(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function n(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=n(i);fetch(i.href,o)}})();var Oh=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function z2(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var bg={exports:{}},pu={};var Sx;function B2(){if(Sx)return pu;Sx=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function n(r,i,o){var l=null;if(o!==void 0&&(l=""+o),i.key!==void 0&&(l=""+i.key),"key"in i){o={};for(var d in i)d!=="key"&&(o[d]=i[d])}else o=i;return i=o.ref,{$$typeof:t,type:r,key:l,ref:i!==void 0?i:null,props:o}}return pu.Fragment=e,pu.jsx=n,pu.jsxs=n,pu}var Cx;function L2(){return Cx||(Cx=1,bg.exports=B2()),bg.exports}var u=L2(),vg={exports:{}},Je={};var Ex;function U2(){if(Ex)return Je;Ex=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),o=Symbol.for("react.consumer"),l=Symbol.for("react.context"),d=Symbol.for("react.forward_ref"),h=Symbol.for("react.suspense"),m=Symbol.for("react.memo"),p=Symbol.for("react.lazy"),g=Symbol.for("react.activity"),v=Symbol.iterator;function _(B){return B===null||typeof B!="object"?null:(B=v&&B[v]||B["@@iterator"],typeof B=="function"?B:null)}var C={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},x=Object.assign,S={};function E(B,G,ne){this.props=B,this.context=G,this.refs=S,this.updater=ne||C}E.prototype.isReactComponent={},E.prototype.setState=function(B,G){if(typeof B!="object"&&typeof B!="function"&&B!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,B,G,"setState")},E.prototype.forceUpdate=function(B){this.updater.enqueueForceUpdate(this,B,"forceUpdate")};function T(){}T.prototype=E.prototype;function I(B,G,ne){this.props=B,this.context=G,this.refs=S,this.updater=ne||C}var M=I.prototype=new T;M.constructor=I,x(M,E.prototype),M.isPureReactComponent=!0;var L=Array.isArray;function $(){}var k={H:null,A:null,T:null,S:null},A=Object.prototype.hasOwnProperty;function N(B,G,ne){var ie=ne.ref;return{$$typeof:t,type:B,key:G,ref:ie!==void 0?ie:null,props:ne}}function F(B,G){return N(B.type,G,B.props)}function q(B){return typeof B=="object"&&B!==null&&B.$$typeof===t}function j(B){var G={"=":"=0",":":"=2"};return"$"+B.replace(/[=:]/g,function(ne){return G[ne]})}var P=/\/+/g;function O(B,G){return typeof B=="object"&&B!==null&&B.key!=null?j(""+B.key):G.toString(36)}function X(B){switch(B.status){case"fulfilled":return B.value;case"rejected":throw B.reason;default:switch(typeof B.status=="string"?B.then($,$):(B.status="pending",B.then(function(G){B.status==="pending"&&(B.status="fulfilled",B.value=G)},function(G){B.status==="pending"&&(B.status="rejected",B.reason=G)})),B.status){case"fulfilled":return B.value;case"rejected":throw B.reason}}throw B}function W(B,G,ne,ie,ee){var ue=typeof B;(ue==="undefined"||ue==="boolean")&&(B=null);var be=!1;if(B===null)be=!0;else switch(ue){case"bigint":case"string":case"number":be=!0;break;case"object":switch(B.$$typeof){case t:case e:be=!0;break;case p:return be=B._init,W(be(B._payload),G,ne,ie,ee)}}if(be)return ee=ee(B),be=ie===""?"."+O(B,0):ie,L(ee)?(ne="",be!=null&&(ne=be.replace(P,"$&/")+"/"),W(ee,G,ne,"",function(ze){return ze})):ee!=null&&(q(ee)&&(ee=F(ee,ne+(ee.key==null||B&&B.key===ee.key?"":(""+ee.key).replace(P,"$&/")+"/")+be)),G.push(ee)),1;be=0;var ce=ie===""?".":ie+":";if(L(B))for(var ve=0;ve<B.length;ve++)ie=B[ve],ue=ce+O(ie,ve),be+=W(ie,G,ne,ue,ee);else if(ve=_(B),typeof ve=="function")for(B=ve.call(B),ve=0;!(ie=B.next()).done;)ie=ie.value,ue=ce+O(ie,ve++),be+=W(ie,G,ne,ue,ee);else if(ue==="object"){if(typeof B.then=="function")return W(X(B),G,ne,ie,ee);throw G=String(B),Error("Objects are not valid as a React child (found: "+(G==="[object Object]"?"object with keys {"+Object.keys(B).join(", ")+"}":G)+"). If you meant to render a collection of children, use an array instead.")}return be}function H(B,G,ne){if(B==null)return B;var ie=[],ee=0;return W(B,ie,"","",function(ue){return G.call(ne,ue,ee++)}),ie}function Z(B){if(B._status===-1){var G=B._result;G=G(),G.then(function(ne){(B._status===0||B._status===-1)&&(B._status=1,B._result=ne)},function(ne){(B._status===0||B._status===-1)&&(B._status=2,B._result=ne)}),B._status===-1&&(B._status=0,B._result=G)}if(B._status===1)return B._result.default;throw B._result}var Y=typeof reportError=="function"?reportError:function(B){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var G=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof B=="object"&&B!==null&&typeof B.message=="string"?String(B.message):String(B),error:B});if(!window.dispatchEvent(G))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",B);return}console.error(B)},se={map:H,forEach:function(B,G,ne){H(B,function(){G.apply(this,arguments)},ne)},count:function(B){var G=0;return H(B,function(){G++}),G},toArray:function(B){return H(B,function(G){return G})||[]},only:function(B){if(!q(B))throw Error("React.Children.only expected to receive a single React element child.");return B}};return Je.Activity=g,Je.Children=se,Je.Component=E,Je.Fragment=n,Je.Profiler=i,Je.PureComponent=I,Je.StrictMode=r,Je.Suspense=h,Je.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=k,Je.__COMPILER_RUNTIME={__proto__:null,c:function(B){return k.H.useMemoCache(B)}},Je.cache=function(B){return function(){return B.apply(null,arguments)}},Je.cacheSignal=function(){return null},Je.cloneElement=function(B,G,ne){if(B==null)throw Error("The argument must be a React element, but you passed "+B+".");var ie=x({},B.props),ee=B.key;if(G!=null)for(ue in G.key!==void 0&&(ee=""+G.key),G)!A.call(G,ue)||ue==="key"||ue==="__self"||ue==="__source"||ue==="ref"&&G.ref===void 0||(ie[ue]=G[ue]);var ue=arguments.length-2;if(ue===1)ie.children=ne;else if(1<ue){for(var be=Array(ue),ce=0;ce<ue;ce++)be[ce]=arguments[ce+2];ie.children=be}return N(B.type,ee,ie)},Je.createContext=function(B){return B={$$typeof:l,_currentValue:B,_currentValue2:B,_threadCount:0,Provider:null,Consumer:null},B.Provider=B,B.Consumer={$$typeof:o,_context:B},B},Je.createElement=function(B,G,ne){var ie,ee={},ue=null;if(G!=null)for(ie in G.key!==void 0&&(ue=""+G.key),G)A.call(G,ie)&&ie!=="key"&&ie!=="__self"&&ie!=="__source"&&(ee[ie]=G[ie]);var be=arguments.length-2;if(be===1)ee.children=ne;else if(1<be){for(var ce=Array(be),ve=0;ve<be;ve++)ce[ve]=arguments[ve+2];ee.children=ce}if(B&&B.defaultProps)for(ie in be=B.defaultProps,be)ee[ie]===void 0&&(ee[ie]=be[ie]);return N(B,ue,ee)},Je.createRef=function(){return{current:null}},Je.forwardRef=function(B){return{$$typeof:d,render:B}},Je.isValidElement=q,Je.lazy=function(B){return{$$typeof:p,_payload:{_status:-1,_result:B},_init:Z}},Je.memo=function(B,G){return{$$typeof:m,type:B,compare:G===void 0?null:G}},Je.startTransition=function(B){var G=k.T,ne={};k.T=ne;try{var ie=B(),ee=k.S;ee!==null&&ee(ne,ie),typeof ie=="object"&&ie!==null&&typeof ie.then=="function"&&ie.then($,Y)}catch(ue){Y(ue)}finally{G!==null&&ne.types!==null&&(G.types=ne.types),k.T=G}},Je.unstable_useCacheRefresh=function(){return k.H.useCacheRefresh()},Je.use=function(B){return k.H.use(B)},Je.useActionState=function(B,G,ne){return k.H.useActionState(B,G,ne)},Je.useCallback=function(B,G){return k.H.useCallback(B,G)},Je.useContext=function(B){return k.H.useContext(B)},Je.useDebugValue=function(){},Je.useDeferredValue=function(B,G){return k.H.useDeferredValue(B,G)},Je.useEffect=function(B,G){return k.H.useEffect(B,G)},Je.useEffectEvent=function(B){return k.H.useEffectEvent(B)},Je.useId=function(){return k.H.useId()},Je.useImperativeHandle=function(B,G,ne){return k.H.useImperativeHandle(B,G,ne)},Je.useInsertionEffect=function(B,G){return k.H.useInsertionEffect(B,G)},Je.useLayoutEffect=function(B,G){return k.H.useLayoutEffect(B,G)},Je.useMemo=function(B,G){return k.H.useMemo(B,G)},Je.useOptimistic=function(B,G){return k.H.useOptimistic(B,G)},Je.useReducer=function(B,G,ne){return k.H.useReducer(B,G,ne)},Je.useRef=function(B){return k.H.useRef(B)},Je.useState=function(B){return k.H.useState(B)},Je.useSyncExternalStore=function(B,G,ne){return k.H.useSyncExternalStore(B,G,ne)},Je.useTransition=function(){return k.H.useTransition()},Je.version="19.2.3",Je}var Tx;function Oy(){return Tx||(Tx=1,vg.exports=U2()),vg.exports}var D=Oy(),xg={exports:{}},gu={},wg={exports:{}},Sg={};var Ax;function F2(){return Ax||(Ax=1,(function(t){function e(W,H){var Z=W.length;W.push(H);e:for(;0<Z;){var Y=Z-1>>>1,se=W[Y];if(0<i(se,H))W[Y]=H,W[Z]=se,Z=Y;else break e}}function n(W){return W.length===0?null:W[0]}function r(W){if(W.length===0)return null;var H=W[0],Z=W.pop();if(Z!==H){W[0]=Z;e:for(var Y=0,se=W.length,B=se>>>1;Y<B;){var G=2*(Y+1)-1,ne=W[G],ie=G+1,ee=W[ie];if(0>i(ne,Z))ie<se&&0>i(ee,ne)?(W[Y]=ee,W[ie]=Z,Y=ie):(W[Y]=ne,W[G]=Z,Y=G);else if(ie<se&&0>i(ee,Z))W[Y]=ee,W[ie]=Z,Y=ie;else break e}}return H}function i(W,H){var Z=W.sortIndex-H.sortIndex;return Z!==0?Z:W.id-H.id}if(t.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var o=performance;t.unstable_now=function(){return o.now()}}else{var l=Date,d=l.now();t.unstable_now=function(){return l.now()-d}}var h=[],m=[],p=1,g=null,v=3,_=!1,C=!1,x=!1,S=!1,E=typeof setTimeout=="function"?setTimeout:null,T=typeof clearTimeout=="function"?clearTimeout:null,I=typeof setImmediate<"u"?setImmediate:null;function M(W){for(var H=n(m);H!==null;){if(H.callback===null)r(m);else if(H.startTime<=W)r(m),H.sortIndex=H.expirationTime,e(h,H);else break;H=n(m)}}function L(W){if(x=!1,M(W),!C)if(n(h)!==null)C=!0,$||($=!0,j());else{var H=n(m);H!==null&&X(L,H.startTime-W)}}var $=!1,k=-1,A=5,N=-1;function F(){return S?!0:!(t.unstable_now()-N<A)}function q(){if(S=!1,$){var W=t.unstable_now();N=W;var H=!0;try{e:{C=!1,x&&(x=!1,T(k),k=-1),_=!0;var Z=v;try{t:{for(M(W),g=n(h);g!==null&&!(g.expirationTime>W&&F());){var Y=g.callback;if(typeof Y=="function"){g.callback=null,v=g.priorityLevel;var se=Y(g.expirationTime<=W);if(W=t.unstable_now(),typeof se=="function"){g.callback=se,M(W),H=!0;break t}g===n(h)&&r(h),M(W)}else r(h);g=n(h)}if(g!==null)H=!0;else{var B=n(m);B!==null&&X(L,B.startTime-W),H=!1}}break e}finally{g=null,v=Z,_=!1}H=void 0}}finally{H?j():$=!1}}}var j;if(typeof I=="function")j=function(){I(q)};else if(typeof MessageChannel<"u"){var P=new MessageChannel,O=P.port2;P.port1.onmessage=q,j=function(){O.postMessage(null)}}else j=function(){E(q,0)};function X(W,H){k=E(function(){W(t.unstable_now())},H)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(W){W.callback=null},t.unstable_forceFrameRate=function(W){0>W||125<W?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):A=0<W?Math.floor(1e3/W):5},t.unstable_getCurrentPriorityLevel=function(){return v},t.unstable_next=function(W){switch(v){case 1:case 2:case 3:var H=3;break;default:H=v}var Z=v;v=H;try{return W()}finally{v=Z}},t.unstable_requestPaint=function(){S=!0},t.unstable_runWithPriority=function(W,H){switch(W){case 1:case 2:case 3:case 4:case 5:break;default:W=3}var Z=v;v=W;try{return H()}finally{v=Z}},t.unstable_scheduleCallback=function(W,H,Z){var Y=t.unstable_now();switch(typeof Z=="object"&&Z!==null?(Z=Z.delay,Z=typeof Z=="number"&&0<Z?Y+Z:Y):Z=Y,W){case 1:var se=-1;break;case 2:se=250;break;case 5:se=1073741823;break;case 4:se=1e4;break;default:se=5e3}return se=Z+se,W={id:p++,callback:H,priorityLevel:W,startTime:Z,expirationTime:se,sortIndex:-1},Z>Y?(W.sortIndex=Z,e(m,W),n(h)===null&&W===n(m)&&(x?(T(k),k=-1):x=!0,X(L,Z-Y))):(W.sortIndex=se,e(h,W),C||_||(C=!0,$||($=!0,j()))),W},t.unstable_shouldYield=F,t.unstable_wrapCallback=function(W){var H=v;return function(){var Z=v;v=H;try{return W.apply(this,arguments)}finally{v=Z}}}})(Sg)),Sg}var jx;function V2(){return jx||(jx=1,wg.exports=F2()),wg.exports}var Cg={exports:{}},Kn={};var Rx;function $2(){if(Rx)return Kn;Rx=1;var t=Oy();function e(h){var m="https://react.dev/errors/"+h;if(1<arguments.length){m+="?args[]="+encodeURIComponent(arguments[1]);for(var p=2;p<arguments.length;p++)m+="&args[]="+encodeURIComponent(arguments[p])}return"Minified React error #"+h+"; visit "+m+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function n(){}var r={d:{f:n,r:function(){throw Error(e(522))},D:n,C:n,L:n,m:n,X:n,S:n,M:n},p:0,findDOMNode:null},i=Symbol.for("react.portal");function o(h,m,p){var g=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:i,key:g==null?null:""+g,children:h,containerInfo:m,implementation:p}}var l=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function d(h,m){if(h==="font")return"";if(typeof m=="string")return m==="use-credentials"?m:""}return Kn.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=r,Kn.createPortal=function(h,m){var p=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!m||m.nodeType!==1&&m.nodeType!==9&&m.nodeType!==11)throw Error(e(299));return o(h,m,null,p)},Kn.flushSync=function(h){var m=l.T,p=r.p;try{if(l.T=null,r.p=2,h)return h()}finally{l.T=m,r.p=p,r.d.f()}},Kn.preconnect=function(h,m){typeof h=="string"&&(m?(m=m.crossOrigin,m=typeof m=="string"?m==="use-credentials"?m:"":void 0):m=null,r.d.C(h,m))},Kn.prefetchDNS=function(h){typeof h=="string"&&r.d.D(h)},Kn.preinit=function(h,m){if(typeof h=="string"&&m&&typeof m.as=="string"){var p=m.as,g=d(p,m.crossOrigin),v=typeof m.integrity=="string"?m.integrity:void 0,_=typeof m.fetchPriority=="string"?m.fetchPriority:void 0;p==="style"?r.d.S(h,typeof m.precedence=="string"?m.precedence:void 0,{crossOrigin:g,integrity:v,fetchPriority:_}):p==="script"&&r.d.X(h,{crossOrigin:g,integrity:v,fetchPriority:_,nonce:typeof m.nonce=="string"?m.nonce:void 0})}},Kn.preinitModule=function(h,m){if(typeof h=="string")if(typeof m=="object"&&m!==null){if(m.as==null||m.as==="script"){var p=d(m.as,m.crossOrigin);r.d.M(h,{crossOrigin:p,integrity:typeof m.integrity=="string"?m.integrity:void 0,nonce:typeof m.nonce=="string"?m.nonce:void 0})}}else m==null&&r.d.M(h)},Kn.preload=function(h,m){if(typeof h=="string"&&typeof m=="object"&&m!==null&&typeof m.as=="string"){var p=m.as,g=d(p,m.crossOrigin);r.d.L(h,p,{crossOrigin:g,integrity:typeof m.integrity=="string"?m.integrity:void 0,nonce:typeof m.nonce=="string"?m.nonce:void 0,type:typeof m.type=="string"?m.type:void 0,fetchPriority:typeof m.fetchPriority=="string"?m.fetchPriority:void 0,referrerPolicy:typeof m.referrerPolicy=="string"?m.referrerPolicy:void 0,imageSrcSet:typeof m.imageSrcSet=="string"?m.imageSrcSet:void 0,imageSizes:typeof m.imageSizes=="string"?m.imageSizes:void 0,media:typeof m.media=="string"?m.media:void 0})}},Kn.preloadModule=function(h,m){if(typeof h=="string")if(m){var p=d(m.as,m.crossOrigin);r.d.m(h,{as:typeof m.as=="string"&&m.as!=="script"?m.as:void 0,crossOrigin:p,integrity:typeof m.integrity=="string"?m.integrity:void 0})}else r.d.m(h)},Kn.requestFormReset=function(h){r.d.r(h)},Kn.unstable_batchedUpdates=function(h,m){return h(m)},Kn.useFormState=function(h,m,p){return l.H.useFormState(h,m,p)},Kn.useFormStatus=function(){return l.H.useHostTransitionStatus()},Kn.version="19.2.3",Kn}var Ix;function q2(){if(Ix)return Cg.exports;Ix=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),Cg.exports=$2(),Cg.exports}var kx;function H2(){if(kx)return gu;kx=1;var t=V2(),e=Oy(),n=q2();function r(s){var a="https://react.dev/errors/"+s;if(1<arguments.length){a+="?args[]="+encodeURIComponent(arguments[1]);for(var c=2;c<arguments.length;c++)a+="&args[]="+encodeURIComponent(arguments[c])}return"Minified React error #"+s+"; visit "+a+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(s){return!(!s||s.nodeType!==1&&s.nodeType!==9&&s.nodeType!==11)}function o(s){var a=s,c=s;if(s.alternate)for(;a.return;)a=a.return;else{s=a;do a=s,(a.flags&4098)!==0&&(c=a.return),s=a.return;while(s)}return a.tag===3?c:null}function l(s){if(s.tag===13){var a=s.memoizedState;if(a===null&&(s=s.alternate,s!==null&&(a=s.memoizedState)),a!==null)return a.dehydrated}return null}function d(s){if(s.tag===31){var a=s.memoizedState;if(a===null&&(s=s.alternate,s!==null&&(a=s.memoizedState)),a!==null)return a.dehydrated}return null}function h(s){if(o(s)!==s)throw Error(r(188))}function m(s){var a=s.alternate;if(!a){if(a=o(s),a===null)throw Error(r(188));return a!==s?null:s}for(var c=s,f=a;;){var b=c.return;if(b===null)break;var w=b.alternate;if(w===null){if(f=b.return,f!==null){c=f;continue}break}if(b.child===w.child){for(w=b.child;w;){if(w===c)return h(b),s;if(w===f)return h(b),a;w=w.sibling}throw Error(r(188))}if(c.return!==f.return)c=b,f=w;else{for(var z=!1,Q=b.child;Q;){if(Q===c){z=!0,c=b,f=w;break}if(Q===f){z=!0,f=b,c=w;break}Q=Q.sibling}if(!z){for(Q=w.child;Q;){if(Q===c){z=!0,c=w,f=b;break}if(Q===f){z=!0,f=w,c=b;break}Q=Q.sibling}if(!z)throw Error(r(189))}}if(c.alternate!==f)throw Error(r(190))}if(c.tag!==3)throw Error(r(188));return c.stateNode.current===c?s:a}function p(s){var a=s.tag;if(a===5||a===26||a===27||a===6)return s;for(s=s.child;s!==null;){if(a=p(s),a!==null)return a;s=s.sibling}return null}var g=Object.assign,v=Symbol.for("react.element"),_=Symbol.for("react.transitional.element"),C=Symbol.for("react.portal"),x=Symbol.for("react.fragment"),S=Symbol.for("react.strict_mode"),E=Symbol.for("react.profiler"),T=Symbol.for("react.consumer"),I=Symbol.for("react.context"),M=Symbol.for("react.forward_ref"),L=Symbol.for("react.suspense"),$=Symbol.for("react.suspense_list"),k=Symbol.for("react.memo"),A=Symbol.for("react.lazy"),N=Symbol.for("react.activity"),F=Symbol.for("react.memo_cache_sentinel"),q=Symbol.iterator;function j(s){return s===null||typeof s!="object"?null:(s=q&&s[q]||s["@@iterator"],typeof s=="function"?s:null)}var P=Symbol.for("react.client.reference");function O(s){if(s==null)return null;if(typeof s=="function")return s.$$typeof===P?null:s.displayName||s.name||null;if(typeof s=="string")return s;switch(s){case x:return"Fragment";case E:return"Profiler";case S:return"StrictMode";case L:return"Suspense";case $:return"SuspenseList";case N:return"Activity"}if(typeof s=="object")switch(s.$$typeof){case C:return"Portal";case I:return s.displayName||"Context";case T:return(s._context.displayName||"Context")+".Consumer";case M:var a=s.render;return s=s.displayName,s||(s=a.displayName||a.name||"",s=s!==""?"ForwardRef("+s+")":"ForwardRef"),s;case k:return a=s.displayName||null,a!==null?a:O(s.type)||"Memo";case A:a=s._payload,s=s._init;try{return O(s(a))}catch{}}return null}var X=Array.isArray,W=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,H=n.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Z={pending:!1,data:null,method:null,action:null},Y=[],se=-1;function B(s){return{current:s}}function G(s){0>se||(s.current=Y[se],Y[se]=null,se--)}function ne(s,a){se++,Y[se]=s.current,s.current=a}var ie=B(null),ee=B(null),ue=B(null),be=B(null);function ce(s,a){switch(ne(ue,a),ne(ee,s),ne(ie,null),a.nodeType){case 9:case 11:s=(s=a.documentElement)&&(s=s.namespaceURI)?Gv(s):0;break;default:if(s=a.tagName,a=a.namespaceURI)a=Gv(a),s=Qv(a,s);else switch(s){case"svg":s=1;break;case"math":s=2;break;default:s=0}}G(ie),ne(ie,s)}function ve(){G(ie),G(ee),G(ue)}function ze(s){s.memoizedState!==null&&ne(be,s);var a=ie.current,c=Qv(a,s.type);a!==c&&(ne(ee,s),ne(ie,c))}function Pe(s){ee.current===s&&(G(ie),G(ee)),be.current===s&&(G(be),du._currentValue=Z)}var ot,_t;function U(s){if(ot===void 0)try{throw Error()}catch(c){var a=c.stack.trim().match(/\n( *(at )?)/);ot=a&&a[1]||"",_t=-1<c.stack.indexOf(`
    at`)?" (<anonymous>)":-1<c.stack.indexOf("@")?"@unknown:0:0":""}return`
`+ot+s+_t}var he=!1;function ye(s,a){if(!s||he)return"";he=!0;var c=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var f={DetermineComponentFrameRoot:function(){try{if(a){var Re=function(){throw Error()};if(Object.defineProperty(Re.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Re,[])}catch(we){var _e=we}Reflect.construct(s,[],Re)}else{try{Re.call()}catch(we){_e=we}s.call(Re.prototype)}}else{try{throw Error()}catch(we){_e=we}(Re=s())&&typeof Re.catch=="function"&&Re.catch(function(){})}}catch(we){if(we&&_e&&typeof we.stack=="string")return[we.stack,_e.stack]}return[null,null]}};f.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var b=Object.getOwnPropertyDescriptor(f.DetermineComponentFrameRoot,"name");b&&b.configurable&&Object.defineProperty(f.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var w=f.DetermineComponentFrameRoot(),z=w[0],Q=w[1];if(z&&Q){var re=z.split(`
`),ge=Q.split(`
`);for(b=f=0;f<re.length&&!re[f].includes("DetermineComponentFrameRoot");)f++;for(;b<ge.length&&!ge[b].includes("DetermineComponentFrameRoot");)b++;if(f===re.length||b===ge.length)for(f=re.length-1,b=ge.length-1;1<=f&&0<=b&&re[f]!==ge[b];)b--;for(;1<=f&&0<=b;f--,b--)if(re[f]!==ge[b]){if(f!==1||b!==1)do if(f--,b--,0>b||re[f]!==ge[b]){var Ee=`
`+re[f].replace(" at new "," at ");return s.displayName&&Ee.includes("<anonymous>")&&(Ee=Ee.replace("<anonymous>",s.displayName)),Ee}while(1<=f&&0<=b);break}}}finally{he=!1,Error.prepareStackTrace=c}return(c=s?s.displayName||s.name:"")?U(c):""}function te(s,a){switch(s.tag){case 26:case 27:case 5:return U(s.type);case 16:return U("Lazy");case 13:return s.child!==a&&a!==null?U("Suspense Fallback"):U("Suspense");case 19:return U("SuspenseList");case 0:case 15:return ye(s.type,!1);case 11:return ye(s.type.render,!1);case 1:return ye(s.type,!0);case 31:return U("Activity");default:return""}}function J(s){try{var a="",c=null;do a+=te(s,c),c=s,s=s.return;while(s);return a}catch(f){return`
Error generating stack: `+f.message+`
`+f.stack}}var oe=Object.prototype.hasOwnProperty,Ce=t.unstable_scheduleCallback,Se=t.unstable_cancelCallback,ae=t.unstable_shouldYield,Ae=t.unstable_requestPaint,Me=t.unstable_now,De=t.unstable_getCurrentPriorityLevel,He=t.unstable_ImmediatePriority,wt=t.unstable_UserBlockingPriority,nt=t.unstable_NormalPriority,Qn=t.unstable_LowPriority,ms=t.unstable_IdlePriority,er=t.log,ps=t.unstable_setDisableYieldValue,vt=null,en=null;function Wn(s){if(typeof er=="function"&&ps(s),en&&typeof en.setStrictMode=="function")try{en.setStrictMode(vt,s)}catch{}}var Et=Math.clz32?Math.clz32:Uo,Ua=Math.log,Ai=Math.LN2;function Uo(s){return s>>>=0,s===0?32:31-(Ua(s)/Ai|0)|0}var Ir=256,gs=262144,Ut=4194304;function tr(s){var a=s&42;if(a!==0)return a;switch(s&-s){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return s&261888;case 262144:case 524288:case 1048576:case 2097152:return s&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return s&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return s}}function ys(s,a,c){var f=s.pendingLanes;if(f===0)return 0;var b=0,w=s.suspendedLanes,z=s.pingedLanes;s=s.warmLanes;var Q=f&134217727;return Q!==0?(f=Q&~w,f!==0?b=tr(f):(z&=Q,z!==0?b=tr(z):c||(c=Q&~s,c!==0&&(b=tr(c))))):(Q=f&~w,Q!==0?b=tr(Q):z!==0?b=tr(z):c||(c=f&~s,c!==0&&(b=tr(c)))),b===0?0:a!==0&&a!==b&&(a&w)===0&&(w=b&-b,c=a&-a,w>=c||w===32&&(c&4194048)!==0)?a:b}function Wr(s,a){return(s.pendingLanes&~(s.suspendedLanes&~s.pingedLanes)&a)===0}function Sm(s,a){switch(s){case 1:case 2:case 4:case 8:case 64:return a+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function ud(){var s=Ut;return Ut<<=1,(Ut&62914560)===0&&(Ut=4194304),s}function _s(s){for(var a=[],c=0;31>c;c++)a.push(s);return a}function Fa(s,a){s.pendingLanes|=a,a!==268435456&&(s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0)}function Cm(s,a,c,f,b,w){var z=s.pendingLanes;s.pendingLanes=c,s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0,s.expiredLanes&=c,s.entangledLanes&=c,s.errorRecoveryDisabledLanes&=c,s.shellSuspendCounter=0;var Q=s.entanglements,re=s.expirationTimes,ge=s.hiddenUpdates;for(c=z&~c;0<c;){var Ee=31-Et(c),Re=1<<Ee;Q[Ee]=0,re[Ee]=-1;var _e=ge[Ee];if(_e!==null)for(ge[Ee]=null,Ee=0;Ee<_e.length;Ee++){var we=_e[Ee];we!==null&&(we.lane&=-536870913)}c&=~Re}f!==0&&Va(s,f,0),w!==0&&b===0&&s.tag!==0&&(s.suspendedLanes|=w&~(z&~a))}function Va(s,a,c){s.pendingLanes|=a,s.suspendedLanes&=~a;var f=31-Et(a);s.entangledLanes|=a,s.entanglements[f]=s.entanglements[f]|1073741824|c&261930}function gc(s,a){var c=s.entangledLanes|=a;for(s=s.entanglements;c;){var f=31-Et(c),b=1<<f;b&a|s[f]&a&&(s[f]|=a),c&=~b}}function yc(s,a){var c=a&-a;return c=(c&42)!==0?1:$a(c),(c&(s.suspendedLanes|a))!==0?0:c}function $a(s){switch(s){case 2:s=1;break;case 8:s=4;break;case 32:s=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:s=128;break;case 268435456:s=134217728;break;default:s=0}return s}function Qs(s){return s&=-s,2<s?8<s?(s&134217727)!==0?32:268435456:8:2}function dd(){var s=H.p;return s!==0?s:(s=window.event,s===void 0?32:gx(s.type))}function Kr(s,a){var c=H.p;try{return H.p=s,a()}finally{H.p=c}}var Yr=Math.random().toString(36).slice(2),dn="__reactFiber$"+Yr,Rn="__reactProps$"+Yr,bs="__reactContainer$"+Yr,Fo="__reactEvents$"+Yr,Em="__reactListeners$"+Yr,hd="__reactHandles$"+Yr,fd="__reactResources$"+Yr,vs="__reactMarker$"+Yr;function Vo(s){delete s[dn],delete s[Rn],delete s[Fo],delete s[Em],delete s[hd]}function xs(s){var a=s[dn];if(a)return a;for(var c=s.parentNode;c;){if(a=c[bs]||c[dn]){if(c=a.alternate,a.child!==null||c!==null&&c.child!==null)for(s=ex(s);s!==null;){if(c=s[dn])return c;s=ex(s)}return a}s=c,c=s.parentNode}return null}function kr(s){if(s=s[dn]||s[bs]){var a=s.tag;if(a===5||a===6||a===13||a===31||a===26||a===27||a===3)return s}return null}function _r(s){var a=s.tag;if(a===5||a===26||a===27||a===6)return s.stateNode;throw Error(r(33))}function ws(s){var a=s[fd];return a||(a=s[fd]={hoistableStyles:new Map,hoistableScripts:new Map}),a}function hn(s){s[vs]=!0}var _c=new Set,bc={};function Ss(s,a){Cs(s,a),Cs(s+"Capture",a)}function Cs(s,a){for(bc[s]=a,s=0;s<a.length;s++)_c.add(a[s])}var vc=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),xc={},wc={};function md(s){return oe.call(wc,s)?!0:oe.call(xc,s)?!1:vc.test(s)?wc[s]=!0:(xc[s]=!0,!1)}function $o(s,a,c){if(md(a))if(c===null)s.removeAttribute(a);else{switch(typeof c){case"undefined":case"function":case"symbol":s.removeAttribute(a);return;case"boolean":var f=a.toLowerCase().slice(0,5);if(f!=="data-"&&f!=="aria-"){s.removeAttribute(a);return}}s.setAttribute(a,""+c)}}function br(s,a,c){if(c===null)s.removeAttribute(a);else{switch(typeof c){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(a);return}s.setAttribute(a,""+c)}}function fn(s,a,c,f){if(f===null)s.removeAttribute(c);else{switch(typeof f){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(c);return}s.setAttributeNS(a,c,""+f)}}function In(s){switch(typeof s){case"bigint":case"boolean":case"number":case"string":case"undefined":return s;case"object":return s;default:return""}}function ji(s){var a=s.type;return(s=s.nodeName)&&s.toLowerCase()==="input"&&(a==="checkbox"||a==="radio")}function Sc(s,a,c){var f=Object.getOwnPropertyDescriptor(s.constructor.prototype,a);if(!s.hasOwnProperty(a)&&typeof f<"u"&&typeof f.get=="function"&&typeof f.set=="function"){var b=f.get,w=f.set;return Object.defineProperty(s,a,{configurable:!0,get:function(){return b.call(this)},set:function(z){c=""+z,w.call(this,z)}}),Object.defineProperty(s,a,{enumerable:f.enumerable}),{getValue:function(){return c},setValue:function(z){c=""+z},stopTracking:function(){s._valueTracker=null,delete s[a]}}}}function It(s){if(!s._valueTracker){var a=ji(s)?"checked":"value";s._valueTracker=Sc(s,a,""+s[a])}}function qa(s){if(!s)return!1;var a=s._valueTracker;if(!a)return!0;var c=a.getValue(),f="";return s&&(f=ji(s)?s.checked?"true":"false":s.value),s=f,s!==c?(a.setValue(s),!0):!1}function Es(s){if(s=s||(typeof document<"u"?document:void 0),typeof s>"u")return null;try{return s.activeElement||s.body}catch{return s.body}}var Ha=/[\n"\\]/g;function ir(s){return s.replace(Ha,function(a){return"\\"+a.charCodeAt(0).toString(16)+" "})}function qo(s,a,c,f,b,w,z,Q){s.name="",z!=null&&typeof z!="function"&&typeof z!="symbol"&&typeof z!="boolean"?s.type=z:s.removeAttribute("type"),a!=null?z==="number"?(a===0&&s.value===""||s.value!=a)&&(s.value=""+In(a)):s.value!==""+In(a)&&(s.value=""+In(a)):z!=="submit"&&z!=="reset"||s.removeAttribute("value"),a!=null?Cc(s,z,In(a)):c!=null?Cc(s,z,In(c)):f!=null&&s.removeAttribute("value"),b==null&&w!=null&&(s.defaultChecked=!!w),b!=null&&(s.checked=b&&typeof b!="function"&&typeof b!="symbol"),Q!=null&&typeof Q!="function"&&typeof Q!="symbol"&&typeof Q!="boolean"?s.name=""+In(Q):s.removeAttribute("name")}function pd(s,a,c,f,b,w,z,Q){if(w!=null&&typeof w!="function"&&typeof w!="symbol"&&typeof w!="boolean"&&(s.type=w),a!=null||c!=null){if(!(w!=="submit"&&w!=="reset"||a!=null)){It(s);return}c=c!=null?""+In(c):"",a=a!=null?""+In(a):c,Q||a===s.value||(s.value=a),s.defaultValue=a}f=f??b,f=typeof f!="function"&&typeof f!="symbol"&&!!f,s.checked=Q?s.checked:!!f,s.defaultChecked=!!f,z!=null&&typeof z!="function"&&typeof z!="symbol"&&typeof z!="boolean"&&(s.name=z),It(s)}function Cc(s,a,c){a==="number"&&Es(s.ownerDocument)===s||s.defaultValue===""+c||(s.defaultValue=""+c)}function Ri(s,a,c,f){if(s=s.options,a){a={};for(var b=0;b<c.length;b++)a["$"+c[b]]=!0;for(c=0;c<s.length;c++)b=a.hasOwnProperty("$"+s[c].value),s[c].selected!==b&&(s[c].selected=b),b&&f&&(s[c].defaultSelected=!0)}else{for(c=""+In(c),a=null,b=0;b<s.length;b++){if(s[b].value===c){s[b].selected=!0,f&&(s[b].defaultSelected=!0);return}a!==null||s[b].disabled||(a=s[b])}a!==null&&(a.selected=!0)}}function gd(s,a,c){if(a!=null&&(a=""+In(a),a!==s.value&&(s.value=a),c==null)){s.defaultValue!==a&&(s.defaultValue=a);return}s.defaultValue=c!=null?""+In(c):""}function Ii(s,a,c,f){if(a==null){if(f!=null){if(c!=null)throw Error(r(92));if(X(f)){if(1<f.length)throw Error(r(93));f=f[0]}c=f}c==null&&(c=""),a=c}c=In(a),s.defaultValue=c,f=s.textContent,f===c&&f!==""&&f!==null&&(s.value=f),It(s)}function ar(s,a){if(a){var c=s.firstChild;if(c&&c===s.lastChild&&c.nodeType===3){c.nodeValue=a;return}}s.textContent=a}var yd=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Ec(s,a,c){var f=a.indexOf("--")===0;c==null||typeof c=="boolean"||c===""?f?s.setProperty(a,""):a==="float"?s.cssFloat="":s[a]="":f?s.setProperty(a,c):typeof c!="number"||c===0||yd.has(a)?a==="float"?s.cssFloat=c:s[a]=(""+c).trim():s[a]=c+"px"}function Tc(s,a,c){if(a!=null&&typeof a!="object")throw Error(r(62));if(s=s.style,c!=null){for(var f in c)!c.hasOwnProperty(f)||a!=null&&a.hasOwnProperty(f)||(f.indexOf("--")===0?s.setProperty(f,""):f==="float"?s.cssFloat="":s[f]="");for(var b in a)f=a[b],a.hasOwnProperty(b)&&c[b]!==f&&Ec(s,b,f)}else for(var w in a)a.hasOwnProperty(w)&&Ec(s,w,a[w])}function Ho(s){if(s.indexOf("-")===-1)return!1;switch(s){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var _d=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),ki=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Go(s){return ki.test(""+s)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":s}function Xr(){}var Ac=null;function Dr(s){return s=s.target||s.srcElement||window,s.correspondingUseElement&&(s=s.correspondingUseElement),s.nodeType===3?s.parentNode:s}var Di=null,Ts=null;function Ga(s){var a=kr(s);if(a&&(s=a.stateNode)){var c=s[Rn]||null;e:switch(s=a.stateNode,a.type){case"input":if(qo(s,c.value,c.defaultValue,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name),a=c.name,c.type==="radio"&&a!=null){for(c=s;c.parentNode;)c=c.parentNode;for(c=c.querySelectorAll('input[name="'+ir(""+a)+'"][type="radio"]'),a=0;a<c.length;a++){var f=c[a];if(f!==s&&f.form===s.form){var b=f[Rn]||null;if(!b)throw Error(r(90));qo(f,b.value,b.defaultValue,b.defaultValue,b.checked,b.defaultChecked,b.type,b.name)}}for(a=0;a<c.length;a++)f=c[a],f.form===s.form&&qa(f)}break e;case"textarea":gd(s,c.value,c.defaultValue);break e;case"select":a=c.value,a!=null&&Ri(s,!!c.multiple,a,!1)}}}var Qo=!1;function Oi(s,a,c){if(Qo)return s(a,c);Qo=!0;try{var f=s(a);return f}finally{if(Qo=!1,(Di!==null||Ts!==null)&&(dh(),Di&&(a=Di,s=Ts,Ts=Di=null,Ga(a),s)))for(a=0;a<s.length;a++)Ga(s[a])}}function Zr(s,a){var c=s.stateNode;if(c===null)return null;var f=c[Rn]||null;if(f===null)return null;c=f[a];e:switch(a){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(f=!f.disabled)||(s=s.type,f=!(s==="button"||s==="input"||s==="select"||s==="textarea")),s=!f;break e;default:s=!1}if(s)return null;if(c&&typeof c!="function")throw Error(r(231,a,typeof c));return c}var Or=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Qa=!1;if(Or)try{var Ot={};Object.defineProperty(Ot,"passive",{get:function(){Qa=!0}}),window.addEventListener("test",Ot,Ot),window.removeEventListener("test",Ot,Ot)}catch{Qa=!1}var As=null,jc=null,Wa=null;function Rc(){if(Wa)return Wa;var s,a=jc,c=a.length,f,b="value"in As?As.value:As.textContent,w=b.length;for(s=0;s<c&&a[s]===b[s];s++);var z=c-s;for(f=1;f<=z&&a[c-f]===b[w-f];f++);return Wa=b.slice(s,1<f?1-f:void 0)}function Ka(s){var a=s.keyCode;return"charCode"in s?(s=s.charCode,s===0&&a===13&&(s=13)):s=a,s===10&&(s=13),32<=s||s===13?s:0}function Ws(){return!0}function Jr(){return!1}function Nn(s){function a(c,f,b,w,z){this._reactName=c,this._targetInst=b,this.type=f,this.nativeEvent=w,this.target=z,this.currentTarget=null;for(var Q in s)s.hasOwnProperty(Q)&&(c=s[Q],this[Q]=c?c(w):w[Q]);return this.isDefaultPrevented=(w.defaultPrevented!=null?w.defaultPrevented:w.returnValue===!1)?Ws:Jr,this.isPropagationStopped=Jr,this}return g(a.prototype,{preventDefault:function(){this.defaultPrevented=!0;var c=this.nativeEvent;c&&(c.preventDefault?c.preventDefault():typeof c.returnValue!="unknown"&&(c.returnValue=!1),this.isDefaultPrevented=Ws)},stopPropagation:function(){var c=this.nativeEvent;c&&(c.stopPropagation?c.stopPropagation():typeof c.cancelBubble!="unknown"&&(c.cancelBubble=!0),this.isPropagationStopped=Ws)},persist:function(){},isPersistent:Ws}),a}var Ks={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(s){return s.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},js=Nn(Ks),Mi=g({},Ks,{view:0,detail:0}),Ic=Nn(Mi),Ni,Wo,Rs,Ko=g({},Mi,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Pi,button:0,buttons:0,relatedTarget:function(s){return s.relatedTarget===void 0?s.fromElement===s.srcElement?s.toElement:s.fromElement:s.relatedTarget},movementX:function(s){return"movementX"in s?s.movementX:(s!==Rs&&(Rs&&s.type==="mousemove"?(Ni=s.screenX-Rs.screenX,Wo=s.screenY-Rs.screenY):Wo=Ni=0,Rs=s),Ni)},movementY:function(s){return"movementY"in s?s.movementY:Wo}}),kc=Nn(Ko),Ya=g({},Ko,{dataTransfer:0}),bd=Nn(Ya),vd=g({},Mi,{relatedTarget:0}),Xa=Nn(vd),Dc=g({},Ks,{animationName:0,elapsedTime:0,pseudoElement:0}),xd=Nn(Dc),Yo=g({},Ks,{clipboardData:function(s){return"clipboardData"in s?s.clipboardData:window.clipboardData}}),wd=Nn(Yo),Sd=g({},Ks,{data:0}),Is=Nn(Sd),Cd={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Ed={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Td={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Ad(s){var a=this.nativeEvent;return a.getModifierState?a.getModifierState(s):(s=Td[s])?!!a[s]:!1}function Pi(){return Ad}var nr=g({},Mi,{key:function(s){if(s.key){var a=Cd[s.key]||s.key;if(a!=="Unidentified")return a}return s.type==="keypress"?(s=Ka(s),s===13?"Enter":String.fromCharCode(s)):s.type==="keydown"||s.type==="keyup"?Ed[s.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Pi,charCode:function(s){return s.type==="keypress"?Ka(s):0},keyCode:function(s){return s.type==="keydown"||s.type==="keyup"?s.keyCode:0},which:function(s){return s.type==="keypress"?Ka(s):s.type==="keydown"||s.type==="keyup"?s.keyCode:0}}),jd=Nn(nr),Rd=g({},Ko,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Ys=Nn(Rd),y=g({},Mi,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Pi}),R=Nn(y),V=g({},Ks,{propertyName:0,elapsedTime:0,pseudoElement:0}),K=Nn(V),fe=g({},Ko,{deltaX:function(s){return"deltaX"in s?s.deltaX:"wheelDeltaX"in s?-s.wheelDeltaX:0},deltaY:function(s){return"deltaY"in s?s.deltaY:"wheelDeltaY"in s?-s.wheelDeltaY:"wheelDelta"in s?-s.wheelDelta:0},deltaZ:0,deltaMode:0}),xe=Nn(fe),Ne=g({},Ks,{newState:0,oldState:0}),rt=Nn(Ne),rn=[9,13,27,32],Tt=Or&&"CompositionEvent"in window,Qt=null;Or&&"documentMode"in document&&(Qt=document.documentMode);var Mr=Or&&"TextEvent"in window&&!Qt,ks=Or&&(!Tt||Qt&&8<Qt&&11>=Qt),es=" ",ts=!1;function Za(s,a){switch(s){case"keyup":return rn.indexOf(a.keyCode)!==-1;case"keydown":return a.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Xo(s){return s=s.detail,typeof s=="object"&&"data"in s?s.data:null}var Zo=!1;function oA(s,a){switch(s){case"compositionend":return Xo(a);case"keypress":return a.which!==32?null:(ts=!0,es);case"textInput":return s=a.data,s===es&&ts?null:s;default:return null}}function lA(s,a){if(Zo)return s==="compositionend"||!Tt&&Za(s,a)?(s=Rc(),Wa=jc=As=null,Zo=!1,s):null;switch(s){case"paste":return null;case"keypress":if(!(a.ctrlKey||a.altKey||a.metaKey)||a.ctrlKey&&a.altKey){if(a.char&&1<a.char.length)return a.char;if(a.which)return String.fromCharCode(a.which)}return null;case"compositionend":return ks&&a.locale!=="ko"?null:a.data;default:return null}}var cA={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function r_(s){var a=s&&s.nodeName&&s.nodeName.toLowerCase();return a==="input"?!!cA[s.type]:a==="textarea"}function s_(s,a,c,f){Di?Ts?Ts.push(f):Ts=[f]:Di=f,a=_h(a,"onChange"),0<a.length&&(c=new js("onChange","change",null,c,f),s.push({event:c,listeners:a}))}var Oc=null,Mc=null;function uA(s){Uv(s,0)}function Id(s){var a=_r(s);if(qa(a))return s}function i_(s,a){if(s==="change")return a}var a_=!1;if(Or){var Tm;if(Or){var Am="oninput"in document;if(!Am){var o_=document.createElement("div");o_.setAttribute("oninput","return;"),Am=typeof o_.oninput=="function"}Tm=Am}else Tm=!1;a_=Tm&&(!document.documentMode||9<document.documentMode)}function l_(){Oc&&(Oc.detachEvent("onpropertychange",c_),Mc=Oc=null)}function c_(s){if(s.propertyName==="value"&&Id(Mc)){var a=[];s_(a,Mc,s,Dr(s)),Oi(uA,a)}}function dA(s,a,c){s==="focusin"?(l_(),Oc=a,Mc=c,Oc.attachEvent("onpropertychange",c_)):s==="focusout"&&l_()}function hA(s){if(s==="selectionchange"||s==="keyup"||s==="keydown")return Id(Mc)}function fA(s,a){if(s==="click")return Id(a)}function mA(s,a){if(s==="input"||s==="change")return Id(a)}function pA(s,a){return s===a&&(s!==0||1/s===1/a)||s!==s&&a!==a}var vr=typeof Object.is=="function"?Object.is:pA;function Nc(s,a){if(vr(s,a))return!0;if(typeof s!="object"||s===null||typeof a!="object"||a===null)return!1;var c=Object.keys(s),f=Object.keys(a);if(c.length!==f.length)return!1;for(f=0;f<c.length;f++){var b=c[f];if(!oe.call(a,b)||!vr(s[b],a[b]))return!1}return!0}function u_(s){for(;s&&s.firstChild;)s=s.firstChild;return s}function d_(s,a){var c=u_(s);s=0;for(var f;c;){if(c.nodeType===3){if(f=s+c.textContent.length,s<=a&&f>=a)return{node:c,offset:a-s};s=f}e:{for(;c;){if(c.nextSibling){c=c.nextSibling;break e}c=c.parentNode}c=void 0}c=u_(c)}}function h_(s,a){return s&&a?s===a?!0:s&&s.nodeType===3?!1:a&&a.nodeType===3?h_(s,a.parentNode):"contains"in s?s.contains(a):s.compareDocumentPosition?!!(s.compareDocumentPosition(a)&16):!1:!1}function f_(s){s=s!=null&&s.ownerDocument!=null&&s.ownerDocument.defaultView!=null?s.ownerDocument.defaultView:window;for(var a=Es(s.document);a instanceof s.HTMLIFrameElement;){try{var c=typeof a.contentWindow.location.href=="string"}catch{c=!1}if(c)s=a.contentWindow;else break;a=Es(s.document)}return a}function jm(s){var a=s&&s.nodeName&&s.nodeName.toLowerCase();return a&&(a==="input"&&(s.type==="text"||s.type==="search"||s.type==="tel"||s.type==="url"||s.type==="password")||a==="textarea"||s.contentEditable==="true")}var gA=Or&&"documentMode"in document&&11>=document.documentMode,Jo=null,Rm=null,Pc=null,Im=!1;function m_(s,a,c){var f=c.window===c?c.document:c.nodeType===9?c:c.ownerDocument;Im||Jo==null||Jo!==Es(f)||(f=Jo,"selectionStart"in f&&jm(f)?f={start:f.selectionStart,end:f.selectionEnd}:(f=(f.ownerDocument&&f.ownerDocument.defaultView||window).getSelection(),f={anchorNode:f.anchorNode,anchorOffset:f.anchorOffset,focusNode:f.focusNode,focusOffset:f.focusOffset}),Pc&&Nc(Pc,f)||(Pc=f,f=_h(Rm,"onSelect"),0<f.length&&(a=new js("onSelect","select",null,a,c),s.push({event:a,listeners:f}),a.target=Jo)))}function Ja(s,a){var c={};return c[s.toLowerCase()]=a.toLowerCase(),c["Webkit"+s]="webkit"+a,c["Moz"+s]="moz"+a,c}var el={animationend:Ja("Animation","AnimationEnd"),animationiteration:Ja("Animation","AnimationIteration"),animationstart:Ja("Animation","AnimationStart"),transitionrun:Ja("Transition","TransitionRun"),transitionstart:Ja("Transition","TransitionStart"),transitioncancel:Ja("Transition","TransitionCancel"),transitionend:Ja("Transition","TransitionEnd")},km={},p_={};Or&&(p_=document.createElement("div").style,"AnimationEvent"in window||(delete el.animationend.animation,delete el.animationiteration.animation,delete el.animationstart.animation),"TransitionEvent"in window||delete el.transitionend.transition);function eo(s){if(km[s])return km[s];if(!el[s])return s;var a=el[s],c;for(c in a)if(a.hasOwnProperty(c)&&c in p_)return km[s]=a[c];return s}var g_=eo("animationend"),y_=eo("animationiteration"),__=eo("animationstart"),yA=eo("transitionrun"),_A=eo("transitionstart"),bA=eo("transitioncancel"),b_=eo("transitionend"),v_=new Map,Dm="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Dm.push("scrollEnd");function ns(s,a){v_.set(s,a),Ss(a,[s])}var kd=typeof reportError=="function"?reportError:function(s){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var a=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof s=="object"&&s!==null&&typeof s.message=="string"?String(s.message):String(s),error:s});if(!window.dispatchEvent(a))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",s);return}console.error(s)},Nr=[],tl=0,Om=0;function Dd(){for(var s=tl,a=Om=tl=0;a<s;){var c=Nr[a];Nr[a++]=null;var f=Nr[a];Nr[a++]=null;var b=Nr[a];Nr[a++]=null;var w=Nr[a];if(Nr[a++]=null,f!==null&&b!==null){var z=f.pending;z===null?b.next=b:(b.next=z.next,z.next=b),f.pending=b}w!==0&&x_(c,b,w)}}function Od(s,a,c,f){Nr[tl++]=s,Nr[tl++]=a,Nr[tl++]=c,Nr[tl++]=f,Om|=f,s.lanes|=f,s=s.alternate,s!==null&&(s.lanes|=f)}function Mm(s,a,c,f){return Od(s,a,c,f),Md(s)}function to(s,a){return Od(s,null,null,a),Md(s)}function x_(s,a,c){s.lanes|=c;var f=s.alternate;f!==null&&(f.lanes|=c);for(var b=!1,w=s.return;w!==null;)w.childLanes|=c,f=w.alternate,f!==null&&(f.childLanes|=c),w.tag===22&&(s=w.stateNode,s===null||s._visibility&1||(b=!0)),s=w,w=w.return;return s.tag===3?(w=s.stateNode,b&&a!==null&&(b=31-Et(c),s=w.hiddenUpdates,f=s[b],f===null?s[b]=[a]:f.push(a),a.lane=c|536870912),w):null}function Md(s){if(50<su)throw su=0,$p=null,Error(r(185));for(var a=s.return;a!==null;)s=a,a=s.return;return s.tag===3?s.stateNode:null}var nl={};function vA(s,a,c,f){this.tag=s,this.key=c,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=a,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=f,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function xr(s,a,c,f){return new vA(s,a,c,f)}function Nm(s){return s=s.prototype,!(!s||!s.isReactComponent)}function Xs(s,a){var c=s.alternate;return c===null?(c=xr(s.tag,a,s.key,s.mode),c.elementType=s.elementType,c.type=s.type,c.stateNode=s.stateNode,c.alternate=s,s.alternate=c):(c.pendingProps=a,c.type=s.type,c.flags=0,c.subtreeFlags=0,c.deletions=null),c.flags=s.flags&65011712,c.childLanes=s.childLanes,c.lanes=s.lanes,c.child=s.child,c.memoizedProps=s.memoizedProps,c.memoizedState=s.memoizedState,c.updateQueue=s.updateQueue,a=s.dependencies,c.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext},c.sibling=s.sibling,c.index=s.index,c.ref=s.ref,c.refCleanup=s.refCleanup,c}function w_(s,a){s.flags&=65011714;var c=s.alternate;return c===null?(s.childLanes=0,s.lanes=a,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=c.childLanes,s.lanes=c.lanes,s.child=c.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=c.memoizedProps,s.memoizedState=c.memoizedState,s.updateQueue=c.updateQueue,s.type=c.type,a=c.dependencies,s.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext}),s}function Nd(s,a,c,f,b,w){var z=0;if(f=s,typeof s=="function")Nm(s)&&(z=1);else if(typeof s=="string")z=E2(s,c,ie.current)?26:s==="html"||s==="head"||s==="body"?27:5;else e:switch(s){case N:return s=xr(31,c,a,b),s.elementType=N,s.lanes=w,s;case x:return no(c.children,b,w,a);case S:z=8,b|=24;break;case E:return s=xr(12,c,a,b|2),s.elementType=E,s.lanes=w,s;case L:return s=xr(13,c,a,b),s.elementType=L,s.lanes=w,s;case $:return s=xr(19,c,a,b),s.elementType=$,s.lanes=w,s;default:if(typeof s=="object"&&s!==null)switch(s.$$typeof){case I:z=10;break e;case T:z=9;break e;case M:z=11;break e;case k:z=14;break e;case A:z=16,f=null;break e}z=29,c=Error(r(130,s===null?"null":typeof s,"")),f=null}return a=xr(z,c,a,b),a.elementType=s,a.type=f,a.lanes=w,a}function no(s,a,c,f){return s=xr(7,s,f,a),s.lanes=c,s}function Pm(s,a,c){return s=xr(6,s,null,a),s.lanes=c,s}function S_(s){var a=xr(18,null,null,0);return a.stateNode=s,a}function zm(s,a,c){return a=xr(4,s.children!==null?s.children:[],s.key,a),a.lanes=c,a.stateNode={containerInfo:s.containerInfo,pendingChildren:null,implementation:s.implementation},a}var C_=new WeakMap;function Pr(s,a){if(typeof s=="object"&&s!==null){var c=C_.get(s);return c!==void 0?c:(a={value:s,source:a,stack:J(a)},C_.set(s,a),a)}return{value:s,source:a,stack:J(a)}}var rl=[],sl=0,Pd=null,zc=0,zr=[],Br=0,zi=null,Ds=1,Os="";function Zs(s,a){rl[sl++]=zc,rl[sl++]=Pd,Pd=s,zc=a}function E_(s,a,c){zr[Br++]=Ds,zr[Br++]=Os,zr[Br++]=zi,zi=s;var f=Ds;s=Os;var b=32-Et(f)-1;f&=~(1<<b),c+=1;var w=32-Et(a)+b;if(30<w){var z=b-b%5;w=(f&(1<<z)-1).toString(32),f>>=z,b-=z,Ds=1<<32-Et(a)+b|c<<b|f,Os=w+s}else Ds=1<<w|c<<b|f,Os=s}function Bm(s){s.return!==null&&(Zs(s,1),E_(s,1,0))}function Lm(s){for(;s===Pd;)Pd=rl[--sl],rl[sl]=null,zc=rl[--sl],rl[sl]=null;for(;s===zi;)zi=zr[--Br],zr[Br]=null,Os=zr[--Br],zr[Br]=null,Ds=zr[--Br],zr[Br]=null}function T_(s,a){zr[Br++]=Ds,zr[Br++]=Os,zr[Br++]=zi,Ds=a.id,Os=a.overflow,zi=s}var Pn=null,$t=null,yt=!1,Bi=null,Lr=!1,Um=Error(r(519));function Li(s){var a=Error(r(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Bc(Pr(a,s)),Um}function A_(s){var a=s.stateNode,c=s.type,f=s.memoizedProps;switch(a[dn]=s,a[Rn]=f,c){case"dialog":ut("cancel",a),ut("close",a);break;case"iframe":case"object":case"embed":ut("load",a);break;case"video":case"audio":for(c=0;c<au.length;c++)ut(au[c],a);break;case"source":ut("error",a);break;case"img":case"image":case"link":ut("error",a),ut("load",a);break;case"details":ut("toggle",a);break;case"input":ut("invalid",a),pd(a,f.value,f.defaultValue,f.checked,f.defaultChecked,f.type,f.name,!0);break;case"select":ut("invalid",a);break;case"textarea":ut("invalid",a),Ii(a,f.value,f.defaultValue,f.children)}c=f.children,typeof c!="string"&&typeof c!="number"&&typeof c!="bigint"||a.textContent===""+c||f.suppressHydrationWarning===!0||qv(a.textContent,c)?(f.popover!=null&&(ut("beforetoggle",a),ut("toggle",a)),f.onScroll!=null&&ut("scroll",a),f.onScrollEnd!=null&&ut("scrollend",a),f.onClick!=null&&(a.onclick=Xr),a=!0):a=!1,a||Li(s,!0)}function j_(s){for(Pn=s.return;Pn;)switch(Pn.tag){case 5:case 31:case 13:Lr=!1;return;case 27:case 3:Lr=!0;return;default:Pn=Pn.return}}function il(s){if(s!==Pn)return!1;if(!yt)return j_(s),yt=!0,!1;var a=s.tag,c;if((c=a!==3&&a!==27)&&((c=a===5)&&(c=s.type,c=!(c!=="form"&&c!=="button")||sg(s.type,s.memoizedProps)),c=!c),c&&$t&&Li(s),j_(s),a===13){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(r(317));$t=Jv(s)}else if(a===31){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(r(317));$t=Jv(s)}else a===27?(a=$t,Ji(s.type)?(s=cg,cg=null,$t=s):$t=a):$t=Pn?Fr(s.stateNode.nextSibling):null;return!0}function ro(){$t=Pn=null,yt=!1}function Fm(){var s=Bi;return s!==null&&(ur===null?ur=s:ur.push.apply(ur,s),Bi=null),s}function Bc(s){Bi===null?Bi=[s]:Bi.push(s)}var Vm=B(null),so=null,Js=null;function Ui(s,a,c){ne(Vm,a._currentValue),a._currentValue=c}function ei(s){s._currentValue=Vm.current,G(Vm)}function $m(s,a,c){for(;s!==null;){var f=s.alternate;if((s.childLanes&a)!==a?(s.childLanes|=a,f!==null&&(f.childLanes|=a)):f!==null&&(f.childLanes&a)!==a&&(f.childLanes|=a),s===c)break;s=s.return}}function qm(s,a,c,f){var b=s.child;for(b!==null&&(b.return=s);b!==null;){var w=b.dependencies;if(w!==null){var z=b.child;w=w.firstContext;e:for(;w!==null;){var Q=w;w=b;for(var re=0;re<a.length;re++)if(Q.context===a[re]){w.lanes|=c,Q=w.alternate,Q!==null&&(Q.lanes|=c),$m(w.return,c,s),f||(z=null);break e}w=Q.next}}else if(b.tag===18){if(z=b.return,z===null)throw Error(r(341));z.lanes|=c,w=z.alternate,w!==null&&(w.lanes|=c),$m(z,c,s),z=null}else z=b.child;if(z!==null)z.return=b;else for(z=b;z!==null;){if(z===s){z=null;break}if(b=z.sibling,b!==null){b.return=z.return,z=b;break}z=z.return}b=z}}function al(s,a,c,f){s=null;for(var b=a,w=!1;b!==null;){if(!w){if((b.flags&524288)!==0)w=!0;else if((b.flags&262144)!==0)break}if(b.tag===10){var z=b.alternate;if(z===null)throw Error(r(387));if(z=z.memoizedProps,z!==null){var Q=b.type;vr(b.pendingProps.value,z.value)||(s!==null?s.push(Q):s=[Q])}}else if(b===be.current){if(z=b.alternate,z===null)throw Error(r(387));z.memoizedState.memoizedState!==b.memoizedState.memoizedState&&(s!==null?s.push(du):s=[du])}b=b.return}s!==null&&qm(a,s,c,f),a.flags|=262144}function zd(s){for(s=s.firstContext;s!==null;){if(!vr(s.context._currentValue,s.memoizedValue))return!0;s=s.next}return!1}function io(s){so=s,Js=null,s=s.dependencies,s!==null&&(s.firstContext=null)}function zn(s){return R_(so,s)}function Bd(s,a){return so===null&&io(s),R_(s,a)}function R_(s,a){var c=a._currentValue;if(a={context:a,memoizedValue:c,next:null},Js===null){if(s===null)throw Error(r(308));Js=a,s.dependencies={lanes:0,firstContext:a},s.flags|=524288}else Js=Js.next=a;return c}var xA=typeof AbortController<"u"?AbortController:function(){var s=[],a=this.signal={aborted:!1,addEventListener:function(c,f){s.push(f)}};this.abort=function(){a.aborted=!0,s.forEach(function(c){return c()})}},wA=t.unstable_scheduleCallback,SA=t.unstable_NormalPriority,mn={$$typeof:I,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Hm(){return{controller:new xA,data:new Map,refCount:0}}function Lc(s){s.refCount--,s.refCount===0&&wA(SA,function(){s.controller.abort()})}var Uc=null,Gm=0,ol=0,ll=null;function CA(s,a){if(Uc===null){var c=Uc=[];Gm=0,ol=Kp(),ll={status:"pending",value:void 0,then:function(f){c.push(f)}}}return Gm++,a.then(I_,I_),a}function I_(){if(--Gm===0&&Uc!==null){ll!==null&&(ll.status="fulfilled");var s=Uc;Uc=null,ol=0,ll=null;for(var a=0;a<s.length;a++)(0,s[a])()}}function EA(s,a){var c=[],f={status:"pending",value:null,reason:null,then:function(b){c.push(b)}};return s.then(function(){f.status="fulfilled",f.value=a;for(var b=0;b<c.length;b++)(0,c[b])(a)},function(b){for(f.status="rejected",f.reason=b,b=0;b<c.length;b++)(0,c[b])(void 0)}),f}var k_=W.S;W.S=function(s,a){mv=Me(),typeof a=="object"&&a!==null&&typeof a.then=="function"&&CA(s,a),k_!==null&&k_(s,a)};var ao=B(null);function Qm(){var s=ao.current;return s!==null?s:Lt.pooledCache}function Ld(s,a){a===null?ne(ao,ao.current):ne(ao,a.pool)}function D_(){var s=Qm();return s===null?null:{parent:mn._currentValue,pool:s}}var cl=Error(r(460)),Wm=Error(r(474)),Ud=Error(r(542)),Fd={then:function(){}};function O_(s){return s=s.status,s==="fulfilled"||s==="rejected"}function M_(s,a,c){switch(c=s[c],c===void 0?s.push(a):c!==a&&(a.then(Xr,Xr),a=c),a.status){case"fulfilled":return a.value;case"rejected":throw s=a.reason,P_(s),s;default:if(typeof a.status=="string")a.then(Xr,Xr);else{if(s=Lt,s!==null&&100<s.shellSuspendCounter)throw Error(r(482));s=a,s.status="pending",s.then(function(f){if(a.status==="pending"){var b=a;b.status="fulfilled",b.value=f}},function(f){if(a.status==="pending"){var b=a;b.status="rejected",b.reason=f}})}switch(a.status){case"fulfilled":return a.value;case"rejected":throw s=a.reason,P_(s),s}throw lo=a,cl}}function oo(s){try{var a=s._init;return a(s._payload)}catch(c){throw c!==null&&typeof c=="object"&&typeof c.then=="function"?(lo=c,cl):c}}var lo=null;function N_(){if(lo===null)throw Error(r(459));var s=lo;return lo=null,s}function P_(s){if(s===cl||s===Ud)throw Error(r(483))}var ul=null,Fc=0;function Vd(s){var a=Fc;return Fc+=1,ul===null&&(ul=[]),M_(ul,s,a)}function Vc(s,a){a=a.props.ref,s.ref=a!==void 0?a:null}function $d(s,a){throw a.$$typeof===v?Error(r(525)):(s=Object.prototype.toString.call(a),Error(r(31,s==="[object Object]"?"object with keys {"+Object.keys(a).join(", ")+"}":s)))}function z_(s){function a(de,le){if(s){var pe=de.deletions;pe===null?(de.deletions=[le],de.flags|=16):pe.push(le)}}function c(de,le){if(!s)return null;for(;le!==null;)a(de,le),le=le.sibling;return null}function f(de){for(var le=new Map;de!==null;)de.key!==null?le.set(de.key,de):le.set(de.index,de),de=de.sibling;return le}function b(de,le){return de=Xs(de,le),de.index=0,de.sibling=null,de}function w(de,le,pe){return de.index=pe,s?(pe=de.alternate,pe!==null?(pe=pe.index,pe<le?(de.flags|=67108866,le):pe):(de.flags|=67108866,le)):(de.flags|=1048576,le)}function z(de){return s&&de.alternate===null&&(de.flags|=67108866),de}function Q(de,le,pe,Te){return le===null||le.tag!==6?(le=Pm(pe,de.mode,Te),le.return=de,le):(le=b(le,pe),le.return=de,le)}function re(de,le,pe,Te){var Ge=pe.type;return Ge===x?Ee(de,le,pe.props.children,Te,pe.key):le!==null&&(le.elementType===Ge||typeof Ge=="object"&&Ge!==null&&Ge.$$typeof===A&&oo(Ge)===le.type)?(le=b(le,pe.props),Vc(le,pe),le.return=de,le):(le=Nd(pe.type,pe.key,pe.props,null,de.mode,Te),Vc(le,pe),le.return=de,le)}function ge(de,le,pe,Te){return le===null||le.tag!==4||le.stateNode.containerInfo!==pe.containerInfo||le.stateNode.implementation!==pe.implementation?(le=zm(pe,de.mode,Te),le.return=de,le):(le=b(le,pe.children||[]),le.return=de,le)}function Ee(de,le,pe,Te,Ge){return le===null||le.tag!==7?(le=no(pe,de.mode,Te,Ge),le.return=de,le):(le=b(le,pe),le.return=de,le)}function Re(de,le,pe){if(typeof le=="string"&&le!==""||typeof le=="number"||typeof le=="bigint")return le=Pm(""+le,de.mode,pe),le.return=de,le;if(typeof le=="object"&&le!==null){switch(le.$$typeof){case _:return pe=Nd(le.type,le.key,le.props,null,de.mode,pe),Vc(pe,le),pe.return=de,pe;case C:return le=zm(le,de.mode,pe),le.return=de,le;case A:return le=oo(le),Re(de,le,pe)}if(X(le)||j(le))return le=no(le,de.mode,pe,null),le.return=de,le;if(typeof le.then=="function")return Re(de,Vd(le),pe);if(le.$$typeof===I)return Re(de,Bd(de,le),pe);$d(de,le)}return null}function _e(de,le,pe,Te){var Ge=le!==null?le.key:null;if(typeof pe=="string"&&pe!==""||typeof pe=="number"||typeof pe=="bigint")return Ge!==null?null:Q(de,le,""+pe,Te);if(typeof pe=="object"&&pe!==null){switch(pe.$$typeof){case _:return pe.key===Ge?re(de,le,pe,Te):null;case C:return pe.key===Ge?ge(de,le,pe,Te):null;case A:return pe=oo(pe),_e(de,le,pe,Te)}if(X(pe)||j(pe))return Ge!==null?null:Ee(de,le,pe,Te,null);if(typeof pe.then=="function")return _e(de,le,Vd(pe),Te);if(pe.$$typeof===I)return _e(de,le,Bd(de,pe),Te);$d(de,pe)}return null}function we(de,le,pe,Te,Ge){if(typeof Te=="string"&&Te!==""||typeof Te=="number"||typeof Te=="bigint")return de=de.get(pe)||null,Q(le,de,""+Te,Ge);if(typeof Te=="object"&&Te!==null){switch(Te.$$typeof){case _:return de=de.get(Te.key===null?pe:Te.key)||null,re(le,de,Te,Ge);case C:return de=de.get(Te.key===null?pe:Te.key)||null,ge(le,de,Te,Ge);case A:return Te=oo(Te),we(de,le,pe,Te,Ge)}if(X(Te)||j(Te))return de=de.get(pe)||null,Ee(le,de,Te,Ge,null);if(typeof Te.then=="function")return we(de,le,pe,Vd(Te),Ge);if(Te.$$typeof===I)return we(de,le,pe,Bd(le,Te),Ge);$d(le,Te)}return null}function Fe(de,le,pe,Te){for(var Ge=null,St=null,$e=le,it=le=0,ft=null;$e!==null&&it<pe.length;it++){$e.index>it?(ft=$e,$e=null):ft=$e.sibling;var Ct=_e(de,$e,pe[it],Te);if(Ct===null){$e===null&&($e=ft);break}s&&$e&&Ct.alternate===null&&a(de,$e),le=w(Ct,le,it),St===null?Ge=Ct:St.sibling=Ct,St=Ct,$e=ft}if(it===pe.length)return c(de,$e),yt&&Zs(de,it),Ge;if($e===null){for(;it<pe.length;it++)$e=Re(de,pe[it],Te),$e!==null&&(le=w($e,le,it),St===null?Ge=$e:St.sibling=$e,St=$e);return yt&&Zs(de,it),Ge}for($e=f($e);it<pe.length;it++)ft=we($e,de,it,pe[it],Te),ft!==null&&(s&&ft.alternate!==null&&$e.delete(ft.key===null?it:ft.key),le=w(ft,le,it),St===null?Ge=ft:St.sibling=ft,St=ft);return s&&$e.forEach(function(sa){return a(de,sa)}),yt&&Zs(de,it),Ge}function We(de,le,pe,Te){if(pe==null)throw Error(r(151));for(var Ge=null,St=null,$e=le,it=le=0,ft=null,Ct=pe.next();$e!==null&&!Ct.done;it++,Ct=pe.next()){$e.index>it?(ft=$e,$e=null):ft=$e.sibling;var sa=_e(de,$e,Ct.value,Te);if(sa===null){$e===null&&($e=ft);break}s&&$e&&sa.alternate===null&&a(de,$e),le=w(sa,le,it),St===null?Ge=sa:St.sibling=sa,St=sa,$e=ft}if(Ct.done)return c(de,$e),yt&&Zs(de,it),Ge;if($e===null){for(;!Ct.done;it++,Ct=pe.next())Ct=Re(de,Ct.value,Te),Ct!==null&&(le=w(Ct,le,it),St===null?Ge=Ct:St.sibling=Ct,St=Ct);return yt&&Zs(de,it),Ge}for($e=f($e);!Ct.done;it++,Ct=pe.next())Ct=we($e,de,it,Ct.value,Te),Ct!==null&&(s&&Ct.alternate!==null&&$e.delete(Ct.key===null?it:Ct.key),le=w(Ct,le,it),St===null?Ge=Ct:St.sibling=Ct,St=Ct);return s&&$e.forEach(function(P2){return a(de,P2)}),yt&&Zs(de,it),Ge}function Pt(de,le,pe,Te){if(typeof pe=="object"&&pe!==null&&pe.type===x&&pe.key===null&&(pe=pe.props.children),typeof pe=="object"&&pe!==null){switch(pe.$$typeof){case _:e:{for(var Ge=pe.key;le!==null;){if(le.key===Ge){if(Ge=pe.type,Ge===x){if(le.tag===7){c(de,le.sibling),Te=b(le,pe.props.children),Te.return=de,de=Te;break e}}else if(le.elementType===Ge||typeof Ge=="object"&&Ge!==null&&Ge.$$typeof===A&&oo(Ge)===le.type){c(de,le.sibling),Te=b(le,pe.props),Vc(Te,pe),Te.return=de,de=Te;break e}c(de,le);break}else a(de,le);le=le.sibling}pe.type===x?(Te=no(pe.props.children,de.mode,Te,pe.key),Te.return=de,de=Te):(Te=Nd(pe.type,pe.key,pe.props,null,de.mode,Te),Vc(Te,pe),Te.return=de,de=Te)}return z(de);case C:e:{for(Ge=pe.key;le!==null;){if(le.key===Ge)if(le.tag===4&&le.stateNode.containerInfo===pe.containerInfo&&le.stateNode.implementation===pe.implementation){c(de,le.sibling),Te=b(le,pe.children||[]),Te.return=de,de=Te;break e}else{c(de,le);break}else a(de,le);le=le.sibling}Te=zm(pe,de.mode,Te),Te.return=de,de=Te}return z(de);case A:return pe=oo(pe),Pt(de,le,pe,Te)}if(X(pe))return Fe(de,le,pe,Te);if(j(pe)){if(Ge=j(pe),typeof Ge!="function")throw Error(r(150));return pe=Ge.call(pe),We(de,le,pe,Te)}if(typeof pe.then=="function")return Pt(de,le,Vd(pe),Te);if(pe.$$typeof===I)return Pt(de,le,Bd(de,pe),Te);$d(de,pe)}return typeof pe=="string"&&pe!==""||typeof pe=="number"||typeof pe=="bigint"?(pe=""+pe,le!==null&&le.tag===6?(c(de,le.sibling),Te=b(le,pe),Te.return=de,de=Te):(c(de,le),Te=Pm(pe,de.mode,Te),Te.return=de,de=Te),z(de)):c(de,le)}return function(de,le,pe,Te){try{Fc=0;var Ge=Pt(de,le,pe,Te);return ul=null,Ge}catch($e){if($e===cl||$e===Ud)throw $e;var St=xr(29,$e,null,de.mode);return St.lanes=Te,St.return=de,St}}}var co=z_(!0),B_=z_(!1),Fi=!1;function Km(s){s.updateQueue={baseState:s.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Ym(s,a){s=s.updateQueue,a.updateQueue===s&&(a.updateQueue={baseState:s.baseState,firstBaseUpdate:s.firstBaseUpdate,lastBaseUpdate:s.lastBaseUpdate,shared:s.shared,callbacks:null})}function Vi(s){return{lane:s,tag:0,payload:null,callback:null,next:null}}function $i(s,a,c){var f=s.updateQueue;if(f===null)return null;if(f=f.shared,(At&2)!==0){var b=f.pending;return b===null?a.next=a:(a.next=b.next,b.next=a),f.pending=a,a=Md(s),x_(s,null,c),a}return Od(s,f,a,c),Md(s)}function $c(s,a,c){if(a=a.updateQueue,a!==null&&(a=a.shared,(c&4194048)!==0)){var f=a.lanes;f&=s.pendingLanes,c|=f,a.lanes=c,gc(s,c)}}function Xm(s,a){var c=s.updateQueue,f=s.alternate;if(f!==null&&(f=f.updateQueue,c===f)){var b=null,w=null;if(c=c.firstBaseUpdate,c!==null){do{var z={lane:c.lane,tag:c.tag,payload:c.payload,callback:null,next:null};w===null?b=w=z:w=w.next=z,c=c.next}while(c!==null);w===null?b=w=a:w=w.next=a}else b=w=a;c={baseState:f.baseState,firstBaseUpdate:b,lastBaseUpdate:w,shared:f.shared,callbacks:f.callbacks},s.updateQueue=c;return}s=c.lastBaseUpdate,s===null?c.firstBaseUpdate=a:s.next=a,c.lastBaseUpdate=a}var Zm=!1;function qc(){if(Zm){var s=ll;if(s!==null)throw s}}function Hc(s,a,c,f){Zm=!1;var b=s.updateQueue;Fi=!1;var w=b.firstBaseUpdate,z=b.lastBaseUpdate,Q=b.shared.pending;if(Q!==null){b.shared.pending=null;var re=Q,ge=re.next;re.next=null,z===null?w=ge:z.next=ge,z=re;var Ee=s.alternate;Ee!==null&&(Ee=Ee.updateQueue,Q=Ee.lastBaseUpdate,Q!==z&&(Q===null?Ee.firstBaseUpdate=ge:Q.next=ge,Ee.lastBaseUpdate=re))}if(w!==null){var Re=b.baseState;z=0,Ee=ge=re=null,Q=w;do{var _e=Q.lane&-536870913,we=_e!==Q.lane;if(we?(ht&_e)===_e:(f&_e)===_e){_e!==0&&_e===ol&&(Zm=!0),Ee!==null&&(Ee=Ee.next={lane:0,tag:Q.tag,payload:Q.payload,callback:null,next:null});e:{var Fe=s,We=Q;_e=a;var Pt=c;switch(We.tag){case 1:if(Fe=We.payload,typeof Fe=="function"){Re=Fe.call(Pt,Re,_e);break e}Re=Fe;break e;case 3:Fe.flags=Fe.flags&-65537|128;case 0:if(Fe=We.payload,_e=typeof Fe=="function"?Fe.call(Pt,Re,_e):Fe,_e==null)break e;Re=g({},Re,_e);break e;case 2:Fi=!0}}_e=Q.callback,_e!==null&&(s.flags|=64,we&&(s.flags|=8192),we=b.callbacks,we===null?b.callbacks=[_e]:we.push(_e))}else we={lane:_e,tag:Q.tag,payload:Q.payload,callback:Q.callback,next:null},Ee===null?(ge=Ee=we,re=Re):Ee=Ee.next=we,z|=_e;if(Q=Q.next,Q===null){if(Q=b.shared.pending,Q===null)break;we=Q,Q=we.next,we.next=null,b.lastBaseUpdate=we,b.shared.pending=null}}while(!0);Ee===null&&(re=Re),b.baseState=re,b.firstBaseUpdate=ge,b.lastBaseUpdate=Ee,w===null&&(b.shared.lanes=0),Wi|=z,s.lanes=z,s.memoizedState=Re}}function L_(s,a){if(typeof s!="function")throw Error(r(191,s));s.call(a)}function U_(s,a){var c=s.callbacks;if(c!==null)for(s.callbacks=null,s=0;s<c.length;s++)L_(c[s],a)}var dl=B(null),qd=B(0);function F_(s,a){s=ci,ne(qd,s),ne(dl,a),ci=s|a.baseLanes}function Jm(){ne(qd,ci),ne(dl,dl.current)}function ep(){ci=qd.current,G(dl),G(qd)}var wr=B(null),Ur=null;function qi(s){var a=s.alternate;ne(sn,sn.current&1),ne(wr,s),Ur===null&&(a===null||dl.current!==null||a.memoizedState!==null)&&(Ur=s)}function tp(s){ne(sn,sn.current),ne(wr,s),Ur===null&&(Ur=s)}function V_(s){s.tag===22?(ne(sn,sn.current),ne(wr,s),Ur===null&&(Ur=s)):Hi()}function Hi(){ne(sn,sn.current),ne(wr,wr.current)}function Sr(s){G(wr),Ur===s&&(Ur=null),G(sn)}var sn=B(0);function Hd(s){for(var a=s;a!==null;){if(a.tag===13){var c=a.memoizedState;if(c!==null&&(c=c.dehydrated,c===null||og(c)||lg(c)))return a}else if(a.tag===19&&(a.memoizedProps.revealOrder==="forwards"||a.memoizedProps.revealOrder==="backwards"||a.memoizedProps.revealOrder==="unstable_legacy-backwards"||a.memoizedProps.revealOrder==="together")){if((a.flags&128)!==0)return a}else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===s)break;for(;a.sibling===null;){if(a.return===null||a.return===s)return null;a=a.return}a.sibling.return=a.return,a=a.sibling}return null}var ti=0,st=null,Mt=null,pn=null,Gd=!1,hl=!1,uo=!1,Qd=0,Gc=0,fl=null,TA=0;function tn(){throw Error(r(321))}function np(s,a){if(a===null)return!1;for(var c=0;c<a.length&&c<s.length;c++)if(!vr(s[c],a[c]))return!1;return!0}function rp(s,a,c,f,b,w){return ti=w,st=a,a.memoizedState=null,a.updateQueue=null,a.lanes=0,W.H=s===null||s.memoizedState===null?Eb:_p,uo=!1,w=c(f,b),uo=!1,hl&&(w=q_(a,c,f,b)),$_(s),w}function $_(s){W.H=Kc;var a=Mt!==null&&Mt.next!==null;if(ti=0,pn=Mt=st=null,Gd=!1,Gc=0,fl=null,a)throw Error(r(300));s===null||gn||(s=s.dependencies,s!==null&&zd(s)&&(gn=!0))}function q_(s,a,c,f){st=s;var b=0;do{if(hl&&(fl=null),Gc=0,hl=!1,25<=b)throw Error(r(301));if(b+=1,pn=Mt=null,s.updateQueue!=null){var w=s.updateQueue;w.lastEffect=null,w.events=null,w.stores=null,w.memoCache!=null&&(w.memoCache.index=0)}W.H=Tb,w=a(c,f)}while(hl);return w}function AA(){var s=W.H,a=s.useState()[0];return a=typeof a.then=="function"?Qc(a):a,s=s.useState()[0],(Mt!==null?Mt.memoizedState:null)!==s&&(st.flags|=1024),a}function sp(){var s=Qd!==0;return Qd=0,s}function ip(s,a,c){a.updateQueue=s.updateQueue,a.flags&=-2053,s.lanes&=~c}function ap(s){if(Gd){for(s=s.memoizedState;s!==null;){var a=s.queue;a!==null&&(a.pending=null),s=s.next}Gd=!1}ti=0,pn=Mt=st=null,hl=!1,Gc=Qd=0,fl=null}function rr(){var s={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return pn===null?st.memoizedState=pn=s:pn=pn.next=s,pn}function an(){if(Mt===null){var s=st.alternate;s=s!==null?s.memoizedState:null}else s=Mt.next;var a=pn===null?st.memoizedState:pn.next;if(a!==null)pn=a,Mt=s;else{if(s===null)throw st.alternate===null?Error(r(467)):Error(r(310));Mt=s,s={memoizedState:Mt.memoizedState,baseState:Mt.baseState,baseQueue:Mt.baseQueue,queue:Mt.queue,next:null},pn===null?st.memoizedState=pn=s:pn=pn.next=s}return pn}function Wd(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Qc(s){var a=Gc;return Gc+=1,fl===null&&(fl=[]),s=M_(fl,s,a),a=st,(pn===null?a.memoizedState:pn.next)===null&&(a=a.alternate,W.H=a===null||a.memoizedState===null?Eb:_p),s}function Kd(s){if(s!==null&&typeof s=="object"){if(typeof s.then=="function")return Qc(s);if(s.$$typeof===I)return zn(s)}throw Error(r(438,String(s)))}function op(s){var a=null,c=st.updateQueue;if(c!==null&&(a=c.memoCache),a==null){var f=st.alternate;f!==null&&(f=f.updateQueue,f!==null&&(f=f.memoCache,f!=null&&(a={data:f.data.map(function(b){return b.slice()}),index:0})))}if(a==null&&(a={data:[],index:0}),c===null&&(c=Wd(),st.updateQueue=c),c.memoCache=a,c=a.data[a.index],c===void 0)for(c=a.data[a.index]=Array(s),f=0;f<s;f++)c[f]=F;return a.index++,c}function ni(s,a){return typeof a=="function"?a(s):a}function Yd(s){var a=an();return lp(a,Mt,s)}function lp(s,a,c){var f=s.queue;if(f===null)throw Error(r(311));f.lastRenderedReducer=c;var b=s.baseQueue,w=f.pending;if(w!==null){if(b!==null){var z=b.next;b.next=w.next,w.next=z}a.baseQueue=b=w,f.pending=null}if(w=s.baseState,b===null)s.memoizedState=w;else{a=b.next;var Q=z=null,re=null,ge=a,Ee=!1;do{var Re=ge.lane&-536870913;if(Re!==ge.lane?(ht&Re)===Re:(ti&Re)===Re){var _e=ge.revertLane;if(_e===0)re!==null&&(re=re.next={lane:0,revertLane:0,gesture:null,action:ge.action,hasEagerState:ge.hasEagerState,eagerState:ge.eagerState,next:null}),Re===ol&&(Ee=!0);else if((ti&_e)===_e){ge=ge.next,_e===ol&&(Ee=!0);continue}else Re={lane:0,revertLane:ge.revertLane,gesture:null,action:ge.action,hasEagerState:ge.hasEagerState,eagerState:ge.eagerState,next:null},re===null?(Q=re=Re,z=w):re=re.next=Re,st.lanes|=_e,Wi|=_e;Re=ge.action,uo&&c(w,Re),w=ge.hasEagerState?ge.eagerState:c(w,Re)}else _e={lane:Re,revertLane:ge.revertLane,gesture:ge.gesture,action:ge.action,hasEagerState:ge.hasEagerState,eagerState:ge.eagerState,next:null},re===null?(Q=re=_e,z=w):re=re.next=_e,st.lanes|=Re,Wi|=Re;ge=ge.next}while(ge!==null&&ge!==a);if(re===null?z=w:re.next=Q,!vr(w,s.memoizedState)&&(gn=!0,Ee&&(c=ll,c!==null)))throw c;s.memoizedState=w,s.baseState=z,s.baseQueue=re,f.lastRenderedState=w}return b===null&&(f.lanes=0),[s.memoizedState,f.dispatch]}function cp(s){var a=an(),c=a.queue;if(c===null)throw Error(r(311));c.lastRenderedReducer=s;var f=c.dispatch,b=c.pending,w=a.memoizedState;if(b!==null){c.pending=null;var z=b=b.next;do w=s(w,z.action),z=z.next;while(z!==b);vr(w,a.memoizedState)||(gn=!0),a.memoizedState=w,a.baseQueue===null&&(a.baseState=w),c.lastRenderedState=w}return[w,f]}function H_(s,a,c){var f=st,b=an(),w=yt;if(w){if(c===void 0)throw Error(r(407));c=c()}else c=a();var z=!vr((Mt||b).memoizedState,c);if(z&&(b.memoizedState=c,gn=!0),b=b.queue,hp(W_.bind(null,f,b,s),[s]),b.getSnapshot!==a||z||pn!==null&&pn.memoizedState.tag&1){if(f.flags|=2048,ml(9,{destroy:void 0},Q_.bind(null,f,b,c,a),null),Lt===null)throw Error(r(349));w||(ti&127)!==0||G_(f,a,c)}return c}function G_(s,a,c){s.flags|=16384,s={getSnapshot:a,value:c},a=st.updateQueue,a===null?(a=Wd(),st.updateQueue=a,a.stores=[s]):(c=a.stores,c===null?a.stores=[s]:c.push(s))}function Q_(s,a,c,f){a.value=c,a.getSnapshot=f,K_(a)&&Y_(s)}function W_(s,a,c){return c(function(){K_(a)&&Y_(s)})}function K_(s){var a=s.getSnapshot;s=s.value;try{var c=a();return!vr(s,c)}catch{return!0}}function Y_(s){var a=to(s,2);a!==null&&dr(a,s,2)}function up(s){var a=rr();if(typeof s=="function"){var c=s;if(s=c(),uo){Wn(!0);try{c()}finally{Wn(!1)}}}return a.memoizedState=a.baseState=s,a.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ni,lastRenderedState:s},a}function X_(s,a,c,f){return s.baseState=c,lp(s,Mt,typeof f=="function"?f:ni)}function jA(s,a,c,f,b){if(Jd(s))throw Error(r(485));if(s=a.action,s!==null){var w={payload:b,action:s,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(z){w.listeners.push(z)}};W.T!==null?c(!0):w.isTransition=!1,f(w),c=a.pending,c===null?(w.next=a.pending=w,Z_(a,w)):(w.next=c.next,a.pending=c.next=w)}}function Z_(s,a){var c=a.action,f=a.payload,b=s.state;if(a.isTransition){var w=W.T,z={};W.T=z;try{var Q=c(b,f),re=W.S;re!==null&&re(z,Q),J_(s,a,Q)}catch(ge){dp(s,a,ge)}finally{w!==null&&z.types!==null&&(w.types=z.types),W.T=w}}else try{w=c(b,f),J_(s,a,w)}catch(ge){dp(s,a,ge)}}function J_(s,a,c){c!==null&&typeof c=="object"&&typeof c.then=="function"?c.then(function(f){eb(s,a,f)},function(f){return dp(s,a,f)}):eb(s,a,c)}function eb(s,a,c){a.status="fulfilled",a.value=c,tb(a),s.state=c,a=s.pending,a!==null&&(c=a.next,c===a?s.pending=null:(c=c.next,a.next=c,Z_(s,c)))}function dp(s,a,c){var f=s.pending;if(s.pending=null,f!==null){f=f.next;do a.status="rejected",a.reason=c,tb(a),a=a.next;while(a!==f)}s.action=null}function tb(s){s=s.listeners;for(var a=0;a<s.length;a++)(0,s[a])()}function nb(s,a){return a}function rb(s,a){if(yt){var c=Lt.formState;if(c!==null){e:{var f=st;if(yt){if($t){t:{for(var b=$t,w=Lr;b.nodeType!==8;){if(!w){b=null;break t}if(b=Fr(b.nextSibling),b===null){b=null;break t}}w=b.data,b=w==="F!"||w==="F"?b:null}if(b){$t=Fr(b.nextSibling),f=b.data==="F!";break e}}Li(f)}f=!1}f&&(a=c[0])}}return c=rr(),c.memoizedState=c.baseState=a,f={pending:null,lanes:0,dispatch:null,lastRenderedReducer:nb,lastRenderedState:a},c.queue=f,c=wb.bind(null,st,f),f.dispatch=c,f=up(!1),w=yp.bind(null,st,!1,f.queue),f=rr(),b={state:a,dispatch:null,action:s,pending:null},f.queue=b,c=jA.bind(null,st,b,w,c),b.dispatch=c,f.memoizedState=s,[a,c,!1]}function sb(s){var a=an();return ib(a,Mt,s)}function ib(s,a,c){if(a=lp(s,a,nb)[0],s=Yd(ni)[0],typeof a=="object"&&a!==null&&typeof a.then=="function")try{var f=Qc(a)}catch(z){throw z===cl?Ud:z}else f=a;a=an();var b=a.queue,w=b.dispatch;return c!==a.memoizedState&&(st.flags|=2048,ml(9,{destroy:void 0},RA.bind(null,b,c),null)),[f,w,s]}function RA(s,a){s.action=a}function ab(s){var a=an(),c=Mt;if(c!==null)return ib(a,c,s);an(),a=a.memoizedState,c=an();var f=c.queue.dispatch;return c.memoizedState=s,[a,f,!1]}function ml(s,a,c,f){return s={tag:s,create:c,deps:f,inst:a,next:null},a=st.updateQueue,a===null&&(a=Wd(),st.updateQueue=a),c=a.lastEffect,c===null?a.lastEffect=s.next=s:(f=c.next,c.next=s,s.next=f,a.lastEffect=s),s}function ob(){return an().memoizedState}function Xd(s,a,c,f){var b=rr();st.flags|=s,b.memoizedState=ml(1|a,{destroy:void 0},c,f===void 0?null:f)}function Zd(s,a,c,f){var b=an();f=f===void 0?null:f;var w=b.memoizedState.inst;Mt!==null&&f!==null&&np(f,Mt.memoizedState.deps)?b.memoizedState=ml(a,w,c,f):(st.flags|=s,b.memoizedState=ml(1|a,w,c,f))}function lb(s,a){Xd(8390656,8,s,a)}function hp(s,a){Zd(2048,8,s,a)}function IA(s){st.flags|=4;var a=st.updateQueue;if(a===null)a=Wd(),st.updateQueue=a,a.events=[s];else{var c=a.events;c===null?a.events=[s]:c.push(s)}}function cb(s){var a=an().memoizedState;return IA({ref:a,nextImpl:s}),function(){if((At&2)!==0)throw Error(r(440));return a.impl.apply(void 0,arguments)}}function ub(s,a){return Zd(4,2,s,a)}function db(s,a){return Zd(4,4,s,a)}function hb(s,a){if(typeof a=="function"){s=s();var c=a(s);return function(){typeof c=="function"?c():a(null)}}if(a!=null)return s=s(),a.current=s,function(){a.current=null}}function fb(s,a,c){c=c!=null?c.concat([s]):null,Zd(4,4,hb.bind(null,a,s),c)}function fp(){}function mb(s,a){var c=an();a=a===void 0?null:a;var f=c.memoizedState;return a!==null&&np(a,f[1])?f[0]:(c.memoizedState=[s,a],s)}function pb(s,a){var c=an();a=a===void 0?null:a;var f=c.memoizedState;if(a!==null&&np(a,f[1]))return f[0];if(f=s(),uo){Wn(!0);try{s()}finally{Wn(!1)}}return c.memoizedState=[f,a],f}function mp(s,a,c){return c===void 0||(ti&1073741824)!==0&&(ht&261930)===0?s.memoizedState=a:(s.memoizedState=c,s=gv(),st.lanes|=s,Wi|=s,c)}function gb(s,a,c,f){return vr(c,a)?c:dl.current!==null?(s=mp(s,c,f),vr(s,a)||(gn=!0),s):(ti&42)===0||(ti&1073741824)!==0&&(ht&261930)===0?(gn=!0,s.memoizedState=c):(s=gv(),st.lanes|=s,Wi|=s,a)}function yb(s,a,c,f,b){var w=H.p;H.p=w!==0&&8>w?w:8;var z=W.T,Q={};W.T=Q,yp(s,!1,a,c);try{var re=b(),ge=W.S;if(ge!==null&&ge(Q,re),re!==null&&typeof re=="object"&&typeof re.then=="function"){var Ee=EA(re,f);Wc(s,a,Ee,Tr(s))}else Wc(s,a,f,Tr(s))}catch(Re){Wc(s,a,{then:function(){},status:"rejected",reason:Re},Tr())}finally{H.p=w,z!==null&&Q.types!==null&&(z.types=Q.types),W.T=z}}function kA(){}function pp(s,a,c,f){if(s.tag!==5)throw Error(r(476));var b=_b(s).queue;yb(s,b,a,Z,c===null?kA:function(){return bb(s),c(f)})}function _b(s){var a=s.memoizedState;if(a!==null)return a;a={memoizedState:Z,baseState:Z,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ni,lastRenderedState:Z},next:null};var c={};return a.next={memoizedState:c,baseState:c,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ni,lastRenderedState:c},next:null},s.memoizedState=a,s=s.alternate,s!==null&&(s.memoizedState=a),a}function bb(s){var a=_b(s);a.next===null&&(a=s.alternate.memoizedState),Wc(s,a.next.queue,{},Tr())}function gp(){return zn(du)}function vb(){return an().memoizedState}function xb(){return an().memoizedState}function DA(s){for(var a=s.return;a!==null;){switch(a.tag){case 24:case 3:var c=Tr();s=Vi(c);var f=$i(a,s,c);f!==null&&(dr(f,a,c),$c(f,a,c)),a={cache:Hm()},s.payload=a;return}a=a.return}}function OA(s,a,c){var f=Tr();c={lane:f,revertLane:0,gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null},Jd(s)?Sb(a,c):(c=Mm(s,a,c,f),c!==null&&(dr(c,s,f),Cb(c,a,f)))}function wb(s,a,c){var f=Tr();Wc(s,a,c,f)}function Wc(s,a,c,f){var b={lane:f,revertLane:0,gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null};if(Jd(s))Sb(a,b);else{var w=s.alternate;if(s.lanes===0&&(w===null||w.lanes===0)&&(w=a.lastRenderedReducer,w!==null))try{var z=a.lastRenderedState,Q=w(z,c);if(b.hasEagerState=!0,b.eagerState=Q,vr(Q,z))return Od(s,a,b,0),Lt===null&&Dd(),!1}catch{}if(c=Mm(s,a,b,f),c!==null)return dr(c,s,f),Cb(c,a,f),!0}return!1}function yp(s,a,c,f){if(f={lane:2,revertLane:Kp(),gesture:null,action:f,hasEagerState:!1,eagerState:null,next:null},Jd(s)){if(a)throw Error(r(479))}else a=Mm(s,c,f,2),a!==null&&dr(a,s,2)}function Jd(s){var a=s.alternate;return s===st||a!==null&&a===st}function Sb(s,a){hl=Gd=!0;var c=s.pending;c===null?a.next=a:(a.next=c.next,c.next=a),s.pending=a}function Cb(s,a,c){if((c&4194048)!==0){var f=a.lanes;f&=s.pendingLanes,c|=f,a.lanes=c,gc(s,c)}}var Kc={readContext:zn,use:Kd,useCallback:tn,useContext:tn,useEffect:tn,useImperativeHandle:tn,useLayoutEffect:tn,useInsertionEffect:tn,useMemo:tn,useReducer:tn,useRef:tn,useState:tn,useDebugValue:tn,useDeferredValue:tn,useTransition:tn,useSyncExternalStore:tn,useId:tn,useHostTransitionStatus:tn,useFormState:tn,useActionState:tn,useOptimistic:tn,useMemoCache:tn,useCacheRefresh:tn};Kc.useEffectEvent=tn;var Eb={readContext:zn,use:Kd,useCallback:function(s,a){return rr().memoizedState=[s,a===void 0?null:a],s},useContext:zn,useEffect:lb,useImperativeHandle:function(s,a,c){c=c!=null?c.concat([s]):null,Xd(4194308,4,hb.bind(null,a,s),c)},useLayoutEffect:function(s,a){return Xd(4194308,4,s,a)},useInsertionEffect:function(s,a){Xd(4,2,s,a)},useMemo:function(s,a){var c=rr();a=a===void 0?null:a;var f=s();if(uo){Wn(!0);try{s()}finally{Wn(!1)}}return c.memoizedState=[f,a],f},useReducer:function(s,a,c){var f=rr();if(c!==void 0){var b=c(a);if(uo){Wn(!0);try{c(a)}finally{Wn(!1)}}}else b=a;return f.memoizedState=f.baseState=b,s={pending:null,lanes:0,dispatch:null,lastRenderedReducer:s,lastRenderedState:b},f.queue=s,s=s.dispatch=OA.bind(null,st,s),[f.memoizedState,s]},useRef:function(s){var a=rr();return s={current:s},a.memoizedState=s},useState:function(s){s=up(s);var a=s.queue,c=wb.bind(null,st,a);return a.dispatch=c,[s.memoizedState,c]},useDebugValue:fp,useDeferredValue:function(s,a){var c=rr();return mp(c,s,a)},useTransition:function(){var s=up(!1);return s=yb.bind(null,st,s.queue,!0,!1),rr().memoizedState=s,[!1,s]},useSyncExternalStore:function(s,a,c){var f=st,b=rr();if(yt){if(c===void 0)throw Error(r(407));c=c()}else{if(c=a(),Lt===null)throw Error(r(349));(ht&127)!==0||G_(f,a,c)}b.memoizedState=c;var w={value:c,getSnapshot:a};return b.queue=w,lb(W_.bind(null,f,w,s),[s]),f.flags|=2048,ml(9,{destroy:void 0},Q_.bind(null,f,w,c,a),null),c},useId:function(){var s=rr(),a=Lt.identifierPrefix;if(yt){var c=Os,f=Ds;c=(f&~(1<<32-Et(f)-1)).toString(32)+c,a="_"+a+"R_"+c,c=Qd++,0<c&&(a+="H"+c.toString(32)),a+="_"}else c=TA++,a="_"+a+"r_"+c.toString(32)+"_";return s.memoizedState=a},useHostTransitionStatus:gp,useFormState:rb,useActionState:rb,useOptimistic:function(s){var a=rr();a.memoizedState=a.baseState=s;var c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return a.queue=c,a=yp.bind(null,st,!0,c),c.dispatch=a,[s,a]},useMemoCache:op,useCacheRefresh:function(){return rr().memoizedState=DA.bind(null,st)},useEffectEvent:function(s){var a=rr(),c={impl:s};return a.memoizedState=c,function(){if((At&2)!==0)throw Error(r(440));return c.impl.apply(void 0,arguments)}}},_p={readContext:zn,use:Kd,useCallback:mb,useContext:zn,useEffect:hp,useImperativeHandle:fb,useInsertionEffect:ub,useLayoutEffect:db,useMemo:pb,useReducer:Yd,useRef:ob,useState:function(){return Yd(ni)},useDebugValue:fp,useDeferredValue:function(s,a){var c=an();return gb(c,Mt.memoizedState,s,a)},useTransition:function(){var s=Yd(ni)[0],a=an().memoizedState;return[typeof s=="boolean"?s:Qc(s),a]},useSyncExternalStore:H_,useId:vb,useHostTransitionStatus:gp,useFormState:sb,useActionState:sb,useOptimistic:function(s,a){var c=an();return X_(c,Mt,s,a)},useMemoCache:op,useCacheRefresh:xb};_p.useEffectEvent=cb;var Tb={readContext:zn,use:Kd,useCallback:mb,useContext:zn,useEffect:hp,useImperativeHandle:fb,useInsertionEffect:ub,useLayoutEffect:db,useMemo:pb,useReducer:cp,useRef:ob,useState:function(){return cp(ni)},useDebugValue:fp,useDeferredValue:function(s,a){var c=an();return Mt===null?mp(c,s,a):gb(c,Mt.memoizedState,s,a)},useTransition:function(){var s=cp(ni)[0],a=an().memoizedState;return[typeof s=="boolean"?s:Qc(s),a]},useSyncExternalStore:H_,useId:vb,useHostTransitionStatus:gp,useFormState:ab,useActionState:ab,useOptimistic:function(s,a){var c=an();return Mt!==null?X_(c,Mt,s,a):(c.baseState=s,[s,c.queue.dispatch])},useMemoCache:op,useCacheRefresh:xb};Tb.useEffectEvent=cb;function bp(s,a,c,f){a=s.memoizedState,c=c(f,a),c=c==null?a:g({},a,c),s.memoizedState=c,s.lanes===0&&(s.updateQueue.baseState=c)}var vp={enqueueSetState:function(s,a,c){s=s._reactInternals;var f=Tr(),b=Vi(f);b.payload=a,c!=null&&(b.callback=c),a=$i(s,b,f),a!==null&&(dr(a,s,f),$c(a,s,f))},enqueueReplaceState:function(s,a,c){s=s._reactInternals;var f=Tr(),b=Vi(f);b.tag=1,b.payload=a,c!=null&&(b.callback=c),a=$i(s,b,f),a!==null&&(dr(a,s,f),$c(a,s,f))},enqueueForceUpdate:function(s,a){s=s._reactInternals;var c=Tr(),f=Vi(c);f.tag=2,a!=null&&(f.callback=a),a=$i(s,f,c),a!==null&&(dr(a,s,c),$c(a,s,c))}};function Ab(s,a,c,f,b,w,z){return s=s.stateNode,typeof s.shouldComponentUpdate=="function"?s.shouldComponentUpdate(f,w,z):a.prototype&&a.prototype.isPureReactComponent?!Nc(c,f)||!Nc(b,w):!0}function jb(s,a,c,f){s=a.state,typeof a.componentWillReceiveProps=="function"&&a.componentWillReceiveProps(c,f),typeof a.UNSAFE_componentWillReceiveProps=="function"&&a.UNSAFE_componentWillReceiveProps(c,f),a.state!==s&&vp.enqueueReplaceState(a,a.state,null)}function ho(s,a){var c=a;if("ref"in a){c={};for(var f in a)f!=="ref"&&(c[f]=a[f])}if(s=s.defaultProps){c===a&&(c=g({},c));for(var b in s)c[b]===void 0&&(c[b]=s[b])}return c}function Rb(s){kd(s)}function Ib(s){console.error(s)}function kb(s){kd(s)}function eh(s,a){try{var c=s.onUncaughtError;c(a.value,{componentStack:a.stack})}catch(f){setTimeout(function(){throw f})}}function Db(s,a,c){try{var f=s.onCaughtError;f(c.value,{componentStack:c.stack,errorBoundary:a.tag===1?a.stateNode:null})}catch(b){setTimeout(function(){throw b})}}function xp(s,a,c){return c=Vi(c),c.tag=3,c.payload={element:null},c.callback=function(){eh(s,a)},c}function Ob(s){return s=Vi(s),s.tag=3,s}function Mb(s,a,c,f){var b=c.type.getDerivedStateFromError;if(typeof b=="function"){var w=f.value;s.payload=function(){return b(w)},s.callback=function(){Db(a,c,f)}}var z=c.stateNode;z!==null&&typeof z.componentDidCatch=="function"&&(s.callback=function(){Db(a,c,f),typeof b!="function"&&(Ki===null?Ki=new Set([this]):Ki.add(this));var Q=f.stack;this.componentDidCatch(f.value,{componentStack:Q!==null?Q:""})})}function MA(s,a,c,f,b){if(c.flags|=32768,f!==null&&typeof f=="object"&&typeof f.then=="function"){if(a=c.alternate,a!==null&&al(a,c,b,!0),c=wr.current,c!==null){switch(c.tag){case 31:case 13:return Ur===null?hh():c.alternate===null&&nn===0&&(nn=3),c.flags&=-257,c.flags|=65536,c.lanes=b,f===Fd?c.flags|=16384:(a=c.updateQueue,a===null?c.updateQueue=new Set([f]):a.add(f),Gp(s,f,b)),!1;case 22:return c.flags|=65536,f===Fd?c.flags|=16384:(a=c.updateQueue,a===null?(a={transitions:null,markerInstances:null,retryQueue:new Set([f])},c.updateQueue=a):(c=a.retryQueue,c===null?a.retryQueue=new Set([f]):c.add(f)),Gp(s,f,b)),!1}throw Error(r(435,c.tag))}return Gp(s,f,b),hh(),!1}if(yt)return a=wr.current,a!==null?((a.flags&65536)===0&&(a.flags|=256),a.flags|=65536,a.lanes=b,f!==Um&&(s=Error(r(422),{cause:f}),Bc(Pr(s,c)))):(f!==Um&&(a=Error(r(423),{cause:f}),Bc(Pr(a,c))),s=s.current.alternate,s.flags|=65536,b&=-b,s.lanes|=b,f=Pr(f,c),b=xp(s.stateNode,f,b),Xm(s,b),nn!==4&&(nn=2)),!1;var w=Error(r(520),{cause:f});if(w=Pr(w,c),ru===null?ru=[w]:ru.push(w),nn!==4&&(nn=2),a===null)return!0;f=Pr(f,c),c=a;do{switch(c.tag){case 3:return c.flags|=65536,s=b&-b,c.lanes|=s,s=xp(c.stateNode,f,s),Xm(c,s),!1;case 1:if(a=c.type,w=c.stateNode,(c.flags&128)===0&&(typeof a.getDerivedStateFromError=="function"||w!==null&&typeof w.componentDidCatch=="function"&&(Ki===null||!Ki.has(w))))return c.flags|=65536,b&=-b,c.lanes|=b,b=Ob(b),Mb(b,s,c,f),Xm(c,b),!1}c=c.return}while(c!==null);return!1}var wp=Error(r(461)),gn=!1;function Bn(s,a,c,f){a.child=s===null?B_(a,null,c,f):co(a,s.child,c,f)}function Nb(s,a,c,f,b){c=c.render;var w=a.ref;if("ref"in f){var z={};for(var Q in f)Q!=="ref"&&(z[Q]=f[Q])}else z=f;return io(a),f=rp(s,a,c,z,w,b),Q=sp(),s!==null&&!gn?(ip(s,a,b),ri(s,a,b)):(yt&&Q&&Bm(a),a.flags|=1,Bn(s,a,f,b),a.child)}function Pb(s,a,c,f,b){if(s===null){var w=c.type;return typeof w=="function"&&!Nm(w)&&w.defaultProps===void 0&&c.compare===null?(a.tag=15,a.type=w,zb(s,a,w,f,b)):(s=Nd(c.type,null,f,a,a.mode,b),s.ref=a.ref,s.return=a,a.child=s)}if(w=s.child,!Ip(s,b)){var z=w.memoizedProps;if(c=c.compare,c=c!==null?c:Nc,c(z,f)&&s.ref===a.ref)return ri(s,a,b)}return a.flags|=1,s=Xs(w,f),s.ref=a.ref,s.return=a,a.child=s}function zb(s,a,c,f,b){if(s!==null){var w=s.memoizedProps;if(Nc(w,f)&&s.ref===a.ref)if(gn=!1,a.pendingProps=f=w,Ip(s,b))(s.flags&131072)!==0&&(gn=!0);else return a.lanes=s.lanes,ri(s,a,b)}return Sp(s,a,c,f,b)}function Bb(s,a,c,f){var b=f.children,w=s!==null?s.memoizedState:null;if(s===null&&a.stateNode===null&&(a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),f.mode==="hidden"){if((a.flags&128)!==0){if(w=w!==null?w.baseLanes|c:c,s!==null){for(f=a.child=s.child,b=0;f!==null;)b=b|f.lanes|f.childLanes,f=f.sibling;f=b&~w}else f=0,a.child=null;return Lb(s,a,w,c,f)}if((c&536870912)!==0)a.memoizedState={baseLanes:0,cachePool:null},s!==null&&Ld(a,w!==null?w.cachePool:null),w!==null?F_(a,w):Jm(),V_(a);else return f=a.lanes=536870912,Lb(s,a,w!==null?w.baseLanes|c:c,c,f)}else w!==null?(Ld(a,w.cachePool),F_(a,w),Hi(),a.memoizedState=null):(s!==null&&Ld(a,null),Jm(),Hi());return Bn(s,a,b,c),a.child}function Yc(s,a){return s!==null&&s.tag===22||a.stateNode!==null||(a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),a.sibling}function Lb(s,a,c,f,b){var w=Qm();return w=w===null?null:{parent:mn._currentValue,pool:w},a.memoizedState={baseLanes:c,cachePool:w},s!==null&&Ld(a,null),Jm(),V_(a),s!==null&&al(s,a,f,!0),a.childLanes=b,null}function th(s,a){return a=rh({mode:a.mode,children:a.children},s.mode),a.ref=s.ref,s.child=a,a.return=s,a}function Ub(s,a,c){return co(a,s.child,null,c),s=th(a,a.pendingProps),s.flags|=2,Sr(a),a.memoizedState=null,s}function NA(s,a,c){var f=a.pendingProps,b=(a.flags&128)!==0;if(a.flags&=-129,s===null){if(yt){if(f.mode==="hidden")return s=th(a,f),a.lanes=536870912,Yc(null,s);if(tp(a),(s=$t)?(s=Zv(s,Lr),s=s!==null&&s.data==="&"?s:null,s!==null&&(a.memoizedState={dehydrated:s,treeContext:zi!==null?{id:Ds,overflow:Os}:null,retryLane:536870912,hydrationErrors:null},c=S_(s),c.return=a,a.child=c,Pn=a,$t=null)):s=null,s===null)throw Li(a);return a.lanes=536870912,null}return th(a,f)}var w=s.memoizedState;if(w!==null){var z=w.dehydrated;if(tp(a),b)if(a.flags&256)a.flags&=-257,a=Ub(s,a,c);else if(a.memoizedState!==null)a.child=s.child,a.flags|=128,a=null;else throw Error(r(558));else if(gn||al(s,a,c,!1),b=(c&s.childLanes)!==0,gn||b){if(f=Lt,f!==null&&(z=yc(f,c),z!==0&&z!==w.retryLane))throw w.retryLane=z,to(s,z),dr(f,s,z),wp;hh(),a=Ub(s,a,c)}else s=w.treeContext,$t=Fr(z.nextSibling),Pn=a,yt=!0,Bi=null,Lr=!1,s!==null&&T_(a,s),a=th(a,f),a.flags|=4096;return a}return s=Xs(s.child,{mode:f.mode,children:f.children}),s.ref=a.ref,a.child=s,s.return=a,s}function nh(s,a){var c=a.ref;if(c===null)s!==null&&s.ref!==null&&(a.flags|=4194816);else{if(typeof c!="function"&&typeof c!="object")throw Error(r(284));(s===null||s.ref!==c)&&(a.flags|=4194816)}}function Sp(s,a,c,f,b){return io(a),c=rp(s,a,c,f,void 0,b),f=sp(),s!==null&&!gn?(ip(s,a,b),ri(s,a,b)):(yt&&f&&Bm(a),a.flags|=1,Bn(s,a,c,b),a.child)}function Fb(s,a,c,f,b,w){return io(a),a.updateQueue=null,c=q_(a,f,c,b),$_(s),f=sp(),s!==null&&!gn?(ip(s,a,w),ri(s,a,w)):(yt&&f&&Bm(a),a.flags|=1,Bn(s,a,c,w),a.child)}function Vb(s,a,c,f,b){if(io(a),a.stateNode===null){var w=nl,z=c.contextType;typeof z=="object"&&z!==null&&(w=zn(z)),w=new c(f,w),a.memoizedState=w.state!==null&&w.state!==void 0?w.state:null,w.updater=vp,a.stateNode=w,w._reactInternals=a,w=a.stateNode,w.props=f,w.state=a.memoizedState,w.refs={},Km(a),z=c.contextType,w.context=typeof z=="object"&&z!==null?zn(z):nl,w.state=a.memoizedState,z=c.getDerivedStateFromProps,typeof z=="function"&&(bp(a,c,z,f),w.state=a.memoizedState),typeof c.getDerivedStateFromProps=="function"||typeof w.getSnapshotBeforeUpdate=="function"||typeof w.UNSAFE_componentWillMount!="function"&&typeof w.componentWillMount!="function"||(z=w.state,typeof w.componentWillMount=="function"&&w.componentWillMount(),typeof w.UNSAFE_componentWillMount=="function"&&w.UNSAFE_componentWillMount(),z!==w.state&&vp.enqueueReplaceState(w,w.state,null),Hc(a,f,w,b),qc(),w.state=a.memoizedState),typeof w.componentDidMount=="function"&&(a.flags|=4194308),f=!0}else if(s===null){w=a.stateNode;var Q=a.memoizedProps,re=ho(c,Q);w.props=re;var ge=w.context,Ee=c.contextType;z=nl,typeof Ee=="object"&&Ee!==null&&(z=zn(Ee));var Re=c.getDerivedStateFromProps;Ee=typeof Re=="function"||typeof w.getSnapshotBeforeUpdate=="function",Q=a.pendingProps!==Q,Ee||typeof w.UNSAFE_componentWillReceiveProps!="function"&&typeof w.componentWillReceiveProps!="function"||(Q||ge!==z)&&jb(a,w,f,z),Fi=!1;var _e=a.memoizedState;w.state=_e,Hc(a,f,w,b),qc(),ge=a.memoizedState,Q||_e!==ge||Fi?(typeof Re=="function"&&(bp(a,c,Re,f),ge=a.memoizedState),(re=Fi||Ab(a,c,re,f,_e,ge,z))?(Ee||typeof w.UNSAFE_componentWillMount!="function"&&typeof w.componentWillMount!="function"||(typeof w.componentWillMount=="function"&&w.componentWillMount(),typeof w.UNSAFE_componentWillMount=="function"&&w.UNSAFE_componentWillMount()),typeof w.componentDidMount=="function"&&(a.flags|=4194308)):(typeof w.componentDidMount=="function"&&(a.flags|=4194308),a.memoizedProps=f,a.memoizedState=ge),w.props=f,w.state=ge,w.context=z,f=re):(typeof w.componentDidMount=="function"&&(a.flags|=4194308),f=!1)}else{w=a.stateNode,Ym(s,a),z=a.memoizedProps,Ee=ho(c,z),w.props=Ee,Re=a.pendingProps,_e=w.context,ge=c.contextType,re=nl,typeof ge=="object"&&ge!==null&&(re=zn(ge)),Q=c.getDerivedStateFromProps,(ge=typeof Q=="function"||typeof w.getSnapshotBeforeUpdate=="function")||typeof w.UNSAFE_componentWillReceiveProps!="function"&&typeof w.componentWillReceiveProps!="function"||(z!==Re||_e!==re)&&jb(a,w,f,re),Fi=!1,_e=a.memoizedState,w.state=_e,Hc(a,f,w,b),qc();var we=a.memoizedState;z!==Re||_e!==we||Fi||s!==null&&s.dependencies!==null&&zd(s.dependencies)?(typeof Q=="function"&&(bp(a,c,Q,f),we=a.memoizedState),(Ee=Fi||Ab(a,c,Ee,f,_e,we,re)||s!==null&&s.dependencies!==null&&zd(s.dependencies))?(ge||typeof w.UNSAFE_componentWillUpdate!="function"&&typeof w.componentWillUpdate!="function"||(typeof w.componentWillUpdate=="function"&&w.componentWillUpdate(f,we,re),typeof w.UNSAFE_componentWillUpdate=="function"&&w.UNSAFE_componentWillUpdate(f,we,re)),typeof w.componentDidUpdate=="function"&&(a.flags|=4),typeof w.getSnapshotBeforeUpdate=="function"&&(a.flags|=1024)):(typeof w.componentDidUpdate!="function"||z===s.memoizedProps&&_e===s.memoizedState||(a.flags|=4),typeof w.getSnapshotBeforeUpdate!="function"||z===s.memoizedProps&&_e===s.memoizedState||(a.flags|=1024),a.memoizedProps=f,a.memoizedState=we),w.props=f,w.state=we,w.context=re,f=Ee):(typeof w.componentDidUpdate!="function"||z===s.memoizedProps&&_e===s.memoizedState||(a.flags|=4),typeof w.getSnapshotBeforeUpdate!="function"||z===s.memoizedProps&&_e===s.memoizedState||(a.flags|=1024),f=!1)}return w=f,nh(s,a),f=(a.flags&128)!==0,w||f?(w=a.stateNode,c=f&&typeof c.getDerivedStateFromError!="function"?null:w.render(),a.flags|=1,s!==null&&f?(a.child=co(a,s.child,null,b),a.child=co(a,null,c,b)):Bn(s,a,c,b),a.memoizedState=w.state,s=a.child):s=ri(s,a,b),s}function $b(s,a,c,f){return ro(),a.flags|=256,Bn(s,a,c,f),a.child}var Cp={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Ep(s){return{baseLanes:s,cachePool:D_()}}function Tp(s,a,c){return s=s!==null?s.childLanes&~c:0,a&&(s|=Er),s}function qb(s,a,c){var f=a.pendingProps,b=!1,w=(a.flags&128)!==0,z;if((z=w)||(z=s!==null&&s.memoizedState===null?!1:(sn.current&2)!==0),z&&(b=!0,a.flags&=-129),z=(a.flags&32)!==0,a.flags&=-33,s===null){if(yt){if(b?qi(a):Hi(),(s=$t)?(s=Zv(s,Lr),s=s!==null&&s.data!=="&"?s:null,s!==null&&(a.memoizedState={dehydrated:s,treeContext:zi!==null?{id:Ds,overflow:Os}:null,retryLane:536870912,hydrationErrors:null},c=S_(s),c.return=a,a.child=c,Pn=a,$t=null)):s=null,s===null)throw Li(a);return lg(s)?a.lanes=32:a.lanes=536870912,null}var Q=f.children;return f=f.fallback,b?(Hi(),b=a.mode,Q=rh({mode:"hidden",children:Q},b),f=no(f,b,c,null),Q.return=a,f.return=a,Q.sibling=f,a.child=Q,f=a.child,f.memoizedState=Ep(c),f.childLanes=Tp(s,z,c),a.memoizedState=Cp,Yc(null,f)):(qi(a),Ap(a,Q))}var re=s.memoizedState;if(re!==null&&(Q=re.dehydrated,Q!==null)){if(w)a.flags&256?(qi(a),a.flags&=-257,a=jp(s,a,c)):a.memoizedState!==null?(Hi(),a.child=s.child,a.flags|=128,a=null):(Hi(),Q=f.fallback,b=a.mode,f=rh({mode:"visible",children:f.children},b),Q=no(Q,b,c,null),Q.flags|=2,f.return=a,Q.return=a,f.sibling=Q,a.child=f,co(a,s.child,null,c),f=a.child,f.memoizedState=Ep(c),f.childLanes=Tp(s,z,c),a.memoizedState=Cp,a=Yc(null,f));else if(qi(a),lg(Q)){if(z=Q.nextSibling&&Q.nextSibling.dataset,z)var ge=z.dgst;z=ge,f=Error(r(419)),f.stack="",f.digest=z,Bc({value:f,source:null,stack:null}),a=jp(s,a,c)}else if(gn||al(s,a,c,!1),z=(c&s.childLanes)!==0,gn||z){if(z=Lt,z!==null&&(f=yc(z,c),f!==0&&f!==re.retryLane))throw re.retryLane=f,to(s,f),dr(z,s,f),wp;og(Q)||hh(),a=jp(s,a,c)}else og(Q)?(a.flags|=192,a.child=s.child,a=null):(s=re.treeContext,$t=Fr(Q.nextSibling),Pn=a,yt=!0,Bi=null,Lr=!1,s!==null&&T_(a,s),a=Ap(a,f.children),a.flags|=4096);return a}return b?(Hi(),Q=f.fallback,b=a.mode,re=s.child,ge=re.sibling,f=Xs(re,{mode:"hidden",children:f.children}),f.subtreeFlags=re.subtreeFlags&65011712,ge!==null?Q=Xs(ge,Q):(Q=no(Q,b,c,null),Q.flags|=2),Q.return=a,f.return=a,f.sibling=Q,a.child=f,Yc(null,f),f=a.child,Q=s.child.memoizedState,Q===null?Q=Ep(c):(b=Q.cachePool,b!==null?(re=mn._currentValue,b=b.parent!==re?{parent:re,pool:re}:b):b=D_(),Q={baseLanes:Q.baseLanes|c,cachePool:b}),f.memoizedState=Q,f.childLanes=Tp(s,z,c),a.memoizedState=Cp,Yc(s.child,f)):(qi(a),c=s.child,s=c.sibling,c=Xs(c,{mode:"visible",children:f.children}),c.return=a,c.sibling=null,s!==null&&(z=a.deletions,z===null?(a.deletions=[s],a.flags|=16):z.push(s)),a.child=c,a.memoizedState=null,c)}function Ap(s,a){return a=rh({mode:"visible",children:a},s.mode),a.return=s,s.child=a}function rh(s,a){return s=xr(22,s,null,a),s.lanes=0,s}function jp(s,a,c){return co(a,s.child,null,c),s=Ap(a,a.pendingProps.children),s.flags|=2,a.memoizedState=null,s}function Hb(s,a,c){s.lanes|=a;var f=s.alternate;f!==null&&(f.lanes|=a),$m(s.return,a,c)}function Rp(s,a,c,f,b,w){var z=s.memoizedState;z===null?s.memoizedState={isBackwards:a,rendering:null,renderingStartTime:0,last:f,tail:c,tailMode:b,treeForkCount:w}:(z.isBackwards=a,z.rendering=null,z.renderingStartTime=0,z.last=f,z.tail=c,z.tailMode=b,z.treeForkCount=w)}function Gb(s,a,c){var f=a.pendingProps,b=f.revealOrder,w=f.tail;f=f.children;var z=sn.current,Q=(z&2)!==0;if(Q?(z=z&1|2,a.flags|=128):z&=1,ne(sn,z),Bn(s,a,f,c),f=yt?zc:0,!Q&&s!==null&&(s.flags&128)!==0)e:for(s=a.child;s!==null;){if(s.tag===13)s.memoizedState!==null&&Hb(s,c,a);else if(s.tag===19)Hb(s,c,a);else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===a)break e;for(;s.sibling===null;){if(s.return===null||s.return===a)break e;s=s.return}s.sibling.return=s.return,s=s.sibling}switch(b){case"forwards":for(c=a.child,b=null;c!==null;)s=c.alternate,s!==null&&Hd(s)===null&&(b=c),c=c.sibling;c=b,c===null?(b=a.child,a.child=null):(b=c.sibling,c.sibling=null),Rp(a,!1,b,c,w,f);break;case"backwards":case"unstable_legacy-backwards":for(c=null,b=a.child,a.child=null;b!==null;){if(s=b.alternate,s!==null&&Hd(s)===null){a.child=b;break}s=b.sibling,b.sibling=c,c=b,b=s}Rp(a,!0,c,null,w,f);break;case"together":Rp(a,!1,null,null,void 0,f);break;default:a.memoizedState=null}return a.child}function ri(s,a,c){if(s!==null&&(a.dependencies=s.dependencies),Wi|=a.lanes,(c&a.childLanes)===0)if(s!==null){if(al(s,a,c,!1),(c&a.childLanes)===0)return null}else return null;if(s!==null&&a.child!==s.child)throw Error(r(153));if(a.child!==null){for(s=a.child,c=Xs(s,s.pendingProps),a.child=c,c.return=a;s.sibling!==null;)s=s.sibling,c=c.sibling=Xs(s,s.pendingProps),c.return=a;c.sibling=null}return a.child}function Ip(s,a){return(s.lanes&a)!==0?!0:(s=s.dependencies,!!(s!==null&&zd(s)))}function PA(s,a,c){switch(a.tag){case 3:ce(a,a.stateNode.containerInfo),Ui(a,mn,s.memoizedState.cache),ro();break;case 27:case 5:ze(a);break;case 4:ce(a,a.stateNode.containerInfo);break;case 10:Ui(a,a.type,a.memoizedProps.value);break;case 31:if(a.memoizedState!==null)return a.flags|=128,tp(a),null;break;case 13:var f=a.memoizedState;if(f!==null)return f.dehydrated!==null?(qi(a),a.flags|=128,null):(c&a.child.childLanes)!==0?qb(s,a,c):(qi(a),s=ri(s,a,c),s!==null?s.sibling:null);qi(a);break;case 19:var b=(s.flags&128)!==0;if(f=(c&a.childLanes)!==0,f||(al(s,a,c,!1),f=(c&a.childLanes)!==0),b){if(f)return Gb(s,a,c);a.flags|=128}if(b=a.memoizedState,b!==null&&(b.rendering=null,b.tail=null,b.lastEffect=null),ne(sn,sn.current),f)break;return null;case 22:return a.lanes=0,Bb(s,a,c,a.pendingProps);case 24:Ui(a,mn,s.memoizedState.cache)}return ri(s,a,c)}function Qb(s,a,c){if(s!==null)if(s.memoizedProps!==a.pendingProps)gn=!0;else{if(!Ip(s,c)&&(a.flags&128)===0)return gn=!1,PA(s,a,c);gn=(s.flags&131072)!==0}else gn=!1,yt&&(a.flags&1048576)!==0&&E_(a,zc,a.index);switch(a.lanes=0,a.tag){case 16:e:{var f=a.pendingProps;if(s=oo(a.elementType),a.type=s,typeof s=="function")Nm(s)?(f=ho(s,f),a.tag=1,a=Vb(null,a,s,f,c)):(a.tag=0,a=Sp(null,a,s,f,c));else{if(s!=null){var b=s.$$typeof;if(b===M){a.tag=11,a=Nb(null,a,s,f,c);break e}else if(b===k){a.tag=14,a=Pb(null,a,s,f,c);break e}}throw a=O(s)||s,Error(r(306,a,""))}}return a;case 0:return Sp(s,a,a.type,a.pendingProps,c);case 1:return f=a.type,b=ho(f,a.pendingProps),Vb(s,a,f,b,c);case 3:e:{if(ce(a,a.stateNode.containerInfo),s===null)throw Error(r(387));f=a.pendingProps;var w=a.memoizedState;b=w.element,Ym(s,a),Hc(a,f,null,c);var z=a.memoizedState;if(f=z.cache,Ui(a,mn,f),f!==w.cache&&qm(a,[mn],c,!0),qc(),f=z.element,w.isDehydrated)if(w={element:f,isDehydrated:!1,cache:z.cache},a.updateQueue.baseState=w,a.memoizedState=w,a.flags&256){a=$b(s,a,f,c);break e}else if(f!==b){b=Pr(Error(r(424)),a),Bc(b),a=$b(s,a,f,c);break e}else for(s=a.stateNode.containerInfo,s.nodeType===9?s=s.body:s=s.nodeName==="HTML"?s.ownerDocument.body:s,$t=Fr(s.firstChild),Pn=a,yt=!0,Bi=null,Lr=!0,c=B_(a,null,f,c),a.child=c;c;)c.flags=c.flags&-3|4096,c=c.sibling;else{if(ro(),f===b){a=ri(s,a,c);break e}Bn(s,a,f,c)}a=a.child}return a;case 26:return nh(s,a),s===null?(c=sx(a.type,null,a.pendingProps,null))?a.memoizedState=c:yt||(c=a.type,s=a.pendingProps,f=bh(ue.current).createElement(c),f[dn]=a,f[Rn]=s,Ln(f,c,s),hn(f),a.stateNode=f):a.memoizedState=sx(a.type,s.memoizedProps,a.pendingProps,s.memoizedState),null;case 27:return ze(a),s===null&&yt&&(f=a.stateNode=tx(a.type,a.pendingProps,ue.current),Pn=a,Lr=!0,b=$t,Ji(a.type)?(cg=b,$t=Fr(f.firstChild)):$t=b),Bn(s,a,a.pendingProps.children,c),nh(s,a),s===null&&(a.flags|=4194304),a.child;case 5:return s===null&&yt&&((b=f=$t)&&(f=h2(f,a.type,a.pendingProps,Lr),f!==null?(a.stateNode=f,Pn=a,$t=Fr(f.firstChild),Lr=!1,b=!0):b=!1),b||Li(a)),ze(a),b=a.type,w=a.pendingProps,z=s!==null?s.memoizedProps:null,f=w.children,sg(b,w)?f=null:z!==null&&sg(b,z)&&(a.flags|=32),a.memoizedState!==null&&(b=rp(s,a,AA,null,null,c),du._currentValue=b),nh(s,a),Bn(s,a,f,c),a.child;case 6:return s===null&&yt&&((s=c=$t)&&(c=f2(c,a.pendingProps,Lr),c!==null?(a.stateNode=c,Pn=a,$t=null,s=!0):s=!1),s||Li(a)),null;case 13:return qb(s,a,c);case 4:return ce(a,a.stateNode.containerInfo),f=a.pendingProps,s===null?a.child=co(a,null,f,c):Bn(s,a,f,c),a.child;case 11:return Nb(s,a,a.type,a.pendingProps,c);case 7:return Bn(s,a,a.pendingProps,c),a.child;case 8:return Bn(s,a,a.pendingProps.children,c),a.child;case 12:return Bn(s,a,a.pendingProps.children,c),a.child;case 10:return f=a.pendingProps,Ui(a,a.type,f.value),Bn(s,a,f.children,c),a.child;case 9:return b=a.type._context,f=a.pendingProps.children,io(a),b=zn(b),f=f(b),a.flags|=1,Bn(s,a,f,c),a.child;case 14:return Pb(s,a,a.type,a.pendingProps,c);case 15:return zb(s,a,a.type,a.pendingProps,c);case 19:return Gb(s,a,c);case 31:return NA(s,a,c);case 22:return Bb(s,a,c,a.pendingProps);case 24:return io(a),f=zn(mn),s===null?(b=Qm(),b===null&&(b=Lt,w=Hm(),b.pooledCache=w,w.refCount++,w!==null&&(b.pooledCacheLanes|=c),b=w),a.memoizedState={parent:f,cache:b},Km(a),Ui(a,mn,b)):((s.lanes&c)!==0&&(Ym(s,a),Hc(a,null,null,c),qc()),b=s.memoizedState,w=a.memoizedState,b.parent!==f?(b={parent:f,cache:f},a.memoizedState=b,a.lanes===0&&(a.memoizedState=a.updateQueue.baseState=b),Ui(a,mn,f)):(f=w.cache,Ui(a,mn,f),f!==b.cache&&qm(a,[mn],c,!0))),Bn(s,a,a.pendingProps.children,c),a.child;case 29:throw a.pendingProps}throw Error(r(156,a.tag))}function si(s){s.flags|=4}function kp(s,a,c,f,b){if((a=(s.mode&32)!==0)&&(a=!1),a){if(s.flags|=16777216,(b&335544128)===b)if(s.stateNode.complete)s.flags|=8192;else if(vv())s.flags|=8192;else throw lo=Fd,Wm}else s.flags&=-16777217}function Wb(s,a){if(a.type!=="stylesheet"||(a.state.loading&4)!==0)s.flags&=-16777217;else if(s.flags|=16777216,!cx(a))if(vv())s.flags|=8192;else throw lo=Fd,Wm}function sh(s,a){a!==null&&(s.flags|=4),s.flags&16384&&(a=s.tag!==22?ud():536870912,s.lanes|=a,_l|=a)}function Xc(s,a){if(!yt)switch(s.tailMode){case"hidden":a=s.tail;for(var c=null;a!==null;)a.alternate!==null&&(c=a),a=a.sibling;c===null?s.tail=null:c.sibling=null;break;case"collapsed":c=s.tail;for(var f=null;c!==null;)c.alternate!==null&&(f=c),c=c.sibling;f===null?a||s.tail===null?s.tail=null:s.tail.sibling=null:f.sibling=null}}function qt(s){var a=s.alternate!==null&&s.alternate.child===s.child,c=0,f=0;if(a)for(var b=s.child;b!==null;)c|=b.lanes|b.childLanes,f|=b.subtreeFlags&65011712,f|=b.flags&65011712,b.return=s,b=b.sibling;else for(b=s.child;b!==null;)c|=b.lanes|b.childLanes,f|=b.subtreeFlags,f|=b.flags,b.return=s,b=b.sibling;return s.subtreeFlags|=f,s.childLanes=c,a}function zA(s,a,c){var f=a.pendingProps;switch(Lm(a),a.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return qt(a),null;case 1:return qt(a),null;case 3:return c=a.stateNode,f=null,s!==null&&(f=s.memoizedState.cache),a.memoizedState.cache!==f&&(a.flags|=2048),ei(mn),ve(),c.pendingContext&&(c.context=c.pendingContext,c.pendingContext=null),(s===null||s.child===null)&&(il(a)?si(a):s===null||s.memoizedState.isDehydrated&&(a.flags&256)===0||(a.flags|=1024,Fm())),qt(a),null;case 26:var b=a.type,w=a.memoizedState;return s===null?(si(a),w!==null?(qt(a),Wb(a,w)):(qt(a),kp(a,b,null,f,c))):w?w!==s.memoizedState?(si(a),qt(a),Wb(a,w)):(qt(a),a.flags&=-16777217):(s=s.memoizedProps,s!==f&&si(a),qt(a),kp(a,b,s,f,c)),null;case 27:if(Pe(a),c=ue.current,b=a.type,s!==null&&a.stateNode!=null)s.memoizedProps!==f&&si(a);else{if(!f){if(a.stateNode===null)throw Error(r(166));return qt(a),null}s=ie.current,il(a)?A_(a):(s=tx(b,f,c),a.stateNode=s,si(a))}return qt(a),null;case 5:if(Pe(a),b=a.type,s!==null&&a.stateNode!=null)s.memoizedProps!==f&&si(a);else{if(!f){if(a.stateNode===null)throw Error(r(166));return qt(a),null}if(w=ie.current,il(a))A_(a);else{var z=bh(ue.current);switch(w){case 1:w=z.createElementNS("http://www.w3.org/2000/svg",b);break;case 2:w=z.createElementNS("http://www.w3.org/1998/Math/MathML",b);break;default:switch(b){case"svg":w=z.createElementNS("http://www.w3.org/2000/svg",b);break;case"math":w=z.createElementNS("http://www.w3.org/1998/Math/MathML",b);break;case"script":w=z.createElement("div"),w.innerHTML="<script><\/script>",w=w.removeChild(w.firstChild);break;case"select":w=typeof f.is=="string"?z.createElement("select",{is:f.is}):z.createElement("select"),f.multiple?w.multiple=!0:f.size&&(w.size=f.size);break;default:w=typeof f.is=="string"?z.createElement(b,{is:f.is}):z.createElement(b)}}w[dn]=a,w[Rn]=f;e:for(z=a.child;z!==null;){if(z.tag===5||z.tag===6)w.appendChild(z.stateNode);else if(z.tag!==4&&z.tag!==27&&z.child!==null){z.child.return=z,z=z.child;continue}if(z===a)break e;for(;z.sibling===null;){if(z.return===null||z.return===a)break e;z=z.return}z.sibling.return=z.return,z=z.sibling}a.stateNode=w;e:switch(Ln(w,b,f),b){case"button":case"input":case"select":case"textarea":f=!!f.autoFocus;break e;case"img":f=!0;break e;default:f=!1}f&&si(a)}}return qt(a),kp(a,a.type,s===null?null:s.memoizedProps,a.pendingProps,c),null;case 6:if(s&&a.stateNode!=null)s.memoizedProps!==f&&si(a);else{if(typeof f!="string"&&a.stateNode===null)throw Error(r(166));if(s=ue.current,il(a)){if(s=a.stateNode,c=a.memoizedProps,f=null,b=Pn,b!==null)switch(b.tag){case 27:case 5:f=b.memoizedProps}s[dn]=a,s=!!(s.nodeValue===c||f!==null&&f.suppressHydrationWarning===!0||qv(s.nodeValue,c)),s||Li(a,!0)}else s=bh(s).createTextNode(f),s[dn]=a,a.stateNode=s}return qt(a),null;case 31:if(c=a.memoizedState,s===null||s.memoizedState!==null){if(f=il(a),c!==null){if(s===null){if(!f)throw Error(r(318));if(s=a.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(r(557));s[dn]=a}else ro(),(a.flags&128)===0&&(a.memoizedState=null),a.flags|=4;qt(a),s=!1}else c=Fm(),s!==null&&s.memoizedState!==null&&(s.memoizedState.hydrationErrors=c),s=!0;if(!s)return a.flags&256?(Sr(a),a):(Sr(a),null);if((a.flags&128)!==0)throw Error(r(558))}return qt(a),null;case 13:if(f=a.memoizedState,s===null||s.memoizedState!==null&&s.memoizedState.dehydrated!==null){if(b=il(a),f!==null&&f.dehydrated!==null){if(s===null){if(!b)throw Error(r(318));if(b=a.memoizedState,b=b!==null?b.dehydrated:null,!b)throw Error(r(317));b[dn]=a}else ro(),(a.flags&128)===0&&(a.memoizedState=null),a.flags|=4;qt(a),b=!1}else b=Fm(),s!==null&&s.memoizedState!==null&&(s.memoizedState.hydrationErrors=b),b=!0;if(!b)return a.flags&256?(Sr(a),a):(Sr(a),null)}return Sr(a),(a.flags&128)!==0?(a.lanes=c,a):(c=f!==null,s=s!==null&&s.memoizedState!==null,c&&(f=a.child,b=null,f.alternate!==null&&f.alternate.memoizedState!==null&&f.alternate.memoizedState.cachePool!==null&&(b=f.alternate.memoizedState.cachePool.pool),w=null,f.memoizedState!==null&&f.memoizedState.cachePool!==null&&(w=f.memoizedState.cachePool.pool),w!==b&&(f.flags|=2048)),c!==s&&c&&(a.child.flags|=8192),sh(a,a.updateQueue),qt(a),null);case 4:return ve(),s===null&&Jp(a.stateNode.containerInfo),qt(a),null;case 10:return ei(a.type),qt(a),null;case 19:if(G(sn),f=a.memoizedState,f===null)return qt(a),null;if(b=(a.flags&128)!==0,w=f.rendering,w===null)if(b)Xc(f,!1);else{if(nn!==0||s!==null&&(s.flags&128)!==0)for(s=a.child;s!==null;){if(w=Hd(s),w!==null){for(a.flags|=128,Xc(f,!1),s=w.updateQueue,a.updateQueue=s,sh(a,s),a.subtreeFlags=0,s=c,c=a.child;c!==null;)w_(c,s),c=c.sibling;return ne(sn,sn.current&1|2),yt&&Zs(a,f.treeForkCount),a.child}s=s.sibling}f.tail!==null&&Me()>ch&&(a.flags|=128,b=!0,Xc(f,!1),a.lanes=4194304)}else{if(!b)if(s=Hd(w),s!==null){if(a.flags|=128,b=!0,s=s.updateQueue,a.updateQueue=s,sh(a,s),Xc(f,!0),f.tail===null&&f.tailMode==="hidden"&&!w.alternate&&!yt)return qt(a),null}else 2*Me()-f.renderingStartTime>ch&&c!==536870912&&(a.flags|=128,b=!0,Xc(f,!1),a.lanes=4194304);f.isBackwards?(w.sibling=a.child,a.child=w):(s=f.last,s!==null?s.sibling=w:a.child=w,f.last=w)}return f.tail!==null?(s=f.tail,f.rendering=s,f.tail=s.sibling,f.renderingStartTime=Me(),s.sibling=null,c=sn.current,ne(sn,b?c&1|2:c&1),yt&&Zs(a,f.treeForkCount),s):(qt(a),null);case 22:case 23:return Sr(a),ep(),f=a.memoizedState!==null,s!==null?s.memoizedState!==null!==f&&(a.flags|=8192):f&&(a.flags|=8192),f?(c&536870912)!==0&&(a.flags&128)===0&&(qt(a),a.subtreeFlags&6&&(a.flags|=8192)):qt(a),c=a.updateQueue,c!==null&&sh(a,c.retryQueue),c=null,s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(c=s.memoizedState.cachePool.pool),f=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(f=a.memoizedState.cachePool.pool),f!==c&&(a.flags|=2048),s!==null&&G(ao),null;case 24:return c=null,s!==null&&(c=s.memoizedState.cache),a.memoizedState.cache!==c&&(a.flags|=2048),ei(mn),qt(a),null;case 25:return null;case 30:return null}throw Error(r(156,a.tag))}function BA(s,a){switch(Lm(a),a.tag){case 1:return s=a.flags,s&65536?(a.flags=s&-65537|128,a):null;case 3:return ei(mn),ve(),s=a.flags,(s&65536)!==0&&(s&128)===0?(a.flags=s&-65537|128,a):null;case 26:case 27:case 5:return Pe(a),null;case 31:if(a.memoizedState!==null){if(Sr(a),a.alternate===null)throw Error(r(340));ro()}return s=a.flags,s&65536?(a.flags=s&-65537|128,a):null;case 13:if(Sr(a),s=a.memoizedState,s!==null&&s.dehydrated!==null){if(a.alternate===null)throw Error(r(340));ro()}return s=a.flags,s&65536?(a.flags=s&-65537|128,a):null;case 19:return G(sn),null;case 4:return ve(),null;case 10:return ei(a.type),null;case 22:case 23:return Sr(a),ep(),s!==null&&G(ao),s=a.flags,s&65536?(a.flags=s&-65537|128,a):null;case 24:return ei(mn),null;case 25:return null;default:return null}}function Kb(s,a){switch(Lm(a),a.tag){case 3:ei(mn),ve();break;case 26:case 27:case 5:Pe(a);break;case 4:ve();break;case 31:a.memoizedState!==null&&Sr(a);break;case 13:Sr(a);break;case 19:G(sn);break;case 10:ei(a.type);break;case 22:case 23:Sr(a),ep(),s!==null&&G(ao);break;case 24:ei(mn)}}function Zc(s,a){try{var c=a.updateQueue,f=c!==null?c.lastEffect:null;if(f!==null){var b=f.next;c=b;do{if((c.tag&s)===s){f=void 0;var w=c.create,z=c.inst;f=w(),z.destroy=f}c=c.next}while(c!==b)}}catch(Q){Dt(a,a.return,Q)}}function Gi(s,a,c){try{var f=a.updateQueue,b=f!==null?f.lastEffect:null;if(b!==null){var w=b.next;f=w;do{if((f.tag&s)===s){var z=f.inst,Q=z.destroy;if(Q!==void 0){z.destroy=void 0,b=a;var re=c,ge=Q;try{ge()}catch(Ee){Dt(b,re,Ee)}}}f=f.next}while(f!==w)}}catch(Ee){Dt(a,a.return,Ee)}}function Yb(s){var a=s.updateQueue;if(a!==null){var c=s.stateNode;try{U_(a,c)}catch(f){Dt(s,s.return,f)}}}function Xb(s,a,c){c.props=ho(s.type,s.memoizedProps),c.state=s.memoizedState;try{c.componentWillUnmount()}catch(f){Dt(s,a,f)}}function Jc(s,a){try{var c=s.ref;if(c!==null){switch(s.tag){case 26:case 27:case 5:var f=s.stateNode;break;case 30:f=s.stateNode;break;default:f=s.stateNode}typeof c=="function"?s.refCleanup=c(f):c.current=f}}catch(b){Dt(s,a,b)}}function Ms(s,a){var c=s.ref,f=s.refCleanup;if(c!==null)if(typeof f=="function")try{f()}catch(b){Dt(s,a,b)}finally{s.refCleanup=null,s=s.alternate,s!=null&&(s.refCleanup=null)}else if(typeof c=="function")try{c(null)}catch(b){Dt(s,a,b)}else c.current=null}function Zb(s){var a=s.type,c=s.memoizedProps,f=s.stateNode;try{e:switch(a){case"button":case"input":case"select":case"textarea":c.autoFocus&&f.focus();break e;case"img":c.src?f.src=c.src:c.srcSet&&(f.srcset=c.srcSet)}}catch(b){Dt(s,s.return,b)}}function Dp(s,a,c){try{var f=s.stateNode;a2(f,s.type,c,a),f[Rn]=a}catch(b){Dt(s,s.return,b)}}function Jb(s){return s.tag===5||s.tag===3||s.tag===26||s.tag===27&&Ji(s.type)||s.tag===4}function Op(s){e:for(;;){for(;s.sibling===null;){if(s.return===null||Jb(s.return))return null;s=s.return}for(s.sibling.return=s.return,s=s.sibling;s.tag!==5&&s.tag!==6&&s.tag!==18;){if(s.tag===27&&Ji(s.type)||s.flags&2||s.child===null||s.tag===4)continue e;s.child.return=s,s=s.child}if(!(s.flags&2))return s.stateNode}}function Mp(s,a,c){var f=s.tag;if(f===5||f===6)s=s.stateNode,a?(c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c).insertBefore(s,a):(a=c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c,a.appendChild(s),c=c._reactRootContainer,c!=null||a.onclick!==null||(a.onclick=Xr));else if(f!==4&&(f===27&&Ji(s.type)&&(c=s.stateNode,a=null),s=s.child,s!==null))for(Mp(s,a,c),s=s.sibling;s!==null;)Mp(s,a,c),s=s.sibling}function ih(s,a,c){var f=s.tag;if(f===5||f===6)s=s.stateNode,a?c.insertBefore(s,a):c.appendChild(s);else if(f!==4&&(f===27&&Ji(s.type)&&(c=s.stateNode),s=s.child,s!==null))for(ih(s,a,c),s=s.sibling;s!==null;)ih(s,a,c),s=s.sibling}function ev(s){var a=s.stateNode,c=s.memoizedProps;try{for(var f=s.type,b=a.attributes;b.length;)a.removeAttributeNode(b[0]);Ln(a,f,c),a[dn]=s,a[Rn]=c}catch(w){Dt(s,s.return,w)}}var ii=!1,yn=!1,Np=!1,tv=typeof WeakSet=="function"?WeakSet:Set,kn=null;function LA(s,a){if(s=s.containerInfo,ng=Th,s=f_(s),jm(s)){if("selectionStart"in s)var c={start:s.selectionStart,end:s.selectionEnd};else e:{c=(c=s.ownerDocument)&&c.defaultView||window;var f=c.getSelection&&c.getSelection();if(f&&f.rangeCount!==0){c=f.anchorNode;var b=f.anchorOffset,w=f.focusNode;f=f.focusOffset;try{c.nodeType,w.nodeType}catch{c=null;break e}var z=0,Q=-1,re=-1,ge=0,Ee=0,Re=s,_e=null;t:for(;;){for(var we;Re!==c||b!==0&&Re.nodeType!==3||(Q=z+b),Re!==w||f!==0&&Re.nodeType!==3||(re=z+f),Re.nodeType===3&&(z+=Re.nodeValue.length),(we=Re.firstChild)!==null;)_e=Re,Re=we;for(;;){if(Re===s)break t;if(_e===c&&++ge===b&&(Q=z),_e===w&&++Ee===f&&(re=z),(we=Re.nextSibling)!==null)break;Re=_e,_e=Re.parentNode}Re=we}c=Q===-1||re===-1?null:{start:Q,end:re}}else c=null}c=c||{start:0,end:0}}else c=null;for(rg={focusedElem:s,selectionRange:c},Th=!1,kn=a;kn!==null;)if(a=kn,s=a.child,(a.subtreeFlags&1028)!==0&&s!==null)s.return=a,kn=s;else for(;kn!==null;){switch(a=kn,w=a.alternate,s=a.flags,a.tag){case 0:if((s&4)!==0&&(s=a.updateQueue,s=s!==null?s.events:null,s!==null))for(c=0;c<s.length;c++)b=s[c],b.ref.impl=b.nextImpl;break;case 11:case 15:break;case 1:if((s&1024)!==0&&w!==null){s=void 0,c=a,b=w.memoizedProps,w=w.memoizedState,f=c.stateNode;try{var Fe=ho(c.type,b);s=f.getSnapshotBeforeUpdate(Fe,w),f.__reactInternalSnapshotBeforeUpdate=s}catch(We){Dt(c,c.return,We)}}break;case 3:if((s&1024)!==0){if(s=a.stateNode.containerInfo,c=s.nodeType,c===9)ag(s);else if(c===1)switch(s.nodeName){case"HEAD":case"HTML":case"BODY":ag(s);break;default:s.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((s&1024)!==0)throw Error(r(163))}if(s=a.sibling,s!==null){s.return=a.return,kn=s;break}kn=a.return}}function nv(s,a,c){var f=c.flags;switch(c.tag){case 0:case 11:case 15:oi(s,c),f&4&&Zc(5,c);break;case 1:if(oi(s,c),f&4)if(s=c.stateNode,a===null)try{s.componentDidMount()}catch(z){Dt(c,c.return,z)}else{var b=ho(c.type,a.memoizedProps);a=a.memoizedState;try{s.componentDidUpdate(b,a,s.__reactInternalSnapshotBeforeUpdate)}catch(z){Dt(c,c.return,z)}}f&64&&Yb(c),f&512&&Jc(c,c.return);break;case 3:if(oi(s,c),f&64&&(s=c.updateQueue,s!==null)){if(a=null,c.child!==null)switch(c.child.tag){case 27:case 5:a=c.child.stateNode;break;case 1:a=c.child.stateNode}try{U_(s,a)}catch(z){Dt(c,c.return,z)}}break;case 27:a===null&&f&4&&ev(c);case 26:case 5:oi(s,c),a===null&&f&4&&Zb(c),f&512&&Jc(c,c.return);break;case 12:oi(s,c);break;case 31:oi(s,c),f&4&&iv(s,c);break;case 13:oi(s,c),f&4&&av(s,c),f&64&&(s=c.memoizedState,s!==null&&(s=s.dehydrated,s!==null&&(c=WA.bind(null,c),m2(s,c))));break;case 22:if(f=c.memoizedState!==null||ii,!f){a=a!==null&&a.memoizedState!==null||yn,b=ii;var w=yn;ii=f,(yn=a)&&!w?li(s,c,(c.subtreeFlags&8772)!==0):oi(s,c),ii=b,yn=w}break;case 30:break;default:oi(s,c)}}function rv(s){var a=s.alternate;a!==null&&(s.alternate=null,rv(a)),s.child=null,s.deletions=null,s.sibling=null,s.tag===5&&(a=s.stateNode,a!==null&&Vo(a)),s.stateNode=null,s.return=null,s.dependencies=null,s.memoizedProps=null,s.memoizedState=null,s.pendingProps=null,s.stateNode=null,s.updateQueue=null}var Wt=null,or=!1;function ai(s,a,c){for(c=c.child;c!==null;)sv(s,a,c),c=c.sibling}function sv(s,a,c){if(en&&typeof en.onCommitFiberUnmount=="function")try{en.onCommitFiberUnmount(vt,c)}catch{}switch(c.tag){case 26:yn||Ms(c,a),ai(s,a,c),c.memoizedState?c.memoizedState.count--:c.stateNode&&(c=c.stateNode,c.parentNode.removeChild(c));break;case 27:yn||Ms(c,a);var f=Wt,b=or;Ji(c.type)&&(Wt=c.stateNode,or=!1),ai(s,a,c),lu(c.stateNode),Wt=f,or=b;break;case 5:yn||Ms(c,a);case 6:if(f=Wt,b=or,Wt=null,ai(s,a,c),Wt=f,or=b,Wt!==null)if(or)try{(Wt.nodeType===9?Wt.body:Wt.nodeName==="HTML"?Wt.ownerDocument.body:Wt).removeChild(c.stateNode)}catch(w){Dt(c,a,w)}else try{Wt.removeChild(c.stateNode)}catch(w){Dt(c,a,w)}break;case 18:Wt!==null&&(or?(s=Wt,Yv(s.nodeType===9?s.body:s.nodeName==="HTML"?s.ownerDocument.body:s,c.stateNode),Tl(s)):Yv(Wt,c.stateNode));break;case 4:f=Wt,b=or,Wt=c.stateNode.containerInfo,or=!0,ai(s,a,c),Wt=f,or=b;break;case 0:case 11:case 14:case 15:Gi(2,c,a),yn||Gi(4,c,a),ai(s,a,c);break;case 1:yn||(Ms(c,a),f=c.stateNode,typeof f.componentWillUnmount=="function"&&Xb(c,a,f)),ai(s,a,c);break;case 21:ai(s,a,c);break;case 22:yn=(f=yn)||c.memoizedState!==null,ai(s,a,c),yn=f;break;default:ai(s,a,c)}}function iv(s,a){if(a.memoizedState===null&&(s=a.alternate,s!==null&&(s=s.memoizedState,s!==null))){s=s.dehydrated;try{Tl(s)}catch(c){Dt(a,a.return,c)}}}function av(s,a){if(a.memoizedState===null&&(s=a.alternate,s!==null&&(s=s.memoizedState,s!==null&&(s=s.dehydrated,s!==null))))try{Tl(s)}catch(c){Dt(a,a.return,c)}}function UA(s){switch(s.tag){case 31:case 13:case 19:var a=s.stateNode;return a===null&&(a=s.stateNode=new tv),a;case 22:return s=s.stateNode,a=s._retryCache,a===null&&(a=s._retryCache=new tv),a;default:throw Error(r(435,s.tag))}}function ah(s,a){var c=UA(s);a.forEach(function(f){if(!c.has(f)){c.add(f);var b=KA.bind(null,s,f);f.then(b,b)}})}function lr(s,a){var c=a.deletions;if(c!==null)for(var f=0;f<c.length;f++){var b=c[f],w=s,z=a,Q=z;e:for(;Q!==null;){switch(Q.tag){case 27:if(Ji(Q.type)){Wt=Q.stateNode,or=!1;break e}break;case 5:Wt=Q.stateNode,or=!1;break e;case 3:case 4:Wt=Q.stateNode.containerInfo,or=!0;break e}Q=Q.return}if(Wt===null)throw Error(r(160));sv(w,z,b),Wt=null,or=!1,w=b.alternate,w!==null&&(w.return=null),b.return=null}if(a.subtreeFlags&13886)for(a=a.child;a!==null;)ov(a,s),a=a.sibling}var rs=null;function ov(s,a){var c=s.alternate,f=s.flags;switch(s.tag){case 0:case 11:case 14:case 15:lr(a,s),cr(s),f&4&&(Gi(3,s,s.return),Zc(3,s),Gi(5,s,s.return));break;case 1:lr(a,s),cr(s),f&512&&(yn||c===null||Ms(c,c.return)),f&64&&ii&&(s=s.updateQueue,s!==null&&(f=s.callbacks,f!==null&&(c=s.shared.hiddenCallbacks,s.shared.hiddenCallbacks=c===null?f:c.concat(f))));break;case 26:var b=rs;if(lr(a,s),cr(s),f&512&&(yn||c===null||Ms(c,c.return)),f&4){var w=c!==null?c.memoizedState:null;if(f=s.memoizedState,c===null)if(f===null)if(s.stateNode===null){e:{f=s.type,c=s.memoizedProps,b=b.ownerDocument||b;t:switch(f){case"title":w=b.getElementsByTagName("title")[0],(!w||w[vs]||w[dn]||w.namespaceURI==="http://www.w3.org/2000/svg"||w.hasAttribute("itemprop"))&&(w=b.createElement(f),b.head.insertBefore(w,b.querySelector("head > title"))),Ln(w,f,c),w[dn]=s,hn(w),f=w;break e;case"link":var z=ox("link","href",b).get(f+(c.href||""));if(z){for(var Q=0;Q<z.length;Q++)if(w=z[Q],w.getAttribute("href")===(c.href==null||c.href===""?null:c.href)&&w.getAttribute("rel")===(c.rel==null?null:c.rel)&&w.getAttribute("title")===(c.title==null?null:c.title)&&w.getAttribute("crossorigin")===(c.crossOrigin==null?null:c.crossOrigin)){z.splice(Q,1);break t}}w=b.createElement(f),Ln(w,f,c),b.head.appendChild(w);break;case"meta":if(z=ox("meta","content",b).get(f+(c.content||""))){for(Q=0;Q<z.length;Q++)if(w=z[Q],w.getAttribute("content")===(c.content==null?null:""+c.content)&&w.getAttribute("name")===(c.name==null?null:c.name)&&w.getAttribute("property")===(c.property==null?null:c.property)&&w.getAttribute("http-equiv")===(c.httpEquiv==null?null:c.httpEquiv)&&w.getAttribute("charset")===(c.charSet==null?null:c.charSet)){z.splice(Q,1);break t}}w=b.createElement(f),Ln(w,f,c),b.head.appendChild(w);break;default:throw Error(r(468,f))}w[dn]=s,hn(w),f=w}s.stateNode=f}else lx(b,s.type,s.stateNode);else s.stateNode=ax(b,f,s.memoizedProps);else w!==f?(w===null?c.stateNode!==null&&(c=c.stateNode,c.parentNode.removeChild(c)):w.count--,f===null?lx(b,s.type,s.stateNode):ax(b,f,s.memoizedProps)):f===null&&s.stateNode!==null&&Dp(s,s.memoizedProps,c.memoizedProps)}break;case 27:lr(a,s),cr(s),f&512&&(yn||c===null||Ms(c,c.return)),c!==null&&f&4&&Dp(s,s.memoizedProps,c.memoizedProps);break;case 5:if(lr(a,s),cr(s),f&512&&(yn||c===null||Ms(c,c.return)),s.flags&32){b=s.stateNode;try{ar(b,"")}catch(Fe){Dt(s,s.return,Fe)}}f&4&&s.stateNode!=null&&(b=s.memoizedProps,Dp(s,b,c!==null?c.memoizedProps:b)),f&1024&&(Np=!0);break;case 6:if(lr(a,s),cr(s),f&4){if(s.stateNode===null)throw Error(r(162));f=s.memoizedProps,c=s.stateNode;try{c.nodeValue=f}catch(Fe){Dt(s,s.return,Fe)}}break;case 3:if(wh=null,b=rs,rs=vh(a.containerInfo),lr(a,s),rs=b,cr(s),f&4&&c!==null&&c.memoizedState.isDehydrated)try{Tl(a.containerInfo)}catch(Fe){Dt(s,s.return,Fe)}Np&&(Np=!1,lv(s));break;case 4:f=rs,rs=vh(s.stateNode.containerInfo),lr(a,s),cr(s),rs=f;break;case 12:lr(a,s),cr(s);break;case 31:lr(a,s),cr(s),f&4&&(f=s.updateQueue,f!==null&&(s.updateQueue=null,ah(s,f)));break;case 13:lr(a,s),cr(s),s.child.flags&8192&&s.memoizedState!==null!=(c!==null&&c.memoizedState!==null)&&(lh=Me()),f&4&&(f=s.updateQueue,f!==null&&(s.updateQueue=null,ah(s,f)));break;case 22:b=s.memoizedState!==null;var re=c!==null&&c.memoizedState!==null,ge=ii,Ee=yn;if(ii=ge||b,yn=Ee||re,lr(a,s),yn=Ee,ii=ge,cr(s),f&8192)e:for(a=s.stateNode,a._visibility=b?a._visibility&-2:a._visibility|1,b&&(c===null||re||ii||yn||fo(s)),c=null,a=s;;){if(a.tag===5||a.tag===26){if(c===null){re=c=a;try{if(w=re.stateNode,b)z=w.style,typeof z.setProperty=="function"?z.setProperty("display","none","important"):z.display="none";else{Q=re.stateNode;var Re=re.memoizedProps.style,_e=Re!=null&&Re.hasOwnProperty("display")?Re.display:null;Q.style.display=_e==null||typeof _e=="boolean"?"":(""+_e).trim()}}catch(Fe){Dt(re,re.return,Fe)}}}else if(a.tag===6){if(c===null){re=a;try{re.stateNode.nodeValue=b?"":re.memoizedProps}catch(Fe){Dt(re,re.return,Fe)}}}else if(a.tag===18){if(c===null){re=a;try{var we=re.stateNode;b?Xv(we,!0):Xv(re.stateNode,!1)}catch(Fe){Dt(re,re.return,Fe)}}}else if((a.tag!==22&&a.tag!==23||a.memoizedState===null||a===s)&&a.child!==null){a.child.return=a,a=a.child;continue}if(a===s)break e;for(;a.sibling===null;){if(a.return===null||a.return===s)break e;c===a&&(c=null),a=a.return}c===a&&(c=null),a.sibling.return=a.return,a=a.sibling}f&4&&(f=s.updateQueue,f!==null&&(c=f.retryQueue,c!==null&&(f.retryQueue=null,ah(s,c))));break;case 19:lr(a,s),cr(s),f&4&&(f=s.updateQueue,f!==null&&(s.updateQueue=null,ah(s,f)));break;case 30:break;case 21:break;default:lr(a,s),cr(s)}}function cr(s){var a=s.flags;if(a&2){try{for(var c,f=s.return;f!==null;){if(Jb(f)){c=f;break}f=f.return}if(c==null)throw Error(r(160));switch(c.tag){case 27:var b=c.stateNode,w=Op(s);ih(s,w,b);break;case 5:var z=c.stateNode;c.flags&32&&(ar(z,""),c.flags&=-33);var Q=Op(s);ih(s,Q,z);break;case 3:case 4:var re=c.stateNode.containerInfo,ge=Op(s);Mp(s,ge,re);break;default:throw Error(r(161))}}catch(Ee){Dt(s,s.return,Ee)}s.flags&=-3}a&4096&&(s.flags&=-4097)}function lv(s){if(s.subtreeFlags&1024)for(s=s.child;s!==null;){var a=s;lv(a),a.tag===5&&a.flags&1024&&a.stateNode.reset(),s=s.sibling}}function oi(s,a){if(a.subtreeFlags&8772)for(a=a.child;a!==null;)nv(s,a.alternate,a),a=a.sibling}function fo(s){for(s=s.child;s!==null;){var a=s;switch(a.tag){case 0:case 11:case 14:case 15:Gi(4,a,a.return),fo(a);break;case 1:Ms(a,a.return);var c=a.stateNode;typeof c.componentWillUnmount=="function"&&Xb(a,a.return,c),fo(a);break;case 27:lu(a.stateNode);case 26:case 5:Ms(a,a.return),fo(a);break;case 22:a.memoizedState===null&&fo(a);break;case 30:fo(a);break;default:fo(a)}s=s.sibling}}function li(s,a,c){for(c=c&&(a.subtreeFlags&8772)!==0,a=a.child;a!==null;){var f=a.alternate,b=s,w=a,z=w.flags;switch(w.tag){case 0:case 11:case 15:li(b,w,c),Zc(4,w);break;case 1:if(li(b,w,c),f=w,b=f.stateNode,typeof b.componentDidMount=="function")try{b.componentDidMount()}catch(ge){Dt(f,f.return,ge)}if(f=w,b=f.updateQueue,b!==null){var Q=f.stateNode;try{var re=b.shared.hiddenCallbacks;if(re!==null)for(b.shared.hiddenCallbacks=null,b=0;b<re.length;b++)L_(re[b],Q)}catch(ge){Dt(f,f.return,ge)}}c&&z&64&&Yb(w),Jc(w,w.return);break;case 27:ev(w);case 26:case 5:li(b,w,c),c&&f===null&&z&4&&Zb(w),Jc(w,w.return);break;case 12:li(b,w,c);break;case 31:li(b,w,c),c&&z&4&&iv(b,w);break;case 13:li(b,w,c),c&&z&4&&av(b,w);break;case 22:w.memoizedState===null&&li(b,w,c),Jc(w,w.return);break;case 30:break;default:li(b,w,c)}a=a.sibling}}function Pp(s,a){var c=null;s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(c=s.memoizedState.cachePool.pool),s=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(s=a.memoizedState.cachePool.pool),s!==c&&(s!=null&&s.refCount++,c!=null&&Lc(c))}function zp(s,a){s=null,a.alternate!==null&&(s=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==s&&(a.refCount++,s!=null&&Lc(s))}function ss(s,a,c,f){if(a.subtreeFlags&10256)for(a=a.child;a!==null;)cv(s,a,c,f),a=a.sibling}function cv(s,a,c,f){var b=a.flags;switch(a.tag){case 0:case 11:case 15:ss(s,a,c,f),b&2048&&Zc(9,a);break;case 1:ss(s,a,c,f);break;case 3:ss(s,a,c,f),b&2048&&(s=null,a.alternate!==null&&(s=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==s&&(a.refCount++,s!=null&&Lc(s)));break;case 12:if(b&2048){ss(s,a,c,f),s=a.stateNode;try{var w=a.memoizedProps,z=w.id,Q=w.onPostCommit;typeof Q=="function"&&Q(z,a.alternate===null?"mount":"update",s.passiveEffectDuration,-0)}catch(re){Dt(a,a.return,re)}}else ss(s,a,c,f);break;case 31:ss(s,a,c,f);break;case 13:ss(s,a,c,f);break;case 23:break;case 22:w=a.stateNode,z=a.alternate,a.memoizedState!==null?w._visibility&2?ss(s,a,c,f):eu(s,a):w._visibility&2?ss(s,a,c,f):(w._visibility|=2,pl(s,a,c,f,(a.subtreeFlags&10256)!==0||!1)),b&2048&&Pp(z,a);break;case 24:ss(s,a,c,f),b&2048&&zp(a.alternate,a);break;default:ss(s,a,c,f)}}function pl(s,a,c,f,b){for(b=b&&((a.subtreeFlags&10256)!==0||!1),a=a.child;a!==null;){var w=s,z=a,Q=c,re=f,ge=z.flags;switch(z.tag){case 0:case 11:case 15:pl(w,z,Q,re,b),Zc(8,z);break;case 23:break;case 22:var Ee=z.stateNode;z.memoizedState!==null?Ee._visibility&2?pl(w,z,Q,re,b):eu(w,z):(Ee._visibility|=2,pl(w,z,Q,re,b)),b&&ge&2048&&Pp(z.alternate,z);break;case 24:pl(w,z,Q,re,b),b&&ge&2048&&zp(z.alternate,z);break;default:pl(w,z,Q,re,b)}a=a.sibling}}function eu(s,a){if(a.subtreeFlags&10256)for(a=a.child;a!==null;){var c=s,f=a,b=f.flags;switch(f.tag){case 22:eu(c,f),b&2048&&Pp(f.alternate,f);break;case 24:eu(c,f),b&2048&&zp(f.alternate,f);break;default:eu(c,f)}a=a.sibling}}var tu=8192;function gl(s,a,c){if(s.subtreeFlags&tu)for(s=s.child;s!==null;)uv(s,a,c),s=s.sibling}function uv(s,a,c){switch(s.tag){case 26:gl(s,a,c),s.flags&tu&&s.memoizedState!==null&&T2(c,rs,s.memoizedState,s.memoizedProps);break;case 5:gl(s,a,c);break;case 3:case 4:var f=rs;rs=vh(s.stateNode.containerInfo),gl(s,a,c),rs=f;break;case 22:s.memoizedState===null&&(f=s.alternate,f!==null&&f.memoizedState!==null?(f=tu,tu=16777216,gl(s,a,c),tu=f):gl(s,a,c));break;default:gl(s,a,c)}}function dv(s){var a=s.alternate;if(a!==null&&(s=a.child,s!==null)){a.child=null;do a=s.sibling,s.sibling=null,s=a;while(s!==null)}}function nu(s){var a=s.deletions;if((s.flags&16)!==0){if(a!==null)for(var c=0;c<a.length;c++){var f=a[c];kn=f,fv(f,s)}dv(s)}if(s.subtreeFlags&10256)for(s=s.child;s!==null;)hv(s),s=s.sibling}function hv(s){switch(s.tag){case 0:case 11:case 15:nu(s),s.flags&2048&&Gi(9,s,s.return);break;case 3:nu(s);break;case 12:nu(s);break;case 22:var a=s.stateNode;s.memoizedState!==null&&a._visibility&2&&(s.return===null||s.return.tag!==13)?(a._visibility&=-3,oh(s)):nu(s);break;default:nu(s)}}function oh(s){var a=s.deletions;if((s.flags&16)!==0){if(a!==null)for(var c=0;c<a.length;c++){var f=a[c];kn=f,fv(f,s)}dv(s)}for(s=s.child;s!==null;){switch(a=s,a.tag){case 0:case 11:case 15:Gi(8,a,a.return),oh(a);break;case 22:c=a.stateNode,c._visibility&2&&(c._visibility&=-3,oh(a));break;default:oh(a)}s=s.sibling}}function fv(s,a){for(;kn!==null;){var c=kn;switch(c.tag){case 0:case 11:case 15:Gi(8,c,a);break;case 23:case 22:if(c.memoizedState!==null&&c.memoizedState.cachePool!==null){var f=c.memoizedState.cachePool.pool;f!=null&&f.refCount++}break;case 24:Lc(c.memoizedState.cache)}if(f=c.child,f!==null)f.return=c,kn=f;else e:for(c=s;kn!==null;){f=kn;var b=f.sibling,w=f.return;if(rv(f),f===c){kn=null;break e}if(b!==null){b.return=w,kn=b;break e}kn=w}}}var FA={getCacheForType:function(s){var a=zn(mn),c=a.data.get(s);return c===void 0&&(c=s(),a.data.set(s,c)),c},cacheSignal:function(){return zn(mn).controller.signal}},VA=typeof WeakMap=="function"?WeakMap:Map,At=0,Lt=null,ct=null,ht=0,kt=0,Cr=null,Qi=!1,yl=!1,Bp=!1,ci=0,nn=0,Wi=0,mo=0,Lp=0,Er=0,_l=0,ru=null,ur=null,Up=!1,lh=0,mv=0,ch=1/0,uh=null,Ki=null,Sn=0,Yi=null,bl=null,ui=0,Fp=0,Vp=null,pv=null,su=0,$p=null;function Tr(){return(At&2)!==0&&ht!==0?ht&-ht:W.T!==null?Kp():dd()}function gv(){if(Er===0)if((ht&536870912)===0||yt){var s=gs;gs<<=1,(gs&3932160)===0&&(gs=262144),Er=s}else Er=536870912;return s=wr.current,s!==null&&(s.flags|=32),Er}function dr(s,a,c){(s===Lt&&(kt===2||kt===9)||s.cancelPendingCommit!==null)&&(vl(s,0),Xi(s,ht,Er,!1)),Fa(s,c),((At&2)===0||s!==Lt)&&(s===Lt&&((At&2)===0&&(mo|=c),nn===4&&Xi(s,ht,Er,!1)),Ns(s))}function yv(s,a,c){if((At&6)!==0)throw Error(r(327));var f=!c&&(a&127)===0&&(a&s.expiredLanes)===0||Wr(s,a),b=f?HA(s,a):Hp(s,a,!0),w=f;do{if(b===0){yl&&!f&&Xi(s,a,0,!1);break}else{if(c=s.current.alternate,w&&!$A(c)){b=Hp(s,a,!1),w=!1;continue}if(b===2){if(w=a,s.errorRecoveryDisabledLanes&w)var z=0;else z=s.pendingLanes&-536870913,z=z!==0?z:z&536870912?536870912:0;if(z!==0){a=z;e:{var Q=s;b=ru;var re=Q.current.memoizedState.isDehydrated;if(re&&(vl(Q,z).flags|=256),z=Hp(Q,z,!1),z!==2){if(Bp&&!re){Q.errorRecoveryDisabledLanes|=w,mo|=w,b=4;break e}w=ur,ur=b,w!==null&&(ur===null?ur=w:ur.push.apply(ur,w))}b=z}if(w=!1,b!==2)continue}}if(b===1){vl(s,0),Xi(s,a,0,!0);break}e:{switch(f=s,w=b,w){case 0:case 1:throw Error(r(345));case 4:if((a&4194048)!==a)break;case 6:Xi(f,a,Er,!Qi);break e;case 2:ur=null;break;case 3:case 5:break;default:throw Error(r(329))}if((a&62914560)===a&&(b=lh+300-Me(),10<b)){if(Xi(f,a,Er,!Qi),ys(f,0,!0)!==0)break e;ui=a,f.timeoutHandle=Wv(_v.bind(null,f,c,ur,uh,Up,a,Er,mo,_l,Qi,w,"Throttled",-0,0),b);break e}_v(f,c,ur,uh,Up,a,Er,mo,_l,Qi,w,null,-0,0)}}break}while(!0);Ns(s)}function _v(s,a,c,f,b,w,z,Q,re,ge,Ee,Re,_e,we){if(s.timeoutHandle=-1,Re=a.subtreeFlags,Re&8192||(Re&16785408)===16785408){Re={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Xr},uv(a,w,Re);var Fe=(w&62914560)===w?lh-Me():(w&4194048)===w?mv-Me():0;if(Fe=A2(Re,Fe),Fe!==null){ui=w,s.cancelPendingCommit=Fe(Tv.bind(null,s,a,w,c,f,b,z,Q,re,Ee,Re,null,_e,we)),Xi(s,w,z,!ge);return}}Tv(s,a,w,c,f,b,z,Q,re)}function $A(s){for(var a=s;;){var c=a.tag;if((c===0||c===11||c===15)&&a.flags&16384&&(c=a.updateQueue,c!==null&&(c=c.stores,c!==null)))for(var f=0;f<c.length;f++){var b=c[f],w=b.getSnapshot;b=b.value;try{if(!vr(w(),b))return!1}catch{return!1}}if(c=a.child,a.subtreeFlags&16384&&c!==null)c.return=a,a=c;else{if(a===s)break;for(;a.sibling===null;){if(a.return===null||a.return===s)return!0;a=a.return}a.sibling.return=a.return,a=a.sibling}}return!0}function Xi(s,a,c,f){a&=~Lp,a&=~mo,s.suspendedLanes|=a,s.pingedLanes&=~a,f&&(s.warmLanes|=a),f=s.expirationTimes;for(var b=a;0<b;){var w=31-Et(b),z=1<<w;f[w]=-1,b&=~z}c!==0&&Va(s,c,a)}function dh(){return(At&6)===0?(iu(0),!1):!0}function qp(){if(ct!==null){if(kt===0)var s=ct.return;else s=ct,Js=so=null,ap(s),ul=null,Fc=0,s=ct;for(;s!==null;)Kb(s.alternate,s),s=s.return;ct=null}}function vl(s,a){var c=s.timeoutHandle;c!==-1&&(s.timeoutHandle=-1,c2(c)),c=s.cancelPendingCommit,c!==null&&(s.cancelPendingCommit=null,c()),ui=0,qp(),Lt=s,ct=c=Xs(s.current,null),ht=a,kt=0,Cr=null,Qi=!1,yl=Wr(s,a),Bp=!1,_l=Er=Lp=mo=Wi=nn=0,ur=ru=null,Up=!1,(a&8)!==0&&(a|=a&32);var f=s.entangledLanes;if(f!==0)for(s=s.entanglements,f&=a;0<f;){var b=31-Et(f),w=1<<b;a|=s[b],f&=~w}return ci=a,Dd(),c}function bv(s,a){st=null,W.H=Kc,a===cl||a===Ud?(a=N_(),kt=3):a===Wm?(a=N_(),kt=4):kt=a===wp?8:a!==null&&typeof a=="object"&&typeof a.then=="function"?6:1,Cr=a,ct===null&&(nn=1,eh(s,Pr(a,s.current)))}function vv(){var s=wr.current;return s===null?!0:(ht&4194048)===ht?Ur===null:(ht&62914560)===ht||(ht&536870912)!==0?s===Ur:!1}function xv(){var s=W.H;return W.H=Kc,s===null?Kc:s}function wv(){var s=W.A;return W.A=FA,s}function hh(){nn=4,Qi||(ht&4194048)!==ht&&wr.current!==null||(yl=!0),(Wi&134217727)===0&&(mo&134217727)===0||Lt===null||Xi(Lt,ht,Er,!1)}function Hp(s,a,c){var f=At;At|=2;var b=xv(),w=wv();(Lt!==s||ht!==a)&&(uh=null,vl(s,a)),a=!1;var z=nn;e:do try{if(kt!==0&&ct!==null){var Q=ct,re=Cr;switch(kt){case 8:qp(),z=6;break e;case 3:case 2:case 9:case 6:wr.current===null&&(a=!0);var ge=kt;if(kt=0,Cr=null,xl(s,Q,re,ge),c&&yl){z=0;break e}break;default:ge=kt,kt=0,Cr=null,xl(s,Q,re,ge)}}qA(),z=nn;break}catch(Ee){bv(s,Ee)}while(!0);return a&&s.shellSuspendCounter++,Js=so=null,At=f,W.H=b,W.A=w,ct===null&&(Lt=null,ht=0,Dd()),z}function qA(){for(;ct!==null;)Sv(ct)}function HA(s,a){var c=At;At|=2;var f=xv(),b=wv();Lt!==s||ht!==a?(uh=null,ch=Me()+500,vl(s,a)):yl=Wr(s,a);e:do try{if(kt!==0&&ct!==null){a=ct;var w=Cr;t:switch(kt){case 1:kt=0,Cr=null,xl(s,a,w,1);break;case 2:case 9:if(O_(w)){kt=0,Cr=null,Cv(a);break}a=function(){kt!==2&&kt!==9||Lt!==s||(kt=7),Ns(s)},w.then(a,a);break e;case 3:kt=7;break e;case 4:kt=5;break e;case 7:O_(w)?(kt=0,Cr=null,Cv(a)):(kt=0,Cr=null,xl(s,a,w,7));break;case 5:var z=null;switch(ct.tag){case 26:z=ct.memoizedState;case 5:case 27:var Q=ct;if(z?cx(z):Q.stateNode.complete){kt=0,Cr=null;var re=Q.sibling;if(re!==null)ct=re;else{var ge=Q.return;ge!==null?(ct=ge,fh(ge)):ct=null}break t}}kt=0,Cr=null,xl(s,a,w,5);break;case 6:kt=0,Cr=null,xl(s,a,w,6);break;case 8:qp(),nn=6;break e;default:throw Error(r(462))}}GA();break}catch(Ee){bv(s,Ee)}while(!0);return Js=so=null,W.H=f,W.A=b,At=c,ct!==null?0:(Lt=null,ht=0,Dd(),nn)}function GA(){for(;ct!==null&&!ae();)Sv(ct)}function Sv(s){var a=Qb(s.alternate,s,ci);s.memoizedProps=s.pendingProps,a===null?fh(s):ct=a}function Cv(s){var a=s,c=a.alternate;switch(a.tag){case 15:case 0:a=Fb(c,a,a.pendingProps,a.type,void 0,ht);break;case 11:a=Fb(c,a,a.pendingProps,a.type.render,a.ref,ht);break;case 5:ap(a);default:Kb(c,a),a=ct=w_(a,ci),a=Qb(c,a,ci)}s.memoizedProps=s.pendingProps,a===null?fh(s):ct=a}function xl(s,a,c,f){Js=so=null,ap(a),ul=null,Fc=0;var b=a.return;try{if(MA(s,b,a,c,ht)){nn=1,eh(s,Pr(c,s.current)),ct=null;return}}catch(w){if(b!==null)throw ct=b,w;nn=1,eh(s,Pr(c,s.current)),ct=null;return}a.flags&32768?(yt||f===1?s=!0:yl||(ht&536870912)!==0?s=!1:(Qi=s=!0,(f===2||f===9||f===3||f===6)&&(f=wr.current,f!==null&&f.tag===13&&(f.flags|=16384))),Ev(a,s)):fh(a)}function fh(s){var a=s;do{if((a.flags&32768)!==0){Ev(a,Qi);return}s=a.return;var c=zA(a.alternate,a,ci);if(c!==null){ct=c;return}if(a=a.sibling,a!==null){ct=a;return}ct=a=s}while(a!==null);nn===0&&(nn=5)}function Ev(s,a){do{var c=BA(s.alternate,s);if(c!==null){c.flags&=32767,ct=c;return}if(c=s.return,c!==null&&(c.flags|=32768,c.subtreeFlags=0,c.deletions=null),!a&&(s=s.sibling,s!==null)){ct=s;return}ct=s=c}while(s!==null);nn=6,ct=null}function Tv(s,a,c,f,b,w,z,Q,re){s.cancelPendingCommit=null;do mh();while(Sn!==0);if((At&6)!==0)throw Error(r(327));if(a!==null){if(a===s.current)throw Error(r(177));if(w=a.lanes|a.childLanes,w|=Om,Cm(s,c,w,z,Q,re),s===Lt&&(ct=Lt=null,ht=0),bl=a,Yi=s,ui=c,Fp=w,Vp=b,pv=f,(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?(s.callbackNode=null,s.callbackPriority=0,YA(nt,function(){return kv(),null})):(s.callbackNode=null,s.callbackPriority=0),f=(a.flags&13878)!==0,(a.subtreeFlags&13878)!==0||f){f=W.T,W.T=null,b=H.p,H.p=2,z=At,At|=4;try{LA(s,a,c)}finally{At=z,H.p=b,W.T=f}}Sn=1,Av(),jv(),Rv()}}function Av(){if(Sn===1){Sn=0;var s=Yi,a=bl,c=(a.flags&13878)!==0;if((a.subtreeFlags&13878)!==0||c){c=W.T,W.T=null;var f=H.p;H.p=2;var b=At;At|=4;try{ov(a,s);var w=rg,z=f_(s.containerInfo),Q=w.focusedElem,re=w.selectionRange;if(z!==Q&&Q&&Q.ownerDocument&&h_(Q.ownerDocument.documentElement,Q)){if(re!==null&&jm(Q)){var ge=re.start,Ee=re.end;if(Ee===void 0&&(Ee=ge),"selectionStart"in Q)Q.selectionStart=ge,Q.selectionEnd=Math.min(Ee,Q.value.length);else{var Re=Q.ownerDocument||document,_e=Re&&Re.defaultView||window;if(_e.getSelection){var we=_e.getSelection(),Fe=Q.textContent.length,We=Math.min(re.start,Fe),Pt=re.end===void 0?We:Math.min(re.end,Fe);!we.extend&&We>Pt&&(z=Pt,Pt=We,We=z);var de=d_(Q,We),le=d_(Q,Pt);if(de&&le&&(we.rangeCount!==1||we.anchorNode!==de.node||we.anchorOffset!==de.offset||we.focusNode!==le.node||we.focusOffset!==le.offset)){var pe=Re.createRange();pe.setStart(de.node,de.offset),we.removeAllRanges(),We>Pt?(we.addRange(pe),we.extend(le.node,le.offset)):(pe.setEnd(le.node,le.offset),we.addRange(pe))}}}}for(Re=[],we=Q;we=we.parentNode;)we.nodeType===1&&Re.push({element:we,left:we.scrollLeft,top:we.scrollTop});for(typeof Q.focus=="function"&&Q.focus(),Q=0;Q<Re.length;Q++){var Te=Re[Q];Te.element.scrollLeft=Te.left,Te.element.scrollTop=Te.top}}Th=!!ng,rg=ng=null}finally{At=b,H.p=f,W.T=c}}s.current=a,Sn=2}}function jv(){if(Sn===2){Sn=0;var s=Yi,a=bl,c=(a.flags&8772)!==0;if((a.subtreeFlags&8772)!==0||c){c=W.T,W.T=null;var f=H.p;H.p=2;var b=At;At|=4;try{nv(s,a.alternate,a)}finally{At=b,H.p=f,W.T=c}}Sn=3}}function Rv(){if(Sn===4||Sn===3){Sn=0,Ae();var s=Yi,a=bl,c=ui,f=pv;(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?Sn=5:(Sn=0,bl=Yi=null,Iv(s,s.pendingLanes));var b=s.pendingLanes;if(b===0&&(Ki=null),Qs(c),a=a.stateNode,en&&typeof en.onCommitFiberRoot=="function")try{en.onCommitFiberRoot(vt,a,void 0,(a.current.flags&128)===128)}catch{}if(f!==null){a=W.T,b=H.p,H.p=2,W.T=null;try{for(var w=s.onRecoverableError,z=0;z<f.length;z++){var Q=f[z];w(Q.value,{componentStack:Q.stack})}}finally{W.T=a,H.p=b}}(ui&3)!==0&&mh(),Ns(s),b=s.pendingLanes,(c&261930)!==0&&(b&42)!==0?s===$p?su++:(su=0,$p=s):su=0,iu(0)}}function Iv(s,a){(s.pooledCacheLanes&=a)===0&&(a=s.pooledCache,a!=null&&(s.pooledCache=null,Lc(a)))}function mh(){return Av(),jv(),Rv(),kv()}function kv(){if(Sn!==5)return!1;var s=Yi,a=Fp;Fp=0;var c=Qs(ui),f=W.T,b=H.p;try{H.p=32>c?32:c,W.T=null,c=Vp,Vp=null;var w=Yi,z=ui;if(Sn=0,bl=Yi=null,ui=0,(At&6)!==0)throw Error(r(331));var Q=At;if(At|=4,hv(w.current),cv(w,w.current,z,c),At=Q,iu(0,!1),en&&typeof en.onPostCommitFiberRoot=="function")try{en.onPostCommitFiberRoot(vt,w)}catch{}return!0}finally{H.p=b,W.T=f,Iv(s,a)}}function Dv(s,a,c){a=Pr(c,a),a=xp(s.stateNode,a,2),s=$i(s,a,2),s!==null&&(Fa(s,2),Ns(s))}function Dt(s,a,c){if(s.tag===3)Dv(s,s,c);else for(;a!==null;){if(a.tag===3){Dv(a,s,c);break}else if(a.tag===1){var f=a.stateNode;if(typeof a.type.getDerivedStateFromError=="function"||typeof f.componentDidCatch=="function"&&(Ki===null||!Ki.has(f))){s=Pr(c,s),c=Ob(2),f=$i(a,c,2),f!==null&&(Mb(c,f,a,s),Fa(f,2),Ns(f));break}}a=a.return}}function Gp(s,a,c){var f=s.pingCache;if(f===null){f=s.pingCache=new VA;var b=new Set;f.set(a,b)}else b=f.get(a),b===void 0&&(b=new Set,f.set(a,b));b.has(c)||(Bp=!0,b.add(c),s=QA.bind(null,s,a,c),a.then(s,s))}function QA(s,a,c){var f=s.pingCache;f!==null&&f.delete(a),s.pingedLanes|=s.suspendedLanes&c,s.warmLanes&=~c,Lt===s&&(ht&c)===c&&(nn===4||nn===3&&(ht&62914560)===ht&&300>Me()-lh?(At&2)===0&&vl(s,0):Lp|=c,_l===ht&&(_l=0)),Ns(s)}function Ov(s,a){a===0&&(a=ud()),s=to(s,a),s!==null&&(Fa(s,a),Ns(s))}function WA(s){var a=s.memoizedState,c=0;a!==null&&(c=a.retryLane),Ov(s,c)}function KA(s,a){var c=0;switch(s.tag){case 31:case 13:var f=s.stateNode,b=s.memoizedState;b!==null&&(c=b.retryLane);break;case 19:f=s.stateNode;break;case 22:f=s.stateNode._retryCache;break;default:throw Error(r(314))}f!==null&&f.delete(a),Ov(s,c)}function YA(s,a){return Ce(s,a)}var ph=null,wl=null,Qp=!1,gh=!1,Wp=!1,Zi=0;function Ns(s){s!==wl&&s.next===null&&(wl===null?ph=wl=s:wl=wl.next=s),gh=!0,Qp||(Qp=!0,ZA())}function iu(s,a){if(!Wp&&gh){Wp=!0;do for(var c=!1,f=ph;f!==null;){if(s!==0){var b=f.pendingLanes;if(b===0)var w=0;else{var z=f.suspendedLanes,Q=f.pingedLanes;w=(1<<31-Et(42|s)+1)-1,w&=b&~(z&~Q),w=w&201326741?w&201326741|1:w?w|2:0}w!==0&&(c=!0,zv(f,w))}else w=ht,w=ys(f,f===Lt?w:0,f.cancelPendingCommit!==null||f.timeoutHandle!==-1),(w&3)===0||Wr(f,w)||(c=!0,zv(f,w));f=f.next}while(c);Wp=!1}}function XA(){Mv()}function Mv(){gh=Qp=!1;var s=0;Zi!==0&&l2()&&(s=Zi);for(var a=Me(),c=null,f=ph;f!==null;){var b=f.next,w=Nv(f,a);w===0?(f.next=null,c===null?ph=b:c.next=b,b===null&&(wl=c)):(c=f,(s!==0||(w&3)!==0)&&(gh=!0)),f=b}Sn!==0&&Sn!==5||iu(s),Zi!==0&&(Zi=0)}function Nv(s,a){for(var c=s.suspendedLanes,f=s.pingedLanes,b=s.expirationTimes,w=s.pendingLanes&-62914561;0<w;){var z=31-Et(w),Q=1<<z,re=b[z];re===-1?((Q&c)===0||(Q&f)!==0)&&(b[z]=Sm(Q,a)):re<=a&&(s.expiredLanes|=Q),w&=~Q}if(a=Lt,c=ht,c=ys(s,s===a?c:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),f=s.callbackNode,c===0||s===a&&(kt===2||kt===9)||s.cancelPendingCommit!==null)return f!==null&&f!==null&&Se(f),s.callbackNode=null,s.callbackPriority=0;if((c&3)===0||Wr(s,c)){if(a=c&-c,a===s.callbackPriority)return a;switch(f!==null&&Se(f),Qs(c)){case 2:case 8:c=wt;break;case 32:c=nt;break;case 268435456:c=ms;break;default:c=nt}return f=Pv.bind(null,s),c=Ce(c,f),s.callbackPriority=a,s.callbackNode=c,a}return f!==null&&f!==null&&Se(f),s.callbackPriority=2,s.callbackNode=null,2}function Pv(s,a){if(Sn!==0&&Sn!==5)return s.callbackNode=null,s.callbackPriority=0,null;var c=s.callbackNode;if(mh()&&s.callbackNode!==c)return null;var f=ht;return f=ys(s,s===Lt?f:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),f===0?null:(yv(s,f,a),Nv(s,Me()),s.callbackNode!=null&&s.callbackNode===c?Pv.bind(null,s):null)}function zv(s,a){if(mh())return null;yv(s,a,!0)}function ZA(){u2(function(){(At&6)!==0?Ce(He,XA):Mv()})}function Kp(){if(Zi===0){var s=ol;s===0&&(s=Ir,Ir<<=1,(Ir&261888)===0&&(Ir=256)),Zi=s}return Zi}function Bv(s){return s==null||typeof s=="symbol"||typeof s=="boolean"?null:typeof s=="function"?s:Go(""+s)}function Lv(s,a){var c=a.ownerDocument.createElement("input");return c.name=a.name,c.value=a.value,s.id&&c.setAttribute("form",s.id),a.parentNode.insertBefore(c,a),s=new FormData(s),c.parentNode.removeChild(c),s}function JA(s,a,c,f,b){if(a==="submit"&&c&&c.stateNode===b){var w=Bv((b[Rn]||null).action),z=f.submitter;z&&(a=(a=z[Rn]||null)?Bv(a.formAction):z.getAttribute("formAction"),a!==null&&(w=a,z=null));var Q=new js("action","action",null,f,b);s.push({event:Q,listeners:[{instance:null,listener:function(){if(f.defaultPrevented){if(Zi!==0){var re=z?Lv(b,z):new FormData(b);pp(c,{pending:!0,data:re,method:b.method,action:w},null,re)}}else typeof w=="function"&&(Q.preventDefault(),re=z?Lv(b,z):new FormData(b),pp(c,{pending:!0,data:re,method:b.method,action:w},w,re))},currentTarget:b}]})}}for(var Yp=0;Yp<Dm.length;Yp++){var Xp=Dm[Yp],e2=Xp.toLowerCase(),t2=Xp[0].toUpperCase()+Xp.slice(1);ns(e2,"on"+t2)}ns(g_,"onAnimationEnd"),ns(y_,"onAnimationIteration"),ns(__,"onAnimationStart"),ns("dblclick","onDoubleClick"),ns("focusin","onFocus"),ns("focusout","onBlur"),ns(yA,"onTransitionRun"),ns(_A,"onTransitionStart"),ns(bA,"onTransitionCancel"),ns(b_,"onTransitionEnd"),Cs("onMouseEnter",["mouseout","mouseover"]),Cs("onMouseLeave",["mouseout","mouseover"]),Cs("onPointerEnter",["pointerout","pointerover"]),Cs("onPointerLeave",["pointerout","pointerover"]),Ss("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Ss("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Ss("onBeforeInput",["compositionend","keypress","textInput","paste"]),Ss("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Ss("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Ss("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var au="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),n2=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(au));function Uv(s,a){a=(a&4)!==0;for(var c=0;c<s.length;c++){var f=s[c],b=f.event;f=f.listeners;e:{var w=void 0;if(a)for(var z=f.length-1;0<=z;z--){var Q=f[z],re=Q.instance,ge=Q.currentTarget;if(Q=Q.listener,re!==w&&b.isPropagationStopped())break e;w=Q,b.currentTarget=ge;try{w(b)}catch(Ee){kd(Ee)}b.currentTarget=null,w=re}else for(z=0;z<f.length;z++){if(Q=f[z],re=Q.instance,ge=Q.currentTarget,Q=Q.listener,re!==w&&b.isPropagationStopped())break e;w=Q,b.currentTarget=ge;try{w(b)}catch(Ee){kd(Ee)}b.currentTarget=null,w=re}}}}function ut(s,a){var c=a[Fo];c===void 0&&(c=a[Fo]=new Set);var f=s+"__bubble";c.has(f)||(Fv(a,s,2,!1),c.add(f))}function Zp(s,a,c){var f=0;a&&(f|=4),Fv(c,s,f,a)}var yh="_reactListening"+Math.random().toString(36).slice(2);function Jp(s){if(!s[yh]){s[yh]=!0,_c.forEach(function(c){c!=="selectionchange"&&(n2.has(c)||Zp(c,!1,s),Zp(c,!0,s))});var a=s.nodeType===9?s:s.ownerDocument;a===null||a[yh]||(a[yh]=!0,Zp("selectionchange",!1,a))}}function Fv(s,a,c,f){switch(gx(a)){case 2:var b=I2;break;case 8:b=k2;break;default:b=mg}c=b.bind(null,a,c,s),b=void 0,!Qa||a!=="touchstart"&&a!=="touchmove"&&a!=="wheel"||(b=!0),f?b!==void 0?s.addEventListener(a,c,{capture:!0,passive:b}):s.addEventListener(a,c,!0):b!==void 0?s.addEventListener(a,c,{passive:b}):s.addEventListener(a,c,!1)}function eg(s,a,c,f,b){var w=f;if((a&1)===0&&(a&2)===0&&f!==null)e:for(;;){if(f===null)return;var z=f.tag;if(z===3||z===4){var Q=f.stateNode.containerInfo;if(Q===b)break;if(z===4)for(z=f.return;z!==null;){var re=z.tag;if((re===3||re===4)&&z.stateNode.containerInfo===b)return;z=z.return}for(;Q!==null;){if(z=xs(Q),z===null)return;if(re=z.tag,re===5||re===6||re===26||re===27){f=w=z;continue e}Q=Q.parentNode}}f=f.return}Oi(function(){var ge=w,Ee=Dr(c),Re=[];e:{var _e=v_.get(s);if(_e!==void 0){var we=js,Fe=s;switch(s){case"keypress":if(Ka(c)===0)break e;case"keydown":case"keyup":we=jd;break;case"focusin":Fe="focus",we=Xa;break;case"focusout":Fe="blur",we=Xa;break;case"beforeblur":case"afterblur":we=Xa;break;case"click":if(c.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":we=kc;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":we=bd;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":we=R;break;case g_:case y_:case __:we=xd;break;case b_:we=K;break;case"scroll":case"scrollend":we=Ic;break;case"wheel":we=xe;break;case"copy":case"cut":case"paste":we=wd;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":we=Ys;break;case"toggle":case"beforetoggle":we=rt}var We=(a&4)!==0,Pt=!We&&(s==="scroll"||s==="scrollend"),de=We?_e!==null?_e+"Capture":null:_e;We=[];for(var le=ge,pe;le!==null;){var Te=le;if(pe=Te.stateNode,Te=Te.tag,Te!==5&&Te!==26&&Te!==27||pe===null||de===null||(Te=Zr(le,de),Te!=null&&We.push(ou(le,Te,pe))),Pt)break;le=le.return}0<We.length&&(_e=new we(_e,Fe,null,c,Ee),Re.push({event:_e,listeners:We}))}}if((a&7)===0){e:{if(_e=s==="mouseover"||s==="pointerover",we=s==="mouseout"||s==="pointerout",_e&&c!==Ac&&(Fe=c.relatedTarget||c.fromElement)&&(xs(Fe)||Fe[bs]))break e;if((we||_e)&&(_e=Ee.window===Ee?Ee:(_e=Ee.ownerDocument)?_e.defaultView||_e.parentWindow:window,we?(Fe=c.relatedTarget||c.toElement,we=ge,Fe=Fe?xs(Fe):null,Fe!==null&&(Pt=o(Fe),We=Fe.tag,Fe!==Pt||We!==5&&We!==27&&We!==6)&&(Fe=null)):(we=null,Fe=ge),we!==Fe)){if(We=kc,Te="onMouseLeave",de="onMouseEnter",le="mouse",(s==="pointerout"||s==="pointerover")&&(We=Ys,Te="onPointerLeave",de="onPointerEnter",le="pointer"),Pt=we==null?_e:_r(we),pe=Fe==null?_e:_r(Fe),_e=new We(Te,le+"leave",we,c,Ee),_e.target=Pt,_e.relatedTarget=pe,Te=null,xs(Ee)===ge&&(We=new We(de,le+"enter",Fe,c,Ee),We.target=pe,We.relatedTarget=Pt,Te=We),Pt=Te,we&&Fe)t:{for(We=r2,de=we,le=Fe,pe=0,Te=de;Te;Te=We(Te))pe++;Te=0;for(var Ge=le;Ge;Ge=We(Ge))Te++;for(;0<pe-Te;)de=We(de),pe--;for(;0<Te-pe;)le=We(le),Te--;for(;pe--;){if(de===le||le!==null&&de===le.alternate){We=de;break t}de=We(de),le=We(le)}We=null}else We=null;we!==null&&Vv(Re,_e,we,We,!1),Fe!==null&&Pt!==null&&Vv(Re,Pt,Fe,We,!0)}}e:{if(_e=ge?_r(ge):window,we=_e.nodeName&&_e.nodeName.toLowerCase(),we==="select"||we==="input"&&_e.type==="file")var St=i_;else if(r_(_e))if(a_)St=mA;else{St=hA;var $e=dA}else we=_e.nodeName,!we||we.toLowerCase()!=="input"||_e.type!=="checkbox"&&_e.type!=="radio"?ge&&Ho(ge.elementType)&&(St=i_):St=fA;if(St&&(St=St(s,ge))){s_(Re,St,c,Ee);break e}$e&&$e(s,_e,ge),s==="focusout"&&ge&&_e.type==="number"&&ge.memoizedProps.value!=null&&Cc(_e,"number",_e.value)}switch($e=ge?_r(ge):window,s){case"focusin":(r_($e)||$e.contentEditable==="true")&&(Jo=$e,Rm=ge,Pc=null);break;case"focusout":Pc=Rm=Jo=null;break;case"mousedown":Im=!0;break;case"contextmenu":case"mouseup":case"dragend":Im=!1,m_(Re,c,Ee);break;case"selectionchange":if(gA)break;case"keydown":case"keyup":m_(Re,c,Ee)}var it;if(Tt)e:{switch(s){case"compositionstart":var ft="onCompositionStart";break e;case"compositionend":ft="onCompositionEnd";break e;case"compositionupdate":ft="onCompositionUpdate";break e}ft=void 0}else Zo?Za(s,c)&&(ft="onCompositionEnd"):s==="keydown"&&c.keyCode===229&&(ft="onCompositionStart");ft&&(ks&&c.locale!=="ko"&&(Zo||ft!=="onCompositionStart"?ft==="onCompositionEnd"&&Zo&&(it=Rc()):(As=Ee,jc="value"in As?As.value:As.textContent,Zo=!0)),$e=_h(ge,ft),0<$e.length&&(ft=new Is(ft,s,null,c,Ee),Re.push({event:ft,listeners:$e}),it?ft.data=it:(it=Xo(c),it!==null&&(ft.data=it)))),(it=Mr?oA(s,c):lA(s,c))&&(ft=_h(ge,"onBeforeInput"),0<ft.length&&($e=new Is("onBeforeInput","beforeinput",null,c,Ee),Re.push({event:$e,listeners:ft}),$e.data=it)),JA(Re,s,ge,c,Ee)}Uv(Re,a)})}function ou(s,a,c){return{instance:s,listener:a,currentTarget:c}}function _h(s,a){for(var c=a+"Capture",f=[];s!==null;){var b=s,w=b.stateNode;if(b=b.tag,b!==5&&b!==26&&b!==27||w===null||(b=Zr(s,c),b!=null&&f.unshift(ou(s,b,w)),b=Zr(s,a),b!=null&&f.push(ou(s,b,w))),s.tag===3)return f;s=s.return}return[]}function r2(s){if(s===null)return null;do s=s.return;while(s&&s.tag!==5&&s.tag!==27);return s||null}function Vv(s,a,c,f,b){for(var w=a._reactName,z=[];c!==null&&c!==f;){var Q=c,re=Q.alternate,ge=Q.stateNode;if(Q=Q.tag,re!==null&&re===f)break;Q!==5&&Q!==26&&Q!==27||ge===null||(re=ge,b?(ge=Zr(c,w),ge!=null&&z.unshift(ou(c,ge,re))):b||(ge=Zr(c,w),ge!=null&&z.push(ou(c,ge,re)))),c=c.return}z.length!==0&&s.push({event:a,listeners:z})}var s2=/\r\n?/g,i2=/\u0000|\uFFFD/g;function $v(s){return(typeof s=="string"?s:""+s).replace(s2,`
`).replace(i2,"")}function qv(s,a){return a=$v(a),$v(s)===a}function Nt(s,a,c,f,b,w){switch(c){case"children":typeof f=="string"?a==="body"||a==="textarea"&&f===""||ar(s,f):(typeof f=="number"||typeof f=="bigint")&&a!=="body"&&ar(s,""+f);break;case"className":br(s,"class",f);break;case"tabIndex":br(s,"tabindex",f);break;case"dir":case"role":case"viewBox":case"width":case"height":br(s,c,f);break;case"style":Tc(s,f,w);break;case"data":if(a!=="object"){br(s,"data",f);break}case"src":case"href":if(f===""&&(a!=="a"||c!=="href")){s.removeAttribute(c);break}if(f==null||typeof f=="function"||typeof f=="symbol"||typeof f=="boolean"){s.removeAttribute(c);break}f=Go(""+f),s.setAttribute(c,f);break;case"action":case"formAction":if(typeof f=="function"){s.setAttribute(c,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof w=="function"&&(c==="formAction"?(a!=="input"&&Nt(s,a,"name",b.name,b,null),Nt(s,a,"formEncType",b.formEncType,b,null),Nt(s,a,"formMethod",b.formMethod,b,null),Nt(s,a,"formTarget",b.formTarget,b,null)):(Nt(s,a,"encType",b.encType,b,null),Nt(s,a,"method",b.method,b,null),Nt(s,a,"target",b.target,b,null)));if(f==null||typeof f=="symbol"||typeof f=="boolean"){s.removeAttribute(c);break}f=Go(""+f),s.setAttribute(c,f);break;case"onClick":f!=null&&(s.onclick=Xr);break;case"onScroll":f!=null&&ut("scroll",s);break;case"onScrollEnd":f!=null&&ut("scrollend",s);break;case"dangerouslySetInnerHTML":if(f!=null){if(typeof f!="object"||!("__html"in f))throw Error(r(61));if(c=f.__html,c!=null){if(b.children!=null)throw Error(r(60));s.innerHTML=c}}break;case"multiple":s.multiple=f&&typeof f!="function"&&typeof f!="symbol";break;case"muted":s.muted=f&&typeof f!="function"&&typeof f!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(f==null||typeof f=="function"||typeof f=="boolean"||typeof f=="symbol"){s.removeAttribute("xlink:href");break}c=Go(""+f),s.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",c);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":f!=null&&typeof f!="function"&&typeof f!="symbol"?s.setAttribute(c,""+f):s.removeAttribute(c);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":f&&typeof f!="function"&&typeof f!="symbol"?s.setAttribute(c,""):s.removeAttribute(c);break;case"capture":case"download":f===!0?s.setAttribute(c,""):f!==!1&&f!=null&&typeof f!="function"&&typeof f!="symbol"?s.setAttribute(c,f):s.removeAttribute(c);break;case"cols":case"rows":case"size":case"span":f!=null&&typeof f!="function"&&typeof f!="symbol"&&!isNaN(f)&&1<=f?s.setAttribute(c,f):s.removeAttribute(c);break;case"rowSpan":case"start":f==null||typeof f=="function"||typeof f=="symbol"||isNaN(f)?s.removeAttribute(c):s.setAttribute(c,f);break;case"popover":ut("beforetoggle",s),ut("toggle",s),$o(s,"popover",f);break;case"xlinkActuate":fn(s,"http://www.w3.org/1999/xlink","xlink:actuate",f);break;case"xlinkArcrole":fn(s,"http://www.w3.org/1999/xlink","xlink:arcrole",f);break;case"xlinkRole":fn(s,"http://www.w3.org/1999/xlink","xlink:role",f);break;case"xlinkShow":fn(s,"http://www.w3.org/1999/xlink","xlink:show",f);break;case"xlinkTitle":fn(s,"http://www.w3.org/1999/xlink","xlink:title",f);break;case"xlinkType":fn(s,"http://www.w3.org/1999/xlink","xlink:type",f);break;case"xmlBase":fn(s,"http://www.w3.org/XML/1998/namespace","xml:base",f);break;case"xmlLang":fn(s,"http://www.w3.org/XML/1998/namespace","xml:lang",f);break;case"xmlSpace":fn(s,"http://www.w3.org/XML/1998/namespace","xml:space",f);break;case"is":$o(s,"is",f);break;case"innerText":case"textContent":break;default:(!(2<c.length)||c[0]!=="o"&&c[0]!=="O"||c[1]!=="n"&&c[1]!=="N")&&(c=_d.get(c)||c,$o(s,c,f))}}function tg(s,a,c,f,b,w){switch(c){case"style":Tc(s,f,w);break;case"dangerouslySetInnerHTML":if(f!=null){if(typeof f!="object"||!("__html"in f))throw Error(r(61));if(c=f.__html,c!=null){if(b.children!=null)throw Error(r(60));s.innerHTML=c}}break;case"children":typeof f=="string"?ar(s,f):(typeof f=="number"||typeof f=="bigint")&&ar(s,""+f);break;case"onScroll":f!=null&&ut("scroll",s);break;case"onScrollEnd":f!=null&&ut("scrollend",s);break;case"onClick":f!=null&&(s.onclick=Xr);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!bc.hasOwnProperty(c))e:{if(c[0]==="o"&&c[1]==="n"&&(b=c.endsWith("Capture"),a=c.slice(2,b?c.length-7:void 0),w=s[Rn]||null,w=w!=null?w[c]:null,typeof w=="function"&&s.removeEventListener(a,w,b),typeof f=="function")){typeof w!="function"&&w!==null&&(c in s?s[c]=null:s.hasAttribute(c)&&s.removeAttribute(c)),s.addEventListener(a,f,b);break e}c in s?s[c]=f:f===!0?s.setAttribute(c,""):$o(s,c,f)}}}function Ln(s,a,c){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":ut("error",s),ut("load",s);var f=!1,b=!1,w;for(w in c)if(c.hasOwnProperty(w)){var z=c[w];if(z!=null)switch(w){case"src":f=!0;break;case"srcSet":b=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(r(137,a));default:Nt(s,a,w,z,c,null)}}b&&Nt(s,a,"srcSet",c.srcSet,c,null),f&&Nt(s,a,"src",c.src,c,null);return;case"input":ut("invalid",s);var Q=w=z=b=null,re=null,ge=null;for(f in c)if(c.hasOwnProperty(f)){var Ee=c[f];if(Ee!=null)switch(f){case"name":b=Ee;break;case"type":z=Ee;break;case"checked":re=Ee;break;case"defaultChecked":ge=Ee;break;case"value":w=Ee;break;case"defaultValue":Q=Ee;break;case"children":case"dangerouslySetInnerHTML":if(Ee!=null)throw Error(r(137,a));break;default:Nt(s,a,f,Ee,c,null)}}pd(s,w,Q,re,ge,z,b,!1);return;case"select":ut("invalid",s),f=z=w=null;for(b in c)if(c.hasOwnProperty(b)&&(Q=c[b],Q!=null))switch(b){case"value":w=Q;break;case"defaultValue":z=Q;break;case"multiple":f=Q;default:Nt(s,a,b,Q,c,null)}a=w,c=z,s.multiple=!!f,a!=null?Ri(s,!!f,a,!1):c!=null&&Ri(s,!!f,c,!0);return;case"textarea":ut("invalid",s),w=b=f=null;for(z in c)if(c.hasOwnProperty(z)&&(Q=c[z],Q!=null))switch(z){case"value":f=Q;break;case"defaultValue":b=Q;break;case"children":w=Q;break;case"dangerouslySetInnerHTML":if(Q!=null)throw Error(r(91));break;default:Nt(s,a,z,Q,c,null)}Ii(s,f,b,w);return;case"option":for(re in c)c.hasOwnProperty(re)&&(f=c[re],f!=null)&&(re==="selected"?s.selected=f&&typeof f!="function"&&typeof f!="symbol":Nt(s,a,re,f,c,null));return;case"dialog":ut("beforetoggle",s),ut("toggle",s),ut("cancel",s),ut("close",s);break;case"iframe":case"object":ut("load",s);break;case"video":case"audio":for(f=0;f<au.length;f++)ut(au[f],s);break;case"image":ut("error",s),ut("load",s);break;case"details":ut("toggle",s);break;case"embed":case"source":case"link":ut("error",s),ut("load",s);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(ge in c)if(c.hasOwnProperty(ge)&&(f=c[ge],f!=null))switch(ge){case"children":case"dangerouslySetInnerHTML":throw Error(r(137,a));default:Nt(s,a,ge,f,c,null)}return;default:if(Ho(a)){for(Ee in c)c.hasOwnProperty(Ee)&&(f=c[Ee],f!==void 0&&tg(s,a,Ee,f,c,void 0));return}}for(Q in c)c.hasOwnProperty(Q)&&(f=c[Q],f!=null&&Nt(s,a,Q,f,c,null))}function a2(s,a,c,f){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var b=null,w=null,z=null,Q=null,re=null,ge=null,Ee=null;for(we in c){var Re=c[we];if(c.hasOwnProperty(we)&&Re!=null)switch(we){case"checked":break;case"value":break;case"defaultValue":re=Re;default:f.hasOwnProperty(we)||Nt(s,a,we,null,f,Re)}}for(var _e in f){var we=f[_e];if(Re=c[_e],f.hasOwnProperty(_e)&&(we!=null||Re!=null))switch(_e){case"type":w=we;break;case"name":b=we;break;case"checked":ge=we;break;case"defaultChecked":Ee=we;break;case"value":z=we;break;case"defaultValue":Q=we;break;case"children":case"dangerouslySetInnerHTML":if(we!=null)throw Error(r(137,a));break;default:we!==Re&&Nt(s,a,_e,we,f,Re)}}qo(s,z,Q,re,ge,Ee,w,b);return;case"select":we=z=Q=_e=null;for(w in c)if(re=c[w],c.hasOwnProperty(w)&&re!=null)switch(w){case"value":break;case"multiple":we=re;default:f.hasOwnProperty(w)||Nt(s,a,w,null,f,re)}for(b in f)if(w=f[b],re=c[b],f.hasOwnProperty(b)&&(w!=null||re!=null))switch(b){case"value":_e=w;break;case"defaultValue":Q=w;break;case"multiple":z=w;default:w!==re&&Nt(s,a,b,w,f,re)}a=Q,c=z,f=we,_e!=null?Ri(s,!!c,_e,!1):!!f!=!!c&&(a!=null?Ri(s,!!c,a,!0):Ri(s,!!c,c?[]:"",!1));return;case"textarea":we=_e=null;for(Q in c)if(b=c[Q],c.hasOwnProperty(Q)&&b!=null&&!f.hasOwnProperty(Q))switch(Q){case"value":break;case"children":break;default:Nt(s,a,Q,null,f,b)}for(z in f)if(b=f[z],w=c[z],f.hasOwnProperty(z)&&(b!=null||w!=null))switch(z){case"value":_e=b;break;case"defaultValue":we=b;break;case"children":break;case"dangerouslySetInnerHTML":if(b!=null)throw Error(r(91));break;default:b!==w&&Nt(s,a,z,b,f,w)}gd(s,_e,we);return;case"option":for(var Fe in c)_e=c[Fe],c.hasOwnProperty(Fe)&&_e!=null&&!f.hasOwnProperty(Fe)&&(Fe==="selected"?s.selected=!1:Nt(s,a,Fe,null,f,_e));for(re in f)_e=f[re],we=c[re],f.hasOwnProperty(re)&&_e!==we&&(_e!=null||we!=null)&&(re==="selected"?s.selected=_e&&typeof _e!="function"&&typeof _e!="symbol":Nt(s,a,re,_e,f,we));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var We in c)_e=c[We],c.hasOwnProperty(We)&&_e!=null&&!f.hasOwnProperty(We)&&Nt(s,a,We,null,f,_e);for(ge in f)if(_e=f[ge],we=c[ge],f.hasOwnProperty(ge)&&_e!==we&&(_e!=null||we!=null))switch(ge){case"children":case"dangerouslySetInnerHTML":if(_e!=null)throw Error(r(137,a));break;default:Nt(s,a,ge,_e,f,we)}return;default:if(Ho(a)){for(var Pt in c)_e=c[Pt],c.hasOwnProperty(Pt)&&_e!==void 0&&!f.hasOwnProperty(Pt)&&tg(s,a,Pt,void 0,f,_e);for(Ee in f)_e=f[Ee],we=c[Ee],!f.hasOwnProperty(Ee)||_e===we||_e===void 0&&we===void 0||tg(s,a,Ee,_e,f,we);return}}for(var de in c)_e=c[de],c.hasOwnProperty(de)&&_e!=null&&!f.hasOwnProperty(de)&&Nt(s,a,de,null,f,_e);for(Re in f)_e=f[Re],we=c[Re],!f.hasOwnProperty(Re)||_e===we||_e==null&&we==null||Nt(s,a,Re,_e,f,we)}function Hv(s){switch(s){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function o2(){if(typeof performance.getEntriesByType=="function"){for(var s=0,a=0,c=performance.getEntriesByType("resource"),f=0;f<c.length;f++){var b=c[f],w=b.transferSize,z=b.initiatorType,Q=b.duration;if(w&&Q&&Hv(z)){for(z=0,Q=b.responseEnd,f+=1;f<c.length;f++){var re=c[f],ge=re.startTime;if(ge>Q)break;var Ee=re.transferSize,Re=re.initiatorType;Ee&&Hv(Re)&&(re=re.responseEnd,z+=Ee*(re<Q?1:(Q-ge)/(re-ge)))}if(--f,a+=8*(w+z)/(b.duration/1e3),s++,10<s)break}}if(0<s)return a/s/1e6}return navigator.connection&&(s=navigator.connection.downlink,typeof s=="number")?s:5}var ng=null,rg=null;function bh(s){return s.nodeType===9?s:s.ownerDocument}function Gv(s){switch(s){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Qv(s,a){if(s===0)switch(a){case"svg":return 1;case"math":return 2;default:return 0}return s===1&&a==="foreignObject"?0:s}function sg(s,a){return s==="textarea"||s==="noscript"||typeof a.children=="string"||typeof a.children=="number"||typeof a.children=="bigint"||typeof a.dangerouslySetInnerHTML=="object"&&a.dangerouslySetInnerHTML!==null&&a.dangerouslySetInnerHTML.__html!=null}var ig=null;function l2(){var s=window.event;return s&&s.type==="popstate"?s===ig?!1:(ig=s,!0):(ig=null,!1)}var Wv=typeof setTimeout=="function"?setTimeout:void 0,c2=typeof clearTimeout=="function"?clearTimeout:void 0,Kv=typeof Promise=="function"?Promise:void 0,u2=typeof queueMicrotask=="function"?queueMicrotask:typeof Kv<"u"?function(s){return Kv.resolve(null).then(s).catch(d2)}:Wv;function d2(s){setTimeout(function(){throw s})}function Ji(s){return s==="head"}function Yv(s,a){var c=a,f=0;do{var b=c.nextSibling;if(s.removeChild(c),b&&b.nodeType===8)if(c=b.data,c==="/$"||c==="/&"){if(f===0){s.removeChild(b),Tl(a);return}f--}else if(c==="$"||c==="$?"||c==="$~"||c==="$!"||c==="&")f++;else if(c==="html")lu(s.ownerDocument.documentElement);else if(c==="head"){c=s.ownerDocument.head,lu(c);for(var w=c.firstChild;w;){var z=w.nextSibling,Q=w.nodeName;w[vs]||Q==="SCRIPT"||Q==="STYLE"||Q==="LINK"&&w.rel.toLowerCase()==="stylesheet"||c.removeChild(w),w=z}}else c==="body"&&lu(s.ownerDocument.body);c=b}while(c);Tl(a)}function Xv(s,a){var c=s;s=0;do{var f=c.nextSibling;if(c.nodeType===1?a?(c._stashedDisplay=c.style.display,c.style.display="none"):(c.style.display=c._stashedDisplay||"",c.getAttribute("style")===""&&c.removeAttribute("style")):c.nodeType===3&&(a?(c._stashedText=c.nodeValue,c.nodeValue=""):c.nodeValue=c._stashedText||""),f&&f.nodeType===8)if(c=f.data,c==="/$"){if(s===0)break;s--}else c!=="$"&&c!=="$?"&&c!=="$~"&&c!=="$!"||s++;c=f}while(c)}function ag(s){var a=s.firstChild;for(a&&a.nodeType===10&&(a=a.nextSibling);a;){var c=a;switch(a=a.nextSibling,c.nodeName){case"HTML":case"HEAD":case"BODY":ag(c),Vo(c);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(c.rel.toLowerCase()==="stylesheet")continue}s.removeChild(c)}}function h2(s,a,c,f){for(;s.nodeType===1;){var b=c;if(s.nodeName.toLowerCase()!==a.toLowerCase()){if(!f&&(s.nodeName!=="INPUT"||s.type!=="hidden"))break}else if(f){if(!s[vs])switch(a){case"meta":if(!s.hasAttribute("itemprop"))break;return s;case"link":if(w=s.getAttribute("rel"),w==="stylesheet"&&s.hasAttribute("data-precedence"))break;if(w!==b.rel||s.getAttribute("href")!==(b.href==null||b.href===""?null:b.href)||s.getAttribute("crossorigin")!==(b.crossOrigin==null?null:b.crossOrigin)||s.getAttribute("title")!==(b.title==null?null:b.title))break;return s;case"style":if(s.hasAttribute("data-precedence"))break;return s;case"script":if(w=s.getAttribute("src"),(w!==(b.src==null?null:b.src)||s.getAttribute("type")!==(b.type==null?null:b.type)||s.getAttribute("crossorigin")!==(b.crossOrigin==null?null:b.crossOrigin))&&w&&s.hasAttribute("async")&&!s.hasAttribute("itemprop"))break;return s;default:return s}}else if(a==="input"&&s.type==="hidden"){var w=b.name==null?null:""+b.name;if(b.type==="hidden"&&s.getAttribute("name")===w)return s}else return s;if(s=Fr(s.nextSibling),s===null)break}return null}function f2(s,a,c){if(a==="")return null;for(;s.nodeType!==3;)if((s.nodeType!==1||s.nodeName!=="INPUT"||s.type!=="hidden")&&!c||(s=Fr(s.nextSibling),s===null))return null;return s}function Zv(s,a){for(;s.nodeType!==8;)if((s.nodeType!==1||s.nodeName!=="INPUT"||s.type!=="hidden")&&!a||(s=Fr(s.nextSibling),s===null))return null;return s}function og(s){return s.data==="$?"||s.data==="$~"}function lg(s){return s.data==="$!"||s.data==="$?"&&s.ownerDocument.readyState!=="loading"}function m2(s,a){var c=s.ownerDocument;if(s.data==="$~")s._reactRetry=a;else if(s.data!=="$?"||c.readyState!=="loading")a();else{var f=function(){a(),c.removeEventListener("DOMContentLoaded",f)};c.addEventListener("DOMContentLoaded",f),s._reactRetry=f}}function Fr(s){for(;s!=null;s=s.nextSibling){var a=s.nodeType;if(a===1||a===3)break;if(a===8){if(a=s.data,a==="$"||a==="$!"||a==="$?"||a==="$~"||a==="&"||a==="F!"||a==="F")break;if(a==="/$"||a==="/&")return null}}return s}var cg=null;function Jv(s){s=s.nextSibling;for(var a=0;s;){if(s.nodeType===8){var c=s.data;if(c==="/$"||c==="/&"){if(a===0)return Fr(s.nextSibling);a--}else c!=="$"&&c!=="$!"&&c!=="$?"&&c!=="$~"&&c!=="&"||a++}s=s.nextSibling}return null}function ex(s){s=s.previousSibling;for(var a=0;s;){if(s.nodeType===8){var c=s.data;if(c==="$"||c==="$!"||c==="$?"||c==="$~"||c==="&"){if(a===0)return s;a--}else c!=="/$"&&c!=="/&"||a++}s=s.previousSibling}return null}function tx(s,a,c){switch(a=bh(c),s){case"html":if(s=a.documentElement,!s)throw Error(r(452));return s;case"head":if(s=a.head,!s)throw Error(r(453));return s;case"body":if(s=a.body,!s)throw Error(r(454));return s;default:throw Error(r(451))}}function lu(s){for(var a=s.attributes;a.length;)s.removeAttributeNode(a[0]);Vo(s)}var Vr=new Map,nx=new Set;function vh(s){return typeof s.getRootNode=="function"?s.getRootNode():s.nodeType===9?s:s.ownerDocument}var di=H.d;H.d={f:p2,r:g2,D:y2,C:_2,L:b2,m:v2,X:w2,S:x2,M:S2};function p2(){var s=di.f(),a=dh();return s||a}function g2(s){var a=kr(s);a!==null&&a.tag===5&&a.type==="form"?bb(a):di.r(s)}var Sl=typeof document>"u"?null:document;function rx(s,a,c){var f=Sl;if(f&&typeof a=="string"&&a){var b=ir(a);b='link[rel="'+s+'"][href="'+b+'"]',typeof c=="string"&&(b+='[crossorigin="'+c+'"]'),nx.has(b)||(nx.add(b),s={rel:s,crossOrigin:c,href:a},f.querySelector(b)===null&&(a=f.createElement("link"),Ln(a,"link",s),hn(a),f.head.appendChild(a)))}}function y2(s){di.D(s),rx("dns-prefetch",s,null)}function _2(s,a){di.C(s,a),rx("preconnect",s,a)}function b2(s,a,c){di.L(s,a,c);var f=Sl;if(f&&s&&a){var b='link[rel="preload"][as="'+ir(a)+'"]';a==="image"&&c&&c.imageSrcSet?(b+='[imagesrcset="'+ir(c.imageSrcSet)+'"]',typeof c.imageSizes=="string"&&(b+='[imagesizes="'+ir(c.imageSizes)+'"]')):b+='[href="'+ir(s)+'"]';var w=b;switch(a){case"style":w=Cl(s);break;case"script":w=El(s)}Vr.has(w)||(s=g({rel:"preload",href:a==="image"&&c&&c.imageSrcSet?void 0:s,as:a},c),Vr.set(w,s),f.querySelector(b)!==null||a==="style"&&f.querySelector(cu(w))||a==="script"&&f.querySelector(uu(w))||(a=f.createElement("link"),Ln(a,"link",s),hn(a),f.head.appendChild(a)))}}function v2(s,a){di.m(s,a);var c=Sl;if(c&&s){var f=a&&typeof a.as=="string"?a.as:"script",b='link[rel="modulepreload"][as="'+ir(f)+'"][href="'+ir(s)+'"]',w=b;switch(f){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":w=El(s)}if(!Vr.has(w)&&(s=g({rel:"modulepreload",href:s},a),Vr.set(w,s),c.querySelector(b)===null)){switch(f){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(c.querySelector(uu(w)))return}f=c.createElement("link"),Ln(f,"link",s),hn(f),c.head.appendChild(f)}}}function x2(s,a,c){di.S(s,a,c);var f=Sl;if(f&&s){var b=ws(f).hoistableStyles,w=Cl(s);a=a||"default";var z=b.get(w);if(!z){var Q={loading:0,preload:null};if(z=f.querySelector(cu(w)))Q.loading=5;else{s=g({rel:"stylesheet",href:s,"data-precedence":a},c),(c=Vr.get(w))&&ug(s,c);var re=z=f.createElement("link");hn(re),Ln(re,"link",s),re._p=new Promise(function(ge,Ee){re.onload=ge,re.onerror=Ee}),re.addEventListener("load",function(){Q.loading|=1}),re.addEventListener("error",function(){Q.loading|=2}),Q.loading|=4,xh(z,a,f)}z={type:"stylesheet",instance:z,count:1,state:Q},b.set(w,z)}}}function w2(s,a){di.X(s,a);var c=Sl;if(c&&s){var f=ws(c).hoistableScripts,b=El(s),w=f.get(b);w||(w=c.querySelector(uu(b)),w||(s=g({src:s,async:!0},a),(a=Vr.get(b))&&dg(s,a),w=c.createElement("script"),hn(w),Ln(w,"link",s),c.head.appendChild(w)),w={type:"script",instance:w,count:1,state:null},f.set(b,w))}}function S2(s,a){di.M(s,a);var c=Sl;if(c&&s){var f=ws(c).hoistableScripts,b=El(s),w=f.get(b);w||(w=c.querySelector(uu(b)),w||(s=g({src:s,async:!0,type:"module"},a),(a=Vr.get(b))&&dg(s,a),w=c.createElement("script"),hn(w),Ln(w,"link",s),c.head.appendChild(w)),w={type:"script",instance:w,count:1,state:null},f.set(b,w))}}function sx(s,a,c,f){var b=(b=ue.current)?vh(b):null;if(!b)throw Error(r(446));switch(s){case"meta":case"title":return null;case"style":return typeof c.precedence=="string"&&typeof c.href=="string"?(a=Cl(c.href),c=ws(b).hoistableStyles,f=c.get(a),f||(f={type:"style",instance:null,count:0,state:null},c.set(a,f)),f):{type:"void",instance:null,count:0,state:null};case"link":if(c.rel==="stylesheet"&&typeof c.href=="string"&&typeof c.precedence=="string"){s=Cl(c.href);var w=ws(b).hoistableStyles,z=w.get(s);if(z||(b=b.ownerDocument||b,z={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},w.set(s,z),(w=b.querySelector(cu(s)))&&!w._p&&(z.instance=w,z.state.loading=5),Vr.has(s)||(c={rel:"preload",as:"style",href:c.href,crossOrigin:c.crossOrigin,integrity:c.integrity,media:c.media,hrefLang:c.hrefLang,referrerPolicy:c.referrerPolicy},Vr.set(s,c),w||C2(b,s,c,z.state))),a&&f===null)throw Error(r(528,""));return z}if(a&&f!==null)throw Error(r(529,""));return null;case"script":return a=c.async,c=c.src,typeof c=="string"&&a&&typeof a!="function"&&typeof a!="symbol"?(a=El(c),c=ws(b).hoistableScripts,f=c.get(a),f||(f={type:"script",instance:null,count:0,state:null},c.set(a,f)),f):{type:"void",instance:null,count:0,state:null};default:throw Error(r(444,s))}}function Cl(s){return'href="'+ir(s)+'"'}function cu(s){return'link[rel="stylesheet"]['+s+"]"}function ix(s){return g({},s,{"data-precedence":s.precedence,precedence:null})}function C2(s,a,c,f){s.querySelector('link[rel="preload"][as="style"]['+a+"]")?f.loading=1:(a=s.createElement("link"),f.preload=a,a.addEventListener("load",function(){return f.loading|=1}),a.addEventListener("error",function(){return f.loading|=2}),Ln(a,"link",c),hn(a),s.head.appendChild(a))}function El(s){return'[src="'+ir(s)+'"]'}function uu(s){return"script[async]"+s}function ax(s,a,c){if(a.count++,a.instance===null)switch(a.type){case"style":var f=s.querySelector('style[data-href~="'+ir(c.href)+'"]');if(f)return a.instance=f,hn(f),f;var b=g({},c,{"data-href":c.href,"data-precedence":c.precedence,href:null,precedence:null});return f=(s.ownerDocument||s).createElement("style"),hn(f),Ln(f,"style",b),xh(f,c.precedence,s),a.instance=f;case"stylesheet":b=Cl(c.href);var w=s.querySelector(cu(b));if(w)return a.state.loading|=4,a.instance=w,hn(w),w;f=ix(c),(b=Vr.get(b))&&ug(f,b),w=(s.ownerDocument||s).createElement("link"),hn(w);var z=w;return z._p=new Promise(function(Q,re){z.onload=Q,z.onerror=re}),Ln(w,"link",f),a.state.loading|=4,xh(w,c.precedence,s),a.instance=w;case"script":return w=El(c.src),(b=s.querySelector(uu(w)))?(a.instance=b,hn(b),b):(f=c,(b=Vr.get(w))&&(f=g({},c),dg(f,b)),s=s.ownerDocument||s,b=s.createElement("script"),hn(b),Ln(b,"link",f),s.head.appendChild(b),a.instance=b);case"void":return null;default:throw Error(r(443,a.type))}else a.type==="stylesheet"&&(a.state.loading&4)===0&&(f=a.instance,a.state.loading|=4,xh(f,c.precedence,s));return a.instance}function xh(s,a,c){for(var f=c.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),b=f.length?f[f.length-1]:null,w=b,z=0;z<f.length;z++){var Q=f[z];if(Q.dataset.precedence===a)w=Q;else if(w!==b)break}w?w.parentNode.insertBefore(s,w.nextSibling):(a=c.nodeType===9?c.head:c,a.insertBefore(s,a.firstChild))}function ug(s,a){s.crossOrigin==null&&(s.crossOrigin=a.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=a.referrerPolicy),s.title==null&&(s.title=a.title)}function dg(s,a){s.crossOrigin==null&&(s.crossOrigin=a.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=a.referrerPolicy),s.integrity==null&&(s.integrity=a.integrity)}var wh=null;function ox(s,a,c){if(wh===null){var f=new Map,b=wh=new Map;b.set(c,f)}else b=wh,f=b.get(c),f||(f=new Map,b.set(c,f));if(f.has(s))return f;for(f.set(s,null),c=c.getElementsByTagName(s),b=0;b<c.length;b++){var w=c[b];if(!(w[vs]||w[dn]||s==="link"&&w.getAttribute("rel")==="stylesheet")&&w.namespaceURI!=="http://www.w3.org/2000/svg"){var z=w.getAttribute(a)||"";z=s+z;var Q=f.get(z);Q?Q.push(w):f.set(z,[w])}}return f}function lx(s,a,c){s=s.ownerDocument||s,s.head.insertBefore(c,a==="title"?s.querySelector("head > title"):null)}function E2(s,a,c){if(c===1||a.itemProp!=null)return!1;switch(s){case"meta":case"title":return!0;case"style":if(typeof a.precedence!="string"||typeof a.href!="string"||a.href==="")break;return!0;case"link":if(typeof a.rel!="string"||typeof a.href!="string"||a.href===""||a.onLoad||a.onError)break;return a.rel==="stylesheet"?(s=a.disabled,typeof a.precedence=="string"&&s==null):!0;case"script":if(a.async&&typeof a.async!="function"&&typeof a.async!="symbol"&&!a.onLoad&&!a.onError&&a.src&&typeof a.src=="string")return!0}return!1}function cx(s){return!(s.type==="stylesheet"&&(s.state.loading&3)===0)}function T2(s,a,c,f){if(c.type==="stylesheet"&&(typeof f.media!="string"||matchMedia(f.media).matches!==!1)&&(c.state.loading&4)===0){if(c.instance===null){var b=Cl(f.href),w=a.querySelector(cu(b));if(w){a=w._p,a!==null&&typeof a=="object"&&typeof a.then=="function"&&(s.count++,s=Sh.bind(s),a.then(s,s)),c.state.loading|=4,c.instance=w,hn(w);return}w=a.ownerDocument||a,f=ix(f),(b=Vr.get(b))&&ug(f,b),w=w.createElement("link"),hn(w);var z=w;z._p=new Promise(function(Q,re){z.onload=Q,z.onerror=re}),Ln(w,"link",f),c.instance=w}s.stylesheets===null&&(s.stylesheets=new Map),s.stylesheets.set(c,a),(a=c.state.preload)&&(c.state.loading&3)===0&&(s.count++,c=Sh.bind(s),a.addEventListener("load",c),a.addEventListener("error",c))}}var hg=0;function A2(s,a){return s.stylesheets&&s.count===0&&Eh(s,s.stylesheets),0<s.count||0<s.imgCount?function(c){var f=setTimeout(function(){if(s.stylesheets&&Eh(s,s.stylesheets),s.unsuspend){var w=s.unsuspend;s.unsuspend=null,w()}},6e4+a);0<s.imgBytes&&hg===0&&(hg=62500*o2());var b=setTimeout(function(){if(s.waitingForImages=!1,s.count===0&&(s.stylesheets&&Eh(s,s.stylesheets),s.unsuspend)){var w=s.unsuspend;s.unsuspend=null,w()}},(s.imgBytes>hg?50:800)+a);return s.unsuspend=c,function(){s.unsuspend=null,clearTimeout(f),clearTimeout(b)}}:null}function Sh(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)Eh(this,this.stylesheets);else if(this.unsuspend){var s=this.unsuspend;this.unsuspend=null,s()}}}var Ch=null;function Eh(s,a){s.stylesheets=null,s.unsuspend!==null&&(s.count++,Ch=new Map,a.forEach(j2,s),Ch=null,Sh.call(s))}function j2(s,a){if(!(a.state.loading&4)){var c=Ch.get(s);if(c)var f=c.get(null);else{c=new Map,Ch.set(s,c);for(var b=s.querySelectorAll("link[data-precedence],style[data-precedence]"),w=0;w<b.length;w++){var z=b[w];(z.nodeName==="LINK"||z.getAttribute("media")!=="not all")&&(c.set(z.dataset.precedence,z),f=z)}f&&c.set(null,f)}b=a.instance,z=b.getAttribute("data-precedence"),w=c.get(z)||f,w===f&&c.set(null,b),c.set(z,b),this.count++,f=Sh.bind(this),b.addEventListener("load",f),b.addEventListener("error",f),w?w.parentNode.insertBefore(b,w.nextSibling):(s=s.nodeType===9?s.head:s,s.insertBefore(b,s.firstChild)),a.state.loading|=4}}var du={$$typeof:I,Provider:null,Consumer:null,_currentValue:Z,_currentValue2:Z,_threadCount:0};function R2(s,a,c,f,b,w,z,Q,re){this.tag=1,this.containerInfo=s,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=_s(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=_s(0),this.hiddenUpdates=_s(null),this.identifierPrefix=f,this.onUncaughtError=b,this.onCaughtError=w,this.onRecoverableError=z,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=re,this.incompleteTransitions=new Map}function ux(s,a,c,f,b,w,z,Q,re,ge,Ee,Re){return s=new R2(s,a,c,z,re,ge,Ee,Re,Q),a=1,w===!0&&(a|=24),w=xr(3,null,null,a),s.current=w,w.stateNode=s,a=Hm(),a.refCount++,s.pooledCache=a,a.refCount++,w.memoizedState={element:f,isDehydrated:c,cache:a},Km(w),s}function dx(s){return s?(s=nl,s):nl}function hx(s,a,c,f,b,w){b=dx(b),f.context===null?f.context=b:f.pendingContext=b,f=Vi(a),f.payload={element:c},w=w===void 0?null:w,w!==null&&(f.callback=w),c=$i(s,f,a),c!==null&&(dr(c,s,a),$c(c,s,a))}function fx(s,a){if(s=s.memoizedState,s!==null&&s.dehydrated!==null){var c=s.retryLane;s.retryLane=c!==0&&c<a?c:a}}function fg(s,a){fx(s,a),(s=s.alternate)&&fx(s,a)}function mx(s){if(s.tag===13||s.tag===31){var a=to(s,67108864);a!==null&&dr(a,s,67108864),fg(s,67108864)}}function px(s){if(s.tag===13||s.tag===31){var a=Tr();a=$a(a);var c=to(s,a);c!==null&&dr(c,s,a),fg(s,a)}}var Th=!0;function I2(s,a,c,f){var b=W.T;W.T=null;var w=H.p;try{H.p=2,mg(s,a,c,f)}finally{H.p=w,W.T=b}}function k2(s,a,c,f){var b=W.T;W.T=null;var w=H.p;try{H.p=8,mg(s,a,c,f)}finally{H.p=w,W.T=b}}function mg(s,a,c,f){if(Th){var b=pg(f);if(b===null)eg(s,a,f,Ah,c),yx(s,f);else if(O2(b,s,a,c,f))f.stopPropagation();else if(yx(s,f),a&4&&-1<D2.indexOf(s)){for(;b!==null;){var w=kr(b);if(w!==null)switch(w.tag){case 3:if(w=w.stateNode,w.current.memoizedState.isDehydrated){var z=tr(w.pendingLanes);if(z!==0){var Q=w;for(Q.pendingLanes|=2,Q.entangledLanes|=2;z;){var re=1<<31-Et(z);Q.entanglements[1]|=re,z&=~re}Ns(w),(At&6)===0&&(ch=Me()+500,iu(0))}}break;case 31:case 13:Q=to(w,2),Q!==null&&dr(Q,w,2),dh(),fg(w,2)}if(w=pg(f),w===null&&eg(s,a,f,Ah,c),w===b)break;b=w}b!==null&&f.stopPropagation()}else eg(s,a,f,null,c)}}function pg(s){return s=Dr(s),gg(s)}var Ah=null;function gg(s){if(Ah=null,s=xs(s),s!==null){var a=o(s);if(a===null)s=null;else{var c=a.tag;if(c===13){if(s=l(a),s!==null)return s;s=null}else if(c===31){if(s=d(a),s!==null)return s;s=null}else if(c===3){if(a.stateNode.current.memoizedState.isDehydrated)return a.tag===3?a.stateNode.containerInfo:null;s=null}else a!==s&&(s=null)}}return Ah=s,null}function gx(s){switch(s){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(De()){case He:return 2;case wt:return 8;case nt:case Qn:return 32;case ms:return 268435456;default:return 32}default:return 32}}var yg=!1,ea=null,ta=null,na=null,hu=new Map,fu=new Map,ra=[],D2="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function yx(s,a){switch(s){case"focusin":case"focusout":ea=null;break;case"dragenter":case"dragleave":ta=null;break;case"mouseover":case"mouseout":na=null;break;case"pointerover":case"pointerout":hu.delete(a.pointerId);break;case"gotpointercapture":case"lostpointercapture":fu.delete(a.pointerId)}}function mu(s,a,c,f,b,w){return s===null||s.nativeEvent!==w?(s={blockedOn:a,domEventName:c,eventSystemFlags:f,nativeEvent:w,targetContainers:[b]},a!==null&&(a=kr(a),a!==null&&mx(a)),s):(s.eventSystemFlags|=f,a=s.targetContainers,b!==null&&a.indexOf(b)===-1&&a.push(b),s)}function O2(s,a,c,f,b){switch(a){case"focusin":return ea=mu(ea,s,a,c,f,b),!0;case"dragenter":return ta=mu(ta,s,a,c,f,b),!0;case"mouseover":return na=mu(na,s,a,c,f,b),!0;case"pointerover":var w=b.pointerId;return hu.set(w,mu(hu.get(w)||null,s,a,c,f,b)),!0;case"gotpointercapture":return w=b.pointerId,fu.set(w,mu(fu.get(w)||null,s,a,c,f,b)),!0}return!1}function _x(s){var a=xs(s.target);if(a!==null){var c=o(a);if(c!==null){if(a=c.tag,a===13){if(a=l(c),a!==null){s.blockedOn=a,Kr(s.priority,function(){px(c)});return}}else if(a===31){if(a=d(c),a!==null){s.blockedOn=a,Kr(s.priority,function(){px(c)});return}}else if(a===3&&c.stateNode.current.memoizedState.isDehydrated){s.blockedOn=c.tag===3?c.stateNode.containerInfo:null;return}}}s.blockedOn=null}function jh(s){if(s.blockedOn!==null)return!1;for(var a=s.targetContainers;0<a.length;){var c=pg(s.nativeEvent);if(c===null){c=s.nativeEvent;var f=new c.constructor(c.type,c);Ac=f,c.target.dispatchEvent(f),Ac=null}else return a=kr(c),a!==null&&mx(a),s.blockedOn=c,!1;a.shift()}return!0}function bx(s,a,c){jh(s)&&c.delete(a)}function M2(){yg=!1,ea!==null&&jh(ea)&&(ea=null),ta!==null&&jh(ta)&&(ta=null),na!==null&&jh(na)&&(na=null),hu.forEach(bx),fu.forEach(bx)}function Rh(s,a){s.blockedOn===a&&(s.blockedOn=null,yg||(yg=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,M2)))}var Ih=null;function vx(s){Ih!==s&&(Ih=s,t.unstable_scheduleCallback(t.unstable_NormalPriority,function(){Ih===s&&(Ih=null);for(var a=0;a<s.length;a+=3){var c=s[a],f=s[a+1],b=s[a+2];if(typeof f!="function"){if(gg(f||c)===null)continue;break}var w=kr(c);w!==null&&(s.splice(a,3),a-=3,pp(w,{pending:!0,data:b,method:c.method,action:f},f,b))}}))}function Tl(s){function a(re){return Rh(re,s)}ea!==null&&Rh(ea,s),ta!==null&&Rh(ta,s),na!==null&&Rh(na,s),hu.forEach(a),fu.forEach(a);for(var c=0;c<ra.length;c++){var f=ra[c];f.blockedOn===s&&(f.blockedOn=null)}for(;0<ra.length&&(c=ra[0],c.blockedOn===null);)_x(c),c.blockedOn===null&&ra.shift();if(c=(s.ownerDocument||s).$$reactFormReplay,c!=null)for(f=0;f<c.length;f+=3){var b=c[f],w=c[f+1],z=b[Rn]||null;if(typeof w=="function")z||vx(c);else if(z){var Q=null;if(w&&w.hasAttribute("formAction")){if(b=w,z=w[Rn]||null)Q=z.formAction;else if(gg(b)!==null)continue}else Q=z.action;typeof Q=="function"?c[f+1]=Q:(c.splice(f,3),f-=3),vx(c)}}}function xx(){function s(w){w.canIntercept&&w.info==="react-transition"&&w.intercept({handler:function(){return new Promise(function(z){return b=z})},focusReset:"manual",scroll:"manual"})}function a(){b!==null&&(b(),b=null),f||setTimeout(c,20)}function c(){if(!f&&!navigation.transition){var w=navigation.currentEntry;w&&w.url!=null&&navigation.navigate(w.url,{state:w.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var f=!1,b=null;return navigation.addEventListener("navigate",s),navigation.addEventListener("navigatesuccess",a),navigation.addEventListener("navigateerror",a),setTimeout(c,100),function(){f=!0,navigation.removeEventListener("navigate",s),navigation.removeEventListener("navigatesuccess",a),navigation.removeEventListener("navigateerror",a),b!==null&&(b(),b=null)}}}function _g(s){this._internalRoot=s}kh.prototype.render=_g.prototype.render=function(s){var a=this._internalRoot;if(a===null)throw Error(r(409));var c=a.current,f=Tr();hx(c,f,s,a,null,null)},kh.prototype.unmount=_g.prototype.unmount=function(){var s=this._internalRoot;if(s!==null){this._internalRoot=null;var a=s.containerInfo;hx(s.current,2,null,s,null,null),dh(),a[bs]=null}};function kh(s){this._internalRoot=s}kh.prototype.unstable_scheduleHydration=function(s){if(s){var a=dd();s={blockedOn:null,target:s,priority:a};for(var c=0;c<ra.length&&a!==0&&a<ra[c].priority;c++);ra.splice(c,0,s),c===0&&_x(s)}};var wx=e.version;if(wx!=="19.2.3")throw Error(r(527,wx,"19.2.3"));H.findDOMNode=function(s){var a=s._reactInternals;if(a===void 0)throw typeof s.render=="function"?Error(r(188)):(s=Object.keys(s).join(","),Error(r(268,s)));return s=m(a),s=s!==null?p(s):null,s=s===null?null:s.stateNode,s};var N2={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:W,reconcilerVersion:"19.2.3"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Dh=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Dh.isDisabled&&Dh.supportsFiber)try{vt=Dh.inject(N2),en=Dh}catch{}}return gu.createRoot=function(s,a){if(!i(s))throw Error(r(299));var c=!1,f="",b=Rb,w=Ib,z=kb;return a!=null&&(a.unstable_strictMode===!0&&(c=!0),a.identifierPrefix!==void 0&&(f=a.identifierPrefix),a.onUncaughtError!==void 0&&(b=a.onUncaughtError),a.onCaughtError!==void 0&&(w=a.onCaughtError),a.onRecoverableError!==void 0&&(z=a.onRecoverableError)),a=ux(s,1,!1,null,null,c,f,null,b,w,z,xx),s[bs]=a.current,Jp(s),new _g(a)},gu.hydrateRoot=function(s,a,c){if(!i(s))throw Error(r(299));var f=!1,b="",w=Rb,z=Ib,Q=kb,re=null;return c!=null&&(c.unstable_strictMode===!0&&(f=!0),c.identifierPrefix!==void 0&&(b=c.identifierPrefix),c.onUncaughtError!==void 0&&(w=c.onUncaughtError),c.onCaughtError!==void 0&&(z=c.onCaughtError),c.onRecoverableError!==void 0&&(Q=c.onRecoverableError),c.formState!==void 0&&(re=c.formState)),a=ux(s,1,!0,a,c??null,f,b,re,w,z,Q,xx),a.context=dx(null),c=a.current,f=Tr(),f=$a(f),b=Vi(f),b.callback=null,$i(c,b,f),c=f,a.current.lanes=c,Fa(a,c),Ns(a),s[bs]=a.current,Jp(s),new kh(a)},gu.version="19.2.3",gu}var Dx;function G2(){if(Dx)return xg.exports;Dx=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),xg.exports=H2(),xg.exports}var Q2=G2();var Ox="popstate";function W2(t={}){function e(r,i){let{pathname:o,search:l,hash:d}=r.location;return Kg("",{pathname:o,search:l,hash:d},i.state&&i.state.usr||null,i.state&&i.state.key||"default")}function n(r,i){return typeof i=="string"?i:Iu(i)}return Y2(e,n,null,t)}function Xt(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function jr(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function K2(){return Math.random().toString(36).substring(2,10)}function Mx(t,e){return{usr:t.state,key:t.key,idx:e}}function Kg(t,e,n=null,r){return{pathname:typeof t=="string"?t:t.pathname,search:"",hash:"",...typeof e=="string"?Zl(e):e,state:n,key:e&&e.key||r||K2()}}function Iu({pathname:t="/",search:e="",hash:n=""}){return e&&e!=="?"&&(t+=e.charAt(0)==="?"?e:"?"+e),n&&n!=="#"&&(t+=n.charAt(0)==="#"?n:"#"+n),t}function Zl(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substring(n),t=t.substring(0,n));let r=t.indexOf("?");r>=0&&(e.search=t.substring(r),t=t.substring(0,r)),t&&(e.pathname=t)}return e}function Y2(t,e,n,r={}){let{window:i=document.defaultView,v5Compat:o=!1}=r,l=i.history,d="POP",h=null,m=p();m==null&&(m=0,l.replaceState({...l.state,idx:m},""));function p(){return(l.state||{idx:null}).idx}function g(){d="POP";let S=p(),E=S==null?null:S-m;m=S,h&&h({action:d,location:x.location,delta:E})}function v(S,E){d="PUSH";let T=Kg(x.location,S,E);m=p()+1;let I=Mx(T,m),M=x.createHref(T);try{l.pushState(I,"",M)}catch(L){if(L instanceof DOMException&&L.name==="DataCloneError")throw L;i.location.assign(M)}o&&h&&h({action:d,location:x.location,delta:1})}function _(S,E){d="REPLACE";let T=Kg(x.location,S,E);m=p();let I=Mx(T,m),M=x.createHref(T);l.replaceState(I,"",M),o&&h&&h({action:d,location:x.location,delta:0})}function C(S){return X2(S)}let x={get action(){return d},get location(){return t(i,l)},listen(S){if(h)throw new Error("A history only accepts one active listener");return i.addEventListener(Ox,g),h=S,()=>{i.removeEventListener(Ox,g),h=null}},createHref(S){return e(i,S)},createURL:C,encodeLocation(S){let E=C(S);return{pathname:E.pathname,search:E.search,hash:E.hash}},push:v,replace:_,go(S){return l.go(S)}};return x}function X2(t,e=!1){let n="http://localhost";typeof window<"u"&&(n=window.location.origin!=="null"?window.location.origin:window.location.href),Xt(n,"No window.location.(origin|href) available to create URL");let r=typeof t=="string"?t:Iu(t);return r=r.replace(/ $/,"%20"),!e&&r.startsWith("//")&&(r=n+r),new URL(r,n)}function cS(t,e,n="/"){return Z2(t,e,n,!1)}function Z2(t,e,n,r){let i=typeof e=="string"?Zl(e):e,o=yi(i.pathname||"/",n);if(o==null)return null;let l=uS(t);J2(l);let d=null;for(let h=0;d==null&&h<l.length;++h){let m=u5(o);d=l5(l[h],m,r)}return d}function uS(t,e=[],n=[],r="",i=!1){let o=(l,d,h=i,m)=>{let p={relativePath:m===void 0?l.path||"":m,caseSensitive:l.caseSensitive===!0,childrenIndex:d,route:l};if(p.relativePath.startsWith("/")){if(!p.relativePath.startsWith(r)&&h)return;Xt(p.relativePath.startsWith(r),`Absolute route path "${p.relativePath}" nested under path "${r}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),p.relativePath=p.relativePath.slice(r.length)}let g=pi([r,p.relativePath]),v=n.concat(p);l.children&&l.children.length>0&&(Xt(l.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${g}".`),uS(l.children,e,v,g,h)),!(l.path==null&&!l.index)&&e.push({path:g,score:a5(g,l.index),routesMeta:v})};return t.forEach((l,d)=>{if(l.path===""||!l.path?.includes("?"))o(l,d);else for(let h of dS(l.path))o(l,d,!0,h)}),e}function dS(t){let e=t.split("/");if(e.length===0)return[];let[n,...r]=e,i=n.endsWith("?"),o=n.replace(/\?$/,"");if(r.length===0)return i?[o,""]:[o];let l=dS(r.join("/")),d=[];return d.push(...l.map(h=>h===""?o:[o,h].join("/"))),i&&d.push(...l),d.map(h=>t.startsWith("/")&&h===""?"/":h)}function J2(t){t.sort((e,n)=>e.score!==n.score?n.score-e.score:o5(e.routesMeta.map(r=>r.childrenIndex),n.routesMeta.map(r=>r.childrenIndex)))}var e5=/^:[\w-]+$/,t5=3,n5=2,r5=1,s5=10,i5=-2,Nx=t=>t==="*";function a5(t,e){let n=t.split("/"),r=n.length;return n.some(Nx)&&(r+=i5),e&&(r+=n5),n.filter(i=>!Nx(i)).reduce((i,o)=>i+(e5.test(o)?t5:o===""?r5:s5),r)}function o5(t,e){return t.length===e.length&&t.slice(0,-1).every((r,i)=>r===e[i])?t[t.length-1]-e[e.length-1]:0}function l5(t,e,n=!1){let{routesMeta:r}=t,i={},o="/",l=[];for(let d=0;d<r.length;++d){let h=r[d],m=d===r.length-1,p=o==="/"?e:e.slice(o.length)||"/",g=nf({path:h.relativePath,caseSensitive:h.caseSensitive,end:m},p),v=h.route;if(!g&&m&&n&&!r[r.length-1].route.index&&(g=nf({path:h.relativePath,caseSensitive:h.caseSensitive,end:!1},p)),!g)return null;Object.assign(i,g.params),l.push({params:i,pathname:pi([o,g.pathname]),pathnameBase:m5(pi([o,g.pathnameBase])),route:v}),g.pathnameBase!=="/"&&(o=pi([o,g.pathnameBase]))}return l}function nf(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,r]=c5(t.path,t.caseSensitive,t.end),i=e.match(n);if(!i)return null;let o=i[0],l=o.replace(/(.)\/+$/,"$1"),d=i.slice(1);return{params:r.reduce((m,{paramName:p,isOptional:g},v)=>{if(p==="*"){let C=d[v]||"";l=o.slice(0,o.length-C.length).replace(/(.)\/+$/,"$1")}const _=d[v];return g&&!_?m[p]=void 0:m[p]=(_||"").replace(/%2F/g,"/"),m},{}),pathname:o,pathnameBase:l,pattern:t}}function c5(t,e=!1,n=!0){jr(t==="*"||!t.endsWith("*")||t.endsWith("/*"),`Route path "${t}" will be treated as if it were "${t.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${t.replace(/\*$/,"/*")}".`);let r=[],i="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(l,d,h)=>(r.push({paramName:d,isOptional:h!=null}),h?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return t.endsWith("*")?(r.push({paramName:"*"}),i+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?i+="\\/*$":t!==""&&t!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,e?void 0:"i"),r]}function u5(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return jr(!1,`The URL path "${t}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),t}}function yi(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,r=t.charAt(n);return r&&r!=="/"?null:t.slice(n)||"/"}var hS=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,d5=t=>hS.test(t);function h5(t,e="/"){let{pathname:n,search:r="",hash:i=""}=typeof t=="string"?Zl(t):t,o;if(n)if(d5(n))o=n;else{if(n.includes("//")){let l=n;n=n.replace(/\/\/+/g,"/"),jr(!1,`Pathnames cannot have embedded double slashes - normalizing ${l} -> ${n}`)}n.startsWith("/")?o=Px(n.substring(1),"/"):o=Px(n,e)}else o=e;return{pathname:o,search:p5(r),hash:g5(i)}}function Px(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(i=>{i===".."?n.length>1&&n.pop():i!=="."&&n.push(i)}),n.length>1?n.join("/"):"/"}function Eg(t,e,n,r){return`Cannot include a '${t}' character in a manually specified \`to.${e}\` field [${JSON.stringify(r)}].  Please separate it out to the \`to.${n}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function f5(t){return t.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function My(t){let e=f5(t);return e.map((n,r)=>r===e.length-1?n.pathname:n.pathnameBase)}function Ny(t,e,n,r=!1){let i;typeof t=="string"?i=Zl(t):(i={...t},Xt(!i.pathname||!i.pathname.includes("?"),Eg("?","pathname","search",i)),Xt(!i.pathname||!i.pathname.includes("#"),Eg("#","pathname","hash",i)),Xt(!i.search||!i.search.includes("#"),Eg("#","search","hash",i)));let o=t===""||i.pathname==="",l=o?"/":i.pathname,d;if(l==null)d=n;else{let g=e.length-1;if(!r&&l.startsWith("..")){let v=l.split("/");for(;v[0]==="..";)v.shift(),g-=1;i.pathname=v.join("/")}d=g>=0?e[g]:"/"}let h=h5(i,d),m=l&&l!=="/"&&l.endsWith("/"),p=(o||l===".")&&n.endsWith("/");return!h.pathname.endsWith("/")&&(m||p)&&(h.pathname+="/"),h}var pi=t=>t.join("/").replace(/\/\/+/g,"/"),m5=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),p5=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,g5=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t,y5=class{constructor(t,e,n,r=!1){this.status=t,this.statusText=e||"",this.internal=r,n instanceof Error?(this.data=n.toString(),this.error=n):this.data=n}};function _5(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}function b5(t){return t.map(e=>e.route.path).filter(Boolean).join("/").replace(/\/\/*/g,"/")||"/"}var fS=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function mS(t,e){let n=t;if(typeof n!="string"||!hS.test(n))return{absoluteURL:void 0,isExternal:!1,to:n};let r=n,i=!1;if(fS)try{let o=new URL(window.location.href),l=n.startsWith("//")?new URL(o.protocol+n):new URL(n),d=yi(l.pathname,e);l.origin===o.origin&&d!=null?n=d+l.search+l.hash:i=!0}catch{jr(!1,`<Link to="${n}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}return{absoluteURL:r,isExternal:i,to:n}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var pS=["POST","PUT","PATCH","DELETE"];new Set(pS);var v5=["GET",...pS];new Set(v5);var Jl=D.createContext(null);Jl.displayName="DataRouter";var Pf=D.createContext(null);Pf.displayName="DataRouterState";var x5=D.createContext(!1),gS=D.createContext({isTransitioning:!1});gS.displayName="ViewTransition";var w5=D.createContext(new Map);w5.displayName="Fetchers";var S5=D.createContext(null);S5.displayName="Await";var Rr=D.createContext(null);Rr.displayName="Navigation";var Hu=D.createContext(null);Hu.displayName="Location";var Gr=D.createContext({outlet:null,matches:[],isDataRoute:!1});Gr.displayName="Route";var Py=D.createContext(null);Py.displayName="RouteError";var yS="REACT_ROUTER_ERROR",C5="REDIRECT",E5="ROUTE_ERROR_RESPONSE";function T5(t){if(t.startsWith(`${yS}:${C5}:{`))try{let e=JSON.parse(t.slice(28));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.location=="string"&&typeof e.reloadDocument=="boolean"&&typeof e.replace=="boolean")return e}catch{}}function A5(t){if(t.startsWith(`${yS}:${E5}:{`))try{let e=JSON.parse(t.slice(40));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string")return new y5(e.status,e.statusText,e.data)}catch{}}function j5(t,{relative:e}={}){Xt(ec(),"useHref() may be used only in the context of a <Router> component.");let{basename:n,navigator:r}=D.useContext(Rr),{hash:i,pathname:o,search:l}=Qu(t,{relative:e}),d=o;return n!=="/"&&(d=o==="/"?n:pi([n,o])),r.createHref({pathname:d,search:l,hash:i})}function ec(){return D.useContext(Hu)!=null}function Mn(){return Xt(ec(),"useLocation() may be used only in the context of a <Router> component."),D.useContext(Hu).location}var _S="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function bS(t){D.useContext(Rr).static||D.useLayoutEffect(t)}function Gu(){let{isDataRoute:t}=D.useContext(Gr);return t?q5():R5()}function R5(){Xt(ec(),"useNavigate() may be used only in the context of a <Router> component.");let t=D.useContext(Jl),{basename:e,navigator:n}=D.useContext(Rr),{matches:r}=D.useContext(Gr),{pathname:i}=Mn(),o=JSON.stringify(My(r)),l=D.useRef(!1);return bS(()=>{l.current=!0}),D.useCallback((h,m={})=>{if(jr(l.current,_S),!l.current)return;if(typeof h=="number"){n.go(h);return}let p=Ny(h,JSON.parse(o),i,m.relative==="path");t==null&&e!=="/"&&(p.pathname=p.pathname==="/"?e:pi([e,p.pathname])),(m.replace?n.replace:n.push)(p,m.state,m)},[e,n,o,i,t])}var I5=D.createContext(null);function k5(t){let e=D.useContext(Gr).outlet;return D.useMemo(()=>e&&D.createElement(I5.Provider,{value:t},e),[e,t])}function D5(){let{matches:t}=D.useContext(Gr),e=t[t.length-1];return e?e.params:{}}function Qu(t,{relative:e}={}){let{matches:n}=D.useContext(Gr),{pathname:r}=Mn(),i=JSON.stringify(My(n));return D.useMemo(()=>Ny(t,JSON.parse(i),r,e==="path"),[t,i,r,e])}function O5(t,e){return vS(t,e)}function vS(t,e,n,r,i){Xt(ec(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:o}=D.useContext(Rr),{matches:l}=D.useContext(Gr),d=l[l.length-1],h=d?d.params:{},m=d?d.pathname:"/",p=d?d.pathnameBase:"/",g=d&&d.route;{let T=g&&g.path||"";wS(m,!g||T.endsWith("*")||T.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${m}" (under <Route path="${T}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${T}"> to <Route path="${T==="/"?"*":`${T}/*`}">.`)}let v=Mn(),_;if(e){let T=typeof e=="string"?Zl(e):e;Xt(p==="/"||T.pathname?.startsWith(p),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${p}" but pathname "${T.pathname}" was given in the \`location\` prop.`),_=T}else _=v;let C=_.pathname||"/",x=C;if(p!=="/"){let T=p.replace(/^\//,"").split("/");x="/"+C.replace(/^\//,"").split("/").slice(T.length).join("/")}let S=cS(t,{pathname:x});jr(g||S!=null,`No routes matched location "${_.pathname}${_.search}${_.hash}" `),jr(S==null||S[S.length-1].route.element!==void 0||S[S.length-1].route.Component!==void 0||S[S.length-1].route.lazy!==void 0,`Matched leaf route at location "${_.pathname}${_.search}${_.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let E=B5(S&&S.map(T=>Object.assign({},T,{params:Object.assign({},h,T.params),pathname:pi([p,o.encodeLocation?o.encodeLocation(T.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:T.pathname]),pathnameBase:T.pathnameBase==="/"?p:pi([p,o.encodeLocation?o.encodeLocation(T.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:T.pathnameBase])})),l,n,r,i);return e&&E?D.createElement(Hu.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",..._},navigationType:"POP"}},E):E}function M5(){let t=$5(),e=_5(t)?`${t.status} ${t.statusText}`:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,r="rgba(200,200,200, 0.5)",i={padding:"0.5rem",backgroundColor:r},o={padding:"2px 4px",backgroundColor:r},l=null;return console.error("Error handled by React Router default ErrorBoundary:",t),l=D.createElement(D.Fragment,null,D.createElement("p",null," Hey developer "),D.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",D.createElement("code",{style:o},"ErrorBoundary")," or"," ",D.createElement("code",{style:o},"errorElement")," prop on your route.")),D.createElement(D.Fragment,null,D.createElement("h2",null,"Unexpected Application Error!"),D.createElement("h3",{style:{fontStyle:"italic"}},e),n?D.createElement("pre",{style:i},n):null,l)}var N5=D.createElement(M5,null),xS=class extends D.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,e){return e.location!==t.location||e.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:e.error,location:e.location,revalidation:t.revalidation||e.revalidation}}componentDidCatch(t,e){this.props.onError?this.props.onError(t,e):console.error("React Router caught the following error during render",t)}render(){let t=this.state.error;if(this.context&&typeof t=="object"&&t&&"digest"in t&&typeof t.digest=="string"){const n=A5(t.digest);n&&(t=n)}let e=t!==void 0?D.createElement(Gr.Provider,{value:this.props.routeContext},D.createElement(Py.Provider,{value:t,children:this.props.component})):this.props.children;return this.context?D.createElement(P5,{error:t},e):e}};xS.contextType=x5;var Tg=new WeakMap;function P5({children:t,error:e}){let{basename:n}=D.useContext(Rr);if(typeof e=="object"&&e&&"digest"in e&&typeof e.digest=="string"){let r=T5(e.digest);if(r){let i=Tg.get(e);if(i)throw i;let o=mS(r.location,n);if(fS&&!Tg.get(e))if(o.isExternal||r.reloadDocument)window.location.href=o.absoluteURL||o.to;else{const l=Promise.resolve().then(()=>window.__reactRouterDataRouter.navigate(o.to,{replace:r.replace}));throw Tg.set(e,l),l}return D.createElement("meta",{httpEquiv:"refresh",content:`0;url=${o.absoluteURL||o.to}`})}}return t}function z5({routeContext:t,match:e,children:n}){let r=D.useContext(Jl);return r&&r.static&&r.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=e.route.id),D.createElement(Gr.Provider,{value:t},n)}function B5(t,e=[],n=null,r=null,i=null){if(t==null){if(!n)return null;if(n.errors)t=n.matches;else if(e.length===0&&!n.initialized&&n.matches.length>0)t=n.matches;else return null}let o=t,l=n?.errors;if(l!=null){let p=o.findIndex(g=>g.route.id&&l?.[g.route.id]!==void 0);Xt(p>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(l).join(",")}`),o=o.slice(0,Math.min(o.length,p+1))}let d=!1,h=-1;if(n)for(let p=0;p<o.length;p++){let g=o[p];if((g.route.HydrateFallback||g.route.hydrateFallbackElement)&&(h=p),g.route.id){let{loaderData:v,errors:_}=n,C=g.route.loader&&!v.hasOwnProperty(g.route.id)&&(!_||_[g.route.id]===void 0);if(g.route.lazy||C){d=!0,h>=0?o=o.slice(0,h+1):o=[o[0]];break}}}let m=n&&r?(p,g)=>{r(p,{location:n.location,params:n.matches?.[0]?.params??{},unstable_pattern:b5(n.matches),errorInfo:g})}:void 0;return o.reduceRight((p,g,v)=>{let _,C=!1,x=null,S=null;n&&(_=l&&g.route.id?l[g.route.id]:void 0,x=g.route.errorElement||N5,d&&(h<0&&v===0?(wS("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),C=!0,S=null):h===v&&(C=!0,S=g.route.hydrateFallbackElement||null)));let E=e.concat(o.slice(0,v+1)),T=()=>{let I;return _?I=x:C?I=S:g.route.Component?I=D.createElement(g.route.Component,null):g.route.element?I=g.route.element:I=p,D.createElement(z5,{match:g,routeContext:{outlet:p,matches:E,isDataRoute:n!=null},children:I})};return n&&(g.route.ErrorBoundary||g.route.errorElement||v===0)?D.createElement(xS,{location:n.location,revalidation:n.revalidation,component:x,error:_,children:T(),routeContext:{outlet:null,matches:E,isDataRoute:!0},onError:m}):T()},null)}function zy(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function L5(t){let e=D.useContext(Jl);return Xt(e,zy(t)),e}function U5(t){let e=D.useContext(Pf);return Xt(e,zy(t)),e}function F5(t){let e=D.useContext(Gr);return Xt(e,zy(t)),e}function By(t){let e=F5(t),n=e.matches[e.matches.length-1];return Xt(n.route.id,`${t} can only be used on routes that contain a unique "id"`),n.route.id}function V5(){return By("useRouteId")}function $5(){let t=D.useContext(Py),e=U5("useRouteError"),n=By("useRouteError");return t!==void 0?t:e.errors?.[n]}function q5(){let{router:t}=L5("useNavigate"),e=By("useNavigate"),n=D.useRef(!1);return bS(()=>{n.current=!0}),D.useCallback(async(i,o={})=>{jr(n.current,_S),n.current&&(typeof i=="number"?await t.navigate(i):await t.navigate(i,{fromRouteId:e,...o}))},[t,e])}var zx={};function wS(t,e,n){!e&&!zx[t]&&(zx[t]=!0,jr(!1,n))}D.memo(H5);function H5({routes:t,future:e,state:n,onError:r}){return vS(t,void 0,n,r,e)}function zf({to:t,replace:e,state:n,relative:r}){Xt(ec(),"<Navigate> may be used only in the context of a <Router> component.");let{static:i}=D.useContext(Rr);jr(!i,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:o}=D.useContext(Gr),{pathname:l}=Mn(),d=Gu(),h=Ny(t,My(o),l,r==="path"),m=JSON.stringify(h);return D.useEffect(()=>{d(JSON.parse(m),{replace:e,state:n,relative:r})},[d,m,r,e,n]),null}function Bf(t){return k5(t.context)}function Cn(t){Xt(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function G5({basename:t="/",children:e=null,location:n,navigationType:r="POP",navigator:i,static:o=!1,unstable_useTransitions:l}){Xt(!ec(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let d=t.replace(/^\/*/,"/"),h=D.useMemo(()=>({basename:d,navigator:i,static:o,unstable_useTransitions:l,future:{}}),[d,i,o,l]);typeof n=="string"&&(n=Zl(n));let{pathname:m="/",search:p="",hash:g="",state:v=null,key:_="default"}=n,C=D.useMemo(()=>{let x=yi(m,d);return x==null?null:{location:{pathname:x,search:p,hash:g,state:v,key:_},navigationType:r}},[d,m,p,g,v,_,r]);return jr(C!=null,`<Router basename="${d}"> is not able to match the URL "${m}${p}${g}" because it does not start with the basename, so the <Router> won't render anything.`),C==null?null:D.createElement(Rr.Provider,{value:h},D.createElement(Hu.Provider,{children:e,value:C}))}function Q5({children:t,location:e}){return O5(Yg(t),e)}function Yg(t,e=[]){let n=[];return D.Children.forEach(t,(r,i)=>{if(!D.isValidElement(r))return;let o=[...e,i];if(r.type===D.Fragment){n.push.apply(n,Yg(r.props.children,o));return}Xt(r.type===Cn,`[${typeof r.type=="string"?r.type:r.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),Xt(!r.props.index||!r.props.children,"An index route cannot have child routes.");let l={id:r.props.id||o.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,middleware:r.props.middleware,loader:r.props.loader,action:r.props.action,hydrateFallbackElement:r.props.hydrateFallbackElement,HydrateFallback:r.props.HydrateFallback,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.hasErrorBoundary===!0||r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(l.children=Yg(r.props.children,o)),n.push(l)}),n}var qh="get",Hh="application/x-www-form-urlencoded";function Lf(t){return typeof HTMLElement<"u"&&t instanceof HTMLElement}function W5(t){return Lf(t)&&t.tagName.toLowerCase()==="button"}function K5(t){return Lf(t)&&t.tagName.toLowerCase()==="form"}function Y5(t){return Lf(t)&&t.tagName.toLowerCase()==="input"}function X5(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function Z5(t,e){return t.button===0&&(!e||e==="_self")&&!X5(t)}function Xg(t=""){return new URLSearchParams(typeof t=="string"||Array.isArray(t)||t instanceof URLSearchParams?t:Object.keys(t).reduce((e,n)=>{let r=t[n];return e.concat(Array.isArray(r)?r.map(i=>[n,i]):[[n,r]])},[]))}function J5(t,e){let n=Xg(t);return e&&e.forEach((r,i)=>{n.has(i)||e.getAll(i).forEach(o=>{n.append(i,o)})}),n}var Mh=null;function ej(){if(Mh===null)try{new FormData(document.createElement("form"),0),Mh=!1}catch{Mh=!0}return Mh}var tj=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function Ag(t){return t!=null&&!tj.has(t)?(jr(!1,`"${t}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${Hh}"`),null):t}function nj(t,e){let n,r,i,o,l;if(K5(t)){let d=t.getAttribute("action");r=d?yi(d,e):null,n=t.getAttribute("method")||qh,i=Ag(t.getAttribute("enctype"))||Hh,o=new FormData(t)}else if(W5(t)||Y5(t)&&(t.type==="submit"||t.type==="image")){let d=t.form;if(d==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let h=t.getAttribute("formaction")||d.getAttribute("action");if(r=h?yi(h,e):null,n=t.getAttribute("formmethod")||d.getAttribute("method")||qh,i=Ag(t.getAttribute("formenctype"))||Ag(d.getAttribute("enctype"))||Hh,o=new FormData(d,t),!ej()){let{name:m,type:p,value:g}=t;if(p==="image"){let v=m?`${m}.`:"";o.append(`${v}x`,"0"),o.append(`${v}y`,"0")}else m&&o.append(m,g)}}else{if(Lf(t))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');n=qh,r=null,i=Hh,l=t}return o&&i==="text/plain"&&(l=o,o=void 0),{action:r,method:n.toLowerCase(),encType:i,formData:o,body:l}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function Ly(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function rj(t,e,n){let r=typeof t=="string"?new URL(t,typeof window>"u"?"server://singlefetch/":window.location.origin):t;return r.pathname==="/"?r.pathname=`_root.${n}`:e&&yi(r.pathname,e)==="/"?r.pathname=`${e.replace(/\/$/,"")}/_root.${n}`:r.pathname=`${r.pathname.replace(/\/$/,"")}.${n}`,r}async function sj(t,e){if(t.id in e)return e[t.id];try{let n=await import(t.module);return e[t.id]=n,n}catch(n){return console.error(`Error loading route module \`${t.module}\`, reloading page...`),console.error(n),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function ij(t){return t==null?!1:t.href==null?t.rel==="preload"&&typeof t.imageSrcSet=="string"&&typeof t.imageSizes=="string":typeof t.rel=="string"&&typeof t.href=="string"}async function aj(t,e,n){let r=await Promise.all(t.map(async i=>{let o=e.routes[i.route.id];if(o){let l=await sj(o,n);return l.links?l.links():[]}return[]}));return uj(r.flat(1).filter(ij).filter(i=>i.rel==="stylesheet"||i.rel==="preload").map(i=>i.rel==="stylesheet"?{...i,rel:"prefetch",as:"style"}:{...i,rel:"prefetch"}))}function Bx(t,e,n,r,i,o){let l=(h,m)=>n[m]?h.route.id!==n[m].route.id:!0,d=(h,m)=>n[m].pathname!==h.pathname||n[m].route.path?.endsWith("*")&&n[m].params["*"]!==h.params["*"];return o==="assets"?e.filter((h,m)=>l(h,m)||d(h,m)):o==="data"?e.filter((h,m)=>{let p=r.routes[h.route.id];if(!p||!p.hasLoader)return!1;if(l(h,m)||d(h,m))return!0;if(h.route.shouldRevalidate){let g=h.route.shouldRevalidate({currentUrl:new URL(i.pathname+i.search+i.hash,window.origin),currentParams:n[0]?.params||{},nextUrl:new URL(t,window.origin),nextParams:h.params,defaultShouldRevalidate:!0});if(typeof g=="boolean")return g}return!0}):[]}function oj(t,e,{includeHydrateFallback:n}={}){return lj(t.map(r=>{let i=e.routes[r.route.id];if(!i)return[];let o=[i.module];return i.clientActionModule&&(o=o.concat(i.clientActionModule)),i.clientLoaderModule&&(o=o.concat(i.clientLoaderModule)),n&&i.hydrateFallbackModule&&(o=o.concat(i.hydrateFallbackModule)),i.imports&&(o=o.concat(i.imports)),o}).flat(1))}function lj(t){return[...new Set(t)]}function cj(t){let e={},n=Object.keys(t).sort();for(let r of n)e[r]=t[r];return e}function uj(t,e){let n=new Set;return new Set(e),t.reduce((r,i)=>{let o=JSON.stringify(cj(i));return n.has(o)||(n.add(o),r.push({key:o,link:i})),r},[])}function SS(){let t=D.useContext(Jl);return Ly(t,"You must render this element inside a <DataRouterContext.Provider> element"),t}function dj(){let t=D.useContext(Pf);return Ly(t,"You must render this element inside a <DataRouterStateContext.Provider> element"),t}var Uy=D.createContext(void 0);Uy.displayName="FrameworkContext";function CS(){let t=D.useContext(Uy);return Ly(t,"You must render this element inside a <HydratedRouter> element"),t}function hj(t,e){let n=D.useContext(Uy),[r,i]=D.useState(!1),[o,l]=D.useState(!1),{onFocus:d,onBlur:h,onMouseEnter:m,onMouseLeave:p,onTouchStart:g}=e,v=D.useRef(null);D.useEffect(()=>{if(t==="render"&&l(!0),t==="viewport"){let x=E=>{E.forEach(T=>{l(T.isIntersecting)})},S=new IntersectionObserver(x,{threshold:.5});return v.current&&S.observe(v.current),()=>{S.disconnect()}}},[t]),D.useEffect(()=>{if(r){let x=setTimeout(()=>{l(!0)},100);return()=>{clearTimeout(x)}}},[r]);let _=()=>{i(!0)},C=()=>{i(!1),l(!1)};return n?t!=="intent"?[o,v,{}]:[o,v,{onFocus:yu(d,_),onBlur:yu(h,C),onMouseEnter:yu(m,_),onMouseLeave:yu(p,C),onTouchStart:yu(g,_)}]:[!1,v,{}]}function yu(t,e){return n=>{t&&t(n),n.defaultPrevented||e(n)}}function fj({page:t,...e}){let{router:n}=SS(),r=D.useMemo(()=>cS(n.routes,t,n.basename),[n.routes,t,n.basename]);return r?D.createElement(pj,{page:t,matches:r,...e}):null}function mj(t){let{manifest:e,routeModules:n}=CS(),[r,i]=D.useState([]);return D.useEffect(()=>{let o=!1;return aj(t,e,n).then(l=>{o||i(l)}),()=>{o=!0}},[t,e,n]),r}function pj({page:t,matches:e,...n}){let r=Mn(),{manifest:i,routeModules:o}=CS(),{basename:l}=SS(),{loaderData:d,matches:h}=dj(),m=D.useMemo(()=>Bx(t,e,h,i,r,"data"),[t,e,h,i,r]),p=D.useMemo(()=>Bx(t,e,h,i,r,"assets"),[t,e,h,i,r]),g=D.useMemo(()=>{if(t===r.pathname+r.search+r.hash)return[];let C=new Set,x=!1;if(e.forEach(E=>{let T=i.routes[E.route.id];!T||!T.hasLoader||(!m.some(I=>I.route.id===E.route.id)&&E.route.id in d&&o[E.route.id]?.shouldRevalidate||T.hasClientLoader?x=!0:C.add(E.route.id))}),C.size===0)return[];let S=rj(t,l,"data");return x&&C.size>0&&S.searchParams.set("_routes",e.filter(E=>C.has(E.route.id)).map(E=>E.route.id).join(",")),[S.pathname+S.search]},[l,d,r,i,m,e,t,o]),v=D.useMemo(()=>oj(p,i),[p,i]),_=mj(p);return D.createElement(D.Fragment,null,g.map(C=>D.createElement("link",{key:C,rel:"prefetch",as:"fetch",href:C,...n})),v.map(C=>D.createElement("link",{key:C,rel:"modulepreload",href:C,...n})),_.map(({key:C,link:x})=>D.createElement("link",{key:C,nonce:n.nonce,...x})))}function gj(...t){return e=>{t.forEach(n=>{typeof n=="function"?n(e):n!=null&&(n.current=e)})}}var yj=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{yj&&(window.__reactRouterVersion="7.11.0")}catch{}function _j({basename:t,children:e,unstable_useTransitions:n,window:r}){let i=D.useRef();i.current==null&&(i.current=W2({window:r,v5Compat:!0}));let o=i.current,[l,d]=D.useState({action:o.action,location:o.location}),h=D.useCallback(m=>{n===!1?d(m):D.startTransition(()=>d(m))},[n]);return D.useLayoutEffect(()=>o.listen(h),[o,h]),D.createElement(G5,{basename:t,children:e,location:l.location,navigationType:l.action,navigator:o,unstable_useTransitions:n})}var ES=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Tn=D.forwardRef(function({onClick:e,discover:n="render",prefetch:r="none",relative:i,reloadDocument:o,replace:l,state:d,target:h,to:m,preventScrollReset:p,viewTransition:g,unstable_defaultShouldRevalidate:v,..._},C){let{basename:x,unstable_useTransitions:S}=D.useContext(Rr),E=typeof m=="string"&&ES.test(m),T=mS(m,x);m=T.to;let I=j5(m,{relative:i}),[M,L,$]=hj(r,_),k=wj(m,{replace:l,state:d,target:h,preventScrollReset:p,relative:i,viewTransition:g,unstable_defaultShouldRevalidate:v,unstable_useTransitions:S});function A(F){e&&e(F),F.defaultPrevented||k(F)}let N=D.createElement("a",{..._,...$,href:T.absoluteURL||I,onClick:T.isExternal||o?e:A,ref:gj(C,L),target:h,"data-discover":!E&&n==="render"?"true":void 0});return M&&!E?D.createElement(D.Fragment,null,N,D.createElement(fj,{page:I})):N});Tn.displayName="Link";var bj=D.forwardRef(function({"aria-current":e="page",caseSensitive:n=!1,className:r="",end:i=!1,style:o,to:l,viewTransition:d,children:h,...m},p){let g=Qu(l,{relative:m.relative}),v=Mn(),_=D.useContext(Pf),{navigator:C,basename:x}=D.useContext(Rr),S=_!=null&&Aj(g)&&d===!0,E=C.encodeLocation?C.encodeLocation(g).pathname:g.pathname,T=v.pathname,I=_&&_.navigation&&_.navigation.location?_.navigation.location.pathname:null;n||(T=T.toLowerCase(),I=I?I.toLowerCase():null,E=E.toLowerCase()),I&&x&&(I=yi(I,x)||I);const M=E!=="/"&&E.endsWith("/")?E.length-1:E.length;let L=T===E||!i&&T.startsWith(E)&&T.charAt(M)==="/",$=I!=null&&(I===E||!i&&I.startsWith(E)&&I.charAt(E.length)==="/"),k={isActive:L,isPending:$,isTransitioning:S},A=L?e:void 0,N;typeof r=="function"?N=r(k):N=[r,L?"active":null,$?"pending":null,S?"transitioning":null].filter(Boolean).join(" ");let F=typeof o=="function"?o(k):o;return D.createElement(Tn,{...m,"aria-current":A,className:N,ref:p,style:F,to:l,viewTransition:d},typeof h=="function"?h(k):h)});bj.displayName="NavLink";var vj=D.forwardRef(({discover:t="render",fetcherKey:e,navigate:n,reloadDocument:r,replace:i,state:o,method:l=qh,action:d,onSubmit:h,relative:m,preventScrollReset:p,viewTransition:g,unstable_defaultShouldRevalidate:v,..._},C)=>{let{unstable_useTransitions:x}=D.useContext(Rr),S=Ej(),E=Tj(d,{relative:m}),T=l.toLowerCase()==="get"?"get":"post",I=typeof d=="string"&&ES.test(d),M=L=>{if(h&&h(L),L.defaultPrevented)return;L.preventDefault();let $=L.nativeEvent.submitter,k=$?.getAttribute("formmethod")||l,A=()=>S($||L.currentTarget,{fetcherKey:e,method:k,navigate:n,replace:i,state:o,relative:m,preventScrollReset:p,viewTransition:g,unstable_defaultShouldRevalidate:v});x&&n!==!1?D.startTransition(()=>A()):A()};return D.createElement("form",{ref:C,method:T,action:E,onSubmit:r?h:M,..._,"data-discover":!I&&t==="render"?"true":void 0})});vj.displayName="Form";function xj(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function TS(t){let e=D.useContext(Jl);return Xt(e,xj(t)),e}function wj(t,{target:e,replace:n,state:r,preventScrollReset:i,relative:o,viewTransition:l,unstable_defaultShouldRevalidate:d,unstable_useTransitions:h}={}){let m=Gu(),p=Mn(),g=Qu(t,{relative:o});return D.useCallback(v=>{if(Z5(v,e)){v.preventDefault();let _=n!==void 0?n:Iu(p)===Iu(g),C=()=>m(t,{replace:_,state:r,preventScrollReset:i,relative:o,viewTransition:l,unstable_defaultShouldRevalidate:d});h?D.startTransition(()=>C()):C()}},[p,m,g,n,r,e,t,i,o,l,d,h])}function AS(t){jr(typeof URLSearchParams<"u","You cannot use the `useSearchParams` hook in a browser that does not support the URLSearchParams API. If you need to support Internet Explorer 11, we recommend you load a polyfill such as https://github.com/ungap/url-search-params.");let e=D.useRef(Xg(t)),n=D.useRef(!1),r=Mn(),i=D.useMemo(()=>J5(r.search,n.current?null:e.current),[r.search]),o=Gu(),l=D.useCallback((d,h)=>{const m=Xg(typeof d=="function"?d(new URLSearchParams(i)):d);n.current=!0,o("?"+m,h)},[o,i]);return[i,l]}var Sj=0,Cj=()=>`__${String(++Sj)}__`;function Ej(){let{router:t}=TS("useSubmit"),{basename:e}=D.useContext(Rr),n=V5(),r=t.fetch,i=t.navigate;return D.useCallback(async(o,l={})=>{let{action:d,method:h,encType:m,formData:p,body:g}=nj(o,e);if(l.navigate===!1){let v=l.fetcherKey||Cj();await r(v,n,l.action||d,{unstable_defaultShouldRevalidate:l.unstable_defaultShouldRevalidate,preventScrollReset:l.preventScrollReset,formData:p,body:g,formMethod:l.method||h,formEncType:l.encType||m,flushSync:l.flushSync})}else await i(l.action||d,{unstable_defaultShouldRevalidate:l.unstable_defaultShouldRevalidate,preventScrollReset:l.preventScrollReset,formData:p,body:g,formMethod:l.method||h,formEncType:l.encType||m,replace:l.replace,state:l.state,fromRouteId:n,flushSync:l.flushSync,viewTransition:l.viewTransition})},[r,i,e,n])}function Tj(t,{relative:e}={}){let{basename:n}=D.useContext(Rr),r=D.useContext(Gr);Xt(r,"useFormAction must be used inside a RouteContext");let[i]=r.matches.slice(-1),o={...Qu(t||".",{relative:e})},l=Mn();if(t==null){o.search=l.search;let d=new URLSearchParams(o.search),h=d.getAll("index");if(h.some(p=>p==="")){d.delete("index"),h.filter(g=>g).forEach(g=>d.append("index",g));let p=d.toString();o.search=p?`?${p}`:""}}return(!t||t===".")&&i.route.index&&(o.search=o.search?o.search.replace(/^\?/,"?index&"):"?index"),n!=="/"&&(o.pathname=o.pathname==="/"?n:pi([n,o.pathname])),Iu(o)}function Aj(t,{relative:e}={}){let n=D.useContext(gS);Xt(n!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:r}=TS("useViewTransitionState"),i=Qu(t,{relative:e});if(!n.isTransitioning)return!1;let o=yi(n.currentLocation.pathname,r)||n.currentLocation.pathname,l=yi(n.nextLocation.pathname,r)||n.nextLocation.pathname;return nf(i.pathname,l)!=null||nf(i.pathname,o)!=null}var tc=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(t){return this.listeners.add(t),this.onSubscribe(),()=>{this.listeners.delete(t),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},jj={setTimeout:(t,e)=>setTimeout(t,e),clearTimeout:t=>clearTimeout(t),setInterval:(t,e)=>setInterval(t,e),clearInterval:t=>clearInterval(t)},Rj=class{#e=jj;#t=!1;setTimeoutProvider(t){this.#e=t}setTimeout(t,e){return this.#e.setTimeout(t,e)}clearTimeout(t){this.#e.clearTimeout(t)}setInterval(t,e){return this.#e.setInterval(t,e)}clearInterval(t){this.#e.clearInterval(t)}},bo=new Rj;function Ij(t){setTimeout(t,0)}var Eo=typeof window>"u"||"Deno"in globalThis;function sr(){}function kj(t,e){return typeof t=="function"?t(e):t}function Zg(t){return typeof t=="number"&&t>=0&&t!==1/0}function jS(t,e){return Math.max(t+(e||0)-Date.now(),0)}function pa(t,e){return typeof t=="function"?t(e):t}function $r(t,e){return typeof t=="function"?t(e):t}function Lx(t,e){const{type:n="all",exact:r,fetchStatus:i,predicate:o,queryKey:l,stale:d}=t;if(l){if(r){if(e.queryHash!==Fy(l,e.options))return!1}else if(!ku(e.queryKey,l))return!1}if(n!=="all"){const h=e.isActive();if(n==="active"&&!h||n==="inactive"&&h)return!1}return!(typeof d=="boolean"&&e.isStale()!==d||i&&i!==e.state.fetchStatus||o&&!o(e))}function Ux(t,e){const{exact:n,status:r,predicate:i,mutationKey:o}=t;if(o){if(!e.options.mutationKey)return!1;if(n){if(To(e.options.mutationKey)!==To(o))return!1}else if(!ku(e.options.mutationKey,o))return!1}return!(r&&e.state.status!==r||i&&!i(e))}function Fy(t,e){return(e?.queryKeyHashFn||To)(t)}function To(t){return JSON.stringify(t,(e,n)=>Jg(n)?Object.keys(n).sort().reduce((r,i)=>(r[i]=n[i],r),{}):n)}function ku(t,e){return t===e?!0:typeof t!=typeof e?!1:t&&e&&typeof t=="object"&&typeof e=="object"?Object.keys(e).every(n=>ku(t[n],e[n])):!1}var Dj=Object.prototype.hasOwnProperty;function RS(t,e){if(t===e)return t;const n=Fx(t)&&Fx(e);if(!n&&!(Jg(t)&&Jg(e)))return e;const i=(n?t:Object.keys(t)).length,o=n?e:Object.keys(e),l=o.length,d=n?new Array(l):{};let h=0;for(let m=0;m<l;m++){const p=n?m:o[m],g=t[p],v=e[p];if(g===v){d[p]=g,(n?m<i:Dj.call(t,p))&&h++;continue}if(g===null||v===null||typeof g!="object"||typeof v!="object"){d[p]=v;continue}const _=RS(g,v);d[p]=_,_===g&&h++}return i===l&&h===i?t:d}function rf(t,e){if(!e||Object.keys(t).length!==Object.keys(e).length)return!1;for(const n in t)if(t[n]!==e[n])return!1;return!0}function Fx(t){return Array.isArray(t)&&t.length===Object.keys(t).length}function Jg(t){if(!Vx(t))return!1;const e=t.constructor;if(e===void 0)return!0;const n=e.prototype;return!(!Vx(n)||!n.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(t)!==Object.prototype)}function Vx(t){return Object.prototype.toString.call(t)==="[object Object]"}function Oj(t){return new Promise(e=>{bo.setTimeout(e,t)})}function ey(t,e,n){return typeof n.structuralSharing=="function"?n.structuralSharing(t,e):n.structuralSharing!==!1?RS(t,e):e}function Mj(t,e,n=0){const r=[...t,e];return n&&r.length>n?r.slice(1):r}function Nj(t,e,n=0){const r=[e,...t];return n&&r.length>n?r.slice(0,-1):r}var Vy=Symbol();function IS(t,e){return!t.queryFn&&e?.initialPromise?()=>e.initialPromise:!t.queryFn||t.queryFn===Vy?()=>Promise.reject(new Error(`Missing queryFn: '${t.queryHash}'`)):t.queryFn}function kS(t,e){return typeof t=="function"?t(...e):!!t}var Pj=class extends tc{#e;#t;#n;constructor(){super(),this.#n=t=>{if(!Eo&&window.addEventListener){const e=()=>t();return window.addEventListener("visibilitychange",e,!1),()=>{window.removeEventListener("visibilitychange",e)}}}}onSubscribe(){this.#t||this.setEventListener(this.#n)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(t){this.#n=t,this.#t?.(),this.#t=t(e=>{typeof e=="boolean"?this.setFocused(e):this.onFocus()})}setFocused(t){this.#e!==t&&(this.#e=t,this.onFocus())}onFocus(){const t=this.isFocused();this.listeners.forEach(e=>{e(t)})}isFocused(){return typeof this.#e=="boolean"?this.#e:globalThis.document?.visibilityState!=="hidden"}},$y=new Pj;function ty(){let t,e;const n=new Promise((i,o)=>{t=i,e=o});n.status="pending",n.catch(()=>{});function r(i){Object.assign(n,i),delete n.resolve,delete n.reject}return n.resolve=i=>{r({status:"fulfilled",value:i}),t(i)},n.reject=i=>{r({status:"rejected",reason:i}),e(i)},n}var zj=Ij;function Bj(){let t=[],e=0,n=d=>{d()},r=d=>{d()},i=zj;const o=d=>{e?t.push(d):i(()=>{n(d)})},l=()=>{const d=t;t=[],d.length&&i(()=>{r(()=>{d.forEach(h=>{n(h)})})})};return{batch:d=>{let h;e++;try{h=d()}finally{e--,e||l()}return h},batchCalls:d=>(...h)=>{o(()=>{d(...h)})},schedule:o,setNotifyFunction:d=>{n=d},setBatchNotifyFunction:d=>{r=d},setScheduler:d=>{i=d}}}var En=Bj(),Lj=class extends tc{#e=!0;#t;#n;constructor(){super(),this.#n=t=>{if(!Eo&&window.addEventListener){const e=()=>t(!0),n=()=>t(!1);return window.addEventListener("online",e,!1),window.addEventListener("offline",n,!1),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",n)}}}}onSubscribe(){this.#t||this.setEventListener(this.#n)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(t){this.#n=t,this.#t?.(),this.#t=t(this.setOnline.bind(this))}setOnline(t){this.#e!==t&&(this.#e=t,this.listeners.forEach(n=>{n(t)}))}isOnline(){return this.#e}},sf=new Lj;function Uj(t){return Math.min(1e3*2**t,3e4)}function DS(t){return(t??"online")==="online"?sf.isOnline():!0}var ny=class extends Error{constructor(t){super("CancelledError"),this.revert=t?.revert,this.silent=t?.silent}};function OS(t){let e=!1,n=0,r;const i=ty(),o=()=>i.status!=="pending",l=x=>{if(!o()){const S=new ny(x);v(S),t.onCancel?.(S)}},d=()=>{e=!0},h=()=>{e=!1},m=()=>$y.isFocused()&&(t.networkMode==="always"||sf.isOnline())&&t.canRun(),p=()=>DS(t.networkMode)&&t.canRun(),g=x=>{o()||(r?.(),i.resolve(x))},v=x=>{o()||(r?.(),i.reject(x))},_=()=>new Promise(x=>{r=S=>{(o()||m())&&x(S)},t.onPause?.()}).then(()=>{r=void 0,o()||t.onContinue?.()}),C=()=>{if(o())return;let x;const S=n===0?t.initialPromise:void 0;try{x=S??t.fn()}catch(E){x=Promise.reject(E)}Promise.resolve(x).then(g).catch(E=>{if(o())return;const T=t.retry??(Eo?0:3),I=t.retryDelay??Uj,M=typeof I=="function"?I(n,E):I,L=T===!0||typeof T=="number"&&n<T||typeof T=="function"&&T(n,E);if(e||!L){v(E);return}n++,t.onFail?.(n,E),Oj(M).then(()=>m()?void 0:_()).then(()=>{e?v(E):C()})})};return{promise:i,status:()=>i.status,cancel:l,continue:()=>(r?.(),i),cancelRetry:d,continueRetry:h,canStart:p,start:()=>(p()?C():_().then(C),i)}}var MS=class{#e;destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),Zg(this.gcTime)&&(this.#e=bo.setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(t){this.gcTime=Math.max(this.gcTime||0,t??(Eo?1/0:300*1e3))}clearGcTimeout(){this.#e&&(bo.clearTimeout(this.#e),this.#e=void 0)}},Fj=class extends MS{#e;#t;#n;#s;#r;#a;#o;constructor(e){super(),this.#o=!1,this.#a=e.defaultOptions,this.setOptions(e.options),this.observers=[],this.#s=e.client,this.#n=this.#s.getQueryCache(),this.queryKey=e.queryKey,this.queryHash=e.queryHash,this.#e=qx(this.options),this.state=e.state??this.#e,this.scheduleGc()}get meta(){return this.options.meta}get promise(){return this.#r?.promise}setOptions(e){if(this.options={...this.#a,...e},this.updateGcTime(this.options.gcTime),this.state&&this.state.data===void 0){const n=qx(this.options);n.data!==void 0&&(this.setState($x(n.data,n.dataUpdatedAt)),this.#e=n)}}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&this.#n.remove(this)}setData(e,n){const r=ey(this.state.data,e,this.options);return this.#i({data:r,type:"success",dataUpdatedAt:n?.updatedAt,manual:n?.manual}),r}setState(e,n){this.#i({type:"setState",state:e,setStateOptions:n})}cancel(e){const n=this.#r?.promise;return this.#r?.cancel(e),n?n.then(sr).catch(sr):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(this.#e)}isActive(){return this.observers.some(e=>$r(e.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===Vy||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(e=>pa(e.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(e=>e.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(e=0){return this.state.data===void 0?!0:e==="static"?!1:this.state.isInvalidated?!0:!jS(this.state.dataUpdatedAt,e)}onFocus(){this.observers.find(n=>n.shouldFetchOnWindowFocus())?.refetch({cancelRefetch:!1}),this.#r?.continue()}onOnline(){this.observers.find(n=>n.shouldFetchOnReconnect())?.refetch({cancelRefetch:!1}),this.#r?.continue()}addObserver(e){this.observers.includes(e)||(this.observers.push(e),this.clearGcTimeout(),this.#n.notify({type:"observerAdded",query:this,observer:e}))}removeObserver(e){this.observers.includes(e)&&(this.observers=this.observers.filter(n=>n!==e),this.observers.length||(this.#r&&(this.#o?this.#r.cancel({revert:!0}):this.#r.cancelRetry()),this.scheduleGc()),this.#n.notify({type:"observerRemoved",query:this,observer:e}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||this.#i({type:"invalidate"})}async fetch(e,n){if(this.state.fetchStatus!=="idle"&&this.#r?.status()!=="rejected"){if(this.state.data!==void 0&&n?.cancelRefetch)this.cancel({silent:!0});else if(this.#r)return this.#r.continueRetry(),this.#r.promise}if(e&&this.setOptions(e),!this.options.queryFn){const h=this.observers.find(m=>m.options.queryFn);h&&this.setOptions(h.options)}const r=new AbortController,i=h=>{Object.defineProperty(h,"signal",{enumerable:!0,get:()=>(this.#o=!0,r.signal)})},o=()=>{const h=IS(this.options,n),p=(()=>{const g={client:this.#s,queryKey:this.queryKey,meta:this.meta};return i(g),g})();return this.#o=!1,this.options.persister?this.options.persister(h,p,this):h(p)},d=(()=>{const h={fetchOptions:n,options:this.options,queryKey:this.queryKey,client:this.#s,state:this.state,fetchFn:o};return i(h),h})();this.options.behavior?.onFetch(d,this),this.#t=this.state,(this.state.fetchStatus==="idle"||this.state.fetchMeta!==d.fetchOptions?.meta)&&this.#i({type:"fetch",meta:d.fetchOptions?.meta}),this.#r=OS({initialPromise:n?.initialPromise,fn:d.fetchFn,onCancel:h=>{h instanceof ny&&h.revert&&this.setState({...this.#t,fetchStatus:"idle"}),r.abort()},onFail:(h,m)=>{this.#i({type:"failed",failureCount:h,error:m})},onPause:()=>{this.#i({type:"pause"})},onContinue:()=>{this.#i({type:"continue"})},retry:d.options.retry,retryDelay:d.options.retryDelay,networkMode:d.options.networkMode,canRun:()=>!0});try{const h=await this.#r.start();if(h===void 0)throw new Error(`${this.queryHash} data is undefined`);return this.setData(h),this.#n.config.onSuccess?.(h,this),this.#n.config.onSettled?.(h,this.state.error,this),h}catch(h){if(h instanceof ny){if(h.silent)return this.#r.promise;if(h.revert){if(this.state.data===void 0)throw h;return this.state.data}}throw this.#i({type:"error",error:h}),this.#n.config.onError?.(h,this),this.#n.config.onSettled?.(this.state.data,h,this),h}finally{this.scheduleGc()}}#i(e){const n=r=>{switch(e.type){case"failed":return{...r,fetchFailureCount:e.failureCount,fetchFailureReason:e.error};case"pause":return{...r,fetchStatus:"paused"};case"continue":return{...r,fetchStatus:"fetching"};case"fetch":return{...r,...NS(r.data,this.options),fetchMeta:e.meta??null};case"success":const i={...r,...$x(e.data,e.dataUpdatedAt),dataUpdateCount:r.dataUpdateCount+1,...!e.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return this.#t=e.manual?i:void 0,i;case"error":const o=e.error;return{...r,error:o,errorUpdateCount:r.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:r.fetchFailureCount+1,fetchFailureReason:o,fetchStatus:"idle",status:"error"};case"invalidate":return{...r,isInvalidated:!0};case"setState":return{...r,...e.state}}};this.state=n(this.state),En.batch(()=>{this.observers.forEach(r=>{r.onQueryUpdate()}),this.#n.notify({query:this,type:"updated",action:e})})}};function NS(t,e){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:DS(e.networkMode)?"fetching":"paused",...t===void 0&&{error:null,status:"pending"}}}function $x(t,e){return{data:t,dataUpdatedAt:e??Date.now(),error:null,isInvalidated:!1,status:"success"}}function qx(t){const e=typeof t.initialData=="function"?t.initialData():t.initialData,n=e!==void 0,r=n?typeof t.initialDataUpdatedAt=="function"?t.initialDataUpdatedAt():t.initialDataUpdatedAt:0;return{data:e,dataUpdateCount:0,dataUpdatedAt:n?r??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:n?"success":"pending",fetchStatus:"idle"}}var Vj=class extends tc{constructor(t,e){super(),this.options=e,this.#e=t,this.#i=null,this.#o=ty(),this.bindMethods(),this.setOptions(e)}#e;#t=void 0;#n=void 0;#s=void 0;#r;#a;#o;#i;#p;#h;#f;#c;#u;#l;#m=new Set;bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(this.#t.addObserver(this),Hx(this.#t,this.options)?this.#d():this.updateResult(),this.#b())}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return ry(this.#t,this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return ry(this.#t,this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,this.#v(),this.#x(),this.#t.removeObserver(this)}setOptions(t){const e=this.options,n=this.#t;if(this.options=this.#e.defaultQueryOptions(t),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof $r(this.options.enabled,this.#t)!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");this.#w(),this.#t.setOptions(this.options),e._defaulted&&!rf(this.options,e)&&this.#e.getQueryCache().notify({type:"observerOptionsUpdated",query:this.#t,observer:this});const r=this.hasListeners();r&&Gx(this.#t,n,this.options,e)&&this.#d(),this.updateResult(),r&&(this.#t!==n||$r(this.options.enabled,this.#t)!==$r(e.enabled,this.#t)||pa(this.options.staleTime,this.#t)!==pa(e.staleTime,this.#t))&&this.#g();const i=this.#y();r&&(this.#t!==n||$r(this.options.enabled,this.#t)!==$r(e.enabled,this.#t)||i!==this.#l)&&this.#_(i)}getOptimisticResult(t){const e=this.#e.getQueryCache().build(this.#e,t),n=this.createResult(e,t);return qj(this,n)&&(this.#s=n,this.#a=this.options,this.#r=this.#t.state),n}getCurrentResult(){return this.#s}trackResult(t,e){return new Proxy(t,{get:(n,r)=>(this.trackProp(r),e?.(r),r==="promise"&&(this.trackProp("data"),!this.options.experimental_prefetchInRender&&this.#o.status==="pending"&&this.#o.reject(new Error("experimental_prefetchInRender feature flag is not enabled"))),Reflect.get(n,r))})}trackProp(t){this.#m.add(t)}getCurrentQuery(){return this.#t}refetch({...t}={}){return this.fetch({...t})}fetchOptimistic(t){const e=this.#e.defaultQueryOptions(t),n=this.#e.getQueryCache().build(this.#e,e);return n.fetch().then(()=>this.createResult(n,e))}fetch(t){return this.#d({...t,cancelRefetch:t.cancelRefetch??!0}).then(()=>(this.updateResult(),this.#s))}#d(t){this.#w();let e=this.#t.fetch(this.options,t);return t?.throwOnError||(e=e.catch(sr)),e}#g(){this.#v();const t=pa(this.options.staleTime,this.#t);if(Eo||this.#s.isStale||!Zg(t))return;const n=jS(this.#s.dataUpdatedAt,t)+1;this.#c=bo.setTimeout(()=>{this.#s.isStale||this.updateResult()},n)}#y(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(this.#t):this.options.refetchInterval)??!1}#_(t){this.#x(),this.#l=t,!(Eo||$r(this.options.enabled,this.#t)===!1||!Zg(this.#l)||this.#l===0)&&(this.#u=bo.setInterval(()=>{(this.options.refetchIntervalInBackground||$y.isFocused())&&this.#d()},this.#l))}#b(){this.#g(),this.#_(this.#y())}#v(){this.#c&&(bo.clearTimeout(this.#c),this.#c=void 0)}#x(){this.#u&&(bo.clearInterval(this.#u),this.#u=void 0)}createResult(t,e){const n=this.#t,r=this.options,i=this.#s,o=this.#r,l=this.#a,h=t!==n?t.state:this.#n,{state:m}=t;let p={...m},g=!1,v;if(e._optimisticResults){const A=this.hasListeners(),N=!A&&Hx(t,e),F=A&&Gx(t,n,e,r);(N||F)&&(p={...p,...NS(m.data,t.options)}),e._optimisticResults==="isRestoring"&&(p.fetchStatus="idle")}let{error:_,errorUpdatedAt:C,status:x}=p;v=p.data;let S=!1;if(e.placeholderData!==void 0&&v===void 0&&x==="pending"){let A;i?.isPlaceholderData&&e.placeholderData===l?.placeholderData?(A=i.data,S=!0):A=typeof e.placeholderData=="function"?e.placeholderData(this.#f?.state.data,this.#f):e.placeholderData,A!==void 0&&(x="success",v=ey(i?.data,A,e),g=!0)}if(e.select&&v!==void 0&&!S)if(i&&v===o?.data&&e.select===this.#p)v=this.#h;else try{this.#p=e.select,v=e.select(v),v=ey(i?.data,v,e),this.#h=v,this.#i=null}catch(A){this.#i=A}this.#i&&(_=this.#i,v=this.#h,C=Date.now(),x="error");const E=p.fetchStatus==="fetching",T=x==="pending",I=x==="error",M=T&&E,L=v!==void 0,k={status:x,fetchStatus:p.fetchStatus,isPending:T,isSuccess:x==="success",isError:I,isInitialLoading:M,isLoading:M,data:v,dataUpdatedAt:p.dataUpdatedAt,error:_,errorUpdatedAt:C,failureCount:p.fetchFailureCount,failureReason:p.fetchFailureReason,errorUpdateCount:p.errorUpdateCount,isFetched:p.dataUpdateCount>0||p.errorUpdateCount>0,isFetchedAfterMount:p.dataUpdateCount>h.dataUpdateCount||p.errorUpdateCount>h.errorUpdateCount,isFetching:E,isRefetching:E&&!T,isLoadingError:I&&!L,isPaused:p.fetchStatus==="paused",isPlaceholderData:g,isRefetchError:I&&L,isStale:qy(t,e),refetch:this.refetch,promise:this.#o,isEnabled:$r(e.enabled,t)!==!1};if(this.options.experimental_prefetchInRender){const A=q=>{k.status==="error"?q.reject(k.error):k.data!==void 0&&q.resolve(k.data)},N=()=>{const q=this.#o=k.promise=ty();A(q)},F=this.#o;switch(F.status){case"pending":t.queryHash===n.queryHash&&A(F);break;case"fulfilled":(k.status==="error"||k.data!==F.value)&&N();break;case"rejected":(k.status!=="error"||k.error!==F.reason)&&N();break}}return k}updateResult(){const t=this.#s,e=this.createResult(this.#t,this.options);if(this.#r=this.#t.state,this.#a=this.options,this.#r.data!==void 0&&(this.#f=this.#t),rf(e,t))return;this.#s=e;const n=()=>{if(!t)return!0;const{notifyOnChangeProps:r}=this.options,i=typeof r=="function"?r():r;if(i==="all"||!i&&!this.#m.size)return!0;const o=new Set(i??this.#m);return this.options.throwOnError&&o.add("error"),Object.keys(this.#s).some(l=>{const d=l;return this.#s[d]!==t[d]&&o.has(d)})};this.#S({listeners:n()})}#w(){const t=this.#e.getQueryCache().build(this.#e,this.options);if(t===this.#t)return;const e=this.#t;this.#t=t,this.#n=t.state,this.hasListeners()&&(e?.removeObserver(this),t.addObserver(this))}onQueryUpdate(){this.updateResult(),this.hasListeners()&&this.#b()}#S(t){En.batch(()=>{t.listeners&&this.listeners.forEach(e=>{e(this.#s)}),this.#e.getQueryCache().notify({query:this.#t,type:"observerResultsUpdated"})})}};function $j(t,e){return $r(e.enabled,t)!==!1&&t.state.data===void 0&&!(t.state.status==="error"&&e.retryOnMount===!1)}function Hx(t,e){return $j(t,e)||t.state.data!==void 0&&ry(t,e,e.refetchOnMount)}function ry(t,e,n){if($r(e.enabled,t)!==!1&&pa(e.staleTime,t)!=="static"){const r=typeof n=="function"?n(t):n;return r==="always"||r!==!1&&qy(t,e)}return!1}function Gx(t,e,n,r){return(t!==e||$r(r.enabled,t)===!1)&&(!n.suspense||t.state.status!=="error")&&qy(t,n)}function qy(t,e){return $r(e.enabled,t)!==!1&&t.isStaleByTime(pa(e.staleTime,t))}function qj(t,e){return!rf(t.getCurrentResult(),e)}function Qx(t){return{onFetch:(e,n)=>{const r=e.options,i=e.fetchOptions?.meta?.fetchMore?.direction,o=e.state.data?.pages||[],l=e.state.data?.pageParams||[];let d={pages:[],pageParams:[]},h=0;const m=async()=>{let p=!1;const g=C=>{Object.defineProperty(C,"signal",{enumerable:!0,get:()=>(e.signal.aborted?p=!0:e.signal.addEventListener("abort",()=>{p=!0}),e.signal)})},v=IS(e.options,e.fetchOptions),_=async(C,x,S)=>{if(p)return Promise.reject();if(x==null&&C.pages.length)return Promise.resolve(C);const T=(()=>{const $={client:e.client,queryKey:e.queryKey,pageParam:x,direction:S?"backward":"forward",meta:e.options.meta};return g($),$})(),I=await v(T),{maxPages:M}=e.options,L=S?Nj:Mj;return{pages:L(C.pages,I,M),pageParams:L(C.pageParams,x,M)}};if(i&&o.length){const C=i==="backward",x=C?Hj:Wx,S={pages:o,pageParams:l},E=x(r,S);d=await _(S,E,C)}else{const C=t??o.length;do{const x=h===0?l[0]??r.initialPageParam:Wx(r,d);if(h>0&&x==null)break;d=await _(d,x),h++}while(h<C)}return d};e.options.persister?e.fetchFn=()=>e.options.persister?.(m,{client:e.client,queryKey:e.queryKey,meta:e.options.meta,signal:e.signal},n):e.fetchFn=m}}}function Wx(t,{pages:e,pageParams:n}){const r=e.length-1;return e.length>0?t.getNextPageParam(e[r],e,n[r],n):void 0}function Hj(t,{pages:e,pageParams:n}){return e.length>0?t.getPreviousPageParam?.(e[0],e,n[0],n):void 0}var Gj=class extends MS{#e;#t;#n;#s;constructor(e){super(),this.#e=e.client,this.mutationId=e.mutationId,this.#n=e.mutationCache,this.#t=[],this.state=e.state||PS(),this.setOptions(e.options),this.scheduleGc()}setOptions(e){this.options=e,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(e){this.#t.includes(e)||(this.#t.push(e),this.clearGcTimeout(),this.#n.notify({type:"observerAdded",mutation:this,observer:e}))}removeObserver(e){this.#t=this.#t.filter(n=>n!==e),this.scheduleGc(),this.#n.notify({type:"observerRemoved",mutation:this,observer:e})}optionalRemove(){this.#t.length||(this.state.status==="pending"?this.scheduleGc():this.#n.remove(this))}continue(){return this.#s?.continue()??this.execute(this.state.variables)}async execute(e){const n=()=>{this.#r({type:"continue"})},r={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};this.#s=OS({fn:()=>this.options.mutationFn?this.options.mutationFn(e,r):Promise.reject(new Error("No mutationFn found")),onFail:(l,d)=>{this.#r({type:"failed",failureCount:l,error:d})},onPause:()=>{this.#r({type:"pause"})},onContinue:n,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>this.#n.canRun(this)});const i=this.state.status==="pending",o=!this.#s.canStart();try{if(i)n();else{this.#r({type:"pending",variables:e,isPaused:o}),await this.#n.config.onMutate?.(e,this,r);const d=await this.options.onMutate?.(e,r);d!==this.state.context&&this.#r({type:"pending",context:d,variables:e,isPaused:o})}const l=await this.#s.start();return await this.#n.config.onSuccess?.(l,e,this.state.context,this,r),await this.options.onSuccess?.(l,e,this.state.context,r),await this.#n.config.onSettled?.(l,null,this.state.variables,this.state.context,this,r),await this.options.onSettled?.(l,null,e,this.state.context,r),this.#r({type:"success",data:l}),l}catch(l){try{throw await this.#n.config.onError?.(l,e,this.state.context,this,r),await this.options.onError?.(l,e,this.state.context,r),await this.#n.config.onSettled?.(void 0,l,this.state.variables,this.state.context,this,r),await this.options.onSettled?.(void 0,l,e,this.state.context,r),l}finally{this.#r({type:"error",error:l})}}finally{this.#n.runNext(this)}}#r(e){const n=r=>{switch(e.type){case"failed":return{...r,failureCount:e.failureCount,failureReason:e.error};case"pause":return{...r,isPaused:!0};case"continue":return{...r,isPaused:!1};case"pending":return{...r,context:e.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:e.isPaused,status:"pending",variables:e.variables,submittedAt:Date.now()};case"success":return{...r,data:e.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...r,data:void 0,error:e.error,failureCount:r.failureCount+1,failureReason:e.error,isPaused:!1,status:"error"}}};this.state=n(this.state),En.batch(()=>{this.#t.forEach(r=>{r.onMutationUpdate(e)}),this.#n.notify({mutation:this,type:"updated",action:e})})}};function PS(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var Qj=class extends tc{constructor(t={}){super(),this.config=t,this.#e=new Set,this.#t=new Map,this.#n=0}#e;#t;#n;build(t,e,n){const r=new Gj({client:t,mutationCache:this,mutationId:++this.#n,options:t.defaultMutationOptions(e),state:n});return this.add(r),r}add(t){this.#e.add(t);const e=Nh(t);if(typeof e=="string"){const n=this.#t.get(e);n?n.push(t):this.#t.set(e,[t])}this.notify({type:"added",mutation:t})}remove(t){if(this.#e.delete(t)){const e=Nh(t);if(typeof e=="string"){const n=this.#t.get(e);if(n)if(n.length>1){const r=n.indexOf(t);r!==-1&&n.splice(r,1)}else n[0]===t&&this.#t.delete(e)}}this.notify({type:"removed",mutation:t})}canRun(t){const e=Nh(t);if(typeof e=="string"){const r=this.#t.get(e)?.find(i=>i.state.status==="pending");return!r||r===t}else return!0}runNext(t){const e=Nh(t);return typeof e=="string"?this.#t.get(e)?.find(r=>r!==t&&r.state.isPaused)?.continue()??Promise.resolve():Promise.resolve()}clear(){En.batch(()=>{this.#e.forEach(t=>{this.notify({type:"removed",mutation:t})}),this.#e.clear(),this.#t.clear()})}getAll(){return Array.from(this.#e)}find(t){const e={exact:!0,...t};return this.getAll().find(n=>Ux(e,n))}findAll(t={}){return this.getAll().filter(e=>Ux(t,e))}notify(t){En.batch(()=>{this.listeners.forEach(e=>{e(t)})})}resumePausedMutations(){const t=this.getAll().filter(e=>e.state.isPaused);return En.batch(()=>Promise.all(t.map(e=>e.continue().catch(sr))))}};function Nh(t){return t.options.scope?.id}var Wj=class extends tc{#e;#t=void 0;#n;#s;constructor(e,n){super(),this.#e=e,this.setOptions(n),this.bindMethods(),this.#r()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){const n=this.options;this.options=this.#e.defaultMutationOptions(e),rf(this.options,n)||this.#e.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#n,observer:this}),n?.mutationKey&&this.options.mutationKey&&To(n.mutationKey)!==To(this.options.mutationKey)?this.reset():this.#n?.state.status==="pending"&&this.#n.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#n?.removeObserver(this)}onMutationUpdate(e){this.#r(),this.#a(e)}getCurrentResult(){return this.#t}reset(){this.#n?.removeObserver(this),this.#n=void 0,this.#r(),this.#a()}mutate(e,n){return this.#s=n,this.#n?.removeObserver(this),this.#n=this.#e.getMutationCache().build(this.#e,this.options),this.#n.addObserver(this),this.#n.execute(e)}#r(){const e=this.#n?.state??PS();this.#t={...e,isPending:e.status==="pending",isSuccess:e.status==="success",isError:e.status==="error",isIdle:e.status==="idle",mutate:this.mutate,reset:this.reset}}#a(e){En.batch(()=>{if(this.#s&&this.hasListeners()){const n=this.#t.variables,r=this.#t.context,i={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};e?.type==="success"?(this.#s.onSuccess?.(e.data,n,r,i),this.#s.onSettled?.(e.data,null,n,r,i)):e?.type==="error"&&(this.#s.onError?.(e.error,n,r,i),this.#s.onSettled?.(void 0,e.error,n,r,i))}this.listeners.forEach(n=>{n(this.#t)})})}},Kj=class extends tc{constructor(t={}){super(),this.config=t,this.#e=new Map}#e;build(t,e,n){const r=e.queryKey,i=e.queryHash??Fy(r,e);let o=this.get(i);return o||(o=new Fj({client:t,queryKey:r,queryHash:i,options:t.defaultQueryOptions(e),state:n,defaultOptions:t.getQueryDefaults(r)}),this.add(o)),o}add(t){this.#e.has(t.queryHash)||(this.#e.set(t.queryHash,t),this.notify({type:"added",query:t}))}remove(t){const e=this.#e.get(t.queryHash);e&&(t.destroy(),e===t&&this.#e.delete(t.queryHash),this.notify({type:"removed",query:t}))}clear(){En.batch(()=>{this.getAll().forEach(t=>{this.remove(t)})})}get(t){return this.#e.get(t)}getAll(){return[...this.#e.values()]}find(t){const e={exact:!0,...t};return this.getAll().find(n=>Lx(e,n))}findAll(t={}){const e=this.getAll();return Object.keys(t).length>0?e.filter(n=>Lx(t,n)):e}notify(t){En.batch(()=>{this.listeners.forEach(e=>{e(t)})})}onFocus(){En.batch(()=>{this.getAll().forEach(t=>{t.onFocus()})})}onOnline(){En.batch(()=>{this.getAll().forEach(t=>{t.onOnline()})})}},Yj=class{#e;#t;#n;#s;#r;#a;#o;#i;constructor(t={}){this.#e=t.queryCache||new Kj,this.#t=t.mutationCache||new Qj,this.#n=t.defaultOptions||{},this.#s=new Map,this.#r=new Map,this.#a=0}mount(){this.#a++,this.#a===1&&(this.#o=$y.subscribe(async t=>{t&&(await this.resumePausedMutations(),this.#e.onFocus())}),this.#i=sf.subscribe(async t=>{t&&(await this.resumePausedMutations(),this.#e.onOnline())}))}unmount(){this.#a--,this.#a===0&&(this.#o?.(),this.#o=void 0,this.#i?.(),this.#i=void 0)}isFetching(t){return this.#e.findAll({...t,fetchStatus:"fetching"}).length}isMutating(t){return this.#t.findAll({...t,status:"pending"}).length}getQueryData(t){const e=this.defaultQueryOptions({queryKey:t});return this.#e.get(e.queryHash)?.state.data}ensureQueryData(t){const e=this.defaultQueryOptions(t),n=this.#e.build(this,e),r=n.state.data;return r===void 0?this.fetchQuery(t):(t.revalidateIfStale&&n.isStaleByTime(pa(e.staleTime,n))&&this.prefetchQuery(e),Promise.resolve(r))}getQueriesData(t){return this.#e.findAll(t).map(({queryKey:e,state:n})=>{const r=n.data;return[e,r]})}setQueryData(t,e,n){const r=this.defaultQueryOptions({queryKey:t}),o=this.#e.get(r.queryHash)?.state.data,l=kj(e,o);if(l!==void 0)return this.#e.build(this,r).setData(l,{...n,manual:!0})}setQueriesData(t,e,n){return En.batch(()=>this.#e.findAll(t).map(({queryKey:r})=>[r,this.setQueryData(r,e,n)]))}getQueryState(t){const e=this.defaultQueryOptions({queryKey:t});return this.#e.get(e.queryHash)?.state}removeQueries(t){const e=this.#e;En.batch(()=>{e.findAll(t).forEach(n=>{e.remove(n)})})}resetQueries(t,e){const n=this.#e;return En.batch(()=>(n.findAll(t).forEach(r=>{r.reset()}),this.refetchQueries({type:"active",...t},e)))}cancelQueries(t,e={}){const n={revert:!0,...e},r=En.batch(()=>this.#e.findAll(t).map(i=>i.cancel(n)));return Promise.all(r).then(sr).catch(sr)}invalidateQueries(t,e={}){return En.batch(()=>(this.#e.findAll(t).forEach(n=>{n.invalidate()}),t?.refetchType==="none"?Promise.resolve():this.refetchQueries({...t,type:t?.refetchType??t?.type??"active"},e)))}refetchQueries(t,e={}){const n={...e,cancelRefetch:e.cancelRefetch??!0},r=En.batch(()=>this.#e.findAll(t).filter(i=>!i.isDisabled()&&!i.isStatic()).map(i=>{let o=i.fetch(void 0,n);return n.throwOnError||(o=o.catch(sr)),i.state.fetchStatus==="paused"?Promise.resolve():o}));return Promise.all(r).then(sr)}fetchQuery(t){const e=this.defaultQueryOptions(t);e.retry===void 0&&(e.retry=!1);const n=this.#e.build(this,e);return n.isStaleByTime(pa(e.staleTime,n))?n.fetch(e):Promise.resolve(n.state.data)}prefetchQuery(t){return this.fetchQuery(t).then(sr).catch(sr)}fetchInfiniteQuery(t){return t.behavior=Qx(t.pages),this.fetchQuery(t)}prefetchInfiniteQuery(t){return this.fetchInfiniteQuery(t).then(sr).catch(sr)}ensureInfiniteQueryData(t){return t.behavior=Qx(t.pages),this.ensureQueryData(t)}resumePausedMutations(){return sf.isOnline()?this.#t.resumePausedMutations():Promise.resolve()}getQueryCache(){return this.#e}getMutationCache(){return this.#t}getDefaultOptions(){return this.#n}setDefaultOptions(t){this.#n=t}setQueryDefaults(t,e){this.#s.set(To(t),{queryKey:t,defaultOptions:e})}getQueryDefaults(t){const e=[...this.#s.values()],n={};return e.forEach(r=>{ku(t,r.queryKey)&&Object.assign(n,r.defaultOptions)}),n}setMutationDefaults(t,e){this.#r.set(To(t),{mutationKey:t,defaultOptions:e})}getMutationDefaults(t){const e=[...this.#r.values()],n={};return e.forEach(r=>{ku(t,r.mutationKey)&&Object.assign(n,r.defaultOptions)}),n}defaultQueryOptions(t){if(t._defaulted)return t;const e={...this.#n.queries,...this.getQueryDefaults(t.queryKey),...t,_defaulted:!0};return e.queryHash||(e.queryHash=Fy(e.queryKey,e)),e.refetchOnReconnect===void 0&&(e.refetchOnReconnect=e.networkMode!=="always"),e.throwOnError===void 0&&(e.throwOnError=!!e.suspense),!e.networkMode&&e.persister&&(e.networkMode="offlineFirst"),e.queryFn===Vy&&(e.enabled=!1),e}defaultMutationOptions(t){return t?._defaulted?t:{...this.#n.mutations,...t?.mutationKey&&this.getMutationDefaults(t.mutationKey),...t,_defaulted:!0}}clear(){this.#e.clear(),this.#t.clear()}},zS=D.createContext(void 0),Vt=t=>{const e=D.useContext(zS);if(!e)throw new Error("No QueryClient set, use QueryClientProvider to set one");return e},Xj=({client:t,children:e})=>(D.useEffect(()=>(t.mount(),()=>{t.unmount()}),[t]),u.jsx(zS.Provider,{value:t,children:e})),BS=D.createContext(!1),Zj=()=>D.useContext(BS);BS.Provider;function Jj(){let t=!1;return{clearReset:()=>{t=!1},reset:()=>{t=!0},isReset:()=>t}}var eR=D.createContext(Jj()),tR=()=>D.useContext(eR),nR=(t,e)=>{(t.suspense||t.throwOnError||t.experimental_prefetchInRender)&&(e.isReset()||(t.retryOnMount=!1))},rR=t=>{D.useEffect(()=>{t.clearReset()},[t])},sR=({result:t,errorResetBoundary:e,throwOnError:n,query:r,suspense:i})=>t.isError&&!e.isReset()&&!t.isFetching&&r&&(i&&t.data===void 0||kS(n,[t.error,r])),iR=t=>{if(t.suspense){const n=i=>i==="static"?i:Math.max(i??1e3,1e3),r=t.staleTime;t.staleTime=typeof r=="function"?(...i)=>n(r(...i)):n(r),typeof t.gcTime=="number"&&(t.gcTime=Math.max(t.gcTime,1e3))}},aR=(t,e)=>t.isLoading&&t.isFetching&&!e,oR=(t,e)=>t?.suspense&&e.isPending,Kx=(t,e,n)=>e.fetchOptimistic(t).catch(()=>{n.clearReset()});function lR(t,e,n){const r=Zj(),i=tR(),o=Vt(),l=o.defaultQueryOptions(t);o.getDefaultOptions().queries?._experimental_beforeQuery?.(l),l._optimisticResults=r?"isRestoring":"optimistic",iR(l),nR(l,i),rR(i);const d=!o.getQueryCache().get(l.queryHash),[h]=D.useState(()=>new e(o,l)),m=h.getOptimisticResult(l),p=!r&&t.subscribed!==!1;if(D.useSyncExternalStore(D.useCallback(g=>{const v=p?h.subscribe(En.batchCalls(g)):sr;return h.updateResult(),v},[h,p]),()=>h.getCurrentResult(),()=>h.getCurrentResult()),D.useEffect(()=>{h.setOptions(l)},[l,h]),oR(l,m))throw Kx(l,h,i);if(sR({result:m,errorResetBoundary:i,throwOnError:l.throwOnError,query:o.getQueryCache().get(l.queryHash),suspense:l.suspense}))throw m.error;return o.getDefaultOptions().queries?._experimental_afterQuery?.(l,m),l.experimental_prefetchInRender&&!Eo&&aR(m,r)&&(d?Kx(l,h,i):o.getQueryCache().get(l.queryHash)?.promise)?.catch(sr).finally(()=>{h.updateResult()}),l.notifyOnChangeProps?m:h.trackResult(m)}function Do(t,e){return lR(t,Vj)}function Hn(t,e){const n=Vt(),[r]=D.useState(()=>new Wj(n,t));D.useEffect(()=>{r.setOptions(t)},[r,t]);const i=D.useSyncExternalStore(D.useCallback(l=>r.subscribe(En.batchCalls(l)),[r]),()=>r.getCurrentResult(),()=>r.getCurrentResult()),o=D.useCallback((l,d)=>{r.mutate(l,d).catch(sr)},[r]);if(i.error&&kS(r.options.throwOnError,[i.error]))throw i.error;return{...i,mutate:o,mutateAsync:i.mutate}}const cR={isLoading:!1,loadingMessage:"Loading...",addLoadingHold:()=>{},removeLoadingHold:()=>{}},LS=D.createContext(cR);function uR({children:t}){const[e,n]=D.useState(new Map),r=D.useCallback((h,m)=>{n(p=>new Map(p).set(h,m))},[]),i=D.useCallback(h=>{n(m=>{const p=new Map(m);return p.delete(h),p})},[]),o=e.size>0,l=e.size>0&&Array.from(e.values()).pop()||"Loading...",d={isLoading:o,loadingMessage:l,addLoadingHold:r,removeLoadingHold:i};return u.jsx(LS.Provider,{value:d,children:t})}function Gn(){const t=D.useContext(LS);if(!t)throw new Error("useApp must be used within an AppProvider");return t}const dR=()=>{};var Yx={};const US=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let i=t.charCodeAt(r);i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=i&63|128):(i&64512)===55296&&r+1<t.length&&(t.charCodeAt(r+1)&64512)===56320?(i=65536+((i&1023)<<10)+(t.charCodeAt(++r)&1023),e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=i&63|128):(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=i&63|128)}return e},hR=function(t){const e=[];let n=0,r=0;for(;n<t.length;){const i=t[n++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){const o=t[n++];e[r++]=String.fromCharCode((i&31)<<6|o&63)}else if(i>239&&i<365){const o=t[n++],l=t[n++],d=t[n++],h=((i&7)<<18|(o&63)<<12|(l&63)<<6|d&63)-65536;e[r++]=String.fromCharCode(55296+(h>>10)),e[r++]=String.fromCharCode(56320+(h&1023))}else{const o=t[n++],l=t[n++];e[r++]=String.fromCharCode((i&15)<<12|(o&63)<<6|l&63)}}return e.join("")},FS={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<t.length;i+=3){const o=t[i],l=i+1<t.length,d=l?t[i+1]:0,h=i+2<t.length,m=h?t[i+2]:0,p=o>>2,g=(o&3)<<4|d>>4;let v=(d&15)<<2|m>>6,_=m&63;h||(_=64,l||(v=64)),r.push(n[p],n[g],n[v],n[_])}return r.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(US(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):hR(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<t.length;){const o=n[t.charAt(i++)],d=i<t.length?n[t.charAt(i)]:0;++i;const m=i<t.length?n[t.charAt(i)]:64;++i;const g=i<t.length?n[t.charAt(i)]:64;if(++i,o==null||d==null||m==null||g==null)throw new fR;const v=o<<2|d>>4;if(r.push(v),m!==64){const _=d<<4&240|m>>2;if(r.push(_),g!==64){const C=m<<6&192|g;r.push(C)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class fR extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const mR=function(t){const e=US(t);return FS.encodeByteArray(e,!0)},af=function(t){return mR(t).replace(/\./g,"")},VS=function(t){try{return FS.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function pR(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const gR=()=>pR().__FIREBASE_DEFAULTS__,yR=()=>{if(typeof process>"u"||typeof Yx>"u")return;const t=Yx.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},_R=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&VS(t[1]);return e&&JSON.parse(e)},Uf=()=>{try{return dR()||gR()||yR()||_R()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},$S=t=>Uf()?.emulatorHosts?.[t],bR=t=>{const e=$S(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(n+1),10);return e[0]==="["?[e.substring(1,n-1),r]:[e.substring(0,n),r]},qS=()=>Uf()?.config,HS=t=>Uf()?.[`_${t}`];class vR{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,r)=>{n?this.reject(n):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,r))}}}function nc(t){try{return(t.startsWith("http://")||t.startsWith("https://")?new URL(t).hostname:t).endsWith(".cloudworkstations.dev")}catch{return!1}}async function GS(t){return(await fetch(t,{credentials:"include"})).ok}function xR(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n={alg:"none",type:"JWT"},r=e||"demo-project",i=t.iat||0,o=t.sub||t.user_id;if(!o)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const l={iss:`https://securetoken.google.com/${r}`,aud:r,iat:i,exp:i+3600,auth_time:i,sub:o,user_id:o,firebase:{sign_in_provider:"custom",identities:{}},...t};return[af(JSON.stringify(n)),af(JSON.stringify(l)),""].join(".")}const Cu={};function wR(){const t={prod:[],emulator:[]};for(const e of Object.keys(Cu))Cu[e]?t.emulator.push(e):t.prod.push(e);return t}function SR(t){let e=document.getElementById(t),n=!1;return e||(e=document.createElement("div"),e.setAttribute("id",t),n=!0),{created:n,element:e}}let Xx=!1;function QS(t,e){if(typeof window>"u"||typeof document>"u"||!nc(window.location.host)||Cu[t]===e||Cu[t]||Xx)return;Cu[t]=e;function n(v){return`__firebase__banner__${v}`}const r="__firebase__banner",o=wR().prod.length>0;function l(){const v=document.getElementById(r);v&&v.remove()}function d(v){v.style.display="flex",v.style.background="#7faaf0",v.style.position="fixed",v.style.bottom="5px",v.style.left="5px",v.style.padding=".5em",v.style.borderRadius="5px",v.style.alignItems="center"}function h(v,_){v.setAttribute("width","24"),v.setAttribute("id",_),v.setAttribute("height","24"),v.setAttribute("viewBox","0 0 24 24"),v.setAttribute("fill","none"),v.style.marginLeft="-6px"}function m(){const v=document.createElement("span");return v.style.cursor="pointer",v.style.marginLeft="16px",v.style.fontSize="24px",v.innerHTML=" &times;",v.onclick=()=>{Xx=!0,l()},v}function p(v,_){v.setAttribute("id",_),v.innerText="Learn more",v.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",v.setAttribute("target","__blank"),v.style.paddingLeft="5px",v.style.textDecoration="underline"}function g(){const v=SR(r),_=n("text"),C=document.getElementById(_)||document.createElement("span"),x=n("learnmore"),S=document.getElementById(x)||document.createElement("a"),E=n("preprendIcon"),T=document.getElementById(E)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(v.created){const I=v.element;d(I),p(S,x);const M=m();h(T,E),I.append(T,C,S,M),document.body.appendChild(I)}o?(C.innerText="Preview backend disconnected.",T.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(T.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,C.innerText="Preview backend running in this workspace."),C.setAttribute("id",_)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",g):g()}function Jn(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function CR(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Jn())}function ER(){const t=Uf()?.forceEnvironment;if(t==="node")return!0;if(t==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function TR(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function AR(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function jR(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function RR(){const t=Jn();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function IR(){return!ER()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function kR(){try{return typeof indexedDB=="object"}catch{return!1}}function DR(){return new Promise((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{e(i.error?.message||"")}}catch(n){e(n)}})}const OR="FirebaseError";class Ei extends Error{constructor(e,n,r){super(n),this.code=e,this.customData=r,this.name=OR,Object.setPrototypeOf(this,Ei.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Wu.prototype.create)}}class Wu{constructor(e,n,r){this.service=e,this.serviceName=n,this.errors=r}create(e,...n){const r=n[0]||{},i=`${this.service}/${e}`,o=this.errors[e],l=o?MR(o,r):"Error",d=`${this.serviceName}: ${l} (${i}).`;return new Ei(i,d,r)}}function MR(t,e){return t.replace(NR,(n,r)=>{const i=e[r];return i!=null?String(i):`<${r}?>`})}const NR=/\{\$([^}]+)}/g;function PR(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function _i(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const i of n){if(!r.includes(i))return!1;const o=t[i],l=e[i];if(Zx(o)&&Zx(l)){if(!_i(o,l))return!1}else if(o!==l)return!1}for(const i of r)if(!n.includes(i))return!1;return!0}function Zx(t){return t!==null&&typeof t=="object"}function Ku(t){const e=[];for(const[n,r]of Object.entries(t))Array.isArray(r)?r.forEach(i=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function _u(t){const e={};return t.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[i,o]=r.split("=");e[decodeURIComponent(i)]=decodeURIComponent(o)}}),e}function bu(t){const e=t.indexOf("?");if(!e)return"";const n=t.indexOf("#",e);return t.substring(e,n>0?n:void 0)}function zR(t,e){const n=new BR(t,e);return n.subscribe.bind(n)}class BR{constructor(e,n){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(n=>{n.next(e)})}error(e){this.forEachObserver(n=>{n.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,n,r){let i;if(e===void 0&&n===void 0&&r===void 0)throw new Error("Missing Observer.");LR(e,["next","error","complete"])?i=e:i={next:e,error:n,complete:r},i.next===void 0&&(i.next=jg),i.error===void 0&&(i.error=jg),i.complete===void 0&&(i.complete=jg);const o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),o}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let n=0;n<this.observers.length;n++)this.sendOne(n,e)}sendOne(e,n){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{n(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function LR(t,e){if(typeof t!="object"||t===null)return!1;for(const n of e)if(n in t&&typeof t[n]=="function")return!0;return!1}function jg(){}function xn(t){return t&&t._delegate?t._delegate:t}class Ao{constructor(e,n,r){this.name=e,this.instanceFactory=n,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const yo="[DEFAULT]";class UR{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){const r=new vR;if(this.instancesDeferred.set(n,r),this.isInitialized(n)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:n});i&&r.resolve(i)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){const n=this.normalizeInstanceIdentifier(e?.identifier),r=e?.optional??!1;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(i){if(r)return null;throw i}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(VR(e))try{this.getOrInitializeService({instanceIdentifier:yo})}catch{}for(const[n,r]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(n);try{const o=this.getOrInitializeService({instanceIdentifier:i});r.resolve(o)}catch{}}}}clearInstance(e=yo){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=yo){return this.instances.has(e)}getOptions(e=yo){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:n={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:r,options:n});for(const[o,l]of this.instancesDeferred.entries()){const d=this.normalizeInstanceIdentifier(o);r===d&&l.resolve(i)}return i}onInit(e,n){const r=this.normalizeInstanceIdentifier(n),i=this.onInitCallbacks.get(r)??new Set;i.add(e),this.onInitCallbacks.set(r,i);const o=this.instances.get(r);return o&&e(o,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,n){const r=this.onInitCallbacks.get(n);if(r)for(const i of r)try{i(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:FR(e),options:n}),this.instances.set(e,r),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=yo){return this.component?this.component.multipleInstances?e:yo:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function FR(t){return t===yo?void 0:t}function VR(t){return t.instantiationMode==="EAGER"}class $R{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const n=new UR(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}}var mt;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(mt||(mt={}));const qR={debug:mt.DEBUG,verbose:mt.VERBOSE,info:mt.INFO,warn:mt.WARN,error:mt.ERROR,silent:mt.SILENT},HR=mt.INFO,GR={[mt.DEBUG]:"log",[mt.VERBOSE]:"log",[mt.INFO]:"info",[mt.WARN]:"warn",[mt.ERROR]:"error"},QR=(t,e,...n)=>{if(e<t.logLevel)return;const r=new Date().toISOString(),i=GR[e];if(i)console[i](`[${r}]  ${t.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Hy{constructor(e){this.name=e,this._logLevel=HR,this._logHandler=QR,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in mt))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?qR[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,mt.DEBUG,...e),this._logHandler(this,mt.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,mt.VERBOSE,...e),this._logHandler(this,mt.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,mt.INFO,...e),this._logHandler(this,mt.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,mt.WARN,...e),this._logHandler(this,mt.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,mt.ERROR,...e),this._logHandler(this,mt.ERROR,...e)}}const WR=(t,e)=>e.some(n=>t instanceof n);let Jx,ew;function KR(){return Jx||(Jx=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function YR(){return ew||(ew=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const WS=new WeakMap,sy=new WeakMap,KS=new WeakMap,Rg=new WeakMap,Gy=new WeakMap;function XR(t){const e=new Promise((n,r)=>{const i=()=>{t.removeEventListener("success",o),t.removeEventListener("error",l)},o=()=>{n(ga(t.result)),i()},l=()=>{r(t.error),i()};t.addEventListener("success",o),t.addEventListener("error",l)});return e.then(n=>{n instanceof IDBCursor&&WS.set(n,t)}).catch(()=>{}),Gy.set(e,t),e}function ZR(t){if(sy.has(t))return;const e=new Promise((n,r)=>{const i=()=>{t.removeEventListener("complete",o),t.removeEventListener("error",l),t.removeEventListener("abort",l)},o=()=>{n(),i()},l=()=>{r(t.error||new DOMException("AbortError","AbortError")),i()};t.addEventListener("complete",o),t.addEventListener("error",l),t.addEventListener("abort",l)});sy.set(t,e)}let iy={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return sy.get(t);if(e==="objectStoreNames")return t.objectStoreNames||KS.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return ga(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function JR(t){iy=t(iy)}function eI(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const r=t.call(Ig(this),e,...n);return KS.set(r,e.sort?e.sort():[e]),ga(r)}:YR().includes(t)?function(...e){return t.apply(Ig(this),e),ga(WS.get(this))}:function(...e){return ga(t.apply(Ig(this),e))}}function tI(t){return typeof t=="function"?eI(t):(t instanceof IDBTransaction&&ZR(t),WR(t,KR())?new Proxy(t,iy):t)}function ga(t){if(t instanceof IDBRequest)return XR(t);if(Rg.has(t))return Rg.get(t);const e=tI(t);return e!==t&&(Rg.set(t,e),Gy.set(e,t)),e}const Ig=t=>Gy.get(t);function nI(t,e,{blocked:n,upgrade:r,blocking:i,terminated:o}={}){const l=indexedDB.open(t,e),d=ga(l);return r&&l.addEventListener("upgradeneeded",h=>{r(ga(l.result),h.oldVersion,h.newVersion,ga(l.transaction),h)}),n&&l.addEventListener("blocked",h=>n(h.oldVersion,h.newVersion,h)),d.then(h=>{o&&h.addEventListener("close",()=>o()),i&&h.addEventListener("versionchange",m=>i(m.oldVersion,m.newVersion,m))}).catch(()=>{}),d}const rI=["get","getKey","getAll","getAllKeys","count"],sI=["put","add","delete","clear"],kg=new Map;function tw(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(kg.get(e))return kg.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,i=sI.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(i||rI.includes(n)))return;const o=async function(l,...d){const h=this.transaction(l,i?"readwrite":"readonly");let m=h.store;return r&&(m=m.index(d.shift())),(await Promise.all([m[n](...d),i&&h.done]))[0]};return kg.set(e,o),o}JR(t=>({...t,get:(e,n,r)=>tw(e,n)||t.get(e,n,r),has:(e,n)=>!!tw(e,n)||t.has(e,n)}));class iI{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(aI(n)){const r=n.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(n=>n).join(" ")}}function aI(t){return t.getComponent()?.type==="VERSION"}const ay="@firebase/app",nw="0.14.6";const bi=new Hy("@firebase/app"),oI="@firebase/app-compat",lI="@firebase/analytics-compat",cI="@firebase/analytics",uI="@firebase/app-check-compat",dI="@firebase/app-check",hI="@firebase/auth",fI="@firebase/auth-compat",mI="@firebase/database",pI="@firebase/data-connect",gI="@firebase/database-compat",yI="@firebase/functions",_I="@firebase/functions-compat",bI="@firebase/installations",vI="@firebase/installations-compat",xI="@firebase/messaging",wI="@firebase/messaging-compat",SI="@firebase/performance",CI="@firebase/performance-compat",EI="@firebase/remote-config",TI="@firebase/remote-config-compat",AI="@firebase/storage",jI="@firebase/storage-compat",RI="@firebase/firestore",II="@firebase/ai",kI="@firebase/firestore-compat",DI="firebase",OI="12.6.0";const oy="[DEFAULT]",MI={[ay]:"fire-core",[oI]:"fire-core-compat",[cI]:"fire-analytics",[lI]:"fire-analytics-compat",[dI]:"fire-app-check",[uI]:"fire-app-check-compat",[hI]:"fire-auth",[fI]:"fire-auth-compat",[mI]:"fire-rtdb",[pI]:"fire-data-connect",[gI]:"fire-rtdb-compat",[yI]:"fire-fn",[_I]:"fire-fn-compat",[bI]:"fire-iid",[vI]:"fire-iid-compat",[xI]:"fire-fcm",[wI]:"fire-fcm-compat",[SI]:"fire-perf",[CI]:"fire-perf-compat",[EI]:"fire-rc",[TI]:"fire-rc-compat",[AI]:"fire-gcs",[jI]:"fire-gcs-compat",[RI]:"fire-fst",[kI]:"fire-fst-compat",[II]:"fire-vertex","fire-js":"fire-js",[DI]:"fire-js-all"};const of=new Map,NI=new Map,ly=new Map;function rw(t,e){try{t.container.addComponent(e)}catch(n){bi.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function Fl(t){const e=t.name;if(ly.has(e))return bi.debug(`There were multiple attempts to register component ${e}.`),!1;ly.set(e,t);for(const n of of.values())rw(n,t);for(const n of NI.values())rw(n,t);return!0}function Qy(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function as(t){return t==null?!1:t.settings!==void 0}const PI={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},ya=new Wu("app","Firebase",PI);class zI{constructor(e,n,r){this._isDeleted=!1,this._options={...e},this._config={...n},this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Ao("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw ya.create("app-deleted",{appName:this._name})}}const rc=OI;function YS(t,e={}){let n=t;typeof e!="object"&&(e={name:e});const r={name:oy,automaticDataCollectionEnabled:!0,...e},i=r.name;if(typeof i!="string"||!i)throw ya.create("bad-app-name",{appName:String(i)});if(n||(n=qS()),!n)throw ya.create("no-options");const o=of.get(i);if(o){if(_i(n,o.options)&&_i(r,o.config))return o;throw ya.create("duplicate-app",{appName:i})}const l=new $R(i);for(const h of ly.values())l.addComponent(h);const d=new zI(n,r,l);return of.set(i,d),d}function XS(t=oy){const e=of.get(t);if(!e&&t===oy&&qS())return YS();if(!e)throw ya.create("no-app",{appName:t});return e}function _a(t,e,n){let r=MI[t]??t;n&&(r+=`-${n}`);const i=r.match(/\s|\//),o=e.match(/\s|\//);if(i||o){const l=[`Unable to register library "${r}" with version "${e}":`];i&&l.push(`library name "${r}" contains illegal characters (whitespace or "/")`),i&&o&&l.push("and"),o&&l.push(`version name "${e}" contains illegal characters (whitespace or "/")`),bi.warn(l.join(" "));return}Fl(new Ao(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}const BI="firebase-heartbeat-database",LI=1,Du="firebase-heartbeat-store";let Dg=null;function ZS(){return Dg||(Dg=nI(BI,LI,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(Du)}catch(n){console.warn(n)}}}}).catch(t=>{throw ya.create("idb-open",{originalErrorMessage:t.message})})),Dg}async function UI(t){try{const n=(await ZS()).transaction(Du),r=await n.objectStore(Du).get(JS(t));return await n.done,r}catch(e){if(e instanceof Ei)bi.warn(e.message);else{const n=ya.create("idb-get",{originalErrorMessage:e?.message});bi.warn(n.message)}}}async function sw(t,e){try{const r=(await ZS()).transaction(Du,"readwrite");await r.objectStore(Du).put(e,JS(t)),await r.done}catch(n){if(n instanceof Ei)bi.warn(n.message);else{const r=ya.create("idb-set",{originalErrorMessage:n?.message});bi.warn(r.message)}}}function JS(t){return`${t.name}!${t.options.appId}`}const FI=1024,VI=30;class $I{constructor(e){this.container=e,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new HI(n),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){try{const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=iw();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(i=>i.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:n}),this._heartbeatsCache.heartbeats.length>VI){const i=GI(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(i,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){bi.warn(e)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const e=iw(),{heartbeatsToSend:n,unsentEntries:r}=qI(this._heartbeatsCache.heartbeats),i=af(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(e){return bi.warn(e),""}}}function iw(){return new Date().toISOString().substring(0,10)}function qI(t,e=FI){const n=[];let r=t.slice();for(const i of t){const o=n.find(l=>l.agent===i.agent);if(o){if(o.dates.push(i.date),aw(n)>e){o.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),aw(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}class HI{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return kR()?DR().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const n=await UI(this.app);return n?.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return sw(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return sw(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function aw(t){return af(JSON.stringify({version:2,heartbeats:t})).length}function GI(t){if(t.length===0)return-1;let e=0,n=t[0].date;for(let r=1;r<t.length;r++)t[r].date<n&&(n=t[r].date,e=r);return e}function QI(t){Fl(new Ao("platform-logger",e=>new iI(e),"PRIVATE")),Fl(new Ao("heartbeat",e=>new $I(e),"PRIVATE")),_a(ay,nw,t),_a(ay,nw,"esm2020"),_a("fire-js","")}QI("");function eC(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const WI=eC,tC=new Wu("auth","Firebase",eC());const lf=new Hy("@firebase/auth");function KI(t,...e){lf.logLevel<=mt.WARN&&lf.warn(`Auth (${rc}): ${t}`,...e)}function Gh(t,...e){lf.logLevel<=mt.ERROR&&lf.error(`Auth (${rc}): ${t}`,...e)}function us(t,...e){throw Wy(t,...e)}function Ls(t,...e){return Wy(t,...e)}function nC(t,e,n){const r={...WI(),[e]:n};return new Wu("auth","Firebase",r).create(e,{appName:t.name})}function ba(t){return nC(t,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Wy(t,...e){if(typeof t!="string"){const n=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=t.name),t._errorFactory.create(n,...r)}return tC.create(t,...e)}function Ke(t,e,...n){if(!t)throw Wy(e,...n)}function fi(t){const e="INTERNAL ASSERTION FAILED: "+t;throw Gh(e),new Error(e)}function vi(t,e){t||fi(e)}function cy(){return typeof self<"u"&&self.location?.href||""}function YI(){return ow()==="http:"||ow()==="https:"}function ow(){return typeof self<"u"&&self.location?.protocol||null}function XI(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(YI()||AR()||"connection"in navigator)?navigator.onLine:!0}function ZI(){if(typeof navigator>"u")return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}class Yu{constructor(e,n){this.shortDelay=e,this.longDelay=n,vi(n>e,"Short delay should be less than long delay!"),this.isMobile=CR()||jR()}get(){return XI()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function Ky(t,e){vi(t.emulator,"Emulator should always be set here");const{url:n}=t.emulator;return e?`${n}${e.startsWith("/")?e.slice(1):e}`:n}class rC{static initialize(e,n,r){this.fetchImpl=e,n&&(this.headersImpl=n),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;fi("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;fi("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;fi("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const JI={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};const ek=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],tk=new Yu(3e4,6e4);function Oo(t,e){return t.tenantId&&!e.tenantId?{...e,tenantId:t.tenantId}:e}async function Da(t,e,n,r,i={}){return sC(t,i,async()=>{let o={},l={};r&&(e==="GET"?l=r:o={body:JSON.stringify(r)});const d=Ku({key:t.config.apiKey,...l}).slice(1),h=await t._getAdditionalHeaders();h["Content-Type"]="application/json",t.languageCode&&(h["X-Firebase-Locale"]=t.languageCode);const m={method:e,headers:h,...o};return TR()||(m.referrerPolicy="no-referrer"),t.emulatorConfig&&nc(t.emulatorConfig.host)&&(m.credentials="include"),rC.fetch()(await iC(t,t.config.apiHost,n,d),m)})}async function sC(t,e,n){t._canInitEmulator=!1;const r={...JI,...e};try{const i=new rk(t),o=await Promise.race([n(),i.promise]);i.clearNetworkTimeout();const l=await o.json();if("needConfirmation"in l)throw Ph(t,"account-exists-with-different-credential",l);if(o.ok&&!("errorMessage"in l))return l;{const d=o.ok?l.errorMessage:l.error.message,[h,m]=d.split(" : ");if(h==="FEDERATED_USER_ID_ALREADY_LINKED")throw Ph(t,"credential-already-in-use",l);if(h==="EMAIL_EXISTS")throw Ph(t,"email-already-in-use",l);if(h==="USER_DISABLED")throw Ph(t,"user-disabled",l);const p=r[h]||h.toLowerCase().replace(/[_\s]+/g,"-");if(m)throw nC(t,p,m);us(t,p)}}catch(i){if(i instanceof Ei)throw i;us(t,"network-request-failed",{message:String(i)})}}async function Ff(t,e,n,r,i={}){const o=await Da(t,e,n,r,i);return"mfaPendingCredential"in o&&us(t,"multi-factor-auth-required",{_serverResponse:o}),o}async function iC(t,e,n,r){const i=`${e}${n}?${r}`,o=t,l=o.config.emulator?Ky(t.config,i):`${t.config.apiScheme}://${i}`;return ek.includes(n)&&(await o._persistenceManagerAvailable,o._getPersistenceType()==="COOKIE")?o._getPersistence()._getFinalTarget(l).toString():l}function nk(t){switch(t){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class rk{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((n,r)=>{this.timer=setTimeout(()=>r(Ls(this.auth,"network-request-failed")),tk.get())})}}function Ph(t,e,n){const r={appName:t.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const i=Ls(t,e,r);return i.customData._tokenResponse=n,i}function lw(t){return t!==void 0&&t.enterprise!==void 0}class sk{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const n of this.recaptchaEnforcementState)if(n.provider&&n.provider===e)return nk(n.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function ik(t,e){return Da(t,"GET","/v2/recaptchaConfig",Oo(t,e))}async function ak(t,e){return Da(t,"POST","/v1/accounts:delete",e)}async function cf(t,e){return Da(t,"POST","/v1/accounts:lookup",e)}function Eu(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function ok(t,e=!1){const n=xn(t),r=await n.getIdToken(e),i=Yy(r);Ke(i&&i.exp&&i.auth_time&&i.iat,n.auth,"internal-error");const o=typeof i.firebase=="object"?i.firebase:void 0,l=o?.sign_in_provider;return{claims:i,token:r,authTime:Eu(Og(i.auth_time)),issuedAtTime:Eu(Og(i.iat)),expirationTime:Eu(Og(i.exp)),signInProvider:l||null,signInSecondFactor:o?.sign_in_second_factor||null}}function Og(t){return Number(t)*1e3}function Yy(t){const[e,n,r]=t.split(".");if(e===void 0||n===void 0||r===void 0)return Gh("JWT malformed, contained fewer than 3 sections"),null;try{const i=VS(n);return i?JSON.parse(i):(Gh("Failed to decode base64 JWT payload"),null)}catch(i){return Gh("Caught error parsing JWT payload as JSON",i?.toString()),null}}function cw(t){const e=Yy(t);return Ke(e,"internal-error"),Ke(typeof e.exp<"u","internal-error"),Ke(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}async function Ou(t,e,n=!1){if(n)return e;try{return await e}catch(r){throw r instanceof Ei&&lk(r)&&t.auth.currentUser===t&&await t.auth.signOut(),r}}function lk({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}class ck{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const n=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),n}else{this.errorBackoff=3e4;const r=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;const n=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},n)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class uy{constructor(e,n){this.createdAt=e,this.lastLoginAt=n,this._initializeTime()}_initializeTime(){this.lastSignInTime=Eu(this.lastLoginAt),this.creationTime=Eu(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function uf(t){const e=t.auth,n=await t.getIdToken(),r=await Ou(t,cf(e,{idToken:n}));Ke(r?.users.length,e,"internal-error");const i=r.users[0];t._notifyReloadListener(i);const o=i.providerUserInfo?.length?aC(i.providerUserInfo):[],l=dk(t.providerData,o),d=t.isAnonymous,h=!(t.email&&i.passwordHash)&&!l?.length,m=d?h:!1,p={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:l,metadata:new uy(i.createdAt,i.lastLoginAt),isAnonymous:m};Object.assign(t,p)}async function uk(t){const e=xn(t);await uf(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function dk(t,e){return[...t.filter(r=>!e.some(i=>i.providerId===r.providerId)),...e]}function aC(t){return t.map(({providerId:e,...n})=>({providerId:e,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}))}async function hk(t,e){const n=await sC(t,{},async()=>{const r=Ku({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:o}=t.config,l=await iC(t,i,"/v1/token",`key=${o}`),d=await t._getAdditionalHeaders();d["Content-Type"]="application/x-www-form-urlencoded";const h={method:"POST",headers:d,body:r};return t.emulatorConfig&&nc(t.emulatorConfig.host)&&(h.credentials="include"),rC.fetch()(l,h)});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}async function fk(t,e){return Da(t,"POST","/v2/accounts:revokeToken",Oo(t,e))}class Pl{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Ke(e.idToken,"internal-error"),Ke(typeof e.idToken<"u","internal-error"),Ke(typeof e.refreshToken<"u","internal-error");const n="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):cw(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,n)}updateFromIdToken(e){Ke(e.length!==0,"internal-error");const n=cw(e);this.updateTokensAndExpiration(e,null,n)}async getToken(e,n=!1){return!n&&this.accessToken&&!this.isExpired?this.accessToken:(Ke(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,n){const{accessToken:r,refreshToken:i,expiresIn:o}=await hk(e,n);this.updateTokensAndExpiration(r,i,Number(o))}updateTokensAndExpiration(e,n,r){this.refreshToken=n||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,n){const{refreshToken:r,accessToken:i,expirationTime:o}=n,l=new Pl;return r&&(Ke(typeof r=="string","internal-error",{appName:e}),l.refreshToken=r),i&&(Ke(typeof i=="string","internal-error",{appName:e}),l.accessToken=i),o&&(Ke(typeof o=="number","internal-error",{appName:e}),l.expirationTime=o),l}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Pl,this.toJSON())}_performRefresh(){return fi("not implemented")}}function ia(t,e){Ke(typeof t=="string"||typeof t>"u","internal-error",{appName:e})}class os{constructor({uid:e,auth:n,stsTokenManager:r,...i}){this.providerId="firebase",this.proactiveRefresh=new ck(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new uy(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const n=await Ou(this,this.stsTokenManager.getToken(this.auth,e));return Ke(n,this.auth,"internal-error"),this.accessToken!==n&&(this.accessToken=n,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),n}getIdTokenResult(e){return ok(this,e)}reload(){return uk(this)}_assign(e){this!==e&&(Ke(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(n=>({...n})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const n=new os({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return n.metadata._copy(this.metadata),n}_onReload(e){Ke(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,n=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),n&&await uf(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(as(this.auth.app))return Promise.reject(ba(this.auth));const e=await this.getIdToken();return await Ou(this,ak(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,n){const r=n.displayName??void 0,i=n.email??void 0,o=n.phoneNumber??void 0,l=n.photoURL??void 0,d=n.tenantId??void 0,h=n._redirectEventId??void 0,m=n.createdAt??void 0,p=n.lastLoginAt??void 0,{uid:g,emailVerified:v,isAnonymous:_,providerData:C,stsTokenManager:x}=n;Ke(g&&x,e,"internal-error");const S=Pl.fromJSON(this.name,x);Ke(typeof g=="string",e,"internal-error"),ia(r,e.name),ia(i,e.name),Ke(typeof v=="boolean",e,"internal-error"),Ke(typeof _=="boolean",e,"internal-error"),ia(o,e.name),ia(l,e.name),ia(d,e.name),ia(h,e.name),ia(m,e.name),ia(p,e.name);const E=new os({uid:g,auth:e,email:i,emailVerified:v,displayName:r,isAnonymous:_,photoURL:l,phoneNumber:o,tenantId:d,stsTokenManager:S,createdAt:m,lastLoginAt:p});return C&&Array.isArray(C)&&(E.providerData=C.map(T=>({...T}))),h&&(E._redirectEventId=h),E}static async _fromIdTokenResponse(e,n,r=!1){const i=new Pl;i.updateFromServerResponse(n);const o=new os({uid:n.localId,auth:e,stsTokenManager:i,isAnonymous:r});return await uf(o),o}static async _fromGetAccountInfoResponse(e,n,r){const i=n.users[0];Ke(i.localId!==void 0,"internal-error");const o=i.providerUserInfo!==void 0?aC(i.providerUserInfo):[],l=!(i.email&&i.passwordHash)&&!o?.length,d=new Pl;d.updateFromIdToken(r);const h=new os({uid:i.localId,auth:e,stsTokenManager:d,isAnonymous:l}),m={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:o,metadata:new uy(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!o?.length};return Object.assign(h,m),h}}const uw=new Map;function mi(t){vi(t instanceof Function,"Expected a class definition");let e=uw.get(t);return e?(vi(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,uw.set(t,e),e)}class oC{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,n){this.storage[e]=n}async _get(e){const n=this.storage[e];return n===void 0?null:n}async _remove(e){delete this.storage[e]}_addListener(e,n){}_removeListener(e,n){}}oC.type="NONE";const dw=oC;function Qh(t,e,n){return`firebase:${t}:${e}:${n}`}class zl{constructor(e,n,r){this.persistence=e,this.auth=n,this.userKey=r;const{config:i,name:o}=this.auth;this.fullUserKey=Qh(this.userKey,i.apiKey,o),this.fullPersistenceKey=Qh("persistence",i.apiKey,o),this.boundEventHandler=n._onStorageEvent.bind(n),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const n=await cf(this.auth,{idToken:e}).catch(()=>{});return n?os._fromGetAccountInfoResponse(this.auth,n,e):null}return os._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const n=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,n)return this.setCurrentUser(n)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,n,r="authUser"){if(!n.length)return new zl(mi(dw),e,r);const i=(await Promise.all(n.map(async m=>{if(await m._isAvailable())return m}))).filter(m=>m);let o=i[0]||mi(dw);const l=Qh(r,e.config.apiKey,e.name);let d=null;for(const m of n)try{const p=await m._get(l);if(p){let g;if(typeof p=="string"){const v=await cf(e,{idToken:p}).catch(()=>{});if(!v)break;g=await os._fromGetAccountInfoResponse(e,v,p)}else g=os._fromJSON(e,p);m!==o&&(d=g),o=m;break}}catch{}const h=i.filter(m=>m._shouldAllowMigration);return!o._shouldAllowMigration||!h.length?new zl(o,e,r):(o=h[0],d&&await o._set(l,d.toJSON()),await Promise.all(n.map(async m=>{if(m!==o)try{await m._remove(l)}catch{}})),new zl(o,e,r))}}function hw(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(dC(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(lC(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(fC(e))return"Blackberry";if(mC(e))return"Webos";if(cC(e))return"Safari";if((e.includes("chrome/")||uC(e))&&!e.includes("edge/"))return"Chrome";if(hC(e))return"Android";{const n=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=t.match(n);if(r?.length===2)return r[1]}return"Other"}function lC(t=Jn()){return/firefox\//i.test(t)}function cC(t=Jn()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function uC(t=Jn()){return/crios\//i.test(t)}function dC(t=Jn()){return/iemobile/i.test(t)}function hC(t=Jn()){return/android/i.test(t)}function fC(t=Jn()){return/blackberry/i.test(t)}function mC(t=Jn()){return/webos/i.test(t)}function Xy(t=Jn()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function mk(t=Jn()){return Xy(t)&&!!window.navigator?.standalone}function pk(){return RR()&&document.documentMode===10}function pC(t=Jn()){return Xy(t)||hC(t)||mC(t)||fC(t)||/windows phone/i.test(t)||dC(t)}function gC(t,e=[]){let n;switch(t){case"Browser":n=hw(Jn());break;case"Worker":n=`${hw(Jn())}-${t}`;break;default:n=t}const r=e.length?e.join(","):"FirebaseCore-web";return`${n}/JsCore/${rc}/${r}`}class gk{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,n){const r=o=>new Promise((l,d)=>{try{const h=e(o);l(h)}catch(h){d(h)}});r.onAbort=n,this.queue.push(r);const i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const n=[];try{for(const r of this.queue)await r(e),r.onAbort&&n.push(r.onAbort)}catch(r){n.reverse();for(const i of n)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r?.message})}}}async function yk(t,e={}){return Da(t,"GET","/v2/passwordPolicy",Oo(t,e))}const _k=6;class bk{constructor(e){const n=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=n.minPasswordLength??_k,n.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=n.maxPasswordLength),n.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=n.containsLowercaseCharacter),n.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=n.containsUppercaseCharacter),n.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=n.containsNumericCharacter),n.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=n.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const n={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,n),this.validatePasswordCharacterOptions(e,n),n.isValid&&(n.isValid=n.meetsMinPasswordLength??!0),n.isValid&&(n.isValid=n.meetsMaxPasswordLength??!0),n.isValid&&(n.isValid=n.containsLowercaseLetter??!0),n.isValid&&(n.isValid=n.containsUppercaseLetter??!0),n.isValid&&(n.isValid=n.containsNumericCharacter??!0),n.isValid&&(n.isValid=n.containsNonAlphanumericCharacter??!0),n}validatePasswordLengthOptions(e,n){const r=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;r&&(n.meetsMinPasswordLength=e.length>=r),i&&(n.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,n){this.updatePasswordCharacterOptionsStatuses(n,!1,!1,!1,!1);let r;for(let i=0;i<e.length;i++)r=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(n,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,n,r,i,o){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=n)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=o))}}class vk{constructor(e,n,r,i){this.app=e,this.heartbeatServiceProvider=n,this.appCheckServiceProvider=r,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new fw(this),this.idTokenSubscription=new fw(this),this.beforeStateQueue=new gk(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=tC,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion,this._persistenceManagerAvailable=new Promise(o=>this._resolvePersistenceManagerAvailable=o)}_initializeWithPersistence(e,n){return n&&(this._popupRedirectResolver=mi(n)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await zl.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(n),this.lastNotifiedUid=this.currentUser?.uid||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const n=await cf(this,{idToken:e}),r=await os._fromGetAccountInfoResponse(this,n,e);await this.directlySetCurrentUser(r)}catch(n){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",n),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(as(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(l=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(l,l))}):this.directlySetCurrentUser(null)}const n=await this.assertedPersistence.getCurrentUser();let r=n,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=this.redirectUser?._redirectEventId,l=r?._redirectEventId,d=await this.tryRedirectSignIn(e);(!o||o===l)&&d?.user&&(r=d.user,i=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(r)}catch(o){r=n,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return Ke(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let n=null;try{n=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return n}async reloadAndSetCurrentUserOrClear(e){try{await uf(e)}catch(n){if(n?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=ZI()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(as(this.app))return Promise.reject(ba(this));const n=e?xn(e):null;return n&&Ke(n.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(n&&n._clone(this))}async _updateCurrentUser(e,n=!1){if(!this._deleted)return e&&Ke(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),n||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return as(this.app)?Promise.reject(ba(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return as(this.app)?Promise.reject(ba(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(mi(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const n=this._getPasswordPolicyInternal();return n.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):n.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await yk(this),n=new bk(e);this.tenantId===null?this._projectPasswordPolicy=n:this._tenantPasswordPolicies[this.tenantId]=n}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new Wu("auth","Firebase",e())}onAuthStateChanged(e,n,r){return this.registerStateListener(this.authStateSubscription,e,n,r)}beforeAuthStateChanged(e,n){return this.beforeStateQueue.pushCallback(e,n)}onIdTokenChanged(e,n,r){return this.registerStateListener(this.idTokenSubscription,e,n,r)}authStateReady(){return new Promise((e,n)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},n)}})}async revokeAccessToken(e){if(this.currentUser){const n=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:n};this.tenantId!=null&&(r.tenantId=this.tenantId),await fk(this,r)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,n){const r=await this.getOrInitRedirectPersistenceManager(n);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const n=e&&mi(e)||this._popupRedirectResolver;Ke(n,this,"argument-error"),this.redirectPersistenceManager=await zl.create(this,[mi(n._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,n,r,i){if(this._deleted)return()=>{};const o=typeof n=="function"?n:n.next.bind(n);let l=!1;const d=this._isInitialized?Promise.resolve():this._initializationPromise;if(Ke(d,this,"internal-error"),d.then(()=>{l||o(this.currentUser)}),typeof n=="function"){const h=e.addObserver(n,r,i);return()=>{l=!0,h()}}else{const h=e.addObserver(n);return()=>{l=!0,h()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Ke(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=gC(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const n=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();n&&(e["X-Firebase-Client"]=n);const r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){if(as(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&KI(`Error while retrieving App Check token: ${e.error}`),e?.token}}function sc(t){return xn(t)}class fw{constructor(e){this.auth=e,this.observer=null,this.addObserver=zR(n=>this.observer=n)}get next(){return Ke(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let Vf={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function xk(t){Vf=t}function yC(t){return Vf.loadJS(t)}function wk(){return Vf.recaptchaEnterpriseScript}function Sk(){return Vf.gapiScript}function Ck(t){return`__${t}${Math.floor(Math.random()*1e6)}`}class Ek{constructor(){this.enterprise=new Tk}ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}class Tk{ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}const Ak="recaptcha-enterprise",_C="NO_RECAPTCHA";class jk{constructor(e){this.type=Ak,this.auth=sc(e)}async verify(e="verify",n=!1){async function r(o){if(!n){if(o.tenantId==null&&o._agentRecaptchaConfig!=null)return o._agentRecaptchaConfig.siteKey;if(o.tenantId!=null&&o._tenantRecaptchaConfigs[o.tenantId]!==void 0)return o._tenantRecaptchaConfigs[o.tenantId].siteKey}return new Promise(async(l,d)=>{ik(o,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(h=>{if(h.recaptchaKey===void 0)d(new Error("recaptcha Enterprise site key undefined"));else{const m=new sk(h);return o.tenantId==null?o._agentRecaptchaConfig=m:o._tenantRecaptchaConfigs[o.tenantId]=m,l(m.siteKey)}}).catch(h=>{d(h)})})}function i(o,l,d){const h=window.grecaptcha;lw(h)?h.enterprise.ready(()=>{h.enterprise.execute(o,{action:e}).then(m=>{l(m)}).catch(()=>{l(_C)})}):d(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new Ek().execute("siteKey",{action:"verify"}):new Promise((o,l)=>{r(this.auth).then(d=>{if(!n&&lw(window.grecaptcha))i(d,o,l);else{if(typeof window>"u"){l(new Error("RecaptchaVerifier is only supported in browser"));return}let h=wk();h.length!==0&&(h+=d),yC(h).then(()=>{i(d,o,l)}).catch(m=>{l(m)})}}).catch(d=>{l(d)})})}}async function mw(t,e,n,r=!1,i=!1){const o=new jk(t);let l;if(i)l=_C;else try{l=await o.verify(n)}catch{l=await o.verify(n,!0)}const d={...e};if(n==="mfaSmsEnrollment"||n==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in d){const h=d.phoneEnrollmentInfo.phoneNumber,m=d.phoneEnrollmentInfo.recaptchaToken;Object.assign(d,{phoneEnrollmentInfo:{phoneNumber:h,recaptchaToken:m,captchaResponse:l,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in d){const h=d.phoneSignInInfo.recaptchaToken;Object.assign(d,{phoneSignInInfo:{recaptchaToken:h,captchaResponse:l,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return d}return r?Object.assign(d,{captchaResp:l}):Object.assign(d,{captchaResponse:l}),Object.assign(d,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(d,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),d}async function pw(t,e,n,r,i){if(t._getRecaptchaConfig()?.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const o=await mw(t,e,n,n==="getOobCode");return r(t,o)}else return r(t,e).catch(async o=>{if(o.code==="auth/missing-recaptcha-token"){console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const l=await mw(t,e,n,n==="getOobCode");return r(t,l)}else return Promise.reject(o)})}function Rk(t,e){const n=Qy(t,"auth");if(n.isInitialized()){const i=n.getImmediate(),o=n.getOptions();if(_i(o,e??{}))return i;us(i,"already-initialized")}return n.initialize({options:e})}function Ik(t,e){const n=e?.persistence||[],r=(Array.isArray(n)?n:[n]).map(mi);e?.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(r,e?.popupRedirectResolver)}function kk(t,e,n){const r=sc(t);Ke(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const i=!1,o=bC(e),{host:l,port:d}=Dk(e),h=d===null?"":`:${d}`,m={url:`${o}//${l}${h}/`},p=Object.freeze({host:l,port:d,protocol:o.replace(":",""),options:Object.freeze({disableWarnings:i})});if(!r._canInitEmulator){Ke(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),Ke(_i(m,r.config.emulator)&&_i(p,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=m,r.emulatorConfig=p,r.settings.appVerificationDisabledForTesting=!0,nc(l)?(GS(`${o}//${l}${h}`),QS("Auth",!0)):Ok()}function bC(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function Dk(t){const e=bC(t),n=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){const o=i[1];return{host:o,port:gw(r.substr(o.length+1))}}else{const[o,l]=r.split(":");return{host:o,port:gw(l)}}}function gw(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}function Ok(){function t(){const e=document.createElement("p"),n=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",n.position="fixed",n.width="100%",n.backgroundColor="#ffffff",n.border=".1em solid #000000",n.color="#b50000",n.bottom="0px",n.left="0px",n.margin="0px",n.zIndex="10000",n.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",t):t())}class Zy{constructor(e,n){this.providerId=e,this.signInMethod=n}toJSON(){return fi("not implemented")}_getIdTokenResponse(e){return fi("not implemented")}_linkToIdToken(e,n){return fi("not implemented")}_getReauthenticationResolver(e){return fi("not implemented")}}async function Mk(t,e){return Da(t,"POST","/v1/accounts:signUp",e)}async function Nk(t,e){return Ff(t,"POST","/v1/accounts:signInWithPassword",Oo(t,e))}async function Pk(t,e){return Ff(t,"POST","/v1/accounts:signInWithEmailLink",Oo(t,e))}async function zk(t,e){return Ff(t,"POST","/v1/accounts:signInWithEmailLink",Oo(t,e))}class Mu extends Zy{constructor(e,n,r,i=null){super("password",r),this._email=e,this._password=n,this._tenantId=i}static _fromEmailAndPassword(e,n){return new Mu(e,n,"password")}static _fromEmailAndCode(e,n,r=null){return new Mu(e,n,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e;if(n?.email&&n?.password){if(n.signInMethod==="password")return this._fromEmailAndPassword(n.email,n.password);if(n.signInMethod==="emailLink")return this._fromEmailAndCode(n.email,n.password,n.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const n={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return pw(e,n,"signInWithPassword",Nk);case"emailLink":return Pk(e,{email:this._email,oobCode:this._password});default:us(e,"internal-error")}}async _linkToIdToken(e,n){switch(this.signInMethod){case"password":const r={idToken:n,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return pw(e,r,"signUpPassword",Mk);case"emailLink":return zk(e,{idToken:n,email:this._email,oobCode:this._password});default:us(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function Bl(t,e){return Ff(t,"POST","/v1/accounts:signInWithIdp",Oo(t,e))}const Bk="http://localhost";class jo extends Zy{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const n=new jo(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(n.idToken=e.idToken),e.accessToken&&(n.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(n.nonce=e.nonce),e.pendingToken&&(n.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(n.accessToken=e.oauthToken,n.secret=e.oauthTokenSecret):us("argument-error"),n}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:i,...o}=n;if(!r||!i)return null;const l=new jo(r,i);return l.idToken=o.idToken||void 0,l.accessToken=o.accessToken||void 0,l.secret=o.secret,l.nonce=o.nonce,l.pendingToken=o.pendingToken||null,l}_getIdTokenResponse(e){const n=this.buildRequest();return Bl(e,n)}_linkToIdToken(e,n){const r=this.buildRequest();return r.idToken=n,Bl(e,r)}_getReauthenticationResolver(e){const n=this.buildRequest();return n.autoCreate=!1,Bl(e,n)}buildRequest(){const e={requestUri:Bk,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const n={};this.idToken&&(n.id_token=this.idToken),this.accessToken&&(n.access_token=this.accessToken),this.secret&&(n.oauth_token_secret=this.secret),n.providerId=this.providerId,this.nonce&&!this.pendingToken&&(n.nonce=this.nonce),e.postBody=Ku(n)}return e}}function Lk(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function Uk(t){const e=_u(bu(t)).link,n=e?_u(bu(e)).deep_link_id:null,r=_u(bu(t)).deep_link_id;return(r?_u(bu(r)).link:null)||r||n||e||t}class Jy{constructor(e){const n=_u(bu(e)),r=n.apiKey??null,i=n.oobCode??null,o=Lk(n.mode??null);Ke(r&&i&&o,"argument-error"),this.apiKey=r,this.operation=o,this.code=i,this.continueUrl=n.continueUrl??null,this.languageCode=n.lang??null,this.tenantId=n.tenantId??null}static parseLink(e){const n=Uk(e);try{return new Jy(n)}catch{return null}}}class ic{constructor(){this.providerId=ic.PROVIDER_ID}static credential(e,n){return Mu._fromEmailAndPassword(e,n)}static credentialWithLink(e,n){const r=Jy.parseLink(n);return Ke(r,"argument-error"),Mu._fromEmailAndCode(e,r.code,r.tenantId)}}ic.PROVIDER_ID="password";ic.EMAIL_PASSWORD_SIGN_IN_METHOD="password";ic.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class vC{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class Xu extends vC{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class oa extends Xu{constructor(){super("facebook.com")}static credential(e){return jo._fromParams({providerId:oa.PROVIDER_ID,signInMethod:oa.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return oa.credentialFromTaggedObject(e)}static credentialFromError(e){return oa.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return oa.credential(e.oauthAccessToken)}catch{return null}}}oa.FACEBOOK_SIGN_IN_METHOD="facebook.com";oa.PROVIDER_ID="facebook.com";class la extends Xu{constructor(){super("google.com"),this.addScope("profile")}static credential(e,n){return jo._fromParams({providerId:la.PROVIDER_ID,signInMethod:la.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:n})}static credentialFromResult(e){return la.credentialFromTaggedObject(e)}static credentialFromError(e){return la.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:n,oauthAccessToken:r}=e;if(!n&&!r)return null;try{return la.credential(n,r)}catch{return null}}}la.GOOGLE_SIGN_IN_METHOD="google.com";la.PROVIDER_ID="google.com";class ca extends Xu{constructor(){super("github.com")}static credential(e){return jo._fromParams({providerId:ca.PROVIDER_ID,signInMethod:ca.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return ca.credentialFromTaggedObject(e)}static credentialFromError(e){return ca.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return ca.credential(e.oauthAccessToken)}catch{return null}}}ca.GITHUB_SIGN_IN_METHOD="github.com";ca.PROVIDER_ID="github.com";class ua extends Xu{constructor(){super("twitter.com")}static credential(e,n){return jo._fromParams({providerId:ua.PROVIDER_ID,signInMethod:ua.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:n})}static credentialFromResult(e){return ua.credentialFromTaggedObject(e)}static credentialFromError(e){return ua.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:n,oauthTokenSecret:r}=e;if(!n||!r)return null;try{return ua.credential(n,r)}catch{return null}}}ua.TWITTER_SIGN_IN_METHOD="twitter.com";ua.PROVIDER_ID="twitter.com";class Vl{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,n,r,i=!1){const o=await os._fromIdTokenResponse(e,r,i),l=yw(r);return new Vl({user:o,providerId:l,_tokenResponse:r,operationType:n})}static async _forOperation(e,n,r){await e._updateTokensIfNecessary(r,!0);const i=yw(r);return new Vl({user:e,providerId:i,_tokenResponse:r,operationType:n})}}function yw(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}class df extends Ei{constructor(e,n,r,i){super(n.code,n.message),this.operationType=r,this.user=i,Object.setPrototypeOf(this,df.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:n.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,n,r,i){return new df(e,n,r,i)}}function xC(t,e,n,r){return(e==="reauthenticate"?n._getReauthenticationResolver(t):n._getIdTokenResponse(t)).catch(o=>{throw o.code==="auth/multi-factor-auth-required"?df._fromErrorAndOperation(t,o,e,r):o})}async function Fk(t,e,n=!1){const r=await Ou(t,e._linkToIdToken(t.auth,await t.getIdToken()),n);return Vl._forOperation(t,"link",r)}async function Vk(t,e,n=!1){const{auth:r}=t;if(as(r.app))return Promise.reject(ba(r));const i="reauthenticate";try{const o=await Ou(t,xC(r,i,e,t),n);Ke(o.idToken,r,"internal-error");const l=Yy(o.idToken);Ke(l,r,"internal-error");const{sub:d}=l;return Ke(t.uid===d,r,"user-mismatch"),Vl._forOperation(t,i,o)}catch(o){throw o?.code==="auth/user-not-found"&&us(r,"user-mismatch"),o}}async function wC(t,e,n=!1){if(as(t.app))return Promise.reject(ba(t));const r="signIn",i=await xC(t,r,e),o=await Vl._fromIdTokenResponse(t,r,i);return n||await t._updateCurrentUser(o.user),o}async function $k(t,e){return wC(sc(t),e)}async function qk(t){const e=sc(t);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}function Hk(t,e,n){return as(t.app)?Promise.reject(ba(t)):$k(xn(t),ic.credential(e,n)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&qk(t),r})}function Gk(t,e,n,r){return xn(t).onIdTokenChanged(e,n,r)}function Qk(t,e,n){return xn(t).beforeAuthStateChanged(e,n)}function Wk(t,e,n,r){return xn(t).onAuthStateChanged(e,n,r)}function Kk(t){return xn(t).signOut()}const hf="__sak";class SC{constructor(e,n){this.storageRetriever=e,this.type=n}_isAvailable(){try{return this.storage?(this.storage.setItem(hf,"1"),this.storage.removeItem(hf),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,n){return this.storage.setItem(e,JSON.stringify(n)),Promise.resolve()}_get(e){const n=this.storage.getItem(e);return Promise.resolve(n?JSON.parse(n):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}const Yk=1e3,Xk=10;class CC extends SC{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,n)=>this.onStorageEvent(e,n),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=pC(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const n of Object.keys(this.listeners)){const r=this.storage.getItem(n),i=this.localCache[n];r!==i&&e(n,i,r)}}onStorageEvent(e,n=!1){if(!e.key){this.forAllChangedKeys((l,d,h)=>{this.notifyListeners(l,h)});return}const r=e.key;n?this.detachListener():this.stopPolling();const i=()=>{const l=this.storage.getItem(r);!n&&this.localCache[r]===l||this.notifyListeners(r,l)},o=this.storage.getItem(r);pk()&&o!==e.newValue&&e.newValue!==e.oldValue?setTimeout(i,Xk):i()}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const i of Array.from(r))i(n&&JSON.parse(n))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,n,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:n,newValue:r}),!0)})},Yk)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,n){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,n){await super._set(e,n),this.localCache[e]=JSON.stringify(n)}async _get(e){const n=await super._get(e);return this.localCache[e]=JSON.stringify(n),n}async _remove(e){await super._remove(e),delete this.localCache[e]}}CC.type="LOCAL";const Zk=CC;class EC extends SC{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,n){}_removeListener(e,n){}}EC.type="SESSION";const TC=EC;function Jk(t){return Promise.all(t.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(n){return{fulfilled:!1,reason:n}}}))}class $f{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const n=this.receivers.find(i=>i.isListeningto(e));if(n)return n;const r=new $f(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const n=e,{eventId:r,eventType:i,data:o}=n.data,l=this.handlersMap[i];if(!l?.size)return;n.ports[0].postMessage({status:"ack",eventId:r,eventType:i});const d=Array.from(l).map(async m=>m(n.origin,o)),h=await Jk(d);n.ports[0].postMessage({status:"done",eventId:r,eventType:i,response:h})}_subscribe(e,n){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(n)}_unsubscribe(e,n){this.handlersMap[e]&&n&&this.handlersMap[e].delete(n),(!n||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}$f.receivers=[];function e0(t="",e=10){let n="";for(let r=0;r<e;r++)n+=Math.floor(Math.random()*10);return t+n}class eD{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,n,r=50){const i=typeof MessageChannel<"u"?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let o,l;return new Promise((d,h)=>{const m=e0("",20);i.port1.start();const p=setTimeout(()=>{h(new Error("unsupported_event"))},r);l={messageChannel:i,onMessage(g){const v=g;if(v.data.eventId===m)switch(v.data.status){case"ack":clearTimeout(p),o=setTimeout(()=>{h(new Error("timeout"))},3e3);break;case"done":clearTimeout(o),d(v.data.response);break;default:clearTimeout(p),clearTimeout(o),h(new Error("invalid_response"));break}}},this.handlers.add(l),i.port1.addEventListener("message",l.onMessage),this.target.postMessage({eventType:e,eventId:m,data:n},[i.port2])}).finally(()=>{l&&this.removeMessageHandler(l)})}}function Us(){return window}function tD(t){Us().location.href=t}function AC(){return typeof Us().WorkerGlobalScope<"u"&&typeof Us().importScripts=="function"}async function nD(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function rD(){return navigator?.serviceWorker?.controller||null}function sD(){return AC()?self:null}const jC="firebaseLocalStorageDb",iD=1,ff="firebaseLocalStorage",RC="fbase_key";class Zu{constructor(e){this.request=e}toPromise(){return new Promise((e,n)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{n(this.request.error)})})}}function qf(t,e){return t.transaction([ff],e?"readwrite":"readonly").objectStore(ff)}function aD(){const t=indexedDB.deleteDatabase(jC);return new Zu(t).toPromise()}function dy(){const t=indexedDB.open(jC,iD);return new Promise((e,n)=>{t.addEventListener("error",()=>{n(t.error)}),t.addEventListener("upgradeneeded",()=>{const r=t.result;try{r.createObjectStore(ff,{keyPath:RC})}catch(i){n(i)}}),t.addEventListener("success",async()=>{const r=t.result;r.objectStoreNames.contains(ff)?e(r):(r.close(),await aD(),e(await dy()))})})}async function _w(t,e,n){const r=qf(t,!0).put({[RC]:e,value:n});return new Zu(r).toPromise()}async function oD(t,e){const n=qf(t,!1).get(e),r=await new Zu(n).toPromise();return r===void 0?null:r.value}function bw(t,e){const n=qf(t,!0).delete(e);return new Zu(n).toPromise()}const lD=800,cD=3;class IC{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await dy(),this.db)}async _withRetries(e){let n=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(n++>cD)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return AC()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=$f._getInstance(sD()),this.receiver._subscribe("keyChanged",async(e,n)=>({keyProcessed:(await this._poll()).includes(n.key)})),this.receiver._subscribe("ping",async(e,n)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await nD(),!this.activeServiceWorker)return;this.sender=new eD(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||rD()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await dy();return await _w(e,hf,"1"),await bw(e,hf),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,n){return this._withPendingWrite(async()=>(await this._withRetries(r=>_w(r,e,n)),this.localCache[e]=n,this.notifyServiceWorker(e)))}async _get(e){const n=await this._withRetries(r=>oD(r,e));return this.localCache[e]=n,n}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(n=>bw(n,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(i=>{const o=qf(i,!1).getAll();return new Zu(o).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const n=[],r=new Set;if(e.length!==0)for(const{fbase_key:i,value:o}of e)r.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(o)&&(this.notifyListeners(i,o),n.push(i));for(const i of Object.keys(this.localCache))this.localCache[i]&&!r.has(i)&&(this.notifyListeners(i,null),n.push(i));return n}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const i of Array.from(r))i(n)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),lD)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,n){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}IC.type="LOCAL";const uD=IC;new Yu(3e4,6e4);function dD(t,e){return e?mi(e):(Ke(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}class t0 extends Zy{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Bl(e,this._buildIdpRequest())}_linkToIdToken(e,n){return Bl(e,this._buildIdpRequest(n))}_getReauthenticationResolver(e){return Bl(e,this._buildIdpRequest())}_buildIdpRequest(e){const n={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(n.idToken=e),n}}function hD(t){return wC(t.auth,new t0(t),t.bypassAuthState)}function fD(t){const{auth:e,user:n}=t;return Ke(n,e,"internal-error"),Vk(n,new t0(t),t.bypassAuthState)}async function mD(t){const{auth:e,user:n}=t;return Ke(n,e,"internal-error"),Fk(n,new t0(t),t.bypassAuthState)}class kC{constructor(e,n,r,i,o=!1){this.auth=e,this.resolver=r,this.user=i,this.bypassAuthState=o,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(n)?n:[n]}execute(){return new Promise(async(e,n)=>{this.pendingPromise={resolve:e,reject:n};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:n,sessionId:r,postBody:i,tenantId:o,error:l,type:d}=e;if(l){this.reject(l);return}const h={auth:this.auth,requestUri:n,sessionId:r,tenantId:o||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(d)(h))}catch(m){this.reject(m)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return hD;case"linkViaPopup":case"linkViaRedirect":return mD;case"reauthViaPopup":case"reauthViaRedirect":return fD;default:us(this.auth,"internal-error")}}resolve(e){vi(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){vi(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const pD=new Yu(2e3,1e4);class Nl extends kC{constructor(e,n,r,i,o){super(e,n,i,o),this.provider=r,this.authWindow=null,this.pollId=null,Nl.currentPopupAction&&Nl.currentPopupAction.cancel(),Nl.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Ke(e,this.auth,"internal-error"),e}async onExecution(){vi(this.filter.length===1,"Popup operations only handle one event");const e=e0();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(n=>{this.reject(n)}),this.resolver._isIframeWebStorageSupported(this.auth,n=>{n||this.reject(Ls(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(Ls(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Nl.currentPopupAction=null}pollUserCancellation(){const e=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Ls(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,pD.get())};e()}}Nl.currentPopupAction=null;const gD="pendingRedirect",Wh=new Map;class yD extends kC{constructor(e,n,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],n,void 0,r),this.eventId=null}async execute(){let e=Wh.get(this.auth._key());if(!e){try{const r=await _D(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(n){e=()=>Promise.reject(n)}Wh.set(this.auth._key(),e)}return this.bypassAuthState||Wh.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const n=await this.auth._redirectUserForId(e.eventId);if(n)return this.user=n,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function _D(t,e){const n=xD(e),r=vD(t);if(!await r._isAvailable())return!1;const i=await r._get(n)==="true";return await r._remove(n),i}function bD(t,e){Wh.set(t._key(),e)}function vD(t){return mi(t._redirectPersistence)}function xD(t){return Qh(gD,t.config.apiKey,t.name)}async function wD(t,e,n=!1){if(as(t.app))return Promise.reject(ba(t));const r=sc(t),i=dD(r,e),l=await new yD(r,i,n).execute();return l&&!n&&(delete l.user._redirectEventId,await r._persistUserIfCurrent(l.user),await r._setRedirectUser(null,e)),l}const SD=600*1e3;class CD{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let n=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(n=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!ED(e)||(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=e,n=!0)),n}sendToConsumer(e,n){if(e.error&&!DC(e)){const r=e.error.code?.split("auth/")[1]||"internal-error";n.onError(Ls(this.auth,r))}else n.onAuthEvent(e)}isEventForConsumer(e,n){const r=n.eventId===null||!!e.eventId&&e.eventId===n.eventId;return n.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=SD&&this.cachedEventUids.clear(),this.cachedEventUids.has(vw(e))}saveEventToCache(e){this.cachedEventUids.add(vw(e)),this.lastProcessedEventTime=Date.now()}}function vw(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(e=>e).join("-")}function DC({type:t,error:e}){return t==="unknown"&&e?.code==="auth/no-auth-event"}function ED(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return DC(t);default:return!1}}async function TD(t,e={}){return Da(t,"GET","/v1/projects",e)}const AD=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,jD=/^https?/;async function RD(t){if(t.config.emulator)return;const{authorizedDomains:e}=await TD(t);for(const n of e)try{if(ID(n))return}catch{}us(t,"unauthorized-domain")}function ID(t){const e=cy(),{protocol:n,hostname:r}=new URL(e);if(t.startsWith("chrome-extension://")){const l=new URL(t);return l.hostname===""&&r===""?n==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):n==="chrome-extension:"&&l.hostname===r}if(!jD.test(n))return!1;if(AD.test(t))return r===t;const i=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}const kD=new Yu(3e4,6e4);function xw(){const t=Us().___jsl;if(t?.H){for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let n=0;n<t.CP.length;n++)t.CP[n]=null}}function DD(t){return new Promise((e,n)=>{function r(){xw(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{xw(),n(Ls(t,"network-request-failed"))},timeout:kD.get()})}if(Us().gapi?.iframes?.Iframe)e(gapi.iframes.getContext());else if(Us().gapi?.load)r();else{const i=Ck("iframefcb");return Us()[i]=()=>{gapi.load?r():n(Ls(t,"network-request-failed"))},yC(`${Sk()}?onload=${i}`).catch(o=>n(o))}}).catch(e=>{throw Kh=null,e})}let Kh=null;function OD(t){return Kh=Kh||DD(t),Kh}const MD=new Yu(5e3,15e3),ND="__/auth/iframe",PD="emulator/auth/iframe",zD={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},BD=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function LD(t){const e=t.config;Ke(e.authDomain,t,"auth-domain-config-required");const n=e.emulator?Ky(e,PD):`https://${t.config.authDomain}/${ND}`,r={apiKey:e.apiKey,appName:t.name,v:rc},i=BD.get(t.config.apiHost);i&&(r.eid=i);const o=t._getFrameworks();return o.length&&(r.fw=o.join(",")),`${n}?${Ku(r).slice(1)}`}async function UD(t){const e=await OD(t),n=Us().gapi;return Ke(n,t,"internal-error"),e.open({where:document.body,url:LD(t),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:zD,dontclear:!0},r=>new Promise(async(i,o)=>{await r.restyle({setHideOnLeave:!1});const l=Ls(t,"network-request-failed"),d=Us().setTimeout(()=>{o(l)},MD.get());function h(){Us().clearTimeout(d),i(r)}r.ping(h).then(h,()=>{o(l)})}))}const FD={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},VD=500,$D=600,qD="_blank",HD="http://localhost";class ww{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function GD(t,e,n,r=VD,i=$D){const o=Math.max((window.screen.availHeight-i)/2,0).toString(),l=Math.max((window.screen.availWidth-r)/2,0).toString();let d="";const h={...FD,width:r.toString(),height:i.toString(),top:o,left:l},m=Jn().toLowerCase();n&&(d=uC(m)?qD:n),lC(m)&&(e=e||HD,h.scrollbars="yes");const p=Object.entries(h).reduce((v,[_,C])=>`${v}${_}=${C},`,"");if(mk(m)&&d!=="_self")return QD(e||"",d),new ww(null);const g=window.open(e||"",d,p);Ke(g,t,"popup-blocked");try{g.focus()}catch{}return new ww(g)}function QD(t,e){const n=document.createElement("a");n.href=t,n.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}const WD="__/auth/handler",KD="emulator/auth/handler",YD=encodeURIComponent("fac");async function Sw(t,e,n,r,i,o){Ke(t.config.authDomain,t,"auth-domain-config-required"),Ke(t.config.apiKey,t,"invalid-api-key");const l={apiKey:t.config.apiKey,appName:t.name,authType:n,redirectUrl:r,v:rc,eventId:i};if(e instanceof vC){e.setDefaultLanguage(t.languageCode),l.providerId=e.providerId||"",PR(e.getCustomParameters())||(l.customParameters=JSON.stringify(e.getCustomParameters()));for(const[p,g]of Object.entries({}))l[p]=g}if(e instanceof Xu){const p=e.getScopes().filter(g=>g!=="");p.length>0&&(l.scopes=p.join(","))}t.tenantId&&(l.tid=t.tenantId);const d=l;for(const p of Object.keys(d))d[p]===void 0&&delete d[p];const h=await t._getAppCheckToken(),m=h?`#${YD}=${encodeURIComponent(h)}`:"";return`${XD(t)}?${Ku(d).slice(1)}${m}`}function XD({config:t}){return t.emulator?Ky(t,KD):`https://${t.authDomain}/${WD}`}const Mg="webStorageSupport";class ZD{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=TC,this._completeRedirectFn=wD,this._overrideRedirectResult=bD}async _openPopup(e,n,r,i){vi(this.eventManagers[e._key()]?.manager,"_initialize() not called before _openPopup()");const o=await Sw(e,n,r,cy(),i);return GD(e,o,e0())}async _openRedirect(e,n,r,i){await this._originValidation(e);const o=await Sw(e,n,r,cy(),i);return tD(o),new Promise(()=>{})}_initialize(e){const n=e._key();if(this.eventManagers[n]){const{manager:i,promise:o}=this.eventManagers[n];return i?Promise.resolve(i):(vi(o,"If manager is not set, promise should be"),o)}const r=this.initAndGetManager(e);return this.eventManagers[n]={promise:r},r.catch(()=>{delete this.eventManagers[n]}),r}async initAndGetManager(e){const n=await UD(e),r=new CD(e);return n.register("authEvent",i=>(Ke(i?.authEvent,e,"invalid-auth-event"),{status:r.onEvent(i.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=n,r}_isIframeWebStorageSupported(e,n){this.iframes[e._key()].send(Mg,{type:Mg},i=>{const o=i?.[0]?.[Mg];o!==void 0&&n(!!o),us(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const n=e._key();return this.originValidationPromises[n]||(this.originValidationPromises[n]=RD(e)),this.originValidationPromises[n]}get _shouldInitProactively(){return pC()||cC()||Xy()}}const JD=ZD;var Cw="@firebase/auth",Ew="1.12.0";class eO{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const n=this.auth.onIdTokenChanged(r=>{e(r?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,n),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const n=this.internalListeners.get(e);n&&(this.internalListeners.delete(e),n(),this.updateProactiveRefresh())}assertAuthConfigured(){Ke(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function tO(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function nO(t){Fl(new Ao("auth",(e,{options:n})=>{const r=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),o=e.getProvider("app-check-internal"),{apiKey:l,authDomain:d}=r.options;Ke(l&&!l.includes(":"),"invalid-api-key",{appName:r.name});const h={apiKey:l,authDomain:d,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:gC(t)},m=new vk(r,i,o,h);return Ik(m,n),m},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,n,r)=>{e.getProvider("auth-internal").initialize()})),Fl(new Ao("auth-internal",e=>{const n=sc(e.getProvider("auth").getImmediate());return(r=>new eO(r))(n)},"PRIVATE").setInstantiationMode("EXPLICIT")),_a(Cw,Ew,tO(t)),_a(Cw,Ew,"esm2020")}const rO=300,sO=HS("authIdTokenMaxAge")||rO;let Tw=null;const iO=t=>async e=>{const n=e&&await e.getIdTokenResult(),r=n&&(new Date().getTime()-Date.parse(n.issuedAtTime))/1e3;if(r&&r>sO)return;const i=n?.token;Tw!==i&&(Tw=i,await fetch(t,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))};function aO(t=XS()){const e=Qy(t,"auth");if(e.isInitialized())return e.getImmediate();const n=Rk(t,{popupRedirectResolver:JD,persistence:[uD,Zk,TC]}),r=HS("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const o=new URL(r,location.origin);if(location.origin===o.origin){const l=iO(o.toString());Qk(n,l,()=>l(n.currentUser)),Gk(n,d=>l(d))}}const i=$S("auth");return i&&kk(n,`http://${i}`),n}function oO(){return document.getElementsByTagName("head")?.[0]??document}xk({loadJS(t){return new Promise((e,n)=>{const r=document.createElement("script");r.setAttribute("src",t),r.onload=e,r.onerror=i=>{const o=Ls("internal-error");o.customData=i,n(o)},r.type="text/javascript",r.charset="UTF-8",oO().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});nO("Browser");var lO="firebase",cO="12.7.0";_a(lO,cO,"app");const uO={apiKey:"AIzaSyCfvR8bEeW2CXdD31Ec34doRNThnbryXJo",authDomain:"budget-tkl.firebaseapp.com",projectId:"budget-tkl",storageBucket:"budget-tkl.firebasestorage.app",messagingSenderId:"631248313026",appId:"1:631248313026:web:36574d789a42b2d102f95b"},OC=YS(uO);function Oa(){const t=aO(OC);async function e(){return!1}async function n(h,m){return Hk(t,h,m)}function r(){return Kk(t)}function i(h){Wk(t,m=>{h(m)})}function o(){return t.currentUser}function l(){const h=t.currentUser;if(!h)throw new Error("Not authenticated");if(!h.email)throw new Error("Email is required but not available for this account");return h.email}return{set_user_listener:i,delete_firebase_user:e,login_firebase_user:n,logout_firebase_user:r,get_current_firebase_user:o,requireUserEmail:l}}const ac=300*1e3,dO=1800*1e3,Ue=new Yj({defaultOptions:{queries:{staleTime:ac,gcTime:dO,refetchOnWindowFocus:!1,refetchOnReconnect:!0,retry:1,refetchOnMount:!0},mutations:{retry:1}}});Ue.getQueryCache().subscribe(t=>{const e=t?.query;if(e&&t.type==="updated"){const{state:n}=e;n.status==="error"&&n.error&&console.error("[RQ] Query FAILED:",e.queryKey,n.error)}});const ke={user:t=>["user",t],budget:t=>["budget",t],month:(t,e,n)=>["month",t,e,n],payees:t=>["payees",t],accessibleBudgets:t=>["accessibleBudgets",t],feedback:()=>["feedback"]};function hO({children:t}){return u.jsx(Xj,{client:Ue,children:t})}var Aw=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var va,MC;(function(){var t;function e(k,A){function N(){}N.prototype=A.prototype,k.F=A.prototype,k.prototype=new N,k.prototype.constructor=k,k.D=function(F,q,j){for(var P=Array(arguments.length-2),O=2;O<arguments.length;O++)P[O-2]=arguments[O];return A.prototype[q].apply(F,P)}}function n(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(r,n),r.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(k,A,N){N||(N=0);const F=Array(16);if(typeof A=="string")for(var q=0;q<16;++q)F[q]=A.charCodeAt(N++)|A.charCodeAt(N++)<<8|A.charCodeAt(N++)<<16|A.charCodeAt(N++)<<24;else for(q=0;q<16;++q)F[q]=A[N++]|A[N++]<<8|A[N++]<<16|A[N++]<<24;A=k.g[0],N=k.g[1],q=k.g[2];let j=k.g[3],P;P=A+(j^N&(q^j))+F[0]+3614090360&4294967295,A=N+(P<<7&4294967295|P>>>25),P=j+(q^A&(N^q))+F[1]+3905402710&4294967295,j=A+(P<<12&4294967295|P>>>20),P=q+(N^j&(A^N))+F[2]+606105819&4294967295,q=j+(P<<17&4294967295|P>>>15),P=N+(A^q&(j^A))+F[3]+3250441966&4294967295,N=q+(P<<22&4294967295|P>>>10),P=A+(j^N&(q^j))+F[4]+4118548399&4294967295,A=N+(P<<7&4294967295|P>>>25),P=j+(q^A&(N^q))+F[5]+1200080426&4294967295,j=A+(P<<12&4294967295|P>>>20),P=q+(N^j&(A^N))+F[6]+2821735955&4294967295,q=j+(P<<17&4294967295|P>>>15),P=N+(A^q&(j^A))+F[7]+4249261313&4294967295,N=q+(P<<22&4294967295|P>>>10),P=A+(j^N&(q^j))+F[8]+1770035416&4294967295,A=N+(P<<7&4294967295|P>>>25),P=j+(q^A&(N^q))+F[9]+2336552879&4294967295,j=A+(P<<12&4294967295|P>>>20),P=q+(N^j&(A^N))+F[10]+4294925233&4294967295,q=j+(P<<17&4294967295|P>>>15),P=N+(A^q&(j^A))+F[11]+2304563134&4294967295,N=q+(P<<22&4294967295|P>>>10),P=A+(j^N&(q^j))+F[12]+1804603682&4294967295,A=N+(P<<7&4294967295|P>>>25),P=j+(q^A&(N^q))+F[13]+4254626195&4294967295,j=A+(P<<12&4294967295|P>>>20),P=q+(N^j&(A^N))+F[14]+2792965006&4294967295,q=j+(P<<17&4294967295|P>>>15),P=N+(A^q&(j^A))+F[15]+1236535329&4294967295,N=q+(P<<22&4294967295|P>>>10),P=A+(q^j&(N^q))+F[1]+4129170786&4294967295,A=N+(P<<5&4294967295|P>>>27),P=j+(N^q&(A^N))+F[6]+3225465664&4294967295,j=A+(P<<9&4294967295|P>>>23),P=q+(A^N&(j^A))+F[11]+643717713&4294967295,q=j+(P<<14&4294967295|P>>>18),P=N+(j^A&(q^j))+F[0]+3921069994&4294967295,N=q+(P<<20&4294967295|P>>>12),P=A+(q^j&(N^q))+F[5]+3593408605&4294967295,A=N+(P<<5&4294967295|P>>>27),P=j+(N^q&(A^N))+F[10]+38016083&4294967295,j=A+(P<<9&4294967295|P>>>23),P=q+(A^N&(j^A))+F[15]+3634488961&4294967295,q=j+(P<<14&4294967295|P>>>18),P=N+(j^A&(q^j))+F[4]+3889429448&4294967295,N=q+(P<<20&4294967295|P>>>12),P=A+(q^j&(N^q))+F[9]+568446438&4294967295,A=N+(P<<5&4294967295|P>>>27),P=j+(N^q&(A^N))+F[14]+3275163606&4294967295,j=A+(P<<9&4294967295|P>>>23),P=q+(A^N&(j^A))+F[3]+4107603335&4294967295,q=j+(P<<14&4294967295|P>>>18),P=N+(j^A&(q^j))+F[8]+1163531501&4294967295,N=q+(P<<20&4294967295|P>>>12),P=A+(q^j&(N^q))+F[13]+2850285829&4294967295,A=N+(P<<5&4294967295|P>>>27),P=j+(N^q&(A^N))+F[2]+4243563512&4294967295,j=A+(P<<9&4294967295|P>>>23),P=q+(A^N&(j^A))+F[7]+1735328473&4294967295,q=j+(P<<14&4294967295|P>>>18),P=N+(j^A&(q^j))+F[12]+2368359562&4294967295,N=q+(P<<20&4294967295|P>>>12),P=A+(N^q^j)+F[5]+4294588738&4294967295,A=N+(P<<4&4294967295|P>>>28),P=j+(A^N^q)+F[8]+2272392833&4294967295,j=A+(P<<11&4294967295|P>>>21),P=q+(j^A^N)+F[11]+1839030562&4294967295,q=j+(P<<16&4294967295|P>>>16),P=N+(q^j^A)+F[14]+4259657740&4294967295,N=q+(P<<23&4294967295|P>>>9),P=A+(N^q^j)+F[1]+2763975236&4294967295,A=N+(P<<4&4294967295|P>>>28),P=j+(A^N^q)+F[4]+1272893353&4294967295,j=A+(P<<11&4294967295|P>>>21),P=q+(j^A^N)+F[7]+4139469664&4294967295,q=j+(P<<16&4294967295|P>>>16),P=N+(q^j^A)+F[10]+3200236656&4294967295,N=q+(P<<23&4294967295|P>>>9),P=A+(N^q^j)+F[13]+681279174&4294967295,A=N+(P<<4&4294967295|P>>>28),P=j+(A^N^q)+F[0]+3936430074&4294967295,j=A+(P<<11&4294967295|P>>>21),P=q+(j^A^N)+F[3]+3572445317&4294967295,q=j+(P<<16&4294967295|P>>>16),P=N+(q^j^A)+F[6]+76029189&4294967295,N=q+(P<<23&4294967295|P>>>9),P=A+(N^q^j)+F[9]+3654602809&4294967295,A=N+(P<<4&4294967295|P>>>28),P=j+(A^N^q)+F[12]+3873151461&4294967295,j=A+(P<<11&4294967295|P>>>21),P=q+(j^A^N)+F[15]+530742520&4294967295,q=j+(P<<16&4294967295|P>>>16),P=N+(q^j^A)+F[2]+3299628645&4294967295,N=q+(P<<23&4294967295|P>>>9),P=A+(q^(N|~j))+F[0]+4096336452&4294967295,A=N+(P<<6&4294967295|P>>>26),P=j+(N^(A|~q))+F[7]+1126891415&4294967295,j=A+(P<<10&4294967295|P>>>22),P=q+(A^(j|~N))+F[14]+2878612391&4294967295,q=j+(P<<15&4294967295|P>>>17),P=N+(j^(q|~A))+F[5]+4237533241&4294967295,N=q+(P<<21&4294967295|P>>>11),P=A+(q^(N|~j))+F[12]+1700485571&4294967295,A=N+(P<<6&4294967295|P>>>26),P=j+(N^(A|~q))+F[3]+2399980690&4294967295,j=A+(P<<10&4294967295|P>>>22),P=q+(A^(j|~N))+F[10]+4293915773&4294967295,q=j+(P<<15&4294967295|P>>>17),P=N+(j^(q|~A))+F[1]+2240044497&4294967295,N=q+(P<<21&4294967295|P>>>11),P=A+(q^(N|~j))+F[8]+1873313359&4294967295,A=N+(P<<6&4294967295|P>>>26),P=j+(N^(A|~q))+F[15]+4264355552&4294967295,j=A+(P<<10&4294967295|P>>>22),P=q+(A^(j|~N))+F[6]+2734768916&4294967295,q=j+(P<<15&4294967295|P>>>17),P=N+(j^(q|~A))+F[13]+1309151649&4294967295,N=q+(P<<21&4294967295|P>>>11),P=A+(q^(N|~j))+F[4]+4149444226&4294967295,A=N+(P<<6&4294967295|P>>>26),P=j+(N^(A|~q))+F[11]+3174756917&4294967295,j=A+(P<<10&4294967295|P>>>22),P=q+(A^(j|~N))+F[2]+718787259&4294967295,q=j+(P<<15&4294967295|P>>>17),P=N+(j^(q|~A))+F[9]+3951481745&4294967295,k.g[0]=k.g[0]+A&4294967295,k.g[1]=k.g[1]+(q+(P<<21&4294967295|P>>>11))&4294967295,k.g[2]=k.g[2]+q&4294967295,k.g[3]=k.g[3]+j&4294967295}r.prototype.v=function(k,A){A===void 0&&(A=k.length);const N=A-this.blockSize,F=this.C;let q=this.h,j=0;for(;j<A;){if(q==0)for(;j<=N;)i(this,k,j),j+=this.blockSize;if(typeof k=="string"){for(;j<A;)if(F[q++]=k.charCodeAt(j++),q==this.blockSize){i(this,F),q=0;break}}else for(;j<A;)if(F[q++]=k[j++],q==this.blockSize){i(this,F),q=0;break}}this.h=q,this.o+=A},r.prototype.A=function(){var k=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);k[0]=128;for(var A=1;A<k.length-8;++A)k[A]=0;A=this.o*8;for(var N=k.length-8;N<k.length;++N)k[N]=A&255,A/=256;for(this.v(k),k=Array(16),A=0,N=0;N<4;++N)for(let F=0;F<32;F+=8)k[A++]=this.g[N]>>>F&255;return k};function o(k,A){var N=d;return Object.prototype.hasOwnProperty.call(N,k)?N[k]:N[k]=A(k)}function l(k,A){this.h=A;const N=[];let F=!0;for(let q=k.length-1;q>=0;q--){const j=k[q]|0;F&&j==A||(N[q]=j,F=!1)}this.g=N}var d={};function h(k){return-128<=k&&k<128?o(k,function(A){return new l([A|0],A<0?-1:0)}):new l([k|0],k<0?-1:0)}function m(k){if(isNaN(k)||!isFinite(k))return g;if(k<0)return S(m(-k));const A=[];let N=1;for(let F=0;k>=N;F++)A[F]=k/N|0,N*=4294967296;return new l(A,0)}function p(k,A){if(k.length==0)throw Error("number format error: empty string");if(A=A||10,A<2||36<A)throw Error("radix out of range: "+A);if(k.charAt(0)=="-")return S(p(k.substring(1),A));if(k.indexOf("-")>=0)throw Error('number format error: interior "-" character');const N=m(Math.pow(A,8));let F=g;for(let j=0;j<k.length;j+=8){var q=Math.min(8,k.length-j);const P=parseInt(k.substring(j,j+q),A);q<8?(q=m(Math.pow(A,q)),F=F.j(q).add(m(P))):(F=F.j(N),F=F.add(m(P)))}return F}var g=h(0),v=h(1),_=h(16777216);t=l.prototype,t.m=function(){if(x(this))return-S(this).m();let k=0,A=1;for(let N=0;N<this.g.length;N++){const F=this.i(N);k+=(F>=0?F:4294967296+F)*A,A*=4294967296}return k},t.toString=function(k){if(k=k||10,k<2||36<k)throw Error("radix out of range: "+k);if(C(this))return"0";if(x(this))return"-"+S(this).toString(k);const A=m(Math.pow(k,6));var N=this;let F="";for(;;){const q=M(N,A).g;N=E(N,q.j(A));let j=((N.g.length>0?N.g[0]:N.h)>>>0).toString(k);if(N=q,C(N))return j+F;for(;j.length<6;)j="0"+j;F=j+F}},t.i=function(k){return k<0?0:k<this.g.length?this.g[k]:this.h};function C(k){if(k.h!=0)return!1;for(let A=0;A<k.g.length;A++)if(k.g[A]!=0)return!1;return!0}function x(k){return k.h==-1}t.l=function(k){return k=E(this,k),x(k)?-1:C(k)?0:1};function S(k){const A=k.g.length,N=[];for(let F=0;F<A;F++)N[F]=~k.g[F];return new l(N,~k.h).add(v)}t.abs=function(){return x(this)?S(this):this},t.add=function(k){const A=Math.max(this.g.length,k.g.length),N=[];let F=0;for(let q=0;q<=A;q++){let j=F+(this.i(q)&65535)+(k.i(q)&65535),P=(j>>>16)+(this.i(q)>>>16)+(k.i(q)>>>16);F=P>>>16,j&=65535,P&=65535,N[q]=P<<16|j}return new l(N,N[N.length-1]&-2147483648?-1:0)};function E(k,A){return k.add(S(A))}t.j=function(k){if(C(this)||C(k))return g;if(x(this))return x(k)?S(this).j(S(k)):S(S(this).j(k));if(x(k))return S(this.j(S(k)));if(this.l(_)<0&&k.l(_)<0)return m(this.m()*k.m());const A=this.g.length+k.g.length,N=[];for(var F=0;F<2*A;F++)N[F]=0;for(F=0;F<this.g.length;F++)for(let q=0;q<k.g.length;q++){const j=this.i(F)>>>16,P=this.i(F)&65535,O=k.i(q)>>>16,X=k.i(q)&65535;N[2*F+2*q]+=P*X,T(N,2*F+2*q),N[2*F+2*q+1]+=j*X,T(N,2*F+2*q+1),N[2*F+2*q+1]+=P*O,T(N,2*F+2*q+1),N[2*F+2*q+2]+=j*O,T(N,2*F+2*q+2)}for(k=0;k<A;k++)N[k]=N[2*k+1]<<16|N[2*k];for(k=A;k<2*A;k++)N[k]=0;return new l(N,0)};function T(k,A){for(;(k[A]&65535)!=k[A];)k[A+1]+=k[A]>>>16,k[A]&=65535,A++}function I(k,A){this.g=k,this.h=A}function M(k,A){if(C(A))throw Error("division by zero");if(C(k))return new I(g,g);if(x(k))return A=M(S(k),A),new I(S(A.g),S(A.h));if(x(A))return A=M(k,S(A)),new I(S(A.g),A.h);if(k.g.length>30){if(x(k)||x(A))throw Error("slowDivide_ only works with positive integers.");for(var N=v,F=A;F.l(k)<=0;)N=L(N),F=L(F);var q=$(N,1),j=$(F,1);for(F=$(F,2),N=$(N,2);!C(F);){var P=j.add(F);P.l(k)<=0&&(q=q.add(N),j=P),F=$(F,1),N=$(N,1)}return A=E(k,q.j(A)),new I(q,A)}for(q=g;k.l(A)>=0;){for(N=Math.max(1,Math.floor(k.m()/A.m())),F=Math.ceil(Math.log(N)/Math.LN2),F=F<=48?1:Math.pow(2,F-48),j=m(N),P=j.j(A);x(P)||P.l(k)>0;)N-=F,j=m(N),P=j.j(A);C(j)&&(j=v),q=q.add(j),k=E(k,P)}return new I(q,k)}t.B=function(k){return M(this,k).h},t.and=function(k){const A=Math.max(this.g.length,k.g.length),N=[];for(let F=0;F<A;F++)N[F]=this.i(F)&k.i(F);return new l(N,this.h&k.h)},t.or=function(k){const A=Math.max(this.g.length,k.g.length),N=[];for(let F=0;F<A;F++)N[F]=this.i(F)|k.i(F);return new l(N,this.h|k.h)},t.xor=function(k){const A=Math.max(this.g.length,k.g.length),N=[];for(let F=0;F<A;F++)N[F]=this.i(F)^k.i(F);return new l(N,this.h^k.h)};function L(k){const A=k.g.length+1,N=[];for(let F=0;F<A;F++)N[F]=k.i(F)<<1|k.i(F-1)>>>31;return new l(N,k.h)}function $(k,A){const N=A>>5;A%=32;const F=k.g.length-N,q=[];for(let j=0;j<F;j++)q[j]=A>0?k.i(j+N)>>>A|k.i(j+N+1)<<32-A:k.i(j+N);return new l(q,k.h)}r.prototype.digest=r.prototype.A,r.prototype.reset=r.prototype.u,r.prototype.update=r.prototype.v,MC=r,l.prototype.add=l.prototype.add,l.prototype.multiply=l.prototype.j,l.prototype.modulo=l.prototype.B,l.prototype.compare=l.prototype.l,l.prototype.toNumber=l.prototype.m,l.prototype.toString=l.prototype.toString,l.prototype.getBits=l.prototype.i,l.fromNumber=m,l.fromString=p,va=l}).apply(typeof Aw<"u"?Aw:typeof self<"u"?self:typeof window<"u"?window:{});var zh=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var NC,vu,PC,Yh,hy,zC,BC,LC;(function(){var t,e=Object.defineProperty;function n(y){y=[typeof globalThis=="object"&&globalThis,y,typeof window=="object"&&window,typeof self=="object"&&self,typeof zh=="object"&&zh];for(var R=0;R<y.length;++R){var V=y[R];if(V&&V.Math==Math)return V}throw Error("Cannot find global object")}var r=n(this);function i(y,R){if(R)e:{var V=r;y=y.split(".");for(var K=0;K<y.length-1;K++){var fe=y[K];if(!(fe in V))break e;V=V[fe]}y=y[y.length-1],K=V[y],R=R(K),R!=K&&R!=null&&e(V,y,{configurable:!0,writable:!0,value:R})}}i("Symbol.dispose",function(y){return y||Symbol("Symbol.dispose")}),i("Array.prototype.values",function(y){return y||function(){return this[Symbol.iterator]()}}),i("Object.entries",function(y){return y||function(R){var V=[],K;for(K in R)Object.prototype.hasOwnProperty.call(R,K)&&V.push([K,R[K]]);return V}});var o=o||{},l=this||self;function d(y){var R=typeof y;return R=="object"&&y!=null||R=="function"}function h(y,R,V){return y.call.apply(y.bind,arguments)}function m(y,R,V){return m=h,m.apply(null,arguments)}function p(y,R){var V=Array.prototype.slice.call(arguments,1);return function(){var K=V.slice();return K.push.apply(K,arguments),y.apply(this,K)}}function g(y,R){function V(){}V.prototype=R.prototype,y.Z=R.prototype,y.prototype=new V,y.prototype.constructor=y,y.Ob=function(K,fe,xe){for(var Ne=Array(arguments.length-2),rt=2;rt<arguments.length;rt++)Ne[rt-2]=arguments[rt];return R.prototype[fe].apply(K,Ne)}}var v=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?y=>y&&AsyncContext.Snapshot.wrap(y):y=>y;function _(y){const R=y.length;if(R>0){const V=Array(R);for(let K=0;K<R;K++)V[K]=y[K];return V}return[]}function C(y,R){for(let K=1;K<arguments.length;K++){const fe=arguments[K];var V=typeof fe;if(V=V!="object"?V:fe?Array.isArray(fe)?"array":V:"null",V=="array"||V=="object"&&typeof fe.length=="number"){V=y.length||0;const xe=fe.length||0;y.length=V+xe;for(let Ne=0;Ne<xe;Ne++)y[V+Ne]=fe[Ne]}else y.push(fe)}}class x{constructor(R,V){this.i=R,this.j=V,this.h=0,this.g=null}get(){let R;return this.h>0?(this.h--,R=this.g,this.g=R.next,R.next=null):R=this.i(),R}}function S(y){l.setTimeout(()=>{throw y},0)}function E(){var y=k;let R=null;return y.g&&(R=y.g,y.g=y.g.next,y.g||(y.h=null),R.next=null),R}class T{constructor(){this.h=this.g=null}add(R,V){const K=I.get();K.set(R,V),this.h?this.h.next=K:this.g=K,this.h=K}}var I=new x(()=>new M,y=>y.reset());class M{constructor(){this.next=this.g=this.h=null}set(R,V){this.h=R,this.g=V,this.next=null}reset(){this.next=this.g=this.h=null}}let L,$=!1,k=new T,A=()=>{const y=Promise.resolve(void 0);L=()=>{y.then(N)}};function N(){for(var y;y=E();){try{y.h.call(y.g)}catch(V){S(V)}var R=I;R.j(y),R.h<100&&(R.h++,y.next=R.g,R.g=y)}$=!1}function F(){this.u=this.u,this.C=this.C}F.prototype.u=!1,F.prototype.dispose=function(){this.u||(this.u=!0,this.N())},F.prototype[Symbol.dispose]=function(){this.dispose()},F.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function q(y,R){this.type=y,this.g=this.target=R,this.defaultPrevented=!1}q.prototype.h=function(){this.defaultPrevented=!0};var j=(function(){if(!l.addEventListener||!Object.defineProperty)return!1;var y=!1,R=Object.defineProperty({},"passive",{get:function(){y=!0}});try{const V=()=>{};l.addEventListener("test",V,R),l.removeEventListener("test",V,R)}catch{}return y})();function P(y){return/^[\s\xa0]*$/.test(y)}function O(y,R){q.call(this,y?y.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,y&&this.init(y,R)}g(O,q),O.prototype.init=function(y,R){const V=this.type=y.type,K=y.changedTouches&&y.changedTouches.length?y.changedTouches[0]:null;this.target=y.target||y.srcElement,this.g=R,R=y.relatedTarget,R||(V=="mouseover"?R=y.fromElement:V=="mouseout"&&(R=y.toElement)),this.relatedTarget=R,K?(this.clientX=K.clientX!==void 0?K.clientX:K.pageX,this.clientY=K.clientY!==void 0?K.clientY:K.pageY,this.screenX=K.screenX||0,this.screenY=K.screenY||0):(this.clientX=y.clientX!==void 0?y.clientX:y.pageX,this.clientY=y.clientY!==void 0?y.clientY:y.pageY,this.screenX=y.screenX||0,this.screenY=y.screenY||0),this.button=y.button,this.key=y.key||"",this.ctrlKey=y.ctrlKey,this.altKey=y.altKey,this.shiftKey=y.shiftKey,this.metaKey=y.metaKey,this.pointerId=y.pointerId||0,this.pointerType=y.pointerType,this.state=y.state,this.i=y,y.defaultPrevented&&O.Z.h.call(this)},O.prototype.h=function(){O.Z.h.call(this);const y=this.i;y.preventDefault?y.preventDefault():y.returnValue=!1};var X="closure_listenable_"+(Math.random()*1e6|0),W=0;function H(y,R,V,K,fe){this.listener=y,this.proxy=null,this.src=R,this.type=V,this.capture=!!K,this.ha=fe,this.key=++W,this.da=this.fa=!1}function Z(y){y.da=!0,y.listener=null,y.proxy=null,y.src=null,y.ha=null}function Y(y,R,V){for(const K in y)R.call(V,y[K],K,y)}function se(y,R){for(const V in y)R.call(void 0,y[V],V,y)}function B(y){const R={};for(const V in y)R[V]=y[V];return R}const G="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ne(y,R){let V,K;for(let fe=1;fe<arguments.length;fe++){K=arguments[fe];for(V in K)y[V]=K[V];for(let xe=0;xe<G.length;xe++)V=G[xe],Object.prototype.hasOwnProperty.call(K,V)&&(y[V]=K[V])}}function ie(y){this.src=y,this.g={},this.h=0}ie.prototype.add=function(y,R,V,K,fe){const xe=y.toString();y=this.g[xe],y||(y=this.g[xe]=[],this.h++);const Ne=ue(y,R,K,fe);return Ne>-1?(R=y[Ne],V||(R.fa=!1)):(R=new H(R,this.src,xe,!!K,fe),R.fa=V,y.push(R)),R};function ee(y,R){const V=R.type;if(V in y.g){var K=y.g[V],fe=Array.prototype.indexOf.call(K,R,void 0),xe;(xe=fe>=0)&&Array.prototype.splice.call(K,fe,1),xe&&(Z(R),y.g[V].length==0&&(delete y.g[V],y.h--))}}function ue(y,R,V,K){for(let fe=0;fe<y.length;++fe){const xe=y[fe];if(!xe.da&&xe.listener==R&&xe.capture==!!V&&xe.ha==K)return fe}return-1}var be="closure_lm_"+(Math.random()*1e6|0),ce={};function ve(y,R,V,K,fe){if(Array.isArray(R)){for(let xe=0;xe<R.length;xe++)ve(y,R[xe],V,K,fe);return null}return V=J(V),y&&y[X]?y.J(R,V,d(K)?!!K.capture:!1,fe):ze(y,R,V,!1,K,fe)}function ze(y,R,V,K,fe,xe){if(!R)throw Error("Invalid event type");const Ne=d(fe)?!!fe.capture:!!fe;let rt=ye(y);if(rt||(y[be]=rt=new ie(y)),V=rt.add(R,V,K,Ne,xe),V.proxy)return V;if(K=Pe(),V.proxy=K,K.src=y,K.listener=V,y.addEventListener)j||(fe=Ne),fe===void 0&&(fe=!1),y.addEventListener(R.toString(),K,fe);else if(y.attachEvent)y.attachEvent(U(R.toString()),K);else if(y.addListener&&y.removeListener)y.addListener(K);else throw Error("addEventListener and attachEvent are unavailable.");return V}function Pe(){function y(V){return R.call(y.src,y.listener,V)}const R=he;return y}function ot(y,R,V,K,fe){if(Array.isArray(R))for(var xe=0;xe<R.length;xe++)ot(y,R[xe],V,K,fe);else K=d(K)?!!K.capture:!!K,V=J(V),y&&y[X]?(y=y.i,xe=String(R).toString(),xe in y.g&&(R=y.g[xe],V=ue(R,V,K,fe),V>-1&&(Z(R[V]),Array.prototype.splice.call(R,V,1),R.length==0&&(delete y.g[xe],y.h--)))):y&&(y=ye(y))&&(R=y.g[R.toString()],y=-1,R&&(y=ue(R,V,K,fe)),(V=y>-1?R[y]:null)&&_t(V))}function _t(y){if(typeof y!="number"&&y&&!y.da){var R=y.src;if(R&&R[X])ee(R.i,y);else{var V=y.type,K=y.proxy;R.removeEventListener?R.removeEventListener(V,K,y.capture):R.detachEvent?R.detachEvent(U(V),K):R.addListener&&R.removeListener&&R.removeListener(K),(V=ye(R))?(ee(V,y),V.h==0&&(V.src=null,R[be]=null)):Z(y)}}}function U(y){return y in ce?ce[y]:ce[y]="on"+y}function he(y,R){if(y.da)y=!0;else{R=new O(R,this);const V=y.listener,K=y.ha||y.src;y.fa&&_t(y),y=V.call(K,R)}return y}function ye(y){return y=y[be],y instanceof ie?y:null}var te="__closure_events_fn_"+(Math.random()*1e9>>>0);function J(y){return typeof y=="function"?y:(y[te]||(y[te]=function(R){return y.handleEvent(R)}),y[te])}function oe(){F.call(this),this.i=new ie(this),this.M=this,this.G=null}g(oe,F),oe.prototype[X]=!0,oe.prototype.removeEventListener=function(y,R,V,K){ot(this,y,R,V,K)};function Ce(y,R){var V,K=y.G;if(K)for(V=[];K;K=K.G)V.push(K);if(y=y.M,K=R.type||R,typeof R=="string")R=new q(R,y);else if(R instanceof q)R.target=R.target||y;else{var fe=R;R=new q(K,y),ne(R,fe)}fe=!0;let xe,Ne;if(V)for(Ne=V.length-1;Ne>=0;Ne--)xe=R.g=V[Ne],fe=Se(xe,K,!0,R)&&fe;if(xe=R.g=y,fe=Se(xe,K,!0,R)&&fe,fe=Se(xe,K,!1,R)&&fe,V)for(Ne=0;Ne<V.length;Ne++)xe=R.g=V[Ne],fe=Se(xe,K,!1,R)&&fe}oe.prototype.N=function(){if(oe.Z.N.call(this),this.i){var y=this.i;for(const R in y.g){const V=y.g[R];for(let K=0;K<V.length;K++)Z(V[K]);delete y.g[R],y.h--}}this.G=null},oe.prototype.J=function(y,R,V,K){return this.i.add(String(y),R,!1,V,K)},oe.prototype.K=function(y,R,V,K){return this.i.add(String(y),R,!0,V,K)};function Se(y,R,V,K){if(R=y.i.g[String(R)],!R)return!0;R=R.concat();let fe=!0;for(let xe=0;xe<R.length;++xe){const Ne=R[xe];if(Ne&&!Ne.da&&Ne.capture==V){const rt=Ne.listener,rn=Ne.ha||Ne.src;Ne.fa&&ee(y.i,Ne),fe=rt.call(rn,K)!==!1&&fe}}return fe&&!K.defaultPrevented}function ae(y,R){if(typeof y!="function")if(y&&typeof y.handleEvent=="function")y=m(y.handleEvent,y);else throw Error("Invalid listener argument");return Number(R)>2147483647?-1:l.setTimeout(y,R||0)}function Ae(y){y.g=ae(()=>{y.g=null,y.i&&(y.i=!1,Ae(y))},y.l);const R=y.h;y.h=null,y.m.apply(null,R)}class Me extends F{constructor(R,V){super(),this.m=R,this.l=V,this.h=null,this.i=!1,this.g=null}j(R){this.h=arguments,this.g?this.i=!0:Ae(this)}N(){super.N(),this.g&&(l.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function De(y){F.call(this),this.h=y,this.g={}}g(De,F);var He=[];function wt(y){Y(y.g,function(R,V){this.g.hasOwnProperty(V)&&_t(R)},y),y.g={}}De.prototype.N=function(){De.Z.N.call(this),wt(this)},De.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var nt=l.JSON.stringify,Qn=l.JSON.parse,ms=class{stringify(y){return l.JSON.stringify(y,void 0)}parse(y){return l.JSON.parse(y,void 0)}};function er(){}function ps(){}var vt={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function en(){q.call(this,"d")}g(en,q);function Wn(){q.call(this,"c")}g(Wn,q);var Et={},Ua=null;function Ai(){return Ua=Ua||new oe}Et.Ia="serverreachability";function Uo(y){q.call(this,Et.Ia,y)}g(Uo,q);function Ir(y){const R=Ai();Ce(R,new Uo(R))}Et.STAT_EVENT="statevent";function gs(y,R){q.call(this,Et.STAT_EVENT,y),this.stat=R}g(gs,q);function Ut(y){const R=Ai();Ce(R,new gs(R,y))}Et.Ja="timingevent";function tr(y,R){q.call(this,Et.Ja,y),this.size=R}g(tr,q);function ys(y,R){if(typeof y!="function")throw Error("Fn must not be null and must be a function");return l.setTimeout(function(){y()},R)}function Wr(){this.g=!0}Wr.prototype.ua=function(){this.g=!1};function Sm(y,R,V,K,fe,xe){y.info(function(){if(y.g)if(xe){var Ne="",rt=xe.split("&");for(let Tt=0;Tt<rt.length;Tt++){var rn=rt[Tt].split("=");if(rn.length>1){const Qt=rn[0];rn=rn[1];const Mr=Qt.split("_");Ne=Mr.length>=2&&Mr[1]=="type"?Ne+(Qt+"="+rn+"&"):Ne+(Qt+"=redacted&")}}}else Ne=null;else Ne=xe;return"XMLHTTP REQ ("+K+") [attempt "+fe+"]: "+R+`
`+V+`
`+Ne})}function ud(y,R,V,K,fe,xe,Ne){y.info(function(){return"XMLHTTP RESP ("+K+") [ attempt "+fe+"]: "+R+`
`+V+`
`+xe+" "+Ne})}function _s(y,R,V,K){y.info(function(){return"XMLHTTP TEXT ("+R+"): "+Cm(y,V)+(K?" "+K:"")})}function Fa(y,R){y.info(function(){return"TIMEOUT: "+R})}Wr.prototype.info=function(){};function Cm(y,R){if(!y.g)return R;if(!R)return null;try{const xe=JSON.parse(R);if(xe){for(y=0;y<xe.length;y++)if(Array.isArray(xe[y])){var V=xe[y];if(!(V.length<2)){var K=V[1];if(Array.isArray(K)&&!(K.length<1)){var fe=K[0];if(fe!="noop"&&fe!="stop"&&fe!="close")for(let Ne=1;Ne<K.length;Ne++)K[Ne]=""}}}}return nt(xe)}catch{return R}}var Va={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},gc={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},yc;function $a(){}g($a,er),$a.prototype.g=function(){return new XMLHttpRequest},yc=new $a;function Qs(y){return encodeURIComponent(String(y))}function dd(y){var R=1;y=y.split(":");const V=[];for(;R>0&&y.length;)V.push(y.shift()),R--;return y.length&&V.push(y.join(":")),V}function Kr(y,R,V,K){this.j=y,this.i=R,this.l=V,this.S=K||1,this.V=new De(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new Yr}function Yr(){this.i=null,this.g="",this.h=!1}var dn={},Rn={};function bs(y,R,V){y.M=1,y.A=qa(fn(R)),y.u=V,y.R=!0,Fo(y,null)}function Fo(y,R){y.F=Date.now(),vs(y),y.B=fn(y.A);var V=y.B,K=y.S;Array.isArray(K)||(K=[String(K)]),Ho(V.i,"t",K),y.C=0,V=y.j.L,y.h=new Yr,y.g=Td(y.j,V?R:null,!y.u),y.P>0&&(y.O=new Me(m(y.Y,y,y.g),y.P)),R=y.V,V=y.g,K=y.ba;var fe="readystatechange";Array.isArray(fe)||(fe&&(He[0]=fe.toString()),fe=He);for(let xe=0;xe<fe.length;xe++){const Ne=ve(V,fe[xe],K||R.handleEvent,!1,R.h||R);if(!Ne)break;R.g[Ne.key]=Ne}R=y.J?B(y.J):{},y.u?(y.v||(y.v="POST"),R["Content-Type"]="application/x-www-form-urlencoded",y.g.ea(y.B,y.v,y.u,R)):(y.v="GET",y.g.ea(y.B,y.v,null,R)),Ir(),Sm(y.i,y.v,y.B,y.l,y.S,y.u)}Kr.prototype.ba=function(y){y=y.target;const R=this.O;R&&Jr(y)==3?R.j():this.Y(y)},Kr.prototype.Y=function(y){try{if(y==this.g)e:{const rt=Jr(this.g),rn=this.g.ya(),Tt=this.g.ca();if(!(rt<3)&&(rt!=3||this.g&&(this.h.h||this.g.la()||Nn(this.g)))){this.K||rt!=4||rn==7||(rn==8||Tt<=0?Ir(3):Ir(2)),xs(this);var R=this.g.ca();this.X=R;var V=Em(this);if(this.o=R==200,ud(this.i,this.v,this.B,this.l,this.S,rt,R),this.o){if(this.U&&!this.L){t:{if(this.g){var K,fe=this.g;if((K=fe.g?fe.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!P(K)){var xe=K;break t}}xe=null}if(y=xe)_s(this.i,this.l,y,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,ws(this,y);else{this.o=!1,this.m=3,Ut(12),_r(this),kr(this);break e}}if(this.R){y=!0;let Qt;for(;!this.K&&this.C<V.length;)if(Qt=fd(this,V),Qt==Rn){rt==4&&(this.m=4,Ut(14),y=!1),_s(this.i,this.l,null,"[Incomplete Response]");break}else if(Qt==dn){this.m=4,Ut(15),_s(this.i,this.l,V,"[Invalid Chunk]"),y=!1;break}else _s(this.i,this.l,Qt,null),ws(this,Qt);if(hd(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),rt!=4||V.length!=0||this.h.h||(this.m=1,Ut(16),y=!1),this.o=this.o&&y,!y)_s(this.i,this.l,V,"[Invalid Chunked Response]"),_r(this),kr(this);else if(V.length>0&&!this.W){this.W=!0;var Ne=this.j;Ne.g==this&&Ne.aa&&!Ne.P&&(Ne.j.info("Great, no buffering proxy detected. Bytes received: "+V.length),Dc(Ne),Ne.P=!0,Ut(11))}}else _s(this.i,this.l,V,null),ws(this,V);rt==4&&_r(this),this.o&&!this.K&&(rt==4?wd(this.j,this):(this.o=!1,vs(this)))}else Ks(this.g),R==400&&V.indexOf("Unknown SID")>0?(this.m=3,Ut(12)):(this.m=0,Ut(13)),_r(this),kr(this)}}}catch{}};function Em(y){if(!hd(y))return y.g.la();const R=Nn(y.g);if(R==="")return"";let V="";const K=R.length,fe=Jr(y.g)==4;if(!y.h.i){if(typeof TextDecoder>"u")return _r(y),kr(y),"";y.h.i=new l.TextDecoder}for(let xe=0;xe<K;xe++)y.h.h=!0,V+=y.h.i.decode(R[xe],{stream:!(fe&&xe==K-1)});return R.length=0,y.h.g+=V,y.C=0,y.h.g}function hd(y){return y.g?y.v=="GET"&&y.M!=2&&y.j.Aa:!1}function fd(y,R){var V=y.C,K=R.indexOf(`
`,V);return K==-1?Rn:(V=Number(R.substring(V,K)),isNaN(V)?dn:(K+=1,K+V>R.length?Rn:(R=R.slice(K,K+V),y.C=K+V,R)))}Kr.prototype.cancel=function(){this.K=!0,_r(this)};function vs(y){y.T=Date.now()+y.H,Vo(y,y.H)}function Vo(y,R){if(y.D!=null)throw Error("WatchDog timer not null");y.D=ys(m(y.aa,y),R)}function xs(y){y.D&&(l.clearTimeout(y.D),y.D=null)}Kr.prototype.aa=function(){this.D=null;const y=Date.now();y-this.T>=0?(Fa(this.i,this.B),this.M!=2&&(Ir(),Ut(17)),_r(this),this.m=2,kr(this)):Vo(this,this.T-y)};function kr(y){y.j.I==0||y.K||wd(y.j,y)}function _r(y){xs(y);var R=y.O;R&&typeof R.dispose=="function"&&R.dispose(),y.O=null,wt(y.V),y.g&&(R=y.g,y.g=null,R.abort(),R.dispose())}function ws(y,R){try{var V=y.j;if(V.I!=0&&(V.g==y||Cs(V.h,y))){if(!y.L&&Cs(V.h,y)&&V.I==3){try{var K=V.Ba.g.parse(R)}catch{K=null}if(Array.isArray(K)&&K.length==3){var fe=K;if(fe[0]==0){e:if(!V.v){if(V.g)if(V.g.F+3e3<y.F)Yo(V),Ni(V);else break e;Xa(V),Ut(18)}}else V.xa=fe[1],0<V.xa-V.K&&fe[2]<37500&&V.F&&V.A==0&&!V.C&&(V.C=ys(m(V.Va,V),6e3));Ss(V.h)<=1&&V.ta&&(V.ta=void 0)}else Is(V,11)}else if((y.L||V.g==y)&&Yo(V),!P(R))for(fe=V.Ba.g.parse(R),R=0;R<fe.length;R++){let Tt=fe[R];const Qt=Tt[0];if(!(Qt<=V.K))if(V.K=Qt,Tt=Tt[1],V.I==2)if(Tt[0]=="c"){V.M=Tt[1],V.ba=Tt[2];const Mr=Tt[3];Mr!=null&&(V.ka=Mr,V.j.info("VER="+V.ka));const ks=Tt[4];ks!=null&&(V.za=ks,V.j.info("SVER="+V.za));const es=Tt[5];es!=null&&typeof es=="number"&&es>0&&(K=1.5*es,V.O=K,V.j.info("backChannelRequestTimeoutMs_="+K)),K=V;const ts=y.g;if(ts){const Za=ts.g?ts.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Za){var xe=K.h;xe.g||Za.indexOf("spdy")==-1&&Za.indexOf("quic")==-1&&Za.indexOf("h2")==-1||(xe.j=xe.l,xe.g=new Set,xe.h&&(vc(xe,xe.h),xe.h=null))}if(K.G){const Xo=ts.g?ts.g.getResponseHeader("X-HTTP-Session-Id"):null;Xo&&(K.wa=Xo,It(K.J,K.G,Xo))}}V.I=3,V.l&&V.l.ra(),V.aa&&(V.T=Date.now()-y.F,V.j.info("Handshake RTT: "+V.T+"ms")),K=V;var Ne=y;if(K.na=Ed(K,K.L?K.ba:null,K.W),Ne.L){xc(K.h,Ne);var rt=Ne,rn=K.O;rn&&(rt.H=rn),rt.D&&(xs(rt),vs(rt)),K.g=Ne}else vd(K);V.i.length>0&&Rs(V)}else Tt[0]!="stop"&&Tt[0]!="close"||Is(V,7);else V.I==3&&(Tt[0]=="stop"||Tt[0]=="close"?Tt[0]=="stop"?Is(V,7):Ic(V):Tt[0]!="noop"&&V.l&&V.l.qa(Tt),V.A=0)}}Ir(4)}catch{}}var hn=class{constructor(y,R){this.g=y,this.map=R}};function _c(y){this.l=y||10,l.PerformanceNavigationTiming?(y=l.performance.getEntriesByType("navigation"),y=y.length>0&&(y[0].nextHopProtocol=="hq"||y[0].nextHopProtocol=="h2")):y=!!(l.chrome&&l.chrome.loadTimes&&l.chrome.loadTimes()&&l.chrome.loadTimes().wasFetchedViaSpdy),this.j=y?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function bc(y){return y.h?!0:y.g?y.g.size>=y.j:!1}function Ss(y){return y.h?1:y.g?y.g.size:0}function Cs(y,R){return y.h?y.h==R:y.g?y.g.has(R):!1}function vc(y,R){y.g?y.g.add(R):y.h=R}function xc(y,R){y.h&&y.h==R?y.h=null:y.g&&y.g.has(R)&&y.g.delete(R)}_c.prototype.cancel=function(){if(this.i=wc(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const y of this.g.values())y.cancel();this.g.clear()}};function wc(y){if(y.h!=null)return y.i.concat(y.h.G);if(y.g!=null&&y.g.size!==0){let R=y.i;for(const V of y.g.values())R=R.concat(V.G);return R}return _(y.i)}var md=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function $o(y,R){if(y){y=y.split("&");for(let V=0;V<y.length;V++){const K=y[V].indexOf("=");let fe,xe=null;K>=0?(fe=y[V].substring(0,K),xe=y[V].substring(K+1)):fe=y[V],R(fe,xe?decodeURIComponent(xe.replace(/\+/g," ")):"")}}}function br(y){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let R;y instanceof br?(this.l=y.l,In(this,y.j),this.o=y.o,this.g=y.g,ji(this,y.u),this.h=y.h,Sc(this,_d(y.i)),this.m=y.m):y&&(R=String(y).match(md))?(this.l=!1,In(this,R[1]||"",!0),this.o=Es(R[2]||""),this.g=Es(R[3]||"",!0),ji(this,R[4]),this.h=Es(R[5]||"",!0),Sc(this,R[6]||"",!0),this.m=Es(R[7]||"")):(this.l=!1,this.i=new Ii(null,this.l))}br.prototype.toString=function(){const y=[];var R=this.j;R&&y.push(Ha(R,qo,!0),":");var V=this.g;return(V||R=="file")&&(y.push("//"),(R=this.o)&&y.push(Ha(R,qo,!0),"@"),y.push(Qs(V).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),V=this.u,V!=null&&y.push(":",String(V))),(V=this.h)&&(this.g&&V.charAt(0)!="/"&&y.push("/"),y.push(Ha(V,V.charAt(0)=="/"?Cc:pd,!0))),(V=this.i.toString())&&y.push("?",V),(V=this.m)&&y.push("#",Ha(V,gd)),y.join("")},br.prototype.resolve=function(y){const R=fn(this);let V=!!y.j;V?In(R,y.j):V=!!y.o,V?R.o=y.o:V=!!y.g,V?R.g=y.g:V=y.u!=null;var K=y.h;if(V)ji(R,y.u);else if(V=!!y.h){if(K.charAt(0)!="/")if(this.g&&!this.h)K="/"+K;else{var fe=R.h.lastIndexOf("/");fe!=-1&&(K=R.h.slice(0,fe+1)+K)}if(fe=K,fe==".."||fe==".")K="";else if(fe.indexOf("./")!=-1||fe.indexOf("/.")!=-1){K=fe.lastIndexOf("/",0)==0,fe=fe.split("/");const xe=[];for(let Ne=0;Ne<fe.length;){const rt=fe[Ne++];rt=="."?K&&Ne==fe.length&&xe.push(""):rt==".."?((xe.length>1||xe.length==1&&xe[0]!="")&&xe.pop(),K&&Ne==fe.length&&xe.push("")):(xe.push(rt),K=!0)}K=xe.join("/")}else K=fe}return V?R.h=K:V=y.i.toString()!=="",V?Sc(R,_d(y.i)):V=!!y.m,V&&(R.m=y.m),R};function fn(y){return new br(y)}function In(y,R,V){y.j=V?Es(R,!0):R,y.j&&(y.j=y.j.replace(/:$/,""))}function ji(y,R){if(R){if(R=Number(R),isNaN(R)||R<0)throw Error("Bad port number "+R);y.u=R}else y.u=null}function Sc(y,R,V){R instanceof Ii?(y.i=R,Go(y.i,y.l)):(V||(R=Ha(R,Ri)),y.i=new Ii(R,y.l))}function It(y,R,V){y.i.set(R,V)}function qa(y){return It(y,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),y}function Es(y,R){return y?R?decodeURI(y.replace(/%25/g,"%2525")):decodeURIComponent(y):""}function Ha(y,R,V){return typeof y=="string"?(y=encodeURI(y).replace(R,ir),V&&(y=y.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),y):null}function ir(y){return y=y.charCodeAt(0),"%"+(y>>4&15).toString(16)+(y&15).toString(16)}var qo=/[#\/\?@]/g,pd=/[#\?:]/g,Cc=/[#\?]/g,Ri=/[#\?@]/g,gd=/#/g;function Ii(y,R){this.h=this.g=null,this.i=y||null,this.j=!!R}function ar(y){y.g||(y.g=new Map,y.h=0,y.i&&$o(y.i,function(R,V){y.add(decodeURIComponent(R.replace(/\+/g," ")),V)}))}t=Ii.prototype,t.add=function(y,R){ar(this),this.i=null,y=ki(this,y);let V=this.g.get(y);return V||this.g.set(y,V=[]),V.push(R),this.h+=1,this};function yd(y,R){ar(y),R=ki(y,R),y.g.has(R)&&(y.i=null,y.h-=y.g.get(R).length,y.g.delete(R))}function Ec(y,R){return ar(y),R=ki(y,R),y.g.has(R)}t.forEach=function(y,R){ar(this),this.g.forEach(function(V,K){V.forEach(function(fe){y.call(R,fe,K,this)},this)},this)};function Tc(y,R){ar(y);let V=[];if(typeof R=="string")Ec(y,R)&&(V=V.concat(y.g.get(ki(y,R))));else for(y=Array.from(y.g.values()),R=0;R<y.length;R++)V=V.concat(y[R]);return V}t.set=function(y,R){return ar(this),this.i=null,y=ki(this,y),Ec(this,y)&&(this.h-=this.g.get(y).length),this.g.set(y,[R]),this.h+=1,this},t.get=function(y,R){return y?(y=Tc(this,y),y.length>0?String(y[0]):R):R};function Ho(y,R,V){yd(y,R),V.length>0&&(y.i=null,y.g.set(ki(y,R),_(V)),y.h+=V.length)}t.toString=function(){if(this.i)return this.i;if(!this.g)return"";const y=[],R=Array.from(this.g.keys());for(let K=0;K<R.length;K++){var V=R[K];const fe=Qs(V);V=Tc(this,V);for(let xe=0;xe<V.length;xe++){let Ne=fe;V[xe]!==""&&(Ne+="="+Qs(V[xe])),y.push(Ne)}}return this.i=y.join("&")};function _d(y){const R=new Ii;return R.i=y.i,y.g&&(R.g=new Map(y.g),R.h=y.h),R}function ki(y,R){return R=String(R),y.j&&(R=R.toLowerCase()),R}function Go(y,R){R&&!y.j&&(ar(y),y.i=null,y.g.forEach(function(V,K){const fe=K.toLowerCase();K!=fe&&(yd(this,K),Ho(this,fe,V))},y)),y.j=R}function Xr(y,R){const V=new Wr;if(l.Image){const K=new Image;K.onload=p(Dr,V,"TestLoadImage: loaded",!0,R,K),K.onerror=p(Dr,V,"TestLoadImage: error",!1,R,K),K.onabort=p(Dr,V,"TestLoadImage: abort",!1,R,K),K.ontimeout=p(Dr,V,"TestLoadImage: timeout",!1,R,K),l.setTimeout(function(){K.ontimeout&&K.ontimeout()},1e4),K.src=y}else R(!1)}function Ac(y,R){const V=new Wr,K=new AbortController,fe=setTimeout(()=>{K.abort(),Dr(V,"TestPingServer: timeout",!1,R)},1e4);fetch(y,{signal:K.signal}).then(xe=>{clearTimeout(fe),xe.ok?Dr(V,"TestPingServer: ok",!0,R):Dr(V,"TestPingServer: server error",!1,R)}).catch(()=>{clearTimeout(fe),Dr(V,"TestPingServer: error",!1,R)})}function Dr(y,R,V,K,fe){try{fe&&(fe.onload=null,fe.onerror=null,fe.onabort=null,fe.ontimeout=null),K(V)}catch{}}function Di(){this.g=new ms}function Ts(y){this.i=y.Sb||null,this.h=y.ab||!1}g(Ts,er),Ts.prototype.g=function(){return new Ga(this.i,this.h)};function Ga(y,R){oe.call(this),this.H=y,this.o=R,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}g(Ga,oe),t=Ga.prototype,t.open=function(y,R){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=y,this.D=R,this.readyState=1,Zr(this)},t.send=function(y){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const R={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};y&&(R.body=y),(this.H||l).fetch(new Request(this.D,R)).then(this.Pa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,Oi(this)),this.readyState=0},t.Pa=function(y){if(this.g&&(this.l=y,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=y.headers,this.readyState=2,Zr(this)),this.g&&(this.readyState=3,Zr(this),this.g)))if(this.responseType==="arraybuffer")y.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof l.ReadableStream<"u"&&"body"in y){if(this.j=y.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;Qo(this)}else y.text().then(this.Oa.bind(this),this.ga.bind(this))};function Qo(y){y.j.read().then(y.Ma.bind(y)).catch(y.ga.bind(y))}t.Ma=function(y){if(this.g){if(this.o&&y.value)this.response.push(y.value);else if(!this.o){var R=y.value?y.value:new Uint8Array(0);(R=this.B.decode(R,{stream:!y.done}))&&(this.response=this.responseText+=R)}y.done?Oi(this):Zr(this),this.readyState==3&&Qo(this)}},t.Oa=function(y){this.g&&(this.response=this.responseText=y,Oi(this))},t.Na=function(y){this.g&&(this.response=y,Oi(this))},t.ga=function(){this.g&&Oi(this)};function Oi(y){y.readyState=4,y.l=null,y.j=null,y.B=null,Zr(y)}t.setRequestHeader=function(y,R){this.A.append(y,R)},t.getResponseHeader=function(y){return this.h&&this.h.get(y.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";const y=[],R=this.h.entries();for(var V=R.next();!V.done;)V=V.value,y.push(V[0]+": "+V[1]),V=R.next();return y.join(`\r
`)};function Zr(y){y.onreadystatechange&&y.onreadystatechange.call(y)}Object.defineProperty(Ga.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(y){this.m=y?"include":"same-origin"}});function Or(y){let R="";return Y(y,function(V,K){R+=K,R+=":",R+=V,R+=`\r
`}),R}function Qa(y,R,V){e:{for(K in V){var K=!1;break e}K=!0}K||(V=Or(V),typeof y=="string"?V!=null&&Qs(V):It(y,R,V))}function Ot(y){oe.call(this),this.headers=new Map,this.L=y||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}g(Ot,oe);var As=/^https?$/i,jc=["POST","PUT"];t=Ot.prototype,t.Fa=function(y){this.H=y},t.ea=function(y,R,V,K){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+y);R=R?R.toUpperCase():"GET",this.D=y,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():yc.g(),this.g.onreadystatechange=v(m(this.Ca,this));try{this.B=!0,this.g.open(R,String(y),!0),this.B=!1}catch(xe){Wa(this,xe);return}if(y=V||"",V=new Map(this.headers),K)if(Object.getPrototypeOf(K)===Object.prototype)for(var fe in K)V.set(fe,K[fe]);else if(typeof K.keys=="function"&&typeof K.get=="function")for(const xe of K.keys())V.set(xe,K.get(xe));else throw Error("Unknown input type for opt_headers: "+String(K));K=Array.from(V.keys()).find(xe=>xe.toLowerCase()=="content-type"),fe=l.FormData&&y instanceof l.FormData,!(Array.prototype.indexOf.call(jc,R,void 0)>=0)||K||fe||V.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[xe,Ne]of V)this.g.setRequestHeader(xe,Ne);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(y),this.v=!1}catch(xe){Wa(this,xe)}};function Wa(y,R){y.h=!1,y.g&&(y.j=!0,y.g.abort(),y.j=!1),y.l=R,y.o=5,Rc(y),Ws(y)}function Rc(y){y.A||(y.A=!0,Ce(y,"complete"),Ce(y,"error"))}t.abort=function(y){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=y||7,Ce(this,"complete"),Ce(this,"abort"),Ws(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Ws(this,!0)),Ot.Z.N.call(this)},t.Ca=function(){this.u||(this.B||this.v||this.j?Ka(this):this.Xa())},t.Xa=function(){Ka(this)};function Ka(y){if(y.h&&typeof o<"u"){if(y.v&&Jr(y)==4)setTimeout(y.Ca.bind(y),0);else if(Ce(y,"readystatechange"),Jr(y)==4){y.h=!1;try{const xe=y.ca();e:switch(xe){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var R=!0;break e;default:R=!1}var V;if(!(V=R)){var K;if(K=xe===0){let Ne=String(y.D).match(md)[1]||null;!Ne&&l.self&&l.self.location&&(Ne=l.self.location.protocol.slice(0,-1)),K=!As.test(Ne?Ne.toLowerCase():"")}V=K}if(V)Ce(y,"complete"),Ce(y,"success");else{y.o=6;try{var fe=Jr(y)>2?y.g.statusText:""}catch{fe=""}y.l=fe+" ["+y.ca()+"]",Rc(y)}}finally{Ws(y)}}}}function Ws(y,R){if(y.g){y.m&&(clearTimeout(y.m),y.m=null);const V=y.g;y.g=null,R||Ce(y,"ready");try{V.onreadystatechange=null}catch{}}}t.isActive=function(){return!!this.g};function Jr(y){return y.g?y.g.readyState:0}t.ca=function(){try{return Jr(this)>2?this.g.status:-1}catch{return-1}},t.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},t.La=function(y){if(this.g){var R=this.g.responseText;return y&&R.indexOf(y)==0&&(R=R.substring(y.length)),Qn(R)}};function Nn(y){try{if(!y.g)return null;if("response"in y.g)return y.g.response;switch(y.F){case"":case"text":return y.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in y.g)return y.g.mozResponseArrayBuffer}return null}catch{return null}}function Ks(y){const R={};y=(y.g&&Jr(y)>=2&&y.g.getAllResponseHeaders()||"").split(`\r
`);for(let K=0;K<y.length;K++){if(P(y[K]))continue;var V=dd(y[K]);const fe=V[0];if(V=V[1],typeof V!="string")continue;V=V.trim();const xe=R[fe]||[];R[fe]=xe,xe.push(V)}se(R,function(K){return K.join(", ")})}t.ya=function(){return this.o},t.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function js(y,R,V){return V&&V.internalChannelParams&&V.internalChannelParams[y]||R}function Mi(y){this.za=0,this.i=[],this.j=new Wr,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=js("failFast",!1,y),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=js("baseRetryDelayMs",5e3,y),this.Za=js("retryDelaySeedMs",1e4,y),this.Ta=js("forwardChannelMaxRetries",2,y),this.va=js("forwardChannelRequestTimeoutMs",2e4,y),this.ma=y&&y.xmlHttpFactory||void 0,this.Ua=y&&y.Rb||void 0,this.Aa=y&&y.useFetchStreams||!1,this.O=void 0,this.L=y&&y.supportsCrossDomainXhr||!1,this.M="",this.h=new _c(y&&y.concurrentRequestLimit),this.Ba=new Di,this.S=y&&y.fastHandshake||!1,this.R=y&&y.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=y&&y.Pb||!1,y&&y.ua&&this.j.ua(),y&&y.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&y&&y.detectBufferingProxy||!1,this.ia=void 0,y&&y.longPollingTimeout&&y.longPollingTimeout>0&&(this.ia=y.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}t=Mi.prototype,t.ka=8,t.I=1,t.connect=function(y,R,V,K){Ut(0),this.W=y,this.H=R||{},V&&K!==void 0&&(this.H.OSID=V,this.H.OAID=K),this.F=this.X,this.J=Ed(this,null,this.W),Rs(this)};function Ic(y){if(Wo(y),y.I==3){var R=y.V++,V=fn(y.J);if(It(V,"SID",y.M),It(V,"RID",R),It(V,"TYPE","terminate"),Ya(y,V),R=new Kr(y,y.j,R),R.M=2,R.A=qa(fn(V)),V=!1,l.navigator&&l.navigator.sendBeacon)try{V=l.navigator.sendBeacon(R.A.toString(),"")}catch{}!V&&l.Image&&(new Image().src=R.A,V=!0),V||(R.g=Td(R.j,null),R.g.ea(R.A)),R.F=Date.now(),vs(R)}Cd(y)}function Ni(y){y.g&&(Dc(y),y.g.cancel(),y.g=null)}function Wo(y){Ni(y),y.v&&(l.clearTimeout(y.v),y.v=null),Yo(y),y.h.cancel(),y.m&&(typeof y.m=="number"&&l.clearTimeout(y.m),y.m=null)}function Rs(y){if(!bc(y.h)&&!y.m){y.m=!0;var R=y.Ea;L||A(),$||(L(),$=!0),k.add(R,y),y.D=0}}function Ko(y,R){return Ss(y.h)>=y.h.j-(y.m?1:0)?!1:y.m?(y.i=R.G.concat(y.i),!0):y.I==1||y.I==2||y.D>=(y.Sa?0:y.Ta)?!1:(y.m=ys(m(y.Ea,y,R),Sd(y,y.D)),y.D++,!0)}t.Ea=function(y){if(this.m)if(this.m=null,this.I==1){if(!y){this.V=Math.floor(Math.random()*1e5),y=this.V++;const fe=new Kr(this,this.j,y);let xe=this.o;if(this.U&&(xe?(xe=B(xe),ne(xe,this.U)):xe=this.U),this.u!==null||this.R||(fe.J=xe,xe=null),this.S)e:{for(var R=0,V=0;V<this.i.length;V++){t:{var K=this.i[V];if("__data__"in K.map&&(K=K.map.__data__,typeof K=="string")){K=K.length;break t}K=void 0}if(K===void 0)break;if(R+=K,R>4096){R=V;break e}if(R===4096||V===this.i.length-1){R=V+1;break e}}R=1e3}else R=1e3;R=bd(this,fe,R),V=fn(this.J),It(V,"RID",y),It(V,"CVER",22),this.G&&It(V,"X-HTTP-Session-Id",this.G),Ya(this,V),xe&&(this.R?R="headers="+Qs(Or(xe))+"&"+R:this.u&&Qa(V,this.u,xe)),vc(this.h,fe),this.Ra&&It(V,"TYPE","init"),this.S?(It(V,"$req",R),It(V,"SID","null"),fe.U=!0,bs(fe,V,null)):bs(fe,V,R),this.I=2}}else this.I==3&&(y?kc(this,y):this.i.length==0||bc(this.h)||kc(this))};function kc(y,R){var V;R?V=R.l:V=y.V++;const K=fn(y.J);It(K,"SID",y.M),It(K,"RID",V),It(K,"AID",y.K),Ya(y,K),y.u&&y.o&&Qa(K,y.u,y.o),V=new Kr(y,y.j,V,y.D+1),y.u===null&&(V.J=y.o),R&&(y.i=R.G.concat(y.i)),R=bd(y,V,1e3),V.H=Math.round(y.va*.5)+Math.round(y.va*.5*Math.random()),vc(y.h,V),bs(V,K,R)}function Ya(y,R){y.H&&Y(y.H,function(V,K){It(R,K,V)}),y.l&&Y({},function(V,K){It(R,K,V)})}function bd(y,R,V){V=Math.min(y.i.length,V);const K=y.l?m(y.l.Ka,y.l,y):null;e:{var fe=y.i;let rt=-1;for(;;){const rn=["count="+V];rt==-1?V>0?(rt=fe[0].g,rn.push("ofs="+rt)):rt=0:rn.push("ofs="+rt);let Tt=!0;for(let Qt=0;Qt<V;Qt++){var xe=fe[Qt].g;const Mr=fe[Qt].map;if(xe-=rt,xe<0)rt=Math.max(0,fe[Qt].g-100),Tt=!1;else try{xe="req"+xe+"_"||"";try{var Ne=Mr instanceof Map?Mr:Object.entries(Mr);for(const[ks,es]of Ne){let ts=es;d(es)&&(ts=nt(es)),rn.push(xe+ks+"="+encodeURIComponent(ts))}}catch(ks){throw rn.push(xe+"type="+encodeURIComponent("_badmap")),ks}}catch{K&&K(Mr)}}if(Tt){Ne=rn.join("&");break e}}Ne=void 0}return y=y.i.splice(0,V),R.G=y,Ne}function vd(y){if(!y.g&&!y.v){y.Y=1;var R=y.Da;L||A(),$||(L(),$=!0),k.add(R,y),y.A=0}}function Xa(y){return y.g||y.v||y.A>=3?!1:(y.Y++,y.v=ys(m(y.Da,y),Sd(y,y.A)),y.A++,!0)}t.Da=function(){if(this.v=null,xd(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var y=4*this.T;this.j.info("BP detection timer enabled: "+y),this.B=ys(m(this.Wa,this),y)}},t.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,Ut(10),Ni(this),xd(this))};function Dc(y){y.B!=null&&(l.clearTimeout(y.B),y.B=null)}function xd(y){y.g=new Kr(y,y.j,"rpc",y.Y),y.u===null&&(y.g.J=y.o),y.g.P=0;var R=fn(y.na);It(R,"RID","rpc"),It(R,"SID",y.M),It(R,"AID",y.K),It(R,"CI",y.F?"0":"1"),!y.F&&y.ia&&It(R,"TO",y.ia),It(R,"TYPE","xmlhttp"),Ya(y,R),y.u&&y.o&&Qa(R,y.u,y.o),y.O&&(y.g.H=y.O);var V=y.g;y=y.ba,V.M=1,V.A=qa(fn(R)),V.u=null,V.R=!0,Fo(V,y)}t.Va=function(){this.C!=null&&(this.C=null,Ni(this),Xa(this),Ut(19))};function Yo(y){y.C!=null&&(l.clearTimeout(y.C),y.C=null)}function wd(y,R){var V=null;if(y.g==R){Yo(y),Dc(y),y.g=null;var K=2}else if(Cs(y.h,R))V=R.G,xc(y.h,R),K=1;else return;if(y.I!=0){if(R.o)if(K==1){V=R.u?R.u.length:0,R=Date.now()-R.F;var fe=y.D;K=Ai(),Ce(K,new tr(K,V)),Rs(y)}else vd(y);else if(fe=R.m,fe==3||fe==0&&R.X>0||!(K==1&&Ko(y,R)||K==2&&Xa(y)))switch(V&&V.length>0&&(R=y.h,R.i=R.i.concat(V)),fe){case 1:Is(y,5);break;case 4:Is(y,10);break;case 3:Is(y,6);break;default:Is(y,2)}}}function Sd(y,R){let V=y.Qa+Math.floor(Math.random()*y.Za);return y.isActive()||(V*=2),V*R}function Is(y,R){if(y.j.info("Error code "+R),R==2){var V=m(y.bb,y),K=y.Ua;const fe=!K;K=new br(K||"//www.google.com/images/cleardot.gif"),l.location&&l.location.protocol=="http"||In(K,"https"),qa(K),fe?Xr(K.toString(),V):Ac(K.toString(),V)}else Ut(2);y.I=0,y.l&&y.l.pa(R),Cd(y),Wo(y)}t.bb=function(y){y?(this.j.info("Successfully pinged google.com"),Ut(2)):(this.j.info("Failed to ping google.com"),Ut(1))};function Cd(y){if(y.I=0,y.ja=[],y.l){const R=wc(y.h);(R.length!=0||y.i.length!=0)&&(C(y.ja,R),C(y.ja,y.i),y.h.i.length=0,_(y.i),y.i.length=0),y.l.oa()}}function Ed(y,R,V){var K=V instanceof br?fn(V):new br(V);if(K.g!="")R&&(K.g=R+"."+K.g),ji(K,K.u);else{var fe=l.location;K=fe.protocol,R=R?R+"."+fe.hostname:fe.hostname,fe=+fe.port;const xe=new br(null);K&&In(xe,K),R&&(xe.g=R),fe&&ji(xe,fe),V&&(xe.h=V),K=xe}return V=y.G,R=y.wa,V&&R&&It(K,V,R),It(K,"VER",y.ka),Ya(y,K),K}function Td(y,R,V){if(R&&!y.L)throw Error("Can't create secondary domain capable XhrIo object.");return R=y.Aa&&!y.ma?new Ot(new Ts({ab:V})):new Ot(y.ma),R.Fa(y.L),R}t.isActive=function(){return!!this.l&&this.l.isActive(this)};function Ad(){}t=Ad.prototype,t.ra=function(){},t.qa=function(){},t.pa=function(){},t.oa=function(){},t.isActive=function(){return!0},t.Ka=function(){};function Pi(){}Pi.prototype.g=function(y,R){return new nr(y,R)};function nr(y,R){oe.call(this),this.g=new Mi(R),this.l=y,this.h=R&&R.messageUrlParams||null,y=R&&R.messageHeaders||null,R&&R.clientProtocolHeaderRequired&&(y?y["X-Client-Protocol"]="webchannel":y={"X-Client-Protocol":"webchannel"}),this.g.o=y,y=R&&R.initMessageHeaders||null,R&&R.messageContentType&&(y?y["X-WebChannel-Content-Type"]=R.messageContentType:y={"X-WebChannel-Content-Type":R.messageContentType}),R&&R.sa&&(y?y["X-WebChannel-Client-Profile"]=R.sa:y={"X-WebChannel-Client-Profile":R.sa}),this.g.U=y,(y=R&&R.Qb)&&!P(y)&&(this.g.u=y),this.A=R&&R.supportsCrossDomainXhr||!1,this.v=R&&R.sendRawJson||!1,(R=R&&R.httpSessionIdParam)&&!P(R)&&(this.g.G=R,y=this.h,y!==null&&R in y&&(y=this.h,R in y&&delete y[R])),this.j=new Ys(this)}g(nr,oe),nr.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},nr.prototype.close=function(){Ic(this.g)},nr.prototype.o=function(y){var R=this.g;if(typeof y=="string"){var V={};V.__data__=y,y=V}else this.v&&(V={},V.__data__=nt(y),y=V);R.i.push(new hn(R.Ya++,y)),R.I==3&&Rs(R)},nr.prototype.N=function(){this.g.l=null,delete this.j,Ic(this.g),delete this.g,nr.Z.N.call(this)};function jd(y){en.call(this),y.__headers__&&(this.headers=y.__headers__,this.statusCode=y.__status__,delete y.__headers__,delete y.__status__);var R=y.__sm__;if(R){e:{for(const V in R){y=V;break e}y=void 0}(this.i=y)&&(y=this.i,R=R!==null&&y in R?R[y]:void 0),this.data=R}else this.data=y}g(jd,en);function Rd(){Wn.call(this),this.status=1}g(Rd,Wn);function Ys(y){this.g=y}g(Ys,Ad),Ys.prototype.ra=function(){Ce(this.g,"a")},Ys.prototype.qa=function(y){Ce(this.g,new jd(y))},Ys.prototype.pa=function(y){Ce(this.g,new Rd)},Ys.prototype.oa=function(){Ce(this.g,"b")},Pi.prototype.createWebChannel=Pi.prototype.g,nr.prototype.send=nr.prototype.o,nr.prototype.open=nr.prototype.m,nr.prototype.close=nr.prototype.close,LC=function(){return new Pi},BC=function(){return Ai()},zC=Et,hy={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},Va.NO_ERROR=0,Va.TIMEOUT=8,Va.HTTP_ERROR=6,Yh=Va,gc.COMPLETE="complete",PC=gc,ps.EventType=vt,vt.OPEN="a",vt.CLOSE="b",vt.ERROR="c",vt.MESSAGE="d",oe.prototype.listen=oe.prototype.J,vu=ps,Ot.prototype.listenOnce=Ot.prototype.K,Ot.prototype.getLastError=Ot.prototype.Ha,Ot.prototype.getLastErrorCode=Ot.prototype.ya,Ot.prototype.getStatus=Ot.prototype.ca,Ot.prototype.getResponseJson=Ot.prototype.La,Ot.prototype.getResponseText=Ot.prototype.la,Ot.prototype.send=Ot.prototype.ea,Ot.prototype.setWithCredentials=Ot.prototype.Fa,NC=Ot}).apply(typeof zh<"u"?zh:typeof self<"u"?self:typeof window<"u"?window:{});const jw="@firebase/firestore",Rw="4.9.3";class Xn{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Xn.UNAUTHENTICATED=new Xn(null),Xn.GOOGLE_CREDENTIALS=new Xn("google-credentials-uid"),Xn.FIRST_PARTY=new Xn("first-party-uid"),Xn.MOCK_USER=new Xn("mock-user");let oc="12.7.0";const Ro=new Hy("@firebase/firestore");function kl(){return Ro.logLevel}function Le(t,...e){if(Ro.logLevel<=mt.DEBUG){const n=e.map(n0);Ro.debug(`Firestore (${oc}): ${t}`,...n)}}function xi(t,...e){if(Ro.logLevel<=mt.ERROR){const n=e.map(n0);Ro.error(`Firestore (${oc}): ${t}`,...n)}}function $l(t,...e){if(Ro.logLevel<=mt.WARN){const n=e.map(n0);Ro.warn(`Firestore (${oc}): ${t}`,...n)}}function n0(t){if(typeof t=="string")return t;try{return(function(n){return JSON.stringify(n)})(t)}catch{return t}}function Ye(t,e,n){let r="Unexpected state";typeof e=="string"?r=e:n=e,UC(t,r,n)}function UC(t,e,n){let r=`FIRESTORE (${oc}) INTERNAL ASSERTION FAILED: ${e} (ID: ${t.toString(16)})`;if(n!==void 0)try{r+=" CONTEXT: "+JSON.stringify(n)}catch{r+=" CONTEXT: "+n}throw xi(r),new Error(r)}function Rt(t,e,n,r){let i="Unexpected state";typeof n=="string"?i=n:r=n,t||UC(e,i,r)}function tt(t,e){return t}const je={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Be extends Ei{constructor(e,n){super(e,n),this.code=e,this.message=n,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class gi{constructor(){this.promise=new Promise(((e,n)=>{this.resolve=e,this.reject=n}))}}class FC{constructor(e,n){this.user=n,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class fO{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,n){e.enqueueRetryable((()=>n(Xn.UNAUTHENTICATED)))}shutdown(){}}class mO{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,n){this.changeListener=n,e.enqueueRetryable((()=>n(this.token.user)))}shutdown(){this.changeListener=null}}class pO{constructor(e){this.t=e,this.currentUser=Xn.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,n){Rt(this.o===void 0,42304);let r=this.i;const i=h=>this.i!==r?(r=this.i,n(h)):Promise.resolve();let o=new gi;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new gi,e.enqueueRetryable((()=>i(this.currentUser)))};const l=()=>{const h=o;e.enqueueRetryable((async()=>{await h.promise,await i(this.currentUser)}))},d=h=>{Le("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=h,this.o&&(this.auth.addAuthTokenListener(this.o),l())};this.t.onInit((h=>d(h))),setTimeout((()=>{if(!this.auth){const h=this.t.getImmediate({optional:!0});h?d(h):(Le("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new gi)}}),0),l()}getToken(){const e=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then((r=>this.i!==e?(Le("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(Rt(typeof r.accessToken=="string",31837,{l:r}),new FC(r.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Rt(e===null||typeof e=="string",2055,{h:e}),new Xn(e)}}class gO{constructor(e,n,r){this.P=e,this.T=n,this.I=r,this.type="FirstParty",this.user=Xn.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class yO{constructor(e,n,r){this.P=e,this.T=n,this.I=r}getToken(){return Promise.resolve(new gO(this.P,this.T,this.I))}start(e,n){e.enqueueRetryable((()=>n(Xn.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class Iw{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class _O{constructor(e,n){this.V=n,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,as(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,n){Rt(this.o===void 0,3512);const r=o=>{o.error!=null&&Le("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${o.error.message}`);const l=o.token!==this.m;return this.m=o.token,Le("FirebaseAppCheckTokenProvider",`Received ${l?"new":"existing"} token.`),l?n(o.token):Promise.resolve()};this.o=o=>{e.enqueueRetryable((()=>r(o)))};const i=o=>{Le("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=o,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((o=>i(o))),setTimeout((()=>{if(!this.appCheck){const o=this.V.getImmediate({optional:!0});o?i(o):Le("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new Iw(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((n=>n?(Rt(typeof n.token=="string",44558,{tokenResult:n}),this.m=n.token,new Iw(n.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function bO(t){const e=typeof self<"u"&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(n);else for(let r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}class r0{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const i=bO(40);for(let o=0;o<i.length;++o)r.length<20&&i[o]<n&&(r+=e.charAt(i[o]%62))}return r}}function pt(t,e){return t<e?-1:t>e?1:0}function fy(t,e){const n=Math.min(t.length,e.length);for(let r=0;r<n;r++){const i=t.charAt(r),o=e.charAt(r);if(i!==o)return Ng(i)===Ng(o)?pt(i,o):Ng(i)?1:-1}return pt(t.length,e.length)}const vO=55296,xO=57343;function Ng(t){const e=t.charCodeAt(0);return e>=vO&&e<=xO}function ql(t,e,n){return t.length===e.length&&t.every(((r,i)=>n(r,e[i])))}const kw="__name__";class zs{constructor(e,n,r){n===void 0?n=0:n>e.length&&Ye(637,{offset:n,range:e.length}),r===void 0?r=e.length-n:r>e.length-n&&Ye(1746,{length:r,range:e.length-n}),this.segments=e,this.offset=n,this.len=r}get length(){return this.len}isEqual(e){return zs.comparator(this,e)===0}child(e){const n=this.segments.slice(this.offset,this.limit());return e instanceof zs?e.forEach((r=>{n.push(r)})):n.push(e),this.construct(n)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}forEach(e){for(let n=this.offset,r=this.limit();n<r;n++)e(this.segments[n])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,n){const r=Math.min(e.length,n.length);for(let i=0;i<r;i++){const o=zs.compareSegments(e.get(i),n.get(i));if(o!==0)return o}return pt(e.length,n.length)}static compareSegments(e,n){const r=zs.isNumericId(e),i=zs.isNumericId(n);return r&&!i?-1:!r&&i?1:r&&i?zs.extractNumericId(e).compare(zs.extractNumericId(n)):fy(e,n)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return va.fromString(e.substring(4,e.length-2))}}class Ft extends zs{construct(e,n,r){return new Ft(e,n,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const n=[];for(const r of e){if(r.indexOf("//")>=0)throw new Be(je.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);n.push(...r.split("/").filter((i=>i.length>0)))}return new Ft(n)}static emptyPath(){return new Ft([])}}const wO=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Fn extends zs{construct(e,n,r){return new Fn(e,n,r)}static isValidIdentifier(e){return wO.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Fn.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===kw}static keyField(){return new Fn([kw])}static fromServerFormat(e){const n=[];let r="",i=0;const o=()=>{if(r.length===0)throw new Be(je.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);n.push(r),r=""};let l=!1;for(;i<e.length;){const d=e[i];if(d==="\\"){if(i+1===e.length)throw new Be(je.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const h=e[i+1];if(h!=="\\"&&h!=="."&&h!=="`")throw new Be(je.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=h,i+=2}else d==="`"?(l=!l,i++):d!=="."||l?(r+=d,i++):(o(),i++)}if(o(),l)throw new Be(je.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Fn(n)}static emptyPath(){return new Fn([])}}class Qe{constructor(e){this.path=e}static fromPath(e){return new Qe(Ft.fromString(e))}static fromName(e){return new Qe(Ft.fromString(e).popFirst(5))}static empty(){return new Qe(Ft.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Ft.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,n){return Ft.comparator(e.path,n.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Qe(new Ft(e.slice()))}}function VC(t,e,n){if(!n)throw new Be(je.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function SO(t,e,n,r){if(e===!0&&r===!0)throw new Be(je.INVALID_ARGUMENT,`${t} and ${n} cannot be used together.`)}function Dw(t){if(!Qe.isDocumentKey(t))throw new Be(je.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function Ow(t){if(Qe.isDocumentKey(t))throw new Be(je.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function $C(t){return typeof t=="object"&&t!==null&&(Object.getPrototypeOf(t)===Object.prototype||Object.getPrototypeOf(t)===null)}function Hf(t){if(t===void 0)return"undefined";if(t===null)return"null";if(typeof t=="string")return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if(typeof t=="number"||typeof t=="boolean")return""+t;if(typeof t=="object"){if(t instanceof Array)return"an array";{const e=(function(r){return r.constructor?r.constructor.name:null})(t);return e?`a custom ${e} object`:"an object"}}return typeof t=="function"?"a function":Ye(12329,{type:typeof t})}function ds(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new Be(je.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=Hf(t);throw new Be(je.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}function vn(t,e){const n={typeString:t};return e&&(n.value=e),n}function Ju(t,e){if(!$C(t))throw new Be(je.INVALID_ARGUMENT,"JSON must be an object");let n;for(const r in e)if(e[r]){const i=e[r].typeString,o="value"in e[r]?{value:e[r].value}:void 0;if(!(r in t)){n=`JSON missing required field: '${r}'`;break}const l=t[r];if(i&&typeof l!==i){n=`JSON field '${r}' must be a ${i}.`;break}if(o!==void 0&&l!==o.value){n=`Expected '${r}' field to equal '${o.value}'`;break}}if(n)throw new Be(je.INVALID_ARGUMENT,n);return!0}const Mw=-62135596800,Nw=1e6;class Gt{static now(){return Gt.fromMillis(Date.now())}static fromDate(e){return Gt.fromMillis(e.getTime())}static fromMillis(e){const n=Math.floor(e/1e3),r=Math.floor((e-1e3*n)*Nw);return new Gt(n,r)}constructor(e,n){if(this.seconds=e,this.nanoseconds=n,n<0)throw new Be(je.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new Be(je.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(e<Mw)throw new Be(je.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Be(je.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/Nw}_compareTo(e){return this.seconds===e.seconds?pt(this.nanoseconds,e.nanoseconds):pt(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:Gt._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(Ju(e,Gt._jsonSchema))return new Gt(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-Mw;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}Gt._jsonSchemaVersion="firestore/timestamp/1.0",Gt._jsonSchema={type:vn("string",Gt._jsonSchemaVersion),seconds:vn("number"),nanoseconds:vn("number")};class Ze{static fromTimestamp(e){return new Ze(e)}static min(){return new Ze(new Gt(0,0))}static max(){return new Ze(new Gt(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const Nu=-1;function CO(t,e){const n=t.toTimestamp().seconds,r=t.toTimestamp().nanoseconds+1,i=Ze.fromTimestamp(r===1e9?new Gt(n+1,0):new Gt(n,r));return new wa(i,Qe.empty(),e)}function EO(t){return new wa(t.readTime,t.key,Nu)}class wa{constructor(e,n,r){this.readTime=e,this.documentKey=n,this.largestBatchId=r}static min(){return new wa(Ze.min(),Qe.empty(),Nu)}static max(){return new wa(Ze.max(),Qe.empty(),Nu)}}function TO(t,e){let n=t.readTime.compareTo(e.readTime);return n!==0?n:(n=Qe.comparator(t.documentKey,e.documentKey),n!==0?n:pt(t.largestBatchId,e.largestBatchId))}const AO="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class jO{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function lc(t){if(t.code!==je.FAILED_PRECONDITION||t.message!==AO)throw t;Le("LocalStore","Unexpectedly lost primary lease")}class Ie{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((n=>{this.isDone=!0,this.result=n,this.nextCallback&&this.nextCallback(n)}),(n=>{this.isDone=!0,this.error=n,this.catchCallback&&this.catchCallback(n)}))}catch(e){return this.next(void 0,e)}next(e,n){return this.callbackAttached&&Ye(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new Ie(((r,i)=>{this.nextCallback=o=>{this.wrapSuccess(e,o).next(r,i)},this.catchCallback=o=>{this.wrapFailure(n,o).next(r,i)}}))}toPromise(){return new Promise(((e,n)=>{this.next(e,n)}))}wrapUserFunction(e){try{const n=e();return n instanceof Ie?n:Ie.resolve(n)}catch(n){return Ie.reject(n)}}wrapSuccess(e,n){return e?this.wrapUserFunction((()=>e(n))):Ie.resolve(n)}wrapFailure(e,n){return e?this.wrapUserFunction((()=>e(n))):Ie.reject(n)}static resolve(e){return new Ie(((n,r)=>{n(e)}))}static reject(e){return new Ie(((n,r)=>{r(e)}))}static waitFor(e){return new Ie(((n,r)=>{let i=0,o=0,l=!1;e.forEach((d=>{++i,d.next((()=>{++o,l&&o===i&&n()}),(h=>r(h)))})),l=!0,o===i&&n()}))}static or(e){let n=Ie.resolve(!1);for(const r of e)n=n.next((i=>i?Ie.resolve(i):r()));return n}static forEach(e,n){const r=[];return e.forEach(((i,o)=>{r.push(n.call(this,i,o))})),this.waitFor(r)}static mapArray(e,n){return new Ie(((r,i)=>{const o=e.length,l=new Array(o);let d=0;for(let h=0;h<o;h++){const m=h;n(e[m]).next((p=>{l[m]=p,++d,d===o&&r(l)}),(p=>i(p)))}}))}static doWhile(e,n){return new Ie(((r,i)=>{const o=()=>{e()===!0?n().next((()=>{o()}),i):r()};o()}))}}function RO(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}function cc(t){return t.name==="IndexedDbTransactionError"}class Gf{constructor(e,n){this.previousValue=e,n&&(n.sequenceNumberHandler=r=>this.ae(r),this.ue=r=>n.writeSequenceNumber(r))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}Gf.ce=-1;const s0=-1;function Qf(t){return t==null}function mf(t){return t===0&&1/t==-1/0}function IO(t){return typeof t=="number"&&Number.isInteger(t)&&!mf(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}const qC="";function kO(t){let e="";for(let n=0;n<t.length;n++)e.length>0&&(e=Pw(e)),e=DO(t.get(n),e);return Pw(e)}function DO(t,e){let n=e;const r=t.length;for(let i=0;i<r;i++){const o=t.charAt(i);switch(o){case"\0":n+="";break;case qC:n+="";break;default:n+=o}}return n}function Pw(t){return t+qC+""}function zw(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Ma(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function HC(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}class Jt{constructor(e,n){this.comparator=e,this.root=n||Un.EMPTY}insert(e,n){return new Jt(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,Un.BLACK,null,null))}remove(e){return new Jt(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Un.BLACK,null,null))}get(e){let n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(r===0)return n.value;r<0?n=n.left:r>0&&(n=n.right)}return null}indexOf(e){let n=0,r=this.root;for(;!r.isEmpty();){const i=this.comparator(e,r.key);if(i===0)return n+r.left.size;i<0?r=r.left:(n+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((n,r)=>(e(n,r),!1)))}toString(){const e=[];return this.inorderTraversal(((n,r)=>(e.push(`${n}:${r}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Bh(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Bh(this.root,e,this.comparator,!1)}getReverseIterator(){return new Bh(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Bh(this.root,e,this.comparator,!0)}}class Bh{constructor(e,n,r,i){this.isReverse=i,this.nodeStack=[];let o=1;for(;!e.isEmpty();)if(o=n?r(e.key,n):1,n&&i&&(o*=-1),o<0)e=this.isReverse?e.left:e.right;else{if(o===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const n={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return n}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Un{constructor(e,n,r,i,o){this.key=e,this.value=n,this.color=r??Un.RED,this.left=i??Un.EMPTY,this.right=o??Un.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,n,r,i,o){return new Un(e??this.key,n??this.value,r??this.color,i??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,r){let i=this;const o=r(e,i.key);return i=o<0?i.copy(null,null,null,i.left.insert(e,n,r),null):o===0?i.copy(null,n,null,null,null):i.copy(null,null,null,null,i.right.insert(e,n,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return Un.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,n){let r,i=this;if(n(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),n(e,i.key)===0){if(i.right.isEmpty())return Un.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Un.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Un.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Ye(43730,{key:this.key,value:this.value});if(this.right.isRed())throw Ye(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw Ye(27949);return e+(this.isRed()?0:1)}}Un.EMPTY=null,Un.RED=!0,Un.BLACK=!1;Un.EMPTY=new class{constructor(){this.size=0}get key(){throw Ye(57766)}get value(){throw Ye(16141)}get color(){throw Ye(16727)}get left(){throw Ye(29726)}get right(){throw Ye(36894)}copy(e,n,r,i,o){return this}insert(e,n,r){return new Un(e,n)}remove(e,n){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class An{constructor(e){this.comparator=e,this.data=new Jt(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((n,r)=>(e(n),!1)))}forEachInRange(e,n){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;n(i.key)}}forEachWhile(e,n){let r;for(r=n!==void 0?this.data.getIteratorFrom(n):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const n=this.data.getIteratorFrom(e);return n.hasNext()?n.getNext().key:null}getIterator(){return new Bw(this.data.getIterator())}getIteratorFrom(e){return new Bw(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let n=this;return n.size<e.size&&(n=e,e=this),e.forEach((r=>{n=n.add(r)})),n}isEqual(e){if(!(e instanceof An)||this.size!==e.size)return!1;const n=this.data.getIterator(),r=e.data.getIterator();for(;n.hasNext();){const i=n.getNext().key,o=r.getNext().key;if(this.comparator(i,o)!==0)return!1}return!0}toArray(){const e=[];return this.forEach((n=>{e.push(n)})),e}toString(){const e=[];return this.forEach((n=>e.push(n))),"SortedSet("+e.toString()+")"}copy(e){const n=new An(this.comparator);return n.data=e,n}}class Bw{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class Ar{constructor(e){this.fields=e,e.sort(Fn.comparator)}static empty(){return new Ar([])}unionWith(e){let n=new An(Fn.comparator);for(const r of this.fields)n=n.add(r);for(const r of e)n=n.add(r);return new Ar(n.toArray())}covers(e){for(const n of this.fields)if(n.isPrefixOf(e))return!0;return!1}isEqual(e){return ql(this.fields,e.fields,((n,r)=>n.isEqual(r)))}}class GC extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class $n{constructor(e){this.binaryString=e}static fromBase64String(e){const n=(function(i){try{return atob(i)}catch(o){throw typeof DOMException<"u"&&o instanceof DOMException?new GC("Invalid base64 string: "+o):o}})(e);return new $n(n)}static fromUint8Array(e){const n=(function(i){let o="";for(let l=0;l<i.length;++l)o+=String.fromCharCode(i[l]);return o})(e);return new $n(n)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(n){return btoa(n)})(this.binaryString)}toUint8Array(){return(function(n){const r=new Uint8Array(n.length);for(let i=0;i<n.length;i++)r[i]=n.charCodeAt(i);return r})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return pt(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}$n.EMPTY_BYTE_STRING=new $n("");const OO=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Sa(t){if(Rt(!!t,39018),typeof t=="string"){let e=0;const n=OO.exec(t);if(Rt(!!n,46558,{timestamp:t}),n[1]){let i=n[1];i=(i+"000000000").substr(0,9),e=Number(i)}const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:on(t.seconds),nanos:on(t.nanos)}}function on(t){return typeof t=="number"?t:typeof t=="string"?Number(t):0}function Ca(t){return typeof t=="string"?$n.fromBase64String(t):$n.fromUint8Array(t)}const QC="server_timestamp",WC="__type__",KC="__previous_value__",YC="__local_write_time__";function i0(t){return(t?.mapValue?.fields||{})[WC]?.stringValue===QC}function Wf(t){const e=t.mapValue.fields[KC];return i0(e)?Wf(e):e}function Pu(t){const e=Sa(t.mapValue.fields[YC].timestampValue);return new Gt(e.seconds,e.nanos)}class MO{constructor(e,n,r,i,o,l,d,h,m,p){this.databaseId=e,this.appId=n,this.persistenceKey=r,this.host=i,this.ssl=o,this.forceLongPolling=l,this.autoDetectLongPolling=d,this.longPollingOptions=h,this.useFetchStreams=m,this.isUsingEmulator=p}}const pf="(default)";class zu{constructor(e,n){this.projectId=e,this.database=n||pf}static empty(){return new zu("","")}get isDefaultDatabase(){return this.database===pf}isEqual(e){return e instanceof zu&&e.projectId===this.projectId&&e.database===this.database}}const XC="__type__",NO="__max__",Lh={mapValue:{}},ZC="__vector__",gf="value";function Ea(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?i0(t)?4:zO(t)?9007199254740991:PO(t)?10:11:Ye(28295,{value:t})}function Hs(t,e){if(t===e)return!0;const n=Ea(t);if(n!==Ea(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Pu(t).isEqual(Pu(e));case 3:return(function(i,o){if(typeof i.timestampValue=="string"&&typeof o.timestampValue=="string"&&i.timestampValue.length===o.timestampValue.length)return i.timestampValue===o.timestampValue;const l=Sa(i.timestampValue),d=Sa(o.timestampValue);return l.seconds===d.seconds&&l.nanos===d.nanos})(t,e);case 5:return t.stringValue===e.stringValue;case 6:return(function(i,o){return Ca(i.bytesValue).isEqual(Ca(o.bytesValue))})(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return(function(i,o){return on(i.geoPointValue.latitude)===on(o.geoPointValue.latitude)&&on(i.geoPointValue.longitude)===on(o.geoPointValue.longitude)})(t,e);case 2:return(function(i,o){if("integerValue"in i&&"integerValue"in o)return on(i.integerValue)===on(o.integerValue);if("doubleValue"in i&&"doubleValue"in o){const l=on(i.doubleValue),d=on(o.doubleValue);return l===d?mf(l)===mf(d):isNaN(l)&&isNaN(d)}return!1})(t,e);case 9:return ql(t.arrayValue.values||[],e.arrayValue.values||[],Hs);case 10:case 11:return(function(i,o){const l=i.mapValue.fields||{},d=o.mapValue.fields||{};if(zw(l)!==zw(d))return!1;for(const h in l)if(l.hasOwnProperty(h)&&(d[h]===void 0||!Hs(l[h],d[h])))return!1;return!0})(t,e);default:return Ye(52216,{left:t})}}function Bu(t,e){return(t.values||[]).find((n=>Hs(n,e)))!==void 0}function Hl(t,e){if(t===e)return 0;const n=Ea(t),r=Ea(e);if(n!==r)return pt(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return pt(t.booleanValue,e.booleanValue);case 2:return(function(o,l){const d=on(o.integerValue||o.doubleValue),h=on(l.integerValue||l.doubleValue);return d<h?-1:d>h?1:d===h?0:isNaN(d)?isNaN(h)?0:-1:1})(t,e);case 3:return Lw(t.timestampValue,e.timestampValue);case 4:return Lw(Pu(t),Pu(e));case 5:return fy(t.stringValue,e.stringValue);case 6:return(function(o,l){const d=Ca(o),h=Ca(l);return d.compareTo(h)})(t.bytesValue,e.bytesValue);case 7:return(function(o,l){const d=o.split("/"),h=l.split("/");for(let m=0;m<d.length&&m<h.length;m++){const p=pt(d[m],h[m]);if(p!==0)return p}return pt(d.length,h.length)})(t.referenceValue,e.referenceValue);case 8:return(function(o,l){const d=pt(on(o.latitude),on(l.latitude));return d!==0?d:pt(on(o.longitude),on(l.longitude))})(t.geoPointValue,e.geoPointValue);case 9:return Uw(t.arrayValue,e.arrayValue);case 10:return(function(o,l){const d=o.fields||{},h=l.fields||{},m=d[gf]?.arrayValue,p=h[gf]?.arrayValue,g=pt(m?.values?.length||0,p?.values?.length||0);return g!==0?g:Uw(m,p)})(t.mapValue,e.mapValue);case 11:return(function(o,l){if(o===Lh.mapValue&&l===Lh.mapValue)return 0;if(o===Lh.mapValue)return 1;if(l===Lh.mapValue)return-1;const d=o.fields||{},h=Object.keys(d),m=l.fields||{},p=Object.keys(m);h.sort(),p.sort();for(let g=0;g<h.length&&g<p.length;++g){const v=fy(h[g],p[g]);if(v!==0)return v;const _=Hl(d[h[g]],m[p[g]]);if(_!==0)return _}return pt(h.length,p.length)})(t.mapValue,e.mapValue);default:throw Ye(23264,{he:n})}}function Lw(t,e){if(typeof t=="string"&&typeof e=="string"&&t.length===e.length)return pt(t,e);const n=Sa(t),r=Sa(e),i=pt(n.seconds,r.seconds);return i!==0?i:pt(n.nanos,r.nanos)}function Uw(t,e){const n=t.values||[],r=e.values||[];for(let i=0;i<n.length&&i<r.length;++i){const o=Hl(n[i],r[i]);if(o)return o}return pt(n.length,r.length)}function Gl(t){return my(t)}function my(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?(function(n){const r=Sa(n);return`time(${r.seconds},${r.nanos})`})(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?(function(n){return Ca(n).toBase64()})(t.bytesValue):"referenceValue"in t?(function(n){return Qe.fromName(n).toString()})(t.referenceValue):"geoPointValue"in t?(function(n){return`geo(${n.latitude},${n.longitude})`})(t.geoPointValue):"arrayValue"in t?(function(n){let r="[",i=!0;for(const o of n.values||[])i?i=!1:r+=",",r+=my(o);return r+"]"})(t.arrayValue):"mapValue"in t?(function(n){const r=Object.keys(n.fields||{}).sort();let i="{",o=!0;for(const l of r)o?o=!1:i+=",",i+=`${l}:${my(n.fields[l])}`;return i+"}"})(t.mapValue):Ye(61005,{value:t})}function Xh(t){switch(Ea(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=Wf(t);return e?16+Xh(e):16;case 5:return 2*t.stringValue.length;case 6:return Ca(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return(function(r){return(r.values||[]).reduce(((i,o)=>i+Xh(o)),0)})(t.arrayValue);case 10:case 11:return(function(r){let i=0;return Ma(r.fields,((o,l)=>{i+=o.length+Xh(l)})),i})(t.mapValue);default:throw Ye(13486,{value:t})}}function Fw(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function py(t){return!!t&&"integerValue"in t}function a0(t){return!!t&&"arrayValue"in t}function Vw(t){return!!t&&"nullValue"in t}function $w(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Zh(t){return!!t&&"mapValue"in t}function PO(t){return(t?.mapValue?.fields||{})[XC]?.stringValue===ZC}function Tu(t){if(t.geoPointValue)return{geoPointValue:{...t.geoPointValue}};if(t.timestampValue&&typeof t.timestampValue=="object")return{timestampValue:{...t.timestampValue}};if(t.mapValue){const e={mapValue:{fields:{}}};return Ma(t.mapValue.fields,((n,r)=>e.mapValue.fields[n]=Tu(r))),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=Tu(t.arrayValue.values[n]);return e}return{...t}}function zO(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue===NO}class fr{constructor(e){this.value=e}static empty(){return new fr({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let n=this.value;for(let r=0;r<e.length-1;++r)if(n=(n.mapValue.fields||{})[e.get(r)],!Zh(n))return null;return n=(n.mapValue.fields||{})[e.lastSegment()],n||null}}set(e,n){this.getFieldsMap(e.popLast())[e.lastSegment()]=Tu(n)}setAll(e){let n=Fn.emptyPath(),r={},i=[];e.forEach(((l,d)=>{if(!n.isImmediateParentOf(d)){const h=this.getFieldsMap(n);this.applyChanges(h,r,i),r={},i=[],n=d.popLast()}l?r[d.lastSegment()]=Tu(l):i.push(d.lastSegment())}));const o=this.getFieldsMap(n);this.applyChanges(o,r,i)}delete(e){const n=this.field(e.popLast());Zh(n)&&n.mapValue.fields&&delete n.mapValue.fields[e.lastSegment()]}isEqual(e){return Hs(this.value,e.value)}getFieldsMap(e){let n=this.value;n.mapValue.fields||(n.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=n.mapValue.fields[e.get(r)];Zh(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},n.mapValue.fields[e.get(r)]=i),n=i}return n.mapValue.fields}applyChanges(e,n,r){Ma(n,((i,o)=>e[i]=o));for(const i of r)delete e[i]}clone(){return new fr(Tu(this.value))}}function JC(t){const e=[];return Ma(t.fields,((n,r)=>{const i=new Fn([n]);if(Zh(r)){const o=JC(r.mapValue).fields;if(o.length===0)e.push(i);else for(const l of o)e.push(i.child(l))}else e.push(i)})),new Ar(e)}class Zn{constructor(e,n,r,i,o,l,d){this.key=e,this.documentType=n,this.version=r,this.readTime=i,this.createTime=o,this.data=l,this.documentState=d}static newInvalidDocument(e){return new Zn(e,0,Ze.min(),Ze.min(),Ze.min(),fr.empty(),0)}static newFoundDocument(e,n,r,i){return new Zn(e,1,n,Ze.min(),r,i,0)}static newNoDocument(e,n){return new Zn(e,2,n,Ze.min(),Ze.min(),fr.empty(),0)}static newUnknownDocument(e,n){return new Zn(e,3,n,Ze.min(),Ze.min(),fr.empty(),2)}convertToFoundDocument(e,n){return!this.createTime.isEqual(Ze.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=n,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=fr.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=fr.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Ze.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Zn&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Zn(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class yf{constructor(e,n){this.position=e,this.inclusive=n}}function qw(t,e,n){let r=0;for(let i=0;i<t.position.length;i++){const o=e[i],l=t.position[i];if(o.field.isKeyField()?r=Qe.comparator(Qe.fromName(l.referenceValue),n.key):r=Hl(l,n.data.field(o.field)),o.dir==="desc"&&(r*=-1),r!==0)break}return r}function Hw(t,e){if(t===null)return e===null;if(e===null||t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!Hs(t.position[n],e.position[n]))return!1;return!0}class _f{constructor(e,n="asc"){this.field=e,this.dir=n}}function BO(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}class eE{}class bn extends eE{constructor(e,n,r){super(),this.field=e,this.op=n,this.value=r}static create(e,n,r){return e.isKeyField()?n==="in"||n==="not-in"?this.createKeyFieldInFilter(e,n,r):new UO(e,n,r):n==="array-contains"?new $O(e,r):n==="in"?new qO(e,r):n==="not-in"?new HO(e,r):n==="array-contains-any"?new GO(e,r):new bn(e,n,r)}static createKeyFieldInFilter(e,n,r){return n==="in"?new FO(e,r):new VO(e,r)}matches(e){const n=e.data.field(this.field);return this.op==="!="?n!==null&&n.nullValue===void 0&&this.matchesComparison(Hl(n,this.value)):n!==null&&Ea(this.value)===Ea(n)&&this.matchesComparison(Hl(n,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Ye(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class hs extends eE{constructor(e,n){super(),this.filters=e,this.op=n,this.Pe=null}static create(e,n){return new hs(e,n)}matches(e){return tE(this)?this.filters.find((n=>!n.matches(e)))===void 0:this.filters.find((n=>n.matches(e)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((e,n)=>e.concat(n.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function tE(t){return t.op==="and"}function nE(t){return LO(t)&&tE(t)}function LO(t){for(const e of t.filters)if(e instanceof hs)return!1;return!0}function gy(t){if(t instanceof bn)return t.field.canonicalString()+t.op.toString()+Gl(t.value);if(nE(t))return t.filters.map((e=>gy(e))).join(",");{const e=t.filters.map((n=>gy(n))).join(",");return`${t.op}(${e})`}}function rE(t,e){return t instanceof bn?(function(r,i){return i instanceof bn&&r.op===i.op&&r.field.isEqual(i.field)&&Hs(r.value,i.value)})(t,e):t instanceof hs?(function(r,i){return i instanceof hs&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce(((o,l,d)=>o&&rE(l,i.filters[d])),!0):!1})(t,e):void Ye(19439)}function sE(t){return t instanceof bn?(function(n){return`${n.field.canonicalString()} ${n.op} ${Gl(n.value)}`})(t):t instanceof hs?(function(n){return n.op.toString()+" {"+n.getFilters().map(sE).join(" ,")+"}"})(t):"Filter"}class UO extends bn{constructor(e,n,r){super(e,n,r),this.key=Qe.fromName(r.referenceValue)}matches(e){const n=Qe.comparator(e.key,this.key);return this.matchesComparison(n)}}class FO extends bn{constructor(e,n){super(e,"in",n),this.keys=iE("in",n)}matches(e){return this.keys.some((n=>n.isEqual(e.key)))}}class VO extends bn{constructor(e,n){super(e,"not-in",n),this.keys=iE("not-in",n)}matches(e){return!this.keys.some((n=>n.isEqual(e.key)))}}function iE(t,e){return(e.arrayValue?.values||[]).map((n=>Qe.fromName(n.referenceValue)))}class $O extends bn{constructor(e,n){super(e,"array-contains",n)}matches(e){const n=e.data.field(this.field);return a0(n)&&Bu(n.arrayValue,this.value)}}class qO extends bn{constructor(e,n){super(e,"in",n)}matches(e){const n=e.data.field(this.field);return n!==null&&Bu(this.value.arrayValue,n)}}class HO extends bn{constructor(e,n){super(e,"not-in",n)}matches(e){if(Bu(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const n=e.data.field(this.field);return n!==null&&n.nullValue===void 0&&!Bu(this.value.arrayValue,n)}}class GO extends bn{constructor(e,n){super(e,"array-contains-any",n)}matches(e){const n=e.data.field(this.field);return!(!a0(n)||!n.arrayValue.values)&&n.arrayValue.values.some((r=>Bu(this.value.arrayValue,r)))}}class QO{constructor(e,n=null,r=[],i=[],o=null,l=null,d=null){this.path=e,this.collectionGroup=n,this.orderBy=r,this.filters=i,this.limit=o,this.startAt=l,this.endAt=d,this.Te=null}}function Gw(t,e=null,n=[],r=[],i=null,o=null,l=null){return new QO(t,e,n,r,i,o,l)}function o0(t){const e=tt(t);if(e.Te===null){let n=e.path.canonicalString();e.collectionGroup!==null&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map((r=>gy(r))).join(","),n+="|ob:",n+=e.orderBy.map((r=>(function(o){return o.field.canonicalString()+o.dir})(r))).join(","),Qf(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map((r=>Gl(r))).join(",")),e.endAt&&(n+="|ub:",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map((r=>Gl(r))).join(",")),e.Te=n}return e.Te}function l0(t,e){if(t.limit!==e.limit||t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!BO(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!rE(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!Hw(t.startAt,e.startAt)&&Hw(t.endAt,e.endAt)}function yy(t){return Qe.isDocumentKey(t.path)&&t.collectionGroup===null&&t.filters.length===0}class ed{constructor(e,n=null,r=[],i=[],o=null,l="F",d=null,h=null){this.path=e,this.collectionGroup=n,this.explicitOrderBy=r,this.filters=i,this.limit=o,this.limitType=l,this.startAt=d,this.endAt=h,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function WO(t,e,n,r,i,o,l,d){return new ed(t,e,n,r,i,o,l,d)}function c0(t){return new ed(t)}function Qw(t){return t.filters.length===0&&t.limit===null&&t.startAt==null&&t.endAt==null&&(t.explicitOrderBy.length===0||t.explicitOrderBy.length===1&&t.explicitOrderBy[0].field.isKeyField())}function aE(t){return t.collectionGroup!==null}function Au(t){const e=tt(t);if(e.Ie===null){e.Ie=[];const n=new Set;for(const o of e.explicitOrderBy)e.Ie.push(o),n.add(o.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(l){let d=new An(Fn.comparator);return l.filters.forEach((h=>{h.getFlattenedFilters().forEach((m=>{m.isInequality()&&(d=d.add(m.field))}))})),d})(e).forEach((o=>{n.has(o.canonicalString())||o.isKeyField()||e.Ie.push(new _f(o,r))})),n.has(Fn.keyField().canonicalString())||e.Ie.push(new _f(Fn.keyField(),r))}return e.Ie}function Fs(t){const e=tt(t);return e.Ee||(e.Ee=KO(e,Au(t))),e.Ee}function KO(t,e){if(t.limitType==="F")return Gw(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map((i=>{const o=i.dir==="desc"?"asc":"desc";return new _f(i.field,o)}));const n=t.endAt?new yf(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new yf(t.startAt.position,t.startAt.inclusive):null;return Gw(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}}function _y(t,e){const n=t.filters.concat([e]);return new ed(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}function by(t,e,n){return new ed(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Kf(t,e){return l0(Fs(t),Fs(e))&&t.limitType===e.limitType}function oE(t){return`${o0(Fs(t))}|lt:${t.limitType}`}function Dl(t){return`Query(target=${(function(n){let r=n.path.canonicalString();return n.collectionGroup!==null&&(r+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(r+=`, filters: [${n.filters.map((i=>sE(i))).join(", ")}]`),Qf(n.limit)||(r+=", limit: "+n.limit),n.orderBy.length>0&&(r+=`, orderBy: [${n.orderBy.map((i=>(function(l){return`${l.field.canonicalString()} (${l.dir})`})(i))).join(", ")}]`),n.startAt&&(r+=", startAt: ",r+=n.startAt.inclusive?"b:":"a:",r+=n.startAt.position.map((i=>Gl(i))).join(",")),n.endAt&&(r+=", endAt: ",r+=n.endAt.inclusive?"a:":"b:",r+=n.endAt.position.map((i=>Gl(i))).join(",")),`Target(${r})`})(Fs(t))}; limitType=${t.limitType})`}function Yf(t,e){return e.isFoundDocument()&&(function(r,i){const o=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(o):Qe.isDocumentKey(r.path)?r.path.isEqual(o):r.path.isImmediateParentOf(o)})(t,e)&&(function(r,i){for(const o of Au(r))if(!o.field.isKeyField()&&i.data.field(o.field)===null)return!1;return!0})(t,e)&&(function(r,i){for(const o of r.filters)if(!o.matches(i))return!1;return!0})(t,e)&&(function(r,i){return!(r.startAt&&!(function(l,d,h){const m=qw(l,d,h);return l.inclusive?m<=0:m<0})(r.startAt,Au(r),i)||r.endAt&&!(function(l,d,h){const m=qw(l,d,h);return l.inclusive?m>=0:m>0})(r.endAt,Au(r),i))})(t,e)}function YO(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function lE(t){return(e,n)=>{let r=!1;for(const i of Au(t)){const o=XO(i,e,n);if(o!==0)return o;r=r||i.field.isKeyField()}return 0}}function XO(t,e,n){const r=t.field.isKeyField()?Qe.comparator(e.key,n.key):(function(o,l,d){const h=l.data.field(o),m=d.data.field(o);return h!==null&&m!==null?Hl(h,m):Ye(42886)})(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return Ye(19790,{direction:t.dir})}}class Mo{constructor(e,n){this.mapKeyFn=e,this.equalsFn=n,this.inner={},this.innerSize=0}get(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r!==void 0){for(const[i,o]of r)if(this.equalsFn(i,e))return o}}has(e){return this.get(e)!==void 0}set(e,n){const r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,n]],void this.innerSize++;for(let o=0;o<i.length;o++)if(this.equalsFn(i[o][0],e))return void(i[o]=[e,n]);i.push([e,n]),this.innerSize++}delete(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[n]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Ma(this.inner,((n,r)=>{for(const[i,o]of r)e(i,o)}))}isEmpty(){return HC(this.inner)}size(){return this.innerSize}}const ZO=new Jt(Qe.comparator);function wi(){return ZO}const cE=new Jt(Qe.comparator);function xu(...t){let e=cE;for(const n of t)e=e.insert(n.key,n);return e}function uE(t){let e=cE;return t.forEach(((n,r)=>e=e.insert(n,r.overlayedDocument))),e}function vo(){return ju()}function dE(){return ju()}function ju(){return new Mo((t=>t.toString()),((t,e)=>t.isEqual(e)))}const JO=new Jt(Qe.comparator),eM=new An(Qe.comparator);function gt(...t){let e=eM;for(const n of t)e=e.add(n);return e}const tM=new An(pt);function nM(){return tM}function u0(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:mf(e)?"-0":e}}function hE(t){return{integerValue:""+t}}function rM(t,e){return IO(e)?hE(e):u0(t,e)}class Xf{constructor(){this._=void 0}}function sM(t,e,n){return t instanceof bf?(function(i,o){const l={fields:{[WC]:{stringValue:QC},[YC]:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return o&&i0(o)&&(o=Wf(o)),o&&(l.fields[KC]=o),{mapValue:l}})(n,e):t instanceof Ql?mE(t,e):t instanceof Wl?pE(t,e):(function(i,o){const l=fE(i,o),d=Ww(l)+Ww(i.Ae);return py(l)&&py(i.Ae)?hE(d):u0(i.serializer,d)})(t,e)}function iM(t,e,n){return t instanceof Ql?mE(t,e):t instanceof Wl?pE(t,e):n}function fE(t,e){return t instanceof vf?(function(r){return py(r)||(function(o){return!!o&&"doubleValue"in o})(r)})(e)?e:{integerValue:0}:null}class bf extends Xf{}class Ql extends Xf{constructor(e){super(),this.elements=e}}function mE(t,e){const n=gE(e);for(const r of t.elements)n.some((i=>Hs(i,r)))||n.push(r);return{arrayValue:{values:n}}}class Wl extends Xf{constructor(e){super(),this.elements=e}}function pE(t,e){let n=gE(e);for(const r of t.elements)n=n.filter((i=>!Hs(i,r)));return{arrayValue:{values:n}}}class vf extends Xf{constructor(e,n){super(),this.serializer=e,this.Ae=n}}function Ww(t){return on(t.integerValue||t.doubleValue)}function gE(t){return a0(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}class yE{constructor(e,n){this.field=e,this.transform=n}}function aM(t,e){return t.field.isEqual(e.field)&&(function(r,i){return r instanceof Ql&&i instanceof Ql||r instanceof Wl&&i instanceof Wl?ql(r.elements,i.elements,Hs):r instanceof vf&&i instanceof vf?Hs(r.Ae,i.Ae):r instanceof bf&&i instanceof bf})(t.transform,e.transform)}class oM{constructor(e,n){this.version=e,this.transformResults=n}}class gr{constructor(e,n){this.updateTime=e,this.exists=n}static none(){return new gr}static exists(e){return new gr(void 0,e)}static updateTime(e){return new gr(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Jh(t,e){return t.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(t.updateTime):t.exists===void 0||t.exists===e.isFoundDocument()}class Zf{}function _E(t,e){if(!t.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return t.isNoDocument()?new Jf(t.key,gr.none()):new td(t.key,t.data,gr.none());{const n=t.data,r=fr.empty();let i=new An(Fn.comparator);for(let o of e.fields)if(!i.has(o)){let l=n.field(o);l===null&&o.length>1&&(o=o.popLast(),l=n.field(o)),l===null?r.delete(o):r.set(o,l),i=i.add(o)}return new Na(t.key,r,new Ar(i.toArray()),gr.none())}}function lM(t,e,n){t instanceof td?(function(i,o,l){const d=i.value.clone(),h=Yw(i.fieldTransforms,o,l.transformResults);d.setAll(h),o.convertToFoundDocument(l.version,d).setHasCommittedMutations()})(t,e,n):t instanceof Na?(function(i,o,l){if(!Jh(i.precondition,o))return void o.convertToUnknownDocument(l.version);const d=Yw(i.fieldTransforms,o,l.transformResults),h=o.data;h.setAll(bE(i)),h.setAll(d),o.convertToFoundDocument(l.version,h).setHasCommittedMutations()})(t,e,n):(function(i,o,l){o.convertToNoDocument(l.version).setHasCommittedMutations()})(0,e,n)}function Ru(t,e,n,r){return t instanceof td?(function(o,l,d,h){if(!Jh(o.precondition,l))return d;const m=o.value.clone(),p=Xw(o.fieldTransforms,h,l);return m.setAll(p),l.convertToFoundDocument(l.version,m).setHasLocalMutations(),null})(t,e,n,r):t instanceof Na?(function(o,l,d,h){if(!Jh(o.precondition,l))return d;const m=Xw(o.fieldTransforms,h,l),p=l.data;return p.setAll(bE(o)),p.setAll(m),l.convertToFoundDocument(l.version,p).setHasLocalMutations(),d===null?null:d.unionWith(o.fieldMask.fields).unionWith(o.fieldTransforms.map((g=>g.field)))})(t,e,n,r):(function(o,l,d){return Jh(o.precondition,l)?(l.convertToNoDocument(l.version).setHasLocalMutations(),null):d})(t,e,n)}function cM(t,e){let n=null;for(const r of t.fieldTransforms){const i=e.data.field(r.field),o=fE(r.transform,i||null);o!=null&&(n===null&&(n=fr.empty()),n.set(r.field,o))}return n||null}function Kw(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!(function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&ql(r,i,((o,l)=>aM(o,l)))})(t.fieldTransforms,e.fieldTransforms)&&(t.type===0?t.value.isEqual(e.value):t.type!==1||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class td extends Zf{constructor(e,n,r,i=[]){super(),this.key=e,this.value=n,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class Na extends Zf{constructor(e,n,r,i,o=[]){super(),this.key=e,this.data=n,this.fieldMask=r,this.precondition=i,this.fieldTransforms=o,this.type=1}getFieldMask(){return this.fieldMask}}function bE(t){const e=new Map;return t.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const r=t.data.field(n);e.set(n,r)}})),e}function Yw(t,e,n){const r=new Map;Rt(t.length===n.length,32656,{Re:n.length,Ve:t.length});for(let i=0;i<n.length;i++){const o=t[i],l=o.transform,d=e.data.field(o.field);r.set(o.field,iM(l,d,n[i]))}return r}function Xw(t,e,n){const r=new Map;for(const i of t){const o=i.transform,l=n.data.field(i.field);r.set(i.field,sM(o,l,e))}return r}class Jf extends Zf{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class uM extends Zf{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class dM{constructor(e,n,r,i){this.batchId=e,this.localWriteTime=n,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,n){const r=n.mutationResults;for(let i=0;i<this.mutations.length;i++){const o=this.mutations[i];o.key.isEqual(e.key)&&lM(o,e,r[i])}}applyToLocalView(e,n){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(n=Ru(r,e,n,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(n=Ru(r,e,n,this.localWriteTime));return n}applyToLocalDocumentSet(e,n){const r=dE();return this.mutations.forEach((i=>{const o=e.get(i.key),l=o.overlayedDocument;let d=this.applyToLocalView(l,o.mutatedFields);d=n.has(i.key)?null:d;const h=_E(l,d);h!==null&&r.set(i.key,h),l.isValidDocument()||l.convertToNoDocument(Ze.min())})),r}keys(){return this.mutations.reduce(((e,n)=>e.add(n.key)),gt())}isEqual(e){return this.batchId===e.batchId&&ql(this.mutations,e.mutations,((n,r)=>Kw(n,r)))&&ql(this.baseMutations,e.baseMutations,((n,r)=>Kw(n,r)))}}class d0{constructor(e,n,r,i){this.batch=e,this.commitVersion=n,this.mutationResults=r,this.docVersions=i}static from(e,n,r){Rt(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let i=(function(){return JO})();const o=e.mutations;for(let l=0;l<o.length;l++)i=i.insert(o[l].key,r[l].version);return new d0(e,n,r,i)}}class hM{constructor(e,n){this.largestBatchId=e,this.mutation=n}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class fM{constructor(e,n){this.count=e,this.unchangedNames=n}}var _n,bt;function mM(t){switch(t){case je.OK:return Ye(64938);case je.CANCELLED:case je.UNKNOWN:case je.DEADLINE_EXCEEDED:case je.RESOURCE_EXHAUSTED:case je.INTERNAL:case je.UNAVAILABLE:case je.UNAUTHENTICATED:return!1;case je.INVALID_ARGUMENT:case je.NOT_FOUND:case je.ALREADY_EXISTS:case je.PERMISSION_DENIED:case je.FAILED_PRECONDITION:case je.ABORTED:case je.OUT_OF_RANGE:case je.UNIMPLEMENTED:case je.DATA_LOSS:return!0;default:return Ye(15467,{code:t})}}function vE(t){if(t===void 0)return xi("GRPC error has no .code"),je.UNKNOWN;switch(t){case _n.OK:return je.OK;case _n.CANCELLED:return je.CANCELLED;case _n.UNKNOWN:return je.UNKNOWN;case _n.DEADLINE_EXCEEDED:return je.DEADLINE_EXCEEDED;case _n.RESOURCE_EXHAUSTED:return je.RESOURCE_EXHAUSTED;case _n.INTERNAL:return je.INTERNAL;case _n.UNAVAILABLE:return je.UNAVAILABLE;case _n.UNAUTHENTICATED:return je.UNAUTHENTICATED;case _n.INVALID_ARGUMENT:return je.INVALID_ARGUMENT;case _n.NOT_FOUND:return je.NOT_FOUND;case _n.ALREADY_EXISTS:return je.ALREADY_EXISTS;case _n.PERMISSION_DENIED:return je.PERMISSION_DENIED;case _n.FAILED_PRECONDITION:return je.FAILED_PRECONDITION;case _n.ABORTED:return je.ABORTED;case _n.OUT_OF_RANGE:return je.OUT_OF_RANGE;case _n.UNIMPLEMENTED:return je.UNIMPLEMENTED;case _n.DATA_LOSS:return je.DATA_LOSS;default:return Ye(39323,{code:t})}}(bt=_n||(_n={}))[bt.OK=0]="OK",bt[bt.CANCELLED=1]="CANCELLED",bt[bt.UNKNOWN=2]="UNKNOWN",bt[bt.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",bt[bt.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",bt[bt.NOT_FOUND=5]="NOT_FOUND",bt[bt.ALREADY_EXISTS=6]="ALREADY_EXISTS",bt[bt.PERMISSION_DENIED=7]="PERMISSION_DENIED",bt[bt.UNAUTHENTICATED=16]="UNAUTHENTICATED",bt[bt.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",bt[bt.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",bt[bt.ABORTED=10]="ABORTED",bt[bt.OUT_OF_RANGE=11]="OUT_OF_RANGE",bt[bt.UNIMPLEMENTED=12]="UNIMPLEMENTED",bt[bt.INTERNAL=13]="INTERNAL",bt[bt.UNAVAILABLE=14]="UNAVAILABLE",bt[bt.DATA_LOSS=15]="DATA_LOSS";function pM(){return new TextEncoder}const gM=new va([4294967295,4294967295],0);function Zw(t){const e=pM().encode(t),n=new MC;return n.update(e),new Uint8Array(n.digest())}function Jw(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),o=e.getUint32(12,!0);return[new va([n,r],0),new va([i,o],0)]}class h0{constructor(e,n,r){if(this.bitmap=e,this.padding=n,this.hashCount=r,n<0||n>=8)throw new wu(`Invalid padding: ${n}`);if(r<0)throw new wu(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new wu(`Invalid hash count: ${r}`);if(e.length===0&&n!==0)throw new wu(`Invalid padding when bitmap length is 0: ${n}`);this.ge=8*e.length-n,this.pe=va.fromNumber(this.ge)}ye(e,n,r){let i=e.add(n.multiply(va.fromNumber(r)));return i.compare(gM)===1&&(i=new va([i.getBits(0),i.getBits(1)],0)),i.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const n=Zw(e),[r,i]=Jw(n);for(let o=0;o<this.hashCount;o++){const l=this.ye(r,i,o);if(!this.we(l))return!1}return!0}static create(e,n,r){const i=e%8==0?0:8-e%8,o=new Uint8Array(Math.ceil(e/8)),l=new h0(o,i,n);return r.forEach((d=>l.insert(d))),l}insert(e){if(this.ge===0)return;const n=Zw(e),[r,i]=Jw(n);for(let o=0;o<this.hashCount;o++){const l=this.ye(r,i,o);this.Se(l)}}Se(e){const n=Math.floor(e/8),r=e%8;this.bitmap[n]|=1<<r}}class wu extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class em{constructor(e,n,r,i,o){this.snapshotVersion=e,this.targetChanges=n,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=o}static createSynthesizedRemoteEventForCurrentChange(e,n,r){const i=new Map;return i.set(e,nd.createSynthesizedTargetChangeForCurrentChange(e,n,r)),new em(Ze.min(),i,new Jt(pt),wi(),gt())}}class nd{constructor(e,n,r,i,o){this.resumeToken=e,this.current=n,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=o}static createSynthesizedTargetChangeForCurrentChange(e,n,r){return new nd(r,n,gt(),gt(),gt())}}class ef{constructor(e,n,r,i){this.be=e,this.removedTargetIds=n,this.key=r,this.De=i}}class xE{constructor(e,n){this.targetId=e,this.Ce=n}}class wE{constructor(e,n,r=$n.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=n,this.resumeToken=r,this.cause=i}}class e1{constructor(){this.ve=0,this.Fe=t1(),this.Me=$n.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=gt(),n=gt(),r=gt();return this.Fe.forEach(((i,o)=>{switch(o){case 0:e=e.add(i);break;case 2:n=n.add(i);break;case 1:r=r.add(i);break;default:Ye(38017,{changeType:o})}})),new nd(this.Me,this.xe,e,n,r)}qe(){this.Oe=!1,this.Fe=t1()}Qe(e,n){this.Oe=!0,this.Fe=this.Fe.insert(e,n)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,Rt(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class yM{constructor(e){this.Ge=e,this.ze=new Map,this.je=wi(),this.Je=Uh(),this.He=Uh(),this.Ye=new Jt(pt)}Ze(e){for(const n of e.be)e.De&&e.De.isFoundDocument()?this.Xe(n,e.De):this.et(n,e.key,e.De);for(const n of e.removedTargetIds)this.et(n,e.key,e.De)}tt(e){this.forEachTarget(e,(n=>{const r=this.nt(n);switch(e.state){case 0:this.rt(n)&&r.Le(e.resumeToken);break;case 1:r.Ke(),r.Ne||r.qe(),r.Le(e.resumeToken);break;case 2:r.Ke(),r.Ne||this.removeTarget(n);break;case 3:this.rt(n)&&(r.We(),r.Le(e.resumeToken));break;case 4:this.rt(n)&&(this.it(n),r.Le(e.resumeToken));break;default:Ye(56790,{state:e.state})}}))}forEachTarget(e,n){e.targetIds.length>0?e.targetIds.forEach(n):this.ze.forEach(((r,i)=>{this.rt(i)&&n(i)}))}st(e){const n=e.targetId,r=e.Ce.count,i=this.ot(n);if(i){const o=i.target;if(yy(o))if(r===0){const l=new Qe(o.path);this.et(n,l,Zn.newNoDocument(l,Ze.min()))}else Rt(r===1,20013,{expectedCount:r});else{const l=this._t(n);if(l!==r){const d=this.ut(e),h=d?this.ct(d,e,l):1;if(h!==0){this.it(n);const m=h===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(n,m)}}}}}ut(e){const n=e.Ce.unchangedNames;if(!n||!n.bits)return null;const{bits:{bitmap:r="",padding:i=0},hashCount:o=0}=n;let l,d;try{l=Ca(r).toUint8Array()}catch(h){if(h instanceof GC)return $l("Decoding the base64 bloom filter in existence filter failed ("+h.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw h}try{d=new h0(l,i,o)}catch(h){return $l(h instanceof wu?"BloomFilter error: ":"Applying bloom filter failed: ",h),null}return d.ge===0?null:d}ct(e,n,r){return n.Ce.count===r-this.Pt(e,n.targetId)?0:2}Pt(e,n){const r=this.Ge.getRemoteKeysForTarget(n);let i=0;return r.forEach((o=>{const l=this.Ge.ht(),d=`projects/${l.projectId}/databases/${l.database}/documents/${o.path.canonicalString()}`;e.mightContain(d)||(this.et(n,o,null),i++)})),i}Tt(e){const n=new Map;this.ze.forEach(((o,l)=>{const d=this.ot(l);if(d){if(o.current&&yy(d.target)){const h=new Qe(d.target.path);this.It(h).has(l)||this.Et(l,h)||this.et(l,h,Zn.newNoDocument(h,e))}o.Be&&(n.set(l,o.ke()),o.qe())}}));let r=gt();this.He.forEach(((o,l)=>{let d=!0;l.forEachWhile((h=>{const m=this.ot(h);return!m||m.purpose==="TargetPurposeLimboResolution"||(d=!1,!1)})),d&&(r=r.add(o))})),this.je.forEach(((o,l)=>l.setReadTime(e)));const i=new em(e,n,this.Ye,this.je,r);return this.je=wi(),this.Je=Uh(),this.He=Uh(),this.Ye=new Jt(pt),i}Xe(e,n){if(!this.rt(e))return;const r=this.Et(e,n.key)?2:0;this.nt(e).Qe(n.key,r),this.je=this.je.insert(n.key,n),this.Je=this.Je.insert(n.key,this.It(n.key).add(e)),this.He=this.He.insert(n.key,this.dt(n.key).add(e))}et(e,n,r){if(!this.rt(e))return;const i=this.nt(e);this.Et(e,n)?i.Qe(n,1):i.$e(n),this.He=this.He.insert(n,this.dt(n).delete(e)),this.He=this.He.insert(n,this.dt(n).add(e)),r&&(this.je=this.je.insert(n,r))}removeTarget(e){this.ze.delete(e)}_t(e){const n=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+n.addedDocuments.size-n.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let n=this.ze.get(e);return n||(n=new e1,this.ze.set(e,n)),n}dt(e){let n=this.He.get(e);return n||(n=new An(pt),this.He=this.He.insert(e,n)),n}It(e){let n=this.Je.get(e);return n||(n=new An(pt),this.Je=this.Je.insert(e,n)),n}rt(e){const n=this.ot(e)!==null;return n||Le("WatchChangeAggregator","Detected inactive target",e),n}ot(e){const n=this.ze.get(e);return n&&n.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new e1),this.Ge.getRemoteKeysForTarget(e).forEach((n=>{this.et(e,n,null)}))}Et(e,n){return this.Ge.getRemoteKeysForTarget(e).has(n)}}function Uh(){return new Jt(Qe.comparator)}function t1(){return new Jt(Qe.comparator)}const _M={asc:"ASCENDING",desc:"DESCENDING"},bM={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},vM={and:"AND",or:"OR"};class xM{constructor(e,n){this.databaseId=e,this.useProto3Json=n}}function vy(t,e){return t.useProto3Json||Qf(e)?e:{value:e}}function xf(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function SE(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function wM(t,e){return xf(t,e.toTimestamp())}function Vs(t){return Rt(!!t,49232),Ze.fromTimestamp((function(n){const r=Sa(n);return new Gt(r.seconds,r.nanos)})(t))}function f0(t,e){return xy(t,e).canonicalString()}function xy(t,e){const n=(function(i){return new Ft(["projects",i.projectId,"databases",i.database])})(t).child("documents");return e===void 0?n:n.child(e)}function CE(t){const e=Ft.fromString(t);return Rt(RE(e),10190,{key:e.toString()}),e}function wy(t,e){return f0(t.databaseId,e.path)}function Pg(t,e){const n=CE(e);if(n.get(1)!==t.databaseId.projectId)throw new Be(je.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new Be(je.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new Qe(TE(n))}function EE(t,e){return f0(t.databaseId,e)}function SM(t){const e=CE(t);return e.length===4?Ft.emptyPath():TE(e)}function Sy(t){return new Ft(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function TE(t){return Rt(t.length>4&&t.get(4)==="documents",29091,{key:t.toString()}),t.popFirst(5)}function n1(t,e,n){return{name:wy(t,e),fields:n.value.mapValue.fields}}function CM(t,e){let n;if("targetChange"in e){e.targetChange;const r=(function(m){return m==="NO_CHANGE"?0:m==="ADD"?1:m==="REMOVE"?2:m==="CURRENT"?3:m==="RESET"?4:Ye(39313,{state:m})})(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],o=(function(m,p){return m.useProto3Json?(Rt(p===void 0||typeof p=="string",58123),$n.fromBase64String(p||"")):(Rt(p===void 0||p instanceof Buffer||p instanceof Uint8Array,16193),$n.fromUint8Array(p||new Uint8Array))})(t,e.targetChange.resumeToken),l=e.targetChange.cause,d=l&&(function(m){const p=m.code===void 0?je.UNKNOWN:vE(m.code);return new Be(p,m.message||"")})(l);n=new wE(r,i,o,d||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const i=Pg(t,r.document.name),o=Vs(r.document.updateTime),l=r.document.createTime?Vs(r.document.createTime):Ze.min(),d=new fr({mapValue:{fields:r.document.fields}}),h=Zn.newFoundDocument(i,o,l,d),m=r.targetIds||[],p=r.removedTargetIds||[];n=new ef(m,p,h.key,h)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const i=Pg(t,r.document),o=r.readTime?Vs(r.readTime):Ze.min(),l=Zn.newNoDocument(i,o),d=r.removedTargetIds||[];n=new ef([],d,l.key,l)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const i=Pg(t,r.document),o=r.removedTargetIds||[];n=new ef([],o,i,null)}else{if(!("filter"in e))return Ye(11601,{Rt:e});{e.filter;const r=e.filter;r.targetId;const{count:i=0,unchangedNames:o}=r,l=new fM(i,o),d=r.targetId;n=new xE(d,l)}}return n}function EM(t,e){let n;if(e instanceof td)n={update:n1(t,e.key,e.value)};else if(e instanceof Jf)n={delete:wy(t,e.key)};else if(e instanceof Na)n={update:n1(t,e.key,e.data),updateMask:MM(e.fieldMask)};else{if(!(e instanceof uM))return Ye(16599,{Vt:e.type});n={verify:wy(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map((r=>(function(o,l){const d=l.transform;if(d instanceof bf)return{fieldPath:l.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(d instanceof Ql)return{fieldPath:l.field.canonicalString(),appendMissingElements:{values:d.elements}};if(d instanceof Wl)return{fieldPath:l.field.canonicalString(),removeAllFromArray:{values:d.elements}};if(d instanceof vf)return{fieldPath:l.field.canonicalString(),increment:d.Ae};throw Ye(20930,{transform:l.transform})})(0,r)))),e.precondition.isNone||(n.currentDocument=(function(i,o){return o.updateTime!==void 0?{updateTime:wM(i,o.updateTime)}:o.exists!==void 0?{exists:o.exists}:Ye(27497)})(t,e.precondition)),n}function TM(t,e){return t&&t.length>0?(Rt(e!==void 0,14353),t.map((n=>(function(i,o){let l=i.updateTime?Vs(i.updateTime):Vs(o);return l.isEqual(Ze.min())&&(l=Vs(o)),new oM(l,i.transformResults||[])})(n,e)))):[]}function AM(t,e){return{documents:[EE(t,e.path)]}}function jM(t,e){const n={structuredQuery:{}},r=e.path;let i;e.collectionGroup!==null?(i=r,n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=EE(t,i);const o=(function(m){if(m.length!==0)return jE(hs.create(m,"and"))})(e.filters);o&&(n.structuredQuery.where=o);const l=(function(m){if(m.length!==0)return m.map((p=>(function(v){return{field:Ol(v.field),direction:kM(v.dir)}})(p)))})(e.orderBy);l&&(n.structuredQuery.orderBy=l);const d=vy(t,e.limit);return d!==null&&(n.structuredQuery.limit=d),e.startAt&&(n.structuredQuery.startAt=(function(m){return{before:m.inclusive,values:m.position}})(e.startAt)),e.endAt&&(n.structuredQuery.endAt=(function(m){return{before:!m.inclusive,values:m.position}})(e.endAt)),{ft:n,parent:i}}function RM(t){let e=SM(t.parent);const n=t.structuredQuery,r=n.from?n.from.length:0;let i=null;if(r>0){Rt(r===1,65062);const p=n.from[0];p.allDescendants?i=p.collectionId:e=e.child(p.collectionId)}let o=[];n.where&&(o=(function(g){const v=AE(g);return v instanceof hs&&nE(v)?v.getFilters():[v]})(n.where));let l=[];n.orderBy&&(l=(function(g){return g.map((v=>(function(C){return new _f(Ml(C.field),(function(S){switch(S){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(C.direction))})(v)))})(n.orderBy));let d=null;n.limit&&(d=(function(g){let v;return v=typeof g=="object"?g.value:g,Qf(v)?null:v})(n.limit));let h=null;n.startAt&&(h=(function(g){const v=!!g.before,_=g.values||[];return new yf(_,v)})(n.startAt));let m=null;return n.endAt&&(m=(function(g){const v=!g.before,_=g.values||[];return new yf(_,v)})(n.endAt)),WO(e,i,l,o,d,"F",h,m)}function IM(t,e){const n=(function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Ye(28987,{purpose:i})}})(e.purpose);return n==null?null:{"goog-listen-tags":n}}function AE(t){return t.unaryFilter!==void 0?(function(n){switch(n.unaryFilter.op){case"IS_NAN":const r=Ml(n.unaryFilter.field);return bn.create(r,"==",{doubleValue:NaN});case"IS_NULL":const i=Ml(n.unaryFilter.field);return bn.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const o=Ml(n.unaryFilter.field);return bn.create(o,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const l=Ml(n.unaryFilter.field);return bn.create(l,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return Ye(61313);default:return Ye(60726)}})(t):t.fieldFilter!==void 0?(function(n){return bn.create(Ml(n.fieldFilter.field),(function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return Ye(58110);default:return Ye(50506)}})(n.fieldFilter.op),n.fieldFilter.value)})(t):t.compositeFilter!==void 0?(function(n){return hs.create(n.compositeFilter.filters.map((r=>AE(r))),(function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return Ye(1026)}})(n.compositeFilter.op))})(t):Ye(30097,{filter:t})}function kM(t){return _M[t]}function DM(t){return bM[t]}function OM(t){return vM[t]}function Ol(t){return{fieldPath:t.canonicalString()}}function Ml(t){return Fn.fromServerFormat(t.fieldPath)}function jE(t){return t instanceof bn?(function(n){if(n.op==="=="){if($w(n.value))return{unaryFilter:{field:Ol(n.field),op:"IS_NAN"}};if(Vw(n.value))return{unaryFilter:{field:Ol(n.field),op:"IS_NULL"}}}else if(n.op==="!="){if($w(n.value))return{unaryFilter:{field:Ol(n.field),op:"IS_NOT_NAN"}};if(Vw(n.value))return{unaryFilter:{field:Ol(n.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Ol(n.field),op:DM(n.op),value:n.value}}})(t):t instanceof hs?(function(n){const r=n.getFilters().map((i=>jE(i)));return r.length===1?r[0]:{compositeFilter:{op:OM(n.op),filters:r}}})(t):Ye(54877,{filter:t})}function MM(t){const e=[];return t.fields.forEach((n=>e.push(n.canonicalString()))),{fieldPaths:e}}function RE(t){return t.length>=4&&t.get(0)==="projects"&&t.get(2)==="databases"}class da{constructor(e,n,r,i,o=Ze.min(),l=Ze.min(),d=$n.EMPTY_BYTE_STRING,h=null){this.target=e,this.targetId=n,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=o,this.lastLimboFreeSnapshotVersion=l,this.resumeToken=d,this.expectedCount=h}withSequenceNumber(e){return new da(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,n){return new da(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new da(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new da(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class NM{constructor(e){this.yt=e}}function PM(t){const e=RM({parent:t.parent,structuredQuery:t.structuredQuery});return t.limitType==="LAST"?by(e,e.limit,"L"):e}class zM{constructor(){this.Cn=new BM}addToCollectionParentIndex(e,n){return this.Cn.add(n),Ie.resolve()}getCollectionParents(e,n){return Ie.resolve(this.Cn.getEntries(n))}addFieldIndex(e,n){return Ie.resolve()}deleteFieldIndex(e,n){return Ie.resolve()}deleteAllFieldIndexes(e){return Ie.resolve()}createTargetIndexes(e,n){return Ie.resolve()}getDocumentsMatchingTarget(e,n){return Ie.resolve(null)}getIndexType(e,n){return Ie.resolve(0)}getFieldIndexes(e,n){return Ie.resolve([])}getNextCollectionGroupToUpdate(e){return Ie.resolve(null)}getMinOffset(e,n){return Ie.resolve(wa.min())}getMinOffsetFromCollectionGroup(e,n){return Ie.resolve(wa.min())}updateCollectionGroup(e,n,r){return Ie.resolve()}updateIndexEntries(e,n){return Ie.resolve()}}class BM{constructor(){this.index={}}add(e){const n=e.lastSegment(),r=e.popLast(),i=this.index[n]||new An(Ft.comparator),o=!i.has(r);return this.index[n]=i.add(r),o}has(e){const n=e.lastSegment(),r=e.popLast(),i=this.index[n];return i&&i.has(r)}getEntries(e){return(this.index[e]||new An(Ft.comparator)).toArray()}}const r1={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},IE=41943040;class hr{static withCacheSize(e){return new hr(e,hr.DEFAULT_COLLECTION_PERCENTILE,hr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,n,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=n,this.maximumSequenceNumbersToCollect=r}}hr.DEFAULT_COLLECTION_PERCENTILE=10,hr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,hr.DEFAULT=new hr(IE,hr.DEFAULT_COLLECTION_PERCENTILE,hr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),hr.DISABLED=new hr(-1,0,0);class Kl{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new Kl(0)}static cr(){return new Kl(-1)}}const s1="LruGarbageCollector",LM=1048576;function i1([t,e],[n,r]){const i=pt(t,n);return i===0?pt(e,r):i}class UM{constructor(e){this.Ir=e,this.buffer=new An(i1),this.Er=0}dr(){return++this.Er}Ar(e){const n=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(n);else{const r=this.buffer.last();i1(n,r)<0&&(this.buffer=this.buffer.delete(r).add(n))}}get maxValue(){return this.buffer.last()[0]}}class FM{constructor(e,n,r){this.garbageCollector=e,this.asyncQueue=n,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){Le(s1,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(n){cc(n)?Le(s1,"Ignoring IndexedDB error during garbage collection: ",n):await lc(n)}await this.Vr(3e5)}))}}class VM{constructor(e,n){this.mr=e,this.params=n}calculateTargetCount(e,n){return this.mr.gr(e).next((r=>Math.floor(n/100*r)))}nthSequenceNumber(e,n){if(n===0)return Ie.resolve(Gf.ce);const r=new UM(n);return this.mr.forEachTarget(e,(i=>r.Ar(i.sequenceNumber))).next((()=>this.mr.pr(e,(i=>r.Ar(i))))).next((()=>r.maxValue))}removeTargets(e,n,r){return this.mr.removeTargets(e,n,r)}removeOrphanedDocuments(e,n){return this.mr.removeOrphanedDocuments(e,n)}collect(e,n){return this.params.cacheSizeCollectionThreshold===-1?(Le("LruGarbageCollector","Garbage collection skipped; disabled"),Ie.resolve(r1)):this.getCacheSize(e).next((r=>r<this.params.cacheSizeCollectionThreshold?(Le("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),r1):this.yr(e,n)))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,n){let r,i,o,l,d,h,m;const p=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((g=>(g>this.params.maximumSequenceNumbersToCollect?(Le("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${g}`),i=this.params.maximumSequenceNumbersToCollect):i=g,l=Date.now(),this.nthSequenceNumber(e,i)))).next((g=>(r=g,d=Date.now(),this.removeTargets(e,r,n)))).next((g=>(o=g,h=Date.now(),this.removeOrphanedDocuments(e,r)))).next((g=>(m=Date.now(),kl()<=mt.DEBUG&&Le("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${l-p}ms
	Determined least recently used ${i} in `+(d-l)+`ms
	Removed ${o} targets in `+(h-d)+`ms
	Removed ${g} documents in `+(m-h)+`ms
Total Duration: ${m-p}ms`),Ie.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:o,documentsRemoved:g}))))}}function $M(t,e){return new VM(t,e)}class qM{constructor(){this.changes=new Mo((e=>e.toString()),((e,n)=>e.isEqual(n))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,n){this.assertNotApplied(),this.changes.set(e,Zn.newInvalidDocument(e).setReadTime(n))}getEntry(e,n){this.assertNotApplied();const r=this.changes.get(n);return r!==void 0?Ie.resolve(r):this.getFromCache(e,n)}getEntries(e,n){return this.getAllFromCache(e,n)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class HM{constructor(e,n){this.overlayedDocument=e,this.mutatedFields=n}}class GM{constructor(e,n,r,i){this.remoteDocumentCache=e,this.mutationQueue=n,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,n){let r=null;return this.documentOverlayCache.getOverlay(e,n).next((i=>(r=i,this.remoteDocumentCache.getEntry(e,n)))).next((i=>(r!==null&&Ru(r.mutation,i,Ar.empty(),Gt.now()),i)))}getDocuments(e,n){return this.remoteDocumentCache.getEntries(e,n).next((r=>this.getLocalViewOfDocuments(e,r,gt()).next((()=>r))))}getLocalViewOfDocuments(e,n,r=gt()){const i=vo();return this.populateOverlays(e,i,n).next((()=>this.computeViews(e,n,i,r).next((o=>{let l=xu();return o.forEach(((d,h)=>{l=l.insert(d,h.overlayedDocument)})),l}))))}getOverlayedDocuments(e,n){const r=vo();return this.populateOverlays(e,r,n).next((()=>this.computeViews(e,n,r,gt())))}populateOverlays(e,n,r){const i=[];return r.forEach((o=>{n.has(o)||i.push(o)})),this.documentOverlayCache.getOverlays(e,i).next((o=>{o.forEach(((l,d)=>{n.set(l,d)}))}))}computeViews(e,n,r,i){let o=wi();const l=ju(),d=(function(){return ju()})();return n.forEach(((h,m)=>{const p=r.get(m.key);i.has(m.key)&&(p===void 0||p.mutation instanceof Na)?o=o.insert(m.key,m):p!==void 0?(l.set(m.key,p.mutation.getFieldMask()),Ru(p.mutation,m,p.mutation.getFieldMask(),Gt.now())):l.set(m.key,Ar.empty())})),this.recalculateAndSaveOverlays(e,o).next((h=>(h.forEach(((m,p)=>l.set(m,p))),n.forEach(((m,p)=>d.set(m,new HM(p,l.get(m)??null)))),d)))}recalculateAndSaveOverlays(e,n){const r=ju();let i=new Jt(((l,d)=>l-d)),o=gt();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,n).next((l=>{for(const d of l)d.keys().forEach((h=>{const m=n.get(h);if(m===null)return;let p=r.get(h)||Ar.empty();p=d.applyToLocalView(m,p),r.set(h,p);const g=(i.get(d.batchId)||gt()).add(h);i=i.insert(d.batchId,g)}))})).next((()=>{const l=[],d=i.getReverseIterator();for(;d.hasNext();){const h=d.getNext(),m=h.key,p=h.value,g=dE();p.forEach((v=>{if(!o.has(v)){const _=_E(n.get(v),r.get(v));_!==null&&g.set(v,_),o=o.add(v)}})),l.push(this.documentOverlayCache.saveOverlays(e,m,g))}return Ie.waitFor(l)})).next((()=>r))}recalculateAndSaveOverlaysForDocumentKeys(e,n){return this.remoteDocumentCache.getEntries(e,n).next((r=>this.recalculateAndSaveOverlays(e,r)))}getDocumentsMatchingQuery(e,n,r,i){return(function(l){return Qe.isDocumentKey(l.path)&&l.collectionGroup===null&&l.filters.length===0})(n)?this.getDocumentsMatchingDocumentQuery(e,n.path):aE(n)?this.getDocumentsMatchingCollectionGroupQuery(e,n,r,i):this.getDocumentsMatchingCollectionQuery(e,n,r,i)}getNextDocuments(e,n,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,n,r,i).next((o=>{const l=i-o.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,n,r.largestBatchId,i-o.size):Ie.resolve(vo());let d=Nu,h=o;return l.next((m=>Ie.forEach(m,((p,g)=>(d<g.largestBatchId&&(d=g.largestBatchId),o.get(p)?Ie.resolve():this.remoteDocumentCache.getEntry(e,p).next((v=>{h=h.insert(p,v)}))))).next((()=>this.populateOverlays(e,m,o))).next((()=>this.computeViews(e,h,m,gt()))).next((p=>({batchId:d,changes:uE(p)})))))}))}getDocumentsMatchingDocumentQuery(e,n){return this.getDocument(e,new Qe(n)).next((r=>{let i=xu();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i}))}getDocumentsMatchingCollectionGroupQuery(e,n,r,i){const o=n.collectionGroup;let l=xu();return this.indexManager.getCollectionParents(e,o).next((d=>Ie.forEach(d,(h=>{const m=(function(g,v){return new ed(v,null,g.explicitOrderBy.slice(),g.filters.slice(),g.limit,g.limitType,g.startAt,g.endAt)})(n,h.child(o));return this.getDocumentsMatchingCollectionQuery(e,m,r,i).next((p=>{p.forEach(((g,v)=>{l=l.insert(g,v)}))}))})).next((()=>l))))}getDocumentsMatchingCollectionQuery(e,n,r,i){let o;return this.documentOverlayCache.getOverlaysForCollection(e,n.path,r.largestBatchId).next((l=>(o=l,this.remoteDocumentCache.getDocumentsMatchingQuery(e,n,r,o,i)))).next((l=>{o.forEach(((h,m)=>{const p=m.getKey();l.get(p)===null&&(l=l.insert(p,Zn.newInvalidDocument(p)))}));let d=xu();return l.forEach(((h,m)=>{const p=o.get(h);p!==void 0&&Ru(p.mutation,m,Ar.empty(),Gt.now()),Yf(n,m)&&(d=d.insert(h,m))})),d}))}}class QM{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,n){return Ie.resolve(this.Lr.get(n))}saveBundleMetadata(e,n){return this.Lr.set(n.id,(function(i){return{id:i.id,version:i.version,createTime:Vs(i.createTime)}})(n)),Ie.resolve()}getNamedQuery(e,n){return Ie.resolve(this.kr.get(n))}saveNamedQuery(e,n){return this.kr.set(n.name,(function(i){return{name:i.name,query:PM(i.bundledQuery),readTime:Vs(i.readTime)}})(n)),Ie.resolve()}}class WM{constructor(){this.overlays=new Jt(Qe.comparator),this.qr=new Map}getOverlay(e,n){return Ie.resolve(this.overlays.get(n))}getOverlays(e,n){const r=vo();return Ie.forEach(n,(i=>this.getOverlay(e,i).next((o=>{o!==null&&r.set(i,o)})))).next((()=>r))}saveOverlays(e,n,r){return r.forEach(((i,o)=>{this.St(e,n,o)})),Ie.resolve()}removeOverlaysForBatchId(e,n,r){const i=this.qr.get(r);return i!==void 0&&(i.forEach((o=>this.overlays=this.overlays.remove(o))),this.qr.delete(r)),Ie.resolve()}getOverlaysForCollection(e,n,r){const i=vo(),o=n.length+1,l=new Qe(n.child("")),d=this.overlays.getIteratorFrom(l);for(;d.hasNext();){const h=d.getNext().value,m=h.getKey();if(!n.isPrefixOf(m.path))break;m.path.length===o&&h.largestBatchId>r&&i.set(h.getKey(),h)}return Ie.resolve(i)}getOverlaysForCollectionGroup(e,n,r,i){let o=new Jt(((m,p)=>m-p));const l=this.overlays.getIterator();for(;l.hasNext();){const m=l.getNext().value;if(m.getKey().getCollectionGroup()===n&&m.largestBatchId>r){let p=o.get(m.largestBatchId);p===null&&(p=vo(),o=o.insert(m.largestBatchId,p)),p.set(m.getKey(),m)}}const d=vo(),h=o.getIterator();for(;h.hasNext()&&(h.getNext().value.forEach(((m,p)=>d.set(m,p))),!(d.size()>=i)););return Ie.resolve(d)}St(e,n,r){const i=this.overlays.get(r.key);if(i!==null){const l=this.qr.get(i.largestBatchId).delete(r.key);this.qr.set(i.largestBatchId,l)}this.overlays=this.overlays.insert(r.key,new hM(n,r));let o=this.qr.get(n);o===void 0&&(o=gt(),this.qr.set(n,o)),this.qr.set(n,o.add(r.key))}}class KM{constructor(){this.sessionToken=$n.EMPTY_BYTE_STRING}getSessionToken(e){return Ie.resolve(this.sessionToken)}setSessionToken(e,n){return this.sessionToken=n,Ie.resolve()}}class m0{constructor(){this.Qr=new An(Dn.$r),this.Ur=new An(Dn.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,n){const r=new Dn(e,n);this.Qr=this.Qr.add(r),this.Ur=this.Ur.add(r)}Wr(e,n){e.forEach((r=>this.addReference(r,n)))}removeReference(e,n){this.Gr(new Dn(e,n))}zr(e,n){e.forEach((r=>this.removeReference(r,n)))}jr(e){const n=new Qe(new Ft([])),r=new Dn(n,e),i=new Dn(n,e+1),o=[];return this.Ur.forEachInRange([r,i],(l=>{this.Gr(l),o.push(l.key)})),o}Jr(){this.Qr.forEach((e=>this.Gr(e)))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const n=new Qe(new Ft([])),r=new Dn(n,e),i=new Dn(n,e+1);let o=gt();return this.Ur.forEachInRange([r,i],(l=>{o=o.add(l.key)})),o}containsKey(e){const n=new Dn(e,0),r=this.Qr.firstAfterOrEqual(n);return r!==null&&e.isEqual(r.key)}}class Dn{constructor(e,n){this.key=e,this.Yr=n}static $r(e,n){return Qe.comparator(e.key,n.key)||pt(e.Yr,n.Yr)}static Kr(e,n){return pt(e.Yr,n.Yr)||Qe.comparator(e.key,n.key)}}class YM{constructor(e,n){this.indexManager=e,this.referenceDelegate=n,this.mutationQueue=[],this.tr=1,this.Zr=new An(Dn.$r)}checkEmpty(e){return Ie.resolve(this.mutationQueue.length===0)}addMutationBatch(e,n,r,i){const o=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const l=new dM(o,n,r,i);this.mutationQueue.push(l);for(const d of i)this.Zr=this.Zr.add(new Dn(d.key,o)),this.indexManager.addToCollectionParentIndex(e,d.key.path.popLast());return Ie.resolve(l)}lookupMutationBatch(e,n){return Ie.resolve(this.Xr(n))}getNextMutationBatchAfterBatchId(e,n){const r=n+1,i=this.ei(r),o=i<0?0:i;return Ie.resolve(this.mutationQueue.length>o?this.mutationQueue[o]:null)}getHighestUnacknowledgedBatchId(){return Ie.resolve(this.mutationQueue.length===0?s0:this.tr-1)}getAllMutationBatches(e){return Ie.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,n){const r=new Dn(n,0),i=new Dn(n,Number.POSITIVE_INFINITY),o=[];return this.Zr.forEachInRange([r,i],(l=>{const d=this.Xr(l.Yr);o.push(d)})),Ie.resolve(o)}getAllMutationBatchesAffectingDocumentKeys(e,n){let r=new An(pt);return n.forEach((i=>{const o=new Dn(i,0),l=new Dn(i,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([o,l],(d=>{r=r.add(d.Yr)}))})),Ie.resolve(this.ti(r))}getAllMutationBatchesAffectingQuery(e,n){const r=n.path,i=r.length+1;let o=r;Qe.isDocumentKey(o)||(o=o.child(""));const l=new Dn(new Qe(o),0);let d=new An(pt);return this.Zr.forEachWhile((h=>{const m=h.key.path;return!!r.isPrefixOf(m)&&(m.length===i&&(d=d.add(h.Yr)),!0)}),l),Ie.resolve(this.ti(d))}ti(e){const n=[];return e.forEach((r=>{const i=this.Xr(r);i!==null&&n.push(i)})),n}removeMutationBatch(e,n){Rt(this.ni(n.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Zr;return Ie.forEach(n.mutations,(i=>{const o=new Dn(i.key,n.batchId);return r=r.delete(o),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)})).next((()=>{this.Zr=r}))}ir(e){}containsKey(e,n){const r=new Dn(n,0),i=this.Zr.firstAfterOrEqual(r);return Ie.resolve(n.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,Ie.resolve()}ni(e,n){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const n=this.ei(e);return n<0||n>=this.mutationQueue.length?null:this.mutationQueue[n]}}class XM{constructor(e){this.ri=e,this.docs=(function(){return new Jt(Qe.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,n){const r=n.key,i=this.docs.get(r),o=i?i.size:0,l=this.ri(n);return this.docs=this.docs.insert(r,{document:n.mutableCopy(),size:l}),this.size+=l-o,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const n=this.docs.get(e);n&&(this.docs=this.docs.remove(e),this.size-=n.size)}getEntry(e,n){const r=this.docs.get(n);return Ie.resolve(r?r.document.mutableCopy():Zn.newInvalidDocument(n))}getEntries(e,n){let r=wi();return n.forEach((i=>{const o=this.docs.get(i);r=r.insert(i,o?o.document.mutableCopy():Zn.newInvalidDocument(i))})),Ie.resolve(r)}getDocumentsMatchingQuery(e,n,r,i){let o=wi();const l=n.path,d=new Qe(l.child("__id-9223372036854775808__")),h=this.docs.getIteratorFrom(d);for(;h.hasNext();){const{key:m,value:{document:p}}=h.getNext();if(!l.isPrefixOf(m.path))break;m.path.length>l.length+1||TO(EO(p),r)<=0||(i.has(p.key)||Yf(n,p))&&(o=o.insert(p.key,p.mutableCopy()))}return Ie.resolve(o)}getAllFromCollectionGroup(e,n,r,i){Ye(9500)}ii(e,n){return Ie.forEach(this.docs,(r=>n(r)))}newChangeBuffer(e){return new ZM(this)}getSize(e){return Ie.resolve(this.size)}}class ZM extends qM{constructor(e){super(),this.Nr=e}applyChanges(e){const n=[];return this.changes.forEach(((r,i)=>{i.isValidDocument()?n.push(this.Nr.addEntry(e,i)):this.Nr.removeEntry(r)})),Ie.waitFor(n)}getFromCache(e,n){return this.Nr.getEntry(e,n)}getAllFromCache(e,n){return this.Nr.getEntries(e,n)}}class JM{constructor(e){this.persistence=e,this.si=new Mo((n=>o0(n)),l0),this.lastRemoteSnapshotVersion=Ze.min(),this.highestTargetId=0,this.oi=0,this._i=new m0,this.targetCount=0,this.ai=Kl.ur()}forEachTarget(e,n){return this.si.forEach(((r,i)=>n(i))),Ie.resolve()}getLastRemoteSnapshotVersion(e){return Ie.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return Ie.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),Ie.resolve(this.highestTargetId)}setTargetsMetadata(e,n,r){return r&&(this.lastRemoteSnapshotVersion=r),n>this.oi&&(this.oi=n),Ie.resolve()}Pr(e){this.si.set(e.target,e);const n=e.targetId;n>this.highestTargetId&&(this.ai=new Kl(n),this.highestTargetId=n),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,n){return this.Pr(n),this.targetCount+=1,Ie.resolve()}updateTargetData(e,n){return this.Pr(n),Ie.resolve()}removeTargetData(e,n){return this.si.delete(n.target),this._i.jr(n.targetId),this.targetCount-=1,Ie.resolve()}removeTargets(e,n,r){let i=0;const o=[];return this.si.forEach(((l,d)=>{d.sequenceNumber<=n&&r.get(d.targetId)===null&&(this.si.delete(l),o.push(this.removeMatchingKeysForTargetId(e,d.targetId)),i++)})),Ie.waitFor(o).next((()=>i))}getTargetCount(e){return Ie.resolve(this.targetCount)}getTargetData(e,n){const r=this.si.get(n)||null;return Ie.resolve(r)}addMatchingKeys(e,n,r){return this._i.Wr(n,r),Ie.resolve()}removeMatchingKeys(e,n,r){this._i.zr(n,r);const i=this.persistence.referenceDelegate,o=[];return i&&n.forEach((l=>{o.push(i.markPotentiallyOrphaned(e,l))})),Ie.waitFor(o)}removeMatchingKeysForTargetId(e,n){return this._i.jr(n),Ie.resolve()}getMatchingKeysForTargetId(e,n){const r=this._i.Hr(n);return Ie.resolve(r)}containsKey(e,n){return Ie.resolve(this._i.containsKey(n))}}class kE{constructor(e,n){this.ui={},this.overlays={},this.ci=new Gf(0),this.li=!1,this.li=!0,this.hi=new KM,this.referenceDelegate=e(this),this.Pi=new JM(this),this.indexManager=new zM,this.remoteDocumentCache=(function(i){return new XM(i)})((r=>this.referenceDelegate.Ti(r))),this.serializer=new NM(n),this.Ii=new QM(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let n=this.overlays[e.toKey()];return n||(n=new WM,this.overlays[e.toKey()]=n),n}getMutationQueue(e,n){let r=this.ui[e.toKey()];return r||(r=new YM(n,this.referenceDelegate),this.ui[e.toKey()]=r),r}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,n,r){Le("MemoryPersistence","Starting transaction:",e);const i=new eN(this.ci.next());return this.referenceDelegate.Ei(),r(i).next((o=>this.referenceDelegate.di(i).next((()=>o)))).toPromise().then((o=>(i.raiseOnCommittedEvent(),o)))}Ai(e,n){return Ie.or(Object.values(this.ui).map((r=>()=>r.containsKey(e,n))))}}class eN extends jO{constructor(e){super(),this.currentSequenceNumber=e}}class p0{constructor(e){this.persistence=e,this.Ri=new m0,this.Vi=null}static mi(e){return new p0(e)}get fi(){if(this.Vi)return this.Vi;throw Ye(60996)}addReference(e,n,r){return this.Ri.addReference(r,n),this.fi.delete(r.toString()),Ie.resolve()}removeReference(e,n,r){return this.Ri.removeReference(r,n),this.fi.add(r.toString()),Ie.resolve()}markPotentiallyOrphaned(e,n){return this.fi.add(n.toString()),Ie.resolve()}removeTarget(e,n){this.Ri.jr(n.targetId).forEach((i=>this.fi.add(i.toString())));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,n.targetId).next((i=>{i.forEach((o=>this.fi.add(o.toString())))})).next((()=>r.removeTargetData(e,n)))}Ei(){this.Vi=new Set}di(e){const n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Ie.forEach(this.fi,(r=>{const i=Qe.fromPath(r);return this.gi(e,i).next((o=>{o||n.removeEntry(i,Ze.min())}))})).next((()=>(this.Vi=null,n.apply(e))))}updateLimboDocument(e,n){return this.gi(e,n).next((r=>{r?this.fi.delete(n.toString()):this.fi.add(n.toString())}))}Ti(e){return 0}gi(e,n){return Ie.or([()=>Ie.resolve(this.Ri.containsKey(n)),()=>this.persistence.getTargetCache().containsKey(e,n),()=>this.persistence.Ai(e,n)])}}class wf{constructor(e,n){this.persistence=e,this.pi=new Mo((r=>kO(r.path)),((r,i)=>r.isEqual(i))),this.garbageCollector=$M(this,n)}static mi(e,n){return new wf(e,n)}Ei(){}di(e){return Ie.resolve()}forEachTarget(e,n){return this.persistence.getTargetCache().forEachTarget(e,n)}gr(e){const n=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next((r=>n.next((i=>r+i))))}wr(e){let n=0;return this.pr(e,(r=>{n++})).next((()=>n))}pr(e,n){return Ie.forEach(this.pi,((r,i)=>this.br(e,r,i).next((o=>o?Ie.resolve():n(i)))))}removeTargets(e,n,r){return this.persistence.getTargetCache().removeTargets(e,n,r)}removeOrphanedDocuments(e,n){let r=0;const i=this.persistence.getRemoteDocumentCache(),o=i.newChangeBuffer();return i.ii(e,(l=>this.br(e,l,n).next((d=>{d||(r++,o.removeEntry(l,Ze.min()))})))).next((()=>o.apply(e))).next((()=>r))}markPotentiallyOrphaned(e,n){return this.pi.set(n,e.currentSequenceNumber),Ie.resolve()}removeTarget(e,n){const r=n.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,n,r){return this.pi.set(r,e.currentSequenceNumber),Ie.resolve()}removeReference(e,n,r){return this.pi.set(r,e.currentSequenceNumber),Ie.resolve()}updateLimboDocument(e,n){return this.pi.set(n,e.currentSequenceNumber),Ie.resolve()}Ti(e){let n=e.key.toString().length;return e.isFoundDocument()&&(n+=Xh(e.data.value)),n}br(e,n,r){return Ie.or([()=>this.persistence.Ai(e,n),()=>this.persistence.getTargetCache().containsKey(e,n),()=>{const i=this.pi.get(n);return Ie.resolve(i!==void 0&&i>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class g0{constructor(e,n,r,i){this.targetId=e,this.fromCache=n,this.Es=r,this.ds=i}static As(e,n){let r=gt(),i=gt();for(const o of n.docChanges)switch(o.type){case 0:r=r.add(o.doc.key);break;case 1:i=i.add(o.doc.key)}return new g0(e,n.fromCache,r,i)}}class tN{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class nN{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(function(){return IR()?8:RO(Jn())>0?6:4})()}initialize(e,n){this.ps=e,this.indexManager=n,this.Rs=!0}getDocumentsMatchingQuery(e,n,r,i){const o={result:null};return this.ys(e,n).next((l=>{o.result=l})).next((()=>{if(!o.result)return this.ws(e,n,i,r).next((l=>{o.result=l}))})).next((()=>{if(o.result)return;const l=new tN;return this.Ss(e,n,l).next((d=>{if(o.result=d,this.Vs)return this.bs(e,n,l,d.size)}))})).next((()=>o.result))}bs(e,n,r,i){return r.documentReadCount<this.fs?(kl()<=mt.DEBUG&&Le("QueryEngine","SDK will not create cache indexes for query:",Dl(n),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),Ie.resolve()):(kl()<=mt.DEBUG&&Le("QueryEngine","Query:",Dl(n),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.gs*i?(kl()<=mt.DEBUG&&Le("QueryEngine","The SDK decides to create cache indexes for query:",Dl(n),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Fs(n))):Ie.resolve())}ys(e,n){if(Qw(n))return Ie.resolve(null);let r=Fs(n);return this.indexManager.getIndexType(e,r).next((i=>i===0?null:(n.limit!==null&&i===1&&(n=by(n,null,"F"),r=Fs(n)),this.indexManager.getDocumentsMatchingTarget(e,r).next((o=>{const l=gt(...o);return this.ps.getDocuments(e,l).next((d=>this.indexManager.getMinOffset(e,r).next((h=>{const m=this.Ds(n,d);return this.Cs(n,m,l,h.readTime)?this.ys(e,by(n,null,"F")):this.vs(e,m,n,h)}))))})))))}ws(e,n,r,i){return Qw(n)||i.isEqual(Ze.min())?Ie.resolve(null):this.ps.getDocuments(e,r).next((o=>{const l=this.Ds(n,o);return this.Cs(n,l,r,i)?Ie.resolve(null):(kl()<=mt.DEBUG&&Le("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Dl(n)),this.vs(e,l,n,CO(i,Nu)).next((d=>d)))}))}Ds(e,n){let r=new An(lE(e));return n.forEach(((i,o)=>{Yf(e,o)&&(r=r.add(o))})),r}Cs(e,n,r,i){if(e.limit===null)return!1;if(r.size!==n.size)return!0;const o=e.limitType==="F"?n.last():n.first();return!!o&&(o.hasPendingWrites||o.version.compareTo(i)>0)}Ss(e,n,r){return kl()<=mt.DEBUG&&Le("QueryEngine","Using full collection scan to execute query:",Dl(n)),this.ps.getDocumentsMatchingQuery(e,n,wa.min(),r)}vs(e,n,r,i){return this.ps.getDocumentsMatchingQuery(e,r,i).next((o=>(n.forEach((l=>{o=o.insert(l.key,l)})),o)))}}const y0="LocalStore",rN=3e8;class sN{constructor(e,n,r,i){this.persistence=e,this.Fs=n,this.serializer=i,this.Ms=new Jt(pt),this.xs=new Mo((o=>o0(o)),l0),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(r)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new GM(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(n=>e.collect(n,this.Ms)))}}function iN(t,e,n,r){return new sN(t,e,n,r)}async function DE(t,e){const n=tt(t);return await n.persistence.runTransaction("Handle user change","readonly",(r=>{let i;return n.mutationQueue.getAllMutationBatches(r).next((o=>(i=o,n.Bs(e),n.mutationQueue.getAllMutationBatches(r)))).next((o=>{const l=[],d=[];let h=gt();for(const m of i){l.push(m.batchId);for(const p of m.mutations)h=h.add(p.key)}for(const m of o){d.push(m.batchId);for(const p of m.mutations)h=h.add(p.key)}return n.localDocuments.getDocuments(r,h).next((m=>({Ls:m,removedBatchIds:l,addedBatchIds:d})))}))}))}function aN(t,e){const n=tt(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(r=>{const i=e.batch.keys(),o=n.Ns.newChangeBuffer({trackRemovals:!0});return(function(d,h,m,p){const g=m.batch,v=g.keys();let _=Ie.resolve();return v.forEach((C=>{_=_.next((()=>p.getEntry(h,C))).next((x=>{const S=m.docVersions.get(C);Rt(S!==null,48541),x.version.compareTo(S)<0&&(g.applyToRemoteDocument(x,m),x.isValidDocument()&&(x.setReadTime(m.commitVersion),p.addEntry(x)))}))})),_.next((()=>d.mutationQueue.removeMutationBatch(h,g)))})(n,r,e,o).next((()=>o.apply(r))).next((()=>n.mutationQueue.performConsistencyCheck(r))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,(function(d){let h=gt();for(let m=0;m<d.mutationResults.length;++m)d.mutationResults[m].transformResults.length>0&&(h=h.add(d.batch.mutations[m].key));return h})(e)))).next((()=>n.localDocuments.getDocuments(r,i)))}))}function OE(t){const e=tt(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(n=>e.Pi.getLastRemoteSnapshotVersion(n)))}function oN(t,e){const n=tt(t),r=e.snapshotVersion;let i=n.Ms;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(o=>{const l=n.Ns.newChangeBuffer({trackRemovals:!0});i=n.Ms;const d=[];e.targetChanges.forEach(((p,g)=>{const v=i.get(g);if(!v)return;d.push(n.Pi.removeMatchingKeys(o,p.removedDocuments,g).next((()=>n.Pi.addMatchingKeys(o,p.addedDocuments,g))));let _=v.withSequenceNumber(o.currentSequenceNumber);e.targetMismatches.get(g)!==null?_=_.withResumeToken($n.EMPTY_BYTE_STRING,Ze.min()).withLastLimboFreeSnapshotVersion(Ze.min()):p.resumeToken.approximateByteSize()>0&&(_=_.withResumeToken(p.resumeToken,r)),i=i.insert(g,_),(function(x,S,E){return x.resumeToken.approximateByteSize()===0||S.snapshotVersion.toMicroseconds()-x.snapshotVersion.toMicroseconds()>=rN?!0:E.addedDocuments.size+E.modifiedDocuments.size+E.removedDocuments.size>0})(v,_,p)&&d.push(n.Pi.updateTargetData(o,_))}));let h=wi(),m=gt();if(e.documentUpdates.forEach((p=>{e.resolvedLimboDocuments.has(p)&&d.push(n.persistence.referenceDelegate.updateLimboDocument(o,p))})),d.push(lN(o,l,e.documentUpdates).next((p=>{h=p.ks,m=p.qs}))),!r.isEqual(Ze.min())){const p=n.Pi.getLastRemoteSnapshotVersion(o).next((g=>n.Pi.setTargetsMetadata(o,o.currentSequenceNumber,r)));d.push(p)}return Ie.waitFor(d).next((()=>l.apply(o))).next((()=>n.localDocuments.getLocalViewOfDocuments(o,h,m))).next((()=>h))})).then((o=>(n.Ms=i,o)))}function lN(t,e,n){let r=gt(),i=gt();return n.forEach((o=>r=r.add(o))),e.getEntries(t,r).next((o=>{let l=wi();return n.forEach(((d,h)=>{const m=o.get(d);h.isFoundDocument()!==m.isFoundDocument()&&(i=i.add(d)),h.isNoDocument()&&h.version.isEqual(Ze.min())?(e.removeEntry(d,h.readTime),l=l.insert(d,h)):!m.isValidDocument()||h.version.compareTo(m.version)>0||h.version.compareTo(m.version)===0&&m.hasPendingWrites?(e.addEntry(h),l=l.insert(d,h)):Le(y0,"Ignoring outdated watch update for ",d,". Current version:",m.version," Watch version:",h.version)})),{ks:l,qs:i}}))}function cN(t,e){const n=tt(t);return n.persistence.runTransaction("Get next mutation batch","readonly",(r=>(e===void 0&&(e=s0),n.mutationQueue.getNextMutationBatchAfterBatchId(r,e))))}function uN(t,e){const n=tt(t);return n.persistence.runTransaction("Allocate target","readwrite",(r=>{let i;return n.Pi.getTargetData(r,e).next((o=>o?(i=o,Ie.resolve(i)):n.Pi.allocateTargetId(r).next((l=>(i=new da(e,l,"TargetPurposeListen",r.currentSequenceNumber),n.Pi.addTargetData(r,i).next((()=>i)))))))})).then((r=>{const i=n.Ms.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(n.Ms=n.Ms.insert(r.targetId,r),n.xs.set(e,r.targetId)),r}))}async function Cy(t,e,n){const r=tt(t),i=r.Ms.get(e),o=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",o,(l=>r.persistence.referenceDelegate.removeTarget(l,i)))}catch(l){if(!cc(l))throw l;Le(y0,`Failed to update sequence numbers for target ${e}: ${l}`)}r.Ms=r.Ms.remove(e),r.xs.delete(i.target)}function a1(t,e,n){const r=tt(t);let i=Ze.min(),o=gt();return r.persistence.runTransaction("Execute query","readwrite",(l=>(function(h,m,p){const g=tt(h),v=g.xs.get(p);return v!==void 0?Ie.resolve(g.Ms.get(v)):g.Pi.getTargetData(m,p)})(r,l,Fs(e)).next((d=>{if(d)return i=d.lastLimboFreeSnapshotVersion,r.Pi.getMatchingKeysForTargetId(l,d.targetId).next((h=>{o=h}))})).next((()=>r.Fs.getDocumentsMatchingQuery(l,e,n?i:Ze.min(),n?o:gt()))).next((d=>(dN(r,YO(e),d),{documents:d,Qs:o})))))}function dN(t,e,n){let r=t.Os.get(e)||Ze.min();n.forEach(((i,o)=>{o.readTime.compareTo(r)>0&&(r=o.readTime)})),t.Os.set(e,r)}class o1{constructor(){this.activeTargetIds=nM()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class hN{constructor(){this.Mo=new o1,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,n,r){}addLocalQueryTarget(e,n=!0){return n&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,n,r){this.xo[e]=n}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new o1,Promise.resolve()}handleUserChange(e,n,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class fN{Oo(e){}shutdown(){}}const l1="ConnectivityMonitor";class c1{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){Le(l1,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){Le(l1,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}let Fh=null;function Ey(){return Fh===null?Fh=(function(){return 268435456+Math.round(2147483648*Math.random())})():Fh++,"0x"+Fh.toString(16)}const zg="RestConnection",mN={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class pN{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const n=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Uo=n+"://"+e.host,this.Ko=`projects/${r}/databases/${i}`,this.Wo=this.databaseId.database===pf?`project_id=${r}`:`project_id=${r}&database_id=${i}`}Go(e,n,r,i,o){const l=Ey(),d=this.zo(e,n.toUriEncodedString());Le(zg,`Sending RPC '${e}' ${l}:`,d,r);const h={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(h,i,o);const{host:m}=new URL(d),p=nc(m);return this.Jo(e,d,h,r,p).then((g=>(Le(zg,`Received RPC '${e}' ${l}: `,g),g)),(g=>{throw $l(zg,`RPC '${e}' ${l} failed with error: `,g,"url: ",d,"request:",r),g}))}Ho(e,n,r,i,o,l){return this.Go(e,n,r,i,o)}jo(e,n,r){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+oc})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach(((i,o)=>e[o]=i)),r&&r.headers.forEach(((i,o)=>e[o]=i))}zo(e,n){const r=mN[e];return`${this.Uo}/v1/${n}:${r}`}terminate(){}}class gN{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}const Yn="WebChannelConnection";class yN extends pN{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,n,r,i,o){const l=Ey();return new Promise(((d,h)=>{const m=new NC;m.setWithCredentials(!0),m.listenOnce(PC.COMPLETE,(()=>{try{switch(m.getLastErrorCode()){case Yh.NO_ERROR:const g=m.getResponseJson();Le(Yn,`XHR for RPC '${e}' ${l} received:`,JSON.stringify(g)),d(g);break;case Yh.TIMEOUT:Le(Yn,`RPC '${e}' ${l} timed out`),h(new Be(je.DEADLINE_EXCEEDED,"Request time out"));break;case Yh.HTTP_ERROR:const v=m.getStatus();if(Le(Yn,`RPC '${e}' ${l} failed with status:`,v,"response text:",m.getResponseText()),v>0){let _=m.getResponseJson();Array.isArray(_)&&(_=_[0]);const C=_?.error;if(C&&C.status&&C.message){const x=(function(E){const T=E.toLowerCase().replace(/_/g,"-");return Object.values(je).indexOf(T)>=0?T:je.UNKNOWN})(C.status);h(new Be(x,C.message))}else h(new Be(je.UNKNOWN,"Server responded with status "+m.getStatus()))}else h(new Be(je.UNAVAILABLE,"Connection failed."));break;default:Ye(9055,{l_:e,streamId:l,h_:m.getLastErrorCode(),P_:m.getLastError()})}}finally{Le(Yn,`RPC '${e}' ${l} completed.`)}}));const p=JSON.stringify(i);Le(Yn,`RPC '${e}' ${l} sending request:`,i),m.send(n,"POST",p,r,15)}))}T_(e,n,r){const i=Ey(),o=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],l=LC(),d=BC(),h={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},m=this.longPollingOptions.timeoutSeconds;m!==void 0&&(h.longPollingTimeout=Math.round(1e3*m)),this.useFetchStreams&&(h.useFetchStreams=!0),this.jo(h.initMessageHeaders,n,r),h.encodeInitMessageHeaders=!0;const p=o.join("");Le(Yn,`Creating RPC '${e}' stream ${i}: ${p}`,h);const g=l.createWebChannel(p,h);this.I_(g);let v=!1,_=!1;const C=new gN({Yo:S=>{_?Le(Yn,`Not sending because RPC '${e}' stream ${i} is closed:`,S):(v||(Le(Yn,`Opening RPC '${e}' stream ${i} transport.`),g.open(),v=!0),Le(Yn,`RPC '${e}' stream ${i} sending:`,S),g.send(S))},Zo:()=>g.close()}),x=(S,E,T)=>{S.listen(E,(I=>{try{T(I)}catch(M){setTimeout((()=>{throw M}),0)}}))};return x(g,vu.EventType.OPEN,(()=>{_||(Le(Yn,`RPC '${e}' stream ${i} transport opened.`),C.o_())})),x(g,vu.EventType.CLOSE,(()=>{_||(_=!0,Le(Yn,`RPC '${e}' stream ${i} transport closed`),C.a_(),this.E_(g))})),x(g,vu.EventType.ERROR,(S=>{_||(_=!0,$l(Yn,`RPC '${e}' stream ${i} transport errored. Name:`,S.name,"Message:",S.message),C.a_(new Be(je.UNAVAILABLE,"The operation could not be completed")))})),x(g,vu.EventType.MESSAGE,(S=>{if(!_){const E=S.data[0];Rt(!!E,16349);const T=E,I=T?.error||T[0]?.error;if(I){Le(Yn,`RPC '${e}' stream ${i} received error:`,I);const M=I.status;let L=(function(A){const N=_n[A];if(N!==void 0)return vE(N)})(M),$=I.message;L===void 0&&(L=je.INTERNAL,$="Unknown error status: "+M+" with message "+I.message),_=!0,C.a_(new Be(L,$)),g.close()}else Le(Yn,`RPC '${e}' stream ${i} received:`,E),C.u_(E)}})),x(d,zC.STAT_EVENT,(S=>{S.stat===hy.PROXY?Le(Yn,`RPC '${e}' stream ${i} detected buffering proxy`):S.stat===hy.NOPROXY&&Le(Yn,`RPC '${e}' stream ${i} detected no buffering proxy`)})),setTimeout((()=>{C.__()}),0),C}terminate(){this.c_.forEach((e=>e.close())),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter((n=>n===e))}}function Bg(){return typeof document<"u"?document:null}function tm(t){return new xM(t,!0)}class ME{constructor(e,n,r=1e3,i=1.5,o=6e4){this.Mi=e,this.timerId=n,this.d_=r,this.A_=i,this.R_=o,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const n=Math.floor(this.V_+this.y_()),r=Math.max(0,Date.now()-this.f_),i=Math.max(0,n-r);i>0&&Le("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.V_} ms, delay with jitter: ${n} ms, last attempt: ${r} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,i,(()=>(this.f_=Date.now(),e()))),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}const u1="PersistentStream";class NE{constructor(e,n,r,i,o,l,d,h){this.Mi=e,this.S_=r,this.b_=i,this.connection=o,this.authCredentialsProvider=l,this.appCheckCredentialsProvider=d,this.listener=h,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new ME(e,n)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,(()=>this.k_())))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,n){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():n&&n.code===je.RESOURCE_EXHAUSTED?(xi(n.toString()),xi("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):n&&n.code===je.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(n)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),n=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([r,i])=>{this.D_===n&&this.G_(r,i)}),(r=>{e((()=>{const i=new Be(je.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(i)}))}))}G_(e,n){const r=this.W_(this.D_);this.stream=this.j_(e,n),this.stream.Xo((()=>{r((()=>this.listener.Xo()))})),this.stream.t_((()=>{r((()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.t_())))})),this.stream.r_((i=>{r((()=>this.z_(i)))})),this.stream.onMessage((i=>{r((()=>++this.F_==1?this.J_(i):this.onNext(i)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(e){return Le(u1,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return n=>{this.Mi.enqueueAndForget((()=>this.D_===e?n():(Le(u1,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class _N extends NE{constructor(e,n,r,i,o,l){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",n,r,i,l),this.serializer=o}j_(e,n){return this.connection.T_("Listen",e,n)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const n=CM(this.serializer,e),r=(function(o){if(!("targetChange"in o))return Ze.min();const l=o.targetChange;return l.targetIds&&l.targetIds.length?Ze.min():l.readTime?Vs(l.readTime):Ze.min()})(e);return this.listener.H_(n,r)}Y_(e){const n={};n.database=Sy(this.serializer),n.addTarget=(function(o,l){let d;const h=l.target;if(d=yy(h)?{documents:AM(o,h)}:{query:jM(o,h).ft},d.targetId=l.targetId,l.resumeToken.approximateByteSize()>0){d.resumeToken=SE(o,l.resumeToken);const m=vy(o,l.expectedCount);m!==null&&(d.expectedCount=m)}else if(l.snapshotVersion.compareTo(Ze.min())>0){d.readTime=xf(o,l.snapshotVersion.toTimestamp());const m=vy(o,l.expectedCount);m!==null&&(d.expectedCount=m)}return d})(this.serializer,e);const r=IM(this.serializer,e);r&&(n.labels=r),this.q_(n)}Z_(e){const n={};n.database=Sy(this.serializer),n.removeTarget=e,this.q_(n)}}class bN extends NE{constructor(e,n,r,i,o,l){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",n,r,i,l),this.serializer=o}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,n){return this.connection.T_("Write",e,n)}J_(e){return Rt(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,Rt(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){Rt(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const n=TM(e.writeResults,e.commitTime),r=Vs(e.commitTime);return this.listener.na(r,n)}ra(){const e={};e.database=Sy(this.serializer),this.q_(e)}ea(e){const n={streamToken:this.lastStreamToken,writes:e.map((r=>EM(this.serializer,r)))};this.q_(n)}}class vN{}class xN extends vN{constructor(e,n,r,i){super(),this.authCredentials=e,this.appCheckCredentials=n,this.connection=r,this.serializer=i,this.ia=!1}sa(){if(this.ia)throw new Be(je.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,n,r,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([o,l])=>this.connection.Go(e,xy(n,r),i,o,l))).catch((o=>{throw o.name==="FirebaseError"?(o.code===je.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new Be(je.UNKNOWN,o.toString())}))}Ho(e,n,r,i,o){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([l,d])=>this.connection.Ho(e,xy(n,r),i,l,d,o))).catch((l=>{throw l.name==="FirebaseError"?(l.code===je.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),l):new Be(je.UNKNOWN,l.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}class wN{constructor(e,n){this.asyncQueue=e,this.onlineStateHandler=n,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const n=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(xi(n),this.aa=!1):Le("OnlineStateTracker",n)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}const Io="RemoteStore";class SN{constructor(e,n,r,i,o){this.localStore=e,this.datastore=n,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=o,this.Aa.Oo((l=>{r.enqueueAndForget((async()=>{No(this)&&(Le(Io,"Restarting streams for network reachability change."),await(async function(h){const m=tt(h);m.Ea.add(4),await rd(m),m.Ra.set("Unknown"),m.Ea.delete(4),await nm(m)})(this))}))})),this.Ra=new wN(r,i)}}async function nm(t){if(No(t))for(const e of t.da)await e(!0)}async function rd(t){for(const e of t.da)await e(!1)}function PE(t,e){const n=tt(t);n.Ia.has(e.targetId)||(n.Ia.set(e.targetId,e),x0(n)?v0(n):uc(n).O_()&&b0(n,e))}function _0(t,e){const n=tt(t),r=uc(n);n.Ia.delete(e),r.O_()&&zE(n,e),n.Ia.size===0&&(r.O_()?r.L_():No(n)&&n.Ra.set("Unknown"))}function b0(t,e){if(t.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Ze.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}uc(t).Y_(e)}function zE(t,e){t.Va.Ue(e),uc(t).Z_(e)}function v0(t){t.Va=new yM({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),At:e=>t.Ia.get(e)||null,ht:()=>t.datastore.serializer.databaseId}),uc(t).start(),t.Ra.ua()}function x0(t){return No(t)&&!uc(t).x_()&&t.Ia.size>0}function No(t){return tt(t).Ea.size===0}function BE(t){t.Va=void 0}async function CN(t){t.Ra.set("Online")}async function EN(t){t.Ia.forEach(((e,n)=>{b0(t,e)}))}async function TN(t,e){BE(t),x0(t)?(t.Ra.ha(e),v0(t)):t.Ra.set("Unknown")}async function AN(t,e,n){if(t.Ra.set("Online"),e instanceof wE&&e.state===2&&e.cause)try{await(async function(i,o){const l=o.cause;for(const d of o.targetIds)i.Ia.has(d)&&(await i.remoteSyncer.rejectListen(d,l),i.Ia.delete(d),i.Va.removeTarget(d))})(t,e)}catch(r){Le(Io,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await Sf(t,r)}else if(e instanceof ef?t.Va.Ze(e):e instanceof xE?t.Va.st(e):t.Va.tt(e),!n.isEqual(Ze.min()))try{const r=await OE(t.localStore);n.compareTo(r)>=0&&await(function(o,l){const d=o.Va.Tt(l);return d.targetChanges.forEach(((h,m)=>{if(h.resumeToken.approximateByteSize()>0){const p=o.Ia.get(m);p&&o.Ia.set(m,p.withResumeToken(h.resumeToken,l))}})),d.targetMismatches.forEach(((h,m)=>{const p=o.Ia.get(h);if(!p)return;o.Ia.set(h,p.withResumeToken($n.EMPTY_BYTE_STRING,p.snapshotVersion)),zE(o,h);const g=new da(p.target,h,m,p.sequenceNumber);b0(o,g)})),o.remoteSyncer.applyRemoteEvent(d)})(t,n)}catch(r){Le(Io,"Failed to raise snapshot:",r),await Sf(t,r)}}async function Sf(t,e,n){if(!cc(e))throw e;t.Ea.add(1),await rd(t),t.Ra.set("Offline"),n||(n=()=>OE(t.localStore)),t.asyncQueue.enqueueRetryable((async()=>{Le(Io,"Retrying IndexedDB access"),await n(),t.Ea.delete(1),await nm(t)}))}function LE(t,e){return e().catch((n=>Sf(t,n,e)))}async function rm(t){const e=tt(t),n=Ta(e);let r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:s0;for(;jN(e);)try{const i=await cN(e.localStore,r);if(i===null){e.Ta.length===0&&n.L_();break}r=i.batchId,RN(e,i)}catch(i){await Sf(e,i)}UE(e)&&FE(e)}function jN(t){return No(t)&&t.Ta.length<10}function RN(t,e){t.Ta.push(e);const n=Ta(t);n.O_()&&n.X_&&n.ea(e.mutations)}function UE(t){return No(t)&&!Ta(t).x_()&&t.Ta.length>0}function FE(t){Ta(t).start()}async function IN(t){Ta(t).ra()}async function kN(t){const e=Ta(t);for(const n of t.Ta)e.ea(n.mutations)}async function DN(t,e,n){const r=t.Ta.shift(),i=d0.from(r,e,n);await LE(t,(()=>t.remoteSyncer.applySuccessfulWrite(i))),await rm(t)}async function ON(t,e){e&&Ta(t).X_&&await(async function(r,i){if((function(l){return mM(l)&&l!==je.ABORTED})(i.code)){const o=r.Ta.shift();Ta(r).B_(),await LE(r,(()=>r.remoteSyncer.rejectFailedWrite(o.batchId,i))),await rm(r)}})(t,e),UE(t)&&FE(t)}async function d1(t,e){const n=tt(t);n.asyncQueue.verifyOperationInProgress(),Le(Io,"RemoteStore received new credentials");const r=No(n);n.Ea.add(3),await rd(n),r&&n.Ra.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.Ea.delete(3),await nm(n)}async function MN(t,e){const n=tt(t);e?(n.Ea.delete(2),await nm(n)):e||(n.Ea.add(2),await rd(n),n.Ra.set("Unknown"))}function uc(t){return t.ma||(t.ma=(function(n,r,i){const o=tt(n);return o.sa(),new _N(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,i)})(t.datastore,t.asyncQueue,{Xo:CN.bind(null,t),t_:EN.bind(null,t),r_:TN.bind(null,t),H_:AN.bind(null,t)}),t.da.push((async e=>{e?(t.ma.B_(),x0(t)?v0(t):t.Ra.set("Unknown")):(await t.ma.stop(),BE(t))}))),t.ma}function Ta(t){return t.fa||(t.fa=(function(n,r,i){const o=tt(n);return o.sa(),new bN(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,i)})(t.datastore,t.asyncQueue,{Xo:()=>Promise.resolve(),t_:IN.bind(null,t),r_:ON.bind(null,t),ta:kN.bind(null,t),na:DN.bind(null,t)}),t.da.push((async e=>{e?(t.fa.B_(),await rm(t)):(await t.fa.stop(),t.Ta.length>0&&(Le(Io,`Stopping write stream with ${t.Ta.length} pending writes`),t.Ta=[]))}))),t.fa}class w0{constructor(e,n,r,i,o){this.asyncQueue=e,this.timerId=n,this.targetTimeMs=r,this.op=i,this.removalCallback=o,this.deferred=new gi,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((l=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,n,r,i,o){const l=Date.now()+r,d=new w0(e,n,l,i,o);return d.start(r),d}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Be(je.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function S0(t,e){if(xi("AsyncQueue",`${e}: ${t}`),cc(t))return new Be(je.UNAVAILABLE,`${e}: ${t}`);throw t}class Ll{static emptySet(e){return new Ll(e.comparator)}constructor(e){this.comparator=e?(n,r)=>e(n,r)||Qe.comparator(n.key,r.key):(n,r)=>Qe.comparator(n.key,r.key),this.keyedMap=xu(),this.sortedSet=new Jt(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const n=this.keyedMap.get(e);return n?this.sortedSet.indexOf(n):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((n,r)=>(e(n),!1)))}add(e){const n=this.delete(e.key);return n.copy(n.keyedMap.insert(e.key,e),n.sortedSet.insert(e,null))}delete(e){const n=this.get(e);return n?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(n)):this}isEqual(e){if(!(e instanceof Ll)||this.size!==e.size)return!1;const n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;n.hasNext();){const i=n.getNext().key,o=r.getNext().key;if(!i.isEqual(o))return!1}return!0}toString(){const e=[];return this.forEach((n=>{e.push(n.toString())})),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,n){const r=new Ll;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r}}class h1{constructor(){this.ga=new Jt(Qe.comparator)}track(e){const n=e.doc.key,r=this.ga.get(n);r?e.type!==0&&r.type===3?this.ga=this.ga.insert(n,e):e.type===3&&r.type!==1?this.ga=this.ga.insert(n,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.ga=this.ga.insert(n,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.ga=this.ga.insert(n,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.ga=this.ga.remove(n):e.type===1&&r.type===2?this.ga=this.ga.insert(n,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.ga=this.ga.insert(n,{type:2,doc:e.doc}):Ye(63341,{Rt:e,pa:r}):this.ga=this.ga.insert(n,e)}ya(){const e=[];return this.ga.inorderTraversal(((n,r)=>{e.push(r)})),e}}class Yl{constructor(e,n,r,i,o,l,d,h,m){this.query=e,this.docs=n,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=o,this.fromCache=l,this.syncStateChanged=d,this.excludesMetadataChanges=h,this.hasCachedResults=m}static fromInitialDocuments(e,n,r,i,o){const l=[];return n.forEach((d=>{l.push({type:0,doc:d})})),new Yl(e,n,Ll.emptySet(n),l,r,i,!0,!1,o)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Kf(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const n=this.docChanges,r=e.docChanges;if(n.length!==r.length)return!1;for(let i=0;i<n.length;i++)if(n[i].type!==r[i].type||!n[i].doc.isEqual(r[i].doc))return!1;return!0}}class NN{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some((e=>e.Da()))}}class PN{constructor(){this.queries=f1(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(n,r){const i=tt(n),o=i.queries;i.queries=f1(),o.forEach(((l,d)=>{for(const h of d.Sa)h.onError(r)}))})(this,new Be(je.ABORTED,"Firestore shutting down"))}}function f1(){return new Mo((t=>oE(t)),Kf)}async function VE(t,e){const n=tt(t);let r=3;const i=e.query;let o=n.queries.get(i);o?!o.ba()&&e.Da()&&(r=2):(o=new NN,r=e.Da()?0:1);try{switch(r){case 0:o.wa=await n.onListen(i,!0);break;case 1:o.wa=await n.onListen(i,!1);break;case 2:await n.onFirstRemoteStoreListen(i)}}catch(l){const d=S0(l,`Initialization of query '${Dl(e.query)}' failed`);return void e.onError(d)}n.queries.set(i,o),o.Sa.push(e),e.va(n.onlineState),o.wa&&e.Fa(o.wa)&&C0(n)}async function $E(t,e){const n=tt(t),r=e.query;let i=3;const o=n.queries.get(r);if(o){const l=o.Sa.indexOf(e);l>=0&&(o.Sa.splice(l,1),o.Sa.length===0?i=e.Da()?0:1:!o.ba()&&e.Da()&&(i=2))}switch(i){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}}function zN(t,e){const n=tt(t);let r=!1;for(const i of e){const o=i.query,l=n.queries.get(o);if(l){for(const d of l.Sa)d.Fa(i)&&(r=!0);l.wa=i}}r&&C0(n)}function BN(t,e,n){const r=tt(t),i=r.queries.get(e);if(i)for(const o of i.Sa)o.onError(n);r.queries.delete(e)}function C0(t){t.Ca.forEach((e=>{e.next()}))}var Ty,m1;(m1=Ty||(Ty={})).Ma="default",m1.Cache="cache";class qE{constructor(e,n,r){this.query=e,this.xa=n,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){const r=[];for(const i of e.docChanges)i.type!==3&&r.push(i);e=new Yl(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let n=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),n=!0):this.La(e,this.onlineState)&&(this.ka(e),n=!0),this.Na=e,n}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let n=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),n=!0),n}La(e,n){if(!e.fromCache||!this.Da())return!0;const r=n!=="Offline";return(!this.options.qa||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||n==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const n=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!n)&&this.options.includeMetadataChanges===!0}ka(e){e=Yl.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==Ty.Cache}}class HE{constructor(e){this.key=e}}class GE{constructor(e){this.key=e}}class LN{constructor(e,n){this.query=e,this.Ya=n,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=gt(),this.mutatedKeys=gt(),this.eu=lE(e),this.tu=new Ll(this.eu)}get nu(){return this.Ya}ru(e,n){const r=n?n.iu:new h1,i=n?n.tu:this.tu;let o=n?n.mutatedKeys:this.mutatedKeys,l=i,d=!1;const h=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,m=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal(((p,g)=>{const v=i.get(p),_=Yf(this.query,g)?g:null,C=!!v&&this.mutatedKeys.has(v.key),x=!!_&&(_.hasLocalMutations||this.mutatedKeys.has(_.key)&&_.hasCommittedMutations);let S=!1;v&&_?v.data.isEqual(_.data)?C!==x&&(r.track({type:3,doc:_}),S=!0):this.su(v,_)||(r.track({type:2,doc:_}),S=!0,(h&&this.eu(_,h)>0||m&&this.eu(_,m)<0)&&(d=!0)):!v&&_?(r.track({type:0,doc:_}),S=!0):v&&!_&&(r.track({type:1,doc:v}),S=!0,(h||m)&&(d=!0)),S&&(_?(l=l.add(_),o=x?o.add(p):o.delete(p)):(l=l.delete(p),o=o.delete(p)))})),this.query.limit!==null)for(;l.size>this.query.limit;){const p=this.query.limitType==="F"?l.last():l.first();l=l.delete(p.key),o=o.delete(p.key),r.track({type:1,doc:p})}return{tu:l,iu:r,Cs:d,mutatedKeys:o}}su(e,n){return e.hasLocalMutations&&n.hasCommittedMutations&&!n.hasLocalMutations}applyChanges(e,n,r,i){const o=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const l=e.iu.ya();l.sort(((p,g)=>(function(_,C){const x=S=>{switch(S){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Ye(20277,{Rt:S})}};return x(_)-x(C)})(p.type,g.type)||this.eu(p.doc,g.doc))),this.ou(r),i=i??!1;const d=n&&!i?this._u():[],h=this.Xa.size===0&&this.current&&!i?1:0,m=h!==this.Za;return this.Za=h,l.length!==0||m?{snapshot:new Yl(this.query,e.tu,o,l,e.mutatedKeys,h===0,m,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:d}:{au:d}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new h1,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach((n=>this.Ya=this.Ya.add(n))),e.modifiedDocuments.forEach((n=>{})),e.removedDocuments.forEach((n=>this.Ya=this.Ya.delete(n))),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=gt(),this.tu.forEach((r=>{this.uu(r.key)&&(this.Xa=this.Xa.add(r.key))}));const n=[];return e.forEach((r=>{this.Xa.has(r)||n.push(new GE(r))})),this.Xa.forEach((r=>{e.has(r)||n.push(new HE(r))})),n}cu(e){this.Ya=e.Qs,this.Xa=gt();const n=this.ru(e.documents);return this.applyChanges(n,!0)}lu(){return Yl.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const E0="SyncEngine";class UN{constructor(e,n,r){this.query=e,this.targetId=n,this.view=r}}class FN{constructor(e){this.key=e,this.hu=!1}}class VN{constructor(e,n,r,i,o,l){this.localStore=e,this.remoteStore=n,this.eventManager=r,this.sharedClientState=i,this.currentUser=o,this.maxConcurrentLimboResolutions=l,this.Pu={},this.Tu=new Mo((d=>oE(d)),Kf),this.Iu=new Map,this.Eu=new Set,this.du=new Jt(Qe.comparator),this.Au=new Map,this.Ru=new m0,this.Vu={},this.mu=new Map,this.fu=Kl.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function $N(t,e,n=!0){const r=ZE(t);let i;const o=r.Tu.get(e);return o?(r.sharedClientState.addLocalQueryTarget(o.targetId),i=o.view.lu()):i=await QE(r,e,n,!0),i}async function qN(t,e){const n=ZE(t);await QE(n,e,!0,!1)}async function QE(t,e,n,r){const i=await uN(t.localStore,Fs(e)),o=i.targetId,l=t.sharedClientState.addLocalQueryTarget(o,n);let d;return r&&(d=await HN(t,e,o,l==="current",i.resumeToken)),t.isPrimaryClient&&n&&PE(t.remoteStore,i),d}async function HN(t,e,n,r,i){t.pu=(g,v,_)=>(async function(x,S,E,T){let I=S.view.ru(E);I.Cs&&(I=await a1(x.localStore,S.query,!1).then((({documents:k})=>S.view.ru(k,I))));const M=T&&T.targetChanges.get(S.targetId),L=T&&T.targetMismatches.get(S.targetId)!=null,$=S.view.applyChanges(I,x.isPrimaryClient,M,L);return g1(x,S.targetId,$.au),$.snapshot})(t,g,v,_);const o=await a1(t.localStore,e,!0),l=new LN(e,o.Qs),d=l.ru(o.documents),h=nd.createSynthesizedTargetChangeForCurrentChange(n,r&&t.onlineState!=="Offline",i),m=l.applyChanges(d,t.isPrimaryClient,h);g1(t,n,m.au);const p=new UN(e,n,l);return t.Tu.set(e,p),t.Iu.has(n)?t.Iu.get(n).push(e):t.Iu.set(n,[e]),m.snapshot}async function GN(t,e,n){const r=tt(t),i=r.Tu.get(e),o=r.Iu.get(i.targetId);if(o.length>1)return r.Iu.set(i.targetId,o.filter((l=>!Kf(l,e)))),void r.Tu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||await Cy(r.localStore,i.targetId,!1).then((()=>{r.sharedClientState.clearQueryState(i.targetId),n&&_0(r.remoteStore,i.targetId),Ay(r,i.targetId)})).catch(lc)):(Ay(r,i.targetId),await Cy(r.localStore,i.targetId,!0))}async function QN(t,e){const n=tt(t),r=n.Tu.get(e),i=n.Iu.get(r.targetId);n.isPrimaryClient&&i.length===1&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),_0(n.remoteStore,r.targetId))}async function WN(t,e,n){const r=t6(t);try{const i=await(function(l,d){const h=tt(l),m=Gt.now(),p=d.reduce(((_,C)=>_.add(C.key)),gt());let g,v;return h.persistence.runTransaction("Locally write mutations","readwrite",(_=>{let C=wi(),x=gt();return h.Ns.getEntries(_,p).next((S=>{C=S,C.forEach(((E,T)=>{T.isValidDocument()||(x=x.add(E))}))})).next((()=>h.localDocuments.getOverlayedDocuments(_,C))).next((S=>{g=S;const E=[];for(const T of d){const I=cM(T,g.get(T.key).overlayedDocument);I!=null&&E.push(new Na(T.key,I,JC(I.value.mapValue),gr.exists(!0)))}return h.mutationQueue.addMutationBatch(_,m,E,d)})).next((S=>{v=S;const E=S.applyToLocalDocumentSet(g,x);return h.documentOverlayCache.saveOverlays(_,S.batchId,E)}))})).then((()=>({batchId:v.batchId,changes:uE(g)})))})(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),(function(l,d,h){let m=l.Vu[l.currentUser.toKey()];m||(m=new Jt(pt)),m=m.insert(d,h),l.Vu[l.currentUser.toKey()]=m})(r,i.batchId,n),await sd(r,i.changes),await rm(r.remoteStore)}catch(i){const o=S0(i,"Failed to persist write");n.reject(o)}}async function WE(t,e){const n=tt(t);try{const r=await oN(n.localStore,e);e.targetChanges.forEach(((i,o)=>{const l=n.Au.get(o);l&&(Rt(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1,22616),i.addedDocuments.size>0?l.hu=!0:i.modifiedDocuments.size>0?Rt(l.hu,14607):i.removedDocuments.size>0&&(Rt(l.hu,42227),l.hu=!1))})),await sd(n,r,e)}catch(r){await lc(r)}}function p1(t,e,n){const r=tt(t);if(r.isPrimaryClient&&n===0||!r.isPrimaryClient&&n===1){const i=[];r.Tu.forEach(((o,l)=>{const d=l.view.va(e);d.snapshot&&i.push(d.snapshot)})),(function(l,d){const h=tt(l);h.onlineState=d;let m=!1;h.queries.forEach(((p,g)=>{for(const v of g.Sa)v.va(d)&&(m=!0)})),m&&C0(h)})(r.eventManager,e),i.length&&r.Pu.H_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function KN(t,e,n){const r=tt(t);r.sharedClientState.updateQueryState(e,"rejected",n);const i=r.Au.get(e),o=i&&i.key;if(o){let l=new Jt(Qe.comparator);l=l.insert(o,Zn.newNoDocument(o,Ze.min()));const d=gt().add(o),h=new em(Ze.min(),new Map,new Jt(pt),l,d);await WE(r,h),r.du=r.du.remove(o),r.Au.delete(e),T0(r)}else await Cy(r.localStore,e,!1).then((()=>Ay(r,e,n))).catch(lc)}async function YN(t,e){const n=tt(t),r=e.batch.batchId;try{const i=await aN(n.localStore,e);YE(n,r,null),KE(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await sd(n,i)}catch(i){await lc(i)}}async function XN(t,e,n){const r=tt(t);try{const i=await(function(l,d){const h=tt(l);return h.persistence.runTransaction("Reject batch","readwrite-primary",(m=>{let p;return h.mutationQueue.lookupMutationBatch(m,d).next((g=>(Rt(g!==null,37113),p=g.keys(),h.mutationQueue.removeMutationBatch(m,g)))).next((()=>h.mutationQueue.performConsistencyCheck(m))).next((()=>h.documentOverlayCache.removeOverlaysForBatchId(m,p,d))).next((()=>h.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(m,p))).next((()=>h.localDocuments.getDocuments(m,p)))}))})(r.localStore,e);YE(r,e,n),KE(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),await sd(r,i)}catch(i){await lc(i)}}function KE(t,e){(t.mu.get(e)||[]).forEach((n=>{n.resolve()})),t.mu.delete(e)}function YE(t,e,n){const r=tt(t);let i=r.Vu[r.currentUser.toKey()];if(i){const o=i.get(e);o&&(n?o.reject(n):o.resolve(),i=i.remove(e)),r.Vu[r.currentUser.toKey()]=i}}function Ay(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.Iu.get(e))t.Tu.delete(r),n&&t.Pu.yu(r,n);t.Iu.delete(e),t.isPrimaryClient&&t.Ru.jr(e).forEach((r=>{t.Ru.containsKey(r)||XE(t,r)}))}function XE(t,e){t.Eu.delete(e.path.canonicalString());const n=t.du.get(e);n!==null&&(_0(t.remoteStore,n),t.du=t.du.remove(e),t.Au.delete(n),T0(t))}function g1(t,e,n){for(const r of n)r instanceof HE?(t.Ru.addReference(r.key,e),ZN(t,r)):r instanceof GE?(Le(E0,"Document no longer in limbo: "+r.key),t.Ru.removeReference(r.key,e),t.Ru.containsKey(r.key)||XE(t,r.key)):Ye(19791,{wu:r})}function ZN(t,e){const n=e.key,r=n.path.canonicalString();t.du.get(n)||t.Eu.has(r)||(Le(E0,"New document in limbo: "+n),t.Eu.add(r),T0(t))}function T0(t){for(;t.Eu.size>0&&t.du.size<t.maxConcurrentLimboResolutions;){const e=t.Eu.values().next().value;t.Eu.delete(e);const n=new Qe(Ft.fromString(e)),r=t.fu.next();t.Au.set(r,new FN(n)),t.du=t.du.insert(n,r),PE(t.remoteStore,new da(Fs(c0(n.path)),r,"TargetPurposeLimboResolution",Gf.ce))}}async function sd(t,e,n){const r=tt(t),i=[],o=[],l=[];r.Tu.isEmpty()||(r.Tu.forEach(((d,h)=>{l.push(r.pu(h,e,n).then((m=>{if((m||n)&&r.isPrimaryClient){const p=m?!m.fromCache:n?.targetChanges.get(h.targetId)?.current;r.sharedClientState.updateQueryState(h.targetId,p?"current":"not-current")}if(m){i.push(m);const p=g0.As(h.targetId,m);o.push(p)}})))})),await Promise.all(l),r.Pu.H_(i),await(async function(h,m){const p=tt(h);try{await p.persistence.runTransaction("notifyLocalViewChanges","readwrite",(g=>Ie.forEach(m,(v=>Ie.forEach(v.Es,(_=>p.persistence.referenceDelegate.addReference(g,v.targetId,_))).next((()=>Ie.forEach(v.ds,(_=>p.persistence.referenceDelegate.removeReference(g,v.targetId,_)))))))))}catch(g){if(!cc(g))throw g;Le(y0,"Failed to update sequence numbers: "+g)}for(const g of m){const v=g.targetId;if(!g.fromCache){const _=p.Ms.get(v),C=_.snapshotVersion,x=_.withLastLimboFreeSnapshotVersion(C);p.Ms=p.Ms.insert(v,x)}}})(r.localStore,o))}async function JN(t,e){const n=tt(t);if(!n.currentUser.isEqual(e)){Le(E0,"User change. New user:",e.toKey());const r=await DE(n.localStore,e);n.currentUser=e,(function(o,l){o.mu.forEach((d=>{d.forEach((h=>{h.reject(new Be(je.CANCELLED,l))}))})),o.mu.clear()})(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await sd(n,r.Ls)}}function e6(t,e){const n=tt(t),r=n.Au.get(e);if(r&&r.hu)return gt().add(r.key);{let i=gt();const o=n.Iu.get(e);if(!o)return i;for(const l of o){const d=n.Tu.get(l);i=i.unionWith(d.view.nu)}return i}}function ZE(t){const e=tt(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=WE.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=e6.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=KN.bind(null,e),e.Pu.H_=zN.bind(null,e.eventManager),e.Pu.yu=BN.bind(null,e.eventManager),e}function t6(t){const e=tt(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=YN.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=XN.bind(null,e),e}class Cf{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=tm(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,n){return null}Mu(e,n){return null}vu(e){return iN(this.persistence,new nN,e.initialUser,this.serializer)}Cu(e){return new kE(p0.mi,this.serializer)}Du(e){return new hN}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Cf.provider={build:()=>new Cf};class n6 extends Cf{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,n){Rt(this.persistence.referenceDelegate instanceof wf,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new FM(r,e.asyncQueue,n)}Cu(e){const n=this.cacheSizeBytes!==void 0?hr.withCacheSize(this.cacheSizeBytes):hr.DEFAULT;return new kE((r=>wf.mi(r,n)),this.serializer)}}class jy{async initialize(e,n){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>p1(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=JN.bind(null,this.syncEngine),await MN(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new PN})()}createDatastore(e){const n=tm(e.databaseInfo.databaseId),r=(function(o){return new yN(o)})(e.databaseInfo);return(function(o,l,d,h){return new xN(o,l,d,h)})(e.authCredentials,e.appCheckCredentials,r,n)}createRemoteStore(e){return(function(r,i,o,l,d){return new SN(r,i,o,l,d)})(this.localStore,this.datastore,e.asyncQueue,(n=>p1(this.syncEngine,n,0)),(function(){return c1.v()?new c1:new fN})())}createSyncEngine(e,n){return(function(i,o,l,d,h,m,p){const g=new VN(i,o,l,d,h,m);return p&&(g.gu=!0),g})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,n)}async terminate(){await(async function(n){const r=tt(n);Le(Io,"RemoteStore shutting down."),r.Ea.add(5),await rd(r),r.Aa.shutdown(),r.Ra.set("Unknown")})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}jy.provider={build:()=>new jy};class JE{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):xi("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,n){setTimeout((()=>{this.muted||e(n)}),0)}}const Aa="FirestoreClient";class r6{constructor(e,n,r,i,o){this.authCredentials=e,this.appCheckCredentials=n,this.asyncQueue=r,this.databaseInfo=i,this.user=Xn.UNAUTHENTICATED,this.clientId=r0.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=o,this.authCredentials.start(r,(async l=>{Le(Aa,"Received user=",l.uid),await this.authCredentialListener(l),this.user=l})),this.appCheckCredentials.start(r,(l=>(Le(Aa,"Received new app check token=",l),this.appCheckCredentialListener(l,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new gi;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){const r=S0(n,"Failed to shutdown persistence");e.reject(r)}})),e.promise}}async function Lg(t,e){t.asyncQueue.verifyOperationInProgress(),Le(Aa,"Initializing OfflineComponentProvider");const n=t.configuration;await e.initialize(n);let r=n.initialUser;t.setCredentialChangeListener((async i=>{r.isEqual(i)||(await DE(e.localStore,i),r=i)})),e.persistence.setDatabaseDeletedListener((()=>t.terminate())),t._offlineComponents=e}async function y1(t,e){t.asyncQueue.verifyOperationInProgress();const n=await s6(t);Le(Aa,"Initializing OnlineComponentProvider"),await e.initialize(n,t.configuration),t.setCredentialChangeListener((r=>d1(e.remoteStore,r))),t.setAppCheckTokenChangeListener(((r,i)=>d1(e.remoteStore,i))),t._onlineComponents=e}async function s6(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){Le(Aa,"Using user provided OfflineComponentProvider");try{await Lg(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!(function(i){return i.name==="FirebaseError"?i.code===je.FAILED_PRECONDITION||i.code===je.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11})(n))throw n;$l("Error using user provided cache. Falling back to memory cache: "+n),await Lg(t,new Cf)}}else Le(Aa,"Using default OfflineComponentProvider"),await Lg(t,new n6(void 0));return t._offlineComponents}async function eT(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(Le(Aa,"Using user provided OnlineComponentProvider"),await y1(t,t._uninitializedComponentsProvider._online)):(Le(Aa,"Using default OnlineComponentProvider"),await y1(t,new jy))),t._onlineComponents}function i6(t){return eT(t).then((e=>e.syncEngine))}async function tT(t){const e=await eT(t),n=e.eventManager;return n.onListen=$N.bind(null,e.syncEngine),n.onUnlisten=GN.bind(null,e.syncEngine),n.onFirstRemoteStoreListen=qN.bind(null,e.syncEngine),n.onLastRemoteStoreUnlisten=QN.bind(null,e.syncEngine),n}function a6(t,e,n={}){const r=new gi;return t.asyncQueue.enqueueAndForget((async()=>(function(o,l,d,h,m){const p=new JE({next:v=>{p.Nu(),l.enqueueAndForget((()=>$E(o,g)));const _=v.docs.has(d);!_&&v.fromCache?m.reject(new Be(je.UNAVAILABLE,"Failed to get document because the client is offline.")):_&&v.fromCache&&h&&h.source==="server"?m.reject(new Be(je.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):m.resolve(v)},error:v=>m.reject(v)}),g=new qE(c0(d.path),p,{includeMetadataChanges:!0,qa:!0});return VE(o,g)})(await tT(t),t.asyncQueue,e,n,r))),r.promise}function o6(t,e,n={}){const r=new gi;return t.asyncQueue.enqueueAndForget((async()=>(function(o,l,d,h,m){const p=new JE({next:v=>{p.Nu(),l.enqueueAndForget((()=>$E(o,g))),v.fromCache&&h.source==="server"?m.reject(new Be(je.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):m.resolve(v)},error:v=>m.reject(v)}),g=new qE(d,p,{includeMetadataChanges:!0,qa:!0});return VE(o,g)})(await tT(t),t.asyncQueue,e,n,r))),r.promise}function nT(t){const e={};return t.timeoutSeconds!==void 0&&(e.timeoutSeconds=t.timeoutSeconds),e}const _1=new Map;const rT="firestore.googleapis.com",b1=!0;class v1{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new Be(je.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=rT,this.ssl=b1}else this.host=e.host,this.ssl=e.ssl??b1;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=IE;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<LM)throw new Be(je.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}SO("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=nT(e.experimentalLongPollingOptions??{}),(function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new Be(je.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new Be(je.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new Be(je.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(r,i){return r.timeoutSeconds===i.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class sm{constructor(e,n,r,i){this._authCredentials=e,this._appCheckCredentials=n,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new v1({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Be(je.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new Be(je.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new v1(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(r){if(!r)return new fO;switch(r.type){case"firstParty":return new yO(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new Be(je.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(n){const r=_1.get(n);r&&(Le("ComponentProvider","Removing Datastore"),_1.delete(n),r.terminate())})(this),Promise.resolve()}}function l6(t,e,n,r={}){t=ds(t,sm);const i=nc(e),o=t._getSettings(),l={...o,emulatorOptions:t._getEmulatorOptions()},d=`${e}:${n}`;i&&(GS(`https://${d}`),QS("Firestore",!0)),o.host!==rT&&o.host!==d&&$l("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const h={...o,host:d,ssl:i,emulatorOptions:r};if(!_i(h,l)&&(t._setSettings(h),r.mockUserToken)){let m,p;if(typeof r.mockUserToken=="string")m=r.mockUserToken,p=Xn.MOCK_USER;else{m=xR(r.mockUserToken,t._app?.options.projectId);const g=r.mockUserToken.sub||r.mockUserToken.user_id;if(!g)throw new Be(je.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");p=new Xn(g)}t._authCredentials=new mO(new FC(m,p))}}class dc{constructor(e,n,r){this.converter=n,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new dc(this.firestore,e,this._query)}}class cn{constructor(e,n,r){this.converter=n,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new xa(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new cn(this.firestore,e,this._key)}toJSON(){return{type:cn._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,n,r){if(Ju(n,cn._jsonSchema))return new cn(e,r||null,new Qe(Ft.fromString(n.referencePath)))}}cn._jsonSchemaVersion="firestore/documentReference/1.0",cn._jsonSchema={type:vn("string",cn._jsonSchemaVersion),referencePath:vn("string")};class xa extends dc{constructor(e,n,r){super(e,n,c0(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new cn(this.firestore,null,new Qe(e))}withConverter(e){return new xa(this.firestore,e,this._path)}}function c6(t,e,...n){if(t=xn(t),VC("collection","path",e),t instanceof sm){const r=Ft.fromString(e,...n);return Ow(r),new xa(t,null,r)}{if(!(t instanceof cn||t instanceof xa))throw new Be(je.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(Ft.fromString(e,...n));return Ow(r),new xa(t.firestore,null,r)}}function hc(t,e,...n){if(t=xn(t),arguments.length===1&&(e=r0.newId()),VC("doc","path",e),t instanceof sm){const r=Ft.fromString(e,...n);return Dw(r),new cn(t,null,new Qe(r))}{if(!(t instanceof cn||t instanceof xa))throw new Be(je.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(Ft.fromString(e,...n));return Dw(r),new cn(t.firestore,t instanceof xa?t.converter:null,new Qe(r))}}const x1="AsyncQueue";class w1{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new ME(this,"async_queue_retry"),this._c=()=>{const r=Bg();r&&Le(x1,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=e;const n=Bg();n&&typeof n.addEventListener=="function"&&n.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const n=Bg();n&&typeof n.removeEventListener=="function"&&n.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise((()=>{}));const n=new gi;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(e().then(n.resolve,n.reject),n.promise))).then((()=>n.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Xu.push(e),this.lc())))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!cc(e))throw e;Le(x1,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_((()=>this.lc()))}}cc(e){const n=this.ac.then((()=>(this.rc=!0,e().catch((r=>{throw this.nc=r,this.rc=!1,xi("INTERNAL UNHANDLED ERROR: ",S1(r)),r})).then((r=>(this.rc=!1,r))))));return this.ac=n,n}enqueueAfterDelay(e,n,r){this.uc(),this.oc.indexOf(e)>-1&&(n=0);const i=w0.createAndSchedule(this,e,n,r,(o=>this.hc(o)));return this.tc.push(i),i}uc(){this.nc&&Ye(47125,{Pc:S1(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const n of this.tc)if(n.timerId===e)return!0;return!1}Ec(e){return this.Tc().then((()=>{this.tc.sort(((n,r)=>n.targetTimeMs-r.targetTimeMs));for(const n of this.tc)if(n.skipDelay(),e!=="all"&&n.timerId===e)break;return this.Tc()}))}dc(e){this.oc.push(e)}hc(e){const n=this.tc.indexOf(e);this.tc.splice(n,1)}}function S1(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+`
`+t.stack),e}class Po extends sm{constructor(e,n,r,i){super(e,n,r,i),this.type="firestore",this._queue=new w1,this._persistenceKey=i?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new w1(e),this._firestoreClient=void 0,await e}}}function u6(t,e){const n=typeof t=="object"?t:XS(),r=typeof t=="string"?t:pf,i=Qy(n,"firestore").getImmediate({identifier:r});if(!i._initialized){const o=bR("firestore");o&&l6(i,...o)}return i}function im(t){if(t._terminated)throw new Be(je.FAILED_PRECONDITION,"The client has already been terminated.");return t._firestoreClient||d6(t),t._firestoreClient}function d6(t){const e=t._freezeSettings(),n=(function(i,o,l,d){return new MO(i,o,l,d.host,d.ssl,d.experimentalForceLongPolling,d.experimentalAutoDetectLongPolling,nT(d.experimentalLongPollingOptions),d.useFetchStreams,d.isUsingEmulator)})(t._databaseId,t._app?.options.appId||"",t._persistenceKey,e);t._componentsProvider||e.localCache?._offlineComponentProvider&&e.localCache?._onlineComponentProvider&&(t._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),t._firestoreClient=new r6(t._authCredentials,t._appCheckCredentials,t._queue,n,t._componentsProvider&&(function(i){const o=i?._online.build();return{_offline:i?._offline.build(o),_online:o}})(t._componentsProvider))}class Hr{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Hr($n.fromBase64String(e))}catch(n){throw new Be(je.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+n)}}static fromUint8Array(e){return new Hr($n.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:Hr._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(Ju(e,Hr._jsonSchema))return Hr.fromBase64String(e.bytes)}}Hr._jsonSchemaVersion="firestore/bytes/1.0",Hr._jsonSchema={type:vn("string",Hr._jsonSchemaVersion),bytes:vn("string")};class id{constructor(...e){for(let n=0;n<e.length;++n)if(e[n].length===0)throw new Be(je.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Fn(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class ad{constructor(e){this._methodName=e}}class $s{constructor(e,n){if(!isFinite(e)||e<-90||e>90)throw new Be(je.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(n)||n<-180||n>180)throw new Be(je.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=e,this._long=n}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return pt(this._lat,e._lat)||pt(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:$s._jsonSchemaVersion}}static fromJSON(e){if(Ju(e,$s._jsonSchema))return new $s(e.latitude,e.longitude)}}$s._jsonSchemaVersion="firestore/geoPoint/1.0",$s._jsonSchema={type:vn("string",$s._jsonSchemaVersion),latitude:vn("number"),longitude:vn("number")};class qs{constructor(e){this._values=(e||[]).map((n=>n))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(r,i){if(r.length!==i.length)return!1;for(let o=0;o<r.length;++o)if(r[o]!==i[o])return!1;return!0})(this._values,e._values)}toJSON(){return{type:qs._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(Ju(e,qs._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every((n=>typeof n=="number")))return new qs(e.vectorValues);throw new Be(je.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}qs._jsonSchemaVersion="firestore/vectorValue/1.0",qs._jsonSchema={type:vn("string",qs._jsonSchemaVersion),vectorValues:vn("object")};const h6=/^__.*__$/;class f6{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return this.fieldMask!==null?new Na(e,this.data,this.fieldMask,n,this.fieldTransforms):new td(e,this.data,n,this.fieldTransforms)}}class sT{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return new Na(e,this.data,this.fieldMask,n,this.fieldTransforms)}}function iT(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Ye(40011,{Ac:t})}}class am{constructor(e,n,r,i,o,l){this.settings=e,this.databaseId=n,this.serializer=r,this.ignoreUndefinedProperties=i,o===void 0&&this.Rc(),this.fieldTransforms=o||[],this.fieldMask=l||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new am({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){const n=this.path?.child(e),r=this.Vc({path:n,fc:!1});return r.gc(e),r}yc(e){const n=this.path?.child(e),r=this.Vc({path:n,fc:!1});return r.Rc(),r}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return Ef(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find((n=>e.isPrefixOf(n)))!==void 0||this.fieldTransforms.find((n=>e.isPrefixOf(n.field)))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(iT(this.Ac)&&h6.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class m6{constructor(e,n,r){this.databaseId=e,this.ignoreUndefinedProperties=n,this.serializer=r||tm(e)}Cc(e,n,r,i=!1){return new am({Ac:e,methodName:n,Dc:r,path:Fn.emptyPath(),fc:!1,bc:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function om(t){const e=t._freezeSettings(),n=tm(t._databaseId);return new m6(t._databaseId,!!e.ignoreUndefinedProperties,n)}function aT(t,e,n,r,i,o={}){const l=t.Cc(o.merge||o.mergeFields?2:0,e,n,i);R0("Data must be an object, but it was:",l,r);const d=uT(r,l);let h,m;if(o.merge)h=new Ar(l.fieldMask),m=l.fieldTransforms;else if(o.mergeFields){const p=[];for(const g of o.mergeFields){const v=Ry(e,g,n);if(!l.contains(v))throw new Be(je.INVALID_ARGUMENT,`Field '${v}' is specified in your field mask but missing from your input data.`);hT(p,v)||p.push(v)}h=new Ar(p),m=l.fieldTransforms.filter((g=>h.covers(g.field)))}else h=null,m=l.fieldTransforms;return new f6(new fr(d),h,m)}class lm extends ad{_toFieldTransform(e){if(e.Ac!==2)throw e.Ac===1?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof lm}}function oT(t,e,n){return new am({Ac:3,Dc:e.settings.Dc,methodName:t._methodName,fc:n},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class A0 extends ad{constructor(e,n){super(e),this.vc=n}_toFieldTransform(e){const n=oT(this,e,!0),r=this.vc.map((o=>zo(o,n))),i=new Ql(r);return new yE(e.path,i)}isEqual(e){return e instanceof A0&&_i(this.vc,e.vc)}}class j0 extends ad{constructor(e,n){super(e),this.vc=n}_toFieldTransform(e){const n=oT(this,e,!0),r=this.vc.map((o=>zo(o,n))),i=new Wl(r);return new yE(e.path,i)}isEqual(e){return e instanceof j0&&_i(this.vc,e.vc)}}function lT(t,e,n,r){const i=t.Cc(1,e,n);R0("Data must be an object, but it was:",i,r);const o=[],l=fr.empty();Ma(r,((h,m)=>{const p=I0(e,h,n);m=xn(m);const g=i.yc(p);if(m instanceof lm)o.push(p);else{const v=zo(m,g);v!=null&&(o.push(p),l.set(p,v))}}));const d=new Ar(o);return new sT(l,d,i.fieldTransforms)}function cT(t,e,n,r,i,o){const l=t.Cc(1,e,n),d=[Ry(e,r,n)],h=[i];if(o.length%2!=0)throw new Be(je.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let v=0;v<o.length;v+=2)d.push(Ry(e,o[v])),h.push(o[v+1]);const m=[],p=fr.empty();for(let v=d.length-1;v>=0;--v)if(!hT(m,d[v])){const _=d[v];let C=h[v];C=xn(C);const x=l.yc(_);if(C instanceof lm)m.push(_);else{const S=zo(C,x);S!=null&&(m.push(_),p.set(_,S))}}const g=new Ar(m);return new sT(p,g,l.fieldTransforms)}function p6(t,e,n,r=!1){return zo(n,t.Cc(r?4:3,e))}function zo(t,e){if(dT(t=xn(t)))return R0("Unsupported field value:",e,t),uT(t,e);if(t instanceof ad)return(function(r,i){if(!iT(i.Ac))throw i.Sc(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Sc(`${r._methodName}() is not currently supported inside arrays`);const o=r._toFieldTransform(i);o&&i.fieldTransforms.push(o)})(t,e),null;if(t===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return(function(r,i){const o=[];let l=0;for(const d of r){let h=zo(d,i.wc(l));h==null&&(h={nullValue:"NULL_VALUE"}),o.push(h),l++}return{arrayValue:{values:o}}})(t,e)}return(function(r,i){if((r=xn(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return rM(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const o=Gt.fromDate(r);return{timestampValue:xf(i.serializer,o)}}if(r instanceof Gt){const o=new Gt(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:xf(i.serializer,o)}}if(r instanceof $s)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Hr)return{bytesValue:SE(i.serializer,r._byteString)};if(r instanceof cn){const o=i.databaseId,l=r.firestore._databaseId;if(!l.isEqual(o))throw i.Sc(`Document reference is for database ${l.projectId}/${l.database} but should be for database ${o.projectId}/${o.database}`);return{referenceValue:f0(r.firestore._databaseId||i.databaseId,r._key.path)}}if(r instanceof qs)return(function(l,d){return{mapValue:{fields:{[XC]:{stringValue:ZC},[gf]:{arrayValue:{values:l.toArray().map((m=>{if(typeof m!="number")throw d.Sc("VectorValues must only contain numeric values.");return u0(d.serializer,m)}))}}}}}})(r,i);throw i.Sc(`Unsupported field value: ${Hf(r)}`)})(t,e)}function uT(t,e){const n={};return HC(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Ma(t,((r,i)=>{const o=zo(i,e.mc(r));o!=null&&(n[r]=o)})),{mapValue:{fields:n}}}function dT(t){return!(typeof t!="object"||t===null||t instanceof Array||t instanceof Date||t instanceof Gt||t instanceof $s||t instanceof Hr||t instanceof cn||t instanceof ad||t instanceof qs)}function R0(t,e,n){if(!dT(n)||!$C(n)){const r=Hf(n);throw r==="an object"?e.Sc(t+" a custom object"):e.Sc(t+" "+r)}}function Ry(t,e,n){if((e=xn(e))instanceof id)return e._internalPath;if(typeof e=="string")return I0(t,e);throw Ef("Field path arguments must be of type string or ",t,!1,void 0,n)}const g6=new RegExp("[~\\*/\\[\\]]");function I0(t,e,n){if(e.search(g6)>=0)throw Ef(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new id(...e.split("."))._internalPath}catch{throw Ef(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function Ef(t,e,n,r,i){const o=r&&!r.isEmpty(),l=i!==void 0;let d=`Function ${e}() called with invalid data`;n&&(d+=" (via `toFirestore()`)"),d+=". ";let h="";return(o||l)&&(h+=" (found",o&&(h+=` in field ${r}`),l&&(h+=` in document ${i}`),h+=")"),new Be(je.INVALID_ARGUMENT,d+t+h)}function hT(t,e){return t.some((n=>n.isEqual(e)))}class fT{constructor(e,n,r,i,o){this._firestore=e,this._userDataWriter=n,this._key=r,this._document=i,this._converter=o}get id(){return this._key.path.lastSegment()}get ref(){return new cn(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new y6(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const n=this._document.data.field(k0("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n)}}}class y6 extends fT{data(){return super.data()}}function k0(t,e){return typeof e=="string"?I0(t,e):e instanceof id?e._internalPath:e._delegate._internalPath}function _6(t){if(t.limitType==="L"&&t.explicitOrderBy.length===0)throw new Be(je.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class D0{}class b6 extends D0{}function v6(t,e,...n){let r=[];e instanceof D0&&r.push(e),r=r.concat(n),(function(o){const l=o.filter((h=>h instanceof O0)).length,d=o.filter((h=>h instanceof cm)).length;if(l>1||l>0&&d>0)throw new Be(je.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")})(r);for(const i of r)t=i._apply(t);return t}class cm extends b6{constructor(e,n,r){super(),this._field=e,this._op=n,this._value=r,this.type="where"}static _create(e,n,r){return new cm(e,n,r)}_apply(e){const n=this._parse(e);return mT(e._query,n),new dc(e.firestore,e.converter,_y(e._query,n))}_parse(e){const n=om(e.firestore);return(function(o,l,d,h,m,p,g){let v;if(m.isKeyField()){if(p==="array-contains"||p==="array-contains-any")throw new Be(je.INVALID_ARGUMENT,`Invalid Query. You can't perform '${p}' queries on documentId().`);if(p==="in"||p==="not-in"){E1(g,p);const C=[];for(const x of g)C.push(C1(h,o,x));v={arrayValue:{values:C}}}else v=C1(h,o,g)}else p!=="in"&&p!=="not-in"&&p!=="array-contains-any"||E1(g,p),v=p6(d,l,g,p==="in"||p==="not-in");return bn.create(m,p,v)})(e._query,"where",n,e.firestore._databaseId,this._field,this._op,this._value)}}function x6(t,e,n){const r=e,i=k0("where",t);return cm._create(i,r,n)}class O0 extends D0{constructor(e,n){super(),this.type=e,this._queryConstraints=n}static _create(e,n){return new O0(e,n)}_parse(e){const n=this._queryConstraints.map((r=>r._parse(e))).filter((r=>r.getFilters().length>0));return n.length===1?n[0]:hs.create(n,this._getOperator())}_apply(e){const n=this._parse(e);return n.getFilters().length===0?e:((function(i,o){let l=i;const d=o.getFlattenedFilters();for(const h of d)mT(l,h),l=_y(l,h)})(e._query,n),new dc(e.firestore,e.converter,_y(e._query,n)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function C1(t,e,n){if(typeof(n=xn(n))=="string"){if(n==="")throw new Be(je.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!aE(e)&&n.indexOf("/")!==-1)throw new Be(je.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=e.path.child(Ft.fromString(n));if(!Qe.isDocumentKey(r))throw new Be(je.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Fw(t,new Qe(r))}if(n instanceof cn)return Fw(t,n._key);throw new Be(je.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Hf(n)}.`)}function E1(t,e){if(!Array.isArray(t)||t.length===0)throw new Be(je.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function mT(t,e){const n=(function(i,o){for(const l of i)for(const d of l.getFlattenedFilters())if(o.indexOf(d.op)>=0)return d.op;return null})(t.filters,(function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(e.op));if(n!==null)throw n===e.op?new Be(je.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new Be(je.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}class w6{convertValue(e,n="none"){switch(Ea(e)){case 0:return null;case 1:return e.booleanValue;case 2:return on(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,n);case 5:return e.stringValue;case 6:return this.convertBytes(Ca(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,n);case 11:return this.convertObject(e.mapValue,n);case 10:return this.convertVectorValue(e.mapValue);default:throw Ye(62114,{value:e})}}convertObject(e,n){return this.convertObjectMap(e.fields,n)}convertObjectMap(e,n="none"){const r={};return Ma(e,((i,o)=>{r[i]=this.convertValue(o,n)})),r}convertVectorValue(e){const n=e.fields?.[gf].arrayValue?.values?.map((r=>on(r.doubleValue)));return new qs(n)}convertGeoPoint(e){return new $s(on(e.latitude),on(e.longitude))}convertArray(e,n){return(e.values||[]).map((r=>this.convertValue(r,n)))}convertServerTimestamp(e,n){switch(n){case"previous":const r=Wf(e);return r==null?null:this.convertValue(r,n);case"estimate":return this.convertTimestamp(Pu(e));default:return null}}convertTimestamp(e){const n=Sa(e);return new Gt(n.seconds,n.nanos)}convertDocumentKey(e,n){const r=Ft.fromString(e);Rt(RE(r),9688,{name:e});const i=new zu(r.get(1),r.get(3)),o=new Qe(r.popFirst(5));return i.isEqual(n)||xi(`Document ${o} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${n.projectId}/${n.database}) instead.`),o}}function pT(t,e,n){let r;return r=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,r}class Su{constructor(e,n){this.hasPendingWrites=e,this.fromCache=n}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Co extends fT{constructor(e,n,r,i,o,l){super(e,n,r,i,l),this._firestore=e,this._firestoreImpl=e,this.metadata=o}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const n=new tf(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(n,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,n={}){if(this._document){const r=this._document.data.field(k0("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,n.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new Be(je.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,n={};return n.type=Co._jsonSchemaVersion,n.bundle="",n.bundleSource="DocumentSnapshot",n.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?n:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),n.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),n)}}Co._jsonSchemaVersion="firestore/documentSnapshot/1.0",Co._jsonSchema={type:vn("string",Co._jsonSchemaVersion),bundleSource:vn("string","DocumentSnapshot"),bundleName:vn("string"),bundle:vn("string")};class tf extends Co{data(e={}){return super.data(e)}}class Ul{constructor(e,n,r,i){this._firestore=e,this._userDataWriter=n,this._snapshot=i,this.metadata=new Su(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){const e=[];return this.forEach((n=>e.push(n))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,n){this._snapshot.docs.forEach((r=>{e.call(n,new tf(this._firestore,this._userDataWriter,r.key,r,new Su(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const n=!!e.includeMetadataChanges;if(n&&this._snapshot.excludesMetadataChanges)throw new Be(je.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===n||(this._cachedChanges=(function(i,o){if(i._snapshot.oldDocs.isEmpty()){let l=0;return i._snapshot.docChanges.map((d=>{const h=new tf(i._firestore,i._userDataWriter,d.doc.key,d.doc,new Su(i._snapshot.mutatedKeys.has(d.doc.key),i._snapshot.fromCache),i.query.converter);return d.doc,{type:"added",doc:h,oldIndex:-1,newIndex:l++}}))}{let l=i._snapshot.oldDocs;return i._snapshot.docChanges.filter((d=>o||d.type!==3)).map((d=>{const h=new tf(i._firestore,i._userDataWriter,d.doc.key,d.doc,new Su(i._snapshot.mutatedKeys.has(d.doc.key),i._snapshot.fromCache),i.query.converter);let m=-1,p=-1;return d.type!==0&&(m=l.indexOf(d.doc.key),l=l.delete(d.doc.key)),d.type!==1&&(l=l.add(d.doc),p=l.indexOf(d.doc.key)),{type:S6(d.type),doc:h,oldIndex:m,newIndex:p}}))}})(this,n),this._cachedChangesIncludeMetadataChanges=n),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new Be(je.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=Ul._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=r0.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const n=[],r=[],i=[];return this.docs.forEach((o=>{o._document!==null&&(n.push(o._document),r.push(this._userDataWriter.convertObjectMap(o._document.data.value.mapValue.fields,"previous")),i.push(o.ref.path))})),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function S6(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Ye(61501,{type:t})}}function C6(t){t=ds(t,cn);const e=ds(t.firestore,Po);return a6(im(e),t._key).then((n=>R6(e,t,n)))}Ul._jsonSchemaVersion="firestore/querySnapshot/1.0",Ul._jsonSchema={type:vn("string",Ul._jsonSchemaVersion),bundleSource:vn("string","QuerySnapshot"),bundleName:vn("string"),bundle:vn("string")};class gT extends w6{constructor(e){super(),this.firestore=e}convertBytes(e){return new Hr(e)}convertReference(e){const n=this.convertDocumentKey(e,this.firestore._databaseId);return new cn(this.firestore,null,n)}}function E6(t){t=ds(t,dc);const e=ds(t.firestore,Po),n=im(e),r=new gT(e);return _6(t._query),o6(n,t._query).then((i=>new Ul(e,r,t,i)))}function T6(t,e,n){t=ds(t,cn);const r=ds(t.firestore,Po),i=pT(t.converter,e,n);return um(r,[aT(om(r),"setDoc",t._key,i,t.converter!==null,n).toMutation(t._key,gr.none())])}function A6(t,e,n,...r){t=ds(t,cn);const i=ds(t.firestore,Po),o=om(i);let l;return l=typeof(e=xn(e))=="string"||e instanceof id?cT(o,"updateDoc",t._key,e,n,r):lT(o,"updateDoc",t._key,e),um(i,[l.toMutation(t._key,gr.exists(!0))])}function j6(t){return um(ds(t.firestore,Po),[new Jf(t._key,gr.none())])}function um(t,e){return(function(r,i){const o=new gi;return r.asyncQueue.enqueueAndForget((async()=>WN(await i6(r),i,o))),o.promise})(im(t),e)}function R6(t,e,n){const r=n.docs.get(e._key),i=new gT(t);return new Co(t,i,e._key,r,new Su(n.hasPendingWrites,n.fromCache),e.converter)}class I6{constructor(e,n){this._firestore=e,this._commitHandler=n,this._mutations=[],this._committed=!1,this._dataReader=om(e)}set(e,n,r){this._verifyNotCommitted();const i=Ug(e,this._firestore),o=pT(i.converter,n,r),l=aT(this._dataReader,"WriteBatch.set",i._key,o,i.converter!==null,r);return this._mutations.push(l.toMutation(i._key,gr.none())),this}update(e,n,r,...i){this._verifyNotCommitted();const o=Ug(e,this._firestore);let l;return l=typeof(n=xn(n))=="string"||n instanceof id?cT(this._dataReader,"WriteBatch.update",o._key,n,r,i):lT(this._dataReader,"WriteBatch.update",o._key,n),this._mutations.push(l.toMutation(o._key,gr.exists(!0))),this}delete(e){this._verifyNotCommitted();const n=Ug(e,this._firestore);return this._mutations=this._mutations.concat(new Jf(n._key,gr.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new Be(je.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Ug(t,e){if((t=xn(t)).firestore!==e)throw new Be(je.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}function Lu(...t){return new A0("arrayUnion",t)}function T1(...t){return new j0("arrayRemove",t)}function yT(t){return im(t=ds(t,Po)),new I6(t,(e=>um(t,e)))}(function(e,n=!0){(function(i){oc=i})(rc),Fl(new Ao("firestore",((r,{instanceIdentifier:i,options:o})=>{const l=r.getProvider("app").getImmediate(),d=new Po(new pO(r.getProvider("auth-internal")),new _O(l,r.getProvider("app-check-internal")),(function(m,p){if(!Object.prototype.hasOwnProperty.apply(m.options,["projectId"]))throw new Be(je.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new zu(m.options.projectId,p)})(l,i),l);return o={useFetchStreams:n,...o},d._setSettings(o),d}),"PUBLIC").setMultipleInstances(!0)),_a(jw,Rw,e),_a(jw,Rw,"esm2020")})();function Bo(){return u6(OC)}const Kt={showGroupTotals:!1};function Lo(t,e,n,r=1,i,o){let l=e;if(e.startsWith("budgets/"))l="budgets";else if(e.startsWith("months/")){const p=e.replace("months/","").split("_");if(p.length>=2){const g=p[p.length-1];l=`months/${p[p.length-2]}/${g}`}}console.log(`[Firebase] ${t}(${r}): ${l}${i===!1?" [NOT FOUND]":""}`)}async function jt(t,e,n){const r=hc(Bo(),t,e),i=`${t}/${e}`,o=await C6(r),l=o.exists(),d=l?o.data():null;return Lo("READ",i,n,1,l),{exists:l,data:d,ref:r}}async function On(t,e,n){const r=Bo(),i=c6(r,t);let o;if(n&&n.length>0){const m=n.map(p=>x6(p.field,p.op,p.value));o=v6(i,...m)}else o=i;const l=await E6(o),d=l.docs.map(m=>({id:m.id,data:m.data()}));let h=t;if(n&&n.length>0){const m=n.map(p=>`${p.field} ${p.op} ${JSON.stringify(p.value)}`).join(", ");h+=` WHERE ${m}`}return Lo("QUERY",h,e,l.docs.length,void 0),{docs:d}}async function qn(t,e,n,r,i){const o=hc(Bo(),t,e),l=`${t}/${e}`;return Lo("WRITE",l,r,1,void 0),T6(o,n,i??{})}async function dm(t,e){const r=Bo();for(let i=0;i<t.length;i+=500){const o=t.slice(i,i+500),l=yT(r);for(const{collectionPath:d,docId:h,data:m}of o){const p=hc(r,d,h);l.set(p,m)}Lo("BATCH_WRITE",`${o.length} docs`,e,o.length,void 0);try{await l.commit()}catch(d){throw console.error(`[Firebase] BATCH_WRITE ERROR in ${e}:`,d),console.error("[Firebase] Failed batch details:",{batchIndex:Math.floor(i/500)+1,totalBatches:Math.ceil(t.length/500),docsInBatch:o.length,firstDoc:o[0]?`${o[0].collectionPath}/${o[0].docId}`:"none"}),d}}}async function Tf(t,e,n,r){const i=hc(Bo(),t,e),o=`${t}/${e}`;return Lo("UPDATE",o,r,1,void 0),A6(i,n)}async function Iy(t,e,n){const r=hc(Bo(),t,e),i=`${t}/${e}`;return Lo("DELETE",i),j6(r)}async function _T(t,e,n){const i=Bo();for(let o=0;o<t.length;o+=500){const l=t.slice(o,o+500),d=yT(i);for(const{collectionPath:h,docId:m}of l){const p=hc(i,h,m);d.delete(p)}Lo("BATCH_DELETE",`${l.length} docs`,e,l.length),await d.commit(),n?.(o+l.length)}}const _o={mobile:640,tablet:768,wide:1200},k6=_o.mobile,Uu=["January","February","March","April","May","June","July","August","September","October","November","December"],Af=3,jf=3,Zt="ungrouped_accounts",ln="ungrouped_categories";function D6(t={}){const e={};return Object.entries(t).forEach(([n,r])=>{e[n]={nickname:r.nickname??"",description:r.description??"",balance:r.balance??0,account_group_id:r.account_group_id??Zt,sort_order:r.sort_order??0,is_income_account:r.is_income_account??!1,is_income_default:r.is_income_default??!1,is_outgo_account:r.is_outgo_account??!1,is_outgo_default:r.is_outgo_default??!1,on_budget:r.on_budget??!0,is_active:r.is_active??!0}}),e}function O6(t={}){const e={};return Object.entries(t).forEach(([n,r])=>{e[n]={name:r.name,sort_order:r.sort_order??0,expected_balance:r.expected_balance??"positive",on_budget:r.on_budget!==void 0?r.on_budget:null,is_active:r.is_active!==void 0?r.is_active:null}}),e[Zt]||(e[Zt]={name:"Ungrouped",sort_order:0,expected_balance:"positive",on_budget:null,is_active:null}),e}function M6(t={}){const e={};return Object.entries(t).forEach(([n,r])=>{e[n]={name:r.name,description:r.description,category_group_id:r.category_group_id??ln,sort_order:r.sort_order??0,default_monthly_amount:r.default_monthly_amount,default_monthly_type:r.default_monthly_type,balance:r.balance??0,is_hidden:r.is_hidden??!1}}),e}function N6(t=[]){const e=t.map(r=>({id:r.id,name:r.name,sort_order:r.sort_order??0}));return e.some(r=>r.id===ln)||e.push({id:ln,name:"Uncategorized",sort_order:0}),e.sort((r,i)=>r.sort_order-i.sort_order),e}function P6(t={}){const e={};return Object.entries(t).forEach(([n,r])=>{e[n]={needs_recalculation:r?.needs_recalculation??!1}}),e}async function M0(t){const{exists:e,data:n}=await jt("budgets",t,"loading budget data (cache miss or stale)");if(!e||!n)throw new Error(`Budget ${t} not found`);const r=D6(n.accounts),i=O6(n.account_groups),o=M6(n.categories),l=N6(n.category_groups),d=n.total_available??0,h=P6(n.month_map),m=n.is_needs_recalculation??!1;return{budget:{id:t,name:n.name,user_ids:n.user_ids||[],accepted_user_ids:n.accepted_user_ids||[],owner_id:n.owner_id||n.user_ids?.[0]||"",owner_email:n.owner_email||"",accounts:r,account_groups:i,categories:o,category_groups:l,total_available:d,is_needs_recalculation:m,month_map:h},accounts:r,accountGroups:i,categories:o,categoryGroups:l,isNeedsRecalculation:m,monthMap:h}}function z6(t,e){const{initialDataLoadComplete:n}=Xe(),r=!!t&&e?.enabled!==!1&&n;return Do({queryKey:t?ke.budget(t):["budget","none"],queryFn:()=>M0(t),enabled:r,staleTime:ac})}function fs(t,e,n){const r=n.toString().padStart(2,"0");return`${t}_${e}_${r}`}function Xl(t,e){return e===1?{year:t-1,month:12}:{year:t,month:e-1}}function bT(t,e){return e===12?{year:t+1,month:1}:{year:t,month:e+1}}function xt(t,e){return`${t}${e.toString().padStart(2,"0")}`}function ky(t){return new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit"})}function hm(t,e){const n=new Date,r=n.getFullYear(),i=n.getMonth()+1;if(t===r&&e===i){const o=n.getDate();return`${r}-${String(i).padStart(2,"0")}-${String(o).padStart(2,"0")}`}return`${t}-${String(e).padStart(2,"0")}-01`}function fm(t){const[e,n]=t.split("-").map(Number);return{year:e,month:n}}function Oe(t){return Math.round((t+Number.EPSILON)*100)/100}function dt(t){if(t==null||isNaN(t))return!1;const e=t*100;return Math.abs(e-Math.round(e))>1e-9}function ja(t){if(t==null)return t;if(Array.isArray(t))return t.map(e=>ja(e));if(typeof t=="object"){const e={};for(const[n,r]of Object.entries(t))r!==void 0&&(e[n]=ja(r));return e}return t}function B6(t,e,n,r){return{budget_id:e,year_month_ordinal:t.year_month_ordinal??xt(n,r),year:t.year??n,month:t.month??r,income:t.income||[],total_income:t.total_income??0,previous_month_income:t.previous_month_income??0,expenses:t.expenses||[],total_expenses:t.total_expenses??0,transfers:t.transfers||[],adjustments:t.adjustments||[],account_balances:t.account_balances||[],category_balances:t.category_balances||[],are_allocations_finalized:t.are_allocations_finalized??!1,created_at:t.created_at,updated_at:t.updated_at}}async function Qr(t,e,n,r){const i=fs(t,e,n);return(await Ue.fetchQuery({queryKey:ke.month(t,e,n),queryFn:async()=>{const{exists:l,data:d}=await jt("months",i,r?.description??`reading month ${e}/${n}`);return!l||!d?null:{month:B6(d,t,e,n)}},staleTime:ac}))?.month??null}async function L6(t,e,n){const r=xt(e,n);return(await On("months","getFutureMonths: querying months after specified month",[{field:"budget_id",op:"==",value:t},{field:"year_month_ordinal",op:">",value:r}])).docs.map(l=>({id:l.id,...l.data})).sort((l,d)=>l.year!==d.year?l.year-d.year:l.month-d.month)}function U6(t){const e={},n={};return t.category_balances&&t.category_balances.forEach(r=>{e[r.category_id]=r.end_balance}),t.account_balances&&t.account_balances.forEach(r=>{n[r.account_id]=r.end_balance}),{categoryEndBalances:e,accountEndBalances:n}}function F6(){const t=new Date,e=t.getFullYear(),n=t.getMonth()+1,r=[];for(let i=jf;i>0;i--){let o=e,l=n-i;for(;l<1;)l+=12,o-=1;r.push(xt(o,l))}r.push(xt(e,n));for(let i=1;i<=Af;i++){let o=e,l=n+i;for(;l>12;)l-=12,o+=1;r.push(xt(o,l))}return r}function V6(t,e){const n=ke.budget(t),r=Ue.getQueryData(n);if(!r?.monthMap)return!1;for(const[i,o]of Object.entries(r.monthMap))if(i>=e&&!o.needs_recalculation)return!1;return!0}function $6(t,e,n){const r=ke.budget(t),i=Ue.getQueryData(r);i&&Ue.setQueryData(r,{...i,isNeedsRecalculation:!0,monthMap:n,budget:{...i.budget,is_needs_recalculation:!0,month_map:n}})}function q6(t,e,n){const r=ke.budget(t),i=Ue.getQueryData(r);i&&Ue.setQueryData(r,{...i,monthMap:e,budget:{...i.budget,month_map:e}})}function H6(t,e,n,r){const i=xt(e,n),o=ke.budget(t),l=Ue.getQueryData(o);if(!l)return console.warn(`[removeMonthFromMap] Budget ${t} not found in cache`),{};const d=l.monthMap||{},{[i]:h,...m}=d,p=m;return Ue.setQueryData(o,{...l,monthMap:p,budget:{...l.budget,month_map:p}}),r&&r({type:"budget",budgetId:t}),p}async function G6(t,e,n,r){const{bypassDateLimit:i=!1}={},o=new Date,l=o.getFullYear(),d=o.getMonth()+1,h=(e-l)*12+(n-d);if(!i&&h>Af){const A=`[createMonth] Refusing to create month ${e}/${n} - it's ${h} months in the future (max allowed: ${Af}). This likely indicates a bug in month navigation.`;throw console.error(A),new Error(A)}if(!i&&h<-jf){const A=`[createMonth] Refusing to create month ${e}/${n} - it's ${Math.abs(h)} months in the past (max allowed: ${jf}). Existing months can still be viewed, but new months cannot be created this far back.`;throw console.error(A),new Error(A)}const{exists:m,data:p}=await jt("budgets",t,"validating budget exists before creating month");if(!m||!p){Ue.removeQueries({queryKey:ke.budget(t)});const A=`[createMonth] Budget ${t} does not exist. It may have been deleted. Please refresh the page.`;throw console.error(A),new Error(A)}const g=o.toISOString(),v=fs(t,e,n);let _=0,C={},x={};if(n>1||e>new Date().getFullYear()-10){const{year:A,month:N}=Xl(e,n),F=fs(t,A,N);try{const{exists:q,data:j}=await jt("months",F,"fetching previous month to create start balances for new month");if(q&&j){const P={budget_id:t,year_month_ordinal:j.year_month_ordinal??xt(A,N),year:j.year??A,month:j.month??N,income:j.income||[],total_income:j.total_income??0,previous_month_income:j.previous_month_income??0,expenses:j.expenses||[],total_expenses:j.total_expenses??0,transfers:j.transfers||[],adjustments:j.adjustments||[],account_balances:j.account_balances||[],category_balances:j.category_balances||[],are_allocations_finalized:j.are_allocations_finalized??!1,created_at:j.created_at,updated_at:j.updated_at};_=P.total_income;const{categoryEndBalances:O,accountEndBalances:X}=U6(P);C=O,x=X}}catch(q){if(q instanceof Error&&q.message.includes("Missing or insufficient permissions"))console.warn(`[createMonth] Permission error reading previous month ${A}/${N}, starting with zero balances`);else throw q}}const S=Object.entries(C).map(([A,N])=>({category_id:A,start_balance:N,allocated:0,spent:0,transfers:0,adjustments:0,end_balance:N})),E=Object.entries(x).map(([A,N])=>({account_id:A,start_balance:N,income:0,expenses:0,transfers:0,adjustments:0,net_change:0,end_balance:N})),T={budget_id:t,year_month_ordinal:xt(e,n),year:e,month:n,income:[],total_income:0,previous_month_income:_,expenses:[],total_expenses:0,transfers:[],adjustments:[],account_balances:E,category_balances:S,are_allocations_finalized:!1,created_at:g,updated_at:g},I={budget_id:t,year_month_ordinal:xt(e,n),year:e,month:n,income:[],total_income:0,previous_month_income:_,expenses:[],total_expenses:0,transfers:[],adjustments:[],account_balances:E,category_balances:S,are_allocations_finalized:!1,created_at:g,updated_at:g};await qn("months",v,I,"creating new month document (first time viewing this month)"),Ue.setQueryData(ke.month(t,e,n),{month:T});const M=xt(e,n),$={...p.month_map||{},[M]:{needs_recalculation:!1}},k=$;return q6(t,k),await Tf("budgets",t,{month_map:k,updated_at:g},`adding month ${e}/${n} to budget month_map`),T}function Q6(t,e,n,r){return{budget_id:e,year_month_ordinal:t.year_month_ordinal??xt(n,r),year:t.year??n,month:t.month??r,income:t.income||[],total_income:t.total_income??0,previous_month_income:t.previous_month_income??0,expenses:t.expenses||[],total_expenses:t.total_expenses??0,transfers:t.transfers||[],adjustments:t.adjustments||[],account_balances:t.account_balances||[],category_balances:t.category_balances||[],are_allocations_finalized:t.are_allocations_finalized??!1,created_at:t.created_at,updated_at:t.updated_at}}async function N0(t,e,n){const r=fs(t,e,n);try{const{exists:i,data:o}=await jt("months",r,`loading month ${e}/${n}`);return!i||!o?null:Q6(o,t,e,n)}catch(i){if(i instanceof Error&&i.message.includes("Missing or insufficient permissions"))return console.warn(`[readMonthDirect] Permission error reading month ${e}/${n}, treating as not found`),null;throw i}}async function W6(t,e,n,r){const i=await N0(t,e,n);if(i)return i;let o=!1;if(r){const l=r.getQueryData(ke.budget(t));l?.monthMap&&(o=xt(e,n)in l.monthMap)}else{const{exists:l,data:d}=await jt("budgets",t,"checking month_map before creating month");if(l&&d?.month_map){const h=xt(e,n),m=d.month_map;o=h in m}}if(o)return G6(t,e,n);throw new Error(`Month ${e}/${n} does not exist in budget. Cannot create months that are not in month_map.`)}function K6(t,e,n,r){const i=Vt(),{initialDataLoadComplete:o}=Xe(),l=t?ke.month(t,e,n):["month","none"],d=!!t&&r?.enabled!==!1&&o;return Do({queryKey:l,queryFn:async()=>({month:await W6(t,e,n,i)}),enabled:d,staleTime:ac})}async function P0(t){const{exists:e,data:n}=await jt("payees",t,"loading payees for autocomplete (cache miss or stale)");return e&&n?n.payees||[]:[]}function z0(t,e){const{initialDataLoadComplete:n}=Xe(),r=!!t&&e?.enabled!==!1&&n;return Do({queryKey:t?ke.payees(t):["payees","none"],queryFn:()=>P0(t),enabled:r,staleTime:ac})}async function Y6(t,e){const{exists:n,data:r}=await jt("users",t,"loading user profile (cache miss or stale)");if(n&&r)return r;const i={uid:t,email:e,budget_ids:[],created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return await qn("users",t,i,"creating new user document (first login)"),i}function X6(t,e,n){return Do({queryKey:t?ke.user(t):["user","none"],queryFn:()=>Y6(t,e),enabled:!!t&&n?.enabled!==!1})}async function Z6(t,e){const n=await On("budgets","loading budgets user has access to (cache miss or stale)",[{field:"user_ids",op:"array-contains",value:t}]),r=[],i=[];for(const o of n.docs){const l=o.data;l.accepted_user_ids?.includes(t)||e?.budget_ids?.includes(o.id)?r.push({id:o.id,name:l.name||"Unnamed Budget",ownerEmail:l.owner_email||null,isOwner:l.owner_id===t,isPending:!1}):i.push({budgetId:o.id,budgetName:l.name||"Unnamed Budget",ownerEmail:l.owner_email||null})}return{budgets:r,pendingInvites:i}}function J6(t,e,n){return Do({queryKey:t?ke.accessibleBudgets(t):["accessibleBudgets","none"],queryFn:async()=>t?Z6(t,e):{budgets:[],pendingInvites:[]},enabled:!!t&&n?.enabled!==!1,staleTime:60*1e3})}function e4(t){if(Array.isArray(t))return t;if(t&&typeof t=="object"&&!Array.isArray(t)){const e=t;if(e._methodName==="arrayUnion"&&Array.isArray(e.vc))return console.warn("[fetchFeedback] Found corrupted arrayUnion in feedback document - extracting items from vc"),e.vc}return[]}async function t4(){const t=await On("feedback","admin loading all feedback (cache miss or stale)"),e=[];for(const n of t.docs){const r=e4(n.data.items),i=n.data.user_email||n.id;r.forEach(o=>{e.push({...o,doc_id:n.id,user_email:i})})}return{items:e}}function n4(t){return Do({queryKey:ke.feedback(),queryFn:t4,enabled:t?.enabled!==!1})}const Yt="__NO_CATEGORY__",ko="No Category";function at(t){return t===Yt}const Ht="__NO_ACCOUNT__",Ra="No Account";function et(t){return t===Ht}const B0={categoryEndBalances:{},accountEndBalances:{},totalIncome:0};function L0(t,e){const n=t.income||[],r=t.expenses||[],i=Oe(n.reduce((g,v)=>g+v.amount,0)),o=Oe(r.reduce((g,v)=>g+v.amount,0)),l=r4(t),{transfersMap:d,adjustmentsMap:h}=s4(t),m=i4(t.category_balances,e.categoryEndBalances,l,d,h),p=a4(t,e.accountEndBalances);return{...t,total_income:i,total_expenses:o,previous_month_income:e.totalIncome,category_balances:m,account_balances:p,updated_at:new Date().toISOString()}}function r4(t){const e={};for(const n of t.transfers||[])at(n.from_category_id)||(e[n.from_category_id]=(e[n.from_category_id]||0)-n.amount),at(n.to_category_id)||(e[n.to_category_id]=(e[n.to_category_id]||0)+n.amount);for(const n of t.adjustments||[])at(n.category_id)||(e[n.category_id]=(e[n.category_id]||0)+n.amount);for(const n of Object.keys(e))e[n]=Oe(e[n]);return e}function s4(t){const e={},n={};for(const r of t.transfers||[])at(r.from_category_id)||(e[r.from_category_id]=(e[r.from_category_id]||0)-r.amount),at(r.to_category_id)||(e[r.to_category_id]=(e[r.to_category_id]||0)+r.amount);for(const r of t.adjustments||[])at(r.category_id)||(n[r.category_id]=(n[r.category_id]||0)+r.amount);for(const r of Object.keys(e))e[r]=Oe(e[r]);for(const r of Object.keys(n))n[r]=Oe(n[r]);return{transfersMap:e,adjustmentsMap:n}}function i4(t,e,n,r,i){const o=new Map;for(const h of t)at(h.category_id)||o.set(h.category_id,h);const l=new Set;for(const h of t)at(h.category_id)||l.add(h.category_id);for(const h of Object.keys(e))at(h)||l.add(h);for(const h of Object.keys(n))at(h)||l.add(h);const d=[];for(const h of l){const m=o.get(h),p=Oe(e[h]??0),g=Oe(m?.allocated??0),v=Oe(m?.spent??0),_=Oe(r[h]??0),C=Oe(i[h]??0);d.push({category_id:h,start_balance:p,allocated:g,spent:v,transfers:_,adjustments:C,end_balance:Oe(p+g+v+_+C)})}return d}function a4(t,e){const n=new Set;for(const i of t.income||[])et(i.account_id)||n.add(i.account_id);for(const i of t.expenses||[])et(i.account_id)||n.add(i.account_id);for(const i of t.transfers||[])et(i.from_account_id)||n.add(i.from_account_id),et(i.to_account_id)||n.add(i.to_account_id);for(const i of t.adjustments||[])et(i.account_id)||n.add(i.account_id);for(const i of Object.keys(e))et(i)||n.add(i);for(const i of t.account_balances||[])et(i.account_id)||n.add(i.account_id);const r=[];for(const i of n){const o=Oe(e[i]??0),l=Oe((t.income||[]).filter(_=>_.account_id===i).reduce((_,C)=>_+C.amount,0)),d=Oe((t.expenses||[]).filter(_=>_.account_id===i).reduce((_,C)=>_+C.amount,0)),h=Oe((t.transfers||[]).filter(_=>_.from_account_id===i).reduce((_,C)=>_-C.amount,0)),m=Oe((t.transfers||[]).filter(_=>_.to_account_id===i).reduce((_,C)=>_+C.amount,0)),p=Oe(m+h),g=Oe((t.adjustments||[]).filter(_=>_.account_id===i).reduce((_,C)=>_+C.amount,0)),v=Oe(l+d+p+g);r.push({account_id:i,start_balance:o,income:l,expenses:d,transfers:p,adjustments:g,net_change:v,end_balance:Oe(o+v)})}return r}function Fu(t){const e={},n={};for(const r of t.category_balances||[])at(r.category_id)||(e[r.category_id]=Oe(r.end_balance));for(const r of t.account_balances||[])et(r.account_id)||(n[r.account_id]=Oe(r.end_balance));return{categoryEndBalances:e,accountEndBalances:n,totalIncome:Oe(t.total_income)}}const o4=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function l4(t){return{year:parseInt(t.slice(0,4),10),month:parseInt(t.slice(4,6),10)}}function vT(t={}){const e={};return Object.entries(t).forEach(([n,r])=>{e[n]={needs_recalculation:r?.needs_recalculation??!1}}),e}function xT(t){return Object.entries(t).filter(([,e])=>e.needs_recalculation).map(([e])=>e).sort()}function c4(t){return Object.keys(t).sort()}async function u4(t,e){const{year:n,month:r}=l4(e),i=fs(t,n,r),{exists:o,data:l}=await jt("months",i,`[recalc] fetching month ${n}/${r}`);return!o||!l?null:{id:i,budget_id:t,year_month_ordinal:l.year_month_ordinal??xt(n,r),year:l.year??n,month:l.month??r,income:l.income||[],total_income:l.total_income??0,previous_month_income:l.previous_month_income??0,expenses:l.expenses||[],total_expenses:l.total_expenses??0,transfers:l.transfers||[],adjustments:l.adjustments||[],account_balances:l.account_balances||[],category_balances:l.category_balances||[],are_allocations_finalized:l.are_allocations_finalized??!1,created_at:l.created_at,updated_at:l.updated_at}}async function d4(t,e,n){n?.(0,e.length);const r=await Promise.all(e.map(i=>u4(t,i)));return n?.(e.length,e.length),r.filter(i=>i!==null)}function U0(t){const e={};for(const n of Object.keys(t))e[n]={needs_recalculation:!1};return e}function F0(t,e,n){const r=Object.entries(t).reduce((o,[,l])=>{const d=l.account_group_id?n[l.account_group_id]:void 0,h=d&&d.on_budget!==null?d.on_budget:l.on_budget!==!1,m=d&&d.is_active!==null?d.is_active:l.is_active!==!1;return h&&m?o+(l.balance??0):o},0),i=Object.values(e).reduce((o,l)=>{const d=l.balance??0;return o+(d>0?d:0)},0);return Oe(r-i)}async function wT(t,e,n,r){const{exists:i,data:o}=await jt("budgets",t,"[recalc] reading budget for balance update");if(!i||!o)return;const l={...o.accounts};for(const[p,g]of Object.entries(e))l[p]&&(l[p]={...l[p],balance:Oe(g)});const d={...o.categories};for(const[p,g]of Object.entries(n))d[p]&&(d[p]={...d[p],balance:Oe(g)});const h=U0(r),m=F0(l,d,o.account_groups||{});await qn("budgets",t,{...o,accounts:l,categories:d,total_available:m,is_needs_recalculation:!1,month_map:h,updated_at:new Date().toISOString()},"[recalc] saving balances and clearing flags"),f4(t,l,d,m,h)}function h4(t,e){const n=Ue.getQueryData(ke.budget(t));n&&Ue.setQueryData(ke.budget(t),{...n,isNeedsRecalculation:!1,monthMap:e,budget:{...n.budget,is_needs_recalculation:!1,month_map:e}})}function f4(t,e,n,r,i){const o=Ue.getQueryData(ke.budget(t));if(o){const l={};for(const[h,m]of Object.entries(o.accounts)){const p=e[h];l[h]=p?{...m,balance:p.balance??m.balance}:m}const d={};for(const[h,m]of Object.entries(o.categories)){const p=n[h];d[h]=p?{...m,balance:p.balance??m.balance}:m}Ue.setQueryData(ke.budget(t),{...o,accounts:l,categories:d,isNeedsRecalculation:!1,monthMap:i,budget:{...o.budget,accounts:e,categories:n,total_available:r,is_needs_recalculation:!1,month_map:i}})}}async function A1(t,e){const{exists:n,data:r}=await jt("budgets",t,"[recalc] reading budget to clear flags");if(!n||!r)return;const i=U0(e);await qn("budgets",t,{...r,total_available:F0(r.accounts||{},r.categories||{},r.account_groups||{}),is_needs_recalculation:!1,month_map:i,updated_at:new Date().toISOString()},"[recalc] clearing flags"),h4(t,i)}const Fg=new Map;async function m4(t,e={}){const n=Fg.get(t);if(n)return n;const r=p4(t,e);Fg.set(t,r);try{return await r}finally{Fg.delete(t)}}async function p4(t,e={}){const{onProgress:n}=e;n?.({phase:"reading-budget",monthsProcessed:0,totalMonths:0,percentComplete:5});const{exists:r,data:i}=await jt("budgets",t,"[recalc] reading budget for month_map");if(!r||!i)return n?.({phase:"complete",monthsProcessed:0,totalMonths:0,percentComplete:100}),{monthsRecalculated:0,budgetUpdated:!1};const o=vT(i.month_map),l=xT(o);if(l.length===0&&!i.is_needs_recalculation)return n?.({phase:"complete",monthsProcessed:0,totalMonths:0,percentComplete:100}),{monthsRecalculated:0,budgetUpdated:!1};const d=c4(o),h=l.length>0?l[0]:null;if(!h)return await A1(t,o),n?.({phase:"complete",monthsProcessed:0,totalMonths:0,percentComplete:100}),{monthsRecalculated:0,budgetUpdated:!0};const m=d.indexOf(h),p=m>0,g=p?d.slice(m-1):d.slice(m),v=p?g.length-1:g.length;n?.({phase:"fetching-months",monthsFetched:0,totalMonthsToFetch:g.length,monthsProcessed:0,totalMonths:v,percentComplete:10});const _=await d4(t,g,(k,A)=>{n?.({phase:"fetching-months",monthsFetched:k,totalMonthsToFetch:A,monthsProcessed:0,totalMonths:v,percentComplete:k===0?10:30})});if(_.length===0)return await A1(t,o),n?.({phase:"complete",monthsProcessed:0,totalMonths:0,percentComplete:100}),{monthsRecalculated:0,budgetUpdated:!0};const C=p?1:0,x=_.length-1,S=x-C+1;let E=B0;p&&_.length>0&&(E=Fu(_[0]));const T=[];let I=0;for(let k=C;k<=x;k++){const A=_[k],N=`${o4[A.month-1]} ${A.year}`;n?.({phase:"recalculating",currentMonth:N,monthsProcessed:I,totalMonths:S,percentComplete:Math.round(30+I/S*40)});const F=L0(A,E);T.push(F),E=Fu(F),I++}n?.({phase:"saving",monthsProcessed:I,totalMonths:S,percentComplete:75});const M=T.map(k=>({collectionPath:"months",docId:fs(t,k.year,k.month),data:k}));await dm(M,`[recalc] batch write ${T.length} months`);for(const k of T)Ue.setQueryData(ke.month(t,k.year,k.month),{month:k});n?.({phase:"saving",monthsProcessed:I,totalMonths:S,percentComplete:92});const L=E.accountEndBalances,$=E.categoryEndBalances;return await wT(t,L,$,o),n?.({phase:"complete",monthsProcessed:I,totalMonths:S,percentComplete:100}),{monthsRecalculated:I,budgetUpdated:!0,finalAccountBalances:L}}async function g4(t,e,n){const r=xt(e,n);if(V6(t,r))return{markedCount:0,budgetUpdated:!1};const{exists:i,data:o}=await jt("budgets",t,"reading budget for month_map update");if(!i||!o)return console.warn(`[markMonthsNeedRecalculation] Budget ${t} not found`),{markedCount:0,budgetUpdated:!1};const d={...o.month_map||{}},h=F6();for(const v of h)d[v]||(d[v]={needs_recalculation:!1});let m=0;for(const v of h)v>=r&&(d[v]?.needs_recalculation||(d[v]={needs_recalculation:!0},m++));const p=o.is_needs_recalculation===!0;if(m===0&&p)return{markedCount:0,budgetUpdated:!1};const g=d;return $6(t,r,g),await Tf("budgets",t,{is_needs_recalculation:!0,month_map:g,updated_at:new Date().toISOString()},`marking budget and ${m} future months as needing recalculation`),{markedCount:m,budgetUpdated:!0}}async function y4(t,e){return Ue.fetchQuery({queryKey:["budgetInvite",t,e],queryFn:async()=>{const{exists:n,data:r}=await jt("budgets",t,"checking if user has pending invite for budget");return!n||!r?null:{isInvited:r.user_ids?.includes(e)??!1,hasAccepted:r.accepted_user_ids?.includes(e)??!1,budgetName:r.name||"Unnamed Budget",ownerEmail:r.owner_email||null}},staleTime:60*1e3})}async function Dy(t,e,n){const r=await Qr(t,e,n,{description:`fetching month for balance calculation (walking ${e}/${n})`});return r?{year:r.year,month:r.month,category_balances:r.category_balances,are_allocations_finalized:r.are_allocations_finalized,expenses:r.expenses}:null}async function _4(t,e,n,r){const i={};e.forEach(v=>{i[v]=0});const o=await Dy(t,n,r);if(o?.category_balances){for(const v of o.category_balances)e.includes(v.category_id)&&(i[v.category_id]=v.end_balance);return i}const l={};e.forEach(v=>{l[v]=0});const d=[];o&&d.push(o);let h=n,m=r,p=!1;const g=120;for(let v=0;v<g&&!p;v++){const _=Xl(h,m);h=_.year,m=_.month;const C=await Dy(t,h,m);if(!C)p=!0;else if(C.category_balances){p=!0;for(const x of C.category_balances)e.includes(x.category_id)&&(l[x.category_id]=x.end_balance)}else d.push(C)}d.reverse(),Object.assign(i,l);for(const v of d){if(v.are_allocations_finalized&&v.category_balances)for(const _ of v.category_balances)e.includes(_.category_id)&&(i[_.category_id]=(i[_.category_id]||0)+_.allocated);if(v.expenses)for(const _ of v.expenses)e.includes(_.category_id)&&(i[_.category_id]=(i[_.category_id]||0)-_.amount)}return i}async function b4(t,e,n,r,i){const o={...n};let l=r,d=i;const h=24;for(let m=0;m<h;m++){const p=bT(l,d);l=p.year,d=p.month;const g=await Dy(t,l,d);if(!g)break;if(g.are_allocations_finalized&&g.category_balances)for(const v of g.category_balances)e.includes(v.category_id)&&(o[v.category_id]=(o[v.category_id]||0)+v.allocated);if(g.expenses)for(const v of g.expenses)e.includes(v.category_id)&&(o[v.category_id]=(o[v.category_id]||0)-v.amount)}return o}async function Vg(t,e,n,r){const i=await _4(t,e,n,r),o=await b4(t,e,i,n,r);return{current:i,total:o}}async function ST(t,e,n){const r=fs(t,e.year,e.month);await qn("months",r,e,`writeMonthData: ${n}`)}async function CT(t,e,n){await g4(t,e,n)}async function ET(t){const{budgetId:e,month:n,description:r,cascadeRecalculation:i=!0}=t;await ST(e,n,r||`${n.year}/${n.month}`),Ue.setQueryData(ke.month(e,n.year,n.month),{month:n}),i&&await CT(e,n.year,n.month)}function v4(){const t=Vt();return{writeData:Hn({mutationFn:async({budgetId:n,month:r,description:i,cascadeRecalculation:o=!0})=>(await ST(n,r,i||`${r.year}/${r.month}`),{budgetId:n,year:r.year,month:r.month,cascadeRecalculation:o}),onMutate:async({budgetId:n,month:r})=>{const i=ke.month(n,r.year,r.month);await t.cancelQueries({queryKey:i});const o=t.getQueryData(i);return t.setQueryData(i,{month:r}),{oldMonthQueryData:o,monthKey:i}},onSuccess:async({budgetId:n,year:r,month:i,cascadeRecalculation:o})=>{o&&await CT(n,r,i)},onError:(n,r,i)=>{i?.oldMonthQueryData&&t.setQueryData(i.monthKey,i.oldMonthQueryData)}})}}function x4(t,e,n,r){const i={};t.category_balances&&t.category_balances.forEach(h=>{i[h.category_id]=h});const o=t.expenses??[],l={};for(const h of t.transfers||[])at(h.from_category_id)||(l[h.from_category_id]=(l[h.from_category_id]||0)-h.amount),at(h.to_category_id)||(l[h.to_category_id]=(l[h.to_category_id]||0)+h.amount);const d={};for(const h of t.adjustments||[])at(h.category_id)||(d[h.category_id]=(d[h.category_id]||0)+h.amount);return e.map(h=>{const m=i[h],p=Oe(m?.start_balance??0),g=Oe(n[h]??0),v=Oe(o.filter(x=>x.category_id===h).reduce((x,S)=>x+S.amount,0)),_=Oe(l[h]??0),C=Oe(d[h]??0);return{category_id:h,start_balance:p,allocated:g,spent:v,transfers:_,adjustments:C,end_balance:Oe(p+g+v+_+C)}})}function w4(){const{writeData:t}=v4();return{saveDraftAllocations:async(n,r,i,o)=>{const l=await Qr(n,r,i);if(!l)throw new Error(`Month not found: ${r}/${i}`);const d=l.category_balances.map(m=>({...m,allocated:o[m.category_id]??m.allocated})),h={...l,category_balances:d,updated_at:new Date().toISOString()};return await t.mutateAsync({budgetId:n,month:h,cascadeRecalculation:!1}),{updatedMonth:h}},isPending:t.isPending,isError:t.isError,error:t.error}}const me={primary:"#646cff",error:"#f87171",errorBg:"rgba(220, 38, 38, 0.1)",errorBorder:"rgba(220, 38, 38, 0.3)",success:"#4ade80",danger:"#f87171",warning:"#facc15",debt:"#fb923c",zero:"rgba(255, 255, 255, 0.4)"},ls={textDecoration:"underline",textDecorationStyle:"dotted",textUnderlineOffset:"3px"},Ia="1px solid color-mix(in srgb, currentColor 20%, transparent)",Rf={maxWidth:"var(--page-max-width, 85rem)",margin:"0 auto",padding:"var(--page-padding, 2rem)"},V0={background:"color-mix(in srgb, currentColor 8%, transparent)",padding:"1rem 1.25rem",borderRadius:"8px",display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem"},S4={background:"color-mix(in srgb, currentColor 8%, transparent)",padding:"1.25rem",borderRadius:"8px",display:"flex",flexDirection:"column",gap:"1rem"},C4={display:"flex",flexDirection:"column",gap:"0.5rem"},E4={fontSize:"0.9rem",fontWeight:500},Pa={padding:"0.6rem 0.8rem",borderRadius:"6px",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"1rem",color:"inherit",width:"100%",boxSizing:"border-box"},T4={...Pa,cursor:"pointer"},$0={padding:"0.6rem 1.25rem",borderRadius:"6px",cursor:"pointer",fontWeight:500,fontSize:"0.9rem",transition:"opacity 0.15s"},TT={...$0,background:me.primary,color:"white",border:"none"},A4={...TT,padding:"0.75rem 1.5rem",borderRadius:"8px"},j4={...$0,background:"transparent",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)"},R4={...$0,background:"transparent",border:`1px solid ${me.errorBorder}`,color:me.error},I4={background:"transparent",border:"1px solid color-mix(in srgb, currentColor 25%, transparent)",padding:"0.35rem 0.75rem",borderRadius:"6px",cursor:"pointer",fontSize:"0.8rem",opacity:.8,transition:"opacity 0.15s"},ha={background:"transparent",border:"1px solid color-mix(in srgb, currentColor 15%, transparent)",padding:"0.25rem 0.35rem",borderRadius:"4px",cursor:"pointer",fontSize:"0.75rem",lineHeight:1,display:"flex",alignItems:"center",justifyContent:"center",opacity:.6,transition:"opacity 0.15s, background 0.15s"},If={display:"flex",flexDirection:"column",gap:"2px"},k4={display:"flex",gap:"0.75rem",marginTop:"0.5rem"},D4={opacity:.4,cursor:"grab"},O4={position:"absolute",top:"-4px",left:0,right:0,height:"3px",background:me.primary,borderRadius:"2px",transition:"opacity 0.15s"},M4={position:"relative",height:"2rem",marginTop:"-0.25rem"},N4={position:"absolute",top:"50%",left:0,right:0,height:"3px",background:me.primary,borderRadius:"2px",transition:"opacity 0.15s"},P4={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"0.75rem",opacity:.7,background:"var(--background, #1a1a1a)",padding:"0 0.5rem",whiteSpace:"nowrap"},z4={background:me.errorBg,border:`1px solid ${me.errorBorder}`,color:me.error,padding:"0.75rem 1rem",borderRadius:"8px",marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem"},B4={background:"transparent",border:"none",color:me.error,cursor:"pointer",fontSize:"1.2rem",padding:"0 0.25rem",lineHeight:1},AT={opacity:.7,marginBottom:"1.5rem"},j1={display:"flex",flexDirection:"column",gap:"0.5rem",marginBottom:"1.5rem"};function mm({message:t,children:e,onDismiss:n,style:r}){return u.jsxs("div",{style:{...z4,...r},children:[u.jsx("span",{children:e??t}),n&&u.jsx("button",{onClick:n,style:B4,children:""})]})}const L4={primary:TT,"primary-large":A4,secondary:j4,danger:R4,small:I4},U4={position:"absolute",bottom:"100%",left:"50%",transform:"translateX(-50%)",background:me.warning,color:"#1a1a1a",padding:"0.5rem 0.75rem",borderRadius:"6px",fontSize:"0.8rem",fontWeight:500,whiteSpace:"nowrap",marginBottom:"0.5rem",zIndex:100,boxShadow:"0 2px 8px rgba(0,0,0,0.3)",animation:"tooltipFadeIn 0.15s ease-out"},F4={position:"absolute",top:"100%",left:"50%",transform:"translateX(-50%)",width:0,height:0,borderLeft:"6px solid transparent",borderRight:"6px solid transparent",borderTop:`6px solid ${me.warning}`};function Ve({variant:t="primary",isLoading:e,loadingText:n="Saving...",children:r,disabled:i,style:o,actionName:l,disabledReason:d,onClick:h,...m}){const p=L4[t],g=i||e,[v,_]=D.useState(!1);function C(E){h?.(E)}function x(E){g&&d&&(E.preventDefault(),E.stopPropagation(),_(!0),setTimeout(()=>_(!1),3e3))}const S=g?{cursor:"not-allowed",opacity:.35,filter:"grayscale(50%)"}:{};return u.jsxs("div",{style:{position:"relative",display:"inline-block"},onClick:x,children:[v&&d&&u.jsxs("div",{style:U4,children:[d,u.jsx("div",{style:F4})]}),u.jsx("button",{disabled:g,style:{...p,cursor:g?"not-allowed":"pointer",...S,...o},onClick:C,...m,children:e?n:r})]})}function jT(t,e){const n=t.toLowerCase(),r=e.toLowerCase();if(r.includes(n)){const d=r.indexOf(n);return{match:!0,score:d===0||/\s/.test(r[d-1])?100:90}}let i=0,o=0,l=0;for(let d=0;d<r.length&&i<n.length;d++)r[d]===n[i]?(i++,l++,o+=l*2):l=0;return i===n.length?{match:!0,score:o}:{match:!1,score:0}}function RT(t){return[...t].sort((e,n)=>!e.groupId&&n.groupId?1:e.groupId&&!n.groupId?-1:!e.groupId&&!n.groupId?e.sortOrder-n.sortOrder:e.groupSortOrder!==n.groupSortOrder?e.groupSortOrder-n.groupSortOrder:e.sortOrder-n.sortOrder)}function IT(t){const e=RT(t),n=[];let r="__initial__";return e.forEach(i=>{i.groupId!==r&&(r=i.groupId,n.push({groupId:i.groupId,groupName:i.groupName,groupSortOrder:i.groupSortOrder,items:[]})),n[n.length-1].items.push(i)}),n}function kT(t,e,n){return e.trim()?t.map(i=>{const o=n(i);let l=0,d=!1;for(const h of o){const m=jT(e,h);m.match&&(d=!0,l=Math.max(l,m.score))}return{item:i,score:l,hasMatch:d}}).filter(({hasMatch:i})=>i).sort((i,o)=>o.score!==i.score?o.score-i.score:!i.item.groupId&&o.item.groupId?1:i.item.groupId&&!o.item.groupId?-1:i.item.groupSortOrder!==o.item.groupSortOrder?i.item.groupSortOrder-o.item.groupSortOrder:i.item.sortOrder-o.item.sortOrder).map(({item:i})=>i):RT(t)}const q0={position:"absolute",top:"100%",left:0,right:0,marginTop:"4px",background:"var(--background, #1a1a1a)",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",borderRadius:"6px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",zIndex:1e3},Vu={padding:"0.6rem 0.8rem",cursor:"pointer",transition:"background 0.1s"};function R1({id:t,value:e,onChange:n,payees:r,placeholder:i="Enter payee name",autoFocus:o}){const[l,d]=D.useState(!1),[h,m]=D.useState(-1),p=D.useRef(null),g=D.useRef(null),v=e.trim()?r.map(x=>({payee:x,...jT(e,x)})).filter(x=>x.match).sort((x,S)=>S.score-x.score).slice(0,8).map(x=>x.payee):[];D.useEffect(()=>{function x(S){p.current&&!p.current.contains(S.target)&&d(!1)}return document.addEventListener("mousedown",x),()=>document.removeEventListener("mousedown",x)},[]);function _(x){!l||v.length===0||(x.key==="ArrowDown"?(x.preventDefault(),m(S=>Math.min(S+1,v.length-1))):x.key==="ArrowUp"?(x.preventDefault(),m(S=>Math.max(S-1,-1))):x.key==="Enter"&&h>=0?(x.preventDefault(),n(v[h]),d(!1),m(-1)):x.key==="Escape"&&(d(!1),m(-1)))}function C(x){n(x),d(!1),m(-1),g.current?.focus()}return u.jsxs("div",{ref:p,style:{position:"relative"},children:[u.jsx("input",{ref:g,id:t,type:"text",value:e,onChange:x=>{n(x.target.value),d(!0),m(-1)},onFocus:()=>d(!0),onKeyDown:_,placeholder:i,autoComplete:"off",autoFocus:o,style:Pa}),l&&v.length>0&&u.jsx("div",{style:{...q0,maxHeight:"200px",overflowY:"auto"},children:v.map((x,S)=>u.jsx("div",{onClick:()=>C(x),style:{...Vu,background:S===h?`color-mix(in srgb, ${me.primary} 20%, transparent)`:"transparent",borderBottom:S<v.length-1?"1px solid color-mix(in srgb, currentColor 10%, transparent)":"none"},onMouseEnter:()=>m(S),children:x},x))})]})}function DT({id:t,value:e,onChange:n,categories:r,categoryGroups:i,placeholder:o="Search categories...",required:l,showNoCategoryOption:d=!1,showHiddenCategories:h=!1}){const m=Object.fromEntries(i.map(H=>[H.id,H.name])),p=Object.fromEntries(i.map(H=>[H.id,H.sort_order])),g=h?r:Object.fromEntries(Object.entries(r).filter(([,H])=>!H.is_hidden)),v=Object.entries(g).map(([H,Z])=>({id:H,name:Z.name,groupId:Z.category_group_id,groupName:Z.category_group_id&&m[Z.category_group_id]||null,sortOrder:Z.sort_order,groupSortOrder:Z.category_group_id?p[Z.category_group_id]??999:999})),_=e===Yt,C=_?null:e?r[e]:null,x=_?"":C?.name||"",[S,E]=D.useState(x),[T,I]=D.useState(!1),[M,L]=D.useState(-1),$=D.useRef(null),k=D.useRef(null);D.useEffect(()=>{if(e===Yt)E("");else if(e){const H=r[e];E(H?.name||"")}},[e,r]);const A=kT(v,S,H=>[H.name]),N=IT(A);D.useEffect(()=>{function H(Z){if($.current&&!$.current.contains(Z.target))if(I(!1),e===Yt)E("");else{const Y=e?r[e]:null;E(Y?.name||"")}}return document.addEventListener("mousedown",H),()=>document.removeEventListener("mousedown",H)},[e,r]);function F(H){if(H.key==="ArrowDown")H.preventDefault(),T?L(Z=>Math.min(Z+1,A.length-1)):(I(!0),L(0));else if(H.key==="ArrowUp")H.preventDefault(),L(Z=>Math.max(Z-1,0));else if(H.key==="Enter")H.preventDefault(),T&&M>=0&&A[M]&&q(A[M]);else if(H.key==="Escape")if(I(!1),L(-1),e===Yt)E("");else{const Z=e?r[e]:null;E(Z?.name||"")}else if(H.key==="Tab")if(T&&M>=0&&A[M])q(A[M]);else if(I(!1),L(-1),e===Yt)E("");else{const Z=e?r[e]:null;E(Z?.name||"")}}function q(H){n(H.id),E(H.id===Yt?"":H.name),I(!1),L(-1)}function j(){n(Yt),E(""),I(!1),L(-1)}function P(H){const Z=H.target.value;E(Z),I(!0),L(Z.trim()?0:-1),Z!==x&&(d&&Z.trim()===""?n(Yt):n(""))}function O(){I(!0),d&&(e===Yt||S.trim()==="")?L(-1):A.length>0&&L(0)}let X=-1;const W=()=>++X;return u.jsxs("div",{ref:$,style:{position:"relative"},children:[u.jsx("input",{ref:k,id:t,type:"text",value:S,onChange:P,onFocus:O,onKeyDown:F,placeholder:o,autoComplete:"off",required:l&&!d,style:{...Pa,borderColor:l&&!e?me.error:void 0}}),T&&u.jsxs("div",{style:{...q0,maxHeight:"250px",overflowY:"auto"},children:[d&&u.jsx("div",{onClick:j,onMouseEnter:()=>L(-1),style:{...Vu,opacity:.7,fontStyle:"italic",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)",background:M===-1?`color-mix(in srgb, ${me.primary} 20%, transparent)`:"transparent"},children:ko}),N.map((H,Z)=>u.jsxs("div",{children:[H.groupName&&u.jsx("div",{style:{padding:"0.4rem 0.8rem",fontSize:"0.75rem",textTransform:"uppercase",letterSpacing:"0.5px",opacity:.6,background:"color-mix(in srgb, currentColor 5%, transparent)",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},children:H.groupName}),H.items.map(Y=>{const se=W();return u.jsx("div",{onClick:()=>q(Y),style:{...Vu,paddingLeft:H.groupName?"1.2rem":"0.8rem",background:se===M?`color-mix(in srgb, ${me.primary} 20%, transparent)`:"transparent",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},onMouseEnter:()=>L(se),children:Y.name},Y.id)})]},`group-${Z}`)),A.length===0&&S.trim()&&!d&&u.jsx("div",{style:{padding:"0.6rem 0.8rem",opacity:.6,fontStyle:"italic"},children:"No matching categories"})]})]})}function OT({id:t,value:e,onChange:n,accounts:r,accountGroups:i,placeholder:o="Search accounts...",required:l,showNoAccountOption:d=!1,showHiddenAccounts:h=!1}){const p=(h?r:r.filter(([,X])=>!X.is_hidden)).map(([X,W])=>({id:X,name:W.nickname,groupId:W.account_group_id,groupName:W.account_group_id&&i[W.account_group_id]?.name||null,sortOrder:W.sort_order,groupSortOrder:W.account_group_id?i[W.account_group_id]?.sort_order??999:999})),g=e===Ht,v=g?null:r.find(([X])=>X===e)?.[1],_=g?"":v?.nickname||"",[C,x]=D.useState(_),[S,E]=D.useState(!1),[T,I]=D.useState(-1),M=D.useRef(null),L=D.useRef(null);D.useEffect(()=>{if(e===Ht)x("");else if(e){const X=r.find(([W])=>W===e)?.[1];x(X?.nickname||"")}},[e,r]);const $=kT(p,C,X=>[X.name]),k=IT($);D.useEffect(()=>{function X(W){if(M.current&&!M.current.contains(W.target))if(E(!1),e===Ht)x("");else{const H=r.find(([Z])=>Z===e)?.[1];x(H?.nickname||"")}}return document.addEventListener("mousedown",X),()=>document.removeEventListener("mousedown",X)},[e,r]);function A(X){if(X.key==="ArrowDown")X.preventDefault(),S?I(W=>Math.min(W+1,$.length-1)):(E(!0),I(0));else if(X.key==="ArrowUp")X.preventDefault(),I(W=>Math.max(W-1,0));else if(X.key==="Enter")X.preventDefault(),S&&T>=0&&$[T]&&N($[T]);else if(X.key==="Escape")if(E(!1),I(-1),e===Ht)x("");else{const W=r.find(([H])=>H===e)?.[1];x(W?.nickname||"")}else if(X.key==="Tab")if(S&&T>=0&&$[T])N($[T]);else if(E(!1),I(-1),e===Ht)x("");else{const W=r.find(([H])=>H===e)?.[1];x(W?.nickname||"")}}function N(X){n(X.id),x(X.id===Ht?"":X.name),E(!1),I(-1)}function F(){n(Ht),x(""),E(!1),I(-1)}function q(X){const W=X.target.value;x(W),E(!0),I(W.trim()?0:-1),W!==_&&(d&&W.trim()===""?n(Ht):n(""))}function j(){E(!0),d&&(e===Ht||C.trim()==="")?I(-1):$.length>0&&I(0)}let P=-1;const O=()=>++P;return u.jsxs("div",{ref:M,style:{position:"relative"},children:[u.jsx("input",{ref:L,id:t,type:"text",value:C,onChange:q,onFocus:j,onKeyDown:A,placeholder:o,autoComplete:"off",required:l&&!d,style:{...Pa,borderColor:l&&!e?me.error:void 0}}),S&&u.jsxs("div",{style:{...q0,maxHeight:"250px",overflowY:"auto"},children:[d&&u.jsx("div",{onClick:F,onMouseEnter:()=>I(-1),style:{...Vu,opacity:.7,fontStyle:"italic",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)",background:T===-1?`color-mix(in srgb, ${me.primary} 20%, transparent)`:"transparent"},children:Ra}),k.map((X,W)=>u.jsxs("div",{children:[X.groupName&&u.jsx("div",{style:{padding:"0.4rem 0.8rem",fontSize:"0.75rem",textTransform:"uppercase",letterSpacing:"0.5px",opacity:.6,background:"color-mix(in srgb, currentColor 5%, transparent)",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},children:X.groupName}),X.items.map(H=>{const Z=O();return u.jsx("div",{onClick:()=>N(H),style:{...Vu,paddingLeft:X.groupName?"1.2rem":"0.8rem",background:Z===T?`color-mix(in srgb, ${me.primary} 20%, transparent)`:"transparent",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},onMouseEnter:()=>I(Z),children:H.name},H.id)})]},`group-${W}`)),$.length===0&&C.trim()&&!d&&u.jsx("div",{style:{padding:"0.6rem 0.8rem",opacity:.6,fontStyle:"italic"},children:"No matching accounts"})]})]})}function Si({children:t,onSubmit:e,actionName:n}){function r(i){e(i)}return u.jsx("form",{onSubmit:r,style:S4,children:t})}function zt({label:t,htmlFor:e,children:n,hint:r,style:i}){return u.jsxs("div",{style:{...C4,...i},children:[u.jsx("label",{htmlFor:e,style:E4,children:t}),n,r&&u.jsx("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.85rem",opacity:.6},children:r})]})}function Ci(t){return u.jsx("input",{style:Pa,...t})}function V4(t){if(!t)return"";try{return new Date(t+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"})}catch{return t}}function kf({value:t,onChange:e,style:n,autoFocus:r,...i}){const o=D.useRef(null),l=D.useRef(null),d=V4(t);D.useEffect(()=>{r&&l.current?.focus()},[r]);function h(){o.current?.showPicker?.()}function m(p){p.key==="Enter"&&(p.preventDefault(),o.current?.showPicker?.())}return u.jsxs("div",{style:{position:"relative"},children:[u.jsx("input",{ref:o,type:"date",value:t||"",onChange:e,style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",opacity:0,pointerEvents:"none"},...i}),u.jsx("div",{ref:l,tabIndex:0,onClick:h,onKeyDown:m,style:{...Pa,cursor:"pointer",display:"flex",alignItems:"center",fontSize:"0.85rem",fontFamily:"monospace",color:t?"inherit":"color-mix(in srgb, currentColor 50%, transparent)",...n},children:d||"Select date"})]})}function $u({children:t,...e}){return u.jsx("select",{style:T4,...e,children:t})}function H0({minHeight:t="6rem",style:e,...n}){return u.jsx("textarea",{style:{...Pa,width:"100%",minHeight:t,resize:"vertical",fontFamily:"inherit",boxSizing:"border-box",...e},...n})}function za({children:t}){return u.jsx("div",{style:k4,children:t})}function $g(t){const n=t.replace(/[^\d.]/g,"").split("."),r=n[0]||"",i=n[1],o=r.replace(/\B(?=(\d{3})+(?!\d))/g,",");return i!==void 0?`$${o}.${i.slice(0,2)}`:o?`$${o}`:""}function $4(t){return t.replace(/[$,]/g,"")}function xo({id:t,value:e,onChange:n,placeholder:r="$0.00",required:i,autoFocus:o,style:l}){const[d,h]=D.useState(()=>$g(e)),m=D.useRef(null);D.useEffect(()=>{const g=$g(e);$4(d)!==e&&h(g)},[e]);function p(g){const v=g.target.value;if(!v||v==="$"){h(""),n("");return}const C=v.replace(/[^\d.]/g,"").split(".");let x=C[0];C.length>1&&(x+="."+C.slice(1).join("").slice(0,2));const S=$g(x);h(S),n(x)}return u.jsx("input",{ref:m,id:t,type:"text",inputMode:"decimal",value:d,onChange:p,placeholder:r,required:i,autoFocus:o,style:{...Pa,...l}})}function Ti(t=k6){const[e,n]=D.useState(()=>typeof window>"u"?!1:window.innerWidth<t);return D.useEffect(()=>{const r=window.matchMedia(`(max-width: ${t-1}px)`);function i(l){n(l.matches)}i(r),r.addEventListener("change",i);function o(){n(window.innerWidth<t)}return window.addEventListener("resize",o),()=>{r.removeEventListener("change",i),window.removeEventListener("resize",o)}},[t]),e}function MT(){const[t,e]=D.useState(()=>typeof window>"u"?1200:window.innerWidth);return D.useEffect(()=>{function n(){e(window.innerWidth)}return window.addEventListener("resize",n),n(),()=>window.removeEventListener("resize",n)},[]),{width:t,isWide:t>=_o.wide,isMedium:t>=_o.tablet&&t<_o.wide,isNarrowMedium:t>=_o.mobile&&t<_o.tablet,isMobile:t<_o.mobile}}function jn(){const{selectedBudgetId:t,currentUserId:e}=Xe(),n=z6(t),r=n.data,i=r?.budget||null,o=D.useMemo(()=>r?.accounts||{},[r?.accounts]),l=D.useMemo(()=>r?.accountGroups||{},[r?.accountGroups]),d=D.useMemo(()=>r?.categories||{},[r?.categories]),h=D.useMemo(()=>r?.categoryGroups||[],[r?.categoryGroups]),m=i?.owner_id===e,p=D.useMemo(()=>i?.user_ids||[],[i?.user_ids]),g=D.useMemo(()=>i?.accepted_user_ids||[],[i?.accepted_user_ids]),v=i?.total_available??0,_=D.useMemo(()=>r?.monthMap||{},[r?.monthMap]),C=D.useCallback(M=>{if(!t)return;const L=Ue.getQueryData(ke.budget(t));L&&Ue.setQueryData(ke.budget(t),{...L,accounts:M})},[t]),x=D.useCallback(M=>{if(!t)return;const L=Ue.getQueryData(ke.budget(t));L&&Ue.setQueryData(ke.budget(t),{...L,accountGroups:M})},[t]),S=D.useCallback(M=>{if(!t)return;const L=Ue.getQueryData(ke.budget(t));L&&Ue.setQueryData(ke.budget(t),{...L,categories:M})},[t]),E=D.useCallback(M=>{if(!t)return;const L=Ue.getQueryData(ke.budget(t));L&&Ue.setQueryData(ke.budget(t),{...L,categoryGroups:M})},[t]),T=D.useCallback(async()=>{t&&await Ue.invalidateQueries({queryKey:ke.budget(t)})},[t]),I=D.useCallback(()=>Object.entries(o).filter(([,M])=>{const L=M.account_group_id?l[M.account_group_id]:void 0,$=L&&L.on_budget!==null?L.on_budget:M.on_budget!==!1,k=L&&L.is_active!==null?L.is_active:M.is_active!==!1;return $&&k}).reduce((M,[,L])=>M+L.balance,0),[o,l]);return{isLoading:n.isLoading,isFetching:n.isFetching,error:n.error,budget:i,accounts:o,accountGroups:l,categories:d,categoryGroups:h,isOwner:m,budgetUserIds:p,acceptedUserIds:g,totalAvailable:v,monthMap:_,setAccountsOptimistic:C,setAccountGroupsOptimistic:x,setCategoriesOptimistic:S,setCategoryGroupsOptimistic:E,refreshBudget:T,getOnBudgetTotal:I}}function Gs(t,e,n){const{addLoadingHold:r,removeLoadingHold:i}=Gn(),o=Vt(),l=K6(t,e,n,{enabled:!!t});D.useEffect(()=>{const T=t?ke.month(t,e,n):null;return!(T?o.getQueryData(T):null)&&l.isLoading?r("month-query","Loading month data..."):i("month-query"),()=>i("month-query")},[l.isLoading,t,e,n,o,r,i]);const d=l.data?.month||null,h=D.useMemo(()=>d?.income||[],[d?.income]),m=D.useMemo(()=>d?.expenses||[],[d?.expenses]),p=D.useMemo(()=>d?.transfers||[],[d?.transfers]),g=D.useMemo(()=>d?.adjustments||[],[d?.adjustments]),v=D.useMemo(()=>d?.category_balances||[],[d?.category_balances]),_=D.useMemo(()=>d?.account_balances||[],[d?.account_balances]),C=d?.total_income||0,x=d?.total_expenses||0,S=d?.are_allocations_finalized||!1,E=d?.previous_month_income??0;return{isLoading:l.isLoading,isFetching:l.isFetching,error:l.error,month:d,income:h,expenses:m,transfers:p,adjustments:g,categoryBalances:v,accountBalances:_,totalIncome:C,totalExpenses:x,areAllocationsFinalized:S,previousMonthIncome:E}}const q4={trackChange:()=>{},clearChanges:()=>{},removeChange:()=>{},getChanges:()=>[],hasChanges:()=>!1,isSaving:!1,setIsSaving:()=>{},lastSaveTime:null,setLastSaveTime:()=>{},saveError:null,setSaveError:()=>{},clearSaveError:()=>{},syncError:null,setSyncError:()=>{}},NT=D.createContext(q4);function H4({children:t}){const[e,n]=D.useState(new Map),[r,i]=D.useState(!1),[o,l]=D.useState(null),[d,h]=D.useState(null),[m,p]=D.useState(null),g=D.useCallback($=>{i($)},[]),v=D.useCallback($=>{l($)},[]),_=D.useCallback($=>{h($)},[]),C=D.useCallback($=>$.type==="month"&&$.year!==void 0&&$.month!==void 0?`${$.type}:${$.budgetId}:${$.year}:${$.month}`:`${$.type}:${$.budgetId}`,[]),x=D.useCallback($=>{n(k=>{const A=new Map(k),N=C($);return A.set(N,{...$,timestamp:Date.now()}),A})},[C]),S=D.useCallback(()=>{n(new Map)},[]),E=D.useCallback($=>{n(k=>{const A=new Map(k),N=C($);return A.delete(N),A})},[C]),T=D.useCallback(()=>Array.from(e.values()),[e]),I=D.useCallback(()=>e.size>0,[e]),M=D.useCallback(()=>{h(null)},[]),L={trackChange:x,clearChanges:S,removeChange:E,getChanges:T,hasChanges:I,isSaving:r,lastSaveTime:o,saveError:d,clearSaveError:M,setIsSaving:g,setLastSaveTime:v,setSaveError:_,syncError:m,setSyncError:p};return u.jsx(NT.Provider,{value:L,children:t})}function fc(){const t=D.useContext(NT);if(!t)throw new Error("useSync must be used within a SyncProvider");return t}function pm(){const{trackChange:t}=fc();return{updateBudgetCacheAndTrack:(n,r)=>{Ue.setQueryData(ke.budget(n),r),t({type:"budget",budgetId:n})}}}function PT(){const t=Vt(),{currentViewingDocument:e}=Xe(),{saveCurrentDocument:n}=wn(),{updateBudgetCacheAndTrack:r}=pm(),i=Hn({onMutate:async l=>{const{budgetId:d,accounts:h}=l,m=ke.budget(d);await t.cancelQueries({queryKey:m});const p=t.getQueryData(m);if(p){const v={...p,accounts:h};r(d,v)}if(e.type==="budget")try{await n(d,"budget")}catch(v){console.warn("[useUpdateAccounts] Failed to save current document immediately:",v)}return{previousData:p}},mutationFn:async l=>{const{accounts:d}=l;return{accounts:d}},onError:(l,d,h)=>{h?.previousData&&t.setQueryData(ke.budget(d.budgetId),h.previousData)}});return{updateAccounts:{mutate:l=>i.mutate(l),mutateAsync:l=>i.mutateAsync(l),isPending:i.isPending,isError:i.isError,error:i.error,reset:i.reset}}}function G4(){const t=Vt(),{currentViewingDocument:e}=Xe(),{saveCurrentDocument:n}=wn(),{updateBudgetCacheAndTrack:r}=pm(),i=Hn({onMutate:async l=>{const{budgetId:d,accountGroups:h}=l,m=ke.budget(d);await t.cancelQueries({queryKey:m});const p=t.getQueryData(m);if(p){const v={...p,accountGroups:h};r(d,v)}if(e.type==="budget")try{await n(d,"budget")}catch(v){console.warn("[useUpdateAccountGroups] Failed to save current document immediately:",v)}return{previousData:p}},mutationFn:async l=>{const{accountGroups:d}=l;return{accountGroups:d}},onError:(l,d,h)=>{h?.previousData&&t.setQueryData(ke.budget(d.budgetId),h.previousData)}});return{updateAccountGroups:{mutate:l=>i.mutate(l),mutateAsync:l=>i.mutateAsync(l),isPending:i.isPending,isError:i.isError,error:i.error,reset:i.reset}}}function zT(){const t=Vt(),{currentViewingDocument:e}=Xe(),{saveCurrentDocument:n}=wn(),{updateBudgetCacheAndTrack:r}=pm(),i=Hn({onMutate:async l=>{const{budgetId:d,categories:h}=l,m=ke.budget(d);await t.cancelQueries({queryKey:m});const p=t.getQueryData(m);if(p){const v={...p,categories:h};r(d,v)}if(e.type==="budget")try{await n(d,"budget")}catch(v){console.warn("[useUpdateCategories] Failed to save current document immediately:",v)}return{previousData:p}},mutationFn:async l=>{const{categories:d}=l;return{categories:d}},onError:(l,d,h)=>{h?.previousData&&t.setQueryData(ke.budget(d.budgetId),h.previousData)}});return{updateCategories:{mutate:l=>i.mutate(l),mutateAsync:l=>i.mutateAsync(l),isPending:i.isPending,isError:i.isError,error:i.error,reset:i.reset}}}function Q4(){const t=Vt(),{currentViewingDocument:e}=Xe(),{saveCurrentDocument:n}=wn(),{updateBudgetCacheAndTrack:r}=pm(),i=Hn({onMutate:async l=>{const{budgetId:d,categoryGroups:h}=l,m=ke.budget(d);await t.cancelQueries({queryKey:m});const p=t.getQueryData(m);if(p){const v={...p,categoryGroups:h};r(d,v)}if(e.type==="budget")try{await n(d,"budget")}catch(v){console.warn("[useUpdateCategoryGroups] Failed to save current document immediately:",v)}return{previousData:p}},mutationFn:async l=>{const{categoryGroups:d}=l;return{categoryGroups:d}},onError:(l,d,h)=>{h?.previousData&&t.setQueryData(ke.budget(d.budgetId),h.previousData)}});return{updateCategoryGroups:{mutate:l=>i.mutate(l),mutateAsync:l=>i.mutateAsync(l),isPending:i.isPending,isError:i.isError,error:i.error,reset:i.reset}}}async function gm(t){const{budgetId:e,updates:n,description:r}=t,i={...n,updated_at:new Date().toISOString()},o=ja(i);await qn("budgets",e,o,r,{merge:!0});const l=Ue.getQueryData(ke.budget(e));l&&Ue.setQueryData(ke.budget(e),{...l,budget:{...l.budget,...n}})}function W4(){const t=Vt(),e=Hn({onMutate:async r=>{const{budgetId:i,newName:o}=r,l=ke.budget(i);await t.cancelQueries({queryKey:l});const d=t.getQueryData(l);return d&&t.setQueryData(l,{...d,budget:{...d.budget,name:o.trim()}}),{previousData:d}},mutationFn:async r=>{const{budgetId:i,newName:o}=r,l=o.trim();return await gm({budgetId:i,updates:{name:l},description:`renaming budget to "${l}"`}),{newName:l}},onError:(r,i,o)=>{o?.previousData&&t.setQueryData(ke.budget(i.budgetId),o.previousData)}});return{renameBudget:{mutate:r=>e.mutate(r),mutateAsync:r=>e.mutateAsync(r),isPending:e.isPending,isError:e.isError,error:e.error,reset:e.reset}}}function K4({currentBudget:t,accounts:e,accountGroups:n,setAccountsOptimistic:r,setAccountGroupsOptimistic:i,saveAccounts:o,saveAccountGroups:l,setError:d}){const h=D.useCallback(async(p,g,v)=>{const _=e[p];if(!_)return;const C=v==="ungrouped"?Zt:v,x=Object.entries(e).filter(([,T])=>(T.account_group_id||"ungrouped")===v),S={};Object.entries(e).forEach(([T,I])=>{T!==p&&(S[T]={...I})});let E;if(g==="__group_end__"||x.length===0||!x.find(([T])=>T===g))E=(x.length>0?Math.max(...x.filter(([I])=>I!==p).map(([,I])=>I.sort_order)):-1)+1;else{const T=x.find(([I])=>I===g);if(T){const[,I]=T;E=I.sort_order,Object.entries(S).forEach(([M,L])=>{(L.account_group_id||"ungrouped")===v&&L.sort_order>=E&&(S[M]={...L,sort_order:L.sort_order+1})})}else E=0}if(S[p]={..._,account_group_id:C,sort_order:E},r(S),!!t)try{await o(S)}catch(T){d(T instanceof Error?T.message:"Failed to save changes")}},[t,e,r,o,d]),m=D.useCallback(async(p,g)=>{if(p===g)return;const v=Object.entries(n).sort(([,E],[,T])=>E.sort_order-T.sort_order),_=v.findIndex(([E])=>E===p),C=[...v],[x]=C.splice(_,1);if(g==="__end__")C.push(x);else{const E=C.findIndex(([T])=>T===g);C.splice(E,0,x)}const S={};if(C.forEach(([E,T],I)=>{S[E]={...T,sort_order:I}}),i(S),!!t)try{await l(S)}catch(E){d(E instanceof Error?E.message:"Failed to save new order")}},[t,n,i,l,d]);return{reorderAccountsInGroup:h,reorderGroups:m}}function Y4(){const{selectedBudgetId:t}=Xe(),{budget:e,accounts:n,accountGroups:r,setAccountsOptimistic:i,setAccountGroupsOptimistic:o}=jn(),{updateAccounts:l}=PT(),{updateAccountGroups:d}=G4(),[h,m]=D.useState(null),p=D.useCallback(async F=>{if(!t)throw new Error("No budget selected");await l.mutateAsync({budgetId:t,accounts:F})},[t,l]),g=D.useCallback(async F=>{if(!t)throw new Error("No budget selected");await d.mutateAsync({budgetId:t,accountGroups:F})},[t,d]),v=D.useCallback(async(F,q)=>{if(!t)throw new Error("No budget selected");await Promise.all([l.mutateAsync({budgetId:t,accounts:F}),d.mutateAsync({budgetId:t,accountGroups:q})])},[t,l,d]),_=D.useMemo(()=>Object.entries(n).filter(([,F])=>!F.is_hidden).reduce((F,[q,j])=>{const P=j.account_group_id||Zt;return F[P]||(F[P]=[]),F[P].push({...j,id:q}),F},{}),[n]),C=D.useMemo(()=>Object.entries(n).filter(([,F])=>F.is_hidden).map(([F,q])=>({...q,id:F})).sort((F,q)=>F.sort_order-q.sort_order),[n]),x=D.useMemo(()=>Object.entries(r).sort(([,F],[,q])=>F.sort_order-q.sort_order).map(([F,q])=>({...q,id:F})),[r]),S=D.useCallback((F,q)=>{if(!e)return;const j=q||Zt,P=Object.values(n).filter(Z=>Z.account_group_id===j),O=P.length>0?Math.max(...P.map(Z=>Z.sort_order)):-1,X=`account_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,W={nickname:F.nickname,description:"",balance:0,account_group_id:j,sort_order:O+1,is_income_account:F.is_income_account??!1,is_income_default:F.is_income_default??!1,is_outgo_account:F.is_outgo_account??!1,is_outgo_default:F.is_outgo_default??!1,on_budget:F.on_budget!==!1,is_active:F.is_active!==!1,is_hidden:F.is_hidden??!1},H={...n};F.is_income_default&&Object.keys(H).forEach(Z=>{H[Z]={...H[Z],is_income_default:!1}}),F.is_outgo_default&&Object.keys(H).forEach(Z=>{H[Z]={...H[Z],is_outgo_default:!1}}),H[X]=W,i(H),p(H).catch(Z=>m(Z instanceof Error?Z.message:"Failed to create account."))},[e,n,i,p]),E=D.useCallback((F,q)=>{if(!e)return;const j=n[F];if(!j)return;const P=j.account_group_id||Zt,O=q.account_group_id||Zt;let X=j.sort_order;if(P!==O){const H=Object.values(n).filter(Z=>Z.account_group_id===O);X=H.length>0?Math.max(...H.map(Z=>Z.sort_order))+1:0}const W={};Object.entries(n).forEach(([H,Z])=>{H===F?W[H]={...Z,nickname:q.nickname,account_group_id:O,sort_order:X,is_income_account:q.is_income_account??!1,is_income_default:q.is_income_default??!1,is_outgo_account:q.is_outgo_account??!1,is_outgo_default:q.is_outgo_default??!1,on_budget:q.on_budget!==!1,is_active:q.is_active!==!1,is_hidden:q.is_hidden??!1}:(W[H]={...Z},q.is_income_default&&!j.is_income_default&&(W[H].is_income_default=!1),q.is_outgo_default&&!j.is_outgo_default&&(W[H].is_outgo_default=!1))}),i(W),p(W).catch(H=>m(H instanceof Error?H.message:"Failed to save account."))},[e,n,i,p]),T=D.useCallback(F=>{if(!confirm("Are you sure you want to delete this account?")||!e)return;const{[F]:q,...j}=n;i(j),p(j).catch(P=>m(P instanceof Error?P.message:"Failed to delete account."))},[e,n,i,p]),I=D.useCallback(async(F,q)=>{const j=n[F];if(!j)return;const P=j.account_group_id||Zt,O=Object.entries(n).filter(([,se])=>se.account_group_id===P).sort(([,se],[,B])=>se.sort_order-B.sort_order),X=O.findIndex(([se])=>se===F),W=q==="up"?X-1:X+1;if(W<0||W>=O.length)return;const[H,Z]=O[W],Y={};if(Object.entries(n).forEach(([se,B])=>{se===F?Y[se]={...B,sort_order:Z.sort_order}:se===H?Y[se]={...B,sort_order:j.sort_order}:Y[se]={...B}}),i(Y),!!e)try{await p(Y)}catch(se){i(n),m(se instanceof Error?se.message:"Failed to move account")}},[e,n,i,p]),M=D.useCallback(F=>{if(!e)return;const q=Object.values(r).map(W=>W.sort_order),j=q.length>0?Math.max(...q):-1,P=`account_group_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,O={name:F.name,sort_order:j+1,expected_balance:F.expected_balance,on_budget:F.on_budget??null,is_active:F.is_active??null},X={...r,[P]:O};o(X),g(X).catch(W=>m(W instanceof Error?W.message:"Failed to create account type."))},[e,r,o,g]),L=D.useCallback((F,q)=>{if(!e)return;const j={...r,[F]:{...r[F],name:q.name,expected_balance:q.expected_balance,on_budget:q.on_budget??null,is_active:q.is_active??null}};o(j),g(j).catch(P=>m(P instanceof Error?P.message:"Failed to update account type."))},[e,r,o,g]),$=D.useCallback(F=>{if(F===Zt){alert("Cannot delete the default Ungrouped account type.");return}if(!confirm("Are you sure you want to delete this account type? Accounts in this type will move to Ungrouped.")||!e)return;const q={};Object.entries(n).forEach(([O,X])=>{q[O]=X.account_group_id===F?{...X,account_group_id:Zt}:X});const{[F]:j,...P}=r;i(q),o(P),v(q,P).catch(O=>m(O instanceof Error?O.message:"Failed to delete account type."))},[e,n,r,i,o,v]),k=D.useCallback(async(F,q)=>{const j=Object.entries(r).sort(([,H],[,Z])=>H.sort_order-Z.sort_order),P=j.findIndex(([H])=>H===F),O=q==="up"?P-1:P+1;if(O<0||O>=j.length)return;const[X]=j.splice(P,1);j.splice(O,0,X);const W={};if(j.forEach(([H,Z],Y)=>{W[H]={...Z,sort_order:Y}}),o(W),!!e)try{await g(W)}catch(H){o(r),m(H instanceof Error?H.message:"Failed to move account type")}},[e,r,o,g]),{reorderAccountsInGroup:A,reorderGroups:N}=K4({currentBudget:e,accounts:n,accountGroups:r,setAccountsOptimistic:i,setAccountGroupsOptimistic:o,saveAccounts:p,saveAccountGroups:g,setError:m});return{accounts:n,accountGroups:r,accountsByGroup:_,hiddenAccounts:C,sortedGroups:x,currentBudget:e,error:h,setError:m,handleCreateAccount:S,handleUpdateAccount:E,handleDeleteAccount:T,handleMoveAccount:I,handleCreateGroup:M,handleUpdateGroup:L,handleDeleteGroup:$,handleMoveGroup:k,reorderAccountsInGroup:A,reorderGroups:N}}function I1(t,e){if(!t)return{};const n={};return Object.entries(e).forEach(([r,i])=>{if(i.default_monthly_type==="percentage")return;const o=t.category_balances?.find(l=>l.category_id===r);o&&o.allocated>0?n[r]=o.allocated.toString():i.default_monthly_amount!==void 0&&i.default_monthly_amount>0?n[r]=i.default_monthly_amount.toString():n[r]=""}),n}function X4(){const{addLoadingHold:t,removeLoadingHold:e}=Gn(),{selectedBudgetId:n,currentYear:r,currentMonthNumber:i}=Xe(),{categories:o,getOnBudgetTotal:l,totalAvailable:d}=jn(),{month:h,isLoading:m,previousMonthIncome:p,areAllocationsFinalized:g}=Gs(n,r,i),v=D.useMemo(()=>h?.income?h.income.reduce((B,G)=>B+G.amount,0):0,[h]),{saveDraftAllocations:_}=w4(),{finalizeAllocations:C}=TP(),{deleteAllocations:x}=YT(),S=D.useMemo(()=>I1(h,o),[h,o]),[E,T]=D.useState(S),[I,M]=D.useState(!1),[L,$]=D.useState(null),k=D.useRef(null);D.useMemo(()=>Object.values(o).reduce((B,G)=>B+(G.balance??0),0),[o]),D.useEffect(()=>{if(!h)return;const B=`${h.year}-${h.month}`;k.current!==B&&(M(!1),T(I1(h,o)),k.current=B)},[h,o]);const A=D.useCallback((B,G)=>{if(G.default_monthly_type==="percentage"&&G.default_monthly_amount!==void 0)return Oe(G.default_monthly_amount/100*p);const ne=E[B],ie=parseFloat(ne||"0");return isNaN(ie)?0:Oe(ie)},[E,p]),N=D.useMemo(()=>Object.entries(o).reduce((B,[G,ne])=>{const ie=A(G,ne),ee=ne.balance??0;if(ee<0){const ue=Math.abs(ee),be=Math.max(0,ie-ue);return B+be}return B+ie},0),[o,A]),F=l(),q=g?(h?.category_balances||[]).reduce((B,G)=>{const ne=o[G.category_id]?.balance??0,ie=G.allocated,ee=ne-ie;if(ee<0){const ue=Math.abs(ee);return B+Math.max(0,ie-ue)}return B+ie},0):0,j=I?d+q:d,P=D.useMemo(()=>I?j-N:j-N+q,[j,N,q,I]),O=D.useCallback((B,G)=>{T(ne=>({...ne,[B]:G}))},[]),X=D.useCallback(()=>{if(!h)return;const B={};Object.entries(o).forEach(([G,ne])=>{if(ne.default_monthly_type==="percentage")return;const ie=h.category_balances?.find(ee=>ee.category_id===G);ie&&ie.allocated>0?B[G]=ie.allocated.toString():ne.default_monthly_amount!==void 0&&ne.default_monthly_amount>0?B[G]=ne.default_monthly_amount.toString():B[G]=""}),T(B),M(!1)},[h,o]),W=D.useCallback(()=>{const B={};return Object.entries(o).forEach(([G,ne])=>{const ie=A(G,ne);ie>0&&(B[G]=ie)}),B},[o,A]),H=D.useCallback(async()=>{if(n){$(null),t("allocations-save","Saving allocations...");try{await _(n,r,i,W()),M(!1)}catch(B){$(B instanceof Error?B.message:"Failed to save allocations")}finally{e("allocations-save")}}},[n,r,i,_,W,t,e]),Z=D.useCallback(async()=>{if(n){$(null),t("allocations-finalize","Applying allocations...");try{await C({budgetId:n,year:r,month:i,allocations:W(),onProgress:B=>{t("allocations-finalize",B.message)}}),M(!1)}catch(B){$(B instanceof Error?B.message:"Failed to finalize allocations")}finally{e("allocations-finalize")}}},[n,r,i,C,W,t,e]),Y=D.useCallback(async()=>{if(n){$(null),t("allocations-delete","Deleting allocations...");try{await x({budgetId:n,year:r,month:i,onProgress:G=>{t("allocations-delete",G.message)}});const B={};Object.entries(o).forEach(([G,ne])=>{ne.default_monthly_type!=="percentage"&&(ne.default_monthly_amount!==void 0&&ne.default_monthly_amount>0?B[G]=ne.default_monthly_amount.toString():B[G]="")}),T(B),M(!1)}catch(B){$(B instanceof Error?B.message:"Failed to delete allocations")}finally{e("allocations-delete")}}},[n,r,i,x,o,t,e]),se=N-q;return{localAllocations:E,isEditingAppliedAllocations:I,error:L,monthLoading:m,onBudgetTotal:F,availableNow:j,currentDraftTotal:N,draftChangeAmount:se,availableAfterApply:P,previousMonthIncome:p,currentMonthIncome:v,allocationsFinalized:g,getAllocationAmount:A,handleAllocationChange:O,resetAllocationsToSaved:X,handleSaveAllocations:H,handleFinalizeAllocations:Z,handleDeleteAllocations:Y,setIsEditingAppliedAllocations:M,setError:$}}function Z4({budgetId:t,categories:e,currentYear:n,currentMonth:r,updateCategoriesWithBalances:i}){const[o,l]=D.useState({}),[d,h]=D.useState(!1);D.useEffect(()=>{if(!t||Object.keys(e).length===0){l({});return}let E=!1;h(!0);const T=Object.keys(e);return Vg(t,T,n,r).then(({current:I,total:M})=>{if(E)return;const L={};T.forEach($=>{L[$]={current:I[$]??0,total:M[$]??0}}),l(L)}).catch(I=>{if(E)return;console.error("[useCategoryBalances] Error calculating balances:",I);const M={};Object.entries(e).forEach(([L,$])=>{M[L]={current:$.balance??0,total:$.balance??0}}),l(M)}).finally(()=>{E||h(!1)}),()=>{E=!0}},[t,n,r,e]);const m=D.useMemo(()=>{const E={};return Object.entries(e).forEach(([T,I])=>{o[T]?E[T]=o[T]:E[T]={current:I.balance??0,total:I.balance??0}}),E},[e,o]),[p,g]=D.useState(!1),v=p||d,[_,C]=D.useState(null),x=D.useCallback(async()=>{if(!t||Object.keys(e).length===0)return null;const E=Object.keys(e),{total:T}=await Vg(t,E,n,r),I={};Object.entries(e).forEach(([L,$])=>{const k=$.balance,A=T[L]??0;Math.abs(k-A)>.01&&(I[L]={stored:k,calculated:A})});const M=Object.keys(I).length>0?I:null;return C(M),M},[t,e,n,r]),S=D.useCallback(async()=>{if(!(!t||Object.keys(e).length===0)){g(!0);try{const E=Object.keys(e),{total:T}=await Vg(t,E,n,r),I={};Object.entries(e).forEach(([M,L])=>{I[M]={...L,balance:T[M]??0}}),await i(I),C(null)}finally{g(!1)}}},[t,e,i,n,r]);return{categoryBalances:m,loadingBalances:v,categoryBalanceMismatch:_,checkCategoryBalanceMismatch:x,recalculateAndSaveCategoryBalances:S}}function J4({categories:t,categoryGroups:e,currentBudget:n,setCategoriesOptimistic:r,setCategoryGroupsOptimistic:i,saveCategories:o,saveCategoryGroups:l,setError:d}){const[h,m]=D.useState(null),[p,g]=D.useState(null),[v,_]=D.useState(null),[C,x]=D.useState(null);function S(A,N){m("category"),g(N),A.dataTransfer.effectAllowed="move"}function E(A,N,F){A.preventDefault(),h==="category"&&(N!==p&&_(N),x(F))}function T(A,N){A.preventDefault(),h==="category"&&(x(N),_(null))}function I(){_(null)}function M(){x(null)}function L(){m(null),g(null),_(null),x(null)}async function $(A,N,F){if(A.preventDefault(),A.stopPropagation(),!p||h!=="category"){L();return}const q=t[p];if(!q)return;const j=F==="ungrouped"?ln:F,P=Object.entries(t).filter(([,W])=>(W.category_group_id||"ungrouped")===F),O={};Object.entries(t).forEach(([W,H])=>{W!==p&&(O[W]=H)});let X;if(N==="__group_end__"||P.length===0||!P.find(([W])=>W===N))X=(P.length>0?Math.max(...P.filter(([H])=>H!==p).map(([,H])=>H.sort_order)):-1)+1;else{const W=P.find(([H])=>H===N);W?(X=W[1].sort_order,Object.entries(O).forEach(([H,Z])=>{(Z.category_group_id||"ungrouped")===F&&Z.sort_order>=X&&(O[H]={...Z,sort_order:Z.sort_order+1})})):X=0}if(O[p]={...q,category_group_id:j,sort_order:X},r(O),L(),!!n)try{await o(O)}catch(W){d(W instanceof Error?W.message:"Failed to save changes")}}async function k(A,N){A.preventDefault(),h==="category"&&await $(A,"__group_end__",N)}return{dragType:h,draggedId:p,dragOverId:v,dragOverGroupId:C,setDragOverId:_,setDragOverGroupId:x,handleCategoryDragStart:S,handleCategoryDragOver:E,handleDragOverGroup:T,handleDragLeave:I,handleDragLeaveGroup:M,handleDragEnd:L,handleCategoryDrop:$,handleDropOnGroup:k}}function e3(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n}=Xe(),{budget:r,categories:i,categoryGroups:o,isLoading:l,setCategoriesOptimistic:d,setCategoryGroupsOptimistic:h,getOnBudgetTotal:m}=jn(),{updateCategories:p}=zT(),{updateCategoryGroups:g}=Q4(),[v,_]=D.useState(null),C=D.useCallback(async Z=>{if(!t)throw new Error("No budget selected");await p.mutateAsync({budgetId:t,categories:Z})},[t,p]),x=D.useCallback(async Z=>{if(!t)throw new Error("No budget selected");await g.mutateAsync({budgetId:t,categoryGroups:Z})},[t,g]),S=D.useCallback(async(Z,Y)=>{if(!t)throw new Error("No budget selected");await Promise.all([p.mutateAsync({budgetId:t,categories:Z}),g.mutateAsync({budgetId:t,categoryGroups:Y})])},[t,p,g]),{categoryBalances:E,loadingBalances:T,categoryBalanceMismatch:I,checkCategoryBalanceMismatch:M,recalculateAndSaveCategoryBalances:L}=Z4({budgetId:t,categories:i,currentYear:e,currentMonth:n,updateCategoriesWithBalances:C}),$=J4({categories:i,categoryGroups:o,currentBudget:r,setCategoriesOptimistic:d,setCategoryGroupsOptimistic:h,saveCategories:C,saveCategoryGroups:x,setError:_});async function k(Z,Y){if(!r)return;const se=Y||ln,B=Object.values(i).filter(ue=>ue.category_group_id===se),G=B.length>0?Math.max(...B.map(ue=>ue.sort_order)):-1,ne=`category_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,ie={name:Z.name,description:Z.description??"",category_group_id:se,sort_order:G+1,default_monthly_amount:Z.default_monthly_amount??0,default_monthly_type:Z.default_monthly_type??"fixed",balance:0,is_hidden:Z.is_hidden??!1},ee={...i,[ne]:ie};d(ee);try{await C(ee)}catch(ue){d(i),_(ue instanceof Error?ue.message:"Failed to create category")}}async function A(Z,Y){if(r)try{const se=i[Z];if(!se)return;const B=se.category_group_id||ln,G=Y.category_group_id||ln;let ne=se.sort_order;if(B!==G){const ee=Object.values(i).filter(ue=>ue.category_group_id===G).filter((ue,be,ce)=>i[Z]!==ce[be]);ne=ee.length>0?Math.max(...ee.map(ue=>ue.sort_order))+1:0}const ie={...i,[Z]:{...se,name:Y.name,description:Y.description??"",category_group_id:G,sort_order:ne,default_monthly_amount:Y.default_monthly_amount??0,default_monthly_type:Y.default_monthly_type??"fixed",is_hidden:Y.is_hidden??!1}};d(ie),await C(ie)}catch(se){_(se instanceof Error?se.message:"Failed to update category")}}async function N(Z){if(confirm("Are you sure you want to delete this category?")&&r)try{const{[Z]:Y,...se}=i;d(se),await C(se)}catch(Y){_(Y instanceof Error?Y.message:"Failed to delete category")}}async function F(Z,Y){const se=i[Z];if(!se)return;const B=se.category_group_id||ln,G=Object.entries(i).filter(([,ce])=>ce.category_group_id===B).sort((ce,ve)=>ce[1].sort_order-ve[1].sort_order),ne=G.findIndex(([ce])=>ce===Z),ie=Y==="up"?ne-1:ne+1;if(ie<0||ie>=G.length)return;const[ee,ue]=G[ie],be={};if(Object.entries(i).forEach(([ce,ve])=>{ce===Z?be[ce]={...ve,sort_order:ue.sort_order}:ce===ee?be[ce]={...ve,sort_order:se.sort_order}:be[ce]=ve}),d(be),!!r)try{await C(be)}catch(ce){d(i),_(ce instanceof Error?ce.message:"Failed to move category")}}async function q(Z){if(r)try{const Y=o.length>0?Math.max(...o.map(G=>G.sort_order)):-1,se={id:`category_group_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,name:Z.name,sort_order:Y+1},B=[...o,se];h(B),await x(B)}catch(Y){_(Y instanceof Error?Y.message:"Failed to create group")}}async function j(Z,Y){if(r)try{const se=o.map(B=>B.id===Z?{...B,name:Y.name}:B);h(se),await x(se)}catch(se){_(se instanceof Error?se.message:"Failed to update group")}}async function P(Z){if(Z===ln){alert("Cannot delete the default Uncategorized category group.");return}if(confirm("Are you sure you want to delete this group? Categories in this group will move to Uncategorized.")&&r)try{const Y={};Object.entries(i).forEach(([B,G])=>{Y[B]=G.category_group_id===Z?{...G,category_group_id:ln}:G});const se=o.filter(B=>B.id!==Z);d(Y),h(se),await S(Y,se)}catch(Y){_(Y instanceof Error?Y.message:"Failed to delete group")}}async function O(Z,Y){const se=[...o].sort((ee,ue)=>ee.sort_order-ue.sort_order),B=se.findIndex(ee=>ee.id===Z),G=Y==="up"?B-1:B+1;if(G<0||G>=se.length)return;const[ne]=se.splice(B,1);se.splice(G,0,ne);const ie=se.map((ee,ue)=>({...ee,sort_order:ue}));if(h(ie),!!r)try{await x(ie)}catch(ee){h(o),_(ee instanceof Error?ee.message:"Failed to move group")}}const X=Object.entries(i).filter(([,Z])=>!Z.is_hidden).reduce((Z,[Y,se])=>{const B=se.category_group_id||ln;return Z[B]||(Z[B]=[]),Z[B].push([Y,se]),Z},{}),W=Object.entries(i).filter(([,Z])=>Z.is_hidden).map(([Z,Y])=>[Z,Y]).sort((Z,Y)=>Z[1].sort_order-Y[1].sort_order),H=[...o].sort((Z,Y)=>Z.sort_order-Y.sort_order);return{currentBudget:r,categories:i,categoryGroups:o,categoriesByGroup:X,hiddenCategories:W,sortedGroups:H,categoryBalances:E,isLoading:l,loadingBalances:T,error:v,setError:_,getOnBudgetTotal:m,categoryBalanceMismatch:I,checkCategoryBalanceMismatch:M,recalculateAndSaveCategoryBalances:L,handleCreateCategory:k,handleUpdateCategory:A,handleDeleteCategory:N,handleMoveCategory:F,handleCreateGroup:q,handleUpdateGroup:j,handleDeleteGroup:P,handleMoveGroup:O,dragType:$.dragType,draggedId:$.draggedId,dragOverId:$.dragOverId,dragOverGroupId:$.dragOverGroupId,setDragOverId:$.setDragOverId,setDragOverGroupId:$.setDragOverGroupId,handleCategoryDragStart:$.handleCategoryDragStart,handleCategoryDragOver:$.handleCategoryDragOver,handleDragOverGroup:$.handleDragOverGroup,handleDragLeave:$.handleDragLeave,handleDragLeaveGroup:$.handleDragLeaveGroup,handleDragEnd:$.handleDragEnd,handleCategoryDrop:$.handleCategoryDrop,handleDropOnGroup:$.handleDropOnGroup}}function t3(t){switch(t.phase){case"reading-budget":return"Reading budget data...";case"fetching-months":return t.totalMonthsToFetch?`Loading ${t.totalMonthsToFetch} months...`:"Loading months...";case"recalculating":return t.currentMonth?`Recalculating ${t.currentMonth}...`:"Recalculating balances...";case"saving":return t.totalMonths?`Saving ${t.totalMonths} months...`:"Saving results...";case"complete":return"Recalculation complete!";default:return"Recalculating..."}}function od({budgetId:t,year:e,month:n,monthMap:r,checkAnyMonth:i=!1,requireMonthLoaded:o=!1,currentMonth:l,additionalCondition:d=!0,onProgress:h,onError:m,logPrefix:p="[AutoRecalc]"}){const[g,v]=D.useState(null),_=D.useRef(!1),C=D.useRef(null),x=D.useRef(null),S=Mn(),E=D.useRef(null),{addLoadingHold:T,removeLoadingHold:I}=Gn();return D.useEffect(()=>{if(!t||!d||o&&!l)return;let M;const L=S.pathname;if(i){E.current!==L&&(C.current=null,E.current=L);const A=xT(r);if(A.length===0||_.current||(M=`any-${A[0]}`,C.current===M))return}else{if(e===void 0||n===void 0){console.warn(`${p} year and month are required when checkAnyMonth is false`);return}const A=xt(e,n),N=r[A]?.needs_recalculation===!0;if(M=`${e}-${n}`,(E.current!==L||x.current!==M)&&(C.current=null,E.current=L,x.current=M),C.current===M)return;if(!N||_.current){C.current=M;return}`${e}${String(n).padStart(2,"0")}`}_.current=!0,C.current=M;const $=`recalc-${t}`;T($,"Recalculating balances..."),m4(t,{onProgress:A=>{v(A);const N=t3(A);T($,N),h?.(A)}}).then(()=>{Ue.invalidateQueries({queryKey:["month",t]})}).catch(A=>{const N=A instanceof Error?A:new Error(String(A));m?m(N):console.error(`${p} Recalculation failed:`,N)}).finally(()=>{_.current=!1,v(null),I($)})},[t,e,n,r,i,o,l,d,h,m,p,S.pathname,T,I]),{recalcProgress:g,isRecalculating:g!==null}}function n3(t,e,n,r){return{budget_id:e,year_month_ordinal:t.year_month_ordinal??xt(n,r),year:t.year??n,month:t.month??r,income:t.income||[],total_income:t.total_income??0,previous_month_income:t.previous_month_income??0,expenses:t.expenses||[],total_expenses:t.total_expenses??0,transfers:t.transfers||[],adjustments:t.adjustments||[],account_balances:t.account_balances||[],category_balances:t.category_balances||[],are_allocations_finalized:t.are_allocations_finalized??!1,created_at:t.created_at,updated_at:t.updated_at}}async function r3(t){const e=new Date,n=e.getFullYear(),r=e.getMonth()+1;let i=n,o=r-3;for(;o<=0;)o+=12,i-=1;const l=xt(i,o);return(await On("months","useInitialDataLoad: loading initial months",[{field:"budget_id",op:"==",value:t},{field:"year_month_ordinal",op:">=",value:l}])).docs.map(m=>{const p=m.data,g=p.year,v=p.month;return n3(p,t,g,v)}).sort((m,p)=>m.year!==p.year?m.year-p.year:m.month-p.month)}async function s3(t){const[e,n,r]=await Promise.all([M0(t),P0(t),r3(t)]);return{budget:e,payees:n,months:r}}function i3(t,e){return Do({queryKey:t?["initialDataLoad",t]:["initialDataLoad","none"],queryFn:()=>s3(t),enabled:!!t&&e?.enabled!==!1,staleTime:1/0})}async function a3(t,e,n,r){const i=ke.month(t,e,n),o=r.getQueryData(i);if(!o?.month)throw new Error(`Month ${e}/${n} not found in cache`);const l=o.month,d=await o3(t,e,n,r),h=L0(l,d);return r.setQueryData(i,{month:h}),h}async function o3(t,e,n,r){const{year:i,month:o}=Xl(e,n),l=ke.month(t,i,o),d=r.getQueryData(l);if(d?.month)return Fu(d.month);try{const h=await N0(t,i,o);if(h)return r.setQueryData(l,{month:h}),Fu(h)}catch(h){console.warn(`[useLocalRecalculation] Could not fetch previous month ${i}/${o}:`,h)}return B0}function l3(){const t=Mn(),{saveAllChanges:e}=wn(),{hasChanges:n}=fc(),r=D.useRef(null);D.useEffect(()=>{const i=t.pathname;if(r.current===null){r.current=i;return}r.current!==i&&n()&&queueMicrotask(()=>{e("navigation save (page change)").catch(o=>{console.error("[useNavigationSave] Failed to save on navigation:",o)})}),r.current=i},[t.pathname,n,e])}const k1=300*1e3;function c3(t,e,n,r){return{budget_id:e,year_month_ordinal:t.year_month_ordinal??xt(n,r),year:t.year??n,month:t.month??r,income:t.income||[],total_income:t.total_income??0,previous_month_income:t.previous_month_income??0,expenses:t.expenses||[],total_expenses:t.total_expenses??0,transfers:t.transfers||[],adjustments:t.adjustments||[],account_balances:t.account_balances||[],category_balances:t.category_balances||[],are_allocations_finalized:t.are_allocations_finalized??!1,created_at:t.created_at,updated_at:t.updated_at}}function D1(t,e){return e?t?new Date(e)>new Date(t):!0:!1}async function u3(t,e){const n=[],r=new Date,i=r.getFullYear(),o=r.getMonth()+1;let l=i,d=o-3;for(;d<=0;)d+=12,l-=1;const h=xt(l,d),[m,p,g]=await Promise.all([Ue.fetchQuery({queryKey:ke.budget(t),queryFn:()=>M0(t),staleTime:0}).catch(()=>null),Ue.fetchQuery({queryKey:ke.payees(t),queryFn:()=>P0(t),staleTime:0}).catch(()=>null),On("months","useSyncCheck: checking for remote changes",[{field:"budget_id",op:"==",value:t},{field:"year_month_ordinal",op:">=",value:h}]).catch(()=>({docs:[]}))]);if(m){const _=Ue.getQueryData(ke.budget(t));if(_){const C=_.budget?.updated_at;D1(C,m.budget.updated_at)&&(e.some(S=>S.type==="budget"&&S.budgetId===t)?n.push("Budget document has been updated remotely (you have unsaved local changes)"):Ue.setQueryData(ke.budget(t),m))}}p!==null&&Ue.getQueryData(ke.payees(t));const v=g.docs.map(_=>{const C=_.data,x=C.year,S=C.month;return c3(C,t,x,S)});for(const _ of v){const C=Ue.getQueryData(ke.month(t,_.year,_.month));C?.month&&D1(C.month.updated_at,_.updated_at)&&(e.some(S=>S.type==="month"&&S.budgetId===t&&S.year===_.year&&S.month===_.month)?n.push(`Month ${_.year}/${_.month} has been updated remotely (you have unsaved local changes)`):Ue.setQueryData(ke.month(t,_.year,_.month),{month:_}))}return n}function d3(t,e){const{setSyncError:n,getChanges:r}=fc(),i=D.useRef(null),o=D.useRef(null),l=D.useRef(0),d=D.useRef(!1);D.useEffect(()=>{if(!t||!e||d.current)return;d.current=!0;const h=async()=>{try{const m=r(),p=await u3(t,m);if(p.length>0){const g=`Sync conflict detected: ${p.join("; ")}`;n(g),pr.add({type:"error",message:g,autoDismissMs:0})}else n(null)}catch(m){console.error("[useSyncCheck] Sync check failed:",m);const p=`Failed to check for sync conflicts: ${m instanceof Error?m.message:String(m)}`;n(p),pr.add({type:"error",message:p,autoDismissMs:0})}};return o.current=setTimeout(()=>{h(),l.current=Date.now(),i.current=setInterval(()=>{h(),l.current=Date.now()},k1)},k1),()=>{o.current&&clearTimeout(o.current),i.current&&clearInterval(i.current),d.current=!1}},[t,e,n,r])}function h3(t,e,n){const r=Vt(),i=D.useRef(null),o=D.useRef(null);D.useEffect(()=>{if(i.current===null||o.current===null){i.current=e,o.current=n;return}if(i.current===e&&o.current===n)return;if(!t){i.current=e,o.current=n;return}const l=xt(i.current,o.current),m=xt(e,n)>l?bT(e,n):Xl(e,n),p=ke.month(t,m.year,m.month);if(!r.getQueryData(p)){const v=r.getQueryData(ke.budget(t)),_=xt(m.year,m.month);v?.monthMap&&_ in v.monthMap&&r.prefetchQuery({queryKey:p,queryFn:async()=>{const x=await N0(t,m.year,m.month);return x?{month:x}:null},staleTime:ac}).catch(x=>{console.warn(`[useMonthPrefetch] Failed to prefetch month ${m.year}/${m.month}:`,x)})}i.current=e,o.current=n},[t,e,n,r])}function ka(){Ue.removeQueries({queryKey:["budget"]}),Ue.removeQueries({queryKey:["month"]}),Ue.removeQueries({queryKey:["accessibleBudgets"]}),Ue.removeQueries({queryKey:["payees"]}),Ue.removeQueries({queryKey:["user"]}),console.log("[Migration] All caches cleared")}async function ym(t){try{const e=await t();return ka(),e}catch(e){throw ka(),e}}const BT=D.createContext(null),O1={isOpen:!1,migrationName:"",stage:"",progress:null,currentItem:null,details:null,isComplete:!1,error:null};function f3({children:t}){const[e,n]=D.useState(O1),r=D.useCallback(()=>({setStage:d=>{n(h=>({...h,stage:d}))},setProgress:d=>{n(h=>({...h,progress:d}))},setCurrentItem:d=>{n(h=>({...h,currentItem:d}))},setDetails:d=>{n(h=>({...h,details:d}))},updateItemProgress:(d,h,m)=>{const p=h>0?Math.round(d/h*100):0;n(g=>({...g,progress:p,currentItem:m||`Item ${d} of ${h}`,details:`${d} / ${h} complete`}))}}),[]),i=D.useCallback(async(d,h)=>{n({isOpen:!0,migrationName:d,stage:"Starting migration...",progress:null,currentItem:null,details:null,isComplete:!1,error:null});const m=r();try{const p=await h(m);return ka(),n(g=>({...g,isComplete:!0,stage:"Migration complete",progress:100,details:p.errors.length>0?`Completed with ${p.errors.length} error(s)`:"All operations successful"})),p}catch(p){ka();const g=p instanceof Error?p.message:"Unknown error occurred";throw n(v=>({...v,isComplete:!0,error:g,stage:"Migration failed",progress:null})),p}},[r]),o=D.useCallback(()=>{n(d=>d.isComplete?O1:(console.warn("[MigrationProgress] Cannot close modal while migration is running"),d))},[]),l={state:e,runMigrationWithProgress:i,closeModal:o};return u.jsx(BT.Provider,{value:l,children:t})}function m3(){const t=D.useContext(BT);if(!t)throw new Error("useMigrationProgress must be used within MigrationProgressProvider");return t}async function p3(t){return(await On("budgets",`${t}: batch reading all budgets`)).docs.map(n=>({id:n.id,data:n.data}))}async function LT(t,e){return(await On("months",`${e}: batch reading months for budget ${t}`,[{field:"budget_id",op:"==",value:t}])).docs.map(i=>({id:i.id,data:i.data,budgetId:i.data.budget_id,year:i.data.year,month:i.data.month})).sort((i,o)=>i.year!==o.year?i.year-o.year:i.month-o.month)}async function Ba(t){const e=await p3(t),n=await On("months",`${t}: batch reading all months`),r=new Map;for(const i of n.docs){const o=i.data.budget_id,l={id:i.id,data:i.data,budgetId:o,year:i.data.year,month:i.data.month};r.has(o)||r.set(o,[]),r.get(o).push(l)}for(const i of r.values())i.sort((o,l)=>o.year!==l.year?o.year-l.year:o.month-l.month);return{budgets:e,monthsByBudget:r}}async function ld(t,e){if(t.length===0)return;const n=t.map(r=>({collectionPath:"months",docId:fs(r.budgetId,r.year,r.month),data:ja({...r.data,updated_at:new Date().toISOString()})}));await dm(n,`${e}: batch writing ${t.length} months`)}async function UT(t,e){if(t.length===0)return;const n=t.map(r=>({collectionPath:"budgets",docId:r.budgetId,data:ja({...r.data,updated_at:new Date().toISOString()})}));await dm(n,`${e}: batch writing ${t.length} budgets`)}async function FT(t,e,n){if(e.length===0)return;let r=B0;const i=[];for(const p of e){const g=L0(p,r);i.push(g),r=Fu(g)}const o=i.map(p=>({budgetId:t,year:p.year,month:p.month,data:p}));await ld(o,n);const l=r.accountEndBalances,d=r.categoryEndBalances,{exists:h,data:m}=await jt("budgets",t,`${n}: reading budget for final update`);if(h&&m){const p=vT(m.month_map||{}),g=U0(p),v={...d},_=m.categories||{};for(const C of Object.keys(_))C in v||(v[C]=0);await wT(t,l,v,g)}}async function g3(t,e){if(t.length===0)return;const n=new Map;for(const r of t)n.has(r.budgetId)||n.set(r.budgetId,[]),n.get(r.budgetId).push(r);for(const[r,i]of n){i.sort((d,h)=>d.year!==h.year?d.year-h.year:d.month-h.month),await ld(i,e);const l=(await LT(r,e)).map(d=>d.data);await FT(r,l,e)}}async function y3(t){const{exists:e,data:n}=await jt("budgets",t,`[delete all months] reading budget ${t} for reset`);if(!e||!n)return;const r={...n.accounts};for(const o of Object.keys(r))r[o]&&typeof r[o]=="object"&&(r[o]={...r[o],balance:0});const i={...n.categories};for(const o of Object.keys(i))i[o]&&typeof i[o]=="object"&&(i[o]={...i[o],balance:0});await qn("budgets",t,{...n,accounts:r,categories:i,month_map:{},total_available:0,is_needs_recalculation:!1,updated_at:new Date().toISOString()},`[delete all months] resetting budget ${t} balances to zero`)}function _3({currentUser:t,onComplete:e}){const[n,r]=D.useState(!1),[i,o]=D.useState(!1),[l,d]=D.useState(null),[h,m]=D.useState(null),[p,g]=D.useState(null);async function v(){if(t){r(!0);try{const C=await On("months","delete all months: scanning for all months"),x=[],S=new Set;for(const E of C.docs){const{budget_id:T,year:I,month:M}=E.data;S.add(T),x.push({docId:E.id,budgetId:T,year:I,month:M})}x.sort((E,T)=>E.budgetId!==T.budgetId?E.budgetId.localeCompare(T.budgetId):E.year!==T.year?E.year-T.year:E.month-T.month),d({monthsToDelete:x,monthsCount:x.length,budgetCount:S.size})}catch{}finally{r(!1)}}}async function _(){if(!t||!l||l.monthsToDelete.length===0)return;o(!0),m(null);const C=l.monthsToDelete.length,x=new Set,S=[];for(const L of l.monthsToDelete)x.add(L.budgetId);g({phase:"deleting",deleted:0,total:C,currentMonth:null,budgetsRecalculated:0,totalBudgets:l.budgetCount,percentComplete:0});const E=l.monthsToDelete.map(L=>({collectionPath:"months",docId:L.docId}));let T=0;try{await _T(E,"delete all months: batch deleting all month documents",L=>{T=L,g({phase:"deleting",deleted:L,total:C,currentMonth:`Batch ${Math.ceil(L/500)} of ${Math.ceil(C/500)}`,budgetsRecalculated:0,totalBudgets:l.budgetCount,percentComplete:Math.round(L/C*70)})}),T=C}catch(L){S.push(`Batch delete failed: ${L instanceof Error?L.message:"Unknown error"}`)}const I=Array.from(x);let M=0;for(const L of I){g({phase:"resetting-budgets",deleted:T,total:C,currentMonth:`Budget ${M+1}/${I.length}`,budgetsRecalculated:M,totalBudgets:I.length,percentComplete:70+Math.round(M/I.length*25)});try{await y3(L),M++}catch{M++}}g({phase:"clearing-cache",deleted:T,total:C,currentMonth:null,budgetsRecalculated:M,totalBudgets:I.length,percentComplete:95}),ka(),g({phase:"complete",deleted:T,total:C,currentMonth:null,budgetsRecalculated:M,totalBudgets:I.length,percentComplete:100}),m({deleted:T,errors:S,budgetsRecalculated:M}),o(!1),g(null),S.length===0&&(d({monthsToDelete:[],monthsCount:0,budgetCount:0}),e?.())}return{status:l,isScanning:n,scanStatus:v,isDeleting:i,deleteResult:h,deleteProgress:p,deleteAllMonths:_}}const qg="sample@sample.com",po="budget_1767746876726_xuj7nzl4l";function b3({currentUser:t,onComplete:e}){const[n,r]=D.useState(!1),[i,o]=D.useState(!1),[l,d]=D.useState(null),[h,m]=D.useState(null),[p,g]=D.useState(null);async function v(){if(t){r(!0);try{let x=(await On("budgets","delete sample user budget: scanning for sample user budgets",[{field:"owner_email",op:"==",value:qg}])).docs;if(x.length===0){console.log("delete sample user budget: no budgets found by owner_email, checking fallback budget ID");const L=await jt("budgets",po,"delete sample user budget: checking fallback budget ID");L.exists&&L.data&&(console.log("delete sample user budget: found fallback budget",po),x=[{id:po,data:L.data}])}const S=[];let E=0,T=!1;for(const L of x){const $=L.id,k=L.data.name,N=(await On("months",`delete sample user budget: counting months for budget ${$}`,[{field:"budget_id",op:"==",value:$}])).docs.length;E+=N,S.push({budgetId:$,budgetName:k,monthCount:N}),(await On("payees",`delete sample user budget: checking payees for budget ${$}`,[{field:"budget_id",op:"==",value:$}])).docs.length>0&&(T=!0)}const I=[],M=await On("users","delete sample user budget: finding sample user document",[{field:"email",op:"==",value:qg}]);M.docs.length>0&&M.docs[0].data.budget_ids?.includes(po)&&(S.some(A=>A.budgetId===po)||(console.log("delete sample user budget: found stale budget reference in sample user document",po),I.push(po))),d({budgets:S,totalBudgets:S.length,totalMonths:E,hasPayees:T,staleBudgetIds:I})}catch(C){console.error("Error scanning for sample user budgets:",C)}finally{r(!1)}}}async function _(){if(!t||!l||l.budgets.length===0&&l.staleBudgetIds.length===0)return;o(!0),m(null);const C=[];let x=0,S=0,E=0;const T=l.totalMonths,I=l.totalBudgets;g({phase:"deleting-months",monthsDeleted:0,totalMonths:T,budgetsDeleted:0,totalBudgets:I,percentComplete:0});for(const L of l.budgets)try{const k=(await On("months",`delete sample user budget: fetching month IDs for budget ${L.budgetId}`)).docs.filter(A=>A.data.budget_id===L.budgetId).map(A=>({collectionPath:"months",docId:A.id}));k.length>0&&(await _T(k,`delete sample user budget: deleting ${k.length} months for budget ${L.budgetId}`,A=>{x=A,g({phase:"deleting-months",monthsDeleted:x,totalMonths:T,budgetsDeleted:S,totalBudgets:I,percentComplete:Math.round(x/Math.max(T,1)*60)})}),x=k.length)}catch($){C.push(`Failed to delete months for budget ${L.budgetId}: ${$ instanceof Error?$.message:"Unknown error"}`)}g({phase:"deleting-payees",monthsDeleted:x,totalMonths:T,budgetsDeleted:S,totalBudgets:I,percentComplete:60});for(const L of l.budgets)try{await Iy("payees",L.budgetId,`delete sample user budget: deleting payees for budget ${L.budgetId}`),E++}catch{}g({phase:"deleting-budgets",monthsDeleted:x,totalMonths:T,budgetsDeleted:S,totalBudgets:I,percentComplete:70});for(const L of l.budgets)try{await Iy("budgets",L.budgetId,`delete sample user budget: deleting budget ${L.budgetId}`),S++,g({phase:"deleting-budgets",monthsDeleted:x,totalMonths:T,budgetsDeleted:S,totalBudgets:I,percentComplete:70+Math.round(S/I*10)})}catch($){C.push(`Failed to delete budget ${L.budgetId}: ${$ instanceof Error?$.message:"Unknown error"}`)}g({phase:"updating-user",monthsDeleted:x,totalMonths:T,budgetsDeleted:S,totalBudgets:I,percentComplete:80});const M=[...l.budgets.map(L=>L.budgetId),...l.staleBudgetIds];try{const L=await On("users","delete sample user budget: finding sample user document to remove budget references",[{field:"email",op:"==",value:qg}]);if(L.docs.length>0){const $=L.docs[0],k=$.id,A=$.data,N=(A.budget_ids||[]).filter(F=>!M.includes(F));await qn("users",k,{...A,budget_ids:N,updated_at:new Date().toISOString()},"delete sample user budget: removing deleted budget IDs from sample user document"),console.log(`delete sample user budget: removed ${M.length} budget IDs from sample user document`)}else console.log("delete sample user budget: no sample user document found, skipping user update")}catch(L){C.push(`Failed to update sample user document: ${L instanceof Error?L.message:"Unknown error"}`)}g({phase:"clearing-cache",monthsDeleted:x,totalMonths:T,budgetsDeleted:S,totalBudgets:I,percentComplete:95}),ka(),g({phase:"complete",monthsDeleted:x,totalMonths:T,budgetsDeleted:S,totalBudgets:I,percentComplete:100}),m({budgetsDeleted:S,monthsDeleted:x,payeesDeleted:E,errors:C}),o(!1),g(null),C.length===0&&(d({budgets:[],totalBudgets:0,totalMonths:0,hasPayees:!1,staleBudgetIds:[]}),e?.())}return{status:l,isScanning:n,scanStatus:v,isDeleting:i,deleteResult:h,deleteProgress:p,deleteSampleUserBudget:_}}function M1(t){if(!t)return 0;let e=0;for(const n of t)dt(n.start_balance??0)&&e++,dt(n.end_balance??0)&&e++,dt(n.allocated??0)&&e++,dt(n.spent??0)&&e++,dt(n.income??0)&&e++,dt(n.expenses??0)&&e++,dt(n.net_change??0)&&e++;return e}function N1(t){if(!t)return 0;let e=0;for(const n of t)dt(n.amount??0)&&e++;return e}async function P1(){const t=await On("budgets","precision cleanup: scanning all budgets");let e=0,n=0,r=0,i=0;for(const g of t.docs){const v=g.data;let _=!1;dt(v.total_available??0)&&(i++,_=!0);const C=v.accounts;if(C&&typeof C=="object")for(const S of Object.values(C))dt(S.balance??0)&&(n++,_=!0);const x=v.categories;if(x&&typeof x=="object")for(const S of Object.values(x))dt(S.balance??0)&&(r++,_=!0),dt(S.default_monthly_amount??0)&&(r++,_=!0);_&&e++}const o=await On("months","precision cleanup: scanning all months");let l=0,d=0,h=0,m=0,p=0;for(const g of o.docs){const v=g.data;let _=!1;(dt(v.total_income??0)||dt(v.total_expenses??0)||dt(v.previous_month_income??0))&&(_=!0);const C=N1(v.income);C>0&&(d+=C,_=!0);const x=N1(v.expenses);x>0&&(h+=x,_=!0);const S=M1(v.category_balances);S>0&&(m+=S,_=!0);const E=M1(v.account_balances);E>0&&(p+=E,_=!0),_&&l++}return{totalBudgets:t.docs.length,budgetsWithPrecisionIssues:e,accountsWithPrecisionIssues:n,categoriesWithPrecisionIssues:r,totalAvailableWithPrecisionIssues:i,totalMonths:o.docs.length,monthsWithPrecisionIssues:l,incomeValuesWithPrecisionIssues:d,expenseValuesWithPrecisionIssues:h,categoryBalancesWithPrecisionIssues:m,accountBalancesWithPrecisionIssues:p}}function z1(t){const e={...t};return e.start_balance!==void 0&&(e.start_balance=Oe(e.start_balance)),e.end_balance!==void 0&&(e.end_balance=Oe(e.end_balance)),e.allocated!==void 0&&(e.allocated=Oe(e.allocated)),e.spent!==void 0&&(e.spent=Oe(e.spent)),e.income!==void 0&&(e.income=Oe(e.income)),e.expenses!==void 0&&(e.expenses=Oe(e.expenses)),e.transfers!==void 0&&(e.transfers=Oe(e.transfers)),e.adjustments!==void 0&&(e.adjustments=Oe(e.adjustments)),e.net_change!==void 0&&(e.net_change=Oe(e.net_change)),e}function v3(t,e){let n=!1;dt(t.total_available??0)&&(t.total_available=Oe(t.total_available??0),e.totalAvailableFixed++,n=!0);const r=t.accounts;if(r&&typeof r=="object")for(const[o,l]of Object.entries(r)){const d=l;dt(d.balance??0)&&(r[o].balance=Oe(d.balance??0),e.accountsFixed++,n=!0)}const i=t.categories;if(i&&typeof i=="object")for(const[o,l]of Object.entries(i)){const d=l;dt(d.balance??0)&&(i[o].balance=Oe(d.balance??0),e.categoriesFixed++,n=!0),dt(d.default_monthly_amount??0)&&(i[o].default_monthly_amount=Oe(d.default_monthly_amount??0),e.categoriesFixed++,n=!0)}return{fixed:n,data:t}}function x3(t,e){let n=!1;if(dt(t.total_income??0)&&(t.total_income=Oe(t.total_income??0),n=!0),dt(t.total_expenses??0)&&(t.total_expenses=Oe(t.total_expenses??0),n=!0),dt(t.previous_month_income??0)&&(t.previous_month_income=Oe(t.previous_month_income??0),n=!0),t.income&&Array.isArray(t.income)){const r=[];for(const i of t.income)dt(i.amount??0)?(r.push({...i,amount:Oe(i.amount??0)}),e.incomeValuesFixed++,n=!0):r.push(i);t.income=r}if(t.expenses&&Array.isArray(t.expenses)){const r=[];for(const i of t.expenses)dt(i.amount??0)?(r.push({...i,amount:Oe(i.amount??0)}),e.expenseValuesFixed++,n=!0):r.push(i);t.expenses=r}if(t.category_balances&&Array.isArray(t.category_balances)){const r=[];for(const i of t.category_balances)dt(i.start_balance??0)||dt(i.end_balance??0)||dt(i.allocated??0)||dt(i.spent??0)||dt(i.transfers??0)||dt(i.adjustments??0)?(r.push(z1(i)),e.categoryBalancesFixed++,n=!0):r.push(i);t.category_balances=r}if(t.account_balances&&Array.isArray(t.account_balances)){const r=[];for(const i of t.account_balances)dt(i.start_balance??0)||dt(i.end_balance??0)||dt(i.income??0)||dt(i.expenses??0)||dt(i.transfers??0)||dt(i.adjustments??0)||dt(i.net_change??0)?(r.push(z1(i)),e.accountBalancesFixed++,n=!0):r.push(i);t.account_balances=r}return{fixed:n,data:t}}function w3(t,e,n){const r={...t.data},{fixed:i,data:o}=v3(r,n),l=i?{budgetId:t.id,data:o}:null;i&&n.budgetsProcessed++;const d=[];let h=!1;for(const m of e){const p={...m.data},{fixed:g,data:v}=x3(p,n);g&&(n.monthsProcessed++,h=!0),d.push(v)}return{budgetUpdate:l,fixedMonths:d,hasMonthFixes:h}}async function S3(){const t={budgetsProcessed:0,accountsFixed:0,categoriesFixed:0,totalAvailableFixed:0,monthsProcessed:0,incomeValuesFixed:0,expenseValuesFixed:0,categoryBalancesFixed:0,accountBalancesFixed:0,errors:[]},{budgets:e,monthsByBudget:n}=await Ba("precision cleanup"),r=[],i=[];for(const o of e)try{const l=n.get(o.id)||[],{budgetUpdate:d,fixedMonths:h,hasMonthFixes:m}=w3(o,l,t);d&&r.push(d),(m||h.length>0)&&i.push({budgetId:o.id,months:h})}catch(l){t.errors.push(`Budget ${o.id}: ${l instanceof Error?l.message:String(l)}`)}if(r.length>0)try{await UT(r,"precision cleanup")}catch(o){t.errors.push(`Budget batch write: ${o instanceof Error?o.message:String(o)}`)}for(const{budgetId:o,months:l}of i)try{await FT(o,l,"precision cleanup")}catch(d){t.errors.push(`Budget ${o} recalc: ${d instanceof Error?d.message:String(d)}`)}return t}function C3({currentUser:t,onComplete:e}){const[n,r]=D.useState(null),[i,o]=D.useState(!1),[l,d]=D.useState(!1),[h,m]=D.useState(null),[p,g]=D.useState(null),v=n?n.accountsWithPrecisionIssues+n.categoriesWithPrecisionIssues+n.totalAvailableWithPrecisionIssues+n.incomeValuesWithPrecisionIssues+n.expenseValuesWithPrecisionIssues+n.categoryBalancesWithPrecisionIssues+n.accountBalancesWithPrecisionIssues:0,_=v>0,C=D.useCallback(async()=>{if(t){o(!0),g(null);try{const S=await P1();r(S),m(null)}catch(S){g(S instanceof Error?S.message:"Failed to scan for precision issues")}finally{o(!1)}}},[t]),x=D.useCallback(async()=>{if(!(!t||!_)){d(!0),g(null);try{const S=await ym(()=>S3());m(S);const E=await P1();r(E),e?.()}catch(S){g(S instanceof Error?S.message:"Failed to run precision cleanup")}finally{d(!1)}}},[t,_,e]);return{status:n,isScanning:i,isRunning:l,result:h,error:p,totalIssues:v,hasIssues:_,hasData:n!==null,scan:C,runCleanup:x}}function _m(t){const e=t.income||[],n=t.expenses||[],r=Oe(e.reduce((d,h)=>d+h.amount,0)),i=Oe(n.reduce((d,h)=>d+h.amount,0)),o=E3(t),l=T3(t);return{...t,total_income:r,total_expenses:i,account_balances:o,category_balances:l}}function E3(t){const e=t.income||[],n=t.expenses||[],r=t.transfers||[],i=t.adjustments||[],o=t.account_balances||[],l=new Map;for(const m of o)et(m.account_id)||l.set(m.account_id,m);const d=new Set;for(const m of e)et(m.account_id)||d.add(m.account_id);for(const m of n)et(m.account_id)||d.add(m.account_id);for(const m of r)et(m.from_account_id)||d.add(m.from_account_id),et(m.to_account_id)||d.add(m.to_account_id);for(const m of i)et(m.account_id)||d.add(m.account_id);for(const m of o)et(m.account_id)||d.add(m.account_id);const h=[];for(const m of d){const p=l.get(m),g=Oe(p?.start_balance??0),v=Oe(e.filter(I=>I.account_id===m).reduce((I,M)=>I+M.amount,0)),_=Oe(n.filter(I=>I.account_id===m).reduce((I,M)=>I+M.amount,0)),C=Oe(r.filter(I=>I.from_account_id===m).reduce((I,M)=>I-M.amount,0)),x=Oe(r.filter(I=>I.to_account_id===m).reduce((I,M)=>I+M.amount,0)),S=Oe(x+C),E=Oe(i.filter(I=>I.account_id===m).reduce((I,M)=>I+M.amount,0)),T=Oe(v+_+S+E);h.push({account_id:m,start_balance:g,income:v,expenses:_,transfers:S,adjustments:E,net_change:T,end_balance:Oe(g+T)})}return h}function T3(t){const e=t.expenses||[],n=t.transfers||[],r=t.adjustments||[],i=t.category_balances||[],o=new Map;for(const g of i)at(g.category_id)||o.set(g.category_id,g);const l=new Map;for(const g of e){if(at(g.category_id))continue;const v=l.get(g.category_id)||0;l.set(g.category_id,v+g.amount)}const d=new Map;for(const g of n){if(!at(g.from_category_id)){const v=d.get(g.from_category_id)||0;d.set(g.from_category_id,v-g.amount)}if(!at(g.to_category_id)){const v=d.get(g.to_category_id)||0;d.set(g.to_category_id,v+g.amount)}}const h=new Map;for(const g of r)if(!at(g.category_id)){const v=h.get(g.category_id)||0;h.set(g.category_id,v+g.amount)}const m=new Set;for(const g of i)at(g.category_id)||m.add(g.category_id);for(const g of e)at(g.category_id)||m.add(g.category_id);for(const g of n)at(g.from_category_id)||m.add(g.from_category_id),at(g.to_category_id)||m.add(g.to_category_id);for(const g of r)at(g.category_id)||m.add(g.category_id);const p=[];for(const g of m){const v=o.get(g),_=Oe(l.get(g)??0),C=Oe(d.get(g)??0),x=Oe(h.get(g)??0);if(v){const S=Oe(v.start_balance),E=Oe(v.allocated);p.push({category_id:g,start_balance:S,allocated:E,spent:_,transfers:C,adjustments:x,end_balance:Oe(S+E+_+C+x)})}else p.push({category_id:g,start_balance:0,allocated:0,spent:_,transfers:C,adjustments:x,end_balance:Oe(_+C+x)})}return p}const A3=["unknown","Unknown","UNKNOWN","","null","undefined","N/A","n/a"],j3=["unknown","Unknown","UNKNOWN","","null","undefined","N/A","n/a"];function bm(t){return!t||et(t)?!0:A3.includes(t)}function vm(t){return!t||at(t)?!0:j3.includes(t)}function VT(t){return bm(t.account_id)||vm(t.category_id)}function R3(t){return{id:t.id.replace("expense_","adjustment_"),amount:t.amount,account_id:bm(t.account_id)?Ht:t.account_id,category_id:vm(t.category_id)?Yt:t.category_id,date:t.date,description:t.description||t.payee,cleared:t.cleared,created_at:t.created_at}}function I3(t){const e=t.data,n=e.expenses||[],r=e.adjustments||[],i=[],o=[];let l=0,d=0;for(const m of n)VT(m)?(bm(m.account_id)&&!et(m.account_id)&&l++,vm(m.category_id)&&!at(m.category_id)&&d++,o.push(R3(m))):i.push(m);return o.length===0?{needsUpdate:!1,updatedMonth:null,stats:{expensesMigrated:0,invalidAccountsFixed:0,invalidCategoriesFixed:0}}:{needsUpdate:!0,updatedMonth:_m({...e,expenses:i,adjustments:[...r,...o],transfers:e.transfers||[],updated_at:new Date().toISOString()}),stats:{expensesMigrated:o.length,invalidAccountsFixed:l,invalidCategoriesFixed:d}}}async function k3(){const{budgets:t,monthsByBudget:e}=await Ba("expense-to-adjustment-scan");let n=0,r=0,i=0,o=0;for(const l of t){const d=e.get(l.id)||[];n+=d.length;for(const h of d){const p=h.data.expenses||[];for(const g of p)VT(g)&&(r++,bm(g.account_id)&&!et(g.account_id)&&i++,vm(g.category_id)&&!at(g.category_id)&&o++)}}return{totalBudgets:t.length,totalMonths:n,expensesToMigrate:r,invalidAccountsToFix:i,invalidCategoriesToFix:o}}async function D3(){const{budgets:t,monthsByBudget:e}=await Ba("expense-to-adjustment-migration"),n=[];let r=0,i=0,o=0;const l=[];for(const d of t){const h=e.get(d.id)||[];for(const m of h)try{const{needsUpdate:p,updatedMonth:g,stats:v}=I3(m);p&&g&&(n.push({budgetId:d.id,year:m.year,month:m.month,data:g}),r+=v.expensesMigrated,i+=v.invalidAccountsFixed,o+=v.invalidCategoriesFixed)}catch(p){l.push(`Month ${m.year}/${m.month} in budget ${d.id}: ${p instanceof Error?p.message:String(p)}`)}}return n.length>0&&await ld(n,"expense-to-adjustment-migration"),{budgetsProcessed:t.length,monthsProcessed:n.length,expensesMigrated:r,invalidAccountsFixed:i,invalidCategoriesFixed:o,errors:l}}function O3({currentUser:t,onComplete:e}){const[n,r]=D.useState(!1),[i,o]=D.useState(!1),[l,d]=D.useState(null),[h,m]=D.useState(null);async function p(){if(t){r(!0);try{const _=await k3();d(_)}catch(_){console.error("Failed to scan for expense to adjustment migration:",_)}finally{r(!1)}}}async function g(){if(t){o(!0),m(null);try{const _=await ym(()=>D3());m(_),e?.()}catch(_){m({budgetsProcessed:0,monthsProcessed:0,expensesMigrated:0,invalidAccountsFixed:0,invalidCategoriesFixed:0,errors:[_ instanceof Error?_.message:"Unknown error"]})}finally{o(!1)}}}const v=l!==null&&l.expensesToMigrate>0;return{status:l,isScanning:n,scanStatus:p,hasItemsToMigrate:v,isRunning:i,result:h,runMigration:g}}function $T(t){const e=new Set,n=new Set,r=t.categories;if(r)for(const o of Object.keys(r))e.add(o);const i=t.accounts;if(i)for(const o of Object.keys(i))n.add(o);return{categoryIds:e,accountIds:n}}function fa(t,e){return!t||at(t)?!1:!e.has(t)}function Bs(t,e){return!t||et(t)?!1:!e.has(t)}function M3(t,e){const n=t.data;let r=0,i=0,o=0,l=0,d=0,h=0,m=!1;const p=(n.expenses||[]).map(x=>{const S={...x};let E=!1;return fa(x.category_id,e.categoryIds)&&(S.category_id=Yt,r++,E=!0),Bs(x.account_id,e.accountIds)&&(S.account_id=Ht,i++,E=!0),E&&(o++,m=!0),S}),g=(n.income||[]).map(x=>{const S={...x};let E=!1;return Bs(x.account_id,e.accountIds)&&(S.account_id=Ht,i++,E=!0),E&&(l++,m=!0),S}),v=(n.transfers||[]).map(x=>{const S={...x};let E=!1;return fa(x.from_category_id,e.categoryIds)&&(S.from_category_id=Yt,r++,E=!0),fa(x.to_category_id,e.categoryIds)&&(S.to_category_id=Yt,r++,E=!0),Bs(x.from_account_id,e.accountIds)&&(S.from_account_id=Ht,i++,E=!0),Bs(x.to_account_id,e.accountIds)&&(S.to_account_id=Ht,i++,E=!0),E&&(d++,m=!0),S}),_=(n.adjustments||[]).map(x=>{const S={...x};let E=!1;return fa(x.category_id,e.categoryIds)&&(S.category_id=Yt,r++,E=!0),Bs(x.account_id,e.accountIds)&&(S.account_id=Ht,i++,E=!0),E&&(h++,m=!0),S});return m?{needsUpdate:!0,updatedMonth:{...n,expenses:p,income:g,transfers:v,adjustments:_,updated_at:new Date().toISOString()},stats:{categoryIdsFixed:r,accountIdsFixed:i,affectedExpenses:o,affectedIncome:l,affectedTransfers:d,affectedAdjustments:h}}:{needsUpdate:!1,updatedMonth:null,stats:{categoryIdsFixed:0,accountIdsFixed:0,affectedExpenses:0,affectedIncome:0,affectedTransfers:0,affectedAdjustments:0}}}async function N3(){const{budgets:t,monthsByBudget:e}=await Ba("orphaned-id-scan");let n=0,r=0,i=0,o=0,l=0,d=0,h=0;for(const m of t){const p=$T(m.data),g=e.get(m.id)||[];n+=g.length;for(const v of g){const _=v.data;for(const C of _.expenses||[]){let x=!1;fa(C.category_id,p.categoryIds)&&(r++,x=!0),Bs(C.account_id,p.accountIds)&&(i++,x=!0),x&&o++}for(const C of _.income||[])Bs(C.account_id,p.accountIds)&&(i++,l++);for(const C of _.transfers||[]){let x=!1;fa(C.from_category_id,p.categoryIds)&&(r++,x=!0),fa(C.to_category_id,p.categoryIds)&&(r++,x=!0),Bs(C.from_account_id,p.accountIds)&&(i++,x=!0),Bs(C.to_account_id,p.accountIds)&&(i++,x=!0),x&&d++}for(const C of _.adjustments||[]){let x=!1;fa(C.category_id,p.categoryIds)&&(r++,x=!0),Bs(C.account_id,p.accountIds)&&(i++,x=!0),x&&h++}}}return{totalBudgets:t.length,totalMonths:n,orphanedCategoryIds:r,orphanedAccountIds:i,affectedExpenses:o,affectedIncome:l,affectedTransfers:d,affectedAdjustments:h}}async function P3(){const{budgets:t,monthsByBudget:e}=await Ba("orphaned-id-cleanup"),n=[];let r=0,i=0;const o=[];for(const l of t){const d=$T(l.data),h=e.get(l.id)||[];for(const m of h)try{const{needsUpdate:p,updatedMonth:g,stats:v}=M3(m,d);p&&g&&(n.push({budgetId:l.id,year:m.year,month:m.month,data:g}),r+=v.categoryIdsFixed,i+=v.accountIdsFixed)}catch(p){o.push(`Month ${m.year}/${m.month} in budget ${l.id}: ${p instanceof Error?p.message:String(p)}`)}}return n.length>0&&await ld(n,"orphaned-id-cleanup"),{budgetsProcessed:t.length,monthsProcessed:n.length,categoryIdsFixed:r,accountIdsFixed:i,errors:o}}function z3({currentUser:t,onComplete:e}){const[n,r]=D.useState(!1),[i,o]=D.useState(!1),[l,d]=D.useState(null),[h,m]=D.useState(null);async function p(){if(t){r(!0);try{const _=await N3();d(_)}catch(_){console.error("Failed to scan for orphaned IDs:",_)}finally{r(!1)}}}async function g(){if(t){o(!0),m(null);try{const _=await ym(()=>P3());m(_),e?.()}catch(_){m({budgetsProcessed:0,monthsProcessed:0,categoryIdsFixed:0,accountIdsFixed:0,errors:[_ instanceof Error?_.message:"Unknown error"]})}finally{o(!1)}}}const v=l!==null&&(l.orphanedCategoryIds>0||l.orphanedAccountIds>0);return{status:l,isScanning:n,scanStatus:p,hasItemsToFix:v,isRunning:i,result:h,runMigration:g}}function B3(t,e){if(t.date!==e.date||Math.abs(t.amount+e.amount)>.001)return null;const n=t.amount<0?t:e,r=t.amount<0?e:t,i=at(t.category_id)&&at(e.category_id),o=!et(t.account_id)&&!et(e.account_id),l=t.account_id!==e.account_id;if(i&&o&&l)return{negative:n,positive:r,type:"account"};const d=et(t.account_id)&&et(e.account_id),h=!at(t.category_id)&&!at(e.category_id),m=t.category_id!==e.category_id;return d&&h&&m?{negative:n,positive:r,type:"category"}:null}function qT(t){const e=[],n=new Set;for(let r=0;r<t.length;r++)if(!n.has(t[r].id))for(let i=r+1;i<t.length;i++){if(n.has(t[i].id))continue;const o=B3(t[r],t[i]);if(o){e.push(o),n.add(t[r].id),n.add(t[i].id);break}}return e}function L3(t){const{negative:e,positive:n,type:r}=t;return r==="account"?{id:`transfer_from_adj_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,amount:Math.abs(e.amount),from_account_id:e.account_id,to_account_id:n.account_id,from_category_id:Yt,to_category_id:Yt,date:e.date,description:e.description||n.description||"Transfer",cleared:e.cleared&&n.cleared,created_at:new Date().toISOString()}:{id:`transfer_from_adj_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,amount:Math.abs(e.amount),from_account_id:Ht,to_account_id:Ht,from_category_id:e.category_id,to_category_id:n.category_id,date:e.date,description:e.description||n.description||"Transfer",cleared:e.cleared&&n.cleared,created_at:new Date().toISOString()}}function U3(t){const e=t.data,n=e.adjustments||[],r=e.transfers||[],i=qT(n);if(i.length===0)return{needsUpdate:!1,updatedMonth:null,stats:{pairsConverted:0,adjustmentsRemoved:0}};const o=i.map(L3),l=new Set;for(const m of i)l.add(m.negative.id),l.add(m.positive.id);const d=n.filter(m=>!l.has(m.id));return{needsUpdate:!0,updatedMonth:{...e,adjustments:d,transfers:[...r,...o],updated_at:new Date().toISOString()},stats:{pairsConverted:i.length,adjustmentsRemoved:l.size}}}async function F3(){const{budgets:t,monthsByBudget:e}=await Ba("adjustments-to-transfers-scan");let n=0,r=0,i=0,o=0;for(const l of t){const d=e.get(l.id)||[];n+=d.length;for(const h of d){const p=h.data.adjustments||[],g=qT(p);r+=g.length;for(const v of g)v.type==="account"?i++:o++}}return{totalBudgets:t.length,totalMonths:n,pairsFound:r,accountTransferPairs:i,categoryTransferPairs:o}}async function V3(){const{budgets:t,monthsByBudget:e}=await Ba("adjustments-to-transfers-migration"),n=[];let r=0,i=0;const o=[];for(const l of t){const d=e.get(l.id)||[];for(const h of d)try{const{needsUpdate:m,updatedMonth:p,stats:g}=U3(h);m&&p&&(n.push({budgetId:l.id,year:h.year,month:h.month,data:p}),r+=g.pairsConverted,i+=g.adjustmentsRemoved)}catch(m){o.push(`Month ${h.year}/${h.month} in budget ${l.id}: ${m instanceof Error?m.message:String(m)}`)}}return n.length>0&&await ld(n,"adjustments-to-transfers-migration"),{budgetsProcessed:t.length,monthsProcessed:n.length,transfersCreated:r,adjustmentsRemoved:i,errors:o}}function $3({currentUser:t,onComplete:e}){const[n,r]=D.useState(!1),[i,o]=D.useState(!1),[l,d]=D.useState(null),[h,m]=D.useState(null);async function p(){if(t){r(!0);try{const _=await F3();d(_)}catch(_){console.error("Failed to scan for adjustment pairs:",_)}finally{r(!1)}}}async function g(){if(t){o(!0),m(null);try{const _=await ym(()=>V3());m(_),e?.()}catch(_){m({budgetsProcessed:0,monthsProcessed:0,transfersCreated:0,adjustmentsRemoved:0,errors:[_ instanceof Error?_.message:"Unknown error"]})}finally{o(!1)}}}const v=l!==null&&l.pairsFound>0;return{status:l,isScanning:n,scanStatus:p,hasPairsToConvert:v,isRunning:i,result:h,runMigration:g}}function q3(t){const e=[];let n="",r=!1;for(let i=0;i<t.length;i++){const o=t[i];o==='"'?r=!r:o===","&&!r?(e.push(n.trim()),n=""):n+=o}return e.push(n.trim()),e}function H3(t){if(!t)return 0;let e=t.replace(/[$\s]/g,"");const n=e.startsWith("(")||e.startsWith("-");e=e.replace(/[()]/g,"").replace("-",""),e=e.replace(/,/g,"");const r=parseFloat(e);return isNaN(r)?0:n?-r:r}function G3(t){if(!t)return null;const e=t.split("/");if(e.length!==3)return null;const n=parseInt(e[0],10),r=parseInt(e[1],10),i=parseInt(e[2],10);return isNaN(n)||isNaN(r)||isNaN(i)||n<1||n>12||r<1||r>31?null:{year:i,month:n,day:r}}function Q3(t){if(!t)return!1;const e=t.toLowerCase().trim();return e==="true"||e==="1"||e==="yes"}function W3(t,e){return e.toLowerCase()==="income"?"income":t.toLowerCase()==="budget allocation"?"allocation":"spend"}function K3(t){const e=t.split(`
`).filter(r=>r.trim()),n=[];for(const r of e){const i=q3(r);if(i.length<5)continue;const[o,l,d,h,m,p,g]=i;if(o.toLowerCase()==="cash flow"||o.toLowerCase()==="date")continue;const v=G3(o);if(!v)continue;const _=W3(l,d),C=H3(m),x=Q3(g||"");n.push({recordType:_,date:o,year:v.year,month:v.month,day:v.day,payee:l,category:d,account:h,amount:C,description:p||"",cleared:x,rawLine:r})}return n}function Y3(t){return!t.account_id||t.account_id.trim()===""?"Missing account_id (empty or undefined)":null}function X3(t){const e=[];return(!t.account_id||t.account_id.trim()==="")&&e.push("missing account_id"),(!t.category_id||t.category_id.trim()==="")&&e.push("missing category_id"),e.length>0?e.join(", "):null}function Z3(t){const e=et(t.account_id)||!t.account_id||t.account_id.trim()==="",n=at(t.category_id)||!t.category_id||t.category_id.trim()==="";return e&&n?"Both account_id and category_id are missing/NO_* (must have at least one real ID)":null}function J3(t){const e=[];if((!t.from_account_id||t.from_account_id.trim()==="")&&e.push("missing from_account_id"),(!t.to_account_id||t.to_account_id.trim()==="")&&e.push("missing to_account_id"),(!t.from_category_id||t.from_category_id.trim()==="")&&e.push("missing from_category_id"),(!t.to_category_id||t.to_category_id.trim()==="")&&e.push("missing to_category_id"),e.length>0)return e.join(", ");const n=t.from_account_id===t.to_account_id,r=t.from_category_id===t.to_category_id;if(n&&r)return"Transfer has same from/to on both account and category (nothing would transfer)";const i=et(t.from_account_id),o=et(t.to_account_id),l=at(t.from_category_id),d=at(t.to_category_id);return i&&o&&l&&d?"All from/to account and category IDs are NO_* (must involve at least one real entity)":i&&o&&r?"Both accounts are NO_ACCOUNT and categories are the same (nothing transfers)":l&&d&&n?"Both categories are NO_CATEGORY and accounts are the same (nothing transfers)":null}function Vh(t,e,n,r,i){return t.filter(o=>{const[l,d,h]=e.split("-").map(Number);return o.year!==l||o.month!==d||o.day!==h||Math.abs(Math.abs(o.amount)-Math.abs(n))>.01?!1:(r&&o.payee&&o.payee.toLowerCase()===r.toLowerCase()||i&&o.description&&o.description.toLowerCase().includes(i.toLowerCase()),!0)})}async function eP(t){const e=[];let n=0,r=0,i=0,o=0;const l=t?K3(t):[],{budgets:d,monthsByBudget:h}=await Ba("account-category-validation");for(const m of d){const p=h.get(m.id)||[];for(const g of p){const v=g.data,_=`${v.year}-${String(v.month).padStart(2,"0")}`,C=v.income||[];n+=C.length;for(const T of C){const I=Y3(T);I&&e.push({budgetId:m.id,monthKey:_,transactionType:"income",transactionId:T.id,violation:I,transactionDetails:{date:T.date,amount:T.amount,payee:T.payee,description:T.description,accountId:T.account_id},potentialSeedMatches:Vh(l,T.date,T.amount,T.payee,T.description)})}const x=v.expenses||[];r+=x.length;for(const T of x){const I=X3(T);I&&e.push({budgetId:m.id,monthKey:_,transactionType:"expense",transactionId:T.id,violation:I,transactionDetails:{date:T.date,amount:T.amount,payee:T.payee,description:T.description,accountId:T.account_id,categoryId:T.category_id},potentialSeedMatches:Vh(l,T.date,T.amount,T.payee,T.description)})}const S=v.adjustments||[];i+=S.length;for(const T of S){const I=Z3(T);I&&e.push({budgetId:m.id,monthKey:_,transactionType:"adjustment",transactionId:T.id,violation:I,transactionDetails:{date:T.date,amount:T.amount,description:T.description,accountId:T.account_id,categoryId:T.category_id},potentialSeedMatches:Vh(l,T.date,T.amount,void 0,T.description)})}const E=v.transfers||[];o+=E.length;for(const T of E){const I=J3(T);I&&e.push({budgetId:m.id,monthKey:_,transactionType:"transfer",transactionId:T.id,violation:I,transactionDetails:{date:T.date,amount:T.amount,description:T.description,fromAccountId:T.from_account_id,toAccountId:T.to_account_id,fromCategoryId:T.from_category_id,toCategoryId:T.to_category_id},potentialSeedMatches:Vh(l,T.date,T.amount,void 0,T.description)})}}}return e.sort((m,p)=>{const g=m.monthKey.localeCompare(p.monthKey);return g!==0?g:m.transactionType.localeCompare(p.transactionType)}),{totalBudgets:d.length,totalMonths:Array.from(h.values()).reduce((m,p)=>m+p.length,0),totalIncome:n,totalExpenses:r,totalAdjustments:i,totalTransfers:o,violations:e,scannedAt:new Date().toISOString()}}function tP(t){const e=[];if(e.push("=".repeat(80),"ACCOUNT/CATEGORY VALIDATION REPORT",`Scanned at: ${t.scannedAt}`,"=".repeat(80),"","SUMMARY:"),e.push(`  Budgets scanned: ${t.totalBudgets}`,`  Months scanned: ${t.totalMonths}`,`  Income transactions: ${t.totalIncome}`,`  Expense transactions: ${t.totalExpenses}`,`  Adjustment transactions: ${t.totalAdjustments}`,`  Transfer transactions: ${t.totalTransfers}`,`  VIOLATIONS FOUND: ${t.violations.length}`,""),t.violations.length===0)return e.push(" No violations found!"),e.join(`
`);const n=new Map;for(const r of t.violations)n.has(r.transactionType)||n.set(r.transactionType,[]),n.get(r.transactionType).push(r);e.push("-".repeat(80),"VIOLATIONS BY TYPE:","-".repeat(80));for(const[r,i]of n){e.push("",`## ${r.toUpperCase()} (${i.length} violations)`,"");for(const o of i){if(e.push(`  [${o.monthKey}] ID: ${o.transactionId}`,`    Violation: ${o.violation}`,`    Date: ${o.transactionDetails.date}`,`    Amount: ${o.transactionDetails.amount}`),o.transactionDetails.payee&&e.push(`    Payee: ${o.transactionDetails.payee}`),o.transactionDetails.description&&e.push(`    Description: ${o.transactionDetails.description}`),o.transactionDetails.accountId!==void 0&&e.push(`    Account ID: ${o.transactionDetails.accountId||"(empty)"}`),o.transactionDetails.categoryId!==void 0&&e.push(`    Category ID: ${o.transactionDetails.categoryId||"(empty)"}`),o.transactionDetails.fromAccountId!==void 0&&e.push(`    From Account: ${o.transactionDetails.fromAccountId||"(empty)"}`,`    To Account: ${o.transactionDetails.toAccountId||"(empty)"}`,`    From Category: ${o.transactionDetails.fromCategoryId||"(empty)"}`,`    To Category: ${o.transactionDetails.toCategoryId||"(empty)"}`),o.potentialSeedMatches.length>0){e.push(`    POTENTIAL SEED MATCHES (${o.potentialSeedMatches.length}):`);for(const l of o.potentialSeedMatches.slice(0,5))e.push(`      - Line: ${l.rawLine}`,`        Type: ${l.recordType}, Date: ${l.date}, Payee: ${l.payee}`,`        Category: ${l.category}, Account: ${l.account}`);o.potentialSeedMatches.length>5&&e.push(`      ... and ${o.potentialSeedMatches.length-5} more matches`)}else e.push("    No seed matches found");e.push("")}}return e.join(`
`)}function nP({currentUser:t}){const[e,n]=D.useState(!1),[r,i]=D.useState(null),[o,l]=D.useState(null);async function d(h){if(t){n(!0),i(null),l(null);try{const m=await eP(h);i(m),l(tP(m))}catch(m){console.error("Failed to scan transactions:",m),l(`Error scanning: ${m instanceof Error?m.message:"Unknown error"}`)}finally{n(!1)}}}return{isScanning:e,status:r,report:o,scan:d,hasViolations:r!==null&&r.violations.length>0,violationCount:r?.violations.length??0}}function $h(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Hg={exports:{}};var B1;function rP(){return B1||(B1=1,(function(t,e){(function(n){t.exports=n()})(function(){return(function n(r,i,o){function l(m,p){if(!i[m]){if(!r[m]){var g=typeof $h=="function"&&$h;if(!p&&g)return g(m,!0);if(d)return d(m,!0);var v=new Error("Cannot find module '"+m+"'");throw v.code="MODULE_NOT_FOUND",v}var _=i[m]={exports:{}};r[m][0].call(_.exports,function(C){var x=r[m][1][C];return l(x||C)},_,_.exports,n,r,i,o)}return i[m].exports}for(var d=typeof $h=="function"&&$h,h=0;h<o.length;h++)l(o[h]);return l})({1:[function(n,r,i){var o=n("./utils"),l=n("./support"),d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(h){for(var m,p,g,v,_,C,x,S=[],E=0,T=h.length,I=T,M=o.getTypeOf(h)!=="string";E<h.length;)I=T-E,g=M?(m=h[E++],p=E<T?h[E++]:0,E<T?h[E++]:0):(m=h.charCodeAt(E++),p=E<T?h.charCodeAt(E++):0,E<T?h.charCodeAt(E++):0),v=m>>2,_=(3&m)<<4|p>>4,C=1<I?(15&p)<<2|g>>6:64,x=2<I?63&g:64,S.push(d.charAt(v)+d.charAt(_)+d.charAt(C)+d.charAt(x));return S.join("")},i.decode=function(h){var m,p,g,v,_,C,x=0,S=0,E="data:";if(h.substr(0,E.length)===E)throw new Error("Invalid base64 input, it looks like a data url.");var T,I=3*(h=h.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(h.charAt(h.length-1)===d.charAt(64)&&I--,h.charAt(h.length-2)===d.charAt(64)&&I--,I%1!=0)throw new Error("Invalid base64 input, bad content length.");for(T=l.uint8array?new Uint8Array(0|I):new Array(0|I);x<h.length;)m=d.indexOf(h.charAt(x++))<<2|(v=d.indexOf(h.charAt(x++)))>>4,p=(15&v)<<4|(_=d.indexOf(h.charAt(x++)))>>2,g=(3&_)<<6|(C=d.indexOf(h.charAt(x++))),T[S++]=m,_!==64&&(T[S++]=p),C!==64&&(T[S++]=g);return T}},{"./support":30,"./utils":32}],2:[function(n,r,i){var o=n("./external"),l=n("./stream/DataWorker"),d=n("./stream/Crc32Probe"),h=n("./stream/DataLengthProbe");function m(p,g,v,_,C){this.compressedSize=p,this.uncompressedSize=g,this.crc32=v,this.compression=_,this.compressedContent=C}m.prototype={getContentWorker:function(){var p=new l(o.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new h("data_length")),g=this;return p.on("end",function(){if(this.streamInfo.data_length!==g.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),p},getCompressedWorker:function(){return new l(o.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},m.createWorkerFrom=function(p,g,v){return p.pipe(new d).pipe(new h("uncompressedSize")).pipe(g.compressWorker(v)).pipe(new h("compressedSize")).withStreamInfo("compression",g)},r.exports=m},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(n,r,i){var o=n("./stream/GenericWorker");i.STORE={magic:"\0\0",compressWorker:function(){return new o("STORE compression")},uncompressWorker:function(){return new o("STORE decompression")}},i.DEFLATE=n("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(n,r,i){var o=n("./utils"),l=(function(){for(var d,h=[],m=0;m<256;m++){d=m;for(var p=0;p<8;p++)d=1&d?3988292384^d>>>1:d>>>1;h[m]=d}return h})();r.exports=function(d,h){return d!==void 0&&d.length?o.getTypeOf(d)!=="string"?(function(m,p,g,v){var _=l,C=v+g;m^=-1;for(var x=v;x<C;x++)m=m>>>8^_[255&(m^p[x])];return-1^m})(0|h,d,d.length,0):(function(m,p,g,v){var _=l,C=v+g;m^=-1;for(var x=v;x<C;x++)m=m>>>8^_[255&(m^p.charCodeAt(x))];return-1^m})(0|h,d,d.length,0):0}},{"./utils":32}],5:[function(n,r,i){i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!0,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],6:[function(n,r,i){var o=null;o=typeof Promise<"u"?Promise:n("lie"),r.exports={Promise:o}},{lie:37}],7:[function(n,r,i){var o=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",l=n("pako"),d=n("./utils"),h=n("./stream/GenericWorker"),m=o?"uint8array":"array";function p(g,v){h.call(this,"FlateWorker/"+g),this._pako=null,this._pakoAction=g,this._pakoOptions=v,this.meta={}}i.magic="\b\0",d.inherits(p,h),p.prototype.processChunk=function(g){this.meta=g.meta,this._pako===null&&this._createPako(),this._pako.push(d.transformTo(m,g.data),!1)},p.prototype.flush=function(){h.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},p.prototype.cleanUp=function(){h.prototype.cleanUp.call(this),this._pako=null},p.prototype._createPako=function(){this._pako=new l[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var g=this;this._pako.onData=function(v){g.push({data:v,meta:g.meta})}},i.compressWorker=function(g){return new p("Deflate",g)},i.uncompressWorker=function(){return new p("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(n,r,i){function o(_,C){var x,S="";for(x=0;x<C;x++)S+=String.fromCharCode(255&_),_>>>=8;return S}function l(_,C,x,S,E,T){var I,M,L=_.file,$=_.compression,k=T!==m.utf8encode,A=d.transformTo("string",T(L.name)),N=d.transformTo("string",m.utf8encode(L.name)),F=L.comment,q=d.transformTo("string",T(F)),j=d.transformTo("string",m.utf8encode(F)),P=N.length!==L.name.length,O=j.length!==F.length,X="",W="",H="",Z=L.dir,Y=L.date,se={crc32:0,compressedSize:0,uncompressedSize:0};C&&!x||(se.crc32=_.crc32,se.compressedSize=_.compressedSize,se.uncompressedSize=_.uncompressedSize);var B=0;C&&(B|=8),k||!P&&!O||(B|=2048);var G=0,ne=0;Z&&(G|=16),E==="UNIX"?(ne=798,G|=(function(ee,ue){var be=ee;return ee||(be=ue?16893:33204),(65535&be)<<16})(L.unixPermissions,Z)):(ne=20,G|=(function(ee){return 63&(ee||0)})(L.dosPermissions)),I=Y.getUTCHours(),I<<=6,I|=Y.getUTCMinutes(),I<<=5,I|=Y.getUTCSeconds()/2,M=Y.getUTCFullYear()-1980,M<<=4,M|=Y.getUTCMonth()+1,M<<=5,M|=Y.getUTCDate(),P&&(W=o(1,1)+o(p(A),4)+N,X+="up"+o(W.length,2)+W),O&&(H=o(1,1)+o(p(q),4)+j,X+="uc"+o(H.length,2)+H);var ie="";return ie+=`
\0`,ie+=o(B,2),ie+=$.magic,ie+=o(I,2),ie+=o(M,2),ie+=o(se.crc32,4),ie+=o(se.compressedSize,4),ie+=o(se.uncompressedSize,4),ie+=o(A.length,2),ie+=o(X.length,2),{fileRecord:g.LOCAL_FILE_HEADER+ie+A+X,dirRecord:g.CENTRAL_FILE_HEADER+o(ne,2)+ie+o(q.length,2)+"\0\0\0\0"+o(G,4)+o(S,4)+A+X+q}}var d=n("../utils"),h=n("../stream/GenericWorker"),m=n("../utf8"),p=n("../crc32"),g=n("../signature");function v(_,C,x,S){h.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=C,this.zipPlatform=x,this.encodeFileName=S,this.streamFiles=_,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}d.inherits(v,h),v.prototype.push=function(_){var C=_.meta.percent||0,x=this.entriesCount,S=this._sources.length;this.accumulate?this.contentBuffer.push(_):(this.bytesWritten+=_.data.length,h.prototype.push.call(this,{data:_.data,meta:{currentFile:this.currentFile,percent:x?(C+100*(x-S-1))/x:100}}))},v.prototype.openedSource=function(_){this.currentSourceOffset=this.bytesWritten,this.currentFile=_.file.name;var C=this.streamFiles&&!_.file.dir;if(C){var x=l(_,C,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:x.fileRecord,meta:{percent:0}})}else this.accumulate=!0},v.prototype.closedSource=function(_){this.accumulate=!1;var C=this.streamFiles&&!_.file.dir,x=l(_,C,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(x.dirRecord),C)this.push({data:(function(S){return g.DATA_DESCRIPTOR+o(S.crc32,4)+o(S.compressedSize,4)+o(S.uncompressedSize,4)})(_),meta:{percent:100}});else for(this.push({data:x.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},v.prototype.flush=function(){for(var _=this.bytesWritten,C=0;C<this.dirRecords.length;C++)this.push({data:this.dirRecords[C],meta:{percent:100}});var x=this.bytesWritten-_,S=(function(E,T,I,M,L){var $=d.transformTo("string",L(M));return g.CENTRAL_DIRECTORY_END+"\0\0\0\0"+o(E,2)+o(E,2)+o(T,4)+o(I,4)+o($.length,2)+$})(this.dirRecords.length,x,_,this.zipComment,this.encodeFileName);this.push({data:S,meta:{percent:100}})},v.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},v.prototype.registerPrevious=function(_){this._sources.push(_);var C=this;return _.on("data",function(x){C.processChunk(x)}),_.on("end",function(){C.closedSource(C.previous.streamInfo),C._sources.length?C.prepareNextSource():C.end()}),_.on("error",function(x){C.error(x)}),this},v.prototype.resume=function(){return!!h.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},v.prototype.error=function(_){var C=this._sources;if(!h.prototype.error.call(this,_))return!1;for(var x=0;x<C.length;x++)try{C[x].error(_)}catch{}return!0},v.prototype.lock=function(){h.prototype.lock.call(this);for(var _=this._sources,C=0;C<_.length;C++)_[C].lock()},r.exports=v},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(n,r,i){var o=n("../compressions"),l=n("./ZipFileWorker");i.generateWorker=function(d,h,m){var p=new l(h.streamFiles,m,h.platform,h.encodeFileName),g=0;try{d.forEach(function(v,_){g++;var C=(function(T,I){var M=T||I,L=o[M];if(!L)throw new Error(M+" is not a valid compression method !");return L})(_.options.compression,h.compression),x=_.options.compressionOptions||h.compressionOptions||{},S=_.dir,E=_.date;_._compressWorker(C,x).withStreamInfo("file",{name:v,dir:S,date:E,comment:_.comment||"",unixPermissions:_.unixPermissions,dosPermissions:_.dosPermissions}).pipe(p)}),p.entriesCount=g}catch(v){p.error(v)}return p}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(n,r,i){function o(){if(!(this instanceof o))return new o;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var l=new o;for(var d in this)typeof this[d]!="function"&&(l[d]=this[d]);return l}}(o.prototype=n("./object")).loadAsync=n("./load"),o.support=n("./support"),o.defaults=n("./defaults"),o.version="3.10.1",o.loadAsync=function(l,d){return new o().loadAsync(l,d)},o.external=n("./external"),r.exports=o},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(n,r,i){var o=n("./utils"),l=n("./external"),d=n("./utf8"),h=n("./zipEntries"),m=n("./stream/Crc32Probe"),p=n("./nodejsUtils");function g(v){return new l.Promise(function(_,C){var x=v.decompressed.getContentWorker().pipe(new m);x.on("error",function(S){C(S)}).on("end",function(){x.streamInfo.crc32!==v.decompressed.crc32?C(new Error("Corrupted zip : CRC32 mismatch")):_()}).resume()})}r.exports=function(v,_){var C=this;return _=o.extend(_||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:d.utf8decode}),p.isNode&&p.isStream(v)?l.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):o.prepareContent("the loaded zip file",v,!0,_.optimizedBinaryString,_.base64).then(function(x){var S=new h(_);return S.load(x),S}).then(function(x){var S=[l.Promise.resolve(x)],E=x.files;if(_.checkCRC32)for(var T=0;T<E.length;T++)S.push(g(E[T]));return l.Promise.all(S)}).then(function(x){for(var S=x.shift(),E=S.files,T=0;T<E.length;T++){var I=E[T],M=I.fileNameStr,L=o.resolve(I.fileNameStr);C.file(L,I.decompressed,{binary:!0,optimizedBinaryString:!0,date:I.date,dir:I.dir,comment:I.fileCommentStr.length?I.fileCommentStr:null,unixPermissions:I.unixPermissions,dosPermissions:I.dosPermissions,createFolders:_.createFolders}),I.dir||(C.file(L).unsafeOriginalName=M)}return S.zipComment.length&&(C.comment=S.zipComment),C})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(n,r,i){var o=n("../utils"),l=n("../stream/GenericWorker");function d(h,m){l.call(this,"Nodejs stream input adapter for "+h),this._upstreamEnded=!1,this._bindStream(m)}o.inherits(d,l),d.prototype._bindStream=function(h){var m=this;(this._stream=h).pause(),h.on("data",function(p){m.push({data:p,meta:{percent:0}})}).on("error",function(p){m.isPaused?this.generatedError=p:m.error(p)}).on("end",function(){m.isPaused?m._upstreamEnded=!0:m.end()})},d.prototype.pause=function(){return!!l.prototype.pause.call(this)&&(this._stream.pause(),!0)},d.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},r.exports=d},{"../stream/GenericWorker":28,"../utils":32}],13:[function(n,r,i){var o=n("readable-stream").Readable;function l(d,h,m){o.call(this,h),this._helper=d;var p=this;d.on("data",function(g,v){p.push(g)||p._helper.pause(),m&&m(v)}).on("error",function(g){p.emit("error",g)}).on("end",function(){p.push(null)})}n("../utils").inherits(l,o),l.prototype._read=function(){this._helper.resume()},r.exports=l},{"../utils":32,"readable-stream":16}],14:[function(n,r,i){r.exports={isNode:typeof Buffer<"u",newBufferFrom:function(o,l){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(o,l);if(typeof o=="number")throw new Error('The "data" argument must not be a number');return new Buffer(o,l)},allocBuffer:function(o){if(Buffer.alloc)return Buffer.alloc(o);var l=new Buffer(o);return l.fill(0),l},isBuffer:function(o){return Buffer.isBuffer(o)},isStream:function(o){return o&&typeof o.on=="function"&&typeof o.pause=="function"&&typeof o.resume=="function"}}},{}],15:[function(n,r,i){function o(L,$,k){var A,N=d.getTypeOf($),F=d.extend(k||{},p);F.date=F.date||new Date,F.compression!==null&&(F.compression=F.compression.toUpperCase()),typeof F.unixPermissions=="string"&&(F.unixPermissions=parseInt(F.unixPermissions,8)),F.unixPermissions&&16384&F.unixPermissions&&(F.dir=!0),F.dosPermissions&&16&F.dosPermissions&&(F.dir=!0),F.dir&&(L=E(L)),F.createFolders&&(A=S(L))&&T.call(this,A,!0);var q=N==="string"&&F.binary===!1&&F.base64===!1;k&&k.binary!==void 0||(F.binary=!q),($ instanceof g&&$.uncompressedSize===0||F.dir||!$||$.length===0)&&(F.base64=!1,F.binary=!0,$="",F.compression="STORE",N="string");var j=null;j=$ instanceof g||$ instanceof h?$:C.isNode&&C.isStream($)?new x(L,$):d.prepareContent(L,$,F.binary,F.optimizedBinaryString,F.base64);var P=new v(L,j,F);this.files[L]=P}var l=n("./utf8"),d=n("./utils"),h=n("./stream/GenericWorker"),m=n("./stream/StreamHelper"),p=n("./defaults"),g=n("./compressedObject"),v=n("./zipObject"),_=n("./generate"),C=n("./nodejsUtils"),x=n("./nodejs/NodejsStreamInputAdapter"),S=function(L){L.slice(-1)==="/"&&(L=L.substring(0,L.length-1));var $=L.lastIndexOf("/");return 0<$?L.substring(0,$):""},E=function(L){return L.slice(-1)!=="/"&&(L+="/"),L},T=function(L,$){return $=$!==void 0?$:p.createFolders,L=E(L),this.files[L]||o.call(this,L,null,{dir:!0,createFolders:$}),this.files[L]};function I(L){return Object.prototype.toString.call(L)==="[object RegExp]"}var M={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(L){var $,k,A;for($ in this.files)A=this.files[$],(k=$.slice(this.root.length,$.length))&&$.slice(0,this.root.length)===this.root&&L(k,A)},filter:function(L){var $=[];return this.forEach(function(k,A){L(k,A)&&$.push(A)}),$},file:function(L,$,k){if(arguments.length!==1)return L=this.root+L,o.call(this,L,$,k),this;if(I(L)){var A=L;return this.filter(function(F,q){return!q.dir&&A.test(F)})}var N=this.files[this.root+L];return N&&!N.dir?N:null},folder:function(L){if(!L)return this;if(I(L))return this.filter(function(N,F){return F.dir&&L.test(N)});var $=this.root+L,k=T.call(this,$),A=this.clone();return A.root=k.name,A},remove:function(L){L=this.root+L;var $=this.files[L];if($||(L.slice(-1)!=="/"&&(L+="/"),$=this.files[L]),$&&!$.dir)delete this.files[L];else for(var k=this.filter(function(N,F){return F.name.slice(0,L.length)===L}),A=0;A<k.length;A++)delete this.files[k[A].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(L){var $,k={};try{if((k=d.extend(L||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:l.utf8encode})).type=k.type.toLowerCase(),k.compression=k.compression.toUpperCase(),k.type==="binarystring"&&(k.type="string"),!k.type)throw new Error("No output type specified.");d.checkSupport(k.type),k.platform!=="darwin"&&k.platform!=="freebsd"&&k.platform!=="linux"&&k.platform!=="sunos"||(k.platform="UNIX"),k.platform==="win32"&&(k.platform="DOS");var A=k.comment||this.comment||"";$=_.generateWorker(this,k,A)}catch(N){($=new h("error")).error(N)}return new m($,k.type||"string",k.mimeType)},generateAsync:function(L,$){return this.generateInternalStream(L).accumulate($)},generateNodeStream:function(L,$){return(L=L||{}).type||(L.type="nodebuffer"),this.generateInternalStream(L).toNodejsStream($)}};r.exports=M},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(n,r,i){r.exports=n("stream")},{stream:void 0}],17:[function(n,r,i){var o=n("./DataReader");function l(d){o.call(this,d);for(var h=0;h<this.data.length;h++)d[h]=255&d[h]}n("../utils").inherits(l,o),l.prototype.byteAt=function(d){return this.data[this.zero+d]},l.prototype.lastIndexOfSignature=function(d){for(var h=d.charCodeAt(0),m=d.charCodeAt(1),p=d.charCodeAt(2),g=d.charCodeAt(3),v=this.length-4;0<=v;--v)if(this.data[v]===h&&this.data[v+1]===m&&this.data[v+2]===p&&this.data[v+3]===g)return v-this.zero;return-1},l.prototype.readAndCheckSignature=function(d){var h=d.charCodeAt(0),m=d.charCodeAt(1),p=d.charCodeAt(2),g=d.charCodeAt(3),v=this.readData(4);return h===v[0]&&m===v[1]&&p===v[2]&&g===v[3]},l.prototype.readData=function(d){if(this.checkOffset(d),d===0)return[];var h=this.data.slice(this.zero+this.index,this.zero+this.index+d);return this.index+=d,h},r.exports=l},{"../utils":32,"./DataReader":18}],18:[function(n,r,i){var o=n("../utils");function l(d){this.data=d,this.length=d.length,this.index=0,this.zero=0}l.prototype={checkOffset:function(d){this.checkIndex(this.index+d)},checkIndex:function(d){if(this.length<this.zero+d||d<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+d+"). Corrupted zip ?")},setIndex:function(d){this.checkIndex(d),this.index=d},skip:function(d){this.setIndex(this.index+d)},byteAt:function(){},readInt:function(d){var h,m=0;for(this.checkOffset(d),h=this.index+d-1;h>=this.index;h--)m=(m<<8)+this.byteAt(h);return this.index+=d,m},readString:function(d){return o.transformTo("string",this.readData(d))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var d=this.readInt(4);return new Date(Date.UTC(1980+(d>>25&127),(d>>21&15)-1,d>>16&31,d>>11&31,d>>5&63,(31&d)<<1))}},r.exports=l},{"../utils":32}],19:[function(n,r,i){var o=n("./Uint8ArrayReader");function l(d){o.call(this,d)}n("../utils").inherits(l,o),l.prototype.readData=function(d){this.checkOffset(d);var h=this.data.slice(this.zero+this.index,this.zero+this.index+d);return this.index+=d,h},r.exports=l},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(n,r,i){var o=n("./DataReader");function l(d){o.call(this,d)}n("../utils").inherits(l,o),l.prototype.byteAt=function(d){return this.data.charCodeAt(this.zero+d)},l.prototype.lastIndexOfSignature=function(d){return this.data.lastIndexOf(d)-this.zero},l.prototype.readAndCheckSignature=function(d){return d===this.readData(4)},l.prototype.readData=function(d){this.checkOffset(d);var h=this.data.slice(this.zero+this.index,this.zero+this.index+d);return this.index+=d,h},r.exports=l},{"../utils":32,"./DataReader":18}],21:[function(n,r,i){var o=n("./ArrayReader");function l(d){o.call(this,d)}n("../utils").inherits(l,o),l.prototype.readData=function(d){if(this.checkOffset(d),d===0)return new Uint8Array(0);var h=this.data.subarray(this.zero+this.index,this.zero+this.index+d);return this.index+=d,h},r.exports=l},{"../utils":32,"./ArrayReader":17}],22:[function(n,r,i){var o=n("../utils"),l=n("../support"),d=n("./ArrayReader"),h=n("./StringReader"),m=n("./NodeBufferReader"),p=n("./Uint8ArrayReader");r.exports=function(g){var v=o.getTypeOf(g);return o.checkSupport(v),v!=="string"||l.uint8array?v==="nodebuffer"?new m(g):l.uint8array?new p(o.transformTo("uint8array",g)):new d(o.transformTo("array",g)):new h(g)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(n,r,i){i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(n,r,i){var o=n("./GenericWorker"),l=n("../utils");function d(h){o.call(this,"ConvertWorker to "+h),this.destType=h}l.inherits(d,o),d.prototype.processChunk=function(h){this.push({data:l.transformTo(this.destType,h.data),meta:h.meta})},r.exports=d},{"../utils":32,"./GenericWorker":28}],25:[function(n,r,i){var o=n("./GenericWorker"),l=n("../crc32");function d(){o.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}n("../utils").inherits(d,o),d.prototype.processChunk=function(h){this.streamInfo.crc32=l(h.data,this.streamInfo.crc32||0),this.push(h)},r.exports=d},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(n,r,i){var o=n("../utils"),l=n("./GenericWorker");function d(h){l.call(this,"DataLengthProbe for "+h),this.propName=h,this.withStreamInfo(h,0)}o.inherits(d,l),d.prototype.processChunk=function(h){if(h){var m=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=m+h.data.length}l.prototype.processChunk.call(this,h)},r.exports=d},{"../utils":32,"./GenericWorker":28}],27:[function(n,r,i){var o=n("../utils"),l=n("./GenericWorker");function d(h){l.call(this,"DataWorker");var m=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,h.then(function(p){m.dataIsReady=!0,m.data=p,m.max=p&&p.length||0,m.type=o.getTypeOf(p),m.isPaused||m._tickAndRepeat()},function(p){m.error(p)})}o.inherits(d,l),d.prototype.cleanUp=function(){l.prototype.cleanUp.call(this),this.data=null},d.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,o.delay(this._tickAndRepeat,[],this)),!0)},d.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(o.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},d.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var h=null,m=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":h=this.data.substring(this.index,m);break;case"uint8array":h=this.data.subarray(this.index,m);break;case"array":case"nodebuffer":h=this.data.slice(this.index,m)}return this.index=m,this.push({data:h,meta:{percent:this.max?this.index/this.max*100:0}})},r.exports=d},{"../utils":32,"./GenericWorker":28}],28:[function(n,r,i){function o(l){this.name=l||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}o.prototype={push:function(l){this.emit("data",l)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(l){this.emit("error",l)}return!0},error:function(l){return!this.isFinished&&(this.isPaused?this.generatedError=l:(this.isFinished=!0,this.emit("error",l),this.previous&&this.previous.error(l),this.cleanUp()),!0)},on:function(l,d){return this._listeners[l].push(d),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(l,d){if(this._listeners[l])for(var h=0;h<this._listeners[l].length;h++)this._listeners[l][h].call(this,d)},pipe:function(l){return l.registerPrevious(this)},registerPrevious:function(l){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=l.streamInfo,this.mergeStreamInfo(),this.previous=l;var d=this;return l.on("data",function(h){d.processChunk(h)}),l.on("end",function(){d.end()}),l.on("error",function(h){d.error(h)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var l=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),l=!0),this.previous&&this.previous.resume(),!l},flush:function(){},processChunk:function(l){this.push(l)},withStreamInfo:function(l,d){return this.extraStreamInfo[l]=d,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var l in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,l)&&(this.streamInfo[l]=this.extraStreamInfo[l])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var l="Worker "+this.name;return this.previous?this.previous+" -> "+l:l}},r.exports=o},{}],29:[function(n,r,i){var o=n("../utils"),l=n("./ConvertWorker"),d=n("./GenericWorker"),h=n("../base64"),m=n("../support"),p=n("../external"),g=null;if(m.nodestream)try{g=n("../nodejs/NodejsStreamOutputAdapter")}catch{}function v(C,x){return new p.Promise(function(S,E){var T=[],I=C._internalType,M=C._outputType,L=C._mimeType;C.on("data",function($,k){T.push($),x&&x(k)}).on("error",function($){T=[],E($)}).on("end",function(){try{var $=(function(k,A,N){switch(k){case"blob":return o.newBlob(o.transformTo("arraybuffer",A),N);case"base64":return h.encode(A);default:return o.transformTo(k,A)}})(M,(function(k,A){var N,F=0,q=null,j=0;for(N=0;N<A.length;N++)j+=A[N].length;switch(k){case"string":return A.join("");case"array":return Array.prototype.concat.apply([],A);case"uint8array":for(q=new Uint8Array(j),N=0;N<A.length;N++)q.set(A[N],F),F+=A[N].length;return q;case"nodebuffer":return Buffer.concat(A);default:throw new Error("concat : unsupported type '"+k+"'")}})(I,T),L);S($)}catch(k){E(k)}T=[]}).resume()})}function _(C,x,S){var E=x;switch(x){case"blob":case"arraybuffer":E="uint8array";break;case"base64":E="string"}try{this._internalType=E,this._outputType=x,this._mimeType=S,o.checkSupport(E),this._worker=C.pipe(new l(E)),C.lock()}catch(T){this._worker=new d("error"),this._worker.error(T)}}_.prototype={accumulate:function(C){return v(this,C)},on:function(C,x){var S=this;return C==="data"?this._worker.on(C,function(E){x.call(S,E.data,E.meta)}):this._worker.on(C,function(){o.delay(x,arguments,S)}),this},resume:function(){return o.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(C){if(o.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new g(this,{objectMode:this._outputType!=="nodebuffer"},C)}},r.exports=_},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(n,r,i){if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",i.nodebuffer=typeof Buffer<"u",i.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")i.blob=!1;else{var o=new ArrayBuffer(0);try{i.blob=new Blob([o],{type:"application/zip"}).size===0}catch{try{var l=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);l.append(o),i.blob=l.getBlob("application/zip").size===0}catch{i.blob=!1}}}try{i.nodestream=!!n("readable-stream").Readable}catch{i.nodestream=!1}},{"readable-stream":16}],31:[function(n,r,i){for(var o=n("./utils"),l=n("./support"),d=n("./nodejsUtils"),h=n("./stream/GenericWorker"),m=new Array(256),p=0;p<256;p++)m[p]=252<=p?6:248<=p?5:240<=p?4:224<=p?3:192<=p?2:1;m[254]=m[254]=1;function g(){h.call(this,"utf-8 decode"),this.leftOver=null}function v(){h.call(this,"utf-8 encode")}i.utf8encode=function(_){return l.nodebuffer?d.newBufferFrom(_,"utf-8"):(function(C){var x,S,E,T,I,M=C.length,L=0;for(T=0;T<M;T++)(64512&(S=C.charCodeAt(T)))==55296&&T+1<M&&(64512&(E=C.charCodeAt(T+1)))==56320&&(S=65536+(S-55296<<10)+(E-56320),T++),L+=S<128?1:S<2048?2:S<65536?3:4;for(x=l.uint8array?new Uint8Array(L):new Array(L),T=I=0;I<L;T++)(64512&(S=C.charCodeAt(T)))==55296&&T+1<M&&(64512&(E=C.charCodeAt(T+1)))==56320&&(S=65536+(S-55296<<10)+(E-56320),T++),S<128?x[I++]=S:(S<2048?x[I++]=192|S>>>6:(S<65536?x[I++]=224|S>>>12:(x[I++]=240|S>>>18,x[I++]=128|S>>>12&63),x[I++]=128|S>>>6&63),x[I++]=128|63&S);return x})(_)},i.utf8decode=function(_){return l.nodebuffer?o.transformTo("nodebuffer",_).toString("utf-8"):(function(C){var x,S,E,T,I=C.length,M=new Array(2*I);for(x=S=0;x<I;)if((E=C[x++])<128)M[S++]=E;else if(4<(T=m[E]))M[S++]=65533,x+=T-1;else{for(E&=T===2?31:T===3?15:7;1<T&&x<I;)E=E<<6|63&C[x++],T--;1<T?M[S++]=65533:E<65536?M[S++]=E:(E-=65536,M[S++]=55296|E>>10&1023,M[S++]=56320|1023&E)}return M.length!==S&&(M.subarray?M=M.subarray(0,S):M.length=S),o.applyFromCharCode(M)})(_=o.transformTo(l.uint8array?"uint8array":"array",_))},o.inherits(g,h),g.prototype.processChunk=function(_){var C=o.transformTo(l.uint8array?"uint8array":"array",_.data);if(this.leftOver&&this.leftOver.length){if(l.uint8array){var x=C;(C=new Uint8Array(x.length+this.leftOver.length)).set(this.leftOver,0),C.set(x,this.leftOver.length)}else C=this.leftOver.concat(C);this.leftOver=null}var S=(function(T,I){var M;for((I=I||T.length)>T.length&&(I=T.length),M=I-1;0<=M&&(192&T[M])==128;)M--;return M<0||M===0?I:M+m[T[M]]>I?M:I})(C),E=C;S!==C.length&&(l.uint8array?(E=C.subarray(0,S),this.leftOver=C.subarray(S,C.length)):(E=C.slice(0,S),this.leftOver=C.slice(S,C.length))),this.push({data:i.utf8decode(E),meta:_.meta})},g.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:i.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},i.Utf8DecodeWorker=g,o.inherits(v,h),v.prototype.processChunk=function(_){this.push({data:i.utf8encode(_.data),meta:_.meta})},i.Utf8EncodeWorker=v},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(n,r,i){var o=n("./support"),l=n("./base64"),d=n("./nodejsUtils"),h=n("./external");function m(x){return x}function p(x,S){for(var E=0;E<x.length;++E)S[E]=255&x.charCodeAt(E);return S}n("setimmediate"),i.newBlob=function(x,S){i.checkSupport("blob");try{return new Blob([x],{type:S})}catch{try{var E=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return E.append(x),E.getBlob(S)}catch{throw new Error("Bug : can't construct the Blob.")}}};var g={stringifyByChunk:function(x,S,E){var T=[],I=0,M=x.length;if(M<=E)return String.fromCharCode.apply(null,x);for(;I<M;)S==="array"||S==="nodebuffer"?T.push(String.fromCharCode.apply(null,x.slice(I,Math.min(I+E,M)))):T.push(String.fromCharCode.apply(null,x.subarray(I,Math.min(I+E,M)))),I+=E;return T.join("")},stringifyByChar:function(x){for(var S="",E=0;E<x.length;E++)S+=String.fromCharCode(x[E]);return S},applyCanBeUsed:{uint8array:(function(){try{return o.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}})(),nodebuffer:(function(){try{return o.nodebuffer&&String.fromCharCode.apply(null,d.allocBuffer(1)).length===1}catch{return!1}})()}};function v(x){var S=65536,E=i.getTypeOf(x),T=!0;if(E==="uint8array"?T=g.applyCanBeUsed.uint8array:E==="nodebuffer"&&(T=g.applyCanBeUsed.nodebuffer),T)for(;1<S;)try{return g.stringifyByChunk(x,E,S)}catch{S=Math.floor(S/2)}return g.stringifyByChar(x)}function _(x,S){for(var E=0;E<x.length;E++)S[E]=x[E];return S}i.applyFromCharCode=v;var C={};C.string={string:m,array:function(x){return p(x,new Array(x.length))},arraybuffer:function(x){return C.string.uint8array(x).buffer},uint8array:function(x){return p(x,new Uint8Array(x.length))},nodebuffer:function(x){return p(x,d.allocBuffer(x.length))}},C.array={string:v,array:m,arraybuffer:function(x){return new Uint8Array(x).buffer},uint8array:function(x){return new Uint8Array(x)},nodebuffer:function(x){return d.newBufferFrom(x)}},C.arraybuffer={string:function(x){return v(new Uint8Array(x))},array:function(x){return _(new Uint8Array(x),new Array(x.byteLength))},arraybuffer:m,uint8array:function(x){return new Uint8Array(x)},nodebuffer:function(x){return d.newBufferFrom(new Uint8Array(x))}},C.uint8array={string:v,array:function(x){return _(x,new Array(x.length))},arraybuffer:function(x){return x.buffer},uint8array:m,nodebuffer:function(x){return d.newBufferFrom(x)}},C.nodebuffer={string:v,array:function(x){return _(x,new Array(x.length))},arraybuffer:function(x){return C.nodebuffer.uint8array(x).buffer},uint8array:function(x){return _(x,new Uint8Array(x.length))},nodebuffer:m},i.transformTo=function(x,S){if(S=S||"",!x)return S;i.checkSupport(x);var E=i.getTypeOf(S);return C[E][x](S)},i.resolve=function(x){for(var S=x.split("/"),E=[],T=0;T<S.length;T++){var I=S[T];I==="."||I===""&&T!==0&&T!==S.length-1||(I===".."?E.pop():E.push(I))}return E.join("/")},i.getTypeOf=function(x){return typeof x=="string"?"string":Object.prototype.toString.call(x)==="[object Array]"?"array":o.nodebuffer&&d.isBuffer(x)?"nodebuffer":o.uint8array&&x instanceof Uint8Array?"uint8array":o.arraybuffer&&x instanceof ArrayBuffer?"arraybuffer":void 0},i.checkSupport=function(x){if(!o[x.toLowerCase()])throw new Error(x+" is not supported by this platform")},i.MAX_VALUE_16BITS=65535,i.MAX_VALUE_32BITS=-1,i.pretty=function(x){var S,E,T="";for(E=0;E<(x||"").length;E++)T+="\\x"+((S=x.charCodeAt(E))<16?"0":"")+S.toString(16).toUpperCase();return T},i.delay=function(x,S,E){setImmediate(function(){x.apply(E||null,S||[])})},i.inherits=function(x,S){function E(){}E.prototype=S.prototype,x.prototype=new E},i.extend=function(){var x,S,E={};for(x=0;x<arguments.length;x++)for(S in arguments[x])Object.prototype.hasOwnProperty.call(arguments[x],S)&&E[S]===void 0&&(E[S]=arguments[x][S]);return E},i.prepareContent=function(x,S,E,T,I){return h.Promise.resolve(S).then(function(M){return o.blob&&(M instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(M))!==-1)&&typeof FileReader<"u"?new h.Promise(function(L,$){var k=new FileReader;k.onload=function(A){L(A.target.result)},k.onerror=function(A){$(A.target.error)},k.readAsArrayBuffer(M)}):M}).then(function(M){var L=i.getTypeOf(M);return L?(L==="arraybuffer"?M=i.transformTo("uint8array",M):L==="string"&&(I?M=l.decode(M):E&&T!==!0&&(M=(function($){return p($,o.uint8array?new Uint8Array($.length):new Array($.length))})(M))),M):h.Promise.reject(new Error("Can't read the data of '"+x+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(n,r,i){var o=n("./reader/readerFor"),l=n("./utils"),d=n("./signature"),h=n("./zipEntry"),m=n("./support");function p(g){this.files=[],this.loadOptions=g}p.prototype={checkSignature:function(g){if(!this.reader.readAndCheckSignature(g)){this.reader.index-=4;var v=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+l.pretty(v)+", expected "+l.pretty(g)+")")}},isSignature:function(g,v){var _=this.reader.index;this.reader.setIndex(g);var C=this.reader.readString(4)===v;return this.reader.setIndex(_),C},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var g=this.reader.readData(this.zipCommentLength),v=m.uint8array?"uint8array":"array",_=l.transformTo(v,g);this.zipComment=this.loadOptions.decodeFileName(_)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var g,v,_,C=this.zip64EndOfCentralSize-44;0<C;)g=this.reader.readInt(2),v=this.reader.readInt(4),_=this.reader.readData(v),this.zip64ExtensibleData[g]={id:g,length:v,value:_}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var g,v;for(g=0;g<this.files.length;g++)v=this.files[g],this.reader.setIndex(v.localHeaderOffset),this.checkSignature(d.LOCAL_FILE_HEADER),v.readLocalPart(this.reader),v.handleUTF8(),v.processAttributes()},readCentralDir:function(){var g;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(d.CENTRAL_FILE_HEADER);)(g=new h({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(g);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var g=this.reader.lastIndexOfSignature(d.CENTRAL_DIRECTORY_END);if(g<0)throw this.isSignature(0,d.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(g);var v=g;if(this.checkSignature(d.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===l.MAX_VALUE_16BITS||this.diskWithCentralDirStart===l.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===l.MAX_VALUE_16BITS||this.centralDirRecords===l.MAX_VALUE_16BITS||this.centralDirSize===l.MAX_VALUE_32BITS||this.centralDirOffset===l.MAX_VALUE_32BITS){if(this.zip64=!0,(g=this.reader.lastIndexOfSignature(d.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(g),this.checkSignature(d.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,d.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(d.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(d.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var _=this.centralDirOffset+this.centralDirSize;this.zip64&&(_+=20,_+=12+this.zip64EndOfCentralSize);var C=v-_;if(0<C)this.isSignature(v,d.CENTRAL_FILE_HEADER)||(this.reader.zero=C);else if(C<0)throw new Error("Corrupted zip: missing "+Math.abs(C)+" bytes.")},prepareReader:function(g){this.reader=o(g)},load:function(g){this.prepareReader(g),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},r.exports=p},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(n,r,i){var o=n("./reader/readerFor"),l=n("./utils"),d=n("./compressedObject"),h=n("./crc32"),m=n("./utf8"),p=n("./compressions"),g=n("./support");function v(_,C){this.options=_,this.loadOptions=C}v.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(_){var C,x;if(_.skip(22),this.fileNameLength=_.readInt(2),x=_.readInt(2),this.fileName=_.readData(this.fileNameLength),_.skip(x),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((C=(function(S){for(var E in p)if(Object.prototype.hasOwnProperty.call(p,E)&&p[E].magic===S)return p[E];return null})(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+l.pretty(this.compressionMethod)+" unknown (inner file : "+l.transformTo("string",this.fileName)+")");this.decompressed=new d(this.compressedSize,this.uncompressedSize,this.crc32,C,_.readData(this.compressedSize))},readCentralPart:function(_){this.versionMadeBy=_.readInt(2),_.skip(2),this.bitFlag=_.readInt(2),this.compressionMethod=_.readString(2),this.date=_.readDate(),this.crc32=_.readInt(4),this.compressedSize=_.readInt(4),this.uncompressedSize=_.readInt(4);var C=_.readInt(2);if(this.extraFieldsLength=_.readInt(2),this.fileCommentLength=_.readInt(2),this.diskNumberStart=_.readInt(2),this.internalFileAttributes=_.readInt(2),this.externalFileAttributes=_.readInt(4),this.localHeaderOffset=_.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");_.skip(C),this.readExtraFields(_),this.parseZIP64ExtraField(_),this.fileComment=_.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var _=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),_==0&&(this.dosPermissions=63&this.externalFileAttributes),_==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var _=o(this.extraFields[1].value);this.uncompressedSize===l.MAX_VALUE_32BITS&&(this.uncompressedSize=_.readInt(8)),this.compressedSize===l.MAX_VALUE_32BITS&&(this.compressedSize=_.readInt(8)),this.localHeaderOffset===l.MAX_VALUE_32BITS&&(this.localHeaderOffset=_.readInt(8)),this.diskNumberStart===l.MAX_VALUE_32BITS&&(this.diskNumberStart=_.readInt(4))}},readExtraFields:function(_){var C,x,S,E=_.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});_.index+4<E;)C=_.readInt(2),x=_.readInt(2),S=_.readData(x),this.extraFields[C]={id:C,length:x,value:S};_.setIndex(E)},handleUTF8:function(){var _=g.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=m.utf8decode(this.fileName),this.fileCommentStr=m.utf8decode(this.fileComment);else{var C=this.findExtraFieldUnicodePath();if(C!==null)this.fileNameStr=C;else{var x=l.transformTo(_,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(x)}var S=this.findExtraFieldUnicodeComment();if(S!==null)this.fileCommentStr=S;else{var E=l.transformTo(_,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(E)}}},findExtraFieldUnicodePath:function(){var _=this.extraFields[28789];if(_){var C=o(_.value);return C.readInt(1)!==1||h(this.fileName)!==C.readInt(4)?null:m.utf8decode(C.readData(_.length-5))}return null},findExtraFieldUnicodeComment:function(){var _=this.extraFields[25461];if(_){var C=o(_.value);return C.readInt(1)!==1||h(this.fileComment)!==C.readInt(4)?null:m.utf8decode(C.readData(_.length-5))}return null}},r.exports=v},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(n,r,i){function o(C,x,S){this.name=C,this.dir=S.dir,this.date=S.date,this.comment=S.comment,this.unixPermissions=S.unixPermissions,this.dosPermissions=S.dosPermissions,this._data=x,this._dataBinary=S.binary,this.options={compression:S.compression,compressionOptions:S.compressionOptions}}var l=n("./stream/StreamHelper"),d=n("./stream/DataWorker"),h=n("./utf8"),m=n("./compressedObject"),p=n("./stream/GenericWorker");o.prototype={internalStream:function(C){var x=null,S="string";try{if(!C)throw new Error("No output type specified.");var E=(S=C.toLowerCase())==="string"||S==="text";S!=="binarystring"&&S!=="text"||(S="string"),x=this._decompressWorker();var T=!this._dataBinary;T&&!E&&(x=x.pipe(new h.Utf8EncodeWorker)),!T&&E&&(x=x.pipe(new h.Utf8DecodeWorker))}catch(I){(x=new p("error")).error(I)}return new l(x,S,"")},async:function(C,x){return this.internalStream(C).accumulate(x)},nodeStream:function(C,x){return this.internalStream(C||"nodebuffer").toNodejsStream(x)},_compressWorker:function(C,x){if(this._data instanceof m&&this._data.compression.magic===C.magic)return this._data.getCompressedWorker();var S=this._decompressWorker();return this._dataBinary||(S=S.pipe(new h.Utf8EncodeWorker)),m.createWorkerFrom(S,C,x)},_decompressWorker:function(){return this._data instanceof m?this._data.getContentWorker():this._data instanceof p?this._data:new d(this._data)}};for(var g=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],v=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},_=0;_<g.length;_++)o.prototype[g[_]]=v;r.exports=o},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(n,r,i){(function(o){var l,d,h=o.MutationObserver||o.WebKitMutationObserver;if(h){var m=0,p=new h(C),g=o.document.createTextNode("");p.observe(g,{characterData:!0}),l=function(){g.data=m=++m%2}}else if(o.setImmediate||o.MessageChannel===void 0)l="document"in o&&"onreadystatechange"in o.document.createElement("script")?function(){var x=o.document.createElement("script");x.onreadystatechange=function(){C(),x.onreadystatechange=null,x.parentNode.removeChild(x),x=null},o.document.documentElement.appendChild(x)}:function(){setTimeout(C,0)};else{var v=new o.MessageChannel;v.port1.onmessage=C,l=function(){v.port2.postMessage(0)}}var _=[];function C(){var x,S;d=!0;for(var E=_.length;E;){for(S=_,_=[],x=-1;++x<E;)S[x]();E=_.length}d=!1}r.exports=function(x){_.push(x)!==1||d||l()}}).call(this,typeof Oh<"u"?Oh:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(n,r,i){var o=n("immediate");function l(){}var d={},h=["REJECTED"],m=["FULFILLED"],p=["PENDING"];function g(E){if(typeof E!="function")throw new TypeError("resolver must be a function");this.state=p,this.queue=[],this.outcome=void 0,E!==l&&x(this,E)}function v(E,T,I){this.promise=E,typeof T=="function"&&(this.onFulfilled=T,this.callFulfilled=this.otherCallFulfilled),typeof I=="function"&&(this.onRejected=I,this.callRejected=this.otherCallRejected)}function _(E,T,I){o(function(){var M;try{M=T(I)}catch(L){return d.reject(E,L)}M===E?d.reject(E,new TypeError("Cannot resolve promise with itself")):d.resolve(E,M)})}function C(E){var T=E&&E.then;if(E&&(typeof E=="object"||typeof E=="function")&&typeof T=="function")return function(){T.apply(E,arguments)}}function x(E,T){var I=!1;function M(k){I||(I=!0,d.reject(E,k))}function L(k){I||(I=!0,d.resolve(E,k))}var $=S(function(){T(L,M)});$.status==="error"&&M($.value)}function S(E,T){var I={};try{I.value=E(T),I.status="success"}catch(M){I.status="error",I.value=M}return I}(r.exports=g).prototype.finally=function(E){if(typeof E!="function")return this;var T=this.constructor;return this.then(function(I){return T.resolve(E()).then(function(){return I})},function(I){return T.resolve(E()).then(function(){throw I})})},g.prototype.catch=function(E){return this.then(null,E)},g.prototype.then=function(E,T){if(typeof E!="function"&&this.state===m||typeof T!="function"&&this.state===h)return this;var I=new this.constructor(l);return this.state!==p?_(I,this.state===m?E:T,this.outcome):this.queue.push(new v(I,E,T)),I},v.prototype.callFulfilled=function(E){d.resolve(this.promise,E)},v.prototype.otherCallFulfilled=function(E){_(this.promise,this.onFulfilled,E)},v.prototype.callRejected=function(E){d.reject(this.promise,E)},v.prototype.otherCallRejected=function(E){_(this.promise,this.onRejected,E)},d.resolve=function(E,T){var I=S(C,T);if(I.status==="error")return d.reject(E,I.value);var M=I.value;if(M)x(E,M);else{E.state=m,E.outcome=T;for(var L=-1,$=E.queue.length;++L<$;)E.queue[L].callFulfilled(T)}return E},d.reject=function(E,T){E.state=h,E.outcome=T;for(var I=-1,M=E.queue.length;++I<M;)E.queue[I].callRejected(T);return E},g.resolve=function(E){return E instanceof this?E:d.resolve(new this(l),E)},g.reject=function(E){var T=new this(l);return d.reject(T,E)},g.all=function(E){var T=this;if(Object.prototype.toString.call(E)!=="[object Array]")return this.reject(new TypeError("must be an array"));var I=E.length,M=!1;if(!I)return this.resolve([]);for(var L=new Array(I),$=0,k=-1,A=new this(l);++k<I;)N(E[k],k);return A;function N(F,q){T.resolve(F).then(function(j){L[q]=j,++$!==I||M||(M=!0,d.resolve(A,L))},function(j){M||(M=!0,d.reject(A,j))})}},g.race=function(E){var T=this;if(Object.prototype.toString.call(E)!=="[object Array]")return this.reject(new TypeError("must be an array"));var I=E.length,M=!1;if(!I)return this.resolve([]);for(var L=-1,$=new this(l);++L<I;)k=E[L],T.resolve(k).then(function(A){M||(M=!0,d.resolve($,A))},function(A){M||(M=!0,d.reject($,A))});var k;return $}},{immediate:36}],38:[function(n,r,i){var o={};(0,n("./lib/utils/common").assign)(o,n("./lib/deflate"),n("./lib/inflate"),n("./lib/zlib/constants")),r.exports=o},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(n,r,i){var o=n("./zlib/deflate"),l=n("./utils/common"),d=n("./utils/strings"),h=n("./zlib/messages"),m=n("./zlib/zstream"),p=Object.prototype.toString,g=0,v=-1,_=0,C=8;function x(E){if(!(this instanceof x))return new x(E);this.options=l.assign({level:v,method:C,chunkSize:16384,windowBits:15,memLevel:8,strategy:_,to:""},E||{});var T=this.options;T.raw&&0<T.windowBits?T.windowBits=-T.windowBits:T.gzip&&0<T.windowBits&&T.windowBits<16&&(T.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new m,this.strm.avail_out=0;var I=o.deflateInit2(this.strm,T.level,T.method,T.windowBits,T.memLevel,T.strategy);if(I!==g)throw new Error(h[I]);if(T.header&&o.deflateSetHeader(this.strm,T.header),T.dictionary){var M;if(M=typeof T.dictionary=="string"?d.string2buf(T.dictionary):p.call(T.dictionary)==="[object ArrayBuffer]"?new Uint8Array(T.dictionary):T.dictionary,(I=o.deflateSetDictionary(this.strm,M))!==g)throw new Error(h[I]);this._dict_set=!0}}function S(E,T){var I=new x(T);if(I.push(E,!0),I.err)throw I.msg||h[I.err];return I.result}x.prototype.push=function(E,T){var I,M,L=this.strm,$=this.options.chunkSize;if(this.ended)return!1;M=T===~~T?T:T===!0?4:0,typeof E=="string"?L.input=d.string2buf(E):p.call(E)==="[object ArrayBuffer]"?L.input=new Uint8Array(E):L.input=E,L.next_in=0,L.avail_in=L.input.length;do{if(L.avail_out===0&&(L.output=new l.Buf8($),L.next_out=0,L.avail_out=$),(I=o.deflate(L,M))!==1&&I!==g)return this.onEnd(I),!(this.ended=!0);L.avail_out!==0&&(L.avail_in!==0||M!==4&&M!==2)||(this.options.to==="string"?this.onData(d.buf2binstring(l.shrinkBuf(L.output,L.next_out))):this.onData(l.shrinkBuf(L.output,L.next_out)))}while((0<L.avail_in||L.avail_out===0)&&I!==1);return M===4?(I=o.deflateEnd(this.strm),this.onEnd(I),this.ended=!0,I===g):M!==2||(this.onEnd(g),!(L.avail_out=0))},x.prototype.onData=function(E){this.chunks.push(E)},x.prototype.onEnd=function(E){E===g&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=l.flattenChunks(this.chunks)),this.chunks=[],this.err=E,this.msg=this.strm.msg},i.Deflate=x,i.deflate=S,i.deflateRaw=function(E,T){return(T=T||{}).raw=!0,S(E,T)},i.gzip=function(E,T){return(T=T||{}).gzip=!0,S(E,T)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(n,r,i){var o=n("./zlib/inflate"),l=n("./utils/common"),d=n("./utils/strings"),h=n("./zlib/constants"),m=n("./zlib/messages"),p=n("./zlib/zstream"),g=n("./zlib/gzheader"),v=Object.prototype.toString;function _(x){if(!(this instanceof _))return new _(x);this.options=l.assign({chunkSize:16384,windowBits:0,to:""},x||{});var S=this.options;S.raw&&0<=S.windowBits&&S.windowBits<16&&(S.windowBits=-S.windowBits,S.windowBits===0&&(S.windowBits=-15)),!(0<=S.windowBits&&S.windowBits<16)||x&&x.windowBits||(S.windowBits+=32),15<S.windowBits&&S.windowBits<48&&(15&S.windowBits)==0&&(S.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new p,this.strm.avail_out=0;var E=o.inflateInit2(this.strm,S.windowBits);if(E!==h.Z_OK)throw new Error(m[E]);this.header=new g,o.inflateGetHeader(this.strm,this.header)}function C(x,S){var E=new _(S);if(E.push(x,!0),E.err)throw E.msg||m[E.err];return E.result}_.prototype.push=function(x,S){var E,T,I,M,L,$,k=this.strm,A=this.options.chunkSize,N=this.options.dictionary,F=!1;if(this.ended)return!1;T=S===~~S?S:S===!0?h.Z_FINISH:h.Z_NO_FLUSH,typeof x=="string"?k.input=d.binstring2buf(x):v.call(x)==="[object ArrayBuffer]"?k.input=new Uint8Array(x):k.input=x,k.next_in=0,k.avail_in=k.input.length;do{if(k.avail_out===0&&(k.output=new l.Buf8(A),k.next_out=0,k.avail_out=A),(E=o.inflate(k,h.Z_NO_FLUSH))===h.Z_NEED_DICT&&N&&($=typeof N=="string"?d.string2buf(N):v.call(N)==="[object ArrayBuffer]"?new Uint8Array(N):N,E=o.inflateSetDictionary(this.strm,$)),E===h.Z_BUF_ERROR&&F===!0&&(E=h.Z_OK,F=!1),E!==h.Z_STREAM_END&&E!==h.Z_OK)return this.onEnd(E),!(this.ended=!0);k.next_out&&(k.avail_out!==0&&E!==h.Z_STREAM_END&&(k.avail_in!==0||T!==h.Z_FINISH&&T!==h.Z_SYNC_FLUSH)||(this.options.to==="string"?(I=d.utf8border(k.output,k.next_out),M=k.next_out-I,L=d.buf2string(k.output,I),k.next_out=M,k.avail_out=A-M,M&&l.arraySet(k.output,k.output,I,M,0),this.onData(L)):this.onData(l.shrinkBuf(k.output,k.next_out)))),k.avail_in===0&&k.avail_out===0&&(F=!0)}while((0<k.avail_in||k.avail_out===0)&&E!==h.Z_STREAM_END);return E===h.Z_STREAM_END&&(T=h.Z_FINISH),T===h.Z_FINISH?(E=o.inflateEnd(this.strm),this.onEnd(E),this.ended=!0,E===h.Z_OK):T!==h.Z_SYNC_FLUSH||(this.onEnd(h.Z_OK),!(k.avail_out=0))},_.prototype.onData=function(x){this.chunks.push(x)},_.prototype.onEnd=function(x){x===h.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=l.flattenChunks(this.chunks)),this.chunks=[],this.err=x,this.msg=this.strm.msg},i.Inflate=_,i.inflate=C,i.inflateRaw=function(x,S){return(S=S||{}).raw=!0,C(x,S)},i.ungzip=C},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(n,r,i){var o=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";i.assign=function(h){for(var m=Array.prototype.slice.call(arguments,1);m.length;){var p=m.shift();if(p){if(typeof p!="object")throw new TypeError(p+"must be non-object");for(var g in p)p.hasOwnProperty(g)&&(h[g]=p[g])}}return h},i.shrinkBuf=function(h,m){return h.length===m?h:h.subarray?h.subarray(0,m):(h.length=m,h)};var l={arraySet:function(h,m,p,g,v){if(m.subarray&&h.subarray)h.set(m.subarray(p,p+g),v);else for(var _=0;_<g;_++)h[v+_]=m[p+_]},flattenChunks:function(h){var m,p,g,v,_,C;for(m=g=0,p=h.length;m<p;m++)g+=h[m].length;for(C=new Uint8Array(g),m=v=0,p=h.length;m<p;m++)_=h[m],C.set(_,v),v+=_.length;return C}},d={arraySet:function(h,m,p,g,v){for(var _=0;_<g;_++)h[v+_]=m[p+_]},flattenChunks:function(h){return[].concat.apply([],h)}};i.setTyped=function(h){h?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,l)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,d))},i.setTyped(o)},{}],42:[function(n,r,i){var o=n("./common"),l=!0,d=!0;try{String.fromCharCode.apply(null,[0])}catch{l=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{d=!1}for(var h=new o.Buf8(256),m=0;m<256;m++)h[m]=252<=m?6:248<=m?5:240<=m?4:224<=m?3:192<=m?2:1;function p(g,v){if(v<65537&&(g.subarray&&d||!g.subarray&&l))return String.fromCharCode.apply(null,o.shrinkBuf(g,v));for(var _="",C=0;C<v;C++)_+=String.fromCharCode(g[C]);return _}h[254]=h[254]=1,i.string2buf=function(g){var v,_,C,x,S,E=g.length,T=0;for(x=0;x<E;x++)(64512&(_=g.charCodeAt(x)))==55296&&x+1<E&&(64512&(C=g.charCodeAt(x+1)))==56320&&(_=65536+(_-55296<<10)+(C-56320),x++),T+=_<128?1:_<2048?2:_<65536?3:4;for(v=new o.Buf8(T),x=S=0;S<T;x++)(64512&(_=g.charCodeAt(x)))==55296&&x+1<E&&(64512&(C=g.charCodeAt(x+1)))==56320&&(_=65536+(_-55296<<10)+(C-56320),x++),_<128?v[S++]=_:(_<2048?v[S++]=192|_>>>6:(_<65536?v[S++]=224|_>>>12:(v[S++]=240|_>>>18,v[S++]=128|_>>>12&63),v[S++]=128|_>>>6&63),v[S++]=128|63&_);return v},i.buf2binstring=function(g){return p(g,g.length)},i.binstring2buf=function(g){for(var v=new o.Buf8(g.length),_=0,C=v.length;_<C;_++)v[_]=g.charCodeAt(_);return v},i.buf2string=function(g,v){var _,C,x,S,E=v||g.length,T=new Array(2*E);for(_=C=0;_<E;)if((x=g[_++])<128)T[C++]=x;else if(4<(S=h[x]))T[C++]=65533,_+=S-1;else{for(x&=S===2?31:S===3?15:7;1<S&&_<E;)x=x<<6|63&g[_++],S--;1<S?T[C++]=65533:x<65536?T[C++]=x:(x-=65536,T[C++]=55296|x>>10&1023,T[C++]=56320|1023&x)}return p(T,C)},i.utf8border=function(g,v){var _;for((v=v||g.length)>g.length&&(v=g.length),_=v-1;0<=_&&(192&g[_])==128;)_--;return _<0||_===0?v:_+h[g[_]]>v?_:v}},{"./common":41}],43:[function(n,r,i){r.exports=function(o,l,d,h){for(var m=65535&o|0,p=o>>>16&65535|0,g=0;d!==0;){for(d-=g=2e3<d?2e3:d;p=p+(m=m+l[h++]|0)|0,--g;);m%=65521,p%=65521}return m|p<<16|0}},{}],44:[function(n,r,i){r.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(n,r,i){var o=(function(){for(var l,d=[],h=0;h<256;h++){l=h;for(var m=0;m<8;m++)l=1&l?3988292384^l>>>1:l>>>1;d[h]=l}return d})();r.exports=function(l,d,h,m){var p=o,g=m+h;l^=-1;for(var v=m;v<g;v++)l=l>>>8^p[255&(l^d[v])];return-1^l}},{}],46:[function(n,r,i){var o,l=n("../utils/common"),d=n("./trees"),h=n("./adler32"),m=n("./crc32"),p=n("./messages"),g=0,v=4,_=0,C=-2,x=-1,S=4,E=2,T=8,I=9,M=286,L=30,$=19,k=2*M+1,A=15,N=3,F=258,q=F+N+1,j=42,P=113,O=1,X=2,W=3,H=4;function Z(U,he){return U.msg=p[he],he}function Y(U){return(U<<1)-(4<U?9:0)}function se(U){for(var he=U.length;0<=--he;)U[he]=0}function B(U){var he=U.state,ye=he.pending;ye>U.avail_out&&(ye=U.avail_out),ye!==0&&(l.arraySet(U.output,he.pending_buf,he.pending_out,ye,U.next_out),U.next_out+=ye,he.pending_out+=ye,U.total_out+=ye,U.avail_out-=ye,he.pending-=ye,he.pending===0&&(he.pending_out=0))}function G(U,he){d._tr_flush_block(U,0<=U.block_start?U.block_start:-1,U.strstart-U.block_start,he),U.block_start=U.strstart,B(U.strm)}function ne(U,he){U.pending_buf[U.pending++]=he}function ie(U,he){U.pending_buf[U.pending++]=he>>>8&255,U.pending_buf[U.pending++]=255&he}function ee(U,he){var ye,te,J=U.max_chain_length,oe=U.strstart,Ce=U.prev_length,Se=U.nice_match,ae=U.strstart>U.w_size-q?U.strstart-(U.w_size-q):0,Ae=U.window,Me=U.w_mask,De=U.prev,He=U.strstart+F,wt=Ae[oe+Ce-1],nt=Ae[oe+Ce];U.prev_length>=U.good_match&&(J>>=2),Se>U.lookahead&&(Se=U.lookahead);do if(Ae[(ye=he)+Ce]===nt&&Ae[ye+Ce-1]===wt&&Ae[ye]===Ae[oe]&&Ae[++ye]===Ae[oe+1]){oe+=2,ye++;do;while(Ae[++oe]===Ae[++ye]&&Ae[++oe]===Ae[++ye]&&Ae[++oe]===Ae[++ye]&&Ae[++oe]===Ae[++ye]&&Ae[++oe]===Ae[++ye]&&Ae[++oe]===Ae[++ye]&&Ae[++oe]===Ae[++ye]&&Ae[++oe]===Ae[++ye]&&oe<He);if(te=F-(He-oe),oe=He-F,Ce<te){if(U.match_start=he,Se<=(Ce=te))break;wt=Ae[oe+Ce-1],nt=Ae[oe+Ce]}}while((he=De[he&Me])>ae&&--J!=0);return Ce<=U.lookahead?Ce:U.lookahead}function ue(U){var he,ye,te,J,oe,Ce,Se,ae,Ae,Me,De=U.w_size;do{if(J=U.window_size-U.lookahead-U.strstart,U.strstart>=De+(De-q)){for(l.arraySet(U.window,U.window,De,De,0),U.match_start-=De,U.strstart-=De,U.block_start-=De,he=ye=U.hash_size;te=U.head[--he],U.head[he]=De<=te?te-De:0,--ye;);for(he=ye=De;te=U.prev[--he],U.prev[he]=De<=te?te-De:0,--ye;);J+=De}if(U.strm.avail_in===0)break;if(Ce=U.strm,Se=U.window,ae=U.strstart+U.lookahead,Ae=J,Me=void 0,Me=Ce.avail_in,Ae<Me&&(Me=Ae),ye=Me===0?0:(Ce.avail_in-=Me,l.arraySet(Se,Ce.input,Ce.next_in,Me,ae),Ce.state.wrap===1?Ce.adler=h(Ce.adler,Se,Me,ae):Ce.state.wrap===2&&(Ce.adler=m(Ce.adler,Se,Me,ae)),Ce.next_in+=Me,Ce.total_in+=Me,Me),U.lookahead+=ye,U.lookahead+U.insert>=N)for(oe=U.strstart-U.insert,U.ins_h=U.window[oe],U.ins_h=(U.ins_h<<U.hash_shift^U.window[oe+1])&U.hash_mask;U.insert&&(U.ins_h=(U.ins_h<<U.hash_shift^U.window[oe+N-1])&U.hash_mask,U.prev[oe&U.w_mask]=U.head[U.ins_h],U.head[U.ins_h]=oe,oe++,U.insert--,!(U.lookahead+U.insert<N)););}while(U.lookahead<q&&U.strm.avail_in!==0)}function be(U,he){for(var ye,te;;){if(U.lookahead<q){if(ue(U),U.lookahead<q&&he===g)return O;if(U.lookahead===0)break}if(ye=0,U.lookahead>=N&&(U.ins_h=(U.ins_h<<U.hash_shift^U.window[U.strstart+N-1])&U.hash_mask,ye=U.prev[U.strstart&U.w_mask]=U.head[U.ins_h],U.head[U.ins_h]=U.strstart),ye!==0&&U.strstart-ye<=U.w_size-q&&(U.match_length=ee(U,ye)),U.match_length>=N)if(te=d._tr_tally(U,U.strstart-U.match_start,U.match_length-N),U.lookahead-=U.match_length,U.match_length<=U.max_lazy_match&&U.lookahead>=N){for(U.match_length--;U.strstart++,U.ins_h=(U.ins_h<<U.hash_shift^U.window[U.strstart+N-1])&U.hash_mask,ye=U.prev[U.strstart&U.w_mask]=U.head[U.ins_h],U.head[U.ins_h]=U.strstart,--U.match_length!=0;);U.strstart++}else U.strstart+=U.match_length,U.match_length=0,U.ins_h=U.window[U.strstart],U.ins_h=(U.ins_h<<U.hash_shift^U.window[U.strstart+1])&U.hash_mask;else te=d._tr_tally(U,0,U.window[U.strstart]),U.lookahead--,U.strstart++;if(te&&(G(U,!1),U.strm.avail_out===0))return O}return U.insert=U.strstart<N-1?U.strstart:N-1,he===v?(G(U,!0),U.strm.avail_out===0?W:H):U.last_lit&&(G(U,!1),U.strm.avail_out===0)?O:X}function ce(U,he){for(var ye,te,J;;){if(U.lookahead<q){if(ue(U),U.lookahead<q&&he===g)return O;if(U.lookahead===0)break}if(ye=0,U.lookahead>=N&&(U.ins_h=(U.ins_h<<U.hash_shift^U.window[U.strstart+N-1])&U.hash_mask,ye=U.prev[U.strstart&U.w_mask]=U.head[U.ins_h],U.head[U.ins_h]=U.strstart),U.prev_length=U.match_length,U.prev_match=U.match_start,U.match_length=N-1,ye!==0&&U.prev_length<U.max_lazy_match&&U.strstart-ye<=U.w_size-q&&(U.match_length=ee(U,ye),U.match_length<=5&&(U.strategy===1||U.match_length===N&&4096<U.strstart-U.match_start)&&(U.match_length=N-1)),U.prev_length>=N&&U.match_length<=U.prev_length){for(J=U.strstart+U.lookahead-N,te=d._tr_tally(U,U.strstart-1-U.prev_match,U.prev_length-N),U.lookahead-=U.prev_length-1,U.prev_length-=2;++U.strstart<=J&&(U.ins_h=(U.ins_h<<U.hash_shift^U.window[U.strstart+N-1])&U.hash_mask,ye=U.prev[U.strstart&U.w_mask]=U.head[U.ins_h],U.head[U.ins_h]=U.strstart),--U.prev_length!=0;);if(U.match_available=0,U.match_length=N-1,U.strstart++,te&&(G(U,!1),U.strm.avail_out===0))return O}else if(U.match_available){if((te=d._tr_tally(U,0,U.window[U.strstart-1]))&&G(U,!1),U.strstart++,U.lookahead--,U.strm.avail_out===0)return O}else U.match_available=1,U.strstart++,U.lookahead--}return U.match_available&&(te=d._tr_tally(U,0,U.window[U.strstart-1]),U.match_available=0),U.insert=U.strstart<N-1?U.strstart:N-1,he===v?(G(U,!0),U.strm.avail_out===0?W:H):U.last_lit&&(G(U,!1),U.strm.avail_out===0)?O:X}function ve(U,he,ye,te,J){this.good_length=U,this.max_lazy=he,this.nice_length=ye,this.max_chain=te,this.func=J}function ze(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=T,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new l.Buf16(2*k),this.dyn_dtree=new l.Buf16(2*(2*L+1)),this.bl_tree=new l.Buf16(2*(2*$+1)),se(this.dyn_ltree),se(this.dyn_dtree),se(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new l.Buf16(A+1),this.heap=new l.Buf16(2*M+1),se(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new l.Buf16(2*M+1),se(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Pe(U){var he;return U&&U.state?(U.total_in=U.total_out=0,U.data_type=E,(he=U.state).pending=0,he.pending_out=0,he.wrap<0&&(he.wrap=-he.wrap),he.status=he.wrap?j:P,U.adler=he.wrap===2?0:1,he.last_flush=g,d._tr_init(he),_):Z(U,C)}function ot(U){var he=Pe(U);return he===_&&(function(ye){ye.window_size=2*ye.w_size,se(ye.head),ye.max_lazy_match=o[ye.level].max_lazy,ye.good_match=o[ye.level].good_length,ye.nice_match=o[ye.level].nice_length,ye.max_chain_length=o[ye.level].max_chain,ye.strstart=0,ye.block_start=0,ye.lookahead=0,ye.insert=0,ye.match_length=ye.prev_length=N-1,ye.match_available=0,ye.ins_h=0})(U.state),he}function _t(U,he,ye,te,J,oe){if(!U)return C;var Ce=1;if(he===x&&(he=6),te<0?(Ce=0,te=-te):15<te&&(Ce=2,te-=16),J<1||I<J||ye!==T||te<8||15<te||he<0||9<he||oe<0||S<oe)return Z(U,C);te===8&&(te=9);var Se=new ze;return(U.state=Se).strm=U,Se.wrap=Ce,Se.gzhead=null,Se.w_bits=te,Se.w_size=1<<Se.w_bits,Se.w_mask=Se.w_size-1,Se.hash_bits=J+7,Se.hash_size=1<<Se.hash_bits,Se.hash_mask=Se.hash_size-1,Se.hash_shift=~~((Se.hash_bits+N-1)/N),Se.window=new l.Buf8(2*Se.w_size),Se.head=new l.Buf16(Se.hash_size),Se.prev=new l.Buf16(Se.w_size),Se.lit_bufsize=1<<J+6,Se.pending_buf_size=4*Se.lit_bufsize,Se.pending_buf=new l.Buf8(Se.pending_buf_size),Se.d_buf=1*Se.lit_bufsize,Se.l_buf=3*Se.lit_bufsize,Se.level=he,Se.strategy=oe,Se.method=ye,ot(U)}o=[new ve(0,0,0,0,function(U,he){var ye=65535;for(ye>U.pending_buf_size-5&&(ye=U.pending_buf_size-5);;){if(U.lookahead<=1){if(ue(U),U.lookahead===0&&he===g)return O;if(U.lookahead===0)break}U.strstart+=U.lookahead,U.lookahead=0;var te=U.block_start+ye;if((U.strstart===0||U.strstart>=te)&&(U.lookahead=U.strstart-te,U.strstart=te,G(U,!1),U.strm.avail_out===0)||U.strstart-U.block_start>=U.w_size-q&&(G(U,!1),U.strm.avail_out===0))return O}return U.insert=0,he===v?(G(U,!0),U.strm.avail_out===0?W:H):(U.strstart>U.block_start&&(G(U,!1),U.strm.avail_out),O)}),new ve(4,4,8,4,be),new ve(4,5,16,8,be),new ve(4,6,32,32,be),new ve(4,4,16,16,ce),new ve(8,16,32,32,ce),new ve(8,16,128,128,ce),new ve(8,32,128,256,ce),new ve(32,128,258,1024,ce),new ve(32,258,258,4096,ce)],i.deflateInit=function(U,he){return _t(U,he,T,15,8,0)},i.deflateInit2=_t,i.deflateReset=ot,i.deflateResetKeep=Pe,i.deflateSetHeader=function(U,he){return U&&U.state?U.state.wrap!==2?C:(U.state.gzhead=he,_):C},i.deflate=function(U,he){var ye,te,J,oe;if(!U||!U.state||5<he||he<0)return U?Z(U,C):C;if(te=U.state,!U.output||!U.input&&U.avail_in!==0||te.status===666&&he!==v)return Z(U,U.avail_out===0?-5:C);if(te.strm=U,ye=te.last_flush,te.last_flush=he,te.status===j)if(te.wrap===2)U.adler=0,ne(te,31),ne(te,139),ne(te,8),te.gzhead?(ne(te,(te.gzhead.text?1:0)+(te.gzhead.hcrc?2:0)+(te.gzhead.extra?4:0)+(te.gzhead.name?8:0)+(te.gzhead.comment?16:0)),ne(te,255&te.gzhead.time),ne(te,te.gzhead.time>>8&255),ne(te,te.gzhead.time>>16&255),ne(te,te.gzhead.time>>24&255),ne(te,te.level===9?2:2<=te.strategy||te.level<2?4:0),ne(te,255&te.gzhead.os),te.gzhead.extra&&te.gzhead.extra.length&&(ne(te,255&te.gzhead.extra.length),ne(te,te.gzhead.extra.length>>8&255)),te.gzhead.hcrc&&(U.adler=m(U.adler,te.pending_buf,te.pending,0)),te.gzindex=0,te.status=69):(ne(te,0),ne(te,0),ne(te,0),ne(te,0),ne(te,0),ne(te,te.level===9?2:2<=te.strategy||te.level<2?4:0),ne(te,3),te.status=P);else{var Ce=T+(te.w_bits-8<<4)<<8;Ce|=(2<=te.strategy||te.level<2?0:te.level<6?1:te.level===6?2:3)<<6,te.strstart!==0&&(Ce|=32),Ce+=31-Ce%31,te.status=P,ie(te,Ce),te.strstart!==0&&(ie(te,U.adler>>>16),ie(te,65535&U.adler)),U.adler=1}if(te.status===69)if(te.gzhead.extra){for(J=te.pending;te.gzindex<(65535&te.gzhead.extra.length)&&(te.pending!==te.pending_buf_size||(te.gzhead.hcrc&&te.pending>J&&(U.adler=m(U.adler,te.pending_buf,te.pending-J,J)),B(U),J=te.pending,te.pending!==te.pending_buf_size));)ne(te,255&te.gzhead.extra[te.gzindex]),te.gzindex++;te.gzhead.hcrc&&te.pending>J&&(U.adler=m(U.adler,te.pending_buf,te.pending-J,J)),te.gzindex===te.gzhead.extra.length&&(te.gzindex=0,te.status=73)}else te.status=73;if(te.status===73)if(te.gzhead.name){J=te.pending;do{if(te.pending===te.pending_buf_size&&(te.gzhead.hcrc&&te.pending>J&&(U.adler=m(U.adler,te.pending_buf,te.pending-J,J)),B(U),J=te.pending,te.pending===te.pending_buf_size)){oe=1;break}oe=te.gzindex<te.gzhead.name.length?255&te.gzhead.name.charCodeAt(te.gzindex++):0,ne(te,oe)}while(oe!==0);te.gzhead.hcrc&&te.pending>J&&(U.adler=m(U.adler,te.pending_buf,te.pending-J,J)),oe===0&&(te.gzindex=0,te.status=91)}else te.status=91;if(te.status===91)if(te.gzhead.comment){J=te.pending;do{if(te.pending===te.pending_buf_size&&(te.gzhead.hcrc&&te.pending>J&&(U.adler=m(U.adler,te.pending_buf,te.pending-J,J)),B(U),J=te.pending,te.pending===te.pending_buf_size)){oe=1;break}oe=te.gzindex<te.gzhead.comment.length?255&te.gzhead.comment.charCodeAt(te.gzindex++):0,ne(te,oe)}while(oe!==0);te.gzhead.hcrc&&te.pending>J&&(U.adler=m(U.adler,te.pending_buf,te.pending-J,J)),oe===0&&(te.status=103)}else te.status=103;if(te.status===103&&(te.gzhead.hcrc?(te.pending+2>te.pending_buf_size&&B(U),te.pending+2<=te.pending_buf_size&&(ne(te,255&U.adler),ne(te,U.adler>>8&255),U.adler=0,te.status=P)):te.status=P),te.pending!==0){if(B(U),U.avail_out===0)return te.last_flush=-1,_}else if(U.avail_in===0&&Y(he)<=Y(ye)&&he!==v)return Z(U,-5);if(te.status===666&&U.avail_in!==0)return Z(U,-5);if(U.avail_in!==0||te.lookahead!==0||he!==g&&te.status!==666){var Se=te.strategy===2?(function(ae,Ae){for(var Me;;){if(ae.lookahead===0&&(ue(ae),ae.lookahead===0)){if(Ae===g)return O;break}if(ae.match_length=0,Me=d._tr_tally(ae,0,ae.window[ae.strstart]),ae.lookahead--,ae.strstart++,Me&&(G(ae,!1),ae.strm.avail_out===0))return O}return ae.insert=0,Ae===v?(G(ae,!0),ae.strm.avail_out===0?W:H):ae.last_lit&&(G(ae,!1),ae.strm.avail_out===0)?O:X})(te,he):te.strategy===3?(function(ae,Ae){for(var Me,De,He,wt,nt=ae.window;;){if(ae.lookahead<=F){if(ue(ae),ae.lookahead<=F&&Ae===g)return O;if(ae.lookahead===0)break}if(ae.match_length=0,ae.lookahead>=N&&0<ae.strstart&&(De=nt[He=ae.strstart-1])===nt[++He]&&De===nt[++He]&&De===nt[++He]){wt=ae.strstart+F;do;while(De===nt[++He]&&De===nt[++He]&&De===nt[++He]&&De===nt[++He]&&De===nt[++He]&&De===nt[++He]&&De===nt[++He]&&De===nt[++He]&&He<wt);ae.match_length=F-(wt-He),ae.match_length>ae.lookahead&&(ae.match_length=ae.lookahead)}if(ae.match_length>=N?(Me=d._tr_tally(ae,1,ae.match_length-N),ae.lookahead-=ae.match_length,ae.strstart+=ae.match_length,ae.match_length=0):(Me=d._tr_tally(ae,0,ae.window[ae.strstart]),ae.lookahead--,ae.strstart++),Me&&(G(ae,!1),ae.strm.avail_out===0))return O}return ae.insert=0,Ae===v?(G(ae,!0),ae.strm.avail_out===0?W:H):ae.last_lit&&(G(ae,!1),ae.strm.avail_out===0)?O:X})(te,he):o[te.level].func(te,he);if(Se!==W&&Se!==H||(te.status=666),Se===O||Se===W)return U.avail_out===0&&(te.last_flush=-1),_;if(Se===X&&(he===1?d._tr_align(te):he!==5&&(d._tr_stored_block(te,0,0,!1),he===3&&(se(te.head),te.lookahead===0&&(te.strstart=0,te.block_start=0,te.insert=0))),B(U),U.avail_out===0))return te.last_flush=-1,_}return he!==v?_:te.wrap<=0?1:(te.wrap===2?(ne(te,255&U.adler),ne(te,U.adler>>8&255),ne(te,U.adler>>16&255),ne(te,U.adler>>24&255),ne(te,255&U.total_in),ne(te,U.total_in>>8&255),ne(te,U.total_in>>16&255),ne(te,U.total_in>>24&255)):(ie(te,U.adler>>>16),ie(te,65535&U.adler)),B(U),0<te.wrap&&(te.wrap=-te.wrap),te.pending!==0?_:1)},i.deflateEnd=function(U){var he;return U&&U.state?(he=U.state.status)!==j&&he!==69&&he!==73&&he!==91&&he!==103&&he!==P&&he!==666?Z(U,C):(U.state=null,he===P?Z(U,-3):_):C},i.deflateSetDictionary=function(U,he){var ye,te,J,oe,Ce,Se,ae,Ae,Me=he.length;if(!U||!U.state||(oe=(ye=U.state).wrap)===2||oe===1&&ye.status!==j||ye.lookahead)return C;for(oe===1&&(U.adler=h(U.adler,he,Me,0)),ye.wrap=0,Me>=ye.w_size&&(oe===0&&(se(ye.head),ye.strstart=0,ye.block_start=0,ye.insert=0),Ae=new l.Buf8(ye.w_size),l.arraySet(Ae,he,Me-ye.w_size,ye.w_size,0),he=Ae,Me=ye.w_size),Ce=U.avail_in,Se=U.next_in,ae=U.input,U.avail_in=Me,U.next_in=0,U.input=he,ue(ye);ye.lookahead>=N;){for(te=ye.strstart,J=ye.lookahead-(N-1);ye.ins_h=(ye.ins_h<<ye.hash_shift^ye.window[te+N-1])&ye.hash_mask,ye.prev[te&ye.w_mask]=ye.head[ye.ins_h],ye.head[ye.ins_h]=te,te++,--J;);ye.strstart=te,ye.lookahead=N-1,ue(ye)}return ye.strstart+=ye.lookahead,ye.block_start=ye.strstart,ye.insert=ye.lookahead,ye.lookahead=0,ye.match_length=ye.prev_length=N-1,ye.match_available=0,U.next_in=Se,U.input=ae,U.avail_in=Ce,ye.wrap=oe,_},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(n,r,i){r.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(n,r,i){r.exports=function(o,l){var d,h,m,p,g,v,_,C,x,S,E,T,I,M,L,$,k,A,N,F,q,j,P,O,X;d=o.state,h=o.next_in,O=o.input,m=h+(o.avail_in-5),p=o.next_out,X=o.output,g=p-(l-o.avail_out),v=p+(o.avail_out-257),_=d.dmax,C=d.wsize,x=d.whave,S=d.wnext,E=d.window,T=d.hold,I=d.bits,M=d.lencode,L=d.distcode,$=(1<<d.lenbits)-1,k=(1<<d.distbits)-1;e:do{I<15&&(T+=O[h++]<<I,I+=8,T+=O[h++]<<I,I+=8),A=M[T&$];t:for(;;){if(T>>>=N=A>>>24,I-=N,(N=A>>>16&255)===0)X[p++]=65535&A;else{if(!(16&N)){if((64&N)==0){A=M[(65535&A)+(T&(1<<N)-1)];continue t}if(32&N){d.mode=12;break e}o.msg="invalid literal/length code",d.mode=30;break e}F=65535&A,(N&=15)&&(I<N&&(T+=O[h++]<<I,I+=8),F+=T&(1<<N)-1,T>>>=N,I-=N),I<15&&(T+=O[h++]<<I,I+=8,T+=O[h++]<<I,I+=8),A=L[T&k];n:for(;;){if(T>>>=N=A>>>24,I-=N,!(16&(N=A>>>16&255))){if((64&N)==0){A=L[(65535&A)+(T&(1<<N)-1)];continue n}o.msg="invalid distance code",d.mode=30;break e}if(q=65535&A,I<(N&=15)&&(T+=O[h++]<<I,(I+=8)<N&&(T+=O[h++]<<I,I+=8)),_<(q+=T&(1<<N)-1)){o.msg="invalid distance too far back",d.mode=30;break e}if(T>>>=N,I-=N,(N=p-g)<q){if(x<(N=q-N)&&d.sane){o.msg="invalid distance too far back",d.mode=30;break e}if(P=E,(j=0)===S){if(j+=C-N,N<F){for(F-=N;X[p++]=E[j++],--N;);j=p-q,P=X}}else if(S<N){if(j+=C+S-N,(N-=S)<F){for(F-=N;X[p++]=E[j++],--N;);if(j=0,S<F){for(F-=N=S;X[p++]=E[j++],--N;);j=p-q,P=X}}}else if(j+=S-N,N<F){for(F-=N;X[p++]=E[j++],--N;);j=p-q,P=X}for(;2<F;)X[p++]=P[j++],X[p++]=P[j++],X[p++]=P[j++],F-=3;F&&(X[p++]=P[j++],1<F&&(X[p++]=P[j++]))}else{for(j=p-q;X[p++]=X[j++],X[p++]=X[j++],X[p++]=X[j++],2<(F-=3););F&&(X[p++]=X[j++],1<F&&(X[p++]=X[j++]))}break}}break}}while(h<m&&p<v);h-=F=I>>3,T&=(1<<(I-=F<<3))-1,o.next_in=h,o.next_out=p,o.avail_in=h<m?m-h+5:5-(h-m),o.avail_out=p<v?v-p+257:257-(p-v),d.hold=T,d.bits=I}},{}],49:[function(n,r,i){var o=n("../utils/common"),l=n("./adler32"),d=n("./crc32"),h=n("./inffast"),m=n("./inftrees"),p=1,g=2,v=0,_=-2,C=1,x=852,S=592;function E(j){return(j>>>24&255)+(j>>>8&65280)+((65280&j)<<8)+((255&j)<<24)}function T(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new o.Buf16(320),this.work=new o.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function I(j){var P;return j&&j.state?(P=j.state,j.total_in=j.total_out=P.total=0,j.msg="",P.wrap&&(j.adler=1&P.wrap),P.mode=C,P.last=0,P.havedict=0,P.dmax=32768,P.head=null,P.hold=0,P.bits=0,P.lencode=P.lendyn=new o.Buf32(x),P.distcode=P.distdyn=new o.Buf32(S),P.sane=1,P.back=-1,v):_}function M(j){var P;return j&&j.state?((P=j.state).wsize=0,P.whave=0,P.wnext=0,I(j)):_}function L(j,P){var O,X;return j&&j.state?(X=j.state,P<0?(O=0,P=-P):(O=1+(P>>4),P<48&&(P&=15)),P&&(P<8||15<P)?_:(X.window!==null&&X.wbits!==P&&(X.window=null),X.wrap=O,X.wbits=P,M(j))):_}function $(j,P){var O,X;return j?(X=new T,(j.state=X).window=null,(O=L(j,P))!==v&&(j.state=null),O):_}var k,A,N=!0;function F(j){if(N){var P;for(k=new o.Buf32(512),A=new o.Buf32(32),P=0;P<144;)j.lens[P++]=8;for(;P<256;)j.lens[P++]=9;for(;P<280;)j.lens[P++]=7;for(;P<288;)j.lens[P++]=8;for(m(p,j.lens,0,288,k,0,j.work,{bits:9}),P=0;P<32;)j.lens[P++]=5;m(g,j.lens,0,32,A,0,j.work,{bits:5}),N=!1}j.lencode=k,j.lenbits=9,j.distcode=A,j.distbits=5}function q(j,P,O,X){var W,H=j.state;return H.window===null&&(H.wsize=1<<H.wbits,H.wnext=0,H.whave=0,H.window=new o.Buf8(H.wsize)),X>=H.wsize?(o.arraySet(H.window,P,O-H.wsize,H.wsize,0),H.wnext=0,H.whave=H.wsize):(X<(W=H.wsize-H.wnext)&&(W=X),o.arraySet(H.window,P,O-X,W,H.wnext),(X-=W)?(o.arraySet(H.window,P,O-X,X,0),H.wnext=X,H.whave=H.wsize):(H.wnext+=W,H.wnext===H.wsize&&(H.wnext=0),H.whave<H.wsize&&(H.whave+=W))),0}i.inflateReset=M,i.inflateReset2=L,i.inflateResetKeep=I,i.inflateInit=function(j){return $(j,15)},i.inflateInit2=$,i.inflate=function(j,P){var O,X,W,H,Z,Y,se,B,G,ne,ie,ee,ue,be,ce,ve,ze,Pe,ot,_t,U,he,ye,te,J=0,oe=new o.Buf8(4),Ce=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!j||!j.state||!j.output||!j.input&&j.avail_in!==0)return _;(O=j.state).mode===12&&(O.mode=13),Z=j.next_out,W=j.output,se=j.avail_out,H=j.next_in,X=j.input,Y=j.avail_in,B=O.hold,G=O.bits,ne=Y,ie=se,he=v;e:for(;;)switch(O.mode){case C:if(O.wrap===0){O.mode=13;break}for(;G<16;){if(Y===0)break e;Y--,B+=X[H++]<<G,G+=8}if(2&O.wrap&&B===35615){oe[O.check=0]=255&B,oe[1]=B>>>8&255,O.check=d(O.check,oe,2,0),G=B=0,O.mode=2;break}if(O.flags=0,O.head&&(O.head.done=!1),!(1&O.wrap)||(((255&B)<<8)+(B>>8))%31){j.msg="incorrect header check",O.mode=30;break}if((15&B)!=8){j.msg="unknown compression method",O.mode=30;break}if(G-=4,U=8+(15&(B>>>=4)),O.wbits===0)O.wbits=U;else if(U>O.wbits){j.msg="invalid window size",O.mode=30;break}O.dmax=1<<U,j.adler=O.check=1,O.mode=512&B?10:12,G=B=0;break;case 2:for(;G<16;){if(Y===0)break e;Y--,B+=X[H++]<<G,G+=8}if(O.flags=B,(255&O.flags)!=8){j.msg="unknown compression method",O.mode=30;break}if(57344&O.flags){j.msg="unknown header flags set",O.mode=30;break}O.head&&(O.head.text=B>>8&1),512&O.flags&&(oe[0]=255&B,oe[1]=B>>>8&255,O.check=d(O.check,oe,2,0)),G=B=0,O.mode=3;case 3:for(;G<32;){if(Y===0)break e;Y--,B+=X[H++]<<G,G+=8}O.head&&(O.head.time=B),512&O.flags&&(oe[0]=255&B,oe[1]=B>>>8&255,oe[2]=B>>>16&255,oe[3]=B>>>24&255,O.check=d(O.check,oe,4,0)),G=B=0,O.mode=4;case 4:for(;G<16;){if(Y===0)break e;Y--,B+=X[H++]<<G,G+=8}O.head&&(O.head.xflags=255&B,O.head.os=B>>8),512&O.flags&&(oe[0]=255&B,oe[1]=B>>>8&255,O.check=d(O.check,oe,2,0)),G=B=0,O.mode=5;case 5:if(1024&O.flags){for(;G<16;){if(Y===0)break e;Y--,B+=X[H++]<<G,G+=8}O.length=B,O.head&&(O.head.extra_len=B),512&O.flags&&(oe[0]=255&B,oe[1]=B>>>8&255,O.check=d(O.check,oe,2,0)),G=B=0}else O.head&&(O.head.extra=null);O.mode=6;case 6:if(1024&O.flags&&(Y<(ee=O.length)&&(ee=Y),ee&&(O.head&&(U=O.head.extra_len-O.length,O.head.extra||(O.head.extra=new Array(O.head.extra_len)),o.arraySet(O.head.extra,X,H,ee,U)),512&O.flags&&(O.check=d(O.check,X,ee,H)),Y-=ee,H+=ee,O.length-=ee),O.length))break e;O.length=0,O.mode=7;case 7:if(2048&O.flags){if(Y===0)break e;for(ee=0;U=X[H+ee++],O.head&&U&&O.length<65536&&(O.head.name+=String.fromCharCode(U)),U&&ee<Y;);if(512&O.flags&&(O.check=d(O.check,X,ee,H)),Y-=ee,H+=ee,U)break e}else O.head&&(O.head.name=null);O.length=0,O.mode=8;case 8:if(4096&O.flags){if(Y===0)break e;for(ee=0;U=X[H+ee++],O.head&&U&&O.length<65536&&(O.head.comment+=String.fromCharCode(U)),U&&ee<Y;);if(512&O.flags&&(O.check=d(O.check,X,ee,H)),Y-=ee,H+=ee,U)break e}else O.head&&(O.head.comment=null);O.mode=9;case 9:if(512&O.flags){for(;G<16;){if(Y===0)break e;Y--,B+=X[H++]<<G,G+=8}if(B!==(65535&O.check)){j.msg="header crc mismatch",O.mode=30;break}G=B=0}O.head&&(O.head.hcrc=O.flags>>9&1,O.head.done=!0),j.adler=O.check=0,O.mode=12;break;case 10:for(;G<32;){if(Y===0)break e;Y--,B+=X[H++]<<G,G+=8}j.adler=O.check=E(B),G=B=0,O.mode=11;case 11:if(O.havedict===0)return j.next_out=Z,j.avail_out=se,j.next_in=H,j.avail_in=Y,O.hold=B,O.bits=G,2;j.adler=O.check=1,O.mode=12;case 12:if(P===5||P===6)break e;case 13:if(O.last){B>>>=7&G,G-=7&G,O.mode=27;break}for(;G<3;){if(Y===0)break e;Y--,B+=X[H++]<<G,G+=8}switch(O.last=1&B,G-=1,3&(B>>>=1)){case 0:O.mode=14;break;case 1:if(F(O),O.mode=20,P!==6)break;B>>>=2,G-=2;break e;case 2:O.mode=17;break;case 3:j.msg="invalid block type",O.mode=30}B>>>=2,G-=2;break;case 14:for(B>>>=7&G,G-=7&G;G<32;){if(Y===0)break e;Y--,B+=X[H++]<<G,G+=8}if((65535&B)!=(B>>>16^65535)){j.msg="invalid stored block lengths",O.mode=30;break}if(O.length=65535&B,G=B=0,O.mode=15,P===6)break e;case 15:O.mode=16;case 16:if(ee=O.length){if(Y<ee&&(ee=Y),se<ee&&(ee=se),ee===0)break e;o.arraySet(W,X,H,ee,Z),Y-=ee,H+=ee,se-=ee,Z+=ee,O.length-=ee;break}O.mode=12;break;case 17:for(;G<14;){if(Y===0)break e;Y--,B+=X[H++]<<G,G+=8}if(O.nlen=257+(31&B),B>>>=5,G-=5,O.ndist=1+(31&B),B>>>=5,G-=5,O.ncode=4+(15&B),B>>>=4,G-=4,286<O.nlen||30<O.ndist){j.msg="too many length or distance symbols",O.mode=30;break}O.have=0,O.mode=18;case 18:for(;O.have<O.ncode;){for(;G<3;){if(Y===0)break e;Y--,B+=X[H++]<<G,G+=8}O.lens[Ce[O.have++]]=7&B,B>>>=3,G-=3}for(;O.have<19;)O.lens[Ce[O.have++]]=0;if(O.lencode=O.lendyn,O.lenbits=7,ye={bits:O.lenbits},he=m(0,O.lens,0,19,O.lencode,0,O.work,ye),O.lenbits=ye.bits,he){j.msg="invalid code lengths set",O.mode=30;break}O.have=0,O.mode=19;case 19:for(;O.have<O.nlen+O.ndist;){for(;ve=(J=O.lencode[B&(1<<O.lenbits)-1])>>>16&255,ze=65535&J,!((ce=J>>>24)<=G);){if(Y===0)break e;Y--,B+=X[H++]<<G,G+=8}if(ze<16)B>>>=ce,G-=ce,O.lens[O.have++]=ze;else{if(ze===16){for(te=ce+2;G<te;){if(Y===0)break e;Y--,B+=X[H++]<<G,G+=8}if(B>>>=ce,G-=ce,O.have===0){j.msg="invalid bit length repeat",O.mode=30;break}U=O.lens[O.have-1],ee=3+(3&B),B>>>=2,G-=2}else if(ze===17){for(te=ce+3;G<te;){if(Y===0)break e;Y--,B+=X[H++]<<G,G+=8}G-=ce,U=0,ee=3+(7&(B>>>=ce)),B>>>=3,G-=3}else{for(te=ce+7;G<te;){if(Y===0)break e;Y--,B+=X[H++]<<G,G+=8}G-=ce,U=0,ee=11+(127&(B>>>=ce)),B>>>=7,G-=7}if(O.have+ee>O.nlen+O.ndist){j.msg="invalid bit length repeat",O.mode=30;break}for(;ee--;)O.lens[O.have++]=U}}if(O.mode===30)break;if(O.lens[256]===0){j.msg="invalid code -- missing end-of-block",O.mode=30;break}if(O.lenbits=9,ye={bits:O.lenbits},he=m(p,O.lens,0,O.nlen,O.lencode,0,O.work,ye),O.lenbits=ye.bits,he){j.msg="invalid literal/lengths set",O.mode=30;break}if(O.distbits=6,O.distcode=O.distdyn,ye={bits:O.distbits},he=m(g,O.lens,O.nlen,O.ndist,O.distcode,0,O.work,ye),O.distbits=ye.bits,he){j.msg="invalid distances set",O.mode=30;break}if(O.mode=20,P===6)break e;case 20:O.mode=21;case 21:if(6<=Y&&258<=se){j.next_out=Z,j.avail_out=se,j.next_in=H,j.avail_in=Y,O.hold=B,O.bits=G,h(j,ie),Z=j.next_out,W=j.output,se=j.avail_out,H=j.next_in,X=j.input,Y=j.avail_in,B=O.hold,G=O.bits,O.mode===12&&(O.back=-1);break}for(O.back=0;ve=(J=O.lencode[B&(1<<O.lenbits)-1])>>>16&255,ze=65535&J,!((ce=J>>>24)<=G);){if(Y===0)break e;Y--,B+=X[H++]<<G,G+=8}if(ve&&(240&ve)==0){for(Pe=ce,ot=ve,_t=ze;ve=(J=O.lencode[_t+((B&(1<<Pe+ot)-1)>>Pe)])>>>16&255,ze=65535&J,!(Pe+(ce=J>>>24)<=G);){if(Y===0)break e;Y--,B+=X[H++]<<G,G+=8}B>>>=Pe,G-=Pe,O.back+=Pe}if(B>>>=ce,G-=ce,O.back+=ce,O.length=ze,ve===0){O.mode=26;break}if(32&ve){O.back=-1,O.mode=12;break}if(64&ve){j.msg="invalid literal/length code",O.mode=30;break}O.extra=15&ve,O.mode=22;case 22:if(O.extra){for(te=O.extra;G<te;){if(Y===0)break e;Y--,B+=X[H++]<<G,G+=8}O.length+=B&(1<<O.extra)-1,B>>>=O.extra,G-=O.extra,O.back+=O.extra}O.was=O.length,O.mode=23;case 23:for(;ve=(J=O.distcode[B&(1<<O.distbits)-1])>>>16&255,ze=65535&J,!((ce=J>>>24)<=G);){if(Y===0)break e;Y--,B+=X[H++]<<G,G+=8}if((240&ve)==0){for(Pe=ce,ot=ve,_t=ze;ve=(J=O.distcode[_t+((B&(1<<Pe+ot)-1)>>Pe)])>>>16&255,ze=65535&J,!(Pe+(ce=J>>>24)<=G);){if(Y===0)break e;Y--,B+=X[H++]<<G,G+=8}B>>>=Pe,G-=Pe,O.back+=Pe}if(B>>>=ce,G-=ce,O.back+=ce,64&ve){j.msg="invalid distance code",O.mode=30;break}O.offset=ze,O.extra=15&ve,O.mode=24;case 24:if(O.extra){for(te=O.extra;G<te;){if(Y===0)break e;Y--,B+=X[H++]<<G,G+=8}O.offset+=B&(1<<O.extra)-1,B>>>=O.extra,G-=O.extra,O.back+=O.extra}if(O.offset>O.dmax){j.msg="invalid distance too far back",O.mode=30;break}O.mode=25;case 25:if(se===0)break e;if(ee=ie-se,O.offset>ee){if((ee=O.offset-ee)>O.whave&&O.sane){j.msg="invalid distance too far back",O.mode=30;break}ue=ee>O.wnext?(ee-=O.wnext,O.wsize-ee):O.wnext-ee,ee>O.length&&(ee=O.length),be=O.window}else be=W,ue=Z-O.offset,ee=O.length;for(se<ee&&(ee=se),se-=ee,O.length-=ee;W[Z++]=be[ue++],--ee;);O.length===0&&(O.mode=21);break;case 26:if(se===0)break e;W[Z++]=O.length,se--,O.mode=21;break;case 27:if(O.wrap){for(;G<32;){if(Y===0)break e;Y--,B|=X[H++]<<G,G+=8}if(ie-=se,j.total_out+=ie,O.total+=ie,ie&&(j.adler=O.check=O.flags?d(O.check,W,ie,Z-ie):l(O.check,W,ie,Z-ie)),ie=se,(O.flags?B:E(B))!==O.check){j.msg="incorrect data check",O.mode=30;break}G=B=0}O.mode=28;case 28:if(O.wrap&&O.flags){for(;G<32;){if(Y===0)break e;Y--,B+=X[H++]<<G,G+=8}if(B!==(4294967295&O.total)){j.msg="incorrect length check",O.mode=30;break}G=B=0}O.mode=29;case 29:he=1;break e;case 30:he=-3;break e;case 31:return-4;default:return _}return j.next_out=Z,j.avail_out=se,j.next_in=H,j.avail_in=Y,O.hold=B,O.bits=G,(O.wsize||ie!==j.avail_out&&O.mode<30&&(O.mode<27||P!==4))&&q(j,j.output,j.next_out,ie-j.avail_out)?(O.mode=31,-4):(ne-=j.avail_in,ie-=j.avail_out,j.total_in+=ne,j.total_out+=ie,O.total+=ie,O.wrap&&ie&&(j.adler=O.check=O.flags?d(O.check,W,ie,j.next_out-ie):l(O.check,W,ie,j.next_out-ie)),j.data_type=O.bits+(O.last?64:0)+(O.mode===12?128:0)+(O.mode===20||O.mode===15?256:0),(ne==0&&ie===0||P===4)&&he===v&&(he=-5),he)},i.inflateEnd=function(j){if(!j||!j.state)return _;var P=j.state;return P.window&&(P.window=null),j.state=null,v},i.inflateGetHeader=function(j,P){var O;return j&&j.state?(2&(O=j.state).wrap)==0?_:((O.head=P).done=!1,v):_},i.inflateSetDictionary=function(j,P){var O,X=P.length;return j&&j.state?(O=j.state).wrap!==0&&O.mode!==11?_:O.mode===11&&l(1,P,X,0)!==O.check?-3:q(j,P,X,X)?(O.mode=31,-4):(O.havedict=1,v):_},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(n,r,i){var o=n("../utils/common"),l=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],d=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],h=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],m=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];r.exports=function(p,g,v,_,C,x,S,E){var T,I,M,L,$,k,A,N,F,q=E.bits,j=0,P=0,O=0,X=0,W=0,H=0,Z=0,Y=0,se=0,B=0,G=null,ne=0,ie=new o.Buf16(16),ee=new o.Buf16(16),ue=null,be=0;for(j=0;j<=15;j++)ie[j]=0;for(P=0;P<_;P++)ie[g[v+P]]++;for(W=q,X=15;1<=X&&ie[X]===0;X--);if(X<W&&(W=X),X===0)return C[x++]=20971520,C[x++]=20971520,E.bits=1,0;for(O=1;O<X&&ie[O]===0;O++);for(W<O&&(W=O),j=Y=1;j<=15;j++)if(Y<<=1,(Y-=ie[j])<0)return-1;if(0<Y&&(p===0||X!==1))return-1;for(ee[1]=0,j=1;j<15;j++)ee[j+1]=ee[j]+ie[j];for(P=0;P<_;P++)g[v+P]!==0&&(S[ee[g[v+P]]++]=P);if(k=p===0?(G=ue=S,19):p===1?(G=l,ne-=257,ue=d,be-=257,256):(G=h,ue=m,-1),j=O,$=x,Z=P=B=0,M=-1,L=(se=1<<(H=W))-1,p===1&&852<se||p===2&&592<se)return 1;for(;;){for(A=j-Z,F=S[P]<k?(N=0,S[P]):S[P]>k?(N=ue[be+S[P]],G[ne+S[P]]):(N=96,0),T=1<<j-Z,O=I=1<<H;C[$+(B>>Z)+(I-=T)]=A<<24|N<<16|F|0,I!==0;);for(T=1<<j-1;B&T;)T>>=1;if(T!==0?(B&=T-1,B+=T):B=0,P++,--ie[j]==0){if(j===X)break;j=g[v+S[P]]}if(W<j&&(B&L)!==M){for(Z===0&&(Z=W),$+=O,Y=1<<(H=j-Z);H+Z<X&&!((Y-=ie[H+Z])<=0);)H++,Y<<=1;if(se+=1<<H,p===1&&852<se||p===2&&592<se)return 1;C[M=B&L]=W<<24|H<<16|$-x|0}}return B!==0&&(C[$+B]=j-Z<<24|64<<16|0),E.bits=W,0}},{"../utils/common":41}],51:[function(n,r,i){r.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(n,r,i){var o=n("../utils/common"),l=0,d=1;function h(J){for(var oe=J.length;0<=--oe;)J[oe]=0}var m=0,p=29,g=256,v=g+1+p,_=30,C=19,x=2*v+1,S=15,E=16,T=7,I=256,M=16,L=17,$=18,k=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],A=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],N=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],F=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],q=new Array(2*(v+2));h(q);var j=new Array(2*_);h(j);var P=new Array(512);h(P);var O=new Array(256);h(O);var X=new Array(p);h(X);var W,H,Z,Y=new Array(_);function se(J,oe,Ce,Se,ae){this.static_tree=J,this.extra_bits=oe,this.extra_base=Ce,this.elems=Se,this.max_length=ae,this.has_stree=J&&J.length}function B(J,oe){this.dyn_tree=J,this.max_code=0,this.stat_desc=oe}function G(J){return J<256?P[J]:P[256+(J>>>7)]}function ne(J,oe){J.pending_buf[J.pending++]=255&oe,J.pending_buf[J.pending++]=oe>>>8&255}function ie(J,oe,Ce){J.bi_valid>E-Ce?(J.bi_buf|=oe<<J.bi_valid&65535,ne(J,J.bi_buf),J.bi_buf=oe>>E-J.bi_valid,J.bi_valid+=Ce-E):(J.bi_buf|=oe<<J.bi_valid&65535,J.bi_valid+=Ce)}function ee(J,oe,Ce){ie(J,Ce[2*oe],Ce[2*oe+1])}function ue(J,oe){for(var Ce=0;Ce|=1&J,J>>>=1,Ce<<=1,0<--oe;);return Ce>>>1}function be(J,oe,Ce){var Se,ae,Ae=new Array(S+1),Me=0;for(Se=1;Se<=S;Se++)Ae[Se]=Me=Me+Ce[Se-1]<<1;for(ae=0;ae<=oe;ae++){var De=J[2*ae+1];De!==0&&(J[2*ae]=ue(Ae[De]++,De))}}function ce(J){var oe;for(oe=0;oe<v;oe++)J.dyn_ltree[2*oe]=0;for(oe=0;oe<_;oe++)J.dyn_dtree[2*oe]=0;for(oe=0;oe<C;oe++)J.bl_tree[2*oe]=0;J.dyn_ltree[2*I]=1,J.opt_len=J.static_len=0,J.last_lit=J.matches=0}function ve(J){8<J.bi_valid?ne(J,J.bi_buf):0<J.bi_valid&&(J.pending_buf[J.pending++]=J.bi_buf),J.bi_buf=0,J.bi_valid=0}function ze(J,oe,Ce,Se){var ae=2*oe,Ae=2*Ce;return J[ae]<J[Ae]||J[ae]===J[Ae]&&Se[oe]<=Se[Ce]}function Pe(J,oe,Ce){for(var Se=J.heap[Ce],ae=Ce<<1;ae<=J.heap_len&&(ae<J.heap_len&&ze(oe,J.heap[ae+1],J.heap[ae],J.depth)&&ae++,!ze(oe,Se,J.heap[ae],J.depth));)J.heap[Ce]=J.heap[ae],Ce=ae,ae<<=1;J.heap[Ce]=Se}function ot(J,oe,Ce){var Se,ae,Ae,Me,De=0;if(J.last_lit!==0)for(;Se=J.pending_buf[J.d_buf+2*De]<<8|J.pending_buf[J.d_buf+2*De+1],ae=J.pending_buf[J.l_buf+De],De++,Se===0?ee(J,ae,oe):(ee(J,(Ae=O[ae])+g+1,oe),(Me=k[Ae])!==0&&ie(J,ae-=X[Ae],Me),ee(J,Ae=G(--Se),Ce),(Me=A[Ae])!==0&&ie(J,Se-=Y[Ae],Me)),De<J.last_lit;);ee(J,I,oe)}function _t(J,oe){var Ce,Se,ae,Ae=oe.dyn_tree,Me=oe.stat_desc.static_tree,De=oe.stat_desc.has_stree,He=oe.stat_desc.elems,wt=-1;for(J.heap_len=0,J.heap_max=x,Ce=0;Ce<He;Ce++)Ae[2*Ce]!==0?(J.heap[++J.heap_len]=wt=Ce,J.depth[Ce]=0):Ae[2*Ce+1]=0;for(;J.heap_len<2;)Ae[2*(ae=J.heap[++J.heap_len]=wt<2?++wt:0)]=1,J.depth[ae]=0,J.opt_len--,De&&(J.static_len-=Me[2*ae+1]);for(oe.max_code=wt,Ce=J.heap_len>>1;1<=Ce;Ce--)Pe(J,Ae,Ce);for(ae=He;Ce=J.heap[1],J.heap[1]=J.heap[J.heap_len--],Pe(J,Ae,1),Se=J.heap[1],J.heap[--J.heap_max]=Ce,J.heap[--J.heap_max]=Se,Ae[2*ae]=Ae[2*Ce]+Ae[2*Se],J.depth[ae]=(J.depth[Ce]>=J.depth[Se]?J.depth[Ce]:J.depth[Se])+1,Ae[2*Ce+1]=Ae[2*Se+1]=ae,J.heap[1]=ae++,Pe(J,Ae,1),2<=J.heap_len;);J.heap[--J.heap_max]=J.heap[1],(function(nt,Qn){var ms,er,ps,vt,en,Wn,Et=Qn.dyn_tree,Ua=Qn.max_code,Ai=Qn.stat_desc.static_tree,Uo=Qn.stat_desc.has_stree,Ir=Qn.stat_desc.extra_bits,gs=Qn.stat_desc.extra_base,Ut=Qn.stat_desc.max_length,tr=0;for(vt=0;vt<=S;vt++)nt.bl_count[vt]=0;for(Et[2*nt.heap[nt.heap_max]+1]=0,ms=nt.heap_max+1;ms<x;ms++)Ut<(vt=Et[2*Et[2*(er=nt.heap[ms])+1]+1]+1)&&(vt=Ut,tr++),Et[2*er+1]=vt,Ua<er||(nt.bl_count[vt]++,en=0,gs<=er&&(en=Ir[er-gs]),Wn=Et[2*er],nt.opt_len+=Wn*(vt+en),Uo&&(nt.static_len+=Wn*(Ai[2*er+1]+en)));if(tr!==0){do{for(vt=Ut-1;nt.bl_count[vt]===0;)vt--;nt.bl_count[vt]--,nt.bl_count[vt+1]+=2,nt.bl_count[Ut]--,tr-=2}while(0<tr);for(vt=Ut;vt!==0;vt--)for(er=nt.bl_count[vt];er!==0;)Ua<(ps=nt.heap[--ms])||(Et[2*ps+1]!==vt&&(nt.opt_len+=(vt-Et[2*ps+1])*Et[2*ps],Et[2*ps+1]=vt),er--)}})(J,oe),be(Ae,wt,J.bl_count)}function U(J,oe,Ce){var Se,ae,Ae=-1,Me=oe[1],De=0,He=7,wt=4;for(Me===0&&(He=138,wt=3),oe[2*(Ce+1)+1]=65535,Se=0;Se<=Ce;Se++)ae=Me,Me=oe[2*(Se+1)+1],++De<He&&ae===Me||(De<wt?J.bl_tree[2*ae]+=De:ae!==0?(ae!==Ae&&J.bl_tree[2*ae]++,J.bl_tree[2*M]++):De<=10?J.bl_tree[2*L]++:J.bl_tree[2*$]++,Ae=ae,wt=(De=0)===Me?(He=138,3):ae===Me?(He=6,3):(He=7,4))}function he(J,oe,Ce){var Se,ae,Ae=-1,Me=oe[1],De=0,He=7,wt=4;for(Me===0&&(He=138,wt=3),Se=0;Se<=Ce;Se++)if(ae=Me,Me=oe[2*(Se+1)+1],!(++De<He&&ae===Me)){if(De<wt)for(;ee(J,ae,J.bl_tree),--De!=0;);else ae!==0?(ae!==Ae&&(ee(J,ae,J.bl_tree),De--),ee(J,M,J.bl_tree),ie(J,De-3,2)):De<=10?(ee(J,L,J.bl_tree),ie(J,De-3,3)):(ee(J,$,J.bl_tree),ie(J,De-11,7));Ae=ae,wt=(De=0)===Me?(He=138,3):ae===Me?(He=6,3):(He=7,4)}}h(Y);var ye=!1;function te(J,oe,Ce,Se){ie(J,(m<<1)+(Se?1:0),3),(function(ae,Ae,Me,De){ve(ae),ne(ae,Me),ne(ae,~Me),o.arraySet(ae.pending_buf,ae.window,Ae,Me,ae.pending),ae.pending+=Me})(J,oe,Ce)}i._tr_init=function(J){ye||((function(){var oe,Ce,Se,ae,Ae,Me=new Array(S+1);for(ae=Se=0;ae<p-1;ae++)for(X[ae]=Se,oe=0;oe<1<<k[ae];oe++)O[Se++]=ae;for(O[Se-1]=ae,ae=Ae=0;ae<16;ae++)for(Y[ae]=Ae,oe=0;oe<1<<A[ae];oe++)P[Ae++]=ae;for(Ae>>=7;ae<_;ae++)for(Y[ae]=Ae<<7,oe=0;oe<1<<A[ae]-7;oe++)P[256+Ae++]=ae;for(Ce=0;Ce<=S;Ce++)Me[Ce]=0;for(oe=0;oe<=143;)q[2*oe+1]=8,oe++,Me[8]++;for(;oe<=255;)q[2*oe+1]=9,oe++,Me[9]++;for(;oe<=279;)q[2*oe+1]=7,oe++,Me[7]++;for(;oe<=287;)q[2*oe+1]=8,oe++,Me[8]++;for(be(q,v+1,Me),oe=0;oe<_;oe++)j[2*oe+1]=5,j[2*oe]=ue(oe,5);W=new se(q,k,g+1,v,S),H=new se(j,A,0,_,S),Z=new se(new Array(0),N,0,C,T)})(),ye=!0),J.l_desc=new B(J.dyn_ltree,W),J.d_desc=new B(J.dyn_dtree,H),J.bl_desc=new B(J.bl_tree,Z),J.bi_buf=0,J.bi_valid=0,ce(J)},i._tr_stored_block=te,i._tr_flush_block=function(J,oe,Ce,Se){var ae,Ae,Me=0;0<J.level?(J.strm.data_type===2&&(J.strm.data_type=(function(De){var He,wt=4093624447;for(He=0;He<=31;He++,wt>>>=1)if(1&wt&&De.dyn_ltree[2*He]!==0)return l;if(De.dyn_ltree[18]!==0||De.dyn_ltree[20]!==0||De.dyn_ltree[26]!==0)return d;for(He=32;He<g;He++)if(De.dyn_ltree[2*He]!==0)return d;return l})(J)),_t(J,J.l_desc),_t(J,J.d_desc),Me=(function(De){var He;for(U(De,De.dyn_ltree,De.l_desc.max_code),U(De,De.dyn_dtree,De.d_desc.max_code),_t(De,De.bl_desc),He=C-1;3<=He&&De.bl_tree[2*F[He]+1]===0;He--);return De.opt_len+=3*(He+1)+5+5+4,He})(J),ae=J.opt_len+3+7>>>3,(Ae=J.static_len+3+7>>>3)<=ae&&(ae=Ae)):ae=Ae=Ce+5,Ce+4<=ae&&oe!==-1?te(J,oe,Ce,Se):J.strategy===4||Ae===ae?(ie(J,2+(Se?1:0),3),ot(J,q,j)):(ie(J,4+(Se?1:0),3),(function(De,He,wt,nt){var Qn;for(ie(De,He-257,5),ie(De,wt-1,5),ie(De,nt-4,4),Qn=0;Qn<nt;Qn++)ie(De,De.bl_tree[2*F[Qn]+1],3);he(De,De.dyn_ltree,He-1),he(De,De.dyn_dtree,wt-1)})(J,J.l_desc.max_code+1,J.d_desc.max_code+1,Me+1),ot(J,J.dyn_ltree,J.dyn_dtree)),ce(J),Se&&ve(J)},i._tr_tally=function(J,oe,Ce){return J.pending_buf[J.d_buf+2*J.last_lit]=oe>>>8&255,J.pending_buf[J.d_buf+2*J.last_lit+1]=255&oe,J.pending_buf[J.l_buf+J.last_lit]=255&Ce,J.last_lit++,oe===0?J.dyn_ltree[2*Ce]++:(J.matches++,oe--,J.dyn_ltree[2*(O[Ce]+g+1)]++,J.dyn_dtree[2*G(oe)]++),J.last_lit===J.lit_bufsize-1},i._tr_align=function(J){ie(J,2,3),ee(J,I,q),(function(oe){oe.bi_valid===16?(ne(oe,oe.bi_buf),oe.bi_buf=0,oe.bi_valid=0):8<=oe.bi_valid&&(oe.pending_buf[oe.pending++]=255&oe.bi_buf,oe.bi_buf>>=8,oe.bi_valid-=8)})(J)}},{"../utils/common":41}],53:[function(n,r,i){r.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(n,r,i){(function(o){(function(l,d){if(!l.setImmediate){var h,m,p,g,v=1,_={},C=!1,x=l.document,S=Object.getPrototypeOf&&Object.getPrototypeOf(l);S=S&&S.setTimeout?S:l,h={}.toString.call(l.process)==="[object process]"?function(M){process.nextTick(function(){T(M)})}:(function(){if(l.postMessage&&!l.importScripts){var M=!0,L=l.onmessage;return l.onmessage=function(){M=!1},l.postMessage("","*"),l.onmessage=L,M}})()?(g="setImmediate$"+Math.random()+"$",l.addEventListener?l.addEventListener("message",I,!1):l.attachEvent("onmessage",I),function(M){l.postMessage(g+M,"*")}):l.MessageChannel?((p=new MessageChannel).port1.onmessage=function(M){T(M.data)},function(M){p.port2.postMessage(M)}):x&&"onreadystatechange"in x.createElement("script")?(m=x.documentElement,function(M){var L=x.createElement("script");L.onreadystatechange=function(){T(M),L.onreadystatechange=null,m.removeChild(L),L=null},m.appendChild(L)}):function(M){setTimeout(T,0,M)},S.setImmediate=function(M){typeof M!="function"&&(M=new Function(""+M));for(var L=new Array(arguments.length-1),$=0;$<L.length;$++)L[$]=arguments[$+1];var k={callback:M,args:L};return _[v]=k,h(v),v++},S.clearImmediate=E}function E(M){delete _[M]}function T(M){if(C)setTimeout(T,0,M);else{var L=_[M];if(L){C=!0;try{(function($){var k=$.callback,A=$.args;switch(A.length){case 0:k();break;case 1:k(A[0]);break;case 2:k(A[0],A[1]);break;case 3:k(A[0],A[1],A[2]);break;default:k.apply(d,A)}})(L)}finally{E(M),C=!1}}}}function I(M){M.source===l&&typeof M.data=="string"&&M.data.indexOf(g)===0&&T(+M.data.slice(g.length))}})(typeof self>"u"?o===void 0?this:o:self)}).call(this,typeof Oh<"u"?Oh:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(Hg)),Hg.exports}var sP=rP();const xm=z2(sP);function iP({currentUser:t,budgetId:e}){const[n,r]=D.useState(!1),[i,o]=D.useState(null),[l,d]=D.useState(null);async function h(){if(!t){d("Must be logged in to download budget");return}if(!e){d("No budget selected");return}r(!0),d(null),o({phase:"reading",current:0,total:1,percentComplete:0});try{o({phase:"reading",current:0,total:1,percentComplete:10});const{exists:m,data:p}=await jt("budgets",e,`downloading budget ${e}`);if(!m||!p){d(`Budget ${e} not found`);return}const g=await LT(e,"download-budget");let v=null;try{const{exists:j,data:P}=await jt("payees",e,`downloading payees for budget ${e}`);j&&P&&(v=P)}catch(j){console.warn(`Could not read payees for budget ${e}:`,j)}o({phase:"processing",current:0,total:g.length+1,percentComplete:20});const _=new xm,C=new Date,x=C.toISOString().split("T")[0],S=`budget_${e}`,{accounts:E,account_groups:T,categories:I,category_groups:M,...L}=p;_.file(`${S}/budget.json`,JSON.stringify(L,null,2)),_.file(`${S}/accounts.json`,JSON.stringify(E||{},null,2)),_.file(`${S}/account_groups.json`,JSON.stringify(T||{},null,2)),_.file(`${S}/categories.json`,JSON.stringify(I||{},null,2)),_.file(`${S}/category_groups.json`,JSON.stringify(M||[],null,2)),v&&_.file(`${S}/payees.json`,JSON.stringify(v,null,2));let $=0;for(const j of g){const P=j.data,O=`${S}/months/month_${P.year}_${String(P.month).padStart(2,"0")}`,X={};if(P.are_allocations_finalized&&P.category_balances)for(const W of P.category_balances)W.allocated!==void 0&&(X[W.category_id]=W.allocated);_.file(`${O}/metadata.json`,JSON.stringify({budget_id:P.budget_id,year_month_ordinal:P.year_month_ordinal,year:P.year,month:P.month,total_income:P.total_income,previous_month_income:P.previous_month_income,total_expenses:P.total_expenses,are_allocations_finalized:P.are_allocations_finalized,created_at:P.created_at,updated_at:P.updated_at,...P.are_allocations_finalized&&{allocations:X},downloaded_at:C.toISOString()},null,2)),_.file(`${O}/income.json`,JSON.stringify(P.income||[],null,2)),_.file(`${O}/expenses.json`,JSON.stringify(P.expenses||[],null,2)),_.file(`${O}/transfers.json`,JSON.stringify(P.transfers||[],null,2)),_.file(`${O}/adjustments.json`,JSON.stringify(P.adjustments||[],null,2)),_.file(`${O}/account_balances.json`,JSON.stringify(P.account_balances||[],null,2)),_.file(`${O}/category_balances.json`,JSON.stringify(P.category_balances||[],null,2)),$++,o({phase:"processing",current:$,total:g.length,percentComplete:20+Math.round($/g.length*60)})}o({phase:"zipping",current:0,total:1,percentComplete:80});const k=await _.generateAsync({type:"blob"});o({phase:"complete",current:1,total:1,percentComplete:100});const N=(p.name||"budget").replace(/[^a-z0-9]/gi,"_").toLowerCase(),F=URL.createObjectURL(k),q=document.createElement("a");q.href=F,q.download=`${x}_${N}_${e}.zip`,document.body.appendChild(q),q.click(),document.body.removeChild(q),URL.revokeObjectURL(F)}catch(m){d(m instanceof Error?m.message:"Unknown error during download")}finally{r(!1),o(null)}}return{isDownloading:n,progress:i,error:l,downloadBudget:h}}async function aP(t){const n=await new xm().loadAsync(t),r=new Set,i=new Set;for(const[o]of Object.entries(n.files)){const l=o.match(/^budget_([^/]+)\//);if(l){const d=l[1];r.add(d),o.match(/^budget_([^/]+)\/months\/month_\d{4}_\d{2}\//)&&i.add(o.split("/months/")[1].split("/")[0])}}return{budgetsFound:r.size,monthsFound:i.size,payeesFound:r.size,budgetsToRestore:Array.from(r)}}async function oP(t,e,n){const i=`${`${e}/months/`}${n}/`,o=`${i}metadata.json`,l=t.files[o];if(!l)return null;const d=await l.async("string"),h=JSON.parse(d),{downloaded_at:m,allocations:p,...g}=h,v=async S=>{const E=`${i}${S}`,T=t.files[E];if(T){const I=await T.async("string");return JSON.parse(I)}return[]},_={budget_id:g.budget_id,year:g.year,month:g.month,year_month_ordinal:g.year_month_ordinal,total_income:0,previous_month_income:0,total_expenses:0,are_allocations_finalized:g.are_allocations_finalized??!1,created_at:g.created_at||new Date().toISOString(),updated_at:new Date().toISOString(),income:await v("income.json"),expenses:await v("expenses.json"),transfers:await v("transfers.json"),adjustments:await v("adjustments.json"),account_balances:[],category_balances:[]},C=ja(_);let x=_m(C);if(h.are_allocations_finalized&&p!==void 0){const S=new Map;for(const I of x.category_balances)S.set(I.category_id,I);const E=[],T=new Set;for(const I of x.category_balances){const M=p[I.category_id];if(M!==void 0){const L=Oe(M);E.push({...I,allocated:L,end_balance:Oe(I.start_balance+L+I.spent+I.transfers+I.adjustments)})}else E.push(I);T.add(I.category_id)}for(const[I,M]of Object.entries(p))if(!T.has(I)){const L=Oe(M);E.push({category_id:I,start_balance:0,allocated:L,spent:0,transfers:0,adjustments:0,end_balance:L})}x={...x,category_balances:E}}return{budgetId:g.budget_id,year:g.year,month:g.month,data:x}}async function lP(t,e){const n=`budget_${e}`,r=async $=>{const k=t.files[$];if(k){const A=await k.async("string");return JSON.parse(A)}return null},i=`${n}/budget.json`,o=`${n}/accounts.json`,l=`${n}/account_groups.json`,d=`${n}/categories.json`,h=`${n}/category_groups.json`,m=await r(i);if(!m)throw new Error("Missing required file budget.json");const p=await r(o)||{},g=await r(l)||{},v=await r(d)||{},_=await r(h)||[],C=ja({...m,accounts:p,account_groups:g,categories:v,category_groups:_}),x={budgetId:e,data:C},S=`${n}/payees.json`,E=await r(S);let T=null;if(E){const $={...E,budget_id:e,updated_at:new Date().toISOString()};T={collectionPath:"payees",docId:e,data:ja($)}}const I=`${n}/months/`,M=new Set;for(const $ of Object.keys(t.files))if($.startsWith(I)&&$.includes("/metadata.json")){const k=$.split("/months/")[1].split("/")[0];M.add(k)}const L=[];for(const $ of M){const k=await oP(t,n,$);k&&L.push(k)}return{budgetUpdate:x,monthUpdates:L,payeeWrite:T}}function cP({currentUser:t}){const[e,n]=D.useState(!1),[r,i]=D.useState(!1),[o,l]=D.useState(null),[d,h]=D.useState(null),[m,p]=D.useState(null),[g,v]=D.useState(null);async function _(x){if(!t){p("Must be logged in to upload budget");return}n(!0),p(null),l(null),v(null);try{const S=await aP(x);l(S)}catch(S){p(S instanceof Error?S.message:"Failed to parse zip file")}finally{n(!1)}}async function C(x){if(!t){p("Must be logged in to upload budget");return}if(!o){p("Must scan file first");return}i(!0),p(null),h({phase:"parsing",current:0,total:1,percentComplete:0});const S=[];let E=0,T=0,I=0;try{h({phase:"parsing",current:0,total:1,percentComplete:10});const L=await new xm().loadAsync(x);h({phase:"validating",current:0,total:1,percentComplete:20}),h({phase:"uploading",current:0,total:o.budgetsToRestore.length,percentComplete:30});const $=[],k=[],A=[];for(let N=0;N<o.budgetsToRestore.length;N++){const F=o.budgetsToRestore[N];try{const{budgetUpdate:q,monthUpdates:j,payeeWrite:P}=await lP(L,F);$.push(q),k.push(...j),P&&A.push(P),h({phase:"uploading",current:N+1,total:o.budgetsToRestore.length,percentComplete:30+Math.round((N+1)/o.budgetsToRestore.length*50)})}catch(q){S.push(`Budget ${F}: ${q instanceof Error?q.message:String(q)}`)}}if(h({phase:"uploading",current:o.budgetsToRestore.length,total:o.budgetsToRestore.length,percentComplete:80}),$.length>0)try{console.log(`[Upload] Writing ${$.length} budget(s)...`),await UT($,"upload-budget"),E=$.length,console.log(`[Upload] Successfully wrote ${E} budget(s)`)}catch(N){const F=`Failed to write budgets: ${N instanceof Error?N.message:String(N)}`;throw console.error(`[Upload] ${F}`,N),S.push(F),N}if(A.length>0)try{console.log(`[Upload] Writing ${A.length} payee doc(s)...`),await dm(A,"upload-budget: writing payees"),I=A.length,console.log(`[Upload] Successfully wrote ${I} payee doc(s)`)}catch(N){const F=`Failed to write payees: ${N instanceof Error?N.message:String(N)}`;throw console.error(`[Upload] ${F}`,N),S.push(F),N}if(k.length>0)try{console.log(`[Upload] Writing ${k.length} month(s) and recalculating...`),await g3(k,"upload-budget"),T=k.length,console.log(`[Upload] Successfully wrote ${T} month(s)`)}catch(N){const F=`Failed to write months: ${N instanceof Error?N.message:String(N)}`;throw console.error(`[Upload] ${F}`,N),S.push(F),N}h({phase:"complete",current:1,total:1,percentComplete:100}),v({success:S.length===0,budgetsRestored:E,monthsRestored:T,payeesRestored:I,errors:S}),console.log("[Upload] Clearing all caches after upload..."),ka()}catch(M){const L=M instanceof Error?M.message:"Unknown error during upload";console.error("[Upload] Upload failed with error:",M),console.error("[Upload] Error details:",{errorMessage:L,budgetsRestored:E,monthsRestored:T,payeesRestored:I,errorsSoFar:S}),p(L),v({success:!1,budgetsRestored:E,monthsRestored:T,payeesRestored:I,errors:[...S,L]}),console.log("[Upload] Clearing all caches after failed upload (partial writes possible)..."),ka()}finally{i(!1),h(null)}}return{isScanning:e,isUploading:r,status:o,progress:d,error:m,result:g,scanZipFile:_,uploadBudget:C}}function uP({isActive:t,onDragOver:e,onDragLeave:n,onDrop:r,label:i="Move to end"}){return u.jsxs("div",{onDragOver:e,onDragLeave:n,onDrop:r,style:M4,children:[u.jsx("div",{style:{...N4,opacity:t?1:.3,boxShadow:t?"0 0 8px rgba(100, 108, 255, 0.6)":"none"}}),t&&u.jsx("span",{style:P4,children:i})]})}function qe(t){return`$${Math.abs(t).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`}function mr(t){return t<0?`-$${Math.abs(t).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`:`$${t.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`}function La(t){return t===0?"$0.00":`${t>0?"+":"-"}${qe(t)}`}function Bt(t){return`${t>=0?"+":"-"}${qe(t)}`}function lt(t){return t===0?me.zero:t>0?me.success:me.danger}function un(t){return t===0?me.zero:t>0?me.success:me.debt}function mc(t){return t===0?me.zero:t<0?me.error:me.success}function pc(t){return t===0?me.zero:t>0?me.success:me.error}async function HT(t,e){const{exists:n,data:r}=await jt("feedback",t,`VALIDATION-READ: ${e}`);if(!n||!r)throw new Error(`Feedback document not found: ${t}`);return{items:r.items||[],user_email:r.user_email,created_at:r.created_at,updated_at:r.updated_at}}async function G0(t){const{docId:e,items:n,description:r}=t;await qn("feedback",e,{items:n,updated_at:new Date().toISOString()},r,{merge:!0})}async function dP(t,e,n,r){const{exists:i}=await jt("feedback",t,"checking if user has existing feedback document");i?await qn("feedback",t,{items:Lu(e),user_email:n,updated_at:new Date().toISOString()},r,{merge:!0}):await qn("feedback",t,{items:[e],user_email:n,created_at:new Date().toISOString(),updated_at:new Date().toISOString()},r)}function GT(){const t=Vt(),e=Hn({onMutate:async r=>{const{userId:i,userEmail:o,text:l,feedbackType:d,currentPath:h}=r,m=o||i,p=ke.feedback();await t.cancelQueries({queryKey:p});const g=t.getQueryData(p),v=`feedback_optimistic_${Date.now()}`,_={id:v,text:`${l}

(Submitted from: ${h})`,created_at:new Date().toISOString(),is_done:!1,completed_at:null,sort_order:Date.now(),feedback_type:d,doc_id:m,user_email:o};return g&&t.setQueryData(p,{items:[...g.items,_]}),{previousData:g,optimisticId:v}},mutationFn:async r=>{const{userId:i,userEmail:o,text:l,feedbackType:d,currentPath:h}=r,m=o||i,p={id:`feedback_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,text:`${l}

(Submitted from: ${h})`,created_at:new Date().toISOString(),is_done:!1,completed_at:null,sort_order:Date.now(),feedback_type:d};return await dP(m,p,o,"submitting new feedback"),{feedbackItem:p,docId:m}},onSuccess:(r,i,o)=>{if(!o?.optimisticId)return;const l=t.getQueryData(ke.feedback());l&&t.setQueryData(ke.feedback(),{items:l.items.map(d=>d.id===o.optimisticId?{...r.feedbackItem,doc_id:r.docId,user_email:i.userEmail}:d)})},onError:(r,i,o)=>{o?.previousData&&t.setQueryData(ke.feedback(),o.previousData)}});return{submitFeedback:{mutate:r=>e.mutate(r),mutateAsync:r=>e.mutateAsync(r),isPending:e.isPending,isError:e.isError,error:e.error,reset:e.reset}}}function hP(){const t=Vt(),e=Hn({onMutate:async r=>{const{item:i}=r,o=ke.feedback(),l=!i.is_done,d=l?new Date().toISOString():null;await t.cancelQueries({queryKey:o});const h=t.getQueryData(o);return h&&t.setQueryData(o,{items:h.items.map(m=>m.id===i.id?{...m,is_done:l,completed_at:d}:m)}),{previousData:h}},mutationFn:async r=>{const{item:i}=r,o=!i.is_done,l=o?new Date().toISOString():null,d=await HT(i.doc_id,"toggle feedback");let h=!1;const m=d.items.map(p=>p.id===i.id?(h=!0,{...p,is_done:o,completed_at:l}):p);if(!h)throw console.error("[toggleFeedback] Item not found in document",{searchingFor:i.id,inDocument:i.doc_id,availableIds:d.items.map(p=>p.id)}),new Error(`Feedback item not found in document. Item ID: ${i.id}, Doc ID: ${i.doc_id}`);return await G0({docId:i.doc_id,items:m,description:`marking feedback item as ${o?"done":"not done"}`}),{itemId:i.id,isDone:o,completedAt:l}},onError:(r,i,o)=>{o?.previousData&&t.setQueryData(ke.feedback(),o.previousData)}});return{toggleFeedback:{mutate:r=>e.mutate(r),mutateAsync:r=>e.mutateAsync(r),isPending:e.isPending,isError:e.isError,error:e.error,reset:e.reset}}}function fP(){const t=Vt(),e=Hn({onMutate:async r=>{const{docId:i,items:o}=r,l=ke.feedback();await t.cancelQueries({queryKey:l});const d=t.getQueryData(l),h=new Map;return o.forEach(m=>{h.set(m.id,m.sort_order)}),d&&t.setQueryData(l,{items:d.items.map(m=>m.doc_id===i&&h.has(m.id)?{...m,sort_order:h.get(m.id)}:m)}),{previousData:d}},mutationFn:async r=>{const{docId:i,items:o}=r;return await G0({docId:i,items:o,description:"saving reordered feedback items"}),{docId:i,items:o}},onError:(r,i,o)=>{o?.previousData&&t.setQueryData(ke.feedback(),o.previousData)}});return{updateSortOrder:{mutate:r=>e.mutate(r),mutateAsync:r=>e.mutateAsync(r),isPending:e.isPending,isError:e.isError,error:e.error,reset:e.reset}}}function cs({isOpen:t,onClose:e,title:n,children:r,width:i="28rem"}){if(!t)return null;function o(){e()}return u.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0, 0, 0, 0.6)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1001,padding:"1rem"},onClick:o,children:u.jsxs("div",{style:{background:"#1a1a1a",color:"rgba(255, 255, 255, 0.87)",borderRadius:"12px",padding:"1.5rem",width:i,maxWidth:"calc(100vw - 2rem)",flexShrink:0,boxSizing:"border-box",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.5)"},onClick:l=>l.stopPropagation(),children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[u.jsx("h2",{style:{margin:0,fontSize:"1.25rem"},children:n}),u.jsx("button",{onClick:o,style:{background:"transparent",border:"none",color:"inherit",cursor:"pointer",fontSize:"1.5rem",opacity:.6,lineHeight:1},children:""})]}),r]})})}const mP=2e3,pP={critical_bug:{label:"Critical Bug",color:"#ff4757",bgColor:"rgba(255, 71, 87, 0.15)"},bug:{label:"Bug",color:"#ffa502",bgColor:"rgba(255, 165, 2, 0.15)"},new_feature:{label:"New Feature",color:"#2ed573",bgColor:"rgba(46, 213, 115, 0.15)"},core_feature:{label:"Core Feature",color:"#1e90ff",bgColor:"rgba(30, 144, 255, 0.15)"},qol:{label:"QOL",color:"#a55eea",bgColor:"rgba(165, 94, 234, 0.15)"}};function gP(){const[t,e]=D.useState(!1),[n,r]=D.useState(""),[i,o]=D.useState("bug"),[l,d]=D.useState(!1),h=D.useContext(cd),p=Oa().get_current_firebase_user(),g=Mn(),{submitFeedback:v}=GT();if(D.useEffect(()=>{if(l){const x=setTimeout(()=>d(!1),mP);return()=>clearTimeout(x)}},[l]),g.pathname.includes("/admin/feedback")||!h.is_logged_in)return null;function C(x){x.preventDefault(),!(!n.trim()||!h.username||!p)&&(v.mutate({userId:p.uid,userEmail:h.username,text:n.trim(),feedbackType:i,currentPath:g.pathname}),r(""),o("bug"),e(!1),d(!0))}return u.jsxs(u.Fragment,{children:[l&&u.jsxs("div",{style:{position:"fixed",bottom:"5rem",right:"1.5rem",background:"rgba(46, 213, 115, 0.95)",color:"white",padding:"0.75rem 1rem",borderRadius:"0.5rem",fontSize:"0.9rem",fontWeight:500,boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",zIndex:1001,display:"flex",alignItems:"center",gap:"0.5rem",animation:"fadeInUp 0.2s ease-out"},children:[u.jsx("span",{children:""}),u.jsx("span",{children:"Feedback submitted!"})]}),u.jsx("button",{onClick:()=>{e(!0)},style:{position:"fixed",bottom:"1.5rem",right:"1.5rem",width:"3rem",height:"3rem",borderRadius:"50%",background:me.primary,color:"white",border:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1.25rem",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",transition:"transform 0.15s, box-shadow 0.15s",zIndex:1e3},title:"Send Feedback",onMouseEnter:x=>{x.currentTarget.style.transform="scale(1.1)",x.currentTarget.style.boxShadow="0 6px 16px rgba(0, 0, 0, 0.4)"},onMouseLeave:x=>{x.currentTarget.style.transform="scale(1)",x.currentTarget.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.3)"},children:""}),u.jsx(cs,{isOpen:t,onClose:()=>{e(!1),o("bug")},title:"Send Feedback",children:u.jsxs("form",{onSubmit:C,children:[u.jsx("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"0.75rem",paddingBottom:"1rem",flexWrap:"wrap"},children:["critical_bug","bug","new_feature","core_feature","qol"].map(x=>{const S=pP[x],E=i===x;return u.jsxs("button",{type:"button",onClick:()=>{S.label,o(x)},style:{flex:1,padding:"0.6rem 0.5rem",border:`2px solid ${S.color}`,borderRadius:"0.5rem",background:E?S.bgColor:"transparent",color:E?S.color:"rgba(255,255,255,0.5)",cursor:"pointer",fontWeight:E?600:400,fontSize:"0.8rem",transition:"all 0.15s ease",opacity:E?1:.5,boxShadow:E?`0 0 12px ${S.bgColor}`:"none",position:"relative"},children:[S.label,E&&u.jsx("span",{style:{position:"absolute",bottom:"-14px",left:"10%",right:"10%",height:"3px",background:"white",borderRadius:"2px"}})]},x)})}),u.jsx(H0,{value:n,onChange:x=>r(x.target.value),placeholder:"Share your feedback, bug reports, or feature requests...",minHeight:"8rem",autoFocus:!0,required:!0}),u.jsxs(za,{children:[u.jsx(Ve,{type:"button",variant:"secondary",actionName:"Cancel Feedback",onClick:()=>{e(!1),o("bug")},children:"Cancel"}),u.jsx(Ve,{type:"submit",actionName:"Submit Feedback",disabled:!n.trim(),children:"Submit"})]})]})})]})}function qr({children:t,labelStyle:e,...n}){return u.jsxs("label",{style:{display:"flex",alignItems:"flex-start",gap:"0.75rem",flex:1,cursor:"pointer",...e},children:[u.jsx("input",{type:"checkbox",style:{width:"1.25rem",height:"1.25rem",marginTop:"0.1rem",cursor:"pointer",accentColor:me.primary},...n}),t]})}function Q0({title:t,count:e,children:n,defaultExpanded:r=!1}){const[i,o]=D.useState(r);return u.jsxs("div",{style:{marginTop:"2rem"},children:[u.jsxs("button",{onClick:()=>o(!i),style:{background:"transparent",border:"none",color:"inherit",cursor:"pointer",display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 0",fontSize:"0.9rem",opacity:.7},children:[u.jsx("span",{style:{transition:"transform 0.2s",transform:i?"rotate(90deg)":"rotate(0deg)"},children:""}),t,e!==void 0&&` (${e})`]}),i&&n]})}const yP=t=>{switch(t){case 2:return 220;case 3:return 320;case 4:return 420;case 5:return 520;case 6:return 620;default:return t*100+20}},_P=t=>t<=4?2:t<=6?3:Math.ceil(t/2);function Df(t){const{tabs:e,activeTab:n,variant:r="primary"}=t,i=e.filter(S=>!S.hidden),o=i.length,l=yP(o),d=_P(o),h=Math.floor(100/d),m=`tab-nav-${o}-${r}`,p=r==="primary",g=r==="secondary",v=r==="segmented",_=S=>{const E="color-mix(in srgb, currentColor 10%, transparent)",T="color-mix(in srgb, currentColor 3%, transparent)";return v?{flex:"1 1 0",padding:"0.75rem 1rem",border:"none",borderRadius:0,background:S?E:T,cursor:"pointer",fontWeight:S?600:400,fontSize:"0.95rem",color:"inherit",opacity:S?1:.55,transition:"all 0.15s",textDecoration:"none",display:"inline-flex",alignItems:"center",justifyContent:"center",gap:"0.25rem",position:"relative",boxSizing:"border-box",outline:"none",borderBottom:S?"2px solid currentColor":"2px solid transparent"}:g?{flex:"none",minWidth:"8.5rem",padding:"0.55rem 1rem 0.65rem",border:"none",borderRadius:"10px 10px 0 0",background:"transparent",cursor:"pointer",fontWeight:600,fontSize:"0.85rem",color:S?"inherit":"color-mix(in srgb, currentColor 55%, transparent)",transition:"color 0.15s",textDecoration:"none",display:"inline-flex",alignItems:"center",justifyContent:"center",gap:"0.25rem",position:"relative",boxSizing:"border-box",outline:"none",marginBottom:S?"-1px":"0"}:{flex:"1 1 0",padding:"0.7rem 0.75rem",border:"none",borderRadius:0,background:"transparent",cursor:"pointer",fontWeight:S?600:400,fontSize:"1rem",letterSpacing:"0.01em",color:"inherit",opacity:S?1:.6,transition:"all 0.15s",textDecoration:"none",display:"inline-flex",alignItems:"center",justifyContent:"center",gap:"0.25rem",position:"relative",boxSizing:"border-box",outline:"none"}},C=(S,E)=>u.jsxs(u.Fragment,{children:[u.jsx("span",{children:S.label}),S.checkmark&&u.jsx("span",{style:{color:me.success,fontWeight:600},children:""}),p&&E&&u.jsx("span",{style:{position:"absolute",bottom:"-1px",left:"10%",right:"10%",height:"3px",background:"white",borderRadius:"2px"}})]}),x=()=>v?`
        .${m} {
          display: flex;
          margin-bottom: 0.75rem;
          border-bottom: 1px solid color-mix(in srgb, currentColor 15%, transparent);
        }
      `:g?`
        .${m} {
          display: flex;
          flex-wrap: nowrap;
          margin-bottom: 1rem;
          border-bottom: 1px solid color-mix(in srgb, currentColor 10%, transparent);
          justify-content: flex-start;
          padding-left: 0.75rem;
          position: relative;
        }
        .${m} > button,
        .${m} > a {
          margin-right: -8px;
          isolation: isolate;
        }
        .${m} > button:last-child,
        .${m} > a:last-child {
          margin-right: 0;
        }
        .${m} > button::before,
        .${m} > a::before {
          content: '';
          position: absolute;
          inset: 0;
          background: var(--tab-bg);
          border-radius: 10px 10px 0 0;
          z-index: -1;
          transform: perspective(50px) rotateX(5deg);
          transform-origin: bottom center;
          transition: background 0.15s;
          box-shadow: -1px 0 0 #242424, 1px 0 0 #242424;
        }
        .${m} > button:nth-child(1),
        .${m} > a:nth-child(1) {
          z-index: 4;
        }
        .${m} > button:nth-child(2),
        .${m} > a:nth-child(2) {
          z-index: 3;
        }
        .${m} > button:nth-child(3),
        .${m} > a:nth-child(3) {
          z-index: 2;
        }
        .${m} > button:nth-child(4),
        .${m} > a:nth-child(4) {
          z-index: 1;
        }
        .${m} > button.tab-active,
        .${m} > a.tab-active {
          z-index: 10;
        }
        .${m} > button.tab-active::before,
        .${m} > a.tab-active::before {
          background: var(--tab-bg-active);
        }
        .${m} > button:not(.tab-active):hover,
        .${m} > a:not(.tab-active):hover {
          color: color-mix(in srgb, currentColor 80%, transparent);
        }
        .${m} > button:not(.tab-active):hover::before,
        .${m} > a:not(.tab-active):hover::before {
          background: var(--tab-bg-hover);
        }
        @media (max-width: 480px) {
          .${m} {
            padding-left: 0;
            padding-right: 0;
          }
          .${m} > button,
          .${m} > a {
            flex: 0 0 27% !important;
            min-width: 27% !important;
            padding: 0.55rem 0.5rem 0.65rem !important;
            font-size: 0.8rem !important;
          }
        }
      `:`
      .${m} {
        display: flex;
        flex-wrap: wrap;
        margin-bottom: 0;
        border-bottom: 1px solid color-mix(in srgb, currentColor 25%, transparent);
      }
      @media (max-width: ${l}px) {
        .${m} > * {
          flex: 1 1 ${h}% !important;
          min-width: ${h}% !important;
        }
      }
    `;return u.jsxs(u.Fragment,{children:[u.jsx("style",{children:`
        ${x()}
        .${m} > button,
        .${m} > a {
          border: none !important;
          border-radius: 0 !important;
          outline: none !important;
        }
        .${m} > button:hover,
        .${m} > button:focus,
        .${m} > a:hover,
        .${m} > a:focus {
          border: none !important;
          border-color: transparent !important;
          ${p?"opacity: 0.85;":""}
          ${v?"background: color-mix(in srgb, currentColor 7%, transparent);":""}
        }
      `}),u.jsx("div",{className:m,children:i.map(S=>{const E=n===S.id;return t.mode==="link"?u.jsx(Tn,{to:`${t.linkPrefix}/${S.id}`,onClick:()=>(`${S.label}`,void 0),style:_(E),className:E?"tab-active":"",children:C(S,E)},S.id):u.jsx("button",{onClick:()=>{`${S.label}`,t.onTabChange(S.id)},style:_(E),className:E?"tab-active":"",children:C(S,E)},S.id)})})]})}function QT({items:t}){const[e,n]=D.useState(!1),r=D.useRef(null),o=Mn().pathname;D.useEffect(()=>{function d(h){r.current&&!r.current.contains(h.target)&&n(!1)}if(e)return document.addEventListener("mousedown",d),()=>document.removeEventListener("mousedown",d)},[e]),D.useEffect(()=>{function d(h){h.key==="Escape"&&n(!1)}if(e)return document.addEventListener("keydown",d),()=>document.removeEventListener("keydown",d)},[e]);const l=t.filter(d=>d.hidden?!1:d.to?d.to==="/budget"?!(o==="/budget"||/^\/budget\/\d{4}\/\d{1,2}\/\w+$/.test(o)):d.to==="/account"||d.to==="/"?o!==d.to:!o.startsWith(d.to):!0);return u.jsxs("div",{ref:r,style:{position:"relative"},children:[u.jsx("button",{onClick:()=>{n(!e)},style:{display:"flex",alignItems:"center",justifyContent:"center",width:"2.5rem",height:"2.5rem",borderRadius:"8px",background:e?"color-mix(in srgb, currentColor 15%, transparent)":"color-mix(in srgb, currentColor 8%, transparent)",border:"none",cursor:"pointer",fontSize:"1.25rem",color:"inherit",transition:"background 0.15s",lineHeight:1},title:"Menu","aria-expanded":e,"aria-haspopup":"true",children:""}),e&&u.jsx("div",{style:{position:"absolute",top:"100%",right:0,marginTop:"0.5rem",minWidth:"180px",background:"#1a1a2e",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",borderRadius:"8px",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.3)",zIndex:1e3,overflow:"hidden"},children:l.map((d,h)=>{if(d.divider)return u.jsx("div",{style:{height:"1px",background:"color-mix(in srgb, currentColor 15%, transparent)",margin:"0.25rem 0"}},h);const m=u.jsxs(u.Fragment,{children:[d.icon&&u.jsx("span",{style:{width:"1.5rem",textAlign:"center"},children:d.icon}),u.jsx("span",{children:d.label})]}),p={display:"flex",alignItems:"center",gap:"0.75rem",padding:"0.75rem 1rem",fontSize:"0.95rem",color:"inherit",textDecoration:"none",cursor:"pointer",transition:"background 0.15s",background:"transparent",border:"none",width:"100%",textAlign:"left"},g={background:"color-mix(in srgb, currentColor 10%, transparent)"};return d.to?u.jsx(Tn,{to:d.to,style:p,onMouseEnter:v=>Object.assign(v.currentTarget.style,g),onMouseLeave:v=>v.currentTarget.style.background="transparent",onClick:()=>{`${d.label}`,n(!1)},children:m},h):u.jsx("button",{onClick:()=>{`${d.label}`,d.onClick?.(),n(!1)},style:p,onMouseEnter:v=>Object.assign(v.currentTarget.style,g),onMouseLeave:v=>v.currentTarget.style.background="transparent",children:m},h)})})]})}function bP({title:t,showBackArrow:e=!1,hideMenu:n=!1}){const{isAdmin:r}=Xe(),i=Mn(),l=[...i.pathname==="/budget"||i.pathname.startsWith("/budget/")&&!i.pathname.startsWith("/budget/settings")&&!i.pathname.startsWith("/budget/admin")&&!i.pathname.startsWith("/budget/analytics")&&!i.pathname.startsWith("/budget/my-budgets")?[]:[{label:"Budget",icon:"",to:"/budget"}],{label:"Budget Settings",icon:"",to:"/budget/settings"},{label:"Analytics",icon:"",to:"/budget/analytics"},...r?[{label:"Admin",icon:"",to:"/budget/admin"}]:[],{label:"Switch Budgets",icon:"",to:"/budget/my-budgets"},{divider:!0,label:""},{label:"Exit Budget App",icon:"",to:"/"}];return u.jsxs("nav",{style:{marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%"},children:[u.jsx("div",{style:{flex:"0 0 auto"},children:e?u.jsx(Tn,{to:"/",onClick:()=>void 0,style:{opacity:.6,fontSize:"1.5rem",textDecoration:"none"},title:"Back to Home",children:""}):u.jsx(Tn,{to:"/budget",onClick:()=>void 0,title:"Budget Home",children:u.jsx("img",{src:"/budget-icon.svg",alt:"Budget",style:{width:"1.5rem",height:"1.5rem"}})})}),u.jsx("span",{style:{fontWeight:600,fontSize:"1.1rem",textAlign:"center",flex:"1 1 auto"},children:t}),u.jsx("div",{style:{flex:"0 0 auto"},children:n?u.jsx("div",{style:{width:"1.5rem"}}):u.jsx(QT,{items:l})})]})}function WT({children:t,style:e}){return u.jsx("div",{style:{width:"100%",maxWidth:"var(--content-max-width, 900px)",marginLeft:"auto",marginRight:"auto",...e},children:t})}function qu({message:t,linkText:e,linkTo:n}){return u.jsx("div",{style:{gridColumn:"1 / -1",background:`color-mix(in srgb, ${me.warning} 12%, transparent)`,border:`2px solid ${me.warning}`,borderRadius:"8px",padding:"1rem 1.25rem",margin:"0.75rem 0",animation:"warningPulse 2s ease-in-out infinite"},children:u.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"0.75rem",flexWrap:"wrap"},children:[u.jsx("span",{style:{fontSize:"1.25rem",lineHeight:1.3},children:""}),u.jsxs("div",{style:{flex:1,minWidth:"200px"},children:[u.jsx("p",{style:{margin:0,fontWeight:500,color:me.warning,fontSize:"0.95rem"},children:t}),u.jsxs(Tn,{to:n,style:{display:"inline-flex",alignItems:"center",gap:"0.35rem",marginTop:"0.5rem",color:me.warning,fontWeight:600,fontSize:"0.9rem",textDecoration:"underline",textUnderlineOffset:"3px"},children:[e," "]})]})]})})}const vP={success:{bgColor:"rgba(46, 213, 115, 0.95)",color:"white",icon:""},error:{bgColor:"rgba(255, 71, 87, 0.95)",color:"white",icon:""},warning:{bgColor:"rgba(255, 165, 2, 0.95)",color:"white",icon:""},info:{bgColor:"rgba(30, 144, 255, 0.95)",color:"white",icon:""}};function xP({item:t,onDismiss:e}){const[n,r]=D.useState(!1);if(D.useEffect(()=>{if(t){if(r(!0),t.autoDismissMs&&t.autoDismissMs>0){const o=setTimeout(()=>{r(!1),setTimeout(()=>e(t.id),200)},t.autoDismissMs);return()=>clearTimeout(o)}}else r(!1)},[t,e]),!t||!n)return null;const i=vP[t.type];return u.jsxs("div",{style:{position:"fixed",bottom:"1.5rem",right:"1.5rem",left:"1.5rem",maxWidth:"600px",margin:"0 auto",background:i.bgColor,color:i.color,padding:"0.75rem 1rem",borderRadius:"0.5rem",fontSize:"0.9rem",fontWeight:500,boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",zIndex:1001,display:"flex",alignItems:"center",gap:"0.5rem",animation:n?"fadeInUp 0.2s ease-out":"fadeOut 0.2s ease-out",cursor:"pointer"},onClick:()=>{r(!1),setTimeout(()=>e(t.id),200)},children:[u.jsx("span",{children:i.icon}),u.jsx("span",{style:{flex:1},children:t.message}),u.jsx("span",{style:{fontSize:"1.2rem",lineHeight:1},children:""})]})}class wP{items=[];listeners=new Set;nextId=1;add(e){const n=`banner-${this.nextId++}`,r={...e,id:n};return this.items.push(r),this.notify(),n}remove(e){this.items=this.items.filter(n=>n.id!==e),this.notify()}getCurrent(){return this.items[0]||null}subscribe(e){return this.listeners.add(e),e(this.getCurrent()),()=>{this.listeners.delete(e)}}notify(){const e=this.getCurrent();this.listeners.forEach(n=>n(e))}}const pr=new wP;function SP(t,e){const n={};Object.keys(e).forEach(l=>{n[l]=0});const r=Ue.getQueryData(ke.budget(t));if(!r)return n;const i=r.budget.month_map||{},o=Object.keys(i).sort();for(const l of o){const d=parseInt(l.substring(0,4),10),h=parseInt(l.substring(4,6),10),m=ke.month(t,d,h),p=Ue.getQueryData(m);if(!p?.month)continue;const g=p.month;for(const v of g.account_balances||[])v.account_id&&!et(v.account_id)&&n[v.account_id]===0&&(n[v.account_id]=v.start_balance??0)}for(const l of o){const d=parseInt(l.substring(0,4),10),h=parseInt(l.substring(4,6),10),m=ke.month(t,d,h),p=Ue.getQueryData(m);if(!p?.month)continue;const g=p.month;for(const v of g.income||[])v.account_id&&!et(v.account_id)&&n[v.account_id]!==void 0&&(n[v.account_id]+=v.amount);for(const v of g.expenses||[])v.account_id&&!et(v.account_id)&&n[v.account_id]!==void 0&&(n[v.account_id]+=v.amount);for(const v of g.transfers||[])v.to_account_id&&!et(v.to_account_id)&&n[v.to_account_id]!==void 0&&(n[v.to_account_id]+=v.amount),v.from_account_id&&!et(v.from_account_id)&&n[v.from_account_id]!==void 0&&(n[v.from_account_id]-=v.amount);for(const v of g.adjustments||[])v.account_id&&!et(v.account_id)&&n[v.account_id]!==void 0&&(n[v.account_id]+=v.amount)}for(const l of Object.keys(n))n[l]=Oe(n[l]);return n}function KT(t){const e=Ue.getQueryData(ke.budget(t));if(!e){console.warn("[recalculateBudgetAccountBalancesFromCache] Budget not in cache");return}const n=SP(t,e.accounts),r={};for(const[o,l]of Object.entries(e.accounts))r[o]={...l,balance:n[o]??l.balance};const i=F0(r,e.categories,e.accountGroups);Ue.setQueryData(ke.budget(t),{...e,accounts:r,budget:{...e.budget,accounts:r,total_available:i}})}const CP=300*1e3;function wn(){const{removeChange:t,getChanges:e,clearChanges:n,hasChanges:r,setIsSaving:i,setLastSaveTime:o,setSaveError:l}=fc(),d=D.useRef(null),h=D.useRef(!1),m=D.useCallback(async(C,x,S,E)=>{const T=ke.month(C,x,S),I=Ue.getQueryData(T);if(!I?.month)throw new Error(`Month ${x}/${S} not found in cache`);await ET({budgetId:C,month:I.month,description:`${E}: ${x}/${S}`,cascadeRecalculation:!1})},[]),p=D.useCallback(async(C,x)=>{const S=ke.budget(C),E=Ue.getQueryData(S);if(!E)throw new Error(`Budget ${C} not found in cache`);await gm({budgetId:C,updates:{name:E.budget.name,user_ids:E.budget.user_ids,accepted_user_ids:E.budget.accepted_user_ids,owner_id:E.budget.owner_id,owner_email:E.budget.owner_email,accounts:E.budget.accounts,account_groups:E.budget.account_groups,categories:E.budget.categories,category_groups:E.budget.category_groups,total_available:E.budget.total_available,is_needs_recalculation:E.budget.is_needs_recalculation,month_map:E.budget.month_map},description:`${x}: budget`})},[]),g=D.useCallback(async(C,x)=>{const S=ke.payees(C),E=Ue.getQueryData(S);if(!E)throw new Error(`Payees for budget ${C} not found in cache`);await qn("payees",C,{budget_id:C,payees:E,updated_at:new Date().toISOString()},`${x}: payees`)},[]),v=D.useCallback(async(C="periodic save")=>{if(h.current||!r())return;h.current=!0,i(!0),l(null);const x=e(),S=[];try{const E=[],T=new Set,I=new Set;for(const M of x)M.type==="month"&&M.year!==void 0&&M.month!==void 0?E.push({budgetId:M.budgetId,year:M.year,month:M.month}):M.type==="budget"?T.add(M.budgetId):M.type==="payees"&&I.add(M.budgetId);for(const{budgetId:M,year:L,month:$}of E){const k=ke.month(M,L,$),A=Ue.getQueryData(k);if(A?.month){const N=_m(A.month);Ue.setQueryData(k,{month:N})}}for(const{budgetId:M,year:L,month:$}of E)try{await m(M,L,$,C)}catch(k){const A=`Failed to save month ${L}/${$}: ${k instanceof Error?k.message:String(k)}`;S.push(A),console.error("[useBackgroundSave]",A,k)}for(const M of T)try{KT(M)}catch(L){console.warn("[useBackgroundSave] Failed to recalculate budget account balances from cache:",L)}for(const M of T)try{await p(M,C)}catch(L){const $=`Failed to save budget: ${L instanceof Error?L.message:String(L)}`;S.push($),console.error("[useBackgroundSave]",$,L)}for(const M of I)try{await g(M,C)}catch(L){const $=`Failed to save payees: ${L instanceof Error?L.message:String(L)}`;S.push($),console.error("[useBackgroundSave]",$,L)}if(S.length===0)n(),o(Date.now()),pr.add({type:"success",message:"All changes saved successfully",autoDismissMs:2e3});else throw new Error(S.join("; "))}catch(E){const T=E instanceof Error?E.message:String(E);throw l(T),pr.add({type:"error",message:`Failed to save changes: ${T}`,autoDismissMs:0}),E}finally{h.current=!1,i(!1)}},[r,e,n,m,p,g,i,o,l]),_=D.useCallback(async(C,x,S,E)=>{try{i(!0),l(null),x==="month"&&S!==void 0&&E!==void 0?(await m(C,S,E,"immediate save (current viewing document)"),t({type:"month",budgetId:C,year:S,month:E}),o(Date.now())):x==="budget"&&(await p(C,"immediate save (current viewing document)"),t({type:"budget",budgetId:C}),o(Date.now()))}catch(T){const I=T instanceof Error?T.message:String(T);throw l(I),pr.add({type:"error",message:`Failed to save current document: ${I}`,autoDismissMs:0}),T}finally{i(!1)}},[m,p,t,i,o,l]);return D.useEffect(()=>(d.current&&clearInterval(d.current),d.current=setInterval(()=>{r()&&v("periodic save (5-minute timer)").catch(x=>{console.error("[useBackgroundSave] Periodic save failed:",x)})},CP),()=>{d.current&&clearInterval(d.current)}),[r,v]),{saveAllChanges:v,saveCurrentDocument:_}}async function EP(t,e,n,r){const i=Ue.getQueryData(ke.budget(t));if(!i){console.warn("[mutationHelpers] Budget not in cache, skipping local recalculation");return}const o=i.budget.month_map,l=xt(e,n),d=[];for(const[h]of Object.entries(o))if(h>=l){const m=parseInt(h.substring(0,4),10),p=parseInt(h.substring(4,6),10);d.push({year:m,month:p})}d.sort((h,m)=>h.year!==m.year?h.year-m.year:h.month-m.month);for(const{year:h,month:m}of d)try{await a3(t,h,m,Ue),r&&r({type:"month",budgetId:t,year:h,month:m})}catch(p){console.warn(`[mutationHelpers] Failed to recalculate month ${h}/${m} locally:`,p)}}function yr(){const{trackChange:t}=fc();return{updateMonthCacheAndTrack:(r,i,o,l)=>{Ue.setQueryData(ke.month(r,i,o),{month:l}),t({type:"month",budgetId:r,year:i,month:o})},recalculateMonthAndCascade:async(r,i,o)=>{const l=ke.month(r,i,o),d=Ue.getQueryData(l);if(d?.month){const h=_m(d.month);Ue.setQueryData(l,{month:h})}await EP(r,i,o,t);try{KT(r),t({type:"budget",budgetId:r})}catch(h){console.warn("[mutationHelpers] Failed to recalculate budget account balances from cache:",h),t({type:"budget",budgetId:r})}},trackChange:t}}function TP(){const{currentViewingDocument:t}=Xe(),{saveCurrentDocument:e}=wn(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=yr();return{finalizeAllocations:async o=>{const{budgetId:l,year:d,month:h,allocations:m,onProgress:p}=o;p?.({phase:"saving",message:"Saving allocations..."});const g=await Qr(l,d,h);if(!g)throw new Error(`Month not found: ${d}/${h}`);const v=g.category_balances?.map(E=>E.category_id)??[],_=v.length>0?v:Object.keys(m),C=_.length>0?x4(g,_,m):g.category_balances,x={...g,category_balances:C,are_allocations_finalized:!0,updated_at:new Date().toISOString()};n(l,d,h,x),p?.({phase:"recalculating",message:"Recalculating month balances..."});try{await r(l,d,h)}catch(E){console.warn("[useFinalizeAllocations] Failed to recalculate month and cascade:",E)}if(t.type==="month"&&t.year===d&&t.month===h)try{await e(l,"month",d,h)}catch(E){console.warn("[useFinalizeAllocations] Failed to save current document immediately:",E)}return p?.({phase:"complete",message:"Allocations applied!"}),{updatedMonth:x}},isPending:!1,isError:!1,error:null}}function YT(){const{currentViewingDocument:t}=Xe(),{saveCurrentDocument:e}=wn(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=yr();return{deleteAllocations:async o=>{const{budgetId:l,year:d,month:h,onProgress:m}=o;m?.({phase:"saving",message:"Deleting allocations..."});const p=await Qr(l,d,h);if(!p)throw new Error(`Month not found: ${d}/${h}`);const g=p.category_balances.map(C=>({...C,allocated:0,end_balance:C.start_balance-C.spent})),v={...p,category_balances:g,are_allocations_finalized:!1,updated_at:new Date().toISOString()};n(l,d,h,v),m?.({phase:"recalculating",message:"Recalculating month balances..."});try{await r(l,d,h)}catch(C){console.warn("[useDeleteAllocations] Failed to recalculate month and cascade:",C)}if(t.type==="month"&&t.year===d&&t.month===h)try{await e(l,"month",d,h)}catch(C){console.warn("[useDeleteAllocations] Failed to save current document immediately:",C)}return m?.({phase:"complete",message:"Allocations deleted!"}),{updatedMonth:v}},isPending:!1,isError:!1,error:null}}async function wm(t,e,n){const r=e.trim();if(!r||n.includes(r))return null;const i=[...n,r].sort((o,l)=>o.toLowerCase().localeCompare(l.toLowerCase()));return await qn("payees",t,{budget_id:t,payees:i,updated_at:new Date().toISOString()},`adding new payee "${r}" to autocomplete list`),i}function AP(t,e){const n={id:e,amount:t.amount,account_id:t.accountId,date:t.date,created_at:new Date().toISOString()};return t.payee?.trim()&&(n.payee=t.payee.trim()),t.description&&(n.description=t.description),n}function jP(){const t=Vt(),{currentViewingDocument:e}=Xe(),{saveCurrentDocument:n}=wn(),{updateMonthCacheAndTrack:r,recalculateMonthAndCascade:i,trackChange:o}=yr(),l=Hn({onMutate:async h=>{const{budgetId:m,year:p,month:g}=h,v=ke.month(m,p,g);await t.cancelQueries({queryKey:v});const _=t.getQueryData(v),C=`income_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,x=AP(h,C);if(_?.month){const E={..._.month,income:[..._.month.income||[],x],updated_at:new Date().toISOString()};r(m,p,g,E)}try{await i(m,p,g)}catch(E){console.warn("[useAddIncome] Failed to recalculate month and cascade:",E)}if(h.payee?.trim()){const E=t.getQueryData(ke.payees(m))||[],T=await wm(m,h.payee,E);T&&(t.setQueryData(ke.payees(m),T),o({type:"payees",budgetId:m}))}if(e.type==="month"&&e.year===p&&e.month===g)try{await n(m,"month",p,g)}catch(E){console.warn("[useAddIncome] Failed to save current document immediately:",E)}return{previousData:_,incomeId:C,newIncome:x}},mutationFn:async h=>{const{budgetId:m,year:p,month:g}=h,v=ke.month(m,p,g),_=t.getQueryData(v);if(!_?.month)throw new Error("No month data in cache after optimistic update");const C=_.month,x=C.income?.[C.income.length-1];if(!x)throw new Error("Could not find new income in updated month");return{updatedMonth:C,newIncome:x}},onError:(h,m,p)=>{if(p?.previousData){const{budgetId:g,year:v,month:_}=m;t.setQueryData(ke.month(g,v,_),p.previousData)}}});return{addIncome:async(h,m,p,g,v,_,C,x)=>l.mutateAsync({budgetId:h,year:m,month:p,amount:g,accountId:v,date:_,payee:C,description:x}),isPending:l.isPending,isError:l.isError,error:l.error}}function RP(t,e,n,r,i,o){if(!t)return!0;const l=t.payee||void 0,d=i?.trim()||void 0,h=t.description||void 0,m=o||void 0;return e!==t.amount||n!==t.account_id||r!==t.date||d!==l||m!==h}function IP(){const t=Vt(),{currentViewingDocument:e}=Xe(),{saveCurrentDocument:n}=wn(),{updateMonthCacheAndTrack:r,recalculateMonthAndCascade:i,trackChange:o}=yr();return{updateIncome:async(d,h,m,p,g,v,_,C,x)=>{const S=await Qr(d,h,m);if(!S)throw new Error(`Month not found: ${h}/${m}`);const E=(S.income||[]).find($=>$.id===p);if(!RP(E,g,v,_,C,x))return{updatedMonth:S,noOp:!0};const T={id:p,amount:g,account_id:v,date:_,created_at:(S.income||[]).find($=>$.id===p)?.created_at||new Date().toISOString()};C?.trim()&&(T.payee=C.trim()),x&&(T.description=x);const I=(S.income||[]).map($=>$.id===p?T:$),M={...S,income:I,updated_at:new Date().toISOString()};r(d,h,m,M);try{await i(d,h,m)}catch($){console.warn("[useUpdateIncome] Failed to recalculate month and cascade:",$)}if(C?.trim()){const $=t.getQueryData(ke.payees(d))||[],k=await wm(d,C,$);k&&(t.setQueryData(ke.payees(d),k),o({type:"payees",budgetId:d}))}if(e.type==="month"&&e.year===h&&e.month===m)try{await n(d,"month",h,m)}catch($){console.warn("[useUpdateIncome] Failed to save current document immediately:",$)}return{updatedMonth:M}},isPending:!1,isError:!1,error:null}}function kP(){const{currentViewingDocument:t}=Xe(),{saveCurrentDocument:e}=wn(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=yr();return{deleteIncome:async(o,l,d,h)=>{const m=await Qr(o,l,d);if(!m)throw new Error(`Month not found: ${l}/${d}`);const p=(m.income||[]).filter(_=>_.id!==h),g={...m,income:p,updated_at:new Date().toISOString()};n(o,l,d,g);try{await r(o,l,d)}catch(_){console.warn("[useDeleteIncome] Failed to recalculate month and cascade:",_)}if(t.type==="month"&&t.year===l&&t.month===d)try{await e(o,"month",l,d)}catch(_){console.warn("[useDeleteIncome] Failed to save current document immediately:",_)}return{updatedMonth:g}},isPending:!1,isError:!1,error:null}}function DP(t,e){const n={id:e,amount:t.amount,category_id:t.categoryId,account_id:t.accountId,date:t.date,created_at:new Date().toISOString()};return t.payee?.trim()&&(n.payee=t.payee.trim()),t.description&&(n.description=t.description),t.cleared!==void 0&&(n.cleared=t.cleared),n}function OP(){const t=Vt(),{currentViewingDocument:e}=Xe(),{saveCurrentDocument:n}=wn(),{updateMonthCacheAndTrack:r,recalculateMonthAndCascade:i,trackChange:o}=yr(),l=Hn({onMutate:async h=>{const{budgetId:m,year:p,month:g}=h,v=ke.month(m,p,g);await t.cancelQueries({queryKey:v});const _=t.getQueryData(v),C=`expense_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,x=DP(h,C);if(_?.month){const E={..._.month,expenses:[..._.month.expenses||[],x],updated_at:new Date().toISOString()};r(m,p,g,E)}try{await i(m,p,g)}catch(E){console.warn("[useAddExpense] Failed to recalculate month and cascade:",E)}if(h.payee?.trim()){const E=t.getQueryData(ke.payees(m))||[],T=await wm(m,h.payee,E);T&&(t.setQueryData(ke.payees(m),T),o({type:"payees",budgetId:m}))}if(e.type==="month"&&e.year===p&&e.month===g)try{await n(m,"month",p,g)}catch(E){console.warn("[useAddExpense] Failed to save current document immediately:",E)}return{previousData:_,expenseId:C,newExpense:x}},mutationFn:async h=>{const{budgetId:m,year:p,month:g}=h,v=ke.month(m,p,g),_=t.getQueryData(v);if(!_?.month)throw new Error("No month data in cache after optimistic update");const C=_.month,x=C.expenses?.[C.expenses.length-1];if(!x)throw new Error("Could not find new expense in updated month");return{updatedMonth:C,newExpense:x}},onError:(h,m,p)=>{if(p?.previousData){const{budgetId:g,year:v,month:_}=m;t.setQueryData(ke.month(g,v,_),p.previousData)}}});return{addExpense:async(h,m,p,g,v,_,C,x,S,E)=>l.mutateAsync({budgetId:h,year:m,month:p,amount:g,categoryId:v,accountId:_,date:C,payee:x,description:S,cleared:E}),isPending:l.isPending,isError:l.isError,error:l.error}}function MP(t,e,n,r,i,o,l,d){if(!t)return!0;const h=t.payee||void 0,m=o?.trim()||void 0,p=t.description||void 0,g=l||void 0;return e!==t.amount||n!==t.category_id||r!==t.account_id||i!==t.date||m!==h||g!==p||d!==t.cleared}function NP(){const t=Vt(),{currentViewingDocument:e}=Xe(),{saveCurrentDocument:n}=wn(),{updateMonthCacheAndTrack:r,recalculateMonthAndCascade:i}=yr();return{updateExpense:async(l,d,h,m,p,g,v,_,C,x,S)=>{const E=await Qr(l,d,h);if(!E)throw new Error(`Month not found: ${d}/${h}`);const T=(E.expenses||[]).find(k=>k.id===m);if(!MP(T,p,g,v,_,C,x,S))return{updatedMonth:E,noOp:!0};const I={id:m,amount:p,category_id:g,account_id:v,date:_,created_at:E.expenses?.find(k=>k.id===m)?.created_at||new Date().toISOString()};C?.trim()&&(I.payee=C.trim()),x&&(I.description=x),S!==void 0&&(I.cleared=S);const M=(E.expenses||[]).map(k=>k.id===m?I:k),L={...E,expenses:M,updated_at:new Date().toISOString()};r(l,d,h,L);try{await i(l,d,h)}catch(k){console.warn("[useUpdateExpense] Failed to recalculate month and cascade:",k)}if(C?.trim()){const k=t.getQueryData(ke.payees(l))||[],A=await wm(l,C,k);A&&t.setQueryData(ke.payees(l),A)}if(e.type==="month"&&e.year===d&&e.month===h)try{await n(l,"month",d,h)}catch(k){console.warn("[useUpdateExpense] Failed to save current document immediately:",k)}return{updatedMonth:L}},isPending:!1,isError:!1,error:null}}function PP(){const{currentViewingDocument:t}=Xe(),{saveCurrentDocument:e}=wn(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=yr();return{deleteExpense:async(o,l,d,h)=>{const m=await Qr(o,l,d);if(!m)throw new Error(`Month not found: ${l}/${d}`);const p=(m.expenses||[]).filter(_=>_.id!==h),g={...m,expenses:p,updated_at:new Date().toISOString()};n(o,l,d,g);try{await r(o,l,d)}catch(_){console.warn("[useDeleteExpense] Failed to recalculate month and cascade:",_)}if(t.type==="month"&&t.year===l&&t.month===d)try{await e(o,"month",l,d)}catch(_){console.warn("[useDeleteExpense] Failed to save current document immediately:",_)}return{updatedMonth:g}},isPending:!1,isError:!1,error:null}}function zP(t,e){const n={id:e,amount:t.amount,from_account_id:t.fromAccountId,to_account_id:t.toAccountId,from_category_id:t.fromCategoryId,to_category_id:t.toCategoryId,date:t.date,created_at:new Date().toISOString()};return t.description&&(n.description=t.description),t.cleared!==void 0&&(n.cleared=t.cleared),n}function BP(){const t=Vt(),{currentViewingDocument:e}=Xe(),{saveCurrentDocument:n}=wn(),{updateMonthCacheAndTrack:r,recalculateMonthAndCascade:i}=yr(),o=Hn({onMutate:async d=>{const{budgetId:h,year:m,month:p}=d,g=ke.month(h,m,p);await t.cancelQueries({queryKey:g});const v=t.getQueryData(g),_=`transfer_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,C=zP(d,_);if(v?.month){const S={...v.month,transfers:[...v.month.transfers||[],C],updated_at:new Date().toISOString()};r(h,m,p,S)}try{await i(h,m,p)}catch(S){console.warn("[useAddTransfer] Failed to recalculate month and cascade:",S)}if(e.type==="month"&&e.year===m&&e.month===p)try{await n(h,"month",m,p)}catch(S){console.warn("[useAddTransfer] Failed to save current document immediately:",S)}return{previousData:v,transferId:_,newTransfer:C}},mutationFn:async d=>{const{budgetId:h,year:m,month:p}=d,g=ke.month(h,m,p),v=t.getQueryData(g);if(!v?.month)throw new Error("No month data in cache after optimistic update");const _=v.month,C=_.transfers?.[_.transfers.length-1];if(!C)throw new Error("Could not find new transfer in updated month");return{updatedMonth:_,newTransfer:C}},onError:(d,h,m)=>{if(m?.previousData){const{budgetId:p,year:g,month:v}=h;t.setQueryData(ke.month(p,g,v),m.previousData)}}});return{addTransfer:async(d,h,m,p,g,v,_,C,x,S,E)=>o.mutateAsync({budgetId:d,year:h,month:m,amount:p,fromAccountId:g,toAccountId:v,fromCategoryId:_,toCategoryId:C,date:x,description:S,cleared:E}),isPending:o.isPending,isError:o.isError,error:o.error}}function LP(t,e,n,r,i,o,l,d,h){if(!t)return!0;const m=t.description||void 0,p=d||void 0;return e!==t.amount||n!==t.from_account_id||r!==t.to_account_id||i!==t.from_category_id||o!==t.to_category_id||l!==t.date||p!==m||h!==t.cleared}function UP(){const{currentViewingDocument:t}=Xe(),{saveCurrentDocument:e}=wn(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=yr();return{updateTransfer:async(o,l,d,h,m,p,g,v,_,C,x,S)=>{const E=await Qr(o,l,d);if(!E)throw new Error(`Month not found: ${l}/${d}`);const T=(E.transfers||[]).find(k=>k.id===h);if(!LP(T,m,p,g,v,_,C,x,S))return{updatedMonth:E,noOp:!0};const I={id:h,amount:m,from_account_id:p,to_account_id:g,from_category_id:v,to_category_id:_,date:C,created_at:E.transfers?.find(k=>k.id===h)?.created_at||new Date().toISOString()};x&&(I.description=x),S!==void 0&&(I.cleared=S);const M=(E.transfers||[]).map(k=>k.id===h?I:k),L={...E,transfers:M,updated_at:new Date().toISOString()};n(o,l,d,L);try{await r(o,l,d)}catch(k){console.warn("[useUpdateTransfer] Failed to recalculate month and cascade:",k)}if(t.type==="month"&&t.year===l&&t.month===d)try{await e(o,"month",l,d)}catch(k){console.warn("[useUpdateTransfer] Failed to save current document immediately:",k)}return{updatedMonth:L}},isPending:!1,isError:!1,error:null}}function FP(){const{currentViewingDocument:t}=Xe(),{saveCurrentDocument:e}=wn(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=yr();return{deleteTransfer:async(o,l,d,h)=>{const m=await Qr(o,l,d);if(!m)throw new Error(`Month not found: ${l}/${d}`);const p=(m.transfers||[]).filter(_=>_.id!==h),g={...m,transfers:p,updated_at:new Date().toISOString()};n(o,l,d,g);try{await r(o,l,d)}catch(_){console.warn("[useDeleteTransfer] Failed to recalculate month and cascade:",_)}if(t.type==="month"&&t.year===l&&t.month===d)try{await e(o,"month",l,d)}catch(_){console.warn("[useDeleteTransfer] Failed to save current document immediately:",_)}return{updatedMonth:g}},isPending:!1,isError:!1,error:null}}function VP(t,e){const n={id:e,amount:t.amount,account_id:t.accountId,category_id:t.categoryId,date:t.date,created_at:new Date().toISOString()};return t.payee?.trim()&&(n.payee=t.payee.trim()),t.description&&(n.description=t.description),t.cleared!==void 0&&(n.cleared=t.cleared),n}function $P(){const t=Vt(),{currentViewingDocument:e}=Xe(),{saveCurrentDocument:n}=wn(),{updateMonthCacheAndTrack:r,recalculateMonthAndCascade:i}=yr(),o=Hn({onMutate:async d=>{const{budgetId:h,year:m,month:p}=d,g=ke.month(h,m,p);await t.cancelQueries({queryKey:g});const v=t.getQueryData(g),_=`adjustment_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,C=VP(d,_);if(v?.month){const S={...v.month,adjustments:[...v.month.adjustments||[],C],updated_at:new Date().toISOString()};r(h,m,p,S)}try{await i(h,m,p)}catch(S){console.warn("[useAddAdjustment] Failed to recalculate month and cascade:",S)}if(e.type==="month"&&e.year===m&&e.month===p)try{await n(h,"month",m,p)}catch(S){console.warn("[useAddAdjustment] Failed to save current document immediately:",S)}return{previousData:v,adjustmentId:_,newAdjustment:C}},mutationFn:async d=>{const{budgetId:h,year:m,month:p}=d,g=ke.month(h,m,p),v=t.getQueryData(g);if(!v?.month)throw new Error("No month data in cache after optimistic update");const _=v.month,C=_.adjustments?.[_.adjustments.length-1];if(!C)throw new Error("Could not find new adjustment in updated month");return{updatedMonth:_,newAdjustment:C}},onError:(d,h,m)=>{if(m?.previousData){const{budgetId:p,year:g,month:v}=h;t.setQueryData(ke.month(p,g,v),m.previousData)}}});return{addAdjustment:async(d,h,m,p,g,v,_,C,x,S)=>o.mutateAsync({budgetId:d,year:h,month:m,amount:p,accountId:g,categoryId:v,date:_,payee:C,description:x,cleared:S}),isPending:o.isPending,isError:o.isError,error:o.error}}function qP(t,e,n,r,i,o,l,d){if(!t)return!0;const h=t.payee||void 0,m=o?.trim()||void 0,p=t.description||void 0,g=l||void 0;return e!==t.amount||n!==t.account_id||r!==t.category_id||i!==t.date||m!==h||g!==p||d!==t.cleared}function HP(){const{currentViewingDocument:t}=Xe(),{saveCurrentDocument:e}=wn(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=yr();return{updateAdjustment:async(o,l,d,h,m,p,g,v,_,C,x)=>{const S=await Qr(o,l,d);if(!S)throw new Error(`Month not found: ${l}/${d}`);const E=(S.adjustments||[]).find($=>$.id===h);if(!qP(E,m,p,g,v,_,C,x))return{updatedMonth:S,noOp:!0};const T={id:h,amount:m,account_id:p,category_id:g,date:v,created_at:S.adjustments?.find($=>$.id===h)?.created_at||new Date().toISOString()};_?.trim()&&(T.payee=_.trim()),C&&(T.description=C),x!==void 0&&(T.cleared=x);const I=(S.adjustments||[]).map($=>$.id===h?T:$),M={...S,adjustments:I,updated_at:new Date().toISOString()};n(o,l,d,M);try{await r(o,l,d)}catch($){console.warn("[useUpdateAdjustment] Failed to recalculate month and cascade:",$)}if(t.type==="month"&&t.year===l&&t.month===d)try{await e(o,"month",l,d)}catch($){console.warn("[useUpdateAdjustment] Failed to save current document immediately:",$)}return{updatedMonth:M}},isPending:!1,isError:!1,error:null}}function GP(){const{currentViewingDocument:t}=Xe(),{saveCurrentDocument:e}=wn(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=yr();return{deleteAdjustment:async(o,l,d,h)=>{const m=await Qr(o,l,d);if(!m)throw new Error(`Month not found: ${l}/${d}`);const p=(m.adjustments||[]).filter(_=>_.id!==h),g={...m,adjustments:p,updated_at:new Date().toISOString()};n(o,l,d,g);try{await r(o,l,d)}catch(_){console.warn("[useDeleteAdjustment] Failed to recalculate month and cascade:",_)}if(t.type==="month"&&t.year===l&&t.month===d)try{await e(o,"month",l,d)}catch(_){console.warn("[useDeleteAdjustment] Failed to save current document immediately:",_)}return{updatedMonth:g}},isPending:!1,isError:!1,error:null}}const QP={currentUserId:null,selectedBudgetId:null,currentYear:new Date().getFullYear(),currentMonthNumber:new Date().getMonth()+1,lastActiveTab:"categories",lastSettingsTab:"categories",lastAdminTab:"budget",currentViewingDocument:{type:null},setCurrentViewingDocument:()=>{},setSelectedBudgetId:()=>{},setCurrentYear:()=>{},setCurrentMonthNumber:()=>{},setLastActiveTab:()=>{},setLastSettingsTab:()=>{},setLastAdminTab:()=>{},pageTitle:"Budget",setPageTitle:()=>{},isInitialized:!1,needsFirstBudget:!1,initialDataLoadComplete:!1,goToPreviousMonth:()=>{},goToNextMonth:()=>{},pendingInvites:[],hasPendingInvites:!1,accessibleBudgets:[],isAdmin:!1,isTest:!1,loadAccessibleBudgets:async()=>{},switchToBudget:()=>{},checkBudgetInvite:async()=>null,clearCache:()=>{}},XT=D.createContext(QP);function WP({children:t}){const n=Oa().get_current_firebase_user(),[r,i]=D.useState(null),[o,l]=D.useState(new Date().getFullYear()),[d,h]=D.useState(new Date().getMonth()+1),[m,p]=D.useState("categories"),[g,v]=D.useState("categories"),[_,C]=D.useState("budget"),[x,S]=D.useState("Budget"),E=D.useCallback(ue=>{S(be=>be===ue?be:ue)},[]),[T,I]=D.useState({type:null}),[M,L]=D.useState(!1),[$,k]=D.useState(!1),A=X6(n?.uid||null,n?.email||null),N=A.data&&A.data.budget_ids.length===0,F=J6(n?.uid||null,A.data||null,{enabled:!!n?.uid&&!!A.data&&N}),q=i3(r,{enabled:!!r&&M}),[j,P]=D.useState(!1);D.useEffect(()=>{if(!q.data){P(!1);return}const{budget:ue,payees:be,months:ce}=q.data,ve=Date.now();Ue.setQueryData(ke.budget(r),ue,{updatedAt:ve}),Ue.setQueryData(ke.payees(r),be,{updatedAt:ve});for(const ze of ce)Ue.setQueryData(ke.month(r,ze.year,ze.month),{month:ze},{updatedAt:ve});P(!0)},[q.data,r]),D.useEffect(()=>{r||P(!1)},[r]);const O=A.data?.permission_flags?.is_admin===!0,X=A.data?.permission_flags?.is_test===!0,W=F.data?.pendingInvites||[],H=F.data?.budgets||[],Z=W.length>0;D.useEffect(()=>{if(!n||M||A.isLoading)return;const ue=A.data;if(!(!ue&&!A.isError))if(ue&&ue.budget_ids.length>0)i(ue.budget_ids[0]),k(!1),L(!0);else{if(F.isLoading)return;const be=F.data;k(!(be?.pendingInvites&&be.pendingInvites.length>0)),L(!0)}},[n,M,A.data,A.isLoading,A.isError,F.data,F.isLoading]);const Y=D.useCallback(()=>{d===1?(l(ue=>ue-1),h(12)):h(ue=>ue-1)},[d]),se=D.useCallback(()=>{d===12?(l(ue=>ue+1),h(1)):h(ue=>ue+1)},[d]),B=D.useCallback(async ue=>{(ue?.force||!F.data)&&await F.refetch()},[F]),G=D.useCallback(ue=>{i(ue),k(!1)},[]),ne=D.useCallback(async ue=>{if(!n)return null;try{const be=await y4(ue,n.uid);return be&&be.isInvited&&!be.hasAccepted?{budgetId:ue,budgetName:be.budgetName,ownerEmail:be.ownerEmail}:null}catch(be){return console.error("[BudgetContext] Error checking budget invite:",be),null}},[n]),ie=D.useCallback(()=>{Ue.clear()},[]),ee={currentUserId:n?.uid||null,selectedBudgetId:r,currentYear:o,currentMonthNumber:d,lastActiveTab:m,lastSettingsTab:g,lastAdminTab:_,currentViewingDocument:T,setCurrentViewingDocument:I,setSelectedBudgetId:i,setCurrentYear:l,setCurrentMonthNumber:h,setLastActiveTab:p,setLastSettingsTab:v,setLastAdminTab:C,pageTitle:x,setPageTitle:E,isInitialized:M,needsFirstBudget:$,initialDataLoadComplete:j,goToPreviousMonth:Y,goToNextMonth:se,pendingInvites:W,hasPendingInvites:Z,accessibleBudgets:H,isAdmin:O,isTest:X,loadAccessibleBudgets:B,switchToBudget:G,checkBudgetInvite:ne,clearCache:ie};return u.jsx(XT.Provider,{value:ee,children:t})}function Xe(){const t=D.useContext(XT);if(!t)throw new Error("useBudget must be used within a BudgetProvider");return t}const KP=function(){},YP={is_logged_in:!1,is_auth_checked:!1,username:"",set_user_context:KP},cd=D.createContext(YP);function L1({budget:t,isCurrent:e,isAccepting:n,isSwitching:r,isEditing:i,editName:o,isRenaming:l,onAccept:d,onSwitch:h,onStartEdit:m,onCancelEdit:p,onEditNameChange:g,onSaveEdit:v}){const _=e&&t.isOwner;return u.jsx("div",{style:{background:e?"color-mix(in srgb, #646cff 15%, transparent)":"color-mix(in srgb, currentColor 8%, transparent)",border:e?"2px solid color-mix(in srgb, #646cff 50%, transparent)":"1px solid transparent",padding:"1rem",borderRadius:"8px"},children:i?u.jsxs("form",{onSubmit:v,children:[u.jsx("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"0.5rem"},children:u.jsx("input",{type:"text",value:o,onChange:C=>g(C.target.value),placeholder:"Budget name",autoFocus:!0,style:{flex:1,padding:"0.5rem 0.75rem",borderRadius:"6px",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"1rem",fontWeight:600,color:"inherit"}})}),u.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[u.jsx("button",{type:"submit",disabled:l||!o.trim(),style:{background:"#22c55e",color:"white",border:"none",padding:"0.4rem 0.75rem",borderRadius:"6px",cursor:l||!o.trim()?"not-allowed":"pointer",fontWeight:500,opacity:l||!o.trim()?.7:1,fontSize:"0.8rem"},children:l?"Saving...":"Save"}),u.jsx("button",{type:"button",onClick:p,disabled:l,style:{background:"transparent",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)",padding:"0.4rem 0.75rem",borderRadius:"6px",cursor:l?"not-allowed":"pointer",fontWeight:500,opacity:l?.7:.8,fontSize:"0.8rem"},children:"Cancel"})]})]}):u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem",flexWrap:"wrap"},children:[u.jsxs("div",{style:{flex:1,minWidth:"200px"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flexWrap:"wrap",marginBottom:"0.25rem"},children:[u.jsx("span",{style:{fontWeight:600},children:t.name}),t.isOwner&&u.jsx("span",{style:{background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.65rem",textTransform:"uppercase",fontWeight:600},children:"Owner"}),e&&u.jsx("span",{style:{background:"color-mix(in srgb, #22c55e 20%, transparent)",color:"#4ade80",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.65rem",textTransform:"uppercase",fontWeight:600},children:"Active"}),t.isPending&&u.jsx("span",{style:{background:"color-mix(in srgb, #f59e0b 20%, transparent)",color:"#fbbf24",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.65rem",textTransform:"uppercase",fontWeight:600},children:"Pending"}),_&&u.jsx("button",{onClick:m,style:{background:"transparent",border:"none",padding:"0.15rem",cursor:"pointer",opacity:.5,fontSize:"0.8rem",lineHeight:1},title:"Rename budget",children:""})]}),u.jsx("p",{style:{margin:0,fontSize:"0.8rem",opacity:.6},children:t.ownerEmail?`Owner: ${t.ownerEmail}`:`ID: ${t.id}`})]}),u.jsx("div",{style:{display:"flex",gap:"0.5rem"},children:t.isPending?u.jsx("button",{onClick:d,disabled:n,style:{background:"#22c55e",color:"white",border:"none",padding:"0.5rem 1rem",borderRadius:"6px",cursor:n?"not-allowed":"pointer",fontWeight:500,opacity:n?.7:1,fontSize:"0.85rem"},children:n?"Accepting...":"Accept"}):e?null:u.jsx("button",{onClick:h,disabled:r,style:{background:"#646cff",color:"white",border:"none",padding:"0.5rem 1rem",borderRadius:"6px",cursor:r?"not-allowed":"pointer",fontWeight:500,opacity:r?.7:1,fontSize:"0.85rem"},children:r?"Switching...":"Switch"})})]})})}const Of={critical_bug:{label:"Critical Bug",color:"#ff4757",bgColor:"rgba(255, 71, 87, 0.15)"},bug:{label:"Bug",color:"#ffa502",bgColor:"rgba(255, 165, 2, 0.15)"},new_feature:{label:"New Feature",color:"#2ed573",bgColor:"rgba(46, 213, 115, 0.15)"},core_feature:{label:"Core Feature",color:"#1e90ff",bgColor:"rgba(30, 144, 255, 0.15)"},qol:{label:"QOL",color:"#a55eea",bgColor:"rgba(165, 94, 234, 0.15)"}};function ZT({type:t,onClick:e}){const n=t==="feature"?"new_feature":t,r=n&&n in Of?n:"bug",i=Of[r];return u.jsx("button",{type:"button",onClick:e,style:{padding:"0.25rem 0.5rem",borderRadius:"0.25rem",background:i.bgColor,color:i.color,fontSize:"0.7rem",fontWeight:600,textTransform:"uppercase",letterSpacing:"0.025em",flexShrink:0,border:"none",cursor:"pointer",transition:"opacity 0.15s, transform 0.15s"},onMouseEnter:o=>{o.currentTarget.style.opacity="0.8",o.currentTarget.style.transform="scale(1.05)"},onMouseLeave:o=>{o.currentTarget.style.opacity="1",o.currentTarget.style.transform="scale(1)"},title:"Click to change type",children:i.label})}function XP({item:t,isDragging:e,isDragOver:n,onDragStart:r,onDragOver:i,onDragLeave:o,onDragEnd:l,onDrop:d,onToggleDone:h,onTypeClick:m}){return u.jsxs("div",{onDragOver:p=>{p.stopPropagation(),i(p)},onDragLeave:p=>{p.stopPropagation(),o()},onDrop:p=>{p.stopPropagation(),d(p)},style:{position:"relative"},children:[u.jsx("div",{style:{...O4,opacity:n?1:0,boxShadow:n?"0 0 8px rgba(100, 108, 255, 0.6)":"none"}}),u.jsxs("div",{draggable:!0,onDragStart:r,onDragEnd:l,style:{...V0,cursor:"grab",opacity:e?.5:1,flexDirection:"column",alignItems:"stretch",gap:"0.5rem"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[u.jsx("span",{style:{...D4},children:""}),u.jsx("input",{type:"checkbox",checked:t.is_done,onChange:h,style:{width:"1.25rem",height:"1.25rem",cursor:"pointer",accentColor:me.primary,flexShrink:0}}),u.jsx(ZT,{type:t.feedback_type,onClick:m})]}),u.jsxs("div",{style:{marginLeft:"3.25rem"},children:[u.jsx("p",{style:{margin:0,lineHeight:1.5},children:t.text}),u.jsxs("p",{style:{margin:"0.5rem 0 0 0",fontSize:"0.8rem",opacity:.6},children:[t.user_email,"  ",ky(t.created_at)]})]})]})]})}function ZP({item:t,onToggleDone:e,onTypeClick:n}){return u.jsxs("div",{style:{...V0,opacity:.6,flexDirection:"column",alignItems:"stretch",gap:"0.5rem"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[u.jsx("input",{type:"checkbox",checked:t.is_done,onChange:e,style:{width:"1.25rem",height:"1.25rem",cursor:"pointer",accentColor:me.primary,flexShrink:0}}),u.jsx(ZT,{type:t.feedback_type,onClick:n})]}),u.jsxs("div",{style:{marginLeft:"2rem"},children:[u.jsx("p",{style:{margin:0,lineHeight:1.5,textDecoration:"line-through"},children:t.text}),u.jsxs("p",{style:{margin:"0.5rem 0 0 0",fontSize:"0.8rem",opacity:.8},children:[t.user_email,"  Created: ",ky(t.created_at)]}),t.completed_at&&u.jsxs("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.8rem",color:me.success},children:[" Completed: ",ky(t.completed_at)]})]})]})}function Vn({noMargin:t}={}){return u.jsx("span",{style:{display:"inline-block",width:"14px",height:"14px",border:"2px solid rgba(255, 255, 255, 0.3)",borderTopColor:"white",borderRadius:"50%",animation:"spin 0.8s linear infinite",marginRight:t?0:"0.5rem",verticalAlign:"middle"}})}function JT(){const{state:t,closeModal:e}=m3();if(!t.isOpen)return null;const n=t.isComplete;return u.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0, 0, 0, 0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1002,padding:"1rem"},onClick:n?e:void 0,children:u.jsxs("div",{style:{background:"#1a1a1a",color:"rgba(255, 255, 255, 0.87)",borderRadius:"16px",padding:"2rem",width:"32rem",maxWidth:"calc(100vw - 2rem)",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.5)"},onClick:r=>r.stopPropagation(),children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1.5rem"},children:[u.jsxs("h2",{style:{margin:0,fontSize:"1.25rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[!t.isComplete&&u.jsx(Vn,{noMargin:!0}),t.migrationName]}),n&&u.jsx("button",{onClick:e,style:{background:"transparent",border:"none",color:"inherit",cursor:"pointer",fontSize:"1.5rem",opacity:.6,lineHeight:1,padding:"0.25rem"},title:"Close",children:""})]}),u.jsxs("div",{style:{fontSize:"1rem",fontWeight:500,marginBottom:"1rem",color:t.error?"#ef4444":t.isComplete?"#22c55e":"inherit"},children:[t.error?" ":t.isComplete?" ":"",t.stage]}),u.jsx("div",{style:{background:"rgba(255, 255, 255, 0.1)",borderRadius:"8px",height:"12px",overflow:"hidden",marginBottom:"1rem"},children:t.progress!==null?u.jsx("div",{style:{background:t.error?"#ef4444":t.isComplete?"#22c55e":"#646cff",height:"100%",width:`${t.progress}%`,transition:"width 0.3s ease-out",borderRadius:"8px"}}):u.jsx("div",{style:{background:t.error?"#ef4444":"#646cff",height:"100%",width:"30%",borderRadius:"8px",animation:"progressIndeterminate 1.5s ease-in-out infinite"}})}),t.currentItem&&u.jsx("div",{style:{fontSize:"0.9rem",opacity:.8,marginBottom:"0.5rem",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:t.currentItem}),t.details&&u.jsx("div",{style:{fontSize:"0.85rem",opacity:.6,marginBottom:t.error?"1rem":0},children:t.details}),t.error&&u.jsx("div",{style:{background:"rgba(239, 68, 68, 0.1)",border:"1px solid rgba(239, 68, 68, 0.3)",borderRadius:"8px",padding:"0.75rem 1rem",fontSize:"0.9rem",color:"#ef4444"},children:t.error}),t.isComplete&&u.jsx("button",{onClick:e,style:{marginTop:"1.5rem",width:"100%",background:t.error?"rgba(239, 68, 68, 0.2)":"#646cff",color:"white",border:"none",padding:"0.75rem 1.5rem",borderRadius:"8px",cursor:"pointer",fontWeight:500,fontSize:"1rem"},children:t.error?"Close":"Done"}),!t.isComplete&&u.jsx("div",{style:{marginTop:"1rem",fontSize:"0.85rem",opacity:.5,textAlign:"center"},children:"Please wait  do not close this window"}),u.jsx("style",{children:`
            @keyframes progressIndeterminate {
              0% { transform: translateX(-100%); }
              100% { transform: translateX(400%); }
            }
          `})]})})}function wo({isOpen:t,onClose:e,onConfirm:n,migrationName:r,isDestructive:i=!1,onDownloadBackup:o,isDownloading:l=!1}){const[d,h]=D.useState(!1),m=D.useCallback(async()=>{o&&(await o(),h(!0))},[o]),p=D.useCallback(()=>{n(d?"downloaded":"already-have")},[d,n]),g=D.useCallback(()=>{n("cancelled"),e()},[n,e]);return u.jsxs(cs,{isOpen:t,onClose:g,title:" Backup Recommended",children:[u.jsx("div",{style:{background:i?"color-mix(in srgb, #ef4444 15%, transparent)":"color-mix(in srgb, #f59e0b 15%, transparent)",border:`1px solid ${i?"color-mix(in srgb, #ef4444 40%, transparent)":"color-mix(in srgb, #f59e0b 40%, transparent)"}`,borderRadius:"8px",padding:"1rem",marginBottom:"1rem"},children:u.jsx("p",{style:{margin:0,color:i?"#fca5a5":"#fcd34d",fontWeight:500,fontSize:"0.95rem"},children:i?" This migration modifies your data. A backup is strongly recommended!":" Before running migrations, we recommend having a recent backup."})}),u.jsxs("p",{style:{margin:"0 0 0.75rem",opacity:.9},children:["You are about to run: ",u.jsx("strong",{children:r})]}),u.jsx("p",{style:{margin:"0 0 1rem",opacity:.8,fontSize:"0.9rem"},children:"Please ensure you have a recent backup of your data. You can download a diagnostic backup that includes all your budget and month data."}),o&&u.jsx("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",padding:"1rem",marginBottom:"1rem"},children:u.jsx(Ve,{variant:"secondary",onClick:m,disabled:l,actionName:"Download Backup Before Migration",style:{width:"100%"},children:l?u.jsxs(u.Fragment,{children:[u.jsx(Vn,{noMargin:!0})," Downloading Backup..."]}):d?" Backup Downloaded":" Download Backup Now"})}),u.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[u.jsx(Ve,{variant:"secondary",actionName:"Cancel Migration",onClick:g,children:"Cancel"}),u.jsx(Ve,{variant:i?"danger":"primary",actionName:`Proceed with ${r}`,onClick:p,disabled:l,children:d?" Proceed with Migration":" I Have a Backup - Proceed"})]})]})}function So({migrationName:t,isDestructive:e=!1,onDownloadBackup:n}){const[r,i]=D.useState(!1),[o,l]=D.useState(!1),[d,h]=D.useState(null),m=D.useCallback(_=>{h(()=>_),i(!0)},[]),p=D.useCallback(_=>{_!=="cancelled"&&d&&d(),h(null),i(!1)},[d]),g=D.useCallback(()=>{h(null),i(!1)},[]),v=D.useCallback(async()=>{if(n){l(!0);try{await n()}finally{l(!1)}}},[n]);return{promptBeforeAction:m,promptProps:{isOpen:r,onClose:g,onConfirm:p,migrationName:t,isDestructive:e,onDownloadBackup:n?v:void 0,isDownloading:o}}}const JP={onetime:{borderColor:"color-mix(in srgb, #a855f7 30%, transparent)",iconBg:"color-mix(in srgb, #a855f7 15%, transparent)",headerBg:"color-mix(in srgb, #a855f7 8%, transparent)"},maintenance:{borderColor:"color-mix(in srgb, #3b82f6 30%, transparent)",iconBg:"color-mix(in srgb, #3b82f6 15%, transparent)",headerBg:"color-mix(in srgb, #3b82f6 8%, transparent)"},utility:{borderColor:"color-mix(in srgb, #22c55e 30%, transparent)",iconBg:"color-mix(in srgb, #22c55e 15%, transparent)",headerBg:"color-mix(in srgb, #22c55e 8%, transparent)"}};function W0({title:t,icon:e,description:n,type:r,children:i,onValidateAll:o,isValidating:l=!1,isAnyRunning:d=!1}){const h=JP[r],m=l||d,p=()=>{o&&!m&&o()};return u.jsxs("section",{style:{background:"color-mix(in srgb, currentColor 3%, transparent)",border:`1px solid ${h.borderColor}`,borderRadius:"12px",marginBottom:"1.5rem",overflow:"hidden"},children:[u.jsxs("div",{style:{background:h.headerBg,padding:"1.25rem 1.5rem",borderBottom:`2px solid ${h.borderColor}`,display:"flex",justifyContent:"space-between",alignItems:"flex-start",gap:"1rem"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"0.875rem",flex:1},children:[u.jsx("span",{style:{fontSize:"1.75rem",background:h.iconBg,padding:"0.625rem",borderRadius:"10px",lineHeight:1,display:"flex",alignItems:"center",justifyContent:"center",minWidth:"48px",minHeight:"48px"},children:e}),u.jsxs("div",{children:[u.jsx("h3",{style:{margin:"0 0 0.375rem 0",fontSize:"1.25rem",fontWeight:600,letterSpacing:"-0.01em"},children:t}),u.jsx("p",{style:{margin:0,opacity:.75,fontSize:"0.9rem",lineHeight:1.4},children:n})]})]}),o&&u.jsx("button",{onClick:p,disabled:m,style:{background:"color-mix(in srgb, #3b82f6 20%, transparent)",color:"#60a5fa",border:"1px solid color-mix(in srgb, #3b82f6 40%, transparent)",padding:"0.5rem 1rem",borderRadius:"6px",cursor:m?"not-allowed":"pointer",fontWeight:500,fontSize:"0.85rem",opacity:m?.6:1,display:"flex",alignItems:"center",gap:"0.4rem",flexShrink:0},children:l?u.jsxs(u.Fragment,{children:[u.jsx(Vn,{noMargin:!0})," Validating..."]}):" Validate All"})]}),u.jsx("div",{style:{padding:"0.75rem",background:"color-mix(in srgb, currentColor 1%, transparent)"},children:i})]})}const ez={unknown:{color:"#9ca3af",icon:"",text:"Unknown"},clean:{color:"#22c55e",icon:"",text:"Clean"},"needs-action":{color:"#f59e0b",icon:"",text:"Needs Action"},running:{color:"#60a5fa",icon:"",text:"Running"},complete:{color:"#22c55e",icon:"",text:"Complete"},error:{color:"#ef4444",icon:"",text:"Error"}};function K0({name:t,description:e,status:n,statusText:r,onCheck:i,isChecking:o,onRun:l,isRunning:d=!1,actionText:h="Run",disabled:m=!1,itemCount:p,details:g,isDestructive:v=!1}){const[_,C]=D.useState(!1),x=ez[n],S=r||x.text,E=m||d||o,T=()=>{i()},I=()=>{l&&l()},M=()=>{g&&C(!_)};return u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"8px",margin:"0.25rem 0",overflow:"hidden"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"0.75rem 1rem",gap:"1rem"},children:[u.jsx("div",{style:{width:"28px",height:"28px",borderRadius:"50%",background:`color-mix(in srgb, ${x.color} 20%, transparent)`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.85rem",flexShrink:0},children:d||o?u.jsx(Vn,{noMargin:!0}):x.icon}),u.jsxs("div",{style:{flex:1,minWidth:0},children:[u.jsx("div",{style:{fontWeight:500,fontSize:"0.95rem",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:t}),u.jsx("div",{style:{fontSize:"0.8rem",opacity:.6,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:e})]}),u.jsxs("div",{style:{color:x.color,fontSize:"0.8rem",fontWeight:500,display:"flex",alignItems:"center",gap:"0.25rem",flexShrink:0},children:[S,p!==void 0&&p>0&&u.jsx("span",{style:{background:`color-mix(in srgb, ${x.color} 20%, transparent)`,padding:"0.15rem 0.4rem",borderRadius:"4px",fontSize:"0.75rem"},children:p})]}),u.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:[u.jsx("button",{onClick:T,disabled:E,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",padding:"0.35rem 0.6rem",borderRadius:"4px",cursor:E?"not-allowed":"pointer",fontSize:"0.8rem",opacity:E?.5:1,display:"flex",alignItems:"center",gap:"0.25rem"},title:"Check status",children:o?u.jsx(Vn,{noMargin:!0}):""}),l&&n==="needs-action"&&u.jsx("button",{onClick:I,disabled:E,style:{background:v?"#ef4444":"#646cff",color:"white",border:"none",padding:"0.35rem 0.75rem",borderRadius:"4px",cursor:E?"not-allowed":"pointer",fontSize:"0.8rem",fontWeight:500,opacity:E?.6:1,display:"flex",alignItems:"center",gap:"0.25rem"},children:d?u.jsx(Vn,{noMargin:!0}):h}),g&&u.jsx("button",{onClick:M,style:{background:"transparent",color:"inherit",border:"none",padding:"0.35rem",borderRadius:"4px",cursor:"pointer",fontSize:"0.9rem",opacity:.6},title:_?"Collapse details":"Expand details",children:_?"":""})]})]}),_&&g&&u.jsx("div",{style:{borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)",padding:"1rem",background:"color-mix(in srgb, currentColor 2%, transparent)"},children:g})]})}function tz({name:t,description:e,onAction:n,actionText:r,actionIcon:i,isRunning:o=!1,disabled:l=!1,progress:d,error:h,isDestructive:m=!1}){const p=l||o,g=()=>{n()};return u.jsx("div",{style:{background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"8px",margin:"0.25rem 0",padding:"0.75rem 1rem"},children:u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},children:[u.jsxs("div",{style:{flex:1,minWidth:0},children:[u.jsx("div",{style:{fontWeight:500,fontSize:"0.95rem",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:t}),u.jsx("div",{style:{fontSize:"0.8rem",opacity:.6,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:e}),h&&u.jsx("div",{style:{fontSize:"0.8rem",color:"#ef4444",marginTop:"0.25rem"},children:h})]}),d!==void 0&&o&&u.jsxs("div",{style:{width:"100px",flexShrink:0},children:[u.jsx("div",{style:{background:"rgba(255, 255, 255, 0.1)",borderRadius:"4px",height:"6px",overflow:"hidden"},children:u.jsx("div",{style:{background:m?"#ef4444":"#646cff",height:"100%",width:`${d}%`,transition:"width 0.3s"}})}),u.jsxs("div",{style:{fontSize:"0.7rem",opacity:.6,textAlign:"center",marginTop:"0.15rem"},children:[d,"%"]})]}),u.jsx("button",{onClick:g,disabled:p,style:{background:m?"#ef4444":"#646cff",color:"white",border:"none",padding:"0.5rem 1rem",borderRadius:"6px",cursor:p?"not-allowed":"pointer",fontSize:"0.85rem",fontWeight:500,opacity:p?.6:1,display:"flex",alignItems:"center",gap:"0.4rem",flexShrink:0},children:o?u.jsxs(u.Fragment,{children:[u.jsx(Vn,{noMargin:!0})," Running..."]}):u.jsxs(u.Fragment,{children:[i&&u.jsx("span",{children:i}),r]})})]})})}function nz({disabled:t,onDownloadBackup:e,isDownloadingBackup:n}){return u.jsx(u.Fragment,{children:u.jsx(W0,{title:"One-Time Migrations",icon:"",description:"Migrations that typically only need to be run once. Check status first, then apply if needed.",type:"onetime",isAnyRunning:!1,children:null})})}const eA={unknown:{color:"#9ca3af",icon:""},clean:{color:"#22c55e",icon:""},"needs-action":{color:"#f59e0b",icon:""},running:{color:"#60a5fa",icon:""},complete:{color:"#22c55e",icon:""},error:{color:"#ef4444",icon:""}};function rz({check:t,disabled:e}){const n=eA[t.status],r=e||t.isRunning||t.isChecking;return u.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"0.5rem 0.75rem",gap:"0.75rem",borderRadius:"6px",background:"color-mix(in srgb, currentColor 3%, transparent)",marginBottom:"0.25rem"},children:[u.jsx("div",{style:{width:"20px",height:"20px",borderRadius:"50%",background:`color-mix(in srgb, ${n.color} 20%, transparent)`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.7rem",flexShrink:0},children:t.isRunning||t.isChecking?u.jsx(Vn,{noMargin:!0}):n.icon}),u.jsxs("div",{style:{flex:1,minWidth:0},children:[u.jsxs("div",{style:{fontWeight:500,fontSize:"0.85rem"},children:[t.name,t.issueCount>0&&u.jsxs("span",{style:{marginLeft:"0.5rem",color:n.color,fontSize:"0.75rem"},children:["(",t.issueCount,")"]})]}),u.jsx("div",{style:{fontSize:"0.75rem",opacity:.6},children:t.description}),t.details]}),u.jsxs("div",{style:{display:"flex",gap:"0.35rem",flexShrink:0},children:[u.jsx("button",{onClick:()=>{`${t.name}`,t.onCheck()},disabled:r,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",padding:"0.25rem 0.4rem",borderRadius:"4px",cursor:r?"not-allowed":"pointer",fontSize:"0.7rem",opacity:r?.5:1},title:"Check",children:t.isChecking?u.jsx(Vn,{noMargin:!0}):""}),t.canFix&&t.onFix&&u.jsx("button",{onClick:()=>{`${t.name}`,t.onFix()},disabled:r,style:{background:"#646cff",color:"white",border:"none",padding:"0.25rem 0.5rem",borderRadius:"4px",cursor:r?"not-allowed":"pointer",fontSize:"0.7rem",fontWeight:500,opacity:r?.6:1},children:t.isRunning?u.jsx(Vn,{noMargin:!0}):"Fix"})]})]})}function sz({accountCategoryValidation:t,orphanedIdCleanup:e,expenseToAdjustment:n,adjustmentsToTransfers:r,needsAction:i,totalIssues:o,isScanning:l,isRunning:d,disabled:h,onRunOrphaned:m,onRunExpense:p,onRunTransfers:g}){const[v,_]=D.useState(!1),x=d?"running":t.hasData&&e.hasData&&n.hasData&&r.hasData?i?"needs-action":"clean":"unknown",S=eA[x],E=[{id:"validation",name:"Account/Category Validation",status:t.isScanning?"running":t.hasData?t.hasViolations?"needs-action":"clean":"unknown",issueCount:t.violationCount,description:"Validates all transactions have proper account/category combinations",canFix:!1,onCheck:()=>t.scan(),isChecking:t.isScanning,isRunning:!1,details:t.hasViolations&&t.status&&u.jsxs("div",{style:{fontSize:"0.8rem",opacity:.8},children:[t.status.violations.filter(M=>M.transactionType==="income").length>0&&u.jsxs("span",{children:["Income: ",t.status.violations.filter(M=>M.transactionType==="income").length," "]}),t.status.violations.filter(M=>M.transactionType==="expense").length>0&&u.jsxs("span",{children:["Expenses: ",t.status.violations.filter(M=>M.transactionType==="expense").length," "]}),t.status.violations.filter(M=>M.transactionType==="adjustment").length>0&&u.jsxs("span",{children:["Adjustments: ",t.status.violations.filter(M=>M.transactionType==="adjustment").length," "]}),t.status.violations.filter(M=>M.transactionType==="transfer").length>0&&u.jsxs("span",{children:["Transfers: ",t.status.violations.filter(M=>M.transactionType==="transfer").length]})]})},{id:"orphaned",name:"Orphaned ID Cleanup",status:Gg(e),issueCount:e.totalOrphaned,description:"Finds transactions with deleted/invalid account/category IDs",canFix:e.hasItemsToFix,onCheck:e.scanStatus,onFix:m,isChecking:e.isScanning,isRunning:e.isRunning,details:e.hasItemsToFix&&e.status&&u.jsxs("div",{style:{fontSize:"0.8rem",opacity:.8},children:[e.status.orphanedCategoryIds>0&&u.jsxs("span",{children:["Categories: ",e.status.orphanedCategoryIds," "]}),e.status.orphanedAccountIds>0&&u.jsxs("span",{children:["Accounts: ",e.status.orphanedAccountIds]})]})},{id:"expense",name:"Expense  Adjustment",status:Gg(n,"hasItemsToMigrate"),issueCount:n.totalToMigrate,description:"Moves expenses without account/category to adjustments",canFix:n.hasItemsToMigrate,onCheck:n.scanStatus,onFix:p,isChecking:n.isScanning,isRunning:n.isRunning,details:n.hasItemsToMigrate&&n.status&&u.jsxs("div",{style:{fontSize:"0.8rem",opacity:.8},children:[n.status.expensesToMigrate," expense(s) with No Account or No Category"]})},{id:"transfers",name:"Adjustment  Transfers",status:Gg(r,"hasPairsToConvert"),issueCount:r.totalPairs,description:"Converts opposite adjustment pairs to transfers",canFix:r.hasPairsToConvert,onCheck:r.scanStatus,onFix:g,isChecking:r.isScanning,isRunning:r.isRunning,details:r.hasPairsToConvert&&r.status&&u.jsxs("div",{style:{fontSize:"0.8rem",opacity:.8},children:[r.status.accountTransferPairs>0&&u.jsxs("span",{children:["Account transfers: ",r.status.accountTransferPairs," "]}),r.status.categoryTransferPairs>0&&u.jsxs("span",{children:["Category transfers: ",r.status.categoryTransferPairs]})]})}],T=h||d||l,I=()=>{E.forEach(M=>M.onCheck())};return u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"8px",margin:"0.25rem 0",overflow:"hidden"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"0.75rem 1rem",gap:"1rem"},children:[u.jsx("div",{style:{width:"28px",height:"28px",borderRadius:"50%",background:`color-mix(in srgb, ${S.color} 20%, transparent)`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.85rem",flexShrink:0},children:d||l?u.jsx(Vn,{noMargin:!0}):S.icon}),u.jsxs("div",{style:{flex:1,minWidth:0},children:[u.jsx("div",{style:{fontWeight:500,fontSize:"0.95rem",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:"Transaction Type Audit"}),u.jsx("div",{style:{fontSize:"0.8rem",opacity:.6,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:"Validates account/category assignments and fixes invalid transactions"})]}),u.jsxs("div",{style:{color:S.color,fontSize:"0.8rem",fontWeight:500,display:"flex",alignItems:"center",gap:"0.25rem",flexShrink:0},children:[x==="unknown"?"Unknown":x==="clean"?"Clean":x==="running"?"Running":"Needs Action",o>0&&u.jsx("span",{style:{background:`color-mix(in srgb, ${S.color} 20%, transparent)`,padding:"0.15rem 0.4rem",borderRadius:"4px",fontSize:"0.75rem"},children:o})]}),u.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:[u.jsx("button",{onClick:I,disabled:T,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",padding:"0.35rem 0.6rem",borderRadius:"4px",cursor:T?"not-allowed":"pointer",fontSize:"0.8rem",opacity:T?.5:1,display:"flex",alignItems:"center",gap:"0.25rem"},title:"Check all",children:l?u.jsx(Vn,{noMargin:!0}):""}),u.jsx("button",{onClick:()=>_(!v),style:{background:"transparent",color:"inherit",border:"none",padding:"0.35rem",borderRadius:"4px",cursor:"pointer",fontSize:"0.9rem",opacity:.6},title:v?"Collapse":"Expand",children:v?"":""})]})]}),v&&u.jsx("div",{style:{borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)",padding:"0.5rem",background:"color-mix(in srgb, currentColor 2%, transparent)"},children:E.map(M=>u.jsx(rz,{check:M,disabled:h},M.id))})]})}function Gg(t,e="hasItemsToFix"){return t.isRunning?"running":t.result&&t.result.errors.length===0?"complete":t.isScanning?"running":t.hasData?t[e]?"needs-action":"clean":"unknown"}function iz({status:t,hasData:e,hasIssues:n,totalIssues:r,isChecking:i,isRunning:o,result:l,onCheck:d,onRun:h,disabled:m}){const p=()=>o?"running":e?l&&l.errors.length===0?"complete":l&&l.errors.length>0?"error":n?"needs-action":"clean":"unknown",g=()=>{if(l&&l.errors.length===0){const _=l.accountsFixed+l.categoriesFixed+l.totalAvailableFixed+l.incomeValuesFixed+l.expenseValuesFixed+l.categoryBalancesFixed+l.accountBalancesFixed;return _>0?`Fixed ${_}`:"Complete"}},v=()=>{if(l){const _=l.accountsFixed+l.categoriesFixed+l.totalAvailableFixed+l.incomeValuesFixed+l.expenseValuesFixed+l.categoryBalancesFixed+l.accountBalancesFixed;return u.jsxs("div",{style:{fontSize:"0.85rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem",fontWeight:500},children:l.errors.length>0?" Completed with errors":" Cleanup complete"}),u.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[l.budgetsProcessed>0&&u.jsxs("li",{children:[l.budgetsProcessed," budget(s) updated"]}),l.accountsFixed>0&&u.jsxs("li",{children:[l.accountsFixed," account balance(s) fixed"]}),l.categoriesFixed>0&&u.jsxs("li",{children:[l.categoriesFixed," category value(s) fixed"]}),l.totalAvailableFixed>0&&u.jsxs("li",{children:[l.totalAvailableFixed," total_available value(s) fixed"]}),l.monthsProcessed>0&&u.jsxs("li",{children:[l.monthsProcessed," month(s) updated"]}),l.incomeValuesFixed>0&&u.jsxs("li",{children:[l.incomeValuesFixed," income amount(s) fixed"]}),l.expenseValuesFixed>0&&u.jsxs("li",{children:[l.expenseValuesFixed," expense amount(s) fixed"]}),l.categoryBalancesFixed>0&&u.jsxs("li",{children:[l.categoryBalancesFixed," category balance(s) fixed"]}),l.accountBalancesFixed>0&&u.jsxs("li",{children:[l.accountBalancesFixed," account balance(s) fixed"]}),_===0&&u.jsx("li",{children:"No changes needed"})]}),l.errors.length>0&&u.jsxs("div",{style:{marginTop:"0.5rem",color:"#ef4444"},children:[u.jsxs("div",{children:["Errors (",l.errors.length,"):"]}),u.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1.25rem"},children:[l.errors.slice(0,3).map((C,x)=>u.jsx("li",{children:C},x)),l.errors.length>3&&u.jsxs("li",{children:["...and ",l.errors.length-3," more"]})]})]})]})}return e?n?u.jsxs("div",{style:{fontSize:"0.85rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem",color:"#fbbf24"},children:"Precision issues found:"}),u.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[t.budgetsWithPrecisionIssues>0&&u.jsxs("li",{children:[t.budgetsWithPrecisionIssues," budget(s) with issues:",u.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1rem",opacity:.8},children:[t.accountsWithPrecisionIssues>0&&u.jsxs("li",{children:[t.accountsWithPrecisionIssues," account balance(s)"]}),t.categoriesWithPrecisionIssues>0&&u.jsxs("li",{children:[t.categoriesWithPrecisionIssues," category value(s)"]}),t.totalAvailableWithPrecisionIssues>0&&u.jsxs("li",{children:[t.totalAvailableWithPrecisionIssues," total_available value(s)"]})]})]}),t.monthsWithPrecisionIssues>0&&u.jsxs("li",{children:[t.monthsWithPrecisionIssues," month(s) with issues:",u.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1rem",opacity:.8},children:[t.incomeValuesWithPrecisionIssues>0&&u.jsxs("li",{children:[t.incomeValuesWithPrecisionIssues," income amount(s)"]}),t.expenseValuesWithPrecisionIssues>0&&u.jsxs("li",{children:[t.expenseValuesWithPrecisionIssues," expense amount(s)"]}),t.categoryBalancesWithPrecisionIssues>0&&u.jsxs("li",{children:[t.categoryBalancesWithPrecisionIssues," category balance(s)"]}),t.accountBalancesWithPrecisionIssues>0&&u.jsxs("li",{children:[t.accountBalancesWithPrecisionIssues," account balance(s)"]})]})]})]}),u.jsxs("div",{style:{marginTop:"0.5rem",opacity:.6},children:["Scanned ",t.totalBudgets," budget(s) and ",t.totalMonths," month(s)."]})]}):u.jsxs("div",{style:{fontSize:"0.85rem"},children:[" All currency values have proper precision (2 decimal places).",u.jsxs("div",{style:{marginTop:"0.25rem",opacity:.6},children:["Scanned ",t.totalBudgets," budget(s) and ",t.totalMonths," month(s)."]})]}):u.jsx("div",{style:{fontSize:"0.85rem",opacity:.7},children:"Click check to scan for precision issues."})};return u.jsx(K0,{name:"Currency Precision",description:"Fixes floating-point precision by rounding all values to 2 decimal places",status:p(),statusText:g(),onCheck:d,isChecking:i,onRun:h,isRunning:o,actionText:`Fix ${r}`,disabled:m,itemCount:n?r:void 0,details:v(),isDestructive:!0})}function az({disabled:t,onDownloadBackup:e,isDownloadingBackup:n,accountCategoryValidation:r,orphanedIdCleanup:i,expenseToAdjustment:o,adjustmentsToTransfers:l,precisionCleanup:d}){const h=r.isScanning||i.isScanning||o.isScanning||l.isScanning||d.isScanning,m=i.isRunning||o.isRunning||l.isRunning||d.isRunning,p=async()=>{await Promise.all([r.scan(),i.scanStatus(),o.scanStatus(),l.scanStatus(),d.scan()])},g=So({migrationName:"Orphaned ID Cleanup",isDestructive:!0,onDownloadBackup:e}),v=So({migrationName:"Expense to Adjustment Migration",isDestructive:!0,onDownloadBackup:e}),_=So({migrationName:"Adjustments to Transfers Migration",isDestructive:!0,onDownloadBackup:e}),C=So({migrationName:"Currency Precision Cleanup",isDestructive:!0,onDownloadBackup:e}),x=r.hasViolations||i.hasItemsToFix||o.hasItemsToMigrate||l.hasPairsToConvert,S=(r.violationCount||0)+(i.totalOrphaned||0)+(o.totalToMigrate||0)+(l.totalPairs||0);return u.jsxs(u.Fragment,{children:[u.jsxs(W0,{title:"Maintenance",icon:"",description:"Re-runnable database validation scripts. Validate all to see which need resolution.",type:"maintenance",onValidateAll:p,isValidating:h,isAnyRunning:m,children:[u.jsx(sz,{accountCategoryValidation:r,orphanedIdCleanup:i,expenseToAdjustment:o,adjustmentsToTransfers:l,needsAction:x,totalIssues:S,isScanning:r.isScanning||i.isScanning||o.isScanning||l.isScanning,isRunning:i.isRunning||o.isRunning||l.isRunning,disabled:t,onRunOrphaned:()=>g.promptBeforeAction(i.runMigration),onRunExpense:()=>v.promptBeforeAction(o.runMigration),onRunTransfers:()=>_.promptBeforeAction(l.runMigration)}),u.jsx(iz,{status:d.status,hasData:d.hasData,hasIssues:d.hasIssues,totalIssues:d.totalIssues,isChecking:d.isScanning,isRunning:d.isRunning,result:d.result,onCheck:d.scan,onRun:()=>C.promptBeforeAction(d.runCleanup),disabled:t})]}),u.jsx(wo,{...g.promptProps,isDownloading:n}),u.jsx(wo,{...v.promptProps,isDownloading:n}),u.jsx(wo,{..._.promptProps,isDownloading:n}),u.jsx(wo,{...C.promptProps,isDownloading:n})]})}function oz({isDownloading:t,downloadProgress:e,downloadError:n,onDownload:r,isScanning:i,isUploading:o,uploadStatus:l,uploadProgress:d,uploadError:h,uploadResult:m,onScan:p,onUpload:g,disabled:v}){const _=D.useRef(null),[C,x]=D.useState(null),[S,E]=D.useState(!1),T=async q=>{const j=q.target.files?.[0];j&&(x(j),await p(j))},I=l!==null,M=I&&(l.budgetsFound>0||l.monthsFound>0),L=v||t||i||o,$=m?.success?"#22c55e":M?"#f59e0b":I?"#22c55e":"#9ca3af",k=m?.success?"":o||i||t?"":M?"":I?"":"",A=m?.success?"Uploaded":o?"Uploading":i?"Scanning":t?"Downloading":M?`${l.budgetsFound} budget(s), ${l.monthsFound} month(s) ready`:I?"Nothing to upload":"Select file",N=t?e?.percentComplete:d?.percentComplete,F=n||h;return u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"8px",margin:"0.25rem 0",overflow:"hidden"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"0.75rem 1rem",gap:"1rem"},children:[u.jsx("div",{style:{width:"28px",height:"28px",borderRadius:"50%",background:`color-mix(in srgb, ${$} 20%, transparent)`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.85rem",flexShrink:0},children:o||i||t?u.jsx(Vn,{noMargin:!0}):k}),u.jsxs("div",{style:{flex:1,minWidth:0},children:[u.jsx("div",{style:{fontWeight:500,fontSize:"0.95rem",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:" Budget Backup & Restore"}),u.jsx("div",{style:{fontSize:"0.8rem",opacity:.6,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:"Download selected budget as zip or restore from zip file"})]}),u.jsx("div",{style:{color:$,fontSize:"0.8rem",fontWeight:500,flexShrink:0},children:A}),u.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:[u.jsx("button",{onClick:()=>{r()},disabled:L,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",padding:"0.35rem 0.6rem",borderRadius:"4px",cursor:L?"not-allowed":"pointer",fontSize:"0.8rem",opacity:L?.5:1,display:"flex",alignItems:"center",gap:"0.25rem"},title:"Download all budgets as zip",children:t?u.jsx(Vn,{noMargin:!0}):""}),u.jsx("input",{ref:_,type:"file",accept:".zip",onChange:T,style:{display:"none"}}),u.jsx("button",{onClick:()=>_.current?.click(),disabled:L,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",padding:"0.35rem 0.6rem",borderRadius:"4px",cursor:L?"not-allowed":"pointer",fontSize:"0.8rem",opacity:L?.5:1,display:"flex",alignItems:"center",gap:"0.25rem"},title:"Select zip file to restore",children:i?u.jsx(Vn,{noMargin:!0}):""}),M&&C&&u.jsx("button",{onClick:async()=>{await g(C)},disabled:L,style:{background:"#646cff",color:"white",border:"none",padding:"0.35rem 0.75rem",borderRadius:"4px",cursor:L?"not-allowed":"pointer",fontSize:"0.8rem",fontWeight:500,opacity:L?.6:1,display:"flex",alignItems:"center",gap:"0.25rem"},children:o?u.jsx(Vn,{noMargin:!0}):"Upload"}),(I||m||F)&&u.jsx("button",{onClick:()=>E(!S),style:{background:"transparent",color:"inherit",border:"none",padding:"0.35rem",borderRadius:"4px",cursor:"pointer",fontSize:"0.9rem",opacity:.6},title:S?"Collapse":"Expand",children:S?"":""})]})]}),(t||o)&&N!==void 0&&u.jsxs("div",{style:{padding:"0 1rem 0.5rem 1rem"},children:[u.jsx("div",{style:{width:"100%",height:"4px",background:"color-mix(in srgb, currentColor 10%, transparent)",borderRadius:"2px",overflow:"hidden"},children:u.jsx("div",{style:{width:`${N}%`,height:"100%",background:"#646cff",transition:"width 0.3s ease"}})}),u.jsxs("div",{style:{fontSize:"0.75rem",opacity:.6,marginTop:"0.25rem",textAlign:"center"},children:[t?e?.phase:d?.phase,": ",N,"%"]})]}),S&&(I||m||F)&&u.jsxs("div",{style:{borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)",padding:"1rem",background:"color-mix(in srgb, currentColor 2%, transparent)",fontSize:"0.85rem"},children:[F&&u.jsxs("div",{style:{marginBottom:"0.75rem",color:"#ef4444"},children:[" Error: ",F]}),m&&u.jsx("div",{style:{marginBottom:l?"0.75rem":0,color:m.success?"#22c55e":"#ef4444"},children:m.success?u.jsxs(u.Fragment,{children:[" Restored ",m.budgetsRestored," budget(s), ",m.monthsRestored," month(s), ",m.payeesRestored," payee doc(s)"]}):u.jsxs(u.Fragment,{children:[" Upload failed: ",m.errors.join(", ")]})}),l&&u.jsxs(u.Fragment,{children:[u.jsxs("div",{style:{marginBottom:"0.25rem"},children:[u.jsx("strong",{children:"Found in zip:"})," ",l.budgetsFound," budget(s), ",l.monthsFound," month(s), ",l.payeesFound," payee doc(s)"]}),l.budgetsToRestore.length>0&&u.jsxs("div",{children:[u.jsx("strong",{children:"Budgets to restore:"})," ",l.budgetsToRestore.join(", ")]})]})]})]})}function lz({hasData:t,monthsCount:e,budgetCount:n,isChecking:r,isDeleting:i,deleteResult:o,onCheck:l,onDelete:d,disabled:h}){const[m,p]=D.useState(!1),g=()=>i?"running":t?o&&o.errors.length===0?"complete":e===0?"clean":"needs-action":"unknown",v=()=>o&&o.errors.length===0?`Deleted ${o.deleted}`:e===0?"No months":`${e} months`,_=()=>{p(!0)},C=()=>{p(!1),d()},x=()=>o?u.jsxs("div",{style:{fontSize:"0.85rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem",fontWeight:500},children:o.errors.length>0?" Completed with errors":" Deletion complete"}),u.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[u.jsxs("li",{children:[o.deleted," month(s) deleted"]}),o.budgetsRecalculated>0&&u.jsxs("li",{children:[o.budgetsRecalculated," budget(s) reset"]})]}),o.errors.length>0&&u.jsxs("div",{style:{marginTop:"0.5rem",color:"#ef4444"},children:[u.jsxs("div",{children:["Errors (",o.errors.length,"):"]}),u.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1.25rem"},children:[o.errors.slice(0,3).map((S,E)=>u.jsx("li",{children:S},E)),o.errors.length>3&&u.jsxs("li",{children:["...and ",o.errors.length-3," more"]})]})]})]}):t?e===0?u.jsx("div",{style:{fontSize:"0.85rem"},children:" No month documents found in Firebase."}):u.jsxs("div",{style:{fontSize:"0.85rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem",color:"#ef4444"},children:" DESTRUCTIVE ACTION"}),u.jsxs("div",{children:["Found ",e," month(s) across ",n," budget(s)."]}),u.jsx("div",{style:{marginTop:"0.5rem",opacity:.7},children:"This will permanently delete ALL month documents and reset all budgets."})]}):u.jsx("div",{style:{fontSize:"0.85rem",opacity:.7},children:"Click check to scan for months."});return u.jsxs(u.Fragment,{children:[u.jsx(K0,{name:"Delete ALL Months",description:"DESTRUCTIVE: Deletes all month documents from all budgets",status:g(),statusText:v(),onCheck:l,isChecking:r,onRun:e>0?_:void 0,isRunning:i,actionText:"Delete",disabled:h,itemCount:e>0?e:void 0,details:x(),isDestructive:!0}),u.jsxs(cs,{isOpen:m,onClose:()=>p(!1),title:" Delete All Months?",children:[u.jsx("div",{style:{background:"color-mix(in srgb, #ef4444 15%, transparent)",border:"1px solid color-mix(in srgb, #ef4444 40%, transparent)",borderRadius:"8px",padding:"1rem",marginBottom:"1rem"},children:u.jsx("p",{style:{margin:0,color:"#fca5a5",fontWeight:500,fontSize:"0.95rem"},children:" This is a destructive operation that cannot be undone!"})}),u.jsxs("p",{style:{margin:"0 0 0.75rem",opacity:.9},children:["This will permanently delete ",u.jsxs("strong",{style:{color:"#ef4444"},children:[e," month(s)"]})," across"," ",u.jsxs("strong",{style:{color:"#ef4444"},children:[n," budget(s)"]}),"."]}),u.jsxs("ul",{style:{margin:"0 0 1.5rem",paddingLeft:"1.5rem",opacity:.8,fontSize:"0.9rem"},children:[u.jsx("li",{children:"All account balances  $0"}),u.jsx("li",{children:"All category balances  $0"}),u.jsx("li",{children:"Month history cleared"})]}),u.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[u.jsx(Ve,{variant:"secondary",actionName:"Cancel Delete All Months",onClick:()=>p(!1),children:"Cancel"}),u.jsxs(Ve,{variant:"danger",actionName:"Confirm Delete All Months",onClick:C,children:[" Delete All ",e," Months"]})]})]})]})}function cz({status:t,hasData:e,totalBudgets:n,totalMonths:r,isChecking:i,isDeleting:o,deleteResult:l,onCheck:d,onDelete:h,disabled:m}){const[p,g]=D.useState(!1),v=t?.staleBudgetIds??[],_=v.length>0,C=()=>o?"running":e?l&&l.errors.length===0?"complete":n===0&&!_?"clean":"needs-action":"unknown",x=()=>l&&l.errors.length===0?`Deleted ${l.budgetsDeleted}`:n===0&&!_?"Clean":_?`${v.length} stale ref(s)`:`${n} budget(s)`,S=()=>{g(!0)},E=()=>{g(!1),h()},T=()=>l?u.jsxs("div",{style:{fontSize:"0.85rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem",fontWeight:500},children:l.errors.length>0?" Completed with errors":" Deletion complete"}),u.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[l.budgetsDeleted>0&&u.jsxs("li",{children:[l.budgetsDeleted," budget(s) deleted"]}),l.monthsDeleted>0&&u.jsxs("li",{children:[l.monthsDeleted," month(s) deleted"]}),l.payeesDeleted>0&&u.jsxs("li",{children:[l.payeesDeleted," payee doc(s) deleted"]})]}),l.errors.length>0&&u.jsxs("div",{style:{marginTop:"0.5rem",color:"#ef4444"},children:[u.jsxs("div",{children:["Errors (",l.errors.length,"):"]}),u.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1.25rem"},children:[l.errors.slice(0,3).map((M,L)=>u.jsx("li",{children:M},L)),l.errors.length>3&&u.jsxs("li",{children:["...and ",l.errors.length-3," more"]})]})]})]}):e?n===0&&!_?u.jsx("div",{style:{fontSize:"0.85rem"},children:' No budget found for sample@sample.com  user is in "new user" state.'}):_?u.jsxs("div",{style:{fontSize:"0.85rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem",color:"#f59e0b"},children:" Found stale budget references:"}),u.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[v.slice(0,3).map(M=>u.jsx("li",{style:{opacity:.8},children:M},M)),v.length>3&&u.jsxs("li",{style:{opacity:.6},children:["...and ",v.length-3," more"]})]})]}):u.jsxs("div",{style:{fontSize:"0.85rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem",color:"#f59e0b"},children:" Sample user budget found:"}),u.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[u.jsxs("li",{children:[n," budget(s)"]}),u.jsxs("li",{children:[r," month(s)"]})]}),u.jsx("div",{style:{marginTop:"0.5rem",opacity:.7},children:"Deleting will reset sample@sample.com to a new user state."})]}):u.jsx("div",{style:{fontSize:"0.85rem",opacity:.7},children:"Click check to scan for sample user budget."}),I=n>0||_;return u.jsxs(u.Fragment,{children:[u.jsx(K0,{name:"Delete Sample User Budget",description:"Reset sample@sample.com to new user state",status:C(),statusText:x(),onCheck:d,isChecking:i,onRun:I?S:void 0,isRunning:o,actionText:"Delete",disabled:m,itemCount:I?n||v.length:void 0,details:T(),isDestructive:!0}),u.jsxs(cs,{isOpen:p,onClose:()=>g(!1),title:" Delete Sample User Budget?",children:[u.jsx("div",{style:{background:"color-mix(in srgb, #f59e0b 15%, transparent)",border:"1px solid color-mix(in srgb, #f59e0b 40%, transparent)",borderRadius:"8px",padding:"1rem",marginBottom:"1rem"},children:u.jsx("p",{style:{margin:0,color:"#fcd34d",fontWeight:500,fontSize:"0.95rem"},children:" This will delete all data for sample@sample.com!"})}),n>0&&u.jsxs("p",{style:{margin:"0 0 0.75rem",opacity:.9},children:["This will permanently delete ",u.jsxs("strong",{style:{color:"#f59e0b"},children:[n," budget(s)"]})," and"," ",u.jsxs("strong",{style:{color:"#f59e0b"},children:[r," month(s)"]}),"."]}),_&&u.jsxs("p",{style:{margin:"0 0 0.75rem",opacity:.9},children:["This will remove ",u.jsxs("strong",{style:{color:"#f59e0b"},children:[v.length," stale reference(s)"]})," from the user document."]}),u.jsxs("ul",{style:{margin:"0 0 1.5rem",paddingLeft:"1.5rem",opacity:.8,fontSize:"0.9rem"},children:[u.jsx("li",{children:"Budget document deleted"}),u.jsx("li",{children:"All month documents deleted"}),u.jsx("li",{children:"Payees document deleted"}),u.jsx("li",{children:"User will see onboarding flow"})]}),u.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[u.jsx(Ve,{variant:"secondary",actionName:"Cancel Delete Sample User Budget",onClick:()=>g(!1),children:"Cancel"}),u.jsx(Ve,{variant:"danger",actionName:"Confirm Delete Sample User Budget",onClick:E,children:" Delete Sample User Data"})]})]})]})}function uz({onClearCache:t,disabled:e}){const[n,r]=D.useState(!1),i=()=>{r(!0)},o=()=>{r(!1),t()};return u.jsxs(u.Fragment,{children:[u.jsx(tz,{name:"Clear All Caches",description:"Clear cached data and reload to fetch fresh data from Firestore",onAction:i,actionText:"Clear & Reload",actionIcon:"",disabled:e,isDestructive:!0}),u.jsxs(cs,{isOpen:n,onClose:()=>r(!1),title:"Clear Caches & Reload?",children:[u.jsx("p",{style:{margin:"0 0 1rem 0",opacity:.8},children:"This will clear all cached data and reload the page. The app will fetch fresh data from Firestore for everything."}),u.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[u.jsx(Ve,{variant:"secondary",actionName:"Cancel Clear Caches",onClick:()=>r(!1),children:"Cancel"}),u.jsx(Ve,{variant:"danger",actionName:"Confirm Clear Caches & Reload",onClick:o,children:"Clear & Reload"})]})]})]})}function dz({disabled:t,onDownloadBackup:e,isDownloadingBackup:n,budgetDownloadUpload:r,deleteAllMonths:i,deleteSampleUserBudget:o,onClearCache:l}){const d=r.isDownloading||r.isUploading||i.isDeleting||o.isDeleting,h=So({migrationName:"Delete All Months",isDestructive:!0,onDownloadBackup:e}),m=So({migrationName:"Delete Sample User Budget",isDestructive:!0,onDownloadBackup:e}),p=So({migrationName:"Upload Budget",isDestructive:!0,onDownloadBackup:e});return u.jsxs(u.Fragment,{children:[u.jsxs(W0,{title:"Utilities",icon:"",description:"Administrative utilities for data management, downloads, and cache control.",type:"utility",isAnyRunning:d,children:[u.jsx(oz,{isDownloading:r.isDownloading,downloadProgress:r.downloadProgress,downloadError:r.downloadError,onDownload:r.downloadBudget,isScanning:r.isScanning,isUploading:r.isUploading,uploadStatus:r.uploadStatus,uploadProgress:r.uploadProgress,uploadError:r.uploadError,uploadResult:r.uploadResult,onScan:r.scanZipFile,onUpload:async g=>{p.promptBeforeAction(()=>{r.uploadBudget(g).catch(v=>console.error("Upload failed:",v))})},disabled:t}),u.jsxs("div",{style:{marginTop:"0.75rem",paddingTop:"0.75rem",borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},children:[u.jsx("div",{style:{fontSize:"0.75rem",opacity:.5,textTransform:"uppercase",letterSpacing:"0.05em",marginBottom:"0.5rem",paddingLeft:"0.5rem"},children:"Destructive Actions"}),u.jsx(lz,{status:i.status,hasData:i.hasData,monthsCount:i.monthsCount,budgetCount:i.budgetCount,isChecking:i.isScanning,isDeleting:i.isDeleting,deleteResult:i.deleteResult,deleteProgress:i.deleteProgress,onCheck:i.scanStatus,onDelete:()=>h.promptBeforeAction(i.deleteAllMonths),disabled:t}),u.jsx(cz,{status:o.status,hasData:o.hasData,totalBudgets:o.totalBudgets,totalMonths:o.totalMonths,isChecking:o.isScanning,isDeleting:o.isDeleting,deleteResult:o.deleteResult,deleteProgress:o.deleteProgress,onCheck:o.scanStatus,onDelete:()=>m.promptBeforeAction(o.deleteSampleUserBudget),disabled:t}),u.jsx(uz,{onClearCache:l,disabled:t})]})]}),u.jsx(wo,{...h.promptProps,isDownloading:n}),u.jsx(wo,{...m.promptProps,isDownloading:n}),u.jsx(wo,{...p.promptProps,isDownloading:n})]})}function Y0({message:t="Loading...",spinnerColor:e=me.primary,children:n,spinnerSize:r=4}){return u.jsxs("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(15, 15, 20, 0.95)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",zIndex:9999,gap:"1.5rem",backdropFilter:"blur(4px)"},children:[u.jsx("div",{style:{width:`${r}rem`,height:`${r}rem`,border:"3px solid rgba(255, 255, 255, 0.15)",borderTopColor:e,borderRadius:"50%",animation:"loadingOverlaySpin 0.8s linear infinite"}}),u.jsx("p",{style:{color:"rgba(255, 255, 255, 0.95)",fontSize:"1.2rem",fontWeight:600,letterSpacing:"0.02em",margin:0},children:t}),n,u.jsx("style",{children:`
        @keyframes loadingOverlaySpin {
          to { transform: rotate(360deg); }
        }
      `})]})}function tA({percent:t,gradient:e="linear-gradient(90deg, #646cff, #8b5cf6)",width:n=300}){return u.jsx("div",{style:{width:`${n}px`,height:"8px",background:"rgba(255, 255, 255, 0.1)",borderRadius:"4px",overflow:"hidden"},children:u.jsx("div",{style:{width:`${t}%`,height:"100%",background:e,borderRadius:"4px",transition:"width 0.3s ease-out"}})})}function Mf({value:t,label:e,color:n="#646cff"}){return u.jsxs("div",{style:{textAlign:"center"},children:[u.jsx("p",{style:{color:n,fontSize:"1.5rem",fontWeight:700,margin:0},children:t}),u.jsx("p",{style:{color:"rgba(255, 255, 255, 0.6)",fontSize:"0.8rem",margin:"0.25rem 0 0",textTransform:"uppercase",letterSpacing:"0.05em"},children:e})]})}function nA({percent:t}){return u.jsxs("p",{style:{color:"rgba(255, 255, 255, 0.5)",fontSize:"0.9rem",margin:0},children:[t,"% complete"]})}function hz(){return u.jsxs("div",{style:Rf,children:[u.jsx("nav",{style:{marginBottom:"1rem",display:"flex",alignItems:"center"},children:u.jsx(Tn,{to:"/",style:{display:"flex",alignItems:"center"},title:"Tarron Lane Home",children:u.jsx("img",{src:"/t-icon.svg",alt:"Tarron Lane Home",style:{width:"2rem",height:"2rem"}})})}),u.jsx("h1",{children:"Tarron Lane Homepage"}),u.jsx("nav",{children:u.jsxs("ul",{children:[u.jsx("li",{children:u.jsx(Tn,{to:"/sql-test",children:"SQL Test"})}),u.jsx("li",{children:u.jsx(Tn,{to:"/budget",children:"Budget"})}),u.jsx("li",{children:u.jsx(Tn,{to:"/account",children:"Account"})})]})})]})}function fz(){const t=D.useContext(cd),e=Oa(),[n,r]=D.useState(!1),i=Mn(),o=Gu(),l=i.state?.from||"/";D.useEffect(()=>{t.is_logged_in&&l!=="/"&&o(l,{replace:!0})},[t.is_logged_in,l,o]);function d(){r(!0),e.logout_firebase_user().then(function(){Ue.clear(),window.location.href="/"})}return u.jsxs("div",{style:Rf,children:[u.jsxs("nav",{style:{marginBottom:"1rem",display:"grid",gridTemplateColumns:"1fr auto 1fr",alignItems:"center"},children:[u.jsx("div",{style:{display:"flex",alignItems:"center"},children:u.jsx(Tn,{to:"/",style:{opacity:.6,fontSize:"1.5rem",textDecoration:"none",padding:"0.25rem 0.5rem"},title:"Back to Home",children:""})}),u.jsxs(Tn,{to:"/",style:{display:"flex",alignItems:"center",gap:"0.5rem",textDecoration:"none",color:"inherit"},title:"Tarron Lane Home",children:[u.jsx("img",{src:"/t-icon.svg",alt:"Tarron Lane",style:{width:"1.5rem",height:"1.5rem"}}),u.jsx("span",{style:{fontWeight:600,fontSize:"1.1rem"},children:"Account"})]}),u.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:u.jsx(QT,{items:[{label:"Budget",icon:"",to:"/budget"},{label:"Account",icon:"",to:"/account"}]})})]}),u.jsx("h1",{children:"Account"}),t.is_logged_in?n?u.jsx("p",{children:"Logging Out..."}):u.jsxs(u.Fragment,{children:[u.jsxs("p",{children:["You are logged in as ",t.username]}),u.jsx("button",{onClick:d,style:{marginTop:"1rem"},children:"Logout"})]}):u.jsx(mz,{})]})}function mz(){const t=Oa(),[e,n]=D.useState(""),[r,i]=D.useState(""),[o,l]=D.useState(!1),[d,h]=D.useState(!1),[m,p]=D.useState("");function g(C){n(C.target.value)}function v(C){i(C.target.value)}function _(C){C.preventDefault(),h(!0),p(""),Ue.clear(),t.login_firebase_user(e,r).then(function(){}).catch(function(){p("Incorrect login credentials")}).finally(function(){h(!1)})}return u.jsxs("form",{onSubmit:_,children:[u.jsxs("div",{children:[u.jsx("label",{htmlFor:"username",children:"Email: "}),u.jsx("input",{id:"username",type:"email",value:e,onChange:g})]}),u.jsxs("div",{children:[u.jsx("label",{htmlFor:"password",children:"Password: "}),u.jsxs("div",{style:{display:"inline-flex",alignItems:"center",position:"relative"},children:[u.jsx("input",{id:"password",type:o?"text":"password",value:r,onChange:v,style:{paddingRight:"2rem"}}),u.jsx("button",{type:"button",onClick:()=>l(!o),style:{position:"absolute",right:"0.25rem",background:"none",border:"none",cursor:"pointer",padding:"0.25rem",opacity:.6,fontSize:"1rem"},title:o?"Hide password":"Show password",children:o?"":""})]})]}),d?u.jsx("p",{children:"Logging in..."}):u.jsx("button",{children:"Login"}),m&&u.jsx("p",{style:{color:"red"},children:m})]})}const pz={categories:"balances",accounts:"balances",income:"transactions",spend:"transactions",transfers:"transactions",adjustments:"transactions"},gz={balances:"categories",transactions:"income"};function yz({activeTab:t,setActiveTab:e,allocationsFinalized:n}){const r=pz[t],i=D.useMemo(()=>[{id:"balances",label:"Balances"},{id:"transactions",label:"Transactions"}],[]),o=D.useMemo(()=>[{id:"categories",label:"Categories",checkmark:n},{id:"accounts",label:"Accounts"}],[n]),l=D.useMemo(()=>[{id:"income",label:"Income"},{id:"spend",label:"Spend"},{id:"transfers",label:"Transfers"},{id:"adjustments",label:"Adjustments"}],[]),d=m=>{e(gz[m])},h=r==="balances"?o:l;return u.jsxs("div",{children:[u.jsx(Df,{mode:"button",tabs:i,activeTab:r,onTabChange:d,variant:"segmented"}),u.jsx(Df,{mode:"button",tabs:h,activeTab:t,onTabChange:m=>e(m),variant:"secondary"})]})}function _z({isOpen:t,onClose:e,onProceed:n,results:r}){const[i,o]=D.useState("from_current"),l=!r||r.status==="confirming",d=r&&!["confirming","done","error"].includes(r.status),h=l||r?.status==="done"||r?.status==="error";function m(){h&&(e(),o("from_current"))}function p(){n(i)}return u.jsx(cs,{isOpen:t,onClose:m,title:"Recalculate Balances",width:"540px",children:u.jsxs("div",{style:{padding:"0.5rem 0"},children:[l&&u.jsxs(u.Fragment,{children:[u.jsx("p",{style:{margin:"0 0 1rem 0",fontSize:"0.95rem",lineHeight:1.5},children:"Choose what to recalculate:"}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem",marginBottom:"1.5rem"},children:[u.jsx(F1,{selected:i==="from_current",onClick:()=>o("from_current"),title:"From current month forward",description:"Recalculate from this month onward. Use for quick fixes."}),u.jsx(F1,{selected:i==="all_months",onClick:()=>o("all_months"),title:"All months from beginning",description:"Recalculate entire history. Use after migrations or data repairs.",recommended:!0})]}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem",marginBottom:"1.5rem"},children:[u.jsx(Al,{status:"waiting",label:"Find all months to process"}),u.jsx(Al,{status:"waiting",label:"Process months"}),u.jsx(Al,{status:"waiting",label:"Update budget totals"})]}),u.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[u.jsx(Ve,{variant:"secondary",actionName:"Cancel Recalculation",onClick:e,children:"Cancel"}),u.jsx(Ve,{actionName:"Proceed with Recalculation",onClick:p,children:"Proceed"})]})]}),!l&&u.jsxs(u.Fragment,{children:[u.jsx("p",{style:{margin:"0 0 1.5rem 0",fontSize:"0.9rem",opacity:.7},children:"Recalculating category balances and account balances..."}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:[u.jsx(Al,{status:r?.status==="pending"?"waiting":"complete",label:"Find all months to process",detail:r&&r.status!=="pending"?`Found ${r.monthsFound||0} month${r.monthsFound!==1?"s":""}`:void 0}),u.jsx(Al,{status:U1(r?.status,["pending","finding_months"],"processing_months"),label:"Process months",detail:r?.status==="processing_months"?`Processing: ${r.currentMonthLabel} (${(r.currentMonthIndex||0)+1}/${r.monthsFound||0})`:r?.monthsProcessed!==void 0?`Processed ${r.monthsProcessed} month${r.monthsProcessed!==1?"s":""}`:void 0}),u.jsx(Al,{status:r?.status==="error"?"error":U1(r?.status,["pending","finding_months","processing_months"],"updating_budget"),label:"Update budget totals",detail:r?.status==="error"?r.error:void 0,isError:r?.status==="error"})]}),r?.status==="done"&&u.jsxs("div",{style:{marginTop:"1.5rem",padding:"1rem",background:`color-mix(in srgb, ${me.success} 10%, transparent)`,border:`1px solid ${me.success}`,borderRadius:"8px",textAlign:"center"},children:[u.jsx("p",{style:{margin:0,fontWeight:600,color:me.success},children:" Recalculation complete!"}),u.jsxs("p",{style:{margin:"0.5rem 0 0 0",fontSize:"0.9rem",opacity:.8},children:[r.monthsProcessed," month",r.monthsProcessed!==1?"s":""," processed",u.jsx("br",{}),"Total Income: ",qe(r.totalIncomeRecalculated||0),u.jsx("br",{}),"Total Expenses: ",qe(r.totalExpensesRecalculated||0)]})]}),(r?.status==="done"||r?.status==="error")&&u.jsx("div",{style:{marginTop:"1.5rem",display:"flex",justifyContent:"center"},children:u.jsx(Ve,{actionName:"Close Recalculation Modal",onClick:e,children:"Done"})}),d&&u.jsx("p",{style:{marginTop:"1.5rem",textAlign:"center",fontSize:"0.85rem",opacity:.6},children:"Please wait, do not close this window..."})]})]})})}function U1(t,e,n){return!t||e.includes(t)?t===n?"active":"waiting":t===n?"active":"complete"}function Al({status:t,label:e,detail:n,isError:r}){const i=t==="waiting"?"":t==="active"?"":t==="error"?"":"";return u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[u.jsx("span",{style:{fontSize:"1.1rem",width:"1.5rem",textAlign:"center"},children:i}),u.jsxs("div",{style:{flex:1},children:[u.jsx("p",{style:{margin:0,fontWeight:500},children:e}),n&&u.jsx("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.85rem",opacity:r?1:.6,color:r?me.error:"inherit"},children:n})]})]})}function F1({selected:t,onClick:e,title:n,description:r,recommended:i}){return u.jsxs("button",{type:"button",onClick:e,style:{display:"flex",alignItems:"flex-start",gap:"0.75rem",padding:"0.75rem 1rem",background:t?"color-mix(in srgb, #646cff 15%, transparent)":"color-mix(in srgb, currentColor 5%, transparent)",border:t?"2px solid #646cff":"2px solid transparent",borderRadius:"8px",cursor:"pointer",textAlign:"left",width:"100%",transition:"all 0.15s ease"},children:[u.jsx("span",{style:{width:"20px",height:"20px",borderRadius:"50%",border:t?"6px solid #646cff":"2px solid rgba(128,128,128,0.5)",flexShrink:0,marginTop:"2px",background:t?"white":"transparent"}}),u.jsxs("div",{style:{flex:1},children:[u.jsxs("p",{style:{margin:0,fontWeight:600,fontSize:"0.95rem"},children:[n,i&&u.jsx("span",{style:{marginLeft:"0.5rem",padding:"0.15rem 0.5rem",background:me.success,color:"white",borderRadius:"4px",fontSize:"0.7rem",fontWeight:500,verticalAlign:"middle"},children:"RECOMMENDED"})]}),u.jsx("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.85rem",opacity:.7},children:r})]})]})}function Qg(t){return t==="no_category"||t==="NO_CATEGORY"}function bz(t,e){const n={};for(const r of t)Qg(r.from_category_id)||(n[r.from_category_id]=(n[r.from_category_id]||0)-r.amount),Qg(r.to_category_id)||(n[r.to_category_id]=(n[r.to_category_id]||0)+r.amount);for(const r of e)Qg(r.category_id)||(n[r.category_id]=(n[r.category_id]||0)+r.amount);for(const r of Object.keys(n))n[r]=Oe(n[r]);return n}async function vz(t,e,n,r,i,o,l){const d=fs(t,e.year,e.month),{exists:h,data:m}=await jt("months",d,"recalculate: reading full month data");if(!h||!m)return null;const p=m.income||[],g=m.expenses||[],v=m.transfers||[],_=m.adjustments||[],C=m.are_allocations_finalized||!1,x=Oe(p.reduce((A,N)=>A+N.amount,0)),S=Oe(g.reduce((A,N)=>A+N.amount,0)),E={};if(m.category_balances)for(const A of m.category_balances)E[A.category_id]={allocated:A.allocated??0};const T=bz(v,_),I=n.map(A=>{const N=Oe(i[A]??0);let F=0;C&&E[A]&&(F=Oe(E[A].allocated));let q=0;g.length>0&&(q=Oe(g.filter(W=>W.category_id===A).reduce((W,H)=>W+H.amount,0)));const j=T[A]??0,P=Oe(v.filter(W=>W.from_category_id===A||W.to_category_id===A).reduce((W,H)=>H.from_category_id===A?W-H.amount:H.to_category_id===A?W+H.amount:W,0)),O=Oe(_.filter(W=>W.category_id===A).reduce((W,H)=>W+H.amount,0)),X=Oe(N+F+q+j);return{category_id:A,start_balance:N,allocated:F,spent:q,transfers:P,adjustments:O,end_balance:X}});I.forEach(A=>{i[A.category_id]=A.end_balance});const M=Object.keys(r),L={},$=M.map(A=>{const N=Oe(p.filter(H=>H.account_id===A).reduce((H,Z)=>H+Z.amount,0)),F=Oe(g.filter(H=>H.account_id===A).reduce((H,Z)=>H+Z.amount,0)),q=Oe(v.filter(H=>H.from_account_id===A).reduce((H,Z)=>H-Z.amount,0)),j=Oe(v.filter(H=>H.to_account_id===A).reduce((H,Z)=>H+Z.amount,0)),P=Oe(_.filter(H=>H.account_id===A).reduce((H,Z)=>H+Z.amount,0)),O=Oe(N+F+q+j+P);L[A]=O;const X=Oe(o[A]??0),W=Oe(q+j);return{account_id:A,start_balance:X,income:N,expenses:F,transfers:W,adjustments:P,net_change:O,end_balance:Oe(X+O)}});for(const A of $)o[A.account_id]=A.end_balance;return{updatedMonth:{budget_id:t,year_month_ordinal:xt(e.year,e.month),year:e.year,month:e.month,income:p,total_income:x,previous_month_income:l,expenses:g,total_expenses:S,transfers:v,adjustments:_,account_balances:$,category_balances:I,are_allocations_finalized:C,created_at:m.created_at||new Date().toISOString(),updated_at:new Date().toISOString()},totalIncome:x,totalExpenses:S,accountNetChanges:L}}function X0({isDisabled:t,onCloseMenu:e}){const{selectedBudgetId:n,currentYear:r,currentMonthNumber:i}=Xe(),{categories:o,accounts:l}=jn(),{updateAccounts:d}=PT(),{updateCategories:h}=zT(),[m,p]=D.useState(!1),[g,v]=D.useState(!1),[_,C]=D.useState(null);function x(){v(!0),C({status:"confirming"})}async function S(T){if(n){p(!0),C({status:"pending"});try{C({status:"finding_months"});let I;if(T==="all_months")I=(await On("months","recalculate: querying all months for full recalculation",[{field:"budget_id",op:"==",value:n}])).docs.map(P=>({year:P.data.year,month:P.data.month})).sort((P,O)=>P.year!==O.year?P.year-O.year:P.month-O.month);else{const j=new Date,P=r||j.getFullYear(),O=i||j.getMonth()+1,{year:X,month:W}=Xl(P,O);I=await L6(n,X,W)}const M=Object.keys(o);C({status:"finding_months",monthsFound:I.length}),await new Promise(j=>setTimeout(j,100));const L={},$={};if(T==="from_current"){const j=new Date,P=r||j.getFullYear(),O=i||j.getMonth()+1,{year:X,month:W}=Xl(P,O),H=fs(n,X,W),{exists:Z,data:Y}=await jt("months",H,"recalculate: reading previous month for starting balances");if(Z&&Y?.category_balances)for(const se of Y.category_balances)L[se.category_id]=se.end_balance??0;if(Z&&Y?.account_balances)for(const se of Y.account_balances)$[se.account_id]=se.end_balance??0}M.forEach(j=>{L[j]===void 0&&(L[j]=0)}),Object.keys(l).forEach(j=>{$[j]===void 0&&($[j]=0)});let k=0,A=0,N=0;for(let j=0;j<I.length;j++){const P=I[j],O=`${Uu[P.month-1]} ${P.year}`;C({status:"processing_months",monthsFound:I.length,currentMonthIndex:j,currentMonthLabel:O});const X=await vz(n,P,M,l,L,$,N);X&&(k+=X.totalIncome,A+=X.totalExpenses,N=X.totalIncome,await ET({budgetId:n,month:X.updatedMonth,description:"recalculate all months"}),await new Promise(W=>setTimeout(W,50)))}const F={};Object.entries(l).forEach(([j,P])=>{F[j]={...P,balance:$[j]??0}}),await d.mutateAsync({budgetId:n,accounts:F}),C({status:"updating_budget",monthsFound:I.length,monthsProcessed:I.length,totalIncomeRecalculated:k,totalExpensesRecalculated:A});const q={};Object.entries(o).forEach(([j,P])=>{q[j]={...P,balance:L[j]??0}}),await h.mutateAsync({budgetId:n,categories:q});for(const j of I)Ue.invalidateQueries({queryKey:ke.month(n,j.year,j.month)});C({status:"done",monthsFound:I.length,monthsProcessed:I.length,totalIncomeRecalculated:k,totalExpensesRecalculated:A})}catch(I){console.error("Recalculate error:",I),C({status:"error",error:I instanceof Error?I.message:"Failed to recalculate"})}finally{p(!1)}}}function E(){v(!1),C(null),e?.()}return u.jsxs(u.Fragment,{children:[u.jsxs("button",{onClick:x,disabled:t||m,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",border:"none",borderRadius:"8px",padding:"0.5rem",cursor:t||m?"not-allowed":"pointer",opacity:t||m?.5:1,fontSize:"1rem",display:"flex",alignItems:"center",justifyContent:"center"},title:"Recalculate balances from this month forward",children:[m?"":""," Recalculate"]}),u.jsx(_z,{isOpen:g,onClose:E,onProceed:S,results:_})]})}function V1({direction:t,isDisabled:e,isLoading:n,disabledReason:r,onNavigate:i}){const[o,l]=D.useState(!1),d=n||e,h=t==="prev"?"":"",m=t==="prev"?"Previous month":"Next month",p=()=>{n||(e?(l(!0),setTimeout(()=>l(!1),2e3)):i())};return u.jsxs("div",{style:{position:"relative"},children:[u.jsx("button",{onClick:p,onMouseEnter:()=>e&&l(!0),onMouseLeave:()=>l(!1),style:{background:"color-mix(in srgb, currentColor 10%, transparent)",border:"none",borderRadius:"8px",padding:"0.75rem 1rem",cursor:d?"not-allowed":"pointer",fontSize:"1.25rem",opacity:d?.5:1,transition:"opacity 0.15s, background 0.15s"},title:e?void 0:m,children:h}),o&&e&&u.jsx("div",{style:{position:"absolute",top:"100%",...t==="prev"?{left:0}:{right:0},marginTop:"0.5rem",padding:"0.5rem 0.75rem",background:me.warning,color:"#000",borderRadius:"6px",fontSize:"0.75rem",fontWeight:500,width:"max-content",maxWidth:"min(300px, 50vw)",textAlign:"center",zIndex:20,boxShadow:"0 2px 8px rgba(0,0,0,0.3)"},children:r})]})}function xz({pickerYear:t,pickerMonth:e,currentYear:n,currentMonthNumber:r,minOrdinal:i,maxOrdinal:o,minAllowed:l,maxAllowed:d,onYearChange:h,onMonthChange:m,onGo:p}){const g=t>l.year,v=t<d.year,_=Number(xt(t,e)),C=_>=i&&_<=o;return u.jsxs("div",{style:{padding:"0.75rem",borderTop:"1px solid color-mix(in srgb, currentColor 15%, transparent)",marginTop:"0.25rem"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.5rem"},children:[u.jsx("button",{onClick:()=>h(t-1),disabled:!g,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",border:"none",borderRadius:"4px",padding:"0.25rem 0.5rem",cursor:g?"pointer":"not-allowed",fontSize:"0.8rem",opacity:g?1:.3},title:g?"Previous year":"Cannot go further back",children:""}),u.jsx("span",{style:{flex:1,textAlign:"center",fontSize:"0.9rem",fontWeight:500},children:t}),u.jsx("button",{onClick:()=>h(t+1),disabled:!v,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",border:"none",borderRadius:"4px",padding:"0.25rem 0.5rem",cursor:v?"pointer":"not-allowed",fontSize:"0.8rem",opacity:v?1:.3},title:v?"Next year":"Cannot go further ahead",children:""})]}),u.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"0.25rem",marginBottom:"0.5rem"},children:Uu.map((x,S)=>{const E=S+1,T=E===e,I=t===n&&E===r,M=Number(xt(t,E)),L=M<i,$=M>o,k=L||$;let A=x;return L?A="Too far in the past":$&&(A="Too far in the future"),u.jsx("button",{onClick:()=>m(E),disabled:k,style:{background:T?me.primary:"color-mix(in srgb, currentColor 8%, transparent)",border:I?`1px solid ${me.primary}`:"1px solid transparent",borderRadius:"4px",padding:"0.35rem 0.25rem",cursor:k?"not-allowed":"pointer",fontSize:"0.7rem",color:T?"#fff":"inherit",opacity:k?.3:1,transition:"background 0.15s"},title:A,children:x.slice(0,3)},E)})}),u.jsxs("button",{onClick:p,disabled:!C,style:{width:"100%",background:C?me.primary:"color-mix(in srgb, currentColor 20%, transparent)",border:"none",borderRadius:"6px",padding:"0.5rem",cursor:C?"pointer":"not-allowed",fontSize:"0.85rem",color:C?"#fff":"inherit",fontWeight:500,opacity:C?1:.5},children:["Go to ",Uu[e-1]," ",t]})]})}function wz({isOpen:t,onClose:e,year:n,month:r,isDeleting:i,onConfirm:o}){return u.jsxs(cs,{isOpen:t,onClose:e,title:" Delete Month?",children:[u.jsx("div",{style:{background:"color-mix(in srgb, #ef4444 15%, transparent)",border:"1px solid color-mix(in srgb, #ef4444 40%, transparent)",borderRadius:"8px",padding:"1rem",marginBottom:"1rem"},children:u.jsxs("p",{style:{margin:0,color:"#fca5a5",fontWeight:500,fontSize:"0.95rem"},children:[" This will permanently delete ",Uu[r-1]," ",n,"!"]})}),u.jsx("p",{style:{margin:"0 0 0.75rem",opacity:.9},children:"This month document and all its data (income, expenses, allocations) will be permanently deleted."}),u.jsx("p",{style:{margin:"0 0 1rem",opacity:.8,fontSize:"0.9rem"},children:"After deletion, you will be navigated to the previous month."}),u.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[u.jsx(Ve,{variant:"secondary",actionName:"Cancel Delete Month",onClick:e,disabled:i,children:"Cancel"}),u.jsx(Ve,{variant:"danger",actionName:"Confirm Delete Month",onClick:o,disabled:i,children:i?"Deleting...":" Delete Month"})]})]})}function Sz(){const t=new Date;let e=t.getFullYear(),n=t.getMonth()+1+Af;for(;n>12;)n-=12,e+=1;return{year:e,month:n}}function Cz(){const t=new Date;let e=t.getFullYear(),n=t.getMonth()+1-jf;for(;n<1;)n+=12,e-=1;return{year:e,month:n}}function Ez(t){return Object.keys(t).sort()[0]}function Tz(t){const e=parseInt(t.slice(0,4),10),n=parseInt(t.slice(4,6),10);return{year:e,month:n}}function Az(t){const e=Cz(),n=Ez(t);if(!n)return e;const r=xt(e.year,e.month);return n<r?Tz(n):e}function $1(t,e){return e===1?{year:t-1,month:12}:{year:t,month:e-1}}function jz(t,e){return e===12?{year:t+1,month:1}:{year:t,month:e+1}}function Rz({onPreviousMonth:t,onNextMonth:e}){const{isLoading:n}=Gn(),{currentYear:r,currentMonthNumber:i,isAdmin:o,selectedBudgetId:l,setCurrentYear:d,setCurrentMonthNumber:h}=Xe(),{budget:m,monthMap:p}=jn(),{month:g}=Gs(l,r,i),v=$1(r,i),_=jz(r,i),C=Az(p),x=Sz(),S=Number(xt(C.year,C.month)),E=Number(xt(x.year,x.month)),T=Number(xt(v.year,v.month)),I=Number(xt(_.year,_.month)),M=T<S,L=I>E,[$,k]=D.useState(!1),[A,N]=D.useState(!1),[F,q]=D.useState(r),[j,P]=D.useState(i),[O,X]=D.useState(!1),[W,H]=D.useState(!1),Z=D.useRef(null),Y=(()=>{if(!p||Object.keys(p).length===0)return!1;const ee=xt(r,i),ue=Math.max(...Object.keys(p).map(Number));return Number(ee)===ue})(),{trackChange:se}=fc();async function B(){if(l){H(!0);try{const ee=fs(l,r,i);H6(l,r,i,se),await Iy("months",ee,`deleting month ${r}/${i}`),`${r}${i}`,Ue.removeQueries({queryKey:ke.month(l,r,i)});const ue=$1(r,i);X(!1),k(!1),window.location.href=`/budget/${ue.year}/${ue.month}/categories`}catch(ee){console.error("Failed to delete month:",ee),alert(`Failed to delete month: ${ee instanceof Error?ee.message:"Unknown error"}`)}finally{H(!1)}}}D.useEffect(()=>{if(!$)return;function ee(ue){Z.current&&!Z.current.contains(ue.target)&&(k(!1),N(!1))}return document.addEventListener("mousedown",ee),()=>document.removeEventListener("mousedown",ee)},[$]);function G(){A||(q(r),P(i)),N(!A)}function ne(){d(F),h(j),N(!1),k(!1)}async function ie(){if(!g||!m)return;const ee=new Date,be=`${ee.toISOString().split("T")[0]}_month_${r}_${String(i).padStart(2,"0")}`,ce=new xm,ve=[{name:`${be}_income.json`,data:g.income||[]},{name:`${be}_expenses.json`,data:g.expenses||[]},{name:`${be}_transfers.json`,data:g.transfers||[]},{name:`${be}_adjustments.json`,data:g.adjustments||[]},{name:`${be}_account_balances.json`,data:g.account_balances||[]},{name:`${be}_category_balances.json`,data:g.category_balances||[]}],ze={budget_id:m.id,budget_name:m.name,year_month_ordinal:g.year_month_ordinal,year:g.year,month:g.month,total_income:g.total_income,previous_month_income:g.previous_month_income,total_expenses:g.total_expenses,are_allocations_finalized:g.are_allocations_finalized,created_at:g.created_at,updated_at:g.updated_at,downloaded_at:ee.toISOString()};ve.push({name:`${be}_metadata.json`,data:ze});for(const U of ve)ce.file(U.name,JSON.stringify(U.data,null,2));const Pe=await ce.generateAsync({type:"blob"}),ot=URL.createObjectURL(Pe),_t=document.createElement("a");_t.href=ot,_t.download=`${be}.zip`,document.body.appendChild(_t),_t.click(),document.body.removeChild(_t),URL.revokeObjectURL(ot),k(!1)}return u.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"1rem",marginBottom:"1.5rem",padding:"1rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"12px"},children:[u.jsx(V1,{direction:"prev",isDisabled:M,isLoading:n,disabledReason:"Cannot create months more than 3 months into the past",onNavigate:t}),u.jsxs("div",{ref:Z,style:{textAlign:"center",minWidth:"180px",position:"relative"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"flex-start",justifyContent:"center",gap:"0.25rem"},children:[u.jsxs("h2",{style:{margin:0,fontSize:"1.5rem"},children:[Uu[i-1]," ",r]}),u.jsx("button",{onClick:()=>k(!$),style:{background:"transparent",border:"none",cursor:"pointer",fontSize:"0.5rem",opacity:.4,padding:"0.15rem",borderRadius:"4px",transition:"opacity 0.15s, transform 0.15s",transform:$?"rotate(180deg)":"rotate(0deg)",marginTop:"0.25rem"},title:"Month options",children:""})]}),n&&u.jsxs(u.Fragment,{children:[u.jsx("style",{children:"@keyframes spin { to { transform: rotate(360deg); } }"}),u.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0.4rem",marginTop:"0.35rem"},children:[u.jsx("span",{style:{display:"inline-block",width:"14px",height:"14px",border:"2px solid color-mix(in srgb, currentColor 20%, transparent)",borderTopColor:me.primary,borderRadius:"50%",animation:"spin 0.8s linear infinite"}}),u.jsx("span",{style:{fontSize:"0.8rem",opacity:.6},children:"Loading..."})]})]}),$&&u.jsxs("div",{style:{position:"absolute",top:"100%",left:"50%",transform:"translateX(-50%)",marginTop:"0.5rem",background:"var(--background, #242424)",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",borderRadius:"8px",padding:"0.25rem",zIndex:100,minWidth:"160px",boxShadow:"0 4px 12px rgba(0,0,0,0.3)"},children:[u.jsx(X0,{isDisabled:n,onCloseMenu:()=>k(!1)}),u.jsx("button",{onClick:G,style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%",background:"transparent",border:"none",borderRadius:"6px",padding:"0.5rem 0.75rem",cursor:"pointer",fontSize:"0.85rem",color:"inherit",textAlign:"left",transition:"background 0.15s"},title:"Jump to a specific month",children:" Go to Month"}),A&&u.jsx(xz,{pickerYear:F,pickerMonth:j,currentYear:r,currentMonthNumber:i,minOrdinal:S,maxOrdinal:E,minAllowed:C,maxAllowed:x,onYearChange:q,onMonthChange:P,onGo:ne}),o&&g&&u.jsx("button",{onClick:()=>{ie()},style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%",background:"transparent",border:"none",borderRadius:"6px",padding:"0.5rem 0.75rem",cursor:"pointer",fontSize:"0.85rem",color:"inherit",textAlign:"left",transition:"background 0.15s"},title:"Download month document as JSON (for debugging)",children:" Download JSON"}),o&&g&&Y&&u.jsx("button",{onClick:()=>X(!0),style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%",background:"transparent",border:"none",borderRadius:"6px",padding:"0.5rem 0.75rem",cursor:"pointer",fontSize:"0.85rem",color:"#ef4444",textAlign:"left",transition:"background 0.15s"},title:"Delete this month (last month only)",children:" Delete Month"})]})]}),u.jsx(V1,{direction:"next",isDisabled:L,isLoading:n,disabledReason:"Cannot create months more than 3 months into the future",onNavigate:e}),u.jsx(wz,{isOpen:O,onClose:()=>X(!1),year:r,month:i,isDeleting:W,onConfirm:B})]})}const Z0={cursor:"pointer",fontSize:"0.9rem",padding:"0.35rem 0.5rem",borderRadius:"4px"},Iz={...Z0,background:me.primary,border:"none",color:"white"},kz={...Z0,background:"transparent",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)"},Dz={...Z0,background:"transparent",border:`1px solid ${me.errorBorder}`,color:me.error},q1=t=>({display:"flex",alignItems:"center",justifyContent:"center",width:"2.25rem",height:"100%",minHeight:"2.25rem",background:t?`color-mix(in srgb, ${me.error} 15%, transparent)`:`color-mix(in srgb, ${me.success} 15%, transparent)`,border:`1px solid ${t?me.errorBorder:"rgba(74, 222, 128, 0.4)"}`,borderRadius:"4px 0 0 4px",cursor:"pointer",fontSize:"1rem",fontWeight:600,color:t?me.error:me.success,transition:"all 0.15s ease",flexShrink:0});function J0({accounts:t,accountGroups:e,categories:n,categoryGroups:r,payees:i,initialData:o,defaultAccountId:l,defaultDate:d,config:h,onSubmit:m,onCancel:p,onDelete:g,extraContent:v}){const{isWide:_}=MT(),{showCategory:C=!1,showCleared:x=!1,showSignToggle:S=!1,accountLabel:E="Account",payeePlaceholder:T="Payee name",descriptionPlaceholder:I="Optional note",submitLabel:M}=h,L=new Date().toISOString().split("T")[0],[$,k]=D.useState(o?.date||d||L),[A,N]=D.useState(o?.payee||""),[F,q]=D.useState(o?.categoryId||(h.showNoCategoryOption?Yt:"")),[j,P]=D.useState(o?.accountId||l||(h.showNoAccountOption?Ht:t[0]?t[0][0]:"")),O=o?.amount!==void 0?Math.abs(o.amount):void 0,[X,W]=D.useState(O?.toString()||""),[H,Z]=D.useState(o?.description||""),[Y,se]=D.useState(o?.cleared||!1),[B,G]=D.useState(()=>S?o?.amount!==void 0?o.amount<0:!1:!0),[ne,ie]=D.useState(!1),ee={},ue=[];t.forEach(([Se,ae])=>{ae.account_group_id?(ee[ae.account_group_id]||(ee[ae.account_group_id]=[]),ee[ae.account_group_id].push([Se,ae])):ue.push([Se,ae])});function be(Se){Se.preventDefault();const ae=parseFloat(X);if(isNaN(ae)||ae<=0||C&&!F||!j||!$)return;if(F===Yt&&j===Ht){ie(!0);return}ie(!1);const De=S&&B?-ae:ae;m({date:$,payee:A.trim()||void 0,categoryId:C?F:void 0,accountId:j,amount:De,description:H.trim()||void 0,cleared:x?Y:void 0})}!(F===Yt&&j===Ht)&&ne&&ie(!1);const Pe=h.showNoAccountOption?u.jsx(OT,{id:"txn-account",value:j,onChange:P,accounts:t,accountGroups:e,placeholder:Ra,required:!0,showNoAccountOption:!0}):u.jsxs($u,{id:"txn-account",value:j,onChange:Se=>P(Se.target.value),required:!0,style:{fontSize:"0.85rem",padding:"0.5rem"},children:[Object.entries(e).map(([Se,ae])=>{const Ae=ee[Se];return Ae?.length?u.jsx("optgroup",{label:ae.name,children:Ae.map(([Me,De])=>u.jsx("option",{value:Me,children:De.nickname},Me))},Se):null}),ue.length>0&&u.jsx("optgroup",{label:"Other",children:ue.map(([Se,ae])=>u.jsx("option",{value:Se,children:ae.nickname},Se))})]}),ot=C&&n&&r?u.jsx(zt,{label:"Category",htmlFor:"txn-category",children:u.jsx(DT,{id:"txn-category",value:F,onChange:q,categories:n,categoryGroups:r,placeholder:h.showNoCategoryOption?ko:"Search...",required:!0,showNoCategoryOption:h.showNoCategoryOption})}):null,_t=x?u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.25rem",paddingBottom:"0.35rem"},children:[u.jsx("label",{htmlFor:"txn-cleared",style:{fontSize:"0.75rem",opacity:.7,fontWeight:500},children:"Clr"}),u.jsx(qr,{id:"txn-cleared",checked:Y,onChange:Se=>se(Se.target.checked)})]}):null,U=u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.25rem",paddingBottom:"0.1rem"},children:[u.jsx("span",{style:{fontSize:"0.75rem",opacity:.7,fontWeight:500},children:""}),u.jsxs("div",{style:{display:"flex",gap:"0.25rem"},children:[u.jsx("button",{type:"submit",title:M,style:Iz,children:""}),u.jsx("button",{type:"button",onClick:()=>{p()},title:"Cancel",style:kz,children:""}),g&&u.jsx("button",{type:"button",onClick:()=>{g()},title:"Delete",style:Dz,children:""})]})]}),he=ne?u.jsx("div",{style:{background:`color-mix(in srgb, ${me.error} 15%, transparent)`,border:`1px solid ${me.errorBorder}`,borderRadius:"6px",padding:"0.5rem 0.75rem",fontSize:"0.85rem",color:me.error},children:'Cannot select both "No Category" and "No Account"  at least one must be a real category or account.'}):null,ye=u.jsxs(za,{children:[u.jsx(Ve,{type:"submit",actionName:M,children:M}),u.jsx(Ve,{type:"button",variant:"secondary",actionName:"Cancel Transaction Form",onClick:p,children:"Cancel"}),g&&u.jsx(Ve,{type:"button",variant:"danger",actionName:"Delete Transaction",onClick:g,children:" Delete"})]}),te=C&&n&&r,J={fontSize:"0.85rem",padding:"0.5rem"};if(!_)return u.jsxs(Si,{actionName:M,onSubmit:be,children:[u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:[u.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[u.jsx(zt,{label:"Date",htmlFor:"txn-date",children:u.jsx(kf,{id:"txn-date",value:$,onChange:Se=>k(Se.target.value),required:!0,autoFocus:!0})}),u.jsx(zt,{label:S?B?"Amount (Expense)":"Amount (Refund)":"Amount",htmlFor:"txn-amount",children:S?u.jsxs("div",{className:"currency-with-sign",style:{display:"flex",alignItems:"stretch"},children:[u.jsx("button",{type:"button",onClick:()=>G(!B),style:q1(B),title:B?"Click to make this a refund (+)":"Click to make this an expense (-)",children:B?"":"+"}),u.jsx("div",{style:{flex:1},children:u.jsx(xo,{id:"txn-amount",value:X,onChange:W,placeholder:"$0.00",required:!0,style:{borderTopLeftRadius:0,borderBottomLeftRadius:0,borderLeft:"none",color:B?me.error:me.success}})})]}):u.jsx(xo,{id:"txn-amount",value:X,onChange:W,placeholder:"$0.00",required:!0})})]}),u.jsx(zt,{label:"Payee",htmlFor:"txn-payee",children:u.jsx(R1,{id:"txn-payee",value:A,onChange:N,payees:i,placeholder:T})}),ot,u.jsx(zt,{label:E,htmlFor:"txn-account",children:Pe}),u.jsx(zt,{label:"Description (optional)",htmlFor:"txn-description",children:u.jsx(Ci,{id:"txn-description",value:H,onChange:Se=>Z(Se.target.value),placeholder:I})}),x&&u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx(qr,{id:"txn-cleared-stacked",checked:Y,onChange:Se=>se(Se.target.checked)}),u.jsx("label",{htmlFor:"txn-cleared-stacked",style:{fontSize:"0.9rem",cursor:"pointer"},children:"Cleared (appeared in bank account)"})]}),he,v]}),ye]});const oe=S?"8.25rem":"6rem",Ce=te?x?`6rem minmax(8rem, 1fr) minmax(8rem, 1fr) minmax(8rem, 1fr) ${oe} minmax(10rem, 2fr) auto auto`:`6rem minmax(8rem, 1fr) minmax(8rem, 1fr) minmax(8rem, 1fr) ${oe} minmax(10rem, 2fr) auto`:x?`6rem minmax(10rem, 1fr) minmax(10rem, 1fr) ${oe} minmax(12rem, 2fr) auto auto`:`6rem minmax(10rem, 1fr) minmax(10rem, 1fr) ${oe} minmax(12rem, 2fr) auto`;return u.jsxs(Si,{actionName:M,onSubmit:be,children:[u.jsxs("div",{style:{display:"grid",gridTemplateColumns:Ce,gap:"1rem",alignItems:"end"},children:[u.jsx(zt,{label:"Date",htmlFor:"txn-date",children:u.jsx(kf,{id:"txn-date",value:$,onChange:Se=>k(Se.target.value),required:!0,style:J,autoFocus:!0})}),u.jsx(zt,{label:"Payee",htmlFor:"txn-payee",children:u.jsx(R1,{id:"txn-payee",value:A,onChange:N,payees:i,placeholder:T})}),ot,u.jsx(zt,{label:E,htmlFor:"txn-account",children:Pe}),u.jsx(zt,{label:S?B?"Amount ()":"Amount (+)":"Amount",htmlFor:"txn-amount",children:S?u.jsxs("div",{className:"currency-with-sign",style:{display:"flex",alignItems:"stretch"},children:[u.jsx("button",{type:"button",onClick:()=>G(!B),style:q1(B),title:B?"Click to make this a refund (+)":"Click to make this an expense (-)",children:B?"":"+"}),u.jsx("div",{style:{flex:1},children:u.jsx(xo,{id:"txn-amount",value:X,onChange:W,placeholder:"$0.00",required:!0,style:{borderTopLeftRadius:0,borderBottomLeftRadius:0,borderLeft:"none",color:B?me.error:me.success}})})]}):u.jsx(xo,{id:"txn-amount",value:X,onChange:W,placeholder:"$0.00",required:!0})}),u.jsx(zt,{label:"Description",htmlFor:"txn-description",children:u.jsx(Ci,{id:"txn-description",value:H,onChange:Se=>Z(Se.target.value),placeholder:I,style:J})}),_t,U]}),he,v]})}function H1({accounts:t,accountGroups:e,payees:n,initialData:r,defaultAccountId:i,defaultDate:o,onSubmit:l,onCancel:d,onDelete:h,submitLabel:m}){function p(g){l(g.amount,g.accountId,g.date,g.payee,g.description)}return u.jsx(J0,{accounts:t,accountGroups:e,payees:n,initialData:r?{date:r.date,payee:r.payee,accountId:r.account_id,amount:r.amount,description:r.description}:void 0,defaultAccountId:i,defaultDate:o,config:{showCategory:!1,showCleared:!1,accountLabel:"Deposit To",payeePlaceholder:"e.g., Employer, Client name",descriptionPlaceholder:"e.g., January paycheck",submitLabel:m},onSubmit:p,onCancel:d,onDelete:h})}function Oz({income:t,accountName:e,accountGroupName:n,onEdit:r,onDelete:i,isMobile:o,isEvenRow:l}){const d=t.date?new Date(t.date+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"}):"",h=n?`${n} / ${e}`:e,m=l?"transparent":"rgba(255,255,255,0.04)";if(o)return u.jsxs("div",{onClick:r,style:{gridColumn:"1 / -1",display:"grid",gridTemplateColumns:"1fr auto",gap:"0.5rem",padding:"0.75rem 1rem",background:m,cursor:"pointer",transition:"background 0.15s"},children:[u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{style:{fontSize:"0.75rem",opacity:.5,fontFamily:"monospace",minWidth:"3rem"},children:d}),u.jsx("span",{style:{fontWeight:500,fontSize:"0.9rem"},children:t.payee||""})]}),u.jsxs("span",{style:{fontSize:"0.75rem",opacity:.6},children:[" ",h]})]}),u.jsx("div",{style:{display:"flex",alignItems:"center"},children:u.jsxs("span",{style:{fontWeight:600,color:me.success,fontFamily:"monospace"},children:["+",qe(t.amount)]})})]});const p={padding:"0.6rem 0.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem"};return u.jsxs("div",{style:{gridColumn:"1 / -1",background:m,display:"grid",gridTemplateColumns:"5rem 1.5fr 7rem 1fr 6rem 1fr 3rem 4rem"},children:[u.jsx("div",{style:{...p,fontSize:"0.85rem",fontFamily:"monospace"},children:u.jsx("span",{style:{opacity:.6},children:d})}),u.jsx("div",{style:{...p,fontWeight:500,overflow:"hidden"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.payee||""})}),u.jsx("div",{style:{...p,overflow:"hidden"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.85rem",opacity:.7},children:h})}),u.jsxs("div",{style:{...p,justifyContent:"flex-end",fontWeight:600,color:me.success,fontFamily:"monospace"},children:["+",qe(t.amount)]}),u.jsx("div",{style:{...p,paddingLeft:"0.5rem",overflow:"hidden"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.8rem",opacity:.6},children:t.description||""})}),u.jsxs("div",{style:{...p,justifyContent:"flex-end",gap:"0.25rem"},children:[u.jsx("button",{onClick:r,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:g=>g.currentTarget.style.opacity="1",onMouseLeave:g=>g.currentTarget.style.opacity="0.5",title:"Edit",children:""}),u.jsx("button",{onClick:i,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:g=>g.currentTarget.style.opacity="1",onMouseLeave:g=>g.currentTarget.style.opacity="0.5",title:"Delete",children:""})]})]})}const jl={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderTop:"1px solid rgba(255,255,255,0.1)"};function Mz(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n,setCurrentYear:r,setCurrentMonthNumber:i}=Xe(),{accounts:o,accountGroups:l}=jn(),{month:d,isLoading:h}=Gs(t,e,n),{addIncome:m}=jP(),{updateIncome:p}=IP(),{deleteIncome:g}=kP(),v=Ti(),[_,C]=D.useState(null),[x,S]=D.useState(!1),[E,T]=D.useState(null),L=z0(t,{enabled:x||E!==null}).data||[];function $(H){const Z=H.account_group_id?l[H.account_group_id]:void 0;return Z&&Z.is_active!==null?Z.is_active:H.is_active!==!1}function k(H){const Z=H.account_group_id?l[H.account_group_id]:void 0;return Z&&Z.on_budget!==null?Z.on_budget:H.on_budget!==!1}const A=Object.entries(o).filter(([,H])=>$(H)&&k(H)),N=A.filter(([,H])=>H.is_income_account),F=N.length>0?N:A,q=A.find(([,H])=>H.is_income_default),j=q?q[0]:void 0,P=d?.income.reduce((H,Z)=>H+Z.amount,0)||0;function O(H,Z,Y,se,B){if(!t)return;C(null),S(!1);const{year:G,month:ne}=fm(Y);(G!==e||ne!==n)&&(r(G),i(ne)),m(t,G,ne,H,Z,Y,se,B).catch(ie=>{C(ie instanceof Error?ie.message:"Failed to add income")})}function X(H,Z,Y,se,B,G){t&&(C(null),T(null),p(t,e,n,H,Z,Y,se,B,G).catch(ne=>{C(ne instanceof Error?ne.message:"Failed to update income")}))}function W(H){t&&confirm("Are you sure you want to delete this income entry?")&&(C(null),g(t,e,n,H).catch(Z=>{C(Z instanceof Error?Z.message:"Failed to delete income")}))}return u.jsxs("div",{style:{opacity:h?.5:1,transition:"opacity 0.15s ease-out",pointerEvents:h?"none":"auto"},children:[_&&u.jsx("div",{style:{background:`color-mix(in srgb, ${me.error} 15%, transparent)`,border:`1px solid ${me.error}`,borderRadius:"8px",padding:"0.75rem",marginBottom:"1rem",color:me.error},children:_}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:v?"1fr":"5rem 1.5fr 2fr 7rem 1.5fr 3rem"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"#242424",borderBottom:"1px solid rgba(255,255,255,0.15)",display:v?"block":"grid",gridTemplateColumns:v?void 0:"subgrid"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem"},children:[u.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[u.jsx("span",{style:{fontWeight:600},children:"Income:"}),u.jsx("span",{style:{opacity:.6,fontSize:"0.8rem"},children:"Incoming money that should be factored into income calculations"}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"Total: "}),u.jsx("span",{style:{color:lt(P),fontWeight:600},children:qe(P)})]})]}),u.jsx("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:!x&&u.jsx(Ve,{actionName:"Open Add Income Form",onClick:()=>S(!0),disabled:F.length===0,disabledReason:Object.keys(o).length===0?"Create an account first":"Set up an income account first",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:"+ Add Income"})})]}),!v&&u.jsxs(u.Fragment,{children:[u.jsx("div",{style:jl,children:"Date"}),u.jsx("div",{style:jl,children:"Payee"}),u.jsx("div",{style:jl,children:"Account"}),u.jsx("div",{style:{...jl,textAlign:"right"},children:"Amount"}),u.jsx("div",{style:jl,children:"Description"}),u.jsx("div",{style:jl})]})]}),u.jsx("div",{style:{gridColumn:"1 / -1",fontSize:"0.8rem",opacity:.55,fontStyle:"italic",padding:"0.5rem 0"},children:" All income entries on this page count towards the tithing owed calculation."}),F.length===0&&u.jsx(qu,{message:Object.keys(o).length===0?"You need to create at least one account before adding income.":'No accounts are set up for income deposits. Edit an account and enable "Show in income deposit list".',linkText:"Manage accounts",linkTo:"/budget/settings/accounts"}),x&&u.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"1rem"},children:u.jsx(H1,{accounts:F,accountGroups:l,payees:L,defaultAccountId:j,defaultDate:hm(e,n),onSubmit:O,onCancel:()=>S(!1),submitLabel:"Add Income",isMobile:v})}),d?.income.slice().sort((H,Z)=>(H.date||"").localeCompare(Z.date||"")).map((H,Z)=>E===H.id?u.jsx("div",{style:{gridColumn:"1 / -1",padding:"0.5rem"},children:u.jsx(H1,{accounts:F,accountGroups:l,payees:L,initialData:H,onSubmit:(Y,se,B,G,ne)=>X(H.id,Y,se,B,G,ne),onCancel:()=>T(null),onDelete:()=>W(H.id),submitLabel:"Save",isMobile:v})},H.id):u.jsx(Oz,{income:H,accountName:et(H.account_id)?Ra:o[H.account_id]?.nickname||"Unknown Account",accountGroupName:et(H.account_id)?void 0:o[H.account_id]?.account_group_id?l[o[H.account_id].account_group_id]?.name:void 0,onEdit:()=>{H.payee||`${H.amount}`,T(H.id)},onDelete:()=>W(H.id),isMobile:v,isEvenRow:Z%2===0},H.id)),(!d?.income||d.income.length===0)&&!x&&u.jsx("p",{style:{gridColumn:"1 / -1",opacity:.5,fontSize:"0.9rem",textAlign:"center",padding:"1.5rem"},children:"No income recorded for this month"}),u.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]})]})}function G1({accounts:t,accountGroups:e,categories:n,categoryGroups:r,payees:i,initialData:o,defaultAccountId:l,defaultDate:d,onSubmit:h,onCancel:m,onDelete:p,submitLabel:g}){function v(_){h(_.amount,_.categoryId,_.accountId,_.date,_.payee,_.description,_.cleared)}return u.jsx(J0,{accounts:t,accountGroups:e,categories:n,categoryGroups:r,payees:i,initialData:o?{date:o.date,payee:o.payee,categoryId:o.category_id,accountId:o.account_id,amount:o.amount,description:o.description,cleared:o.cleared}:void 0,defaultAccountId:l,defaultDate:d,config:{showCategory:!0,showCleared:!0,showNoCategoryOption:!1,showNoAccountOption:!1,showSignToggle:!0,accountLabel:"Pay From",payeePlaceholder:"e.g., Grocery Store",descriptionPlaceholder:"e.g., Weekly groceries",submitLabel:g},onSubmit:v,onCancel:m,onDelete:p})}function Nz({expense:t,categoryName:e,accountName:n,accountGroupName:r,onEdit:i,onDelete:o,isMobile:l,isEvenRow:d}){const h=t.date?new Date(t.date+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"}):"",m=r?`${r} / ${n}`:n,p=d?"transparent":"rgba(255,255,255,0.04)";if(l)return u.jsxs("div",{onClick:i,style:{gridColumn:"1 / -1",display:"grid",gridTemplateColumns:"1fr auto",gap:"0.5rem",padding:"0.75rem 1rem",background:p,cursor:"pointer",transition:"background 0.15s"},children:[u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{style:{fontSize:"0.75rem",opacity:.5,fontFamily:"monospace",minWidth:"3rem"},children:h}),u.jsx("span",{style:{fontWeight:500,fontSize:"0.9rem"},children:t.payee||""}),t.cleared&&u.jsx("span",{style:{fontSize:"0.7rem",color:me.success},title:"Cleared",children:""})]}),u.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap"},children:[u.jsx("span",{style:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px"},children:e}),u.jsxs("span",{style:{fontSize:"0.75rem",opacity:.6},children:[" ",m]})]})]}),u.jsx("div",{style:{display:"flex",alignItems:"center"},children:u.jsx("span",{style:{fontWeight:600,color:lt(t.amount),fontFamily:"monospace"},children:Bt(t.amount)})})]});const g={padding:"0.6rem 0.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem"};return u.jsxs("div",{style:{gridColumn:"1 / -1",background:p,display:"grid",gridTemplateColumns:"5rem 1.5fr 7rem 1fr 6rem 1fr 3rem 4rem"},children:[u.jsx("div",{style:{...g,fontSize:"0.85rem",fontFamily:"monospace"},children:u.jsx("span",{style:{opacity:.6},children:h})}),u.jsx("div",{style:{...g,fontWeight:500,overflow:"hidden"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.payee||""})}),u.jsx("div",{style:{...g,justifyContent:"center"},children:u.jsx("span",{style:{fontSize:"0.8rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e})}),u.jsx("div",{style:{...g,overflow:"hidden"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.85rem",opacity:.7},children:m})}),u.jsx("div",{style:{...g,justifyContent:"flex-end",fontWeight:600,color:lt(t.amount),fontFamily:"monospace"},children:Bt(t.amount)}),u.jsx("div",{style:{...g,paddingLeft:"0.5rem",overflow:"hidden"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.8rem",opacity:.6},children:t.description||""})}),u.jsx("div",{style:{...g,justifyContent:"center",color:t.cleared?me.success:"inherit",opacity:t.cleared?1:.3,fontSize:"1rem"},children:t.cleared?"":""}),u.jsxs("div",{style:{...g,justifyContent:"flex-end",gap:"0.25rem"},children:[u.jsx("button",{onClick:i,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:v=>v.currentTarget.style.opacity="1",onMouseLeave:v=>v.currentTarget.style.opacity="0.5",title:"Edit",children:""}),u.jsx("button",{onClick:o,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:v=>v.currentTarget.style.opacity="1",onMouseLeave:v=>v.currentTarget.style.opacity="0.5",title:"Delete",children:""})]})]})}const aa={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderTop:"1px solid rgba(255,255,255,0.1)"};function Pz(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n,setCurrentYear:r,setCurrentMonthNumber:i}=Xe(),{accounts:o,accountGroups:l,categories:d,categoryGroups:h}=jn(),{month:m,isLoading:p}=Gs(t,e,n),{addExpense:g}=OP(),{updateExpense:v}=NP(),{deleteExpense:_}=PP(),C=Ti(),[x,S]=D.useState(null),[E,T]=D.useState(!1),[I,M]=D.useState(null),k=z0(t,{enabled:E||I!==null}).data||[];function A(Y){const se=Y.account_group_id?l[Y.account_group_id]:void 0;return se&&se.is_active!==null?se.is_active:Y.is_active!==!1}function N(Y){const se=Y.account_group_id?l[Y.account_group_id]:void 0;return se&&se.on_budget!==null?se.on_budget:Y.on_budget!==!1}const F=Object.entries(o).filter(([,Y])=>A(Y)&&N(Y)),q=F.filter(([,Y])=>Y.is_outgo_account),j=q.length>0?q:F,P=F.find(([,Y])=>Y.is_outgo_default),O=P?P[0]:void 0,X=m?.expenses?.reduce((Y,se)=>Y+se.amount,0)||0;function W(Y,se,B,G,ne,ie,ee){if(!t)return;S(null),T(!1);const{year:ue,month:be}=fm(G);(ue!==e||be!==n)&&(r(ue),i(be)),g(t,ue,be,Y,se,B,G,ne,ie,ee).catch(ce=>{S(ce instanceof Error?ce.message:"Failed to add expense")})}function H(Y,se,B,G,ne,ie,ee,ue){t&&(S(null),M(null),v(t,e,n,Y,se,B,G,ne,ie,ee,ue).catch(be=>{S(be instanceof Error?be.message:"Failed to update expense")}))}function Z(Y){t&&confirm("Are you sure you want to delete this expense?")&&(S(null),_(t,e,n,Y).catch(se=>{S(se instanceof Error?se.message:"Failed to delete expense")}))}return u.jsxs("div",{style:{opacity:p?.5:1,transition:"opacity 0.15s ease-out",pointerEvents:p?"none":"auto"},children:[x&&u.jsx("div",{style:{background:`color-mix(in srgb, ${me.error} 15%, transparent)`,border:`1px solid ${me.error}`,borderRadius:"8px",padding:"0.75rem",marginBottom:"1rem",color:me.error},children:x}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:C?"1fr":"5rem 1.5fr 7rem 1fr 6rem 1fr 3rem 4rem"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"#242424",borderBottom:"1px solid rgba(255,255,255,0.15)",display:C?"block":"grid",gridTemplateColumns:C?void 0:"subgrid"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem"},children:[u.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[u.jsx("span",{style:{fontWeight:600},children:"Expenses:"}),u.jsx("span",{style:{opacity:.6,fontSize:"0.8rem"},children:"Transactions that should be factored into spend calculations"}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"Total: "}),u.jsx("span",{style:{color:lt(X),fontWeight:600},children:Bt(X)})]})]}),u.jsx("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:!E&&u.jsx(Ve,{actionName:"Open Add Expense Form",onClick:()=>T(!0),disabled:j.length===0||Object.keys(d).length===0,disabledReason:j.length===0&&Object.keys(d).length===0?"Create accounts and categories first":j.length===0?"Create an expense account first":"Create a category first",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:"+ Add Expense"})})]}),!C&&u.jsxs(u.Fragment,{children:[u.jsx("div",{style:aa,children:"Date"}),u.jsx("div",{style:aa,children:"Payee"}),u.jsx("div",{style:{...aa,textAlign:"center"},children:"Category"}),u.jsx("div",{style:aa,children:"Account"}),u.jsx("div",{style:{...aa,textAlign:"right"},children:"Amount"}),u.jsx("div",{style:aa,children:"Description"}),u.jsx("div",{style:{...aa,textAlign:"center"},children:"Clr"}),u.jsx("div",{style:aa})]})]}),j.length===0&&u.jsx(qu,{message:Object.keys(o).length===0?"You need to create at least one account before adding expenses.":'No accounts are set up for expenses. Edit an account and enable "Show in expense list".',linkText:"Manage accounts",linkTo:"/budget/settings/accounts"}),Object.keys(d).length===0&&u.jsx(qu,{message:"You need to create at least one category before adding expenses.",linkText:"Create categories",linkTo:"/budget/settings/categories"}),E&&u.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"1rem"},children:u.jsx(G1,{accounts:j,accountGroups:l,categories:d,categoryGroups:h,payees:k,defaultAccountId:O,defaultDate:hm(e,n),onSubmit:W,onCancel:()=>T(!1),submitLabel:"Add Expense",isMobile:C})}),m?.expenses?.slice().sort((Y,se)=>(Y.date||"").localeCompare(se.date||"")).map((Y,se)=>I===Y.id?u.jsx("div",{style:{gridColumn:"1 / -1",padding:"0.5rem"},children:u.jsx(G1,{accounts:j,accountGroups:l,categories:d,categoryGroups:h,payees:k,initialData:Y,onSubmit:(B,G,ne,ie,ee,ue,be)=>H(Y.id,B,G,ne,ie,ee,ue,be),onCancel:()=>M(null),onDelete:()=>Z(Y.id),submitLabel:"Save",isMobile:C})},Y.id):u.jsx(Nz,{expense:Y,categoryName:at(Y.category_id)?ko:d[Y.category_id]?.name||"Unknown Category",accountName:et(Y.account_id)?Ra:o[Y.account_id]?.nickname||"Unknown Account",accountGroupName:et(Y.account_id)?void 0:o[Y.account_id]?.account_group_id?l[o[Y.account_id].account_group_id]?.name:void 0,onEdit:()=>{Y.payee||`${Y.amount}`,M(Y.id)},onDelete:()=>Z(Y.id),isMobile:C,isEvenRow:se%2===0},Y.id)),(!m?.expenses||m.expenses.length===0)&&!E&&u.jsx("p",{style:{gridColumn:"1 / -1",opacity:.5,fontSize:"0.9rem",textAlign:"center",padding:"1.5rem"},children:"No expenses recorded for this month"}),u.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]})]})}const zz={background:me.primary,border:"none",cursor:"pointer",fontSize:"0.9rem",padding:"0.35rem 0.5rem",borderRadius:"4px",color:"white"},Bz={background:"transparent",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)",cursor:"pointer",fontSize:"0.9rem",padding:"0.35rem 0.5rem",borderRadius:"4px"},Lz={background:"transparent",border:`1px solid ${me.errorBorder}`,color:me.error,cursor:"pointer",fontSize:"0.9rem",padding:"0.35rem 0.5rem",borderRadius:"4px"};function Q1({accounts:t,accountGroups:e,categories:n,categoryGroups:r,initialData:i,defaultDate:o,onSubmit:l,onCancel:d,onDelete:h,submitLabel:m}){const{isWide:p}=MT(),g=new Date().toISOString().split("T")[0],[v,_]=D.useState(i?.date||o||g),[C,x]=D.useState(i?.amount?.toString()||""),[S,E]=D.useState(i?.from_account_id||Ht),[T,I]=D.useState(i?.to_account_id||Ht),[M,L]=D.useState(i?.from_category_id||Yt),[$,k]=D.useState(i?.to_category_id||Yt),[A,N]=D.useState(i?.description||""),[F,q]=D.useState(i?.cleared||!1),[j,P]=D.useState(null),O=M===Yt,X=$===Yt,W=S===Ht,H=T===Ht;function Z(){return O&&X&&(W&&H)?'A transfer must move between real categories or real accounts  not all "No" options.':W!==H?'Both accounts must be real accounts, or both must be "No Account". Cannot transfer from a real account to nothing.':O!==X?'Both categories must be real categories, or both must be "No Category". Cannot transfer from a real category to nothing.':null}Z()===null&&j!==null&&P(null);function se(ce){ce.preventDefault();const ve=parseFloat(C);if(isNaN(ve)||ve<=0||!S||!T||!M||!$||!v)return;const ze=Z();if(ze){P(ze);return}P(null),l(ve,S,T,M,$,v,A.trim()||void 0,F)}const B=j?u.jsx("div",{style:{background:`color-mix(in srgb, ${me.error} 15%, transparent)`,border:`1px solid ${me.errorBorder}`,borderRadius:"6px",padding:"0.5rem 0.75rem",fontSize:"0.85rem",color:me.error,marginTop:"0.5rem"},children:j}):null,G=(ce,ve,ze,Pe)=>u.jsx(zt,{label:Pe,htmlFor:ce,children:u.jsx(OT,{id:ce,value:ve,onChange:ze,accounts:t,accountGroups:e,placeholder:Ra,required:!0,showNoAccountOption:!0})}),ne=(ce,ve,ze,Pe)=>u.jsx(zt,{label:Pe,htmlFor:ce,children:u.jsx(DT,{id:ce,value:ve,onChange:ze,categories:n,categoryGroups:r,placeholder:ko,required:!0,showNoCategoryOption:!0})}),ie=u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.25rem",paddingBottom:"0.35rem"},children:[u.jsx("label",{htmlFor:"transfer-cleared",style:{fontSize:"0.75rem",opacity:.7,fontWeight:500},children:"Clr"}),u.jsx(qr,{id:"transfer-cleared",checked:F,onChange:ce=>q(ce.target.checked)})]}),ee=u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.25rem",paddingBottom:"0.1rem"},children:[u.jsx("span",{style:{fontSize:"0.75rem",opacity:.7,fontWeight:500},children:""}),u.jsxs("div",{style:{display:"flex",gap:"0.25rem"},children:[u.jsx("button",{type:"submit",title:m,style:zz,children:""}),u.jsx("button",{type:"button",onClick:()=>{d()},title:"Cancel",style:Bz,children:""}),h&&u.jsx("button",{type:"button",onClick:()=>{h()},title:"Delete",style:Lz,children:""})]})]}),ue=u.jsxs(za,{children:[u.jsx(Ve,{type:"submit",actionName:m,children:m}),u.jsx(Ve,{type:"button",variant:"secondary",actionName:"Cancel Transfer Form",onClick:d,children:"Cancel"}),h&&u.jsx(Ve,{type:"button",variant:"danger",actionName:"Delete Transfer",onClick:h,children:" Delete"})]}),be={fontSize:"0.85rem",padding:"0.5rem"};return p?u.jsx(Si,{actionName:m,onSubmit:se,children:u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[u.jsxs("div",{style:{display:"grid",gridTemplateColumns:"5.5rem 5.5rem 1fr 1fr 1.5fr",gap:"0.75rem",alignItems:"end"},children:[u.jsx(zt,{label:"Date",htmlFor:"transfer-date",children:u.jsx(kf,{id:"transfer-date",value:v,onChange:ce=>_(ce.target.value),required:!0,style:be,autoFocus:!0})}),u.jsx(zt,{label:"Amount",htmlFor:"transfer-amount",children:u.jsx(xo,{id:"transfer-amount",value:C,onChange:x,placeholder:"$0.00",required:!0})}),ne("from-category",M,L,"From Category"),G("from-account",S,E,"From Account"),u.jsx(zt,{label:"Description",htmlFor:"transfer-description",children:u.jsx(Ci,{id:"transfer-description",value:A,onChange:ce=>N(ce.target.value),placeholder:"e.g., Transfer",style:be})})]}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:"5.5rem 5.5rem 1fr 1fr 1.5fr",gap:"0.75rem",alignItems:"end"},children:[u.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1.2rem",opacity:.5,paddingBottom:"0.5rem"},children:""}),u.jsx("div",{}),ne("to-category",$,k,"To Category"),G("to-account",T,I,"To Account"),u.jsxs("div",{style:{display:"flex",gap:"0.75rem",alignItems:"end",paddingBottom:"0.25rem"},children:[ie,ee]})]}),B]})}):u.jsxs(Si,{actionName:m,onSubmit:se,children:[u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:[u.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[u.jsx(zt,{label:"Date",htmlFor:"transfer-date",children:u.jsx(kf,{id:"transfer-date",value:v,onChange:ce=>_(ce.target.value),required:!0,autoFocus:!0})}),u.jsx(zt,{label:"Amount",htmlFor:"transfer-amount",children:u.jsx(xo,{id:"transfer-amount",value:C,onChange:x,placeholder:"$0.00",required:!0})})]}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem",background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1rem",borderRadius:"8px"},children:[u.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"0.75rem",alignItems:"end"},children:[ne("from-category",M,L,"From Cat."),G("from-account",S,E,"From Acct.")]}),u.jsx("div",{style:{display:"flex",justifyContent:"center",fontSize:"1.5rem",opacity:.5},children:""}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"0.75rem",alignItems:"end"},children:[ne("to-category",$,k,"To Cat."),G("to-account",T,I,"To Acct.")]})]}),u.jsx(zt,{label:"Description (optional)",htmlFor:"transfer-description",children:u.jsx(Ci,{id:"transfer-description",value:A,onChange:ce=>N(ce.target.value),placeholder:"e.g., Transfer to savings"})}),u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx(qr,{id:"transfer-cleared-stacked",checked:F,onChange:ce=>q(ce.target.checked)}),u.jsx("label",{htmlFor:"transfer-cleared-stacked",style:{fontSize:"0.9rem",cursor:"pointer"},children:"Cleared (appeared in bank account)"})]}),B]}),ue]})}function Uz({transfer:t,fromCategoryName:e,toCategoryName:n,fromAccountName:r,toAccountName:i,fromAccountGroupName:o,toAccountGroupName:l,isFromCategoryNo:d,isToCategoryNo:h,isFromAccountNo:m,isToAccountNo:p,onEdit:g,onDelete:v,isMobile:_,isEvenRow:C}){const x=t.date?new Date(t.date+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"}):"",S=C?"transparent":"rgba(255,255,255,0.04)";if(_)return u.jsxs("div",{onClick:g,style:{gridColumn:"1 / -1",display:"flex",flexDirection:"column",gap:"0.5rem",padding:"0.75rem 1rem",background:S,cursor:"pointer",transition:"background 0.15s"},children:[u.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{style:{fontSize:"0.75rem",opacity:.5,fontFamily:"monospace",minWidth:"3rem"},children:x}),u.jsx("span",{style:{fontWeight:600,opacity:.8,fontFamily:"monospace"},children:qe(t.amount)}),t.cleared&&u.jsx("span",{style:{fontSize:"0.7rem",color:me.success},title:"Cleared",children:""})]})}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto 1fr",gap:"0.5rem",alignItems:"center"},children:[u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[u.jsx("span",{style:d?{fontSize:"0.7rem",opacity:.4}:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px",display:"inline-block",width:"fit-content"},children:e}),m?u.jsx("span",{style:{fontSize:"0.75rem",opacity:.4},children:r}):u.jsxs("div",{style:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px",display:"inline-flex",flexDirection:"column",gap:"0.1rem",width:"fit-content"},children:[o&&u.jsx("span",{style:{fontSize:"0.65rem",opacity:.6},children:o}),u.jsx("span",{children:r})]})]}),u.jsx("span",{style:{opacity:.5},children:""}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[u.jsx("span",{style:h?{fontSize:"0.7rem",opacity:.4}:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px",display:"inline-block",width:"fit-content"},children:n}),p?u.jsx("span",{style:{fontSize:"0.75rem",opacity:.4},children:i}):u.jsxs("div",{style:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px",display:"inline-flex",flexDirection:"column",gap:"0.1rem",width:"fit-content"},children:[l&&u.jsx("span",{style:{fontSize:"0.65rem",opacity:.6},children:l}),u.jsx("span",{children:i})]})]})]}),t.description&&u.jsx("div",{style:{fontSize:"0.75rem",opacity:.6},children:t.description})]});const E={padding:"0.6rem 0.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem"};return u.jsxs("div",{style:{gridColumn:"1 / -1",background:S,display:"grid",gridTemplateColumns:"5rem 1.5fr 7rem 1fr 6rem 1fr 3rem 4rem"},children:[u.jsx("div",{style:{...E,fontSize:"0.85rem",fontFamily:"monospace"},children:u.jsx("span",{style:{opacity:.6},children:x})}),u.jsx("div",{style:{...E,justifyContent:"flex-end",fontWeight:600,opacity:.8,fontFamily:"monospace"},children:qe(t.amount)}),u.jsx("div",{style:{...E,justifyContent:"center"},children:u.jsx("span",{style:d?{fontSize:"0.8rem",opacity:.4}:{fontSize:"0.8rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e})}),u.jsx("div",{style:{...E,overflow:"hidden"},children:m?u.jsx("span",{style:{opacity:.4,fontSize:"0.85rem"},children:r}):u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.1rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden"},children:[o&&u.jsx("span",{style:{fontSize:"0.7rem",opacity:.6,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:o}),u.jsx("span",{style:{fontSize:"0.8rem",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:r})]})}),u.jsx("div",{style:{...E,justifyContent:"center",fontSize:"1rem"},children:u.jsx("span",{style:{opacity:.5},children:""})}),u.jsx("div",{style:{...E,justifyContent:"center"},children:u.jsx("span",{style:h?{fontSize:"0.8rem",opacity:.4}:{fontSize:"0.8rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:n})}),u.jsx("div",{style:{...E,overflow:"hidden"},children:p?u.jsx("span",{style:{opacity:.4,fontSize:"0.85rem"},children:i}):u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.1rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden"},children:[l&&u.jsx("span",{style:{fontSize:"0.7rem",opacity:.6,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:l}),u.jsx("span",{style:{fontSize:"0.8rem",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:i})]})}),u.jsx("div",{style:{...E,paddingLeft:"0.5rem",overflow:"hidden"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.8rem",opacity:.6},children:t.description||""})}),u.jsx("div",{style:{...E,justifyContent:"center",color:t.cleared?me.success:"inherit",opacity:t.cleared?1:.3,fontSize:"1rem"},children:t.cleared?"":""}),u.jsxs("div",{style:{...E,justifyContent:"flex-end",gap:"0.25rem"},children:[u.jsx("button",{onClick:g,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:T=>T.currentTarget.style.opacity="1",onMouseLeave:T=>T.currentTarget.style.opacity="0.5",title:"Edit",children:""}),u.jsx("button",{onClick:v,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:T=>T.currentTarget.style.opacity="1",onMouseLeave:T=>T.currentTarget.style.opacity="0.5",title:"Delete",children:""})]})]})}const Ps={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderTop:"1px solid rgba(255,255,255,0.1)"};function Fz(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n,setCurrentYear:r,setCurrentMonthNumber:i}=Xe(),{accounts:o,accountGroups:l,categories:d,categoryGroups:h}=jn(),{month:m,isLoading:p}=Gs(t,e,n),{addTransfer:g}=BP(),{updateTransfer:v}=UP(),{deleteTransfer:_}=FP(),C=Ti(),[x,S]=D.useState(null),[E,T]=D.useState(!1),[I,M]=D.useState(null);function L(j){const P=j.account_group_id?l[j.account_group_id]:void 0;return P&&P.is_active!==null?P.is_active:j.is_active!==!1}function $(j){const P=j.account_group_id?l[j.account_group_id]:void 0;return P&&P.on_budget!==null?P.on_budget:j.on_budget!==!1}const k=Object.entries(o).filter(([,j])=>L(j)&&$(j));function A(j,P,O,X,W,H,Z,Y){if(!t)return;S(null),T(!1);const{year:se,month:B}=fm(H);(se!==e||B!==n)&&(r(se),i(B)),g(t,se,B,j,P,O,X,W,H,Z,Y).catch(G=>{S(G instanceof Error?G.message:"Failed to add transfer")})}function N(j,P,O,X,W,H,Z,Y,se){t&&(S(null),M(null),v(t,e,n,j,P,O,X,W,H,Z,Y,se).catch(B=>{S(B instanceof Error?B.message:"Failed to update transfer")}))}function F(j){t&&confirm("Are you sure you want to delete this transfer?")&&(S(null),_(t,e,n,j).catch(P=>{S(P instanceof Error?P.message:"Failed to delete transfer")}))}const q=k.length>=1&&Object.keys(d).length>=1;return u.jsxs("div",{style:{opacity:p?.5:1,transition:"opacity 0.15s ease-out",pointerEvents:p?"none":"auto"},children:[x&&u.jsx("div",{style:{background:`color-mix(in srgb, ${me.error} 15%, transparent)`,border:`1px solid ${me.error}`,borderRadius:"8px",padding:"0.75rem",marginBottom:"1rem",color:me.error},children:x}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:C?"1fr":"5rem 6rem 1fr 1fr 2rem 1fr 1fr 1fr 3rem 4rem"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"#242424",borderBottom:"1px solid rgba(255,255,255,0.15)",display:C?"block":"grid",gridTemplateColumns:C?void 0:"subgrid"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem"},children:[u.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[u.jsx("span",{style:{fontWeight:600},children:"Transfers:"}),u.jsx("span",{style:{opacity:.6,fontSize:"0.8rem"},children:"Moving money between accounts and categories within the budget"})]}),u.jsx("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:!E&&u.jsx(Ve,{actionName:"Open Add Transfer Form",onClick:()=>T(!0),disabled:!q,disabledReason:k.length===0&&Object.keys(d).length===0?"Create accounts and categories first":k.length===0?"Create an account first":"Create a category first",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:"+ Add Transfer"})})]}),!C&&u.jsxs(u.Fragment,{children:[u.jsx("div",{style:Ps,children:"Date"}),u.jsx("div",{style:{...Ps,textAlign:"right"},children:"Amount"}),u.jsx("div",{style:{...Ps,textAlign:"center"},children:"From Cat"}),u.jsx("div",{style:Ps,children:"From Acct"}),u.jsx("div",{style:Ps}),u.jsx("div",{style:{...Ps,textAlign:"center"},children:"To Cat"}),u.jsx("div",{style:Ps,children:"To Acct"}),u.jsx("div",{style:Ps,children:"Description"}),u.jsx("div",{style:{...Ps,textAlign:"center"},children:"Clr"}),u.jsx("div",{style:Ps})]})]}),!q&&u.jsx(qu,{message:"You need at least one account and one category before adding transfers.",linkText:"Manage accounts",linkTo:"/budget/settings/accounts"}),E&&u.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"1rem"},children:u.jsx(Q1,{accounts:k,accountGroups:l,categories:d,categoryGroups:h,defaultDate:hm(e,n),onSubmit:A,onCancel:()=>T(!1),submitLabel:"Add Transfer"})}),m?.transfers?.slice().sort((j,P)=>(j.date||"").localeCompare(P.date||"")).map((j,P)=>I===j.id?u.jsx("div",{style:{gridColumn:"1 / -1",padding:"0.5rem"},children:u.jsx(Q1,{accounts:k,accountGroups:l,categories:d,categoryGroups:h,initialData:j,onSubmit:(O,X,W,H,Z,Y,se,B)=>N(j.id,O,X,W,H,Z,Y,se,B),onCancel:()=>M(null),onDelete:()=>F(j.id),submitLabel:"Save"})},j.id):u.jsx(Uz,{transfer:j,fromCategoryName:at(j.from_category_id)?ko:d[j.from_category_id]?.name||"Unknown",toCategoryName:at(j.to_category_id)?ko:d[j.to_category_id]?.name||"Unknown",fromAccountName:et(j.from_account_id)?Ra:o[j.from_account_id]?.nickname||"Unknown",toAccountName:et(j.to_account_id)?Ra:o[j.to_account_id]?.nickname||"Unknown",fromAccountGroupName:et(j.from_account_id)?void 0:o[j.from_account_id]?.account_group_id?l[o[j.from_account_id].account_group_id]?.name:void 0,toAccountGroupName:et(j.to_account_id)?void 0:o[j.to_account_id]?.account_group_id?l[o[j.to_account_id].account_group_id]?.name:void 0,isFromCategoryNo:at(j.from_category_id),isToCategoryNo:at(j.to_category_id),isFromAccountNo:et(j.from_account_id),isToAccountNo:et(j.to_account_id),onEdit:()=>{j.description||`${j.amount}`,M(j.id)},onDelete:()=>F(j.id),isMobile:C,isEvenRow:P%2===0},j.id)),(!m?.transfers||m.transfers.length===0)&&!E&&u.jsx("p",{style:{gridColumn:"1 / -1",opacity:.5,fontSize:"0.9rem",textAlign:"center",padding:"1.5rem"},children:"No transfers recorded for this month"}),u.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]})]})}function W1({accounts:t,accountGroups:e,categories:n,categoryGroups:r,payees:i,initialData:o,defaultAccountId:l,defaultDate:d,onSubmit:h,onCancel:m,onDelete:p,submitLabel:g}){function v(_){h(_.amount,_.accountId,_.categoryId,_.date,_.payee,_.description,_.cleared)}return u.jsx(J0,{accounts:t,accountGroups:e,categories:n,categoryGroups:r,payees:i,initialData:o?{date:o.date,payee:o.payee,categoryId:o.category_id,accountId:o.account_id,amount:o.amount,description:o.description,cleared:o.cleared}:void 0,defaultAccountId:l,defaultDate:d,config:{showCategory:!0,showCleared:!0,showNoCategoryOption:!0,showNoAccountOption:!0,showSignToggle:!0,accountLabel:"Account",payeePlaceholder:"e.g., Bank, Interest source",descriptionPlaceholder:"e.g., Starting balance, Correction",submitLabel:g},onSubmit:v,onCancel:m,onDelete:p})}function Vz({adjustment:t,categoryName:e,accountName:n,accountGroupName:r,onEdit:i,onDelete:o,isMobile:l,isEvenRow:d}){const h=t.date?new Date(t.date+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"}):"",m=r?`${r} / ${n}`:n,p=d?"transparent":"rgba(255,255,255,0.04)";if(l)return u.jsxs("div",{onClick:i,style:{gridColumn:"1 / -1",display:"flex",flexDirection:"column",gap:"0.25rem",padding:"0.75rem 1rem",background:p,cursor:"pointer",transition:"background 0.15s"},children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{style:{fontSize:"0.75rem",opacity:.5,fontFamily:"monospace"},children:h}),t.cleared&&u.jsx("span",{style:{fontSize:"0.7rem",color:me.success},title:"Cleared",children:""})]}),u.jsx("span",{style:{fontWeight:600,color:lt(t.amount),fontFamily:"monospace"},children:Bt(t.amount)})]}),u.jsx("div",{style:{fontWeight:500,fontSize:"0.9rem"},children:t.description||"Adjustment"}),u.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap",alignItems:"center"},children:[u.jsx("span",{style:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px"},children:e}),u.jsx("span",{style:{fontSize:"0.75rem",opacity:.6},children:m})]})]});const g={padding:"0.6rem 0.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem"};return u.jsxs("div",{style:{gridColumn:"1 / -1",background:p,display:"grid",gridTemplateColumns:"5rem 1.5fr 7rem 1fr 6rem 1fr 3rem 4rem"},children:[u.jsx("div",{style:{...g,fontSize:"0.85rem",fontFamily:"monospace"},children:u.jsx("span",{style:{opacity:.6},children:h})}),u.jsx("div",{style:{...g,justifyContent:"center"},children:u.jsx("span",{style:{fontSize:"0.8rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e})}),u.jsx("div",{style:{...g,overflow:"hidden"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.85rem",opacity:.7},children:m})}),u.jsx("div",{style:{...g,justifyContent:"flex-end",fontWeight:600,color:lt(t.amount),fontFamily:"monospace"},children:Bt(t.amount)}),u.jsx("div",{style:{...g,paddingLeft:"0.5rem",overflow:"hidden"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.8rem",opacity:.6},children:t.description||""})}),u.jsx("div",{style:{...g,justifyContent:"center",color:t.cleared?me.success:"inherit",opacity:t.cleared?1:.3,fontSize:"1rem"},children:t.cleared?"":""}),u.jsxs("div",{style:{...g,justifyContent:"flex-end",gap:"0.25rem"},children:[u.jsx("button",{onClick:i,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:v=>v.currentTarget.style.opacity="1",onMouseLeave:v=>v.currentTarget.style.opacity="0.5",title:"Edit",children:""}),u.jsx("button",{onClick:o,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:v=>v.currentTarget.style.opacity="1",onMouseLeave:v=>v.currentTarget.style.opacity="0.5",title:"Delete",children:""})]})]})}const go={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderTop:"1px solid rgba(255,255,255,0.1)"};function $z(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n,setCurrentYear:r,setCurrentMonthNumber:i}=Xe(),{accounts:o,accountGroups:l,categories:d,categoryGroups:h}=jn(),{month:m,isLoading:p}=Gs(t,e,n),{addAdjustment:g}=$P(),{updateAdjustment:v}=HP(),{deleteAdjustment:_}=GP(),C=Ti(),[x,S]=D.useState(null),[E,T]=D.useState(!1),[I,M]=D.useState(null),k=z0(t,{enabled:E||I!==null}).data||[];function A(O){const X=O.account_group_id?l[O.account_group_id]:void 0;return X&&X.is_active!==null?X.is_active:O.is_active!==!1}function N(O){const X=O.account_group_id?l[O.account_group_id]:void 0;return X&&X.on_budget!==null?X.on_budget:O.on_budget!==!1}const F=Object.entries(o).filter(([,O])=>A(O)&&N(O));function q(O,X,W,H,Z,Y,se){if(!t)return;S(null),T(!1);const{year:B,month:G}=fm(H);(B!==e||G!==n)&&(r(B),i(G)),g(t,B,G,O,X,W,H,Z,Y,se).catch(ne=>{S(ne instanceof Error?ne.message:"Failed to add adjustment")})}function j(O,X,W,H,Z,Y,se,B){t&&(S(null),M(null),v(t,e,n,O,X,W,H,Z,Y,se,B).catch(G=>{S(G instanceof Error?G.message:"Failed to update adjustment")}))}function P(O){t&&confirm("Are you sure you want to delete this adjustment?")&&(S(null),_(t,e,n,O).catch(X=>{S(X instanceof Error?X.message:"Failed to delete adjustment")}))}return u.jsxs("div",{style:{opacity:p?.5:1,transition:"opacity 0.15s ease-out",pointerEvents:p?"none":"auto"},children:[x&&u.jsx("div",{style:{background:`color-mix(in srgb, ${me.error} 15%, transparent)`,border:`1px solid ${me.error}`,borderRadius:"8px",padding:"0.75rem",marginBottom:"1rem",color:me.error},children:x}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:C?"1fr":"5rem 1fr 1fr 6rem 1.5fr 3rem 4rem"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"#242424",borderBottom:"1px solid rgba(255,255,255,0.15)",display:C?"block":"grid",gridTemplateColumns:C?void 0:"subgrid"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem"},children:[u.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[u.jsx("span",{style:{fontWeight:600},children:"Adjustments:"}),u.jsx("span",{style:{opacity:.6,fontSize:"0.8rem"},children:"Incoming or outgoing transactions that should bypass income and spend calculations"})]}),u.jsx("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:!E&&u.jsx(Ve,{actionName:"Open Add Adjustment Form",onClick:()=>T(!0),disabled:Object.keys(d).length===0&&F.length===0,disabledReason:"Create an account or category first",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:"+ Add Adjustment"})})]}),!C&&u.jsxs(u.Fragment,{children:[u.jsx("div",{style:go,children:"Date"}),u.jsx("div",{style:{...go,textAlign:"center"},children:"Category"}),u.jsx("div",{style:go,children:"Account"}),u.jsx("div",{style:{...go,textAlign:"right"},children:"Amount"}),u.jsx("div",{style:go,children:"Description"}),u.jsx("div",{style:{...go,textAlign:"center"},children:"Clr"}),u.jsx("div",{style:go})]})]}),F.length===0&&Object.keys(d).length===0&&u.jsx(qu,{message:"You need to create at least one account or category before adding adjustments.",linkText:"Manage accounts",linkTo:"/budget/settings/accounts"}),E&&u.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"1rem"},children:u.jsx(W1,{accounts:F,accountGroups:l,categories:d,categoryGroups:h,payees:k,defaultDate:hm(e,n),onSubmit:q,onCancel:()=>T(!1),submitLabel:"Add Adjustment"})}),m?.adjustments?.slice().sort((O,X)=>(O.date||"").localeCompare(X.date||"")).map((O,X)=>I===O.id?u.jsx("div",{style:{gridColumn:"1 / -1",padding:"0.5rem"},children:u.jsx(W1,{accounts:F,accountGroups:l,categories:d,categoryGroups:h,payees:k,initialData:O,onSubmit:(W,H,Z,Y,se,B,G)=>j(O.id,W,H,Z,Y,se,B,G),onCancel:()=>M(null),onDelete:()=>P(O.id),submitLabel:"Save"})},O.id):u.jsx(Vz,{adjustment:O,categoryName:at(O.category_id)?ko:d[O.category_id]?.name||"Unknown Category",accountName:et(O.account_id)?Ra:o[O.account_id]?.nickname||"Unknown Account",accountGroupName:et(O.account_id)?void 0:o[O.account_id]?.account_group_id?l[o[O.account_id].account_group_id]?.name:void 0,onEdit:()=>{O.description||`${O.amount}`,M(O.id)},onDelete:()=>P(O.id),isMobile:C,isEvenRow:X%2===0},O.id)),(!m?.adjustments||m.adjustments.length===0)&&!E&&u.jsx("p",{style:{gridColumn:"1 / -1",opacity:.5,fontSize:"0.9rem",textAlign:"center",padding:"1.5rem"},children:"No adjustments recorded for this month"}),u.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]})]})}function qz({isOpen:t,onClose:e,onDeleted:n}){const{addLoadingHold:r,removeLoadingHold:i}=Gn(),{selectedBudgetId:o,currentYear:l,currentMonthNumber:d}=Xe(),{deleteAllocations:h}=YT(),[m,p]=D.useState(null),g=async()=>{if(o){p(null),r("allocations-delete","Deleting allocations...");try{await h({budgetId:o,year:l,month:d}),e(),n?.()}catch(v){p(v instanceof Error?v.message:"Failed to delete allocations")}finally{i("allocations-delete")}}};return u.jsxs(cs,{isOpen:t,onClose:e,title:"Delete Allocations",children:[m&&u.jsx(mm,{message:m,onDismiss:()=>p(null)}),u.jsx("p",{style:{margin:"0 0 1.5rem 0"},children:"Are you sure you want to delete all allocations for this month? This will remove all allocated amounts and reset the month to unfinalized."}),u.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[u.jsx(Ve,{actionName:"Cancel Delete Allocations",variant:"secondary",onClick:e,children:"Cancel"}),u.jsx(Ve,{actionName:"Confirm Delete Allocations",variant:"danger",onClick:g,children:"Delete Allocations"})]})]})}function rA({isDraftMode:t,isEditingAppliedAllocations:e,availableNow:n,currentMonthIncome:r,balanceTotals:i,draftChangeAmount:o,availableAfterApply:l,currentDraftTotal:d}){const h=t&&d!==void 0?d:i.allocated;return u.jsxs(u.Fragment,{children:[u.jsx("span",{style:{fontWeight:600,marginRight:"0.25rem"},children:t||e?"Allocations Worksheet:":"Month Summary:"}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:t?"Avail: ":"Inc: "}),t?u.jsx("span",{style:{color:lt(n),fontWeight:600},children:qe(n)}):u.jsxs("span",{style:{color:me.success,fontWeight:600},children:["+",qe(r)]})]}),u.jsxs("span",{children:[t&&u.jsx("span",{style:{opacity:.6},children:" "}),u.jsx("span",{style:{opacity:.6},children:t?"Draft: ":"Alloc: "}),u.jsxs("span",{style:{color:pc(t?h:i.allocated),fontWeight:600,...t?ls:{}},children:[t?"":"+",qe(t?h:i.allocated)]}),e&&o!==0&&u.jsxs("span",{style:{fontSize:"0.85em",color:o>0?me.warning:me.success,marginLeft:"0.25rem"},children:["(",Bt(o),")"]})]}),!t&&u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"Spent: "}),u.jsx("span",{style:{color:mc(i.spent),fontWeight:600},children:La(i.spent)})]}),u.jsxs("span",{children:[t&&u.jsx("span",{style:{opacity:.6},children:"= "}),u.jsx("span",{style:{opacity:.6},children:t?"Remaining: ":"Net: "}),t?u.jsx("span",{style:{color:lt(l),fontWeight:600,...ls},children:qe(l)}):u.jsx("span",{style:{color:lt(i.allocated+i.spent),fontWeight:600},children:qe(i.allocated+i.spent)})]})]})}function Hz({totals:t}){return u.jsxs(u.Fragment,{children:[u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"Start: "}),u.jsx("span",{style:{color:lt(t.start),fontWeight:600},children:qe(t.start)})]}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"Inc: "}),u.jsxs("span",{style:{color:me.success,fontWeight:600},children:["+",qe(t.income)]})]}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"Exp: "}),u.jsx("span",{style:{color:mc(t.expenses),fontWeight:600},children:La(t.expenses)})]}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"End: "}),u.jsx("span",{style:{color:lt(t.end),fontWeight:600},children:qe(t.end)})]})]})}function e_({isDraftMode:t,isEditingAppliedAllocations:e,allocationsFinalized:n,onSave:r,onApply:i,onEdit:o,onCancel:l,onDelete:d}){return u.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:[t&&!e&&u.jsxs(u.Fragment,{children:[u.jsx(Ve,{actionName:"Save Draft Allocations",onClick:r,variant:"secondary",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:" Save"}),u.jsx(Ve,{actionName:"Apply Allocations",onClick:i,variant:"secondary",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:" Apply"})]}),!t&&n&&u.jsx(Ve,{actionName:"Edit Allocations",onClick:o,variant:"secondary",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:" Edit Allocations"}),e&&u.jsxs(u.Fragment,{children:[u.jsx(Ve,{actionName:"Apply Allocations",onClick:i,variant:"secondary",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:" Apply"}),u.jsx(Ve,{actionName:"Cancel Edit Allocations",onClick:l,variant:"secondary",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:""}),u.jsx(Ve,{actionName:"Open Delete Allocations Modal",onClick:d,variant:"secondary",style:{fontSize:"0.8rem",padding:"0.4em 0.8em",color:me.error},children:""})]})]})}function K1(t){return t===0?me.zero:t>0?me.success:me.error}function Gz({category:t,balance:e,localAllocation:n,previousMonthIncome:r,isDraftMode:i,onAllocationChange:o,projectedAllTime:l}){const d=t.default_monthly_type==="percentage"&&t.default_monthly_amount!==void 0&&t.default_monthly_amount>0,h=d?t.default_monthly_amount/100*r:0,m=d?h.toFixed(2):n,p=i&&!d,g=i?l:t.balance??0,v=t.balance??0,_=v<0,C=_?Math.abs(v):0,x=d?h:parseFloat(n)||0,S=_?Math.min(x,C):0,E=_?Math.max(0,x-C):0,T=_&&x>0&&E>0;return u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",padding:"0.75rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem"},children:u.jsx("span",{style:{fontWeight:500},children:t.name})}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr 1fr 1fr",gap:"0.25rem",fontSize:"0.75rem"},children:[u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:"Start"}),u.jsx("span",{style:{color:un(e.start_balance)},children:mr(e.start_balance)})]}),u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:"Alloc"}),p?u.jsxs(u.Fragment,{children:[u.jsx("input",{type:"text",inputMode:"decimal",value:m?`$${m}`:"",onChange:I=>{const M=I.target.value.replace(/[^\d.]/g,"");o(M)},placeholder:"$0",style:{width:"100%",maxWidth:"80px",padding:"0.25rem 0.35rem",borderRadius:"4px",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",background:"color-mix(in srgb, currentColor 8%, transparent)",fontSize:"0.8rem",color:"inherit",boxSizing:"border-box"}}),_&&x>0&&u.jsxs("div",{style:{fontSize:"0.65rem",marginTop:"0.15rem",lineHeight:1.3},children:[u.jsxs("span",{style:{color:me.debt,display:"block"},children:[qe(S),"  debt"]}),T&&u.jsxs("span",{style:{color:me.success,display:"block"},children:[qe(E),"  balance"]})]})]}):u.jsx("span",{style:{color:pc(e.allocated)},children:Bt(e.allocated)})]}),u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:"Spent"}),u.jsx("span",{style:{color:mc(e.spent)},children:La(e.spent)})]}),u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:"End"}),u.jsx("span",{style:{color:un(e.end_balance),...i&&!d?ls:{}},children:mr(e.end_balance)})]}),u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:i?"Proj. All-Time":"All-Time"}),u.jsx("span",{style:{color:un(g),...i&&!d?ls:{}},children:mr(g)})]})]}),(e.transfers!==0||e.adjustments!==0)&&u.jsxs("div",{style:{marginTop:"0.5rem",paddingTop:"0.5rem",borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)",display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",fontSize:"0.7rem",opacity:.7},children:[e.transfers!==0&&u.jsxs("span",{style:{color:K1(e.transfers)},children:[Bt(e.transfers)," transfers"]}),e.adjustments!==0&&u.jsxs("span",{style:{color:K1(e.adjustments)},children:[Bt(e.adjustments)," adjust"]})]}),i&&d&&u.jsx("div",{style:{marginTop:"0.5rem"},children:u.jsxs("span",{style:{fontSize:"0.8rem"},children:[u.jsxs("span",{style:{opacity:.6},children:[qe(r),"  "]}),u.jsxs("span",{style:{color:me.success},children:[t.default_monthly_amount,"%"]}),u.jsx("span",{style:{opacity:.6},children:" = "}),u.jsx("span",{style:{color:me.success},children:qe(h)})]})})]})}function Nf(t){return t===0?me.zero:t>0?me.success:me.error}function Y1({name:t,categories:e,groupTotals:n,getCategoryBalance:r,localAllocations:i,savedAllocations:o,previousMonthIncome:l,isDraftMode:d,onAllocationChange:h,isMobile:m,isUngrouped:p,getAllocationAmount:g,gridTemplateColumns:v}){const _={paddingTop:"0.6rem",paddingBottom:"0.6rem",paddingLeft:"0.5rem",paddingRight:"0.5rem",marginTop:"1.25rem",borderTop:"1px solid rgba(255,255,255,0.2)",borderBottom:Ia,background:"rgba(255,255,255,0.04)",display:"flex",alignItems:"center",fontSize:"0.9rem",fontWeight:600},C=n.allocated+n.spent+n.transfers+n.adjustments,x=e.reduce((S,[E,T])=>{const I=T.balance??0;if(d){const M=g(E,T),L=o[E]??0,$=M-L;return S+I+$}return S+I},0);return u.jsxs("div",{style:{display:"contents"},children:[!m&&u.jsxs(u.Fragment,{children:[u.jsxs("div",{style:{..._,paddingLeft:"0.5rem",opacity:p?.7:1},children:[u.jsx("span",{children:t}),u.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",e.length,")"]})]}),u.jsx("div",{style:{..._,justifyContent:"flex-end",color:un(n.start)},children:Kt.showGroupTotals}),u.jsx("div",{style:{..._,justifyContent:d?"center":"flex-end",color:pc(n.allocated)},children:Kt.showGroupTotals}),u.jsx("div",{style:{..._,justifyContent:"flex-end",color:mc(n.spent)},children:Kt.showGroupTotals}),u.jsx("div",{style:{..._,justifyContent:"flex-end",color:Nf(n.transfers)},children:Kt.showGroupTotals}),u.jsx("div",{style:{..._,justifyContent:"flex-end",color:Nf(n.adjustments)},children:Kt.showGroupTotals}),u.jsx("div",{style:{..._,justifyContent:"flex-end",color:un(C)},children:Kt.showGroupTotals}),u.jsx("div",{style:{..._,justifyContent:"flex-end",color:un(n.end),paddingRight:"1rem",borderRight:"2px solid rgba(128, 128, 128, 0.4)"},children:Kt.showGroupTotals}),u.jsx("div",{style:{..._,justifyContent:"flex-end",color:un(x)},children:Kt.showGroupTotals})]}),!d&&m&&u.jsxs("div",{style:{gridColumn:"1 / -1",paddingTop:"0.6rem",paddingBottom:"0.6rem",paddingLeft:"0.5rem",paddingRight:"0.5rem",marginTop:"1.25rem",borderTop:"1px solid rgba(255,255,255,0.2)",borderBottom:Ia,background:"rgba(255,255,255,0.04)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[u.jsxs("span",{style:{fontWeight:600,opacity:p?.7:1},children:[t,u.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",e.length,")"]})]}),Kt.showGroupTotals]}),e.map(([S,E],T)=>{const I=r(S);if(!I)return null;const M=E.balance??0;let L=M;if(d){const $=g(S,E),k=o[S]??0,A=$-k;L=M+A}return m?u.jsx("div",{style:{gridColumn:"1 / -1"},children:u.jsx(Gz,{category:E,balance:I,localAllocation:i[S]||"",previousMonthIncome:l,isDraftMode:d,onAllocationChange:$=>h(S,$),projectedAllTime:L})},S):u.jsx(Qz,{category:E,balance:I,localAllocation:i[S]||"",previousMonthIncome:l,isDraftMode:d,onAllocationChange:$=>h(S,$),allTimeBalance:L,isEvenRow:T%2===0,gridTemplateColumns:v},S)})]})}function Qz({category:t,balance:e,localAllocation:n,previousMonthIncome:r,isDraftMode:i,onAllocationChange:o,allTimeBalance:l,isEvenRow:d,gridTemplateColumns:h}){const m=t.default_monthly_type==="percentage"&&t.default_monthly_amount!==void 0&&t.default_monthly_amount>0,p=m?t.default_monthly_amount/100*r:0,g=m?p.toFixed(2):n,v=t.balance??0,_=v<0,C=_?Math.abs(v):0,x=m?p:parseFloat(n)||0,S=_?Math.min(x,C):0,E=_?Math.max(0,x-C):0,T=_&&x>0&&E>0,I=d?"transparent":"rgba(255,255,255,0.04)",M={paddingTop:"0.6rem",paddingBottom:"0.6rem",paddingLeft:"0.5rem",paddingRight:"0.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem",minHeight:"2.4rem",boxSizing:"border-box"},L=e.allocated+e.spent+e.transfers+e.adjustments;return u.jsxs("div",{style:{gridColumn:"1 / -1",background:I,display:"grid",gridTemplateColumns:h},children:[u.jsx("div",{style:{paddingTop:"0.6rem",paddingBottom:"0.6rem",paddingRight:"0.5rem",paddingLeft:"1.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem",fontWeight:500,overflow:"hidden",borderLeft:"2px solid rgba(255,255,255,0.1)",minHeight:"2.4rem",boxSizing:"border-box"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.name})}),u.jsx("div",{style:{...M,justifyContent:"flex-end",color:un(e.start_balance)},children:mr(e.start_balance)}),i?u.jsx("div",{style:{...M,justifyContent:"center",flexDirection:"column",gap:"0.1rem",paddingTop:"0.35rem",paddingBottom:"0.35rem"},children:m?u.jsxs("span",{style:{fontSize:"0.85rem"},children:[u.jsxs("span",{style:{color:me.success},children:[t.default_monthly_amount,"%"]}),u.jsx("span",{style:{opacity:.5},children:" = "}),u.jsx("span",{style:{color:me.success},children:qe(p)})]}):u.jsxs(u.Fragment,{children:[u.jsx("input",{type:"text",inputMode:"decimal",value:g?`$${g}`:"",onChange:$=>{const k=$.target.value.replace(/[^\d.]/g,"");o(k)},placeholder:"$0.00",style:{width:"100px",padding:"0.2rem 0.5rem",borderRadius:"4px",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"0.9rem",lineHeight:1,color:"inherit",boxSizing:"border-box"}}),_&&x>0&&u.jsxs("div",{style:{fontSize:"0.6rem",whiteSpace:"nowrap",textAlign:"center",lineHeight:1.3,display:"flex",flexDirection:"column",alignItems:"center"},children:[u.jsxs("span",{style:{color:me.debt},children:[qe(S),"  debt"]}),T&&u.jsxs("span",{style:{color:me.success},children:[qe(E),"  bal"]})]})]})}):(()=>{const $=e.start_balance<0,k=$?Math.abs(e.start_balance):0,A=$?Math.min(e.allocated,k):0,N=$?Math.max(0,e.allocated-k):0,F=$&&e.allocated>0;return u.jsxs("div",{style:{...M,justifyContent:"flex-end",flexDirection:"column",alignItems:"flex-end",gap:"0.1rem",color:pc(e.allocated)},children:[u.jsxs("span",{children:["+",qe(e.allocated)]}),F&&u.jsxs("div",{style:{fontSize:"0.6rem",whiteSpace:"nowrap",textAlign:"right",lineHeight:1.3,display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[u.jsxs("span",{style:{color:me.debt},children:[qe(A),"  debt"]}),N>0&&u.jsxs("span",{style:{color:me.success},children:[qe(N),"  bal"]})]})]})})(),u.jsx("div",{style:{...M,justifyContent:"flex-end",color:mc(e.spent)},children:La(e.spent)}),u.jsx("div",{style:{...M,justifyContent:"flex-end",color:Nf(e.transfers)},children:Bt(e.transfers)}),u.jsx("div",{style:{...M,justifyContent:"flex-end",color:Nf(e.adjustments)},children:Bt(e.adjustments)}),u.jsx("div",{style:{...M,justifyContent:"flex-end",color:un(L),...i&&!m?ls:{}},children:Bt(L)}),u.jsx("div",{style:{...M,justifyContent:"flex-end",fontWeight:600,color:un(e.end_balance),paddingRight:"1rem",borderRight:"2px solid rgba(128, 128, 128, 0.4)",...i&&!m?ls:{}},children:mr(e.end_balance)}),u.jsx("div",{style:{...M,justifyContent:"flex-end",color:un(l),...i&&!m?ls:{}},children:mr(l)})]})}function Wz(t,e){const{includeHidden:n=!1}={},r=Object.entries(t).filter(([,i])=>n||!i.is_hidden).reduce((i,[o,l])=>{const d=l.category_group_id||"ungrouped";return i[d]||(i[d]=[]),i[d].push([o,l]),i},{});return Object.keys(r).forEach(i=>{r[i].sort((o,l)=>o[1].sort_order-l[1].sort_order)}),r}function Kz(t,e,n,r,i){const o={};t?.category_balances&&t.category_balances.forEach(d=>{o[d.category_id]=d});const l={};return Object.entries(e).forEach(([d,h])=>{const m=o[d],p=m?.start_balance??0,g=m?.spent??0;let v=0;n?v=i(d,h):r&&m&&(v=m.allocated);let _=0;t?.transfers&&t.transfers.forEach(x=>{x.to_category_id===d&&(_+=x.amount),x.from_category_id===d&&(_-=x.amount)});let C=0;t?.adjustments&&(C=t.adjustments.filter(x=>x.category_id===d).reduce((x,S)=>x+S.amount,0)),l[d]={category_id:d,start_balance:p,allocated:v,spent:g,transfers:_,adjustments:C,end_balance:p+v+g+_+C}}),l}function Yz(t,e){const n={};t?.account_balances&&t.account_balances.forEach(i=>{n[i.account_id]=i});const r={};return Object.entries(e).forEach(([i,o])=>{const d=n[i]?.start_balance??o.balance;let h=0;t?.income&&(h=t.income.filter(_=>_.account_id===i).reduce((_,C)=>_+C.amount,0));let m=0;t?.expenses&&(m=t.expenses.filter(_=>_.account_id===i).reduce((_,C)=>_+C.amount,0));let p=0;t?.transfers&&t.transfers.forEach(_=>{_.to_account_id===i&&(p+=_.amount),_.from_account_id===i&&(p-=_.amount)});let g=0;t?.adjustments&&(g=t.adjustments.filter(_=>_.account_id===i).reduce((_,C)=>_+C.amount,0));const v=h+m+p+g;r[i]={account_id:i,start_balance:d,income:h,expenses:m,transfers:p,adjustments:g,net_change:v,end_balance:d+v}}),r}function Xz(t){return Object.values(t).reduce((e,n)=>({start:e.start+n.start_balance,income:e.income+n.income,expenses:e.expenses+n.expenses,transfers:e.transfers+n.transfers,adjustments:e.adjustments+n.adjustments,netChange:e.netChange+n.net_change,end:e.end+n.end_balance}),{start:0,income:0,expenses:0,transfers:0,adjustments:0,netChange:0,end:0})}function Zz(t){return Object.values(t).reduce((e,n)=>({start:e.start+n.start_balance,allocated:e.allocated+n.allocated,spent:e.spent+n.spent,transfers:e.transfers+n.transfers,adjustments:e.adjustments+n.adjustments,end:e.end+n.end_balance}),{start:0,allocated:0,spent:0,transfers:0,adjustments:0,end:0})}function sA(t,e){const n={},r={};return t?.account_balances&&t.account_balances.forEach(i=>{r[i.account_id]=i}),t?(Object.entries(e).forEach(([i,o])=>{const d=r[i]?.start_balance??o.balance;let h=0,m=0;t?.income&&t.income.filter(T=>T.account_id===i).forEach(T=>{m+=T.amount,h+=T.amount});let p=0,g=0;t?.expenses&&t.expenses.filter(T=>T.account_id===i).forEach(T=>{g+=T.amount,T.cleared===!0&&(p+=T.amount)});let v=0,_=0;t?.transfers&&t.transfers.forEach(T=>{T.to_account_id===i&&(_+=T.amount,T.cleared===!0&&(v+=T.amount)),T.from_account_id===i&&(_-=T.amount,T.cleared===!0&&(v-=T.amount))});let C=0,x=0;t?.adjustments&&t.adjustments.filter(T=>T.account_id===i).forEach(T=>{x+=T.amount,T.cleared===!0&&(C+=T.amount)});const S=h+p+v+C,E=m+g+_+x;n[i]={account_id:i,cleared_balance:d+S,uncleared_balance:d+E}}),n):(Object.entries(e).forEach(([i,o])=>{n[i]={account_id:i,cleared_balance:o.balance??0,uncleared_balance:o.balance??0}}),n)}function X1(t){return t===0?me.zero:t>0?me.success:me.error}function Jz({isDraftMode:t,allocationsFinalized:e,balanceTotals:n,grandAllTime:r,onSave:i,onApply:o,onEdit:l,onCancel:d,onDelete:h}){const m={paddingTop:"0.6rem",paddingBottom:"0.6rem",paddingLeft:"0.5rem",paddingRight:"0.5rem",borderTop:"2px solid rgba(255,255,255,0.3)",borderBottom:"2px solid rgba(255,255,255,0.3)",fontWeight:600,display:"flex",alignItems:"center",fontSize:"0.9rem"},p=n.allocated+n.spent+n.transfers+n.adjustments;return u.jsxs(u.Fragment,{children:[u.jsxs("div",{style:{...m,gap:"0.75rem"},children:["Grand Totals",!t&&u.jsx(e_,{isDraftMode:!1,isEditingAppliedAllocations:!1,allocationsFinalized:e,onSave:i,onApply:o,onEdit:l,onCancel:d,onDelete:h})]}),u.jsx("div",{style:{...m,justifyContent:"flex-end",color:un(n.start)},children:mr(n.start)}),u.jsxs("div",{style:{...m,justifyContent:t?"center":"flex-end",color:pc(n.allocated),...t?ls:{}},children:["+",qe(n.allocated)]}),u.jsx("div",{style:{...m,justifyContent:"flex-end",color:mc(n.spent)},children:La(n.spent)}),u.jsx("div",{style:{...m,justifyContent:"flex-end",color:X1(n.transfers)},children:Bt(n.transfers)}),u.jsx("div",{style:{...m,justifyContent:"flex-end",color:X1(n.adjustments)},children:Bt(n.adjustments)}),u.jsx("div",{style:{...m,justifyContent:"flex-end",color:un(p),...t?ls:{}},children:Bt(p)}),u.jsx("div",{style:{...m,justifyContent:"flex-end",color:un(n.end),paddingRight:"1rem",borderRight:"2px solid rgba(128, 128, 128, 0.4)",...t?ls:{}},children:mr(n.end)}),u.jsx("div",{style:{...m,justifyContent:"flex-end",color:un(r),...t?ls:{}},children:mr(r)})]})}function eB({allocationsFinalized:t,availableNow:e,currentMonthIncome:n,balanceTotals:r,draftChangeAmount:i,availableAfterApply:o,currentDraftTotal:l,onSave:d,onApply:h,onEdit:m,onCancel:p,onDelete:g}){return u.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem",borderTop:"2px solid rgba(255,255,255,0.3)",borderBottom:"2px solid rgba(255,255,255,0.3)"},children:[u.jsx("span",{style:{fontWeight:600},children:"Grand Totals:"}),u.jsx(rA,{isDraftMode:!1,isEditingAppliedAllocations:!1,availableNow:e,currentMonthIncome:n,balanceTotals:r,draftChangeAmount:i,availableAfterApply:o,currentDraftTotal:l}),u.jsx(e_,{isDraftMode:!1,isEditingAppliedAllocations:!1,allocationsFinalized:t,onSave:d,onApply:h,onEdit:m,onCancel:p,onDelete:g})]})}const hi={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderBottom:"2px solid rgba(255,255,255,0.2)"};function tB(t){if(!t)return"";switch(t.phase){case"reading-budget":return"Reading budget data...";case"fetching-months":return"Fetching months...";case"recalculating":return t.currentMonth?`Recalculating ${t.currentMonth}...`:"Recalculating...";case"saving":return"Saving results...";case"complete":return"Recalculation complete!";default:return"Recalculating balances..."}}function nB(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n}=Xe(),{categories:r,categoryGroups:i,monthMap:o}=jn(),{month:l}=Gs(t,e,n),d=Ti(),[h,m]=D.useState(null);od({budgetId:t,year:e,month:n,monthMap:o,requireMonthLoaded:!0,currentMonth:l,onProgress:G=>m(G),logPrefix:"[MonthCategories]"});const[p,g]=D.useState(!1),{localAllocations:v,isEditingAppliedAllocations:_,error:C,availableNow:x,currentDraftTotal:S,draftChangeAmount:E,availableAfterApply:T,previousMonthIncome:I,currentMonthIncome:M,allocationsFinalized:L,getAllocationAmount:$,handleAllocationChange:k,resetAllocationsToSaved:A,handleSaveAllocations:N,handleFinalizeAllocations:F,setIsEditingAppliedAllocations:q,setError:j}=X4(),P=[...i].sort((G,ne)=>G.sort_order-ne.sort_order),O=D.useMemo(()=>Wz(r),[r]),X=!L||_,W=D.useMemo(()=>Kz(l,r,X,L,$),[l,r,X,L,$]),H=G=>W[G],Z=D.useMemo(()=>Zz(W),[W]),Y=D.useMemo(()=>{const G={};if(l?.category_balances)for(const ne of l.category_balances)G[ne.category_id]=ne.allocated;return G},[l]),se=D.useMemo(()=>Object.entries(r).reduce((G,[ne,ie])=>{const ee=ie.balance??0;if(X){const ue=$(ne,ie),be=Y[ne]??0,ce=ue-be;return G+ee+ce}return G+ee},0),[r,X,$,Y]),B={onSave:N,onApply:F,onEdit:()=>q(!0),onCancel:A,onDelete:()=>g(!0)};return u.jsxs(u.Fragment,{children:[h&&u.jsxs(Y0,{message:tB(h),spinnerColor:"#22c55e",children:[u.jsx(tA,{percent:h.percentComplete,gradient:"linear-gradient(90deg, #22c55e, #10b981)"}),u.jsxs("div",{style:{display:"flex",gap:"2rem",justifyContent:"center",flexWrap:"wrap"},children:[(h.totalMonthsToFetch??0)>0&&u.jsx(Mf,{value:`${h.monthsFetched||0}/${h.totalMonthsToFetch}`,label:"Months Loaded",color:h.phase==="fetching-months"?"#22c55e":"#6b7280"}),(h.totalMonths??0)>0&&u.jsx(Mf,{value:`${h.monthsProcessed}/${h.totalMonths}`,label:"Months Recalculated",color:h.phase==="recalculating"?"#22c55e":"#6b7280"})]}),u.jsx(nA,{percent:h.percentComplete})]}),C&&u.jsx(mm,{message:C,onDismiss:()=>j(null)}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:d?"1fr":X?"2fr 1fr 200px 1fr 1fr 1fr 1fr 1fr 120px":"2fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 120px"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"#242424",display:d?"block":"grid",gridTemplateColumns:d?void 0:"subgrid"},children:[X&&u.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexDirection:d?"column":"row",flexWrap:"wrap",alignItems:d?"stretch":"center",gap:d?"0.5rem":"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:d?"0.5rem":"0.25rem"},children:[u.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:d?void 0:1,alignItems:"center"},children:u.jsx(rA,{isDraftMode:X,isEditingAppliedAllocations:_,availableNow:x,currentMonthIncome:M,balanceTotals:Z,draftChangeAmount:E,availableAfterApply:T,currentDraftTotal:S})}),u.jsx(e_,{isDraftMode:X,isEditingAppliedAllocations:_,allocationsFinalized:L,...B})]}),!d&&u.jsxs(u.Fragment,{children:[u.jsx("div",{style:hi,children:"Category"}),u.jsx("div",{style:{...hi,textAlign:"right"},children:"Start"}),u.jsx("div",{style:{...hi,textAlign:X?"center":"right"},children:"Allocated"}),u.jsx("div",{style:{...hi,textAlign:"right"},children:"Spent"}),u.jsx("div",{style:{...hi,textAlign:"right"},children:"Transfers"}),u.jsx("div",{style:{...hi,textAlign:"right"},children:"Adjust"}),u.jsx("div",{style:{...hi,textAlign:"right"},children:"Net Change"}),u.jsx("div",{style:{...hi,textAlign:"right",paddingRight:"1rem",borderRight:"2px solid rgba(128, 128, 128, 0.4)"},children:"End"}),u.jsx("div",{style:{...hi,textAlign:"right"},children:"All-Time"})]}),!d&&u.jsx(Jz,{isDraftMode:X,allocationsFinalized:L,balanceTotals:Z,grandAllTime:se,...B}),!X&&d&&u.jsx(eB,{allocationsFinalized:L,availableNow:x,currentMonthIncome:M,balanceTotals:Z,draftChangeAmount:E,availableAfterApply:T,currentDraftTotal:S,...B})]}),Object.keys(r).length===0&&u.jsxs("p",{style:{gridColumn:"1 / -1",opacity:.6,textAlign:"center",padding:"2rem"},children:["No categories yet. ",u.jsx(Tn,{to:"/budget/settings/categories",style:{opacity:1},children:"Create categories "})]}),P.map(G=>{const ne=O[G.id]||[];if(ne.length===0)return null;const ie=ne.reduce((ee,[ue])=>{const be=H(ue);return be?{start:ee.start+be.start_balance,allocated:ee.allocated+be.allocated,spent:ee.spent+be.spent,transfers:ee.transfers+be.transfers,adjustments:ee.adjustments+be.adjustments,end:ee.end+be.end_balance}:ee},{start:0,allocated:0,spent:0,transfers:0,adjustments:0,end:0});return u.jsx(Y1,{name:G.name,categories:ne,groupTotals:ie,getCategoryBalance:H,localAllocations:v,savedAllocations:Y,previousMonthIncome:I,isDraftMode:X,onAllocationChange:k,isMobile:d,getAllocationAmount:$,gridTemplateColumns:X?"2fr 1fr 200px 1fr 1fr 1fr 1fr 1fr 120px":"2fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 120px"},G.id)}),O[ln]?.length>0&&(()=>{const G=O[ln],ne=G.reduce((ie,[ee])=>{const ue=H(ee);return ue?{start:ie.start+ue.start_balance,allocated:ie.allocated+ue.allocated,spent:ie.spent+ue.spent,transfers:ie.transfers+ue.transfers,adjustments:ie.adjustments+ue.adjustments,end:ie.end+ue.end_balance}:ie},{start:0,allocated:0,spent:0,transfers:0,adjustments:0,end:0});return u.jsx(Y1,{name:"Uncategorized",categories:G,groupTotals:ne,getCategoryBalance:H,localAllocations:v,savedAllocations:Y,previousMonthIncome:I,isDraftMode:X,onAllocationChange:k,isMobile:d,isUngrouped:!0,getAllocationAmount:$,gridTemplateColumns:X?"2fr 1fr 200px 1fr 1fr 1fr 1fr 1fr 120px":"2fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 120px"},ln)})(),u.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]}),u.jsx(qz,{isOpen:p,onClose:()=>g(!1),onDeleted:()=>q(!1)})]})}function iA(t){return t===0?me.zero:t>0?me.success:me.error}function aA(t){return t===0?me.zero:t<0?me.error:me.success}function ma(t){return t===0?me.zero:t>0?me.success:me.error}function Z1({name:t,accounts:e,groupTotals:n,accountBalances:r,accountClearedBalances:i,isMobile:o,isUngrouped:l}){const d={padding:"0.6rem 0.5rem",marginTop:"1.25rem",borderTop:"1px solid rgba(255,255,255,0.2)",borderBottom:Ia,background:"rgba(255,255,255,0.04)",display:"flex",alignItems:"center",fontSize:"0.9rem",fontWeight:600};return u.jsxs("div",{style:{display:"contents"},children:[!o&&u.jsxs(u.Fragment,{children:[u.jsxs("div",{style:{...d,opacity:l?.7:1},children:[u.jsx("span",{children:t}),u.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",e.length,")"]})]}),u.jsx("div",{style:{...d,justifyContent:"flex-end",color:lt(n.start)},children:Kt.showGroupTotals}),u.jsx("div",{style:{...d,justifyContent:"flex-end",color:iA(n.income)},children:Kt.showGroupTotals}),u.jsx("div",{style:{...d,justifyContent:"flex-end",color:aA(n.expenses)},children:Kt.showGroupTotals}),u.jsx("div",{style:{...d,justifyContent:"flex-end",color:ma(n.transfers)},children:Kt.showGroupTotals}),u.jsx("div",{style:{...d,justifyContent:"flex-end",color:ma(n.adjustments)},children:Kt.showGroupTotals}),u.jsx("div",{style:{...d,justifyContent:"flex-end",color:ma(n.netChange)},children:Kt.showGroupTotals}),u.jsx("div",{style:{...d,justifyContent:"flex-end",color:lt(n.end)},children:Kt.showGroupTotals}),u.jsx("div",{style:{...d,justifyContent:"flex-end"},children:Kt.showGroupTotals}),u.jsx("div",{style:{...d,justifyContent:"flex-end"},children:Kt.showGroupTotals}),u.jsx("div",{style:{...d,justifyContent:"flex-end"},children:Kt.showGroupTotals})]}),o&&u.jsxs("div",{style:{gridColumn:"1 / -1",padding:"0.6rem 0.5rem",marginTop:"1.25rem",borderTop:"1px solid rgba(255,255,255,0.2)",borderBottom:Ia,background:"rgba(255,255,255,0.04)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[u.jsxs("span",{style:{fontWeight:600,opacity:l?.7:1},children:[t,u.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",e.length,")"]})]}),Kt.showGroupTotals]}),e.map(([h,m],p)=>{const g=r[h];if(!g)return null;const v=i?.[h];return o?u.jsx("div",{style:{gridColumn:"1 / -1"},children:u.jsx(sB,{account:m,balance:g,clearedBalance:v})},h):u.jsx(rB,{account:m,balance:g,clearedBalance:v,isEvenRow:p%2===0},h)})]})}function rB({account:t,balance:e,clearedBalance:n,isEvenRow:r}){const i=r?"transparent":"rgba(255,255,255,0.04)",o={padding:"0.5rem 0.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem"};return u.jsxs("div",{style:{gridColumn:"1 / -1",background:i,display:"grid",gridTemplateColumns:"2fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr"},children:[u.jsx("div",{style:{...o,fontWeight:500,overflow:"hidden",paddingLeft:"1.5rem",borderLeft:"2px solid rgba(255,255,255,0.1)"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.nickname})}),u.jsx("div",{style:{...o,justifyContent:"flex-end",color:lt(e.start_balance)},children:qe(e.start_balance)}),u.jsxs("div",{style:{...o,justifyContent:"flex-end",color:iA(e.income)},children:["+",qe(e.income)]}),u.jsx("div",{style:{...o,justifyContent:"flex-end",color:aA(e.expenses)},children:La(e.expenses)}),u.jsx("div",{style:{...o,justifyContent:"flex-end",color:ma(e.transfers)},children:Bt(e.transfers)}),u.jsx("div",{style:{...o,justifyContent:"flex-end",color:ma(e.adjustments)},children:Bt(e.adjustments)}),u.jsx("div",{style:{...o,justifyContent:"flex-end",color:ma(e.net_change)},children:Bt(e.net_change)}),u.jsx("div",{style:{...o,justifyContent:"flex-end",fontWeight:600,color:lt(e.end_balance)},children:qe(e.end_balance)}),n?u.jsx("div",{style:{...o,justifyContent:"flex-end",color:lt(n.uncleared_balance),fontWeight:600},children:qe(n.uncleared_balance)}):u.jsx("div",{style:{...o,justifyContent:"flex-end",opacity:.3,color:"#9ca3af"},children:""}),n?u.jsx("div",{style:{...o,justifyContent:"flex-end",color:lt(n.cleared_balance)},children:Math.abs(n.uncleared_balance-n.cleared_balance)<.01?u.jsx("span",{style:{opacity:.3,color:"#9ca3af"},children:""}):qe(n.cleared_balance)}):u.jsx("div",{style:{...o,justifyContent:"flex-end",opacity:.3,color:"#9ca3af"},children:""}),n&&Math.abs(n.uncleared_balance-n.cleared_balance)>=.01?u.jsx("div",{style:{...o,justifyContent:"flex-end",color:ma(n.uncleared_balance-n.cleared_balance)},children:Bt(n.uncleared_balance-n.cleared_balance)}):u.jsx("div",{style:{...o,justifyContent:"flex-end",opacity:.3,color:"#9ca3af"},children:""})]})}function sB({account:t,balance:e,clearedBalance:n}){return u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",padding:"0.75rem",marginBottom:"0.25rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem"},children:u.jsx("span",{style:{fontWeight:500},children:t.nickname})}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:n&&Math.abs(n.uncleared_balance-n.cleared_balance)>=.01?"1fr 1fr 1fr 1fr":"1fr 1fr 1fr",gap:"0.25rem",fontSize:"0.75rem"},children:[u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:"Start"}),u.jsx("span",{children:qe(e.start_balance)})]}),u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:"Net Change"}),u.jsx("span",{style:{color:lt(e.net_change)},children:Bt(e.net_change)})]}),u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:"End"}),u.jsx("span",{style:{color:lt(e.end_balance)},children:qe(e.end_balance)})]}),n&&u.jsxs(u.Fragment,{children:[u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:"Total"}),u.jsx("span",{style:{color:lt(n.uncleared_balance),fontWeight:600},children:qe(n.uncleared_balance)})]}),Math.abs(n.uncleared_balance-n.cleared_balance)>=.01?u.jsxs(u.Fragment,{children:[u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:"Cleared"}),u.jsx("span",{style:{color:lt(n.cleared_balance)},children:qe(n.cleared_balance)})]}),u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:"Uncleared"}),u.jsx("span",{style:{color:ma(n.uncleared_balance-n.cleared_balance)},children:Bt(n.uncleared_balance-n.cleared_balance)})]})]}):u.jsxs(u.Fragment,{children:[u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:"Cleared"}),u.jsx("span",{style:{opacity:.3,color:"#9ca3af"},children:""})]}),u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:"Uncleared"}),u.jsx("span",{style:{opacity:.3,color:"#9ca3af"},children:""})]})]})]})]}),(e.income!==0||e.expenses!==0||e.transfers!==0||e.adjustments!==0)&&u.jsxs("div",{style:{marginTop:"0.5rem",paddingTop:"0.5rem",borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)",display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",fontSize:"0.7rem",opacity:.7},children:[e.income!==0&&u.jsxs("span",{children:[Bt(e.income)," income"]}),e.expenses!==0&&u.jsxs("span",{children:[La(e.expenses)," expenses"]}),e.transfers!==0&&u.jsxs("span",{children:[Bt(e.transfers)," transfers"]}),e.adjustments!==0&&u.jsxs("span",{children:[Bt(e.adjustments)," adjust"]})]})]})}const is={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderBottom:"2px solid rgba(255,255,255,0.2)"};function iB(t){return t===0?me.zero:t>0?me.success:me.error}function aB(t){return t===0?me.zero:t<0?me.error:me.success}function Wg(t){return t===0?me.zero:t>0?me.success:me.error}function oB(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n}=Xe(),{accounts:r,accountGroups:i,monthMap:o}=jn(),{month:l}=Gs(t,e,n),d=Ti(),[h,m]=D.useState(null);od({budgetId:t,year:e,month:n,monthMap:o,requireMonthLoaded:!0,currentMonth:l,onProgress:I=>m(I),logPrefix:"[MonthAccounts]"});const p=D.useMemo(()=>Object.entries(i).map(([I,M])=>({id:I,...M})).sort((I,M)=>I.sort_order-M.sort_order),[i]),g=D.useMemo(()=>{const I={};return Object.entries(r).filter(([,M])=>!M.is_hidden).forEach(([M,L])=>{const $=L.account_group_id||Zt;I[$]||(I[$]=[]),I[$].push([M,L])}),Object.keys(I).forEach(M=>{I[M].sort((L,$)=>L[1].sort_order-$[1].sort_order)}),I},[r]),v=D.useMemo(()=>Yz(l,r),[l,r]),_=D.useMemo(()=>sA(l,r),[l,r]),C=D.useMemo(()=>Xz(v),[v]),x=C.income+C.expenses,E={...{padding:"0.6rem 0.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem"},borderTop:"2px solid rgba(255,255,255,0.3)",borderBottom:"2px solid rgba(255,255,255,0.3)",fontWeight:600},T=()=>{if(!h)return"";switch(h.phase){case"reading-budget":return"Reading budget data...";case"fetching-months":return"Fetching months...";case"recalculating":return h.currentMonth?`Recalculating ${h.currentMonth}...`:"Recalculating...";case"saving":return"Saving results...";case"complete":return"Recalculation complete!";default:return"Recalculating balances..."}};return u.jsxs(u.Fragment,{children:[h&&u.jsxs(Y0,{message:T(),spinnerColor:"#22c55e",children:[u.jsx(tA,{percent:h.percentComplete,gradient:"linear-gradient(90deg, #22c55e, #10b981)"}),u.jsxs("div",{style:{display:"flex",gap:"2rem",justifyContent:"center",flexWrap:"wrap"},children:[(h.totalMonthsToFetch??0)>0&&u.jsx(Mf,{value:`${h.monthsFetched||0}/${h.totalMonthsToFetch}`,label:"Months Loaded",color:h.phase==="fetching-months"?"#22c55e":"#6b7280"}),(h.totalMonths??0)>0&&u.jsx(Mf,{value:`${h.monthsProcessed}/${h.totalMonths}`,label:"Months Recalculated",color:h.phase==="recalculating"?"#22c55e":"#6b7280"})]}),u.jsx(nA,{percent:h.percentComplete})]}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:d?"1fr":"2fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"#242424",display:d?"block":"grid",gridTemplateColumns:d?void 0:"subgrid"},children:[!d&&u.jsxs(u.Fragment,{children:[u.jsx("div",{style:is,children:"Account"}),u.jsx("div",{style:{...is,textAlign:"right"},children:"Start"}),u.jsx("div",{style:{...is,textAlign:"right"},children:"Income"}),u.jsx("div",{style:{...is,textAlign:"right"},children:"Expenses"}),u.jsx("div",{style:{...is,textAlign:"right"},children:"Transfers"}),u.jsx("div",{style:{...is,textAlign:"right"},children:"Adjust"}),u.jsx("div",{style:{...is,textAlign:"right"},children:"Net Change"}),u.jsx("div",{style:{...is,textAlign:"right"},children:"End"}),u.jsx("div",{style:{...is,textAlign:"right"},children:"Total"}),u.jsx("div",{style:{...is,textAlign:"right"},children:"Cleared"}),u.jsx("div",{style:{...is,textAlign:"right"},children:"Uncleared"})]}),d?u.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem",borderTop:"2px solid rgba(255,255,255,0.3)",borderBottom:"2px solid rgba(255,255,255,0.3)"},children:[u.jsx("span",{style:{fontWeight:600},children:"Grand Totals:"}),u.jsx(Hz,{totals:C})]}):u.jsxs(u.Fragment,{children:[u.jsx("div",{style:{...E},children:"Grand Totals"}),u.jsx("div",{style:{...E,justifyContent:"flex-end",color:lt(C.start)},children:qe(C.start)}),u.jsxs("div",{style:{...E,justifyContent:"flex-end",color:iB(C.income)},children:["+",qe(C.income)]}),u.jsx("div",{style:{...E,justifyContent:"flex-end",color:aB(C.expenses)},children:La(C.expenses)}),u.jsx("div",{style:{...E,justifyContent:"flex-end",color:Wg(C.transfers)},children:Bt(C.transfers)}),u.jsx("div",{style:{...E,justifyContent:"flex-end",color:Wg(C.adjustments)},children:Bt(C.adjustments)}),u.jsx("div",{style:{...E,justifyContent:"flex-end",color:Wg(x)},children:Bt(x)}),u.jsx("div",{style:{...E,justifyContent:"flex-end",color:lt(C.end)},children:qe(C.end)}),u.jsx("div",{style:{...E,justifyContent:"flex-end"},children:Object.keys(_).length>0?qe(Object.values(_).reduce((I,M)=>I+M.uncleared_balance,0)):u.jsx("span",{style:{opacity:.3,color:"#9ca3af"},children:""})}),u.jsx("div",{style:{...E,justifyContent:"flex-end"},children:(()=>{if(Object.keys(_).length===0)return u.jsx("span",{style:{opacity:.3,color:"#9ca3af"},children:""});const I=Object.values(_).reduce((L,$)=>L+$.cleared_balance,0),M=Object.values(_).reduce((L,$)=>L+$.uncleared_balance,0);return Math.abs(M-I)<.01?u.jsx("span",{style:{opacity:.3,color:"#9ca3af"},children:""}):qe(I)})()}),u.jsx("div",{style:{...E,justifyContent:"flex-end"},children:(()=>{if(Object.keys(_).length===0)return u.jsx("span",{style:{opacity:.3,color:"#9ca3af"},children:""});const I=Object.values(_).reduce(($,k)=>$+k.cleared_balance,0),L=Object.values(_).reduce(($,k)=>$+k.uncleared_balance,0)-I;return Math.abs(L)<.01?u.jsx("span",{style:{opacity:.3,color:"#9ca3af"},children:""}):Bt(L)})()})]})]}),Object.keys(r).length===0&&u.jsxs("p",{style:{gridColumn:"1 / -1",opacity:.6,textAlign:"center",padding:"2rem"},children:["No accounts yet."," ",u.jsx(Tn,{to:"/budget/settings/accounts",style:{opacity:1},children:"Add accounts "})]}),p.map(I=>{const M=g[I.id]||[];if(M.length===0)return null;const L=M.reduce(($,[k])=>{const A=v[k];return A?{start:$.start+A.start_balance,income:$.income+A.income,expenses:$.expenses+A.expenses,transfers:$.transfers+A.transfers,adjustments:$.adjustments+A.adjustments,netChange:$.netChange+A.net_change,end:$.end+A.end_balance}:$},{start:0,income:0,expenses:0,transfers:0,adjustments:0,netChange:0,end:0});return u.jsx(Z1,{name:I.name,accounts:M,groupTotals:L,accountBalances:v,accountClearedBalances:_,isMobile:d},I.id)}),g[Zt]?.length>0&&(()=>{const I=g[Zt],M=I.reduce((L,[$])=>{const k=v[$];return k?{start:L.start+k.start_balance,income:L.income+k.income,expenses:L.expenses+k.expenses,transfers:L.transfers+k.transfers,adjustments:L.adjustments+k.adjustments,netChange:L.netChange+k.net_change,end:L.end+k.end_balance}:L},{start:0,income:0,expenses:0,transfers:0,adjustments:0,netChange:0,end:0});return u.jsx(Z1,{name:"Ungrouped",accounts:I,groupTotals:M,accountBalances:v,accountClearedBalances:_,isMobile:d,isUngrouped:!0},Zt)})(),u.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]})]})}const lB=["income","categories","accounts","spend","transfers","adjustments"];function J1(t){const e=t.year?parseInt(t.year,10):null,n=t.month?parseInt(t.month,10):null,r=t.tab&&lB.includes(t.tab)?t.tab:null;return{year:e&&!isNaN(e)&&e>=2e3&&e<=2100?e:null,month:n&&!isNaN(n)&&n>=1&&n<=12?n:null,tab:r}}function cB(){const t=new Date;return{year:t.getFullYear(),month:t.getMonth()+1}}function eS(){const t=D5(),e=Gu(),[n,r]=AS(),{addLoadingHold:i,removeLoadingHold:o}=Gn(),{selectedBudgetId:l,setSelectedBudgetId:d,currentYear:h,currentMonthNumber:m,lastActiveTab:p,setCurrentYear:g,setCurrentMonthNumber:v,setLastActiveTab:_,setPageTitle:C,goToPreviousMonth:x,goToNextMonth:S,hasPendingInvites:E,needsFirstBudget:T,initialDataLoadComplete:I}=Xe(),{budget:M,isLoading:L,monthMap:$}=jn(),k=!L,[A,N]=D.useState(!1);D.useEffect(()=>(!k||!I?i("budget-data","Loading budget data..."):o("budget-data"),()=>o("budget-data")),[k,I,i,o]);const F=D.useRef(!1),q=n.get("error"),[j,P]=D.useState(q);D.useEffect(()=>{q&&(n.delete("error"),r(n,{replace:!0}))},[q,n,r]);const[O,X]=D.useState(()=>{const{tab:ne}=J1(t);return ne??p}),W=ne=>{X(ne),_(ne)};D.useEffect(()=>{if(F.current)return;const{year:ne,month:ie}=J1(t);ne&&g(ne),ie&&v(ie),F.current=!0},[t,g,v]),D.useEffect(()=>{if(!F.current)return;const ne=`/budget/${h}/${m}/${O}`,ie=`/budget/${t.year}/${t.month}/${t.tab}`;ne!==ie&&e(ne,{replace:!0})},[h,m,O,e,t]);const{month:H,error:Z,isLoading:Y}=Gs(k?l:null,h,m);D.useEffect(()=>{if(!Z||A)return;const ne=Z.message||"";if(ne.includes("Budget")&&ne.includes("does not exist")){queueMicrotask(()=>{d(null),e("/budget/my-budgets?context=budget-not-found",{replace:!0})});return}(ne.includes("months in the past")||ne.includes("Refusing to create month"))&&queueMicrotask(()=>{i("month-redirect","Redirecting to current month..."),N(!0);const{year:ie,month:ee}=cB();P(`Cannot create month ${h}/${m} - it's too far in the past. Redirected to current month.`),g(ie),v(ee)})},[Z,A,h,m,g,v,i,d,e]),D.useEffect(()=>{A&&H&&!Y&&queueMicrotask(()=>{N(!1),o("month-redirect")})},[A,H,Y,o]),D.useLayoutEffect(()=>{C(M?.name||"Budget")},[M?.name,C]);const{setCurrentViewingDocument:se}=Xe();if(D.useEffect(()=>(M&&h&&m&&se({type:"month",year:h,month:m}),()=>{se({type:null})}),[M,h,m,se]),D.useEffect(()=>{if(k&&!A){if(!M&&!l){e("/budget/my-budgets",{replace:!0});return}if(!M&&E){e("/budget/my-budgets",{replace:!0});return}if(T){e("/budget/my-budgets",{replace:!0});return}}},[k,A,M,l,E,T,e]),h3(l,h,m),od({budgetId:l,year:h,month:m,monthMap:$,additionalCondition:k&&!!M,logPrefix:"[Budget]"}),!k||!I||A||!M)return null;function B(){P(null),x()}function G(){P(null),S()}return u.jsxs(u.Fragment,{children:[j&&u.jsx(mm,{message:j,onDismiss:()=>P(null)}),u.jsx(Rz,{onPreviousMonth:B,onNextMonth:G}),u.jsx(yz,{activeTab:O,setActiveTab:W,allocationsFinalized:H?.are_allocations_finalized}),O==="income"&&u.jsx(Mz,{},`${h}-${m}`),O==="categories"&&u.jsx(nB,{},`${h}-${m}`),O==="accounts"&&u.jsx(oB,{},`${h}-${m}`),O==="spend"&&u.jsx(Pz,{},`${h}-${m}`),O==="transfers"&&u.jsx(Fz,{},`${h}-${m}`),O==="adjustments"&&u.jsx($z,{},`${h}-${m}`)]})}function uB(){const{setPageTitle:t}=Xe();return D.useLayoutEffect(()=>{t("Analytics")},[t]),u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"50vh",textAlign:"center",gap:"1.5rem"},children:[u.jsx("div",{style:{fontSize:"4rem",opacity:.8},children:""}),u.jsx("h1",{style:{margin:0,fontSize:"2rem",fontWeight:600},children:"Analytics"}),u.jsx("p",{style:{margin:0,fontSize:"1.25rem",opacity:.6,maxWidth:"400px"},children:"Coming Soon"}),u.jsx("p",{style:{margin:0,fontSize:"0.95rem",opacity:.5,maxWidth:"500px",lineHeight:1.6},children:"Track spending trends, category breakdowns, and insights about your budget over time."}),u.jsx(Tn,{to:"/budget",style:{marginTop:"1rem",padding:"0.75rem 1.5rem",background:me.primary,color:"white",borderRadius:"8px",textDecoration:"none",fontWeight:500,transition:"opacity 0.15s"},children:"Back to Budget"})]})}function dB(){const t=Vt();return{createBudget:Hn({mutationFn:async({name:n,userId:r,userEmail:i})=>{const o=`budget_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,l=new Date().toISOString(),d={name:n.trim()||"My Budget",user_ids:[r],accepted_user_ids:[r],owner_id:r,owner_email:i,accounts:{},account_groups:{[Zt]:{name:"Ungrouped",sort_order:0,expected_balance:"positive",on_budget:null,is_active:null}},categories:{},category_groups:[{id:ln,name:"Uncategorized",sort_order:0}],total_available:0,is_needs_recalculation:!1,month_map:{},created_at:l,updated_at:l};return await qn("budgets",o,d,"creating new budget document"),await qn("users",r,{uid:r,email:i,budget_ids:Lu(o),updated_at:l},"adding new budget to user's budget list",{merge:!0}),{budgetId:o,budget:{id:o,...d}}},onSuccess:(n,{userId:r})=>{t.invalidateQueries({queryKey:ke.user(r)}),t.invalidateQueries({queryKey:ke.accessibleBudgets(r)})}})}}function hB(){const t=Vt();return{acceptInvite:Hn({mutationFn:async({budgetId:n,userId:r})=>{const i=new Date().toISOString(),{exists:o,data:l}=await jt("budgets",n,"validating user was invited to this budget");if(!o||!l)throw new Error("Budget not found");if(!l.user_ids?.includes(r))throw new Error("You have not been invited to this budget");if(l.accepted_user_ids?.includes(r))throw new Error("You have already accepted this invite");return await qn("users",r,{uid:r,budget_ids:Lu(n),updated_at:i},"adding accepted budget to user's budget list",{merge:!0}),await qn("budgets",n,{accepted_user_ids:Lu(r),updated_at:i},"marking user as accepted in budget's accepted_user_ids",{merge:!0}),{budgetId:n}},onSuccess:(n,{userId:r})=>{t.invalidateQueries({queryKey:ke.user(r)}),t.invalidateQueries({queryKey:ke.accessibleBudgets(r)}),t.invalidateQueries({queryKey:ke.budget(n.budgetId)})}})}}function fB(){const t=Vt(),e=Hn({onMutate:async r=>{const{budgetId:i,userId:o}=r,l=ke.budget(i);await t.cancelQueries({queryKey:l});const d=t.getQueryData(l);return d&&t.setQueryData(l,{...d,budget:{...d.budget,user_ids:[...d.budget.user_ids,o]}}),{previousData:d}},mutationFn:async r=>{const{budgetId:i,userId:o}=r,{exists:l,data:d}=await jt("budgets",i,"validating user is not already invited");if(!l||!d)throw new Error("Budget not found");if(d.user_ids?.includes(o))throw new Error("User is already invited");return await gm({budgetId:i,updates:{user_ids:Lu(o)},description:"adding user to budget's invited users list"}),{budgetId:i}},onError:(r,i,o)=>{o?.previousData&&t.setQueryData(ke.budget(i.budgetId),o.previousData)}});return{inviteUser:{mutate:r=>e.mutate(r),mutateAsync:r=>e.mutateAsync(r),isPending:e.isPending,isError:e.isError,error:e.error,reset:e.reset}}}function mB(){const t=Vt(),e=Hn({onMutate:async r=>{const{budgetId:i,userId:o}=r,l=ke.budget(i);await t.cancelQueries({queryKey:l});const d=t.getQueryData(l);return d&&t.setQueryData(l,{...d,budget:{...d.budget,user_ids:d.budget.user_ids.filter(h=>h!==o),accepted_user_ids:d.budget.accepted_user_ids.filter(h=>h!==o)}}),{previousData:d}},mutationFn:async r=>{const{budgetId:i,userId:o}=r;return await gm({budgetId:i,updates:{user_ids:T1(o),accepted_user_ids:T1(o)},description:"removing user from budget's access lists"}),{budgetId:i}},onError:(r,i,o)=>{o?.previousData&&t.setQueryData(ke.budget(i.budgetId),o.previousData)}});return{revokeUser:{mutate:r=>e.mutate(r),mutateAsync:r=>e.mutateAsync(r),isPending:e.isPending,isError:e.isError,error:e.error,reset:e.reset}}}function pB({message:t,onDismiss:e}){return u.jsxs("div",{style:{background:"rgba(220, 38, 38, 0.1)",border:"1px solid rgba(220, 38, 38, 0.3)",color:"#f87171",padding:"0.75rem 1rem",borderRadius:"8px",marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[u.jsx("span",{children:t}),u.jsx("button",{onClick:e,style:{background:"transparent",border:"none",color:"#f87171",cursor:"pointer",fontSize:"1.2rem",padding:"0 0.25rem",lineHeight:1},children:""})]})}function gB({message:t,onDismiss:e}){return u.jsxs("div",{style:{background:"rgba(34, 197, 94, 0.1)",border:"1px solid rgba(34, 197, 94, 0.3)",color:"#4ade80",padding:"0.75rem 1rem",borderRadius:"8px",marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[u.jsx("span",{children:t}),u.jsx("button",{onClick:e,style:{background:"transparent",border:"none",color:"#4ade80",cursor:"pointer",fontSize:"1.2rem",padding:"0 0.25rem",lineHeight:1},children:""})]})}function yB({budgetIdInput:t,setBudgetIdInput:e,isCheckingManual:n,manualInvite:r,isAccepting:i,onCheckInvite:o,onAcceptInvite:l,onCancel:d}){return u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px"},children:[u.jsxs("h3",{style:{margin:"0 0 0.75rem 0",fontSize:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{children:""})," Join Budget by ID"]}),u.jsx("p",{style:{margin:"0 0 1rem 0",fontSize:"0.9rem",opacity:.7},children:"If someone shared a budget ID with you, enter it below to accept the invitation:"}),r?u.jsxs("div",{style:{background:"color-mix(in srgb, #22c55e 10%, transparent)",border:"1px solid color-mix(in srgb, #22c55e 30%, transparent)",padding:"1rem",borderRadius:"8px"},children:[u.jsx("p",{style:{margin:"0 0 0.75rem 0",fontWeight:500},children:" You've been invited to join:"}),u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 8%, transparent)",padding:"0.75rem 1rem",borderRadius:"6px",marginBottom:"1rem"},children:[u.jsx("p",{style:{margin:"0 0 0.25rem 0",fontWeight:600,fontSize:"1.1rem"},children:r.budgetName}),r.ownerEmail&&u.jsxs("p",{style:{margin:0,fontSize:"0.9rem",opacity:.7},children:["Owner: ",r.ownerEmail]})]}),u.jsxs("div",{style:{display:"flex",gap:"0.75rem"},children:[u.jsx("button",{onClick:l,disabled:i===r.budgetId,style:{background:"#22c55e",color:"white",border:"none",padding:"0.6rem 1.25rem",borderRadius:"6px",cursor:i===r.budgetId?"not-allowed":"pointer",fontWeight:500,opacity:i===r.budgetId?.7:1},children:i===r.budgetId?"Accepting...":"Accept Invitation"}),u.jsx("button",{onClick:d,disabled:i===r.budgetId,style:{background:"transparent",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)",padding:"0.6rem 1.25rem",borderRadius:"6px",cursor:i===r.budgetId?"not-allowed":"pointer",fontWeight:500,opacity:i===r.budgetId?.7:.8},children:"Cancel"})]})]}):u.jsxs("form",{onSubmit:o,style:{display:"flex",gap:"0.75rem"},children:[u.jsx("input",{type:"text",value:t,onChange:h=>e(h.target.value),placeholder:"Enter Budget ID",style:{flex:1,padding:"0.6rem 0.8rem",borderRadius:"6px",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"0.95rem",color:"inherit"}}),u.jsx("button",{type:"submit",disabled:n||!t.trim(),style:{background:"#646cff",color:"white",border:"none",padding:"0.6rem 1.25rem",borderRadius:"6px",cursor:n||!t.trim()?"not-allowed":"pointer",fontWeight:500,opacity:n||!t.trim()?.7:1,whiteSpace:"nowrap"},children:n?"Checking...":"Check Invite"})]})]})}function _B({currentUserId:t}){return u.jsxs("div",{style:{marginTop:"1.5rem",padding:"1rem",background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"6px",fontSize:"0.85rem",opacity:.7},children:[u.jsx("p",{style:{margin:"0 0 0.5rem 0"},children:" Share your User ID with budget owners so they can invite you:"}),u.jsx("code",{style:{display:"block",padding:"0.5rem 0.75rem",background:"color-mix(in srgb, currentColor 8%, transparent)",borderRadius:"4px",fontSize:"0.8rem",wordBreak:"break-all"},children:t})]})}function bB(){const{addLoadingHold:t,removeLoadingHold:e}=Gn(),{selectedBudgetId:n,currentUserId:r,accessibleBudgets:i,loadAccessibleBudgets:o,switchToBudget:l,checkBudgetInvite:d,isInitialized:h,setPageTitle:m,needsFirstBudget:p}=Xe(),{requireUserEmail:g}=Oa(),v=D.useRef(!1),[_,C]=AS(),x=_.get("context");D.useEffect(()=>{x&&(_.delete("context"),C(_,{replace:!0}))},[x,_,C]);const S=x==="budget-not-found",E=p&&i.length===0;D.useLayoutEffect(()=>{m("My Budgets")},[m]),D.useEffect(()=>{h&&!v.current&&(v.current=!0,o())},[h,o]);const{budget:T,isLoading:I}=jn(),{renameBudget:M}=W4(),{acceptInvite:L}=hB(),{createBudget:$}=dB(),[k,A]=D.useState(null),[N,F]=D.useState(null),[q,j]=D.useState(null),[P,O]=D.useState(null),[X,W]=D.useState(null),[H,Z]=D.useState(""),[Y,se]=D.useState(!1),[B,G]=D.useState(""),[ne,ie]=D.useState(!1),[ee,ue]=D.useState(null),[be,ce]=D.useState(""),[ve,ze]=D.useState(!1);async function Pe(ae){if(ae!==T?.id){A(ae),j(null),O(null);try{await l(ae),O("Switched to budget successfully!"),await o({force:!0})}catch(Ae){j(Ae instanceof Error?Ae.message:"Failed to switch budget")}finally{A(null)}}}async function ot(ae){if(r){F(ae),j(null),O(null);try{await L.mutateAsync({budgetId:ae,userId:r}),O("Invitation accepted! You now have access to this budget."),await o({force:!0})}catch(Ae){j(Ae instanceof Error?Ae.message:"Failed to accept invitation")}finally{F(null)}}}async function _t(ae){if(ae.preventDefault(),!!B.trim()){ie(!0),j(null),ue(null);try{const Ae=await d(B.trim());Ae?ue(Ae):j("No pending invitation found for this budget ID. Make sure you've been invited by the budget owner.")}catch(Ae){j(Ae instanceof Error?Ae.message:"Failed to check invitation")}finally{ie(!1)}}}async function U(){if(!(!ee||!r)){ee.budgetName,F(ee.budgetId),j(null);try{await L.mutateAsync({budgetId:ee.budgetId,userId:r}),O(`Successfully joined "${ee.budgetName}"!`),ue(null),G(""),await o({force:!0})}catch(ae){j(ae instanceof Error?ae.message:"Failed to accept invitation")}finally{F(null)}}}function he(ae,Ae){Z(Ae),W(ae)}async function ye(ae){if(ae.preventDefault(),!(!H.trim()||!X||!n)){H.trim(),se(!0),j(null),O(null);try{await M.mutateAsync({budgetId:n,newName:H.trim()}),O("Budget renamed successfully!"),W(null),await o({force:!0})}catch(Ae){j(Ae instanceof Error?Ae.message:"Failed to rename budget")}finally{se(!1)}}}async function te(ae){if(ae.preventDefault(),!!r){be.trim(),ze(!0),j(null),O(null);try{const Ae=await $.mutateAsync({name:be.trim()||"My Budget",userId:r,userEmail:g()});await l(Ae.budgetId),O("Budget created successfully!"),ce(""),await o({force:!0})}catch(Ae){j(Ae instanceof Error?Ae.message:"Failed to create budget")}finally{ze(!1)}}}const J=i.filter(ae=>!ae.isPending),oe=i.filter(ae=>ae.isPending);if(D.useEffect(()=>(I||!h?t("my-budgets","Loading your budgets..."):e("my-budgets"),()=>e("my-budgets")),[I,h,t,e]),I||!h)return null;let Ce="My Budgets",Se="Switch between budgets, accept invitations, or create a new budget.";return S?(Ce="Budget Not Found",Se="Your selected budget could not be found. It may have been deleted. Select another budget or create a new one."):E&&(Ce="Welcome!",Se="Get started by creating your first budget or accepting an invitation."),u.jsxs("div",{children:[u.jsx("h1",{children:Ce}),u.jsx("p",{style:{opacity:.7,marginBottom:"1.5rem"},children:Se}),q&&u.jsx(pB,{message:q,onDismiss:()=>j(null)}),P&&u.jsx(gB,{message:P,onDismiss:()=>O(null)}),oe.length>0&&u.jsxs("div",{style:{background:"color-mix(in srgb, #f59e0b 10%, transparent)",border:"1px solid color-mix(in srgb, #f59e0b 30%, transparent)",padding:"1.25rem",borderRadius:"8px",marginBottom:"1.5rem"},children:[u.jsxs("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{children:""})," Pending Invitations (",oe.length,")"]}),u.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:oe.map(ae=>u.jsx(L1,{budget:ae,isCurrent:!1,isAccepting:N===ae.id,isSwitching:!1,isEditing:!1,editName:"",isRenaming:!1,onAccept:()=>ot(ae.id),onSwitch:()=>{},onStartEdit:()=>{},onCancelEdit:()=>{},onEditNameChange:()=>{},onSaveEdit:()=>{}},ae.id))})]}),J.length>0&&u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px",marginBottom:"1.5rem"},children:[u.jsxs("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{children:""})," Your Budgets (",J.length,")"]}),u.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:J.map(ae=>u.jsx(L1,{budget:ae,isCurrent:ae.id===n,isAccepting:!1,isSwitching:k===ae.id,isEditing:X===ae.id,editName:X===ae.id?H:"",isRenaming:Y,onAccept:()=>{},onSwitch:()=>Pe(ae.id),onStartEdit:()=>he(ae.id,ae.name),onCancelEdit:()=>{W(null),Z("")},onEditNameChange:Z,onSaveEdit:ye},ae.id))})]}),u.jsxs("div",{style:{background:"color-mix(in srgb, #646cff 8%, transparent)",border:"1px solid color-mix(in srgb, #646cff 25%, transparent)",padding:"1.5rem",borderRadius:"8px",marginBottom:"1.5rem"},children:[u.jsxs("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{children:""})," Create New Budget"]}),u.jsxs("form",{onSubmit:te,children:[u.jsxs("div",{style:{marginBottom:"1rem"},children:[u.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.9rem",opacity:.8},children:"Budget Name"}),u.jsx("input",{type:"text",value:be,onChange:ae=>ce(ae.target.value),placeholder:"My Budget",style:{width:"100%",padding:"0.6rem 0.8rem",borderRadius:"6px",border:"1px solid color-mix(in srgb, currentColor 25%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"0.95rem",color:"inherit",boxSizing:"border-box"}}),u.jsx("p",{style:{margin:"0.5rem 0 0 0",fontSize:"0.8rem",opacity:.5},children:"You can always rename this later"})]}),u.jsx("button",{type:"submit",disabled:ve,style:{background:me.primary,color:"white",border:"none",padding:"0.6rem 1.5rem",borderRadius:"6px",cursor:ve?"not-allowed":"pointer",fontWeight:500,opacity:ve?.7:1,fontSize:"0.9rem"},children:ve?"Creating...":"Create Budget"})]})]}),u.jsx(yB,{budgetIdInput:B,setBudgetIdInput:G,isCheckingManual:ne,manualInvite:ee,isAccepting:N,onCheckInvite:_t,onAcceptInvite:U,onCancel:()=>{ue(null),G("")}}),r&&u.jsx(_B,{currentUserId:r})]})}const vB=["accounts","categories","users"];function xB(){const{addLoadingHold:t,removeLoadingHold:e}=Gn(),{lastSettingsTab:n,setLastSettingsTab:r,setPageTitle:i,selectedBudgetId:o,setCurrentViewingDocument:l}=Xe();D.useLayoutEffect(()=>{i("Budget Settings")},[i]),D.useEffect(()=>(o&&l({type:"budget"}),()=>{l({type:null})}),[o,l]);const{isOwner:d,isLoading:h}=jn();D.useEffect(()=>(h?t("settings","Loading settings..."):e("settings"),()=>e("settings")),[h,t,e]);const m=Mn(),p=m.pathname==="/budget/settings",g=D.useMemo(()=>{const S=m.pathname;return S.includes("/settings/accounts")?"accounts":S.includes("/settings/categories")?"categories":S.includes("/settings/users")?"users":"categories"},[m.pathname]),v=g==="users";D.useEffect(()=>{p||r(g)},[g,p,r]);function _(){return!vB.includes(n)||n==="users"&&!d?"categories":n}const C=D.useMemo(()=>[{id:"accounts",label:"Accounts",icon:""},{id:"categories",label:"Categories",icon:""},{id:"users",label:"Users",icon:"",hidden:!d}],[d]);return h?null:!d&&v?u.jsxs("div",{children:[u.jsx("h1",{children:"Access Denied"}),u.jsx("p",{style:{opacity:.7},children:"Only the budget owner can access this section."}),u.jsx("p",{style:{marginTop:"1rem"},children:u.jsx(Tn,{to:"/budget/settings/categories",children:"Go to Categories "})})]}):u.jsxs("div",{children:[u.jsx(Df,{mode:"link",linkPrefix:"/budget/settings",tabs:C,activeTab:p?_():g}),p?u.jsx(zf,{to:`/budget/settings/${_()}`,replace:!0}):u.jsx(WT,{children:u.jsx(Bf,{})})]})}function t_({initialData:t,onSubmit:e,onCancel:n,submitLabel:r,accountGroups:i,showGroupSelector:o=!1,showIncomeSettings:l=!1,hasExistingIncomeDefault:d=!1,hasExistingOutgoDefault:h=!1,currentGroupId:m,onDelete:p}){const[g,v]=D.useState(t||{nickname:"",account_group_id:null,is_income_account:!1,is_income_default:!1,is_outgo_account:!1,is_outgo_default:!1,on_budget:!0,is_active:!0,is_hidden:!1}),_=g.account_group_id||m,C=_?i.find(M=>M.id===_):null,x=C?.is_active!==null,S=C?.on_budget!==null;function E(M){M.preventDefault(),g.nickname.trim()&&e(g)}function T(M){v({...g,is_income_account:M,is_income_default:M?g.is_income_default:!1})}function I(M){v({...g,is_outgo_account:M,is_outgo_default:M?g.is_outgo_default:!1})}return u.jsxs(Si,{actionName:r==="Create Account"?"Create Account":"Update Account",onSubmit:E,children:[u.jsx(zt,{label:"Account Nickname",htmlFor:"account-nickname",children:u.jsx(Ci,{id:"account-nickname",type:"text",value:g.nickname,onChange:M=>v({...g,nickname:M.target.value}),placeholder:"e.g., Main Checking, Savings",required:!0,autoFocus:!0})}),o&&u.jsx(zt,{label:"Account Type",htmlFor:"account-group",children:u.jsxs($u,{id:"account-group",value:g.account_group_id||Zt,onChange:M=>v({...g,account_group_id:M.target.value===Zt?null:M.target.value}),children:[u.jsx("option",{value:Zt,children:"Ungrouped"}),i.map(M=>u.jsx("option",{value:M.id,children:M.name},M.id))]})}),l&&u.jsxs("div",{style:{padding:"0.75rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",display:"flex",flexDirection:"column",gap:"0.75rem"},children:[u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[u.jsx("p",{style:{margin:0,fontSize:"0.85rem",opacity:.7},children:"Account Status"}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[u.jsx(qr,{id:"is-active",checked:x?C.is_active:g.is_active!==!1,onChange:M=>v({...g,is_active:M.target.checked}),disabled:x,children:u.jsx("span",{style:{opacity:x?.5:1},children:"Active account"})}),x&&u.jsxs("p",{style:{margin:0,fontSize:"0.7rem",opacity:.6,marginLeft:"2rem",color:me.warning},children:['Set by account type "',C.name,'"']})]}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[u.jsx(qr,{id:"on-budget",checked:S?C.on_budget:g.on_budget!==!1,onChange:M=>v({...g,on_budget:M.target.checked}),disabled:S,children:u.jsx("span",{style:{opacity:S?.5:1},children:"On budget (affects budget totals)"})}),S&&u.jsxs("p",{style:{margin:0,fontSize:"0.7rem",opacity:.6,marginLeft:"2rem",color:me.warning},children:['Set by account type "',C.name,'"']})]}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[u.jsx(qr,{id:"is-hidden",checked:g.is_hidden||!1,onChange:M=>v({...g,is_hidden:M.target.checked}),children:"Hidden account"}),u.jsx("p",{style:{margin:0,fontSize:"0.7rem",opacity:.6,marginLeft:"2rem"},children:"Hidden accounts don't appear in dropdowns or balance displays. Use for historical accounts that aren't actively used."})]})]}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[u.jsx("p",{style:{margin:0,fontSize:"0.85rem",opacity:.7},children:"Income Settings"}),u.jsx(qr,{id:"is-income-account",checked:g.is_income_account||!1,onChange:M=>T(M.target.checked),children:"Show in income deposit list"}),g.is_income_account&&u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem",marginLeft:"2rem"},children:[u.jsx(qr,{id:"is-income-default",checked:g.is_income_default||!1,onChange:M=>v({...g,is_income_default:M.target.checked}),disabled:d&&!t?.is_income_default,children:"Default account for new income"}),d&&!t?.is_income_default&&u.jsx("p",{style:{margin:0,fontSize:"0.75rem",opacity:.5},children:"Another account is already set as default"})]})]}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[u.jsx("p",{style:{margin:0,fontSize:"0.85rem",opacity:.7},children:"Expense Settings"}),u.jsx(qr,{id:"is-outgo-account",checked:g.is_outgo_account||!1,onChange:M=>I(M.target.checked),children:"Show in expense account list"}),g.is_outgo_account&&u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem",marginLeft:"2rem"},children:[u.jsx(qr,{id:"is-outgo-default",checked:g.is_outgo_default||!1,onChange:M=>v({...g,is_outgo_default:M.target.checked}),disabled:h&&!t?.is_outgo_default,children:"Default account for new expenses"}),h&&!t?.is_outgo_default&&u.jsx("p",{style:{margin:0,fontSize:"0.75rem",opacity:.5},children:"Another account is already set as default"})]})]})]}),u.jsxs(za,{children:[u.jsx(Ve,{type:"submit",actionName:r,children:r}),u.jsx(Ve,{type:"button",variant:"secondary",actionName:"Cancel Account Form",onClick:n,children:"Cancel"}),p&&u.jsx(Ve,{type:"button",variant:"secondary",actionName:"Delete Account",onClick:M=>{M.preventDefault(),p()},style:{color:"#ff6b6b",borderColor:"#ff6b6b"},children:" Delete"})]})]})}function tS({label:t,value:e,onChange:n,trueLabel:r,falseLabel:i,undefinedLabel:o}){function l(){n(e===void 0?!0:e===!0?!1:void 0)}const d=e===!0?r:e===!1?i:o,h=e===!0?me.success:e===!1?me.warning:"inherit",m=e===!0?"":e===!1?"":"";return u.jsxs("button",{type:"button",onClick:l,style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 0.75rem",background:e!==void 0?`color-mix(in srgb, ${h} 15%, transparent)`:"color-mix(in srgb, currentColor 8%, transparent)",border:e!==void 0?`1px solid color-mix(in srgb, ${h} 40%, transparent)`:"1px solid color-mix(in srgb, currentColor 20%, transparent)",borderRadius:"6px",cursor:"pointer",fontSize:"0.85rem",color:"inherit",textAlign:"left",width:"100%"},children:[u.jsx("span",{style:{width:"1.25rem",height:"1.25rem",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"4px",background:e!==void 0?h:"color-mix(in srgb, currentColor 20%, transparent)",color:e!==void 0?"white":"inherit",fontWeight:600,fontSize:"0.75rem"},children:m}),u.jsxs("span",{style:{flex:1},children:[u.jsxs("span",{style:{opacity:.7},children:[t,":"]})," ",u.jsx("span",{style:{fontWeight:500,color:h},children:d})]}),u.jsx("span",{style:{fontSize:"0.7rem",opacity:.5},children:"click to cycle"})]})}function nS({initialData:t,onSubmit:e,onCancel:n,submitLabel:r}){const[i,o]=D.useState(t||{name:"",expected_balance:"positive"});function l(d){d.preventDefault(),i.name.trim()&&e(i)}return u.jsxs(Si,{actionName:r==="Create Account Type"?"Create Account Type":"Update Account Type",onSubmit:l,children:[u.jsx(zt,{label:"Account Type Name",htmlFor:"group-name",children:u.jsx(Ci,{id:"group-name",type:"text",value:i.name,onChange:d=>o({...i,name:d.target.value}),placeholder:"e.g., Checking, Savings, Credit Cards, Investments",required:!0,autoFocus:!0})}),u.jsx(zt,{label:"Expected Balance",htmlFor:"expected-balance",children:u.jsxs($u,{id:"expected-balance",value:i.expected_balance,onChange:d=>o({...i,expected_balance:d.target.value}),children:[u.jsx("option",{value:"positive",children:"Normally Positive (e.g., Checking, Savings)"}),u.jsx("option",{value:"negative",children:"Normally Negative (e.g., Credit Cards, Loans)"}),u.jsx("option",{value:"any",children:"Either (no warnings)"})]})}),u.jsxs("div",{style:{padding:"0.75rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",display:"flex",flexDirection:"column",gap:"0.5rem"},children:[u.jsxs("p",{style:{margin:0,fontSize:"0.85rem",opacity:.7},children:["Group-Level Overrides ",u.jsx("span",{style:{fontSize:"0.75rem",opacity:.6},children:"(applies to all accounts in this type)"})]}),u.jsx(tS,{label:"Active status",value:i.is_active,onChange:d=>o({...i,is_active:d}),trueLabel:"All active",falseLabel:"All inactive",undefinedLabel:"Per account"}),u.jsx(tS,{label:"Budget status",value:i.on_budget,onChange:d=>o({...i,on_budget:d}),trueLabel:"All on budget",falseLabel:"All off budget",undefinedLabel:"Per account"})]}),u.jsxs(za,{children:[u.jsx(Ve,{type:"submit",actionName:r,children:r}),u.jsx(Ve,{type:"button",variant:"secondary",actionName:"Cancel Account Type Form",onClick:n,children:"Cancel"})]})]})}function Rl({icon:t,label:e,variant:n,title:r}){const o={success:{background:`color-mix(in srgb, ${me.success} 20%, transparent)`,border:`1px solid color-mix(in srgb, ${me.success} 40%, transparent)`,color:me.success,opacity:1},warning:{background:`color-mix(in srgb, ${me.warning} 15%, transparent)`,border:`1px solid color-mix(in srgb, ${me.warning} 35%, transparent)`,color:me.warning,opacity:1},muted:{background:"color-mix(in srgb, currentColor 12%, transparent)",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",color:"inherit",opacity:.7},income:{background:`color-mix(in srgb, ${me.success} 10%, transparent)`,border:`1px solid color-mix(in srgb, ${me.success} 25%, transparent)`,color:me.success,opacity:.7},expense:{background:`color-mix(in srgb, ${me.warning} 10%, transparent)`,border:`1px solid color-mix(in srgb, ${me.warning} 25%, transparent)`,color:me.warning,opacity:.7}}[n];return u.jsxs("span",{title:r||e,style:{display:"inline-flex",alignItems:"center",gap:"0.25rem",background:o.background,border:o.border,padding:"0.15rem 0.4rem",borderRadius:"4px",fontSize:"0.7rem",fontWeight:500,textTransform:"uppercase",letterSpacing:"0.3px",color:o.color,opacity:o.opacity,whiteSpace:"nowrap"},children:[u.jsx("span",{style:{fontSize:"0.75rem"},children:t}),e]})}function rS({account:t,accountGroups:e}){const n=[],r=t.account_group_id?e.find(l=>l.id===t.account_group_id):null,i=r&&r.is_active!==null?r.is_active:t.is_active!==!1,o=r&&r.on_budget!==null?r.on_budget:t.on_budget!==!1;if(!i){const l=r&&r.is_active!==null;n.push(u.jsx(Rl,{icon:"",label:l?"Inactive (type)":"Inactive",variant:"warning",title:l?`Set by "${r.name}" account type`:"Account is inactive/archived"},"inactive"))}if(!o){const l=r&&r.on_budget!==null;n.push(u.jsx(Rl,{icon:"",label:l?"Off Budget (type)":"Off Budget",variant:"warning",title:l?`Set by "${r.name}" account type`:"Tracking only - not included in budget"},"off-budget"))}return t.is_income_default?n.push(u.jsx(Rl,{icon:"",label:"Income Default",variant:"success",title:"Default income deposit account"},"income-default")):t.is_income_account&&n.push(u.jsx(Rl,{icon:"",label:"Income",variant:"income",title:"Income deposit account"},"income")),t.is_outgo_default?n.push(u.jsx(Rl,{icon:"",label:"Expense Default",variant:"warning",title:"Default expense account"},"outgo-default")):t.is_outgo_account&&n.push(u.jsx(Rl,{icon:"",label:"Expense",variant:"expense",title:"Expense account"},"outgo")),n.length===0?null:u.jsx(u.Fragment,{children:n})}function wB({account:t,accountIndex:e,allGroups:n,allAccounts:r,clearedBalance:i,onEdit:o,onDelete:l,onMoveUp:d,onMoveDown:h,canMoveUp:m,canMoveDown:p,editingAccountId:g,setEditingAccountId:v,onUpdateAccount:_,isMobile:C}){if(g===t.id)return u.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"0.5rem"},children:u.jsx(t_,{initialData:{nickname:t.nickname,account_group_id:t.account_group_id,is_income_account:t.is_income_account,is_income_default:t.is_income_default,is_outgo_account:t.is_outgo_account,is_outgo_default:t.is_outgo_default,on_budget:t.on_budget,is_active:t.is_active},onSubmit:T=>{_(t.id,T),v(null)},onCancel:()=>v(null),onDelete:()=>{t.nickname,l(t.id),v(null)},submitLabel:"Save",accountGroups:n,showGroupSelector:!0,showIncomeSettings:!0,currentGroupId:t.account_group_id,hasExistingIncomeDefault:Object.entries(r).some(([T,I])=>I.is_income_default&&T!==t.id),hasExistingOutgoDefault:Object.entries(r).some(([T,I])=>I.is_outgo_default&&T!==t.id)})});if(C)return u.jsx("div",{style:{gridColumn:"1 / -1"},children:u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",padding:"0.75rem",marginBottom:"0.25rem"},children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"},children:[u.jsx("span",{style:{fontWeight:500},children:t.nickname}),u.jsx("div",{style:{display:"flex",gap:"1rem",fontSize:"0.85rem"},children:i?u.jsxs(u.Fragment,{children:[u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[u.jsx("span",{style:{opacity:.6,fontSize:"0.7rem"},children:"Total"}),u.jsx("span",{style:{color:lt(i.uncleared_balance),fontWeight:600},children:qe(i.uncleared_balance)})]}),Math.abs(i.uncleared_balance-i.cleared_balance)>=.01?u.jsxs(u.Fragment,{children:[u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[u.jsx("span",{style:{opacity:.6,fontSize:"0.7rem"},children:"Cleared"}),u.jsx("span",{style:{color:lt(i.cleared_balance)},children:qe(i.cleared_balance)})]}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[u.jsx("span",{style:{opacity:.6,fontSize:"0.7rem"},children:"Uncleared"}),u.jsx("span",{style:{color:lt(i.uncleared_balance-i.cleared_balance)},children:qe(i.uncleared_balance-i.cleared_balance)})]})]}):u.jsxs(u.Fragment,{children:[u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[u.jsx("span",{style:{opacity:.6,fontSize:"0.7rem"},children:"Cleared"}),u.jsx("span",{style:{opacity:.3,color:"#9ca3af"},children:""})]}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[u.jsx("span",{style:{opacity:.6,fontSize:"0.7rem"},children:"Uncleared"}),u.jsx("span",{style:{opacity:.3,color:"#9ca3af"},children:""})]})]})]}):u.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:u.jsx("span",{style:{color:lt(t.balance),fontWeight:600},children:qe(t.balance)})})})]}),u.jsx("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap",marginBottom:"0.5rem"},children:u.jsx(rS,{account:t,accountGroups:n})}),u.jsxs("div",{style:{display:"flex",gap:"0.5rem",justifyContent:"flex-end"},children:[u.jsx("button",{onClick:T=>{T.stopPropagation(),t.nickname,o(t.id)},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Edit",children:""}),u.jsx("button",{onClick:T=>{T.stopPropagation(),d()},disabled:!m,style:{background:"transparent",border:"none",cursor:m?"pointer":"default",opacity:m?.6:.2,fontSize:"0.9rem",padding:"0.25rem"},title:"Move up",children:""}),u.jsx("button",{onClick:T=>{T.stopPropagation(),h()},disabled:!p,style:{background:"transparent",border:"none",cursor:p?"pointer":"default",opacity:p?.6:.2,fontSize:"0.9rem",padding:"0.25rem"},title:"Move down",children:""})]})]})});const S=e%2===0?"transparent":"rgba(255,255,255,0.04)",E={padding:"0.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem"};return u.jsxs("div",{style:{gridColumn:"1 / -1",background:S,display:"grid",gridTemplateColumns:"2fr 1fr 1fr 1fr 1.5fr 1fr"},children:[u.jsx("div",{style:{...E,fontWeight:500,overflow:"hidden",paddingLeft:"1.5rem",borderLeft:"2px solid rgba(255,255,255,0.1)"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.nickname})}),i?u.jsx("div",{style:{...E,justifyContent:"flex-end",color:lt(i.uncleared_balance),fontWeight:600},children:qe(i.uncleared_balance)}):u.jsx("div",{style:{...E,justifyContent:"flex-end",color:lt(t.balance),fontWeight:600},children:qe(t.balance)}),i?u.jsx("div",{style:{...E,justifyContent:"flex-end",color:lt(i.cleared_balance)},children:Math.abs(i.uncleared_balance-i.cleared_balance)<.01?u.jsx("span",{style:{opacity:.3,color:"#9ca3af"},children:""}):qe(i.cleared_balance)}):u.jsx("div",{style:{...E,justifyContent:"flex-end",color:lt(t.balance),fontWeight:600},children:qe(t.balance)}),i&&Math.abs(i.uncleared_balance-i.cleared_balance)>=.01?u.jsx("div",{style:{...E,justifyContent:"flex-end",color:lt(i.uncleared_balance-i.cleared_balance)},children:qe(i.uncleared_balance-i.cleared_balance)}):u.jsx("div",{style:{...E,justifyContent:"flex-end",opacity:.3,color:"#9ca3af"},children:""}),u.jsx("div",{style:{...E,gap:"0.25rem",flexWrap:"wrap"},children:u.jsx(rS,{account:t,accountGroups:n})}),u.jsxs("div",{style:{...E,justifyContent:"flex-end",gap:"0.25rem"},children:[u.jsx("button",{onClick:T=>{T.stopPropagation(),t.nickname,o(t.id)},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Edit",children:""}),u.jsx("button",{onClick:T=>{T.stopPropagation(),d()},disabled:!m,style:{background:"transparent",border:"none",cursor:m?"pointer":"default",opacity:m?.6:.2,fontSize:"0.9rem",padding:"0.25rem"},title:"Move up",children:""}),u.jsx("button",{onClick:T=>{T.stopPropagation(),h()},disabled:!p,style:{background:"transparent",border:"none",cursor:p?"pointer":"default",opacity:p?.6:.2,fontSize:"0.9rem",padding:"0.25rem"},title:"Move down",children:""})]})]})}function sS({group:t,accounts:e,allGroups:n,allAccounts:r,accountClearedBalances:i,editingAccountId:o,createForGroupId:l,setEditingAccountId:d,setCreateForGroupId:h,onUpdateAccount:m,onDeleteAccount:p,onMoveAccount:g,onCreateAccount:v,isMobile:_,isUngrouped:C,canMoveGroupUp:x,canMoveGroupDown:S,onEditGroup:E,onDeleteGroup:T,onMoveGroupUp:I,onMoveGroupDown:M}){const L=[...e].sort((k,A)=>k.sort_order-A.sort_order);L.reduce((k,A)=>k+A.balance,0);const $={padding:"0.6rem 0.5rem",marginTop:"1.25rem",borderTop:"1px solid rgba(255,255,255,0.2)",borderBottom:Ia,background:"rgba(255,255,255,0.04)",display:"flex",alignItems:"center",fontSize:"0.9rem",fontWeight:600};return u.jsxs("div",{style:{display:"contents"},children:[!_&&u.jsxs(u.Fragment,{children:[u.jsxs("div",{style:{...$,opacity:C?.7:1,justifyContent:"space-between"},children:[u.jsxs("span",{children:[u.jsx("span",{children:t.name}),u.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",L.length,")"]})]}),u.jsx("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center",flexShrink:0},children:!C&&u.jsxs(u.Fragment,{children:[u.jsx(Ve,{variant:"small",actionName:`Open Add Account Form (${t.name})`,onClick:()=>h(t.id),disabled:l!==null,children:"+ Account"}),u.jsx("button",{onClick:()=>{t.name,E()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Edit account type",children:""}),u.jsx("button",{onClick:()=>{t.name,T()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Delete account type",children:""}),u.jsxs("div",{style:If,children:[u.jsx("button",{onClick:I,disabled:!x,style:{...ha,opacity:x?.6:.2,cursor:x?"pointer":"default"},title:"Move up","aria-label":"Move up",children:""}),u.jsx("button",{onClick:M,disabled:!S,style:{...ha,opacity:S?.6:.2,cursor:S?"pointer":"default"},title:"Move down","aria-label":"Move down",children:""})]})]})})]}),u.jsx("div",{style:$}),u.jsx("div",{style:$}),u.jsx("div",{style:$}),u.jsx("div",{style:$}),u.jsx("div",{style:$})]}),_&&u.jsxs("div",{style:{gridColumn:"1 / -1",padding:"0.6rem 0.5rem",marginTop:"1.25rem",borderTop:"1px solid rgba(255,255,255,0.2)",borderBottom:Ia,background:"rgba(255,255,255,0.04)"},children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"},children:[u.jsxs("span",{style:{fontWeight:600,opacity:C?.7:1},children:[t.name,u.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",L.length,")"]})]}),Kt.showGroupTotals]}),!C&&u.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center",flexWrap:"wrap"},children:[u.jsx(Ve,{variant:"small",actionName:`Open Add Account Form (${t.name})`,onClick:()=>h(t.id),disabled:l!==null,children:"+ Account"}),u.jsx("button",{onClick:()=>{t.name,E()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Edit account type",children:""}),u.jsx("button",{onClick:()=>{t.name,T()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Delete account type",children:""}),u.jsxs("div",{style:If,children:[u.jsx("button",{onClick:I,disabled:!x,style:{...ha,opacity:x?.6:.2,cursor:x?"pointer":"default"},title:"Move up","aria-label":"Move up",children:""}),u.jsx("button",{onClick:M,disabled:!S,style:{...ha,opacity:S?.6:.2,cursor:S?"pointer":"default"},title:"Move down","aria-label":"Move down",children:""})]})]})]}),L.map((k,A)=>u.jsx(wB,{account:k,accountIndex:A,totalAccounts:L.length,allGroups:n,allAccounts:r,clearedBalance:i?.[k.id],onEdit:d,onDelete:p,onMoveUp:()=>g(k.id,"up"),onMoveDown:()=>g(k.id,"down"),canMoveUp:A>0,canMoveDown:A<L.length-1,editingAccountId:o,setEditingAccountId:d,onUpdateAccount:m,isMobile:_},k.id)),l===t.id&&u.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"0.5rem"},children:u.jsx(t_,{initialData:{nickname:"",account_group_id:t.id},onSubmit:k=>v(k,t.id),onCancel:()=>h(null),submitLabel:"Create",accountGroups:n,showIncomeSettings:!0,currentGroupId:t.id})})]})}function SB(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n}=Xe(),{monthMap:r,isLoading:i,isFetching:o,accounts:l}=jn(),{month:d}=Gs(t,e,n),{accounts:h,accountsByGroup:m,hiddenAccounts:p,sortedGroups:g,currentBudget:v,error:_,setError:C,handleCreateAccount:x,handleUpdateAccount:S,handleDeleteAccount:E,handleMoveAccount:T,handleCreateGroup:I,handleUpdateGroup:M,handleDeleteGroup:L,handleMoveGroup:$}=Y4(),k=Ti(),{addLoadingHold:A,removeLoadingHold:N}=Gn(),F=i||o||!v;od({budgetId:t,monthMap:r,checkAnyMonth:!0,additionalCondition:!F&&!!v,logPrefix:"[Settings/Accounts]"}),D.useEffect(()=>(F?A("accounts","Loading accounts..."):N("accounts"),()=>N("accounts")),[F,A,N]);const[q,j]=D.useState(null),[P,O]=D.useState(null),[X,W]=D.useState(null),[H,Z]=D.useState(!1),Y=D.useMemo(()=>{const ee=Object.values(h),ue=ee.reduce((ve,ze)=>ve+(ze.balance??0),0);let be=0,ce=0;for(const ve of ee){const ze=g.find(ot=>ot.id===ve.account_group_id);ve.on_budget===!0||ve.on_budget===void 0&&ze?.on_budget!==!1?be+=ve.balance??0:ce+=ve.balance??0}return{count:ee.length,groupCount:g.filter(ve=>ve.id!==Zt).length,totalBalance:ue,onBudgetTotal:be,offBudgetTotal:ce}},[h,g]),se=D.useMemo(()=>g.filter(ee=>ee.id!==Zt),[g]),B=D.useMemo(()=>({id:Zt,name:"Ungrouped",sort_order:se.length,expected_balance:"any",on_budget:null,is_active:null}),[se.length]),G=m[Zt]||[],ne=D.useMemo(()=>d?sA(d,l):{},[d,l]),ie={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderBottom:"2px solid rgba(255,255,255,0.2)"};return D.useEffect(()=>{_&&(console.error("[Settings/Accounts] Error:",_),pr.add({type:"error",message:"Failed to update accounts. See console for details.",autoDismissMs:0}),C(null))},[_,C]),F||!v?F?null:u.jsx("p",{children:"No budget found. Please log in."}):u.jsxs("div",{children:[u.jsx("div",{style:{position:"sticky",top:0,zIndex:50,backgroundColor:"#242424",marginLeft:"calc(-1 * var(--page-padding, 2rem))",marginRight:"calc(-1 * var(--page-padding, 2rem))",paddingLeft:"var(--page-padding, 2rem)",paddingRight:"var(--page-padding, 2rem)",paddingTop:"0.5rem",paddingBottom:"0.5rem",borderBottom:"1px solid rgba(255,255,255,0.15)"},children:u.jsxs("div",{style:{display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem"},children:[u.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[u.jsx("span",{style:{fontWeight:600},children:"Accounts:"}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"On-Budget: "}),u.jsx("span",{style:{color:lt(Y.onBudgetTotal),fontWeight:600},children:qe(Y.onBudgetTotal)})]}),Y.offBudgetTotal!==0&&u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"Off-Budget: "}),u.jsx("span",{style:{fontWeight:600,opacity:.7},children:qe(Y.offBudgetTotal)})]}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"Total: "}),u.jsx("span",{style:{color:lt(Y.totalBalance),fontWeight:600},children:qe(Y.totalBalance)})]}),u.jsx("span",{style:{opacity:.5,fontSize:"0.8rem"},children:"Use  buttons to reorder accounts."})]}),u.jsx("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:u.jsx(X0,{})})]})}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:k?"1fr":"2fr 1fr 1fr 1fr 1.5fr 1fr",marginTop:"1rem",marginBottom:"1.5rem"},children:[u.jsx("div",{style:{gridColumn:"1 / -1",position:"sticky",top:"3.5rem",zIndex:49,backgroundColor:"#242424",display:k?"block":"grid",gridTemplateColumns:k?void 0:"subgrid"},children:!k&&u.jsxs(u.Fragment,{children:[u.jsx("div",{style:ie,children:"Account"}),u.jsx("div",{style:{...ie,textAlign:"right"},children:"Total"}),u.jsx("div",{style:{...ie,textAlign:"right"},children:"Cleared"}),u.jsx("div",{style:{...ie,textAlign:"right"},children:"Uncleared"}),u.jsx("div",{style:ie,children:"Flags"}),u.jsx("div",{style:{...ie,textAlign:"right"},children:"Actions"})]})}),Object.keys(h).length===0&&se.length===0&&u.jsx("p",{style:{gridColumn:"1 / -1",opacity:.7,textAlign:"center",padding:"2rem"},children:"No accounts yet. Create an account type first, then add accounts!"}),se.map((ee,ue)=>{const be=m[ee.id]||[];return be.length===0&&X!==ee.id&&P!==ee.id?null:X===ee.id?u.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"1rem"},children:u.jsx(nS,{initialData:{name:ee.name,expected_balance:ee.expected_balance||"positive",on_budget:ee.on_budget??void 0,is_active:ee.is_active??void 0},onSubmit:ce=>{M(ee.id,ce),W(null)},onCancel:()=>W(null),submitLabel:"Save"})},ee.id):u.jsx(sS,{group:ee,accounts:be,allGroups:se,allAccounts:h,accountClearedBalances:ne,editingAccountId:q,createForGroupId:P,setEditingAccountId:j,setCreateForGroupId:O,onUpdateAccount:(ce,ve)=>{S(ce,ve),j(null)},onDeleteAccount:E,onMoveAccount:T,onCreateAccount:x,isMobile:k,canMoveGroupUp:ue>0,canMoveGroupDown:ue<se.length-1,onEditGroup:()=>W(ee.id),onDeleteGroup:()=>L(ee.id),onMoveGroupUp:()=>$(ee.id,"up"),onMoveGroupDown:()=>$(ee.id,"down")},ee.id)}),(G.length>0||P==="ungrouped")&&u.jsx(sS,{group:B,accounts:G,allGroups:se,allAccounts:h,accountClearedBalances:ne,editingAccountId:q,createForGroupId:P,setEditingAccountId:j,setCreateForGroupId:O,onUpdateAccount:(ee,ue)=>{S(ee,ue),j(null)},onDeleteAccount:E,onMoveAccount:T,onCreateAccount:x,isMobile:k,isUngrouped:!0,canMoveGroupUp:!1,canMoveGroupDown:!1,onEditGroup:()=>{},onDeleteGroup:()=>{},onMoveGroupUp:()=>{},onMoveGroupDown:()=>{}}),u.jsx("div",{style:{gridColumn:"1 / -1",height:"1rem"}})]}),p.length>0&&u.jsx("div",{style:{marginBottom:"2rem"},children:u.jsxs(Q0,{title:"Hidden Accounts",count:p.length,children:[u.jsxs("div",{style:{padding:"0.75rem",marginBottom:"1rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",fontSize:"0.85rem"},children:[u.jsxs("p",{style:{margin:"0 0 0.5rem 0",opacity:.8},children:[u.jsx("strong",{children:" Hidden accounts"})," are excluded from dropdowns and balance displays. They're useful for historical accounts (like closed bank accounts or old 401Ks) that you want to keep for record-keeping but don't need in everyday use."]}),u.jsx("p",{style:{margin:0,opacity:.6},children:'To unhide an account, click it to edit and uncheck "Hidden account".'})]}),u.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:p.map(ee=>q===ee.id?u.jsx(t_,{initialData:{nickname:ee.nickname,account_group_id:ee.account_group_id,is_income_account:ee.is_income_account,is_income_default:ee.is_income_default,is_outgo_account:ee.is_outgo_account,is_outgo_default:ee.is_outgo_default,on_budget:ee.on_budget,is_active:ee.is_active,is_hidden:ee.is_hidden},onSubmit:ue=>{S(ee.id,ue),j(null)},onCancel:()=>j(null),submitLabel:"Save",accountGroups:se,showGroupSelector:!0,showIncomeSettings:!0,currentGroupId:ee.account_group_id,hasExistingIncomeDefault:Object.entries(h).some(([ue,be])=>be.is_income_default&&ue!==ee.id),hasExistingOutgoDefault:Object.entries(h).some(([ue,be])=>be.is_outgo_default&&ue!==ee.id)},ee.id):u.jsxs("div",{onClick:()=>j(ee.id),style:{padding:"0.75rem 1rem",background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"8px",cursor:"pointer",display:"flex",justifyContent:"space-between",alignItems:"center",opacity:.7},children:[u.jsx("span",{children:ee.nickname}),u.jsx("span",{style:{color:lt(ee.balance),fontWeight:500},children:qe(ee.balance)})]},ee.id))})]})}),H?u.jsx(nS,{onSubmit:ee=>{I(ee),Z(!1)},onCancel:()=>Z(!1),submitLabel:"Create Account Type"}):u.jsx(Ve,{variant:"primary-large",actionName:"Open Add Account Type Form",onClick:()=>Z(!0),children:"+ Add Account Type"})]})}function n_({initialData:t,onSubmit:e,onCancel:n,submitLabel:r,categoryGroups:i=[],showGroupSelector:o=!1,onDelete:l}){const[d,h]=D.useState(t||{name:"",category_group_id:null,is_hidden:!1}),[m,p]=D.useState(t?.default_monthly_amount?.toString()||""),[g,v]=D.useState(t?.default_monthly_type||"fixed"),[_,C]=D.useState(!1);function x(S){if(S.preventDefault(),!d.name.trim())return;C(!0);const E=parseFloat(m),T=!isNaN(E)&&E>0;e({...d,description:d.description?.trim()||void 0,default_monthly_amount:T?E:void 0,default_monthly_type:T?g:void 0})}return u.jsxs(Si,{actionName:r==="Create"?"Create Category":"Update Category",onSubmit:x,children:[u.jsx(zt,{label:"Category Name",htmlFor:"category-name",children:u.jsx(Ci,{id:"category-name",type:"text",value:d.name,onChange:S=>h({...d,name:S.target.value}),placeholder:"e.g., Groceries, Rent, Gas",required:!0,autoFocus:!0})}),u.jsx(zt,{label:"Description (optional)",htmlFor:"category-description",children:u.jsx(H0,{id:"category-description",value:d.description||"",onChange:S=>h({...d,description:S.target.value}),placeholder:"What is this category used for?",minHeight:"3rem"})}),o&&u.jsx(zt,{label:"Category Group",htmlFor:"category-group",children:u.jsxs($u,{id:"category-group",value:d.category_group_id||ln,onChange:S=>h({...d,category_group_id:S.target.value===ln?null:S.target.value}),children:[u.jsx("option",{value:ln,children:"Uncategorized"}),i.map(S=>u.jsx("option",{value:S.id,children:S.name},S.id))]})}),u.jsxs(zt,{label:"Default Monthly Allocation (optional)",htmlFor:"default-amount",children:[u.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center"},children:[u.jsxs($u,{id:"default-type",value:g,onChange:S=>v(S.target.value),style:{width:"auto",flex:"0 0 auto"},children:[u.jsx("option",{value:"fixed",children:"Fixed $"}),u.jsx("option",{value:"percentage",children:"% of Prev Income"})]}),g==="fixed"?u.jsx(xo,{id:"default-amount",value:m,onChange:p,placeholder:"$0.00"}):u.jsx(Ci,{id:"default-amount",type:"number",value:m,onChange:S=>p(S.target.value),placeholder:"0",min:"0",max:"100",step:"0.1",style:{width:"80px"}}),g==="percentage"&&u.jsx("span",{style:{opacity:.6},children:"%"})]}),u.jsx("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.75rem",opacity:.6},children:g==="fixed"?"Suggested fixed amount to allocate each month":"Percentage of previous month's total income"})]}),o&&u.jsxs("div",{style:{padding:"0.75rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px"},children:[u.jsx(qr,{id:"is-hidden",checked:d.is_hidden||!1,onChange:S=>h({...d,is_hidden:S.target.checked}),children:"Hidden category"}),u.jsx("p",{style:{margin:"0.25rem 0 0 2rem",fontSize:"0.7rem",opacity:.6},children:"Hidden categories don't appear in dropdowns or balance displays. Use for historical categories that aren't actively used."})]}),u.jsxs(za,{children:[u.jsx(Ve,{type:"submit",actionName:r==="Create"?"Create Category":"Save Category",isLoading:_,children:r}),u.jsx(Ve,{type:"button",variant:"secondary",actionName:"Cancel Category Form",onClick:n,children:"Cancel"}),l&&u.jsx(Ve,{type:"button",variant:"secondary",actionName:"Delete Category",onClick:S=>{S.preventDefault(),l()},style:{color:"#ff6b6b",borderColor:"#ff6b6b"},children:" Delete"})]})]})}function iS({initialData:t,onSubmit:e,onCancel:n,submitLabel:r}){const[i,o]=D.useState(t||{name:""}),[l,d]=D.useState(!1);function h(m){m.preventDefault(),i.name.trim()&&(d(!0),e(i))}return u.jsxs(Si,{actionName:r==="Create Group"?"Create Category Group":"Update Category Group",onSubmit:h,children:[u.jsx(zt,{label:"Group Name",htmlFor:"group-name",children:u.jsx(Ci,{id:"group-name",type:"text",value:i.name,onChange:m=>o({...i,name:m.target.value}),placeholder:"e.g., Housing, Transportation, Food",required:!0,autoFocus:!0})}),u.jsxs(za,{children:[u.jsx(Ve,{type:"submit",actionName:r==="Create Group"?"Create Category Group":"Save Category Group",isLoading:l,children:r}),u.jsx(Ve,{type:"button",variant:"secondary",actionName:"Cancel Category Group Form",onClick:n,children:"Cancel"})]})]})}function CB({category:t,catId:e,categoryIndex:n,categoryGroups:r,categoryBalances:i,loadingBalances:o,onEdit:l,onDelete:d,onMoveUp:h,onMoveDown:m,canMoveUp:p,canMoveDown:g,editingCategoryId:v,setEditingCategoryId:_,onUpdateCategory:C,isMobile:x}){const S=i[e]||{current:0,total:0};if(v===e)return u.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"0.5rem"},children:u.jsx(n_,{initialData:{name:t.name,description:t.description,category_group_id:t.category_group_id,default_monthly_amount:t.default_monthly_amount,default_monthly_type:t.default_monthly_type,is_hidden:t.is_hidden},onSubmit:M=>{C(e,M),_(null)},onCancel:()=>_(null),onDelete:()=>{t.name,d(e),_(null)},submitLabel:"Save",categoryGroups:r,showGroupSelector:!0})});if(x)return u.jsx("div",{style:{gridColumn:"1 / -1"},children:u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",padding:"0.75rem",marginBottom:"0.25rem"},children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"},children:[u.jsx("span",{style:{fontWeight:500},children:t.name}),u.jsxs("div",{style:{display:"flex",gap:"1rem",fontSize:"0.85rem"},children:[t.default_monthly_amount!==void 0&&t.default_monthly_amount>0&&u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[u.jsx("span",{style:{opacity:.6,fontSize:"0.7rem"},children:"Default"}),u.jsx("span",{style:{opacity:.7},children:t.default_monthly_type==="percentage"?`${t.default_monthly_amount}%`:`${qe(t.default_monthly_amount)}/mo`})]}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[u.jsx("span",{style:{opacity:.6,fontSize:"0.7rem"},children:"Available Now"}),u.jsx("span",{style:{color:un(S.current),fontWeight:600},children:o?"...":mr(S.current)})]}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[u.jsx("span",{style:{opacity:.6,fontSize:"0.7rem"},children:"Total Allocated"}),u.jsx("span",{style:{color:un(S.total)},children:o?"...":mr(S.total)})]})]})]}),t.description&&u.jsx("p",{style:{fontSize:"0.8rem",opacity:.6,margin:"0 0 0.5rem 0"},children:t.description}),t.default_monthly_amount!==void 0&&t.default_monthly_amount>0&&u.jsxs("div",{style:{fontSize:"0.75rem",opacity:.8,marginBottom:"0.5rem"},children:["Default: ",t.default_monthly_type==="percentage"?u.jsxs(u.Fragment,{children:[u.jsxs("span",{style:{color:me.success,fontWeight:500},children:[t.default_monthly_amount,"%"]})," of prev income"]}):u.jsxs(u.Fragment,{children:[u.jsx("span",{style:{color:me.success,fontWeight:500},children:t.default_monthly_amount}),"/mo"]})]}),u.jsxs("div",{style:{display:"flex",gap:"0.5rem",justifyContent:"flex-end"},children:[u.jsx("button",{onClick:M=>{M.stopPropagation(),t.name,l(e)},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Edit",children:""}),u.jsx("button",{onClick:M=>{M.stopPropagation(),h()},disabled:!p,style:{background:"transparent",border:"none",cursor:p?"pointer":"default",opacity:p?.6:.2,fontSize:"0.9rem",padding:"0.25rem"},title:"Move up",children:""}),u.jsx("button",{onClick:M=>{M.stopPropagation(),m()},disabled:!g,style:{background:"transparent",border:"none",cursor:g?"pointer":"default",opacity:g?.6:.2,fontSize:"0.9rem",padding:"0.25rem"},title:"Move down",children:""})]})]})});const T=n%2===0?"transparent":"rgba(255,255,255,0.04)",I={padding:"0.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem"};return u.jsxs("div",{style:{gridColumn:"1 / -1",background:T,display:"grid",gridTemplateColumns:"2fr 1fr 1fr 1fr 2fr 1fr"},children:[u.jsx("div",{style:{...I,fontWeight:500,overflow:"hidden",paddingLeft:"1.5rem",borderLeft:"2px solid rgba(255,255,255,0.1)"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.name})}),u.jsx("div",{style:{...I,justifyContent:"flex-end",opacity:.7,fontSize:"0.85rem"},children:t.default_monthly_amount!==void 0&&t.default_monthly_amount>0?u.jsx("span",{children:t.default_monthly_type==="percentage"?`${t.default_monthly_amount}%`:`${mr(t.default_monthly_amount)}/mo`}):u.jsx("span",{style:{opacity:.3,fontStyle:"italic",color:"#9ca3af"},children:""})}),u.jsx("div",{style:{...I,justifyContent:"flex-end",color:un(S.current),fontWeight:600},children:o?"...":mr(S.current)}),u.jsx("div",{style:{...I,justifyContent:"flex-end",color:un(S.total)},children:o?"...":mr(S.total)}),u.jsx("div",{style:{...I,opacity:.7,fontSize:"0.85rem"},children:t.description?u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.description}):u.jsx("span",{style:{opacity:.3,fontStyle:"italic",color:"#9ca3af"},children:""})}),u.jsxs("div",{style:{...I,justifyContent:"flex-end",gap:"0.25rem"},children:[u.jsx("button",{onClick:M=>{M.stopPropagation(),t.name,l(e)},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Edit",children:""}),u.jsx("button",{onClick:M=>{M.stopPropagation(),h()},disabled:!p,style:{background:"transparent",border:"none",cursor:p?"pointer":"default",opacity:p?.6:.2,fontSize:"0.9rem",padding:"0.25rem"},title:"Move up",children:""}),u.jsx("button",{onClick:M=>{M.stopPropagation(),m()},disabled:!g,style:{background:"transparent",border:"none",cursor:g?"pointer":"default",opacity:g?.6:.2,fontSize:"0.9rem",padding:"0.25rem"},title:"Move down",children:""})]})]})}function aS({group:t,categories:e,categoryGroups:n,categoryBalances:r,loadingBalances:i,editingCategoryId:o,createForGroupId:l,setEditingCategoryId:d,setCreateForGroupId:h,handleUpdateCategory:m,handleDeleteCategory:p,handleMoveCategory:g,handleCreateCategory:v,isMobile:_,isUngrouped:C,startRowIndex:x=0,canMoveGroupUp:S,canMoveGroupDown:E,onEditGroup:T,onDeleteGroup:I,onMoveGroupUp:M,onMoveGroupDown:L}){const $=[...e].sort((N,F)=>N[1].sort_order-F[1].sort_order),k=$.reduce((N,[F])=>{const q=r[F];return N+(q?.current||0)},0),A={padding:"0.6rem 0.5rem",marginTop:"1.25rem",borderTop:"1px solid rgba(255,255,255,0.2)",borderBottom:Ia,background:"rgba(255,255,255,0.04)",display:"flex",alignItems:"center",fontSize:"0.9rem",fontWeight:600};return u.jsxs("div",{style:{display:"contents"},children:[!_&&u.jsxs(u.Fragment,{children:[u.jsxs("div",{style:{...A,opacity:C?.7:1,justifyContent:"space-between"},children:[u.jsxs("span",{children:[u.jsx("span",{children:t.name}),u.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",$.length,")"]})]}),u.jsx("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center",flexShrink:0},children:!C&&u.jsxs(u.Fragment,{children:[u.jsx(Ve,{variant:"small",actionName:`Open Add Category Form (${t.name})`,onClick:()=>h(t.id),disabled:l!==null,children:"+ Category"}),u.jsx("button",{onClick:()=>{t.name,T()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Edit group",children:""}),u.jsx("button",{onClick:()=>{t.name,I()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Delete group",children:""}),u.jsxs("div",{style:If,children:[u.jsx("button",{onClick:M,disabled:!S,style:{...ha,opacity:S?.6:.2,cursor:S?"pointer":"default"},title:"Move group up","aria-label":"Move group up",children:""}),u.jsx("button",{onClick:L,disabled:!E,style:{...ha,opacity:E?.6:.2,cursor:E?"pointer":"default"},title:"Move group down","aria-label":"Move group down",children:""})]})]})})]}),u.jsx("div",{style:A}),u.jsx("div",{style:{...A,justifyContent:"flex-end",color:un(k)},children:Kt.showGroupTotals}),u.jsx("div",{style:{...A,justifyContent:"flex-end",color:un($.reduce((N,[F])=>{const q=r[F];return N+(q?.total||0)},0))},children:Kt.showGroupTotals}),u.jsx("div",{style:A}),u.jsx("div",{style:A})]}),_&&u.jsxs("div",{style:{gridColumn:"1 / -1",padding:"0.6rem 0.5rem",marginTop:"1.25rem",borderTop:"1px solid rgba(255,255,255,0.2)",borderBottom:Ia,background:"rgba(255,255,255,0.04)"},children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"},children:[u.jsxs("span",{style:{fontWeight:600,opacity:C?.7:1},children:[t.name,u.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",$.length,")"]})]}),Kt.showGroupTotals]}),!C&&u.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center",flexWrap:"wrap"},children:[u.jsx(Ve,{variant:"small",actionName:`Open Add Category Form (${t.name})`,onClick:()=>h(t.id),disabled:l!==null,children:"+ Category"}),u.jsx("button",{onClick:()=>{t.name,T()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Edit group",children:""}),u.jsx("button",{onClick:()=>{t.name,I()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Delete group",children:""}),u.jsxs("div",{style:If,children:[u.jsx("button",{onClick:M,disabled:!S,style:{...ha,opacity:S?.6:.2,cursor:S?"pointer":"default"},title:"Move group up","aria-label":"Move group up",children:""}),u.jsx("button",{onClick:L,disabled:!E,style:{...ha,opacity:E?.6:.2,cursor:E?"pointer":"default"},title:"Move group down","aria-label":"Move group down",children:""})]})]})]}),$.map(([N,F],q)=>{const j=x+q;return u.jsx(CB,{category:F,catId:N,categoryIndex:j,totalCategories:$.length,categoryGroups:n,categoryBalances:r,loadingBalances:i,onEdit:d,onDelete:p,onMoveUp:()=>g(N,"up"),onMoveDown:()=>g(N,"down"),canMoveUp:q>0,canMoveDown:q<$.length-1,editingCategoryId:o,setEditingCategoryId:d,onUpdateCategory:m,isMobile:_},N)}),l===t.id&&u.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"0.5rem"},children:u.jsx(n_,{initialData:{name:"",category_group_id:t.id},onSubmit:N=>v(N,t.id),onCancel:()=>h(null),submitLabel:"Create",categoryGroups:n})})]})}function EB(){const{selectedBudgetId:t}=Xe(),{monthMap:e,isLoading:n,isFetching:r}=jn(),{currentBudget:i,categories:o,categoryGroups:l,categoriesByGroup:d,hiddenCategories:h,sortedGroups:m,categoryBalances:p,isLoading:g,loadingBalances:v,error:_,setError:C,getOnBudgetTotal:x,handleCreateCategory:S,handleUpdateCategory:E,handleDeleteCategory:T,handleMoveCategory:I,handleCreateGroup:M,handleUpdateGroup:L,handleDeleteGroup:$,handleMoveGroup:k}=e3(),A=Ti(),{addLoadingHold:N,removeLoadingHold:F}=Gn(),q=n||g||r||!i;od({budgetId:t,monthMap:e,checkAnyMonth:!0,additionalCondition:!q&&!!i,logPrefix:"[Settings/Categories]"}),D.useEffect(()=>(q?N("categories","Loading categories..."):F("categories"),()=>F("categories")),[q,N,F]);const[j,P]=D.useState(null),[O,X]=D.useState(null),[W,H]=D.useState(null),[Z,Y]=D.useState(!1),se=D.useMemo(()=>m.filter(ue=>ue.id!==ln),[m]),B=D.useMemo(()=>({id:ln,name:"Uncategorized",sort_order:se.length}),[se.length]),G=(d[ln]||[]).sort((ue,be)=>ue[1].sort_order-be[1].sort_order);if(D.useEffect(()=>{_&&(console.error("[Settings/Categories] Error:",_),pr.add({type:"error",message:"Failed to update categories. See console for details.",autoDismissMs:0}),C(null))},[_,C]),q||!i)return q?null:u.jsx("p",{children:"No budget found. Please log in."});const ne=Object.values(p).reduce((ue,be)=>ue+be.current,0),ie=Object.values(p).reduce((ue,be)=>ue+be.total,0),ee={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderBottom:"2px solid rgba(255,255,255,0.2)"};return u.jsxs("div",{children:[u.jsx("div",{style:{position:"sticky",top:0,zIndex:50,backgroundColor:"#242424",marginLeft:"calc(-1 * var(--page-padding, 2rem))",marginRight:"calc(-1 * var(--page-padding, 2rem))",paddingLeft:"var(--page-padding, 2rem)",paddingRight:"var(--page-padding, 2rem)",paddingTop:"0.5rem",paddingBottom:"0.5rem",borderBottom:"1px solid rgba(255,255,255,0.15)"},children:u.jsxs("div",{style:{display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem"},children:[u.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[u.jsx("span",{style:{fontWeight:600},children:"Categories:"}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"On-Budget: "}),u.jsx("span",{style:{color:lt(x()),fontWeight:600},children:qe(x())})]}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"Available Now: "}),u.jsx("span",{style:{color:lt(ne),fontWeight:600},children:v?"...":qe(ne)})]}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"Total Allocated: "}),u.jsx("span",{style:{color:pc(ie),fontWeight:600},children:v?"...":qe(ie)})]}),u.jsx("span",{style:{opacity:.6},children:"Use  buttons to reorder categories."})]}),u.jsx("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:u.jsx(X0,{})})]})}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:A?"1fr":"2fr 1fr 1fr 1fr 2fr 1fr",marginTop:"1rem",marginBottom:"1.5rem"},children:[u.jsx("div",{style:{gridColumn:"1 / -1",position:"sticky",top:"3.5rem",zIndex:49,backgroundColor:"#242424",display:A?"block":"grid",gridTemplateColumns:A?void 0:"subgrid"},children:!A&&u.jsxs(u.Fragment,{children:[u.jsx("div",{style:ee,children:"Category"}),u.jsx("div",{style:{...ee,textAlign:"right"},children:"Default"}),u.jsx("div",{style:{...ee,textAlign:"right"},children:"Available Now"}),u.jsx("div",{style:{...ee,textAlign:"right"},children:"Total Allocated"}),u.jsx("div",{style:ee,children:"Description"}),u.jsx("div",{style:{...ee,textAlign:"right"},children:"Actions"})]})}),Object.keys(o).length===0&&l.length===0&&u.jsx("p",{style:{gridColumn:"1 / -1",opacity:.7,textAlign:"center",padding:"2rem"},children:"No categories yet. Create a group first, then add categories!"}),(()=>{const ue={};let be=0;return se.forEach(ce=>{const ve=(d[ce.id]||[]).sort((ze,Pe)=>ze[1].sort_order-Pe[1].sort_order);ue[ce.id]=be,be+=ve.length}),se.map((ce,ve)=>{const ze=(d[ce.id]||[]).sort((Pe,ot)=>Pe[1].sort_order-ot[1].sort_order);return ze.length===0&&W!==ce.id&&O!==ce.id?null:W===ce.id?u.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"1rem"},children:u.jsx(iS,{initialData:{name:ce.name},onSubmit:Pe=>{L(ce.id,Pe),H(null)},onCancel:()=>H(null),submitLabel:"Save"})},ce.id):u.jsx(aS,{group:ce,categories:ze,categoryGroups:l,categoryBalances:p,loadingBalances:v,editingCategoryId:j,createForGroupId:O,setEditingCategoryId:P,setCreateForGroupId:X,handleUpdateCategory:E,handleDeleteCategory:T,handleMoveCategory:I,handleCreateCategory:S,isMobile:A,canMoveGroupUp:ve>0,canMoveGroupDown:ve<se.length-1,onEditGroup:()=>H(ce.id),onDeleteGroup:()=>$(ce.id),onMoveGroupUp:()=>k(ce.id,"up"),onMoveGroupDown:()=>k(ce.id,"down"),startRowIndex:ue[ce.id]??0},ce.id)})})(),(G.length>0||O==="ungrouped")&&(()=>{const ue=se.reduce((be,ce)=>{const ve=(d[ce.id]||[]).sort((ze,Pe)=>ze[1].sort_order-Pe[1].sort_order);return be+ve.length},0);return u.jsx(aS,{group:B,categories:G,categoryGroups:l,categoryBalances:p,loadingBalances:v,editingCategoryId:j,createForGroupId:O,setEditingCategoryId:P,setCreateForGroupId:X,handleUpdateCategory:E,handleDeleteCategory:T,handleMoveCategory:I,handleCreateCategory:S,isMobile:A,isUngrouped:!0,canMoveGroupUp:!1,canMoveGroupDown:!1,onEditGroup:()=>{},onDeleteGroup:()=>{},onMoveGroupUp:()=>{},onMoveGroupDown:()=>{},startRowIndex:ue})})(),u.jsx("div",{style:{gridColumn:"1 / -1",height:"1rem"}})]}),h.length>0&&u.jsx("div",{style:{marginBottom:"2rem"},children:u.jsxs(Q0,{title:"Hidden Categories",count:h.length,children:[u.jsxs("div",{style:{padding:"0.75rem",marginBottom:"1rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",fontSize:"0.85rem"},children:[u.jsxs("p",{style:{margin:"0 0 0.5rem 0",opacity:.8},children:[u.jsx("strong",{children:" Hidden categories"})," are excluded from dropdowns and balance displays. They're useful for historical categories that you want to keep for record-keeping but don't need in everyday use."]}),u.jsx("p",{style:{margin:0,opacity:.6},children:'To unhide a category, click it to edit and uncheck "Hidden category".'})]}),u.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:h.map(([ue,be])=>j===ue?u.jsx(n_,{initialData:{name:be.name,description:be.description,category_group_id:be.category_group_id,default_monthly_amount:be.default_monthly_amount,default_monthly_type:be.default_monthly_type,is_hidden:be.is_hidden},onSubmit:ce=>{E(ue,ce),P(null)},onCancel:()=>P(null),submitLabel:"Save",categoryGroups:l,showGroupSelector:!0},ue):u.jsxs("div",{onClick:()=>P(ue),style:{padding:"0.75rem 1rem",background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"8px",cursor:"pointer",display:"flex",justifyContent:"space-between",alignItems:"center",opacity:.7},children:[u.jsx("span",{children:be.name}),u.jsx("span",{style:{color:lt(be.balance),fontWeight:500},children:qe(be.balance)})]},ue))})]})}),Z?u.jsx(iS,{onSubmit:ue=>{M(ue),Y(!1)},onCancel:()=>Y(!1),submitLabel:"Create Group"}):u.jsx(Ve,{variant:"primary-large",actionName:"Open Add Category Group Form",onClick:()=>Y(!0),children:"+ Add Category Group"})]})}function TB(){const{selectedBudgetId:t,currentUserId:e}=Xe(),{addLoadingHold:n,removeLoadingHold:r}=Gn(),{budget:i,budgetUserIds:o,acceptedUserIds:l,isLoading:d}=jn();D.useEffect(()=>(d||!i?n("users","Loading users..."):r("users"),()=>r("users")),[d,i,n,r]);const{inviteUser:h}=fB(),{revokeUser:m}=mB(),[p,g]=D.useState(""),[v,_]=D.useState(!1),[C,x]=D.useState(null),[S,E]=D.useState(null);if(d)return null;if(!i)return u.jsx("p",{children:"No budget found."});async function T($){if($.preventDefault(),!(!p.trim()||!i||!t)){_(!0),x(null),E(null);try{await h.mutateAsync({budgetId:t,userId:p.trim()}),g(""),E("Invite sent! The user can now accept the invitation from their account.")}catch(k){x(k instanceof Error?k.message:"Failed to invite user")}finally{_(!1)}}}async function I($){if(!i||!t)return;if($===i.owner_id){x("Cannot revoke the budget owner");return}if($===e){x("Cannot revoke yourself from the budget");return}const k=l.includes($);if(confirm(k?"Are you sure you want to revoke this user's access? They will lose access to this budget.":"Are you sure you want to cancel this invitation?")){x(null),E(null);try{await m.mutateAsync({budgetId:t,userId:$}),E(k?"User access revoked.":"Invitation cancelled.")}catch(N){x(N instanceof Error?N.message:"Failed to revoke user")}}}const M=o.filter($=>l.includes($)),L=o.filter($=>!l.includes($));return u.jsxs("div",{children:[u.jsx("h2",{style:{marginTop:0},children:"Budget Users"}),u.jsx("p",{style:{opacity:.7,marginBottom:"1.5rem"},children:"Invite users to access this budget. They must accept the invitation before they can access it."}),C&&u.jsxs("div",{style:{background:"rgba(220, 38, 38, 0.1)",border:"1px solid rgba(220, 38, 38, 0.3)",color:"#f87171",padding:"0.75rem 1rem",borderRadius:"8px",marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[u.jsx("span",{children:C}),u.jsx("button",{onClick:()=>x(null),style:{background:"transparent",border:"none",color:"#f87171",cursor:"pointer",fontSize:"1.2rem",padding:"0 0.25rem",lineHeight:1},children:""})]}),S&&u.jsxs("div",{style:{background:"rgba(34, 197, 94, 0.1)",border:"1px solid rgba(34, 197, 94, 0.3)",color:"#4ade80",padding:"0.75rem 1rem",borderRadius:"8px",marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[u.jsx("span",{children:S}),u.jsx("button",{onClick:()=>E(null),style:{background:"transparent",border:"none",color:"#4ade80",cursor:"pointer",fontSize:"1.2rem",padding:"0 0.25rem",lineHeight:1},children:""})]}),u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px",marginBottom:"1.5rem"},children:[u.jsxs("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem"},children:["Active Users (",M.length,")"]}),M.length===0?u.jsx("p",{style:{opacity:.6,margin:0},children:"No users have accepted invitations yet."}):u.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:M.map($=>{const k=$===i.owner_id,A=$===e;return u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 8%, transparent)",padding:"0.75rem 1rem",borderRadius:"6px",display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem"},children:[u.jsx("div",{style:{flex:1,minWidth:0},children:u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flexWrap:"wrap"},children:[u.jsx("code",{style:{fontSize:"0.85rem",background:"color-mix(in srgb, currentColor 10%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",wordBreak:"break-all"},children:$}),k&&u.jsx("span",{style:{background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.7rem",textTransform:"uppercase",fontWeight:600},children:"Owner"}),A&&u.jsx("span",{style:{background:"color-mix(in srgb, #22c55e 20%, transparent)",color:"#4ade80",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.7rem",textTransform:"uppercase",fontWeight:600},children:"You"})]})}),!k&&!A&&u.jsx("button",{onClick:()=>I($),style:{background:"transparent",border:"1px solid rgba(220, 38, 38, 0.4)",color:"#f87171",padding:"0.4rem 0.75rem",borderRadius:"6px",cursor:"pointer",fontSize:"0.8rem",whiteSpace:"nowrap"},children:"Revoke Access"})]},$)})})]}),L.length>0&&u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px",marginBottom:"1.5rem"},children:[u.jsxs("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem"},children:["Pending Invitations (",L.length,")"]}),u.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:L.map($=>u.jsxs("div",{style:{background:"color-mix(in srgb, #f59e0b 10%, transparent)",border:"1px solid color-mix(in srgb, #f59e0b 30%, transparent)",padding:"0.75rem 1rem",borderRadius:"6px",display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem"},children:[u.jsx("div",{style:{flex:1,minWidth:0},children:u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flexWrap:"wrap"},children:[u.jsx("code",{style:{fontSize:"0.85rem",background:"color-mix(in srgb, currentColor 10%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",wordBreak:"break-all"},children:$}),u.jsx("span",{style:{background:"color-mix(in srgb, #f59e0b 20%, transparent)",color:"#fbbf24",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.7rem",textTransform:"uppercase",fontWeight:600},children:"Pending"})]})}),u.jsx("button",{onClick:()=>I($),style:{background:"transparent",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)",color:"inherit",padding:"0.4rem 0.75rem",borderRadius:"6px",cursor:"pointer",fontSize:"0.8rem",whiteSpace:"nowrap",opacity:.8},children:"Cancel Invite"})]},$))})]}),u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px"},children:[u.jsx("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem"},children:"Invite User"}),u.jsxs("form",{onSubmit:T,style:{display:"flex",gap:"0.75rem"},children:[u.jsx("input",{type:"text",value:p,onChange:$=>g($.target.value),placeholder:"Enter Firebase User ID",style:{flex:1,padding:"0.6rem 0.8rem",borderRadius:"6px",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"0.95rem",color:"inherit"}}),u.jsx("button",{type:"submit",disabled:v||!p.trim(),style:{background:"#646cff",color:"white",border:"none",padding:"0.6rem 1.25rem",borderRadius:"6px",cursor:v||!p.trim()?"not-allowed":"pointer",fontWeight:500,opacity:v||!p.trim()?.7:1,whiteSpace:"nowrap"},children:v?"Inviting...":"Send Invite"})]}),u.jsx("p",{style:{margin:"1rem 0 0 0",fontSize:"0.85rem",opacity:.6},children:" The invited user will need to accept the invitation from their Account page using this budget's ID:"}),u.jsx("code",{style:{display:"block",marginTop:"0.5rem",padding:"0.5rem 0.75rem",background:"color-mix(in srgb, currentColor 10%, transparent)",borderRadius:"6px",fontSize:"0.85rem",wordBreak:"break-all"},children:i.id})]})]})}const AB=["budget","feedback","migration","tests"];function jB(){const{isAdmin:t,isTest:e,lastAdminTab:n,setLastAdminTab:r,setPageTitle:i}=Xe();D.useLayoutEffect(()=>{i("Budget Admin")},[i]);const o=Mn(),l=o.pathname==="/budget/admin",d=D.useMemo(()=>{const g=o.pathname;return g.includes("/admin/budget")?"budget":g.includes("/admin/feedback")?"feedback":g.includes("/admin/migration")?"migration":g.includes("/admin/tests")?"tests":"budget"},[o.pathname]),h=d==="tests";D.useEffect(()=>{l||r(d)},[d,l,r]);function m(){return!AB.includes(n)||n==="tests"&&!e?"budget":n}const p=D.useMemo(()=>[{id:"budget",label:"Budget",icon:""},{id:"feedback",label:"Feedback",icon:""},{id:"migration",label:"Migration",icon:""},{id:"tests",label:"Tests",icon:"",hidden:!e}],[e]);return t?!e&&h?u.jsxs("div",{children:[u.jsx("h1",{children:"Access Denied"}),u.jsx("p",{style:{opacity:.7},children:"Only test users can access this section."}),u.jsx("p",{style:{marginTop:"1rem"},children:u.jsx(Tn,{to:"/budget/admin/budget",children:"Go to Admin "})})]}):u.jsxs("div",{children:[u.jsx(Df,{mode:"link",linkPrefix:"/budget/admin",tabs:p,activeTab:d}),l?u.jsx(zf,{to:`/budget/admin/${m()}`,replace:!0}):u.jsx(Bf,{})]}):u.jsxs("div",{children:[u.jsx("h1",{children:"Access Denied"}),u.jsx("p",{style:{opacity:.7},children:"Only administrators can access this section."}),u.jsx("p",{style:{marginTop:"1rem"},children:u.jsx(Tn,{to:"/budget",children:"Go to Budget "})})]})}function RB(){const{addLoadingHold:t,removeLoadingHold:e}=Gn(),{isAdmin:n}=Xe(),{budget:r,accounts:i,accountGroups:o,categories:l,categoryGroups:d,isOwner:h,isLoading:m}=jn();return D.useEffect(()=>(m?t("settings-budget","Loading budget info..."):e("settings-budget"),()=>e("settings-budget")),[m,t,e]),m?null:r?u.jsxs("div",{children:[u.jsx("h2",{style:{marginTop:0},children:"Budget Summary"}),u.jsx("p",{style:{opacity:.7,marginBottom:"1.5rem"},children:"Information about the currently selected budget."}),u.jsx("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px",marginBottom:"1.5rem"},children:u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem",fontSize:"0.95rem"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{children:""}),u.jsx("span",{style:{opacity:.7,minWidth:"80px"},children:"Name:"}),u.jsx("strong",{children:r.name})]}),u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{children:""}),u.jsx("span",{style:{opacity:.7,minWidth:"80px"},children:"ID:"}),u.jsx("code",{style:{background:"color-mix(in srgb, currentColor 10%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",fontSize:"0.85rem"},children:r.id})]}),u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{children:""}),u.jsx("span",{style:{opacity:.7,minWidth:"80px"},children:"Owner:"}),u.jsx("strong",{children:r.owner_email||r.owner_id})]}),u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{children:""}),u.jsx("span",{style:{opacity:.7,minWidth:"80px"},children:"Users:"}),u.jsxs("span",{children:[r.user_ids.length," user",r.user_ids.length!==1?"s":"",u.jsxs("span",{style:{opacity:.7},children:["  ",h?"You are the owner":"Shared with you"]})]})]})]})}),n&&u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px"},children:[u.jsx("h3",{style:{margin:"0 0 0.75rem 0",fontSize:"1rem"},children:"Admin Tools"}),u.jsx("button",{onClick:()=>{const p={...r,accounts:i,account_groups:o,categories:l,category_groups:d,_meta:{downloaded_at:new Date().toISOString()}},g=new Blob([JSON.stringify(p,null,2)],{type:"application/json"}),v=URL.createObjectURL(g),_=document.createElement("a");_.href=v,_.download=`budget_${r.id}.json`,document.body.appendChild(_),_.click(),document.body.removeChild(_),URL.revokeObjectURL(v)},style:{display:"inline-flex",alignItems:"center",gap:"0.5rem",background:"color-mix(in srgb, currentColor 10%, transparent)",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",borderRadius:"6px",padding:"0.5rem 0.75rem",cursor:"pointer",fontSize:"0.85rem",color:"inherit",transition:"background 0.15s"},title:"Download budget document as JSON (for debugging)",children:" Download Budget JSON"})]})]}):u.jsx("p",{style:{opacity:.7},children:"No budget selected."})}function oS({selectedType:t,onSelect:e}){return u.jsx("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"0.75rem",paddingBottom:"1rem",flexWrap:"wrap"},children:["critical_bug","bug","new_feature","core_feature","qol"].map(n=>{const r=Of[n],i=t==="feature"?"new_feature":t,o=i===n||!i&&n==="bug";return u.jsxs("button",{type:"button",onClick:()=>{r.label,e(n)},style:{flex:1,padding:"0.6rem 0.75rem",border:`2px solid ${r.color}`,borderRadius:"0.5rem",background:o?r.bgColor:"transparent",color:o?r.color:"rgba(255,255,255,0.5)",cursor:"pointer",fontWeight:o?600:400,fontSize:"0.85rem",transition:"all 0.15s ease",opacity:o?1:.5,boxShadow:o?`0 0 12px ${r.bgColor}`:"none",position:"relative"},children:[r.label,o&&u.jsx("span",{style:{position:"absolute",bottom:"-14px",left:"10%",right:"10%",height:"3px",background:"white",borderRadius:"2px"}})]},n)})})}function IB(){const[t,e]=D.useState(null),[n,r]=D.useState(null),[i,o]=D.useState(!1),[l,d]=D.useState(""),[h,m]=D.useState("bug"),[p,g]=D.useState(null),[v,_]=D.useState(!1),[C,x]=D.useState(null),S=D.useContext(cd),T=Oa().get_current_firebase_user(),I=Vt(),M=n4(),{submitFeedback:L}=GT(),{toggleFeedback:$}=hP(),{updateSortOrder:k}=fP(),A=M.data?.items||[],N=Ti(),{addLoadingHold:F,removeLoadingHold:q}=Gn();D.useEffect(()=>(M.isLoading?F("settings-feedback","Loading feedback..."):q("settings-feedback"),()=>q("settings-feedback")),[M.isLoading,F,q]);function j(ce){ce.preventDefault(),!(!l.trim()||!S.username||!T)&&(L.mutate({userId:T.uid,userEmail:S.username,text:l.trim(),feedbackType:h,currentPath:"/settings/feedback"}),d(""),m("bug"),o(!1))}function P(ce){ce.is_done?O(ce):g(ce)}async function O(ce){try{await $.mutateAsync({item:ce})}catch(ve){console.error("[Feedback] Error updating feedback:",ve),pr.add({type:"error",message:"Failed to update feedback",autoDismissMs:5e3})}}function X(){p&&(O(p),g(null))}async function W(){_(!1);const ce="mark-all-feedback-complete";F(ce,`Marking ${Y.length} item${Y.length!==1?"s":""} as complete...`);try{const ve=new Date().toISOString(),ze=new Set(Y.map(he=>he.id)),Pe=new Map;for(const he of Y)Pe.has(he.doc_id)||Pe.set(he.doc_id,[]),Pe.get(he.doc_id).push(he);const ot=[];for(const[he,ye]of Pe){const te=(async()=>{const oe=(await HT(he,"mark all feedback complete")).items.map(Ce=>ze.has(Ce.id)?{...Ce,is_done:!0,completed_at:ve}:Ce);await G0({docId:he,items:oe,description:`marking ${ye.length} feedback item${ye.length!==1?"s":""} as complete`})})();ot.push(te)}await Promise.all(ot);const _t=ke.feedback(),U=I.getQueryData(_t);U&&I.setQueryData(_t,{items:U.items.map(he=>ze.has(he.id)?{...he,is_done:!0,completed_at:ve}:he)}),await I.invalidateQueries({queryKey:_t}),pr.add({type:"success",message:`Marked ${Y.length} item${Y.length!==1?"s":""} as complete`,autoDismissMs:3e3})}catch(ve){console.error("[Feedback] Error marking all as complete:",ve),pr.add({type:"error",message:"Failed to mark all items as complete",autoDismissMs:5e3}),await I.invalidateQueries({queryKey:ke.feedback()})}finally{q(ce)}}function H(){W()}async function Z(ce){if(C){try{const ze=A.filter(Pe=>Pe.doc_id===C.doc_id).map(Pe=>({id:Pe.id,text:Pe.text,created_at:Pe.created_at,is_done:Pe.is_done,completed_at:Pe.completed_at,sort_order:Pe.sort_order,feedback_type:Pe.id===C.id?ce:Pe.feedback_type}));await k.mutateAsync({docId:C.doc_id,items:ze})}catch(ve){console.error("[Feedback] Error updating feedback type:",ve),pr.add({type:"error",message:"Failed to update feedback type",autoDismissMs:5e3})}x(null)}}const Y=A.filter(ce=>!ce.is_done).sort((ce,ve)=>ce.sort_order-ve.sort_order),se=A.filter(ce=>ce.is_done).sort((ce,ve)=>new Date(ve.completed_at||0).getTime()-new Date(ce.completed_at||0).getTime());function B(ce,ve){e(ve),ce.dataTransfer.effectAllowed="move"}function G(ce,ve){ce.preventDefault(),ve!==t&&r(ve)}function ne(){r(null)}function ie(){e(null),r(null)}async function ee(ce,ve){if(ce.preventDefault(),!t||t===ve){ie();return}const ze=Y.findIndex(he=>he.id===t),Pe=[...Y],[ot]=Pe.splice(ze,1);if(ve==="__end__")Pe.push(ot);else{const he=Pe.findIndex(ye=>ye.id===ve);Pe.splice(he,0,ot)}const _t=Pe.map((he,ye)=>({...he,sort_order:ye}));ie();const U=new Map;for(const he of _t)U.has(he.doc_id)||U.set(he.doc_id,[]),U.get(he.doc_id).push({id:he.id,text:he.text,created_at:he.created_at,is_done:he.is_done,completed_at:he.completed_at,sort_order:he.sort_order,feedback_type:he.feedback_type});for(const he of se)U.has(he.doc_id)||U.set(he.doc_id,[]),U.get(he.doc_id).push({id:he.id,text:he.text,created_at:he.created_at,is_done:he.is_done,completed_at:he.completed_at,sort_order:he.sort_order,feedback_type:he.feedback_type});try{for(const[he,ye]of U)await k.mutateAsync({docId:he,items:ye})}catch(he){console.error("[Feedback] Error saving order:",he),pr.add({type:"error",message:"Failed to save order",autoDismissMs:5e3})}}function ue(){const ce=be(Y),ve=new Blob([ce],{type:"text/markdown"}),ze=URL.createObjectURL(ve),Pe=document.createElement("a");Pe.href=ze,Pe.download=`feedback-${new Date().toISOString().split("T")[0]}.md`,document.body.appendChild(Pe),Pe.click(),document.body.removeChild(Pe),URL.revokeObjectURL(ze)}function be(ce){let ve=`# Feedback Export

`;return ve+=`Generated: ${new Date().toISOString()}

`,ce.length>0&&(ve+=`## Pending

`,ce.forEach((ze,Pe)=>{const ot=ze.feedback_type?Of[ze.feedback_type]?.label||ze.feedback_type:"Unknown";ve+=`### ${Pe+1}. [${ot}] ${ze.text.split(`
`)[0].substring(0,60)}${ze.text.split(`
`)[0].length>60?"...":""}

`,ve+=`- **Type:** ${ot}
`,ve+=`- **Created:** ${ze.created_at}
`,ve+=`- **User:** ${ze.user_email||ze.doc_id}
`,ve+=`- **ID:** ${ze.id}

`,ve+=`${ze.text}

`,ve+=`---

`})),ve}return M.isLoading?null:u.jsxs("div",{children:[u.jsxs("div",{style:{display:"flex",flexDirection:N?"column":"row",justifyContent:"space-between",alignItems:N?"stretch":"flex-start",gap:N?"0.75rem":"1rem",marginTop:"1.5rem",marginBottom:"0.5rem"},children:[u.jsxs("div",{children:[u.jsx("h2",{style:{marginTop:0},children:"Feedback"}),u.jsx("p",{style:{...AT,fontSize:"0.9rem"},children:"View and manage user feedback. Drag to reorder pending items."})]}),u.jsxs("div",{style:{display:"flex",gap:"0.75rem",flexDirection:N?"column":"row"},children:[u.jsx(Ve,{variant:"secondary",actionName:"Download Feedback as Markdown",onClick:ue,disabled:Y.length===0,style:N?{width:"100%"}:void 0,children:"Download Markdown"}),u.jsx(Ve,{variant:"secondary",actionName:"Mark All Complete",onClick:()=>_(!0),disabled:Y.length===0,style:N?{width:"100%"}:void 0,children:"Mark All Complete"})]})]}),u.jsxs("div",{style:j1,children:[Y.length===0&&!i&&u.jsx("p",{style:{opacity:.7},children:"No pending feedback."}),Y.map(ce=>u.jsx(XP,{item:ce,isDragging:t===ce.id,isDragOver:n===ce.id,onDragStart:ve=>B(ve,ce.id),onDragOver:ve=>G(ve,ce.id),onDragLeave:ne,onDragEnd:ie,onDrop:ve=>ee(ve,ce.id),onToggleDone:()=>P(ce),onTypeClick:()=>x(ce)},ce.id)),t&&Y.length>0&&u.jsx(uP,{isActive:n==="__end__",onDragOver:ce=>G(ce,"__end__"),onDragLeave:ne,onDrop:ce=>ee(ce,"__end__")})]}),i?u.jsxs(Si,{actionName:"Add Feedback",onSubmit:j,children:[u.jsx(oS,{selectedType:h,onSelect:m}),u.jsx(H0,{value:l,onChange:ce=>d(ce.target.value),placeholder:"Enter your feedback, bug report, or feature request...",autoFocus:!0,required:!0}),u.jsxs(za,{children:[u.jsx(Ve,{type:"submit",actionName:"Add Feedback",disabled:!l.trim(),children:"Add Feedback"}),u.jsx(Ve,{type:"button",variant:"secondary",actionName:"Cancel Add Feedback",onClick:()=>{o(!1),d(""),m("bug")},children:"Cancel"})]})]}):u.jsx(Ve,{variant:"primary-large",actionName:"Open Add Feedback Form",onClick:()=>o(!0),children:"+ Add Feedback"}),se.length>0&&u.jsx(Q0,{title:"Completed",count:se.length,children:u.jsx("div",{style:{...j1,marginTop:"0.5rem"},children:se.map(ce=>u.jsx(ZP,{item:ce,onToggleDone:()=>P(ce),onTypeClick:()=>x(ce)},ce.id))})}),u.jsxs(cs,{isOpen:p!==null,onClose:()=>g(null),title:"Mark as Complete",children:[u.jsx("p",{style:{margin:"0 0 1.5rem 0"},children:"Are you sure you want to mark this feedback item as complete?"}),p&&u.jsxs("p",{style:{margin:"0 0 1.5rem 0",padding:"0.75rem",background:"rgba(255,255,255,0.05)",borderRadius:"0.5rem",fontSize:"0.9rem"},children:['"',p.text,'"']}),u.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[u.jsx(Ve,{variant:"secondary",actionName:"Cancel Mark Complete",onClick:()=>g(null),children:"Cancel"}),u.jsx(Ve,{variant:"primary",actionName:"Confirm Mark Complete",onClick:X,children:"Mark Complete"})]})]}),u.jsxs(cs,{isOpen:v,onClose:()=>_(!1),title:"Mark All as Complete",children:[u.jsxs("p",{style:{margin:"0 0 1.5rem 0"},children:["Are you sure you want to mark all ",Y.length," pending feedback item",Y.length!==1?"s":""," as complete?"]}),u.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[u.jsx(Ve,{variant:"secondary",actionName:"Cancel Mark All Complete",onClick:()=>_(!1),children:"Cancel"}),u.jsx(Ve,{variant:"primary",actionName:"Confirm Mark All Complete",onClick:H,children:"Mark All Complete"})]})]}),u.jsxs(cs,{isOpen:C!==null,onClose:()=>x(null),title:"Change Feedback Type",children:[u.jsx("p",{style:{margin:"0 0 1rem 0",fontSize:"0.9rem",opacity:.8},children:"Select a new type for this feedback:"}),u.jsx(oS,{selectedType:C?.feedback_type||"bug",onSelect:Z}),u.jsx(Ve,{variant:"secondary",actionName:"Cancel Change Feedback Type",onClick:()=>x(null),style:{width:"100%"},children:"Cancel"})]})]})}function kB(){Ue.clear(),window.location.reload()}function DB(){const e=Oa().get_current_firebase_user(),{selectedBudgetId:n}=Xe(),r=nP({currentUser:e}),i=z3({currentUser:e}),o=O3({currentUser:e}),l=$3({currentUser:e}),d=C3({currentUser:e}),h=iP({currentUser:e,budgetId:n}),m=cP({currentUser:e}),p=_3({currentUser:e}),g=b3({currentUser:e}),v=r.isScanning||i.isScanning||o.isScanning||l.isScanning||d.isScanning||p.isScanning||g.isScanning,_=i.isRunning||o.isRunning||l.isRunning||d.isRunning||p.isDeleting||g.isDeleting||h.isDownloading||m.isUploading,C=async()=>{await Promise.all([r.scan(),i.scanStatus(),o.scanStatus(),l.scanStatus(),d.scan(),p.scanStatus(),g.scanStatus()])};return u.jsxs("div",{children:[u.jsx("style",{children:"@keyframes spin { to { transform: rotate(360deg); } }"}),u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"},children:[u.jsx("h2",{style:{margin:0},children:"Data Migrations"}),u.jsxs("button",{onClick:C,disabled:v||_,style:{background:"#646cff",color:"white",border:"none",padding:"0.5rem 1rem",borderRadius:"6px",cursor:v||_?"not-allowed":"pointer",fontWeight:500,opacity:v||_?.7:1,display:"flex",alignItems:"center",gap:"0.4rem",minWidth:"130px",minHeight:"36px"},children:[u.jsx("span",{style:{width:"18px",height:"18px",display:"inline-flex",justifyContent:"center",alignItems:"center",flexShrink:0},children:v?u.jsx(Vn,{noMargin:!0}):""}),"Refresh All"]})]}),u.jsx("p",{style:{opacity:.7,marginBottom:"1.5rem"},children:'Run migrations to validate and fix your database. Click "Refresh All" to scan Firestore directly.'}),u.jsx(nz,{disabled:!e,onDownloadBackup:h.downloadBudget,isDownloadingBackup:h.isDownloading}),u.jsx(az,{disabled:!e,onDownloadBackup:h.downloadBudget,isDownloadingBackup:h.isDownloading,accountCategoryValidation:{status:r.status,hasData:!!r.status,hasViolations:r.hasViolations,violationCount:r.violationCount,isScanning:r.isScanning,report:r.report,scan:r.scan},orphanedIdCleanup:{status:i.status,hasData:!!i.status,hasItemsToFix:i.hasItemsToFix,totalOrphaned:i.status?i.status.orphanedCategoryIds+i.status.orphanedAccountIds:0,isScanning:i.isScanning,isRunning:i.isRunning,result:i.result,scanStatus:i.scanStatus,runMigration:i.runMigration},expenseToAdjustment:{status:o.status,hasData:!!o.status,hasItemsToMigrate:o.hasItemsToMigrate,totalToMigrate:o.status?.expensesToMigrate??0,isScanning:o.isScanning,isRunning:o.isRunning,result:o.result,scanStatus:o.scanStatus,runMigration:o.runMigration},adjustmentsToTransfers:{status:l.status,hasData:!!l.status,hasPairsToConvert:l.hasPairsToConvert,totalPairs:l.status?.pairsFound??0,isScanning:l.isScanning,isRunning:l.isRunning,result:l.result,scanStatus:l.scanStatus,runMigration:l.runMigration},precisionCleanup:{status:d.status,hasData:d.hasData,hasIssues:d.hasIssues,totalIssues:d.totalIssues,isScanning:d.isScanning,isRunning:d.isRunning,result:d.result,scan:d.scan,runCleanup:d.runCleanup}}),u.jsx(dz,{disabled:!e,onDownloadBackup:h.downloadBudget,isDownloadingBackup:h.isDownloading,budgetDownloadUpload:{isDownloading:h.isDownloading,downloadProgress:h.progress,downloadError:h.error,downloadBudget:h.downloadBudget,isScanning:m.isScanning,isUploading:m.isUploading,uploadStatus:m.status,uploadProgress:m.progress,uploadError:m.error,uploadResult:m.result,scanZipFile:m.scanZipFile,uploadBudget:m.uploadBudget},deleteAllMonths:{status:p.status,hasData:!!p.status,monthsCount:p.status?.monthsCount??0,budgetCount:p.status?.budgetCount??0,isScanning:p.isScanning,isDeleting:p.isDeleting,deleteResult:p.deleteResult,deleteProgress:p.deleteProgress,scanStatus:p.scanStatus,deleteAllMonths:p.deleteAllMonths},deleteSampleUserBudget:{status:g.status,hasData:!!g.status,totalBudgets:g.status?.totalBudgets??0,totalMonths:g.status?.totalMonths??0,isScanning:g.isScanning,isDeleting:g.isDeleting,deleteResult:g.deleteResult,deleteProgress:g.deleteProgress,scanStatus:g.scanStatus,deleteSampleUserBudget:g.deleteSampleUserBudget},onClearCache:kB}),u.jsx("div",{style:{background:"color-mix(in srgb, currentColor 3%, transparent)",padding:"1rem",borderRadius:"8px",fontSize:"0.85rem"},children:u.jsxs("p",{style:{margin:0,opacity:.7},children:[u.jsx("strong",{children:"Note:"})," These migrations will process ",u.jsx("strong",{children:"all budgets and months"})," in the system, not just the ones you own or are invited to."]})}),u.jsx(JT,{})]})}function Il({name:t,description:e,expectedBehavior:n,result:r,onRun:i,disabled:o,expectedToSucceed:l}){const d=r?.status==="passed"?me.success:r?.status==="failed"?me.danger:r?.status==="running"?me.warning:"inherit";return u.jsxs("div",{style:{...V0,display:"flex",flexDirection:"column",gap:"0.5rem"},children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",gap:"1rem"},children:[u.jsxs("div",{style:{flex:1},children:[u.jsx("h4",{style:{margin:0,fontSize:"0.95rem"},children:t}),u.jsx("p",{style:{margin:"0.25rem 0 0",opacity:.7,fontSize:"0.85rem"},children:e}),u.jsxs("p",{style:{margin:"0.25rem 0 0",fontSize:"0.8rem",color:l?me.success:me.warning},children:["Expected: ",n]})]}),u.jsx(Ve,{onClick:i,disabled:o,variant:"secondary",style:{flexShrink:0},children:r?.status==="running"?"":"Run"})]}),r&&r.status!=="pending"&&u.jsx("div",{style:{padding:"0.5rem 0.75rem",borderRadius:"6px",background:`color-mix(in srgb, ${d} 15%, transparent)`,border:`1px solid color-mix(in srgb, ${d} 30%, transparent)`,fontSize:"0.85rem",color:d},children:r.message})]})}function OB({totalCount:t,passedCount:e,failedCount:n}){return u.jsxs("div",{style:{display:"flex",gap:"1rem",padding:"0.75rem 1rem",borderRadius:"8px",background:"color-mix(in srgb, currentColor 5%, transparent)",marginBottom:"1rem"},children:[u.jsxs("span",{children:["Total: ",u.jsx("strong",{children:t})]}),u.jsxs("span",{style:{color:me.success},children:["Passed: ",u.jsx("strong",{children:e})]}),u.jsxs("span",{style:{color:me.danger},children:["Failed: ",u.jsx("strong",{children:n})]})]})}const lS=[{name:"Read unauthorized budget",expectedToFail:!0},{name:"Read another user's document",expectedToFail:!0},{name:"Read unauthorized budget month",expectedToFail:!0},{name:"Toggle is_admin in own permission_flags",expectedToFail:!0},{name:"Toggle is_test in own permission_flags",expectedToFail:!0},{name:"Read own user document",expectedToFail:!1}];function MB(){const{currentUserId:t}=Xe(),[e,n]=D.useState([]),[r,i]=D.useState(!1);function o(_,C){n(x=>x.map(S=>S.name===_?{...S,...C}:S))}async function l(_,C,x){o(_,{status:"running",message:"Running..."});try{const S=await C();x?o(_,{status:"failed",message:` ${S}`}):o(_,{status:"passed",message:` ${S}`})}catch(S){const E=S instanceof Error?S.message:"Unknown error";x?o(_,{status:"passed",message:` Blocked as expected: ${E}`}):o(_,{status:"failed",message:` ${E}`})}}async function d(){i(!0),n(lS.map(_=>({..._,status:"pending",message:""})));for(const _ of lS)await h(_.name);i(!1)}async function h(_){switch(_){case"Read unauthorized budget":await l(_,async()=>(await jt("budgets","unauthorized_budget_test_12345","security test: attempting unauthorized budget read"),"Was able to read budget (unexpected)"),!0);break;case"Read another user's document":await l(_,async()=>(await jt("users","another_user_test_12345","security test: attempting unauthorized user read"),"Was able to read user document (unexpected)"),!0);break;case"Read unauthorized budget month":await l(_,async()=>(await jt("months","unauthorized_budget_test_12345_2024_01","security test: attempting unauthorized month read"),"Was able to read month document for unauthorized budget (unexpected)"),!0);break;case"Toggle is_admin in own permission_flags":await l(_,async()=>{if(!t)throw new Error("Not authenticated");const{data:C}=await jt("users",t,"security test: reading own user to get current is_admin value"),x=C?.permission_flags?.is_admin??!1;return await Tf("users",t,{"permission_flags.is_admin":!x},"security test: attempting to toggle is_admin (should fail)"),`Was able to change is_admin from ${x} to ${!x} (SECURITY ISSUE!)`},!0);break;case"Toggle is_test in own permission_flags":await l(_,async()=>{if(!t)throw new Error("Not authenticated");const{data:C}=await jt("users",t,"security test: reading own user to get current is_test value"),x=C?.permission_flags?.is_test??!1;return await Tf("users",t,{"permission_flags.is_test":!x},"security test: attempting to toggle is_test (should fail)"),`Was able to change is_test from ${x} to ${!x} (SECURITY ISSUE!)`},!0);break;case"Read own user document":await l(_,async()=>{if(!t)throw new Error("Not authenticated");const{exists:C}=await jt("users",t,"security test: reading own user document (should succeed)");if(C)return"Successfully read own document";throw new Error("Document does not exist")},!1);break}}async function m(_){e.find(x=>x.name===_)||n(x=>[...x,{name:_,status:"pending",message:"",expectedToFail:!0}]),i(!0),await h(_),i(!1)}const p=e.filter(_=>_.status==="passed").length,g=e.filter(_=>_.status==="failed").length,v=e.length;return u.jsxs("div",{children:[u.jsx("p",{style:AT,children:'Run security tests to verify Firestore rules are working correctly. Tests that are expected to fail (blocked by security rules) should show as "passed".'}),u.jsx("div",{style:{marginBottom:"1.5rem"},children:u.jsx(Ve,{onClick:d,disabled:r,variant:"primary",children:r?"Running Tests...":"Run All Tests"})}),e.length>0&&u.jsx(OB,{totalCount:v,passedCount:p,failedCount:g}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:[u.jsx("h3",{style:{margin:"0.5rem 0"},children:"Individual Tests"}),u.jsx(Il,{name:"Read unauthorized budget",description:"Try to read a budget the user doesn't have access to",expectedBehavior:"Should be blocked by Firestore rules",result:e.find(_=>_.name==="Read unauthorized budget"),onRun:()=>m("Read unauthorized budget"),disabled:r}),u.jsx(Il,{name:"Read another user's document",description:"Try to read another user's profile document",expectedBehavior:"Should be blocked by Firestore rules",result:e.find(_=>_.name==="Read another user's document"),onRun:()=>m("Read another user's document"),disabled:r}),u.jsx(Il,{name:"Read unauthorized budget month",description:"Try to read a month document for a budget you don't have access to",expectedBehavior:"Should be blocked - months inherit budget access",result:e.find(_=>_.name==="Read unauthorized budget month"),onRun:()=>m("Read unauthorized budget month"),disabled:r}),u.jsx(Il,{name:"Toggle is_admin in own permission_flags",description:"Try to change your admin privileges (toggles current value)",expectedBehavior:"Should be blocked - permission_flags is protected",result:e.find(_=>_.name==="Toggle is_admin in own permission_flags"),onRun:()=>m("Toggle is_admin in own permission_flags"),disabled:r}),u.jsx(Il,{name:"Toggle is_test in own permission_flags",description:"Try to change your test privileges (toggles current value)",expectedBehavior:"Should be blocked - permission_flags is protected",result:e.find(_=>_.name==="Toggle is_test in own permission_flags"),onRun:()=>m("Toggle is_test in own permission_flags"),disabled:r}),u.jsx(Il,{name:"Read own user document",description:"Read your own user profile document",expectedBehavior:"Should succeed - users can read their own data",result:e.find(_=>_.name==="Read own user document"),onRun:()=>m("Read own user document"),disabled:r,expectedToSucceed:!0})]}),g>0&&u.jsxs(mm,{style:{marginTop:"1.5rem"},children:[" ",g," test(s) failed! This may indicate a security vulnerability in your Firestore rules."]})]})}function NB({children:t}){const{addLoadingHold:e,removeLoadingHold:n}=Gn(),r=D.useContext(cd),i=Mn();return D.useEffect(()=>(r.is_auth_checked?n("protected-route"):e("protected-route","Checking authentication..."),()=>n("protected-route")),[r.is_auth_checked,e,n]),r.is_auth_checked?r.is_logged_in?t?u.jsx(u.Fragment,{children:t}):u.jsx(Bf,{}):u.jsx(zf,{to:"/account",state:{from:i.pathname},replace:!0}):null}function PB(){const{addLoadingHold:t,removeLoadingHold:e}=Gn(),{isInitialized:n,pageTitle:r}=Xe(),{isLoading:i,error:o}=jn();return D.useEffect(()=>{n?e("budget-init"):t("budget-init",i?"Fetching data from server...":"Loading budget...")},[n,i,t,e]),D.useEffect(()=>()=>e("budget-init"),[e]),o?(console.error("[BudgetLayout] Error:",o),u.jsx("div",{style:Rf,children:u.jsxs("p",{style:{color:"#ef4444"},children:["Error: ",o.message]})})):u.jsx("div",{style:{...Rf,paddingBottom:"5rem"},children:u.jsxs(WT,{children:[u.jsx(bP,{title:r}),n&&u.jsx(Bf,{})]})})}const zB={is_logged_in:!1,is_auth_checked:!1,username:"",set_user_context:()=>{}};function BB(){const{isLoading:t,loadingMessage:e}=Gn();return t?u.jsx(Y0,{message:e}):null}function LB(){const[t,e]=D.useState(null);return D.useEffect(()=>pr.subscribe(e),[]),t?u.jsx(xP,{item:t,onDismiss:n=>pr.remove(n)}):null}function UB(){const{selectedBudgetId:t,isInitialized:e}=Xe(),n=Vt(),r=t?["initialDataLoad",t]:null,i=r?n.getQueryState(r)?.status==="success":!1;return wn(),l3(),d3(t,i&&e),u.jsxs(u.Fragment,{children:[u.jsxs(Q5,{children:[u.jsx(Cn,{path:"/",element:u.jsx(hz,{})}),u.jsx(Cn,{path:"/account",element:u.jsx(fz,{})}),u.jsx(Cn,{path:"/budget",element:u.jsx(NB,{}),children:u.jsxs(Cn,{element:u.jsx(PB,{}),children:[u.jsx(Cn,{index:!0,element:u.jsx(eS,{})}),u.jsx(Cn,{path:":year/:month/:tab/:view?",element:u.jsx(eS,{})}),u.jsx(Cn,{path:"analytics",element:u.jsx(uB,{})}),u.jsx(Cn,{path:"my-budgets",element:u.jsx(bB,{})}),u.jsxs(Cn,{path:"settings",element:u.jsx(xB,{}),children:[u.jsx(Cn,{index:!0,element:u.jsx(zf,{to:"categories",replace:!0})}),u.jsx(Cn,{path:"accounts",element:u.jsx(SB,{})}),u.jsx(Cn,{path:"categories",element:u.jsx(EB,{})}),u.jsx(Cn,{path:"users",element:u.jsx(TB,{})})]}),u.jsxs(Cn,{path:"admin",element:u.jsx(jB,{}),children:[u.jsx(Cn,{path:"budget",element:u.jsx(RB,{})}),u.jsx(Cn,{path:"feedback",element:u.jsx(IB,{})}),u.jsx(Cn,{path:"migration",element:u.jsx(DB,{})}),u.jsx(Cn,{path:"tests",element:u.jsx(MB,{})})]})]})})]}),u.jsx(gP,{}),u.jsx(JT,{}),u.jsx(LB,{})]})}function FB(){const[t,e]=D.useState(zB),n=Oa(),r=D.useRef(!1),{addLoadingHold:i,removeLoadingHold:o}=Gn();return D.useEffect(function(){r.current||(r.current=!0,n.set_user_listener(l=>{e({is_logged_in:l!=null,is_auth_checked:!0,username:l?.email??"",set_user_context:e})}))},[n]),D.useEffect(()=>{t.is_auth_checked?o("auth"):i("auth","Authenticating...")},[t.is_auth_checked,i,o]),t.is_auth_checked?u.jsx(cd.Provider,{value:t,children:u.jsx(hO,{children:u.jsx(WP,{children:u.jsx(H4,{children:u.jsx(f3,{children:u.jsx(_j,{children:u.jsx(UB,{})})})})})})}):null}function VB(){return u.jsxs(uR,{children:[u.jsx(BB,{}),u.jsx(FB,{})]})}Q2.createRoot(document.getElementById("root")).render(u.jsx(D.StrictMode,{children:u.jsx(VB,{})}));
