(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function n(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=n(i);fetch(i.href,o)}})();var Vh=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Q2(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Tg={exports:{}},bu={};var Cx;function K2(){if(Cx)return bu;Cx=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function n(r,i,o){var l=null;if(o!==void 0&&(l=""+o),i.key!==void 0&&(l=""+i.key),"key"in i){o={};for(var d in i)d!=="key"&&(o[d]=i[d])}else o=i;return i=o.ref,{$$typeof:t,type:r,key:l,ref:i!==void 0?i:null,props:o}}return bu.Fragment=e,bu.jsx=n,bu.jsxs=n,bu}var Tx;function Y2(){return Tx||(Tx=1,Tg.exports=K2()),Tg.exports}var u=Y2(),Ag={exports:{}},et={};var Ax;function X2(){if(Ax)return et;Ax=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),o=Symbol.for("react.consumer"),l=Symbol.for("react.context"),d=Symbol.for("react.forward_ref"),h=Symbol.for("react.suspense"),f=Symbol.for("react.memo"),p=Symbol.for("react.lazy"),g=Symbol.for("react.activity"),b=Symbol.iterator;function _(z){return z===null||typeof z!="object"?null:(z=b&&z[b]||z["@@iterator"],typeof z=="function"?z:null)}var w={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},x=Object.assign,S={};function C(z,H,re){this.props=z,this.context=H,this.refs=S,this.updater=re||w}C.prototype.isReactComponent={},C.prototype.setState=function(z,H){if(typeof z!="object"&&typeof z!="function"&&z!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,z,H,"setState")},C.prototype.forceUpdate=function(z){this.updater.enqueueForceUpdate(this,z,"forceUpdate")};function T(){}T.prototype=C.prototype;function R(z,H,re){this.props=z,this.context=H,this.refs=S,this.updater=re||w}var D=R.prototype=new T;D.constructor=R,x(D,C.prototype),D.isPureReactComponent=!0;var V=Array.isArray;function $(){}var k={H:null,A:null,T:null,S:null},M=Object.prototype.hasOwnProperty;function B(z,H,re){var ne=re.ref;return{$$typeof:t,type:z,key:H,ref:ne!==void 0?ne:null,props:re}}function U(z,H){return B(z.type,H,z.props)}function q(z){return typeof z=="object"&&z!==null&&z.$$typeof===t}function I(z){var H={"=":"=0",":":"=2"};return"$"+z.replace(/[=:]/g,function(re){return H[re]})}var N=/\/+/g;function O(z,H){return typeof z=="object"&&z!==null&&z.key!=null?I(""+z.key):H.toString(36)}function J(z){switch(z.status){case"fulfilled":return z.value;case"rejected":throw z.reason;default:switch(typeof z.status=="string"?z.then($,$):(z.status="pending",z.then(function(H){z.status==="pending"&&(z.status="fulfilled",z.value=H)},function(H){z.status==="pending"&&(z.status="rejected",z.reason=H)})),z.status){case"fulfilled":return z.value;case"rejected":throw z.reason}}throw z}function Y(z,H,re,ne,ce){var he=typeof z;(he==="undefined"||he==="boolean")&&(z=null);var we=!1;if(z===null)we=!0;else switch(he){case"bigint":case"string":case"number":we=!0;break;case"object":switch(z.$$typeof){case t:case e:we=!0;break;case p:return we=z._init,Y(we(z._payload),H,re,ne,ce)}}if(we)return ce=ce(z),we=ne===""?"."+O(z,0):ne,V(ce)?(re="",we!=null&&(re=we.replace(N,"$&/")+"/"),Y(ce,H,re,"",function(Me){return Me})):ce!=null&&(q(ce)&&(ce=U(ce,re+(ce.key==null||z&&z.key===ce.key?"":(""+ce.key).replace(N,"$&/")+"/")+we)),H.push(ce)),1;we=0;var oe=ne===""?".":ne+":";if(V(z))for(var be=0;be<z.length;be++)ne=z[be],he=oe+O(ne,be),we+=Y(ne,H,re,he,ce);else if(be=_(z),typeof be=="function")for(z=be.call(z),be=0;!(ne=z.next()).done;)ne=ne.value,he=oe+O(ne,be++),we+=Y(ne,H,re,he,ce);else if(he==="object"){if(typeof z.then=="function")return Y(J(z),H,re,ne,ce);throw H=String(z),Error("Objects are not valid as a React child (found: "+(H==="[object Object]"?"object with keys {"+Object.keys(z).join(", ")+"}":H)+"). If you meant to render a collection of children, use an array instead.")}return we}function G(z,H,re){if(z==null)return z;var ne=[],ce=0;return Y(z,ne,"","",function(he){return H.call(re,he,ce++)}),ne}function Z(z){if(z._status===-1){var H=z._result;H=H(),H.then(function(re){(z._status===0||z._status===-1)&&(z._status=1,z._result=re)},function(re){(z._status===0||z._status===-1)&&(z._status=2,z._result=re)}),z._status===-1&&(z._status=0,z._result=H)}if(z._status===1)return z._result.default;throw z._result}var Q=typeof reportError=="function"?reportError:function(z){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var H=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof z=="object"&&z!==null&&typeof z.message=="string"?String(z.message):String(z),error:z});if(!window.dispatchEvent(H))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",z);return}console.error(z)},te={map:G,forEach:function(z,H,re){G(z,function(){H.apply(this,arguments)},re)},count:function(z){var H=0;return G(z,function(){H++}),H},toArray:function(z){return G(z,function(H){return H})||[]},only:function(z){if(!q(z))throw Error("React.Children.only expected to receive a single React element child.");return z}};return et.Activity=g,et.Children=te,et.Component=C,et.Fragment=n,et.Profiler=i,et.PureComponent=R,et.StrictMode=r,et.Suspense=h,et.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=k,et.__COMPILER_RUNTIME={__proto__:null,c:function(z){return k.H.useMemoCache(z)}},et.cache=function(z){return function(){return z.apply(null,arguments)}},et.cacheSignal=function(){return null},et.cloneElement=function(z,H,re){if(z==null)throw Error("The argument must be a React element, but you passed "+z+".");var ne=x({},z.props),ce=z.key;if(H!=null)for(he in H.key!==void 0&&(ce=""+H.key),H)!M.call(H,he)||he==="key"||he==="__self"||he==="__source"||he==="ref"&&H.ref===void 0||(ne[he]=H[he]);var he=arguments.length-2;if(he===1)ne.children=re;else if(1<he){for(var we=Array(he),oe=0;oe<he;oe++)we[oe]=arguments[oe+2];ne.children=we}return B(z.type,ce,ne)},et.createContext=function(z){return z={$$typeof:l,_currentValue:z,_currentValue2:z,_threadCount:0,Provider:null,Consumer:null},z.Provider=z,z.Consumer={$$typeof:o,_context:z},z},et.createElement=function(z,H,re){var ne,ce={},he=null;if(H!=null)for(ne in H.key!==void 0&&(he=""+H.key),H)M.call(H,ne)&&ne!=="key"&&ne!=="__self"&&ne!=="__source"&&(ce[ne]=H[ne]);var we=arguments.length-2;if(we===1)ce.children=re;else if(1<we){for(var oe=Array(we),be=0;be<we;be++)oe[be]=arguments[be+2];ce.children=oe}if(z&&z.defaultProps)for(ne in we=z.defaultProps,we)ce[ne]===void 0&&(ce[ne]=we[ne]);return B(z,he,ce)},et.createRef=function(){return{current:null}},et.forwardRef=function(z){return{$$typeof:d,render:z}},et.isValidElement=q,et.lazy=function(z){return{$$typeof:p,_payload:{_status:-1,_result:z},_init:Z}},et.memo=function(z,H){return{$$typeof:f,type:z,compare:H===void 0?null:H}},et.startTransition=function(z){var H=k.T,re={};k.T=re;try{var ne=z(),ce=k.S;ce!==null&&ce(re,ne),typeof ne=="object"&&ne!==null&&typeof ne.then=="function"&&ne.then($,Q)}catch(he){Q(he)}finally{H!==null&&re.types!==null&&(H.types=re.types),k.T=H}},et.unstable_useCacheRefresh=function(){return k.H.useCacheRefresh()},et.use=function(z){return k.H.use(z)},et.useActionState=function(z,H,re){return k.H.useActionState(z,H,re)},et.useCallback=function(z,H){return k.H.useCallback(z,H)},et.useContext=function(z){return k.H.useContext(z)},et.useDebugValue=function(){},et.useDeferredValue=function(z,H){return k.H.useDeferredValue(z,H)},et.useEffect=function(z,H){return k.H.useEffect(z,H)},et.useEffectEvent=function(z){return k.H.useEffectEvent(z)},et.useId=function(){return k.H.useId()},et.useImperativeHandle=function(z,H,re){return k.H.useImperativeHandle(z,H,re)},et.useInsertionEffect=function(z,H){return k.H.useInsertionEffect(z,H)},et.useLayoutEffect=function(z,H){return k.H.useLayoutEffect(z,H)},et.useMemo=function(z,H){return k.H.useMemo(z,H)},et.useOptimistic=function(z,H){return k.H.useOptimistic(z,H)},et.useReducer=function(z,H,re){return k.H.useReducer(z,H,re)},et.useRef=function(z){return k.H.useRef(z)},et.useState=function(z){return k.H.useState(z)},et.useSyncExternalStore=function(z,H,re){return k.H.useSyncExternalStore(z,H,re)},et.useTransition=function(){return k.H.useTransition()},et.version="19.2.3",et}var jx;function By(){return jx||(jx=1,Ag.exports=X2()),Ag.exports}var j=By(),jg={exports:{}},vu={},Rg={exports:{}},Ig={};var Rx;function Z2(){return Rx||(Rx=1,(function(t){function e(Y,G){var Z=Y.length;Y.push(G);e:for(;0<Z;){var Q=Z-1>>>1,te=Y[Q];if(0<i(te,G))Y[Q]=G,Y[Z]=te,Z=Q;else break e}}function n(Y){return Y.length===0?null:Y[0]}function r(Y){if(Y.length===0)return null;var G=Y[0],Z=Y.pop();if(Z!==G){Y[0]=Z;e:for(var Q=0,te=Y.length,z=te>>>1;Q<z;){var H=2*(Q+1)-1,re=Y[H],ne=H+1,ce=Y[ne];if(0>i(re,Z))ne<te&&0>i(ce,re)?(Y[Q]=ce,Y[ne]=Z,Q=ne):(Y[Q]=re,Y[H]=Z,Q=H);else if(ne<te&&0>i(ce,Z))Y[Q]=ce,Y[ne]=Z,Q=ne;else break e}}return G}function i(Y,G){var Z=Y.sortIndex-G.sortIndex;return Z!==0?Z:Y.id-G.id}if(t.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var o=performance;t.unstable_now=function(){return o.now()}}else{var l=Date,d=l.now();t.unstable_now=function(){return l.now()-d}}var h=[],f=[],p=1,g=null,b=3,_=!1,w=!1,x=!1,S=!1,C=typeof setTimeout=="function"?setTimeout:null,T=typeof clearTimeout=="function"?clearTimeout:null,R=typeof setImmediate<"u"?setImmediate:null;function D(Y){for(var G=n(f);G!==null;){if(G.callback===null)r(f);else if(G.startTime<=Y)r(f),G.sortIndex=G.expirationTime,e(h,G);else break;G=n(f)}}function V(Y){if(x=!1,D(Y),!w)if(n(h)!==null)w=!0,$||($=!0,I());else{var G=n(f);G!==null&&J(V,G.startTime-Y)}}var $=!1,k=-1,M=5,B=-1;function U(){return S?!0:!(t.unstable_now()-B<M)}function q(){if(S=!1,$){var Y=t.unstable_now();B=Y;var G=!0;try{e:{w=!1,x&&(x=!1,T(k),k=-1),_=!0;var Z=b;try{t:{for(D(Y),g=n(h);g!==null&&!(g.expirationTime>Y&&U());){var Q=g.callback;if(typeof Q=="function"){g.callback=null,b=g.priorityLevel;var te=Q(g.expirationTime<=Y);if(Y=t.unstable_now(),typeof te=="function"){g.callback=te,D(Y),G=!0;break t}g===n(h)&&r(h),D(Y)}else r(h);g=n(h)}if(g!==null)G=!0;else{var z=n(f);z!==null&&J(V,z.startTime-Y),G=!1}}break e}finally{g=null,b=Z,_=!1}G=void 0}}finally{G?I():$=!1}}}var I;if(typeof R=="function")I=function(){R(q)};else if(typeof MessageChannel<"u"){var N=new MessageChannel,O=N.port2;N.port1.onmessage=q,I=function(){O.postMessage(null)}}else I=function(){C(q,0)};function J(Y,G){k=C(function(){Y(t.unstable_now())},G)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(Y){Y.callback=null},t.unstable_forceFrameRate=function(Y){0>Y||125<Y?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):M=0<Y?Math.floor(1e3/Y):5},t.unstable_getCurrentPriorityLevel=function(){return b},t.unstable_next=function(Y){switch(b){case 1:case 2:case 3:var G=3;break;default:G=b}var Z=b;b=G;try{return Y()}finally{b=Z}},t.unstable_requestPaint=function(){S=!0},t.unstable_runWithPriority=function(Y,G){switch(Y){case 1:case 2:case 3:case 4:case 5:break;default:Y=3}var Z=b;b=Y;try{return G()}finally{b=Z}},t.unstable_scheduleCallback=function(Y,G,Z){var Q=t.unstable_now();switch(typeof Z=="object"&&Z!==null?(Z=Z.delay,Z=typeof Z=="number"&&0<Z?Q+Z:Q):Z=Q,Y){case 1:var te=-1;break;case 2:te=250;break;case 5:te=1073741823;break;case 4:te=1e4;break;default:te=5e3}return te=Z+te,Y={id:p++,callback:G,priorityLevel:Y,startTime:Z,expirationTime:te,sortIndex:-1},Z>Q?(Y.sortIndex=Z,e(f,Y),n(h)===null&&Y===n(f)&&(x?(T(k),k=-1):x=!0,J(V,Z-Q))):(Y.sortIndex=te,e(h,Y),w||_||(w=!0,$||($=!0,I()))),Y},t.unstable_shouldYield=U,t.unstable_wrapCallback=function(Y){var G=b;return function(){var Z=b;b=G;try{return Y.apply(this,arguments)}finally{b=Z}}}})(Ig)),Ig}var Ix;function J2(){return Ix||(Ix=1,Rg.exports=Z2()),Rg.exports}var Dg={exports:{}},Qn={};var Dx;function e5(){if(Dx)return Qn;Dx=1;var t=By();function e(h){var f="https://react.dev/errors/"+h;if(1<arguments.length){f+="?args[]="+encodeURIComponent(arguments[1]);for(var p=2;p<arguments.length;p++)f+="&args[]="+encodeURIComponent(arguments[p])}return"Minified React error #"+h+"; visit "+f+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function n(){}var r={d:{f:n,r:function(){throw Error(e(522))},D:n,C:n,L:n,m:n,X:n,S:n,M:n},p:0,findDOMNode:null},i=Symbol.for("react.portal");function o(h,f,p){var g=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:i,key:g==null?null:""+g,children:h,containerInfo:f,implementation:p}}var l=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function d(h,f){if(h==="font")return"";if(typeof f=="string")return f==="use-credentials"?f:""}return Qn.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=r,Qn.createPortal=function(h,f){var p=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!f||f.nodeType!==1&&f.nodeType!==9&&f.nodeType!==11)throw Error(e(299));return o(h,f,null,p)},Qn.flushSync=function(h){var f=l.T,p=r.p;try{if(l.T=null,r.p=2,h)return h()}finally{l.T=f,r.p=p,r.d.f()}},Qn.preconnect=function(h,f){typeof h=="string"&&(f?(f=f.crossOrigin,f=typeof f=="string"?f==="use-credentials"?f:"":void 0):f=null,r.d.C(h,f))},Qn.prefetchDNS=function(h){typeof h=="string"&&r.d.D(h)},Qn.preinit=function(h,f){if(typeof h=="string"&&f&&typeof f.as=="string"){var p=f.as,g=d(p,f.crossOrigin),b=typeof f.integrity=="string"?f.integrity:void 0,_=typeof f.fetchPriority=="string"?f.fetchPriority:void 0;p==="style"?r.d.S(h,typeof f.precedence=="string"?f.precedence:void 0,{crossOrigin:g,integrity:b,fetchPriority:_}):p==="script"&&r.d.X(h,{crossOrigin:g,integrity:b,fetchPriority:_,nonce:typeof f.nonce=="string"?f.nonce:void 0})}},Qn.preinitModule=function(h,f){if(typeof h=="string")if(typeof f=="object"&&f!==null){if(f.as==null||f.as==="script"){var p=d(f.as,f.crossOrigin);r.d.M(h,{crossOrigin:p,integrity:typeof f.integrity=="string"?f.integrity:void 0,nonce:typeof f.nonce=="string"?f.nonce:void 0})}}else f==null&&r.d.M(h)},Qn.preload=function(h,f){if(typeof h=="string"&&typeof f=="object"&&f!==null&&typeof f.as=="string"){var p=f.as,g=d(p,f.crossOrigin);r.d.L(h,p,{crossOrigin:g,integrity:typeof f.integrity=="string"?f.integrity:void 0,nonce:typeof f.nonce=="string"?f.nonce:void 0,type:typeof f.type=="string"?f.type:void 0,fetchPriority:typeof f.fetchPriority=="string"?f.fetchPriority:void 0,referrerPolicy:typeof f.referrerPolicy=="string"?f.referrerPolicy:void 0,imageSrcSet:typeof f.imageSrcSet=="string"?f.imageSrcSet:void 0,imageSizes:typeof f.imageSizes=="string"?f.imageSizes:void 0,media:typeof f.media=="string"?f.media:void 0})}},Qn.preloadModule=function(h,f){if(typeof h=="string")if(f){var p=d(f.as,f.crossOrigin);r.d.m(h,{as:typeof f.as=="string"&&f.as!=="script"?f.as:void 0,crossOrigin:p,integrity:typeof f.integrity=="string"?f.integrity:void 0})}else r.d.m(h)},Qn.requestFormReset=function(h){r.d.r(h)},Qn.unstable_batchedUpdates=function(h,f){return h(f)},Qn.useFormState=function(h,f,p){return l.H.useFormState(h,f,p)},Qn.useFormStatus=function(){return l.H.useHostTransitionStatus()},Qn.version="19.2.3",Qn}var kx;function t5(){if(kx)return Dg.exports;kx=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),Dg.exports=e5(),Dg.exports}var Mx;function n5(){if(Mx)return vu;Mx=1;var t=J2(),e=By(),n=t5();function r(s){var a="https://react.dev/errors/"+s;if(1<arguments.length){a+="?args[]="+encodeURIComponent(arguments[1]);for(var c=2;c<arguments.length;c++)a+="&args[]="+encodeURIComponent(arguments[c])}return"Minified React error #"+s+"; visit "+a+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(s){return!(!s||s.nodeType!==1&&s.nodeType!==9&&s.nodeType!==11)}function o(s){var a=s,c=s;if(s.alternate)for(;a.return;)a=a.return;else{s=a;do a=s,(a.flags&4098)!==0&&(c=a.return),s=a.return;while(s)}return a.tag===3?c:null}function l(s){if(s.tag===13){var a=s.memoizedState;if(a===null&&(s=s.alternate,s!==null&&(a=s.memoizedState)),a!==null)return a.dehydrated}return null}function d(s){if(s.tag===31){var a=s.memoizedState;if(a===null&&(s=s.alternate,s!==null&&(a=s.memoizedState)),a!==null)return a.dehydrated}return null}function h(s){if(o(s)!==s)throw Error(r(188))}function f(s){var a=s.alternate;if(!a){if(a=o(s),a===null)throw Error(r(188));return a!==s?null:s}for(var c=s,m=a;;){var v=c.return;if(v===null)break;var E=v.alternate;if(E===null){if(m=v.return,m!==null){c=m;continue}break}if(v.child===E.child){for(E=v.child;E;){if(E===c)return h(v),s;if(E===m)return h(v),a;E=E.sibling}throw Error(r(188))}if(c.return!==m.return)c=v,m=E;else{for(var P=!1,W=v.child;W;){if(W===c){P=!0,c=v,m=E;break}if(W===m){P=!0,m=v,c=E;break}W=W.sibling}if(!P){for(W=E.child;W;){if(W===c){P=!0,c=E,m=v;break}if(W===m){P=!0,m=E,c=v;break}W=W.sibling}if(!P)throw Error(r(189))}}if(c.alternate!==m)throw Error(r(190))}if(c.tag!==3)throw Error(r(188));return c.stateNode.current===c?s:a}function p(s){var a=s.tag;if(a===5||a===26||a===27||a===6)return s;for(s=s.child;s!==null;){if(a=p(s),a!==null)return a;s=s.sibling}return null}var g=Object.assign,b=Symbol.for("react.element"),_=Symbol.for("react.transitional.element"),w=Symbol.for("react.portal"),x=Symbol.for("react.fragment"),S=Symbol.for("react.strict_mode"),C=Symbol.for("react.profiler"),T=Symbol.for("react.consumer"),R=Symbol.for("react.context"),D=Symbol.for("react.forward_ref"),V=Symbol.for("react.suspense"),$=Symbol.for("react.suspense_list"),k=Symbol.for("react.memo"),M=Symbol.for("react.lazy"),B=Symbol.for("react.activity"),U=Symbol.for("react.memo_cache_sentinel"),q=Symbol.iterator;function I(s){return s===null||typeof s!="object"?null:(s=q&&s[q]||s["@@iterator"],typeof s=="function"?s:null)}var N=Symbol.for("react.client.reference");function O(s){if(s==null)return null;if(typeof s=="function")return s.$$typeof===N?null:s.displayName||s.name||null;if(typeof s=="string")return s;switch(s){case x:return"Fragment";case C:return"Profiler";case S:return"StrictMode";case V:return"Suspense";case $:return"SuspenseList";case B:return"Activity"}if(typeof s=="object")switch(s.$$typeof){case w:return"Portal";case R:return s.displayName||"Context";case T:return(s._context.displayName||"Context")+".Consumer";case D:var a=s.render;return s=s.displayName,s||(s=a.displayName||a.name||"",s=s!==""?"ForwardRef("+s+")":"ForwardRef"),s;case k:return a=s.displayName||null,a!==null?a:O(s.type)||"Memo";case M:a=s._payload,s=s._init;try{return O(s(a))}catch{}}return null}var J=Array.isArray,Y=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,G=n.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Z={pending:!1,data:null,method:null,action:null},Q=[],te=-1;function z(s){return{current:s}}function H(s){0>te||(s.current=Q[te],Q[te]=null,te--)}function re(s,a){te++,Q[te]=s.current,s.current=a}var ne=z(null),ce=z(null),he=z(null),we=z(null);function oe(s,a){switch(re(he,a),re(ce,s),re(ne,null),a.nodeType){case 9:case 11:s=(s=a.documentElement)&&(s=s.namespaceURI)?Qv(s):0;break;default:if(s=a.tagName,a=a.namespaceURI)a=Qv(a),s=Kv(a,s);else switch(s){case"svg":s=1;break;case"math":s=2;break;default:s=0}}H(ne),re(ne,s)}function be(){H(ne),H(ce),H(he)}function Me(s){s.memoizedState!==null&&re(we,s);var a=ne.current,c=Kv(a,s.type);a!==c&&(re(ce,s),re(ne,c))}function ze(s){ce.current===s&&(H(ne),H(ce)),we.current===s&&(H(we),pu._currentValue=Z)}var at,lt;function L(s){if(at===void 0)try{throw Error()}catch(c){var a=c.stack.trim().match(/\n( *(at )?)/);at=a&&a[1]||"",lt=-1<c.stack.indexOf(`
    at`)?" (<anonymous>)":-1<c.stack.indexOf("@")?"@unknown:0:0":""}return`
`+at+s+lt}var de=!1;function ye(s,a){if(!s||de)return"";de=!0;var c=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var m={DetermineComponentFrameRoot:function(){try{if(a){var De=function(){throw Error()};if(Object.defineProperty(De.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(De,[])}catch(xe){var _e=xe}Reflect.construct(s,[],De)}else{try{De.call()}catch(xe){_e=xe}s.call(De.prototype)}}else{try{throw Error()}catch(xe){_e=xe}(De=s())&&typeof De.catch=="function"&&De.catch(function(){})}}catch(xe){if(xe&&_e&&typeof xe.stack=="string")return[xe.stack,_e.stack]}return[null,null]}};m.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var v=Object.getOwnPropertyDescriptor(m.DetermineComponentFrameRoot,"name");v&&v.configurable&&Object.defineProperty(m.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var E=m.DetermineComponentFrameRoot(),P=E[0],W=E[1];if(P&&W){var se=P.split(`
`),pe=W.split(`
`);for(v=m=0;m<se.length&&!se[m].includes("DetermineComponentFrameRoot");)m++;for(;v<pe.length&&!pe[v].includes("DetermineComponentFrameRoot");)v++;if(m===se.length||v===pe.length)for(m=se.length-1,v=pe.length-1;1<=m&&0<=v&&se[m]!==pe[v];)v--;for(;1<=m&&0<=v;m--,v--)if(se[m]!==pe[v]){if(m!==1||v!==1)do if(m--,v--,0>v||se[m]!==pe[v]){var Te=`
`+se[m].replace(" at new "," at ");return s.displayName&&Te.includes("<anonymous>")&&(Te=Te.replace("<anonymous>",s.displayName)),Te}while(1<=m&&0<=v);break}}}finally{de=!1,Error.prepareStackTrace=c}return(c=s?s.displayName||s.name:"")?L(c):""}function ee(s,a){switch(s.tag){case 26:case 27:case 5:return L(s.type);case 16:return L("Lazy");case 13:return s.child!==a&&a!==null?L("Suspense Fallback"):L("Suspense");case 19:return L("SuspenseList");case 0:case 15:return ye(s.type,!1);case 11:return ye(s.type.render,!1);case 1:return ye(s.type,!0);case 31:return L("Activity");default:return""}}function X(s){try{var a="",c=null;do a+=ee(s,c),c=s,s=s.return;while(s);return a}catch(m){return`
Error generating stack: `+m.message+`
`+m.stack}}var ae=Object.prototype.hasOwnProperty,Ee=t.unstable_scheduleCallback,Se=t.unstable_cancelCallback,ie=t.unstable_shouldYield,Re=t.unstable_requestPaint,Ne=t.unstable_now,Oe=t.unstable_getCurrentPriorityLevel,He=t.unstable_ImmediatePriority,xt=t.unstable_UserBlockingPriority,nt=t.unstable_NormalPriority,Gn=t.unstable_LowPriority,gs=t.unstable_IdlePriority,sr=t.log,ys=t.unstable_setDisableYieldValue,vt=null,nn=null;function Wn(s){if(typeof sr=="function"&&ys(s),nn&&typeof nn.setStrictMode=="function")try{nn.setStrictMode(vt,s)}catch{}}var Et=Math.clz32?Math.clz32:Wo,Ga=Math.log,Oi=Math.LN2;function Wo(s){return s>>>=0,s===0?32:31-(Ga(s)/Oi|0)|0}var Or=256,_s=262144,Ft=4194304;function ir(s){var a=s&42;if(a!==0)return a;switch(s&-s){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return s&261888;case 262144:case 524288:case 1048576:case 2097152:return s&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return s&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return s}}function bs(s,a,c){var m=s.pendingLanes;if(m===0)return 0;var v=0,E=s.suspendedLanes,P=s.pingedLanes;s=s.warmLanes;var W=m&134217727;return W!==0?(m=W&~E,m!==0?v=ir(m):(P&=W,P!==0?v=ir(P):c||(c=W&~s,c!==0&&(v=ir(c))))):(W=m&~E,W!==0?v=ir(W):P!==0?v=ir(P):c||(c=m&~s,c!==0&&(v=ir(c)))),v===0?0:a!==0&&a!==v&&(a&E)===0&&(E=v&-v,c=a&-a,E>=c||E===32&&(c&4194048)!==0)?a:v}function Xr(s,a){return(s.pendingLanes&~(s.suspendedLanes&~s.pingedLanes)&a)===0}function Im(s,a){switch(s){case 1:case 2:case 4:case 8:case 64:return a+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function bd(){var s=Ft;return Ft<<=1,(Ft&62914560)===0&&(Ft=4194304),s}function vs(s){for(var a=[],c=0;31>c;c++)a.push(s);return a}function Wa(s,a){s.pendingLanes|=a,a!==268435456&&(s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0)}function Dm(s,a,c,m,v,E){var P=s.pendingLanes;s.pendingLanes=c,s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0,s.expiredLanes&=c,s.entangledLanes&=c,s.errorRecoveryDisabledLanes&=c,s.shellSuspendCounter=0;var W=s.entanglements,se=s.expirationTimes,pe=s.hiddenUpdates;for(c=P&~c;0<c;){var Te=31-Et(c),De=1<<Te;W[Te]=0,se[Te]=-1;var _e=pe[Te];if(_e!==null)for(pe[Te]=null,Te=0;Te<_e.length;Te++){var xe=_e[Te];xe!==null&&(xe.lane&=-536870913)}c&=~De}m!==0&&Qa(s,m,0),E!==0&&v===0&&s.tag!==0&&(s.suspendedLanes|=E&~(P&~a))}function Qa(s,a,c){s.pendingLanes|=a,s.suspendedLanes&=~a;var m=31-Et(a);s.entangledLanes|=a,s.entanglements[m]=s.entanglements[m]|1073741824|c&261930}function vc(s,a){var c=s.entangledLanes|=a;for(s=s.entanglements;c;){var m=31-Et(c),v=1<<m;v&a|s[m]&a&&(s[m]|=a),c&=~v}}function xc(s,a){var c=a&-a;return c=(c&42)!==0?1:Ka(c),(c&(s.suspendedLanes|a))!==0?0:c}function Ka(s){switch(s){case 2:s=1;break;case 8:s=4;break;case 32:s=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:s=128;break;case 268435456:s=134217728;break;default:s=0}return s}function Xs(s){return s&=-s,2<s?8<s?(s&134217727)!==0?32:268435456:8:2}function vd(){var s=G.p;return s!==0?s:(s=window.event,s===void 0?32:_x(s.type))}function Zr(s,a){var c=G.p;try{return G.p=s,a()}finally{G.p=c}}var Jr=Math.random().toString(36).slice(2),hn="__reactFiber$"+Jr,In="__reactProps$"+Jr,xs="__reactContainer$"+Jr,Qo="__reactEvents$"+Jr,km="__reactListeners$"+Jr,xd="__reactHandles$"+Jr,wd="__reactResources$"+Jr,ws="__reactMarker$"+Jr;function Ko(s){delete s[hn],delete s[In],delete s[Qo],delete s[km],delete s[xd]}function Ss(s){var a=s[hn];if(a)return a;for(var c=s.parentNode;c;){if(a=c[xs]||c[hn]){if(c=a.alternate,a.child!==null||c!==null&&c.child!==null)for(s=nx(s);s!==null;){if(c=s[hn])return c;s=nx(s)}return a}s=c,c=s.parentNode}return null}function Nr(s){if(s=s[hn]||s[xs]){var a=s.tag;if(a===5||a===6||a===13||a===31||a===26||a===27||a===3)return s}return null}function wr(s){var a=s.tag;if(a===5||a===26||a===27||a===6)return s.stateNode;throw Error(r(33))}function Es(s){var a=s[wd];return a||(a=s[wd]={hoistableStyles:new Map,hoistableScripts:new Map}),a}function fn(s){s[ws]=!0}var wc=new Set,Sc={};function Cs(s,a){Ts(s,a),Ts(s+"Capture",a)}function Ts(s,a){for(Sc[s]=a,s=0;s<a.length;s++)wc.add(a[s])}var Ec=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Cc={},Tc={};function Sd(s){return ae.call(Tc,s)?!0:ae.call(Cc,s)?!1:Ec.test(s)?Tc[s]=!0:(Cc[s]=!0,!1)}function Yo(s,a,c){if(Sd(a))if(c===null)s.removeAttribute(a);else{switch(typeof c){case"undefined":case"function":case"symbol":s.removeAttribute(a);return;case"boolean":var m=a.toLowerCase().slice(0,5);if(m!=="data-"&&m!=="aria-"){s.removeAttribute(a);return}}s.setAttribute(a,""+c)}}function Sr(s,a,c){if(c===null)s.removeAttribute(a);else{switch(typeof c){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(a);return}s.setAttribute(a,""+c)}}function mn(s,a,c,m){if(m===null)s.removeAttribute(c);else{switch(typeof m){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(c);return}s.setAttributeNS(a,c,""+m)}}function Dn(s){switch(typeof s){case"bigint":case"boolean":case"number":case"string":case"undefined":return s;case"object":return s;default:return""}}function Ni(s){var a=s.type;return(s=s.nodeName)&&s.toLowerCase()==="input"&&(a==="checkbox"||a==="radio")}function Ac(s,a,c){var m=Object.getOwnPropertyDescriptor(s.constructor.prototype,a);if(!s.hasOwnProperty(a)&&typeof m<"u"&&typeof m.get=="function"&&typeof m.set=="function"){var v=m.get,E=m.set;return Object.defineProperty(s,a,{configurable:!0,get:function(){return v.call(this)},set:function(P){c=""+P,E.call(this,P)}}),Object.defineProperty(s,a,{enumerable:m.enumerable}),{getValue:function(){return c},setValue:function(P){c=""+P},stopTracking:function(){s._valueTracker=null,delete s[a]}}}}function jt(s){if(!s._valueTracker){var a=Ni(s)?"checked":"value";s._valueTracker=Ac(s,a,""+s[a])}}function Ya(s){if(!s)return!1;var a=s._valueTracker;if(!a)return!0;var c=a.getValue(),m="";return s&&(m=Ni(s)?s.checked?"true":"false":s.value),s=m,s!==c?(a.setValue(s),!0):!1}function As(s){if(s=s||(typeof document<"u"?document:void 0),typeof s>"u")return null;try{return s.activeElement||s.body}catch{return s.body}}var Xa=/[\n"\\]/g;function ur(s){return s.replace(Xa,function(a){return"\\"+a.charCodeAt(0).toString(16)+" "})}function Xo(s,a,c,m,v,E,P,W){s.name="",P!=null&&typeof P!="function"&&typeof P!="symbol"&&typeof P!="boolean"?s.type=P:s.removeAttribute("type"),a!=null?P==="number"?(a===0&&s.value===""||s.value!=a)&&(s.value=""+Dn(a)):s.value!==""+Dn(a)&&(s.value=""+Dn(a)):P!=="submit"&&P!=="reset"||s.removeAttribute("value"),a!=null?jc(s,P,Dn(a)):c!=null?jc(s,P,Dn(c)):m!=null&&s.removeAttribute("value"),v==null&&E!=null&&(s.defaultChecked=!!E),v!=null&&(s.checked=v&&typeof v!="function"&&typeof v!="symbol"),W!=null&&typeof W!="function"&&typeof W!="symbol"&&typeof W!="boolean"?s.name=""+Dn(W):s.removeAttribute("name")}function Ed(s,a,c,m,v,E,P,W){if(E!=null&&typeof E!="function"&&typeof E!="symbol"&&typeof E!="boolean"&&(s.type=E),a!=null||c!=null){if(!(E!=="submit"&&E!=="reset"||a!=null)){jt(s);return}c=c!=null?""+Dn(c):"",a=a!=null?""+Dn(a):c,W||a===s.value||(s.value=a),s.defaultValue=a}m=m??v,m=typeof m!="function"&&typeof m!="symbol"&&!!m,s.checked=W?s.checked:!!m,s.defaultChecked=!!m,P!=null&&typeof P!="function"&&typeof P!="symbol"&&typeof P!="boolean"&&(s.name=P),jt(s)}function jc(s,a,c){a==="number"&&As(s.ownerDocument)===s||s.defaultValue===""+c||(s.defaultValue=""+c)}function Pi(s,a,c,m){if(s=s.options,a){a={};for(var v=0;v<c.length;v++)a["$"+c[v]]=!0;for(c=0;c<s.length;c++)v=a.hasOwnProperty("$"+s[c].value),s[c].selected!==v&&(s[c].selected=v),v&&m&&(s[c].defaultSelected=!0)}else{for(c=""+Dn(c),a=null,v=0;v<s.length;v++){if(s[v].value===c){s[v].selected=!0,m&&(s[v].defaultSelected=!0);return}a!==null||s[v].disabled||(a=s[v])}a!==null&&(a.selected=!0)}}function Cd(s,a,c){if(a!=null&&(a=""+Dn(a),a!==s.value&&(s.value=a),c==null)){s.defaultValue!==a&&(s.defaultValue=a);return}s.defaultValue=c!=null?""+Dn(c):""}function Bi(s,a,c,m){if(a==null){if(m!=null){if(c!=null)throw Error(r(92));if(J(m)){if(1<m.length)throw Error(r(93));m=m[0]}c=m}c==null&&(c=""),a=c}c=Dn(a),s.defaultValue=c,m=s.textContent,m===c&&m!==""&&m!==null&&(s.value=m),jt(s)}function dr(s,a){if(a){var c=s.firstChild;if(c&&c===s.lastChild&&c.nodeType===3){c.nodeValue=a;return}}s.textContent=a}var Td=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Rc(s,a,c){var m=a.indexOf("--")===0;c==null||typeof c=="boolean"||c===""?m?s.setProperty(a,""):a==="float"?s.cssFloat="":s[a]="":m?s.setProperty(a,c):typeof c!="number"||c===0||Td.has(a)?a==="float"?s.cssFloat=c:s[a]=(""+c).trim():s[a]=c+"px"}function Ic(s,a,c){if(a!=null&&typeof a!="object")throw Error(r(62));if(s=s.style,c!=null){for(var m in c)!c.hasOwnProperty(m)||a!=null&&a.hasOwnProperty(m)||(m.indexOf("--")===0?s.setProperty(m,""):m==="float"?s.cssFloat="":s[m]="");for(var v in a)m=a[v],a.hasOwnProperty(v)&&c[v]!==m&&Rc(s,v,m)}else for(var E in a)a.hasOwnProperty(E)&&Rc(s,E,a[E])}function Zo(s){if(s.indexOf("-")===-1)return!1;switch(s){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Ad=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),zi=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Jo(s){return zi.test(""+s)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":s}function es(){}var Dc=null;function Pr(s){return s=s.target||s.srcElement||window,s.correspondingUseElement&&(s=s.correspondingUseElement),s.nodeType===3?s.parentNode:s}var Li=null,js=null;function Za(s){var a=Nr(s);if(a&&(s=a.stateNode)){var c=s[In]||null;e:switch(s=a.stateNode,a.type){case"input":if(Xo(s,c.value,c.defaultValue,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name),a=c.name,c.type==="radio"&&a!=null){for(c=s;c.parentNode;)c=c.parentNode;for(c=c.querySelectorAll('input[name="'+ur(""+a)+'"][type="radio"]'),a=0;a<c.length;a++){var m=c[a];if(m!==s&&m.form===s.form){var v=m[In]||null;if(!v)throw Error(r(90));Xo(m,v.value,v.defaultValue,v.defaultValue,v.checked,v.defaultChecked,v.type,v.name)}}for(a=0;a<c.length;a++)m=c[a],m.form===s.form&&Ya(m)}break e;case"textarea":Cd(s,c.value,c.defaultValue);break e;case"select":a=c.value,a!=null&&Pi(s,!!c.multiple,a,!1)}}}var el=!1;function Ui(s,a,c){if(el)return s(a,c);el=!0;try{var m=s(a);return m}finally{if(el=!1,(Li!==null||js!==null)&&(vh(),Li&&(a=Li,s=js,js=Li=null,Za(a),s)))for(a=0;a<s.length;a++)Za(s[a])}}function ts(s,a){var c=s.stateNode;if(c===null)return null;var m=c[In]||null;if(m===null)return null;c=m[a];e:switch(a){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(m=!m.disabled)||(s=s.type,m=!(s==="button"||s==="input"||s==="select"||s==="textarea")),s=!m;break e;default:s=!1}if(s)return null;if(c&&typeof c!="function")throw Error(r(231,a,typeof c));return c}var Br=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Ja=!1;if(Br)try{var Dt={};Object.defineProperty(Dt,"passive",{get:function(){Ja=!0}}),window.addEventListener("test",Dt,Dt),window.removeEventListener("test",Dt,Dt)}catch{Ja=!1}var Rs=null,kc=null,eo=null;function Mc(){if(eo)return eo;var s,a=kc,c=a.length,m,v="value"in Rs?Rs.value:Rs.textContent,E=v.length;for(s=0;s<c&&a[s]===v[s];s++);var P=c-s;for(m=1;m<=P&&a[c-m]===v[E-m];m++);return eo=v.slice(s,1<m?1-m:void 0)}function to(s){var a=s.keyCode;return"charCode"in s?(s=s.charCode,s===0&&a===13&&(s=13)):s=a,s===10&&(s=13),32<=s||s===13?s:0}function Zs(){return!0}function ns(){return!1}function Nn(s){function a(c,m,v,E,P){this._reactName=c,this._targetInst=v,this.type=m,this.nativeEvent=E,this.target=P,this.currentTarget=null;for(var W in s)s.hasOwnProperty(W)&&(c=s[W],this[W]=c?c(E):E[W]);return this.isDefaultPrevented=(E.defaultPrevented!=null?E.defaultPrevented:E.returnValue===!1)?Zs:ns,this.isPropagationStopped=ns,this}return g(a.prototype,{preventDefault:function(){this.defaultPrevented=!0;var c=this.nativeEvent;c&&(c.preventDefault?c.preventDefault():typeof c.returnValue!="unknown"&&(c.returnValue=!1),this.isDefaultPrevented=Zs)},stopPropagation:function(){var c=this.nativeEvent;c&&(c.stopPropagation?c.stopPropagation():typeof c.cancelBubble!="unknown"&&(c.cancelBubble=!0),this.isPropagationStopped=Zs)},persist:function(){},isPersistent:Zs}),a}var Js={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(s){return s.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Is=Nn(Js),Fi=g({},Js,{view:0,detail:0}),Oc=Nn(Fi),Vi,tl,Ds,nl=g({},Fi,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:$i,button:0,buttons:0,relatedTarget:function(s){return s.relatedTarget===void 0?s.fromElement===s.srcElement?s.toElement:s.fromElement:s.relatedTarget},movementX:function(s){return"movementX"in s?s.movementX:(s!==Ds&&(Ds&&s.type==="mousemove"?(Vi=s.screenX-Ds.screenX,tl=s.screenY-Ds.screenY):tl=Vi=0,Ds=s),Vi)},movementY:function(s){return"movementY"in s?s.movementY:tl}}),Nc=Nn(nl),no=g({},nl,{dataTransfer:0}),jd=Nn(no),Rd=g({},Fi,{relatedTarget:0}),ro=Nn(Rd),Pc=g({},Js,{animationName:0,elapsedTime:0,pseudoElement:0}),Id=Nn(Pc),rl=g({},Js,{clipboardData:function(s){return"clipboardData"in s?s.clipboardData:window.clipboardData}}),Dd=Nn(rl),kd=g({},Js,{data:0}),ks=Nn(kd),Md={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Od={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Nd={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Pd(s){var a=this.nativeEvent;return a.getModifierState?a.getModifierState(s):(s=Nd[s])?!!a[s]:!1}function $i(){return Pd}var ar=g({},Fi,{key:function(s){if(s.key){var a=Md[s.key]||s.key;if(a!=="Unidentified")return a}return s.type==="keypress"?(s=to(s),s===13?"Enter":String.fromCharCode(s)):s.type==="keydown"||s.type==="keyup"?Od[s.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:$i,charCode:function(s){return s.type==="keypress"?to(s):0},keyCode:function(s){return s.type==="keydown"||s.type==="keyup"?s.keyCode:0},which:function(s){return s.type==="keypress"?to(s):s.type==="keydown"||s.type==="keyup"?s.keyCode:0}}),Bd=Nn(ar),zd=g({},nl,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),ei=Nn(zd),y=g({},Fi,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:$i}),A=Nn(y),F=g({},Js,{propertyName:0,elapsedTime:0,pseudoElement:0}),K=Nn(F),fe=g({},nl,{deltaX:function(s){return"deltaX"in s?s.deltaX:"wheelDeltaX"in s?-s.wheelDeltaX:0},deltaY:function(s){return"deltaY"in s?s.deltaY:"wheelDeltaY"in s?-s.wheelDeltaY:"wheelDelta"in s?-s.wheelDelta:0},deltaZ:0,deltaMode:0}),ve=Nn(fe),Be=g({},Js,{newState:0,oldState:0}),rt=Nn(Be),an=[9,13,27,32],Ct=Br&&"CompositionEvent"in window,Wt=null;Br&&"documentMode"in document&&(Wt=document.documentMode);var zr=Br&&"TextEvent"in window&&!Wt,Ms=Br&&(!Ct||Wt&&8<Wt&&11>=Wt),rs=" ",ss=!1;function so(s,a){switch(s){case"keyup":return an.indexOf(a.keyCode)!==-1;case"keydown":return a.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function sl(s){return s=s.detail,typeof s=="object"&&"data"in s?s.data:null}var il=!1;function _A(s,a){switch(s){case"compositionend":return sl(a);case"keypress":return a.which!==32?null:(ss=!0,rs);case"textInput":return s=a.data,s===rs&&ss?null:s;default:return null}}function bA(s,a){if(il)return s==="compositionend"||!Ct&&so(s,a)?(s=Mc(),eo=kc=Rs=null,il=!1,s):null;switch(s){case"paste":return null;case"keypress":if(!(a.ctrlKey||a.altKey||a.metaKey)||a.ctrlKey&&a.altKey){if(a.char&&1<a.char.length)return a.char;if(a.which)return String.fromCharCode(a.which)}return null;case"compositionend":return Ms&&a.locale!=="ko"?null:a.data;default:return null}}var vA={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function i_(s){var a=s&&s.nodeName&&s.nodeName.toLowerCase();return a==="input"?!!vA[s.type]:a==="textarea"}function a_(s,a,c,m){Li?js?js.push(m):js=[m]:Li=m,a=Ah(a,"onChange"),0<a.length&&(c=new Is("onChange","change",null,c,m),s.push({event:c,listeners:a}))}var Bc=null,zc=null;function xA(s){Vv(s,0)}function Ld(s){var a=wr(s);if(Ya(a))return s}function o_(s,a){if(s==="change")return a}var l_=!1;if(Br){var Mm;if(Br){var Om="oninput"in document;if(!Om){var c_=document.createElement("div");c_.setAttribute("oninput","return;"),Om=typeof c_.oninput=="function"}Mm=Om}else Mm=!1;l_=Mm&&(!document.documentMode||9<document.documentMode)}function u_(){Bc&&(Bc.detachEvent("onpropertychange",d_),zc=Bc=null)}function d_(s){if(s.propertyName==="value"&&Ld(zc)){var a=[];a_(a,zc,s,Pr(s)),Ui(xA,a)}}function wA(s,a,c){s==="focusin"?(u_(),Bc=a,zc=c,Bc.attachEvent("onpropertychange",d_)):s==="focusout"&&u_()}function SA(s){if(s==="selectionchange"||s==="keyup"||s==="keydown")return Ld(zc)}function EA(s,a){if(s==="click")return Ld(a)}function CA(s,a){if(s==="input"||s==="change")return Ld(a)}function TA(s,a){return s===a&&(s!==0||1/s===1/a)||s!==s&&a!==a}var Er=typeof Object.is=="function"?Object.is:TA;function Lc(s,a){if(Er(s,a))return!0;if(typeof s!="object"||s===null||typeof a!="object"||a===null)return!1;var c=Object.keys(s),m=Object.keys(a);if(c.length!==m.length)return!1;for(m=0;m<c.length;m++){var v=c[m];if(!ae.call(a,v)||!Er(s[v],a[v]))return!1}return!0}function h_(s){for(;s&&s.firstChild;)s=s.firstChild;return s}function f_(s,a){var c=h_(s);s=0;for(var m;c;){if(c.nodeType===3){if(m=s+c.textContent.length,s<=a&&m>=a)return{node:c,offset:a-s};s=m}e:{for(;c;){if(c.nextSibling){c=c.nextSibling;break e}c=c.parentNode}c=void 0}c=h_(c)}}function m_(s,a){return s&&a?s===a?!0:s&&s.nodeType===3?!1:a&&a.nodeType===3?m_(s,a.parentNode):"contains"in s?s.contains(a):s.compareDocumentPosition?!!(s.compareDocumentPosition(a)&16):!1:!1}function p_(s){s=s!=null&&s.ownerDocument!=null&&s.ownerDocument.defaultView!=null?s.ownerDocument.defaultView:window;for(var a=As(s.document);a instanceof s.HTMLIFrameElement;){try{var c=typeof a.contentWindow.location.href=="string"}catch{c=!1}if(c)s=a.contentWindow;else break;a=As(s.document)}return a}function Nm(s){var a=s&&s.nodeName&&s.nodeName.toLowerCase();return a&&(a==="input"&&(s.type==="text"||s.type==="search"||s.type==="tel"||s.type==="url"||s.type==="password")||a==="textarea"||s.contentEditable==="true")}var AA=Br&&"documentMode"in document&&11>=document.documentMode,al=null,Pm=null,Uc=null,Bm=!1;function g_(s,a,c){var m=c.window===c?c.document:c.nodeType===9?c:c.ownerDocument;Bm||al==null||al!==As(m)||(m=al,"selectionStart"in m&&Nm(m)?m={start:m.selectionStart,end:m.selectionEnd}:(m=(m.ownerDocument&&m.ownerDocument.defaultView||window).getSelection(),m={anchorNode:m.anchorNode,anchorOffset:m.anchorOffset,focusNode:m.focusNode,focusOffset:m.focusOffset}),Uc&&Lc(Uc,m)||(Uc=m,m=Ah(Pm,"onSelect"),0<m.length&&(a=new Is("onSelect","select",null,a,c),s.push({event:a,listeners:m}),a.target=al)))}function io(s,a){var c={};return c[s.toLowerCase()]=a.toLowerCase(),c["Webkit"+s]="webkit"+a,c["Moz"+s]="moz"+a,c}var ol={animationend:io("Animation","AnimationEnd"),animationiteration:io("Animation","AnimationIteration"),animationstart:io("Animation","AnimationStart"),transitionrun:io("Transition","TransitionRun"),transitionstart:io("Transition","TransitionStart"),transitioncancel:io("Transition","TransitionCancel"),transitionend:io("Transition","TransitionEnd")},zm={},y_={};Br&&(y_=document.createElement("div").style,"AnimationEvent"in window||(delete ol.animationend.animation,delete ol.animationiteration.animation,delete ol.animationstart.animation),"TransitionEvent"in window||delete ol.transitionend.transition);function ao(s){if(zm[s])return zm[s];if(!ol[s])return s;var a=ol[s],c;for(c in a)if(a.hasOwnProperty(c)&&c in y_)return zm[s]=a[c];return s}var __=ao("animationend"),b_=ao("animationiteration"),v_=ao("animationstart"),jA=ao("transitionrun"),RA=ao("transitionstart"),IA=ao("transitioncancel"),x_=ao("transitionend"),w_=new Map,Lm="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Lm.push("scrollEnd");function is(s,a){w_.set(s,a),Cs(a,[s])}var Ud=typeof reportError=="function"?reportError:function(s){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var a=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof s=="object"&&s!==null&&typeof s.message=="string"?String(s.message):String(s),error:s});if(!window.dispatchEvent(a))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",s);return}console.error(s)},Lr=[],ll=0,Um=0;function Fd(){for(var s=ll,a=Um=ll=0;a<s;){var c=Lr[a];Lr[a++]=null;var m=Lr[a];Lr[a++]=null;var v=Lr[a];Lr[a++]=null;var E=Lr[a];if(Lr[a++]=null,m!==null&&v!==null){var P=m.pending;P===null?v.next=v:(v.next=P.next,P.next=v),m.pending=v}E!==0&&S_(c,v,E)}}function Vd(s,a,c,m){Lr[ll++]=s,Lr[ll++]=a,Lr[ll++]=c,Lr[ll++]=m,Um|=m,s.lanes|=m,s=s.alternate,s!==null&&(s.lanes|=m)}function Fm(s,a,c,m){return Vd(s,a,c,m),$d(s)}function oo(s,a){return Vd(s,null,null,a),$d(s)}function S_(s,a,c){s.lanes|=c;var m=s.alternate;m!==null&&(m.lanes|=c);for(var v=!1,E=s.return;E!==null;)E.childLanes|=c,m=E.alternate,m!==null&&(m.childLanes|=c),E.tag===22&&(s=E.stateNode,s===null||s._visibility&1||(v=!0)),s=E,E=E.return;return s.tag===3?(E=s.stateNode,v&&a!==null&&(v=31-Et(c),s=E.hiddenUpdates,m=s[v],m===null?s[v]=[a]:m.push(a),a.lane=c|536870912),E):null}function $d(s){if(50<lu)throw lu=0,Yp=null,Error(r(185));for(var a=s.return;a!==null;)s=a,a=s.return;return s.tag===3?s.stateNode:null}var cl={};function DA(s,a,c,m){this.tag=s,this.key=c,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=a,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=m,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Cr(s,a,c,m){return new DA(s,a,c,m)}function Vm(s){return s=s.prototype,!(!s||!s.isReactComponent)}function ti(s,a){var c=s.alternate;return c===null?(c=Cr(s.tag,a,s.key,s.mode),c.elementType=s.elementType,c.type=s.type,c.stateNode=s.stateNode,c.alternate=s,s.alternate=c):(c.pendingProps=a,c.type=s.type,c.flags=0,c.subtreeFlags=0,c.deletions=null),c.flags=s.flags&65011712,c.childLanes=s.childLanes,c.lanes=s.lanes,c.child=s.child,c.memoizedProps=s.memoizedProps,c.memoizedState=s.memoizedState,c.updateQueue=s.updateQueue,a=s.dependencies,c.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext},c.sibling=s.sibling,c.index=s.index,c.ref=s.ref,c.refCleanup=s.refCleanup,c}function E_(s,a){s.flags&=65011714;var c=s.alternate;return c===null?(s.childLanes=0,s.lanes=a,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=c.childLanes,s.lanes=c.lanes,s.child=c.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=c.memoizedProps,s.memoizedState=c.memoizedState,s.updateQueue=c.updateQueue,s.type=c.type,a=c.dependencies,s.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext}),s}function qd(s,a,c,m,v,E){var P=0;if(m=s,typeof s=="function")Vm(s)&&(P=1);else if(typeof s=="string")P=P2(s,c,ne.current)?26:s==="html"||s==="head"||s==="body"?27:5;else e:switch(s){case B:return s=Cr(31,c,a,v),s.elementType=B,s.lanes=E,s;case x:return lo(c.children,v,E,a);case S:P=8,v|=24;break;case C:return s=Cr(12,c,a,v|2),s.elementType=C,s.lanes=E,s;case V:return s=Cr(13,c,a,v),s.elementType=V,s.lanes=E,s;case $:return s=Cr(19,c,a,v),s.elementType=$,s.lanes=E,s;default:if(typeof s=="object"&&s!==null)switch(s.$$typeof){case R:P=10;break e;case T:P=9;break e;case D:P=11;break e;case k:P=14;break e;case M:P=16,m=null;break e}P=29,c=Error(r(130,s===null?"null":typeof s,"")),m=null}return a=Cr(P,c,a,v),a.elementType=s,a.type=m,a.lanes=E,a}function lo(s,a,c,m){return s=Cr(7,s,m,a),s.lanes=c,s}function $m(s,a,c){return s=Cr(6,s,null,a),s.lanes=c,s}function C_(s){var a=Cr(18,null,null,0);return a.stateNode=s,a}function qm(s,a,c){return a=Cr(4,s.children!==null?s.children:[],s.key,a),a.lanes=c,a.stateNode={containerInfo:s.containerInfo,pendingChildren:null,implementation:s.implementation},a}var T_=new WeakMap;function Ur(s,a){if(typeof s=="object"&&s!==null){var c=T_.get(s);return c!==void 0?c:(a={value:s,source:a,stack:X(a)},T_.set(s,a),a)}return{value:s,source:a,stack:X(a)}}var ul=[],dl=0,Hd=null,Fc=0,Fr=[],Vr=0,qi=null,Os=1,Ns="";function ni(s,a){ul[dl++]=Fc,ul[dl++]=Hd,Hd=s,Fc=a}function A_(s,a,c){Fr[Vr++]=Os,Fr[Vr++]=Ns,Fr[Vr++]=qi,qi=s;var m=Os;s=Ns;var v=32-Et(m)-1;m&=~(1<<v),c+=1;var E=32-Et(a)+v;if(30<E){var P=v-v%5;E=(m&(1<<P)-1).toString(32),m>>=P,v-=P,Os=1<<32-Et(a)+v|c<<v|m,Ns=E+s}else Os=1<<E|c<<v|m,Ns=s}function Hm(s){s.return!==null&&(ni(s,1),A_(s,1,0))}function Gm(s){for(;s===Hd;)Hd=ul[--dl],ul[dl]=null,Fc=ul[--dl],ul[dl]=null;for(;s===qi;)qi=Fr[--Vr],Fr[Vr]=null,Ns=Fr[--Vr],Fr[Vr]=null,Os=Fr[--Vr],Fr[Vr]=null}function j_(s,a){Fr[Vr++]=Os,Fr[Vr++]=Ns,Fr[Vr++]=qi,Os=a.id,Ns=a.overflow,qi=s}var Pn=null,$t=null,_t=!1,Hi=null,$r=!1,Wm=Error(r(519));function Gi(s){var a=Error(r(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Vc(Ur(a,s)),Wm}function R_(s){var a=s.stateNode,c=s.type,m=s.memoizedProps;switch(a[hn]=s,a[In]=m,c){case"dialog":dt("cancel",a),dt("close",a);break;case"iframe":case"object":case"embed":dt("load",a);break;case"video":case"audio":for(c=0;c<uu.length;c++)dt(uu[c],a);break;case"source":dt("error",a);break;case"img":case"image":case"link":dt("error",a),dt("load",a);break;case"details":dt("toggle",a);break;case"input":dt("invalid",a),Ed(a,m.value,m.defaultValue,m.checked,m.defaultChecked,m.type,m.name,!0);break;case"select":dt("invalid",a);break;case"textarea":dt("invalid",a),Bi(a,m.value,m.defaultValue,m.children)}c=m.children,typeof c!="string"&&typeof c!="number"&&typeof c!="bigint"||a.textContent===""+c||m.suppressHydrationWarning===!0||Gv(a.textContent,c)?(m.popover!=null&&(dt("beforetoggle",a),dt("toggle",a)),m.onScroll!=null&&dt("scroll",a),m.onScrollEnd!=null&&dt("scrollend",a),m.onClick!=null&&(a.onclick=es),a=!0):a=!1,a||Gi(s,!0)}function I_(s){for(Pn=s.return;Pn;)switch(Pn.tag){case 5:case 31:case 13:$r=!1;return;case 27:case 3:$r=!0;return;default:Pn=Pn.return}}function hl(s){if(s!==Pn)return!1;if(!_t)return I_(s),_t=!0,!1;var a=s.tag,c;if((c=a!==3&&a!==27)&&((c=a===5)&&(c=s.type,c=!(c!=="form"&&c!=="button")||dg(s.type,s.memoizedProps)),c=!c),c&&$t&&Gi(s),I_(s),a===13){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(r(317));$t=tx(s)}else if(a===31){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(r(317));$t=tx(s)}else a===27?(a=$t,aa(s.type)?(s=gg,gg=null,$t=s):$t=a):$t=Pn?Hr(s.stateNode.nextSibling):null;return!0}function co(){$t=Pn=null,_t=!1}function Qm(){var s=Hi;return s!==null&&(pr===null?pr=s:pr.push.apply(pr,s),Hi=null),s}function Vc(s){Hi===null?Hi=[s]:Hi.push(s)}var Km=z(null),uo=null,ri=null;function Wi(s,a,c){re(Km,a._currentValue),a._currentValue=c}function si(s){s._currentValue=Km.current,H(Km)}function Ym(s,a,c){for(;s!==null;){var m=s.alternate;if((s.childLanes&a)!==a?(s.childLanes|=a,m!==null&&(m.childLanes|=a)):m!==null&&(m.childLanes&a)!==a&&(m.childLanes|=a),s===c)break;s=s.return}}function Xm(s,a,c,m){var v=s.child;for(v!==null&&(v.return=s);v!==null;){var E=v.dependencies;if(E!==null){var P=v.child;E=E.firstContext;e:for(;E!==null;){var W=E;E=v;for(var se=0;se<a.length;se++)if(W.context===a[se]){E.lanes|=c,W=E.alternate,W!==null&&(W.lanes|=c),Ym(E.return,c,s),m||(P=null);break e}E=W.next}}else if(v.tag===18){if(P=v.return,P===null)throw Error(r(341));P.lanes|=c,E=P.alternate,E!==null&&(E.lanes|=c),Ym(P,c,s),P=null}else P=v.child;if(P!==null)P.return=v;else for(P=v;P!==null;){if(P===s){P=null;break}if(v=P.sibling,v!==null){v.return=P.return,P=v;break}P=P.return}v=P}}function fl(s,a,c,m){s=null;for(var v=a,E=!1;v!==null;){if(!E){if((v.flags&524288)!==0)E=!0;else if((v.flags&262144)!==0)break}if(v.tag===10){var P=v.alternate;if(P===null)throw Error(r(387));if(P=P.memoizedProps,P!==null){var W=v.type;Er(v.pendingProps.value,P.value)||(s!==null?s.push(W):s=[W])}}else if(v===we.current){if(P=v.alternate,P===null)throw Error(r(387));P.memoizedState.memoizedState!==v.memoizedState.memoizedState&&(s!==null?s.push(pu):s=[pu])}v=v.return}s!==null&&Xm(a,s,c,m),a.flags|=262144}function Gd(s){for(s=s.firstContext;s!==null;){if(!Er(s.context._currentValue,s.memoizedValue))return!0;s=s.next}return!1}function ho(s){uo=s,ri=null,s=s.dependencies,s!==null&&(s.firstContext=null)}function Bn(s){return D_(uo,s)}function Wd(s,a){return uo===null&&ho(s),D_(s,a)}function D_(s,a){var c=a._currentValue;if(a={context:a,memoizedValue:c,next:null},ri===null){if(s===null)throw Error(r(308));ri=a,s.dependencies={lanes:0,firstContext:a},s.flags|=524288}else ri=ri.next=a;return c}var kA=typeof AbortController<"u"?AbortController:function(){var s=[],a=this.signal={aborted:!1,addEventListener:function(c,m){s.push(m)}};this.abort=function(){a.aborted=!0,s.forEach(function(c){return c()})}},MA=t.unstable_scheduleCallback,OA=t.unstable_NormalPriority,pn={$$typeof:R,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Zm(){return{controller:new kA,data:new Map,refCount:0}}function $c(s){s.refCount--,s.refCount===0&&MA(OA,function(){s.controller.abort()})}var qc=null,Jm=0,ml=0,pl=null;function NA(s,a){if(qc===null){var c=qc=[];Jm=0,ml=ng(),pl={status:"pending",value:void 0,then:function(m){c.push(m)}}}return Jm++,a.then(k_,k_),a}function k_(){if(--Jm===0&&qc!==null){pl!==null&&(pl.status="fulfilled");var s=qc;qc=null,ml=0,pl=null;for(var a=0;a<s.length;a++)(0,s[a])()}}function PA(s,a){var c=[],m={status:"pending",value:null,reason:null,then:function(v){c.push(v)}};return s.then(function(){m.status="fulfilled",m.value=a;for(var v=0;v<c.length;v++)(0,c[v])(a)},function(v){for(m.status="rejected",m.reason=v,v=0;v<c.length;v++)(0,c[v])(void 0)}),m}var M_=Y.S;Y.S=function(s,a){gv=Ne(),typeof a=="object"&&a!==null&&typeof a.then=="function"&&NA(s,a),M_!==null&&M_(s,a)};var fo=z(null);function ep(){var s=fo.current;return s!==null?s:zt.pooledCache}function Qd(s,a){a===null?re(fo,fo.current):re(fo,a.pool)}function O_(){var s=ep();return s===null?null:{parent:pn._currentValue,pool:s}}var gl=Error(r(460)),tp=Error(r(474)),Kd=Error(r(542)),Yd={then:function(){}};function N_(s){return s=s.status,s==="fulfilled"||s==="rejected"}function P_(s,a,c){switch(c=s[c],c===void 0?s.push(a):c!==a&&(a.then(es,es),a=c),a.status){case"fulfilled":return a.value;case"rejected":throw s=a.reason,z_(s),s;default:if(typeof a.status=="string")a.then(es,es);else{if(s=zt,s!==null&&100<s.shellSuspendCounter)throw Error(r(482));s=a,s.status="pending",s.then(function(m){if(a.status==="pending"){var v=a;v.status="fulfilled",v.value=m}},function(m){if(a.status==="pending"){var v=a;v.status="rejected",v.reason=m}})}switch(a.status){case"fulfilled":return a.value;case"rejected":throw s=a.reason,z_(s),s}throw po=a,gl}}function mo(s){try{var a=s._init;return a(s._payload)}catch(c){throw c!==null&&typeof c=="object"&&typeof c.then=="function"?(po=c,gl):c}}var po=null;function B_(){if(po===null)throw Error(r(459));var s=po;return po=null,s}function z_(s){if(s===gl||s===Kd)throw Error(r(483))}var yl=null,Hc=0;function Xd(s){var a=Hc;return Hc+=1,yl===null&&(yl=[]),P_(yl,s,a)}function Gc(s,a){a=a.props.ref,s.ref=a!==void 0?a:null}function Zd(s,a){throw a.$$typeof===b?Error(r(525)):(s=Object.prototype.toString.call(a),Error(r(31,s==="[object Object]"?"object with keys {"+Object.keys(a).join(", ")+"}":s)))}function L_(s){function a(ue,le){if(s){var me=ue.deletions;me===null?(ue.deletions=[le],ue.flags|=16):me.push(le)}}function c(ue,le){if(!s)return null;for(;le!==null;)a(ue,le),le=le.sibling;return null}function m(ue){for(var le=new Map;ue!==null;)ue.key!==null?le.set(ue.key,ue):le.set(ue.index,ue),ue=ue.sibling;return le}function v(ue,le){return ue=ti(ue,le),ue.index=0,ue.sibling=null,ue}function E(ue,le,me){return ue.index=me,s?(me=ue.alternate,me!==null?(me=me.index,me<le?(ue.flags|=67108866,le):me):(ue.flags|=67108866,le)):(ue.flags|=1048576,le)}function P(ue){return s&&ue.alternate===null&&(ue.flags|=67108866),ue}function W(ue,le,me,je){return le===null||le.tag!==6?(le=$m(me,ue.mode,je),le.return=ue,le):(le=v(le,me),le.return=ue,le)}function se(ue,le,me,je){var Ge=me.type;return Ge===x?Te(ue,le,me.props.children,je,me.key):le!==null&&(le.elementType===Ge||typeof Ge=="object"&&Ge!==null&&Ge.$$typeof===M&&mo(Ge)===le.type)?(le=v(le,me.props),Gc(le,me),le.return=ue,le):(le=qd(me.type,me.key,me.props,null,ue.mode,je),Gc(le,me),le.return=ue,le)}function pe(ue,le,me,je){return le===null||le.tag!==4||le.stateNode.containerInfo!==me.containerInfo||le.stateNode.implementation!==me.implementation?(le=qm(me,ue.mode,je),le.return=ue,le):(le=v(le,me.children||[]),le.return=ue,le)}function Te(ue,le,me,je,Ge){return le===null||le.tag!==7?(le=lo(me,ue.mode,je,Ge),le.return=ue,le):(le=v(le,me),le.return=ue,le)}function De(ue,le,me){if(typeof le=="string"&&le!==""||typeof le=="number"||typeof le=="bigint")return le=$m(""+le,ue.mode,me),le.return=ue,le;if(typeof le=="object"&&le!==null){switch(le.$$typeof){case _:return me=qd(le.type,le.key,le.props,null,ue.mode,me),Gc(me,le),me.return=ue,me;case w:return le=qm(le,ue.mode,me),le.return=ue,le;case M:return le=mo(le),De(ue,le,me)}if(J(le)||I(le))return le=lo(le,ue.mode,me,null),le.return=ue,le;if(typeof le.then=="function")return De(ue,Xd(le),me);if(le.$$typeof===R)return De(ue,Wd(ue,le),me);Zd(ue,le)}return null}function _e(ue,le,me,je){var Ge=le!==null?le.key:null;if(typeof me=="string"&&me!==""||typeof me=="number"||typeof me=="bigint")return Ge!==null?null:W(ue,le,""+me,je);if(typeof me=="object"&&me!==null){switch(me.$$typeof){case _:return me.key===Ge?se(ue,le,me,je):null;case w:return me.key===Ge?pe(ue,le,me,je):null;case M:return me=mo(me),_e(ue,le,me,je)}if(J(me)||I(me))return Ge!==null?null:Te(ue,le,me,je,null);if(typeof me.then=="function")return _e(ue,le,Xd(me),je);if(me.$$typeof===R)return _e(ue,le,Wd(ue,me),je);Zd(ue,me)}return null}function xe(ue,le,me,je,Ge){if(typeof je=="string"&&je!==""||typeof je=="number"||typeof je=="bigint")return ue=ue.get(me)||null,W(le,ue,""+je,Ge);if(typeof je=="object"&&je!==null){switch(je.$$typeof){case _:return ue=ue.get(je.key===null?me:je.key)||null,se(le,ue,je,Ge);case w:return ue=ue.get(je.key===null?me:je.key)||null,pe(le,ue,je,Ge);case M:return je=mo(je),xe(ue,le,me,je,Ge)}if(J(je)||I(je))return ue=ue.get(me)||null,Te(le,ue,je,Ge,null);if(typeof je.then=="function")return xe(ue,le,me,Xd(je),Ge);if(je.$$typeof===R)return xe(ue,le,me,Wd(le,je),Ge);Zd(le,je)}return null}function Fe(ue,le,me,je){for(var Ge=null,wt=null,Ve=le,it=le=0,mt=null;Ve!==null&&it<me.length;it++){Ve.index>it?(mt=Ve,Ve=null):mt=Ve.sibling;var St=_e(ue,Ve,me[it],je);if(St===null){Ve===null&&(Ve=mt);break}s&&Ve&&St.alternate===null&&a(ue,Ve),le=E(St,le,it),wt===null?Ge=St:wt.sibling=St,wt=St,Ve=mt}if(it===me.length)return c(ue,Ve),_t&&ni(ue,it),Ge;if(Ve===null){for(;it<me.length;it++)Ve=De(ue,me[it],je),Ve!==null&&(le=E(Ve,le,it),wt===null?Ge=Ve:wt.sibling=Ve,wt=Ve);return _t&&ni(ue,it),Ge}for(Ve=m(Ve);it<me.length;it++)mt=xe(Ve,ue,it,me[it],je),mt!==null&&(s&&mt.alternate!==null&&Ve.delete(mt.key===null?it:mt.key),le=E(mt,le,it),wt===null?Ge=mt:wt.sibling=mt,wt=mt);return s&&Ve.forEach(function(da){return a(ue,da)}),_t&&ni(ue,it),Ge}function Qe(ue,le,me,je){if(me==null)throw Error(r(151));for(var Ge=null,wt=null,Ve=le,it=le=0,mt=null,St=me.next();Ve!==null&&!St.done;it++,St=me.next()){Ve.index>it?(mt=Ve,Ve=null):mt=Ve.sibling;var da=_e(ue,Ve,St.value,je);if(da===null){Ve===null&&(Ve=mt);break}s&&Ve&&da.alternate===null&&a(ue,Ve),le=E(da,le,it),wt===null?Ge=da:wt.sibling=da,wt=da,Ve=mt}if(St.done)return c(ue,Ve),_t&&ni(ue,it),Ge;if(Ve===null){for(;!St.done;it++,St=me.next())St=De(ue,St.value,je),St!==null&&(le=E(St,le,it),wt===null?Ge=St:wt.sibling=St,wt=St);return _t&&ni(ue,it),Ge}for(Ve=m(Ve);!St.done;it++,St=me.next())St=xe(Ve,ue,it,St.value,je),St!==null&&(s&&St.alternate!==null&&Ve.delete(St.key===null?it:St.key),le=E(St,le,it),wt===null?Ge=St:wt.sibling=St,wt=St);return s&&Ve.forEach(function(W2){return a(ue,W2)}),_t&&ni(ue,it),Ge}function Ot(ue,le,me,je){if(typeof me=="object"&&me!==null&&me.type===x&&me.key===null&&(me=me.props.children),typeof me=="object"&&me!==null){switch(me.$$typeof){case _:e:{for(var Ge=me.key;le!==null;){if(le.key===Ge){if(Ge=me.type,Ge===x){if(le.tag===7){c(ue,le.sibling),je=v(le,me.props.children),je.return=ue,ue=je;break e}}else if(le.elementType===Ge||typeof Ge=="object"&&Ge!==null&&Ge.$$typeof===M&&mo(Ge)===le.type){c(ue,le.sibling),je=v(le,me.props),Gc(je,me),je.return=ue,ue=je;break e}c(ue,le);break}else a(ue,le);le=le.sibling}me.type===x?(je=lo(me.props.children,ue.mode,je,me.key),je.return=ue,ue=je):(je=qd(me.type,me.key,me.props,null,ue.mode,je),Gc(je,me),je.return=ue,ue=je)}return P(ue);case w:e:{for(Ge=me.key;le!==null;){if(le.key===Ge)if(le.tag===4&&le.stateNode.containerInfo===me.containerInfo&&le.stateNode.implementation===me.implementation){c(ue,le.sibling),je=v(le,me.children||[]),je.return=ue,ue=je;break e}else{c(ue,le);break}else a(ue,le);le=le.sibling}je=qm(me,ue.mode,je),je.return=ue,ue=je}return P(ue);case M:return me=mo(me),Ot(ue,le,me,je)}if(J(me))return Fe(ue,le,me,je);if(I(me)){if(Ge=I(me),typeof Ge!="function")throw Error(r(150));return me=Ge.call(me),Qe(ue,le,me,je)}if(typeof me.then=="function")return Ot(ue,le,Xd(me),je);if(me.$$typeof===R)return Ot(ue,le,Wd(ue,me),je);Zd(ue,me)}return typeof me=="string"&&me!==""||typeof me=="number"||typeof me=="bigint"?(me=""+me,le!==null&&le.tag===6?(c(ue,le.sibling),je=v(le,me),je.return=ue,ue=je):(c(ue,le),je=$m(me,ue.mode,je),je.return=ue,ue=je),P(ue)):c(ue,le)}return function(ue,le,me,je){try{Hc=0;var Ge=Ot(ue,le,me,je);return yl=null,Ge}catch(Ve){if(Ve===gl||Ve===Kd)throw Ve;var wt=Cr(29,Ve,null,ue.mode);return wt.lanes=je,wt.return=ue,wt}}}var go=L_(!0),U_=L_(!1),Qi=!1;function np(s){s.updateQueue={baseState:s.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function rp(s,a){s=s.updateQueue,a.updateQueue===s&&(a.updateQueue={baseState:s.baseState,firstBaseUpdate:s.firstBaseUpdate,lastBaseUpdate:s.lastBaseUpdate,shared:s.shared,callbacks:null})}function Ki(s){return{lane:s,tag:0,payload:null,callback:null,next:null}}function Yi(s,a,c){var m=s.updateQueue;if(m===null)return null;if(m=m.shared,(Tt&2)!==0){var v=m.pending;return v===null?a.next=a:(a.next=v.next,v.next=a),m.pending=a,a=$d(s),S_(s,null,c),a}return Vd(s,m,a,c),$d(s)}function Wc(s,a,c){if(a=a.updateQueue,a!==null&&(a=a.shared,(c&4194048)!==0)){var m=a.lanes;m&=s.pendingLanes,c|=m,a.lanes=c,vc(s,c)}}function sp(s,a){var c=s.updateQueue,m=s.alternate;if(m!==null&&(m=m.updateQueue,c===m)){var v=null,E=null;if(c=c.firstBaseUpdate,c!==null){do{var P={lane:c.lane,tag:c.tag,payload:c.payload,callback:null,next:null};E===null?v=E=P:E=E.next=P,c=c.next}while(c!==null);E===null?v=E=a:E=E.next=a}else v=E=a;c={baseState:m.baseState,firstBaseUpdate:v,lastBaseUpdate:E,shared:m.shared,callbacks:m.callbacks},s.updateQueue=c;return}s=c.lastBaseUpdate,s===null?c.firstBaseUpdate=a:s.next=a,c.lastBaseUpdate=a}var ip=!1;function Qc(){if(ip){var s=pl;if(s!==null)throw s}}function Kc(s,a,c,m){ip=!1;var v=s.updateQueue;Qi=!1;var E=v.firstBaseUpdate,P=v.lastBaseUpdate,W=v.shared.pending;if(W!==null){v.shared.pending=null;var se=W,pe=se.next;se.next=null,P===null?E=pe:P.next=pe,P=se;var Te=s.alternate;Te!==null&&(Te=Te.updateQueue,W=Te.lastBaseUpdate,W!==P&&(W===null?Te.firstBaseUpdate=pe:W.next=pe,Te.lastBaseUpdate=se))}if(E!==null){var De=v.baseState;P=0,Te=pe=se=null,W=E;do{var _e=W.lane&-536870913,xe=_e!==W.lane;if(xe?(ft&_e)===_e:(m&_e)===_e){_e!==0&&_e===ml&&(ip=!0),Te!==null&&(Te=Te.next={lane:0,tag:W.tag,payload:W.payload,callback:null,next:null});e:{var Fe=s,Qe=W;_e=a;var Ot=c;switch(Qe.tag){case 1:if(Fe=Qe.payload,typeof Fe=="function"){De=Fe.call(Ot,De,_e);break e}De=Fe;break e;case 3:Fe.flags=Fe.flags&-65537|128;case 0:if(Fe=Qe.payload,_e=typeof Fe=="function"?Fe.call(Ot,De,_e):Fe,_e==null)break e;De=g({},De,_e);break e;case 2:Qi=!0}}_e=W.callback,_e!==null&&(s.flags|=64,xe&&(s.flags|=8192),xe=v.callbacks,xe===null?v.callbacks=[_e]:xe.push(_e))}else xe={lane:_e,tag:W.tag,payload:W.payload,callback:W.callback,next:null},Te===null?(pe=Te=xe,se=De):Te=Te.next=xe,P|=_e;if(W=W.next,W===null){if(W=v.shared.pending,W===null)break;xe=W,W=xe.next,xe.next=null,v.lastBaseUpdate=xe,v.shared.pending=null}}while(!0);Te===null&&(se=De),v.baseState=se,v.firstBaseUpdate=pe,v.lastBaseUpdate=Te,E===null&&(v.shared.lanes=0),ta|=P,s.lanes=P,s.memoizedState=De}}function F_(s,a){if(typeof s!="function")throw Error(r(191,s));s.call(a)}function V_(s,a){var c=s.callbacks;if(c!==null)for(s.callbacks=null,s=0;s<c.length;s++)F_(c[s],a)}var _l=z(null),Jd=z(0);function $_(s,a){s=fi,re(Jd,s),re(_l,a),fi=s|a.baseLanes}function ap(){re(Jd,fi),re(_l,_l.current)}function op(){fi=Jd.current,H(_l),H(Jd)}var Tr=z(null),qr=null;function Xi(s){var a=s.alternate;re(on,on.current&1),re(Tr,s),qr===null&&(a===null||_l.current!==null||a.memoizedState!==null)&&(qr=s)}function lp(s){re(on,on.current),re(Tr,s),qr===null&&(qr=s)}function q_(s){s.tag===22?(re(on,on.current),re(Tr,s),qr===null&&(qr=s)):Zi()}function Zi(){re(on,on.current),re(Tr,Tr.current)}function Ar(s){H(Tr),qr===s&&(qr=null),H(on)}var on=z(0);function eh(s){for(var a=s;a!==null;){if(a.tag===13){var c=a.memoizedState;if(c!==null&&(c=c.dehydrated,c===null||mg(c)||pg(c)))return a}else if(a.tag===19&&(a.memoizedProps.revealOrder==="forwards"||a.memoizedProps.revealOrder==="backwards"||a.memoizedProps.revealOrder==="unstable_legacy-backwards"||a.memoizedProps.revealOrder==="together")){if((a.flags&128)!==0)return a}else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===s)break;for(;a.sibling===null;){if(a.return===null||a.return===s)return null;a=a.return}a.sibling.return=a.return,a=a.sibling}return null}var ii=0,st=null,kt=null,gn=null,th=!1,bl=!1,yo=!1,nh=0,Yc=0,vl=null,BA=0;function rn(){throw Error(r(321))}function cp(s,a){if(a===null)return!1;for(var c=0;c<a.length&&c<s.length;c++)if(!Er(s[c],a[c]))return!1;return!0}function up(s,a,c,m,v,E){return ii=E,st=a,a.memoizedState=null,a.updateQueue=null,a.lanes=0,Y.H=s===null||s.memoizedState===null?Ab:Cp,yo=!1,E=c(m,v),yo=!1,bl&&(E=G_(a,c,m,v)),H_(s),E}function H_(s){Y.H=Jc;var a=kt!==null&&kt.next!==null;if(ii=0,gn=kt=st=null,th=!1,Yc=0,vl=null,a)throw Error(r(300));s===null||yn||(s=s.dependencies,s!==null&&Gd(s)&&(yn=!0))}function G_(s,a,c,m){st=s;var v=0;do{if(bl&&(vl=null),Yc=0,bl=!1,25<=v)throw Error(r(301));if(v+=1,gn=kt=null,s.updateQueue!=null){var E=s.updateQueue;E.lastEffect=null,E.events=null,E.stores=null,E.memoCache!=null&&(E.memoCache.index=0)}Y.H=jb,E=a(c,m)}while(bl);return E}function zA(){var s=Y.H,a=s.useState()[0];return a=typeof a.then=="function"?Xc(a):a,s=s.useState()[0],(kt!==null?kt.memoizedState:null)!==s&&(st.flags|=1024),a}function dp(){var s=nh!==0;return nh=0,s}function hp(s,a,c){a.updateQueue=s.updateQueue,a.flags&=-2053,s.lanes&=~c}function fp(s){if(th){for(s=s.memoizedState;s!==null;){var a=s.queue;a!==null&&(a.pending=null),s=s.next}th=!1}ii=0,gn=kt=st=null,bl=!1,Yc=nh=0,vl=null}function or(){var s={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return gn===null?st.memoizedState=gn=s:gn=gn.next=s,gn}function ln(){if(kt===null){var s=st.alternate;s=s!==null?s.memoizedState:null}else s=kt.next;var a=gn===null?st.memoizedState:gn.next;if(a!==null)gn=a,kt=s;else{if(s===null)throw st.alternate===null?Error(r(467)):Error(r(310));kt=s,s={memoizedState:kt.memoizedState,baseState:kt.baseState,baseQueue:kt.baseQueue,queue:kt.queue,next:null},gn===null?st.memoizedState=gn=s:gn=gn.next=s}return gn}function rh(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Xc(s){var a=Yc;return Yc+=1,vl===null&&(vl=[]),s=P_(vl,s,a),a=st,(gn===null?a.memoizedState:gn.next)===null&&(a=a.alternate,Y.H=a===null||a.memoizedState===null?Ab:Cp),s}function sh(s){if(s!==null&&typeof s=="object"){if(typeof s.then=="function")return Xc(s);if(s.$$typeof===R)return Bn(s)}throw Error(r(438,String(s)))}function mp(s){var a=null,c=st.updateQueue;if(c!==null&&(a=c.memoCache),a==null){var m=st.alternate;m!==null&&(m=m.updateQueue,m!==null&&(m=m.memoCache,m!=null&&(a={data:m.data.map(function(v){return v.slice()}),index:0})))}if(a==null&&(a={data:[],index:0}),c===null&&(c=rh(),st.updateQueue=c),c.memoCache=a,c=a.data[a.index],c===void 0)for(c=a.data[a.index]=Array(s),m=0;m<s;m++)c[m]=U;return a.index++,c}function ai(s,a){return typeof a=="function"?a(s):a}function ih(s){var a=ln();return pp(a,kt,s)}function pp(s,a,c){var m=s.queue;if(m===null)throw Error(r(311));m.lastRenderedReducer=c;var v=s.baseQueue,E=m.pending;if(E!==null){if(v!==null){var P=v.next;v.next=E.next,E.next=P}a.baseQueue=v=E,m.pending=null}if(E=s.baseState,v===null)s.memoizedState=E;else{a=v.next;var W=P=null,se=null,pe=a,Te=!1;do{var De=pe.lane&-536870913;if(De!==pe.lane?(ft&De)===De:(ii&De)===De){var _e=pe.revertLane;if(_e===0)se!==null&&(se=se.next={lane:0,revertLane:0,gesture:null,action:pe.action,hasEagerState:pe.hasEagerState,eagerState:pe.eagerState,next:null}),De===ml&&(Te=!0);else if((ii&_e)===_e){pe=pe.next,_e===ml&&(Te=!0);continue}else De={lane:0,revertLane:pe.revertLane,gesture:null,action:pe.action,hasEagerState:pe.hasEagerState,eagerState:pe.eagerState,next:null},se===null?(W=se=De,P=E):se=se.next=De,st.lanes|=_e,ta|=_e;De=pe.action,yo&&c(E,De),E=pe.hasEagerState?pe.eagerState:c(E,De)}else _e={lane:De,revertLane:pe.revertLane,gesture:pe.gesture,action:pe.action,hasEagerState:pe.hasEagerState,eagerState:pe.eagerState,next:null},se===null?(W=se=_e,P=E):se=se.next=_e,st.lanes|=De,ta|=De;pe=pe.next}while(pe!==null&&pe!==a);if(se===null?P=E:se.next=W,!Er(E,s.memoizedState)&&(yn=!0,Te&&(c=pl,c!==null)))throw c;s.memoizedState=E,s.baseState=P,s.baseQueue=se,m.lastRenderedState=E}return v===null&&(m.lanes=0),[s.memoizedState,m.dispatch]}function gp(s){var a=ln(),c=a.queue;if(c===null)throw Error(r(311));c.lastRenderedReducer=s;var m=c.dispatch,v=c.pending,E=a.memoizedState;if(v!==null){c.pending=null;var P=v=v.next;do E=s(E,P.action),P=P.next;while(P!==v);Er(E,a.memoizedState)||(yn=!0),a.memoizedState=E,a.baseQueue===null&&(a.baseState=E),c.lastRenderedState=E}return[E,m]}function W_(s,a,c){var m=st,v=ln(),E=_t;if(E){if(c===void 0)throw Error(r(407));c=c()}else c=a();var P=!Er((kt||v).memoizedState,c);if(P&&(v.memoizedState=c,yn=!0),v=v.queue,bp(Y_.bind(null,m,v,s),[s]),v.getSnapshot!==a||P||gn!==null&&gn.memoizedState.tag&1){if(m.flags|=2048,xl(9,{destroy:void 0},K_.bind(null,m,v,c,a),null),zt===null)throw Error(r(349));E||(ii&127)!==0||Q_(m,a,c)}return c}function Q_(s,a,c){s.flags|=16384,s={getSnapshot:a,value:c},a=st.updateQueue,a===null?(a=rh(),st.updateQueue=a,a.stores=[s]):(c=a.stores,c===null?a.stores=[s]:c.push(s))}function K_(s,a,c,m){a.value=c,a.getSnapshot=m,X_(a)&&Z_(s)}function Y_(s,a,c){return c(function(){X_(a)&&Z_(s)})}function X_(s){var a=s.getSnapshot;s=s.value;try{var c=a();return!Er(s,c)}catch{return!0}}function Z_(s){var a=oo(s,2);a!==null&&gr(a,s,2)}function yp(s){var a=or();if(typeof s=="function"){var c=s;if(s=c(),yo){Wn(!0);try{c()}finally{Wn(!1)}}}return a.memoizedState=a.baseState=s,a.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ai,lastRenderedState:s},a}function J_(s,a,c,m){return s.baseState=c,pp(s,kt,typeof m=="function"?m:ai)}function LA(s,a,c,m,v){if(lh(s))throw Error(r(485));if(s=a.action,s!==null){var E={payload:v,action:s,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(P){E.listeners.push(P)}};Y.T!==null?c(!0):E.isTransition=!1,m(E),c=a.pending,c===null?(E.next=a.pending=E,eb(a,E)):(E.next=c.next,a.pending=c.next=E)}}function eb(s,a){var c=a.action,m=a.payload,v=s.state;if(a.isTransition){var E=Y.T,P={};Y.T=P;try{var W=c(v,m),se=Y.S;se!==null&&se(P,W),tb(s,a,W)}catch(pe){_p(s,a,pe)}finally{E!==null&&P.types!==null&&(E.types=P.types),Y.T=E}}else try{E=c(v,m),tb(s,a,E)}catch(pe){_p(s,a,pe)}}function tb(s,a,c){c!==null&&typeof c=="object"&&typeof c.then=="function"?c.then(function(m){nb(s,a,m)},function(m){return _p(s,a,m)}):nb(s,a,c)}function nb(s,a,c){a.status="fulfilled",a.value=c,rb(a),s.state=c,a=s.pending,a!==null&&(c=a.next,c===a?s.pending=null:(c=c.next,a.next=c,eb(s,c)))}function _p(s,a,c){var m=s.pending;if(s.pending=null,m!==null){m=m.next;do a.status="rejected",a.reason=c,rb(a),a=a.next;while(a!==m)}s.action=null}function rb(s){s=s.listeners;for(var a=0;a<s.length;a++)(0,s[a])()}function sb(s,a){return a}function ib(s,a){if(_t){var c=zt.formState;if(c!==null){e:{var m=st;if(_t){if($t){t:{for(var v=$t,E=$r;v.nodeType!==8;){if(!E){v=null;break t}if(v=Hr(v.nextSibling),v===null){v=null;break t}}E=v.data,v=E==="F!"||E==="F"?v:null}if(v){$t=Hr(v.nextSibling),m=v.data==="F!";break e}}Gi(m)}m=!1}m&&(a=c[0])}}return c=or(),c.memoizedState=c.baseState=a,m={pending:null,lanes:0,dispatch:null,lastRenderedReducer:sb,lastRenderedState:a},c.queue=m,c=Eb.bind(null,st,m),m.dispatch=c,m=yp(!1),E=Ep.bind(null,st,!1,m.queue),m=or(),v={state:a,dispatch:null,action:s,pending:null},m.queue=v,c=LA.bind(null,st,v,E,c),v.dispatch=c,m.memoizedState=s,[a,c,!1]}function ab(s){var a=ln();return ob(a,kt,s)}function ob(s,a,c){if(a=pp(s,a,sb)[0],s=ih(ai)[0],typeof a=="object"&&a!==null&&typeof a.then=="function")try{var m=Xc(a)}catch(P){throw P===gl?Kd:P}else m=a;a=ln();var v=a.queue,E=v.dispatch;return c!==a.memoizedState&&(st.flags|=2048,xl(9,{destroy:void 0},UA.bind(null,v,c),null)),[m,E,s]}function UA(s,a){s.action=a}function lb(s){var a=ln(),c=kt;if(c!==null)return ob(a,c,s);ln(),a=a.memoizedState,c=ln();var m=c.queue.dispatch;return c.memoizedState=s,[a,m,!1]}function xl(s,a,c,m){return s={tag:s,create:c,deps:m,inst:a,next:null},a=st.updateQueue,a===null&&(a=rh(),st.updateQueue=a),c=a.lastEffect,c===null?a.lastEffect=s.next=s:(m=c.next,c.next=s,s.next=m,a.lastEffect=s),s}function cb(){return ln().memoizedState}function ah(s,a,c,m){var v=or();st.flags|=s,v.memoizedState=xl(1|a,{destroy:void 0},c,m===void 0?null:m)}function oh(s,a,c,m){var v=ln();m=m===void 0?null:m;var E=v.memoizedState.inst;kt!==null&&m!==null&&cp(m,kt.memoizedState.deps)?v.memoizedState=xl(a,E,c,m):(st.flags|=s,v.memoizedState=xl(1|a,E,c,m))}function ub(s,a){ah(8390656,8,s,a)}function bp(s,a){oh(2048,8,s,a)}function FA(s){st.flags|=4;var a=st.updateQueue;if(a===null)a=rh(),st.updateQueue=a,a.events=[s];else{var c=a.events;c===null?a.events=[s]:c.push(s)}}function db(s){var a=ln().memoizedState;return FA({ref:a,nextImpl:s}),function(){if((Tt&2)!==0)throw Error(r(440));return a.impl.apply(void 0,arguments)}}function hb(s,a){return oh(4,2,s,a)}function fb(s,a){return oh(4,4,s,a)}function mb(s,a){if(typeof a=="function"){s=s();var c=a(s);return function(){typeof c=="function"?c():a(null)}}if(a!=null)return s=s(),a.current=s,function(){a.current=null}}function pb(s,a,c){c=c!=null?c.concat([s]):null,oh(4,4,mb.bind(null,a,s),c)}function vp(){}function gb(s,a){var c=ln();a=a===void 0?null:a;var m=c.memoizedState;return a!==null&&cp(a,m[1])?m[0]:(c.memoizedState=[s,a],s)}function yb(s,a){var c=ln();a=a===void 0?null:a;var m=c.memoizedState;if(a!==null&&cp(a,m[1]))return m[0];if(m=s(),yo){Wn(!0);try{s()}finally{Wn(!1)}}return c.memoizedState=[m,a],m}function xp(s,a,c){return c===void 0||(ii&1073741824)!==0&&(ft&261930)===0?s.memoizedState=a:(s.memoizedState=c,s=_v(),st.lanes|=s,ta|=s,c)}function _b(s,a,c,m){return Er(c,a)?c:_l.current!==null?(s=xp(s,c,m),Er(s,a)||(yn=!0),s):(ii&42)===0||(ii&1073741824)!==0&&(ft&261930)===0?(yn=!0,s.memoizedState=c):(s=_v(),st.lanes|=s,ta|=s,a)}function bb(s,a,c,m,v){var E=G.p;G.p=E!==0&&8>E?E:8;var P=Y.T,W={};Y.T=W,Ep(s,!1,a,c);try{var se=v(),pe=Y.S;if(pe!==null&&pe(W,se),se!==null&&typeof se=="object"&&typeof se.then=="function"){var Te=PA(se,m);Zc(s,a,Te,Ir(s))}else Zc(s,a,m,Ir(s))}catch(De){Zc(s,a,{then:function(){},status:"rejected",reason:De},Ir())}finally{G.p=E,P!==null&&W.types!==null&&(P.types=W.types),Y.T=P}}function VA(){}function wp(s,a,c,m){if(s.tag!==5)throw Error(r(476));var v=vb(s).queue;bb(s,v,a,Z,c===null?VA:function(){return xb(s),c(m)})}function vb(s){var a=s.memoizedState;if(a!==null)return a;a={memoizedState:Z,baseState:Z,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ai,lastRenderedState:Z},next:null};var c={};return a.next={memoizedState:c,baseState:c,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ai,lastRenderedState:c},next:null},s.memoizedState=a,s=s.alternate,s!==null&&(s.memoizedState=a),a}function xb(s){var a=vb(s);a.next===null&&(a=s.alternate.memoizedState),Zc(s,a.next.queue,{},Ir())}function Sp(){return Bn(pu)}function wb(){return ln().memoizedState}function Sb(){return ln().memoizedState}function $A(s){for(var a=s.return;a!==null;){switch(a.tag){case 24:case 3:var c=Ir();s=Ki(c);var m=Yi(a,s,c);m!==null&&(gr(m,a,c),Wc(m,a,c)),a={cache:Zm()},s.payload=a;return}a=a.return}}function qA(s,a,c){var m=Ir();c={lane:m,revertLane:0,gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null},lh(s)?Cb(a,c):(c=Fm(s,a,c,m),c!==null&&(gr(c,s,m),Tb(c,a,m)))}function Eb(s,a,c){var m=Ir();Zc(s,a,c,m)}function Zc(s,a,c,m){var v={lane:m,revertLane:0,gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null};if(lh(s))Cb(a,v);else{var E=s.alternate;if(s.lanes===0&&(E===null||E.lanes===0)&&(E=a.lastRenderedReducer,E!==null))try{var P=a.lastRenderedState,W=E(P,c);if(v.hasEagerState=!0,v.eagerState=W,Er(W,P))return Vd(s,a,v,0),zt===null&&Fd(),!1}catch{}if(c=Fm(s,a,v,m),c!==null)return gr(c,s,m),Tb(c,a,m),!0}return!1}function Ep(s,a,c,m){if(m={lane:2,revertLane:ng(),gesture:null,action:m,hasEagerState:!1,eagerState:null,next:null},lh(s)){if(a)throw Error(r(479))}else a=Fm(s,c,m,2),a!==null&&gr(a,s,2)}function lh(s){var a=s.alternate;return s===st||a!==null&&a===st}function Cb(s,a){bl=th=!0;var c=s.pending;c===null?a.next=a:(a.next=c.next,c.next=a),s.pending=a}function Tb(s,a,c){if((c&4194048)!==0){var m=a.lanes;m&=s.pendingLanes,c|=m,a.lanes=c,vc(s,c)}}var Jc={readContext:Bn,use:sh,useCallback:rn,useContext:rn,useEffect:rn,useImperativeHandle:rn,useLayoutEffect:rn,useInsertionEffect:rn,useMemo:rn,useReducer:rn,useRef:rn,useState:rn,useDebugValue:rn,useDeferredValue:rn,useTransition:rn,useSyncExternalStore:rn,useId:rn,useHostTransitionStatus:rn,useFormState:rn,useActionState:rn,useOptimistic:rn,useMemoCache:rn,useCacheRefresh:rn};Jc.useEffectEvent=rn;var Ab={readContext:Bn,use:sh,useCallback:function(s,a){return or().memoizedState=[s,a===void 0?null:a],s},useContext:Bn,useEffect:ub,useImperativeHandle:function(s,a,c){c=c!=null?c.concat([s]):null,ah(4194308,4,mb.bind(null,a,s),c)},useLayoutEffect:function(s,a){return ah(4194308,4,s,a)},useInsertionEffect:function(s,a){ah(4,2,s,a)},useMemo:function(s,a){var c=or();a=a===void 0?null:a;var m=s();if(yo){Wn(!0);try{s()}finally{Wn(!1)}}return c.memoizedState=[m,a],m},useReducer:function(s,a,c){var m=or();if(c!==void 0){var v=c(a);if(yo){Wn(!0);try{c(a)}finally{Wn(!1)}}}else v=a;return m.memoizedState=m.baseState=v,s={pending:null,lanes:0,dispatch:null,lastRenderedReducer:s,lastRenderedState:v},m.queue=s,s=s.dispatch=qA.bind(null,st,s),[m.memoizedState,s]},useRef:function(s){var a=or();return s={current:s},a.memoizedState=s},useState:function(s){s=yp(s);var a=s.queue,c=Eb.bind(null,st,a);return a.dispatch=c,[s.memoizedState,c]},useDebugValue:vp,useDeferredValue:function(s,a){var c=or();return xp(c,s,a)},useTransition:function(){var s=yp(!1);return s=bb.bind(null,st,s.queue,!0,!1),or().memoizedState=s,[!1,s]},useSyncExternalStore:function(s,a,c){var m=st,v=or();if(_t){if(c===void 0)throw Error(r(407));c=c()}else{if(c=a(),zt===null)throw Error(r(349));(ft&127)!==0||Q_(m,a,c)}v.memoizedState=c;var E={value:c,getSnapshot:a};return v.queue=E,ub(Y_.bind(null,m,E,s),[s]),m.flags|=2048,xl(9,{destroy:void 0},K_.bind(null,m,E,c,a),null),c},useId:function(){var s=or(),a=zt.identifierPrefix;if(_t){var c=Ns,m=Os;c=(m&~(1<<32-Et(m)-1)).toString(32)+c,a="_"+a+"R_"+c,c=nh++,0<c&&(a+="H"+c.toString(32)),a+="_"}else c=BA++,a="_"+a+"r_"+c.toString(32)+"_";return s.memoizedState=a},useHostTransitionStatus:Sp,useFormState:ib,useActionState:ib,useOptimistic:function(s){var a=or();a.memoizedState=a.baseState=s;var c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return a.queue=c,a=Ep.bind(null,st,!0,c),c.dispatch=a,[s,a]},useMemoCache:mp,useCacheRefresh:function(){return or().memoizedState=$A.bind(null,st)},useEffectEvent:function(s){var a=or(),c={impl:s};return a.memoizedState=c,function(){if((Tt&2)!==0)throw Error(r(440));return c.impl.apply(void 0,arguments)}}},Cp={readContext:Bn,use:sh,useCallback:gb,useContext:Bn,useEffect:bp,useImperativeHandle:pb,useInsertionEffect:hb,useLayoutEffect:fb,useMemo:yb,useReducer:ih,useRef:cb,useState:function(){return ih(ai)},useDebugValue:vp,useDeferredValue:function(s,a){var c=ln();return _b(c,kt.memoizedState,s,a)},useTransition:function(){var s=ih(ai)[0],a=ln().memoizedState;return[typeof s=="boolean"?s:Xc(s),a]},useSyncExternalStore:W_,useId:wb,useHostTransitionStatus:Sp,useFormState:ab,useActionState:ab,useOptimistic:function(s,a){var c=ln();return J_(c,kt,s,a)},useMemoCache:mp,useCacheRefresh:Sb};Cp.useEffectEvent=db;var jb={readContext:Bn,use:sh,useCallback:gb,useContext:Bn,useEffect:bp,useImperativeHandle:pb,useInsertionEffect:hb,useLayoutEffect:fb,useMemo:yb,useReducer:gp,useRef:cb,useState:function(){return gp(ai)},useDebugValue:vp,useDeferredValue:function(s,a){var c=ln();return kt===null?xp(c,s,a):_b(c,kt.memoizedState,s,a)},useTransition:function(){var s=gp(ai)[0],a=ln().memoizedState;return[typeof s=="boolean"?s:Xc(s),a]},useSyncExternalStore:W_,useId:wb,useHostTransitionStatus:Sp,useFormState:lb,useActionState:lb,useOptimistic:function(s,a){var c=ln();return kt!==null?J_(c,kt,s,a):(c.baseState=s,[s,c.queue.dispatch])},useMemoCache:mp,useCacheRefresh:Sb};jb.useEffectEvent=db;function Tp(s,a,c,m){a=s.memoizedState,c=c(m,a),c=c==null?a:g({},a,c),s.memoizedState=c,s.lanes===0&&(s.updateQueue.baseState=c)}var Ap={enqueueSetState:function(s,a,c){s=s._reactInternals;var m=Ir(),v=Ki(m);v.payload=a,c!=null&&(v.callback=c),a=Yi(s,v,m),a!==null&&(gr(a,s,m),Wc(a,s,m))},enqueueReplaceState:function(s,a,c){s=s._reactInternals;var m=Ir(),v=Ki(m);v.tag=1,v.payload=a,c!=null&&(v.callback=c),a=Yi(s,v,m),a!==null&&(gr(a,s,m),Wc(a,s,m))},enqueueForceUpdate:function(s,a){s=s._reactInternals;var c=Ir(),m=Ki(c);m.tag=2,a!=null&&(m.callback=a),a=Yi(s,m,c),a!==null&&(gr(a,s,c),Wc(a,s,c))}};function Rb(s,a,c,m,v,E,P){return s=s.stateNode,typeof s.shouldComponentUpdate=="function"?s.shouldComponentUpdate(m,E,P):a.prototype&&a.prototype.isPureReactComponent?!Lc(c,m)||!Lc(v,E):!0}function Ib(s,a,c,m){s=a.state,typeof a.componentWillReceiveProps=="function"&&a.componentWillReceiveProps(c,m),typeof a.UNSAFE_componentWillReceiveProps=="function"&&a.UNSAFE_componentWillReceiveProps(c,m),a.state!==s&&Ap.enqueueReplaceState(a,a.state,null)}function _o(s,a){var c=a;if("ref"in a){c={};for(var m in a)m!=="ref"&&(c[m]=a[m])}if(s=s.defaultProps){c===a&&(c=g({},c));for(var v in s)c[v]===void 0&&(c[v]=s[v])}return c}function Db(s){Ud(s)}function kb(s){console.error(s)}function Mb(s){Ud(s)}function ch(s,a){try{var c=s.onUncaughtError;c(a.value,{componentStack:a.stack})}catch(m){setTimeout(function(){throw m})}}function Ob(s,a,c){try{var m=s.onCaughtError;m(c.value,{componentStack:c.stack,errorBoundary:a.tag===1?a.stateNode:null})}catch(v){setTimeout(function(){throw v})}}function jp(s,a,c){return c=Ki(c),c.tag=3,c.payload={element:null},c.callback=function(){ch(s,a)},c}function Nb(s){return s=Ki(s),s.tag=3,s}function Pb(s,a,c,m){var v=c.type.getDerivedStateFromError;if(typeof v=="function"){var E=m.value;s.payload=function(){return v(E)},s.callback=function(){Ob(a,c,m)}}var P=c.stateNode;P!==null&&typeof P.componentDidCatch=="function"&&(s.callback=function(){Ob(a,c,m),typeof v!="function"&&(na===null?na=new Set([this]):na.add(this));var W=m.stack;this.componentDidCatch(m.value,{componentStack:W!==null?W:""})})}function HA(s,a,c,m,v){if(c.flags|=32768,m!==null&&typeof m=="object"&&typeof m.then=="function"){if(a=c.alternate,a!==null&&fl(a,c,v,!0),c=Tr.current,c!==null){switch(c.tag){case 31:case 13:return qr===null?xh():c.alternate===null&&sn===0&&(sn=3),c.flags&=-257,c.flags|=65536,c.lanes=v,m===Yd?c.flags|=16384:(a=c.updateQueue,a===null?c.updateQueue=new Set([m]):a.add(m),Jp(s,m,v)),!1;case 22:return c.flags|=65536,m===Yd?c.flags|=16384:(a=c.updateQueue,a===null?(a={transitions:null,markerInstances:null,retryQueue:new Set([m])},c.updateQueue=a):(c=a.retryQueue,c===null?a.retryQueue=new Set([m]):c.add(m)),Jp(s,m,v)),!1}throw Error(r(435,c.tag))}return Jp(s,m,v),xh(),!1}if(_t)return a=Tr.current,a!==null?((a.flags&65536)===0&&(a.flags|=256),a.flags|=65536,a.lanes=v,m!==Wm&&(s=Error(r(422),{cause:m}),Vc(Ur(s,c)))):(m!==Wm&&(a=Error(r(423),{cause:m}),Vc(Ur(a,c))),s=s.current.alternate,s.flags|=65536,v&=-v,s.lanes|=v,m=Ur(m,c),v=jp(s.stateNode,m,v),sp(s,v),sn!==4&&(sn=2)),!1;var E=Error(r(520),{cause:m});if(E=Ur(E,c),ou===null?ou=[E]:ou.push(E),sn!==4&&(sn=2),a===null)return!0;m=Ur(m,c),c=a;do{switch(c.tag){case 3:return c.flags|=65536,s=v&-v,c.lanes|=s,s=jp(c.stateNode,m,s),sp(c,s),!1;case 1:if(a=c.type,E=c.stateNode,(c.flags&128)===0&&(typeof a.getDerivedStateFromError=="function"||E!==null&&typeof E.componentDidCatch=="function"&&(na===null||!na.has(E))))return c.flags|=65536,v&=-v,c.lanes|=v,v=Nb(v),Pb(v,s,c,m),sp(c,v),!1}c=c.return}while(c!==null);return!1}var Rp=Error(r(461)),yn=!1;function zn(s,a,c,m){a.child=s===null?U_(a,null,c,m):go(a,s.child,c,m)}function Bb(s,a,c,m,v){c=c.render;var E=a.ref;if("ref"in m){var P={};for(var W in m)W!=="ref"&&(P[W]=m[W])}else P=m;return ho(a),m=up(s,a,c,P,E,v),W=dp(),s!==null&&!yn?(hp(s,a,v),oi(s,a,v)):(_t&&W&&Hm(a),a.flags|=1,zn(s,a,m,v),a.child)}function zb(s,a,c,m,v){if(s===null){var E=c.type;return typeof E=="function"&&!Vm(E)&&E.defaultProps===void 0&&c.compare===null?(a.tag=15,a.type=E,Lb(s,a,E,m,v)):(s=qd(c.type,null,m,a,a.mode,v),s.ref=a.ref,s.return=a,a.child=s)}if(E=s.child,!Bp(s,v)){var P=E.memoizedProps;if(c=c.compare,c=c!==null?c:Lc,c(P,m)&&s.ref===a.ref)return oi(s,a,v)}return a.flags|=1,s=ti(E,m),s.ref=a.ref,s.return=a,a.child=s}function Lb(s,a,c,m,v){if(s!==null){var E=s.memoizedProps;if(Lc(E,m)&&s.ref===a.ref)if(yn=!1,a.pendingProps=m=E,Bp(s,v))(s.flags&131072)!==0&&(yn=!0);else return a.lanes=s.lanes,oi(s,a,v)}return Ip(s,a,c,m,v)}function Ub(s,a,c,m){var v=m.children,E=s!==null?s.memoizedState:null;if(s===null&&a.stateNode===null&&(a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),m.mode==="hidden"){if((a.flags&128)!==0){if(E=E!==null?E.baseLanes|c:c,s!==null){for(m=a.child=s.child,v=0;m!==null;)v=v|m.lanes|m.childLanes,m=m.sibling;m=v&~E}else m=0,a.child=null;return Fb(s,a,E,c,m)}if((c&536870912)!==0)a.memoizedState={baseLanes:0,cachePool:null},s!==null&&Qd(a,E!==null?E.cachePool:null),E!==null?$_(a,E):ap(),q_(a);else return m=a.lanes=536870912,Fb(s,a,E!==null?E.baseLanes|c:c,c,m)}else E!==null?(Qd(a,E.cachePool),$_(a,E),Zi(),a.memoizedState=null):(s!==null&&Qd(a,null),ap(),Zi());return zn(s,a,v,c),a.child}function eu(s,a){return s!==null&&s.tag===22||a.stateNode!==null||(a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),a.sibling}function Fb(s,a,c,m,v){var E=ep();return E=E===null?null:{parent:pn._currentValue,pool:E},a.memoizedState={baseLanes:c,cachePool:E},s!==null&&Qd(a,null),ap(),q_(a),s!==null&&fl(s,a,m,!0),a.childLanes=v,null}function uh(s,a){return a=hh({mode:a.mode,children:a.children},s.mode),a.ref=s.ref,s.child=a,a.return=s,a}function Vb(s,a,c){return go(a,s.child,null,c),s=uh(a,a.pendingProps),s.flags|=2,Ar(a),a.memoizedState=null,s}function GA(s,a,c){var m=a.pendingProps,v=(a.flags&128)!==0;if(a.flags&=-129,s===null){if(_t){if(m.mode==="hidden")return s=uh(a,m),a.lanes=536870912,eu(null,s);if(lp(a),(s=$t)?(s=ex(s,$r),s=s!==null&&s.data==="&"?s:null,s!==null&&(a.memoizedState={dehydrated:s,treeContext:qi!==null?{id:Os,overflow:Ns}:null,retryLane:536870912,hydrationErrors:null},c=C_(s),c.return=a,a.child=c,Pn=a,$t=null)):s=null,s===null)throw Gi(a);return a.lanes=536870912,null}return uh(a,m)}var E=s.memoizedState;if(E!==null){var P=E.dehydrated;if(lp(a),v)if(a.flags&256)a.flags&=-257,a=Vb(s,a,c);else if(a.memoizedState!==null)a.child=s.child,a.flags|=128,a=null;else throw Error(r(558));else if(yn||fl(s,a,c,!1),v=(c&s.childLanes)!==0,yn||v){if(m=zt,m!==null&&(P=xc(m,c),P!==0&&P!==E.retryLane))throw E.retryLane=P,oo(s,P),gr(m,s,P),Rp;xh(),a=Vb(s,a,c)}else s=E.treeContext,$t=Hr(P.nextSibling),Pn=a,_t=!0,Hi=null,$r=!1,s!==null&&j_(a,s),a=uh(a,m),a.flags|=4096;return a}return s=ti(s.child,{mode:m.mode,children:m.children}),s.ref=a.ref,a.child=s,s.return=a,s}function dh(s,a){var c=a.ref;if(c===null)s!==null&&s.ref!==null&&(a.flags|=4194816);else{if(typeof c!="function"&&typeof c!="object")throw Error(r(284));(s===null||s.ref!==c)&&(a.flags|=4194816)}}function Ip(s,a,c,m,v){return ho(a),c=up(s,a,c,m,void 0,v),m=dp(),s!==null&&!yn?(hp(s,a,v),oi(s,a,v)):(_t&&m&&Hm(a),a.flags|=1,zn(s,a,c,v),a.child)}function $b(s,a,c,m,v,E){return ho(a),a.updateQueue=null,c=G_(a,m,c,v),H_(s),m=dp(),s!==null&&!yn?(hp(s,a,E),oi(s,a,E)):(_t&&m&&Hm(a),a.flags|=1,zn(s,a,c,E),a.child)}function qb(s,a,c,m,v){if(ho(a),a.stateNode===null){var E=cl,P=c.contextType;typeof P=="object"&&P!==null&&(E=Bn(P)),E=new c(m,E),a.memoizedState=E.state!==null&&E.state!==void 0?E.state:null,E.updater=Ap,a.stateNode=E,E._reactInternals=a,E=a.stateNode,E.props=m,E.state=a.memoizedState,E.refs={},np(a),P=c.contextType,E.context=typeof P=="object"&&P!==null?Bn(P):cl,E.state=a.memoizedState,P=c.getDerivedStateFromProps,typeof P=="function"&&(Tp(a,c,P,m),E.state=a.memoizedState),typeof c.getDerivedStateFromProps=="function"||typeof E.getSnapshotBeforeUpdate=="function"||typeof E.UNSAFE_componentWillMount!="function"&&typeof E.componentWillMount!="function"||(P=E.state,typeof E.componentWillMount=="function"&&E.componentWillMount(),typeof E.UNSAFE_componentWillMount=="function"&&E.UNSAFE_componentWillMount(),P!==E.state&&Ap.enqueueReplaceState(E,E.state,null),Kc(a,m,E,v),Qc(),E.state=a.memoizedState),typeof E.componentDidMount=="function"&&(a.flags|=4194308),m=!0}else if(s===null){E=a.stateNode;var W=a.memoizedProps,se=_o(c,W);E.props=se;var pe=E.context,Te=c.contextType;P=cl,typeof Te=="object"&&Te!==null&&(P=Bn(Te));var De=c.getDerivedStateFromProps;Te=typeof De=="function"||typeof E.getSnapshotBeforeUpdate=="function",W=a.pendingProps!==W,Te||typeof E.UNSAFE_componentWillReceiveProps!="function"&&typeof E.componentWillReceiveProps!="function"||(W||pe!==P)&&Ib(a,E,m,P),Qi=!1;var _e=a.memoizedState;E.state=_e,Kc(a,m,E,v),Qc(),pe=a.memoizedState,W||_e!==pe||Qi?(typeof De=="function"&&(Tp(a,c,De,m),pe=a.memoizedState),(se=Qi||Rb(a,c,se,m,_e,pe,P))?(Te||typeof E.UNSAFE_componentWillMount!="function"&&typeof E.componentWillMount!="function"||(typeof E.componentWillMount=="function"&&E.componentWillMount(),typeof E.UNSAFE_componentWillMount=="function"&&E.UNSAFE_componentWillMount()),typeof E.componentDidMount=="function"&&(a.flags|=4194308)):(typeof E.componentDidMount=="function"&&(a.flags|=4194308),a.memoizedProps=m,a.memoizedState=pe),E.props=m,E.state=pe,E.context=P,m=se):(typeof E.componentDidMount=="function"&&(a.flags|=4194308),m=!1)}else{E=a.stateNode,rp(s,a),P=a.memoizedProps,Te=_o(c,P),E.props=Te,De=a.pendingProps,_e=E.context,pe=c.contextType,se=cl,typeof pe=="object"&&pe!==null&&(se=Bn(pe)),W=c.getDerivedStateFromProps,(pe=typeof W=="function"||typeof E.getSnapshotBeforeUpdate=="function")||typeof E.UNSAFE_componentWillReceiveProps!="function"&&typeof E.componentWillReceiveProps!="function"||(P!==De||_e!==se)&&Ib(a,E,m,se),Qi=!1,_e=a.memoizedState,E.state=_e,Kc(a,m,E,v),Qc();var xe=a.memoizedState;P!==De||_e!==xe||Qi||s!==null&&s.dependencies!==null&&Gd(s.dependencies)?(typeof W=="function"&&(Tp(a,c,W,m),xe=a.memoizedState),(Te=Qi||Rb(a,c,Te,m,_e,xe,se)||s!==null&&s.dependencies!==null&&Gd(s.dependencies))?(pe||typeof E.UNSAFE_componentWillUpdate!="function"&&typeof E.componentWillUpdate!="function"||(typeof E.componentWillUpdate=="function"&&E.componentWillUpdate(m,xe,se),typeof E.UNSAFE_componentWillUpdate=="function"&&E.UNSAFE_componentWillUpdate(m,xe,se)),typeof E.componentDidUpdate=="function"&&(a.flags|=4),typeof E.getSnapshotBeforeUpdate=="function"&&(a.flags|=1024)):(typeof E.componentDidUpdate!="function"||P===s.memoizedProps&&_e===s.memoizedState||(a.flags|=4),typeof E.getSnapshotBeforeUpdate!="function"||P===s.memoizedProps&&_e===s.memoizedState||(a.flags|=1024),a.memoizedProps=m,a.memoizedState=xe),E.props=m,E.state=xe,E.context=se,m=Te):(typeof E.componentDidUpdate!="function"||P===s.memoizedProps&&_e===s.memoizedState||(a.flags|=4),typeof E.getSnapshotBeforeUpdate!="function"||P===s.memoizedProps&&_e===s.memoizedState||(a.flags|=1024),m=!1)}return E=m,dh(s,a),m=(a.flags&128)!==0,E||m?(E=a.stateNode,c=m&&typeof c.getDerivedStateFromError!="function"?null:E.render(),a.flags|=1,s!==null&&m?(a.child=go(a,s.child,null,v),a.child=go(a,null,c,v)):zn(s,a,c,v),a.memoizedState=E.state,s=a.child):s=oi(s,a,v),s}function Hb(s,a,c,m){return co(),a.flags|=256,zn(s,a,c,m),a.child}var Dp={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function kp(s){return{baseLanes:s,cachePool:O_()}}function Mp(s,a,c){return s=s!==null?s.childLanes&~c:0,a&&(s|=Rr),s}function Gb(s,a,c){var m=a.pendingProps,v=!1,E=(a.flags&128)!==0,P;if((P=E)||(P=s!==null&&s.memoizedState===null?!1:(on.current&2)!==0),P&&(v=!0,a.flags&=-129),P=(a.flags&32)!==0,a.flags&=-33,s===null){if(_t){if(v?Xi(a):Zi(),(s=$t)?(s=ex(s,$r),s=s!==null&&s.data!=="&"?s:null,s!==null&&(a.memoizedState={dehydrated:s,treeContext:qi!==null?{id:Os,overflow:Ns}:null,retryLane:536870912,hydrationErrors:null},c=C_(s),c.return=a,a.child=c,Pn=a,$t=null)):s=null,s===null)throw Gi(a);return pg(s)?a.lanes=32:a.lanes=536870912,null}var W=m.children;return m=m.fallback,v?(Zi(),v=a.mode,W=hh({mode:"hidden",children:W},v),m=lo(m,v,c,null),W.return=a,m.return=a,W.sibling=m,a.child=W,m=a.child,m.memoizedState=kp(c),m.childLanes=Mp(s,P,c),a.memoizedState=Dp,eu(null,m)):(Xi(a),Op(a,W))}var se=s.memoizedState;if(se!==null&&(W=se.dehydrated,W!==null)){if(E)a.flags&256?(Xi(a),a.flags&=-257,a=Np(s,a,c)):a.memoizedState!==null?(Zi(),a.child=s.child,a.flags|=128,a=null):(Zi(),W=m.fallback,v=a.mode,m=hh({mode:"visible",children:m.children},v),W=lo(W,v,c,null),W.flags|=2,m.return=a,W.return=a,m.sibling=W,a.child=m,go(a,s.child,null,c),m=a.child,m.memoizedState=kp(c),m.childLanes=Mp(s,P,c),a.memoizedState=Dp,a=eu(null,m));else if(Xi(a),pg(W)){if(P=W.nextSibling&&W.nextSibling.dataset,P)var pe=P.dgst;P=pe,m=Error(r(419)),m.stack="",m.digest=P,Vc({value:m,source:null,stack:null}),a=Np(s,a,c)}else if(yn||fl(s,a,c,!1),P=(c&s.childLanes)!==0,yn||P){if(P=zt,P!==null&&(m=xc(P,c),m!==0&&m!==se.retryLane))throw se.retryLane=m,oo(s,m),gr(P,s,m),Rp;mg(W)||xh(),a=Np(s,a,c)}else mg(W)?(a.flags|=192,a.child=s.child,a=null):(s=se.treeContext,$t=Hr(W.nextSibling),Pn=a,_t=!0,Hi=null,$r=!1,s!==null&&j_(a,s),a=Op(a,m.children),a.flags|=4096);return a}return v?(Zi(),W=m.fallback,v=a.mode,se=s.child,pe=se.sibling,m=ti(se,{mode:"hidden",children:m.children}),m.subtreeFlags=se.subtreeFlags&65011712,pe!==null?W=ti(pe,W):(W=lo(W,v,c,null),W.flags|=2),W.return=a,m.return=a,m.sibling=W,a.child=m,eu(null,m),m=a.child,W=s.child.memoizedState,W===null?W=kp(c):(v=W.cachePool,v!==null?(se=pn._currentValue,v=v.parent!==se?{parent:se,pool:se}:v):v=O_(),W={baseLanes:W.baseLanes|c,cachePool:v}),m.memoizedState=W,m.childLanes=Mp(s,P,c),a.memoizedState=Dp,eu(s.child,m)):(Xi(a),c=s.child,s=c.sibling,c=ti(c,{mode:"visible",children:m.children}),c.return=a,c.sibling=null,s!==null&&(P=a.deletions,P===null?(a.deletions=[s],a.flags|=16):P.push(s)),a.child=c,a.memoizedState=null,c)}function Op(s,a){return a=hh({mode:"visible",children:a},s.mode),a.return=s,s.child=a}function hh(s,a){return s=Cr(22,s,null,a),s.lanes=0,s}function Np(s,a,c){return go(a,s.child,null,c),s=Op(a,a.pendingProps.children),s.flags|=2,a.memoizedState=null,s}function Wb(s,a,c){s.lanes|=a;var m=s.alternate;m!==null&&(m.lanes|=a),Ym(s.return,a,c)}function Pp(s,a,c,m,v,E){var P=s.memoizedState;P===null?s.memoizedState={isBackwards:a,rendering:null,renderingStartTime:0,last:m,tail:c,tailMode:v,treeForkCount:E}:(P.isBackwards=a,P.rendering=null,P.renderingStartTime=0,P.last=m,P.tail=c,P.tailMode=v,P.treeForkCount=E)}function Qb(s,a,c){var m=a.pendingProps,v=m.revealOrder,E=m.tail;m=m.children;var P=on.current,W=(P&2)!==0;if(W?(P=P&1|2,a.flags|=128):P&=1,re(on,P),zn(s,a,m,c),m=_t?Fc:0,!W&&s!==null&&(s.flags&128)!==0)e:for(s=a.child;s!==null;){if(s.tag===13)s.memoizedState!==null&&Wb(s,c,a);else if(s.tag===19)Wb(s,c,a);else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===a)break e;for(;s.sibling===null;){if(s.return===null||s.return===a)break e;s=s.return}s.sibling.return=s.return,s=s.sibling}switch(v){case"forwards":for(c=a.child,v=null;c!==null;)s=c.alternate,s!==null&&eh(s)===null&&(v=c),c=c.sibling;c=v,c===null?(v=a.child,a.child=null):(v=c.sibling,c.sibling=null),Pp(a,!1,v,c,E,m);break;case"backwards":case"unstable_legacy-backwards":for(c=null,v=a.child,a.child=null;v!==null;){if(s=v.alternate,s!==null&&eh(s)===null){a.child=v;break}s=v.sibling,v.sibling=c,c=v,v=s}Pp(a,!0,c,null,E,m);break;case"together":Pp(a,!1,null,null,void 0,m);break;default:a.memoizedState=null}return a.child}function oi(s,a,c){if(s!==null&&(a.dependencies=s.dependencies),ta|=a.lanes,(c&a.childLanes)===0)if(s!==null){if(fl(s,a,c,!1),(c&a.childLanes)===0)return null}else return null;if(s!==null&&a.child!==s.child)throw Error(r(153));if(a.child!==null){for(s=a.child,c=ti(s,s.pendingProps),a.child=c,c.return=a;s.sibling!==null;)s=s.sibling,c=c.sibling=ti(s,s.pendingProps),c.return=a;c.sibling=null}return a.child}function Bp(s,a){return(s.lanes&a)!==0?!0:(s=s.dependencies,!!(s!==null&&Gd(s)))}function WA(s,a,c){switch(a.tag){case 3:oe(a,a.stateNode.containerInfo),Wi(a,pn,s.memoizedState.cache),co();break;case 27:case 5:Me(a);break;case 4:oe(a,a.stateNode.containerInfo);break;case 10:Wi(a,a.type,a.memoizedProps.value);break;case 31:if(a.memoizedState!==null)return a.flags|=128,lp(a),null;break;case 13:var m=a.memoizedState;if(m!==null)return m.dehydrated!==null?(Xi(a),a.flags|=128,null):(c&a.child.childLanes)!==0?Gb(s,a,c):(Xi(a),s=oi(s,a,c),s!==null?s.sibling:null);Xi(a);break;case 19:var v=(s.flags&128)!==0;if(m=(c&a.childLanes)!==0,m||(fl(s,a,c,!1),m=(c&a.childLanes)!==0),v){if(m)return Qb(s,a,c);a.flags|=128}if(v=a.memoizedState,v!==null&&(v.rendering=null,v.tail=null,v.lastEffect=null),re(on,on.current),m)break;return null;case 22:return a.lanes=0,Ub(s,a,c,a.pendingProps);case 24:Wi(a,pn,s.memoizedState.cache)}return oi(s,a,c)}function Kb(s,a,c){if(s!==null)if(s.memoizedProps!==a.pendingProps)yn=!0;else{if(!Bp(s,c)&&(a.flags&128)===0)return yn=!1,WA(s,a,c);yn=(s.flags&131072)!==0}else yn=!1,_t&&(a.flags&1048576)!==0&&A_(a,Fc,a.index);switch(a.lanes=0,a.tag){case 16:e:{var m=a.pendingProps;if(s=mo(a.elementType),a.type=s,typeof s=="function")Vm(s)?(m=_o(s,m),a.tag=1,a=qb(null,a,s,m,c)):(a.tag=0,a=Ip(null,a,s,m,c));else{if(s!=null){var v=s.$$typeof;if(v===D){a.tag=11,a=Bb(null,a,s,m,c);break e}else if(v===k){a.tag=14,a=zb(null,a,s,m,c);break e}}throw a=O(s)||s,Error(r(306,a,""))}}return a;case 0:return Ip(s,a,a.type,a.pendingProps,c);case 1:return m=a.type,v=_o(m,a.pendingProps),qb(s,a,m,v,c);case 3:e:{if(oe(a,a.stateNode.containerInfo),s===null)throw Error(r(387));m=a.pendingProps;var E=a.memoizedState;v=E.element,rp(s,a),Kc(a,m,null,c);var P=a.memoizedState;if(m=P.cache,Wi(a,pn,m),m!==E.cache&&Xm(a,[pn],c,!0),Qc(),m=P.element,E.isDehydrated)if(E={element:m,isDehydrated:!1,cache:P.cache},a.updateQueue.baseState=E,a.memoizedState=E,a.flags&256){a=Hb(s,a,m,c);break e}else if(m!==v){v=Ur(Error(r(424)),a),Vc(v),a=Hb(s,a,m,c);break e}else for(s=a.stateNode.containerInfo,s.nodeType===9?s=s.body:s=s.nodeName==="HTML"?s.ownerDocument.body:s,$t=Hr(s.firstChild),Pn=a,_t=!0,Hi=null,$r=!0,c=U_(a,null,m,c),a.child=c;c;)c.flags=c.flags&-3|4096,c=c.sibling;else{if(co(),m===v){a=oi(s,a,c);break e}zn(s,a,m,c)}a=a.child}return a;case 26:return dh(s,a),s===null?(c=ax(a.type,null,a.pendingProps,null))?a.memoizedState=c:_t||(c=a.type,s=a.pendingProps,m=jh(he.current).createElement(c),m[hn]=a,m[In]=s,Ln(m,c,s),fn(m),a.stateNode=m):a.memoizedState=ax(a.type,s.memoizedProps,a.pendingProps,s.memoizedState),null;case 27:return Me(a),s===null&&_t&&(m=a.stateNode=rx(a.type,a.pendingProps,he.current),Pn=a,$r=!0,v=$t,aa(a.type)?(gg=v,$t=Hr(m.firstChild)):$t=v),zn(s,a,a.pendingProps.children,c),dh(s,a),s===null&&(a.flags|=4194304),a.child;case 5:return s===null&&_t&&((v=m=$t)&&(m=S2(m,a.type,a.pendingProps,$r),m!==null?(a.stateNode=m,Pn=a,$t=Hr(m.firstChild),$r=!1,v=!0):v=!1),v||Gi(a)),Me(a),v=a.type,E=a.pendingProps,P=s!==null?s.memoizedProps:null,m=E.children,dg(v,E)?m=null:P!==null&&dg(v,P)&&(a.flags|=32),a.memoizedState!==null&&(v=up(s,a,zA,null,null,c),pu._currentValue=v),dh(s,a),zn(s,a,m,c),a.child;case 6:return s===null&&_t&&((s=c=$t)&&(c=E2(c,a.pendingProps,$r),c!==null?(a.stateNode=c,Pn=a,$t=null,s=!0):s=!1),s||Gi(a)),null;case 13:return Gb(s,a,c);case 4:return oe(a,a.stateNode.containerInfo),m=a.pendingProps,s===null?a.child=go(a,null,m,c):zn(s,a,m,c),a.child;case 11:return Bb(s,a,a.type,a.pendingProps,c);case 7:return zn(s,a,a.pendingProps,c),a.child;case 8:return zn(s,a,a.pendingProps.children,c),a.child;case 12:return zn(s,a,a.pendingProps.children,c),a.child;case 10:return m=a.pendingProps,Wi(a,a.type,m.value),zn(s,a,m.children,c),a.child;case 9:return v=a.type._context,m=a.pendingProps.children,ho(a),v=Bn(v),m=m(v),a.flags|=1,zn(s,a,m,c),a.child;case 14:return zb(s,a,a.type,a.pendingProps,c);case 15:return Lb(s,a,a.type,a.pendingProps,c);case 19:return Qb(s,a,c);case 31:return GA(s,a,c);case 22:return Ub(s,a,c,a.pendingProps);case 24:return ho(a),m=Bn(pn),s===null?(v=ep(),v===null&&(v=zt,E=Zm(),v.pooledCache=E,E.refCount++,E!==null&&(v.pooledCacheLanes|=c),v=E),a.memoizedState={parent:m,cache:v},np(a),Wi(a,pn,v)):((s.lanes&c)!==0&&(rp(s,a),Kc(a,null,null,c),Qc()),v=s.memoizedState,E=a.memoizedState,v.parent!==m?(v={parent:m,cache:m},a.memoizedState=v,a.lanes===0&&(a.memoizedState=a.updateQueue.baseState=v),Wi(a,pn,m)):(m=E.cache,Wi(a,pn,m),m!==v.cache&&Xm(a,[pn],c,!0))),zn(s,a,a.pendingProps.children,c),a.child;case 29:throw a.pendingProps}throw Error(r(156,a.tag))}function li(s){s.flags|=4}function zp(s,a,c,m,v){if((a=(s.mode&32)!==0)&&(a=!1),a){if(s.flags|=16777216,(v&335544128)===v)if(s.stateNode.complete)s.flags|=8192;else if(wv())s.flags|=8192;else throw po=Yd,tp}else s.flags&=-16777217}function Yb(s,a){if(a.type!=="stylesheet"||(a.state.loading&4)!==0)s.flags&=-16777217;else if(s.flags|=16777216,!dx(a))if(wv())s.flags|=8192;else throw po=Yd,tp}function fh(s,a){a!==null&&(s.flags|=4),s.flags&16384&&(a=s.tag!==22?bd():536870912,s.lanes|=a,Cl|=a)}function tu(s,a){if(!_t)switch(s.tailMode){case"hidden":a=s.tail;for(var c=null;a!==null;)a.alternate!==null&&(c=a),a=a.sibling;c===null?s.tail=null:c.sibling=null;break;case"collapsed":c=s.tail;for(var m=null;c!==null;)c.alternate!==null&&(m=c),c=c.sibling;m===null?a||s.tail===null?s.tail=null:s.tail.sibling=null:m.sibling=null}}function qt(s){var a=s.alternate!==null&&s.alternate.child===s.child,c=0,m=0;if(a)for(var v=s.child;v!==null;)c|=v.lanes|v.childLanes,m|=v.subtreeFlags&65011712,m|=v.flags&65011712,v.return=s,v=v.sibling;else for(v=s.child;v!==null;)c|=v.lanes|v.childLanes,m|=v.subtreeFlags,m|=v.flags,v.return=s,v=v.sibling;return s.subtreeFlags|=m,s.childLanes=c,a}function QA(s,a,c){var m=a.pendingProps;switch(Gm(a),a.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return qt(a),null;case 1:return qt(a),null;case 3:return c=a.stateNode,m=null,s!==null&&(m=s.memoizedState.cache),a.memoizedState.cache!==m&&(a.flags|=2048),si(pn),be(),c.pendingContext&&(c.context=c.pendingContext,c.pendingContext=null),(s===null||s.child===null)&&(hl(a)?li(a):s===null||s.memoizedState.isDehydrated&&(a.flags&256)===0||(a.flags|=1024,Qm())),qt(a),null;case 26:var v=a.type,E=a.memoizedState;return s===null?(li(a),E!==null?(qt(a),Yb(a,E)):(qt(a),zp(a,v,null,m,c))):E?E!==s.memoizedState?(li(a),qt(a),Yb(a,E)):(qt(a),a.flags&=-16777217):(s=s.memoizedProps,s!==m&&li(a),qt(a),zp(a,v,s,m,c)),null;case 27:if(ze(a),c=he.current,v=a.type,s!==null&&a.stateNode!=null)s.memoizedProps!==m&&li(a);else{if(!m){if(a.stateNode===null)throw Error(r(166));return qt(a),null}s=ne.current,hl(a)?R_(a):(s=rx(v,m,c),a.stateNode=s,li(a))}return qt(a),null;case 5:if(ze(a),v=a.type,s!==null&&a.stateNode!=null)s.memoizedProps!==m&&li(a);else{if(!m){if(a.stateNode===null)throw Error(r(166));return qt(a),null}if(E=ne.current,hl(a))R_(a);else{var P=jh(he.current);switch(E){case 1:E=P.createElementNS("http://www.w3.org/2000/svg",v);break;case 2:E=P.createElementNS("http://www.w3.org/1998/Math/MathML",v);break;default:switch(v){case"svg":E=P.createElementNS("http://www.w3.org/2000/svg",v);break;case"math":E=P.createElementNS("http://www.w3.org/1998/Math/MathML",v);break;case"script":E=P.createElement("div"),E.innerHTML="<script><\/script>",E=E.removeChild(E.firstChild);break;case"select":E=typeof m.is=="string"?P.createElement("select",{is:m.is}):P.createElement("select"),m.multiple?E.multiple=!0:m.size&&(E.size=m.size);break;default:E=typeof m.is=="string"?P.createElement(v,{is:m.is}):P.createElement(v)}}E[hn]=a,E[In]=m;e:for(P=a.child;P!==null;){if(P.tag===5||P.tag===6)E.appendChild(P.stateNode);else if(P.tag!==4&&P.tag!==27&&P.child!==null){P.child.return=P,P=P.child;continue}if(P===a)break e;for(;P.sibling===null;){if(P.return===null||P.return===a)break e;P=P.return}P.sibling.return=P.return,P=P.sibling}a.stateNode=E;e:switch(Ln(E,v,m),v){case"button":case"input":case"select":case"textarea":m=!!m.autoFocus;break e;case"img":m=!0;break e;default:m=!1}m&&li(a)}}return qt(a),zp(a,a.type,s===null?null:s.memoizedProps,a.pendingProps,c),null;case 6:if(s&&a.stateNode!=null)s.memoizedProps!==m&&li(a);else{if(typeof m!="string"&&a.stateNode===null)throw Error(r(166));if(s=he.current,hl(a)){if(s=a.stateNode,c=a.memoizedProps,m=null,v=Pn,v!==null)switch(v.tag){case 27:case 5:m=v.memoizedProps}s[hn]=a,s=!!(s.nodeValue===c||m!==null&&m.suppressHydrationWarning===!0||Gv(s.nodeValue,c)),s||Gi(a,!0)}else s=jh(s).createTextNode(m),s[hn]=a,a.stateNode=s}return qt(a),null;case 31:if(c=a.memoizedState,s===null||s.memoizedState!==null){if(m=hl(a),c!==null){if(s===null){if(!m)throw Error(r(318));if(s=a.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(r(557));s[hn]=a}else co(),(a.flags&128)===0&&(a.memoizedState=null),a.flags|=4;qt(a),s=!1}else c=Qm(),s!==null&&s.memoizedState!==null&&(s.memoizedState.hydrationErrors=c),s=!0;if(!s)return a.flags&256?(Ar(a),a):(Ar(a),null);if((a.flags&128)!==0)throw Error(r(558))}return qt(a),null;case 13:if(m=a.memoizedState,s===null||s.memoizedState!==null&&s.memoizedState.dehydrated!==null){if(v=hl(a),m!==null&&m.dehydrated!==null){if(s===null){if(!v)throw Error(r(318));if(v=a.memoizedState,v=v!==null?v.dehydrated:null,!v)throw Error(r(317));v[hn]=a}else co(),(a.flags&128)===0&&(a.memoizedState=null),a.flags|=4;qt(a),v=!1}else v=Qm(),s!==null&&s.memoizedState!==null&&(s.memoizedState.hydrationErrors=v),v=!0;if(!v)return a.flags&256?(Ar(a),a):(Ar(a),null)}return Ar(a),(a.flags&128)!==0?(a.lanes=c,a):(c=m!==null,s=s!==null&&s.memoizedState!==null,c&&(m=a.child,v=null,m.alternate!==null&&m.alternate.memoizedState!==null&&m.alternate.memoizedState.cachePool!==null&&(v=m.alternate.memoizedState.cachePool.pool),E=null,m.memoizedState!==null&&m.memoizedState.cachePool!==null&&(E=m.memoizedState.cachePool.pool),E!==v&&(m.flags|=2048)),c!==s&&c&&(a.child.flags|=8192),fh(a,a.updateQueue),qt(a),null);case 4:return be(),s===null&&ag(a.stateNode.containerInfo),qt(a),null;case 10:return si(a.type),qt(a),null;case 19:if(H(on),m=a.memoizedState,m===null)return qt(a),null;if(v=(a.flags&128)!==0,E=m.rendering,E===null)if(v)tu(m,!1);else{if(sn!==0||s!==null&&(s.flags&128)!==0)for(s=a.child;s!==null;){if(E=eh(s),E!==null){for(a.flags|=128,tu(m,!1),s=E.updateQueue,a.updateQueue=s,fh(a,s),a.subtreeFlags=0,s=c,c=a.child;c!==null;)E_(c,s),c=c.sibling;return re(on,on.current&1|2),_t&&ni(a,m.treeForkCount),a.child}s=s.sibling}m.tail!==null&&Ne()>_h&&(a.flags|=128,v=!0,tu(m,!1),a.lanes=4194304)}else{if(!v)if(s=eh(E),s!==null){if(a.flags|=128,v=!0,s=s.updateQueue,a.updateQueue=s,fh(a,s),tu(m,!0),m.tail===null&&m.tailMode==="hidden"&&!E.alternate&&!_t)return qt(a),null}else 2*Ne()-m.renderingStartTime>_h&&c!==536870912&&(a.flags|=128,v=!0,tu(m,!1),a.lanes=4194304);m.isBackwards?(E.sibling=a.child,a.child=E):(s=m.last,s!==null?s.sibling=E:a.child=E,m.last=E)}return m.tail!==null?(s=m.tail,m.rendering=s,m.tail=s.sibling,m.renderingStartTime=Ne(),s.sibling=null,c=on.current,re(on,v?c&1|2:c&1),_t&&ni(a,m.treeForkCount),s):(qt(a),null);case 22:case 23:return Ar(a),op(),m=a.memoizedState!==null,s!==null?s.memoizedState!==null!==m&&(a.flags|=8192):m&&(a.flags|=8192),m?(c&536870912)!==0&&(a.flags&128)===0&&(qt(a),a.subtreeFlags&6&&(a.flags|=8192)):qt(a),c=a.updateQueue,c!==null&&fh(a,c.retryQueue),c=null,s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(c=s.memoizedState.cachePool.pool),m=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(m=a.memoizedState.cachePool.pool),m!==c&&(a.flags|=2048),s!==null&&H(fo),null;case 24:return c=null,s!==null&&(c=s.memoizedState.cache),a.memoizedState.cache!==c&&(a.flags|=2048),si(pn),qt(a),null;case 25:return null;case 30:return null}throw Error(r(156,a.tag))}function KA(s,a){switch(Gm(a),a.tag){case 1:return s=a.flags,s&65536?(a.flags=s&-65537|128,a):null;case 3:return si(pn),be(),s=a.flags,(s&65536)!==0&&(s&128)===0?(a.flags=s&-65537|128,a):null;case 26:case 27:case 5:return ze(a),null;case 31:if(a.memoizedState!==null){if(Ar(a),a.alternate===null)throw Error(r(340));co()}return s=a.flags,s&65536?(a.flags=s&-65537|128,a):null;case 13:if(Ar(a),s=a.memoizedState,s!==null&&s.dehydrated!==null){if(a.alternate===null)throw Error(r(340));co()}return s=a.flags,s&65536?(a.flags=s&-65537|128,a):null;case 19:return H(on),null;case 4:return be(),null;case 10:return si(a.type),null;case 22:case 23:return Ar(a),op(),s!==null&&H(fo),s=a.flags,s&65536?(a.flags=s&-65537|128,a):null;case 24:return si(pn),null;case 25:return null;default:return null}}function Xb(s,a){switch(Gm(a),a.tag){case 3:si(pn),be();break;case 26:case 27:case 5:ze(a);break;case 4:be();break;case 31:a.memoizedState!==null&&Ar(a);break;case 13:Ar(a);break;case 19:H(on);break;case 10:si(a.type);break;case 22:case 23:Ar(a),op(),s!==null&&H(fo);break;case 24:si(pn)}}function nu(s,a){try{var c=a.updateQueue,m=c!==null?c.lastEffect:null;if(m!==null){var v=m.next;c=v;do{if((c.tag&s)===s){m=void 0;var E=c.create,P=c.inst;m=E(),P.destroy=m}c=c.next}while(c!==v)}}catch(W){It(a,a.return,W)}}function Ji(s,a,c){try{var m=a.updateQueue,v=m!==null?m.lastEffect:null;if(v!==null){var E=v.next;m=E;do{if((m.tag&s)===s){var P=m.inst,W=P.destroy;if(W!==void 0){P.destroy=void 0,v=a;var se=c,pe=W;try{pe()}catch(Te){It(v,se,Te)}}}m=m.next}while(m!==E)}}catch(Te){It(a,a.return,Te)}}function Zb(s){var a=s.updateQueue;if(a!==null){var c=s.stateNode;try{V_(a,c)}catch(m){It(s,s.return,m)}}}function Jb(s,a,c){c.props=_o(s.type,s.memoizedProps),c.state=s.memoizedState;try{c.componentWillUnmount()}catch(m){It(s,a,m)}}function ru(s,a){try{var c=s.ref;if(c!==null){switch(s.tag){case 26:case 27:case 5:var m=s.stateNode;break;case 30:m=s.stateNode;break;default:m=s.stateNode}typeof c=="function"?s.refCleanup=c(m):c.current=m}}catch(v){It(s,a,v)}}function Ps(s,a){var c=s.ref,m=s.refCleanup;if(c!==null)if(typeof m=="function")try{m()}catch(v){It(s,a,v)}finally{s.refCleanup=null,s=s.alternate,s!=null&&(s.refCleanup=null)}else if(typeof c=="function")try{c(null)}catch(v){It(s,a,v)}else c.current=null}function ev(s){var a=s.type,c=s.memoizedProps,m=s.stateNode;try{e:switch(a){case"button":case"input":case"select":case"textarea":c.autoFocus&&m.focus();break e;case"img":c.src?m.src=c.src:c.srcSet&&(m.srcset=c.srcSet)}}catch(v){It(s,s.return,v)}}function Lp(s,a,c){try{var m=s.stateNode;y2(m,s.type,c,a),m[In]=a}catch(v){It(s,s.return,v)}}function tv(s){return s.tag===5||s.tag===3||s.tag===26||s.tag===27&&aa(s.type)||s.tag===4}function Up(s){e:for(;;){for(;s.sibling===null;){if(s.return===null||tv(s.return))return null;s=s.return}for(s.sibling.return=s.return,s=s.sibling;s.tag!==5&&s.tag!==6&&s.tag!==18;){if(s.tag===27&&aa(s.type)||s.flags&2||s.child===null||s.tag===4)continue e;s.child.return=s,s=s.child}if(!(s.flags&2))return s.stateNode}}function Fp(s,a,c){var m=s.tag;if(m===5||m===6)s=s.stateNode,a?(c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c).insertBefore(s,a):(a=c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c,a.appendChild(s),c=c._reactRootContainer,c!=null||a.onclick!==null||(a.onclick=es));else if(m!==4&&(m===27&&aa(s.type)&&(c=s.stateNode,a=null),s=s.child,s!==null))for(Fp(s,a,c),s=s.sibling;s!==null;)Fp(s,a,c),s=s.sibling}function mh(s,a,c){var m=s.tag;if(m===5||m===6)s=s.stateNode,a?c.insertBefore(s,a):c.appendChild(s);else if(m!==4&&(m===27&&aa(s.type)&&(c=s.stateNode),s=s.child,s!==null))for(mh(s,a,c),s=s.sibling;s!==null;)mh(s,a,c),s=s.sibling}function nv(s){var a=s.stateNode,c=s.memoizedProps;try{for(var m=s.type,v=a.attributes;v.length;)a.removeAttributeNode(v[0]);Ln(a,m,c),a[hn]=s,a[In]=c}catch(E){It(s,s.return,E)}}var ci=!1,_n=!1,Vp=!1,rv=typeof WeakSet=="function"?WeakSet:Set,kn=null;function YA(s,a){if(s=s.containerInfo,cg=Nh,s=p_(s),Nm(s)){if("selectionStart"in s)var c={start:s.selectionStart,end:s.selectionEnd};else e:{c=(c=s.ownerDocument)&&c.defaultView||window;var m=c.getSelection&&c.getSelection();if(m&&m.rangeCount!==0){c=m.anchorNode;var v=m.anchorOffset,E=m.focusNode;m=m.focusOffset;try{c.nodeType,E.nodeType}catch{c=null;break e}var P=0,W=-1,se=-1,pe=0,Te=0,De=s,_e=null;t:for(;;){for(var xe;De!==c||v!==0&&De.nodeType!==3||(W=P+v),De!==E||m!==0&&De.nodeType!==3||(se=P+m),De.nodeType===3&&(P+=De.nodeValue.length),(xe=De.firstChild)!==null;)_e=De,De=xe;for(;;){if(De===s)break t;if(_e===c&&++pe===v&&(W=P),_e===E&&++Te===m&&(se=P),(xe=De.nextSibling)!==null)break;De=_e,_e=De.parentNode}De=xe}c=W===-1||se===-1?null:{start:W,end:se}}else c=null}c=c||{start:0,end:0}}else c=null;for(ug={focusedElem:s,selectionRange:c},Nh=!1,kn=a;kn!==null;)if(a=kn,s=a.child,(a.subtreeFlags&1028)!==0&&s!==null)s.return=a,kn=s;else for(;kn!==null;){switch(a=kn,E=a.alternate,s=a.flags,a.tag){case 0:if((s&4)!==0&&(s=a.updateQueue,s=s!==null?s.events:null,s!==null))for(c=0;c<s.length;c++)v=s[c],v.ref.impl=v.nextImpl;break;case 11:case 15:break;case 1:if((s&1024)!==0&&E!==null){s=void 0,c=a,v=E.memoizedProps,E=E.memoizedState,m=c.stateNode;try{var Fe=_o(c.type,v);s=m.getSnapshotBeforeUpdate(Fe,E),m.__reactInternalSnapshotBeforeUpdate=s}catch(Qe){It(c,c.return,Qe)}}break;case 3:if((s&1024)!==0){if(s=a.stateNode.containerInfo,c=s.nodeType,c===9)fg(s);else if(c===1)switch(s.nodeName){case"HEAD":case"HTML":case"BODY":fg(s);break;default:s.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((s&1024)!==0)throw Error(r(163))}if(s=a.sibling,s!==null){s.return=a.return,kn=s;break}kn=a.return}}function sv(s,a,c){var m=c.flags;switch(c.tag){case 0:case 11:case 15:di(s,c),m&4&&nu(5,c);break;case 1:if(di(s,c),m&4)if(s=c.stateNode,a===null)try{s.componentDidMount()}catch(P){It(c,c.return,P)}else{var v=_o(c.type,a.memoizedProps);a=a.memoizedState;try{s.componentDidUpdate(v,a,s.__reactInternalSnapshotBeforeUpdate)}catch(P){It(c,c.return,P)}}m&64&&Zb(c),m&512&&ru(c,c.return);break;case 3:if(di(s,c),m&64&&(s=c.updateQueue,s!==null)){if(a=null,c.child!==null)switch(c.child.tag){case 27:case 5:a=c.child.stateNode;break;case 1:a=c.child.stateNode}try{V_(s,a)}catch(P){It(c,c.return,P)}}break;case 27:a===null&&m&4&&nv(c);case 26:case 5:di(s,c),a===null&&m&4&&ev(c),m&512&&ru(c,c.return);break;case 12:di(s,c);break;case 31:di(s,c),m&4&&ov(s,c);break;case 13:di(s,c),m&4&&lv(s,c),m&64&&(s=c.memoizedState,s!==null&&(s=s.dehydrated,s!==null&&(c=i2.bind(null,c),C2(s,c))));break;case 22:if(m=c.memoizedState!==null||ci,!m){a=a!==null&&a.memoizedState!==null||_n,v=ci;var E=_n;ci=m,(_n=a)&&!E?hi(s,c,(c.subtreeFlags&8772)!==0):di(s,c),ci=v,_n=E}break;case 30:break;default:di(s,c)}}function iv(s){var a=s.alternate;a!==null&&(s.alternate=null,iv(a)),s.child=null,s.deletions=null,s.sibling=null,s.tag===5&&(a=s.stateNode,a!==null&&Ko(a)),s.stateNode=null,s.return=null,s.dependencies=null,s.memoizedProps=null,s.memoizedState=null,s.pendingProps=null,s.stateNode=null,s.updateQueue=null}var Qt=null,hr=!1;function ui(s,a,c){for(c=c.child;c!==null;)av(s,a,c),c=c.sibling}function av(s,a,c){if(nn&&typeof nn.onCommitFiberUnmount=="function")try{nn.onCommitFiberUnmount(vt,c)}catch{}switch(c.tag){case 26:_n||Ps(c,a),ui(s,a,c),c.memoizedState?c.memoizedState.count--:c.stateNode&&(c=c.stateNode,c.parentNode.removeChild(c));break;case 27:_n||Ps(c,a);var m=Qt,v=hr;aa(c.type)&&(Qt=c.stateNode,hr=!1),ui(s,a,c),hu(c.stateNode),Qt=m,hr=v;break;case 5:_n||Ps(c,a);case 6:if(m=Qt,v=hr,Qt=null,ui(s,a,c),Qt=m,hr=v,Qt!==null)if(hr)try{(Qt.nodeType===9?Qt.body:Qt.nodeName==="HTML"?Qt.ownerDocument.body:Qt).removeChild(c.stateNode)}catch(E){It(c,a,E)}else try{Qt.removeChild(c.stateNode)}catch(E){It(c,a,E)}break;case 18:Qt!==null&&(hr?(s=Qt,Zv(s.nodeType===9?s.body:s.nodeName==="HTML"?s.ownerDocument.body:s,c.stateNode),Ml(s)):Zv(Qt,c.stateNode));break;case 4:m=Qt,v=hr,Qt=c.stateNode.containerInfo,hr=!0,ui(s,a,c),Qt=m,hr=v;break;case 0:case 11:case 14:case 15:Ji(2,c,a),_n||Ji(4,c,a),ui(s,a,c);break;case 1:_n||(Ps(c,a),m=c.stateNode,typeof m.componentWillUnmount=="function"&&Jb(c,a,m)),ui(s,a,c);break;case 21:ui(s,a,c);break;case 22:_n=(m=_n)||c.memoizedState!==null,ui(s,a,c),_n=m;break;default:ui(s,a,c)}}function ov(s,a){if(a.memoizedState===null&&(s=a.alternate,s!==null&&(s=s.memoizedState,s!==null))){s=s.dehydrated;try{Ml(s)}catch(c){It(a,a.return,c)}}}function lv(s,a){if(a.memoizedState===null&&(s=a.alternate,s!==null&&(s=s.memoizedState,s!==null&&(s=s.dehydrated,s!==null))))try{Ml(s)}catch(c){It(a,a.return,c)}}function XA(s){switch(s.tag){case 31:case 13:case 19:var a=s.stateNode;return a===null&&(a=s.stateNode=new rv),a;case 22:return s=s.stateNode,a=s._retryCache,a===null&&(a=s._retryCache=new rv),a;default:throw Error(r(435,s.tag))}}function ph(s,a){var c=XA(s);a.forEach(function(m){if(!c.has(m)){c.add(m);var v=a2.bind(null,s,m);m.then(v,v)}})}function fr(s,a){var c=a.deletions;if(c!==null)for(var m=0;m<c.length;m++){var v=c[m],E=s,P=a,W=P;e:for(;W!==null;){switch(W.tag){case 27:if(aa(W.type)){Qt=W.stateNode,hr=!1;break e}break;case 5:Qt=W.stateNode,hr=!1;break e;case 3:case 4:Qt=W.stateNode.containerInfo,hr=!0;break e}W=W.return}if(Qt===null)throw Error(r(160));av(E,P,v),Qt=null,hr=!1,E=v.alternate,E!==null&&(E.return=null),v.return=null}if(a.subtreeFlags&13886)for(a=a.child;a!==null;)cv(a,s),a=a.sibling}var as=null;function cv(s,a){var c=s.alternate,m=s.flags;switch(s.tag){case 0:case 11:case 14:case 15:fr(a,s),mr(s),m&4&&(Ji(3,s,s.return),nu(3,s),Ji(5,s,s.return));break;case 1:fr(a,s),mr(s),m&512&&(_n||c===null||Ps(c,c.return)),m&64&&ci&&(s=s.updateQueue,s!==null&&(m=s.callbacks,m!==null&&(c=s.shared.hiddenCallbacks,s.shared.hiddenCallbacks=c===null?m:c.concat(m))));break;case 26:var v=as;if(fr(a,s),mr(s),m&512&&(_n||c===null||Ps(c,c.return)),m&4){var E=c!==null?c.memoizedState:null;if(m=s.memoizedState,c===null)if(m===null)if(s.stateNode===null){e:{m=s.type,c=s.memoizedProps,v=v.ownerDocument||v;t:switch(m){case"title":E=v.getElementsByTagName("title")[0],(!E||E[ws]||E[hn]||E.namespaceURI==="http://www.w3.org/2000/svg"||E.hasAttribute("itemprop"))&&(E=v.createElement(m),v.head.insertBefore(E,v.querySelector("head > title"))),Ln(E,m,c),E[hn]=s,fn(E),m=E;break e;case"link":var P=cx("link","href",v).get(m+(c.href||""));if(P){for(var W=0;W<P.length;W++)if(E=P[W],E.getAttribute("href")===(c.href==null||c.href===""?null:c.href)&&E.getAttribute("rel")===(c.rel==null?null:c.rel)&&E.getAttribute("title")===(c.title==null?null:c.title)&&E.getAttribute("crossorigin")===(c.crossOrigin==null?null:c.crossOrigin)){P.splice(W,1);break t}}E=v.createElement(m),Ln(E,m,c),v.head.appendChild(E);break;case"meta":if(P=cx("meta","content",v).get(m+(c.content||""))){for(W=0;W<P.length;W++)if(E=P[W],E.getAttribute("content")===(c.content==null?null:""+c.content)&&E.getAttribute("name")===(c.name==null?null:c.name)&&E.getAttribute("property")===(c.property==null?null:c.property)&&E.getAttribute("http-equiv")===(c.httpEquiv==null?null:c.httpEquiv)&&E.getAttribute("charset")===(c.charSet==null?null:c.charSet)){P.splice(W,1);break t}}E=v.createElement(m),Ln(E,m,c),v.head.appendChild(E);break;default:throw Error(r(468,m))}E[hn]=s,fn(E),m=E}s.stateNode=m}else ux(v,s.type,s.stateNode);else s.stateNode=lx(v,m,s.memoizedProps);else E!==m?(E===null?c.stateNode!==null&&(c=c.stateNode,c.parentNode.removeChild(c)):E.count--,m===null?ux(v,s.type,s.stateNode):lx(v,m,s.memoizedProps)):m===null&&s.stateNode!==null&&Lp(s,s.memoizedProps,c.memoizedProps)}break;case 27:fr(a,s),mr(s),m&512&&(_n||c===null||Ps(c,c.return)),c!==null&&m&4&&Lp(s,s.memoizedProps,c.memoizedProps);break;case 5:if(fr(a,s),mr(s),m&512&&(_n||c===null||Ps(c,c.return)),s.flags&32){v=s.stateNode;try{dr(v,"")}catch(Fe){It(s,s.return,Fe)}}m&4&&s.stateNode!=null&&(v=s.memoizedProps,Lp(s,v,c!==null?c.memoizedProps:v)),m&1024&&(Vp=!0);break;case 6:if(fr(a,s),mr(s),m&4){if(s.stateNode===null)throw Error(r(162));m=s.memoizedProps,c=s.stateNode;try{c.nodeValue=m}catch(Fe){It(s,s.return,Fe)}}break;case 3:if(Dh=null,v=as,as=Rh(a.containerInfo),fr(a,s),as=v,mr(s),m&4&&c!==null&&c.memoizedState.isDehydrated)try{Ml(a.containerInfo)}catch(Fe){It(s,s.return,Fe)}Vp&&(Vp=!1,uv(s));break;case 4:m=as,as=Rh(s.stateNode.containerInfo),fr(a,s),mr(s),as=m;break;case 12:fr(a,s),mr(s);break;case 31:fr(a,s),mr(s),m&4&&(m=s.updateQueue,m!==null&&(s.updateQueue=null,ph(s,m)));break;case 13:fr(a,s),mr(s),s.child.flags&8192&&s.memoizedState!==null!=(c!==null&&c.memoizedState!==null)&&(yh=Ne()),m&4&&(m=s.updateQueue,m!==null&&(s.updateQueue=null,ph(s,m)));break;case 22:v=s.memoizedState!==null;var se=c!==null&&c.memoizedState!==null,pe=ci,Te=_n;if(ci=pe||v,_n=Te||se,fr(a,s),_n=Te,ci=pe,mr(s),m&8192)e:for(a=s.stateNode,a._visibility=v?a._visibility&-2:a._visibility|1,v&&(c===null||se||ci||_n||bo(s)),c=null,a=s;;){if(a.tag===5||a.tag===26){if(c===null){se=c=a;try{if(E=se.stateNode,v)P=E.style,typeof P.setProperty=="function"?P.setProperty("display","none","important"):P.display="none";else{W=se.stateNode;var De=se.memoizedProps.style,_e=De!=null&&De.hasOwnProperty("display")?De.display:null;W.style.display=_e==null||typeof _e=="boolean"?"":(""+_e).trim()}}catch(Fe){It(se,se.return,Fe)}}}else if(a.tag===6){if(c===null){se=a;try{se.stateNode.nodeValue=v?"":se.memoizedProps}catch(Fe){It(se,se.return,Fe)}}}else if(a.tag===18){if(c===null){se=a;try{var xe=se.stateNode;v?Jv(xe,!0):Jv(se.stateNode,!1)}catch(Fe){It(se,se.return,Fe)}}}else if((a.tag!==22&&a.tag!==23||a.memoizedState===null||a===s)&&a.child!==null){a.child.return=a,a=a.child;continue}if(a===s)break e;for(;a.sibling===null;){if(a.return===null||a.return===s)break e;c===a&&(c=null),a=a.return}c===a&&(c=null),a.sibling.return=a.return,a=a.sibling}m&4&&(m=s.updateQueue,m!==null&&(c=m.retryQueue,c!==null&&(m.retryQueue=null,ph(s,c))));break;case 19:fr(a,s),mr(s),m&4&&(m=s.updateQueue,m!==null&&(s.updateQueue=null,ph(s,m)));break;case 30:break;case 21:break;default:fr(a,s),mr(s)}}function mr(s){var a=s.flags;if(a&2){try{for(var c,m=s.return;m!==null;){if(tv(m)){c=m;break}m=m.return}if(c==null)throw Error(r(160));switch(c.tag){case 27:var v=c.stateNode,E=Up(s);mh(s,E,v);break;case 5:var P=c.stateNode;c.flags&32&&(dr(P,""),c.flags&=-33);var W=Up(s);mh(s,W,P);break;case 3:case 4:var se=c.stateNode.containerInfo,pe=Up(s);Fp(s,pe,se);break;default:throw Error(r(161))}}catch(Te){It(s,s.return,Te)}s.flags&=-3}a&4096&&(s.flags&=-4097)}function uv(s){if(s.subtreeFlags&1024)for(s=s.child;s!==null;){var a=s;uv(a),a.tag===5&&a.flags&1024&&a.stateNode.reset(),s=s.sibling}}function di(s,a){if(a.subtreeFlags&8772)for(a=a.child;a!==null;)sv(s,a.alternate,a),a=a.sibling}function bo(s){for(s=s.child;s!==null;){var a=s;switch(a.tag){case 0:case 11:case 14:case 15:Ji(4,a,a.return),bo(a);break;case 1:Ps(a,a.return);var c=a.stateNode;typeof c.componentWillUnmount=="function"&&Jb(a,a.return,c),bo(a);break;case 27:hu(a.stateNode);case 26:case 5:Ps(a,a.return),bo(a);break;case 22:a.memoizedState===null&&bo(a);break;case 30:bo(a);break;default:bo(a)}s=s.sibling}}function hi(s,a,c){for(c=c&&(a.subtreeFlags&8772)!==0,a=a.child;a!==null;){var m=a.alternate,v=s,E=a,P=E.flags;switch(E.tag){case 0:case 11:case 15:hi(v,E,c),nu(4,E);break;case 1:if(hi(v,E,c),m=E,v=m.stateNode,typeof v.componentDidMount=="function")try{v.componentDidMount()}catch(pe){It(m,m.return,pe)}if(m=E,v=m.updateQueue,v!==null){var W=m.stateNode;try{var se=v.shared.hiddenCallbacks;if(se!==null)for(v.shared.hiddenCallbacks=null,v=0;v<se.length;v++)F_(se[v],W)}catch(pe){It(m,m.return,pe)}}c&&P&64&&Zb(E),ru(E,E.return);break;case 27:nv(E);case 26:case 5:hi(v,E,c),c&&m===null&&P&4&&ev(E),ru(E,E.return);break;case 12:hi(v,E,c);break;case 31:hi(v,E,c),c&&P&4&&ov(v,E);break;case 13:hi(v,E,c),c&&P&4&&lv(v,E);break;case 22:E.memoizedState===null&&hi(v,E,c),ru(E,E.return);break;case 30:break;default:hi(v,E,c)}a=a.sibling}}function $p(s,a){var c=null;s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(c=s.memoizedState.cachePool.pool),s=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(s=a.memoizedState.cachePool.pool),s!==c&&(s!=null&&s.refCount++,c!=null&&$c(c))}function qp(s,a){s=null,a.alternate!==null&&(s=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==s&&(a.refCount++,s!=null&&$c(s))}function os(s,a,c,m){if(a.subtreeFlags&10256)for(a=a.child;a!==null;)dv(s,a,c,m),a=a.sibling}function dv(s,a,c,m){var v=a.flags;switch(a.tag){case 0:case 11:case 15:os(s,a,c,m),v&2048&&nu(9,a);break;case 1:os(s,a,c,m);break;case 3:os(s,a,c,m),v&2048&&(s=null,a.alternate!==null&&(s=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==s&&(a.refCount++,s!=null&&$c(s)));break;case 12:if(v&2048){os(s,a,c,m),s=a.stateNode;try{var E=a.memoizedProps,P=E.id,W=E.onPostCommit;typeof W=="function"&&W(P,a.alternate===null?"mount":"update",s.passiveEffectDuration,-0)}catch(se){It(a,a.return,se)}}else os(s,a,c,m);break;case 31:os(s,a,c,m);break;case 13:os(s,a,c,m);break;case 23:break;case 22:E=a.stateNode,P=a.alternate,a.memoizedState!==null?E._visibility&2?os(s,a,c,m):su(s,a):E._visibility&2?os(s,a,c,m):(E._visibility|=2,wl(s,a,c,m,(a.subtreeFlags&10256)!==0||!1)),v&2048&&$p(P,a);break;case 24:os(s,a,c,m),v&2048&&qp(a.alternate,a);break;default:os(s,a,c,m)}}function wl(s,a,c,m,v){for(v=v&&((a.subtreeFlags&10256)!==0||!1),a=a.child;a!==null;){var E=s,P=a,W=c,se=m,pe=P.flags;switch(P.tag){case 0:case 11:case 15:wl(E,P,W,se,v),nu(8,P);break;case 23:break;case 22:var Te=P.stateNode;P.memoizedState!==null?Te._visibility&2?wl(E,P,W,se,v):su(E,P):(Te._visibility|=2,wl(E,P,W,se,v)),v&&pe&2048&&$p(P.alternate,P);break;case 24:wl(E,P,W,se,v),v&&pe&2048&&qp(P.alternate,P);break;default:wl(E,P,W,se,v)}a=a.sibling}}function su(s,a){if(a.subtreeFlags&10256)for(a=a.child;a!==null;){var c=s,m=a,v=m.flags;switch(m.tag){case 22:su(c,m),v&2048&&$p(m.alternate,m);break;case 24:su(c,m),v&2048&&qp(m.alternate,m);break;default:su(c,m)}a=a.sibling}}var iu=8192;function Sl(s,a,c){if(s.subtreeFlags&iu)for(s=s.child;s!==null;)hv(s,a,c),s=s.sibling}function hv(s,a,c){switch(s.tag){case 26:Sl(s,a,c),s.flags&iu&&s.memoizedState!==null&&B2(c,as,s.memoizedState,s.memoizedProps);break;case 5:Sl(s,a,c);break;case 3:case 4:var m=as;as=Rh(s.stateNode.containerInfo),Sl(s,a,c),as=m;break;case 22:s.memoizedState===null&&(m=s.alternate,m!==null&&m.memoizedState!==null?(m=iu,iu=16777216,Sl(s,a,c),iu=m):Sl(s,a,c));break;default:Sl(s,a,c)}}function fv(s){var a=s.alternate;if(a!==null&&(s=a.child,s!==null)){a.child=null;do a=s.sibling,s.sibling=null,s=a;while(s!==null)}}function au(s){var a=s.deletions;if((s.flags&16)!==0){if(a!==null)for(var c=0;c<a.length;c++){var m=a[c];kn=m,pv(m,s)}fv(s)}if(s.subtreeFlags&10256)for(s=s.child;s!==null;)mv(s),s=s.sibling}function mv(s){switch(s.tag){case 0:case 11:case 15:au(s),s.flags&2048&&Ji(9,s,s.return);break;case 3:au(s);break;case 12:au(s);break;case 22:var a=s.stateNode;s.memoizedState!==null&&a._visibility&2&&(s.return===null||s.return.tag!==13)?(a._visibility&=-3,gh(s)):au(s);break;default:au(s)}}function gh(s){var a=s.deletions;if((s.flags&16)!==0){if(a!==null)for(var c=0;c<a.length;c++){var m=a[c];kn=m,pv(m,s)}fv(s)}for(s=s.child;s!==null;){switch(a=s,a.tag){case 0:case 11:case 15:Ji(8,a,a.return),gh(a);break;case 22:c=a.stateNode,c._visibility&2&&(c._visibility&=-3,gh(a));break;default:gh(a)}s=s.sibling}}function pv(s,a){for(;kn!==null;){var c=kn;switch(c.tag){case 0:case 11:case 15:Ji(8,c,a);break;case 23:case 22:if(c.memoizedState!==null&&c.memoizedState.cachePool!==null){var m=c.memoizedState.cachePool.pool;m!=null&&m.refCount++}break;case 24:$c(c.memoizedState.cache)}if(m=c.child,m!==null)m.return=c,kn=m;else e:for(c=s;kn!==null;){m=kn;var v=m.sibling,E=m.return;if(iv(m),m===c){kn=null;break e}if(v!==null){v.return=E,kn=v;break e}kn=E}}}var ZA={getCacheForType:function(s){var a=Bn(pn),c=a.data.get(s);return c===void 0&&(c=s(),a.data.set(s,c)),c},cacheSignal:function(){return Bn(pn).controller.signal}},JA=typeof WeakMap=="function"?WeakMap:Map,Tt=0,zt=null,ut=null,ft=0,Rt=0,jr=null,ea=!1,El=!1,Hp=!1,fi=0,sn=0,ta=0,vo=0,Gp=0,Rr=0,Cl=0,ou=null,pr=null,Wp=!1,yh=0,gv=0,_h=1/0,bh=null,na=null,Sn=0,ra=null,Tl=null,mi=0,Qp=0,Kp=null,yv=null,lu=0,Yp=null;function Ir(){return(Tt&2)!==0&&ft!==0?ft&-ft:Y.T!==null?ng():vd()}function _v(){if(Rr===0)if((ft&536870912)===0||_t){var s=_s;_s<<=1,(_s&3932160)===0&&(_s=262144),Rr=s}else Rr=536870912;return s=Tr.current,s!==null&&(s.flags|=32),Rr}function gr(s,a,c){(s===zt&&(Rt===2||Rt===9)||s.cancelPendingCommit!==null)&&(Al(s,0),sa(s,ft,Rr,!1)),Wa(s,c),((Tt&2)===0||s!==zt)&&(s===zt&&((Tt&2)===0&&(vo|=c),sn===4&&sa(s,ft,Rr,!1)),Bs(s))}function bv(s,a,c){if((Tt&6)!==0)throw Error(r(327));var m=!c&&(a&127)===0&&(a&s.expiredLanes)===0||Xr(s,a),v=m?n2(s,a):Zp(s,a,!0),E=m;do{if(v===0){El&&!m&&sa(s,a,0,!1);break}else{if(c=s.current.alternate,E&&!e2(c)){v=Zp(s,a,!1),E=!1;continue}if(v===2){if(E=a,s.errorRecoveryDisabledLanes&E)var P=0;else P=s.pendingLanes&-536870913,P=P!==0?P:P&536870912?536870912:0;if(P!==0){a=P;e:{var W=s;v=ou;var se=W.current.memoizedState.isDehydrated;if(se&&(Al(W,P).flags|=256),P=Zp(W,P,!1),P!==2){if(Hp&&!se){W.errorRecoveryDisabledLanes|=E,vo|=E,v=4;break e}E=pr,pr=v,E!==null&&(pr===null?pr=E:pr.push.apply(pr,E))}v=P}if(E=!1,v!==2)continue}}if(v===1){Al(s,0),sa(s,a,0,!0);break}e:{switch(m=s,E=v,E){case 0:case 1:throw Error(r(345));case 4:if((a&4194048)!==a)break;case 6:sa(m,a,Rr,!ea);break e;case 2:pr=null;break;case 3:case 5:break;default:throw Error(r(329))}if((a&62914560)===a&&(v=yh+300-Ne(),10<v)){if(sa(m,a,Rr,!ea),bs(m,0,!0)!==0)break e;mi=a,m.timeoutHandle=Yv(vv.bind(null,m,c,pr,bh,Wp,a,Rr,vo,Cl,ea,E,"Throttled",-0,0),v);break e}vv(m,c,pr,bh,Wp,a,Rr,vo,Cl,ea,E,null,-0,0)}}break}while(!0);Bs(s)}function vv(s,a,c,m,v,E,P,W,se,pe,Te,De,_e,xe){if(s.timeoutHandle=-1,De=a.subtreeFlags,De&8192||(De&16785408)===16785408){De={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:es},hv(a,E,De);var Fe=(E&62914560)===E?yh-Ne():(E&4194048)===E?gv-Ne():0;if(Fe=z2(De,Fe),Fe!==null){mi=E,s.cancelPendingCommit=Fe(jv.bind(null,s,a,E,c,m,v,P,W,se,Te,De,null,_e,xe)),sa(s,E,P,!pe);return}}jv(s,a,E,c,m,v,P,W,se)}function e2(s){for(var a=s;;){var c=a.tag;if((c===0||c===11||c===15)&&a.flags&16384&&(c=a.updateQueue,c!==null&&(c=c.stores,c!==null)))for(var m=0;m<c.length;m++){var v=c[m],E=v.getSnapshot;v=v.value;try{if(!Er(E(),v))return!1}catch{return!1}}if(c=a.child,a.subtreeFlags&16384&&c!==null)c.return=a,a=c;else{if(a===s)break;for(;a.sibling===null;){if(a.return===null||a.return===s)return!0;a=a.return}a.sibling.return=a.return,a=a.sibling}}return!0}function sa(s,a,c,m){a&=~Gp,a&=~vo,s.suspendedLanes|=a,s.pingedLanes&=~a,m&&(s.warmLanes|=a),m=s.expirationTimes;for(var v=a;0<v;){var E=31-Et(v),P=1<<E;m[E]=-1,v&=~P}c!==0&&Qa(s,c,a)}function vh(){return(Tt&6)===0?(cu(0),!1):!0}function Xp(){if(ut!==null){if(Rt===0)var s=ut.return;else s=ut,ri=uo=null,fp(s),yl=null,Hc=0,s=ut;for(;s!==null;)Xb(s.alternate,s),s=s.return;ut=null}}function Al(s,a){var c=s.timeoutHandle;c!==-1&&(s.timeoutHandle=-1,v2(c)),c=s.cancelPendingCommit,c!==null&&(s.cancelPendingCommit=null,c()),mi=0,Xp(),zt=s,ut=c=ti(s.current,null),ft=a,Rt=0,jr=null,ea=!1,El=Xr(s,a),Hp=!1,Cl=Rr=Gp=vo=ta=sn=0,pr=ou=null,Wp=!1,(a&8)!==0&&(a|=a&32);var m=s.entangledLanes;if(m!==0)for(s=s.entanglements,m&=a;0<m;){var v=31-Et(m),E=1<<v;a|=s[v],m&=~E}return fi=a,Fd(),c}function xv(s,a){st=null,Y.H=Jc,a===gl||a===Kd?(a=B_(),Rt=3):a===tp?(a=B_(),Rt=4):Rt=a===Rp?8:a!==null&&typeof a=="object"&&typeof a.then=="function"?6:1,jr=a,ut===null&&(sn=1,ch(s,Ur(a,s.current)))}function wv(){var s=Tr.current;return s===null?!0:(ft&4194048)===ft?qr===null:(ft&62914560)===ft||(ft&536870912)!==0?s===qr:!1}function Sv(){var s=Y.H;return Y.H=Jc,s===null?Jc:s}function Ev(){var s=Y.A;return Y.A=ZA,s}function xh(){sn=4,ea||(ft&4194048)!==ft&&Tr.current!==null||(El=!0),(ta&134217727)===0&&(vo&134217727)===0||zt===null||sa(zt,ft,Rr,!1)}function Zp(s,a,c){var m=Tt;Tt|=2;var v=Sv(),E=Ev();(zt!==s||ft!==a)&&(bh=null,Al(s,a)),a=!1;var P=sn;e:do try{if(Rt!==0&&ut!==null){var W=ut,se=jr;switch(Rt){case 8:Xp(),P=6;break e;case 3:case 2:case 9:case 6:Tr.current===null&&(a=!0);var pe=Rt;if(Rt=0,jr=null,jl(s,W,se,pe),c&&El){P=0;break e}break;default:pe=Rt,Rt=0,jr=null,jl(s,W,se,pe)}}t2(),P=sn;break}catch(Te){xv(s,Te)}while(!0);return a&&s.shellSuspendCounter++,ri=uo=null,Tt=m,Y.H=v,Y.A=E,ut===null&&(zt=null,ft=0,Fd()),P}function t2(){for(;ut!==null;)Cv(ut)}function n2(s,a){var c=Tt;Tt|=2;var m=Sv(),v=Ev();zt!==s||ft!==a?(bh=null,_h=Ne()+500,Al(s,a)):El=Xr(s,a);e:do try{if(Rt!==0&&ut!==null){a=ut;var E=jr;t:switch(Rt){case 1:Rt=0,jr=null,jl(s,a,E,1);break;case 2:case 9:if(N_(E)){Rt=0,jr=null,Tv(a);break}a=function(){Rt!==2&&Rt!==9||zt!==s||(Rt=7),Bs(s)},E.then(a,a);break e;case 3:Rt=7;break e;case 4:Rt=5;break e;case 7:N_(E)?(Rt=0,jr=null,Tv(a)):(Rt=0,jr=null,jl(s,a,E,7));break;case 5:var P=null;switch(ut.tag){case 26:P=ut.memoizedState;case 5:case 27:var W=ut;if(P?dx(P):W.stateNode.complete){Rt=0,jr=null;var se=W.sibling;if(se!==null)ut=se;else{var pe=W.return;pe!==null?(ut=pe,wh(pe)):ut=null}break t}}Rt=0,jr=null,jl(s,a,E,5);break;case 6:Rt=0,jr=null,jl(s,a,E,6);break;case 8:Xp(),sn=6;break e;default:throw Error(r(462))}}r2();break}catch(Te){xv(s,Te)}while(!0);return ri=uo=null,Y.H=m,Y.A=v,Tt=c,ut!==null?0:(zt=null,ft=0,Fd(),sn)}function r2(){for(;ut!==null&&!ie();)Cv(ut)}function Cv(s){var a=Kb(s.alternate,s,fi);s.memoizedProps=s.pendingProps,a===null?wh(s):ut=a}function Tv(s){var a=s,c=a.alternate;switch(a.tag){case 15:case 0:a=$b(c,a,a.pendingProps,a.type,void 0,ft);break;case 11:a=$b(c,a,a.pendingProps,a.type.render,a.ref,ft);break;case 5:fp(a);default:Xb(c,a),a=ut=E_(a,fi),a=Kb(c,a,fi)}s.memoizedProps=s.pendingProps,a===null?wh(s):ut=a}function jl(s,a,c,m){ri=uo=null,fp(a),yl=null,Hc=0;var v=a.return;try{if(HA(s,v,a,c,ft)){sn=1,ch(s,Ur(c,s.current)),ut=null;return}}catch(E){if(v!==null)throw ut=v,E;sn=1,ch(s,Ur(c,s.current)),ut=null;return}a.flags&32768?(_t||m===1?s=!0:El||(ft&536870912)!==0?s=!1:(ea=s=!0,(m===2||m===9||m===3||m===6)&&(m=Tr.current,m!==null&&m.tag===13&&(m.flags|=16384))),Av(a,s)):wh(a)}function wh(s){var a=s;do{if((a.flags&32768)!==0){Av(a,ea);return}s=a.return;var c=QA(a.alternate,a,fi);if(c!==null){ut=c;return}if(a=a.sibling,a!==null){ut=a;return}ut=a=s}while(a!==null);sn===0&&(sn=5)}function Av(s,a){do{var c=KA(s.alternate,s);if(c!==null){c.flags&=32767,ut=c;return}if(c=s.return,c!==null&&(c.flags|=32768,c.subtreeFlags=0,c.deletions=null),!a&&(s=s.sibling,s!==null)){ut=s;return}ut=s=c}while(s!==null);sn=6,ut=null}function jv(s,a,c,m,v,E,P,W,se){s.cancelPendingCommit=null;do Sh();while(Sn!==0);if((Tt&6)!==0)throw Error(r(327));if(a!==null){if(a===s.current)throw Error(r(177));if(E=a.lanes|a.childLanes,E|=Um,Dm(s,c,E,P,W,se),s===zt&&(ut=zt=null,ft=0),Tl=a,ra=s,mi=c,Qp=E,Kp=v,yv=m,(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?(s.callbackNode=null,s.callbackPriority=0,o2(nt,function(){return Mv(),null})):(s.callbackNode=null,s.callbackPriority=0),m=(a.flags&13878)!==0,(a.subtreeFlags&13878)!==0||m){m=Y.T,Y.T=null,v=G.p,G.p=2,P=Tt,Tt|=4;try{YA(s,a,c)}finally{Tt=P,G.p=v,Y.T=m}}Sn=1,Rv(),Iv(),Dv()}}function Rv(){if(Sn===1){Sn=0;var s=ra,a=Tl,c=(a.flags&13878)!==0;if((a.subtreeFlags&13878)!==0||c){c=Y.T,Y.T=null;var m=G.p;G.p=2;var v=Tt;Tt|=4;try{cv(a,s);var E=ug,P=p_(s.containerInfo),W=E.focusedElem,se=E.selectionRange;if(P!==W&&W&&W.ownerDocument&&m_(W.ownerDocument.documentElement,W)){if(se!==null&&Nm(W)){var pe=se.start,Te=se.end;if(Te===void 0&&(Te=pe),"selectionStart"in W)W.selectionStart=pe,W.selectionEnd=Math.min(Te,W.value.length);else{var De=W.ownerDocument||document,_e=De&&De.defaultView||window;if(_e.getSelection){var xe=_e.getSelection(),Fe=W.textContent.length,Qe=Math.min(se.start,Fe),Ot=se.end===void 0?Qe:Math.min(se.end,Fe);!xe.extend&&Qe>Ot&&(P=Ot,Ot=Qe,Qe=P);var ue=f_(W,Qe),le=f_(W,Ot);if(ue&&le&&(xe.rangeCount!==1||xe.anchorNode!==ue.node||xe.anchorOffset!==ue.offset||xe.focusNode!==le.node||xe.focusOffset!==le.offset)){var me=De.createRange();me.setStart(ue.node,ue.offset),xe.removeAllRanges(),Qe>Ot?(xe.addRange(me),xe.extend(le.node,le.offset)):(me.setEnd(le.node,le.offset),xe.addRange(me))}}}}for(De=[],xe=W;xe=xe.parentNode;)xe.nodeType===1&&De.push({element:xe,left:xe.scrollLeft,top:xe.scrollTop});for(typeof W.focus=="function"&&W.focus(),W=0;W<De.length;W++){var je=De[W];je.element.scrollLeft=je.left,je.element.scrollTop=je.top}}Nh=!!cg,ug=cg=null}finally{Tt=v,G.p=m,Y.T=c}}s.current=a,Sn=2}}function Iv(){if(Sn===2){Sn=0;var s=ra,a=Tl,c=(a.flags&8772)!==0;if((a.subtreeFlags&8772)!==0||c){c=Y.T,Y.T=null;var m=G.p;G.p=2;var v=Tt;Tt|=4;try{sv(s,a.alternate,a)}finally{Tt=v,G.p=m,Y.T=c}}Sn=3}}function Dv(){if(Sn===4||Sn===3){Sn=0,Re();var s=ra,a=Tl,c=mi,m=yv;(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?Sn=5:(Sn=0,Tl=ra=null,kv(s,s.pendingLanes));var v=s.pendingLanes;if(v===0&&(na=null),Xs(c),a=a.stateNode,nn&&typeof nn.onCommitFiberRoot=="function")try{nn.onCommitFiberRoot(vt,a,void 0,(a.current.flags&128)===128)}catch{}if(m!==null){a=Y.T,v=G.p,G.p=2,Y.T=null;try{for(var E=s.onRecoverableError,P=0;P<m.length;P++){var W=m[P];E(W.value,{componentStack:W.stack})}}finally{Y.T=a,G.p=v}}(mi&3)!==0&&Sh(),Bs(s),v=s.pendingLanes,(c&261930)!==0&&(v&42)!==0?s===Yp?lu++:(lu=0,Yp=s):lu=0,cu(0)}}function kv(s,a){(s.pooledCacheLanes&=a)===0&&(a=s.pooledCache,a!=null&&(s.pooledCache=null,$c(a)))}function Sh(){return Rv(),Iv(),Dv(),Mv()}function Mv(){if(Sn!==5)return!1;var s=ra,a=Qp;Qp=0;var c=Xs(mi),m=Y.T,v=G.p;try{G.p=32>c?32:c,Y.T=null,c=Kp,Kp=null;var E=ra,P=mi;if(Sn=0,Tl=ra=null,mi=0,(Tt&6)!==0)throw Error(r(331));var W=Tt;if(Tt|=4,mv(E.current),dv(E,E.current,P,c),Tt=W,cu(0,!1),nn&&typeof nn.onPostCommitFiberRoot=="function")try{nn.onPostCommitFiberRoot(vt,E)}catch{}return!0}finally{G.p=v,Y.T=m,kv(s,a)}}function Ov(s,a,c){a=Ur(c,a),a=jp(s.stateNode,a,2),s=Yi(s,a,2),s!==null&&(Wa(s,2),Bs(s))}function It(s,a,c){if(s.tag===3)Ov(s,s,c);else for(;a!==null;){if(a.tag===3){Ov(a,s,c);break}else if(a.tag===1){var m=a.stateNode;if(typeof a.type.getDerivedStateFromError=="function"||typeof m.componentDidCatch=="function"&&(na===null||!na.has(m))){s=Ur(c,s),c=Nb(2),m=Yi(a,c,2),m!==null&&(Pb(c,m,a,s),Wa(m,2),Bs(m));break}}a=a.return}}function Jp(s,a,c){var m=s.pingCache;if(m===null){m=s.pingCache=new JA;var v=new Set;m.set(a,v)}else v=m.get(a),v===void 0&&(v=new Set,m.set(a,v));v.has(c)||(Hp=!0,v.add(c),s=s2.bind(null,s,a,c),a.then(s,s))}function s2(s,a,c){var m=s.pingCache;m!==null&&m.delete(a),s.pingedLanes|=s.suspendedLanes&c,s.warmLanes&=~c,zt===s&&(ft&c)===c&&(sn===4||sn===3&&(ft&62914560)===ft&&300>Ne()-yh?(Tt&2)===0&&Al(s,0):Gp|=c,Cl===ft&&(Cl=0)),Bs(s)}function Nv(s,a){a===0&&(a=bd()),s=oo(s,a),s!==null&&(Wa(s,a),Bs(s))}function i2(s){var a=s.memoizedState,c=0;a!==null&&(c=a.retryLane),Nv(s,c)}function a2(s,a){var c=0;switch(s.tag){case 31:case 13:var m=s.stateNode,v=s.memoizedState;v!==null&&(c=v.retryLane);break;case 19:m=s.stateNode;break;case 22:m=s.stateNode._retryCache;break;default:throw Error(r(314))}m!==null&&m.delete(a),Nv(s,c)}function o2(s,a){return Ee(s,a)}var Eh=null,Rl=null,eg=!1,Ch=!1,tg=!1,ia=0;function Bs(s){s!==Rl&&s.next===null&&(Rl===null?Eh=Rl=s:Rl=Rl.next=s),Ch=!0,eg||(eg=!0,c2())}function cu(s,a){if(!tg&&Ch){tg=!0;do for(var c=!1,m=Eh;m!==null;){if(s!==0){var v=m.pendingLanes;if(v===0)var E=0;else{var P=m.suspendedLanes,W=m.pingedLanes;E=(1<<31-Et(42|s)+1)-1,E&=v&~(P&~W),E=E&201326741?E&201326741|1:E?E|2:0}E!==0&&(c=!0,Lv(m,E))}else E=ft,E=bs(m,m===zt?E:0,m.cancelPendingCommit!==null||m.timeoutHandle!==-1),(E&3)===0||Xr(m,E)||(c=!0,Lv(m,E));m=m.next}while(c);tg=!1}}function l2(){Pv()}function Pv(){Ch=eg=!1;var s=0;ia!==0&&b2()&&(s=ia);for(var a=Ne(),c=null,m=Eh;m!==null;){var v=m.next,E=Bv(m,a);E===0?(m.next=null,c===null?Eh=v:c.next=v,v===null&&(Rl=c)):(c=m,(s!==0||(E&3)!==0)&&(Ch=!0)),m=v}Sn!==0&&Sn!==5||cu(s),ia!==0&&(ia=0)}function Bv(s,a){for(var c=s.suspendedLanes,m=s.pingedLanes,v=s.expirationTimes,E=s.pendingLanes&-62914561;0<E;){var P=31-Et(E),W=1<<P,se=v[P];se===-1?((W&c)===0||(W&m)!==0)&&(v[P]=Im(W,a)):se<=a&&(s.expiredLanes|=W),E&=~W}if(a=zt,c=ft,c=bs(s,s===a?c:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),m=s.callbackNode,c===0||s===a&&(Rt===2||Rt===9)||s.cancelPendingCommit!==null)return m!==null&&m!==null&&Se(m),s.callbackNode=null,s.callbackPriority=0;if((c&3)===0||Xr(s,c)){if(a=c&-c,a===s.callbackPriority)return a;switch(m!==null&&Se(m),Xs(c)){case 2:case 8:c=xt;break;case 32:c=nt;break;case 268435456:c=gs;break;default:c=nt}return m=zv.bind(null,s),c=Ee(c,m),s.callbackPriority=a,s.callbackNode=c,a}return m!==null&&m!==null&&Se(m),s.callbackPriority=2,s.callbackNode=null,2}function zv(s,a){if(Sn!==0&&Sn!==5)return s.callbackNode=null,s.callbackPriority=0,null;var c=s.callbackNode;if(Sh()&&s.callbackNode!==c)return null;var m=ft;return m=bs(s,s===zt?m:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),m===0?null:(bv(s,m,a),Bv(s,Ne()),s.callbackNode!=null&&s.callbackNode===c?zv.bind(null,s):null)}function Lv(s,a){if(Sh())return null;bv(s,a,!0)}function c2(){x2(function(){(Tt&6)!==0?Ee(He,l2):Pv()})}function ng(){if(ia===0){var s=ml;s===0&&(s=Or,Or<<=1,(Or&261888)===0&&(Or=256)),ia=s}return ia}function Uv(s){return s==null||typeof s=="symbol"||typeof s=="boolean"?null:typeof s=="function"?s:Jo(""+s)}function Fv(s,a){var c=a.ownerDocument.createElement("input");return c.name=a.name,c.value=a.value,s.id&&c.setAttribute("form",s.id),a.parentNode.insertBefore(c,a),s=new FormData(s),c.parentNode.removeChild(c),s}function u2(s,a,c,m,v){if(a==="submit"&&c&&c.stateNode===v){var E=Uv((v[In]||null).action),P=m.submitter;P&&(a=(a=P[In]||null)?Uv(a.formAction):P.getAttribute("formAction"),a!==null&&(E=a,P=null));var W=new Is("action","action",null,m,v);s.push({event:W,listeners:[{instance:null,listener:function(){if(m.defaultPrevented){if(ia!==0){var se=P?Fv(v,P):new FormData(v);wp(c,{pending:!0,data:se,method:v.method,action:E},null,se)}}else typeof E=="function"&&(W.preventDefault(),se=P?Fv(v,P):new FormData(v),wp(c,{pending:!0,data:se,method:v.method,action:E},E,se))},currentTarget:v}]})}}for(var rg=0;rg<Lm.length;rg++){var sg=Lm[rg],d2=sg.toLowerCase(),h2=sg[0].toUpperCase()+sg.slice(1);is(d2,"on"+h2)}is(__,"onAnimationEnd"),is(b_,"onAnimationIteration"),is(v_,"onAnimationStart"),is("dblclick","onDoubleClick"),is("focusin","onFocus"),is("focusout","onBlur"),is(jA,"onTransitionRun"),is(RA,"onTransitionStart"),is(IA,"onTransitionCancel"),is(x_,"onTransitionEnd"),Ts("onMouseEnter",["mouseout","mouseover"]),Ts("onMouseLeave",["mouseout","mouseover"]),Ts("onPointerEnter",["pointerout","pointerover"]),Ts("onPointerLeave",["pointerout","pointerover"]),Cs("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Cs("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Cs("onBeforeInput",["compositionend","keypress","textInput","paste"]),Cs("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Cs("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Cs("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var uu="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),f2=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(uu));function Vv(s,a){a=(a&4)!==0;for(var c=0;c<s.length;c++){var m=s[c],v=m.event;m=m.listeners;e:{var E=void 0;if(a)for(var P=m.length-1;0<=P;P--){var W=m[P],se=W.instance,pe=W.currentTarget;if(W=W.listener,se!==E&&v.isPropagationStopped())break e;E=W,v.currentTarget=pe;try{E(v)}catch(Te){Ud(Te)}v.currentTarget=null,E=se}else for(P=0;P<m.length;P++){if(W=m[P],se=W.instance,pe=W.currentTarget,W=W.listener,se!==E&&v.isPropagationStopped())break e;E=W,v.currentTarget=pe;try{E(v)}catch(Te){Ud(Te)}v.currentTarget=null,E=se}}}}function dt(s,a){var c=a[Qo];c===void 0&&(c=a[Qo]=new Set);var m=s+"__bubble";c.has(m)||($v(a,s,2,!1),c.add(m))}function ig(s,a,c){var m=0;a&&(m|=4),$v(c,s,m,a)}var Th="_reactListening"+Math.random().toString(36).slice(2);function ag(s){if(!s[Th]){s[Th]=!0,wc.forEach(function(c){c!=="selectionchange"&&(f2.has(c)||ig(c,!1,s),ig(c,!0,s))});var a=s.nodeType===9?s:s.ownerDocument;a===null||a[Th]||(a[Th]=!0,ig("selectionchange",!1,a))}}function $v(s,a,c,m){switch(_x(a)){case 2:var v=F2;break;case 8:v=V2;break;default:v=xg}c=v.bind(null,a,c,s),v=void 0,!Ja||a!=="touchstart"&&a!=="touchmove"&&a!=="wheel"||(v=!0),m?v!==void 0?s.addEventListener(a,c,{capture:!0,passive:v}):s.addEventListener(a,c,!0):v!==void 0?s.addEventListener(a,c,{passive:v}):s.addEventListener(a,c,!1)}function og(s,a,c,m,v){var E=m;if((a&1)===0&&(a&2)===0&&m!==null)e:for(;;){if(m===null)return;var P=m.tag;if(P===3||P===4){var W=m.stateNode.containerInfo;if(W===v)break;if(P===4)for(P=m.return;P!==null;){var se=P.tag;if((se===3||se===4)&&P.stateNode.containerInfo===v)return;P=P.return}for(;W!==null;){if(P=Ss(W),P===null)return;if(se=P.tag,se===5||se===6||se===26||se===27){m=E=P;continue e}W=W.parentNode}}m=m.return}Ui(function(){var pe=E,Te=Pr(c),De=[];e:{var _e=w_.get(s);if(_e!==void 0){var xe=Is,Fe=s;switch(s){case"keypress":if(to(c)===0)break e;case"keydown":case"keyup":xe=Bd;break;case"focusin":Fe="focus",xe=ro;break;case"focusout":Fe="blur",xe=ro;break;case"beforeblur":case"afterblur":xe=ro;break;case"click":if(c.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":xe=Nc;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":xe=jd;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":xe=A;break;case __:case b_:case v_:xe=Id;break;case x_:xe=K;break;case"scroll":case"scrollend":xe=Oc;break;case"wheel":xe=ve;break;case"copy":case"cut":case"paste":xe=Dd;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":xe=ei;break;case"toggle":case"beforetoggle":xe=rt}var Qe=(a&4)!==0,Ot=!Qe&&(s==="scroll"||s==="scrollend"),ue=Qe?_e!==null?_e+"Capture":null:_e;Qe=[];for(var le=pe,me;le!==null;){var je=le;if(me=je.stateNode,je=je.tag,je!==5&&je!==26&&je!==27||me===null||ue===null||(je=ts(le,ue),je!=null&&Qe.push(du(le,je,me))),Ot)break;le=le.return}0<Qe.length&&(_e=new xe(_e,Fe,null,c,Te),De.push({event:_e,listeners:Qe}))}}if((a&7)===0){e:{if(_e=s==="mouseover"||s==="pointerover",xe=s==="mouseout"||s==="pointerout",_e&&c!==Dc&&(Fe=c.relatedTarget||c.fromElement)&&(Ss(Fe)||Fe[xs]))break e;if((xe||_e)&&(_e=Te.window===Te?Te:(_e=Te.ownerDocument)?_e.defaultView||_e.parentWindow:window,xe?(Fe=c.relatedTarget||c.toElement,xe=pe,Fe=Fe?Ss(Fe):null,Fe!==null&&(Ot=o(Fe),Qe=Fe.tag,Fe!==Ot||Qe!==5&&Qe!==27&&Qe!==6)&&(Fe=null)):(xe=null,Fe=pe),xe!==Fe)){if(Qe=Nc,je="onMouseLeave",ue="onMouseEnter",le="mouse",(s==="pointerout"||s==="pointerover")&&(Qe=ei,je="onPointerLeave",ue="onPointerEnter",le="pointer"),Ot=xe==null?_e:wr(xe),me=Fe==null?_e:wr(Fe),_e=new Qe(je,le+"leave",xe,c,Te),_e.target=Ot,_e.relatedTarget=me,je=null,Ss(Te)===pe&&(Qe=new Qe(ue,le+"enter",Fe,c,Te),Qe.target=me,Qe.relatedTarget=Ot,je=Qe),Ot=je,xe&&Fe)t:{for(Qe=m2,ue=xe,le=Fe,me=0,je=ue;je;je=Qe(je))me++;je=0;for(var Ge=le;Ge;Ge=Qe(Ge))je++;for(;0<me-je;)ue=Qe(ue),me--;for(;0<je-me;)le=Qe(le),je--;for(;me--;){if(ue===le||le!==null&&ue===le.alternate){Qe=ue;break t}ue=Qe(ue),le=Qe(le)}Qe=null}else Qe=null;xe!==null&&qv(De,_e,xe,Qe,!1),Fe!==null&&Ot!==null&&qv(De,Ot,Fe,Qe,!0)}}e:{if(_e=pe?wr(pe):window,xe=_e.nodeName&&_e.nodeName.toLowerCase(),xe==="select"||xe==="input"&&_e.type==="file")var wt=o_;else if(i_(_e))if(l_)wt=CA;else{wt=SA;var Ve=wA}else xe=_e.nodeName,!xe||xe.toLowerCase()!=="input"||_e.type!=="checkbox"&&_e.type!=="radio"?pe&&Zo(pe.elementType)&&(wt=o_):wt=EA;if(wt&&(wt=wt(s,pe))){a_(De,wt,c,Te);break e}Ve&&Ve(s,_e,pe),s==="focusout"&&pe&&_e.type==="number"&&pe.memoizedProps.value!=null&&jc(_e,"number",_e.value)}switch(Ve=pe?wr(pe):window,s){case"focusin":(i_(Ve)||Ve.contentEditable==="true")&&(al=Ve,Pm=pe,Uc=null);break;case"focusout":Uc=Pm=al=null;break;case"mousedown":Bm=!0;break;case"contextmenu":case"mouseup":case"dragend":Bm=!1,g_(De,c,Te);break;case"selectionchange":if(AA)break;case"keydown":case"keyup":g_(De,c,Te)}var it;if(Ct)e:{switch(s){case"compositionstart":var mt="onCompositionStart";break e;case"compositionend":mt="onCompositionEnd";break e;case"compositionupdate":mt="onCompositionUpdate";break e}mt=void 0}else il?so(s,c)&&(mt="onCompositionEnd"):s==="keydown"&&c.keyCode===229&&(mt="onCompositionStart");mt&&(Ms&&c.locale!=="ko"&&(il||mt!=="onCompositionStart"?mt==="onCompositionEnd"&&il&&(it=Mc()):(Rs=Te,kc="value"in Rs?Rs.value:Rs.textContent,il=!0)),Ve=Ah(pe,mt),0<Ve.length&&(mt=new ks(mt,s,null,c,Te),De.push({event:mt,listeners:Ve}),it?mt.data=it:(it=sl(c),it!==null&&(mt.data=it)))),(it=zr?_A(s,c):bA(s,c))&&(mt=Ah(pe,"onBeforeInput"),0<mt.length&&(Ve=new ks("onBeforeInput","beforeinput",null,c,Te),De.push({event:Ve,listeners:mt}),Ve.data=it)),u2(De,s,pe,c,Te)}Vv(De,a)})}function du(s,a,c){return{instance:s,listener:a,currentTarget:c}}function Ah(s,a){for(var c=a+"Capture",m=[];s!==null;){var v=s,E=v.stateNode;if(v=v.tag,v!==5&&v!==26&&v!==27||E===null||(v=ts(s,c),v!=null&&m.unshift(du(s,v,E)),v=ts(s,a),v!=null&&m.push(du(s,v,E))),s.tag===3)return m;s=s.return}return[]}function m2(s){if(s===null)return null;do s=s.return;while(s&&s.tag!==5&&s.tag!==27);return s||null}function qv(s,a,c,m,v){for(var E=a._reactName,P=[];c!==null&&c!==m;){var W=c,se=W.alternate,pe=W.stateNode;if(W=W.tag,se!==null&&se===m)break;W!==5&&W!==26&&W!==27||pe===null||(se=pe,v?(pe=ts(c,E),pe!=null&&P.unshift(du(c,pe,se))):v||(pe=ts(c,E),pe!=null&&P.push(du(c,pe,se)))),c=c.return}P.length!==0&&s.push({event:a,listeners:P})}var p2=/\r\n?/g,g2=/\u0000|\uFFFD/g;function Hv(s){return(typeof s=="string"?s:""+s).replace(p2,`
`).replace(g2,"")}function Gv(s,a){return a=Hv(a),Hv(s)===a}function Mt(s,a,c,m,v,E){switch(c){case"children":typeof m=="string"?a==="body"||a==="textarea"&&m===""||dr(s,m):(typeof m=="number"||typeof m=="bigint")&&a!=="body"&&dr(s,""+m);break;case"className":Sr(s,"class",m);break;case"tabIndex":Sr(s,"tabindex",m);break;case"dir":case"role":case"viewBox":case"width":case"height":Sr(s,c,m);break;case"style":Ic(s,m,E);break;case"data":if(a!=="object"){Sr(s,"data",m);break}case"src":case"href":if(m===""&&(a!=="a"||c!=="href")){s.removeAttribute(c);break}if(m==null||typeof m=="function"||typeof m=="symbol"||typeof m=="boolean"){s.removeAttribute(c);break}m=Jo(""+m),s.setAttribute(c,m);break;case"action":case"formAction":if(typeof m=="function"){s.setAttribute(c,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof E=="function"&&(c==="formAction"?(a!=="input"&&Mt(s,a,"name",v.name,v,null),Mt(s,a,"formEncType",v.formEncType,v,null),Mt(s,a,"formMethod",v.formMethod,v,null),Mt(s,a,"formTarget",v.formTarget,v,null)):(Mt(s,a,"encType",v.encType,v,null),Mt(s,a,"method",v.method,v,null),Mt(s,a,"target",v.target,v,null)));if(m==null||typeof m=="symbol"||typeof m=="boolean"){s.removeAttribute(c);break}m=Jo(""+m),s.setAttribute(c,m);break;case"onClick":m!=null&&(s.onclick=es);break;case"onScroll":m!=null&&dt("scroll",s);break;case"onScrollEnd":m!=null&&dt("scrollend",s);break;case"dangerouslySetInnerHTML":if(m!=null){if(typeof m!="object"||!("__html"in m))throw Error(r(61));if(c=m.__html,c!=null){if(v.children!=null)throw Error(r(60));s.innerHTML=c}}break;case"multiple":s.multiple=m&&typeof m!="function"&&typeof m!="symbol";break;case"muted":s.muted=m&&typeof m!="function"&&typeof m!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(m==null||typeof m=="function"||typeof m=="boolean"||typeof m=="symbol"){s.removeAttribute("xlink:href");break}c=Jo(""+m),s.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",c);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":m!=null&&typeof m!="function"&&typeof m!="symbol"?s.setAttribute(c,""+m):s.removeAttribute(c);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":m&&typeof m!="function"&&typeof m!="symbol"?s.setAttribute(c,""):s.removeAttribute(c);break;case"capture":case"download":m===!0?s.setAttribute(c,""):m!==!1&&m!=null&&typeof m!="function"&&typeof m!="symbol"?s.setAttribute(c,m):s.removeAttribute(c);break;case"cols":case"rows":case"size":case"span":m!=null&&typeof m!="function"&&typeof m!="symbol"&&!isNaN(m)&&1<=m?s.setAttribute(c,m):s.removeAttribute(c);break;case"rowSpan":case"start":m==null||typeof m=="function"||typeof m=="symbol"||isNaN(m)?s.removeAttribute(c):s.setAttribute(c,m);break;case"popover":dt("beforetoggle",s),dt("toggle",s),Yo(s,"popover",m);break;case"xlinkActuate":mn(s,"http://www.w3.org/1999/xlink","xlink:actuate",m);break;case"xlinkArcrole":mn(s,"http://www.w3.org/1999/xlink","xlink:arcrole",m);break;case"xlinkRole":mn(s,"http://www.w3.org/1999/xlink","xlink:role",m);break;case"xlinkShow":mn(s,"http://www.w3.org/1999/xlink","xlink:show",m);break;case"xlinkTitle":mn(s,"http://www.w3.org/1999/xlink","xlink:title",m);break;case"xlinkType":mn(s,"http://www.w3.org/1999/xlink","xlink:type",m);break;case"xmlBase":mn(s,"http://www.w3.org/XML/1998/namespace","xml:base",m);break;case"xmlLang":mn(s,"http://www.w3.org/XML/1998/namespace","xml:lang",m);break;case"xmlSpace":mn(s,"http://www.w3.org/XML/1998/namespace","xml:space",m);break;case"is":Yo(s,"is",m);break;case"innerText":case"textContent":break;default:(!(2<c.length)||c[0]!=="o"&&c[0]!=="O"||c[1]!=="n"&&c[1]!=="N")&&(c=Ad.get(c)||c,Yo(s,c,m))}}function lg(s,a,c,m,v,E){switch(c){case"style":Ic(s,m,E);break;case"dangerouslySetInnerHTML":if(m!=null){if(typeof m!="object"||!("__html"in m))throw Error(r(61));if(c=m.__html,c!=null){if(v.children!=null)throw Error(r(60));s.innerHTML=c}}break;case"children":typeof m=="string"?dr(s,m):(typeof m=="number"||typeof m=="bigint")&&dr(s,""+m);break;case"onScroll":m!=null&&dt("scroll",s);break;case"onScrollEnd":m!=null&&dt("scrollend",s);break;case"onClick":m!=null&&(s.onclick=es);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Sc.hasOwnProperty(c))e:{if(c[0]==="o"&&c[1]==="n"&&(v=c.endsWith("Capture"),a=c.slice(2,v?c.length-7:void 0),E=s[In]||null,E=E!=null?E[c]:null,typeof E=="function"&&s.removeEventListener(a,E,v),typeof m=="function")){typeof E!="function"&&E!==null&&(c in s?s[c]=null:s.hasAttribute(c)&&s.removeAttribute(c)),s.addEventListener(a,m,v);break e}c in s?s[c]=m:m===!0?s.setAttribute(c,""):Yo(s,c,m)}}}function Ln(s,a,c){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":dt("error",s),dt("load",s);var m=!1,v=!1,E;for(E in c)if(c.hasOwnProperty(E)){var P=c[E];if(P!=null)switch(E){case"src":m=!0;break;case"srcSet":v=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(r(137,a));default:Mt(s,a,E,P,c,null)}}v&&Mt(s,a,"srcSet",c.srcSet,c,null),m&&Mt(s,a,"src",c.src,c,null);return;case"input":dt("invalid",s);var W=E=P=v=null,se=null,pe=null;for(m in c)if(c.hasOwnProperty(m)){var Te=c[m];if(Te!=null)switch(m){case"name":v=Te;break;case"type":P=Te;break;case"checked":se=Te;break;case"defaultChecked":pe=Te;break;case"value":E=Te;break;case"defaultValue":W=Te;break;case"children":case"dangerouslySetInnerHTML":if(Te!=null)throw Error(r(137,a));break;default:Mt(s,a,m,Te,c,null)}}Ed(s,E,W,se,pe,P,v,!1);return;case"select":dt("invalid",s),m=P=E=null;for(v in c)if(c.hasOwnProperty(v)&&(W=c[v],W!=null))switch(v){case"value":E=W;break;case"defaultValue":P=W;break;case"multiple":m=W;default:Mt(s,a,v,W,c,null)}a=E,c=P,s.multiple=!!m,a!=null?Pi(s,!!m,a,!1):c!=null&&Pi(s,!!m,c,!0);return;case"textarea":dt("invalid",s),E=v=m=null;for(P in c)if(c.hasOwnProperty(P)&&(W=c[P],W!=null))switch(P){case"value":m=W;break;case"defaultValue":v=W;break;case"children":E=W;break;case"dangerouslySetInnerHTML":if(W!=null)throw Error(r(91));break;default:Mt(s,a,P,W,c,null)}Bi(s,m,v,E);return;case"option":for(se in c)c.hasOwnProperty(se)&&(m=c[se],m!=null)&&(se==="selected"?s.selected=m&&typeof m!="function"&&typeof m!="symbol":Mt(s,a,se,m,c,null));return;case"dialog":dt("beforetoggle",s),dt("toggle",s),dt("cancel",s),dt("close",s);break;case"iframe":case"object":dt("load",s);break;case"video":case"audio":for(m=0;m<uu.length;m++)dt(uu[m],s);break;case"image":dt("error",s),dt("load",s);break;case"details":dt("toggle",s);break;case"embed":case"source":case"link":dt("error",s),dt("load",s);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(pe in c)if(c.hasOwnProperty(pe)&&(m=c[pe],m!=null))switch(pe){case"children":case"dangerouslySetInnerHTML":throw Error(r(137,a));default:Mt(s,a,pe,m,c,null)}return;default:if(Zo(a)){for(Te in c)c.hasOwnProperty(Te)&&(m=c[Te],m!==void 0&&lg(s,a,Te,m,c,void 0));return}}for(W in c)c.hasOwnProperty(W)&&(m=c[W],m!=null&&Mt(s,a,W,m,c,null))}function y2(s,a,c,m){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var v=null,E=null,P=null,W=null,se=null,pe=null,Te=null;for(xe in c){var De=c[xe];if(c.hasOwnProperty(xe)&&De!=null)switch(xe){case"checked":break;case"value":break;case"defaultValue":se=De;default:m.hasOwnProperty(xe)||Mt(s,a,xe,null,m,De)}}for(var _e in m){var xe=m[_e];if(De=c[_e],m.hasOwnProperty(_e)&&(xe!=null||De!=null))switch(_e){case"type":E=xe;break;case"name":v=xe;break;case"checked":pe=xe;break;case"defaultChecked":Te=xe;break;case"value":P=xe;break;case"defaultValue":W=xe;break;case"children":case"dangerouslySetInnerHTML":if(xe!=null)throw Error(r(137,a));break;default:xe!==De&&Mt(s,a,_e,xe,m,De)}}Xo(s,P,W,se,pe,Te,E,v);return;case"select":xe=P=W=_e=null;for(E in c)if(se=c[E],c.hasOwnProperty(E)&&se!=null)switch(E){case"value":break;case"multiple":xe=se;default:m.hasOwnProperty(E)||Mt(s,a,E,null,m,se)}for(v in m)if(E=m[v],se=c[v],m.hasOwnProperty(v)&&(E!=null||se!=null))switch(v){case"value":_e=E;break;case"defaultValue":W=E;break;case"multiple":P=E;default:E!==se&&Mt(s,a,v,E,m,se)}a=W,c=P,m=xe,_e!=null?Pi(s,!!c,_e,!1):!!m!=!!c&&(a!=null?Pi(s,!!c,a,!0):Pi(s,!!c,c?[]:"",!1));return;case"textarea":xe=_e=null;for(W in c)if(v=c[W],c.hasOwnProperty(W)&&v!=null&&!m.hasOwnProperty(W))switch(W){case"value":break;case"children":break;default:Mt(s,a,W,null,m,v)}for(P in m)if(v=m[P],E=c[P],m.hasOwnProperty(P)&&(v!=null||E!=null))switch(P){case"value":_e=v;break;case"defaultValue":xe=v;break;case"children":break;case"dangerouslySetInnerHTML":if(v!=null)throw Error(r(91));break;default:v!==E&&Mt(s,a,P,v,m,E)}Cd(s,_e,xe);return;case"option":for(var Fe in c)_e=c[Fe],c.hasOwnProperty(Fe)&&_e!=null&&!m.hasOwnProperty(Fe)&&(Fe==="selected"?s.selected=!1:Mt(s,a,Fe,null,m,_e));for(se in m)_e=m[se],xe=c[se],m.hasOwnProperty(se)&&_e!==xe&&(_e!=null||xe!=null)&&(se==="selected"?s.selected=_e&&typeof _e!="function"&&typeof _e!="symbol":Mt(s,a,se,_e,m,xe));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Qe in c)_e=c[Qe],c.hasOwnProperty(Qe)&&_e!=null&&!m.hasOwnProperty(Qe)&&Mt(s,a,Qe,null,m,_e);for(pe in m)if(_e=m[pe],xe=c[pe],m.hasOwnProperty(pe)&&_e!==xe&&(_e!=null||xe!=null))switch(pe){case"children":case"dangerouslySetInnerHTML":if(_e!=null)throw Error(r(137,a));break;default:Mt(s,a,pe,_e,m,xe)}return;default:if(Zo(a)){for(var Ot in c)_e=c[Ot],c.hasOwnProperty(Ot)&&_e!==void 0&&!m.hasOwnProperty(Ot)&&lg(s,a,Ot,void 0,m,_e);for(Te in m)_e=m[Te],xe=c[Te],!m.hasOwnProperty(Te)||_e===xe||_e===void 0&&xe===void 0||lg(s,a,Te,_e,m,xe);return}}for(var ue in c)_e=c[ue],c.hasOwnProperty(ue)&&_e!=null&&!m.hasOwnProperty(ue)&&Mt(s,a,ue,null,m,_e);for(De in m)_e=m[De],xe=c[De],!m.hasOwnProperty(De)||_e===xe||_e==null&&xe==null||Mt(s,a,De,_e,m,xe)}function Wv(s){switch(s){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function _2(){if(typeof performance.getEntriesByType=="function"){for(var s=0,a=0,c=performance.getEntriesByType("resource"),m=0;m<c.length;m++){var v=c[m],E=v.transferSize,P=v.initiatorType,W=v.duration;if(E&&W&&Wv(P)){for(P=0,W=v.responseEnd,m+=1;m<c.length;m++){var se=c[m],pe=se.startTime;if(pe>W)break;var Te=se.transferSize,De=se.initiatorType;Te&&Wv(De)&&(se=se.responseEnd,P+=Te*(se<W?1:(W-pe)/(se-pe)))}if(--m,a+=8*(E+P)/(v.duration/1e3),s++,10<s)break}}if(0<s)return a/s/1e6}return navigator.connection&&(s=navigator.connection.downlink,typeof s=="number")?s:5}var cg=null,ug=null;function jh(s){return s.nodeType===9?s:s.ownerDocument}function Qv(s){switch(s){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Kv(s,a){if(s===0)switch(a){case"svg":return 1;case"math":return 2;default:return 0}return s===1&&a==="foreignObject"?0:s}function dg(s,a){return s==="textarea"||s==="noscript"||typeof a.children=="string"||typeof a.children=="number"||typeof a.children=="bigint"||typeof a.dangerouslySetInnerHTML=="object"&&a.dangerouslySetInnerHTML!==null&&a.dangerouslySetInnerHTML.__html!=null}var hg=null;function b2(){var s=window.event;return s&&s.type==="popstate"?s===hg?!1:(hg=s,!0):(hg=null,!1)}var Yv=typeof setTimeout=="function"?setTimeout:void 0,v2=typeof clearTimeout=="function"?clearTimeout:void 0,Xv=typeof Promise=="function"?Promise:void 0,x2=typeof queueMicrotask=="function"?queueMicrotask:typeof Xv<"u"?function(s){return Xv.resolve(null).then(s).catch(w2)}:Yv;function w2(s){setTimeout(function(){throw s})}function aa(s){return s==="head"}function Zv(s,a){var c=a,m=0;do{var v=c.nextSibling;if(s.removeChild(c),v&&v.nodeType===8)if(c=v.data,c==="/$"||c==="/&"){if(m===0){s.removeChild(v),Ml(a);return}m--}else if(c==="$"||c==="$?"||c==="$~"||c==="$!"||c==="&")m++;else if(c==="html")hu(s.ownerDocument.documentElement);else if(c==="head"){c=s.ownerDocument.head,hu(c);for(var E=c.firstChild;E;){var P=E.nextSibling,W=E.nodeName;E[ws]||W==="SCRIPT"||W==="STYLE"||W==="LINK"&&E.rel.toLowerCase()==="stylesheet"||c.removeChild(E),E=P}}else c==="body"&&hu(s.ownerDocument.body);c=v}while(c);Ml(a)}function Jv(s,a){var c=s;s=0;do{var m=c.nextSibling;if(c.nodeType===1?a?(c._stashedDisplay=c.style.display,c.style.display="none"):(c.style.display=c._stashedDisplay||"",c.getAttribute("style")===""&&c.removeAttribute("style")):c.nodeType===3&&(a?(c._stashedText=c.nodeValue,c.nodeValue=""):c.nodeValue=c._stashedText||""),m&&m.nodeType===8)if(c=m.data,c==="/$"){if(s===0)break;s--}else c!=="$"&&c!=="$?"&&c!=="$~"&&c!=="$!"||s++;c=m}while(c)}function fg(s){var a=s.firstChild;for(a&&a.nodeType===10&&(a=a.nextSibling);a;){var c=a;switch(a=a.nextSibling,c.nodeName){case"HTML":case"HEAD":case"BODY":fg(c),Ko(c);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(c.rel.toLowerCase()==="stylesheet")continue}s.removeChild(c)}}function S2(s,a,c,m){for(;s.nodeType===1;){var v=c;if(s.nodeName.toLowerCase()!==a.toLowerCase()){if(!m&&(s.nodeName!=="INPUT"||s.type!=="hidden"))break}else if(m){if(!s[ws])switch(a){case"meta":if(!s.hasAttribute("itemprop"))break;return s;case"link":if(E=s.getAttribute("rel"),E==="stylesheet"&&s.hasAttribute("data-precedence"))break;if(E!==v.rel||s.getAttribute("href")!==(v.href==null||v.href===""?null:v.href)||s.getAttribute("crossorigin")!==(v.crossOrigin==null?null:v.crossOrigin)||s.getAttribute("title")!==(v.title==null?null:v.title))break;return s;case"style":if(s.hasAttribute("data-precedence"))break;return s;case"script":if(E=s.getAttribute("src"),(E!==(v.src==null?null:v.src)||s.getAttribute("type")!==(v.type==null?null:v.type)||s.getAttribute("crossorigin")!==(v.crossOrigin==null?null:v.crossOrigin))&&E&&s.hasAttribute("async")&&!s.hasAttribute("itemprop"))break;return s;default:return s}}else if(a==="input"&&s.type==="hidden"){var E=v.name==null?null:""+v.name;if(v.type==="hidden"&&s.getAttribute("name")===E)return s}else return s;if(s=Hr(s.nextSibling),s===null)break}return null}function E2(s,a,c){if(a==="")return null;for(;s.nodeType!==3;)if((s.nodeType!==1||s.nodeName!=="INPUT"||s.type!=="hidden")&&!c||(s=Hr(s.nextSibling),s===null))return null;return s}function ex(s,a){for(;s.nodeType!==8;)if((s.nodeType!==1||s.nodeName!=="INPUT"||s.type!=="hidden")&&!a||(s=Hr(s.nextSibling),s===null))return null;return s}function mg(s){return s.data==="$?"||s.data==="$~"}function pg(s){return s.data==="$!"||s.data==="$?"&&s.ownerDocument.readyState!=="loading"}function C2(s,a){var c=s.ownerDocument;if(s.data==="$~")s._reactRetry=a;else if(s.data!=="$?"||c.readyState!=="loading")a();else{var m=function(){a(),c.removeEventListener("DOMContentLoaded",m)};c.addEventListener("DOMContentLoaded",m),s._reactRetry=m}}function Hr(s){for(;s!=null;s=s.nextSibling){var a=s.nodeType;if(a===1||a===3)break;if(a===8){if(a=s.data,a==="$"||a==="$!"||a==="$?"||a==="$~"||a==="&"||a==="F!"||a==="F")break;if(a==="/$"||a==="/&")return null}}return s}var gg=null;function tx(s){s=s.nextSibling;for(var a=0;s;){if(s.nodeType===8){var c=s.data;if(c==="/$"||c==="/&"){if(a===0)return Hr(s.nextSibling);a--}else c!=="$"&&c!=="$!"&&c!=="$?"&&c!=="$~"&&c!=="&"||a++}s=s.nextSibling}return null}function nx(s){s=s.previousSibling;for(var a=0;s;){if(s.nodeType===8){var c=s.data;if(c==="$"||c==="$!"||c==="$?"||c==="$~"||c==="&"){if(a===0)return s;a--}else c!=="/$"&&c!=="/&"||a++}s=s.previousSibling}return null}function rx(s,a,c){switch(a=jh(c),s){case"html":if(s=a.documentElement,!s)throw Error(r(452));return s;case"head":if(s=a.head,!s)throw Error(r(453));return s;case"body":if(s=a.body,!s)throw Error(r(454));return s;default:throw Error(r(451))}}function hu(s){for(var a=s.attributes;a.length;)s.removeAttributeNode(a[0]);Ko(s)}var Gr=new Map,sx=new Set;function Rh(s){return typeof s.getRootNode=="function"?s.getRootNode():s.nodeType===9?s:s.ownerDocument}var pi=G.d;G.d={f:T2,r:A2,D:j2,C:R2,L:I2,m:D2,X:M2,S:k2,M:O2};function T2(){var s=pi.f(),a=vh();return s||a}function A2(s){var a=Nr(s);a!==null&&a.tag===5&&a.type==="form"?xb(a):pi.r(s)}var Il=typeof document>"u"?null:document;function ix(s,a,c){var m=Il;if(m&&typeof a=="string"&&a){var v=ur(a);v='link[rel="'+s+'"][href="'+v+'"]',typeof c=="string"&&(v+='[crossorigin="'+c+'"]'),sx.has(v)||(sx.add(v),s={rel:s,crossOrigin:c,href:a},m.querySelector(v)===null&&(a=m.createElement("link"),Ln(a,"link",s),fn(a),m.head.appendChild(a)))}}function j2(s){pi.D(s),ix("dns-prefetch",s,null)}function R2(s,a){pi.C(s,a),ix("preconnect",s,a)}function I2(s,a,c){pi.L(s,a,c);var m=Il;if(m&&s&&a){var v='link[rel="preload"][as="'+ur(a)+'"]';a==="image"&&c&&c.imageSrcSet?(v+='[imagesrcset="'+ur(c.imageSrcSet)+'"]',typeof c.imageSizes=="string"&&(v+='[imagesizes="'+ur(c.imageSizes)+'"]')):v+='[href="'+ur(s)+'"]';var E=v;switch(a){case"style":E=Dl(s);break;case"script":E=kl(s)}Gr.has(E)||(s=g({rel:"preload",href:a==="image"&&c&&c.imageSrcSet?void 0:s,as:a},c),Gr.set(E,s),m.querySelector(v)!==null||a==="style"&&m.querySelector(fu(E))||a==="script"&&m.querySelector(mu(E))||(a=m.createElement("link"),Ln(a,"link",s),fn(a),m.head.appendChild(a)))}}function D2(s,a){pi.m(s,a);var c=Il;if(c&&s){var m=a&&typeof a.as=="string"?a.as:"script",v='link[rel="modulepreload"][as="'+ur(m)+'"][href="'+ur(s)+'"]',E=v;switch(m){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":E=kl(s)}if(!Gr.has(E)&&(s=g({rel:"modulepreload",href:s},a),Gr.set(E,s),c.querySelector(v)===null)){switch(m){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(c.querySelector(mu(E)))return}m=c.createElement("link"),Ln(m,"link",s),fn(m),c.head.appendChild(m)}}}function k2(s,a,c){pi.S(s,a,c);var m=Il;if(m&&s){var v=Es(m).hoistableStyles,E=Dl(s);a=a||"default";var P=v.get(E);if(!P){var W={loading:0,preload:null};if(P=m.querySelector(fu(E)))W.loading=5;else{s=g({rel:"stylesheet",href:s,"data-precedence":a},c),(c=Gr.get(E))&&yg(s,c);var se=P=m.createElement("link");fn(se),Ln(se,"link",s),se._p=new Promise(function(pe,Te){se.onload=pe,se.onerror=Te}),se.addEventListener("load",function(){W.loading|=1}),se.addEventListener("error",function(){W.loading|=2}),W.loading|=4,Ih(P,a,m)}P={type:"stylesheet",instance:P,count:1,state:W},v.set(E,P)}}}function M2(s,a){pi.X(s,a);var c=Il;if(c&&s){var m=Es(c).hoistableScripts,v=kl(s),E=m.get(v);E||(E=c.querySelector(mu(v)),E||(s=g({src:s,async:!0},a),(a=Gr.get(v))&&_g(s,a),E=c.createElement("script"),fn(E),Ln(E,"link",s),c.head.appendChild(E)),E={type:"script",instance:E,count:1,state:null},m.set(v,E))}}function O2(s,a){pi.M(s,a);var c=Il;if(c&&s){var m=Es(c).hoistableScripts,v=kl(s),E=m.get(v);E||(E=c.querySelector(mu(v)),E||(s=g({src:s,async:!0,type:"module"},a),(a=Gr.get(v))&&_g(s,a),E=c.createElement("script"),fn(E),Ln(E,"link",s),c.head.appendChild(E)),E={type:"script",instance:E,count:1,state:null},m.set(v,E))}}function ax(s,a,c,m){var v=(v=he.current)?Rh(v):null;if(!v)throw Error(r(446));switch(s){case"meta":case"title":return null;case"style":return typeof c.precedence=="string"&&typeof c.href=="string"?(a=Dl(c.href),c=Es(v).hoistableStyles,m=c.get(a),m||(m={type:"style",instance:null,count:0,state:null},c.set(a,m)),m):{type:"void",instance:null,count:0,state:null};case"link":if(c.rel==="stylesheet"&&typeof c.href=="string"&&typeof c.precedence=="string"){s=Dl(c.href);var E=Es(v).hoistableStyles,P=E.get(s);if(P||(v=v.ownerDocument||v,P={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},E.set(s,P),(E=v.querySelector(fu(s)))&&!E._p&&(P.instance=E,P.state.loading=5),Gr.has(s)||(c={rel:"preload",as:"style",href:c.href,crossOrigin:c.crossOrigin,integrity:c.integrity,media:c.media,hrefLang:c.hrefLang,referrerPolicy:c.referrerPolicy},Gr.set(s,c),E||N2(v,s,c,P.state))),a&&m===null)throw Error(r(528,""));return P}if(a&&m!==null)throw Error(r(529,""));return null;case"script":return a=c.async,c=c.src,typeof c=="string"&&a&&typeof a!="function"&&typeof a!="symbol"?(a=kl(c),c=Es(v).hoistableScripts,m=c.get(a),m||(m={type:"script",instance:null,count:0,state:null},c.set(a,m)),m):{type:"void",instance:null,count:0,state:null};default:throw Error(r(444,s))}}function Dl(s){return'href="'+ur(s)+'"'}function fu(s){return'link[rel="stylesheet"]['+s+"]"}function ox(s){return g({},s,{"data-precedence":s.precedence,precedence:null})}function N2(s,a,c,m){s.querySelector('link[rel="preload"][as="style"]['+a+"]")?m.loading=1:(a=s.createElement("link"),m.preload=a,a.addEventListener("load",function(){return m.loading|=1}),a.addEventListener("error",function(){return m.loading|=2}),Ln(a,"link",c),fn(a),s.head.appendChild(a))}function kl(s){return'[src="'+ur(s)+'"]'}function mu(s){return"script[async]"+s}function lx(s,a,c){if(a.count++,a.instance===null)switch(a.type){case"style":var m=s.querySelector('style[data-href~="'+ur(c.href)+'"]');if(m)return a.instance=m,fn(m),m;var v=g({},c,{"data-href":c.href,"data-precedence":c.precedence,href:null,precedence:null});return m=(s.ownerDocument||s).createElement("style"),fn(m),Ln(m,"style",v),Ih(m,c.precedence,s),a.instance=m;case"stylesheet":v=Dl(c.href);var E=s.querySelector(fu(v));if(E)return a.state.loading|=4,a.instance=E,fn(E),E;m=ox(c),(v=Gr.get(v))&&yg(m,v),E=(s.ownerDocument||s).createElement("link"),fn(E);var P=E;return P._p=new Promise(function(W,se){P.onload=W,P.onerror=se}),Ln(E,"link",m),a.state.loading|=4,Ih(E,c.precedence,s),a.instance=E;case"script":return E=kl(c.src),(v=s.querySelector(mu(E)))?(a.instance=v,fn(v),v):(m=c,(v=Gr.get(E))&&(m=g({},c),_g(m,v)),s=s.ownerDocument||s,v=s.createElement("script"),fn(v),Ln(v,"link",m),s.head.appendChild(v),a.instance=v);case"void":return null;default:throw Error(r(443,a.type))}else a.type==="stylesheet"&&(a.state.loading&4)===0&&(m=a.instance,a.state.loading|=4,Ih(m,c.precedence,s));return a.instance}function Ih(s,a,c){for(var m=c.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),v=m.length?m[m.length-1]:null,E=v,P=0;P<m.length;P++){var W=m[P];if(W.dataset.precedence===a)E=W;else if(E!==v)break}E?E.parentNode.insertBefore(s,E.nextSibling):(a=c.nodeType===9?c.head:c,a.insertBefore(s,a.firstChild))}function yg(s,a){s.crossOrigin==null&&(s.crossOrigin=a.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=a.referrerPolicy),s.title==null&&(s.title=a.title)}function _g(s,a){s.crossOrigin==null&&(s.crossOrigin=a.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=a.referrerPolicy),s.integrity==null&&(s.integrity=a.integrity)}var Dh=null;function cx(s,a,c){if(Dh===null){var m=new Map,v=Dh=new Map;v.set(c,m)}else v=Dh,m=v.get(c),m||(m=new Map,v.set(c,m));if(m.has(s))return m;for(m.set(s,null),c=c.getElementsByTagName(s),v=0;v<c.length;v++){var E=c[v];if(!(E[ws]||E[hn]||s==="link"&&E.getAttribute("rel")==="stylesheet")&&E.namespaceURI!=="http://www.w3.org/2000/svg"){var P=E.getAttribute(a)||"";P=s+P;var W=m.get(P);W?W.push(E):m.set(P,[E])}}return m}function ux(s,a,c){s=s.ownerDocument||s,s.head.insertBefore(c,a==="title"?s.querySelector("head > title"):null)}function P2(s,a,c){if(c===1||a.itemProp!=null)return!1;switch(s){case"meta":case"title":return!0;case"style":if(typeof a.precedence!="string"||typeof a.href!="string"||a.href==="")break;return!0;case"link":if(typeof a.rel!="string"||typeof a.href!="string"||a.href===""||a.onLoad||a.onError)break;return a.rel==="stylesheet"?(s=a.disabled,typeof a.precedence=="string"&&s==null):!0;case"script":if(a.async&&typeof a.async!="function"&&typeof a.async!="symbol"&&!a.onLoad&&!a.onError&&a.src&&typeof a.src=="string")return!0}return!1}function dx(s){return!(s.type==="stylesheet"&&(s.state.loading&3)===0)}function B2(s,a,c,m){if(c.type==="stylesheet"&&(typeof m.media!="string"||matchMedia(m.media).matches!==!1)&&(c.state.loading&4)===0){if(c.instance===null){var v=Dl(m.href),E=a.querySelector(fu(v));if(E){a=E._p,a!==null&&typeof a=="object"&&typeof a.then=="function"&&(s.count++,s=kh.bind(s),a.then(s,s)),c.state.loading|=4,c.instance=E,fn(E);return}E=a.ownerDocument||a,m=ox(m),(v=Gr.get(v))&&yg(m,v),E=E.createElement("link"),fn(E);var P=E;P._p=new Promise(function(W,se){P.onload=W,P.onerror=se}),Ln(E,"link",m),c.instance=E}s.stylesheets===null&&(s.stylesheets=new Map),s.stylesheets.set(c,a),(a=c.state.preload)&&(c.state.loading&3)===0&&(s.count++,c=kh.bind(s),a.addEventListener("load",c),a.addEventListener("error",c))}}var bg=0;function z2(s,a){return s.stylesheets&&s.count===0&&Oh(s,s.stylesheets),0<s.count||0<s.imgCount?function(c){var m=setTimeout(function(){if(s.stylesheets&&Oh(s,s.stylesheets),s.unsuspend){var E=s.unsuspend;s.unsuspend=null,E()}},6e4+a);0<s.imgBytes&&bg===0&&(bg=62500*_2());var v=setTimeout(function(){if(s.waitingForImages=!1,s.count===0&&(s.stylesheets&&Oh(s,s.stylesheets),s.unsuspend)){var E=s.unsuspend;s.unsuspend=null,E()}},(s.imgBytes>bg?50:800)+a);return s.unsuspend=c,function(){s.unsuspend=null,clearTimeout(m),clearTimeout(v)}}:null}function kh(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)Oh(this,this.stylesheets);else if(this.unsuspend){var s=this.unsuspend;this.unsuspend=null,s()}}}var Mh=null;function Oh(s,a){s.stylesheets=null,s.unsuspend!==null&&(s.count++,Mh=new Map,a.forEach(L2,s),Mh=null,kh.call(s))}function L2(s,a){if(!(a.state.loading&4)){var c=Mh.get(s);if(c)var m=c.get(null);else{c=new Map,Mh.set(s,c);for(var v=s.querySelectorAll("link[data-precedence],style[data-precedence]"),E=0;E<v.length;E++){var P=v[E];(P.nodeName==="LINK"||P.getAttribute("media")!=="not all")&&(c.set(P.dataset.precedence,P),m=P)}m&&c.set(null,m)}v=a.instance,P=v.getAttribute("data-precedence"),E=c.get(P)||m,E===m&&c.set(null,v),c.set(P,v),this.count++,m=kh.bind(this),v.addEventListener("load",m),v.addEventListener("error",m),E?E.parentNode.insertBefore(v,E.nextSibling):(s=s.nodeType===9?s.head:s,s.insertBefore(v,s.firstChild)),a.state.loading|=4}}var pu={$$typeof:R,Provider:null,Consumer:null,_currentValue:Z,_currentValue2:Z,_threadCount:0};function U2(s,a,c,m,v,E,P,W,se){this.tag=1,this.containerInfo=s,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=vs(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=vs(0),this.hiddenUpdates=vs(null),this.identifierPrefix=m,this.onUncaughtError=v,this.onCaughtError=E,this.onRecoverableError=P,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=se,this.incompleteTransitions=new Map}function hx(s,a,c,m,v,E,P,W,se,pe,Te,De){return s=new U2(s,a,c,P,se,pe,Te,De,W),a=1,E===!0&&(a|=24),E=Cr(3,null,null,a),s.current=E,E.stateNode=s,a=Zm(),a.refCount++,s.pooledCache=a,a.refCount++,E.memoizedState={element:m,isDehydrated:c,cache:a},np(E),s}function fx(s){return s?(s=cl,s):cl}function mx(s,a,c,m,v,E){v=fx(v),m.context===null?m.context=v:m.pendingContext=v,m=Ki(a),m.payload={element:c},E=E===void 0?null:E,E!==null&&(m.callback=E),c=Yi(s,m,a),c!==null&&(gr(c,s,a),Wc(c,s,a))}function px(s,a){if(s=s.memoizedState,s!==null&&s.dehydrated!==null){var c=s.retryLane;s.retryLane=c!==0&&c<a?c:a}}function vg(s,a){px(s,a),(s=s.alternate)&&px(s,a)}function gx(s){if(s.tag===13||s.tag===31){var a=oo(s,67108864);a!==null&&gr(a,s,67108864),vg(s,67108864)}}function yx(s){if(s.tag===13||s.tag===31){var a=Ir();a=Ka(a);var c=oo(s,a);c!==null&&gr(c,s,a),vg(s,a)}}var Nh=!0;function F2(s,a,c,m){var v=Y.T;Y.T=null;var E=G.p;try{G.p=2,xg(s,a,c,m)}finally{G.p=E,Y.T=v}}function V2(s,a,c,m){var v=Y.T;Y.T=null;var E=G.p;try{G.p=8,xg(s,a,c,m)}finally{G.p=E,Y.T=v}}function xg(s,a,c,m){if(Nh){var v=wg(m);if(v===null)og(s,a,m,Ph,c),bx(s,m);else if(q2(v,s,a,c,m))m.stopPropagation();else if(bx(s,m),a&4&&-1<$2.indexOf(s)){for(;v!==null;){var E=Nr(v);if(E!==null)switch(E.tag){case 3:if(E=E.stateNode,E.current.memoizedState.isDehydrated){var P=ir(E.pendingLanes);if(P!==0){var W=E;for(W.pendingLanes|=2,W.entangledLanes|=2;P;){var se=1<<31-Et(P);W.entanglements[1]|=se,P&=~se}Bs(E),(Tt&6)===0&&(_h=Ne()+500,cu(0))}}break;case 31:case 13:W=oo(E,2),W!==null&&gr(W,E,2),vh(),vg(E,2)}if(E=wg(m),E===null&&og(s,a,m,Ph,c),E===v)break;v=E}v!==null&&m.stopPropagation()}else og(s,a,m,null,c)}}function wg(s){return s=Pr(s),Sg(s)}var Ph=null;function Sg(s){if(Ph=null,s=Ss(s),s!==null){var a=o(s);if(a===null)s=null;else{var c=a.tag;if(c===13){if(s=l(a),s!==null)return s;s=null}else if(c===31){if(s=d(a),s!==null)return s;s=null}else if(c===3){if(a.stateNode.current.memoizedState.isDehydrated)return a.tag===3?a.stateNode.containerInfo:null;s=null}else a!==s&&(s=null)}}return Ph=s,null}function _x(s){switch(s){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Oe()){case He:return 2;case xt:return 8;case nt:case Gn:return 32;case gs:return 268435456;default:return 32}default:return 32}}var Eg=!1,oa=null,la=null,ca=null,gu=new Map,yu=new Map,ua=[],$2="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function bx(s,a){switch(s){case"focusin":case"focusout":oa=null;break;case"dragenter":case"dragleave":la=null;break;case"mouseover":case"mouseout":ca=null;break;case"pointerover":case"pointerout":gu.delete(a.pointerId);break;case"gotpointercapture":case"lostpointercapture":yu.delete(a.pointerId)}}function _u(s,a,c,m,v,E){return s===null||s.nativeEvent!==E?(s={blockedOn:a,domEventName:c,eventSystemFlags:m,nativeEvent:E,targetContainers:[v]},a!==null&&(a=Nr(a),a!==null&&gx(a)),s):(s.eventSystemFlags|=m,a=s.targetContainers,v!==null&&a.indexOf(v)===-1&&a.push(v),s)}function q2(s,a,c,m,v){switch(a){case"focusin":return oa=_u(oa,s,a,c,m,v),!0;case"dragenter":return la=_u(la,s,a,c,m,v),!0;case"mouseover":return ca=_u(ca,s,a,c,m,v),!0;case"pointerover":var E=v.pointerId;return gu.set(E,_u(gu.get(E)||null,s,a,c,m,v)),!0;case"gotpointercapture":return E=v.pointerId,yu.set(E,_u(yu.get(E)||null,s,a,c,m,v)),!0}return!1}function vx(s){var a=Ss(s.target);if(a!==null){var c=o(a);if(c!==null){if(a=c.tag,a===13){if(a=l(c),a!==null){s.blockedOn=a,Zr(s.priority,function(){yx(c)});return}}else if(a===31){if(a=d(c),a!==null){s.blockedOn=a,Zr(s.priority,function(){yx(c)});return}}else if(a===3&&c.stateNode.current.memoizedState.isDehydrated){s.blockedOn=c.tag===3?c.stateNode.containerInfo:null;return}}}s.blockedOn=null}function Bh(s){if(s.blockedOn!==null)return!1;for(var a=s.targetContainers;0<a.length;){var c=wg(s.nativeEvent);if(c===null){c=s.nativeEvent;var m=new c.constructor(c.type,c);Dc=m,c.target.dispatchEvent(m),Dc=null}else return a=Nr(c),a!==null&&gx(a),s.blockedOn=c,!1;a.shift()}return!0}function xx(s,a,c){Bh(s)&&c.delete(a)}function H2(){Eg=!1,oa!==null&&Bh(oa)&&(oa=null),la!==null&&Bh(la)&&(la=null),ca!==null&&Bh(ca)&&(ca=null),gu.forEach(xx),yu.forEach(xx)}function zh(s,a){s.blockedOn===a&&(s.blockedOn=null,Eg||(Eg=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,H2)))}var Lh=null;function wx(s){Lh!==s&&(Lh=s,t.unstable_scheduleCallback(t.unstable_NormalPriority,function(){Lh===s&&(Lh=null);for(var a=0;a<s.length;a+=3){var c=s[a],m=s[a+1],v=s[a+2];if(typeof m!="function"){if(Sg(m||c)===null)continue;break}var E=Nr(c);E!==null&&(s.splice(a,3),a-=3,wp(E,{pending:!0,data:v,method:c.method,action:m},m,v))}}))}function Ml(s){function a(se){return zh(se,s)}oa!==null&&zh(oa,s),la!==null&&zh(la,s),ca!==null&&zh(ca,s),gu.forEach(a),yu.forEach(a);for(var c=0;c<ua.length;c++){var m=ua[c];m.blockedOn===s&&(m.blockedOn=null)}for(;0<ua.length&&(c=ua[0],c.blockedOn===null);)vx(c),c.blockedOn===null&&ua.shift();if(c=(s.ownerDocument||s).$$reactFormReplay,c!=null)for(m=0;m<c.length;m+=3){var v=c[m],E=c[m+1],P=v[In]||null;if(typeof E=="function")P||wx(c);else if(P){var W=null;if(E&&E.hasAttribute("formAction")){if(v=E,P=E[In]||null)W=P.formAction;else if(Sg(v)!==null)continue}else W=P.action;typeof W=="function"?c[m+1]=W:(c.splice(m,3),m-=3),wx(c)}}}function Sx(){function s(E){E.canIntercept&&E.info==="react-transition"&&E.intercept({handler:function(){return new Promise(function(P){return v=P})},focusReset:"manual",scroll:"manual"})}function a(){v!==null&&(v(),v=null),m||setTimeout(c,20)}function c(){if(!m&&!navigation.transition){var E=navigation.currentEntry;E&&E.url!=null&&navigation.navigate(E.url,{state:E.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var m=!1,v=null;return navigation.addEventListener("navigate",s),navigation.addEventListener("navigatesuccess",a),navigation.addEventListener("navigateerror",a),setTimeout(c,100),function(){m=!0,navigation.removeEventListener("navigate",s),navigation.removeEventListener("navigatesuccess",a),navigation.removeEventListener("navigateerror",a),v!==null&&(v(),v=null)}}}function Cg(s){this._internalRoot=s}Uh.prototype.render=Cg.prototype.render=function(s){var a=this._internalRoot;if(a===null)throw Error(r(409));var c=a.current,m=Ir();mx(c,m,s,a,null,null)},Uh.prototype.unmount=Cg.prototype.unmount=function(){var s=this._internalRoot;if(s!==null){this._internalRoot=null;var a=s.containerInfo;mx(s.current,2,null,s,null,null),vh(),a[xs]=null}};function Uh(s){this._internalRoot=s}Uh.prototype.unstable_scheduleHydration=function(s){if(s){var a=vd();s={blockedOn:null,target:s,priority:a};for(var c=0;c<ua.length&&a!==0&&a<ua[c].priority;c++);ua.splice(c,0,s),c===0&&vx(s)}};var Ex=e.version;if(Ex!=="19.2.3")throw Error(r(527,Ex,"19.2.3"));G.findDOMNode=function(s){var a=s._reactInternals;if(a===void 0)throw typeof s.render=="function"?Error(r(188)):(s=Object.keys(s).join(","),Error(r(268,s)));return s=f(a),s=s!==null?p(s):null,s=s===null?null:s.stateNode,s};var G2={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:Y,reconcilerVersion:"19.2.3"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Fh=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Fh.isDisabled&&Fh.supportsFiber)try{vt=Fh.inject(G2),nn=Fh}catch{}}return vu.createRoot=function(s,a){if(!i(s))throw Error(r(299));var c=!1,m="",v=Db,E=kb,P=Mb;return a!=null&&(a.unstable_strictMode===!0&&(c=!0),a.identifierPrefix!==void 0&&(m=a.identifierPrefix),a.onUncaughtError!==void 0&&(v=a.onUncaughtError),a.onCaughtError!==void 0&&(E=a.onCaughtError),a.onRecoverableError!==void 0&&(P=a.onRecoverableError)),a=hx(s,1,!1,null,null,c,m,null,v,E,P,Sx),s[xs]=a.current,ag(s),new Cg(a)},vu.hydrateRoot=function(s,a,c){if(!i(s))throw Error(r(299));var m=!1,v="",E=Db,P=kb,W=Mb,se=null;return c!=null&&(c.unstable_strictMode===!0&&(m=!0),c.identifierPrefix!==void 0&&(v=c.identifierPrefix),c.onUncaughtError!==void 0&&(E=c.onUncaughtError),c.onCaughtError!==void 0&&(P=c.onCaughtError),c.onRecoverableError!==void 0&&(W=c.onRecoverableError),c.formState!==void 0&&(se=c.formState)),a=hx(s,1,!0,a,c??null,m,v,se,E,P,W,Sx),a.context=fx(null),c=a.current,m=Ir(),m=Ka(m),v=Ki(m),v.callback=null,Yi(c,v,m),c=m,a.current.lanes=c,Wa(a,c),Bs(a),s[xs]=a.current,ag(s),new Uh(a)},vu.version="19.2.3",vu}var Ox;function r5(){if(Ox)return jg.exports;Ox=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),jg.exports=n5(),jg.exports}var s5=r5();var Nx="popstate";function i5(t={}){function e(r,i){let{pathname:o,search:l,hash:d}=r.location;return Jg("",{pathname:o,search:l,hash:d},i.state&&i.state.usr||null,i.state&&i.state.key||"default")}function n(r,i){return typeof i=="string"?i:Ou(i)}return o5(e,n,null,t)}function Zt(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function kr(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function a5(){return Math.random().toString(36).substring(2,10)}function Px(t,e){return{usr:t.state,key:t.key,idx:e}}function Jg(t,e,n=null,r){return{pathname:typeof t=="string"?t:t.pathname,search:"",hash:"",...typeof e=="string"?sc(e):e,state:n,key:e&&e.key||r||a5()}}function Ou({pathname:t="/",search:e="",hash:n=""}){return e&&e!=="?"&&(t+=e.charAt(0)==="?"?e:"?"+e),n&&n!=="#"&&(t+=n.charAt(0)==="#"?n:"#"+n),t}function sc(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substring(n),t=t.substring(0,n));let r=t.indexOf("?");r>=0&&(e.search=t.substring(r),t=t.substring(0,r)),t&&(e.pathname=t)}return e}function o5(t,e,n,r={}){let{window:i=document.defaultView,v5Compat:o=!1}=r,l=i.history,d="POP",h=null,f=p();f==null&&(f=0,l.replaceState({...l.state,idx:f},""));function p(){return(l.state||{idx:null}).idx}function g(){d="POP";let S=p(),C=S==null?null:S-f;f=S,h&&h({action:d,location:x.location,delta:C})}function b(S,C){d="PUSH";let T=Jg(x.location,S,C);f=p()+1;let R=Px(T,f),D=x.createHref(T);try{l.pushState(R,"",D)}catch(V){if(V instanceof DOMException&&V.name==="DataCloneError")throw V;i.location.assign(D)}o&&h&&h({action:d,location:x.location,delta:1})}function _(S,C){d="REPLACE";let T=Jg(x.location,S,C);f=p();let R=Px(T,f),D=x.createHref(T);l.replaceState(R,"",D),o&&h&&h({action:d,location:x.location,delta:0})}function w(S){return l5(S)}let x={get action(){return d},get location(){return t(i,l)},listen(S){if(h)throw new Error("A history only accepts one active listener");return i.addEventListener(Nx,g),h=S,()=>{i.removeEventListener(Nx,g),h=null}},createHref(S){return e(i,S)},createURL:w,encodeLocation(S){let C=w(S);return{pathname:C.pathname,search:C.search,hash:C.hash}},push:b,replace:_,go(S){return l.go(S)}};return x}function l5(t,e=!1){let n="http://localhost";typeof window<"u"&&(n=window.location.origin!=="null"?window.location.origin:window.location.href),Zt(n,"No window.location.(origin|href) available to create URL");let r=typeof t=="string"?t:Ou(t);return r=r.replace(/ $/,"%20"),!e&&r.startsWith("//")&&(r=n+r),new URL(r,n)}function h1(t,e,n="/"){return c5(t,e,n,!1)}function c5(t,e,n,r){let i=typeof e=="string"?sc(e):e,o=Si(i.pathname||"/",n);if(o==null)return null;let l=f1(t);u5(l);let d=null;for(let h=0;d==null&&h<l.length;++h){let f=x5(o);d=b5(l[h],f,r)}return d}function f1(t,e=[],n=[],r="",i=!1){let o=(l,d,h=i,f)=>{let p={relativePath:f===void 0?l.path||"":f,caseSensitive:l.caseSensitive===!0,childrenIndex:d,route:l};if(p.relativePath.startsWith("/")){if(!p.relativePath.startsWith(r)&&h)return;Zt(p.relativePath.startsWith(r),`Absolute route path "${p.relativePath}" nested under path "${r}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),p.relativePath=p.relativePath.slice(r.length)}let g=xi([r,p.relativePath]),b=n.concat(p);l.children&&l.children.length>0&&(Zt(l.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${g}".`),f1(l.children,e,b,g,h)),!(l.path==null&&!l.index)&&e.push({path:g,score:y5(g,l.index),routesMeta:b})};return t.forEach((l,d)=>{if(l.path===""||!l.path?.includes("?"))o(l,d);else for(let h of m1(l.path))o(l,d,!0,h)}),e}function m1(t){let e=t.split("/");if(e.length===0)return[];let[n,...r]=e,i=n.endsWith("?"),o=n.replace(/\?$/,"");if(r.length===0)return i?[o,""]:[o];let l=m1(r.join("/")),d=[];return d.push(...l.map(h=>h===""?o:[o,h].join("/"))),i&&d.push(...l),d.map(h=>t.startsWith("/")&&h===""?"/":h)}function u5(t){t.sort((e,n)=>e.score!==n.score?n.score-e.score:_5(e.routesMeta.map(r=>r.childrenIndex),n.routesMeta.map(r=>r.childrenIndex)))}var d5=/^:[\w-]+$/,h5=3,f5=2,m5=1,p5=10,g5=-2,Bx=t=>t==="*";function y5(t,e){let n=t.split("/"),r=n.length;return n.some(Bx)&&(r+=g5),e&&(r+=f5),n.filter(i=>!Bx(i)).reduce((i,o)=>i+(d5.test(o)?h5:o===""?m5:p5),r)}function _5(t,e){return t.length===e.length&&t.slice(0,-1).every((r,i)=>r===e[i])?t[t.length-1]-e[e.length-1]:0}function b5(t,e,n=!1){let{routesMeta:r}=t,i={},o="/",l=[];for(let d=0;d<r.length;++d){let h=r[d],f=d===r.length-1,p=o==="/"?e:e.slice(o.length)||"/",g=hf({path:h.relativePath,caseSensitive:h.caseSensitive,end:f},p),b=h.route;if(!g&&f&&n&&!r[r.length-1].route.index&&(g=hf({path:h.relativePath,caseSensitive:h.caseSensitive,end:!1},p)),!g)return null;Object.assign(i,g.params),l.push({params:i,pathname:xi([o,g.pathname]),pathnameBase:C5(xi([o,g.pathnameBase])),route:b}),g.pathnameBase!=="/"&&(o=xi([o,g.pathnameBase]))}return l}function hf(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,r]=v5(t.path,t.caseSensitive,t.end),i=e.match(n);if(!i)return null;let o=i[0],l=o.replace(/(.)\/+$/,"$1"),d=i.slice(1);return{params:r.reduce((f,{paramName:p,isOptional:g},b)=>{if(p==="*"){let w=d[b]||"";l=o.slice(0,o.length-w.length).replace(/(.)\/+$/,"$1")}const _=d[b];return g&&!_?f[p]=void 0:f[p]=(_||"").replace(/%2F/g,"/"),f},{}),pathname:o,pathnameBase:l,pattern:t}}function v5(t,e=!1,n=!0){kr(t==="*"||!t.endsWith("*")||t.endsWith("/*"),`Route path "${t}" will be treated as if it were "${t.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${t.replace(/\*$/,"/*")}".`);let r=[],i="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(l,d,h)=>(r.push({paramName:d,isOptional:h!=null}),h?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return t.endsWith("*")?(r.push({paramName:"*"}),i+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?i+="\\/*$":t!==""&&t!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,e?void 0:"i"),r]}function x5(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return kr(!1,`The URL path "${t}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),t}}function Si(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,r=t.charAt(n);return r&&r!=="/"?null:t.slice(n)||"/"}var p1=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,w5=t=>p1.test(t);function S5(t,e="/"){let{pathname:n,search:r="",hash:i=""}=typeof t=="string"?sc(t):t,o;if(n)if(w5(n))o=n;else{if(n.includes("//")){let l=n;n=n.replace(/\/\/+/g,"/"),kr(!1,`Pathnames cannot have embedded double slashes - normalizing ${l} -> ${n}`)}n.startsWith("/")?o=zx(n.substring(1),"/"):o=zx(n,e)}else o=e;return{pathname:o,search:T5(r),hash:A5(i)}}function zx(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(i=>{i===".."?n.length>1&&n.pop():i!=="."&&n.push(i)}),n.length>1?n.join("/"):"/"}function kg(t,e,n,r){return`Cannot include a '${t}' character in a manually specified \`to.${e}\` field [${JSON.stringify(r)}].  Please separate it out to the \`to.${n}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function E5(t){return t.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function zy(t){let e=E5(t);return e.map((n,r)=>r===e.length-1?n.pathname:n.pathnameBase)}function Ly(t,e,n,r=!1){let i;typeof t=="string"?i=sc(t):(i={...t},Zt(!i.pathname||!i.pathname.includes("?"),kg("?","pathname","search",i)),Zt(!i.pathname||!i.pathname.includes("#"),kg("#","pathname","hash",i)),Zt(!i.search||!i.search.includes("#"),kg("#","search","hash",i)));let o=t===""||i.pathname==="",l=o?"/":i.pathname,d;if(l==null)d=n;else{let g=e.length-1;if(!r&&l.startsWith("..")){let b=l.split("/");for(;b[0]==="..";)b.shift(),g-=1;i.pathname=b.join("/")}d=g>=0?e[g]:"/"}let h=S5(i,d),f=l&&l!=="/"&&l.endsWith("/"),p=(o||l===".")&&n.endsWith("/");return!h.pathname.endsWith("/")&&(f||p)&&(h.pathname+="/"),h}var xi=t=>t.join("/").replace(/\/\/+/g,"/"),C5=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),T5=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,A5=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t,j5=class{constructor(t,e,n,r=!1){this.status=t,this.statusText=e||"",this.internal=r,n instanceof Error?(this.data=n.toString(),this.error=n):this.data=n}};function R5(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}function I5(t){return t.map(e=>e.route.path).filter(Boolean).join("/").replace(/\/\/*/g,"/")||"/"}var g1=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function y1(t,e){let n=t;if(typeof n!="string"||!p1.test(n))return{absoluteURL:void 0,isExternal:!1,to:n};let r=n,i=!1;if(g1)try{let o=new URL(window.location.href),l=n.startsWith("//")?new URL(o.protocol+n):new URL(n),d=Si(l.pathname,e);l.origin===o.origin&&d!=null?n=d+l.search+l.hash:i=!0}catch{kr(!1,`<Link to="${n}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}return{absoluteURL:r,isExternal:i,to:n}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var _1=["POST","PUT","PATCH","DELETE"];new Set(_1);var D5=["GET",..._1];new Set(D5);var ic=j.createContext(null);ic.displayName="DataRouter";var Vf=j.createContext(null);Vf.displayName="DataRouterState";var k5=j.createContext(!1),b1=j.createContext({isTransitioning:!1});b1.displayName="ViewTransition";var M5=j.createContext(new Map);M5.displayName="Fetchers";var O5=j.createContext(null);O5.displayName="Await";var Mr=j.createContext(null);Mr.displayName="Navigation";var Yu=j.createContext(null);Yu.displayName="Location";var Yr=j.createContext({outlet:null,matches:[],isDataRoute:!1});Yr.displayName="Route";var Uy=j.createContext(null);Uy.displayName="RouteError";var v1="REACT_ROUTER_ERROR",N5="REDIRECT",P5="ROUTE_ERROR_RESPONSE";function B5(t){if(t.startsWith(`${v1}:${N5}:{`))try{let e=JSON.parse(t.slice(28));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.location=="string"&&typeof e.reloadDocument=="boolean"&&typeof e.replace=="boolean")return e}catch{}}function z5(t){if(t.startsWith(`${v1}:${P5}:{`))try{let e=JSON.parse(t.slice(40));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string")return new j5(e.status,e.statusText,e.data)}catch{}}function L5(t,{relative:e}={}){Zt(ac(),"useHref() may be used only in the context of a <Router> component.");let{basename:n,navigator:r}=j.useContext(Mr),{hash:i,pathname:o,search:l}=Zu(t,{relative:e}),d=o;return n!=="/"&&(d=o==="/"?n:xi([n,o])),r.createHref({pathname:d,search:l,hash:i})}function ac(){return j.useContext(Yu)!=null}function tr(){return Zt(ac(),"useLocation() may be used only in the context of a <Router> component."),j.useContext(Yu).location}var x1="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function w1(t){j.useContext(Mr).static||j.useLayoutEffect(t)}function Xu(){let{isDataRoute:t}=j.useContext(Yr);return t?tj():U5()}function U5(){Zt(ac(),"useNavigate() may be used only in the context of a <Router> component.");let t=j.useContext(ic),{basename:e,navigator:n}=j.useContext(Mr),{matches:r}=j.useContext(Yr),{pathname:i}=tr(),o=JSON.stringify(zy(r)),l=j.useRef(!1);return w1(()=>{l.current=!0}),j.useCallback((h,f={})=>{if(kr(l.current,x1),!l.current)return;if(typeof h=="number"){n.go(h);return}let p=Ly(h,JSON.parse(o),i,f.relative==="path");t==null&&e!=="/"&&(p.pathname=p.pathname==="/"?e:xi([e,p.pathname])),(f.replace?n.replace:n.push)(p,f.state,f)},[e,n,o,i,t])}var F5=j.createContext(null);function V5(t){let e=j.useContext(Yr).outlet;return j.useMemo(()=>e&&j.createElement(F5.Provider,{value:t},e),[e,t])}function $5(){let{matches:t}=j.useContext(Yr),e=t[t.length-1];return e?e.params:{}}function Zu(t,{relative:e}={}){let{matches:n}=j.useContext(Yr),{pathname:r}=tr(),i=JSON.stringify(zy(n));return j.useMemo(()=>Ly(t,JSON.parse(i),r,e==="path"),[t,i,r,e])}function q5(t,e){return S1(t,e)}function S1(t,e,n,r,i){Zt(ac(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:o}=j.useContext(Mr),{matches:l}=j.useContext(Yr),d=l[l.length-1],h=d?d.params:{},f=d?d.pathname:"/",p=d?d.pathnameBase:"/",g=d&&d.route;{let T=g&&g.path||"";C1(f,!g||T.endsWith("*")||T.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${f}" (under <Route path="${T}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${T}"> to <Route path="${T==="/"?"*":`${T}/*`}">.`)}let b=tr(),_;if(e){let T=typeof e=="string"?sc(e):e;Zt(p==="/"||T.pathname?.startsWith(p),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${p}" but pathname "${T.pathname}" was given in the \`location\` prop.`),_=T}else _=b;let w=_.pathname||"/",x=w;if(p!=="/"){let T=p.replace(/^\//,"").split("/");x="/"+w.replace(/^\//,"").split("/").slice(T.length).join("/")}let S=h1(t,{pathname:x});kr(g||S!=null,`No routes matched location "${_.pathname}${_.search}${_.hash}" `),kr(S==null||S[S.length-1].route.element!==void 0||S[S.length-1].route.Component!==void 0||S[S.length-1].route.lazy!==void 0,`Matched leaf route at location "${_.pathname}${_.search}${_.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let C=K5(S&&S.map(T=>Object.assign({},T,{params:Object.assign({},h,T.params),pathname:xi([p,o.encodeLocation?o.encodeLocation(T.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:T.pathname]),pathnameBase:T.pathnameBase==="/"?p:xi([p,o.encodeLocation?o.encodeLocation(T.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:T.pathnameBase])})),l,n,r,i);return e&&C?j.createElement(Yu.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",..._},navigationType:"POP"}},C):C}function H5(){let t=ej(),e=R5(t)?`${t.status} ${t.statusText}`:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,r="rgba(200,200,200, 0.5)",i={padding:"0.5rem",backgroundColor:r},o={padding:"2px 4px",backgroundColor:r},l=null;return console.error("Error handled by React Router default ErrorBoundary:",t),l=j.createElement(j.Fragment,null,j.createElement("p",null," Hey developer "),j.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",j.createElement("code",{style:o},"ErrorBoundary")," or"," ",j.createElement("code",{style:o},"errorElement")," prop on your route.")),j.createElement(j.Fragment,null,j.createElement("h2",null,"Unexpected Application Error!"),j.createElement("h3",{style:{fontStyle:"italic"}},e),n?j.createElement("pre",{style:i},n):null,l)}var G5=j.createElement(H5,null),E1=class extends j.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,e){return e.location!==t.location||e.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:e.error,location:e.location,revalidation:t.revalidation||e.revalidation}}componentDidCatch(t,e){this.props.onError?this.props.onError(t,e):console.error("React Router caught the following error during render",t)}render(){let t=this.state.error;if(this.context&&typeof t=="object"&&t&&"digest"in t&&typeof t.digest=="string"){const n=z5(t.digest);n&&(t=n)}let e=t!==void 0?j.createElement(Yr.Provider,{value:this.props.routeContext},j.createElement(Uy.Provider,{value:t,children:this.props.component})):this.props.children;return this.context?j.createElement(W5,{error:t},e):e}};E1.contextType=k5;var Mg=new WeakMap;function W5({children:t,error:e}){let{basename:n}=j.useContext(Mr);if(typeof e=="object"&&e&&"digest"in e&&typeof e.digest=="string"){let r=B5(e.digest);if(r){let i=Mg.get(e);if(i)throw i;let o=y1(r.location,n);if(g1&&!Mg.get(e))if(o.isExternal||r.reloadDocument)window.location.href=o.absoluteURL||o.to;else{const l=Promise.resolve().then(()=>window.__reactRouterDataRouter.navigate(o.to,{replace:r.replace}));throw Mg.set(e,l),l}return j.createElement("meta",{httpEquiv:"refresh",content:`0;url=${o.absoluteURL||o.to}`})}}return t}function Q5({routeContext:t,match:e,children:n}){let r=j.useContext(ic);return r&&r.static&&r.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=e.route.id),j.createElement(Yr.Provider,{value:t},n)}function K5(t,e=[],n=null,r=null,i=null){if(t==null){if(!n)return null;if(n.errors)t=n.matches;else if(e.length===0&&!n.initialized&&n.matches.length>0)t=n.matches;else return null}let o=t,l=n?.errors;if(l!=null){let p=o.findIndex(g=>g.route.id&&l?.[g.route.id]!==void 0);Zt(p>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(l).join(",")}`),o=o.slice(0,Math.min(o.length,p+1))}let d=!1,h=-1;if(n)for(let p=0;p<o.length;p++){let g=o[p];if((g.route.HydrateFallback||g.route.hydrateFallbackElement)&&(h=p),g.route.id){let{loaderData:b,errors:_}=n,w=g.route.loader&&!b.hasOwnProperty(g.route.id)&&(!_||_[g.route.id]===void 0);if(g.route.lazy||w){d=!0,h>=0?o=o.slice(0,h+1):o=[o[0]];break}}}let f=n&&r?(p,g)=>{r(p,{location:n.location,params:n.matches?.[0]?.params??{},unstable_pattern:I5(n.matches),errorInfo:g})}:void 0;return o.reduceRight((p,g,b)=>{let _,w=!1,x=null,S=null;n&&(_=l&&g.route.id?l[g.route.id]:void 0,x=g.route.errorElement||G5,d&&(h<0&&b===0?(C1("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),w=!0,S=null):h===b&&(w=!0,S=g.route.hydrateFallbackElement||null)));let C=e.concat(o.slice(0,b+1)),T=()=>{let R;return _?R=x:w?R=S:g.route.Component?R=j.createElement(g.route.Component,null):g.route.element?R=g.route.element:R=p,j.createElement(Q5,{match:g,routeContext:{outlet:p,matches:C,isDataRoute:n!=null},children:R})};return n&&(g.route.ErrorBoundary||g.route.errorElement||b===0)?j.createElement(E1,{location:n.location,revalidation:n.revalidation,component:x,error:_,children:T(),routeContext:{outlet:null,matches:C,isDataRoute:!0},onError:f}):T()},null)}function Fy(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function Y5(t){let e=j.useContext(ic);return Zt(e,Fy(t)),e}function X5(t){let e=j.useContext(Vf);return Zt(e,Fy(t)),e}function Z5(t){let e=j.useContext(Yr);return Zt(e,Fy(t)),e}function Vy(t){let e=Z5(t),n=e.matches[e.matches.length-1];return Zt(n.route.id,`${t} can only be used on routes that contain a unique "id"`),n.route.id}function J5(){return Vy("useRouteId")}function ej(){let t=j.useContext(Uy),e=X5("useRouteError"),n=Vy("useRouteError");return t!==void 0?t:e.errors?.[n]}function tj(){let{router:t}=Y5("useNavigate"),e=Vy("useNavigate"),n=j.useRef(!1);return w1(()=>{n.current=!0}),j.useCallback(async(i,o={})=>{kr(n.current,x1),n.current&&(typeof i=="number"?await t.navigate(i):await t.navigate(i,{fromRouteId:e,...o}))},[t,e])}var Lx={};function C1(t,e,n){!e&&!Lx[t]&&(Lx[t]=!0,kr(!1,n))}j.memo(nj);function nj({routes:t,future:e,state:n,onError:r}){return S1(t,void 0,n,r,e)}function $f({to:t,replace:e,state:n,relative:r}){Zt(ac(),"<Navigate> may be used only in the context of a <Router> component.");let{static:i}=j.useContext(Mr);kr(!i,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:o}=j.useContext(Yr),{pathname:l}=tr(),d=Xu(),h=Ly(t,zy(o),l,r==="path"),f=JSON.stringify(h);return j.useEffect(()=>{d(JSON.parse(f),{replace:e,state:n,relative:r})},[d,f,r,e,n]),null}function qf(t){return V5(t.context)}function En(t){Zt(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function rj({basename:t="/",children:e=null,location:n,navigationType:r="POP",navigator:i,static:o=!1,unstable_useTransitions:l}){Zt(!ac(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let d=t.replace(/^\/*/,"/"),h=j.useMemo(()=>({basename:d,navigator:i,static:o,unstable_useTransitions:l,future:{}}),[d,i,o,l]);typeof n=="string"&&(n=sc(n));let{pathname:f="/",search:p="",hash:g="",state:b=null,key:_="default"}=n,w=j.useMemo(()=>{let x=Si(f,d);return x==null?null:{location:{pathname:x,search:p,hash:g,state:b,key:_},navigationType:r}},[d,f,p,g,b,_,r]);return kr(w!=null,`<Router basename="${d}"> is not able to match the URL "${f}${p}${g}" because it does not start with the basename, so the <Router> won't render anything.`),w==null?null:j.createElement(Mr.Provider,{value:h},j.createElement(Yu.Provider,{children:e,value:w}))}function sj({children:t,location:e}){return q5(ey(t),e)}function ey(t,e=[]){let n=[];return j.Children.forEach(t,(r,i)=>{if(!j.isValidElement(r))return;let o=[...e,i];if(r.type===j.Fragment){n.push.apply(n,ey(r.props.children,o));return}Zt(r.type===En,`[${typeof r.type=="string"?r.type:r.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),Zt(!r.props.index||!r.props.children,"An index route cannot have child routes.");let l={id:r.props.id||o.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,middleware:r.props.middleware,loader:r.props.loader,action:r.props.action,hydrateFallbackElement:r.props.hydrateFallbackElement,HydrateFallback:r.props.HydrateFallback,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.hasErrorBoundary===!0||r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(l.children=ey(r.props.children,o)),n.push(l)}),n}var Jh="get",ef="application/x-www-form-urlencoded";function Hf(t){return typeof HTMLElement<"u"&&t instanceof HTMLElement}function ij(t){return Hf(t)&&t.tagName.toLowerCase()==="button"}function aj(t){return Hf(t)&&t.tagName.toLowerCase()==="form"}function oj(t){return Hf(t)&&t.tagName.toLowerCase()==="input"}function lj(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function cj(t,e){return t.button===0&&(!e||e==="_self")&&!lj(t)}function ty(t=""){return new URLSearchParams(typeof t=="string"||Array.isArray(t)||t instanceof URLSearchParams?t:Object.keys(t).reduce((e,n)=>{let r=t[n];return e.concat(Array.isArray(r)?r.map(i=>[n,i]):[[n,r]])},[]))}function uj(t,e){let n=ty(t);return e&&e.forEach((r,i)=>{n.has(i)||e.getAll(i).forEach(o=>{n.append(i,o)})}),n}var $h=null;function dj(){if($h===null)try{new FormData(document.createElement("form"),0),$h=!1}catch{$h=!0}return $h}var hj=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function Og(t){return t!=null&&!hj.has(t)?(kr(!1,`"${t}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${ef}"`),null):t}function fj(t,e){let n,r,i,o,l;if(aj(t)){let d=t.getAttribute("action");r=d?Si(d,e):null,n=t.getAttribute("method")||Jh,i=Og(t.getAttribute("enctype"))||ef,o=new FormData(t)}else if(ij(t)||oj(t)&&(t.type==="submit"||t.type==="image")){let d=t.form;if(d==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let h=t.getAttribute("formaction")||d.getAttribute("action");if(r=h?Si(h,e):null,n=t.getAttribute("formmethod")||d.getAttribute("method")||Jh,i=Og(t.getAttribute("formenctype"))||Og(d.getAttribute("enctype"))||ef,o=new FormData(d,t),!dj()){let{name:f,type:p,value:g}=t;if(p==="image"){let b=f?`${f}.`:"";o.append(`${b}x`,"0"),o.append(`${b}y`,"0")}else f&&o.append(f,g)}}else{if(Hf(t))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');n=Jh,r=null,i=ef,l=t}return o&&i==="text/plain"&&(l=o,o=void 0),{action:r,method:n.toLowerCase(),encType:i,formData:o,body:l}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function $y(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function mj(t,e,n){let r=typeof t=="string"?new URL(t,typeof window>"u"?"server://singlefetch/":window.location.origin):t;return r.pathname==="/"?r.pathname=`_root.${n}`:e&&Si(r.pathname,e)==="/"?r.pathname=`${e.replace(/\/$/,"")}/_root.${n}`:r.pathname=`${r.pathname.replace(/\/$/,"")}.${n}`,r}async function pj(t,e){if(t.id in e)return e[t.id];try{let n=await import(t.module);return e[t.id]=n,n}catch(n){return console.error(`Error loading route module \`${t.module}\`, reloading page...`),console.error(n),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function gj(t){return t==null?!1:t.href==null?t.rel==="preload"&&typeof t.imageSrcSet=="string"&&typeof t.imageSizes=="string":typeof t.rel=="string"&&typeof t.href=="string"}async function yj(t,e,n){let r=await Promise.all(t.map(async i=>{let o=e.routes[i.route.id];if(o){let l=await pj(o,n);return l.links?l.links():[]}return[]}));return xj(r.flat(1).filter(gj).filter(i=>i.rel==="stylesheet"||i.rel==="preload").map(i=>i.rel==="stylesheet"?{...i,rel:"prefetch",as:"style"}:{...i,rel:"prefetch"}))}function Ux(t,e,n,r,i,o){let l=(h,f)=>n[f]?h.route.id!==n[f].route.id:!0,d=(h,f)=>n[f].pathname!==h.pathname||n[f].route.path?.endsWith("*")&&n[f].params["*"]!==h.params["*"];return o==="assets"?e.filter((h,f)=>l(h,f)||d(h,f)):o==="data"?e.filter((h,f)=>{let p=r.routes[h.route.id];if(!p||!p.hasLoader)return!1;if(l(h,f)||d(h,f))return!0;if(h.route.shouldRevalidate){let g=h.route.shouldRevalidate({currentUrl:new URL(i.pathname+i.search+i.hash,window.origin),currentParams:n[0]?.params||{},nextUrl:new URL(t,window.origin),nextParams:h.params,defaultShouldRevalidate:!0});if(typeof g=="boolean")return g}return!0}):[]}function _j(t,e,{includeHydrateFallback:n}={}){return bj(t.map(r=>{let i=e.routes[r.route.id];if(!i)return[];let o=[i.module];return i.clientActionModule&&(o=o.concat(i.clientActionModule)),i.clientLoaderModule&&(o=o.concat(i.clientLoaderModule)),n&&i.hydrateFallbackModule&&(o=o.concat(i.hydrateFallbackModule)),i.imports&&(o=o.concat(i.imports)),o}).flat(1))}function bj(t){return[...new Set(t)]}function vj(t){let e={},n=Object.keys(t).sort();for(let r of n)e[r]=t[r];return e}function xj(t,e){let n=new Set;return new Set(e),t.reduce((r,i)=>{let o=JSON.stringify(vj(i));return n.has(o)||(n.add(o),r.push({key:o,link:i})),r},[])}function T1(){let t=j.useContext(ic);return $y(t,"You must render this element inside a <DataRouterContext.Provider> element"),t}function wj(){let t=j.useContext(Vf);return $y(t,"You must render this element inside a <DataRouterStateContext.Provider> element"),t}var qy=j.createContext(void 0);qy.displayName="FrameworkContext";function A1(){let t=j.useContext(qy);return $y(t,"You must render this element inside a <HydratedRouter> element"),t}function Sj(t,e){let n=j.useContext(qy),[r,i]=j.useState(!1),[o,l]=j.useState(!1),{onFocus:d,onBlur:h,onMouseEnter:f,onMouseLeave:p,onTouchStart:g}=e,b=j.useRef(null);j.useEffect(()=>{if(t==="render"&&l(!0),t==="viewport"){let x=C=>{C.forEach(T=>{l(T.isIntersecting)})},S=new IntersectionObserver(x,{threshold:.5});return b.current&&S.observe(b.current),()=>{S.disconnect()}}},[t]),j.useEffect(()=>{if(r){let x=setTimeout(()=>{l(!0)},100);return()=>{clearTimeout(x)}}},[r]);let _=()=>{i(!0)},w=()=>{i(!1),l(!1)};return n?t!=="intent"?[o,b,{}]:[o,b,{onFocus:xu(d,_),onBlur:xu(h,w),onMouseEnter:xu(f,_),onMouseLeave:xu(p,w),onTouchStart:xu(g,_)}]:[!1,b,{}]}function xu(t,e){return n=>{t&&t(n),n.defaultPrevented||e(n)}}function Ej({page:t,...e}){let{router:n}=T1(),r=j.useMemo(()=>h1(n.routes,t,n.basename),[n.routes,t,n.basename]);return r?j.createElement(Tj,{page:t,matches:r,...e}):null}function Cj(t){let{manifest:e,routeModules:n}=A1(),[r,i]=j.useState([]);return j.useEffect(()=>{let o=!1;return yj(t,e,n).then(l=>{o||i(l)}),()=>{o=!0}},[t,e,n]),r}function Tj({page:t,matches:e,...n}){let r=tr(),{manifest:i,routeModules:o}=A1(),{basename:l}=T1(),{loaderData:d,matches:h}=wj(),f=j.useMemo(()=>Ux(t,e,h,i,r,"data"),[t,e,h,i,r]),p=j.useMemo(()=>Ux(t,e,h,i,r,"assets"),[t,e,h,i,r]),g=j.useMemo(()=>{if(t===r.pathname+r.search+r.hash)return[];let w=new Set,x=!1;if(e.forEach(C=>{let T=i.routes[C.route.id];!T||!T.hasLoader||(!f.some(R=>R.route.id===C.route.id)&&C.route.id in d&&o[C.route.id]?.shouldRevalidate||T.hasClientLoader?x=!0:w.add(C.route.id))}),w.size===0)return[];let S=mj(t,l,"data");return x&&w.size>0&&S.searchParams.set("_routes",e.filter(C=>w.has(C.route.id)).map(C=>C.route.id).join(",")),[S.pathname+S.search]},[l,d,r,i,f,e,t,o]),b=j.useMemo(()=>_j(p,i),[p,i]),_=Cj(p);return j.createElement(j.Fragment,null,g.map(w=>j.createElement("link",{key:w,rel:"prefetch",as:"fetch",href:w,...n})),b.map(w=>j.createElement("link",{key:w,rel:"modulepreload",href:w,...n})),_.map(({key:w,link:x})=>j.createElement("link",{key:w,nonce:n.nonce,...x})))}function Aj(...t){return e=>{t.forEach(n=>{typeof n=="function"?n(e):n!=null&&(n.current=e)})}}var jj=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{jj&&(window.__reactRouterVersion="7.11.0")}catch{}function Rj({basename:t,children:e,unstable_useTransitions:n,window:r}){let i=j.useRef();i.current==null&&(i.current=i5({window:r,v5Compat:!0}));let o=i.current,[l,d]=j.useState({action:o.action,location:o.location}),h=j.useCallback(f=>{n===!1?d(f):j.startTransition(()=>d(f))},[n]);return j.useLayoutEffect(()=>o.listen(h),[o,h]),j.createElement(rj,{basename:t,children:e,location:l.location,navigationType:l.action,navigator:o,unstable_useTransitions:n})}var j1=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Tn=j.forwardRef(function({onClick:e,discover:n="render",prefetch:r="none",relative:i,reloadDocument:o,replace:l,state:d,target:h,to:f,preventScrollReset:p,viewTransition:g,unstable_defaultShouldRevalidate:b,..._},w){let{basename:x,unstable_useTransitions:S}=j.useContext(Mr),C=typeof f=="string"&&j1.test(f),T=y1(f,x);f=T.to;let R=L5(f,{relative:i}),[D,V,$]=Sj(r,_),k=Mj(f,{replace:l,state:d,target:h,preventScrollReset:p,relative:i,viewTransition:g,unstable_defaultShouldRevalidate:b,unstable_useTransitions:S});function M(U){e&&e(U),U.defaultPrevented||k(U)}let B=j.createElement("a",{..._,...$,href:T.absoluteURL||R,onClick:T.isExternal||o?e:M,ref:Aj(w,V),target:h,"data-discover":!C&&n==="render"?"true":void 0});return D&&!C?j.createElement(j.Fragment,null,B,j.createElement(Ej,{page:R})):B});Tn.displayName="Link";var Ij=j.forwardRef(function({"aria-current":e="page",caseSensitive:n=!1,className:r="",end:i=!1,style:o,to:l,viewTransition:d,children:h,...f},p){let g=Zu(l,{relative:f.relative}),b=tr(),_=j.useContext(Vf),{navigator:w,basename:x}=j.useContext(Mr),S=_!=null&&zj(g)&&d===!0,C=w.encodeLocation?w.encodeLocation(g).pathname:g.pathname,T=b.pathname,R=_&&_.navigation&&_.navigation.location?_.navigation.location.pathname:null;n||(T=T.toLowerCase(),R=R?R.toLowerCase():null,C=C.toLowerCase()),R&&x&&(R=Si(R,x)||R);const D=C!=="/"&&C.endsWith("/")?C.length-1:C.length;let V=T===C||!i&&T.startsWith(C)&&T.charAt(D)==="/",$=R!=null&&(R===C||!i&&R.startsWith(C)&&R.charAt(C.length)==="/"),k={isActive:V,isPending:$,isTransitioning:S},M=V?e:void 0,B;typeof r=="function"?B=r(k):B=[r,V?"active":null,$?"pending":null,S?"transitioning":null].filter(Boolean).join(" ");let U=typeof o=="function"?o(k):o;return j.createElement(Tn,{...f,"aria-current":M,className:B,ref:p,style:U,to:l,viewTransition:d},typeof h=="function"?h(k):h)});Ij.displayName="NavLink";var Dj=j.forwardRef(({discover:t="render",fetcherKey:e,navigate:n,reloadDocument:r,replace:i,state:o,method:l=Jh,action:d,onSubmit:h,relative:f,preventScrollReset:p,viewTransition:g,unstable_defaultShouldRevalidate:b,..._},w)=>{let{unstable_useTransitions:x}=j.useContext(Mr),S=Pj(),C=Bj(d,{relative:f}),T=l.toLowerCase()==="get"?"get":"post",R=typeof d=="string"&&j1.test(d),D=V=>{if(h&&h(V),V.defaultPrevented)return;V.preventDefault();let $=V.nativeEvent.submitter,k=$?.getAttribute("formmethod")||l,M=()=>S($||V.currentTarget,{fetcherKey:e,method:k,navigate:n,replace:i,state:o,relative:f,preventScrollReset:p,viewTransition:g,unstable_defaultShouldRevalidate:b});x&&n!==!1?j.startTransition(()=>M()):M()};return j.createElement("form",{ref:w,method:T,action:C,onSubmit:r?h:D,..._,"data-discover":!R&&t==="render"?"true":void 0})});Dj.displayName="Form";function kj(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function R1(t){let e=j.useContext(ic);return Zt(e,kj(t)),e}function Mj(t,{target:e,replace:n,state:r,preventScrollReset:i,relative:o,viewTransition:l,unstable_defaultShouldRevalidate:d,unstable_useTransitions:h}={}){let f=Xu(),p=tr(),g=Zu(t,{relative:o});return j.useCallback(b=>{if(cj(b,e)){b.preventDefault();let _=n!==void 0?n:Ou(p)===Ou(g),w=()=>f(t,{replace:_,state:r,preventScrollReset:i,relative:o,viewTransition:l,unstable_defaultShouldRevalidate:d});h?j.startTransition(()=>w()):w()}},[p,f,g,n,r,e,t,i,o,l,d,h])}function I1(t){kr(typeof URLSearchParams<"u","You cannot use the `useSearchParams` hook in a browser that does not support the URLSearchParams API. If you need to support Internet Explorer 11, we recommend you load a polyfill such as https://github.com/ungap/url-search-params.");let e=j.useRef(ty(t)),n=j.useRef(!1),r=tr(),i=j.useMemo(()=>uj(r.search,n.current?null:e.current),[r.search]),o=Xu(),l=j.useCallback((d,h)=>{const f=ty(typeof d=="function"?d(new URLSearchParams(i)):d);n.current=!0,o("?"+f,h)},[o,i]);return[i,l]}var Oj=0,Nj=()=>`__${String(++Oj)}__`;function Pj(){let{router:t}=R1("useSubmit"),{basename:e}=j.useContext(Mr),n=J5(),r=t.fetch,i=t.navigate;return j.useCallback(async(o,l={})=>{let{action:d,method:h,encType:f,formData:p,body:g}=fj(o,e);if(l.navigate===!1){let b=l.fetcherKey||Nj();await r(b,n,l.action||d,{unstable_defaultShouldRevalidate:l.unstable_defaultShouldRevalidate,preventScrollReset:l.preventScrollReset,formData:p,body:g,formMethod:l.method||h,formEncType:l.encType||f,flushSync:l.flushSync})}else await i(l.action||d,{unstable_defaultShouldRevalidate:l.unstable_defaultShouldRevalidate,preventScrollReset:l.preventScrollReset,formData:p,body:g,formMethod:l.method||h,formEncType:l.encType||f,replace:l.replace,state:l.state,fromRouteId:n,flushSync:l.flushSync,viewTransition:l.viewTransition})},[r,i,e,n])}function Bj(t,{relative:e}={}){let{basename:n}=j.useContext(Mr),r=j.useContext(Yr);Zt(r,"useFormAction must be used inside a RouteContext");let[i]=r.matches.slice(-1),o={...Zu(t||".",{relative:e})},l=tr();if(t==null){o.search=l.search;let d=new URLSearchParams(o.search),h=d.getAll("index");if(h.some(p=>p==="")){d.delete("index"),h.filter(g=>g).forEach(g=>d.append("index",g));let p=d.toString();o.search=p?`?${p}`:""}}return(!t||t===".")&&i.route.index&&(o.search=o.search?o.search.replace(/^\?/,"?index&"):"?index"),n!=="/"&&(o.pathname=o.pathname==="/"?n:xi([n,o.pathname])),Ou(o)}function zj(t,{relative:e}={}){let n=j.useContext(b1);Zt(n!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:r}=R1("useViewTransitionState"),i=Zu(t,{relative:e});if(!n.isTransitioning)return!1;let o=Si(n.currentLocation.pathname,r)||n.currentLocation.pathname,l=Si(n.nextLocation.pathname,r)||n.nextLocation.pathname;return hf(i.pathname,l)!=null||hf(i.pathname,o)!=null}var oc=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(t){return this.listeners.add(t),this.onSubscribe(),()=>{this.listeners.delete(t),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},Lj={setTimeout:(t,e)=>setTimeout(t,e),clearTimeout:t=>clearTimeout(t),setInterval:(t,e)=>setInterval(t,e),clearInterval:t=>clearInterval(t)},Uj=class{#e=Lj;#t=!1;setTimeoutProvider(t){this.#e=t}setTimeout(t,e){return this.#e.setTimeout(t,e)}clearTimeout(t){this.#e.clearTimeout(t)}setInterval(t,e){return this.#e.setInterval(t,e)}clearInterval(t){this.#e.clearInterval(t)}},Co=new Uj;function Fj(t){setTimeout(t,0)}var Ro=typeof window>"u"||"Deno"in globalThis;function lr(){}function Vj(t,e){return typeof t=="function"?t(e):t}function ny(t){return typeof t=="number"&&t>=0&&t!==1/0}function D1(t,e){return Math.max(t+(e||0)-Date.now(),0)}function wa(t,e){return typeof t=="function"?t(e):t}function Wr(t,e){return typeof t=="function"?t(e):t}function Fx(t,e){const{type:n="all",exact:r,fetchStatus:i,predicate:o,queryKey:l,stale:d}=t;if(l){if(r){if(e.queryHash!==Hy(l,e.options))return!1}else if(!Nu(e.queryKey,l))return!1}if(n!=="all"){const h=e.isActive();if(n==="active"&&!h||n==="inactive"&&h)return!1}return!(typeof d=="boolean"&&e.isStale()!==d||i&&i!==e.state.fetchStatus||o&&!o(e))}function Vx(t,e){const{exact:n,status:r,predicate:i,mutationKey:o}=t;if(o){if(!e.options.mutationKey)return!1;if(n){if(Io(e.options.mutationKey)!==Io(o))return!1}else if(!Nu(e.options.mutationKey,o))return!1}return!(r&&e.state.status!==r||i&&!i(e))}function Hy(t,e){return(e?.queryKeyHashFn||Io)(t)}function Io(t){return JSON.stringify(t,(e,n)=>ry(n)?Object.keys(n).sort().reduce((r,i)=>(r[i]=n[i],r),{}):n)}function Nu(t,e){return t===e?!0:typeof t!=typeof e?!1:t&&e&&typeof t=="object"&&typeof e=="object"?Object.keys(e).every(n=>Nu(t[n],e[n])):!1}var $j=Object.prototype.hasOwnProperty;function k1(t,e){if(t===e)return t;const n=$x(t)&&$x(e);if(!n&&!(ry(t)&&ry(e)))return e;const i=(n?t:Object.keys(t)).length,o=n?e:Object.keys(e),l=o.length,d=n?new Array(l):{};let h=0;for(let f=0;f<l;f++){const p=n?f:o[f],g=t[p],b=e[p];if(g===b){d[p]=g,(n?f<i:$j.call(t,p))&&h++;continue}if(g===null||b===null||typeof g!="object"||typeof b!="object"){d[p]=b;continue}const _=k1(g,b);d[p]=_,_===g&&h++}return i===l&&h===i?t:d}function ff(t,e){if(!e||Object.keys(t).length!==Object.keys(e).length)return!1;for(const n in t)if(t[n]!==e[n])return!1;return!0}function $x(t){return Array.isArray(t)&&t.length===Object.keys(t).length}function ry(t){if(!qx(t))return!1;const e=t.constructor;if(e===void 0)return!0;const n=e.prototype;return!(!qx(n)||!n.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(t)!==Object.prototype)}function qx(t){return Object.prototype.toString.call(t)==="[object Object]"}function qj(t){return new Promise(e=>{Co.setTimeout(e,t)})}function sy(t,e,n){return typeof n.structuralSharing=="function"?n.structuralSharing(t,e):n.structuralSharing!==!1?k1(t,e):e}function Hj(t,e,n=0){const r=[...t,e];return n&&r.length>n?r.slice(1):r}function Gj(t,e,n=0){const r=[e,...t];return n&&r.length>n?r.slice(0,-1):r}var Gy=Symbol();function M1(t,e){return!t.queryFn&&e?.initialPromise?()=>e.initialPromise:!t.queryFn||t.queryFn===Gy?()=>Promise.reject(new Error(`Missing queryFn: '${t.queryHash}'`)):t.queryFn}function O1(t,e){return typeof t=="function"?t(...e):!!t}var Wj=class extends oc{#e;#t;#n;constructor(){super(),this.#n=t=>{if(!Ro&&window.addEventListener){const e=()=>t();return window.addEventListener("visibilitychange",e,!1),()=>{window.removeEventListener("visibilitychange",e)}}}}onSubscribe(){this.#t||this.setEventListener(this.#n)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(t){this.#n=t,this.#t?.(),this.#t=t(e=>{typeof e=="boolean"?this.setFocused(e):this.onFocus()})}setFocused(t){this.#e!==t&&(this.#e=t,this.onFocus())}onFocus(){const t=this.isFocused();this.listeners.forEach(e=>{e(t)})}isFocused(){return typeof this.#e=="boolean"?this.#e:globalThis.document?.visibilityState!=="hidden"}},Wy=new Wj;function iy(){let t,e;const n=new Promise((i,o)=>{t=i,e=o});n.status="pending",n.catch(()=>{});function r(i){Object.assign(n,i),delete n.resolve,delete n.reject}return n.resolve=i=>{r({status:"fulfilled",value:i}),t(i)},n.reject=i=>{r({status:"rejected",reason:i}),e(i)},n}var Qj=Fj;function Kj(){let t=[],e=0,n=d=>{d()},r=d=>{d()},i=Qj;const o=d=>{e?t.push(d):i(()=>{n(d)})},l=()=>{const d=t;t=[],d.length&&i(()=>{r(()=>{d.forEach(h=>{n(h)})})})};return{batch:d=>{let h;e++;try{h=d()}finally{e--,e||l()}return h},batchCalls:d=>(...h)=>{o(()=>{d(...h)})},schedule:o,setNotifyFunction:d=>{n=d},setBatchNotifyFunction:d=>{r=d},setScheduler:d=>{i=d}}}var Cn=Kj(),Yj=class extends oc{#e=!0;#t;#n;constructor(){super(),this.#n=t=>{if(!Ro&&window.addEventListener){const e=()=>t(!0),n=()=>t(!1);return window.addEventListener("online",e,!1),window.addEventListener("offline",n,!1),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",n)}}}}onSubscribe(){this.#t||this.setEventListener(this.#n)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(t){this.#n=t,this.#t?.(),this.#t=t(this.setOnline.bind(this))}setOnline(t){this.#e!==t&&(this.#e=t,this.listeners.forEach(n=>{n(t)}))}isOnline(){return this.#e}},mf=new Yj;function Xj(t){return Math.min(1e3*2**t,3e4)}function N1(t){return(t??"online")==="online"?mf.isOnline():!0}var ay=class extends Error{constructor(t){super("CancelledError"),this.revert=t?.revert,this.silent=t?.silent}};function P1(t){let e=!1,n=0,r;const i=iy(),o=()=>i.status!=="pending",l=x=>{if(!o()){const S=new ay(x);b(S),t.onCancel?.(S)}},d=()=>{e=!0},h=()=>{e=!1},f=()=>Wy.isFocused()&&(t.networkMode==="always"||mf.isOnline())&&t.canRun(),p=()=>N1(t.networkMode)&&t.canRun(),g=x=>{o()||(r?.(),i.resolve(x))},b=x=>{o()||(r?.(),i.reject(x))},_=()=>new Promise(x=>{r=S=>{(o()||f())&&x(S)},t.onPause?.()}).then(()=>{r=void 0,o()||t.onContinue?.()}),w=()=>{if(o())return;let x;const S=n===0?t.initialPromise:void 0;try{x=S??t.fn()}catch(C){x=Promise.reject(C)}Promise.resolve(x).then(g).catch(C=>{if(o())return;const T=t.retry??(Ro?0:3),R=t.retryDelay??Xj,D=typeof R=="function"?R(n,C):R,V=T===!0||typeof T=="number"&&n<T||typeof T=="function"&&T(n,C);if(e||!V){b(C);return}n++,t.onFail?.(n,C),qj(D).then(()=>f()?void 0:_()).then(()=>{e?b(C):w()})})};return{promise:i,status:()=>i.status,cancel:l,continue:()=>(r?.(),i),cancelRetry:d,continueRetry:h,canStart:p,start:()=>(p()?w():_().then(w),i)}}var B1=class{#e;destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),ny(this.gcTime)&&(this.#e=Co.setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(t){this.gcTime=Math.max(this.gcTime||0,t??(Ro?1/0:300*1e3))}clearGcTimeout(){this.#e&&(Co.clearTimeout(this.#e),this.#e=void 0)}},Zj=class extends B1{#e;#t;#n;#s;#r;#a;#o;constructor(e){super(),this.#o=!1,this.#a=e.defaultOptions,this.setOptions(e.options),this.observers=[],this.#s=e.client,this.#n=this.#s.getQueryCache(),this.queryKey=e.queryKey,this.queryHash=e.queryHash,this.#e=Gx(this.options),this.state=e.state??this.#e,this.scheduleGc()}get meta(){return this.options.meta}get promise(){return this.#r?.promise}setOptions(e){if(this.options={...this.#a,...e},this.updateGcTime(this.options.gcTime),this.state&&this.state.data===void 0){const n=Gx(this.options);n.data!==void 0&&(this.setState(Hx(n.data,n.dataUpdatedAt)),this.#e=n)}}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&this.#n.remove(this)}setData(e,n){const r=sy(this.state.data,e,this.options);return this.#i({data:r,type:"success",dataUpdatedAt:n?.updatedAt,manual:n?.manual}),r}setState(e,n){this.#i({type:"setState",state:e,setStateOptions:n})}cancel(e){const n=this.#r?.promise;return this.#r?.cancel(e),n?n.then(lr).catch(lr):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(this.#e)}isActive(){return this.observers.some(e=>Wr(e.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===Gy||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(e=>wa(e.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(e=>e.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(e=0){return this.state.data===void 0?!0:e==="static"?!1:this.state.isInvalidated?!0:!D1(this.state.dataUpdatedAt,e)}onFocus(){this.observers.find(n=>n.shouldFetchOnWindowFocus())?.refetch({cancelRefetch:!1}),this.#r?.continue()}onOnline(){this.observers.find(n=>n.shouldFetchOnReconnect())?.refetch({cancelRefetch:!1}),this.#r?.continue()}addObserver(e){this.observers.includes(e)||(this.observers.push(e),this.clearGcTimeout(),this.#n.notify({type:"observerAdded",query:this,observer:e}))}removeObserver(e){this.observers.includes(e)&&(this.observers=this.observers.filter(n=>n!==e),this.observers.length||(this.#r&&(this.#o?this.#r.cancel({revert:!0}):this.#r.cancelRetry()),this.scheduleGc()),this.#n.notify({type:"observerRemoved",query:this,observer:e}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||this.#i({type:"invalidate"})}async fetch(e,n){if(this.state.fetchStatus!=="idle"&&this.#r?.status()!=="rejected"){if(this.state.data!==void 0&&n?.cancelRefetch)this.cancel({silent:!0});else if(this.#r)return this.#r.continueRetry(),this.#r.promise}if(e&&this.setOptions(e),!this.options.queryFn){const h=this.observers.find(f=>f.options.queryFn);h&&this.setOptions(h.options)}const r=new AbortController,i=h=>{Object.defineProperty(h,"signal",{enumerable:!0,get:()=>(this.#o=!0,r.signal)})},o=()=>{const h=M1(this.options,n),p=(()=>{const g={client:this.#s,queryKey:this.queryKey,meta:this.meta};return i(g),g})();return this.#o=!1,this.options.persister?this.options.persister(h,p,this):h(p)},d=(()=>{const h={fetchOptions:n,options:this.options,queryKey:this.queryKey,client:this.#s,state:this.state,fetchFn:o};return i(h),h})();this.options.behavior?.onFetch(d,this),this.#t=this.state,(this.state.fetchStatus==="idle"||this.state.fetchMeta!==d.fetchOptions?.meta)&&this.#i({type:"fetch",meta:d.fetchOptions?.meta}),this.#r=P1({initialPromise:n?.initialPromise,fn:d.fetchFn,onCancel:h=>{h instanceof ay&&h.revert&&this.setState({...this.#t,fetchStatus:"idle"}),r.abort()},onFail:(h,f)=>{this.#i({type:"failed",failureCount:h,error:f})},onPause:()=>{this.#i({type:"pause"})},onContinue:()=>{this.#i({type:"continue"})},retry:d.options.retry,retryDelay:d.options.retryDelay,networkMode:d.options.networkMode,canRun:()=>!0});try{const h=await this.#r.start();if(h===void 0)throw new Error(`${this.queryHash} data is undefined`);return this.setData(h),this.#n.config.onSuccess?.(h,this),this.#n.config.onSettled?.(h,this.state.error,this),h}catch(h){if(h instanceof ay){if(h.silent)return this.#r.promise;if(h.revert){if(this.state.data===void 0)throw h;return this.state.data}}throw this.#i({type:"error",error:h}),this.#n.config.onError?.(h,this),this.#n.config.onSettled?.(this.state.data,h,this),h}finally{this.scheduleGc()}}#i(e){const n=r=>{switch(e.type){case"failed":return{...r,fetchFailureCount:e.failureCount,fetchFailureReason:e.error};case"pause":return{...r,fetchStatus:"paused"};case"continue":return{...r,fetchStatus:"fetching"};case"fetch":return{...r,...z1(r.data,this.options),fetchMeta:e.meta??null};case"success":const i={...r,...Hx(e.data,e.dataUpdatedAt),dataUpdateCount:r.dataUpdateCount+1,...!e.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return this.#t=e.manual?i:void 0,i;case"error":const o=e.error;return{...r,error:o,errorUpdateCount:r.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:r.fetchFailureCount+1,fetchFailureReason:o,fetchStatus:"idle",status:"error"};case"invalidate":return{...r,isInvalidated:!0};case"setState":return{...r,...e.state}}};this.state=n(this.state),Cn.batch(()=>{this.observers.forEach(r=>{r.onQueryUpdate()}),this.#n.notify({query:this,type:"updated",action:e})})}};function z1(t,e){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:N1(e.networkMode)?"fetching":"paused",...t===void 0&&{error:null,status:"pending"}}}function Hx(t,e){return{data:t,dataUpdatedAt:e??Date.now(),error:null,isInvalidated:!1,status:"success"}}function Gx(t){const e=typeof t.initialData=="function"?t.initialData():t.initialData,n=e!==void 0,r=n?typeof t.initialDataUpdatedAt=="function"?t.initialDataUpdatedAt():t.initialDataUpdatedAt:0;return{data:e,dataUpdateCount:0,dataUpdatedAt:n?r??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:n?"success":"pending",fetchStatus:"idle"}}var Jj=class extends oc{constructor(t,e){super(),this.options=e,this.#e=t,this.#i=null,this.#o=iy(),this.bindMethods(),this.setOptions(e)}#e;#t=void 0;#n=void 0;#s=void 0;#r;#a;#o;#i;#p;#h;#f;#c;#u;#l;#m=new Set;bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(this.#t.addObserver(this),Wx(this.#t,this.options)?this.#d():this.updateResult(),this.#b())}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return oy(this.#t,this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return oy(this.#t,this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,this.#v(),this.#x(),this.#t.removeObserver(this)}setOptions(t){const e=this.options,n=this.#t;if(this.options=this.#e.defaultQueryOptions(t),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof Wr(this.options.enabled,this.#t)!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");this.#w(),this.#t.setOptions(this.options),e._defaulted&&!ff(this.options,e)&&this.#e.getQueryCache().notify({type:"observerOptionsUpdated",query:this.#t,observer:this});const r=this.hasListeners();r&&Qx(this.#t,n,this.options,e)&&this.#d(),this.updateResult(),r&&(this.#t!==n||Wr(this.options.enabled,this.#t)!==Wr(e.enabled,this.#t)||wa(this.options.staleTime,this.#t)!==wa(e.staleTime,this.#t))&&this.#g();const i=this.#y();r&&(this.#t!==n||Wr(this.options.enabled,this.#t)!==Wr(e.enabled,this.#t)||i!==this.#l)&&this.#_(i)}getOptimisticResult(t){const e=this.#e.getQueryCache().build(this.#e,t),n=this.createResult(e,t);return tR(this,n)&&(this.#s=n,this.#a=this.options,this.#r=this.#t.state),n}getCurrentResult(){return this.#s}trackResult(t,e){return new Proxy(t,{get:(n,r)=>(this.trackProp(r),e?.(r),r==="promise"&&(this.trackProp("data"),!this.options.experimental_prefetchInRender&&this.#o.status==="pending"&&this.#o.reject(new Error("experimental_prefetchInRender feature flag is not enabled"))),Reflect.get(n,r))})}trackProp(t){this.#m.add(t)}getCurrentQuery(){return this.#t}refetch({...t}={}){return this.fetch({...t})}fetchOptimistic(t){const e=this.#e.defaultQueryOptions(t),n=this.#e.getQueryCache().build(this.#e,e);return n.fetch().then(()=>this.createResult(n,e))}fetch(t){return this.#d({...t,cancelRefetch:t.cancelRefetch??!0}).then(()=>(this.updateResult(),this.#s))}#d(t){this.#w();let e=this.#t.fetch(this.options,t);return t?.throwOnError||(e=e.catch(lr)),e}#g(){this.#v();const t=wa(this.options.staleTime,this.#t);if(Ro||this.#s.isStale||!ny(t))return;const n=D1(this.#s.dataUpdatedAt,t)+1;this.#c=Co.setTimeout(()=>{this.#s.isStale||this.updateResult()},n)}#y(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(this.#t):this.options.refetchInterval)??!1}#_(t){this.#x(),this.#l=t,!(Ro||Wr(this.options.enabled,this.#t)===!1||!ny(this.#l)||this.#l===0)&&(this.#u=Co.setInterval(()=>{(this.options.refetchIntervalInBackground||Wy.isFocused())&&this.#d()},this.#l))}#b(){this.#g(),this.#_(this.#y())}#v(){this.#c&&(Co.clearTimeout(this.#c),this.#c=void 0)}#x(){this.#u&&(Co.clearInterval(this.#u),this.#u=void 0)}createResult(t,e){const n=this.#t,r=this.options,i=this.#s,o=this.#r,l=this.#a,h=t!==n?t.state:this.#n,{state:f}=t;let p={...f},g=!1,b;if(e._optimisticResults){const M=this.hasListeners(),B=!M&&Wx(t,e),U=M&&Qx(t,n,e,r);(B||U)&&(p={...p,...z1(f.data,t.options)}),e._optimisticResults==="isRestoring"&&(p.fetchStatus="idle")}let{error:_,errorUpdatedAt:w,status:x}=p;b=p.data;let S=!1;if(e.placeholderData!==void 0&&b===void 0&&x==="pending"){let M;i?.isPlaceholderData&&e.placeholderData===l?.placeholderData?(M=i.data,S=!0):M=typeof e.placeholderData=="function"?e.placeholderData(this.#f?.state.data,this.#f):e.placeholderData,M!==void 0&&(x="success",b=sy(i?.data,M,e),g=!0)}if(e.select&&b!==void 0&&!S)if(i&&b===o?.data&&e.select===this.#p)b=this.#h;else try{this.#p=e.select,b=e.select(b),b=sy(i?.data,b,e),this.#h=b,this.#i=null}catch(M){this.#i=M}this.#i&&(_=this.#i,b=this.#h,w=Date.now(),x="error");const C=p.fetchStatus==="fetching",T=x==="pending",R=x==="error",D=T&&C,V=b!==void 0,k={status:x,fetchStatus:p.fetchStatus,isPending:T,isSuccess:x==="success",isError:R,isInitialLoading:D,isLoading:D,data:b,dataUpdatedAt:p.dataUpdatedAt,error:_,errorUpdatedAt:w,failureCount:p.fetchFailureCount,failureReason:p.fetchFailureReason,errorUpdateCount:p.errorUpdateCount,isFetched:p.dataUpdateCount>0||p.errorUpdateCount>0,isFetchedAfterMount:p.dataUpdateCount>h.dataUpdateCount||p.errorUpdateCount>h.errorUpdateCount,isFetching:C,isRefetching:C&&!T,isLoadingError:R&&!V,isPaused:p.fetchStatus==="paused",isPlaceholderData:g,isRefetchError:R&&V,isStale:Qy(t,e),refetch:this.refetch,promise:this.#o,isEnabled:Wr(e.enabled,t)!==!1};if(this.options.experimental_prefetchInRender){const M=q=>{k.status==="error"?q.reject(k.error):k.data!==void 0&&q.resolve(k.data)},B=()=>{const q=this.#o=k.promise=iy();M(q)},U=this.#o;switch(U.status){case"pending":t.queryHash===n.queryHash&&M(U);break;case"fulfilled":(k.status==="error"||k.data!==U.value)&&B();break;case"rejected":(k.status!=="error"||k.error!==U.reason)&&B();break}}return k}updateResult(){const t=this.#s,e=this.createResult(this.#t,this.options);if(this.#r=this.#t.state,this.#a=this.options,this.#r.data!==void 0&&(this.#f=this.#t),ff(e,t))return;this.#s=e;const n=()=>{if(!t)return!0;const{notifyOnChangeProps:r}=this.options,i=typeof r=="function"?r():r;if(i==="all"||!i&&!this.#m.size)return!0;const o=new Set(i??this.#m);return this.options.throwOnError&&o.add("error"),Object.keys(this.#s).some(l=>{const d=l;return this.#s[d]!==t[d]&&o.has(d)})};this.#S({listeners:n()})}#w(){const t=this.#e.getQueryCache().build(this.#e,this.options);if(t===this.#t)return;const e=this.#t;this.#t=t,this.#n=t.state,this.hasListeners()&&(e?.removeObserver(this),t.addObserver(this))}onQueryUpdate(){this.updateResult(),this.hasListeners()&&this.#b()}#S(t){Cn.batch(()=>{t.listeners&&this.listeners.forEach(e=>{e(this.#s)}),this.#e.getQueryCache().notify({query:this.#t,type:"observerResultsUpdated"})})}};function eR(t,e){return Wr(e.enabled,t)!==!1&&t.state.data===void 0&&!(t.state.status==="error"&&e.retryOnMount===!1)}function Wx(t,e){return eR(t,e)||t.state.data!==void 0&&oy(t,e,e.refetchOnMount)}function oy(t,e,n){if(Wr(e.enabled,t)!==!1&&wa(e.staleTime,t)!=="static"){const r=typeof n=="function"?n(t):n;return r==="always"||r!==!1&&Qy(t,e)}return!1}function Qx(t,e,n,r){return(t!==e||Wr(r.enabled,t)===!1)&&(!n.suspense||t.state.status!=="error")&&Qy(t,n)}function Qy(t,e){return Wr(e.enabled,t)!==!1&&t.isStaleByTime(wa(e.staleTime,t))}function tR(t,e){return!ff(t.getCurrentResult(),e)}function Kx(t){return{onFetch:(e,n)=>{const r=e.options,i=e.fetchOptions?.meta?.fetchMore?.direction,o=e.state.data?.pages||[],l=e.state.data?.pageParams||[];let d={pages:[],pageParams:[]},h=0;const f=async()=>{let p=!1;const g=w=>{Object.defineProperty(w,"signal",{enumerable:!0,get:()=>(e.signal.aborted?p=!0:e.signal.addEventListener("abort",()=>{p=!0}),e.signal)})},b=M1(e.options,e.fetchOptions),_=async(w,x,S)=>{if(p)return Promise.reject();if(x==null&&w.pages.length)return Promise.resolve(w);const T=(()=>{const $={client:e.client,queryKey:e.queryKey,pageParam:x,direction:S?"backward":"forward",meta:e.options.meta};return g($),$})(),R=await b(T),{maxPages:D}=e.options,V=S?Gj:Hj;return{pages:V(w.pages,R,D),pageParams:V(w.pageParams,x,D)}};if(i&&o.length){const w=i==="backward",x=w?nR:Yx,S={pages:o,pageParams:l},C=x(r,S);d=await _(S,C,w)}else{const w=t??o.length;do{const x=h===0?l[0]??r.initialPageParam:Yx(r,d);if(h>0&&x==null)break;d=await _(d,x),h++}while(h<w)}return d};e.options.persister?e.fetchFn=()=>e.options.persister?.(f,{client:e.client,queryKey:e.queryKey,meta:e.options.meta,signal:e.signal},n):e.fetchFn=f}}}function Yx(t,{pages:e,pageParams:n}){const r=e.length-1;return e.length>0?t.getNextPageParam(e[r],e,n[r],n):void 0}function nR(t,{pages:e,pageParams:n}){return e.length>0?t.getPreviousPageParam?.(e[0],e,n[0],n):void 0}var rR=class extends B1{#e;#t;#n;#s;constructor(e){super(),this.#e=e.client,this.mutationId=e.mutationId,this.#n=e.mutationCache,this.#t=[],this.state=e.state||L1(),this.setOptions(e.options),this.scheduleGc()}setOptions(e){this.options=e,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(e){this.#t.includes(e)||(this.#t.push(e),this.clearGcTimeout(),this.#n.notify({type:"observerAdded",mutation:this,observer:e}))}removeObserver(e){this.#t=this.#t.filter(n=>n!==e),this.scheduleGc(),this.#n.notify({type:"observerRemoved",mutation:this,observer:e})}optionalRemove(){this.#t.length||(this.state.status==="pending"?this.scheduleGc():this.#n.remove(this))}continue(){return this.#s?.continue()??this.execute(this.state.variables)}async execute(e){const n=()=>{this.#r({type:"continue"})},r={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};this.#s=P1({fn:()=>this.options.mutationFn?this.options.mutationFn(e,r):Promise.reject(new Error("No mutationFn found")),onFail:(l,d)=>{this.#r({type:"failed",failureCount:l,error:d})},onPause:()=>{this.#r({type:"pause"})},onContinue:n,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>this.#n.canRun(this)});const i=this.state.status==="pending",o=!this.#s.canStart();try{if(i)n();else{this.#r({type:"pending",variables:e,isPaused:o}),await this.#n.config.onMutate?.(e,this,r);const d=await this.options.onMutate?.(e,r);d!==this.state.context&&this.#r({type:"pending",context:d,variables:e,isPaused:o})}const l=await this.#s.start();return await this.#n.config.onSuccess?.(l,e,this.state.context,this,r),await this.options.onSuccess?.(l,e,this.state.context,r),await this.#n.config.onSettled?.(l,null,this.state.variables,this.state.context,this,r),await this.options.onSettled?.(l,null,e,this.state.context,r),this.#r({type:"success",data:l}),l}catch(l){try{throw await this.#n.config.onError?.(l,e,this.state.context,this,r),await this.options.onError?.(l,e,this.state.context,r),await this.#n.config.onSettled?.(void 0,l,this.state.variables,this.state.context,this,r),await this.options.onSettled?.(void 0,l,e,this.state.context,r),l}finally{this.#r({type:"error",error:l})}}finally{this.#n.runNext(this)}}#r(e){const n=r=>{switch(e.type){case"failed":return{...r,failureCount:e.failureCount,failureReason:e.error};case"pause":return{...r,isPaused:!0};case"continue":return{...r,isPaused:!1};case"pending":return{...r,context:e.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:e.isPaused,status:"pending",variables:e.variables,submittedAt:Date.now()};case"success":return{...r,data:e.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...r,data:void 0,error:e.error,failureCount:r.failureCount+1,failureReason:e.error,isPaused:!1,status:"error"}}};this.state=n(this.state),Cn.batch(()=>{this.#t.forEach(r=>{r.onMutationUpdate(e)}),this.#n.notify({mutation:this,type:"updated",action:e})})}};function L1(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var sR=class extends oc{constructor(t={}){super(),this.config=t,this.#e=new Set,this.#t=new Map,this.#n=0}#e;#t;#n;build(t,e,n){const r=new rR({client:t,mutationCache:this,mutationId:++this.#n,options:t.defaultMutationOptions(e),state:n});return this.add(r),r}add(t){this.#e.add(t);const e=qh(t);if(typeof e=="string"){const n=this.#t.get(e);n?n.push(t):this.#t.set(e,[t])}this.notify({type:"added",mutation:t})}remove(t){if(this.#e.delete(t)){const e=qh(t);if(typeof e=="string"){const n=this.#t.get(e);if(n)if(n.length>1){const r=n.indexOf(t);r!==-1&&n.splice(r,1)}else n[0]===t&&this.#t.delete(e)}}this.notify({type:"removed",mutation:t})}canRun(t){const e=qh(t);if(typeof e=="string"){const r=this.#t.get(e)?.find(i=>i.state.status==="pending");return!r||r===t}else return!0}runNext(t){const e=qh(t);return typeof e=="string"?this.#t.get(e)?.find(r=>r!==t&&r.state.isPaused)?.continue()??Promise.resolve():Promise.resolve()}clear(){Cn.batch(()=>{this.#e.forEach(t=>{this.notify({type:"removed",mutation:t})}),this.#e.clear(),this.#t.clear()})}getAll(){return Array.from(this.#e)}find(t){const e={exact:!0,...t};return this.getAll().find(n=>Vx(e,n))}findAll(t={}){return this.getAll().filter(e=>Vx(t,e))}notify(t){Cn.batch(()=>{this.listeners.forEach(e=>{e(t)})})}resumePausedMutations(){const t=this.getAll().filter(e=>e.state.isPaused);return Cn.batch(()=>Promise.all(t.map(e=>e.continue().catch(lr))))}};function qh(t){return t.options.scope?.id}var iR=class extends oc{#e;#t=void 0;#n;#s;constructor(e,n){super(),this.#e=e,this.setOptions(n),this.bindMethods(),this.#r()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){const n=this.options;this.options=this.#e.defaultMutationOptions(e),ff(this.options,n)||this.#e.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#n,observer:this}),n?.mutationKey&&this.options.mutationKey&&Io(n.mutationKey)!==Io(this.options.mutationKey)?this.reset():this.#n?.state.status==="pending"&&this.#n.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#n?.removeObserver(this)}onMutationUpdate(e){this.#r(),this.#a(e)}getCurrentResult(){return this.#t}reset(){this.#n?.removeObserver(this),this.#n=void 0,this.#r(),this.#a()}mutate(e,n){return this.#s=n,this.#n?.removeObserver(this),this.#n=this.#e.getMutationCache().build(this.#e,this.options),this.#n.addObserver(this),this.#n.execute(e)}#r(){const e=this.#n?.state??L1();this.#t={...e,isPending:e.status==="pending",isSuccess:e.status==="success",isError:e.status==="error",isIdle:e.status==="idle",mutate:this.mutate,reset:this.reset}}#a(e){Cn.batch(()=>{if(this.#s&&this.hasListeners()){const n=this.#t.variables,r=this.#t.context,i={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};e?.type==="success"?(this.#s.onSuccess?.(e.data,n,r,i),this.#s.onSettled?.(e.data,null,n,r,i)):e?.type==="error"&&(this.#s.onError?.(e.error,n,r,i),this.#s.onSettled?.(void 0,e.error,n,r,i))}this.listeners.forEach(n=>{n(this.#t)})})}},aR=class extends oc{constructor(t={}){super(),this.config=t,this.#e=new Map}#e;build(t,e,n){const r=e.queryKey,i=e.queryHash??Hy(r,e);let o=this.get(i);return o||(o=new Zj({client:t,queryKey:r,queryHash:i,options:t.defaultQueryOptions(e),state:n,defaultOptions:t.getQueryDefaults(r)}),this.add(o)),o}add(t){this.#e.has(t.queryHash)||(this.#e.set(t.queryHash,t),this.notify({type:"added",query:t}))}remove(t){const e=this.#e.get(t.queryHash);e&&(t.destroy(),e===t&&this.#e.delete(t.queryHash),this.notify({type:"removed",query:t}))}clear(){Cn.batch(()=>{this.getAll().forEach(t=>{this.remove(t)})})}get(t){return this.#e.get(t)}getAll(){return[...this.#e.values()]}find(t){const e={exact:!0,...t};return this.getAll().find(n=>Fx(e,n))}findAll(t={}){const e=this.getAll();return Object.keys(t).length>0?e.filter(n=>Fx(t,n)):e}notify(t){Cn.batch(()=>{this.listeners.forEach(e=>{e(t)})})}onFocus(){Cn.batch(()=>{this.getAll().forEach(t=>{t.onFocus()})})}onOnline(){Cn.batch(()=>{this.getAll().forEach(t=>{t.onOnline()})})}},oR=class{#e;#t;#n;#s;#r;#a;#o;#i;constructor(t={}){this.#e=t.queryCache||new aR,this.#t=t.mutationCache||new sR,this.#n=t.defaultOptions||{},this.#s=new Map,this.#r=new Map,this.#a=0}mount(){this.#a++,this.#a===1&&(this.#o=Wy.subscribe(async t=>{t&&(await this.resumePausedMutations(),this.#e.onFocus())}),this.#i=mf.subscribe(async t=>{t&&(await this.resumePausedMutations(),this.#e.onOnline())}))}unmount(){this.#a--,this.#a===0&&(this.#o?.(),this.#o=void 0,this.#i?.(),this.#i=void 0)}isFetching(t){return this.#e.findAll({...t,fetchStatus:"fetching"}).length}isMutating(t){return this.#t.findAll({...t,status:"pending"}).length}getQueryData(t){const e=this.defaultQueryOptions({queryKey:t});return this.#e.get(e.queryHash)?.state.data}ensureQueryData(t){const e=this.defaultQueryOptions(t),n=this.#e.build(this,e),r=n.state.data;return r===void 0?this.fetchQuery(t):(t.revalidateIfStale&&n.isStaleByTime(wa(e.staleTime,n))&&this.prefetchQuery(e),Promise.resolve(r))}getQueriesData(t){return this.#e.findAll(t).map(({queryKey:e,state:n})=>{const r=n.data;return[e,r]})}setQueryData(t,e,n){const r=this.defaultQueryOptions({queryKey:t}),o=this.#e.get(r.queryHash)?.state.data,l=Vj(e,o);if(l!==void 0)return this.#e.build(this,r).setData(l,{...n,manual:!0})}setQueriesData(t,e,n){return Cn.batch(()=>this.#e.findAll(t).map(({queryKey:r})=>[r,this.setQueryData(r,e,n)]))}getQueryState(t){const e=this.defaultQueryOptions({queryKey:t});return this.#e.get(e.queryHash)?.state}removeQueries(t){const e=this.#e;Cn.batch(()=>{e.findAll(t).forEach(n=>{e.remove(n)})})}resetQueries(t,e){const n=this.#e;return Cn.batch(()=>(n.findAll(t).forEach(r=>{r.reset()}),this.refetchQueries({type:"active",...t},e)))}cancelQueries(t,e={}){const n={revert:!0,...e},r=Cn.batch(()=>this.#e.findAll(t).map(i=>i.cancel(n)));return Promise.all(r).then(lr).catch(lr)}invalidateQueries(t,e={}){return Cn.batch(()=>(this.#e.findAll(t).forEach(n=>{n.invalidate()}),t?.refetchType==="none"?Promise.resolve():this.refetchQueries({...t,type:t?.refetchType??t?.type??"active"},e)))}refetchQueries(t,e={}){const n={...e,cancelRefetch:e.cancelRefetch??!0},r=Cn.batch(()=>this.#e.findAll(t).filter(i=>!i.isDisabled()&&!i.isStatic()).map(i=>{let o=i.fetch(void 0,n);return n.throwOnError||(o=o.catch(lr)),i.state.fetchStatus==="paused"?Promise.resolve():o}));return Promise.all(r).then(lr)}fetchQuery(t){const e=this.defaultQueryOptions(t);e.retry===void 0&&(e.retry=!1);const n=this.#e.build(this,e);return n.isStaleByTime(wa(e.staleTime,n))?n.fetch(e):Promise.resolve(n.state.data)}prefetchQuery(t){return this.fetchQuery(t).then(lr).catch(lr)}fetchInfiniteQuery(t){return t.behavior=Kx(t.pages),this.fetchQuery(t)}prefetchInfiniteQuery(t){return this.fetchInfiniteQuery(t).then(lr).catch(lr)}ensureInfiniteQueryData(t){return t.behavior=Kx(t.pages),this.ensureQueryData(t)}resumePausedMutations(){return mf.isOnline()?this.#t.resumePausedMutations():Promise.resolve()}getQueryCache(){return this.#e}getMutationCache(){return this.#t}getDefaultOptions(){return this.#n}setDefaultOptions(t){this.#n=t}setQueryDefaults(t,e){this.#s.set(Io(t),{queryKey:t,defaultOptions:e})}getQueryDefaults(t){const e=[...this.#s.values()],n={};return e.forEach(r=>{Nu(t,r.queryKey)&&Object.assign(n,r.defaultOptions)}),n}setMutationDefaults(t,e){this.#r.set(Io(t),{mutationKey:t,defaultOptions:e})}getMutationDefaults(t){const e=[...this.#r.values()],n={};return e.forEach(r=>{Nu(t,r.mutationKey)&&Object.assign(n,r.defaultOptions)}),n}defaultQueryOptions(t){if(t._defaulted)return t;const e={...this.#n.queries,...this.getQueryDefaults(t.queryKey),...t,_defaulted:!0};return e.queryHash||(e.queryHash=Hy(e.queryKey,e)),e.refetchOnReconnect===void 0&&(e.refetchOnReconnect=e.networkMode!=="always"),e.throwOnError===void 0&&(e.throwOnError=!!e.suspense),!e.networkMode&&e.persister&&(e.networkMode="offlineFirst"),e.queryFn===Gy&&(e.enabled=!1),e}defaultMutationOptions(t){return t?._defaulted?t:{...this.#n.mutations,...t?.mutationKey&&this.getMutationDefaults(t.mutationKey),...t,_defaulted:!0}}clear(){this.#e.clear(),this.#t.clear()}},U1=j.createContext(void 0),Ut=t=>{const e=j.useContext(U1);if(!e)throw new Error("No QueryClient set, use QueryClientProvider to set one");return e},lR=({client:t,children:e})=>(j.useEffect(()=>(t.mount(),()=>{t.unmount()}),[t]),u.jsx(U1.Provider,{value:t,children:e})),F1=j.createContext(!1),cR=()=>j.useContext(F1);F1.Provider;function uR(){let t=!1;return{clearReset:()=>{t=!1},reset:()=>{t=!0},isReset:()=>t}}var dR=j.createContext(uR()),hR=()=>j.useContext(dR),fR=(t,e)=>{(t.suspense||t.throwOnError||t.experimental_prefetchInRender)&&(e.isReset()||(t.retryOnMount=!1))},mR=t=>{j.useEffect(()=>{t.clearReset()},[t])},pR=({result:t,errorResetBoundary:e,throwOnError:n,query:r,suspense:i})=>t.isError&&!e.isReset()&&!t.isFetching&&r&&(i&&t.data===void 0||O1(n,[t.error,r])),gR=t=>{if(t.suspense){const n=i=>i==="static"?i:Math.max(i??1e3,1e3),r=t.staleTime;t.staleTime=typeof r=="function"?(...i)=>n(r(...i)):n(r),typeof t.gcTime=="number"&&(t.gcTime=Math.max(t.gcTime,1e3))}},yR=(t,e)=>t.isLoading&&t.isFetching&&!e,_R=(t,e)=>t?.suspense&&e.isPending,Xx=(t,e,n)=>e.fetchOptimistic(t).catch(()=>{n.clearReset()});function bR(t,e,n){const r=cR(),i=hR(),o=Ut(),l=o.defaultQueryOptions(t);o.getDefaultOptions().queries?._experimental_beforeQuery?.(l),l._optimisticResults=r?"isRestoring":"optimistic",gR(l),fR(l,i),mR(i);const d=!o.getQueryCache().get(l.queryHash),[h]=j.useState(()=>new e(o,l)),f=h.getOptimisticResult(l),p=!r&&t.subscribed!==!1;if(j.useSyncExternalStore(j.useCallback(g=>{const b=p?h.subscribe(Cn.batchCalls(g)):lr;return h.updateResult(),b},[h,p]),()=>h.getCurrentResult(),()=>h.getCurrentResult()),j.useEffect(()=>{h.setOptions(l)},[l,h]),_R(l,f))throw Xx(l,h,i);if(pR({result:f,errorResetBoundary:i,throwOnError:l.throwOnError,query:o.getQueryCache().get(l.queryHash),suspense:l.suspense}))throw f.error;return o.getDefaultOptions().queries?._experimental_afterQuery?.(l,f),l.experimental_prefetchInRender&&!Ro&&yR(f,r)&&(d?Xx(l,h,i):o.getQueryCache().get(l.queryHash)?.promise)?.catch(lr).finally(()=>{h.updateResult()}),l.notifyOnChangeProps?f:h.trackResult(f)}function Bo(t,e){return bR(t,Jj)}function Hn(t,e){const n=Ut(),[r]=j.useState(()=>new iR(n,t));j.useEffect(()=>{r.setOptions(t)},[r,t]);const i=j.useSyncExternalStore(j.useCallback(l=>r.subscribe(Cn.batchCalls(l)),[r]),()=>r.getCurrentResult(),()=>r.getCurrentResult()),o=j.useCallback((l,d)=>{r.mutate(l,d).catch(lr)},[r]);if(i.error&&O1(r.options.throwOnError,[i.error]))throw i.error;return{...i,mutate:o,mutateAsync:i.mutate}}const vR={isLoading:!1,loadingMessage:"Loading...",addLoadingHold:()=>{},removeLoadingHold:()=>{}},V1=j.createContext(vR);function xR({children:t}){const[e,n]=j.useState(new Map),r=j.useCallback((h,f)=>{n(p=>new Map(p).set(h,f))},[]),i=j.useCallback(h=>{n(f=>{const p=new Map(f);return p.delete(h),p})},[]),o=e.size>0,l=e.size>0&&Array.from(e.values()).pop()||"Loading...",d={isLoading:o,loadingMessage:l,addLoadingHold:r,removeLoadingHold:i};return u.jsx(V1.Provider,{value:d,children:t})}function jn(){const t=j.useContext(V1);if(!t)throw new Error("useApp must be used within an AppProvider");return t}const wR=()=>{};var Zx={};const $1=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let i=t.charCodeAt(r);i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=i&63|128):(i&64512)===55296&&r+1<t.length&&(t.charCodeAt(r+1)&64512)===56320?(i=65536+((i&1023)<<10)+(t.charCodeAt(++r)&1023),e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=i&63|128):(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=i&63|128)}return e},SR=function(t){const e=[];let n=0,r=0;for(;n<t.length;){const i=t[n++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){const o=t[n++];e[r++]=String.fromCharCode((i&31)<<6|o&63)}else if(i>239&&i<365){const o=t[n++],l=t[n++],d=t[n++],h=((i&7)<<18|(o&63)<<12|(l&63)<<6|d&63)-65536;e[r++]=String.fromCharCode(55296+(h>>10)),e[r++]=String.fromCharCode(56320+(h&1023))}else{const o=t[n++],l=t[n++];e[r++]=String.fromCharCode((i&15)<<12|(o&63)<<6|l&63)}}return e.join("")},q1={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<t.length;i+=3){const o=t[i],l=i+1<t.length,d=l?t[i+1]:0,h=i+2<t.length,f=h?t[i+2]:0,p=o>>2,g=(o&3)<<4|d>>4;let b=(d&15)<<2|f>>6,_=f&63;h||(_=64,l||(b=64)),r.push(n[p],n[g],n[b],n[_])}return r.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray($1(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):SR(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<t.length;){const o=n[t.charAt(i++)],d=i<t.length?n[t.charAt(i)]:0;++i;const f=i<t.length?n[t.charAt(i)]:64;++i;const g=i<t.length?n[t.charAt(i)]:64;if(++i,o==null||d==null||f==null||g==null)throw new ER;const b=o<<2|d>>4;if(r.push(b),f!==64){const _=d<<4&240|f>>2;if(r.push(_),g!==64){const w=f<<6&192|g;r.push(w)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class ER extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const CR=function(t){const e=$1(t);return q1.encodeByteArray(e,!0)},pf=function(t){return CR(t).replace(/\./g,"")},H1=function(t){try{return q1.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function TR(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const AR=()=>TR().__FIREBASE_DEFAULTS__,jR=()=>{if(typeof process>"u"||typeof Zx>"u")return;const t=Zx.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},RR=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&H1(t[1]);return e&&JSON.parse(e)},Gf=()=>{try{return wR()||AR()||jR()||RR()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},G1=t=>Gf()?.emulatorHosts?.[t],IR=t=>{const e=G1(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(n+1),10);return e[0]==="["?[e.substring(1,n-1),r]:[e.substring(0,n),r]},W1=()=>Gf()?.config,Q1=t=>Gf()?.[`_${t}`];class DR{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,r)=>{n?this.reject(n):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,r))}}}function lc(t){try{return(t.startsWith("http://")||t.startsWith("https://")?new URL(t).hostname:t).endsWith(".cloudworkstations.dev")}catch{return!1}}async function K1(t){return(await fetch(t,{credentials:"include"})).ok}function kR(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n={alg:"none",type:"JWT"},r=e||"demo-project",i=t.iat||0,o=t.sub||t.user_id;if(!o)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const l={iss:`https://securetoken.google.com/${r}`,aud:r,iat:i,exp:i+3600,auth_time:i,sub:o,user_id:o,firebase:{sign_in_provider:"custom",identities:{}},...t};return[pf(JSON.stringify(n)),pf(JSON.stringify(l)),""].join(".")}const ju={};function MR(){const t={prod:[],emulator:[]};for(const e of Object.keys(ju))ju[e]?t.emulator.push(e):t.prod.push(e);return t}function OR(t){let e=document.getElementById(t),n=!1;return e||(e=document.createElement("div"),e.setAttribute("id",t),n=!0),{created:n,element:e}}let Jx=!1;function Y1(t,e){if(typeof window>"u"||typeof document>"u"||!lc(window.location.host)||ju[t]===e||ju[t]||Jx)return;ju[t]=e;function n(b){return`__firebase__banner__${b}`}const r="__firebase__banner",o=MR().prod.length>0;function l(){const b=document.getElementById(r);b&&b.remove()}function d(b){b.style.display="flex",b.style.background="#7faaf0",b.style.position="fixed",b.style.bottom="5px",b.style.left="5px",b.style.padding=".5em",b.style.borderRadius="5px",b.style.alignItems="center"}function h(b,_){b.setAttribute("width","24"),b.setAttribute("id",_),b.setAttribute("height","24"),b.setAttribute("viewBox","0 0 24 24"),b.setAttribute("fill","none"),b.style.marginLeft="-6px"}function f(){const b=document.createElement("span");return b.style.cursor="pointer",b.style.marginLeft="16px",b.style.fontSize="24px",b.innerHTML=" &times;",b.onclick=()=>{Jx=!0,l()},b}function p(b,_){b.setAttribute("id",_),b.innerText="Learn more",b.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",b.setAttribute("target","__blank"),b.style.paddingLeft="5px",b.style.textDecoration="underline"}function g(){const b=OR(r),_=n("text"),w=document.getElementById(_)||document.createElement("span"),x=n("learnmore"),S=document.getElementById(x)||document.createElement("a"),C=n("preprendIcon"),T=document.getElementById(C)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(b.created){const R=b.element;d(R),p(S,x);const D=f();h(T,C),R.append(T,w,S,D),document.body.appendChild(R)}o?(w.innerText="Preview backend disconnected.",T.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(T.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,w.innerText="Preview backend running in this workspace."),w.setAttribute("id",_)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",g):g()}function er(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function NR(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(er())}function PR(){const t=Gf()?.forceEnvironment;if(t==="node")return!0;if(t==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function BR(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function zR(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function LR(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function UR(){const t=er();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function FR(){return!PR()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function VR(){try{return typeof indexedDB=="object"}catch{return!1}}function $R(){return new Promise((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{e(i.error?.message||"")}}catch(n){e(n)}})}const qR="FirebaseError";class Di extends Error{constructor(e,n,r){super(n),this.code=e,this.customData=r,this.name=qR,Object.setPrototypeOf(this,Di.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Ju.prototype.create)}}class Ju{constructor(e,n,r){this.service=e,this.serviceName=n,this.errors=r}create(e,...n){const r=n[0]||{},i=`${this.service}/${e}`,o=this.errors[e],l=o?HR(o,r):"Error",d=`${this.serviceName}: ${l} (${i}).`;return new Di(i,d,r)}}function HR(t,e){return t.replace(GR,(n,r)=>{const i=e[r];return i!=null?String(i):`<${r}?>`})}const GR=/\{\$([^}]+)}/g;function WR(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function Ei(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const i of n){if(!r.includes(i))return!1;const o=t[i],l=e[i];if(ew(o)&&ew(l)){if(!Ei(o,l))return!1}else if(o!==l)return!1}for(const i of r)if(!n.includes(i))return!1;return!0}function ew(t){return t!==null&&typeof t=="object"}function ed(t){const e=[];for(const[n,r]of Object.entries(t))Array.isArray(r)?r.forEach(i=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function wu(t){const e={};return t.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[i,o]=r.split("=");e[decodeURIComponent(i)]=decodeURIComponent(o)}}),e}function Su(t){const e=t.indexOf("?");if(!e)return"";const n=t.indexOf("#",e);return t.substring(e,n>0?n:void 0)}function QR(t,e){const n=new KR(t,e);return n.subscribe.bind(n)}class KR{constructor(e,n){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(n=>{n.next(e)})}error(e){this.forEachObserver(n=>{n.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,n,r){let i;if(e===void 0&&n===void 0&&r===void 0)throw new Error("Missing Observer.");YR(e,["next","error","complete"])?i=e:i={next:e,error:n,complete:r},i.next===void 0&&(i.next=Ng),i.error===void 0&&(i.error=Ng),i.complete===void 0&&(i.complete=Ng);const o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),o}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let n=0;n<this.observers.length;n++)this.sendOne(n,e)}sendOne(e,n){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{n(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function YR(t,e){if(typeof t!="object"||t===null)return!1;for(const n of e)if(n in t&&typeof t[n]=="function")return!0;return!1}function Ng(){}function wn(t){return t&&t._delegate?t._delegate:t}class Do{constructor(e,n,r){this.name=e,this.instanceFactory=n,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const So="[DEFAULT]";class XR{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){const r=new DR;if(this.instancesDeferred.set(n,r),this.isInitialized(n)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:n});i&&r.resolve(i)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){const n=this.normalizeInstanceIdentifier(e?.identifier),r=e?.optional??!1;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(i){if(r)return null;throw i}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(JR(e))try{this.getOrInitializeService({instanceIdentifier:So})}catch{}for(const[n,r]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(n);try{const o=this.getOrInitializeService({instanceIdentifier:i});r.resolve(o)}catch{}}}}clearInstance(e=So){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=So){return this.instances.has(e)}getOptions(e=So){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:n={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:r,options:n});for(const[o,l]of this.instancesDeferred.entries()){const d=this.normalizeInstanceIdentifier(o);r===d&&l.resolve(i)}return i}onInit(e,n){const r=this.normalizeInstanceIdentifier(n),i=this.onInitCallbacks.get(r)??new Set;i.add(e),this.onInitCallbacks.set(r,i);const o=this.instances.get(r);return o&&e(o,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,n){const r=this.onInitCallbacks.get(n);if(r)for(const i of r)try{i(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:ZR(e),options:n}),this.instances.set(e,r),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=So){return this.component?this.component.multipleInstances?e:So:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function ZR(t){return t===So?void 0:t}function JR(t){return t.instantiationMode==="EAGER"}class eI{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const n=new XR(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}}var pt;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(pt||(pt={}));const tI={debug:pt.DEBUG,verbose:pt.VERBOSE,info:pt.INFO,warn:pt.WARN,error:pt.ERROR,silent:pt.SILENT},nI=pt.INFO,rI={[pt.DEBUG]:"log",[pt.VERBOSE]:"log",[pt.INFO]:"info",[pt.WARN]:"warn",[pt.ERROR]:"error"},sI=(t,e,...n)=>{if(e<t.logLevel)return;const r=new Date().toISOString(),i=rI[e];if(i)console[i](`[${r}]  ${t.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Ky{constructor(e){this.name=e,this._logLevel=nI,this._logHandler=sI,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in pt))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?tI[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,pt.DEBUG,...e),this._logHandler(this,pt.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,pt.VERBOSE,...e),this._logHandler(this,pt.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,pt.INFO,...e),this._logHandler(this,pt.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,pt.WARN,...e),this._logHandler(this,pt.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,pt.ERROR,...e),this._logHandler(this,pt.ERROR,...e)}}const iI=(t,e)=>e.some(n=>t instanceof n);let tw,nw;function aI(){return tw||(tw=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function oI(){return nw||(nw=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const X1=new WeakMap,ly=new WeakMap,Z1=new WeakMap,Pg=new WeakMap,Yy=new WeakMap;function lI(t){const e=new Promise((n,r)=>{const i=()=>{t.removeEventListener("success",o),t.removeEventListener("error",l)},o=()=>{n(Sa(t.result)),i()},l=()=>{r(t.error),i()};t.addEventListener("success",o),t.addEventListener("error",l)});return e.then(n=>{n instanceof IDBCursor&&X1.set(n,t)}).catch(()=>{}),Yy.set(e,t),e}function cI(t){if(ly.has(t))return;const e=new Promise((n,r)=>{const i=()=>{t.removeEventListener("complete",o),t.removeEventListener("error",l),t.removeEventListener("abort",l)},o=()=>{n(),i()},l=()=>{r(t.error||new DOMException("AbortError","AbortError")),i()};t.addEventListener("complete",o),t.addEventListener("error",l),t.addEventListener("abort",l)});ly.set(t,e)}let cy={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return ly.get(t);if(e==="objectStoreNames")return t.objectStoreNames||Z1.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Sa(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function uI(t){cy=t(cy)}function dI(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const r=t.call(Bg(this),e,...n);return Z1.set(r,e.sort?e.sort():[e]),Sa(r)}:oI().includes(t)?function(...e){return t.apply(Bg(this),e),Sa(X1.get(this))}:function(...e){return Sa(t.apply(Bg(this),e))}}function hI(t){return typeof t=="function"?dI(t):(t instanceof IDBTransaction&&cI(t),iI(t,aI())?new Proxy(t,cy):t)}function Sa(t){if(t instanceof IDBRequest)return lI(t);if(Pg.has(t))return Pg.get(t);const e=hI(t);return e!==t&&(Pg.set(t,e),Yy.set(e,t)),e}const Bg=t=>Yy.get(t);function fI(t,e,{blocked:n,upgrade:r,blocking:i,terminated:o}={}){const l=indexedDB.open(t,e),d=Sa(l);return r&&l.addEventListener("upgradeneeded",h=>{r(Sa(l.result),h.oldVersion,h.newVersion,Sa(l.transaction),h)}),n&&l.addEventListener("blocked",h=>n(h.oldVersion,h.newVersion,h)),d.then(h=>{o&&h.addEventListener("close",()=>o()),i&&h.addEventListener("versionchange",f=>i(f.oldVersion,f.newVersion,f))}).catch(()=>{}),d}const mI=["get","getKey","getAll","getAllKeys","count"],pI=["put","add","delete","clear"],zg=new Map;function rw(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(zg.get(e))return zg.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,i=pI.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(i||mI.includes(n)))return;const o=async function(l,...d){const h=this.transaction(l,i?"readwrite":"readonly");let f=h.store;return r&&(f=f.index(d.shift())),(await Promise.all([f[n](...d),i&&h.done]))[0]};return zg.set(e,o),o}uI(t=>({...t,get:(e,n,r)=>rw(e,n)||t.get(e,n,r),has:(e,n)=>!!rw(e,n)||t.has(e,n)}));class gI{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(yI(n)){const r=n.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(n=>n).join(" ")}}function yI(t){return t.getComponent()?.type==="VERSION"}const uy="@firebase/app",sw="0.14.6";const Ci=new Ky("@firebase/app"),_I="@firebase/app-compat",bI="@firebase/analytics-compat",vI="@firebase/analytics",xI="@firebase/app-check-compat",wI="@firebase/app-check",SI="@firebase/auth",EI="@firebase/auth-compat",CI="@firebase/database",TI="@firebase/data-connect",AI="@firebase/database-compat",jI="@firebase/functions",RI="@firebase/functions-compat",II="@firebase/installations",DI="@firebase/installations-compat",kI="@firebase/messaging",MI="@firebase/messaging-compat",OI="@firebase/performance",NI="@firebase/performance-compat",PI="@firebase/remote-config",BI="@firebase/remote-config-compat",zI="@firebase/storage",LI="@firebase/storage-compat",UI="@firebase/firestore",FI="@firebase/ai",VI="@firebase/firestore-compat",$I="firebase",qI="12.6.0";const dy="[DEFAULT]",HI={[uy]:"fire-core",[_I]:"fire-core-compat",[vI]:"fire-analytics",[bI]:"fire-analytics-compat",[wI]:"fire-app-check",[xI]:"fire-app-check-compat",[SI]:"fire-auth",[EI]:"fire-auth-compat",[CI]:"fire-rtdb",[TI]:"fire-data-connect",[AI]:"fire-rtdb-compat",[jI]:"fire-fn",[RI]:"fire-fn-compat",[II]:"fire-iid",[DI]:"fire-iid-compat",[kI]:"fire-fcm",[MI]:"fire-fcm-compat",[OI]:"fire-perf",[NI]:"fire-perf-compat",[PI]:"fire-rc",[BI]:"fire-rc-compat",[zI]:"fire-gcs",[LI]:"fire-gcs-compat",[UI]:"fire-fst",[VI]:"fire-fst-compat",[FI]:"fire-vertex","fire-js":"fire-js",[$I]:"fire-js-all"};const gf=new Map,GI=new Map,hy=new Map;function iw(t,e){try{t.container.addComponent(e)}catch(n){Ci.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function Wl(t){const e=t.name;if(hy.has(e))return Ci.debug(`There were multiple attempts to register component ${e}.`),!1;hy.set(e,t);for(const n of gf.values())iw(n,t);for(const n of GI.values())iw(n,t);return!0}function Xy(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function cs(t){return t==null?!1:t.settings!==void 0}const WI={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Ea=new Ju("app","Firebase",WI);class QI{constructor(e,n,r){this._isDeleted=!1,this._options={...e},this._config={...n},this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Do("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Ea.create("app-deleted",{appName:this._name})}}const cc=qI;function J1(t,e={}){let n=t;typeof e!="object"&&(e={name:e});const r={name:dy,automaticDataCollectionEnabled:!0,...e},i=r.name;if(typeof i!="string"||!i)throw Ea.create("bad-app-name",{appName:String(i)});if(n||(n=W1()),!n)throw Ea.create("no-options");const o=gf.get(i);if(o){if(Ei(n,o.options)&&Ei(r,o.config))return o;throw Ea.create("duplicate-app",{appName:i})}const l=new eI(i);for(const h of hy.values())l.addComponent(h);const d=new QI(n,r,l);return gf.set(i,d),d}function eE(t=dy){const e=gf.get(t);if(!e&&t===dy&&W1())return J1();if(!e)throw Ea.create("no-app",{appName:t});return e}function Ca(t,e,n){let r=HI[t]??t;n&&(r+=`-${n}`);const i=r.match(/\s|\//),o=e.match(/\s|\//);if(i||o){const l=[`Unable to register library "${r}" with version "${e}":`];i&&l.push(`library name "${r}" contains illegal characters (whitespace or "/")`),i&&o&&l.push("and"),o&&l.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Ci.warn(l.join(" "));return}Wl(new Do(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}const KI="firebase-heartbeat-database",YI=1,Pu="firebase-heartbeat-store";let Lg=null;function tE(){return Lg||(Lg=fI(KI,YI,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(Pu)}catch(n){console.warn(n)}}}}).catch(t=>{throw Ea.create("idb-open",{originalErrorMessage:t.message})})),Lg}async function XI(t){try{const n=(await tE()).transaction(Pu),r=await n.objectStore(Pu).get(nE(t));return await n.done,r}catch(e){if(e instanceof Di)Ci.warn(e.message);else{const n=Ea.create("idb-get",{originalErrorMessage:e?.message});Ci.warn(n.message)}}}async function aw(t,e){try{const r=(await tE()).transaction(Pu,"readwrite");await r.objectStore(Pu).put(e,nE(t)),await r.done}catch(n){if(n instanceof Di)Ci.warn(n.message);else{const r=Ea.create("idb-set",{originalErrorMessage:n?.message});Ci.warn(r.message)}}}function nE(t){return`${t.name}!${t.options.appId}`}const ZI=1024,JI=30;class eD{constructor(e){this.container=e,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new nD(n),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){try{const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=ow();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(i=>i.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:n}),this._heartbeatsCache.heartbeats.length>JI){const i=rD(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(i,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){Ci.warn(e)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const e=ow(),{heartbeatsToSend:n,unsentEntries:r}=tD(this._heartbeatsCache.heartbeats),i=pf(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(e){return Ci.warn(e),""}}}function ow(){return new Date().toISOString().substring(0,10)}function tD(t,e=ZI){const n=[];let r=t.slice();for(const i of t){const o=n.find(l=>l.agent===i.agent);if(o){if(o.dates.push(i.date),lw(n)>e){o.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),lw(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}class nD{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return VR()?$R().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const n=await XI(this.app);return n?.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return aw(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return aw(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function lw(t){return pf(JSON.stringify({version:2,heartbeats:t})).length}function rD(t){if(t.length===0)return-1;let e=0,n=t[0].date;for(let r=1;r<t.length;r++)t[r].date<n&&(n=t[r].date,e=r);return e}function sD(t){Wl(new Do("platform-logger",e=>new gI(e),"PRIVATE")),Wl(new Do("heartbeat",e=>new eD(e),"PRIVATE")),Ca(uy,sw,t),Ca(uy,sw,"esm2020"),Ca("fire-js","")}sD("");function rE(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const iD=rE,sE=new Ju("auth","Firebase",rE());const yf=new Ky("@firebase/auth");function aD(t,...e){yf.logLevel<=pt.WARN&&yf.warn(`Auth (${cc}): ${t}`,...e)}function tf(t,...e){yf.logLevel<=pt.ERROR&&yf.error(`Auth (${cc}): ${t}`,...e)}function fs(t,...e){throw Zy(t,...e)}function Fs(t,...e){return Zy(t,...e)}function iE(t,e,n){const r={...iD(),[e]:n};return new Ju("auth","Firebase",r).create(e,{appName:t.name})}function Ta(t){return iE(t,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Zy(t,...e){if(typeof t!="string"){const n=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=t.name),t._errorFactory.create(n,...r)}return sE.create(t,...e)}function Ye(t,e,...n){if(!t)throw Zy(e,...n)}function bi(t){const e="INTERNAL ASSERTION FAILED: "+t;throw tf(e),new Error(e)}function Ti(t,e){t||bi(e)}function fy(){return typeof self<"u"&&self.location?.href||""}function oD(){return cw()==="http:"||cw()==="https:"}function cw(){return typeof self<"u"&&self.location?.protocol||null}function lD(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(oD()||zR()||"connection"in navigator)?navigator.onLine:!0}function cD(){if(typeof navigator>"u")return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}class td{constructor(e,n){this.shortDelay=e,this.longDelay=n,Ti(n>e,"Short delay should be less than long delay!"),this.isMobile=NR()||LR()}get(){return lD()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function Jy(t,e){Ti(t.emulator,"Emulator should always be set here");const{url:n}=t.emulator;return e?`${n}${e.startsWith("/")?e.slice(1):e}`:n}class aE{static initialize(e,n,r){this.fetchImpl=e,n&&(this.headersImpl=n),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;bi("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;bi("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;bi("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const uD={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};const dD=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],hD=new td(3e4,6e4);function zo(t,e){return t.tenantId&&!e.tenantId?{...e,tenantId:t.tenantId}:e}async function Ua(t,e,n,r,i={}){return oE(t,i,async()=>{let o={},l={};r&&(e==="GET"?l=r:o={body:JSON.stringify(r)});const d=ed({key:t.config.apiKey,...l}).slice(1),h=await t._getAdditionalHeaders();h["Content-Type"]="application/json",t.languageCode&&(h["X-Firebase-Locale"]=t.languageCode);const f={method:e,headers:h,...o};return BR()||(f.referrerPolicy="no-referrer"),t.emulatorConfig&&lc(t.emulatorConfig.host)&&(f.credentials="include"),aE.fetch()(await lE(t,t.config.apiHost,n,d),f)})}async function oE(t,e,n){t._canInitEmulator=!1;const r={...uD,...e};try{const i=new mD(t),o=await Promise.race([n(),i.promise]);i.clearNetworkTimeout();const l=await o.json();if("needConfirmation"in l)throw Hh(t,"account-exists-with-different-credential",l);if(o.ok&&!("errorMessage"in l))return l;{const d=o.ok?l.errorMessage:l.error.message,[h,f]=d.split(" : ");if(h==="FEDERATED_USER_ID_ALREADY_LINKED")throw Hh(t,"credential-already-in-use",l);if(h==="EMAIL_EXISTS")throw Hh(t,"email-already-in-use",l);if(h==="USER_DISABLED")throw Hh(t,"user-disabled",l);const p=r[h]||h.toLowerCase().replace(/[_\s]+/g,"-");if(f)throw iE(t,p,f);fs(t,p)}}catch(i){if(i instanceof Di)throw i;fs(t,"network-request-failed",{message:String(i)})}}async function Wf(t,e,n,r,i={}){const o=await Ua(t,e,n,r,i);return"mfaPendingCredential"in o&&fs(t,"multi-factor-auth-required",{_serverResponse:o}),o}async function lE(t,e,n,r){const i=`${e}${n}?${r}`,o=t,l=o.config.emulator?Jy(t.config,i):`${t.config.apiScheme}://${i}`;return dD.includes(n)&&(await o._persistenceManagerAvailable,o._getPersistenceType()==="COOKIE")?o._getPersistence()._getFinalTarget(l).toString():l}function fD(t){switch(t){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class mD{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((n,r)=>{this.timer=setTimeout(()=>r(Fs(this.auth,"network-request-failed")),hD.get())})}}function Hh(t,e,n){const r={appName:t.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const i=Fs(t,e,r);return i.customData._tokenResponse=n,i}function uw(t){return t!==void 0&&t.enterprise!==void 0}class pD{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const n of this.recaptchaEnforcementState)if(n.provider&&n.provider===e)return fD(n.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function gD(t,e){return Ua(t,"GET","/v2/recaptchaConfig",zo(t,e))}async function yD(t,e){return Ua(t,"POST","/v1/accounts:delete",e)}async function _f(t,e){return Ua(t,"POST","/v1/accounts:lookup",e)}function Ru(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function _D(t,e=!1){const n=wn(t),r=await n.getIdToken(e),i=e0(r);Ye(i&&i.exp&&i.auth_time&&i.iat,n.auth,"internal-error");const o=typeof i.firebase=="object"?i.firebase:void 0,l=o?.sign_in_provider;return{claims:i,token:r,authTime:Ru(Ug(i.auth_time)),issuedAtTime:Ru(Ug(i.iat)),expirationTime:Ru(Ug(i.exp)),signInProvider:l||null,signInSecondFactor:o?.sign_in_second_factor||null}}function Ug(t){return Number(t)*1e3}function e0(t){const[e,n,r]=t.split(".");if(e===void 0||n===void 0||r===void 0)return tf("JWT malformed, contained fewer than 3 sections"),null;try{const i=H1(n);return i?JSON.parse(i):(tf("Failed to decode base64 JWT payload"),null)}catch(i){return tf("Caught error parsing JWT payload as JSON",i?.toString()),null}}function dw(t){const e=e0(t);return Ye(e,"internal-error"),Ye(typeof e.exp<"u","internal-error"),Ye(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}async function Bu(t,e,n=!1){if(n)return e;try{return await e}catch(r){throw r instanceof Di&&bD(r)&&t.auth.currentUser===t&&await t.auth.signOut(),r}}function bD({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}class vD{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const n=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),n}else{this.errorBackoff=3e4;const r=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;const n=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},n)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class my{constructor(e,n){this.createdAt=e,this.lastLoginAt=n,this._initializeTime()}_initializeTime(){this.lastSignInTime=Ru(this.lastLoginAt),this.creationTime=Ru(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function bf(t){const e=t.auth,n=await t.getIdToken(),r=await Bu(t,_f(e,{idToken:n}));Ye(r?.users.length,e,"internal-error");const i=r.users[0];t._notifyReloadListener(i);const o=i.providerUserInfo?.length?cE(i.providerUserInfo):[],l=wD(t.providerData,o),d=t.isAnonymous,h=!(t.email&&i.passwordHash)&&!l?.length,f=d?h:!1,p={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:l,metadata:new my(i.createdAt,i.lastLoginAt),isAnonymous:f};Object.assign(t,p)}async function xD(t){const e=wn(t);await bf(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function wD(t,e){return[...t.filter(r=>!e.some(i=>i.providerId===r.providerId)),...e]}function cE(t){return t.map(({providerId:e,...n})=>({providerId:e,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}))}async function SD(t,e){const n=await oE(t,{},async()=>{const r=ed({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:o}=t.config,l=await lE(t,i,"/v1/token",`key=${o}`),d=await t._getAdditionalHeaders();d["Content-Type"]="application/x-www-form-urlencoded";const h={method:"POST",headers:d,body:r};return t.emulatorConfig&&lc(t.emulatorConfig.host)&&(h.credentials="include"),aE.fetch()(l,h)});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}async function ED(t,e){return Ua(t,"POST","/v2/accounts:revokeToken",zo(t,e))}class Vl{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Ye(e.idToken,"internal-error"),Ye(typeof e.idToken<"u","internal-error"),Ye(typeof e.refreshToken<"u","internal-error");const n="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):dw(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,n)}updateFromIdToken(e){Ye(e.length!==0,"internal-error");const n=dw(e);this.updateTokensAndExpiration(e,null,n)}async getToken(e,n=!1){return!n&&this.accessToken&&!this.isExpired?this.accessToken:(Ye(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,n){const{accessToken:r,refreshToken:i,expiresIn:o}=await SD(e,n);this.updateTokensAndExpiration(r,i,Number(o))}updateTokensAndExpiration(e,n,r){this.refreshToken=n||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,n){const{refreshToken:r,accessToken:i,expirationTime:o}=n,l=new Vl;return r&&(Ye(typeof r=="string","internal-error",{appName:e}),l.refreshToken=r),i&&(Ye(typeof i=="string","internal-error",{appName:e}),l.accessToken=i),o&&(Ye(typeof o=="number","internal-error",{appName:e}),l.expirationTime=o),l}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Vl,this.toJSON())}_performRefresh(){return bi("not implemented")}}function ha(t,e){Ye(typeof t=="string"||typeof t>"u","internal-error",{appName:e})}class us{constructor({uid:e,auth:n,stsTokenManager:r,...i}){this.providerId="firebase",this.proactiveRefresh=new vD(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new my(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const n=await Bu(this,this.stsTokenManager.getToken(this.auth,e));return Ye(n,this.auth,"internal-error"),this.accessToken!==n&&(this.accessToken=n,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),n}getIdTokenResult(e){return _D(this,e)}reload(){return xD(this)}_assign(e){this!==e&&(Ye(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(n=>({...n})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const n=new us({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return n.metadata._copy(this.metadata),n}_onReload(e){Ye(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,n=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),n&&await bf(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(cs(this.auth.app))return Promise.reject(Ta(this.auth));const e=await this.getIdToken();return await Bu(this,yD(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,n){const r=n.displayName??void 0,i=n.email??void 0,o=n.phoneNumber??void 0,l=n.photoURL??void 0,d=n.tenantId??void 0,h=n._redirectEventId??void 0,f=n.createdAt??void 0,p=n.lastLoginAt??void 0,{uid:g,emailVerified:b,isAnonymous:_,providerData:w,stsTokenManager:x}=n;Ye(g&&x,e,"internal-error");const S=Vl.fromJSON(this.name,x);Ye(typeof g=="string",e,"internal-error"),ha(r,e.name),ha(i,e.name),Ye(typeof b=="boolean",e,"internal-error"),Ye(typeof _=="boolean",e,"internal-error"),ha(o,e.name),ha(l,e.name),ha(d,e.name),ha(h,e.name),ha(f,e.name),ha(p,e.name);const C=new us({uid:g,auth:e,email:i,emailVerified:b,displayName:r,isAnonymous:_,photoURL:l,phoneNumber:o,tenantId:d,stsTokenManager:S,createdAt:f,lastLoginAt:p});return w&&Array.isArray(w)&&(C.providerData=w.map(T=>({...T}))),h&&(C._redirectEventId=h),C}static async _fromIdTokenResponse(e,n,r=!1){const i=new Vl;i.updateFromServerResponse(n);const o=new us({uid:n.localId,auth:e,stsTokenManager:i,isAnonymous:r});return await bf(o),o}static async _fromGetAccountInfoResponse(e,n,r){const i=n.users[0];Ye(i.localId!==void 0,"internal-error");const o=i.providerUserInfo!==void 0?cE(i.providerUserInfo):[],l=!(i.email&&i.passwordHash)&&!o?.length,d=new Vl;d.updateFromIdToken(r);const h=new us({uid:i.localId,auth:e,stsTokenManager:d,isAnonymous:l}),f={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:o,metadata:new my(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!o?.length};return Object.assign(h,f),h}}const hw=new Map;function vi(t){Ti(t instanceof Function,"Expected a class definition");let e=hw.get(t);return e?(Ti(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,hw.set(t,e),e)}class uE{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,n){this.storage[e]=n}async _get(e){const n=this.storage[e];return n===void 0?null:n}async _remove(e){delete this.storage[e]}_addListener(e,n){}_removeListener(e,n){}}uE.type="NONE";const fw=uE;function nf(t,e,n){return`firebase:${t}:${e}:${n}`}class $l{constructor(e,n,r){this.persistence=e,this.auth=n,this.userKey=r;const{config:i,name:o}=this.auth;this.fullUserKey=nf(this.userKey,i.apiKey,o),this.fullPersistenceKey=nf("persistence",i.apiKey,o),this.boundEventHandler=n._onStorageEvent.bind(n),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const n=await _f(this.auth,{idToken:e}).catch(()=>{});return n?us._fromGetAccountInfoResponse(this.auth,n,e):null}return us._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const n=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,n)return this.setCurrentUser(n)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,n,r="authUser"){if(!n.length)return new $l(vi(fw),e,r);const i=(await Promise.all(n.map(async f=>{if(await f._isAvailable())return f}))).filter(f=>f);let o=i[0]||vi(fw);const l=nf(r,e.config.apiKey,e.name);let d=null;for(const f of n)try{const p=await f._get(l);if(p){let g;if(typeof p=="string"){const b=await _f(e,{idToken:p}).catch(()=>{});if(!b)break;g=await us._fromGetAccountInfoResponse(e,b,p)}else g=us._fromJSON(e,p);f!==o&&(d=g),o=f;break}}catch{}const h=i.filter(f=>f._shouldAllowMigration);return!o._shouldAllowMigration||!h.length?new $l(o,e,r):(o=h[0],d&&await o._set(l,d.toJSON()),await Promise.all(n.map(async f=>{if(f!==o)try{await f._remove(l)}catch{}})),new $l(o,e,r))}}function mw(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(mE(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(dE(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(gE(e))return"Blackberry";if(yE(e))return"Webos";if(hE(e))return"Safari";if((e.includes("chrome/")||fE(e))&&!e.includes("edge/"))return"Chrome";if(pE(e))return"Android";{const n=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=t.match(n);if(r?.length===2)return r[1]}return"Other"}function dE(t=er()){return/firefox\//i.test(t)}function hE(t=er()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function fE(t=er()){return/crios\//i.test(t)}function mE(t=er()){return/iemobile/i.test(t)}function pE(t=er()){return/android/i.test(t)}function gE(t=er()){return/blackberry/i.test(t)}function yE(t=er()){return/webos/i.test(t)}function t0(t=er()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function CD(t=er()){return t0(t)&&!!window.navigator?.standalone}function TD(){return UR()&&document.documentMode===10}function _E(t=er()){return t0(t)||pE(t)||yE(t)||gE(t)||/windows phone/i.test(t)||mE(t)}function bE(t,e=[]){let n;switch(t){case"Browser":n=mw(er());break;case"Worker":n=`${mw(er())}-${t}`;break;default:n=t}const r=e.length?e.join(","):"FirebaseCore-web";return`${n}/JsCore/${cc}/${r}`}class AD{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,n){const r=o=>new Promise((l,d)=>{try{const h=e(o);l(h)}catch(h){d(h)}});r.onAbort=n,this.queue.push(r);const i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const n=[];try{for(const r of this.queue)await r(e),r.onAbort&&n.push(r.onAbort)}catch(r){n.reverse();for(const i of n)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r?.message})}}}async function jD(t,e={}){return Ua(t,"GET","/v2/passwordPolicy",zo(t,e))}const RD=6;class ID{constructor(e){const n=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=n.minPasswordLength??RD,n.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=n.maxPasswordLength),n.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=n.containsLowercaseCharacter),n.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=n.containsUppercaseCharacter),n.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=n.containsNumericCharacter),n.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=n.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const n={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,n),this.validatePasswordCharacterOptions(e,n),n.isValid&&(n.isValid=n.meetsMinPasswordLength??!0),n.isValid&&(n.isValid=n.meetsMaxPasswordLength??!0),n.isValid&&(n.isValid=n.containsLowercaseLetter??!0),n.isValid&&(n.isValid=n.containsUppercaseLetter??!0),n.isValid&&(n.isValid=n.containsNumericCharacter??!0),n.isValid&&(n.isValid=n.containsNonAlphanumericCharacter??!0),n}validatePasswordLengthOptions(e,n){const r=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;r&&(n.meetsMinPasswordLength=e.length>=r),i&&(n.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,n){this.updatePasswordCharacterOptionsStatuses(n,!1,!1,!1,!1);let r;for(let i=0;i<e.length;i++)r=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(n,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,n,r,i,o){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=n)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=o))}}class DD{constructor(e,n,r,i){this.app=e,this.heartbeatServiceProvider=n,this.appCheckServiceProvider=r,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new pw(this),this.idTokenSubscription=new pw(this),this.beforeStateQueue=new AD(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=sE,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion,this._persistenceManagerAvailable=new Promise(o=>this._resolvePersistenceManagerAvailable=o)}_initializeWithPersistence(e,n){return n&&(this._popupRedirectResolver=vi(n)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await $l.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(n),this.lastNotifiedUid=this.currentUser?.uid||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const n=await _f(this,{idToken:e}),r=await us._fromGetAccountInfoResponse(this,n,e);await this.directlySetCurrentUser(r)}catch(n){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",n),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(cs(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(l=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(l,l))}):this.directlySetCurrentUser(null)}const n=await this.assertedPersistence.getCurrentUser();let r=n,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=this.redirectUser?._redirectEventId,l=r?._redirectEventId,d=await this.tryRedirectSignIn(e);(!o||o===l)&&d?.user&&(r=d.user,i=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(r)}catch(o){r=n,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return Ye(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let n=null;try{n=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return n}async reloadAndSetCurrentUserOrClear(e){try{await bf(e)}catch(n){if(n?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=cD()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(cs(this.app))return Promise.reject(Ta(this));const n=e?wn(e):null;return n&&Ye(n.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(n&&n._clone(this))}async _updateCurrentUser(e,n=!1){if(!this._deleted)return e&&Ye(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),n||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return cs(this.app)?Promise.reject(Ta(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return cs(this.app)?Promise.reject(Ta(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(vi(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const n=this._getPasswordPolicyInternal();return n.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):n.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await jD(this),n=new ID(e);this.tenantId===null?this._projectPasswordPolicy=n:this._tenantPasswordPolicies[this.tenantId]=n}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new Ju("auth","Firebase",e())}onAuthStateChanged(e,n,r){return this.registerStateListener(this.authStateSubscription,e,n,r)}beforeAuthStateChanged(e,n){return this.beforeStateQueue.pushCallback(e,n)}onIdTokenChanged(e,n,r){return this.registerStateListener(this.idTokenSubscription,e,n,r)}authStateReady(){return new Promise((e,n)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},n)}})}async revokeAccessToken(e){if(this.currentUser){const n=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:n};this.tenantId!=null&&(r.tenantId=this.tenantId),await ED(this,r)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,n){const r=await this.getOrInitRedirectPersistenceManager(n);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const n=e&&vi(e)||this._popupRedirectResolver;Ye(n,this,"argument-error"),this.redirectPersistenceManager=await $l.create(this,[vi(n._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,n,r,i){if(this._deleted)return()=>{};const o=typeof n=="function"?n:n.next.bind(n);let l=!1;const d=this._isInitialized?Promise.resolve():this._initializationPromise;if(Ye(d,this,"internal-error"),d.then(()=>{l||o(this.currentUser)}),typeof n=="function"){const h=e.addObserver(n,r,i);return()=>{l=!0,h()}}else{const h=e.addObserver(n);return()=>{l=!0,h()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Ye(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=bE(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const n=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();n&&(e["X-Firebase-Client"]=n);const r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){if(cs(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&aD(`Error while retrieving App Check token: ${e.error}`),e?.token}}function uc(t){return wn(t)}class pw{constructor(e){this.auth=e,this.observer=null,this.addObserver=QR(n=>this.observer=n)}get next(){return Ye(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let Qf={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function kD(t){Qf=t}function vE(t){return Qf.loadJS(t)}function MD(){return Qf.recaptchaEnterpriseScript}function OD(){return Qf.gapiScript}function ND(t){return`__${t}${Math.floor(Math.random()*1e6)}`}class PD{constructor(){this.enterprise=new BD}ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}class BD{ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}const zD="recaptcha-enterprise",xE="NO_RECAPTCHA";class LD{constructor(e){this.type=zD,this.auth=uc(e)}async verify(e="verify",n=!1){async function r(o){if(!n){if(o.tenantId==null&&o._agentRecaptchaConfig!=null)return o._agentRecaptchaConfig.siteKey;if(o.tenantId!=null&&o._tenantRecaptchaConfigs[o.tenantId]!==void 0)return o._tenantRecaptchaConfigs[o.tenantId].siteKey}return new Promise(async(l,d)=>{gD(o,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(h=>{if(h.recaptchaKey===void 0)d(new Error("recaptcha Enterprise site key undefined"));else{const f=new pD(h);return o.tenantId==null?o._agentRecaptchaConfig=f:o._tenantRecaptchaConfigs[o.tenantId]=f,l(f.siteKey)}}).catch(h=>{d(h)})})}function i(o,l,d){const h=window.grecaptcha;uw(h)?h.enterprise.ready(()=>{h.enterprise.execute(o,{action:e}).then(f=>{l(f)}).catch(()=>{l(xE)})}):d(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new PD().execute("siteKey",{action:"verify"}):new Promise((o,l)=>{r(this.auth).then(d=>{if(!n&&uw(window.grecaptcha))i(d,o,l);else{if(typeof window>"u"){l(new Error("RecaptchaVerifier is only supported in browser"));return}let h=MD();h.length!==0&&(h+=d),vE(h).then(()=>{i(d,o,l)}).catch(f=>{l(f)})}}).catch(d=>{l(d)})})}}async function gw(t,e,n,r=!1,i=!1){const o=new LD(t);let l;if(i)l=xE;else try{l=await o.verify(n)}catch{l=await o.verify(n,!0)}const d={...e};if(n==="mfaSmsEnrollment"||n==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in d){const h=d.phoneEnrollmentInfo.phoneNumber,f=d.phoneEnrollmentInfo.recaptchaToken;Object.assign(d,{phoneEnrollmentInfo:{phoneNumber:h,recaptchaToken:f,captchaResponse:l,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in d){const h=d.phoneSignInInfo.recaptchaToken;Object.assign(d,{phoneSignInInfo:{recaptchaToken:h,captchaResponse:l,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return d}return r?Object.assign(d,{captchaResp:l}):Object.assign(d,{captchaResponse:l}),Object.assign(d,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(d,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),d}async function yw(t,e,n,r,i){if(t._getRecaptchaConfig()?.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const o=await gw(t,e,n,n==="getOobCode");return r(t,o)}else return r(t,e).catch(async o=>{if(o.code==="auth/missing-recaptcha-token"){console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const l=await gw(t,e,n,n==="getOobCode");return r(t,l)}else return Promise.reject(o)})}function UD(t,e){const n=Xy(t,"auth");if(n.isInitialized()){const i=n.getImmediate(),o=n.getOptions();if(Ei(o,e??{}))return i;fs(i,"already-initialized")}return n.initialize({options:e})}function FD(t,e){const n=e?.persistence||[],r=(Array.isArray(n)?n:[n]).map(vi);e?.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(r,e?.popupRedirectResolver)}function VD(t,e,n){const r=uc(t);Ye(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const i=!1,o=wE(e),{host:l,port:d}=$D(e),h=d===null?"":`:${d}`,f={url:`${o}//${l}${h}/`},p=Object.freeze({host:l,port:d,protocol:o.replace(":",""),options:Object.freeze({disableWarnings:i})});if(!r._canInitEmulator){Ye(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),Ye(Ei(f,r.config.emulator)&&Ei(p,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=f,r.emulatorConfig=p,r.settings.appVerificationDisabledForTesting=!0,lc(l)?(K1(`${o}//${l}${h}`),Y1("Auth",!0)):qD()}function wE(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function $D(t){const e=wE(t),n=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){const o=i[1];return{host:o,port:_w(r.substr(o.length+1))}}else{const[o,l]=r.split(":");return{host:o,port:_w(l)}}}function _w(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}function qD(){function t(){const e=document.createElement("p"),n=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",n.position="fixed",n.width="100%",n.backgroundColor="#ffffff",n.border=".1em solid #000000",n.color="#b50000",n.bottom="0px",n.left="0px",n.margin="0px",n.zIndex="10000",n.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",t):t())}class n0{constructor(e,n){this.providerId=e,this.signInMethod=n}toJSON(){return bi("not implemented")}_getIdTokenResponse(e){return bi("not implemented")}_linkToIdToken(e,n){return bi("not implemented")}_getReauthenticationResolver(e){return bi("not implemented")}}async function HD(t,e){return Ua(t,"POST","/v1/accounts:signUp",e)}async function GD(t,e){return Wf(t,"POST","/v1/accounts:signInWithPassword",zo(t,e))}async function WD(t,e){return Wf(t,"POST","/v1/accounts:signInWithEmailLink",zo(t,e))}async function QD(t,e){return Wf(t,"POST","/v1/accounts:signInWithEmailLink",zo(t,e))}class zu extends n0{constructor(e,n,r,i=null){super("password",r),this._email=e,this._password=n,this._tenantId=i}static _fromEmailAndPassword(e,n){return new zu(e,n,"password")}static _fromEmailAndCode(e,n,r=null){return new zu(e,n,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e;if(n?.email&&n?.password){if(n.signInMethod==="password")return this._fromEmailAndPassword(n.email,n.password);if(n.signInMethod==="emailLink")return this._fromEmailAndCode(n.email,n.password,n.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const n={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return yw(e,n,"signInWithPassword",GD);case"emailLink":return WD(e,{email:this._email,oobCode:this._password});default:fs(e,"internal-error")}}async _linkToIdToken(e,n){switch(this.signInMethod){case"password":const r={idToken:n,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return yw(e,r,"signUpPassword",HD);case"emailLink":return QD(e,{idToken:n,email:this._email,oobCode:this._password});default:fs(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function ql(t,e){return Wf(t,"POST","/v1/accounts:signInWithIdp",zo(t,e))}const KD="http://localhost";class ko extends n0{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const n=new ko(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(n.idToken=e.idToken),e.accessToken&&(n.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(n.nonce=e.nonce),e.pendingToken&&(n.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(n.accessToken=e.oauthToken,n.secret=e.oauthTokenSecret):fs("argument-error"),n}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:i,...o}=n;if(!r||!i)return null;const l=new ko(r,i);return l.idToken=o.idToken||void 0,l.accessToken=o.accessToken||void 0,l.secret=o.secret,l.nonce=o.nonce,l.pendingToken=o.pendingToken||null,l}_getIdTokenResponse(e){const n=this.buildRequest();return ql(e,n)}_linkToIdToken(e,n){const r=this.buildRequest();return r.idToken=n,ql(e,r)}_getReauthenticationResolver(e){const n=this.buildRequest();return n.autoCreate=!1,ql(e,n)}buildRequest(){const e={requestUri:KD,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const n={};this.idToken&&(n.id_token=this.idToken),this.accessToken&&(n.access_token=this.accessToken),this.secret&&(n.oauth_token_secret=this.secret),n.providerId=this.providerId,this.nonce&&!this.pendingToken&&(n.nonce=this.nonce),e.postBody=ed(n)}return e}}function YD(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function XD(t){const e=wu(Su(t)).link,n=e?wu(Su(e)).deep_link_id:null,r=wu(Su(t)).deep_link_id;return(r?wu(Su(r)).link:null)||r||n||e||t}class r0{constructor(e){const n=wu(Su(e)),r=n.apiKey??null,i=n.oobCode??null,o=YD(n.mode??null);Ye(r&&i&&o,"argument-error"),this.apiKey=r,this.operation=o,this.code=i,this.continueUrl=n.continueUrl??null,this.languageCode=n.lang??null,this.tenantId=n.tenantId??null}static parseLink(e){const n=XD(e);try{return new r0(n)}catch{return null}}}class dc{constructor(){this.providerId=dc.PROVIDER_ID}static credential(e,n){return zu._fromEmailAndPassword(e,n)}static credentialWithLink(e,n){const r=r0.parseLink(n);return Ye(r,"argument-error"),zu._fromEmailAndCode(e,r.code,r.tenantId)}}dc.PROVIDER_ID="password";dc.EMAIL_PASSWORD_SIGN_IN_METHOD="password";dc.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class SE{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class nd extends SE{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class ma extends nd{constructor(){super("facebook.com")}static credential(e){return ko._fromParams({providerId:ma.PROVIDER_ID,signInMethod:ma.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return ma.credentialFromTaggedObject(e)}static credentialFromError(e){return ma.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return ma.credential(e.oauthAccessToken)}catch{return null}}}ma.FACEBOOK_SIGN_IN_METHOD="facebook.com";ma.PROVIDER_ID="facebook.com";class pa extends nd{constructor(){super("google.com"),this.addScope("profile")}static credential(e,n){return ko._fromParams({providerId:pa.PROVIDER_ID,signInMethod:pa.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:n})}static credentialFromResult(e){return pa.credentialFromTaggedObject(e)}static credentialFromError(e){return pa.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:n,oauthAccessToken:r}=e;if(!n&&!r)return null;try{return pa.credential(n,r)}catch{return null}}}pa.GOOGLE_SIGN_IN_METHOD="google.com";pa.PROVIDER_ID="google.com";class ga extends nd{constructor(){super("github.com")}static credential(e){return ko._fromParams({providerId:ga.PROVIDER_ID,signInMethod:ga.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return ga.credentialFromTaggedObject(e)}static credentialFromError(e){return ga.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return ga.credential(e.oauthAccessToken)}catch{return null}}}ga.GITHUB_SIGN_IN_METHOD="github.com";ga.PROVIDER_ID="github.com";class ya extends nd{constructor(){super("twitter.com")}static credential(e,n){return ko._fromParams({providerId:ya.PROVIDER_ID,signInMethod:ya.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:n})}static credentialFromResult(e){return ya.credentialFromTaggedObject(e)}static credentialFromError(e){return ya.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:n,oauthTokenSecret:r}=e;if(!n||!r)return null;try{return ya.credential(n,r)}catch{return null}}}ya.TWITTER_SIGN_IN_METHOD="twitter.com";ya.PROVIDER_ID="twitter.com";class Ql{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,n,r,i=!1){const o=await us._fromIdTokenResponse(e,r,i),l=bw(r);return new Ql({user:o,providerId:l,_tokenResponse:r,operationType:n})}static async _forOperation(e,n,r){await e._updateTokensIfNecessary(r,!0);const i=bw(r);return new Ql({user:e,providerId:i,_tokenResponse:r,operationType:n})}}function bw(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}class vf extends Di{constructor(e,n,r,i){super(n.code,n.message),this.operationType=r,this.user=i,Object.setPrototypeOf(this,vf.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:n.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,n,r,i){return new vf(e,n,r,i)}}function EE(t,e,n,r){return(e==="reauthenticate"?n._getReauthenticationResolver(t):n._getIdTokenResponse(t)).catch(o=>{throw o.code==="auth/multi-factor-auth-required"?vf._fromErrorAndOperation(t,o,e,r):o})}async function ZD(t,e,n=!1){const r=await Bu(t,e._linkToIdToken(t.auth,await t.getIdToken()),n);return Ql._forOperation(t,"link",r)}async function JD(t,e,n=!1){const{auth:r}=t;if(cs(r.app))return Promise.reject(Ta(r));const i="reauthenticate";try{const o=await Bu(t,EE(r,i,e,t),n);Ye(o.idToken,r,"internal-error");const l=e0(o.idToken);Ye(l,r,"internal-error");const{sub:d}=l;return Ye(t.uid===d,r,"user-mismatch"),Ql._forOperation(t,i,o)}catch(o){throw o?.code==="auth/user-not-found"&&fs(r,"user-mismatch"),o}}async function CE(t,e,n=!1){if(cs(t.app))return Promise.reject(Ta(t));const r="signIn",i=await EE(t,r,e),o=await Ql._fromIdTokenResponse(t,r,i);return n||await t._updateCurrentUser(o.user),o}async function ek(t,e){return CE(uc(t),e)}async function tk(t){const e=uc(t);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}function nk(t,e,n){return cs(t.app)?Promise.reject(Ta(t)):ek(wn(t),dc.credential(e,n)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&tk(t),r})}function rk(t,e,n,r){return wn(t).onIdTokenChanged(e,n,r)}function sk(t,e,n){return wn(t).beforeAuthStateChanged(e,n)}function ik(t,e,n,r){return wn(t).onAuthStateChanged(e,n,r)}function ak(t){return wn(t).signOut()}const xf="__sak";class TE{constructor(e,n){this.storageRetriever=e,this.type=n}_isAvailable(){try{return this.storage?(this.storage.setItem(xf,"1"),this.storage.removeItem(xf),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,n){return this.storage.setItem(e,JSON.stringify(n)),Promise.resolve()}_get(e){const n=this.storage.getItem(e);return Promise.resolve(n?JSON.parse(n):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}const ok=1e3,lk=10;class AE extends TE{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,n)=>this.onStorageEvent(e,n),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=_E(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const n of Object.keys(this.listeners)){const r=this.storage.getItem(n),i=this.localCache[n];r!==i&&e(n,i,r)}}onStorageEvent(e,n=!1){if(!e.key){this.forAllChangedKeys((l,d,h)=>{this.notifyListeners(l,h)});return}const r=e.key;n?this.detachListener():this.stopPolling();const i=()=>{const l=this.storage.getItem(r);!n&&this.localCache[r]===l||this.notifyListeners(r,l)},o=this.storage.getItem(r);TD()&&o!==e.newValue&&e.newValue!==e.oldValue?setTimeout(i,lk):i()}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const i of Array.from(r))i(n&&JSON.parse(n))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,n,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:n,newValue:r}),!0)})},ok)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,n){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,n){await super._set(e,n),this.localCache[e]=JSON.stringify(n)}async _get(e){const n=await super._get(e);return this.localCache[e]=JSON.stringify(n),n}async _remove(e){await super._remove(e),delete this.localCache[e]}}AE.type="LOCAL";const ck=AE;class jE extends TE{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,n){}_removeListener(e,n){}}jE.type="SESSION";const RE=jE;function uk(t){return Promise.all(t.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(n){return{fulfilled:!1,reason:n}}}))}class Kf{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const n=this.receivers.find(i=>i.isListeningto(e));if(n)return n;const r=new Kf(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const n=e,{eventId:r,eventType:i,data:o}=n.data,l=this.handlersMap[i];if(!l?.size)return;n.ports[0].postMessage({status:"ack",eventId:r,eventType:i});const d=Array.from(l).map(async f=>f(n.origin,o)),h=await uk(d);n.ports[0].postMessage({status:"done",eventId:r,eventType:i,response:h})}_subscribe(e,n){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(n)}_unsubscribe(e,n){this.handlersMap[e]&&n&&this.handlersMap[e].delete(n),(!n||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Kf.receivers=[];function s0(t="",e=10){let n="";for(let r=0;r<e;r++)n+=Math.floor(Math.random()*10);return t+n}class dk{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,n,r=50){const i=typeof MessageChannel<"u"?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let o,l;return new Promise((d,h)=>{const f=s0("",20);i.port1.start();const p=setTimeout(()=>{h(new Error("unsupported_event"))},r);l={messageChannel:i,onMessage(g){const b=g;if(b.data.eventId===f)switch(b.data.status){case"ack":clearTimeout(p),o=setTimeout(()=>{h(new Error("timeout"))},3e3);break;case"done":clearTimeout(o),d(b.data.response);break;default:clearTimeout(p),clearTimeout(o),h(new Error("invalid_response"));break}}},this.handlers.add(l),i.port1.addEventListener("message",l.onMessage),this.target.postMessage({eventType:e,eventId:f,data:n},[i.port2])}).finally(()=>{l&&this.removeMessageHandler(l)})}}function Vs(){return window}function hk(t){Vs().location.href=t}function IE(){return typeof Vs().WorkerGlobalScope<"u"&&typeof Vs().importScripts=="function"}async function fk(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function mk(){return navigator?.serviceWorker?.controller||null}function pk(){return IE()?self:null}const DE="firebaseLocalStorageDb",gk=1,wf="firebaseLocalStorage",kE="fbase_key";class rd{constructor(e){this.request=e}toPromise(){return new Promise((e,n)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{n(this.request.error)})})}}function Yf(t,e){return t.transaction([wf],e?"readwrite":"readonly").objectStore(wf)}function yk(){const t=indexedDB.deleteDatabase(DE);return new rd(t).toPromise()}function py(){const t=indexedDB.open(DE,gk);return new Promise((e,n)=>{t.addEventListener("error",()=>{n(t.error)}),t.addEventListener("upgradeneeded",()=>{const r=t.result;try{r.createObjectStore(wf,{keyPath:kE})}catch(i){n(i)}}),t.addEventListener("success",async()=>{const r=t.result;r.objectStoreNames.contains(wf)?e(r):(r.close(),await yk(),e(await py()))})})}async function vw(t,e,n){const r=Yf(t,!0).put({[kE]:e,value:n});return new rd(r).toPromise()}async function _k(t,e){const n=Yf(t,!1).get(e),r=await new rd(n).toPromise();return r===void 0?null:r.value}function xw(t,e){const n=Yf(t,!0).delete(e);return new rd(n).toPromise()}const bk=800,vk=3;class ME{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await py(),this.db)}async _withRetries(e){let n=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(n++>vk)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return IE()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Kf._getInstance(pk()),this.receiver._subscribe("keyChanged",async(e,n)=>({keyProcessed:(await this._poll()).includes(n.key)})),this.receiver._subscribe("ping",async(e,n)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await fk(),!this.activeServiceWorker)return;this.sender=new dk(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||mk()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await py();return await vw(e,xf,"1"),await xw(e,xf),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,n){return this._withPendingWrite(async()=>(await this._withRetries(r=>vw(r,e,n)),this.localCache[e]=n,this.notifyServiceWorker(e)))}async _get(e){const n=await this._withRetries(r=>_k(r,e));return this.localCache[e]=n,n}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(n=>xw(n,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(i=>{const o=Yf(i,!1).getAll();return new rd(o).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const n=[],r=new Set;if(e.length!==0)for(const{fbase_key:i,value:o}of e)r.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(o)&&(this.notifyListeners(i,o),n.push(i));for(const i of Object.keys(this.localCache))this.localCache[i]&&!r.has(i)&&(this.notifyListeners(i,null),n.push(i));return n}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const i of Array.from(r))i(n)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),bk)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,n){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}ME.type="LOCAL";const xk=ME;new td(3e4,6e4);function wk(t,e){return e?vi(e):(Ye(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}class i0 extends n0{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return ql(e,this._buildIdpRequest())}_linkToIdToken(e,n){return ql(e,this._buildIdpRequest(n))}_getReauthenticationResolver(e){return ql(e,this._buildIdpRequest())}_buildIdpRequest(e){const n={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(n.idToken=e),n}}function Sk(t){return CE(t.auth,new i0(t),t.bypassAuthState)}function Ek(t){const{auth:e,user:n}=t;return Ye(n,e,"internal-error"),JD(n,new i0(t),t.bypassAuthState)}async function Ck(t){const{auth:e,user:n}=t;return Ye(n,e,"internal-error"),ZD(n,new i0(t),t.bypassAuthState)}class OE{constructor(e,n,r,i,o=!1){this.auth=e,this.resolver=r,this.user=i,this.bypassAuthState=o,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(n)?n:[n]}execute(){return new Promise(async(e,n)=>{this.pendingPromise={resolve:e,reject:n};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:n,sessionId:r,postBody:i,tenantId:o,error:l,type:d}=e;if(l){this.reject(l);return}const h={auth:this.auth,requestUri:n,sessionId:r,tenantId:o||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(d)(h))}catch(f){this.reject(f)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Sk;case"linkViaPopup":case"linkViaRedirect":return Ck;case"reauthViaPopup":case"reauthViaRedirect":return Ek;default:fs(this.auth,"internal-error")}}resolve(e){Ti(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Ti(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const Tk=new td(2e3,1e4);class Fl extends OE{constructor(e,n,r,i,o){super(e,n,i,o),this.provider=r,this.authWindow=null,this.pollId=null,Fl.currentPopupAction&&Fl.currentPopupAction.cancel(),Fl.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Ye(e,this.auth,"internal-error"),e}async onExecution(){Ti(this.filter.length===1,"Popup operations only handle one event");const e=s0();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(n=>{this.reject(n)}),this.resolver._isIframeWebStorageSupported(this.auth,n=>{n||this.reject(Fs(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(Fs(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Fl.currentPopupAction=null}pollUserCancellation(){const e=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Fs(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,Tk.get())};e()}}Fl.currentPopupAction=null;const Ak="pendingRedirect",rf=new Map;class jk extends OE{constructor(e,n,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],n,void 0,r),this.eventId=null}async execute(){let e=rf.get(this.auth._key());if(!e){try{const r=await Rk(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(n){e=()=>Promise.reject(n)}rf.set(this.auth._key(),e)}return this.bypassAuthState||rf.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const n=await this.auth._redirectUserForId(e.eventId);if(n)return this.user=n,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function Rk(t,e){const n=kk(e),r=Dk(t);if(!await r._isAvailable())return!1;const i=await r._get(n)==="true";return await r._remove(n),i}function Ik(t,e){rf.set(t._key(),e)}function Dk(t){return vi(t._redirectPersistence)}function kk(t){return nf(Ak,t.config.apiKey,t.name)}async function Mk(t,e,n=!1){if(cs(t.app))return Promise.reject(Ta(t));const r=uc(t),i=wk(r,e),l=await new jk(r,i,n).execute();return l&&!n&&(delete l.user._redirectEventId,await r._persistUserIfCurrent(l.user),await r._setRedirectUser(null,e)),l}const Ok=600*1e3;class Nk{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let n=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(n=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!Pk(e)||(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=e,n=!0)),n}sendToConsumer(e,n){if(e.error&&!NE(e)){const r=e.error.code?.split("auth/")[1]||"internal-error";n.onError(Fs(this.auth,r))}else n.onAuthEvent(e)}isEventForConsumer(e,n){const r=n.eventId===null||!!e.eventId&&e.eventId===n.eventId;return n.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=Ok&&this.cachedEventUids.clear(),this.cachedEventUids.has(ww(e))}saveEventToCache(e){this.cachedEventUids.add(ww(e)),this.lastProcessedEventTime=Date.now()}}function ww(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(e=>e).join("-")}function NE({type:t,error:e}){return t==="unknown"&&e?.code==="auth/no-auth-event"}function Pk(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return NE(t);default:return!1}}async function Bk(t,e={}){return Ua(t,"GET","/v1/projects",e)}const zk=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Lk=/^https?/;async function Uk(t){if(t.config.emulator)return;const{authorizedDomains:e}=await Bk(t);for(const n of e)try{if(Fk(n))return}catch{}fs(t,"unauthorized-domain")}function Fk(t){const e=fy(),{protocol:n,hostname:r}=new URL(e);if(t.startsWith("chrome-extension://")){const l=new URL(t);return l.hostname===""&&r===""?n==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):n==="chrome-extension:"&&l.hostname===r}if(!Lk.test(n))return!1;if(zk.test(t))return r===t;const i=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}const Vk=new td(3e4,6e4);function Sw(){const t=Vs().___jsl;if(t?.H){for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let n=0;n<t.CP.length;n++)t.CP[n]=null}}function $k(t){return new Promise((e,n)=>{function r(){Sw(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{Sw(),n(Fs(t,"network-request-failed"))},timeout:Vk.get()})}if(Vs().gapi?.iframes?.Iframe)e(gapi.iframes.getContext());else if(Vs().gapi?.load)r();else{const i=ND("iframefcb");return Vs()[i]=()=>{gapi.load?r():n(Fs(t,"network-request-failed"))},vE(`${OD()}?onload=${i}`).catch(o=>n(o))}}).catch(e=>{throw sf=null,e})}let sf=null;function qk(t){return sf=sf||$k(t),sf}const Hk=new td(5e3,15e3),Gk="__/auth/iframe",Wk="emulator/auth/iframe",Qk={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Kk=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Yk(t){const e=t.config;Ye(e.authDomain,t,"auth-domain-config-required");const n=e.emulator?Jy(e,Wk):`https://${t.config.authDomain}/${Gk}`,r={apiKey:e.apiKey,appName:t.name,v:cc},i=Kk.get(t.config.apiHost);i&&(r.eid=i);const o=t._getFrameworks();return o.length&&(r.fw=o.join(",")),`${n}?${ed(r).slice(1)}`}async function Xk(t){const e=await qk(t),n=Vs().gapi;return Ye(n,t,"internal-error"),e.open({where:document.body,url:Yk(t),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Qk,dontclear:!0},r=>new Promise(async(i,o)=>{await r.restyle({setHideOnLeave:!1});const l=Fs(t,"network-request-failed"),d=Vs().setTimeout(()=>{o(l)},Hk.get());function h(){Vs().clearTimeout(d),i(r)}r.ping(h).then(h,()=>{o(l)})}))}const Zk={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},Jk=500,eM=600,tM="_blank",nM="http://localhost";class Ew{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function rM(t,e,n,r=Jk,i=eM){const o=Math.max((window.screen.availHeight-i)/2,0).toString(),l=Math.max((window.screen.availWidth-r)/2,0).toString();let d="";const h={...Zk,width:r.toString(),height:i.toString(),top:o,left:l},f=er().toLowerCase();n&&(d=fE(f)?tM:n),dE(f)&&(e=e||nM,h.scrollbars="yes");const p=Object.entries(h).reduce((b,[_,w])=>`${b}${_}=${w},`,"");if(CD(f)&&d!=="_self")return sM(e||"",d),new Ew(null);const g=window.open(e||"",d,p);Ye(g,t,"popup-blocked");try{g.focus()}catch{}return new Ew(g)}function sM(t,e){const n=document.createElement("a");n.href=t,n.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}const iM="__/auth/handler",aM="emulator/auth/handler",oM=encodeURIComponent("fac");async function Cw(t,e,n,r,i,o){Ye(t.config.authDomain,t,"auth-domain-config-required"),Ye(t.config.apiKey,t,"invalid-api-key");const l={apiKey:t.config.apiKey,appName:t.name,authType:n,redirectUrl:r,v:cc,eventId:i};if(e instanceof SE){e.setDefaultLanguage(t.languageCode),l.providerId=e.providerId||"",WR(e.getCustomParameters())||(l.customParameters=JSON.stringify(e.getCustomParameters()));for(const[p,g]of Object.entries({}))l[p]=g}if(e instanceof nd){const p=e.getScopes().filter(g=>g!=="");p.length>0&&(l.scopes=p.join(","))}t.tenantId&&(l.tid=t.tenantId);const d=l;for(const p of Object.keys(d))d[p]===void 0&&delete d[p];const h=await t._getAppCheckToken(),f=h?`#${oM}=${encodeURIComponent(h)}`:"";return`${lM(t)}?${ed(d).slice(1)}${f}`}function lM({config:t}){return t.emulator?Jy(t,aM):`https://${t.authDomain}/${iM}`}const Fg="webStorageSupport";class cM{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=RE,this._completeRedirectFn=Mk,this._overrideRedirectResult=Ik}async _openPopup(e,n,r,i){Ti(this.eventManagers[e._key()]?.manager,"_initialize() not called before _openPopup()");const o=await Cw(e,n,r,fy(),i);return rM(e,o,s0())}async _openRedirect(e,n,r,i){await this._originValidation(e);const o=await Cw(e,n,r,fy(),i);return hk(o),new Promise(()=>{})}_initialize(e){const n=e._key();if(this.eventManagers[n]){const{manager:i,promise:o}=this.eventManagers[n];return i?Promise.resolve(i):(Ti(o,"If manager is not set, promise should be"),o)}const r=this.initAndGetManager(e);return this.eventManagers[n]={promise:r},r.catch(()=>{delete this.eventManagers[n]}),r}async initAndGetManager(e){const n=await Xk(e),r=new Nk(e);return n.register("authEvent",i=>(Ye(i?.authEvent,e,"invalid-auth-event"),{status:r.onEvent(i.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=n,r}_isIframeWebStorageSupported(e,n){this.iframes[e._key()].send(Fg,{type:Fg},i=>{const o=i?.[0]?.[Fg];o!==void 0&&n(!!o),fs(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const n=e._key();return this.originValidationPromises[n]||(this.originValidationPromises[n]=Uk(e)),this.originValidationPromises[n]}get _shouldInitProactively(){return _E()||hE()||t0()}}const uM=cM;var Tw="@firebase/auth",Aw="1.12.0";class dM{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const n=this.auth.onIdTokenChanged(r=>{e(r?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,n),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const n=this.internalListeners.get(e);n&&(this.internalListeners.delete(e),n(),this.updateProactiveRefresh())}assertAuthConfigured(){Ye(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function hM(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function fM(t){Wl(new Do("auth",(e,{options:n})=>{const r=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),o=e.getProvider("app-check-internal"),{apiKey:l,authDomain:d}=r.options;Ye(l&&!l.includes(":"),"invalid-api-key",{appName:r.name});const h={apiKey:l,authDomain:d,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:bE(t)},f=new DD(r,i,o,h);return FD(f,n),f},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,n,r)=>{e.getProvider("auth-internal").initialize()})),Wl(new Do("auth-internal",e=>{const n=uc(e.getProvider("auth").getImmediate());return(r=>new dM(r))(n)},"PRIVATE").setInstantiationMode("EXPLICIT")),Ca(Tw,Aw,hM(t)),Ca(Tw,Aw,"esm2020")}const mM=300,pM=Q1("authIdTokenMaxAge")||mM;let jw=null;const gM=t=>async e=>{const n=e&&await e.getIdTokenResult(),r=n&&(new Date().getTime()-Date.parse(n.issuedAtTime))/1e3;if(r&&r>pM)return;const i=n?.token;jw!==i&&(jw=i,await fetch(t,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))};function yM(t=eE()){const e=Xy(t,"auth");if(e.isInitialized())return e.getImmediate();const n=UD(t,{popupRedirectResolver:uM,persistence:[xk,ck,RE]}),r=Q1("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const o=new URL(r,location.origin);if(location.origin===o.origin){const l=gM(o.toString());sk(n,l,()=>l(n.currentUser)),rk(n,d=>l(d))}}const i=G1("auth");return i&&VD(n,`http://${i}`),n}function _M(){return document.getElementsByTagName("head")?.[0]??document}kD({loadJS(t){return new Promise((e,n)=>{const r=document.createElement("script");r.setAttribute("src",t),r.onload=e,r.onerror=i=>{const o=Fs("internal-error");o.customData=i,n(o)},r.type="text/javascript",r.charset="UTF-8",_M().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});fM("Browser");var bM="firebase",vM="12.7.0";Ca(bM,vM,"app");const xM={apiKey:"AIzaSyCfvR8bEeW2CXdD31Ec34doRNThnbryXJo",authDomain:"budget-tkl.firebaseapp.com",projectId:"budget-tkl",storageBucket:"budget-tkl.firebasestorage.app",messagingSenderId:"631248313026",appId:"1:631248313026:web:36574d789a42b2d102f95b"},PE=J1(xM);function ki(){const t=yM(PE);async function e(){return!1}async function n(h,f){return nk(t,h,f)}function r(){return ak(t)}function i(h){ik(t,f=>{h(f)})}function o(){return t.currentUser}function l(){const h=t.currentUser;if(!h)throw new Error("Not authenticated");if(!h.email)throw new Error("Email is required but not available for this account");return h.email}return{set_user_listener:i,delete_firebase_user:e,login_firebase_user:n,logout_firebase_user:r,get_current_firebase_user:o,requireUserEmail:l}}const hs=300*1e3,wM=1800*1e3,Pe=new oR({defaultOptions:{queries:{staleTime:hs,gcTime:wM,refetchOnWindowFocus:!1,refetchOnReconnect:!0,retry:1,refetchOnMount:!0},mutations:{retry:1}}});Pe.getQueryCache().subscribe(t=>{const e=t?.query;if(e&&t.type==="updated"){const{state:n}=e;n.status==="error"&&n.error&&console.error("[RQ] Query FAILED:",e.queryKey,n.error)}});const Ce={user:t=>["user",t],budget:t=>["budget",t],month:(t,e,n)=>["month",t,e,n],payees:t=>["payees",t],accessibleBudgets:t=>["accessibleBudgets",t],feedback:()=>["feedback"]};function SM({children:t}){return u.jsx(lR,{client:Pe,children:t})}var Rw=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var Aa,BE;(function(){var t;function e(k,M){function B(){}B.prototype=M.prototype,k.F=M.prototype,k.prototype=new B,k.prototype.constructor=k,k.D=function(U,q,I){for(var N=Array(arguments.length-2),O=2;O<arguments.length;O++)N[O-2]=arguments[O];return M.prototype[q].apply(U,N)}}function n(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(r,n),r.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(k,M,B){B||(B=0);const U=Array(16);if(typeof M=="string")for(var q=0;q<16;++q)U[q]=M.charCodeAt(B++)|M.charCodeAt(B++)<<8|M.charCodeAt(B++)<<16|M.charCodeAt(B++)<<24;else for(q=0;q<16;++q)U[q]=M[B++]|M[B++]<<8|M[B++]<<16|M[B++]<<24;M=k.g[0],B=k.g[1],q=k.g[2];let I=k.g[3],N;N=M+(I^B&(q^I))+U[0]+3614090360&4294967295,M=B+(N<<7&4294967295|N>>>25),N=I+(q^M&(B^q))+U[1]+3905402710&4294967295,I=M+(N<<12&4294967295|N>>>20),N=q+(B^I&(M^B))+U[2]+606105819&4294967295,q=I+(N<<17&4294967295|N>>>15),N=B+(M^q&(I^M))+U[3]+3250441966&4294967295,B=q+(N<<22&4294967295|N>>>10),N=M+(I^B&(q^I))+U[4]+4118548399&4294967295,M=B+(N<<7&4294967295|N>>>25),N=I+(q^M&(B^q))+U[5]+1200080426&4294967295,I=M+(N<<12&4294967295|N>>>20),N=q+(B^I&(M^B))+U[6]+2821735955&4294967295,q=I+(N<<17&4294967295|N>>>15),N=B+(M^q&(I^M))+U[7]+4249261313&4294967295,B=q+(N<<22&4294967295|N>>>10),N=M+(I^B&(q^I))+U[8]+1770035416&4294967295,M=B+(N<<7&4294967295|N>>>25),N=I+(q^M&(B^q))+U[9]+2336552879&4294967295,I=M+(N<<12&4294967295|N>>>20),N=q+(B^I&(M^B))+U[10]+4294925233&4294967295,q=I+(N<<17&4294967295|N>>>15),N=B+(M^q&(I^M))+U[11]+2304563134&4294967295,B=q+(N<<22&4294967295|N>>>10),N=M+(I^B&(q^I))+U[12]+1804603682&4294967295,M=B+(N<<7&4294967295|N>>>25),N=I+(q^M&(B^q))+U[13]+4254626195&4294967295,I=M+(N<<12&4294967295|N>>>20),N=q+(B^I&(M^B))+U[14]+2792965006&4294967295,q=I+(N<<17&4294967295|N>>>15),N=B+(M^q&(I^M))+U[15]+1236535329&4294967295,B=q+(N<<22&4294967295|N>>>10),N=M+(q^I&(B^q))+U[1]+4129170786&4294967295,M=B+(N<<5&4294967295|N>>>27),N=I+(B^q&(M^B))+U[6]+3225465664&4294967295,I=M+(N<<9&4294967295|N>>>23),N=q+(M^B&(I^M))+U[11]+643717713&4294967295,q=I+(N<<14&4294967295|N>>>18),N=B+(I^M&(q^I))+U[0]+3921069994&4294967295,B=q+(N<<20&4294967295|N>>>12),N=M+(q^I&(B^q))+U[5]+3593408605&4294967295,M=B+(N<<5&4294967295|N>>>27),N=I+(B^q&(M^B))+U[10]+38016083&4294967295,I=M+(N<<9&4294967295|N>>>23),N=q+(M^B&(I^M))+U[15]+3634488961&4294967295,q=I+(N<<14&4294967295|N>>>18),N=B+(I^M&(q^I))+U[4]+3889429448&4294967295,B=q+(N<<20&4294967295|N>>>12),N=M+(q^I&(B^q))+U[9]+568446438&4294967295,M=B+(N<<5&4294967295|N>>>27),N=I+(B^q&(M^B))+U[14]+3275163606&4294967295,I=M+(N<<9&4294967295|N>>>23),N=q+(M^B&(I^M))+U[3]+4107603335&4294967295,q=I+(N<<14&4294967295|N>>>18),N=B+(I^M&(q^I))+U[8]+1163531501&4294967295,B=q+(N<<20&4294967295|N>>>12),N=M+(q^I&(B^q))+U[13]+2850285829&4294967295,M=B+(N<<5&4294967295|N>>>27),N=I+(B^q&(M^B))+U[2]+4243563512&4294967295,I=M+(N<<9&4294967295|N>>>23),N=q+(M^B&(I^M))+U[7]+1735328473&4294967295,q=I+(N<<14&4294967295|N>>>18),N=B+(I^M&(q^I))+U[12]+2368359562&4294967295,B=q+(N<<20&4294967295|N>>>12),N=M+(B^q^I)+U[5]+4294588738&4294967295,M=B+(N<<4&4294967295|N>>>28),N=I+(M^B^q)+U[8]+2272392833&4294967295,I=M+(N<<11&4294967295|N>>>21),N=q+(I^M^B)+U[11]+1839030562&4294967295,q=I+(N<<16&4294967295|N>>>16),N=B+(q^I^M)+U[14]+4259657740&4294967295,B=q+(N<<23&4294967295|N>>>9),N=M+(B^q^I)+U[1]+2763975236&4294967295,M=B+(N<<4&4294967295|N>>>28),N=I+(M^B^q)+U[4]+1272893353&4294967295,I=M+(N<<11&4294967295|N>>>21),N=q+(I^M^B)+U[7]+4139469664&4294967295,q=I+(N<<16&4294967295|N>>>16),N=B+(q^I^M)+U[10]+3200236656&4294967295,B=q+(N<<23&4294967295|N>>>9),N=M+(B^q^I)+U[13]+681279174&4294967295,M=B+(N<<4&4294967295|N>>>28),N=I+(M^B^q)+U[0]+3936430074&4294967295,I=M+(N<<11&4294967295|N>>>21),N=q+(I^M^B)+U[3]+3572445317&4294967295,q=I+(N<<16&4294967295|N>>>16),N=B+(q^I^M)+U[6]+76029189&4294967295,B=q+(N<<23&4294967295|N>>>9),N=M+(B^q^I)+U[9]+3654602809&4294967295,M=B+(N<<4&4294967295|N>>>28),N=I+(M^B^q)+U[12]+3873151461&4294967295,I=M+(N<<11&4294967295|N>>>21),N=q+(I^M^B)+U[15]+530742520&4294967295,q=I+(N<<16&4294967295|N>>>16),N=B+(q^I^M)+U[2]+3299628645&4294967295,B=q+(N<<23&4294967295|N>>>9),N=M+(q^(B|~I))+U[0]+4096336452&4294967295,M=B+(N<<6&4294967295|N>>>26),N=I+(B^(M|~q))+U[7]+1126891415&4294967295,I=M+(N<<10&4294967295|N>>>22),N=q+(M^(I|~B))+U[14]+2878612391&4294967295,q=I+(N<<15&4294967295|N>>>17),N=B+(I^(q|~M))+U[5]+4237533241&4294967295,B=q+(N<<21&4294967295|N>>>11),N=M+(q^(B|~I))+U[12]+1700485571&4294967295,M=B+(N<<6&4294967295|N>>>26),N=I+(B^(M|~q))+U[3]+2399980690&4294967295,I=M+(N<<10&4294967295|N>>>22),N=q+(M^(I|~B))+U[10]+4293915773&4294967295,q=I+(N<<15&4294967295|N>>>17),N=B+(I^(q|~M))+U[1]+2240044497&4294967295,B=q+(N<<21&4294967295|N>>>11),N=M+(q^(B|~I))+U[8]+1873313359&4294967295,M=B+(N<<6&4294967295|N>>>26),N=I+(B^(M|~q))+U[15]+4264355552&4294967295,I=M+(N<<10&4294967295|N>>>22),N=q+(M^(I|~B))+U[6]+2734768916&4294967295,q=I+(N<<15&4294967295|N>>>17),N=B+(I^(q|~M))+U[13]+1309151649&4294967295,B=q+(N<<21&4294967295|N>>>11),N=M+(q^(B|~I))+U[4]+4149444226&4294967295,M=B+(N<<6&4294967295|N>>>26),N=I+(B^(M|~q))+U[11]+3174756917&4294967295,I=M+(N<<10&4294967295|N>>>22),N=q+(M^(I|~B))+U[2]+718787259&4294967295,q=I+(N<<15&4294967295|N>>>17),N=B+(I^(q|~M))+U[9]+3951481745&4294967295,k.g[0]=k.g[0]+M&4294967295,k.g[1]=k.g[1]+(q+(N<<21&4294967295|N>>>11))&4294967295,k.g[2]=k.g[2]+q&4294967295,k.g[3]=k.g[3]+I&4294967295}r.prototype.v=function(k,M){M===void 0&&(M=k.length);const B=M-this.blockSize,U=this.C;let q=this.h,I=0;for(;I<M;){if(q==0)for(;I<=B;)i(this,k,I),I+=this.blockSize;if(typeof k=="string"){for(;I<M;)if(U[q++]=k.charCodeAt(I++),q==this.blockSize){i(this,U),q=0;break}}else for(;I<M;)if(U[q++]=k[I++],q==this.blockSize){i(this,U),q=0;break}}this.h=q,this.o+=M},r.prototype.A=function(){var k=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);k[0]=128;for(var M=1;M<k.length-8;++M)k[M]=0;M=this.o*8;for(var B=k.length-8;B<k.length;++B)k[B]=M&255,M/=256;for(this.v(k),k=Array(16),M=0,B=0;B<4;++B)for(let U=0;U<32;U+=8)k[M++]=this.g[B]>>>U&255;return k};function o(k,M){var B=d;return Object.prototype.hasOwnProperty.call(B,k)?B[k]:B[k]=M(k)}function l(k,M){this.h=M;const B=[];let U=!0;for(let q=k.length-1;q>=0;q--){const I=k[q]|0;U&&I==M||(B[q]=I,U=!1)}this.g=B}var d={};function h(k){return-128<=k&&k<128?o(k,function(M){return new l([M|0],M<0?-1:0)}):new l([k|0],k<0?-1:0)}function f(k){if(isNaN(k)||!isFinite(k))return g;if(k<0)return S(f(-k));const M=[];let B=1;for(let U=0;k>=B;U++)M[U]=k/B|0,B*=4294967296;return new l(M,0)}function p(k,M){if(k.length==0)throw Error("number format error: empty string");if(M=M||10,M<2||36<M)throw Error("radix out of range: "+M);if(k.charAt(0)=="-")return S(p(k.substring(1),M));if(k.indexOf("-")>=0)throw Error('number format error: interior "-" character');const B=f(Math.pow(M,8));let U=g;for(let I=0;I<k.length;I+=8){var q=Math.min(8,k.length-I);const N=parseInt(k.substring(I,I+q),M);q<8?(q=f(Math.pow(M,q)),U=U.j(q).add(f(N))):(U=U.j(B),U=U.add(f(N)))}return U}var g=h(0),b=h(1),_=h(16777216);t=l.prototype,t.m=function(){if(x(this))return-S(this).m();let k=0,M=1;for(let B=0;B<this.g.length;B++){const U=this.i(B);k+=(U>=0?U:4294967296+U)*M,M*=4294967296}return k},t.toString=function(k){if(k=k||10,k<2||36<k)throw Error("radix out of range: "+k);if(w(this))return"0";if(x(this))return"-"+S(this).toString(k);const M=f(Math.pow(k,6));var B=this;let U="";for(;;){const q=D(B,M).g;B=C(B,q.j(M));let I=((B.g.length>0?B.g[0]:B.h)>>>0).toString(k);if(B=q,w(B))return I+U;for(;I.length<6;)I="0"+I;U=I+U}},t.i=function(k){return k<0?0:k<this.g.length?this.g[k]:this.h};function w(k){if(k.h!=0)return!1;for(let M=0;M<k.g.length;M++)if(k.g[M]!=0)return!1;return!0}function x(k){return k.h==-1}t.l=function(k){return k=C(this,k),x(k)?-1:w(k)?0:1};function S(k){const M=k.g.length,B=[];for(let U=0;U<M;U++)B[U]=~k.g[U];return new l(B,~k.h).add(b)}t.abs=function(){return x(this)?S(this):this},t.add=function(k){const M=Math.max(this.g.length,k.g.length),B=[];let U=0;for(let q=0;q<=M;q++){let I=U+(this.i(q)&65535)+(k.i(q)&65535),N=(I>>>16)+(this.i(q)>>>16)+(k.i(q)>>>16);U=N>>>16,I&=65535,N&=65535,B[q]=N<<16|I}return new l(B,B[B.length-1]&-2147483648?-1:0)};function C(k,M){return k.add(S(M))}t.j=function(k){if(w(this)||w(k))return g;if(x(this))return x(k)?S(this).j(S(k)):S(S(this).j(k));if(x(k))return S(this.j(S(k)));if(this.l(_)<0&&k.l(_)<0)return f(this.m()*k.m());const M=this.g.length+k.g.length,B=[];for(var U=0;U<2*M;U++)B[U]=0;for(U=0;U<this.g.length;U++)for(let q=0;q<k.g.length;q++){const I=this.i(U)>>>16,N=this.i(U)&65535,O=k.i(q)>>>16,J=k.i(q)&65535;B[2*U+2*q]+=N*J,T(B,2*U+2*q),B[2*U+2*q+1]+=I*J,T(B,2*U+2*q+1),B[2*U+2*q+1]+=N*O,T(B,2*U+2*q+1),B[2*U+2*q+2]+=I*O,T(B,2*U+2*q+2)}for(k=0;k<M;k++)B[k]=B[2*k+1]<<16|B[2*k];for(k=M;k<2*M;k++)B[k]=0;return new l(B,0)};function T(k,M){for(;(k[M]&65535)!=k[M];)k[M+1]+=k[M]>>>16,k[M]&=65535,M++}function R(k,M){this.g=k,this.h=M}function D(k,M){if(w(M))throw Error("division by zero");if(w(k))return new R(g,g);if(x(k))return M=D(S(k),M),new R(S(M.g),S(M.h));if(x(M))return M=D(k,S(M)),new R(S(M.g),M.h);if(k.g.length>30){if(x(k)||x(M))throw Error("slowDivide_ only works with positive integers.");for(var B=b,U=M;U.l(k)<=0;)B=V(B),U=V(U);var q=$(B,1),I=$(U,1);for(U=$(U,2),B=$(B,2);!w(U);){var N=I.add(U);N.l(k)<=0&&(q=q.add(B),I=N),U=$(U,1),B=$(B,1)}return M=C(k,q.j(M)),new R(q,M)}for(q=g;k.l(M)>=0;){for(B=Math.max(1,Math.floor(k.m()/M.m())),U=Math.ceil(Math.log(B)/Math.LN2),U=U<=48?1:Math.pow(2,U-48),I=f(B),N=I.j(M);x(N)||N.l(k)>0;)B-=U,I=f(B),N=I.j(M);w(I)&&(I=b),q=q.add(I),k=C(k,N)}return new R(q,k)}t.B=function(k){return D(this,k).h},t.and=function(k){const M=Math.max(this.g.length,k.g.length),B=[];for(let U=0;U<M;U++)B[U]=this.i(U)&k.i(U);return new l(B,this.h&k.h)},t.or=function(k){const M=Math.max(this.g.length,k.g.length),B=[];for(let U=0;U<M;U++)B[U]=this.i(U)|k.i(U);return new l(B,this.h|k.h)},t.xor=function(k){const M=Math.max(this.g.length,k.g.length),B=[];for(let U=0;U<M;U++)B[U]=this.i(U)^k.i(U);return new l(B,this.h^k.h)};function V(k){const M=k.g.length+1,B=[];for(let U=0;U<M;U++)B[U]=k.i(U)<<1|k.i(U-1)>>>31;return new l(B,k.h)}function $(k,M){const B=M>>5;M%=32;const U=k.g.length-B,q=[];for(let I=0;I<U;I++)q[I]=M>0?k.i(I+B)>>>M|k.i(I+B+1)<<32-M:k.i(I+B);return new l(q,k.h)}r.prototype.digest=r.prototype.A,r.prototype.reset=r.prototype.u,r.prototype.update=r.prototype.v,BE=r,l.prototype.add=l.prototype.add,l.prototype.multiply=l.prototype.j,l.prototype.modulo=l.prototype.B,l.prototype.compare=l.prototype.l,l.prototype.toNumber=l.prototype.m,l.prototype.toString=l.prototype.toString,l.prototype.getBits=l.prototype.i,l.fromNumber=f,l.fromString=p,Aa=l}).apply(typeof Rw<"u"?Rw:typeof self<"u"?self:typeof window<"u"?window:{});var Gh=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var zE,Eu,LE,af,gy,UE,FE,VE;(function(){var t,e=Object.defineProperty;function n(y){y=[typeof globalThis=="object"&&globalThis,y,typeof window=="object"&&window,typeof self=="object"&&self,typeof Gh=="object"&&Gh];for(var A=0;A<y.length;++A){var F=y[A];if(F&&F.Math==Math)return F}throw Error("Cannot find global object")}var r=n(this);function i(y,A){if(A)e:{var F=r;y=y.split(".");for(var K=0;K<y.length-1;K++){var fe=y[K];if(!(fe in F))break e;F=F[fe]}y=y[y.length-1],K=F[y],A=A(K),A!=K&&A!=null&&e(F,y,{configurable:!0,writable:!0,value:A})}}i("Symbol.dispose",function(y){return y||Symbol("Symbol.dispose")}),i("Array.prototype.values",function(y){return y||function(){return this[Symbol.iterator]()}}),i("Object.entries",function(y){return y||function(A){var F=[],K;for(K in A)Object.prototype.hasOwnProperty.call(A,K)&&F.push([K,A[K]]);return F}});var o=o||{},l=this||self;function d(y){var A=typeof y;return A=="object"&&y!=null||A=="function"}function h(y,A,F){return y.call.apply(y.bind,arguments)}function f(y,A,F){return f=h,f.apply(null,arguments)}function p(y,A){var F=Array.prototype.slice.call(arguments,1);return function(){var K=F.slice();return K.push.apply(K,arguments),y.apply(this,K)}}function g(y,A){function F(){}F.prototype=A.prototype,y.Z=A.prototype,y.prototype=new F,y.prototype.constructor=y,y.Ob=function(K,fe,ve){for(var Be=Array(arguments.length-2),rt=2;rt<arguments.length;rt++)Be[rt-2]=arguments[rt];return A.prototype[fe].apply(K,Be)}}var b=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?y=>y&&AsyncContext.Snapshot.wrap(y):y=>y;function _(y){const A=y.length;if(A>0){const F=Array(A);for(let K=0;K<A;K++)F[K]=y[K];return F}return[]}function w(y,A){for(let K=1;K<arguments.length;K++){const fe=arguments[K];var F=typeof fe;if(F=F!="object"?F:fe?Array.isArray(fe)?"array":F:"null",F=="array"||F=="object"&&typeof fe.length=="number"){F=y.length||0;const ve=fe.length||0;y.length=F+ve;for(let Be=0;Be<ve;Be++)y[F+Be]=fe[Be]}else y.push(fe)}}class x{constructor(A,F){this.i=A,this.j=F,this.h=0,this.g=null}get(){let A;return this.h>0?(this.h--,A=this.g,this.g=A.next,A.next=null):A=this.i(),A}}function S(y){l.setTimeout(()=>{throw y},0)}function C(){var y=k;let A=null;return y.g&&(A=y.g,y.g=y.g.next,y.g||(y.h=null),A.next=null),A}class T{constructor(){this.h=this.g=null}add(A,F){const K=R.get();K.set(A,F),this.h?this.h.next=K:this.g=K,this.h=K}}var R=new x(()=>new D,y=>y.reset());class D{constructor(){this.next=this.g=this.h=null}set(A,F){this.h=A,this.g=F,this.next=null}reset(){this.next=this.g=this.h=null}}let V,$=!1,k=new T,M=()=>{const y=Promise.resolve(void 0);V=()=>{y.then(B)}};function B(){for(var y;y=C();){try{y.h.call(y.g)}catch(F){S(F)}var A=R;A.j(y),A.h<100&&(A.h++,y.next=A.g,A.g=y)}$=!1}function U(){this.u=this.u,this.C=this.C}U.prototype.u=!1,U.prototype.dispose=function(){this.u||(this.u=!0,this.N())},U.prototype[Symbol.dispose]=function(){this.dispose()},U.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function q(y,A){this.type=y,this.g=this.target=A,this.defaultPrevented=!1}q.prototype.h=function(){this.defaultPrevented=!0};var I=(function(){if(!l.addEventListener||!Object.defineProperty)return!1;var y=!1,A=Object.defineProperty({},"passive",{get:function(){y=!0}});try{const F=()=>{};l.addEventListener("test",F,A),l.removeEventListener("test",F,A)}catch{}return y})();function N(y){return/^[\s\xa0]*$/.test(y)}function O(y,A){q.call(this,y?y.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,y&&this.init(y,A)}g(O,q),O.prototype.init=function(y,A){const F=this.type=y.type,K=y.changedTouches&&y.changedTouches.length?y.changedTouches[0]:null;this.target=y.target||y.srcElement,this.g=A,A=y.relatedTarget,A||(F=="mouseover"?A=y.fromElement:F=="mouseout"&&(A=y.toElement)),this.relatedTarget=A,K?(this.clientX=K.clientX!==void 0?K.clientX:K.pageX,this.clientY=K.clientY!==void 0?K.clientY:K.pageY,this.screenX=K.screenX||0,this.screenY=K.screenY||0):(this.clientX=y.clientX!==void 0?y.clientX:y.pageX,this.clientY=y.clientY!==void 0?y.clientY:y.pageY,this.screenX=y.screenX||0,this.screenY=y.screenY||0),this.button=y.button,this.key=y.key||"",this.ctrlKey=y.ctrlKey,this.altKey=y.altKey,this.shiftKey=y.shiftKey,this.metaKey=y.metaKey,this.pointerId=y.pointerId||0,this.pointerType=y.pointerType,this.state=y.state,this.i=y,y.defaultPrevented&&O.Z.h.call(this)},O.prototype.h=function(){O.Z.h.call(this);const y=this.i;y.preventDefault?y.preventDefault():y.returnValue=!1};var J="closure_listenable_"+(Math.random()*1e6|0),Y=0;function G(y,A,F,K,fe){this.listener=y,this.proxy=null,this.src=A,this.type=F,this.capture=!!K,this.ha=fe,this.key=++Y,this.da=this.fa=!1}function Z(y){y.da=!0,y.listener=null,y.proxy=null,y.src=null,y.ha=null}function Q(y,A,F){for(const K in y)A.call(F,y[K],K,y)}function te(y,A){for(const F in y)A.call(void 0,y[F],F,y)}function z(y){const A={};for(const F in y)A[F]=y[F];return A}const H="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function re(y,A){let F,K;for(let fe=1;fe<arguments.length;fe++){K=arguments[fe];for(F in K)y[F]=K[F];for(let ve=0;ve<H.length;ve++)F=H[ve],Object.prototype.hasOwnProperty.call(K,F)&&(y[F]=K[F])}}function ne(y){this.src=y,this.g={},this.h=0}ne.prototype.add=function(y,A,F,K,fe){const ve=y.toString();y=this.g[ve],y||(y=this.g[ve]=[],this.h++);const Be=he(y,A,K,fe);return Be>-1?(A=y[Be],F||(A.fa=!1)):(A=new G(A,this.src,ve,!!K,fe),A.fa=F,y.push(A)),A};function ce(y,A){const F=A.type;if(F in y.g){var K=y.g[F],fe=Array.prototype.indexOf.call(K,A,void 0),ve;(ve=fe>=0)&&Array.prototype.splice.call(K,fe,1),ve&&(Z(A),y.g[F].length==0&&(delete y.g[F],y.h--))}}function he(y,A,F,K){for(let fe=0;fe<y.length;++fe){const ve=y[fe];if(!ve.da&&ve.listener==A&&ve.capture==!!F&&ve.ha==K)return fe}return-1}var we="closure_lm_"+(Math.random()*1e6|0),oe={};function be(y,A,F,K,fe){if(Array.isArray(A)){for(let ve=0;ve<A.length;ve++)be(y,A[ve],F,K,fe);return null}return F=X(F),y&&y[J]?y.J(A,F,d(K)?!!K.capture:!1,fe):Me(y,A,F,!1,K,fe)}function Me(y,A,F,K,fe,ve){if(!A)throw Error("Invalid event type");const Be=d(fe)?!!fe.capture:!!fe;let rt=ye(y);if(rt||(y[we]=rt=new ne(y)),F=rt.add(A,F,K,Be,ve),F.proxy)return F;if(K=ze(),F.proxy=K,K.src=y,K.listener=F,y.addEventListener)I||(fe=Be),fe===void 0&&(fe=!1),y.addEventListener(A.toString(),K,fe);else if(y.attachEvent)y.attachEvent(L(A.toString()),K);else if(y.addListener&&y.removeListener)y.addListener(K);else throw Error("addEventListener and attachEvent are unavailable.");return F}function ze(){function y(F){return A.call(y.src,y.listener,F)}const A=de;return y}function at(y,A,F,K,fe){if(Array.isArray(A))for(var ve=0;ve<A.length;ve++)at(y,A[ve],F,K,fe);else K=d(K)?!!K.capture:!!K,F=X(F),y&&y[J]?(y=y.i,ve=String(A).toString(),ve in y.g&&(A=y.g[ve],F=he(A,F,K,fe),F>-1&&(Z(A[F]),Array.prototype.splice.call(A,F,1),A.length==0&&(delete y.g[ve],y.h--)))):y&&(y=ye(y))&&(A=y.g[A.toString()],y=-1,A&&(y=he(A,F,K,fe)),(F=y>-1?A[y]:null)&&lt(F))}function lt(y){if(typeof y!="number"&&y&&!y.da){var A=y.src;if(A&&A[J])ce(A.i,y);else{var F=y.type,K=y.proxy;A.removeEventListener?A.removeEventListener(F,K,y.capture):A.detachEvent?A.detachEvent(L(F),K):A.addListener&&A.removeListener&&A.removeListener(K),(F=ye(A))?(ce(F,y),F.h==0&&(F.src=null,A[we]=null)):Z(y)}}}function L(y){return y in oe?oe[y]:oe[y]="on"+y}function de(y,A){if(y.da)y=!0;else{A=new O(A,this);const F=y.listener,K=y.ha||y.src;y.fa&&lt(y),y=F.call(K,A)}return y}function ye(y){return y=y[we],y instanceof ne?y:null}var ee="__closure_events_fn_"+(Math.random()*1e9>>>0);function X(y){return typeof y=="function"?y:(y[ee]||(y[ee]=function(A){return y.handleEvent(A)}),y[ee])}function ae(){U.call(this),this.i=new ne(this),this.M=this,this.G=null}g(ae,U),ae.prototype[J]=!0,ae.prototype.removeEventListener=function(y,A,F,K){at(this,y,A,F,K)};function Ee(y,A){var F,K=y.G;if(K)for(F=[];K;K=K.G)F.push(K);if(y=y.M,K=A.type||A,typeof A=="string")A=new q(A,y);else if(A instanceof q)A.target=A.target||y;else{var fe=A;A=new q(K,y),re(A,fe)}fe=!0;let ve,Be;if(F)for(Be=F.length-1;Be>=0;Be--)ve=A.g=F[Be],fe=Se(ve,K,!0,A)&&fe;if(ve=A.g=y,fe=Se(ve,K,!0,A)&&fe,fe=Se(ve,K,!1,A)&&fe,F)for(Be=0;Be<F.length;Be++)ve=A.g=F[Be],fe=Se(ve,K,!1,A)&&fe}ae.prototype.N=function(){if(ae.Z.N.call(this),this.i){var y=this.i;for(const A in y.g){const F=y.g[A];for(let K=0;K<F.length;K++)Z(F[K]);delete y.g[A],y.h--}}this.G=null},ae.prototype.J=function(y,A,F,K){return this.i.add(String(y),A,!1,F,K)},ae.prototype.K=function(y,A,F,K){return this.i.add(String(y),A,!0,F,K)};function Se(y,A,F,K){if(A=y.i.g[String(A)],!A)return!0;A=A.concat();let fe=!0;for(let ve=0;ve<A.length;++ve){const Be=A[ve];if(Be&&!Be.da&&Be.capture==F){const rt=Be.listener,an=Be.ha||Be.src;Be.fa&&ce(y.i,Be),fe=rt.call(an,K)!==!1&&fe}}return fe&&!K.defaultPrevented}function ie(y,A){if(typeof y!="function")if(y&&typeof y.handleEvent=="function")y=f(y.handleEvent,y);else throw Error("Invalid listener argument");return Number(A)>2147483647?-1:l.setTimeout(y,A||0)}function Re(y){y.g=ie(()=>{y.g=null,y.i&&(y.i=!1,Re(y))},y.l);const A=y.h;y.h=null,y.m.apply(null,A)}class Ne extends U{constructor(A,F){super(),this.m=A,this.l=F,this.h=null,this.i=!1,this.g=null}j(A){this.h=arguments,this.g?this.i=!0:Re(this)}N(){super.N(),this.g&&(l.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Oe(y){U.call(this),this.h=y,this.g={}}g(Oe,U);var He=[];function xt(y){Q(y.g,function(A,F){this.g.hasOwnProperty(F)&&lt(A)},y),y.g={}}Oe.prototype.N=function(){Oe.Z.N.call(this),xt(this)},Oe.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var nt=l.JSON.stringify,Gn=l.JSON.parse,gs=class{stringify(y){return l.JSON.stringify(y,void 0)}parse(y){return l.JSON.parse(y,void 0)}};function sr(){}function ys(){}var vt={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function nn(){q.call(this,"d")}g(nn,q);function Wn(){q.call(this,"c")}g(Wn,q);var Et={},Ga=null;function Oi(){return Ga=Ga||new ae}Et.Ia="serverreachability";function Wo(y){q.call(this,Et.Ia,y)}g(Wo,q);function Or(y){const A=Oi();Ee(A,new Wo(A))}Et.STAT_EVENT="statevent";function _s(y,A){q.call(this,Et.STAT_EVENT,y),this.stat=A}g(_s,q);function Ft(y){const A=Oi();Ee(A,new _s(A,y))}Et.Ja="timingevent";function ir(y,A){q.call(this,Et.Ja,y),this.size=A}g(ir,q);function bs(y,A){if(typeof y!="function")throw Error("Fn must not be null and must be a function");return l.setTimeout(function(){y()},A)}function Xr(){this.g=!0}Xr.prototype.ua=function(){this.g=!1};function Im(y,A,F,K,fe,ve){y.info(function(){if(y.g)if(ve){var Be="",rt=ve.split("&");for(let Ct=0;Ct<rt.length;Ct++){var an=rt[Ct].split("=");if(an.length>1){const Wt=an[0];an=an[1];const zr=Wt.split("_");Be=zr.length>=2&&zr[1]=="type"?Be+(Wt+"="+an+"&"):Be+(Wt+"=redacted&")}}}else Be=null;else Be=ve;return"XMLHTTP REQ ("+K+") [attempt "+fe+"]: "+A+`
`+F+`
`+Be})}function bd(y,A,F,K,fe,ve,Be){y.info(function(){return"XMLHTTP RESP ("+K+") [ attempt "+fe+"]: "+A+`
`+F+`
`+ve+" "+Be})}function vs(y,A,F,K){y.info(function(){return"XMLHTTP TEXT ("+A+"): "+Dm(y,F)+(K?" "+K:"")})}function Wa(y,A){y.info(function(){return"TIMEOUT: "+A})}Xr.prototype.info=function(){};function Dm(y,A){if(!y.g)return A;if(!A)return null;try{const ve=JSON.parse(A);if(ve){for(y=0;y<ve.length;y++)if(Array.isArray(ve[y])){var F=ve[y];if(!(F.length<2)){var K=F[1];if(Array.isArray(K)&&!(K.length<1)){var fe=K[0];if(fe!="noop"&&fe!="stop"&&fe!="close")for(let Be=1;Be<K.length;Be++)K[Be]=""}}}}return nt(ve)}catch{return A}}var Qa={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},vc={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},xc;function Ka(){}g(Ka,sr),Ka.prototype.g=function(){return new XMLHttpRequest},xc=new Ka;function Xs(y){return encodeURIComponent(String(y))}function vd(y){var A=1;y=y.split(":");const F=[];for(;A>0&&y.length;)F.push(y.shift()),A--;return y.length&&F.push(y.join(":")),F}function Zr(y,A,F,K){this.j=y,this.i=A,this.l=F,this.S=K||1,this.V=new Oe(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new Jr}function Jr(){this.i=null,this.g="",this.h=!1}var hn={},In={};function xs(y,A,F){y.M=1,y.A=Ya(mn(A)),y.u=F,y.R=!0,Qo(y,null)}function Qo(y,A){y.F=Date.now(),ws(y),y.B=mn(y.A);var F=y.B,K=y.S;Array.isArray(K)||(K=[String(K)]),Zo(F.i,"t",K),y.C=0,F=y.j.L,y.h=new Jr,y.g=Nd(y.j,F?A:null,!y.u),y.P>0&&(y.O=new Ne(f(y.Y,y,y.g),y.P)),A=y.V,F=y.g,K=y.ba;var fe="readystatechange";Array.isArray(fe)||(fe&&(He[0]=fe.toString()),fe=He);for(let ve=0;ve<fe.length;ve++){const Be=be(F,fe[ve],K||A.handleEvent,!1,A.h||A);if(!Be)break;A.g[Be.key]=Be}A=y.J?z(y.J):{},y.u?(y.v||(y.v="POST"),A["Content-Type"]="application/x-www-form-urlencoded",y.g.ea(y.B,y.v,y.u,A)):(y.v="GET",y.g.ea(y.B,y.v,null,A)),Or(),Im(y.i,y.v,y.B,y.l,y.S,y.u)}Zr.prototype.ba=function(y){y=y.target;const A=this.O;A&&ns(y)==3?A.j():this.Y(y)},Zr.prototype.Y=function(y){try{if(y==this.g)e:{const rt=ns(this.g),an=this.g.ya(),Ct=this.g.ca();if(!(rt<3)&&(rt!=3||this.g&&(this.h.h||this.g.la()||Nn(this.g)))){this.K||rt!=4||an==7||(an==8||Ct<=0?Or(3):Or(2)),Ss(this);var A=this.g.ca();this.X=A;var F=km(this);if(this.o=A==200,bd(this.i,this.v,this.B,this.l,this.S,rt,A),this.o){if(this.U&&!this.L){t:{if(this.g){var K,fe=this.g;if((K=fe.g?fe.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!N(K)){var ve=K;break t}}ve=null}if(y=ve)vs(this.i,this.l,y,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,Es(this,y);else{this.o=!1,this.m=3,Ft(12),wr(this),Nr(this);break e}}if(this.R){y=!0;let Wt;for(;!this.K&&this.C<F.length;)if(Wt=wd(this,F),Wt==In){rt==4&&(this.m=4,Ft(14),y=!1),vs(this.i,this.l,null,"[Incomplete Response]");break}else if(Wt==hn){this.m=4,Ft(15),vs(this.i,this.l,F,"[Invalid Chunk]"),y=!1;break}else vs(this.i,this.l,Wt,null),Es(this,Wt);if(xd(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),rt!=4||F.length!=0||this.h.h||(this.m=1,Ft(16),y=!1),this.o=this.o&&y,!y)vs(this.i,this.l,F,"[Invalid Chunked Response]"),wr(this),Nr(this);else if(F.length>0&&!this.W){this.W=!0;var Be=this.j;Be.g==this&&Be.aa&&!Be.P&&(Be.j.info("Great, no buffering proxy detected. Bytes received: "+F.length),Pc(Be),Be.P=!0,Ft(11))}}else vs(this.i,this.l,F,null),Es(this,F);rt==4&&wr(this),this.o&&!this.K&&(rt==4?Dd(this.j,this):(this.o=!1,ws(this)))}else Js(this.g),A==400&&F.indexOf("Unknown SID")>0?(this.m=3,Ft(12)):(this.m=0,Ft(13)),wr(this),Nr(this)}}}catch{}};function km(y){if(!xd(y))return y.g.la();const A=Nn(y.g);if(A==="")return"";let F="";const K=A.length,fe=ns(y.g)==4;if(!y.h.i){if(typeof TextDecoder>"u")return wr(y),Nr(y),"";y.h.i=new l.TextDecoder}for(let ve=0;ve<K;ve++)y.h.h=!0,F+=y.h.i.decode(A[ve],{stream:!(fe&&ve==K-1)});return A.length=0,y.h.g+=F,y.C=0,y.h.g}function xd(y){return y.g?y.v=="GET"&&y.M!=2&&y.j.Aa:!1}function wd(y,A){var F=y.C,K=A.indexOf(`
`,F);return K==-1?In:(F=Number(A.substring(F,K)),isNaN(F)?hn:(K+=1,K+F>A.length?In:(A=A.slice(K,K+F),y.C=K+F,A)))}Zr.prototype.cancel=function(){this.K=!0,wr(this)};function ws(y){y.T=Date.now()+y.H,Ko(y,y.H)}function Ko(y,A){if(y.D!=null)throw Error("WatchDog timer not null");y.D=bs(f(y.aa,y),A)}function Ss(y){y.D&&(l.clearTimeout(y.D),y.D=null)}Zr.prototype.aa=function(){this.D=null;const y=Date.now();y-this.T>=0?(Wa(this.i,this.B),this.M!=2&&(Or(),Ft(17)),wr(this),this.m=2,Nr(this)):Ko(this,this.T-y)};function Nr(y){y.j.I==0||y.K||Dd(y.j,y)}function wr(y){Ss(y);var A=y.O;A&&typeof A.dispose=="function"&&A.dispose(),y.O=null,xt(y.V),y.g&&(A=y.g,y.g=null,A.abort(),A.dispose())}function Es(y,A){try{var F=y.j;if(F.I!=0&&(F.g==y||Ts(F.h,y))){if(!y.L&&Ts(F.h,y)&&F.I==3){try{var K=F.Ba.g.parse(A)}catch{K=null}if(Array.isArray(K)&&K.length==3){var fe=K;if(fe[0]==0){e:if(!F.v){if(F.g)if(F.g.F+3e3<y.F)rl(F),Vi(F);else break e;ro(F),Ft(18)}}else F.xa=fe[1],0<F.xa-F.K&&fe[2]<37500&&F.F&&F.A==0&&!F.C&&(F.C=bs(f(F.Va,F),6e3));Cs(F.h)<=1&&F.ta&&(F.ta=void 0)}else ks(F,11)}else if((y.L||F.g==y)&&rl(F),!N(A))for(fe=F.Ba.g.parse(A),A=0;A<fe.length;A++){let Ct=fe[A];const Wt=Ct[0];if(!(Wt<=F.K))if(F.K=Wt,Ct=Ct[1],F.I==2)if(Ct[0]=="c"){F.M=Ct[1],F.ba=Ct[2];const zr=Ct[3];zr!=null&&(F.ka=zr,F.j.info("VER="+F.ka));const Ms=Ct[4];Ms!=null&&(F.za=Ms,F.j.info("SVER="+F.za));const rs=Ct[5];rs!=null&&typeof rs=="number"&&rs>0&&(K=1.5*rs,F.O=K,F.j.info("backChannelRequestTimeoutMs_="+K)),K=F;const ss=y.g;if(ss){const so=ss.g?ss.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(so){var ve=K.h;ve.g||so.indexOf("spdy")==-1&&so.indexOf("quic")==-1&&so.indexOf("h2")==-1||(ve.j=ve.l,ve.g=new Set,ve.h&&(Ec(ve,ve.h),ve.h=null))}if(K.G){const sl=ss.g?ss.g.getResponseHeader("X-HTTP-Session-Id"):null;sl&&(K.wa=sl,jt(K.J,K.G,sl))}}F.I=3,F.l&&F.l.ra(),F.aa&&(F.T=Date.now()-y.F,F.j.info("Handshake RTT: "+F.T+"ms")),K=F;var Be=y;if(K.na=Od(K,K.L?K.ba:null,K.W),Be.L){Cc(K.h,Be);var rt=Be,an=K.O;an&&(rt.H=an),rt.D&&(Ss(rt),ws(rt)),K.g=Be}else Rd(K);F.i.length>0&&Ds(F)}else Ct[0]!="stop"&&Ct[0]!="close"||ks(F,7);else F.I==3&&(Ct[0]=="stop"||Ct[0]=="close"?Ct[0]=="stop"?ks(F,7):Oc(F):Ct[0]!="noop"&&F.l&&F.l.qa(Ct),F.A=0)}}Or(4)}catch{}}var fn=class{constructor(y,A){this.g=y,this.map=A}};function wc(y){this.l=y||10,l.PerformanceNavigationTiming?(y=l.performance.getEntriesByType("navigation"),y=y.length>0&&(y[0].nextHopProtocol=="hq"||y[0].nextHopProtocol=="h2")):y=!!(l.chrome&&l.chrome.loadTimes&&l.chrome.loadTimes()&&l.chrome.loadTimes().wasFetchedViaSpdy),this.j=y?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function Sc(y){return y.h?!0:y.g?y.g.size>=y.j:!1}function Cs(y){return y.h?1:y.g?y.g.size:0}function Ts(y,A){return y.h?y.h==A:y.g?y.g.has(A):!1}function Ec(y,A){y.g?y.g.add(A):y.h=A}function Cc(y,A){y.h&&y.h==A?y.h=null:y.g&&y.g.has(A)&&y.g.delete(A)}wc.prototype.cancel=function(){if(this.i=Tc(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const y of this.g.values())y.cancel();this.g.clear()}};function Tc(y){if(y.h!=null)return y.i.concat(y.h.G);if(y.g!=null&&y.g.size!==0){let A=y.i;for(const F of y.g.values())A=A.concat(F.G);return A}return _(y.i)}var Sd=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Yo(y,A){if(y){y=y.split("&");for(let F=0;F<y.length;F++){const K=y[F].indexOf("=");let fe,ve=null;K>=0?(fe=y[F].substring(0,K),ve=y[F].substring(K+1)):fe=y[F],A(fe,ve?decodeURIComponent(ve.replace(/\+/g," ")):"")}}}function Sr(y){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let A;y instanceof Sr?(this.l=y.l,Dn(this,y.j),this.o=y.o,this.g=y.g,Ni(this,y.u),this.h=y.h,Ac(this,Ad(y.i)),this.m=y.m):y&&(A=String(y).match(Sd))?(this.l=!1,Dn(this,A[1]||"",!0),this.o=As(A[2]||""),this.g=As(A[3]||"",!0),Ni(this,A[4]),this.h=As(A[5]||"",!0),Ac(this,A[6]||"",!0),this.m=As(A[7]||"")):(this.l=!1,this.i=new Bi(null,this.l))}Sr.prototype.toString=function(){const y=[];var A=this.j;A&&y.push(Xa(A,Xo,!0),":");var F=this.g;return(F||A=="file")&&(y.push("//"),(A=this.o)&&y.push(Xa(A,Xo,!0),"@"),y.push(Xs(F).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),F=this.u,F!=null&&y.push(":",String(F))),(F=this.h)&&(this.g&&F.charAt(0)!="/"&&y.push("/"),y.push(Xa(F,F.charAt(0)=="/"?jc:Ed,!0))),(F=this.i.toString())&&y.push("?",F),(F=this.m)&&y.push("#",Xa(F,Cd)),y.join("")},Sr.prototype.resolve=function(y){const A=mn(this);let F=!!y.j;F?Dn(A,y.j):F=!!y.o,F?A.o=y.o:F=!!y.g,F?A.g=y.g:F=y.u!=null;var K=y.h;if(F)Ni(A,y.u);else if(F=!!y.h){if(K.charAt(0)!="/")if(this.g&&!this.h)K="/"+K;else{var fe=A.h.lastIndexOf("/");fe!=-1&&(K=A.h.slice(0,fe+1)+K)}if(fe=K,fe==".."||fe==".")K="";else if(fe.indexOf("./")!=-1||fe.indexOf("/.")!=-1){K=fe.lastIndexOf("/",0)==0,fe=fe.split("/");const ve=[];for(let Be=0;Be<fe.length;){const rt=fe[Be++];rt=="."?K&&Be==fe.length&&ve.push(""):rt==".."?((ve.length>1||ve.length==1&&ve[0]!="")&&ve.pop(),K&&Be==fe.length&&ve.push("")):(ve.push(rt),K=!0)}K=ve.join("/")}else K=fe}return F?A.h=K:F=y.i.toString()!=="",F?Ac(A,Ad(y.i)):F=!!y.m,F&&(A.m=y.m),A};function mn(y){return new Sr(y)}function Dn(y,A,F){y.j=F?As(A,!0):A,y.j&&(y.j=y.j.replace(/:$/,""))}function Ni(y,A){if(A){if(A=Number(A),isNaN(A)||A<0)throw Error("Bad port number "+A);y.u=A}else y.u=null}function Ac(y,A,F){A instanceof Bi?(y.i=A,Jo(y.i,y.l)):(F||(A=Xa(A,Pi)),y.i=new Bi(A,y.l))}function jt(y,A,F){y.i.set(A,F)}function Ya(y){return jt(y,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),y}function As(y,A){return y?A?decodeURI(y.replace(/%25/g,"%2525")):decodeURIComponent(y):""}function Xa(y,A,F){return typeof y=="string"?(y=encodeURI(y).replace(A,ur),F&&(y=y.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),y):null}function ur(y){return y=y.charCodeAt(0),"%"+(y>>4&15).toString(16)+(y&15).toString(16)}var Xo=/[#\/\?@]/g,Ed=/[#\?:]/g,jc=/[#\?]/g,Pi=/[#\?@]/g,Cd=/#/g;function Bi(y,A){this.h=this.g=null,this.i=y||null,this.j=!!A}function dr(y){y.g||(y.g=new Map,y.h=0,y.i&&Yo(y.i,function(A,F){y.add(decodeURIComponent(A.replace(/\+/g," ")),F)}))}t=Bi.prototype,t.add=function(y,A){dr(this),this.i=null,y=zi(this,y);let F=this.g.get(y);return F||this.g.set(y,F=[]),F.push(A),this.h+=1,this};function Td(y,A){dr(y),A=zi(y,A),y.g.has(A)&&(y.i=null,y.h-=y.g.get(A).length,y.g.delete(A))}function Rc(y,A){return dr(y),A=zi(y,A),y.g.has(A)}t.forEach=function(y,A){dr(this),this.g.forEach(function(F,K){F.forEach(function(fe){y.call(A,fe,K,this)},this)},this)};function Ic(y,A){dr(y);let F=[];if(typeof A=="string")Rc(y,A)&&(F=F.concat(y.g.get(zi(y,A))));else for(y=Array.from(y.g.values()),A=0;A<y.length;A++)F=F.concat(y[A]);return F}t.set=function(y,A){return dr(this),this.i=null,y=zi(this,y),Rc(this,y)&&(this.h-=this.g.get(y).length),this.g.set(y,[A]),this.h+=1,this},t.get=function(y,A){return y?(y=Ic(this,y),y.length>0?String(y[0]):A):A};function Zo(y,A,F){Td(y,A),F.length>0&&(y.i=null,y.g.set(zi(y,A),_(F)),y.h+=F.length)}t.toString=function(){if(this.i)return this.i;if(!this.g)return"";const y=[],A=Array.from(this.g.keys());for(let K=0;K<A.length;K++){var F=A[K];const fe=Xs(F);F=Ic(this,F);for(let ve=0;ve<F.length;ve++){let Be=fe;F[ve]!==""&&(Be+="="+Xs(F[ve])),y.push(Be)}}return this.i=y.join("&")};function Ad(y){const A=new Bi;return A.i=y.i,y.g&&(A.g=new Map(y.g),A.h=y.h),A}function zi(y,A){return A=String(A),y.j&&(A=A.toLowerCase()),A}function Jo(y,A){A&&!y.j&&(dr(y),y.i=null,y.g.forEach(function(F,K){const fe=K.toLowerCase();K!=fe&&(Td(this,K),Zo(this,fe,F))},y)),y.j=A}function es(y,A){const F=new Xr;if(l.Image){const K=new Image;K.onload=p(Pr,F,"TestLoadImage: loaded",!0,A,K),K.onerror=p(Pr,F,"TestLoadImage: error",!1,A,K),K.onabort=p(Pr,F,"TestLoadImage: abort",!1,A,K),K.ontimeout=p(Pr,F,"TestLoadImage: timeout",!1,A,K),l.setTimeout(function(){K.ontimeout&&K.ontimeout()},1e4),K.src=y}else A(!1)}function Dc(y,A){const F=new Xr,K=new AbortController,fe=setTimeout(()=>{K.abort(),Pr(F,"TestPingServer: timeout",!1,A)},1e4);fetch(y,{signal:K.signal}).then(ve=>{clearTimeout(fe),ve.ok?Pr(F,"TestPingServer: ok",!0,A):Pr(F,"TestPingServer: server error",!1,A)}).catch(()=>{clearTimeout(fe),Pr(F,"TestPingServer: error",!1,A)})}function Pr(y,A,F,K,fe){try{fe&&(fe.onload=null,fe.onerror=null,fe.onabort=null,fe.ontimeout=null),K(F)}catch{}}function Li(){this.g=new gs}function js(y){this.i=y.Sb||null,this.h=y.ab||!1}g(js,sr),js.prototype.g=function(){return new Za(this.i,this.h)};function Za(y,A){ae.call(this),this.H=y,this.o=A,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}g(Za,ae),t=Za.prototype,t.open=function(y,A){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=y,this.D=A,this.readyState=1,ts(this)},t.send=function(y){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const A={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};y&&(A.body=y),(this.H||l).fetch(new Request(this.D,A)).then(this.Pa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,Ui(this)),this.readyState=0},t.Pa=function(y){if(this.g&&(this.l=y,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=y.headers,this.readyState=2,ts(this)),this.g&&(this.readyState=3,ts(this),this.g)))if(this.responseType==="arraybuffer")y.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof l.ReadableStream<"u"&&"body"in y){if(this.j=y.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;el(this)}else y.text().then(this.Oa.bind(this),this.ga.bind(this))};function el(y){y.j.read().then(y.Ma.bind(y)).catch(y.ga.bind(y))}t.Ma=function(y){if(this.g){if(this.o&&y.value)this.response.push(y.value);else if(!this.o){var A=y.value?y.value:new Uint8Array(0);(A=this.B.decode(A,{stream:!y.done}))&&(this.response=this.responseText+=A)}y.done?Ui(this):ts(this),this.readyState==3&&el(this)}},t.Oa=function(y){this.g&&(this.response=this.responseText=y,Ui(this))},t.Na=function(y){this.g&&(this.response=y,Ui(this))},t.ga=function(){this.g&&Ui(this)};function Ui(y){y.readyState=4,y.l=null,y.j=null,y.B=null,ts(y)}t.setRequestHeader=function(y,A){this.A.append(y,A)},t.getResponseHeader=function(y){return this.h&&this.h.get(y.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";const y=[],A=this.h.entries();for(var F=A.next();!F.done;)F=F.value,y.push(F[0]+": "+F[1]),F=A.next();return y.join(`\r
`)};function ts(y){y.onreadystatechange&&y.onreadystatechange.call(y)}Object.defineProperty(Za.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(y){this.m=y?"include":"same-origin"}});function Br(y){let A="";return Q(y,function(F,K){A+=K,A+=":",A+=F,A+=`\r
`}),A}function Ja(y,A,F){e:{for(K in F){var K=!1;break e}K=!0}K||(F=Br(F),typeof y=="string"?F!=null&&Xs(F):jt(y,A,F))}function Dt(y){ae.call(this),this.headers=new Map,this.L=y||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}g(Dt,ae);var Rs=/^https?$/i,kc=["POST","PUT"];t=Dt.prototype,t.Fa=function(y){this.H=y},t.ea=function(y,A,F,K){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+y);A=A?A.toUpperCase():"GET",this.D=y,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():xc.g(),this.g.onreadystatechange=b(f(this.Ca,this));try{this.B=!0,this.g.open(A,String(y),!0),this.B=!1}catch(ve){eo(this,ve);return}if(y=F||"",F=new Map(this.headers),K)if(Object.getPrototypeOf(K)===Object.prototype)for(var fe in K)F.set(fe,K[fe]);else if(typeof K.keys=="function"&&typeof K.get=="function")for(const ve of K.keys())F.set(ve,K.get(ve));else throw Error("Unknown input type for opt_headers: "+String(K));K=Array.from(F.keys()).find(ve=>ve.toLowerCase()=="content-type"),fe=l.FormData&&y instanceof l.FormData,!(Array.prototype.indexOf.call(kc,A,void 0)>=0)||K||fe||F.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[ve,Be]of F)this.g.setRequestHeader(ve,Be);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(y),this.v=!1}catch(ve){eo(this,ve)}};function eo(y,A){y.h=!1,y.g&&(y.j=!0,y.g.abort(),y.j=!1),y.l=A,y.o=5,Mc(y),Zs(y)}function Mc(y){y.A||(y.A=!0,Ee(y,"complete"),Ee(y,"error"))}t.abort=function(y){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=y||7,Ee(this,"complete"),Ee(this,"abort"),Zs(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Zs(this,!0)),Dt.Z.N.call(this)},t.Ca=function(){this.u||(this.B||this.v||this.j?to(this):this.Xa())},t.Xa=function(){to(this)};function to(y){if(y.h&&typeof o<"u"){if(y.v&&ns(y)==4)setTimeout(y.Ca.bind(y),0);else if(Ee(y,"readystatechange"),ns(y)==4){y.h=!1;try{const ve=y.ca();e:switch(ve){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var A=!0;break e;default:A=!1}var F;if(!(F=A)){var K;if(K=ve===0){let Be=String(y.D).match(Sd)[1]||null;!Be&&l.self&&l.self.location&&(Be=l.self.location.protocol.slice(0,-1)),K=!Rs.test(Be?Be.toLowerCase():"")}F=K}if(F)Ee(y,"complete"),Ee(y,"success");else{y.o=6;try{var fe=ns(y)>2?y.g.statusText:""}catch{fe=""}y.l=fe+" ["+y.ca()+"]",Mc(y)}}finally{Zs(y)}}}}function Zs(y,A){if(y.g){y.m&&(clearTimeout(y.m),y.m=null);const F=y.g;y.g=null,A||Ee(y,"ready");try{F.onreadystatechange=null}catch{}}}t.isActive=function(){return!!this.g};function ns(y){return y.g?y.g.readyState:0}t.ca=function(){try{return ns(this)>2?this.g.status:-1}catch{return-1}},t.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},t.La=function(y){if(this.g){var A=this.g.responseText;return y&&A.indexOf(y)==0&&(A=A.substring(y.length)),Gn(A)}};function Nn(y){try{if(!y.g)return null;if("response"in y.g)return y.g.response;switch(y.F){case"":case"text":return y.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in y.g)return y.g.mozResponseArrayBuffer}return null}catch{return null}}function Js(y){const A={};y=(y.g&&ns(y)>=2&&y.g.getAllResponseHeaders()||"").split(`\r
`);for(let K=0;K<y.length;K++){if(N(y[K]))continue;var F=vd(y[K]);const fe=F[0];if(F=F[1],typeof F!="string")continue;F=F.trim();const ve=A[fe]||[];A[fe]=ve,ve.push(F)}te(A,function(K){return K.join(", ")})}t.ya=function(){return this.o},t.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function Is(y,A,F){return F&&F.internalChannelParams&&F.internalChannelParams[y]||A}function Fi(y){this.za=0,this.i=[],this.j=new Xr,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=Is("failFast",!1,y),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=Is("baseRetryDelayMs",5e3,y),this.Za=Is("retryDelaySeedMs",1e4,y),this.Ta=Is("forwardChannelMaxRetries",2,y),this.va=Is("forwardChannelRequestTimeoutMs",2e4,y),this.ma=y&&y.xmlHttpFactory||void 0,this.Ua=y&&y.Rb||void 0,this.Aa=y&&y.useFetchStreams||!1,this.O=void 0,this.L=y&&y.supportsCrossDomainXhr||!1,this.M="",this.h=new wc(y&&y.concurrentRequestLimit),this.Ba=new Li,this.S=y&&y.fastHandshake||!1,this.R=y&&y.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=y&&y.Pb||!1,y&&y.ua&&this.j.ua(),y&&y.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&y&&y.detectBufferingProxy||!1,this.ia=void 0,y&&y.longPollingTimeout&&y.longPollingTimeout>0&&(this.ia=y.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}t=Fi.prototype,t.ka=8,t.I=1,t.connect=function(y,A,F,K){Ft(0),this.W=y,this.H=A||{},F&&K!==void 0&&(this.H.OSID=F,this.H.OAID=K),this.F=this.X,this.J=Od(this,null,this.W),Ds(this)};function Oc(y){if(tl(y),y.I==3){var A=y.V++,F=mn(y.J);if(jt(F,"SID",y.M),jt(F,"RID",A),jt(F,"TYPE","terminate"),no(y,F),A=new Zr(y,y.j,A),A.M=2,A.A=Ya(mn(F)),F=!1,l.navigator&&l.navigator.sendBeacon)try{F=l.navigator.sendBeacon(A.A.toString(),"")}catch{}!F&&l.Image&&(new Image().src=A.A,F=!0),F||(A.g=Nd(A.j,null),A.g.ea(A.A)),A.F=Date.now(),ws(A)}Md(y)}function Vi(y){y.g&&(Pc(y),y.g.cancel(),y.g=null)}function tl(y){Vi(y),y.v&&(l.clearTimeout(y.v),y.v=null),rl(y),y.h.cancel(),y.m&&(typeof y.m=="number"&&l.clearTimeout(y.m),y.m=null)}function Ds(y){if(!Sc(y.h)&&!y.m){y.m=!0;var A=y.Ea;V||M(),$||(V(),$=!0),k.add(A,y),y.D=0}}function nl(y,A){return Cs(y.h)>=y.h.j-(y.m?1:0)?!1:y.m?(y.i=A.G.concat(y.i),!0):y.I==1||y.I==2||y.D>=(y.Sa?0:y.Ta)?!1:(y.m=bs(f(y.Ea,y,A),kd(y,y.D)),y.D++,!0)}t.Ea=function(y){if(this.m)if(this.m=null,this.I==1){if(!y){this.V=Math.floor(Math.random()*1e5),y=this.V++;const fe=new Zr(this,this.j,y);let ve=this.o;if(this.U&&(ve?(ve=z(ve),re(ve,this.U)):ve=this.U),this.u!==null||this.R||(fe.J=ve,ve=null),this.S)e:{for(var A=0,F=0;F<this.i.length;F++){t:{var K=this.i[F];if("__data__"in K.map&&(K=K.map.__data__,typeof K=="string")){K=K.length;break t}K=void 0}if(K===void 0)break;if(A+=K,A>4096){A=F;break e}if(A===4096||F===this.i.length-1){A=F+1;break e}}A=1e3}else A=1e3;A=jd(this,fe,A),F=mn(this.J),jt(F,"RID",y),jt(F,"CVER",22),this.G&&jt(F,"X-HTTP-Session-Id",this.G),no(this,F),ve&&(this.R?A="headers="+Xs(Br(ve))+"&"+A:this.u&&Ja(F,this.u,ve)),Ec(this.h,fe),this.Ra&&jt(F,"TYPE","init"),this.S?(jt(F,"$req",A),jt(F,"SID","null"),fe.U=!0,xs(fe,F,null)):xs(fe,F,A),this.I=2}}else this.I==3&&(y?Nc(this,y):this.i.length==0||Sc(this.h)||Nc(this))};function Nc(y,A){var F;A?F=A.l:F=y.V++;const K=mn(y.J);jt(K,"SID",y.M),jt(K,"RID",F),jt(K,"AID",y.K),no(y,K),y.u&&y.o&&Ja(K,y.u,y.o),F=new Zr(y,y.j,F,y.D+1),y.u===null&&(F.J=y.o),A&&(y.i=A.G.concat(y.i)),A=jd(y,F,1e3),F.H=Math.round(y.va*.5)+Math.round(y.va*.5*Math.random()),Ec(y.h,F),xs(F,K,A)}function no(y,A){y.H&&Q(y.H,function(F,K){jt(A,K,F)}),y.l&&Q({},function(F,K){jt(A,K,F)})}function jd(y,A,F){F=Math.min(y.i.length,F);const K=y.l?f(y.l.Ka,y.l,y):null;e:{var fe=y.i;let rt=-1;for(;;){const an=["count="+F];rt==-1?F>0?(rt=fe[0].g,an.push("ofs="+rt)):rt=0:an.push("ofs="+rt);let Ct=!0;for(let Wt=0;Wt<F;Wt++){var ve=fe[Wt].g;const zr=fe[Wt].map;if(ve-=rt,ve<0)rt=Math.max(0,fe[Wt].g-100),Ct=!1;else try{ve="req"+ve+"_"||"";try{var Be=zr instanceof Map?zr:Object.entries(zr);for(const[Ms,rs]of Be){let ss=rs;d(rs)&&(ss=nt(rs)),an.push(ve+Ms+"="+encodeURIComponent(ss))}}catch(Ms){throw an.push(ve+"type="+encodeURIComponent("_badmap")),Ms}}catch{K&&K(zr)}}if(Ct){Be=an.join("&");break e}}Be=void 0}return y=y.i.splice(0,F),A.G=y,Be}function Rd(y){if(!y.g&&!y.v){y.Y=1;var A=y.Da;V||M(),$||(V(),$=!0),k.add(A,y),y.A=0}}function ro(y){return y.g||y.v||y.A>=3?!1:(y.Y++,y.v=bs(f(y.Da,y),kd(y,y.A)),y.A++,!0)}t.Da=function(){if(this.v=null,Id(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var y=4*this.T;this.j.info("BP detection timer enabled: "+y),this.B=bs(f(this.Wa,this),y)}},t.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,Ft(10),Vi(this),Id(this))};function Pc(y){y.B!=null&&(l.clearTimeout(y.B),y.B=null)}function Id(y){y.g=new Zr(y,y.j,"rpc",y.Y),y.u===null&&(y.g.J=y.o),y.g.P=0;var A=mn(y.na);jt(A,"RID","rpc"),jt(A,"SID",y.M),jt(A,"AID",y.K),jt(A,"CI",y.F?"0":"1"),!y.F&&y.ia&&jt(A,"TO",y.ia),jt(A,"TYPE","xmlhttp"),no(y,A),y.u&&y.o&&Ja(A,y.u,y.o),y.O&&(y.g.H=y.O);var F=y.g;y=y.ba,F.M=1,F.A=Ya(mn(A)),F.u=null,F.R=!0,Qo(F,y)}t.Va=function(){this.C!=null&&(this.C=null,Vi(this),ro(this),Ft(19))};function rl(y){y.C!=null&&(l.clearTimeout(y.C),y.C=null)}function Dd(y,A){var F=null;if(y.g==A){rl(y),Pc(y),y.g=null;var K=2}else if(Ts(y.h,A))F=A.G,Cc(y.h,A),K=1;else return;if(y.I!=0){if(A.o)if(K==1){F=A.u?A.u.length:0,A=Date.now()-A.F;var fe=y.D;K=Oi(),Ee(K,new ir(K,F)),Ds(y)}else Rd(y);else if(fe=A.m,fe==3||fe==0&&A.X>0||!(K==1&&nl(y,A)||K==2&&ro(y)))switch(F&&F.length>0&&(A=y.h,A.i=A.i.concat(F)),fe){case 1:ks(y,5);break;case 4:ks(y,10);break;case 3:ks(y,6);break;default:ks(y,2)}}}function kd(y,A){let F=y.Qa+Math.floor(Math.random()*y.Za);return y.isActive()||(F*=2),F*A}function ks(y,A){if(y.j.info("Error code "+A),A==2){var F=f(y.bb,y),K=y.Ua;const fe=!K;K=new Sr(K||"//www.google.com/images/cleardot.gif"),l.location&&l.location.protocol=="http"||Dn(K,"https"),Ya(K),fe?es(K.toString(),F):Dc(K.toString(),F)}else Ft(2);y.I=0,y.l&&y.l.pa(A),Md(y),tl(y)}t.bb=function(y){y?(this.j.info("Successfully pinged google.com"),Ft(2)):(this.j.info("Failed to ping google.com"),Ft(1))};function Md(y){if(y.I=0,y.ja=[],y.l){const A=Tc(y.h);(A.length!=0||y.i.length!=0)&&(w(y.ja,A),w(y.ja,y.i),y.h.i.length=0,_(y.i),y.i.length=0),y.l.oa()}}function Od(y,A,F){var K=F instanceof Sr?mn(F):new Sr(F);if(K.g!="")A&&(K.g=A+"."+K.g),Ni(K,K.u);else{var fe=l.location;K=fe.protocol,A=A?A+"."+fe.hostname:fe.hostname,fe=+fe.port;const ve=new Sr(null);K&&Dn(ve,K),A&&(ve.g=A),fe&&Ni(ve,fe),F&&(ve.h=F),K=ve}return F=y.G,A=y.wa,F&&A&&jt(K,F,A),jt(K,"VER",y.ka),no(y,K),K}function Nd(y,A,F){if(A&&!y.L)throw Error("Can't create secondary domain capable XhrIo object.");return A=y.Aa&&!y.ma?new Dt(new js({ab:F})):new Dt(y.ma),A.Fa(y.L),A}t.isActive=function(){return!!this.l&&this.l.isActive(this)};function Pd(){}t=Pd.prototype,t.ra=function(){},t.qa=function(){},t.pa=function(){},t.oa=function(){},t.isActive=function(){return!0},t.Ka=function(){};function $i(){}$i.prototype.g=function(y,A){return new ar(y,A)};function ar(y,A){ae.call(this),this.g=new Fi(A),this.l=y,this.h=A&&A.messageUrlParams||null,y=A&&A.messageHeaders||null,A&&A.clientProtocolHeaderRequired&&(y?y["X-Client-Protocol"]="webchannel":y={"X-Client-Protocol":"webchannel"}),this.g.o=y,y=A&&A.initMessageHeaders||null,A&&A.messageContentType&&(y?y["X-WebChannel-Content-Type"]=A.messageContentType:y={"X-WebChannel-Content-Type":A.messageContentType}),A&&A.sa&&(y?y["X-WebChannel-Client-Profile"]=A.sa:y={"X-WebChannel-Client-Profile":A.sa}),this.g.U=y,(y=A&&A.Qb)&&!N(y)&&(this.g.u=y),this.A=A&&A.supportsCrossDomainXhr||!1,this.v=A&&A.sendRawJson||!1,(A=A&&A.httpSessionIdParam)&&!N(A)&&(this.g.G=A,y=this.h,y!==null&&A in y&&(y=this.h,A in y&&delete y[A])),this.j=new ei(this)}g(ar,ae),ar.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},ar.prototype.close=function(){Oc(this.g)},ar.prototype.o=function(y){var A=this.g;if(typeof y=="string"){var F={};F.__data__=y,y=F}else this.v&&(F={},F.__data__=nt(y),y=F);A.i.push(new fn(A.Ya++,y)),A.I==3&&Ds(A)},ar.prototype.N=function(){this.g.l=null,delete this.j,Oc(this.g),delete this.g,ar.Z.N.call(this)};function Bd(y){nn.call(this),y.__headers__&&(this.headers=y.__headers__,this.statusCode=y.__status__,delete y.__headers__,delete y.__status__);var A=y.__sm__;if(A){e:{for(const F in A){y=F;break e}y=void 0}(this.i=y)&&(y=this.i,A=A!==null&&y in A?A[y]:void 0),this.data=A}else this.data=y}g(Bd,nn);function zd(){Wn.call(this),this.status=1}g(zd,Wn);function ei(y){this.g=y}g(ei,Pd),ei.prototype.ra=function(){Ee(this.g,"a")},ei.prototype.qa=function(y){Ee(this.g,new Bd(y))},ei.prototype.pa=function(y){Ee(this.g,new zd)},ei.prototype.oa=function(){Ee(this.g,"b")},$i.prototype.createWebChannel=$i.prototype.g,ar.prototype.send=ar.prototype.o,ar.prototype.open=ar.prototype.m,ar.prototype.close=ar.prototype.close,VE=function(){return new $i},FE=function(){return Oi()},UE=Et,gy={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},Qa.NO_ERROR=0,Qa.TIMEOUT=8,Qa.HTTP_ERROR=6,af=Qa,vc.COMPLETE="complete",LE=vc,ys.EventType=vt,vt.OPEN="a",vt.CLOSE="b",vt.ERROR="c",vt.MESSAGE="d",ae.prototype.listen=ae.prototype.J,Eu=ys,Dt.prototype.listenOnce=Dt.prototype.K,Dt.prototype.getLastError=Dt.prototype.Ha,Dt.prototype.getLastErrorCode=Dt.prototype.ya,Dt.prototype.getStatus=Dt.prototype.ca,Dt.prototype.getResponseJson=Dt.prototype.La,Dt.prototype.getResponseText=Dt.prototype.la,Dt.prototype.send=Dt.prototype.ea,Dt.prototype.setWithCredentials=Dt.prototype.Fa,zE=Dt}).apply(typeof Gh<"u"?Gh:typeof self<"u"?self:typeof window<"u"?window:{});const Iw="@firebase/firestore",Dw="4.9.3";class Yn{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Yn.UNAUTHENTICATED=new Yn(null),Yn.GOOGLE_CREDENTIALS=new Yn("google-credentials-uid"),Yn.FIRST_PARTY=new Yn("first-party-uid"),Yn.MOCK_USER=new Yn("mock-user");let hc="12.7.0";const Mo=new Ky("@firebase/firestore");function Bl(){return Mo.logLevel}function Ue(t,...e){if(Mo.logLevel<=pt.DEBUG){const n=e.map(a0);Mo.debug(`Firestore (${hc}): ${t}`,...n)}}function Ai(t,...e){if(Mo.logLevel<=pt.ERROR){const n=e.map(a0);Mo.error(`Firestore (${hc}): ${t}`,...n)}}function Kl(t,...e){if(Mo.logLevel<=pt.WARN){const n=e.map(a0);Mo.warn(`Firestore (${hc}): ${t}`,...n)}}function a0(t){if(typeof t=="string")return t;try{return(function(n){return JSON.stringify(n)})(t)}catch{return t}}function Xe(t,e,n){let r="Unexpected state";typeof e=="string"?r=e:n=e,$E(t,r,n)}function $E(t,e,n){let r=`FIRESTORE (${hc}) INTERNAL ASSERTION FAILED: ${e} (ID: ${t.toString(16)})`;if(n!==void 0)try{r+=" CONTEXT: "+JSON.stringify(n)}catch{r+=" CONTEXT: "+n}throw Ai(r),new Error(r)}function At(t,e,n,r){let i="Unexpected state";typeof n=="string"?i=n:r=n,t||$E(e,i,r)}function tt(t,e){return t}const Ie={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Le extends Di{constructor(e,n){super(e,n),this.code=e,this.message=n,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class wi{constructor(){this.promise=new Promise(((e,n)=>{this.resolve=e,this.reject=n}))}}class qE{constructor(e,n){this.user=n,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class EM{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,n){e.enqueueRetryable((()=>n(Yn.UNAUTHENTICATED)))}shutdown(){}}class CM{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,n){this.changeListener=n,e.enqueueRetryable((()=>n(this.token.user)))}shutdown(){this.changeListener=null}}class TM{constructor(e){this.t=e,this.currentUser=Yn.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,n){At(this.o===void 0,42304);let r=this.i;const i=h=>this.i!==r?(r=this.i,n(h)):Promise.resolve();let o=new wi;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new wi,e.enqueueRetryable((()=>i(this.currentUser)))};const l=()=>{const h=o;e.enqueueRetryable((async()=>{await h.promise,await i(this.currentUser)}))},d=h=>{Ue("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=h,this.o&&(this.auth.addAuthTokenListener(this.o),l())};this.t.onInit((h=>d(h))),setTimeout((()=>{if(!this.auth){const h=this.t.getImmediate({optional:!0});h?d(h):(Ue("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new wi)}}),0),l()}getToken(){const e=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then((r=>this.i!==e?(Ue("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(At(typeof r.accessToken=="string",31837,{l:r}),new qE(r.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return At(e===null||typeof e=="string",2055,{h:e}),new Yn(e)}}class AM{constructor(e,n,r){this.P=e,this.T=n,this.I=r,this.type="FirstParty",this.user=Yn.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class jM{constructor(e,n,r){this.P=e,this.T=n,this.I=r}getToken(){return Promise.resolve(new AM(this.P,this.T,this.I))}start(e,n){e.enqueueRetryable((()=>n(Yn.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class kw{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class RM{constructor(e,n){this.V=n,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,cs(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,n){At(this.o===void 0,3512);const r=o=>{o.error!=null&&Ue("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${o.error.message}`);const l=o.token!==this.m;return this.m=o.token,Ue("FirebaseAppCheckTokenProvider",`Received ${l?"new":"existing"} token.`),l?n(o.token):Promise.resolve()};this.o=o=>{e.enqueueRetryable((()=>r(o)))};const i=o=>{Ue("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=o,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((o=>i(o))),setTimeout((()=>{if(!this.appCheck){const o=this.V.getImmediate({optional:!0});o?i(o):Ue("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new kw(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((n=>n?(At(typeof n.token=="string",44558,{tokenResult:n}),this.m=n.token,new kw(n.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function IM(t){const e=typeof self<"u"&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(n);else for(let r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}class o0{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const i=IM(40);for(let o=0;o<i.length;++o)r.length<20&&i[o]<n&&(r+=e.charAt(i[o]%62))}return r}}function gt(t,e){return t<e?-1:t>e?1:0}function yy(t,e){const n=Math.min(t.length,e.length);for(let r=0;r<n;r++){const i=t.charAt(r),o=e.charAt(r);if(i!==o)return Vg(i)===Vg(o)?gt(i,o):Vg(i)?1:-1}return gt(t.length,e.length)}const DM=55296,kM=57343;function Vg(t){const e=t.charCodeAt(0);return e>=DM&&e<=kM}function Yl(t,e,n){return t.length===e.length&&t.every(((r,i)=>n(r,e[i])))}const Mw="__name__";class Ls{constructor(e,n,r){n===void 0?n=0:n>e.length&&Xe(637,{offset:n,range:e.length}),r===void 0?r=e.length-n:r>e.length-n&&Xe(1746,{length:r,range:e.length-n}),this.segments=e,this.offset=n,this.len=r}get length(){return this.len}isEqual(e){return Ls.comparator(this,e)===0}child(e){const n=this.segments.slice(this.offset,this.limit());return e instanceof Ls?e.forEach((r=>{n.push(r)})):n.push(e),this.construct(n)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}forEach(e){for(let n=this.offset,r=this.limit();n<r;n++)e(this.segments[n])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,n){const r=Math.min(e.length,n.length);for(let i=0;i<r;i++){const o=Ls.compareSegments(e.get(i),n.get(i));if(o!==0)return o}return gt(e.length,n.length)}static compareSegments(e,n){const r=Ls.isNumericId(e),i=Ls.isNumericId(n);return r&&!i?-1:!r&&i?1:r&&i?Ls.extractNumericId(e).compare(Ls.extractNumericId(n)):yy(e,n)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Aa.fromString(e.substring(4,e.length-2))}}class Vt extends Ls{construct(e,n,r){return new Vt(e,n,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const n=[];for(const r of e){if(r.indexOf("//")>=0)throw new Le(Ie.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);n.push(...r.split("/").filter((i=>i.length>0)))}return new Vt(n)}static emptyPath(){return new Vt([])}}const MM=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Vn extends Ls{construct(e,n,r){return new Vn(e,n,r)}static isValidIdentifier(e){return MM.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Vn.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===Mw}static keyField(){return new Vn([Mw])}static fromServerFormat(e){const n=[];let r="",i=0;const o=()=>{if(r.length===0)throw new Le(Ie.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);n.push(r),r=""};let l=!1;for(;i<e.length;){const d=e[i];if(d==="\\"){if(i+1===e.length)throw new Le(Ie.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const h=e[i+1];if(h!=="\\"&&h!=="."&&h!=="`")throw new Le(Ie.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=h,i+=2}else d==="`"?(l=!l,i++):d!=="."||l?(r+=d,i++):(o(),i++)}if(o(),l)throw new Le(Ie.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Vn(n)}static emptyPath(){return new Vn([])}}class We{constructor(e){this.path=e}static fromPath(e){return new We(Vt.fromString(e))}static fromName(e){return new We(Vt.fromString(e).popFirst(5))}static empty(){return new We(Vt.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Vt.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,n){return Vt.comparator(e.path,n.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new We(new Vt(e.slice()))}}function HE(t,e,n){if(!n)throw new Le(Ie.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function OM(t,e,n,r){if(e===!0&&r===!0)throw new Le(Ie.INVALID_ARGUMENT,`${t} and ${n} cannot be used together.`)}function Ow(t){if(!We.isDocumentKey(t))throw new Le(Ie.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function Nw(t){if(We.isDocumentKey(t))throw new Le(Ie.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function GE(t){return typeof t=="object"&&t!==null&&(Object.getPrototypeOf(t)===Object.prototype||Object.getPrototypeOf(t)===null)}function Xf(t){if(t===void 0)return"undefined";if(t===null)return"null";if(typeof t=="string")return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if(typeof t=="number"||typeof t=="boolean")return""+t;if(typeof t=="object"){if(t instanceof Array)return"an array";{const e=(function(r){return r.constructor?r.constructor.name:null})(t);return e?`a custom ${e} object`:"an object"}}return typeof t=="function"?"a function":Xe(12329,{type:typeof t})}function ms(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new Le(Ie.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=Xf(t);throw new Le(Ie.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}function xn(t,e){const n={typeString:t};return e&&(n.value=e),n}function sd(t,e){if(!GE(t))throw new Le(Ie.INVALID_ARGUMENT,"JSON must be an object");let n;for(const r in e)if(e[r]){const i=e[r].typeString,o="value"in e[r]?{value:e[r].value}:void 0;if(!(r in t)){n=`JSON missing required field: '${r}'`;break}const l=t[r];if(i&&typeof l!==i){n=`JSON field '${r}' must be a ${i}.`;break}if(o!==void 0&&l!==o.value){n=`Expected '${r}' field to equal '${o.value}'`;break}}if(n)throw new Le(Ie.INVALID_ARGUMENT,n);return!0}const Pw=-62135596800,Bw=1e6;class Gt{static now(){return Gt.fromMillis(Date.now())}static fromDate(e){return Gt.fromMillis(e.getTime())}static fromMillis(e){const n=Math.floor(e/1e3),r=Math.floor((e-1e3*n)*Bw);return new Gt(n,r)}constructor(e,n){if(this.seconds=e,this.nanoseconds=n,n<0)throw new Le(Ie.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new Le(Ie.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(e<Pw)throw new Le(Ie.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Le(Ie.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/Bw}_compareTo(e){return this.seconds===e.seconds?gt(this.nanoseconds,e.nanoseconds):gt(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:Gt._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(sd(e,Gt._jsonSchema))return new Gt(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-Pw;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}Gt._jsonSchemaVersion="firestore/timestamp/1.0",Gt._jsonSchema={type:xn("string",Gt._jsonSchemaVersion),seconds:xn("number"),nanoseconds:xn("number")};class Je{static fromTimestamp(e){return new Je(e)}static min(){return new Je(new Gt(0,0))}static max(){return new Je(new Gt(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const Lu=-1;function NM(t,e){const n=t.toTimestamp().seconds,r=t.toTimestamp().nanoseconds+1,i=Je.fromTimestamp(r===1e9?new Gt(n+1,0):new Gt(n,r));return new Ia(i,We.empty(),e)}function PM(t){return new Ia(t.readTime,t.key,Lu)}class Ia{constructor(e,n,r){this.readTime=e,this.documentKey=n,this.largestBatchId=r}static min(){return new Ia(Je.min(),We.empty(),Lu)}static max(){return new Ia(Je.max(),We.empty(),Lu)}}function BM(t,e){let n=t.readTime.compareTo(e.readTime);return n!==0?n:(n=We.comparator(t.documentKey,e.documentKey),n!==0?n:gt(t.largestBatchId,e.largestBatchId))}const zM="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class LM{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function fc(t){if(t.code!==Ie.FAILED_PRECONDITION||t.message!==zM)throw t;Ue("LocalStore","Unexpectedly lost primary lease")}class ke{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((n=>{this.isDone=!0,this.result=n,this.nextCallback&&this.nextCallback(n)}),(n=>{this.isDone=!0,this.error=n,this.catchCallback&&this.catchCallback(n)}))}catch(e){return this.next(void 0,e)}next(e,n){return this.callbackAttached&&Xe(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new ke(((r,i)=>{this.nextCallback=o=>{this.wrapSuccess(e,o).next(r,i)},this.catchCallback=o=>{this.wrapFailure(n,o).next(r,i)}}))}toPromise(){return new Promise(((e,n)=>{this.next(e,n)}))}wrapUserFunction(e){try{const n=e();return n instanceof ke?n:ke.resolve(n)}catch(n){return ke.reject(n)}}wrapSuccess(e,n){return e?this.wrapUserFunction((()=>e(n))):ke.resolve(n)}wrapFailure(e,n){return e?this.wrapUserFunction((()=>e(n))):ke.reject(n)}static resolve(e){return new ke(((n,r)=>{n(e)}))}static reject(e){return new ke(((n,r)=>{r(e)}))}static waitFor(e){return new ke(((n,r)=>{let i=0,o=0,l=!1;e.forEach((d=>{++i,d.next((()=>{++o,l&&o===i&&n()}),(h=>r(h)))})),l=!0,o===i&&n()}))}static or(e){let n=ke.resolve(!1);for(const r of e)n=n.next((i=>i?ke.resolve(i):r()));return n}static forEach(e,n){const r=[];return e.forEach(((i,o)=>{r.push(n.call(this,i,o))})),this.waitFor(r)}static mapArray(e,n){return new ke(((r,i)=>{const o=e.length,l=new Array(o);let d=0;for(let h=0;h<o;h++){const f=h;n(e[f]).next((p=>{l[f]=p,++d,d===o&&r(l)}),(p=>i(p)))}}))}static doWhile(e,n){return new ke(((r,i)=>{const o=()=>{e()===!0?n().next((()=>{o()}),i):r()};o()}))}}function UM(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}function mc(t){return t.name==="IndexedDbTransactionError"}class Zf{constructor(e,n){this.previousValue=e,n&&(n.sequenceNumberHandler=r=>this.ae(r),this.ue=r=>n.writeSequenceNumber(r))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}Zf.ce=-1;const l0=-1;function Jf(t){return t==null}function Sf(t){return t===0&&1/t==-1/0}function FM(t){return typeof t=="number"&&Number.isInteger(t)&&!Sf(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}const WE="";function VM(t){let e="";for(let n=0;n<t.length;n++)e.length>0&&(e=zw(e)),e=$M(t.get(n),e);return zw(e)}function $M(t,e){let n=e;const r=t.length;for(let i=0;i<r;i++){const o=t.charAt(i);switch(o){case"\0":n+="";break;case WE:n+="";break;default:n+=o}}return n}function zw(t){return t+WE+""}function Lw(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Fa(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function QE(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}class tn{constructor(e,n){this.comparator=e,this.root=n||Un.EMPTY}insert(e,n){return new tn(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,Un.BLACK,null,null))}remove(e){return new tn(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Un.BLACK,null,null))}get(e){let n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(r===0)return n.value;r<0?n=n.left:r>0&&(n=n.right)}return null}indexOf(e){let n=0,r=this.root;for(;!r.isEmpty();){const i=this.comparator(e,r.key);if(i===0)return n+r.left.size;i<0?r=r.left:(n+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((n,r)=>(e(n,r),!1)))}toString(){const e=[];return this.inorderTraversal(((n,r)=>(e.push(`${n}:${r}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Wh(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Wh(this.root,e,this.comparator,!1)}getReverseIterator(){return new Wh(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Wh(this.root,e,this.comparator,!0)}}class Wh{constructor(e,n,r,i){this.isReverse=i,this.nodeStack=[];let o=1;for(;!e.isEmpty();)if(o=n?r(e.key,n):1,n&&i&&(o*=-1),o<0)e=this.isReverse?e.left:e.right;else{if(o===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const n={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return n}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Un{constructor(e,n,r,i,o){this.key=e,this.value=n,this.color=r??Un.RED,this.left=i??Un.EMPTY,this.right=o??Un.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,n,r,i,o){return new Un(e??this.key,n??this.value,r??this.color,i??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,r){let i=this;const o=r(e,i.key);return i=o<0?i.copy(null,null,null,i.left.insert(e,n,r),null):o===0?i.copy(null,n,null,null,null):i.copy(null,null,null,null,i.right.insert(e,n,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return Un.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,n){let r,i=this;if(n(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),n(e,i.key)===0){if(i.right.isEmpty())return Un.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Un.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Un.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Xe(43730,{key:this.key,value:this.value});if(this.right.isRed())throw Xe(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw Xe(27949);return e+(this.isRed()?0:1)}}Un.EMPTY=null,Un.RED=!0,Un.BLACK=!1;Un.EMPTY=new class{constructor(){this.size=0}get key(){throw Xe(57766)}get value(){throw Xe(16141)}get color(){throw Xe(16727)}get left(){throw Xe(29726)}get right(){throw Xe(36894)}copy(e,n,r,i,o){return this}insert(e,n,r){return new Un(e,n)}remove(e,n){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class An{constructor(e){this.comparator=e,this.data=new tn(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((n,r)=>(e(n),!1)))}forEachInRange(e,n){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;n(i.key)}}forEachWhile(e,n){let r;for(r=n!==void 0?this.data.getIteratorFrom(n):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const n=this.data.getIteratorFrom(e);return n.hasNext()?n.getNext().key:null}getIterator(){return new Uw(this.data.getIterator())}getIteratorFrom(e){return new Uw(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let n=this;return n.size<e.size&&(n=e,e=this),e.forEach((r=>{n=n.add(r)})),n}isEqual(e){if(!(e instanceof An)||this.size!==e.size)return!1;const n=this.data.getIterator(),r=e.data.getIterator();for(;n.hasNext();){const i=n.getNext().key,o=r.getNext().key;if(this.comparator(i,o)!==0)return!1}return!0}toArray(){const e=[];return this.forEach((n=>{e.push(n)})),e}toString(){const e=[];return this.forEach((n=>e.push(n))),"SortedSet("+e.toString()+")"}copy(e){const n=new An(this.comparator);return n.data=e,n}}class Uw{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class Dr{constructor(e){this.fields=e,e.sort(Vn.comparator)}static empty(){return new Dr([])}unionWith(e){let n=new An(Vn.comparator);for(const r of this.fields)n=n.add(r);for(const r of e)n=n.add(r);return new Dr(n.toArray())}covers(e){for(const n of this.fields)if(n.isPrefixOf(e))return!0;return!1}isEqual(e){return Yl(this.fields,e.fields,((n,r)=>n.isEqual(r)))}}class KE extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class qn{constructor(e){this.binaryString=e}static fromBase64String(e){const n=(function(i){try{return atob(i)}catch(o){throw typeof DOMException<"u"&&o instanceof DOMException?new KE("Invalid base64 string: "+o):o}})(e);return new qn(n)}static fromUint8Array(e){const n=(function(i){let o="";for(let l=0;l<i.length;++l)o+=String.fromCharCode(i[l]);return o})(e);return new qn(n)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(n){return btoa(n)})(this.binaryString)}toUint8Array(){return(function(n){const r=new Uint8Array(n.length);for(let i=0;i<n.length;i++)r[i]=n.charCodeAt(i);return r})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return gt(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}qn.EMPTY_BYTE_STRING=new qn("");const qM=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Da(t){if(At(!!t,39018),typeof t=="string"){let e=0;const n=qM.exec(t);if(At(!!n,46558,{timestamp:t}),n[1]){let i=n[1];i=(i+"000000000").substr(0,9),e=Number(i)}const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:cn(t.seconds),nanos:cn(t.nanos)}}function cn(t){return typeof t=="number"?t:typeof t=="string"?Number(t):0}function ka(t){return typeof t=="string"?qn.fromBase64String(t):qn.fromUint8Array(t)}const YE="server_timestamp",XE="__type__",ZE="__previous_value__",JE="__local_write_time__";function c0(t){return(t?.mapValue?.fields||{})[XE]?.stringValue===YE}function em(t){const e=t.mapValue.fields[ZE];return c0(e)?em(e):e}function Uu(t){const e=Da(t.mapValue.fields[JE].timestampValue);return new Gt(e.seconds,e.nanos)}class HM{constructor(e,n,r,i,o,l,d,h,f,p){this.databaseId=e,this.appId=n,this.persistenceKey=r,this.host=i,this.ssl=o,this.forceLongPolling=l,this.autoDetectLongPolling=d,this.longPollingOptions=h,this.useFetchStreams=f,this.isUsingEmulator=p}}const Ef="(default)";class Fu{constructor(e,n){this.projectId=e,this.database=n||Ef}static empty(){return new Fu("","")}get isDefaultDatabase(){return this.database===Ef}isEqual(e){return e instanceof Fu&&e.projectId===this.projectId&&e.database===this.database}}const eC="__type__",GM="__max__",Qh={mapValue:{}},tC="__vector__",Cf="value";function Ma(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?c0(t)?4:QM(t)?9007199254740991:WM(t)?10:11:Xe(28295,{value:t})}function Ks(t,e){if(t===e)return!0;const n=Ma(t);if(n!==Ma(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Uu(t).isEqual(Uu(e));case 3:return(function(i,o){if(typeof i.timestampValue=="string"&&typeof o.timestampValue=="string"&&i.timestampValue.length===o.timestampValue.length)return i.timestampValue===o.timestampValue;const l=Da(i.timestampValue),d=Da(o.timestampValue);return l.seconds===d.seconds&&l.nanos===d.nanos})(t,e);case 5:return t.stringValue===e.stringValue;case 6:return(function(i,o){return ka(i.bytesValue).isEqual(ka(o.bytesValue))})(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return(function(i,o){return cn(i.geoPointValue.latitude)===cn(o.geoPointValue.latitude)&&cn(i.geoPointValue.longitude)===cn(o.geoPointValue.longitude)})(t,e);case 2:return(function(i,o){if("integerValue"in i&&"integerValue"in o)return cn(i.integerValue)===cn(o.integerValue);if("doubleValue"in i&&"doubleValue"in o){const l=cn(i.doubleValue),d=cn(o.doubleValue);return l===d?Sf(l)===Sf(d):isNaN(l)&&isNaN(d)}return!1})(t,e);case 9:return Yl(t.arrayValue.values||[],e.arrayValue.values||[],Ks);case 10:case 11:return(function(i,o){const l=i.mapValue.fields||{},d=o.mapValue.fields||{};if(Lw(l)!==Lw(d))return!1;for(const h in l)if(l.hasOwnProperty(h)&&(d[h]===void 0||!Ks(l[h],d[h])))return!1;return!0})(t,e);default:return Xe(52216,{left:t})}}function Vu(t,e){return(t.values||[]).find((n=>Ks(n,e)))!==void 0}function Xl(t,e){if(t===e)return 0;const n=Ma(t),r=Ma(e);if(n!==r)return gt(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return gt(t.booleanValue,e.booleanValue);case 2:return(function(o,l){const d=cn(o.integerValue||o.doubleValue),h=cn(l.integerValue||l.doubleValue);return d<h?-1:d>h?1:d===h?0:isNaN(d)?isNaN(h)?0:-1:1})(t,e);case 3:return Fw(t.timestampValue,e.timestampValue);case 4:return Fw(Uu(t),Uu(e));case 5:return yy(t.stringValue,e.stringValue);case 6:return(function(o,l){const d=ka(o),h=ka(l);return d.compareTo(h)})(t.bytesValue,e.bytesValue);case 7:return(function(o,l){const d=o.split("/"),h=l.split("/");for(let f=0;f<d.length&&f<h.length;f++){const p=gt(d[f],h[f]);if(p!==0)return p}return gt(d.length,h.length)})(t.referenceValue,e.referenceValue);case 8:return(function(o,l){const d=gt(cn(o.latitude),cn(l.latitude));return d!==0?d:gt(cn(o.longitude),cn(l.longitude))})(t.geoPointValue,e.geoPointValue);case 9:return Vw(t.arrayValue,e.arrayValue);case 10:return(function(o,l){const d=o.fields||{},h=l.fields||{},f=d[Cf]?.arrayValue,p=h[Cf]?.arrayValue,g=gt(f?.values?.length||0,p?.values?.length||0);return g!==0?g:Vw(f,p)})(t.mapValue,e.mapValue);case 11:return(function(o,l){if(o===Qh.mapValue&&l===Qh.mapValue)return 0;if(o===Qh.mapValue)return 1;if(l===Qh.mapValue)return-1;const d=o.fields||{},h=Object.keys(d),f=l.fields||{},p=Object.keys(f);h.sort(),p.sort();for(let g=0;g<h.length&&g<p.length;++g){const b=yy(h[g],p[g]);if(b!==0)return b;const _=Xl(d[h[g]],f[p[g]]);if(_!==0)return _}return gt(h.length,p.length)})(t.mapValue,e.mapValue);default:throw Xe(23264,{he:n})}}function Fw(t,e){if(typeof t=="string"&&typeof e=="string"&&t.length===e.length)return gt(t,e);const n=Da(t),r=Da(e),i=gt(n.seconds,r.seconds);return i!==0?i:gt(n.nanos,r.nanos)}function Vw(t,e){const n=t.values||[],r=e.values||[];for(let i=0;i<n.length&&i<r.length;++i){const o=Xl(n[i],r[i]);if(o)return o}return gt(n.length,r.length)}function Zl(t){return _y(t)}function _y(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?(function(n){const r=Da(n);return`time(${r.seconds},${r.nanos})`})(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?(function(n){return ka(n).toBase64()})(t.bytesValue):"referenceValue"in t?(function(n){return We.fromName(n).toString()})(t.referenceValue):"geoPointValue"in t?(function(n){return`geo(${n.latitude},${n.longitude})`})(t.geoPointValue):"arrayValue"in t?(function(n){let r="[",i=!0;for(const o of n.values||[])i?i=!1:r+=",",r+=_y(o);return r+"]"})(t.arrayValue):"mapValue"in t?(function(n){const r=Object.keys(n.fields||{}).sort();let i="{",o=!0;for(const l of r)o?o=!1:i+=",",i+=`${l}:${_y(n.fields[l])}`;return i+"}"})(t.mapValue):Xe(61005,{value:t})}function of(t){switch(Ma(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=em(t);return e?16+of(e):16;case 5:return 2*t.stringValue.length;case 6:return ka(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return(function(r){return(r.values||[]).reduce(((i,o)=>i+of(o)),0)})(t.arrayValue);case 10:case 11:return(function(r){let i=0;return Fa(r.fields,((o,l)=>{i+=o.length+of(l)})),i})(t.mapValue);default:throw Xe(13486,{value:t})}}function $w(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function by(t){return!!t&&"integerValue"in t}function u0(t){return!!t&&"arrayValue"in t}function qw(t){return!!t&&"nullValue"in t}function Hw(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function lf(t){return!!t&&"mapValue"in t}function WM(t){return(t?.mapValue?.fields||{})[eC]?.stringValue===tC}function Iu(t){if(t.geoPointValue)return{geoPointValue:{...t.geoPointValue}};if(t.timestampValue&&typeof t.timestampValue=="object")return{timestampValue:{...t.timestampValue}};if(t.mapValue){const e={mapValue:{fields:{}}};return Fa(t.mapValue.fields,((n,r)=>e.mapValue.fields[n]=Iu(r))),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=Iu(t.arrayValue.values[n]);return e}return{...t}}function QM(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue===GM}class _r{constructor(e){this.value=e}static empty(){return new _r({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let n=this.value;for(let r=0;r<e.length-1;++r)if(n=(n.mapValue.fields||{})[e.get(r)],!lf(n))return null;return n=(n.mapValue.fields||{})[e.lastSegment()],n||null}}set(e,n){this.getFieldsMap(e.popLast())[e.lastSegment()]=Iu(n)}setAll(e){let n=Vn.emptyPath(),r={},i=[];e.forEach(((l,d)=>{if(!n.isImmediateParentOf(d)){const h=this.getFieldsMap(n);this.applyChanges(h,r,i),r={},i=[],n=d.popLast()}l?r[d.lastSegment()]=Iu(l):i.push(d.lastSegment())}));const o=this.getFieldsMap(n);this.applyChanges(o,r,i)}delete(e){const n=this.field(e.popLast());lf(n)&&n.mapValue.fields&&delete n.mapValue.fields[e.lastSegment()]}isEqual(e){return Ks(this.value,e.value)}getFieldsMap(e){let n=this.value;n.mapValue.fields||(n.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=n.mapValue.fields[e.get(r)];lf(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},n.mapValue.fields[e.get(r)]=i),n=i}return n.mapValue.fields}applyChanges(e,n,r){Fa(n,((i,o)=>e[i]=o));for(const i of r)delete e[i]}clone(){return new _r(Iu(this.value))}}function nC(t){const e=[];return Fa(t.fields,((n,r)=>{const i=new Vn([n]);if(lf(r)){const o=nC(r.mapValue).fields;if(o.length===0)e.push(i);else for(const l of o)e.push(i.child(l))}else e.push(i)})),new Dr(e)}class Xn{constructor(e,n,r,i,o,l,d){this.key=e,this.documentType=n,this.version=r,this.readTime=i,this.createTime=o,this.data=l,this.documentState=d}static newInvalidDocument(e){return new Xn(e,0,Je.min(),Je.min(),Je.min(),_r.empty(),0)}static newFoundDocument(e,n,r,i){return new Xn(e,1,n,Je.min(),r,i,0)}static newNoDocument(e,n){return new Xn(e,2,n,Je.min(),Je.min(),_r.empty(),0)}static newUnknownDocument(e,n){return new Xn(e,3,n,Je.min(),Je.min(),_r.empty(),2)}convertToFoundDocument(e,n){return!this.createTime.isEqual(Je.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=n,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=_r.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=_r.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Je.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Xn&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Xn(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Tf{constructor(e,n){this.position=e,this.inclusive=n}}function Gw(t,e,n){let r=0;for(let i=0;i<t.position.length;i++){const o=e[i],l=t.position[i];if(o.field.isKeyField()?r=We.comparator(We.fromName(l.referenceValue),n.key):r=Xl(l,n.data.field(o.field)),o.dir==="desc"&&(r*=-1),r!==0)break}return r}function Ww(t,e){if(t===null)return e===null;if(e===null||t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!Ks(t.position[n],e.position[n]))return!1;return!0}class Af{constructor(e,n="asc"){this.field=e,this.dir=n}}function KM(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}class rC{}class vn extends rC{constructor(e,n,r){super(),this.field=e,this.op=n,this.value=r}static create(e,n,r){return e.isKeyField()?n==="in"||n==="not-in"?this.createKeyFieldInFilter(e,n,r):new XM(e,n,r):n==="array-contains"?new eO(e,r):n==="in"?new tO(e,r):n==="not-in"?new nO(e,r):n==="array-contains-any"?new rO(e,r):new vn(e,n,r)}static createKeyFieldInFilter(e,n,r){return n==="in"?new ZM(e,r):new JM(e,r)}matches(e){const n=e.data.field(this.field);return this.op==="!="?n!==null&&n.nullValue===void 0&&this.matchesComparison(Xl(n,this.value)):n!==null&&Ma(this.value)===Ma(n)&&this.matchesComparison(Xl(n,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Xe(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class ps extends rC{constructor(e,n){super(),this.filters=e,this.op=n,this.Pe=null}static create(e,n){return new ps(e,n)}matches(e){return sC(this)?this.filters.find((n=>!n.matches(e)))===void 0:this.filters.find((n=>n.matches(e)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((e,n)=>e.concat(n.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function sC(t){return t.op==="and"}function iC(t){return YM(t)&&sC(t)}function YM(t){for(const e of t.filters)if(e instanceof ps)return!1;return!0}function vy(t){if(t instanceof vn)return t.field.canonicalString()+t.op.toString()+Zl(t.value);if(iC(t))return t.filters.map((e=>vy(e))).join(",");{const e=t.filters.map((n=>vy(n))).join(",");return`${t.op}(${e})`}}function aC(t,e){return t instanceof vn?(function(r,i){return i instanceof vn&&r.op===i.op&&r.field.isEqual(i.field)&&Ks(r.value,i.value)})(t,e):t instanceof ps?(function(r,i){return i instanceof ps&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce(((o,l,d)=>o&&aC(l,i.filters[d])),!0):!1})(t,e):void Xe(19439)}function oC(t){return t instanceof vn?(function(n){return`${n.field.canonicalString()} ${n.op} ${Zl(n.value)}`})(t):t instanceof ps?(function(n){return n.op.toString()+" {"+n.getFilters().map(oC).join(" ,")+"}"})(t):"Filter"}class XM extends vn{constructor(e,n,r){super(e,n,r),this.key=We.fromName(r.referenceValue)}matches(e){const n=We.comparator(e.key,this.key);return this.matchesComparison(n)}}class ZM extends vn{constructor(e,n){super(e,"in",n),this.keys=lC("in",n)}matches(e){return this.keys.some((n=>n.isEqual(e.key)))}}class JM extends vn{constructor(e,n){super(e,"not-in",n),this.keys=lC("not-in",n)}matches(e){return!this.keys.some((n=>n.isEqual(e.key)))}}function lC(t,e){return(e.arrayValue?.values||[]).map((n=>We.fromName(n.referenceValue)))}class eO extends vn{constructor(e,n){super(e,"array-contains",n)}matches(e){const n=e.data.field(this.field);return u0(n)&&Vu(n.arrayValue,this.value)}}class tO extends vn{constructor(e,n){super(e,"in",n)}matches(e){const n=e.data.field(this.field);return n!==null&&Vu(this.value.arrayValue,n)}}class nO extends vn{constructor(e,n){super(e,"not-in",n)}matches(e){if(Vu(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const n=e.data.field(this.field);return n!==null&&n.nullValue===void 0&&!Vu(this.value.arrayValue,n)}}class rO extends vn{constructor(e,n){super(e,"array-contains-any",n)}matches(e){const n=e.data.field(this.field);return!(!u0(n)||!n.arrayValue.values)&&n.arrayValue.values.some((r=>Vu(this.value.arrayValue,r)))}}class sO{constructor(e,n=null,r=[],i=[],o=null,l=null,d=null){this.path=e,this.collectionGroup=n,this.orderBy=r,this.filters=i,this.limit=o,this.startAt=l,this.endAt=d,this.Te=null}}function Qw(t,e=null,n=[],r=[],i=null,o=null,l=null){return new sO(t,e,n,r,i,o,l)}function d0(t){const e=tt(t);if(e.Te===null){let n=e.path.canonicalString();e.collectionGroup!==null&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map((r=>vy(r))).join(","),n+="|ob:",n+=e.orderBy.map((r=>(function(o){return o.field.canonicalString()+o.dir})(r))).join(","),Jf(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map((r=>Zl(r))).join(",")),e.endAt&&(n+="|ub:",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map((r=>Zl(r))).join(",")),e.Te=n}return e.Te}function h0(t,e){if(t.limit!==e.limit||t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!KM(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!aC(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!Ww(t.startAt,e.startAt)&&Ww(t.endAt,e.endAt)}function xy(t){return We.isDocumentKey(t.path)&&t.collectionGroup===null&&t.filters.length===0}class id{constructor(e,n=null,r=[],i=[],o=null,l="F",d=null,h=null){this.path=e,this.collectionGroup=n,this.explicitOrderBy=r,this.filters=i,this.limit=o,this.limitType=l,this.startAt=d,this.endAt=h,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function iO(t,e,n,r,i,o,l,d){return new id(t,e,n,r,i,o,l,d)}function f0(t){return new id(t)}function Kw(t){return t.filters.length===0&&t.limit===null&&t.startAt==null&&t.endAt==null&&(t.explicitOrderBy.length===0||t.explicitOrderBy.length===1&&t.explicitOrderBy[0].field.isKeyField())}function cC(t){return t.collectionGroup!==null}function Du(t){const e=tt(t);if(e.Ie===null){e.Ie=[];const n=new Set;for(const o of e.explicitOrderBy)e.Ie.push(o),n.add(o.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(l){let d=new An(Vn.comparator);return l.filters.forEach((h=>{h.getFlattenedFilters().forEach((f=>{f.isInequality()&&(d=d.add(f.field))}))})),d})(e).forEach((o=>{n.has(o.canonicalString())||o.isKeyField()||e.Ie.push(new Af(o,r))})),n.has(Vn.keyField().canonicalString())||e.Ie.push(new Af(Vn.keyField(),r))}return e.Ie}function $s(t){const e=tt(t);return e.Ee||(e.Ee=aO(e,Du(t))),e.Ee}function aO(t,e){if(t.limitType==="F")return Qw(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map((i=>{const o=i.dir==="desc"?"asc":"desc";return new Af(i.field,o)}));const n=t.endAt?new Tf(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new Tf(t.startAt.position,t.startAt.inclusive):null;return Qw(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}}function wy(t,e){const n=t.filters.concat([e]);return new id(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}function Sy(t,e,n){return new id(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function tm(t,e){return h0($s(t),$s(e))&&t.limitType===e.limitType}function uC(t){return`${d0($s(t))}|lt:${t.limitType}`}function zl(t){return`Query(target=${(function(n){let r=n.path.canonicalString();return n.collectionGroup!==null&&(r+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(r+=`, filters: [${n.filters.map((i=>oC(i))).join(", ")}]`),Jf(n.limit)||(r+=", limit: "+n.limit),n.orderBy.length>0&&(r+=`, orderBy: [${n.orderBy.map((i=>(function(l){return`${l.field.canonicalString()} (${l.dir})`})(i))).join(", ")}]`),n.startAt&&(r+=", startAt: ",r+=n.startAt.inclusive?"b:":"a:",r+=n.startAt.position.map((i=>Zl(i))).join(",")),n.endAt&&(r+=", endAt: ",r+=n.endAt.inclusive?"a:":"b:",r+=n.endAt.position.map((i=>Zl(i))).join(",")),`Target(${r})`})($s(t))}; limitType=${t.limitType})`}function nm(t,e){return e.isFoundDocument()&&(function(r,i){const o=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(o):We.isDocumentKey(r.path)?r.path.isEqual(o):r.path.isImmediateParentOf(o)})(t,e)&&(function(r,i){for(const o of Du(r))if(!o.field.isKeyField()&&i.data.field(o.field)===null)return!1;return!0})(t,e)&&(function(r,i){for(const o of r.filters)if(!o.matches(i))return!1;return!0})(t,e)&&(function(r,i){return!(r.startAt&&!(function(l,d,h){const f=Gw(l,d,h);return l.inclusive?f<=0:f<0})(r.startAt,Du(r),i)||r.endAt&&!(function(l,d,h){const f=Gw(l,d,h);return l.inclusive?f>=0:f>0})(r.endAt,Du(r),i))})(t,e)}function oO(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function dC(t){return(e,n)=>{let r=!1;for(const i of Du(t)){const o=lO(i,e,n);if(o!==0)return o;r=r||i.field.isKeyField()}return 0}}function lO(t,e,n){const r=t.field.isKeyField()?We.comparator(e.key,n.key):(function(o,l,d){const h=l.data.field(o),f=d.data.field(o);return h!==null&&f!==null?Xl(h,f):Xe(42886)})(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return Xe(19790,{direction:t.dir})}}class Lo{constructor(e,n){this.mapKeyFn=e,this.equalsFn=n,this.inner={},this.innerSize=0}get(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r!==void 0){for(const[i,o]of r)if(this.equalsFn(i,e))return o}}has(e){return this.get(e)!==void 0}set(e,n){const r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,n]],void this.innerSize++;for(let o=0;o<i.length;o++)if(this.equalsFn(i[o][0],e))return void(i[o]=[e,n]);i.push([e,n]),this.innerSize++}delete(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[n]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Fa(this.inner,((n,r)=>{for(const[i,o]of r)e(i,o)}))}isEmpty(){return QE(this.inner)}size(){return this.innerSize}}const cO=new tn(We.comparator);function ji(){return cO}const hC=new tn(We.comparator);function Cu(...t){let e=hC;for(const n of t)e=e.insert(n.key,n);return e}function fC(t){let e=hC;return t.forEach(((n,r)=>e=e.insert(n,r.overlayedDocument))),e}function To(){return ku()}function mC(){return ku()}function ku(){return new Lo((t=>t.toString()),((t,e)=>t.isEqual(e)))}const uO=new tn(We.comparator),dO=new An(We.comparator);function yt(...t){let e=dO;for(const n of t)e=e.add(n);return e}const hO=new An(gt);function fO(){return hO}function m0(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Sf(e)?"-0":e}}function pC(t){return{integerValue:""+t}}function mO(t,e){return FM(e)?pC(e):m0(t,e)}class rm{constructor(){this._=void 0}}function pO(t,e,n){return t instanceof jf?(function(i,o){const l={fields:{[XE]:{stringValue:YE},[JE]:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return o&&c0(o)&&(o=em(o)),o&&(l.fields[ZE]=o),{mapValue:l}})(n,e):t instanceof Jl?yC(t,e):t instanceof ec?_C(t,e):(function(i,o){const l=gC(i,o),d=Yw(l)+Yw(i.Ae);return by(l)&&by(i.Ae)?pC(d):m0(i.serializer,d)})(t,e)}function gO(t,e,n){return t instanceof Jl?yC(t,e):t instanceof ec?_C(t,e):n}function gC(t,e){return t instanceof Rf?(function(r){return by(r)||(function(o){return!!o&&"doubleValue"in o})(r)})(e)?e:{integerValue:0}:null}class jf extends rm{}class Jl extends rm{constructor(e){super(),this.elements=e}}function yC(t,e){const n=bC(e);for(const r of t.elements)n.some((i=>Ks(i,r)))||n.push(r);return{arrayValue:{values:n}}}class ec extends rm{constructor(e){super(),this.elements=e}}function _C(t,e){let n=bC(e);for(const r of t.elements)n=n.filter((i=>!Ks(i,r)));return{arrayValue:{values:n}}}class Rf extends rm{constructor(e,n){super(),this.serializer=e,this.Ae=n}}function Yw(t){return cn(t.integerValue||t.doubleValue)}function bC(t){return u0(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}class vC{constructor(e,n){this.field=e,this.transform=n}}function yO(t,e){return t.field.isEqual(e.field)&&(function(r,i){return r instanceof Jl&&i instanceof Jl||r instanceof ec&&i instanceof ec?Yl(r.elements,i.elements,Ks):r instanceof Rf&&i instanceof Rf?Ks(r.Ae,i.Ae):r instanceof jf&&i instanceof jf})(t.transform,e.transform)}class _O{constructor(e,n){this.version=e,this.transformResults=n}}class vr{constructor(e,n){this.updateTime=e,this.exists=n}static none(){return new vr}static exists(e){return new vr(void 0,e)}static updateTime(e){return new vr(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function cf(t,e){return t.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(t.updateTime):t.exists===void 0||t.exists===e.isFoundDocument()}class sm{}function xC(t,e){if(!t.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return t.isNoDocument()?new im(t.key,vr.none()):new ad(t.key,t.data,vr.none());{const n=t.data,r=_r.empty();let i=new An(Vn.comparator);for(let o of e.fields)if(!i.has(o)){let l=n.field(o);l===null&&o.length>1&&(o=o.popLast(),l=n.field(o)),l===null?r.delete(o):r.set(o,l),i=i.add(o)}return new Va(t.key,r,new Dr(i.toArray()),vr.none())}}function bO(t,e,n){t instanceof ad?(function(i,o,l){const d=i.value.clone(),h=Zw(i.fieldTransforms,o,l.transformResults);d.setAll(h),o.convertToFoundDocument(l.version,d).setHasCommittedMutations()})(t,e,n):t instanceof Va?(function(i,o,l){if(!cf(i.precondition,o))return void o.convertToUnknownDocument(l.version);const d=Zw(i.fieldTransforms,o,l.transformResults),h=o.data;h.setAll(wC(i)),h.setAll(d),o.convertToFoundDocument(l.version,h).setHasCommittedMutations()})(t,e,n):(function(i,o,l){o.convertToNoDocument(l.version).setHasCommittedMutations()})(0,e,n)}function Mu(t,e,n,r){return t instanceof ad?(function(o,l,d,h){if(!cf(o.precondition,l))return d;const f=o.value.clone(),p=Jw(o.fieldTransforms,h,l);return f.setAll(p),l.convertToFoundDocument(l.version,f).setHasLocalMutations(),null})(t,e,n,r):t instanceof Va?(function(o,l,d,h){if(!cf(o.precondition,l))return d;const f=Jw(o.fieldTransforms,h,l),p=l.data;return p.setAll(wC(o)),p.setAll(f),l.convertToFoundDocument(l.version,p).setHasLocalMutations(),d===null?null:d.unionWith(o.fieldMask.fields).unionWith(o.fieldTransforms.map((g=>g.field)))})(t,e,n,r):(function(o,l,d){return cf(o.precondition,l)?(l.convertToNoDocument(l.version).setHasLocalMutations(),null):d})(t,e,n)}function vO(t,e){let n=null;for(const r of t.fieldTransforms){const i=e.data.field(r.field),o=gC(r.transform,i||null);o!=null&&(n===null&&(n=_r.empty()),n.set(r.field,o))}return n||null}function Xw(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!(function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&Yl(r,i,((o,l)=>yO(o,l)))})(t.fieldTransforms,e.fieldTransforms)&&(t.type===0?t.value.isEqual(e.value):t.type!==1||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class ad extends sm{constructor(e,n,r,i=[]){super(),this.key=e,this.value=n,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class Va extends sm{constructor(e,n,r,i,o=[]){super(),this.key=e,this.data=n,this.fieldMask=r,this.precondition=i,this.fieldTransforms=o,this.type=1}getFieldMask(){return this.fieldMask}}function wC(t){const e=new Map;return t.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const r=t.data.field(n);e.set(n,r)}})),e}function Zw(t,e,n){const r=new Map;At(t.length===n.length,32656,{Re:n.length,Ve:t.length});for(let i=0;i<n.length;i++){const o=t[i],l=o.transform,d=e.data.field(o.field);r.set(o.field,gO(l,d,n[i]))}return r}function Jw(t,e,n){const r=new Map;for(const i of t){const o=i.transform,l=n.data.field(i.field);r.set(i.field,pO(o,l,e))}return r}class im extends sm{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class xO extends sm{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class wO{constructor(e,n,r,i){this.batchId=e,this.localWriteTime=n,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,n){const r=n.mutationResults;for(let i=0;i<this.mutations.length;i++){const o=this.mutations[i];o.key.isEqual(e.key)&&bO(o,e,r[i])}}applyToLocalView(e,n){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(n=Mu(r,e,n,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(n=Mu(r,e,n,this.localWriteTime));return n}applyToLocalDocumentSet(e,n){const r=mC();return this.mutations.forEach((i=>{const o=e.get(i.key),l=o.overlayedDocument;let d=this.applyToLocalView(l,o.mutatedFields);d=n.has(i.key)?null:d;const h=xC(l,d);h!==null&&r.set(i.key,h),l.isValidDocument()||l.convertToNoDocument(Je.min())})),r}keys(){return this.mutations.reduce(((e,n)=>e.add(n.key)),yt())}isEqual(e){return this.batchId===e.batchId&&Yl(this.mutations,e.mutations,((n,r)=>Xw(n,r)))&&Yl(this.baseMutations,e.baseMutations,((n,r)=>Xw(n,r)))}}class p0{constructor(e,n,r,i){this.batch=e,this.commitVersion=n,this.mutationResults=r,this.docVersions=i}static from(e,n,r){At(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let i=(function(){return uO})();const o=e.mutations;for(let l=0;l<o.length;l++)i=i.insert(o[l].key,r[l].version);return new p0(e,n,r,i)}}class SO{constructor(e,n){this.largestBatchId=e,this.mutation=n}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class EO{constructor(e,n){this.count=e,this.unchangedNames=n}}var bn,bt;function CO(t){switch(t){case Ie.OK:return Xe(64938);case Ie.CANCELLED:case Ie.UNKNOWN:case Ie.DEADLINE_EXCEEDED:case Ie.RESOURCE_EXHAUSTED:case Ie.INTERNAL:case Ie.UNAVAILABLE:case Ie.UNAUTHENTICATED:return!1;case Ie.INVALID_ARGUMENT:case Ie.NOT_FOUND:case Ie.ALREADY_EXISTS:case Ie.PERMISSION_DENIED:case Ie.FAILED_PRECONDITION:case Ie.ABORTED:case Ie.OUT_OF_RANGE:case Ie.UNIMPLEMENTED:case Ie.DATA_LOSS:return!0;default:return Xe(15467,{code:t})}}function SC(t){if(t===void 0)return Ai("GRPC error has no .code"),Ie.UNKNOWN;switch(t){case bn.OK:return Ie.OK;case bn.CANCELLED:return Ie.CANCELLED;case bn.UNKNOWN:return Ie.UNKNOWN;case bn.DEADLINE_EXCEEDED:return Ie.DEADLINE_EXCEEDED;case bn.RESOURCE_EXHAUSTED:return Ie.RESOURCE_EXHAUSTED;case bn.INTERNAL:return Ie.INTERNAL;case bn.UNAVAILABLE:return Ie.UNAVAILABLE;case bn.UNAUTHENTICATED:return Ie.UNAUTHENTICATED;case bn.INVALID_ARGUMENT:return Ie.INVALID_ARGUMENT;case bn.NOT_FOUND:return Ie.NOT_FOUND;case bn.ALREADY_EXISTS:return Ie.ALREADY_EXISTS;case bn.PERMISSION_DENIED:return Ie.PERMISSION_DENIED;case bn.FAILED_PRECONDITION:return Ie.FAILED_PRECONDITION;case bn.ABORTED:return Ie.ABORTED;case bn.OUT_OF_RANGE:return Ie.OUT_OF_RANGE;case bn.UNIMPLEMENTED:return Ie.UNIMPLEMENTED;case bn.DATA_LOSS:return Ie.DATA_LOSS;default:return Xe(39323,{code:t})}}(bt=bn||(bn={}))[bt.OK=0]="OK",bt[bt.CANCELLED=1]="CANCELLED",bt[bt.UNKNOWN=2]="UNKNOWN",bt[bt.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",bt[bt.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",bt[bt.NOT_FOUND=5]="NOT_FOUND",bt[bt.ALREADY_EXISTS=6]="ALREADY_EXISTS",bt[bt.PERMISSION_DENIED=7]="PERMISSION_DENIED",bt[bt.UNAUTHENTICATED=16]="UNAUTHENTICATED",bt[bt.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",bt[bt.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",bt[bt.ABORTED=10]="ABORTED",bt[bt.OUT_OF_RANGE=11]="OUT_OF_RANGE",bt[bt.UNIMPLEMENTED=12]="UNIMPLEMENTED",bt[bt.INTERNAL=13]="INTERNAL",bt[bt.UNAVAILABLE=14]="UNAVAILABLE",bt[bt.DATA_LOSS=15]="DATA_LOSS";function TO(){return new TextEncoder}const AO=new Aa([4294967295,4294967295],0);function eS(t){const e=TO().encode(t),n=new BE;return n.update(e),new Uint8Array(n.digest())}function tS(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),o=e.getUint32(12,!0);return[new Aa([n,r],0),new Aa([i,o],0)]}class g0{constructor(e,n,r){if(this.bitmap=e,this.padding=n,this.hashCount=r,n<0||n>=8)throw new Tu(`Invalid padding: ${n}`);if(r<0)throw new Tu(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Tu(`Invalid hash count: ${r}`);if(e.length===0&&n!==0)throw new Tu(`Invalid padding when bitmap length is 0: ${n}`);this.ge=8*e.length-n,this.pe=Aa.fromNumber(this.ge)}ye(e,n,r){let i=e.add(n.multiply(Aa.fromNumber(r)));return i.compare(AO)===1&&(i=new Aa([i.getBits(0),i.getBits(1)],0)),i.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const n=eS(e),[r,i]=tS(n);for(let o=0;o<this.hashCount;o++){const l=this.ye(r,i,o);if(!this.we(l))return!1}return!0}static create(e,n,r){const i=e%8==0?0:8-e%8,o=new Uint8Array(Math.ceil(e/8)),l=new g0(o,i,n);return r.forEach((d=>l.insert(d))),l}insert(e){if(this.ge===0)return;const n=eS(e),[r,i]=tS(n);for(let o=0;o<this.hashCount;o++){const l=this.ye(r,i,o);this.Se(l)}}Se(e){const n=Math.floor(e/8),r=e%8;this.bitmap[n]|=1<<r}}class Tu extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class am{constructor(e,n,r,i,o){this.snapshotVersion=e,this.targetChanges=n,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=o}static createSynthesizedRemoteEventForCurrentChange(e,n,r){const i=new Map;return i.set(e,od.createSynthesizedTargetChangeForCurrentChange(e,n,r)),new am(Je.min(),i,new tn(gt),ji(),yt())}}class od{constructor(e,n,r,i,o){this.resumeToken=e,this.current=n,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=o}static createSynthesizedTargetChangeForCurrentChange(e,n,r){return new od(r,n,yt(),yt(),yt())}}class uf{constructor(e,n,r,i){this.be=e,this.removedTargetIds=n,this.key=r,this.De=i}}class EC{constructor(e,n){this.targetId=e,this.Ce=n}}class CC{constructor(e,n,r=qn.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=n,this.resumeToken=r,this.cause=i}}class nS{constructor(){this.ve=0,this.Fe=rS(),this.Me=qn.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=yt(),n=yt(),r=yt();return this.Fe.forEach(((i,o)=>{switch(o){case 0:e=e.add(i);break;case 2:n=n.add(i);break;case 1:r=r.add(i);break;default:Xe(38017,{changeType:o})}})),new od(this.Me,this.xe,e,n,r)}qe(){this.Oe=!1,this.Fe=rS()}Qe(e,n){this.Oe=!0,this.Fe=this.Fe.insert(e,n)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,At(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class jO{constructor(e){this.Ge=e,this.ze=new Map,this.je=ji(),this.Je=Kh(),this.He=Kh(),this.Ye=new tn(gt)}Ze(e){for(const n of e.be)e.De&&e.De.isFoundDocument()?this.Xe(n,e.De):this.et(n,e.key,e.De);for(const n of e.removedTargetIds)this.et(n,e.key,e.De)}tt(e){this.forEachTarget(e,(n=>{const r=this.nt(n);switch(e.state){case 0:this.rt(n)&&r.Le(e.resumeToken);break;case 1:r.Ke(),r.Ne||r.qe(),r.Le(e.resumeToken);break;case 2:r.Ke(),r.Ne||this.removeTarget(n);break;case 3:this.rt(n)&&(r.We(),r.Le(e.resumeToken));break;case 4:this.rt(n)&&(this.it(n),r.Le(e.resumeToken));break;default:Xe(56790,{state:e.state})}}))}forEachTarget(e,n){e.targetIds.length>0?e.targetIds.forEach(n):this.ze.forEach(((r,i)=>{this.rt(i)&&n(i)}))}st(e){const n=e.targetId,r=e.Ce.count,i=this.ot(n);if(i){const o=i.target;if(xy(o))if(r===0){const l=new We(o.path);this.et(n,l,Xn.newNoDocument(l,Je.min()))}else At(r===1,20013,{expectedCount:r});else{const l=this._t(n);if(l!==r){const d=this.ut(e),h=d?this.ct(d,e,l):1;if(h!==0){this.it(n);const f=h===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(n,f)}}}}}ut(e){const n=e.Ce.unchangedNames;if(!n||!n.bits)return null;const{bits:{bitmap:r="",padding:i=0},hashCount:o=0}=n;let l,d;try{l=ka(r).toUint8Array()}catch(h){if(h instanceof KE)return Kl("Decoding the base64 bloom filter in existence filter failed ("+h.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw h}try{d=new g0(l,i,o)}catch(h){return Kl(h instanceof Tu?"BloomFilter error: ":"Applying bloom filter failed: ",h),null}return d.ge===0?null:d}ct(e,n,r){return n.Ce.count===r-this.Pt(e,n.targetId)?0:2}Pt(e,n){const r=this.Ge.getRemoteKeysForTarget(n);let i=0;return r.forEach((o=>{const l=this.Ge.ht(),d=`projects/${l.projectId}/databases/${l.database}/documents/${o.path.canonicalString()}`;e.mightContain(d)||(this.et(n,o,null),i++)})),i}Tt(e){const n=new Map;this.ze.forEach(((o,l)=>{const d=this.ot(l);if(d){if(o.current&&xy(d.target)){const h=new We(d.target.path);this.It(h).has(l)||this.Et(l,h)||this.et(l,h,Xn.newNoDocument(h,e))}o.Be&&(n.set(l,o.ke()),o.qe())}}));let r=yt();this.He.forEach(((o,l)=>{let d=!0;l.forEachWhile((h=>{const f=this.ot(h);return!f||f.purpose==="TargetPurposeLimboResolution"||(d=!1,!1)})),d&&(r=r.add(o))})),this.je.forEach(((o,l)=>l.setReadTime(e)));const i=new am(e,n,this.Ye,this.je,r);return this.je=ji(),this.Je=Kh(),this.He=Kh(),this.Ye=new tn(gt),i}Xe(e,n){if(!this.rt(e))return;const r=this.Et(e,n.key)?2:0;this.nt(e).Qe(n.key,r),this.je=this.je.insert(n.key,n),this.Je=this.Je.insert(n.key,this.It(n.key).add(e)),this.He=this.He.insert(n.key,this.dt(n.key).add(e))}et(e,n,r){if(!this.rt(e))return;const i=this.nt(e);this.Et(e,n)?i.Qe(n,1):i.$e(n),this.He=this.He.insert(n,this.dt(n).delete(e)),this.He=this.He.insert(n,this.dt(n).add(e)),r&&(this.je=this.je.insert(n,r))}removeTarget(e){this.ze.delete(e)}_t(e){const n=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+n.addedDocuments.size-n.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let n=this.ze.get(e);return n||(n=new nS,this.ze.set(e,n)),n}dt(e){let n=this.He.get(e);return n||(n=new An(gt),this.He=this.He.insert(e,n)),n}It(e){let n=this.Je.get(e);return n||(n=new An(gt),this.Je=this.Je.insert(e,n)),n}rt(e){const n=this.ot(e)!==null;return n||Ue("WatchChangeAggregator","Detected inactive target",e),n}ot(e){const n=this.ze.get(e);return n&&n.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new nS),this.Ge.getRemoteKeysForTarget(e).forEach((n=>{this.et(e,n,null)}))}Et(e,n){return this.Ge.getRemoteKeysForTarget(e).has(n)}}function Kh(){return new tn(We.comparator)}function rS(){return new tn(We.comparator)}const RO={asc:"ASCENDING",desc:"DESCENDING"},IO={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},DO={and:"AND",or:"OR"};class kO{constructor(e,n){this.databaseId=e,this.useProto3Json=n}}function Ey(t,e){return t.useProto3Json||Jf(e)?e:{value:e}}function If(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function TC(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function MO(t,e){return If(t,e.toTimestamp())}function qs(t){return At(!!t,49232),Je.fromTimestamp((function(n){const r=Da(n);return new Gt(r.seconds,r.nanos)})(t))}function y0(t,e){return Cy(t,e).canonicalString()}function Cy(t,e){const n=(function(i){return new Vt(["projects",i.projectId,"databases",i.database])})(t).child("documents");return e===void 0?n:n.child(e)}function AC(t){const e=Vt.fromString(t);return At(kC(e),10190,{key:e.toString()}),e}function Ty(t,e){return y0(t.databaseId,e.path)}function $g(t,e){const n=AC(e);if(n.get(1)!==t.databaseId.projectId)throw new Le(Ie.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new Le(Ie.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new We(RC(n))}function jC(t,e){return y0(t.databaseId,e)}function OO(t){const e=AC(t);return e.length===4?Vt.emptyPath():RC(e)}function Ay(t){return new Vt(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function RC(t){return At(t.length>4&&t.get(4)==="documents",29091,{key:t.toString()}),t.popFirst(5)}function sS(t,e,n){return{name:Ty(t,e),fields:n.value.mapValue.fields}}function NO(t,e){let n;if("targetChange"in e){e.targetChange;const r=(function(f){return f==="NO_CHANGE"?0:f==="ADD"?1:f==="REMOVE"?2:f==="CURRENT"?3:f==="RESET"?4:Xe(39313,{state:f})})(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],o=(function(f,p){return f.useProto3Json?(At(p===void 0||typeof p=="string",58123),qn.fromBase64String(p||"")):(At(p===void 0||p instanceof Buffer||p instanceof Uint8Array,16193),qn.fromUint8Array(p||new Uint8Array))})(t,e.targetChange.resumeToken),l=e.targetChange.cause,d=l&&(function(f){const p=f.code===void 0?Ie.UNKNOWN:SC(f.code);return new Le(p,f.message||"")})(l);n=new CC(r,i,o,d||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const i=$g(t,r.document.name),o=qs(r.document.updateTime),l=r.document.createTime?qs(r.document.createTime):Je.min(),d=new _r({mapValue:{fields:r.document.fields}}),h=Xn.newFoundDocument(i,o,l,d),f=r.targetIds||[],p=r.removedTargetIds||[];n=new uf(f,p,h.key,h)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const i=$g(t,r.document),o=r.readTime?qs(r.readTime):Je.min(),l=Xn.newNoDocument(i,o),d=r.removedTargetIds||[];n=new uf([],d,l.key,l)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const i=$g(t,r.document),o=r.removedTargetIds||[];n=new uf([],o,i,null)}else{if(!("filter"in e))return Xe(11601,{Rt:e});{e.filter;const r=e.filter;r.targetId;const{count:i=0,unchangedNames:o}=r,l=new EO(i,o),d=r.targetId;n=new EC(d,l)}}return n}function PO(t,e){let n;if(e instanceof ad)n={update:sS(t,e.key,e.value)};else if(e instanceof im)n={delete:Ty(t,e.key)};else if(e instanceof Va)n={update:sS(t,e.key,e.data),updateMask:HO(e.fieldMask)};else{if(!(e instanceof xO))return Xe(16599,{Vt:e.type});n={verify:Ty(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map((r=>(function(o,l){const d=l.transform;if(d instanceof jf)return{fieldPath:l.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(d instanceof Jl)return{fieldPath:l.field.canonicalString(),appendMissingElements:{values:d.elements}};if(d instanceof ec)return{fieldPath:l.field.canonicalString(),removeAllFromArray:{values:d.elements}};if(d instanceof Rf)return{fieldPath:l.field.canonicalString(),increment:d.Ae};throw Xe(20930,{transform:l.transform})})(0,r)))),e.precondition.isNone||(n.currentDocument=(function(i,o){return o.updateTime!==void 0?{updateTime:MO(i,o.updateTime)}:o.exists!==void 0?{exists:o.exists}:Xe(27497)})(t,e.precondition)),n}function BO(t,e){return t&&t.length>0?(At(e!==void 0,14353),t.map((n=>(function(i,o){let l=i.updateTime?qs(i.updateTime):qs(o);return l.isEqual(Je.min())&&(l=qs(o)),new _O(l,i.transformResults||[])})(n,e)))):[]}function zO(t,e){return{documents:[jC(t,e.path)]}}function LO(t,e){const n={structuredQuery:{}},r=e.path;let i;e.collectionGroup!==null?(i=r,n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=jC(t,i);const o=(function(f){if(f.length!==0)return DC(ps.create(f,"and"))})(e.filters);o&&(n.structuredQuery.where=o);const l=(function(f){if(f.length!==0)return f.map((p=>(function(b){return{field:Ll(b.field),direction:VO(b.dir)}})(p)))})(e.orderBy);l&&(n.structuredQuery.orderBy=l);const d=Ey(t,e.limit);return d!==null&&(n.structuredQuery.limit=d),e.startAt&&(n.structuredQuery.startAt=(function(f){return{before:f.inclusive,values:f.position}})(e.startAt)),e.endAt&&(n.structuredQuery.endAt=(function(f){return{before:!f.inclusive,values:f.position}})(e.endAt)),{ft:n,parent:i}}function UO(t){let e=OO(t.parent);const n=t.structuredQuery,r=n.from?n.from.length:0;let i=null;if(r>0){At(r===1,65062);const p=n.from[0];p.allDescendants?i=p.collectionId:e=e.child(p.collectionId)}let o=[];n.where&&(o=(function(g){const b=IC(g);return b instanceof ps&&iC(b)?b.getFilters():[b]})(n.where));let l=[];n.orderBy&&(l=(function(g){return g.map((b=>(function(w){return new Af(Ul(w.field),(function(S){switch(S){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(w.direction))})(b)))})(n.orderBy));let d=null;n.limit&&(d=(function(g){let b;return b=typeof g=="object"?g.value:g,Jf(b)?null:b})(n.limit));let h=null;n.startAt&&(h=(function(g){const b=!!g.before,_=g.values||[];return new Tf(_,b)})(n.startAt));let f=null;return n.endAt&&(f=(function(g){const b=!g.before,_=g.values||[];return new Tf(_,b)})(n.endAt)),iO(e,i,l,o,d,"F",h,f)}function FO(t,e){const n=(function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Xe(28987,{purpose:i})}})(e.purpose);return n==null?null:{"goog-listen-tags":n}}function IC(t){return t.unaryFilter!==void 0?(function(n){switch(n.unaryFilter.op){case"IS_NAN":const r=Ul(n.unaryFilter.field);return vn.create(r,"==",{doubleValue:NaN});case"IS_NULL":const i=Ul(n.unaryFilter.field);return vn.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const o=Ul(n.unaryFilter.field);return vn.create(o,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const l=Ul(n.unaryFilter.field);return vn.create(l,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return Xe(61313);default:return Xe(60726)}})(t):t.fieldFilter!==void 0?(function(n){return vn.create(Ul(n.fieldFilter.field),(function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return Xe(58110);default:return Xe(50506)}})(n.fieldFilter.op),n.fieldFilter.value)})(t):t.compositeFilter!==void 0?(function(n){return ps.create(n.compositeFilter.filters.map((r=>IC(r))),(function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return Xe(1026)}})(n.compositeFilter.op))})(t):Xe(30097,{filter:t})}function VO(t){return RO[t]}function $O(t){return IO[t]}function qO(t){return DO[t]}function Ll(t){return{fieldPath:t.canonicalString()}}function Ul(t){return Vn.fromServerFormat(t.fieldPath)}function DC(t){return t instanceof vn?(function(n){if(n.op==="=="){if(Hw(n.value))return{unaryFilter:{field:Ll(n.field),op:"IS_NAN"}};if(qw(n.value))return{unaryFilter:{field:Ll(n.field),op:"IS_NULL"}}}else if(n.op==="!="){if(Hw(n.value))return{unaryFilter:{field:Ll(n.field),op:"IS_NOT_NAN"}};if(qw(n.value))return{unaryFilter:{field:Ll(n.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Ll(n.field),op:$O(n.op),value:n.value}}})(t):t instanceof ps?(function(n){const r=n.getFilters().map((i=>DC(i)));return r.length===1?r[0]:{compositeFilter:{op:qO(n.op),filters:r}}})(t):Xe(54877,{filter:t})}function HO(t){const e=[];return t.fields.forEach((n=>e.push(n.canonicalString()))),{fieldPaths:e}}function kC(t){return t.length>=4&&t.get(0)==="projects"&&t.get(2)==="databases"}class _a{constructor(e,n,r,i,o=Je.min(),l=Je.min(),d=qn.EMPTY_BYTE_STRING,h=null){this.target=e,this.targetId=n,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=o,this.lastLimboFreeSnapshotVersion=l,this.resumeToken=d,this.expectedCount=h}withSequenceNumber(e){return new _a(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,n){return new _a(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new _a(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new _a(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class GO{constructor(e){this.yt=e}}function WO(t){const e=UO({parent:t.parent,structuredQuery:t.structuredQuery});return t.limitType==="LAST"?Sy(e,e.limit,"L"):e}class QO{constructor(){this.Cn=new KO}addToCollectionParentIndex(e,n){return this.Cn.add(n),ke.resolve()}getCollectionParents(e,n){return ke.resolve(this.Cn.getEntries(n))}addFieldIndex(e,n){return ke.resolve()}deleteFieldIndex(e,n){return ke.resolve()}deleteAllFieldIndexes(e){return ke.resolve()}createTargetIndexes(e,n){return ke.resolve()}getDocumentsMatchingTarget(e,n){return ke.resolve(null)}getIndexType(e,n){return ke.resolve(0)}getFieldIndexes(e,n){return ke.resolve([])}getNextCollectionGroupToUpdate(e){return ke.resolve(null)}getMinOffset(e,n){return ke.resolve(Ia.min())}getMinOffsetFromCollectionGroup(e,n){return ke.resolve(Ia.min())}updateCollectionGroup(e,n,r){return ke.resolve()}updateIndexEntries(e,n){return ke.resolve()}}class KO{constructor(){this.index={}}add(e){const n=e.lastSegment(),r=e.popLast(),i=this.index[n]||new An(Vt.comparator),o=!i.has(r);return this.index[n]=i.add(r),o}has(e){const n=e.lastSegment(),r=e.popLast(),i=this.index[n];return i&&i.has(r)}getEntries(e){return(this.index[e]||new An(Vt.comparator)).toArray()}}const iS={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},MC=41943040;class yr{static withCacheSize(e){return new yr(e,yr.DEFAULT_COLLECTION_PERCENTILE,yr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,n,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=n,this.maximumSequenceNumbersToCollect=r}}yr.DEFAULT_COLLECTION_PERCENTILE=10,yr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,yr.DEFAULT=new yr(MC,yr.DEFAULT_COLLECTION_PERCENTILE,yr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),yr.DISABLED=new yr(-1,0,0);class tc{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new tc(0)}static cr(){return new tc(-1)}}const aS="LruGarbageCollector",YO=1048576;function oS([t,e],[n,r]){const i=gt(t,n);return i===0?gt(e,r):i}class XO{constructor(e){this.Ir=e,this.buffer=new An(oS),this.Er=0}dr(){return++this.Er}Ar(e){const n=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(n);else{const r=this.buffer.last();oS(n,r)<0&&(this.buffer=this.buffer.delete(r).add(n))}}get maxValue(){return this.buffer.last()[0]}}class ZO{constructor(e,n,r){this.garbageCollector=e,this.asyncQueue=n,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){Ue(aS,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(n){mc(n)?Ue(aS,"Ignoring IndexedDB error during garbage collection: ",n):await fc(n)}await this.Vr(3e5)}))}}class JO{constructor(e,n){this.mr=e,this.params=n}calculateTargetCount(e,n){return this.mr.gr(e).next((r=>Math.floor(n/100*r)))}nthSequenceNumber(e,n){if(n===0)return ke.resolve(Zf.ce);const r=new XO(n);return this.mr.forEachTarget(e,(i=>r.Ar(i.sequenceNumber))).next((()=>this.mr.pr(e,(i=>r.Ar(i))))).next((()=>r.maxValue))}removeTargets(e,n,r){return this.mr.removeTargets(e,n,r)}removeOrphanedDocuments(e,n){return this.mr.removeOrphanedDocuments(e,n)}collect(e,n){return this.params.cacheSizeCollectionThreshold===-1?(Ue("LruGarbageCollector","Garbage collection skipped; disabled"),ke.resolve(iS)):this.getCacheSize(e).next((r=>r<this.params.cacheSizeCollectionThreshold?(Ue("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),iS):this.yr(e,n)))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,n){let r,i,o,l,d,h,f;const p=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((g=>(g>this.params.maximumSequenceNumbersToCollect?(Ue("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${g}`),i=this.params.maximumSequenceNumbersToCollect):i=g,l=Date.now(),this.nthSequenceNumber(e,i)))).next((g=>(r=g,d=Date.now(),this.removeTargets(e,r,n)))).next((g=>(o=g,h=Date.now(),this.removeOrphanedDocuments(e,r)))).next((g=>(f=Date.now(),Bl()<=pt.DEBUG&&Ue("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${l-p}ms
	Determined least recently used ${i} in `+(d-l)+`ms
	Removed ${o} targets in `+(h-d)+`ms
	Removed ${g} documents in `+(f-h)+`ms
Total Duration: ${f-p}ms`),ke.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:o,documentsRemoved:g}))))}}function eN(t,e){return new JO(t,e)}class tN{constructor(){this.changes=new Lo((e=>e.toString()),((e,n)=>e.isEqual(n))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,n){this.assertNotApplied(),this.changes.set(e,Xn.newInvalidDocument(e).setReadTime(n))}getEntry(e,n){this.assertNotApplied();const r=this.changes.get(n);return r!==void 0?ke.resolve(r):this.getFromCache(e,n)}getEntries(e,n){return this.getAllFromCache(e,n)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class nN{constructor(e,n){this.overlayedDocument=e,this.mutatedFields=n}}class rN{constructor(e,n,r,i){this.remoteDocumentCache=e,this.mutationQueue=n,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,n){let r=null;return this.documentOverlayCache.getOverlay(e,n).next((i=>(r=i,this.remoteDocumentCache.getEntry(e,n)))).next((i=>(r!==null&&Mu(r.mutation,i,Dr.empty(),Gt.now()),i)))}getDocuments(e,n){return this.remoteDocumentCache.getEntries(e,n).next((r=>this.getLocalViewOfDocuments(e,r,yt()).next((()=>r))))}getLocalViewOfDocuments(e,n,r=yt()){const i=To();return this.populateOverlays(e,i,n).next((()=>this.computeViews(e,n,i,r).next((o=>{let l=Cu();return o.forEach(((d,h)=>{l=l.insert(d,h.overlayedDocument)})),l}))))}getOverlayedDocuments(e,n){const r=To();return this.populateOverlays(e,r,n).next((()=>this.computeViews(e,n,r,yt())))}populateOverlays(e,n,r){const i=[];return r.forEach((o=>{n.has(o)||i.push(o)})),this.documentOverlayCache.getOverlays(e,i).next((o=>{o.forEach(((l,d)=>{n.set(l,d)}))}))}computeViews(e,n,r,i){let o=ji();const l=ku(),d=(function(){return ku()})();return n.forEach(((h,f)=>{const p=r.get(f.key);i.has(f.key)&&(p===void 0||p.mutation instanceof Va)?o=o.insert(f.key,f):p!==void 0?(l.set(f.key,p.mutation.getFieldMask()),Mu(p.mutation,f,p.mutation.getFieldMask(),Gt.now())):l.set(f.key,Dr.empty())})),this.recalculateAndSaveOverlays(e,o).next((h=>(h.forEach(((f,p)=>l.set(f,p))),n.forEach(((f,p)=>d.set(f,new nN(p,l.get(f)??null)))),d)))}recalculateAndSaveOverlays(e,n){const r=ku();let i=new tn(((l,d)=>l-d)),o=yt();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,n).next((l=>{for(const d of l)d.keys().forEach((h=>{const f=n.get(h);if(f===null)return;let p=r.get(h)||Dr.empty();p=d.applyToLocalView(f,p),r.set(h,p);const g=(i.get(d.batchId)||yt()).add(h);i=i.insert(d.batchId,g)}))})).next((()=>{const l=[],d=i.getReverseIterator();for(;d.hasNext();){const h=d.getNext(),f=h.key,p=h.value,g=mC();p.forEach((b=>{if(!o.has(b)){const _=xC(n.get(b),r.get(b));_!==null&&g.set(b,_),o=o.add(b)}})),l.push(this.documentOverlayCache.saveOverlays(e,f,g))}return ke.waitFor(l)})).next((()=>r))}recalculateAndSaveOverlaysForDocumentKeys(e,n){return this.remoteDocumentCache.getEntries(e,n).next((r=>this.recalculateAndSaveOverlays(e,r)))}getDocumentsMatchingQuery(e,n,r,i){return(function(l){return We.isDocumentKey(l.path)&&l.collectionGroup===null&&l.filters.length===0})(n)?this.getDocumentsMatchingDocumentQuery(e,n.path):cC(n)?this.getDocumentsMatchingCollectionGroupQuery(e,n,r,i):this.getDocumentsMatchingCollectionQuery(e,n,r,i)}getNextDocuments(e,n,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,n,r,i).next((o=>{const l=i-o.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,n,r.largestBatchId,i-o.size):ke.resolve(To());let d=Lu,h=o;return l.next((f=>ke.forEach(f,((p,g)=>(d<g.largestBatchId&&(d=g.largestBatchId),o.get(p)?ke.resolve():this.remoteDocumentCache.getEntry(e,p).next((b=>{h=h.insert(p,b)}))))).next((()=>this.populateOverlays(e,f,o))).next((()=>this.computeViews(e,h,f,yt()))).next((p=>({batchId:d,changes:fC(p)})))))}))}getDocumentsMatchingDocumentQuery(e,n){return this.getDocument(e,new We(n)).next((r=>{let i=Cu();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i}))}getDocumentsMatchingCollectionGroupQuery(e,n,r,i){const o=n.collectionGroup;let l=Cu();return this.indexManager.getCollectionParents(e,o).next((d=>ke.forEach(d,(h=>{const f=(function(g,b){return new id(b,null,g.explicitOrderBy.slice(),g.filters.slice(),g.limit,g.limitType,g.startAt,g.endAt)})(n,h.child(o));return this.getDocumentsMatchingCollectionQuery(e,f,r,i).next((p=>{p.forEach(((g,b)=>{l=l.insert(g,b)}))}))})).next((()=>l))))}getDocumentsMatchingCollectionQuery(e,n,r,i){let o;return this.documentOverlayCache.getOverlaysForCollection(e,n.path,r.largestBatchId).next((l=>(o=l,this.remoteDocumentCache.getDocumentsMatchingQuery(e,n,r,o,i)))).next((l=>{o.forEach(((h,f)=>{const p=f.getKey();l.get(p)===null&&(l=l.insert(p,Xn.newInvalidDocument(p)))}));let d=Cu();return l.forEach(((h,f)=>{const p=o.get(h);p!==void 0&&Mu(p.mutation,f,Dr.empty(),Gt.now()),nm(n,f)&&(d=d.insert(h,f))})),d}))}}class sN{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,n){return ke.resolve(this.Lr.get(n))}saveBundleMetadata(e,n){return this.Lr.set(n.id,(function(i){return{id:i.id,version:i.version,createTime:qs(i.createTime)}})(n)),ke.resolve()}getNamedQuery(e,n){return ke.resolve(this.kr.get(n))}saveNamedQuery(e,n){return this.kr.set(n.name,(function(i){return{name:i.name,query:WO(i.bundledQuery),readTime:qs(i.readTime)}})(n)),ke.resolve()}}class iN{constructor(){this.overlays=new tn(We.comparator),this.qr=new Map}getOverlay(e,n){return ke.resolve(this.overlays.get(n))}getOverlays(e,n){const r=To();return ke.forEach(n,(i=>this.getOverlay(e,i).next((o=>{o!==null&&r.set(i,o)})))).next((()=>r))}saveOverlays(e,n,r){return r.forEach(((i,o)=>{this.St(e,n,o)})),ke.resolve()}removeOverlaysForBatchId(e,n,r){const i=this.qr.get(r);return i!==void 0&&(i.forEach((o=>this.overlays=this.overlays.remove(o))),this.qr.delete(r)),ke.resolve()}getOverlaysForCollection(e,n,r){const i=To(),o=n.length+1,l=new We(n.child("")),d=this.overlays.getIteratorFrom(l);for(;d.hasNext();){const h=d.getNext().value,f=h.getKey();if(!n.isPrefixOf(f.path))break;f.path.length===o&&h.largestBatchId>r&&i.set(h.getKey(),h)}return ke.resolve(i)}getOverlaysForCollectionGroup(e,n,r,i){let o=new tn(((f,p)=>f-p));const l=this.overlays.getIterator();for(;l.hasNext();){const f=l.getNext().value;if(f.getKey().getCollectionGroup()===n&&f.largestBatchId>r){let p=o.get(f.largestBatchId);p===null&&(p=To(),o=o.insert(f.largestBatchId,p)),p.set(f.getKey(),f)}}const d=To(),h=o.getIterator();for(;h.hasNext()&&(h.getNext().value.forEach(((f,p)=>d.set(f,p))),!(d.size()>=i)););return ke.resolve(d)}St(e,n,r){const i=this.overlays.get(r.key);if(i!==null){const l=this.qr.get(i.largestBatchId).delete(r.key);this.qr.set(i.largestBatchId,l)}this.overlays=this.overlays.insert(r.key,new SO(n,r));let o=this.qr.get(n);o===void 0&&(o=yt(),this.qr.set(n,o)),this.qr.set(n,o.add(r.key))}}class aN{constructor(){this.sessionToken=qn.EMPTY_BYTE_STRING}getSessionToken(e){return ke.resolve(this.sessionToken)}setSessionToken(e,n){return this.sessionToken=n,ke.resolve()}}class _0{constructor(){this.Qr=new An(Mn.$r),this.Ur=new An(Mn.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,n){const r=new Mn(e,n);this.Qr=this.Qr.add(r),this.Ur=this.Ur.add(r)}Wr(e,n){e.forEach((r=>this.addReference(r,n)))}removeReference(e,n){this.Gr(new Mn(e,n))}zr(e,n){e.forEach((r=>this.removeReference(r,n)))}jr(e){const n=new We(new Vt([])),r=new Mn(n,e),i=new Mn(n,e+1),o=[];return this.Ur.forEachInRange([r,i],(l=>{this.Gr(l),o.push(l.key)})),o}Jr(){this.Qr.forEach((e=>this.Gr(e)))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const n=new We(new Vt([])),r=new Mn(n,e),i=new Mn(n,e+1);let o=yt();return this.Ur.forEachInRange([r,i],(l=>{o=o.add(l.key)})),o}containsKey(e){const n=new Mn(e,0),r=this.Qr.firstAfterOrEqual(n);return r!==null&&e.isEqual(r.key)}}class Mn{constructor(e,n){this.key=e,this.Yr=n}static $r(e,n){return We.comparator(e.key,n.key)||gt(e.Yr,n.Yr)}static Kr(e,n){return gt(e.Yr,n.Yr)||We.comparator(e.key,n.key)}}class oN{constructor(e,n){this.indexManager=e,this.referenceDelegate=n,this.mutationQueue=[],this.tr=1,this.Zr=new An(Mn.$r)}checkEmpty(e){return ke.resolve(this.mutationQueue.length===0)}addMutationBatch(e,n,r,i){const o=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const l=new wO(o,n,r,i);this.mutationQueue.push(l);for(const d of i)this.Zr=this.Zr.add(new Mn(d.key,o)),this.indexManager.addToCollectionParentIndex(e,d.key.path.popLast());return ke.resolve(l)}lookupMutationBatch(e,n){return ke.resolve(this.Xr(n))}getNextMutationBatchAfterBatchId(e,n){const r=n+1,i=this.ei(r),o=i<0?0:i;return ke.resolve(this.mutationQueue.length>o?this.mutationQueue[o]:null)}getHighestUnacknowledgedBatchId(){return ke.resolve(this.mutationQueue.length===0?l0:this.tr-1)}getAllMutationBatches(e){return ke.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,n){const r=new Mn(n,0),i=new Mn(n,Number.POSITIVE_INFINITY),o=[];return this.Zr.forEachInRange([r,i],(l=>{const d=this.Xr(l.Yr);o.push(d)})),ke.resolve(o)}getAllMutationBatchesAffectingDocumentKeys(e,n){let r=new An(gt);return n.forEach((i=>{const o=new Mn(i,0),l=new Mn(i,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([o,l],(d=>{r=r.add(d.Yr)}))})),ke.resolve(this.ti(r))}getAllMutationBatchesAffectingQuery(e,n){const r=n.path,i=r.length+1;let o=r;We.isDocumentKey(o)||(o=o.child(""));const l=new Mn(new We(o),0);let d=new An(gt);return this.Zr.forEachWhile((h=>{const f=h.key.path;return!!r.isPrefixOf(f)&&(f.length===i&&(d=d.add(h.Yr)),!0)}),l),ke.resolve(this.ti(d))}ti(e){const n=[];return e.forEach((r=>{const i=this.Xr(r);i!==null&&n.push(i)})),n}removeMutationBatch(e,n){At(this.ni(n.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Zr;return ke.forEach(n.mutations,(i=>{const o=new Mn(i.key,n.batchId);return r=r.delete(o),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)})).next((()=>{this.Zr=r}))}ir(e){}containsKey(e,n){const r=new Mn(n,0),i=this.Zr.firstAfterOrEqual(r);return ke.resolve(n.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,ke.resolve()}ni(e,n){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const n=this.ei(e);return n<0||n>=this.mutationQueue.length?null:this.mutationQueue[n]}}class lN{constructor(e){this.ri=e,this.docs=(function(){return new tn(We.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,n){const r=n.key,i=this.docs.get(r),o=i?i.size:0,l=this.ri(n);return this.docs=this.docs.insert(r,{document:n.mutableCopy(),size:l}),this.size+=l-o,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const n=this.docs.get(e);n&&(this.docs=this.docs.remove(e),this.size-=n.size)}getEntry(e,n){const r=this.docs.get(n);return ke.resolve(r?r.document.mutableCopy():Xn.newInvalidDocument(n))}getEntries(e,n){let r=ji();return n.forEach((i=>{const o=this.docs.get(i);r=r.insert(i,o?o.document.mutableCopy():Xn.newInvalidDocument(i))})),ke.resolve(r)}getDocumentsMatchingQuery(e,n,r,i){let o=ji();const l=n.path,d=new We(l.child("__id-9223372036854775808__")),h=this.docs.getIteratorFrom(d);for(;h.hasNext();){const{key:f,value:{document:p}}=h.getNext();if(!l.isPrefixOf(f.path))break;f.path.length>l.length+1||BM(PM(p),r)<=0||(i.has(p.key)||nm(n,p))&&(o=o.insert(p.key,p.mutableCopy()))}return ke.resolve(o)}getAllFromCollectionGroup(e,n,r,i){Xe(9500)}ii(e,n){return ke.forEach(this.docs,(r=>n(r)))}newChangeBuffer(e){return new cN(this)}getSize(e){return ke.resolve(this.size)}}class cN extends tN{constructor(e){super(),this.Nr=e}applyChanges(e){const n=[];return this.changes.forEach(((r,i)=>{i.isValidDocument()?n.push(this.Nr.addEntry(e,i)):this.Nr.removeEntry(r)})),ke.waitFor(n)}getFromCache(e,n){return this.Nr.getEntry(e,n)}getAllFromCache(e,n){return this.Nr.getEntries(e,n)}}class uN{constructor(e){this.persistence=e,this.si=new Lo((n=>d0(n)),h0),this.lastRemoteSnapshotVersion=Je.min(),this.highestTargetId=0,this.oi=0,this._i=new _0,this.targetCount=0,this.ai=tc.ur()}forEachTarget(e,n){return this.si.forEach(((r,i)=>n(i))),ke.resolve()}getLastRemoteSnapshotVersion(e){return ke.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return ke.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),ke.resolve(this.highestTargetId)}setTargetsMetadata(e,n,r){return r&&(this.lastRemoteSnapshotVersion=r),n>this.oi&&(this.oi=n),ke.resolve()}Pr(e){this.si.set(e.target,e);const n=e.targetId;n>this.highestTargetId&&(this.ai=new tc(n),this.highestTargetId=n),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,n){return this.Pr(n),this.targetCount+=1,ke.resolve()}updateTargetData(e,n){return this.Pr(n),ke.resolve()}removeTargetData(e,n){return this.si.delete(n.target),this._i.jr(n.targetId),this.targetCount-=1,ke.resolve()}removeTargets(e,n,r){let i=0;const o=[];return this.si.forEach(((l,d)=>{d.sequenceNumber<=n&&r.get(d.targetId)===null&&(this.si.delete(l),o.push(this.removeMatchingKeysForTargetId(e,d.targetId)),i++)})),ke.waitFor(o).next((()=>i))}getTargetCount(e){return ke.resolve(this.targetCount)}getTargetData(e,n){const r=this.si.get(n)||null;return ke.resolve(r)}addMatchingKeys(e,n,r){return this._i.Wr(n,r),ke.resolve()}removeMatchingKeys(e,n,r){this._i.zr(n,r);const i=this.persistence.referenceDelegate,o=[];return i&&n.forEach((l=>{o.push(i.markPotentiallyOrphaned(e,l))})),ke.waitFor(o)}removeMatchingKeysForTargetId(e,n){return this._i.jr(n),ke.resolve()}getMatchingKeysForTargetId(e,n){const r=this._i.Hr(n);return ke.resolve(r)}containsKey(e,n){return ke.resolve(this._i.containsKey(n))}}class OC{constructor(e,n){this.ui={},this.overlays={},this.ci=new Zf(0),this.li=!1,this.li=!0,this.hi=new aN,this.referenceDelegate=e(this),this.Pi=new uN(this),this.indexManager=new QO,this.remoteDocumentCache=(function(i){return new lN(i)})((r=>this.referenceDelegate.Ti(r))),this.serializer=new GO(n),this.Ii=new sN(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let n=this.overlays[e.toKey()];return n||(n=new iN,this.overlays[e.toKey()]=n),n}getMutationQueue(e,n){let r=this.ui[e.toKey()];return r||(r=new oN(n,this.referenceDelegate),this.ui[e.toKey()]=r),r}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,n,r){Ue("MemoryPersistence","Starting transaction:",e);const i=new dN(this.ci.next());return this.referenceDelegate.Ei(),r(i).next((o=>this.referenceDelegate.di(i).next((()=>o)))).toPromise().then((o=>(i.raiseOnCommittedEvent(),o)))}Ai(e,n){return ke.or(Object.values(this.ui).map((r=>()=>r.containsKey(e,n))))}}class dN extends LM{constructor(e){super(),this.currentSequenceNumber=e}}class b0{constructor(e){this.persistence=e,this.Ri=new _0,this.Vi=null}static mi(e){return new b0(e)}get fi(){if(this.Vi)return this.Vi;throw Xe(60996)}addReference(e,n,r){return this.Ri.addReference(r,n),this.fi.delete(r.toString()),ke.resolve()}removeReference(e,n,r){return this.Ri.removeReference(r,n),this.fi.add(r.toString()),ke.resolve()}markPotentiallyOrphaned(e,n){return this.fi.add(n.toString()),ke.resolve()}removeTarget(e,n){this.Ri.jr(n.targetId).forEach((i=>this.fi.add(i.toString())));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,n.targetId).next((i=>{i.forEach((o=>this.fi.add(o.toString())))})).next((()=>r.removeTargetData(e,n)))}Ei(){this.Vi=new Set}di(e){const n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return ke.forEach(this.fi,(r=>{const i=We.fromPath(r);return this.gi(e,i).next((o=>{o||n.removeEntry(i,Je.min())}))})).next((()=>(this.Vi=null,n.apply(e))))}updateLimboDocument(e,n){return this.gi(e,n).next((r=>{r?this.fi.delete(n.toString()):this.fi.add(n.toString())}))}Ti(e){return 0}gi(e,n){return ke.or([()=>ke.resolve(this.Ri.containsKey(n)),()=>this.persistence.getTargetCache().containsKey(e,n),()=>this.persistence.Ai(e,n)])}}class Df{constructor(e,n){this.persistence=e,this.pi=new Lo((r=>VM(r.path)),((r,i)=>r.isEqual(i))),this.garbageCollector=eN(this,n)}static mi(e,n){return new Df(e,n)}Ei(){}di(e){return ke.resolve()}forEachTarget(e,n){return this.persistence.getTargetCache().forEachTarget(e,n)}gr(e){const n=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next((r=>n.next((i=>r+i))))}wr(e){let n=0;return this.pr(e,(r=>{n++})).next((()=>n))}pr(e,n){return ke.forEach(this.pi,((r,i)=>this.br(e,r,i).next((o=>o?ke.resolve():n(i)))))}removeTargets(e,n,r){return this.persistence.getTargetCache().removeTargets(e,n,r)}removeOrphanedDocuments(e,n){let r=0;const i=this.persistence.getRemoteDocumentCache(),o=i.newChangeBuffer();return i.ii(e,(l=>this.br(e,l,n).next((d=>{d||(r++,o.removeEntry(l,Je.min()))})))).next((()=>o.apply(e))).next((()=>r))}markPotentiallyOrphaned(e,n){return this.pi.set(n,e.currentSequenceNumber),ke.resolve()}removeTarget(e,n){const r=n.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,n,r){return this.pi.set(r,e.currentSequenceNumber),ke.resolve()}removeReference(e,n,r){return this.pi.set(r,e.currentSequenceNumber),ke.resolve()}updateLimboDocument(e,n){return this.pi.set(n,e.currentSequenceNumber),ke.resolve()}Ti(e){let n=e.key.toString().length;return e.isFoundDocument()&&(n+=of(e.data.value)),n}br(e,n,r){return ke.or([()=>this.persistence.Ai(e,n),()=>this.persistence.getTargetCache().containsKey(e,n),()=>{const i=this.pi.get(n);return ke.resolve(i!==void 0&&i>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class v0{constructor(e,n,r,i){this.targetId=e,this.fromCache=n,this.Es=r,this.ds=i}static As(e,n){let r=yt(),i=yt();for(const o of n.docChanges)switch(o.type){case 0:r=r.add(o.doc.key);break;case 1:i=i.add(o.doc.key)}return new v0(e,n.fromCache,r,i)}}class hN{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class fN{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(function(){return FR()?8:UM(er())>0?6:4})()}initialize(e,n){this.ps=e,this.indexManager=n,this.Rs=!0}getDocumentsMatchingQuery(e,n,r,i){const o={result:null};return this.ys(e,n).next((l=>{o.result=l})).next((()=>{if(!o.result)return this.ws(e,n,i,r).next((l=>{o.result=l}))})).next((()=>{if(o.result)return;const l=new hN;return this.Ss(e,n,l).next((d=>{if(o.result=d,this.Vs)return this.bs(e,n,l,d.size)}))})).next((()=>o.result))}bs(e,n,r,i){return r.documentReadCount<this.fs?(Bl()<=pt.DEBUG&&Ue("QueryEngine","SDK will not create cache indexes for query:",zl(n),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),ke.resolve()):(Bl()<=pt.DEBUG&&Ue("QueryEngine","Query:",zl(n),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.gs*i?(Bl()<=pt.DEBUG&&Ue("QueryEngine","The SDK decides to create cache indexes for query:",zl(n),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,$s(n))):ke.resolve())}ys(e,n){if(Kw(n))return ke.resolve(null);let r=$s(n);return this.indexManager.getIndexType(e,r).next((i=>i===0?null:(n.limit!==null&&i===1&&(n=Sy(n,null,"F"),r=$s(n)),this.indexManager.getDocumentsMatchingTarget(e,r).next((o=>{const l=yt(...o);return this.ps.getDocuments(e,l).next((d=>this.indexManager.getMinOffset(e,r).next((h=>{const f=this.Ds(n,d);return this.Cs(n,f,l,h.readTime)?this.ys(e,Sy(n,null,"F")):this.vs(e,f,n,h)}))))})))))}ws(e,n,r,i){return Kw(n)||i.isEqual(Je.min())?ke.resolve(null):this.ps.getDocuments(e,r).next((o=>{const l=this.Ds(n,o);return this.Cs(n,l,r,i)?ke.resolve(null):(Bl()<=pt.DEBUG&&Ue("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),zl(n)),this.vs(e,l,n,NM(i,Lu)).next((d=>d)))}))}Ds(e,n){let r=new An(dC(e));return n.forEach(((i,o)=>{nm(e,o)&&(r=r.add(o))})),r}Cs(e,n,r,i){if(e.limit===null)return!1;if(r.size!==n.size)return!0;const o=e.limitType==="F"?n.last():n.first();return!!o&&(o.hasPendingWrites||o.version.compareTo(i)>0)}Ss(e,n,r){return Bl()<=pt.DEBUG&&Ue("QueryEngine","Using full collection scan to execute query:",zl(n)),this.ps.getDocumentsMatchingQuery(e,n,Ia.min(),r)}vs(e,n,r,i){return this.ps.getDocumentsMatchingQuery(e,r,i).next((o=>(n.forEach((l=>{o=o.insert(l.key,l)})),o)))}}const x0="LocalStore",mN=3e8;class pN{constructor(e,n,r,i){this.persistence=e,this.Fs=n,this.serializer=i,this.Ms=new tn(gt),this.xs=new Lo((o=>d0(o)),h0),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(r)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new rN(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(n=>e.collect(n,this.Ms)))}}function gN(t,e,n,r){return new pN(t,e,n,r)}async function NC(t,e){const n=tt(t);return await n.persistence.runTransaction("Handle user change","readonly",(r=>{let i;return n.mutationQueue.getAllMutationBatches(r).next((o=>(i=o,n.Bs(e),n.mutationQueue.getAllMutationBatches(r)))).next((o=>{const l=[],d=[];let h=yt();for(const f of i){l.push(f.batchId);for(const p of f.mutations)h=h.add(p.key)}for(const f of o){d.push(f.batchId);for(const p of f.mutations)h=h.add(p.key)}return n.localDocuments.getDocuments(r,h).next((f=>({Ls:f,removedBatchIds:l,addedBatchIds:d})))}))}))}function yN(t,e){const n=tt(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(r=>{const i=e.batch.keys(),o=n.Ns.newChangeBuffer({trackRemovals:!0});return(function(d,h,f,p){const g=f.batch,b=g.keys();let _=ke.resolve();return b.forEach((w=>{_=_.next((()=>p.getEntry(h,w))).next((x=>{const S=f.docVersions.get(w);At(S!==null,48541),x.version.compareTo(S)<0&&(g.applyToRemoteDocument(x,f),x.isValidDocument()&&(x.setReadTime(f.commitVersion),p.addEntry(x)))}))})),_.next((()=>d.mutationQueue.removeMutationBatch(h,g)))})(n,r,e,o).next((()=>o.apply(r))).next((()=>n.mutationQueue.performConsistencyCheck(r))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,(function(d){let h=yt();for(let f=0;f<d.mutationResults.length;++f)d.mutationResults[f].transformResults.length>0&&(h=h.add(d.batch.mutations[f].key));return h})(e)))).next((()=>n.localDocuments.getDocuments(r,i)))}))}function PC(t){const e=tt(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(n=>e.Pi.getLastRemoteSnapshotVersion(n)))}function _N(t,e){const n=tt(t),r=e.snapshotVersion;let i=n.Ms;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(o=>{const l=n.Ns.newChangeBuffer({trackRemovals:!0});i=n.Ms;const d=[];e.targetChanges.forEach(((p,g)=>{const b=i.get(g);if(!b)return;d.push(n.Pi.removeMatchingKeys(o,p.removedDocuments,g).next((()=>n.Pi.addMatchingKeys(o,p.addedDocuments,g))));let _=b.withSequenceNumber(o.currentSequenceNumber);e.targetMismatches.get(g)!==null?_=_.withResumeToken(qn.EMPTY_BYTE_STRING,Je.min()).withLastLimboFreeSnapshotVersion(Je.min()):p.resumeToken.approximateByteSize()>0&&(_=_.withResumeToken(p.resumeToken,r)),i=i.insert(g,_),(function(x,S,C){return x.resumeToken.approximateByteSize()===0||S.snapshotVersion.toMicroseconds()-x.snapshotVersion.toMicroseconds()>=mN?!0:C.addedDocuments.size+C.modifiedDocuments.size+C.removedDocuments.size>0})(b,_,p)&&d.push(n.Pi.updateTargetData(o,_))}));let h=ji(),f=yt();if(e.documentUpdates.forEach((p=>{e.resolvedLimboDocuments.has(p)&&d.push(n.persistence.referenceDelegate.updateLimboDocument(o,p))})),d.push(bN(o,l,e.documentUpdates).next((p=>{h=p.ks,f=p.qs}))),!r.isEqual(Je.min())){const p=n.Pi.getLastRemoteSnapshotVersion(o).next((g=>n.Pi.setTargetsMetadata(o,o.currentSequenceNumber,r)));d.push(p)}return ke.waitFor(d).next((()=>l.apply(o))).next((()=>n.localDocuments.getLocalViewOfDocuments(o,h,f))).next((()=>h))})).then((o=>(n.Ms=i,o)))}function bN(t,e,n){let r=yt(),i=yt();return n.forEach((o=>r=r.add(o))),e.getEntries(t,r).next((o=>{let l=ji();return n.forEach(((d,h)=>{const f=o.get(d);h.isFoundDocument()!==f.isFoundDocument()&&(i=i.add(d)),h.isNoDocument()&&h.version.isEqual(Je.min())?(e.removeEntry(d,h.readTime),l=l.insert(d,h)):!f.isValidDocument()||h.version.compareTo(f.version)>0||h.version.compareTo(f.version)===0&&f.hasPendingWrites?(e.addEntry(h),l=l.insert(d,h)):Ue(x0,"Ignoring outdated watch update for ",d,". Current version:",f.version," Watch version:",h.version)})),{ks:l,qs:i}}))}function vN(t,e){const n=tt(t);return n.persistence.runTransaction("Get next mutation batch","readonly",(r=>(e===void 0&&(e=l0),n.mutationQueue.getNextMutationBatchAfterBatchId(r,e))))}function xN(t,e){const n=tt(t);return n.persistence.runTransaction("Allocate target","readwrite",(r=>{let i;return n.Pi.getTargetData(r,e).next((o=>o?(i=o,ke.resolve(i)):n.Pi.allocateTargetId(r).next((l=>(i=new _a(e,l,"TargetPurposeListen",r.currentSequenceNumber),n.Pi.addTargetData(r,i).next((()=>i)))))))})).then((r=>{const i=n.Ms.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(n.Ms=n.Ms.insert(r.targetId,r),n.xs.set(e,r.targetId)),r}))}async function jy(t,e,n){const r=tt(t),i=r.Ms.get(e),o=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",o,(l=>r.persistence.referenceDelegate.removeTarget(l,i)))}catch(l){if(!mc(l))throw l;Ue(x0,`Failed to update sequence numbers for target ${e}: ${l}`)}r.Ms=r.Ms.remove(e),r.xs.delete(i.target)}function lS(t,e,n){const r=tt(t);let i=Je.min(),o=yt();return r.persistence.runTransaction("Execute query","readwrite",(l=>(function(h,f,p){const g=tt(h),b=g.xs.get(p);return b!==void 0?ke.resolve(g.Ms.get(b)):g.Pi.getTargetData(f,p)})(r,l,$s(e)).next((d=>{if(d)return i=d.lastLimboFreeSnapshotVersion,r.Pi.getMatchingKeysForTargetId(l,d.targetId).next((h=>{o=h}))})).next((()=>r.Fs.getDocumentsMatchingQuery(l,e,n?i:Je.min(),n?o:yt()))).next((d=>(wN(r,oO(e),d),{documents:d,Qs:o})))))}function wN(t,e,n){let r=t.Os.get(e)||Je.min();n.forEach(((i,o)=>{o.readTime.compareTo(r)>0&&(r=o.readTime)})),t.Os.set(e,r)}class cS{constructor(){this.activeTargetIds=fO()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class SN{constructor(){this.Mo=new cS,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,n,r){}addLocalQueryTarget(e,n=!0){return n&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,n,r){this.xo[e]=n}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new cS,Promise.resolve()}handleUserChange(e,n,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class EN{Oo(e){}shutdown(){}}const uS="ConnectivityMonitor";class dS{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){Ue(uS,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){Ue(uS,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}let Yh=null;function Ry(){return Yh===null?Yh=(function(){return 268435456+Math.round(2147483648*Math.random())})():Yh++,"0x"+Yh.toString(16)}const qg="RestConnection",CN={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class TN{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const n=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Uo=n+"://"+e.host,this.Ko=`projects/${r}/databases/${i}`,this.Wo=this.databaseId.database===Ef?`project_id=${r}`:`project_id=${r}&database_id=${i}`}Go(e,n,r,i,o){const l=Ry(),d=this.zo(e,n.toUriEncodedString());Ue(qg,`Sending RPC '${e}' ${l}:`,d,r);const h={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(h,i,o);const{host:f}=new URL(d),p=lc(f);return this.Jo(e,d,h,r,p).then((g=>(Ue(qg,`Received RPC '${e}' ${l}: `,g),g)),(g=>{throw Kl(qg,`RPC '${e}' ${l} failed with error: `,g,"url: ",d,"request:",r),g}))}Ho(e,n,r,i,o,l){return this.Go(e,n,r,i,o)}jo(e,n,r){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+hc})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach(((i,o)=>e[o]=i)),r&&r.headers.forEach(((i,o)=>e[o]=i))}zo(e,n){const r=CN[e];return`${this.Uo}/v1/${n}:${r}`}terminate(){}}class AN{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}const Kn="WebChannelConnection";class jN extends TN{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,n,r,i,o){const l=Ry();return new Promise(((d,h)=>{const f=new zE;f.setWithCredentials(!0),f.listenOnce(LE.COMPLETE,(()=>{try{switch(f.getLastErrorCode()){case af.NO_ERROR:const g=f.getResponseJson();Ue(Kn,`XHR for RPC '${e}' ${l} received:`,JSON.stringify(g)),d(g);break;case af.TIMEOUT:Ue(Kn,`RPC '${e}' ${l} timed out`),h(new Le(Ie.DEADLINE_EXCEEDED,"Request time out"));break;case af.HTTP_ERROR:const b=f.getStatus();if(Ue(Kn,`RPC '${e}' ${l} failed with status:`,b,"response text:",f.getResponseText()),b>0){let _=f.getResponseJson();Array.isArray(_)&&(_=_[0]);const w=_?.error;if(w&&w.status&&w.message){const x=(function(C){const T=C.toLowerCase().replace(/_/g,"-");return Object.values(Ie).indexOf(T)>=0?T:Ie.UNKNOWN})(w.status);h(new Le(x,w.message))}else h(new Le(Ie.UNKNOWN,"Server responded with status "+f.getStatus()))}else h(new Le(Ie.UNAVAILABLE,"Connection failed."));break;default:Xe(9055,{l_:e,streamId:l,h_:f.getLastErrorCode(),P_:f.getLastError()})}}finally{Ue(Kn,`RPC '${e}' ${l} completed.`)}}));const p=JSON.stringify(i);Ue(Kn,`RPC '${e}' ${l} sending request:`,i),f.send(n,"POST",p,r,15)}))}T_(e,n,r){const i=Ry(),o=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],l=VE(),d=FE(),h={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},f=this.longPollingOptions.timeoutSeconds;f!==void 0&&(h.longPollingTimeout=Math.round(1e3*f)),this.useFetchStreams&&(h.useFetchStreams=!0),this.jo(h.initMessageHeaders,n,r),h.encodeInitMessageHeaders=!0;const p=o.join("");Ue(Kn,`Creating RPC '${e}' stream ${i}: ${p}`,h);const g=l.createWebChannel(p,h);this.I_(g);let b=!1,_=!1;const w=new AN({Yo:S=>{_?Ue(Kn,`Not sending because RPC '${e}' stream ${i} is closed:`,S):(b||(Ue(Kn,`Opening RPC '${e}' stream ${i} transport.`),g.open(),b=!0),Ue(Kn,`RPC '${e}' stream ${i} sending:`,S),g.send(S))},Zo:()=>g.close()}),x=(S,C,T)=>{S.listen(C,(R=>{try{T(R)}catch(D){setTimeout((()=>{throw D}),0)}}))};return x(g,Eu.EventType.OPEN,(()=>{_||(Ue(Kn,`RPC '${e}' stream ${i} transport opened.`),w.o_())})),x(g,Eu.EventType.CLOSE,(()=>{_||(_=!0,Ue(Kn,`RPC '${e}' stream ${i} transport closed`),w.a_(),this.E_(g))})),x(g,Eu.EventType.ERROR,(S=>{_||(_=!0,Kl(Kn,`RPC '${e}' stream ${i} transport errored. Name:`,S.name,"Message:",S.message),w.a_(new Le(Ie.UNAVAILABLE,"The operation could not be completed")))})),x(g,Eu.EventType.MESSAGE,(S=>{if(!_){const C=S.data[0];At(!!C,16349);const T=C,R=T?.error||T[0]?.error;if(R){Ue(Kn,`RPC '${e}' stream ${i} received error:`,R);const D=R.status;let V=(function(M){const B=bn[M];if(B!==void 0)return SC(B)})(D),$=R.message;V===void 0&&(V=Ie.INTERNAL,$="Unknown error status: "+D+" with message "+R.message),_=!0,w.a_(new Le(V,$)),g.close()}else Ue(Kn,`RPC '${e}' stream ${i} received:`,C),w.u_(C)}})),x(d,UE.STAT_EVENT,(S=>{S.stat===gy.PROXY?Ue(Kn,`RPC '${e}' stream ${i} detected buffering proxy`):S.stat===gy.NOPROXY&&Ue(Kn,`RPC '${e}' stream ${i} detected no buffering proxy`)})),setTimeout((()=>{w.__()}),0),w}terminate(){this.c_.forEach((e=>e.close())),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter((n=>n===e))}}function Hg(){return typeof document<"u"?document:null}function om(t){return new kO(t,!0)}class BC{constructor(e,n,r=1e3,i=1.5,o=6e4){this.Mi=e,this.timerId=n,this.d_=r,this.A_=i,this.R_=o,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const n=Math.floor(this.V_+this.y_()),r=Math.max(0,Date.now()-this.f_),i=Math.max(0,n-r);i>0&&Ue("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.V_} ms, delay with jitter: ${n} ms, last attempt: ${r} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,i,(()=>(this.f_=Date.now(),e()))),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}const hS="PersistentStream";class zC{constructor(e,n,r,i,o,l,d,h){this.Mi=e,this.S_=r,this.b_=i,this.connection=o,this.authCredentialsProvider=l,this.appCheckCredentialsProvider=d,this.listener=h,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new BC(e,n)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,(()=>this.k_())))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,n){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():n&&n.code===Ie.RESOURCE_EXHAUSTED?(Ai(n.toString()),Ai("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):n&&n.code===Ie.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(n)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),n=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([r,i])=>{this.D_===n&&this.G_(r,i)}),(r=>{e((()=>{const i=new Le(Ie.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(i)}))}))}G_(e,n){const r=this.W_(this.D_);this.stream=this.j_(e,n),this.stream.Xo((()=>{r((()=>this.listener.Xo()))})),this.stream.t_((()=>{r((()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.t_())))})),this.stream.r_((i=>{r((()=>this.z_(i)))})),this.stream.onMessage((i=>{r((()=>++this.F_==1?this.J_(i):this.onNext(i)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(e){return Ue(hS,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return n=>{this.Mi.enqueueAndForget((()=>this.D_===e?n():(Ue(hS,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class RN extends zC{constructor(e,n,r,i,o,l){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",n,r,i,l),this.serializer=o}j_(e,n){return this.connection.T_("Listen",e,n)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const n=NO(this.serializer,e),r=(function(o){if(!("targetChange"in o))return Je.min();const l=o.targetChange;return l.targetIds&&l.targetIds.length?Je.min():l.readTime?qs(l.readTime):Je.min()})(e);return this.listener.H_(n,r)}Y_(e){const n={};n.database=Ay(this.serializer),n.addTarget=(function(o,l){let d;const h=l.target;if(d=xy(h)?{documents:zO(o,h)}:{query:LO(o,h).ft},d.targetId=l.targetId,l.resumeToken.approximateByteSize()>0){d.resumeToken=TC(o,l.resumeToken);const f=Ey(o,l.expectedCount);f!==null&&(d.expectedCount=f)}else if(l.snapshotVersion.compareTo(Je.min())>0){d.readTime=If(o,l.snapshotVersion.toTimestamp());const f=Ey(o,l.expectedCount);f!==null&&(d.expectedCount=f)}return d})(this.serializer,e);const r=FO(this.serializer,e);r&&(n.labels=r),this.q_(n)}Z_(e){const n={};n.database=Ay(this.serializer),n.removeTarget=e,this.q_(n)}}class IN extends zC{constructor(e,n,r,i,o,l){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",n,r,i,l),this.serializer=o}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,n){return this.connection.T_("Write",e,n)}J_(e){return At(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,At(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){At(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const n=BO(e.writeResults,e.commitTime),r=qs(e.commitTime);return this.listener.na(r,n)}ra(){const e={};e.database=Ay(this.serializer),this.q_(e)}ea(e){const n={streamToken:this.lastStreamToken,writes:e.map((r=>PO(this.serializer,r)))};this.q_(n)}}class DN{}class kN extends DN{constructor(e,n,r,i){super(),this.authCredentials=e,this.appCheckCredentials=n,this.connection=r,this.serializer=i,this.ia=!1}sa(){if(this.ia)throw new Le(Ie.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,n,r,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([o,l])=>this.connection.Go(e,Cy(n,r),i,o,l))).catch((o=>{throw o.name==="FirebaseError"?(o.code===Ie.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new Le(Ie.UNKNOWN,o.toString())}))}Ho(e,n,r,i,o){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([l,d])=>this.connection.Ho(e,Cy(n,r),i,l,d,o))).catch((l=>{throw l.name==="FirebaseError"?(l.code===Ie.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),l):new Le(Ie.UNKNOWN,l.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}class MN{constructor(e,n){this.asyncQueue=e,this.onlineStateHandler=n,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const n=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(Ai(n),this.aa=!1):Ue("OnlineStateTracker",n)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}const Oo="RemoteStore";class ON{constructor(e,n,r,i,o){this.localStore=e,this.datastore=n,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=o,this.Aa.Oo((l=>{r.enqueueAndForget((async()=>{Uo(this)&&(Ue(Oo,"Restarting streams for network reachability change."),await(async function(h){const f=tt(h);f.Ea.add(4),await ld(f),f.Ra.set("Unknown"),f.Ea.delete(4),await lm(f)})(this))}))})),this.Ra=new MN(r,i)}}async function lm(t){if(Uo(t))for(const e of t.da)await e(!0)}async function ld(t){for(const e of t.da)await e(!1)}function LC(t,e){const n=tt(t);n.Ia.has(e.targetId)||(n.Ia.set(e.targetId,e),C0(n)?E0(n):pc(n).O_()&&S0(n,e))}function w0(t,e){const n=tt(t),r=pc(n);n.Ia.delete(e),r.O_()&&UC(n,e),n.Ia.size===0&&(r.O_()?r.L_():Uo(n)&&n.Ra.set("Unknown"))}function S0(t,e){if(t.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Je.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}pc(t).Y_(e)}function UC(t,e){t.Va.Ue(e),pc(t).Z_(e)}function E0(t){t.Va=new jO({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),At:e=>t.Ia.get(e)||null,ht:()=>t.datastore.serializer.databaseId}),pc(t).start(),t.Ra.ua()}function C0(t){return Uo(t)&&!pc(t).x_()&&t.Ia.size>0}function Uo(t){return tt(t).Ea.size===0}function FC(t){t.Va=void 0}async function NN(t){t.Ra.set("Online")}async function PN(t){t.Ia.forEach(((e,n)=>{S0(t,e)}))}async function BN(t,e){FC(t),C0(t)?(t.Ra.ha(e),E0(t)):t.Ra.set("Unknown")}async function zN(t,e,n){if(t.Ra.set("Online"),e instanceof CC&&e.state===2&&e.cause)try{await(async function(i,o){const l=o.cause;for(const d of o.targetIds)i.Ia.has(d)&&(await i.remoteSyncer.rejectListen(d,l),i.Ia.delete(d),i.Va.removeTarget(d))})(t,e)}catch(r){Ue(Oo,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await kf(t,r)}else if(e instanceof uf?t.Va.Ze(e):e instanceof EC?t.Va.st(e):t.Va.tt(e),!n.isEqual(Je.min()))try{const r=await PC(t.localStore);n.compareTo(r)>=0&&await(function(o,l){const d=o.Va.Tt(l);return d.targetChanges.forEach(((h,f)=>{if(h.resumeToken.approximateByteSize()>0){const p=o.Ia.get(f);p&&o.Ia.set(f,p.withResumeToken(h.resumeToken,l))}})),d.targetMismatches.forEach(((h,f)=>{const p=o.Ia.get(h);if(!p)return;o.Ia.set(h,p.withResumeToken(qn.EMPTY_BYTE_STRING,p.snapshotVersion)),UC(o,h);const g=new _a(p.target,h,f,p.sequenceNumber);S0(o,g)})),o.remoteSyncer.applyRemoteEvent(d)})(t,n)}catch(r){Ue(Oo,"Failed to raise snapshot:",r),await kf(t,r)}}async function kf(t,e,n){if(!mc(e))throw e;t.Ea.add(1),await ld(t),t.Ra.set("Offline"),n||(n=()=>PC(t.localStore)),t.asyncQueue.enqueueRetryable((async()=>{Ue(Oo,"Retrying IndexedDB access"),await n(),t.Ea.delete(1),await lm(t)}))}function VC(t,e){return e().catch((n=>kf(t,n,e)))}async function cm(t){const e=tt(t),n=Oa(e);let r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:l0;for(;LN(e);)try{const i=await vN(e.localStore,r);if(i===null){e.Ta.length===0&&n.L_();break}r=i.batchId,UN(e,i)}catch(i){await kf(e,i)}$C(e)&&qC(e)}function LN(t){return Uo(t)&&t.Ta.length<10}function UN(t,e){t.Ta.push(e);const n=Oa(t);n.O_()&&n.X_&&n.ea(e.mutations)}function $C(t){return Uo(t)&&!Oa(t).x_()&&t.Ta.length>0}function qC(t){Oa(t).start()}async function FN(t){Oa(t).ra()}async function VN(t){const e=Oa(t);for(const n of t.Ta)e.ea(n.mutations)}async function $N(t,e,n){const r=t.Ta.shift(),i=p0.from(r,e,n);await VC(t,(()=>t.remoteSyncer.applySuccessfulWrite(i))),await cm(t)}async function qN(t,e){e&&Oa(t).X_&&await(async function(r,i){if((function(l){return CO(l)&&l!==Ie.ABORTED})(i.code)){const o=r.Ta.shift();Oa(r).B_(),await VC(r,(()=>r.remoteSyncer.rejectFailedWrite(o.batchId,i))),await cm(r)}})(t,e),$C(t)&&qC(t)}async function fS(t,e){const n=tt(t);n.asyncQueue.verifyOperationInProgress(),Ue(Oo,"RemoteStore received new credentials");const r=Uo(n);n.Ea.add(3),await ld(n),r&&n.Ra.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.Ea.delete(3),await lm(n)}async function HN(t,e){const n=tt(t);e?(n.Ea.delete(2),await lm(n)):e||(n.Ea.add(2),await ld(n),n.Ra.set("Unknown"))}function pc(t){return t.ma||(t.ma=(function(n,r,i){const o=tt(n);return o.sa(),new RN(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,i)})(t.datastore,t.asyncQueue,{Xo:NN.bind(null,t),t_:PN.bind(null,t),r_:BN.bind(null,t),H_:zN.bind(null,t)}),t.da.push((async e=>{e?(t.ma.B_(),C0(t)?E0(t):t.Ra.set("Unknown")):(await t.ma.stop(),FC(t))}))),t.ma}function Oa(t){return t.fa||(t.fa=(function(n,r,i){const o=tt(n);return o.sa(),new IN(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,i)})(t.datastore,t.asyncQueue,{Xo:()=>Promise.resolve(),t_:FN.bind(null,t),r_:qN.bind(null,t),ta:VN.bind(null,t),na:$N.bind(null,t)}),t.da.push((async e=>{e?(t.fa.B_(),await cm(t)):(await t.fa.stop(),t.Ta.length>0&&(Ue(Oo,`Stopping write stream with ${t.Ta.length} pending writes`),t.Ta=[]))}))),t.fa}class T0{constructor(e,n,r,i,o){this.asyncQueue=e,this.timerId=n,this.targetTimeMs=r,this.op=i,this.removalCallback=o,this.deferred=new wi,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((l=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,n,r,i,o){const l=Date.now()+r,d=new T0(e,n,l,i,o);return d.start(r),d}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Le(Ie.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function A0(t,e){if(Ai("AsyncQueue",`${e}: ${t}`),mc(t))return new Le(Ie.UNAVAILABLE,`${e}: ${t}`);throw t}class Hl{static emptySet(e){return new Hl(e.comparator)}constructor(e){this.comparator=e?(n,r)=>e(n,r)||We.comparator(n.key,r.key):(n,r)=>We.comparator(n.key,r.key),this.keyedMap=Cu(),this.sortedSet=new tn(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const n=this.keyedMap.get(e);return n?this.sortedSet.indexOf(n):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((n,r)=>(e(n),!1)))}add(e){const n=this.delete(e.key);return n.copy(n.keyedMap.insert(e.key,e),n.sortedSet.insert(e,null))}delete(e){const n=this.get(e);return n?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(n)):this}isEqual(e){if(!(e instanceof Hl)||this.size!==e.size)return!1;const n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;n.hasNext();){const i=n.getNext().key,o=r.getNext().key;if(!i.isEqual(o))return!1}return!0}toString(){const e=[];return this.forEach((n=>{e.push(n.toString())})),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,n){const r=new Hl;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r}}class mS{constructor(){this.ga=new tn(We.comparator)}track(e){const n=e.doc.key,r=this.ga.get(n);r?e.type!==0&&r.type===3?this.ga=this.ga.insert(n,e):e.type===3&&r.type!==1?this.ga=this.ga.insert(n,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.ga=this.ga.insert(n,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.ga=this.ga.insert(n,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.ga=this.ga.remove(n):e.type===1&&r.type===2?this.ga=this.ga.insert(n,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.ga=this.ga.insert(n,{type:2,doc:e.doc}):Xe(63341,{Rt:e,pa:r}):this.ga=this.ga.insert(n,e)}ya(){const e=[];return this.ga.inorderTraversal(((n,r)=>{e.push(r)})),e}}class nc{constructor(e,n,r,i,o,l,d,h,f){this.query=e,this.docs=n,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=o,this.fromCache=l,this.syncStateChanged=d,this.excludesMetadataChanges=h,this.hasCachedResults=f}static fromInitialDocuments(e,n,r,i,o){const l=[];return n.forEach((d=>{l.push({type:0,doc:d})})),new nc(e,n,Hl.emptySet(n),l,r,i,!0,!1,o)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&tm(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const n=this.docChanges,r=e.docChanges;if(n.length!==r.length)return!1;for(let i=0;i<n.length;i++)if(n[i].type!==r[i].type||!n[i].doc.isEqual(r[i].doc))return!1;return!0}}class GN{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some((e=>e.Da()))}}class WN{constructor(){this.queries=pS(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(n,r){const i=tt(n),o=i.queries;i.queries=pS(),o.forEach(((l,d)=>{for(const h of d.Sa)h.onError(r)}))})(this,new Le(Ie.ABORTED,"Firestore shutting down"))}}function pS(){return new Lo((t=>uC(t)),tm)}async function HC(t,e){const n=tt(t);let r=3;const i=e.query;let o=n.queries.get(i);o?!o.ba()&&e.Da()&&(r=2):(o=new GN,r=e.Da()?0:1);try{switch(r){case 0:o.wa=await n.onListen(i,!0);break;case 1:o.wa=await n.onListen(i,!1);break;case 2:await n.onFirstRemoteStoreListen(i)}}catch(l){const d=A0(l,`Initialization of query '${zl(e.query)}' failed`);return void e.onError(d)}n.queries.set(i,o),o.Sa.push(e),e.va(n.onlineState),o.wa&&e.Fa(o.wa)&&j0(n)}async function GC(t,e){const n=tt(t),r=e.query;let i=3;const o=n.queries.get(r);if(o){const l=o.Sa.indexOf(e);l>=0&&(o.Sa.splice(l,1),o.Sa.length===0?i=e.Da()?0:1:!o.ba()&&e.Da()&&(i=2))}switch(i){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}}function QN(t,e){const n=tt(t);let r=!1;for(const i of e){const o=i.query,l=n.queries.get(o);if(l){for(const d of l.Sa)d.Fa(i)&&(r=!0);l.wa=i}}r&&j0(n)}function KN(t,e,n){const r=tt(t),i=r.queries.get(e);if(i)for(const o of i.Sa)o.onError(n);r.queries.delete(e)}function j0(t){t.Ca.forEach((e=>{e.next()}))}var Iy,gS;(gS=Iy||(Iy={})).Ma="default",gS.Cache="cache";class WC{constructor(e,n,r){this.query=e,this.xa=n,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){const r=[];for(const i of e.docChanges)i.type!==3&&r.push(i);e=new nc(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let n=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),n=!0):this.La(e,this.onlineState)&&(this.ka(e),n=!0),this.Na=e,n}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let n=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),n=!0),n}La(e,n){if(!e.fromCache||!this.Da())return!0;const r=n!=="Offline";return(!this.options.qa||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||n==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const n=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!n)&&this.options.includeMetadataChanges===!0}ka(e){e=nc.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==Iy.Cache}}class QC{constructor(e){this.key=e}}class KC{constructor(e){this.key=e}}class YN{constructor(e,n){this.query=e,this.Ya=n,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=yt(),this.mutatedKeys=yt(),this.eu=dC(e),this.tu=new Hl(this.eu)}get nu(){return this.Ya}ru(e,n){const r=n?n.iu:new mS,i=n?n.tu:this.tu;let o=n?n.mutatedKeys:this.mutatedKeys,l=i,d=!1;const h=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,f=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal(((p,g)=>{const b=i.get(p),_=nm(this.query,g)?g:null,w=!!b&&this.mutatedKeys.has(b.key),x=!!_&&(_.hasLocalMutations||this.mutatedKeys.has(_.key)&&_.hasCommittedMutations);let S=!1;b&&_?b.data.isEqual(_.data)?w!==x&&(r.track({type:3,doc:_}),S=!0):this.su(b,_)||(r.track({type:2,doc:_}),S=!0,(h&&this.eu(_,h)>0||f&&this.eu(_,f)<0)&&(d=!0)):!b&&_?(r.track({type:0,doc:_}),S=!0):b&&!_&&(r.track({type:1,doc:b}),S=!0,(h||f)&&(d=!0)),S&&(_?(l=l.add(_),o=x?o.add(p):o.delete(p)):(l=l.delete(p),o=o.delete(p)))})),this.query.limit!==null)for(;l.size>this.query.limit;){const p=this.query.limitType==="F"?l.last():l.first();l=l.delete(p.key),o=o.delete(p.key),r.track({type:1,doc:p})}return{tu:l,iu:r,Cs:d,mutatedKeys:o}}su(e,n){return e.hasLocalMutations&&n.hasCommittedMutations&&!n.hasLocalMutations}applyChanges(e,n,r,i){const o=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const l=e.iu.ya();l.sort(((p,g)=>(function(_,w){const x=S=>{switch(S){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Xe(20277,{Rt:S})}};return x(_)-x(w)})(p.type,g.type)||this.eu(p.doc,g.doc))),this.ou(r),i=i??!1;const d=n&&!i?this._u():[],h=this.Xa.size===0&&this.current&&!i?1:0,f=h!==this.Za;return this.Za=h,l.length!==0||f?{snapshot:new nc(this.query,e.tu,o,l,e.mutatedKeys,h===0,f,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:d}:{au:d}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new mS,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach((n=>this.Ya=this.Ya.add(n))),e.modifiedDocuments.forEach((n=>{})),e.removedDocuments.forEach((n=>this.Ya=this.Ya.delete(n))),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=yt(),this.tu.forEach((r=>{this.uu(r.key)&&(this.Xa=this.Xa.add(r.key))}));const n=[];return e.forEach((r=>{this.Xa.has(r)||n.push(new KC(r))})),this.Xa.forEach((r=>{e.has(r)||n.push(new QC(r))})),n}cu(e){this.Ya=e.Qs,this.Xa=yt();const n=this.ru(e.documents);return this.applyChanges(n,!0)}lu(){return nc.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const R0="SyncEngine";class XN{constructor(e,n,r){this.query=e,this.targetId=n,this.view=r}}class ZN{constructor(e){this.key=e,this.hu=!1}}class JN{constructor(e,n,r,i,o,l){this.localStore=e,this.remoteStore=n,this.eventManager=r,this.sharedClientState=i,this.currentUser=o,this.maxConcurrentLimboResolutions=l,this.Pu={},this.Tu=new Lo((d=>uC(d)),tm),this.Iu=new Map,this.Eu=new Set,this.du=new tn(We.comparator),this.Au=new Map,this.Ru=new _0,this.Vu={},this.mu=new Map,this.fu=tc.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function e6(t,e,n=!0){const r=tT(t);let i;const o=r.Tu.get(e);return o?(r.sharedClientState.addLocalQueryTarget(o.targetId),i=o.view.lu()):i=await YC(r,e,n,!0),i}async function t6(t,e){const n=tT(t);await YC(n,e,!0,!1)}async function YC(t,e,n,r){const i=await xN(t.localStore,$s(e)),o=i.targetId,l=t.sharedClientState.addLocalQueryTarget(o,n);let d;return r&&(d=await n6(t,e,o,l==="current",i.resumeToken)),t.isPrimaryClient&&n&&LC(t.remoteStore,i),d}async function n6(t,e,n,r,i){t.pu=(g,b,_)=>(async function(x,S,C,T){let R=S.view.ru(C);R.Cs&&(R=await lS(x.localStore,S.query,!1).then((({documents:k})=>S.view.ru(k,R))));const D=T&&T.targetChanges.get(S.targetId),V=T&&T.targetMismatches.get(S.targetId)!=null,$=S.view.applyChanges(R,x.isPrimaryClient,D,V);return _S(x,S.targetId,$.au),$.snapshot})(t,g,b,_);const o=await lS(t.localStore,e,!0),l=new YN(e,o.Qs),d=l.ru(o.documents),h=od.createSynthesizedTargetChangeForCurrentChange(n,r&&t.onlineState!=="Offline",i),f=l.applyChanges(d,t.isPrimaryClient,h);_S(t,n,f.au);const p=new XN(e,n,l);return t.Tu.set(e,p),t.Iu.has(n)?t.Iu.get(n).push(e):t.Iu.set(n,[e]),f.snapshot}async function r6(t,e,n){const r=tt(t),i=r.Tu.get(e),o=r.Iu.get(i.targetId);if(o.length>1)return r.Iu.set(i.targetId,o.filter((l=>!tm(l,e)))),void r.Tu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||await jy(r.localStore,i.targetId,!1).then((()=>{r.sharedClientState.clearQueryState(i.targetId),n&&w0(r.remoteStore,i.targetId),Dy(r,i.targetId)})).catch(fc)):(Dy(r,i.targetId),await jy(r.localStore,i.targetId,!0))}async function s6(t,e){const n=tt(t),r=n.Tu.get(e),i=n.Iu.get(r.targetId);n.isPrimaryClient&&i.length===1&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),w0(n.remoteStore,r.targetId))}async function i6(t,e,n){const r=h6(t);try{const i=await(function(l,d){const h=tt(l),f=Gt.now(),p=d.reduce(((_,w)=>_.add(w.key)),yt());let g,b;return h.persistence.runTransaction("Locally write mutations","readwrite",(_=>{let w=ji(),x=yt();return h.Ns.getEntries(_,p).next((S=>{w=S,w.forEach(((C,T)=>{T.isValidDocument()||(x=x.add(C))}))})).next((()=>h.localDocuments.getOverlayedDocuments(_,w))).next((S=>{g=S;const C=[];for(const T of d){const R=vO(T,g.get(T.key).overlayedDocument);R!=null&&C.push(new Va(T.key,R,nC(R.value.mapValue),vr.exists(!0)))}return h.mutationQueue.addMutationBatch(_,f,C,d)})).next((S=>{b=S;const C=S.applyToLocalDocumentSet(g,x);return h.documentOverlayCache.saveOverlays(_,S.batchId,C)}))})).then((()=>({batchId:b.batchId,changes:fC(g)})))})(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),(function(l,d,h){let f=l.Vu[l.currentUser.toKey()];f||(f=new tn(gt)),f=f.insert(d,h),l.Vu[l.currentUser.toKey()]=f})(r,i.batchId,n),await cd(r,i.changes),await cm(r.remoteStore)}catch(i){const o=A0(i,"Failed to persist write");n.reject(o)}}async function XC(t,e){const n=tt(t);try{const r=await _N(n.localStore,e);e.targetChanges.forEach(((i,o)=>{const l=n.Au.get(o);l&&(At(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1,22616),i.addedDocuments.size>0?l.hu=!0:i.modifiedDocuments.size>0?At(l.hu,14607):i.removedDocuments.size>0&&(At(l.hu,42227),l.hu=!1))})),await cd(n,r,e)}catch(r){await fc(r)}}function yS(t,e,n){const r=tt(t);if(r.isPrimaryClient&&n===0||!r.isPrimaryClient&&n===1){const i=[];r.Tu.forEach(((o,l)=>{const d=l.view.va(e);d.snapshot&&i.push(d.snapshot)})),(function(l,d){const h=tt(l);h.onlineState=d;let f=!1;h.queries.forEach(((p,g)=>{for(const b of g.Sa)b.va(d)&&(f=!0)})),f&&j0(h)})(r.eventManager,e),i.length&&r.Pu.H_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function a6(t,e,n){const r=tt(t);r.sharedClientState.updateQueryState(e,"rejected",n);const i=r.Au.get(e),o=i&&i.key;if(o){let l=new tn(We.comparator);l=l.insert(o,Xn.newNoDocument(o,Je.min()));const d=yt().add(o),h=new am(Je.min(),new Map,new tn(gt),l,d);await XC(r,h),r.du=r.du.remove(o),r.Au.delete(e),I0(r)}else await jy(r.localStore,e,!1).then((()=>Dy(r,e,n))).catch(fc)}async function o6(t,e){const n=tt(t),r=e.batch.batchId;try{const i=await yN(n.localStore,e);JC(n,r,null),ZC(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await cd(n,i)}catch(i){await fc(i)}}async function l6(t,e,n){const r=tt(t);try{const i=await(function(l,d){const h=tt(l);return h.persistence.runTransaction("Reject batch","readwrite-primary",(f=>{let p;return h.mutationQueue.lookupMutationBatch(f,d).next((g=>(At(g!==null,37113),p=g.keys(),h.mutationQueue.removeMutationBatch(f,g)))).next((()=>h.mutationQueue.performConsistencyCheck(f))).next((()=>h.documentOverlayCache.removeOverlaysForBatchId(f,p,d))).next((()=>h.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(f,p))).next((()=>h.localDocuments.getDocuments(f,p)))}))})(r.localStore,e);JC(r,e,n),ZC(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),await cd(r,i)}catch(i){await fc(i)}}function ZC(t,e){(t.mu.get(e)||[]).forEach((n=>{n.resolve()})),t.mu.delete(e)}function JC(t,e,n){const r=tt(t);let i=r.Vu[r.currentUser.toKey()];if(i){const o=i.get(e);o&&(n?o.reject(n):o.resolve(),i=i.remove(e)),r.Vu[r.currentUser.toKey()]=i}}function Dy(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.Iu.get(e))t.Tu.delete(r),n&&t.Pu.yu(r,n);t.Iu.delete(e),t.isPrimaryClient&&t.Ru.jr(e).forEach((r=>{t.Ru.containsKey(r)||eT(t,r)}))}function eT(t,e){t.Eu.delete(e.path.canonicalString());const n=t.du.get(e);n!==null&&(w0(t.remoteStore,n),t.du=t.du.remove(e),t.Au.delete(n),I0(t))}function _S(t,e,n){for(const r of n)r instanceof QC?(t.Ru.addReference(r.key,e),c6(t,r)):r instanceof KC?(Ue(R0,"Document no longer in limbo: "+r.key),t.Ru.removeReference(r.key,e),t.Ru.containsKey(r.key)||eT(t,r.key)):Xe(19791,{wu:r})}function c6(t,e){const n=e.key,r=n.path.canonicalString();t.du.get(n)||t.Eu.has(r)||(Ue(R0,"New document in limbo: "+n),t.Eu.add(r),I0(t))}function I0(t){for(;t.Eu.size>0&&t.du.size<t.maxConcurrentLimboResolutions;){const e=t.Eu.values().next().value;t.Eu.delete(e);const n=new We(Vt.fromString(e)),r=t.fu.next();t.Au.set(r,new ZN(n)),t.du=t.du.insert(n,r),LC(t.remoteStore,new _a($s(f0(n.path)),r,"TargetPurposeLimboResolution",Zf.ce))}}async function cd(t,e,n){const r=tt(t),i=[],o=[],l=[];r.Tu.isEmpty()||(r.Tu.forEach(((d,h)=>{l.push(r.pu(h,e,n).then((f=>{if((f||n)&&r.isPrimaryClient){const p=f?!f.fromCache:n?.targetChanges.get(h.targetId)?.current;r.sharedClientState.updateQueryState(h.targetId,p?"current":"not-current")}if(f){i.push(f);const p=v0.As(h.targetId,f);o.push(p)}})))})),await Promise.all(l),r.Pu.H_(i),await(async function(h,f){const p=tt(h);try{await p.persistence.runTransaction("notifyLocalViewChanges","readwrite",(g=>ke.forEach(f,(b=>ke.forEach(b.Es,(_=>p.persistence.referenceDelegate.addReference(g,b.targetId,_))).next((()=>ke.forEach(b.ds,(_=>p.persistence.referenceDelegate.removeReference(g,b.targetId,_)))))))))}catch(g){if(!mc(g))throw g;Ue(x0,"Failed to update sequence numbers: "+g)}for(const g of f){const b=g.targetId;if(!g.fromCache){const _=p.Ms.get(b),w=_.snapshotVersion,x=_.withLastLimboFreeSnapshotVersion(w);p.Ms=p.Ms.insert(b,x)}}})(r.localStore,o))}async function u6(t,e){const n=tt(t);if(!n.currentUser.isEqual(e)){Ue(R0,"User change. New user:",e.toKey());const r=await NC(n.localStore,e);n.currentUser=e,(function(o,l){o.mu.forEach((d=>{d.forEach((h=>{h.reject(new Le(Ie.CANCELLED,l))}))})),o.mu.clear()})(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await cd(n,r.Ls)}}function d6(t,e){const n=tt(t),r=n.Au.get(e);if(r&&r.hu)return yt().add(r.key);{let i=yt();const o=n.Iu.get(e);if(!o)return i;for(const l of o){const d=n.Tu.get(l);i=i.unionWith(d.view.nu)}return i}}function tT(t){const e=tt(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=XC.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=d6.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=a6.bind(null,e),e.Pu.H_=QN.bind(null,e.eventManager),e.Pu.yu=KN.bind(null,e.eventManager),e}function h6(t){const e=tt(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=o6.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=l6.bind(null,e),e}class Mf{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=om(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,n){return null}Mu(e,n){return null}vu(e){return gN(this.persistence,new fN,e.initialUser,this.serializer)}Cu(e){return new OC(b0.mi,this.serializer)}Du(e){return new SN}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Mf.provider={build:()=>new Mf};class f6 extends Mf{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,n){At(this.persistence.referenceDelegate instanceof Df,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new ZO(r,e.asyncQueue,n)}Cu(e){const n=this.cacheSizeBytes!==void 0?yr.withCacheSize(this.cacheSizeBytes):yr.DEFAULT;return new OC((r=>Df.mi(r,n)),this.serializer)}}class ky{async initialize(e,n){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>yS(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=u6.bind(null,this.syncEngine),await HN(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new WN})()}createDatastore(e){const n=om(e.databaseInfo.databaseId),r=(function(o){return new jN(o)})(e.databaseInfo);return(function(o,l,d,h){return new kN(o,l,d,h)})(e.authCredentials,e.appCheckCredentials,r,n)}createRemoteStore(e){return(function(r,i,o,l,d){return new ON(r,i,o,l,d)})(this.localStore,this.datastore,e.asyncQueue,(n=>yS(this.syncEngine,n,0)),(function(){return dS.v()?new dS:new EN})())}createSyncEngine(e,n){return(function(i,o,l,d,h,f,p){const g=new JN(i,o,l,d,h,f);return p&&(g.gu=!0),g})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,n)}async terminate(){await(async function(n){const r=tt(n);Ue(Oo,"RemoteStore shutting down."),r.Ea.add(5),await ld(r),r.Aa.shutdown(),r.Ra.set("Unknown")})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}ky.provider={build:()=>new ky};class nT{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):Ai("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,n){setTimeout((()=>{this.muted||e(n)}),0)}}const Na="FirestoreClient";class m6{constructor(e,n,r,i,o){this.authCredentials=e,this.appCheckCredentials=n,this.asyncQueue=r,this.databaseInfo=i,this.user=Yn.UNAUTHENTICATED,this.clientId=o0.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=o,this.authCredentials.start(r,(async l=>{Ue(Na,"Received user=",l.uid),await this.authCredentialListener(l),this.user=l})),this.appCheckCredentials.start(r,(l=>(Ue(Na,"Received new app check token=",l),this.appCheckCredentialListener(l,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new wi;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){const r=A0(n,"Failed to shutdown persistence");e.reject(r)}})),e.promise}}async function Gg(t,e){t.asyncQueue.verifyOperationInProgress(),Ue(Na,"Initializing OfflineComponentProvider");const n=t.configuration;await e.initialize(n);let r=n.initialUser;t.setCredentialChangeListener((async i=>{r.isEqual(i)||(await NC(e.localStore,i),r=i)})),e.persistence.setDatabaseDeletedListener((()=>t.terminate())),t._offlineComponents=e}async function bS(t,e){t.asyncQueue.verifyOperationInProgress();const n=await p6(t);Ue(Na,"Initializing OnlineComponentProvider"),await e.initialize(n,t.configuration),t.setCredentialChangeListener((r=>fS(e.remoteStore,r))),t.setAppCheckTokenChangeListener(((r,i)=>fS(e.remoteStore,i))),t._onlineComponents=e}async function p6(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){Ue(Na,"Using user provided OfflineComponentProvider");try{await Gg(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!(function(i){return i.name==="FirebaseError"?i.code===Ie.FAILED_PRECONDITION||i.code===Ie.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11})(n))throw n;Kl("Error using user provided cache. Falling back to memory cache: "+n),await Gg(t,new Mf)}}else Ue(Na,"Using default OfflineComponentProvider"),await Gg(t,new f6(void 0));return t._offlineComponents}async function rT(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(Ue(Na,"Using user provided OnlineComponentProvider"),await bS(t,t._uninitializedComponentsProvider._online)):(Ue(Na,"Using default OnlineComponentProvider"),await bS(t,new ky))),t._onlineComponents}function g6(t){return rT(t).then((e=>e.syncEngine))}async function sT(t){const e=await rT(t),n=e.eventManager;return n.onListen=e6.bind(null,e.syncEngine),n.onUnlisten=r6.bind(null,e.syncEngine),n.onFirstRemoteStoreListen=t6.bind(null,e.syncEngine),n.onLastRemoteStoreUnlisten=s6.bind(null,e.syncEngine),n}function y6(t,e,n={}){const r=new wi;return t.asyncQueue.enqueueAndForget((async()=>(function(o,l,d,h,f){const p=new nT({next:b=>{p.Nu(),l.enqueueAndForget((()=>GC(o,g)));const _=b.docs.has(d);!_&&b.fromCache?f.reject(new Le(Ie.UNAVAILABLE,"Failed to get document because the client is offline.")):_&&b.fromCache&&h&&h.source==="server"?f.reject(new Le(Ie.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):f.resolve(b)},error:b=>f.reject(b)}),g=new WC(f0(d.path),p,{includeMetadataChanges:!0,qa:!0});return HC(o,g)})(await sT(t),t.asyncQueue,e,n,r))),r.promise}function _6(t,e,n={}){const r=new wi;return t.asyncQueue.enqueueAndForget((async()=>(function(o,l,d,h,f){const p=new nT({next:b=>{p.Nu(),l.enqueueAndForget((()=>GC(o,g))),b.fromCache&&h.source==="server"?f.reject(new Le(Ie.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):f.resolve(b)},error:b=>f.reject(b)}),g=new WC(d,p,{includeMetadataChanges:!0,qa:!0});return HC(o,g)})(await sT(t),t.asyncQueue,e,n,r))),r.promise}function iT(t){const e={};return t.timeoutSeconds!==void 0&&(e.timeoutSeconds=t.timeoutSeconds),e}const vS=new Map;const aT="firestore.googleapis.com",xS=!0;class wS{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new Le(Ie.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=aT,this.ssl=xS}else this.host=e.host,this.ssl=e.ssl??xS;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=MC;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<YO)throw new Le(Ie.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}OM("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=iT(e.experimentalLongPollingOptions??{}),(function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new Le(Ie.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new Le(Ie.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new Le(Ie.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(r,i){return r.timeoutSeconds===i.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class um{constructor(e,n,r,i){this._authCredentials=e,this._appCheckCredentials=n,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new wS({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Le(Ie.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new Le(Ie.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new wS(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(r){if(!r)return new EM;switch(r.type){case"firstParty":return new jM(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new Le(Ie.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(n){const r=vS.get(n);r&&(Ue("ComponentProvider","Removing Datastore"),vS.delete(n),r.terminate())})(this),Promise.resolve()}}function b6(t,e,n,r={}){t=ms(t,um);const i=lc(e),o=t._getSettings(),l={...o,emulatorOptions:t._getEmulatorOptions()},d=`${e}:${n}`;i&&(K1(`https://${d}`),Y1("Firestore",!0)),o.host!==aT&&o.host!==d&&Kl("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const h={...o,host:d,ssl:i,emulatorOptions:r};if(!Ei(h,l)&&(t._setSettings(h),r.mockUserToken)){let f,p;if(typeof r.mockUserToken=="string")f=r.mockUserToken,p=Yn.MOCK_USER;else{f=kR(r.mockUserToken,t._app?.options.projectId);const g=r.mockUserToken.sub||r.mockUserToken.user_id;if(!g)throw new Le(Ie.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");p=new Yn(g)}t._authCredentials=new CM(new qE(f,p))}}class gc{constructor(e,n,r){this.converter=n,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new gc(this.firestore,e,this._query)}}class un{constructor(e,n,r){this.converter=n,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new ja(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new un(this.firestore,e,this._key)}toJSON(){return{type:un._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,n,r){if(sd(n,un._jsonSchema))return new un(e,r||null,new We(Vt.fromString(n.referencePath)))}}un._jsonSchemaVersion="firestore/documentReference/1.0",un._jsonSchema={type:xn("string",un._jsonSchemaVersion),referencePath:xn("string")};class ja extends gc{constructor(e,n,r){super(e,n,f0(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new un(this.firestore,null,new We(e))}withConverter(e){return new ja(this.firestore,e,this._path)}}function v6(t,e,...n){if(t=wn(t),HE("collection","path",e),t instanceof um){const r=Vt.fromString(e,...n);return Nw(r),new ja(t,null,r)}{if(!(t instanceof un||t instanceof ja))throw new Le(Ie.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(Vt.fromString(e,...n));return Nw(r),new ja(t.firestore,null,r)}}function yc(t,e,...n){if(t=wn(t),arguments.length===1&&(e=o0.newId()),HE("doc","path",e),t instanceof um){const r=Vt.fromString(e,...n);return Ow(r),new un(t,null,new We(r))}{if(!(t instanceof un||t instanceof ja))throw new Le(Ie.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(Vt.fromString(e,...n));return Ow(r),new un(t.firestore,t instanceof ja?t.converter:null,new We(r))}}const SS="AsyncQueue";class ES{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new BC(this,"async_queue_retry"),this._c=()=>{const r=Hg();r&&Ue(SS,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=e;const n=Hg();n&&typeof n.addEventListener=="function"&&n.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const n=Hg();n&&typeof n.removeEventListener=="function"&&n.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise((()=>{}));const n=new wi;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(e().then(n.resolve,n.reject),n.promise))).then((()=>n.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Xu.push(e),this.lc())))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!mc(e))throw e;Ue(SS,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_((()=>this.lc()))}}cc(e){const n=this.ac.then((()=>(this.rc=!0,e().catch((r=>{throw this.nc=r,this.rc=!1,Ai("INTERNAL UNHANDLED ERROR: ",CS(r)),r})).then((r=>(this.rc=!1,r))))));return this.ac=n,n}enqueueAfterDelay(e,n,r){this.uc(),this.oc.indexOf(e)>-1&&(n=0);const i=T0.createAndSchedule(this,e,n,r,(o=>this.hc(o)));return this.tc.push(i),i}uc(){this.nc&&Xe(47125,{Pc:CS(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const n of this.tc)if(n.timerId===e)return!0;return!1}Ec(e){return this.Tc().then((()=>{this.tc.sort(((n,r)=>n.targetTimeMs-r.targetTimeMs));for(const n of this.tc)if(n.skipDelay(),e!=="all"&&n.timerId===e)break;return this.Tc()}))}dc(e){this.oc.push(e)}hc(e){const n=this.tc.indexOf(e);this.tc.splice(n,1)}}function CS(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+`
`+t.stack),e}class Fo extends um{constructor(e,n,r,i){super(e,n,r,i),this.type="firestore",this._queue=new ES,this._persistenceKey=i?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new ES(e),this._firestoreClient=void 0,await e}}}function x6(t,e){const n=typeof t=="object"?t:eE(),r=typeof t=="string"?t:Ef,i=Xy(n,"firestore").getImmediate({identifier:r});if(!i._initialized){const o=IR("firestore");o&&b6(i,...o)}return i}function dm(t){if(t._terminated)throw new Le(Ie.FAILED_PRECONDITION,"The client has already been terminated.");return t._firestoreClient||w6(t),t._firestoreClient}function w6(t){const e=t._freezeSettings(),n=(function(i,o,l,d){return new HM(i,o,l,d.host,d.ssl,d.experimentalForceLongPolling,d.experimentalAutoDetectLongPolling,iT(d.experimentalLongPollingOptions),d.useFetchStreams,d.isUsingEmulator)})(t._databaseId,t._app?.options.appId||"",t._persistenceKey,e);t._componentsProvider||e.localCache?._offlineComponentProvider&&e.localCache?._onlineComponentProvider&&(t._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),t._firestoreClient=new m6(t._authCredentials,t._appCheckCredentials,t._queue,n,t._componentsProvider&&(function(i){const o=i?._online.build();return{_offline:i?._offline.build(o),_online:o}})(t._componentsProvider))}class Kr{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Kr(qn.fromBase64String(e))}catch(n){throw new Le(Ie.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+n)}}static fromUint8Array(e){return new Kr(qn.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:Kr._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(sd(e,Kr._jsonSchema))return Kr.fromBase64String(e.bytes)}}Kr._jsonSchemaVersion="firestore/bytes/1.0",Kr._jsonSchema={type:xn("string",Kr._jsonSchemaVersion),bytes:xn("string")};class ud{constructor(...e){for(let n=0;n<e.length;++n)if(e[n].length===0)throw new Le(Ie.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Vn(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class dd{constructor(e){this._methodName=e}}class Hs{constructor(e,n){if(!isFinite(e)||e<-90||e>90)throw new Le(Ie.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(n)||n<-180||n>180)throw new Le(Ie.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=e,this._long=n}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return gt(this._lat,e._lat)||gt(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Hs._jsonSchemaVersion}}static fromJSON(e){if(sd(e,Hs._jsonSchema))return new Hs(e.latitude,e.longitude)}}Hs._jsonSchemaVersion="firestore/geoPoint/1.0",Hs._jsonSchema={type:xn("string",Hs._jsonSchemaVersion),latitude:xn("number"),longitude:xn("number")};class Gs{constructor(e){this._values=(e||[]).map((n=>n))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(r,i){if(r.length!==i.length)return!1;for(let o=0;o<r.length;++o)if(r[o]!==i[o])return!1;return!0})(this._values,e._values)}toJSON(){return{type:Gs._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(sd(e,Gs._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every((n=>typeof n=="number")))return new Gs(e.vectorValues);throw new Le(Ie.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Gs._jsonSchemaVersion="firestore/vectorValue/1.0",Gs._jsonSchema={type:xn("string",Gs._jsonSchemaVersion),vectorValues:xn("object")};const S6=/^__.*__$/;class E6{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return this.fieldMask!==null?new Va(e,this.data,this.fieldMask,n,this.fieldTransforms):new ad(e,this.data,n,this.fieldTransforms)}}class oT{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return new Va(e,this.data,this.fieldMask,n,this.fieldTransforms)}}function lT(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Xe(40011,{Ac:t})}}class hm{constructor(e,n,r,i,o,l){this.settings=e,this.databaseId=n,this.serializer=r,this.ignoreUndefinedProperties=i,o===void 0&&this.Rc(),this.fieldTransforms=o||[],this.fieldMask=l||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new hm({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){const n=this.path?.child(e),r=this.Vc({path:n,fc:!1});return r.gc(e),r}yc(e){const n=this.path?.child(e),r=this.Vc({path:n,fc:!1});return r.Rc(),r}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return Of(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find((n=>e.isPrefixOf(n)))!==void 0||this.fieldTransforms.find((n=>e.isPrefixOf(n.field)))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(lT(this.Ac)&&S6.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class C6{constructor(e,n,r){this.databaseId=e,this.ignoreUndefinedProperties=n,this.serializer=r||om(e)}Cc(e,n,r,i=!1){return new hm({Ac:e,methodName:n,Dc:r,path:Vn.emptyPath(),fc:!1,bc:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function fm(t){const e=t._freezeSettings(),n=om(t._databaseId);return new C6(t._databaseId,!!e.ignoreUndefinedProperties,n)}function cT(t,e,n,r,i,o={}){const l=t.Cc(o.merge||o.mergeFields?2:0,e,n,i);M0("Data must be an object, but it was:",l,r);const d=fT(r,l);let h,f;if(o.merge)h=new Dr(l.fieldMask),f=l.fieldTransforms;else if(o.mergeFields){const p=[];for(const g of o.mergeFields){const b=My(e,g,n);if(!l.contains(b))throw new Le(Ie.INVALID_ARGUMENT,`Field '${b}' is specified in your field mask but missing from your input data.`);pT(p,b)||p.push(b)}h=new Dr(p),f=l.fieldTransforms.filter((g=>h.covers(g.field)))}else h=null,f=l.fieldTransforms;return new E6(new _r(d),h,f)}class mm extends dd{_toFieldTransform(e){if(e.Ac!==2)throw e.Ac===1?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof mm}}function uT(t,e,n){return new hm({Ac:3,Dc:e.settings.Dc,methodName:t._methodName,fc:n},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class D0 extends dd{constructor(e,n){super(e),this.vc=n}_toFieldTransform(e){const n=uT(this,e,!0),r=this.vc.map((o=>Vo(o,n))),i=new Jl(r);return new vC(e.path,i)}isEqual(e){return e instanceof D0&&Ei(this.vc,e.vc)}}class k0 extends dd{constructor(e,n){super(e),this.vc=n}_toFieldTransform(e){const n=uT(this,e,!0),r=this.vc.map((o=>Vo(o,n))),i=new ec(r);return new vC(e.path,i)}isEqual(e){return e instanceof k0&&Ei(this.vc,e.vc)}}function dT(t,e,n,r){const i=t.Cc(1,e,n);M0("Data must be an object, but it was:",i,r);const o=[],l=_r.empty();Fa(r,((h,f)=>{const p=O0(e,h,n);f=wn(f);const g=i.yc(p);if(f instanceof mm)o.push(p);else{const b=Vo(f,g);b!=null&&(o.push(p),l.set(p,b))}}));const d=new Dr(o);return new oT(l,d,i.fieldTransforms)}function hT(t,e,n,r,i,o){const l=t.Cc(1,e,n),d=[My(e,r,n)],h=[i];if(o.length%2!=0)throw new Le(Ie.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let b=0;b<o.length;b+=2)d.push(My(e,o[b])),h.push(o[b+1]);const f=[],p=_r.empty();for(let b=d.length-1;b>=0;--b)if(!pT(f,d[b])){const _=d[b];let w=h[b];w=wn(w);const x=l.yc(_);if(w instanceof mm)f.push(_);else{const S=Vo(w,x);S!=null&&(f.push(_),p.set(_,S))}}const g=new Dr(f);return new oT(p,g,l.fieldTransforms)}function T6(t,e,n,r=!1){return Vo(n,t.Cc(r?4:3,e))}function Vo(t,e){if(mT(t=wn(t)))return M0("Unsupported field value:",e,t),fT(t,e);if(t instanceof dd)return(function(r,i){if(!lT(i.Ac))throw i.Sc(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Sc(`${r._methodName}() is not currently supported inside arrays`);const o=r._toFieldTransform(i);o&&i.fieldTransforms.push(o)})(t,e),null;if(t===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return(function(r,i){const o=[];let l=0;for(const d of r){let h=Vo(d,i.wc(l));h==null&&(h={nullValue:"NULL_VALUE"}),o.push(h),l++}return{arrayValue:{values:o}}})(t,e)}return(function(r,i){if((r=wn(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return mO(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const o=Gt.fromDate(r);return{timestampValue:If(i.serializer,o)}}if(r instanceof Gt){const o=new Gt(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:If(i.serializer,o)}}if(r instanceof Hs)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Kr)return{bytesValue:TC(i.serializer,r._byteString)};if(r instanceof un){const o=i.databaseId,l=r.firestore._databaseId;if(!l.isEqual(o))throw i.Sc(`Document reference is for database ${l.projectId}/${l.database} but should be for database ${o.projectId}/${o.database}`);return{referenceValue:y0(r.firestore._databaseId||i.databaseId,r._key.path)}}if(r instanceof Gs)return(function(l,d){return{mapValue:{fields:{[eC]:{stringValue:tC},[Cf]:{arrayValue:{values:l.toArray().map((f=>{if(typeof f!="number")throw d.Sc("VectorValues must only contain numeric values.");return m0(d.serializer,f)}))}}}}}})(r,i);throw i.Sc(`Unsupported field value: ${Xf(r)}`)})(t,e)}function fT(t,e){const n={};return QE(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Fa(t,((r,i)=>{const o=Vo(i,e.mc(r));o!=null&&(n[r]=o)})),{mapValue:{fields:n}}}function mT(t){return!(typeof t!="object"||t===null||t instanceof Array||t instanceof Date||t instanceof Gt||t instanceof Hs||t instanceof Kr||t instanceof un||t instanceof dd||t instanceof Gs)}function M0(t,e,n){if(!mT(n)||!GE(n)){const r=Xf(n);throw r==="an object"?e.Sc(t+" a custom object"):e.Sc(t+" "+r)}}function My(t,e,n){if((e=wn(e))instanceof ud)return e._internalPath;if(typeof e=="string")return O0(t,e);throw Of("Field path arguments must be of type string or ",t,!1,void 0,n)}const A6=new RegExp("[~\\*/\\[\\]]");function O0(t,e,n){if(e.search(A6)>=0)throw Of(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new ud(...e.split("."))._internalPath}catch{throw Of(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function Of(t,e,n,r,i){const o=r&&!r.isEmpty(),l=i!==void 0;let d=`Function ${e}() called with invalid data`;n&&(d+=" (via `toFirestore()`)"),d+=". ";let h="";return(o||l)&&(h+=" (found",o&&(h+=` in field ${r}`),l&&(h+=` in document ${i}`),h+=")"),new Le(Ie.INVALID_ARGUMENT,d+t+h)}function pT(t,e){return t.some((n=>n.isEqual(e)))}class gT{constructor(e,n,r,i,o){this._firestore=e,this._userDataWriter=n,this._key=r,this._document=i,this._converter=o}get id(){return this._key.path.lastSegment()}get ref(){return new un(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new j6(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const n=this._document.data.field(N0("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n)}}}class j6 extends gT{data(){return super.data()}}function N0(t,e){return typeof e=="string"?O0(t,e):e instanceof ud?e._internalPath:e._delegate._internalPath}function R6(t){if(t.limitType==="L"&&t.explicitOrderBy.length===0)throw new Le(Ie.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class P0{}class I6 extends P0{}function D6(t,e,...n){let r=[];e instanceof P0&&r.push(e),r=r.concat(n),(function(o){const l=o.filter((h=>h instanceof B0)).length,d=o.filter((h=>h instanceof pm)).length;if(l>1||l>0&&d>0)throw new Le(Ie.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")})(r);for(const i of r)t=i._apply(t);return t}class pm extends I6{constructor(e,n,r){super(),this._field=e,this._op=n,this._value=r,this.type="where"}static _create(e,n,r){return new pm(e,n,r)}_apply(e){const n=this._parse(e);return yT(e._query,n),new gc(e.firestore,e.converter,wy(e._query,n))}_parse(e){const n=fm(e.firestore);return(function(o,l,d,h,f,p,g){let b;if(f.isKeyField()){if(p==="array-contains"||p==="array-contains-any")throw new Le(Ie.INVALID_ARGUMENT,`Invalid Query. You can't perform '${p}' queries on documentId().`);if(p==="in"||p==="not-in"){AS(g,p);const w=[];for(const x of g)w.push(TS(h,o,x));b={arrayValue:{values:w}}}else b=TS(h,o,g)}else p!=="in"&&p!=="not-in"&&p!=="array-contains-any"||AS(g,p),b=T6(d,l,g,p==="in"||p==="not-in");return vn.create(f,p,b)})(e._query,"where",n,e.firestore._databaseId,this._field,this._op,this._value)}}function k6(t,e,n){const r=e,i=N0("where",t);return pm._create(i,r,n)}class B0 extends P0{constructor(e,n){super(),this.type=e,this._queryConstraints=n}static _create(e,n){return new B0(e,n)}_parse(e){const n=this._queryConstraints.map((r=>r._parse(e))).filter((r=>r.getFilters().length>0));return n.length===1?n[0]:ps.create(n,this._getOperator())}_apply(e){const n=this._parse(e);return n.getFilters().length===0?e:((function(i,o){let l=i;const d=o.getFlattenedFilters();for(const h of d)yT(l,h),l=wy(l,h)})(e._query,n),new gc(e.firestore,e.converter,wy(e._query,n)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function TS(t,e,n){if(typeof(n=wn(n))=="string"){if(n==="")throw new Le(Ie.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!cC(e)&&n.indexOf("/")!==-1)throw new Le(Ie.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=e.path.child(Vt.fromString(n));if(!We.isDocumentKey(r))throw new Le(Ie.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return $w(t,new We(r))}if(n instanceof un)return $w(t,n._key);throw new Le(Ie.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Xf(n)}.`)}function AS(t,e){if(!Array.isArray(t)||t.length===0)throw new Le(Ie.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function yT(t,e){const n=(function(i,o){for(const l of i)for(const d of l.getFlattenedFilters())if(o.indexOf(d.op)>=0)return d.op;return null})(t.filters,(function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(e.op));if(n!==null)throw n===e.op?new Le(Ie.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new Le(Ie.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}class M6{convertValue(e,n="none"){switch(Ma(e)){case 0:return null;case 1:return e.booleanValue;case 2:return cn(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,n);case 5:return e.stringValue;case 6:return this.convertBytes(ka(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,n);case 11:return this.convertObject(e.mapValue,n);case 10:return this.convertVectorValue(e.mapValue);default:throw Xe(62114,{value:e})}}convertObject(e,n){return this.convertObjectMap(e.fields,n)}convertObjectMap(e,n="none"){const r={};return Fa(e,((i,o)=>{r[i]=this.convertValue(o,n)})),r}convertVectorValue(e){const n=e.fields?.[Cf].arrayValue?.values?.map((r=>cn(r.doubleValue)));return new Gs(n)}convertGeoPoint(e){return new Hs(cn(e.latitude),cn(e.longitude))}convertArray(e,n){return(e.values||[]).map((r=>this.convertValue(r,n)))}convertServerTimestamp(e,n){switch(n){case"previous":const r=em(e);return r==null?null:this.convertValue(r,n);case"estimate":return this.convertTimestamp(Uu(e));default:return null}}convertTimestamp(e){const n=Da(e);return new Gt(n.seconds,n.nanos)}convertDocumentKey(e,n){const r=Vt.fromString(e);At(kC(r),9688,{name:e});const i=new Fu(r.get(1),r.get(3)),o=new We(r.popFirst(5));return i.isEqual(n)||Ai(`Document ${o} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${n.projectId}/${n.database}) instead.`),o}}function _T(t,e,n){let r;return r=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,r}class Au{constructor(e,n){this.hasPendingWrites=e,this.fromCache=n}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class jo extends gT{constructor(e,n,r,i,o,l){super(e,n,r,i,l),this._firestore=e,this._firestoreImpl=e,this.metadata=o}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const n=new df(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(n,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,n={}){if(this._document){const r=this._document.data.field(N0("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,n.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new Le(Ie.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,n={};return n.type=jo._jsonSchemaVersion,n.bundle="",n.bundleSource="DocumentSnapshot",n.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?n:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),n.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),n)}}jo._jsonSchemaVersion="firestore/documentSnapshot/1.0",jo._jsonSchema={type:xn("string",jo._jsonSchemaVersion),bundleSource:xn("string","DocumentSnapshot"),bundleName:xn("string"),bundle:xn("string")};class df extends jo{data(e={}){return super.data(e)}}class Gl{constructor(e,n,r,i){this._firestore=e,this._userDataWriter=n,this._snapshot=i,this.metadata=new Au(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){const e=[];return this.forEach((n=>e.push(n))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,n){this._snapshot.docs.forEach((r=>{e.call(n,new df(this._firestore,this._userDataWriter,r.key,r,new Au(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const n=!!e.includeMetadataChanges;if(n&&this._snapshot.excludesMetadataChanges)throw new Le(Ie.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===n||(this._cachedChanges=(function(i,o){if(i._snapshot.oldDocs.isEmpty()){let l=0;return i._snapshot.docChanges.map((d=>{const h=new df(i._firestore,i._userDataWriter,d.doc.key,d.doc,new Au(i._snapshot.mutatedKeys.has(d.doc.key),i._snapshot.fromCache),i.query.converter);return d.doc,{type:"added",doc:h,oldIndex:-1,newIndex:l++}}))}{let l=i._snapshot.oldDocs;return i._snapshot.docChanges.filter((d=>o||d.type!==3)).map((d=>{const h=new df(i._firestore,i._userDataWriter,d.doc.key,d.doc,new Au(i._snapshot.mutatedKeys.has(d.doc.key),i._snapshot.fromCache),i.query.converter);let f=-1,p=-1;return d.type!==0&&(f=l.indexOf(d.doc.key),l=l.delete(d.doc.key)),d.type!==1&&(l=l.add(d.doc),p=l.indexOf(d.doc.key)),{type:O6(d.type),doc:h,oldIndex:f,newIndex:p}}))}})(this,n),this._cachedChangesIncludeMetadataChanges=n),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new Le(Ie.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=Gl._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=o0.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const n=[],r=[],i=[];return this.docs.forEach((o=>{o._document!==null&&(n.push(o._document),r.push(this._userDataWriter.convertObjectMap(o._document.data.value.mapValue.fields,"previous")),i.push(o.ref.path))})),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function O6(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Xe(61501,{type:t})}}function N6(t){t=ms(t,un);const e=ms(t.firestore,Fo);return y6(dm(e),t._key).then((n=>U6(e,t,n)))}Gl._jsonSchemaVersion="firestore/querySnapshot/1.0",Gl._jsonSchema={type:xn("string",Gl._jsonSchemaVersion),bundleSource:xn("string","QuerySnapshot"),bundleName:xn("string"),bundle:xn("string")};class bT extends M6{constructor(e){super(),this.firestore=e}convertBytes(e){return new Kr(e)}convertReference(e){const n=this.convertDocumentKey(e,this.firestore._databaseId);return new un(this.firestore,null,n)}}function P6(t){t=ms(t,gc);const e=ms(t.firestore,Fo),n=dm(e),r=new bT(e);return R6(t._query),_6(n,t._query).then((i=>new Gl(e,r,t,i)))}function B6(t,e,n){t=ms(t,un);const r=ms(t.firestore,Fo),i=_T(t.converter,e,n);return gm(r,[cT(fm(r),"setDoc",t._key,i,t.converter!==null,n).toMutation(t._key,vr.none())])}function z6(t,e,n,...r){t=ms(t,un);const i=ms(t.firestore,Fo),o=fm(i);let l;return l=typeof(e=wn(e))=="string"||e instanceof ud?hT(o,"updateDoc",t._key,e,n,r):dT(o,"updateDoc",t._key,e),gm(i,[l.toMutation(t._key,vr.exists(!0))])}function L6(t){return gm(ms(t.firestore,Fo),[new im(t._key,vr.none())])}function gm(t,e){return(function(r,i){const o=new wi;return r.asyncQueue.enqueueAndForget((async()=>i6(await g6(r),i,o))),o.promise})(dm(t),e)}function U6(t,e,n){const r=n.docs.get(e._key),i=new bT(t);return new jo(t,i,e._key,r,new Au(n.hasPendingWrites,n.fromCache),e.converter)}class F6{constructor(e,n){this._firestore=e,this._commitHandler=n,this._mutations=[],this._committed=!1,this._dataReader=fm(e)}set(e,n,r){this._verifyNotCommitted();const i=Wg(e,this._firestore),o=_T(i.converter,n,r),l=cT(this._dataReader,"WriteBatch.set",i._key,o,i.converter!==null,r);return this._mutations.push(l.toMutation(i._key,vr.none())),this}update(e,n,r,...i){this._verifyNotCommitted();const o=Wg(e,this._firestore);let l;return l=typeof(n=wn(n))=="string"||n instanceof ud?hT(this._dataReader,"WriteBatch.update",o._key,n,r,i):dT(this._dataReader,"WriteBatch.update",o._key,n),this._mutations.push(l.toMutation(o._key,vr.exists(!0))),this}delete(e){this._verifyNotCommitted();const n=Wg(e,this._firestore);return this._mutations=this._mutations.concat(new im(n._key,vr.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new Le(Ie.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Wg(t,e){if((t=wn(t)).firestore!==e)throw new Le(Ie.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}function $u(...t){return new D0("arrayUnion",t)}function jS(...t){return new k0("arrayRemove",t)}function vT(t){return dm(t=ms(t,Fo)),new F6(t,(e=>gm(t,e)))}(function(e,n=!0){(function(i){hc=i})(cc),Wl(new Do("firestore",((r,{instanceIdentifier:i,options:o})=>{const l=r.getProvider("app").getImmediate(),d=new Fo(new TM(r.getProvider("auth-internal")),new RM(l,r.getProvider("app-check-internal")),(function(f,p){if(!Object.prototype.hasOwnProperty.apply(f.options,["projectId"]))throw new Le(Ie.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Fu(f.options.projectId,p)})(l,i),l);return o={useFetchStreams:n,...o},d._setSettings(o),d}),"PUBLIC").setMultipleInstances(!0)),Ca(Iw,Dw,e),Ca(Iw,Dw,"esm2020")})();function $o(){return x6(PE)}const Kt={showGroupTotals:!1};function qo(t,e,n,r=1,i,o){let l=e;if(e.startsWith("budgets/"))l="budgets";else if(e.startsWith("months/")){const p=e.replace("months/","").split("_");if(p.length>=2){const g=p[p.length-1];l=`months/${p[p.length-2]}/${g}`}}console.log(`[Firebase] ${t}(${r}): ${l}${i===!1?" [NOT FOUND]":""}`)}async function Lt(t,e,n){const r=yc($o(),t,e),i=`${t}/${e}`,o=await N6(r),l=o.exists(),d=l?o.data():null;return qo("READ",i,n,1,l),{exists:l,data:d,ref:r}}async function Zn(t,e,n){const r=$o(),i=v6(r,t);let o;if(n&&n.length>0){const f=n.map(p=>k6(p.field,p.op,p.value));o=D6(i,...f)}else o=i;const l=await P6(o),d=l.docs.map(f=>({id:f.id,data:f.data()}));let h=t;if(n&&n.length>0){const f=n.map(p=>`${p.field} ${p.op} ${JSON.stringify(p.value)}`).join(", ");h+=` WHERE ${f}`}return qo("QUERY",h,e,l.docs.length,void 0),{docs:d}}async function cr(t,e,n,r,i){const o=yc($o(),t,e),l=`${t}/${e}`;return qo("WRITE",l,r,1,void 0),B6(o,n,i??{})}async function z0(t,e){const r=$o();for(let i=0;i<t.length;i+=500){const o=t.slice(i,i+500),l=vT(r);for(const{collectionPath:d,docId:h,data:f}of o){const p=yc(r,d,h);l.set(p,f)}qo("BATCH_WRITE",`${o.length} docs`,e,o.length,void 0);try{await l.commit()}catch(d){throw console.error(`[Firebase] BATCH_WRITE ERROR in ${e}:`,d),console.error("[Firebase] Failed batch details:",{batchIndex:Math.floor(i/500)+1,totalBatches:Math.ceil(t.length/500),docsInBatch:o.length,firstDoc:o[0]?`${o[0].collectionPath}/${o[0].docId}`:"none"}),d}}}async function qu(t,e,n,r){const i=yc($o(),t,e),o=`${t}/${e}`;return qo("UPDATE",o,r,1,void 0),z6(i,n)}async function Oy(t,e,n){const r=yc($o(),t,e),i=`${t}/${e}`;return qo("DELETE",i),L6(r)}async function xT(t,e,n){const i=$o();for(let o=0;o<t.length;o+=500){const l=t.slice(o,o+500),d=vT(i);for(const{collectionPath:h,docId:f}of l){const p=yc(i,h,f);d.delete(p)}qo("BATCH_DELETE",`${l.length} docs`,e,l.length),await d.commit(),n?.(o+l.length)}}const Eo={mobile:640,tablet:768,wide:1200},V6=Eo.mobile,Nf=["January","February","March","April","May","June","July","August","September","October","November","December"],Ws=3,L0=3,en="ungrouped_accounts",Jt="ungrouped_categories";function $6(t={}){const e={};return Object.entries(t).forEach(([n,r])=>{e[n]={nickname:r.nickname??"",description:r.description??"",balance:r.balance??0,account_group_id:r.account_group_id??en,sort_order:r.sort_order??0,is_income_account:r.is_income_account??!1,is_income_default:r.is_income_default??!1,is_outgo_account:r.is_outgo_account??!1,is_outgo_default:r.is_outgo_default??!1,on_budget:r.on_budget??!0,is_active:r.is_active??!0}}),e}function q6(t={}){const e={};return Object.entries(t).forEach(([n,r])=>{e[n]={name:r.name,sort_order:r.sort_order??0,expected_balance:r.expected_balance??"positive",on_budget:r.on_budget!==void 0?r.on_budget:null,is_active:r.is_active!==void 0?r.is_active:null}}),e[en]||(e[en]={name:"Ungrouped",sort_order:0,expected_balance:"positive",on_budget:null,is_active:null}),e}function H6(t={}){const e={};return Object.entries(t).forEach(([n,r])=>{e[n]={name:r.name,description:r.description,category_group_id:r.category_group_id??Jt,sort_order:r.sort_order??0,default_monthly_amount:r.default_monthly_amount,default_monthly_type:r.default_monthly_type,balance:r.balance??0,is_hidden:r.is_hidden??!1}}),e}function G6(t=[]){const e=t.map(r=>({id:r.id,name:r.name,sort_order:r.sort_order??0}));if(!e.some(r=>r.id===Jt)){const r=e.length>0?Math.max(...e.map(i=>i.sort_order)):-1;e.push({id:Jt,name:"Uncategorized",sort_order:r+1})}return e.sort((r,i)=>r.sort_order-i.sort_order),e}function W6(t={}){const e={};return Object.keys(t).forEach(n=>{e[n]={}}),e}async function U0(t){const{exists:e,data:n}=await Lt("budgets",t,"loading budget data (cache miss or stale)");if(!e||!n)throw new Error(`Budget ${t} not found`);const r=$6(n.accounts),i=q6(n.account_groups),o=H6(n.categories),l=G6(n.category_groups),d=W6(n.month_map);return{budget:{id:t,name:n.name,user_ids:n.user_ids||[],accepted_user_ids:n.accepted_user_ids||[],owner_id:n.owner_id||n.user_ids?.[0]||"",owner_email:n.owner_email||"",accounts:r,account_groups:i,categories:o,category_groups:l,month_map:d},accounts:r,accountGroups:i,categories:o,categoryGroups:l,monthMap:d}}function Q6(t,e){const{initialDataLoadComplete:n}=Ze(),r=!!t&&e?.enabled!==!1&&n;return Bo({queryKey:t?Ce.budget(t):["budget","none"],queryFn:()=>U0(t),enabled:r,staleTime:hs})}function No(t,e,n){const r=n.toString().padStart(2,"0");return`${t}_${e}_${r}`}function Ho(t,e){return e===1?{year:t-1,month:12}:{year:t,month:e-1}}function Hu(t,e){return e===12?{year:t+1,month:1}:{year:t,month:e+1}}function qe(t,e){return`${t}${e.toString().padStart(2,"0")}`}function Ny(t){return new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit"})}function ym(t,e){const n=new Date,r=n.getFullYear(),i=n.getMonth()+1;if(t===r&&e===i){const o=n.getDate();return`${r}-${String(i).padStart(2,"0")}-${String(o).padStart(2,"0")}`}return`${t}-${String(e).padStart(2,"0")}-01`}function _m(t){const[e,n]=t.split("-").map(Number);return{year:e,month:n}}function Ae(t){return Math.round((t+Number.EPSILON)*100)/100}function ht(t){if(t==null||isNaN(t))return!1;const e=t*100;return Math.abs(e-Math.round(e))>1e-9}function Pa(t){if(t==null)return t;if(Array.isArray(t))return t.map(e=>Pa(e));if(typeof t=="object"){const e={};for(const[n,r]of Object.entries(t))r!==void 0&&(e[n]=Pa(r));return e}return t}const Yt="__NO_CATEGORY__",Po="No Category";function ot(t){return t===Yt}const Ht="__NO_ACCOUNT__",Ba="No Account";function Ke(t){return t===Ht}function wT(t,e){return Ae(e.filter(n=>n.category_id===t).reduce((n,r)=>n+r.amount,0))}function ST(t,e){let n=0;for(const r of e)r.from_category_id===t&&!ot(r.from_category_id)&&(n-=r.amount),r.to_category_id===t&&!ot(r.to_category_id)&&(n+=r.amount);return Ae(n)}function ET(t,e){return Ae(e.filter(n=>n.category_id===t&&!ot(n.category_id)).reduce((n,r)=>n+r.amount,0))}function CT(t,e,n){const r={},i={},o={};for(const l of t)ot(l.category_id)||(r[l.category_id]=(r[l.category_id]||0)+l.amount);for(const l of e)ot(l.from_category_id)||(i[l.from_category_id]=(i[l.from_category_id]||0)-l.amount),ot(l.to_category_id)||(i[l.to_category_id]=(i[l.to_category_id]||0)+l.amount);for(const l of n)ot(l.category_id)||(o[l.category_id]=(o[l.category_id]||0)+l.amount);for(const l of Object.keys(r))r[l]=Ae(r[l]);for(const l of Object.keys(i))i[l]=Ae(i[l]);for(const l of Object.keys(o))o[l]=Ae(o[l]);return{spentMap:r,transfersMap:i,adjustmentsMap:o}}function TT(t,e,n,r){const i=wT(t.category_id,e),o=ST(t.category_id,n),l=ET(t.category_id,r),d=Ae(t.start_balance+t.allocated+i+o+l);return{...t,spent:i,transfers:o,adjustments:l,end_balance:d}}function AT(t,e,n,r){return t.map(i=>TT(i,e,n,r))}const K6=Object.freeze(Object.defineProperty({__proto__:null,calculateCategoryBalance:TT,calculateCategoryBalances:AT},Symbol.toStringTag,{value:"Module"}));function Y6(t,e){return Ae(e.filter(n=>n.account_id===t).reduce((n,r)=>n+r.amount,0))}function X6(t,e){return Ae(e.filter(n=>n.account_id===t).reduce((n,r)=>n+r.amount,0))}function Z6(t,e){let n=0;for(const r of e)r.from_account_id===t&&!Ke(r.from_account_id)&&(n-=r.amount),r.to_account_id===t&&!Ke(r.to_account_id)&&(n+=r.amount);return Ae(n)}function J6(t,e){return Ae(e.filter(n=>n.account_id===t&&!Ke(n.account_id)).reduce((n,r)=>n+r.amount,0))}function e4(t,e,n,r,i){const o=Y6(t.account_id,e),l=X6(t.account_id,n),d=Z6(t.account_id,r),h=J6(t.account_id,i),f=Ae(o+l+d+h),p=Ae(t.start_balance+f);return{...t,income:o,expenses:l,transfers:d,adjustments:h,net_change:f,end_balance:p}}function t4(t,e,n,r,i){return t.map(o=>e4(o,e,n,r,i))}function hd(){const t=new Date,e=t.getFullYear(),n=t.getMonth()+1;let r=e,i=n-L0;for(;i<1;)i+=12,r-=1;return{year:r,month:i}}function bm(t,e){const n=hd(),r=qe(t,e),i=qe(n.year,n.month);return r<=i}function n4(t,e,n,r){if("spent"in t&&"transfers"in t&&"adjustments"in t&&"end_balance"in t)return t;const[i]=AT([t],e,n,r);return i}function r4(t,e,n,r,i){if("income"in t&&"expenses"in t&&"transfers"in t&&"adjustments"in t&&"net_change"in t&&"end_balance"in t)return t;const[o]=t4([t],e,n,r,i);return o}function s4(t,e,n){const r=bm(e,n);return{category_id:t.category_id,start_balance:r?Ae(t.start_balance):0,allocated:Ae(t.allocated)}}function i4(t,e,n){const r=bm(e,n);return{account_id:t.account_id,start_balance:r?Ae(t.start_balance):0}}function fd(t){const e=t.category_balances.map(r=>n4(r,t.expenses,t.transfers,t.adjustments)),n=t.account_balances.map(r=>r4(r,t.income,t.expenses,t.transfers,t.adjustments));return{...t,category_balances:e,account_balances:n}}function md(t){const e=t.category_balances.map(d=>s4(d,t.year,t.month)),n=t.account_balances.map(d=>i4(d,t.year,t.month)),{total_income:r,total_expenses:i,previous_month_income:o,...l}=t;return{...l,category_balances:e,account_balances:n}}const a4="modulepreload",o4=function(t){return"/"+t},RS={},Ra=function(e,n,r){let i=Promise.resolve();if(n&&n.length>0){let f=function(p){return Promise.all(p.map(g=>Promise.resolve(g).then(b=>({status:"fulfilled",value:b}),b=>({status:"rejected",reason:b}))))};var l=f;document.getElementsByTagName("link");const d=document.querySelector("meta[property=csp-nonce]"),h=d?.nonce||d?.getAttribute("nonce");i=f(n.map(p=>{if(p=o4(p),p in RS)return;RS[p]=!0;const g=p.endsWith(".css"),b=g?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${p}"]${b}`))return;const _=document.createElement("link");if(_.rel=g?"stylesheet":a4,g||(_.as="script"),_.crossOrigin="",_.href=p,h&&_.setAttribute("nonce",h),document.head.appendChild(_),g)return new Promise((w,x)=>{_.addEventListener("load",w),_.addEventListener("error",()=>x(new Error(`Unable to preload CSS for ${p}`)))})}))}function o(d){const h=new Event("vite:preloadError",{cancelable:!0});if(h.payload=d,window.dispatchEvent(h),!h.defaultPrevented)throw d}return i.then(d=>{for(const h of d||[])h.status==="rejected"&&o(h.reason);return e().catch(o)})};async function jT(t,e,n,r){const{year:i,month:o}=Ho(e,n),l=Ce.month(t,i,o);if(r){const d=r.getQueryData(l);if(d?.month){const h=d.month.income||[];return Ae(h.reduce((f,p)=>f+(p.amount||0),0))}}if(r)try{const{readMonth:d}=await Ra(async()=>{const{readMonth:f}=await Promise.resolve().then(()=>c4);return{readMonth:f}},[]),h=await d(t,i,o,{description:`calculating previous_month_income for ${e}/${n}`});if(h){const f=h.income||[];return Ae(f.reduce((p,g)=>p+(g.amount||0),0))}}catch(d){console.warn(`[calculatePreviousMonthIncome] Could not fetch previous month ${i}/${o}:`,d)}return 0}async function l4(t,e,n,r,i){const o=t.income||[],l=t.expenses||[],d=o.reduce((g,b)=>g+(b.amount||0),0),h=l.reduce((g,b)=>g+(b.amount||0),0),f=t.previous_month_income!==void 0?t.previous_month_income:await jT(e,n,r,i),p={budget_id:e,year_month_ordinal:t.year_month_ordinal??qe(n,r),year:t.year??n,month:t.month??r,income:o,total_income:d,previous_month_income:f,expenses:l,total_expenses:h,transfers:t.transfers||[],adjustments:t.adjustments||[],account_balances:t.account_balances||[],category_balances:t.category_balances||[],are_allocations_finalized:t.are_allocations_finalized??!1,created_at:t.created_at,updated_at:t.updated_at};return fd(p)}async function nr(t,e,n,r){const i=No(t,e,n);return(await Pe.fetchQuery({queryKey:Ce.month(t,e,n),queryFn:async()=>{const{exists:l,data:d}=await Lt("months",i,r?.description??`reading month ${e}/${n}`);return!l||!d?null:{month:await l4(d,t,e,n,Pe)}},staleTime:hs}))?.month??null}const c4=Object.freeze(Object.defineProperty({__proto__:null,readMonth:nr},Symbol.toStringTag,{value:"Module"}));function RT(t){const e={},n={};return t.category_balances&&t.category_balances.forEach(r=>{e[r.category_id]=r.end_balance}),t.account_balances&&t.account_balances.forEach(r=>{n[r.account_id]=r.end_balance}),{categoryEndBalances:e,accountEndBalances:n}}function IT(){const t=new Date,e=t.getFullYear(),n=t.getMonth()+1,r=[];for(let i=L0;i>0;i--){let o=e,l=n-i;for(;l<1;)l+=12,o-=1;r.push(qe(o,l))}r.push(qe(e,n));for(let i=1;i<=Ws;i++){let o=e,l=n+i;for(;l>12;)l-=12,o+=1;r.push(qe(o,l))}return r}function u4(t,e){const n=Ce.budget(t),r=Pe.getQueryData(n);if(!r?.monthMap||!(e in r.monthMap))return!1;const i=IT();for(const o of i)if(o>=e&&!(o in r.monthMap))return!1;return!0}function d4(t,e,n){const r=Ce.budget(t),i=Pe.getQueryData(r);i&&Pe.setQueryData(r,{...i,monthMap:n,budget:{...i.budget,month_map:n}})}function h4(t,e,n){const r=Ce.budget(t),i=Pe.getQueryData(r);i&&Pe.setQueryData(r,{...i,monthMap:e,budget:{...i.budget,month_map:e}})}function f4(t,e){const n=Ce.budget(t),r=Pe.getQueryData(n);r&&Pe.setQueryData(n,{...r,monthMap:e,budget:{...r.budget,month_map:e}})}function m4(t,e,n,r){const i=qe(e,n),o=Ce.budget(t),l=Pe.getQueryData(o);if(!l)return console.warn(`[removeMonthFromMap] Budget ${t} not found in cache`),{};const d=l.monthMap||{},{[i]:h,...f}=d;return Pe.setQueryData(o,{...l,monthMap:f,budget:{...l.budget,month_map:f}}),r&&r({type:"budget",budgetId:t}),f}async function p4(t,e,n,r){const{bypassDateLimit:i=!1}={},o=new Date,l=o.getFullYear(),d=o.getMonth()+1,h=(e-l)*12+(n-d);if(!i&&h>Ws){const M=`[createMonth] Refusing to create month ${e}/${n} - it's ${h} months in the future (max allowed: ${Ws}). This likely indicates a bug in month navigation.`;throw console.error(M),new Error(M)}const{exists:f,data:p}=await Lt("budgets",t,"validating budget exists before creating month");if(!f||!p){Pe.removeQueries({queryKey:Ce.budget(t)});const M=`[createMonth] Budget ${t} does not exist. It may have been deleted. Please refresh the page.`;throw console.error(M),new Error(M)}const g=o.toISOString(),b=No(t,e,n);let _=0,w={},x={};if(n>1||e>new Date().getFullYear()-10){const{year:M,month:B}=Ho(e,n),U=No(t,M,B),q=Ce.month(t,M,B),I=Pe.getQueryData(q);let N=null;if(I?.month){const O=I.month;N={budget_id:O.budget_id,year_month_ordinal:O.year_month_ordinal,year:O.year,month:O.month,income:O.income,expenses:O.expenses,transfers:O.transfers,adjustments:O.adjustments,account_balances:O.account_balances,category_balances:O.category_balances,are_allocations_finalized:O.are_allocations_finalized,created_at:O.created_at,updated_at:O.updated_at}}else try{const{exists:O,data:J}=await Lt("months",U,"fetching previous month to create start balances for new month");O&&(N=J)}catch(O){if(O instanceof Error&&O.message.includes("Missing or insufficient permissions"))console.warn(`[createMonth] Permission error reading previous month ${M}/${B}, starting with zero balances`);else throw O}if(N){const O={year_month_ordinal:N.year_month_ordinal??qe(M,B),year:N.year??M,month:N.month??B,income:N.income||[],total_income:N.total_income??0,previous_month_income:N.previous_month_income??0,expenses:N.expenses||[],total_expenses:N.total_expenses??0,transfers:N.transfers||[],adjustments:N.adjustments||[],account_balances:N.account_balances||[],category_balances:N.category_balances||[],are_allocations_finalized:N.are_allocations_finalized??!1,created_at:N.created_at,updated_at:N.updated_at};_=O.total_income;const{categoryEndBalances:J,accountEndBalances:Y}=RT(O);w=J,x=Y}}const S=bm(e,n),C=Object.entries(w).map(([M,B])=>({category_id:M,start_balance:S?B:0,allocated:0,spent:0,transfers:0,adjustments:0,end_balance:B})),T=Object.entries(x).map(([M,B])=>({account_id:M,start_balance:S?B:0,income:0,expenses:0,transfers:0,adjustments:0,net_change:0,end_balance:B})),R={budget_id:t,year_month_ordinal:qe(e,n),year:e,month:n,income:[],total_income:0,previous_month_income:_,expenses:[],total_expenses:0,transfers:[],adjustments:[],account_balances:T,category_balances:C,are_allocations_finalized:!1,created_at:g,updated_at:g},D={budget_id:t,year_month_ordinal:qe(e,n),year:e,month:n,income:[],expenses:[],transfers:[],adjustments:[],account_balances:T,category_balances:C,are_allocations_finalized:!1,created_at:g,updated_at:g};await cr("months",b,D,"creating new month document (first time viewing this month)"),Pe.setQueryData(Ce.month(t,e,n),{month:R});const V=qe(e,n),k={...p.month_map||{},[V]:{}};return h4(t,k),await qu("budgets",t,{month_map:k,updated_at:g},`adding month ${e}/${n} to budget month_map`),R}async function g4(t,e,n,r,i){const o=t.income||[],l=t.expenses||[],d=o.reduce((g,b)=>g+(b.amount||0),0),h=l.reduce((g,b)=>g+(b.amount||0),0),f=t.previous_month_income!==void 0?t.previous_month_income:await jT(e,n,r,i),p={budget_id:e,year_month_ordinal:t.year_month_ordinal??qe(n,r),year:t.year??n,month:t.month??r,income:o,total_income:d,previous_month_income:f,expenses:l,total_expenses:h,transfers:t.transfers||[],adjustments:t.adjustments||[],account_balances:t.account_balances||[],category_balances:t.category_balances||[],are_allocations_finalized:t.are_allocations_finalized??!1,created_at:t.created_at,updated_at:t.updated_at};return fd(p)}async function vm(t,e,n){const r=No(t,e,n);try{const{exists:i,data:o}=await Lt("months",r,`loading month ${e}/${n}`);return!i||!o?null:await g4(o,t,e,n)}catch(i){if(i instanceof Error&&i.message.includes("Missing or insufficient permissions"))return console.warn(`[readMonthDirect] Permission error reading month ${e}/${n}, treating as not found`),null;throw i}}async function DT(t,e,n,r){if(r){const l=Ce.month(t,e,n),d=r.getQueryData(l);if(d?.month)return d.month}const i=await vm(t,e,n);if(i)return i;let o=!1;if(r){const l=r.getQueryData(Ce.budget(t));l?.monthMap&&(o=qe(e,n)in l.monthMap)}else{const{exists:l,data:d}=await Lt("budgets",t,"checking month_map before creating month");if(l&&d?.month_map){const h=qe(e,n),f=d.month_map;o=h in f}}if(o)return p4(t,e,n);throw new Error(`Month ${e}/${n} does not exist in budget. Cannot create months that are not in month_map.`)}function kT(t,e,n,r){const i=Ut(),{initialDataLoadComplete:o}=Ze(),l=t?Ce.month(t,e,n):["month","none"],d=!!t&&r?.enabled!==!1&&o;return Bo({queryKey:l,queryFn:async()=>({month:await DT(t,e,n,i)}),enabled:d,staleTime:hs})}const IS=Object.freeze(Object.defineProperty({__proto__:null,fetchMonth:DT,getEndBalancesFromMonth:RT,readMonth:nr,readMonthDirect:vm,useMonthQuery:kT},Symbol.toStringTag,{value:"Module"}));async function F0(t){const{exists:e,data:n}=await Lt("payees",t,"loading payees for autocomplete (cache miss or stale)");return e&&n?n.payees||[]:[]}function V0(t,e){const{initialDataLoadComplete:n}=Ze(),r=!!t&&e?.enabled!==!1&&n;return Bo({queryKey:t?Ce.payees(t):["payees","none"],queryFn:()=>F0(t),enabled:r,staleTime:hs})}async function y4(t,e){const{exists:n,data:r}=await Lt("users",t,"loading user profile (cache miss or stale)");if(n&&r)return r;const i={uid:t,email:e,budget_ids:[],created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return await cr("users",t,i,"creating new user document (first login)"),i}function MT(t,e,n){return Bo({queryKey:t?Ce.user(t):["user","none"],queryFn:()=>y4(t,e),enabled:!!t&&n?.enabled!==!1})}async function _4(t,e){const n=await Zn("budgets","loading budgets user has access to (cache miss or stale)",[{field:"user_ids",op:"array-contains",value:t}]),r=[],i=[];for(const o of n.docs){const l=o.data;l.accepted_user_ids?.includes(t)||e?.budget_ids?.includes(o.id)?r.push({id:o.id,name:l.name||"Unnamed Budget",ownerEmail:l.owner_email||null,isOwner:l.owner_id===t,isPending:!1}):i.push({budgetId:o.id,budgetName:l.name||"Unnamed Budget",ownerEmail:l.owner_email||null})}return{budgets:r,pendingInvites:i}}function b4(t,e,n){return Bo({queryKey:t?Ce.accessibleBudgets(t):["accessibleBudgets","none"],queryFn:async()=>t?_4(t,e):{budgets:[],pendingInvites:[]},enabled:!!t&&n?.enabled!==!1,staleTime:60*1e3})}function v4(t){if(Array.isArray(t))return t;if(t&&typeof t=="object"&&!Array.isArray(t)){const e=t;if(e._methodName==="arrayUnion"&&Array.isArray(e.vc))return console.warn("[fetchFeedback] Found corrupted arrayUnion in feedback document - extracting items from vc"),e.vc}return[]}async function x4(){const t=await Zn("feedback","admin loading all feedback (cache miss or stale)"),e=[];for(const n of t.docs){const r=v4(n.data.items),i=n.data.user_email||n.id;r.forEach(o=>{e.push({...o,doc_id:n.id,user_email:i})})}return{items:e}}function w4(t){return Bo({queryKey:Ce.feedback(),queryFn:x4,enabled:t?.enabled!==!1})}const xm={categoryEndBalances:{},accountEndBalances:{},totalIncome:0};function Gu(t,e){const n=t.income||[],r=t.expenses||[],i=Ae(n.reduce((g,b)=>g+b.amount,0)),o=Ae(r.reduce((g,b)=>g+b.amount,0)),{spentMap:l,transfersMap:d,adjustmentsMap:h}=CT(r,t.transfers||[],t.adjustments||[]),f=S4(t.category_balances,e.categoryEndBalances,d,h,l),p=E4(t,e.accountEndBalances);return{...t,total_income:i,total_expenses:o,previous_month_income:e.totalIncome,category_balances:f,account_balances:p,updated_at:new Date().toISOString()}}function S4(t,e,n,r,i){const o=new Map;for(const h of t)ot(h.category_id)||o.set(h.category_id,h);const l=new Set;for(const h of t)ot(h.category_id)||l.add(h.category_id);for(const h of Object.keys(e))ot(h)||l.add(h);for(const h of Object.keys(n))ot(h)||l.add(h);for(const h of Object.keys(r))ot(h)||l.add(h);const d=[];for(const h of l){const f=o.get(h),p=Ae(e[h]??0),g=Ae(f?.allocated??0),b=Ae(i[h]??0),_=Ae(n[h]??0),w=Ae(r[h]??0);d.push({category_id:h,start_balance:p,allocated:g,spent:b,transfers:_,adjustments:w,end_balance:Ae(p+g+b+_+w)})}return d}function E4(t,e){const n=new Set;for(const i of t.income||[])Ke(i.account_id)||n.add(i.account_id);for(const i of t.expenses||[])Ke(i.account_id)||n.add(i.account_id);for(const i of t.transfers||[])Ke(i.from_account_id)||n.add(i.from_account_id),Ke(i.to_account_id)||n.add(i.to_account_id);for(const i of t.adjustments||[])Ke(i.account_id)||n.add(i.account_id);for(const i of Object.keys(e))Ke(i)||n.add(i);for(const i of t.account_balances||[])Ke(i.account_id)||n.add(i.account_id);const r=[];for(const i of n){const o=Ae(e[i]??0),l=Ae((t.income||[]).filter(_=>_.account_id===i).reduce((_,w)=>_+w.amount,0)),d=Ae((t.expenses||[]).filter(_=>_.account_id===i).reduce((_,w)=>_+w.amount,0)),h=Ae((t.transfers||[]).filter(_=>_.from_account_id===i).reduce((_,w)=>_-w.amount,0)),f=Ae((t.transfers||[]).filter(_=>_.to_account_id===i).reduce((_,w)=>_+w.amount,0)),p=Ae(f+h),g=Ae((t.adjustments||[]).filter(_=>_.account_id===i).reduce((_,w)=>_+w.amount,0)),b=Ae(l+d+p+g);r.push({account_id:i,start_balance:o,income:l,expenses:d,transfers:p,adjustments:g,net_change:b,end_balance:Ae(o+b)})}return r}function rc(t){const e={},n={};for(const r of t.category_balances||[])ot(r.category_id)||(e[r.category_id]=Ae(r.end_balance));for(const r of t.account_balances||[])Ke(r.account_id)||(n[r.account_id]=Ae(r.end_balance));return{categoryEndBalances:e,accountEndBalances:n,totalIncome:Ae(t.total_income)}}async function C4(t,e){return Pe.fetchQuery({queryKey:["budgetInvite",t,e],queryFn:async()=>{const{exists:n,data:r}=await Lt("budgets",t,"checking if user has pending invite for budget");return!n||!r?null:{isInvited:r.user_ids?.includes(e)??!1,hasAccepted:r.accepted_user_ids?.includes(e)??!1,budgetName:r.name||"Unnamed Budget",ownerEmail:r.owner_email||null}},staleTime:60*1e3})}async function Py(t,e,n){const r=await nr(t,e,n,{description:`fetching month for balance calculation (walking ${e}/${n})`});return r?{year:r.year,month:r.month,category_balances:r.category_balances,are_allocations_finalized:r.are_allocations_finalized,expenses:r.expenses}:null}async function T4(t,e,n,r){const i={};e.forEach(b=>{i[b]=0});const o=await Py(t,n,r);if(o?.category_balances){for(const b of o.category_balances)e.includes(b.category_id)&&(i[b.category_id]=b.end_balance);return i}const l={};e.forEach(b=>{l[b]=0});const d=[];o&&d.push(o);let h=n,f=r,p=!1;const g=120;for(let b=0;b<g&&!p;b++){const _=Ho(h,f);h=_.year,f=_.month;const w=await Py(t,h,f);if(!w)p=!0;else if(w.category_balances){p=!0;for(const x of w.category_balances)e.includes(x.category_id)&&(l[x.category_id]=x.end_balance)}else d.push(w)}d.reverse(),Object.assign(i,l);for(const b of d){if(b.are_allocations_finalized&&b.category_balances)for(const _ of b.category_balances)e.includes(_.category_id)&&(i[_.category_id]=(i[_.category_id]||0)+_.allocated);if(b.expenses)for(const _ of b.expenses)e.includes(_.category_id)&&(i[_.category_id]=(i[_.category_id]||0)-_.amount)}return i}async function OT(t,e,n,r,i){const o={...n},d=Pe.getQueryData(Ce.budget(t))?.monthMap||{},h=new Date,f=h.getFullYear(),p=h.getMonth()+1;let g=f,b=p+Ws;for(;b>12;)b-=12,g+=1;const _=qe(g,b);let w=r,x=i;const S=Ws*2;for(let C=0;C<S;C++){const T=Hu(w,x);w=T.year,x=T.month;const R=qe(w,x);if(R>_||!(R in d))break;const D=await Py(t,w,x);if(!D)break;if(D.are_allocations_finalized&&D.category_balances)for(const V of D.category_balances)e.includes(V.category_id)&&(o[V.category_id]=(o[V.category_id]||0)+V.allocated);if(D.expenses)for(const V of D.expenses)e.includes(V.category_id)&&(o[V.category_id]=(o[V.category_id]||0)-V.amount)}return o}async function DS(t,e,n,r){const i=await T4(t,e,n,r),o=await OT(t,e,i,n,r);return{current:i,total:o}}function $0(t,e){const n=t.account_group_id?e[t.account_group_id]:void 0,r=n&&n.on_budget!==null?n.on_budget:t.on_budget!==!1,i=n&&n.is_active!==null?n.is_active:t.is_active!==!1;return r&&i}function NT(t,e,n){const r=Object.entries(t).reduce((o,[,l])=>$0(l,n)?o+(l.balance??0):o,0),i=Object.values(e).reduce((o,l)=>{const d=l.balance??0;return o+(d>0?d:0)},0);return Ae(r-i)}const A4=Object.freeze(Object.defineProperty({__proto__:null,calculateTotalAvailable:NT,isAccountOnBudget:$0},Symbol.toStringTag,{value:"Module"}));function j4(t={}){const e={};return Object.keys(t).forEach(n=>{e[n]={}}),e}async function R4(t,e,n,r){const i=Pe.getQueryData(Ce.budget(t));let o=null;if(i?.budget)o=i.budget;else{const{exists:g,data:b}=await Lt("budgets",t,"[recalc] reading budget for cache update");if(!g||!b)return;o=b}if(!o)return;const l={...o.accounts};for(const[g,b]of Object.entries(e))l[g]&&(l[g]={...l[g],balance:Ae(b)});const d={...o.categories};for(const[g,b]of Object.entries(n))d[g]&&(d[g]={...d[g],balance:Ae(b)});const{calculateTotalAvailable:h}=await Ra(async()=>{const{calculateTotalAvailable:g}=await Promise.resolve().then(()=>A4);return{calculateTotalAvailable:g}},void 0),f=h(l,d,o.account_groups||{}),{writeBudgetData:p}=await Ra(async()=>{const{writeBudgetData:g}=await Promise.resolve().then(()=>KT);return{writeBudgetData:g}},void 0);await p({budgetId:t,updates:{month_map:r},description:"[recalc] updating month_map"}),I4(t,l,d,f,r)}function I4(t,e,n,r,i){const o=Pe.getQueryData(Ce.budget(t));if(o){const l={};for(const[h,f]of Object.entries(o.accounts)){const p=e[h];p&&p.balance!==void 0?l[h]={...f,balance:Ae(p.balance)}:l[h]=f}const d={};for(const[h,f]of Object.entries(o.categories)){const p=n[h];p&&p.balance!==void 0?d[h]={...f,balance:Ae(p.balance)}:d[h]=f}Pe.setQueryData(Ce.budget(t),{...o,accounts:l,categories:d,accountGroups:o.accountGroups,categoryGroups:o.categoryGroups,monthMap:i,budget:{...o.budget,accounts:l,categories:d,account_groups:o.budget.account_groups,category_groups:o.budget.category_groups,month_map:i}})}}async function q0(t,e,n){const r=qe(e,n);if(u4(t,r))return{addedCount:0,budgetUpdated:!1};const i=Ce.budget(t),o=Pe.getQueryData(i);let l=null;if(o?.budget)l=o.budget;else{const{exists:g,data:b}=await Lt("budgets",t,"reading budget for month_map update");if(!g||!b)return console.warn(`[ensureMonthsInMap] Budget ${t} not found`),{addedCount:0,budgetUpdated:!1};l=b}const h={...l.month_map||{}},f=IT();let p=0;r in h||(h[r]={},p++);for(const g of f)g>=r&&!(g in h)&&(h[g]={},p++);return p===0?{addedCount:0,budgetUpdated:!1}:(d4(t,r,h),await qu("budgets",t,{month_map:h,updated_at:new Date().toISOString()},`adding ${p} month(s) to budget month_map`),{addedCount:p,budgetUpdated:!0})}async function D4(t,e){if(e.length===0)return{addedCount:0,budgetUpdated:!1};const n=Ce.budget(t),r=Pe.getQueryData(n);let i=null;if(r?.budget)i=r.budget;else{const{exists:h,data:f}=await Lt("budgets",t,"reading budget for batch month_map update");if(!h||!f)return console.warn(`[ensureMonthsInMapBatch] Budget ${t} not found`),{addedCount:0,budgetUpdated:!1};i=f}const l={...i.month_map||{}};let d=0;for(const{year:h,month:f}of e){const p=qe(h,f);p in l||(l[p]={},d++)}return d===0?{addedCount:0,budgetUpdated:!1}:(f4(t,l),await qu("budgets",t,{month_map:l,updated_at:new Date().toISOString()},`adding ${d} month(s) to budget month_map (batch)`),{addedCount:d,budgetUpdated:!0})}const k4=Object.freeze(Object.defineProperty({__proto__:null,ensureMonthsInMap:q0,ensureMonthsInMapBatch:D4},Symbol.toStringTag,{value:"Module"}));async function PT(t,e,n){const r=No(t,e.year,e.month),i=md(e);await cr("months",r,i,`writeMonthData: ${n}`)}async function H0(t){const{budgetId:e,month:n,description:r,updateMonthMap:i=!0}=t;await PT(e,n,r||`${n.year}/${n.month}`),Pe.setQueryData(Ce.month(e,n.year,n.month),{month:n}),i&&await q0(e,n.year,n.month)}function M4(){const t=Ut();return{writeData:Hn({mutationFn:async({budgetId:n,month:r,description:i,updateMonthMap:o=!0})=>(await PT(n,r,i||`${r.year}/${r.month}`),{budgetId:n,year:r.year,month:r.month,updateMonthMap:o}),onMutate:async({budgetId:n,month:r})=>{const i=Ce.month(n,r.year,r.month);await t.cancelQueries({queryKey:i});const o=t.getQueryData(i);return t.setQueryData(i,{month:r}),{oldMonthQueryData:o,monthKey:i}},onSuccess:async({budgetId:n,year:r,month:i,updateMonthMap:o})=>{o&&await q0(n,r,i)},onError:(n,r,i)=>{i?.oldMonthQueryData&&t.setQueryData(i.monthKey,i.oldMonthQueryData)}})}}function O4(){const{writeData:t}=M4();return{saveDraftAllocations:async(n,r,i,o)=>{const l=await nr(n,r,i);if(!l)throw new Error(`Month not found: ${r}/${i}`);const{calculateCategoryBalances:d}=await Ra(async()=>{const{calculateCategoryBalances:g}=await Promise.resolve().then(()=>K6);return{calculateCategoryBalances:g}},void 0),h=l.category_balances.map(g=>({category_id:g.category_id,start_balance:g.start_balance,allocated:Ae(o[g.category_id]??g.allocated)})),f=d(h,l.expenses||[],l.transfers||[],l.adjustments||[]),p={...l,category_balances:f,updated_at:new Date().toISOString()};return await t.mutateAsync({budgetId:n,month:p,updateMonthMap:!1}),{updatedMonth:p}},isPending:t.isPending,isError:t.isError,error:t.error}}const ge={primary:"#646cff",error:"#f87171",errorBg:"rgba(220, 38, 38, 0.1)",errorBorder:"rgba(220, 38, 38, 0.3)",success:"#4ade80",danger:"#f87171",warning:"#facc15",debt:"#fb923c",zero:"rgba(255, 255, 255, 0.4)"},ds={textDecoration:"underline",textDecorationStyle:"dotted",textUnderlineOffset:"3px"},za="1px solid color-mix(in srgb, currentColor 20%, transparent)",Pf={maxWidth:"var(--page-max-width, 85rem)",margin:"0 auto",padding:"var(--page-padding, 2rem)"},G0={background:"color-mix(in srgb, currentColor 8%, transparent)",padding:"1rem 1.25rem",borderRadius:"8px",display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem"},N4={background:"color-mix(in srgb, currentColor 8%, transparent)",padding:"1.25rem",borderRadius:"8px",display:"flex",flexDirection:"column",gap:"1rem"},P4={display:"flex",flexDirection:"column",gap:"0.5rem"},B4={fontSize:"0.9rem",fontWeight:500},$a={padding:"0.6rem 0.8rem",borderRadius:"6px",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"1rem",color:"inherit",width:"100%",boxSizing:"border-box"},z4={...$a,cursor:"pointer"},W0={padding:"0.6rem 1.25rem",borderRadius:"6px",cursor:"pointer",fontWeight:500,fontSize:"0.9rem",transition:"opacity 0.15s"},BT={...W0,background:ge.primary,color:"white",border:"none"},L4={...BT,padding:"0.75rem 1.5rem",borderRadius:"8px"},U4={...W0,background:"transparent",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)"},F4={...W0,background:"transparent",border:`1px solid ${ge.errorBorder}`,color:ge.error},V4={background:"transparent",border:"1px solid color-mix(in srgb, currentColor 25%, transparent)",padding:"0.35rem 0.75rem",borderRadius:"6px",cursor:"pointer",fontSize:"0.8rem",opacity:.8,transition:"opacity 0.15s",whiteSpace:"nowrap"},ba={background:"transparent",border:"1px solid color-mix(in srgb, currentColor 15%, transparent)",padding:"0.25rem 0.35rem",borderRadius:"4px",cursor:"pointer",fontSize:"0.75rem",lineHeight:1,display:"flex",alignItems:"center",justifyContent:"center",opacity:.6,transition:"opacity 0.15s, background 0.15s"},Bf={display:"flex",flexDirection:"column",gap:"2px"},$4={display:"flex",gap:"0.75rem",marginTop:"0.5rem"},q4={opacity:.4,cursor:"grab"},H4={position:"absolute",top:"-4px",left:0,right:0,height:"3px",background:ge.primary,borderRadius:"2px",transition:"opacity 0.15s"},G4={position:"relative",height:"2rem",marginTop:"-0.25rem"},W4={position:"absolute",top:"50%",left:0,right:0,height:"3px",background:ge.primary,borderRadius:"2px",transition:"opacity 0.15s"},Q4={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"0.75rem",opacity:.7,background:"var(--background, #1a1a1a)",padding:"0 0.5rem",whiteSpace:"nowrap"},K4={background:ge.errorBg,border:`1px solid ${ge.errorBorder}`,color:ge.error,padding:"0.75rem 1rem",borderRadius:"8px",marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem"},Y4={background:"transparent",border:"none",color:ge.error,cursor:"pointer",fontSize:"1.2rem",padding:"0 0.25rem",lineHeight:1},zT={opacity:.7,marginBottom:"1.5rem"},kS={display:"flex",flexDirection:"column",gap:"0.5rem",marginBottom:"1.5rem"};function wm({message:t,children:e,onDismiss:n,style:r}){return u.jsxs("div",{style:{...K4,...r},children:[u.jsx("span",{children:e??t}),n&&u.jsx("button",{onClick:n,style:Y4,children:""})]})}const X4={primary:BT,"primary-large":L4,secondary:U4,danger:F4,small:V4},Z4={position:"absolute",bottom:"100%",left:"50%",transform:"translateX(-50%)",background:ge.warning,color:"#1a1a1a",padding:"0.5rem 0.75rem",borderRadius:"6px",fontSize:"0.8rem",fontWeight:500,whiteSpace:"nowrap",marginBottom:"0.5rem",zIndex:100,boxShadow:"0 2px 8px rgba(0,0,0,0.3)",animation:"tooltipFadeIn 0.15s ease-out"},J4={position:"absolute",top:"100%",left:"50%",transform:"translateX(-50%)",width:0,height:0,borderLeft:"6px solid transparent",borderRight:"6px solid transparent",borderTop:`6px solid ${ge.warning}`};function $e({variant:t="primary",isLoading:e,loadingText:n="Saving...",children:r,disabled:i,style:o,actionName:l,disabledReason:d,onClick:h,...f}){const p=X4[t],g=i||e,[b,_]=j.useState(!1);function w(C){h?.(C)}function x(C){g&&d&&(C.preventDefault(),C.stopPropagation(),_(!0),setTimeout(()=>_(!1),3e3))}const S=g?{cursor:"not-allowed",opacity:.35,filter:"grayscale(50%)"}:{};return u.jsxs("div",{style:{position:"relative",display:"inline-block"},onClick:x,children:[b&&d&&u.jsxs("div",{style:Z4,children:[d,u.jsx("div",{style:J4})]}),u.jsx("button",{disabled:g,style:{...p,cursor:g?"not-allowed":"pointer",...S,...o},onClick:w,...f,children:e?n:r})]})}function LT(t,e){const n=t.toLowerCase(),r=e.toLowerCase();if(r.includes(n)){const d=r.indexOf(n);return{match:!0,score:d===0||/\s/.test(r[d-1])?100:90}}let i=0,o=0,l=0;for(let d=0;d<r.length&&i<n.length;d++)r[d]===n[i]?(i++,l++,o+=l*2):l=0;return i===n.length?{match:!0,score:o}:{match:!1,score:0}}function UT(t){return[...t].sort((e,n)=>!e.groupId&&n.groupId?1:e.groupId&&!n.groupId?-1:!e.groupId&&!n.groupId?e.sortOrder-n.sortOrder:e.groupSortOrder!==n.groupSortOrder?e.groupSortOrder-n.groupSortOrder:e.sortOrder-n.sortOrder)}function FT(t){const e=UT(t),n=[];let r="__initial__";return e.forEach(i=>{i.groupId!==r&&(r=i.groupId,n.push({groupId:i.groupId,groupName:i.groupName,groupSortOrder:i.groupSortOrder,items:[]})),n[n.length-1].items.push(i)}),n}function VT(t,e,n){return e.trim()?t.map(i=>{const o=n(i);let l=0,d=!1;for(const h of o){const f=LT(e,h);f.match&&(d=!0,l=Math.max(l,f.score))}return{item:i,score:l,hasMatch:d}}).filter(({hasMatch:i})=>i).sort((i,o)=>o.score!==i.score?o.score-i.score:!i.item.groupId&&o.item.groupId?1:i.item.groupId&&!o.item.groupId?-1:i.item.groupSortOrder!==o.item.groupSortOrder?i.item.groupSortOrder-o.item.groupSortOrder:i.item.sortOrder-o.item.sortOrder).map(({item:i})=>i):UT(t)}const Q0={position:"absolute",top:"100%",left:0,right:0,marginTop:"4px",background:"var(--background, #1a1a1a)",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",borderRadius:"6px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",zIndex:1e3},Wu={padding:"0.6rem 0.8rem",cursor:"pointer",transition:"background 0.1s"};function MS({id:t,value:e,onChange:n,payees:r,placeholder:i="Enter payee name",autoFocus:o}){const[l,d]=j.useState(!1),[h,f]=j.useState(-1),p=j.useRef(null),g=j.useRef(null),b=e.trim()?r.map(x=>({payee:x,...LT(e,x)})).filter(x=>x.match).sort((x,S)=>S.score-x.score).slice(0,8).map(x=>x.payee):[];j.useEffect(()=>{function x(S){p.current&&!p.current.contains(S.target)&&d(!1)}return document.addEventListener("mousedown",x),()=>document.removeEventListener("mousedown",x)},[]);function _(x){!l||b.length===0||(x.key==="ArrowDown"?(x.preventDefault(),f(S=>Math.min(S+1,b.length-1))):x.key==="ArrowUp"?(x.preventDefault(),f(S=>Math.max(S-1,-1))):x.key==="Enter"&&h>=0?(x.preventDefault(),n(b[h]),d(!1),f(-1)):x.key==="Escape"&&(d(!1),f(-1)))}function w(x){n(x),d(!1),f(-1),g.current?.focus()}return u.jsxs("div",{ref:p,style:{position:"relative"},children:[u.jsx("input",{ref:g,id:t,type:"text",value:e,onChange:x=>{n(x.target.value),d(!0),f(-1)},onFocus:()=>d(!0),onKeyDown:_,placeholder:i,autoComplete:"off",autoFocus:o,style:$a}),l&&b.length>0&&u.jsx("div",{style:{...Q0,maxHeight:"200px",overflowY:"auto"},children:b.map((x,S)=>u.jsx("div",{onClick:()=>w(x),style:{...Wu,background:S===h?`color-mix(in srgb, ${ge.primary} 20%, transparent)`:"transparent",borderBottom:S<b.length-1?"1px solid color-mix(in srgb, currentColor 10%, transparent)":"none"},onMouseEnter:()=>f(S),children:x},x))})]})}function $T({id:t,value:e,onChange:n,categories:r,categoryGroups:i,placeholder:o="Search categories...",required:l,showNoCategoryOption:d=!1,showHiddenCategories:h=!1}){const f=Object.fromEntries(i.map(G=>[G.id,G.name])),p=Object.fromEntries(i.map(G=>[G.id,G.sort_order])),g=h?r:Object.fromEntries(Object.entries(r).filter(([,G])=>!G.is_hidden)),b=Object.entries(g).map(([G,Z])=>({id:G,name:Z.name,groupId:Z.category_group_id,groupName:Z.category_group_id&&f[Z.category_group_id]||null,sortOrder:Z.sort_order,groupSortOrder:Z.category_group_id?p[Z.category_group_id]??999:999})),_=e===Yt,w=_?null:e?r[e]:null,x=_?"":w?.name||"",[S,C]=j.useState(x),[T,R]=j.useState(!1),[D,V]=j.useState(-1),$=j.useRef(null),k=j.useRef(null);j.useEffect(()=>{if(e===Yt)C("");else if(e){const G=r[e];C(G?.name||"")}},[e,r]);const M=VT(b,S,G=>[G.name]),B=FT(M);j.useEffect(()=>{function G(Z){if($.current&&!$.current.contains(Z.target))if(R(!1),e===Yt)C("");else{const Q=e?r[e]:null;C(Q?.name||"")}}return document.addEventListener("mousedown",G),()=>document.removeEventListener("mousedown",G)},[e,r]);function U(G){if(G.key==="ArrowDown")G.preventDefault(),T?V(Z=>Math.min(Z+1,M.length-1)):(R(!0),V(0));else if(G.key==="ArrowUp")G.preventDefault(),V(Z=>Math.max(Z-1,0));else if(G.key==="Enter")G.preventDefault(),T&&D>=0&&M[D]&&q(M[D]);else if(G.key==="Escape")if(R(!1),V(-1),e===Yt)C("");else{const Z=e?r[e]:null;C(Z?.name||"")}else if(G.key==="Tab")if(T&&D>=0&&M[D])q(M[D]);else if(R(!1),V(-1),e===Yt)C("");else{const Z=e?r[e]:null;C(Z?.name||"")}}function q(G){n(G.id),C(G.id===Yt?"":G.name),R(!1),V(-1)}function I(){n(Yt),C(""),R(!1),V(-1)}function N(G){const Z=G.target.value;C(Z),R(!0),V(Z.trim()?0:-1),Z!==x&&(d&&Z.trim()===""?n(Yt):n(""))}function O(){R(!0),d&&(e===Yt||S.trim()==="")?V(-1):M.length>0&&V(0)}let J=-1;const Y=()=>++J;return u.jsxs("div",{ref:$,style:{position:"relative"},children:[u.jsx("input",{ref:k,id:t,type:"text",value:S,onChange:N,onFocus:O,onKeyDown:U,placeholder:o,autoComplete:"off",required:l&&!d,style:{...$a,borderColor:l&&!e?ge.error:void 0}}),T&&u.jsxs("div",{style:{...Q0,maxHeight:"250px",overflowY:"auto"},children:[d&&u.jsx("div",{onClick:I,onMouseEnter:()=>V(-1),style:{...Wu,opacity:.7,fontStyle:"italic",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)",background:D===-1?`color-mix(in srgb, ${ge.primary} 20%, transparent)`:"transparent"},children:Po}),B.map((G,Z)=>u.jsxs("div",{children:[G.groupName&&u.jsx("div",{style:{padding:"0.4rem 0.8rem",fontSize:"0.75rem",textTransform:"uppercase",letterSpacing:"0.5px",opacity:.6,background:"color-mix(in srgb, currentColor 5%, transparent)",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},children:G.groupName}),G.items.map(Q=>{const te=Y();return u.jsx("div",{onClick:()=>q(Q),style:{...Wu,paddingLeft:G.groupName?"1.2rem":"0.8rem",background:te===D?`color-mix(in srgb, ${ge.primary} 20%, transparent)`:"transparent",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},onMouseEnter:()=>V(te),children:Q.name},Q.id)})]},`group-${Z}`)),M.length===0&&S.trim()&&!d&&u.jsx("div",{style:{padding:"0.6rem 0.8rem",opacity:.6,fontStyle:"italic"},children:"No matching categories"})]})]})}function qT({id:t,value:e,onChange:n,accounts:r,accountGroups:i,placeholder:o="Search accounts...",required:l,showNoAccountOption:d=!1,showHiddenAccounts:h=!1}){const p=(h?r:r.filter(([,J])=>!J.is_hidden)).map(([J,Y])=>({id:J,name:Y.nickname,groupId:Y.account_group_id,groupName:Y.account_group_id&&i[Y.account_group_id]?.name||null,sortOrder:Y.sort_order,groupSortOrder:Y.account_group_id?i[Y.account_group_id]?.sort_order??999:999})),g=e===Ht,b=g?null:r.find(([J])=>J===e)?.[1],_=g?"":b?.nickname||"",[w,x]=j.useState(_),[S,C]=j.useState(!1),[T,R]=j.useState(-1),D=j.useRef(null),V=j.useRef(null);j.useEffect(()=>{if(e===Ht)x("");else if(e){const J=r.find(([Y])=>Y===e)?.[1];x(J?.nickname||"")}},[e,r]);const $=VT(p,w,J=>[J.name]),k=FT($);j.useEffect(()=>{function J(Y){if(D.current&&!D.current.contains(Y.target))if(C(!1),e===Ht)x("");else{const G=r.find(([Z])=>Z===e)?.[1];x(G?.nickname||"")}}return document.addEventListener("mousedown",J),()=>document.removeEventListener("mousedown",J)},[e,r]);function M(J){if(J.key==="ArrowDown")J.preventDefault(),S?R(Y=>Math.min(Y+1,$.length-1)):(C(!0),R(0));else if(J.key==="ArrowUp")J.preventDefault(),R(Y=>Math.max(Y-1,0));else if(J.key==="Enter")J.preventDefault(),S&&T>=0&&$[T]&&B($[T]);else if(J.key==="Escape")if(C(!1),R(-1),e===Ht)x("");else{const Y=r.find(([G])=>G===e)?.[1];x(Y?.nickname||"")}else if(J.key==="Tab")if(S&&T>=0&&$[T])B($[T]);else if(C(!1),R(-1),e===Ht)x("");else{const Y=r.find(([G])=>G===e)?.[1];x(Y?.nickname||"")}}function B(J){n(J.id),x(J.id===Ht?"":J.name),C(!1),R(-1)}function U(){n(Ht),x(""),C(!1),R(-1)}function q(J){const Y=J.target.value;x(Y),C(!0),R(Y.trim()?0:-1),Y!==_&&(d&&Y.trim()===""?n(Ht):n(""))}function I(){C(!0),d&&(e===Ht||w.trim()==="")?R(-1):$.length>0&&R(0)}let N=-1;const O=()=>++N;return u.jsxs("div",{ref:D,style:{position:"relative"},children:[u.jsx("input",{ref:V,id:t,type:"text",value:w,onChange:q,onFocus:I,onKeyDown:M,placeholder:o,autoComplete:"off",required:l&&!d,style:{...$a,borderColor:l&&!e?ge.error:void 0}}),S&&u.jsxs("div",{style:{...Q0,maxHeight:"250px",overflowY:"auto"},children:[d&&u.jsx("div",{onClick:U,onMouseEnter:()=>R(-1),style:{...Wu,opacity:.7,fontStyle:"italic",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)",background:T===-1?`color-mix(in srgb, ${ge.primary} 20%, transparent)`:"transparent"},children:Ba}),k.map((J,Y)=>u.jsxs("div",{children:[J.groupName&&u.jsx("div",{style:{padding:"0.4rem 0.8rem",fontSize:"0.75rem",textTransform:"uppercase",letterSpacing:"0.5px",opacity:.6,background:"color-mix(in srgb, currentColor 5%, transparent)",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},children:J.groupName}),J.items.map(G=>{const Z=O();return u.jsx("div",{onClick:()=>B(G),style:{...Wu,paddingLeft:J.groupName?"1.2rem":"0.8rem",background:Z===T?`color-mix(in srgb, ${ge.primary} 20%, transparent)`:"transparent",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},onMouseEnter:()=>R(Z),children:G.name},G.id)})]},`group-${Y}`)),$.length===0&&w.trim()&&!d&&u.jsx("div",{style:{padding:"0.6rem 0.8rem",opacity:.6,fontStyle:"italic"},children:"No matching accounts"})]})]})}function Ri({children:t,onSubmit:e,actionName:n}){function r(i){e(i)}return u.jsx("form",{onSubmit:r,style:N4,children:t})}function Nt({label:t,htmlFor:e,children:n,hint:r,style:i}){return u.jsxs("div",{style:{...P4,...i},children:[u.jsx("label",{htmlFor:e,style:B4,children:t}),n,r&&u.jsx("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.85rem",opacity:.6},children:r})]})}function Ii(t){return u.jsx("input",{style:$a,...t})}function e3(t){if(!t)return"";try{return new Date(t+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"})}catch{return t}}function zf({value:t,onChange:e,style:n,autoFocus:r,...i}){const o=j.useRef(null),l=j.useRef(null),d=e3(t);j.useEffect(()=>{r&&l.current?.focus()},[r]);function h(){o.current?.showPicker?.()}function f(p){p.key==="Enter"&&(p.preventDefault(),o.current?.showPicker?.())}return u.jsxs("div",{style:{position:"relative"},children:[u.jsx("input",{ref:o,type:"date",value:t||"",onChange:e,style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",opacity:0,pointerEvents:"none"},...i}),u.jsx("div",{ref:l,tabIndex:0,onClick:h,onKeyDown:f,style:{...$a,cursor:"pointer",display:"flex",alignItems:"center",fontSize:"0.85rem",fontFamily:"monospace",color:t?"inherit":"color-mix(in srgb, currentColor 50%, transparent)",...n},children:d||"Select date"})]})}function Qu({children:t,...e}){return u.jsx("select",{style:z4,...e,children:t})}function K0({minHeight:t="6rem",style:e,...n}){return u.jsx("textarea",{style:{...$a,width:"100%",minHeight:t,resize:"vertical",fontFamily:"inherit",boxSizing:"border-box",...e},...n})}function qa({children:t}){return u.jsx("div",{style:$4,children:t})}function Qg(t){const n=t.replace(/[^\d.]/g,"").split("."),r=n[0]||"",i=n[1],o=r.replace(/\B(?=(\d{3})+(?!\d))/g,",");return i!==void 0?`$${o}.${i.slice(0,2)}`:o?`$${o}`:""}function t3(t){return t.replace(/[$,]/g,"")}function Ao({id:t,value:e,onChange:n,placeholder:r="$0.00",required:i,autoFocus:o,style:l}){const[d,h]=j.useState(()=>Qg(e)),f=j.useRef(null);j.useEffect(()=>{const g=Qg(e);t3(d)!==e&&h(g)},[e]);function p(g){const b=g.target.value;if(!b||b==="$"){h(""),n("");return}const w=b.replace(/[^\d.]/g,"").split(".");let x=w[0];w.length>1&&(x+="."+w.slice(1).join("").slice(0,2));const S=Qg(x);h(S),n(x)}return u.jsx("input",{ref:f,id:t,type:"text",inputMode:"decimal",value:d,onChange:p,placeholder:r,required:i,autoFocus:o,style:{...$a,...l}})}function Mi(t=V6){const[e,n]=j.useState(()=>typeof window>"u"?!1:window.innerWidth<t);return j.useEffect(()=>{const r=window.matchMedia(`(max-width: ${t-1}px)`);function i(l){n(l.matches)}i(r),r.addEventListener("change",i);function o(){n(window.innerWidth<t)}return window.addEventListener("resize",o),()=>{r.removeEventListener("change",i),window.removeEventListener("resize",o)}},[t]),e}function HT(){const[t,e]=j.useState(()=>typeof window>"u"?1200:window.innerWidth);return j.useEffect(()=>{function n(){e(window.innerWidth)}return window.addEventListener("resize",n),n(),()=>window.removeEventListener("resize",n)},[]),{width:t,isWide:t>=Eo.wide,isMedium:t>=Eo.tablet&&t<Eo.wide,isNarrowMedium:t>=Eo.mobile&&t<Eo.tablet,isMobile:t<Eo.mobile}}function On(){const{selectedBudgetId:t,currentUserId:e}=Ze(),n=Q6(t),r=n.data,i=r?.budget||null,o=j.useMemo(()=>r?.accounts||{},[r?.accounts]),l=j.useMemo(()=>r?.accountGroups||{},[r?.accountGroups]),d=j.useMemo(()=>r?.categories||{},[r?.categories]),h=j.useMemo(()=>{const D=r?.categoryGroups||[];return D.length>0?[...D]:[]},[r?.categoryGroups]),f=i?.owner_id===e,p=j.useMemo(()=>i?.user_ids||[],[i?.user_ids]),g=j.useMemo(()=>i?.accepted_user_ids||[],[i?.accepted_user_ids]),b=j.useMemo(()=>i?NT(o,d,l):0,[i,o,l,d]),_=j.useMemo(()=>r?.monthMap||{},[r?.monthMap]),w=j.useCallback(D=>{if(!t)return;const V=Pe.getQueryData(Ce.budget(t));V&&Pe.setQueryData(Ce.budget(t),{...V,accounts:D})},[t]),x=j.useCallback(D=>{if(!t)return;const V=Pe.getQueryData(Ce.budget(t));V&&Pe.setQueryData(Ce.budget(t),{...V,accountGroups:D})},[t]),S=j.useCallback(D=>{if(!t)return;const V=Pe.getQueryData(Ce.budget(t));V&&Pe.setQueryData(Ce.budget(t),{...V,categories:D,budget:{...V.budget,categories:D}})},[t]),C=j.useCallback(D=>{if(!t)return;const V=Pe.getQueryData(Ce.budget(t));if(V){const $=[...D];Pe.setQueryData(Ce.budget(t),{...V,categoryGroups:$,budget:{...V.budget,category_groups:$}})}},[t]),T=j.useCallback(async()=>{t&&await Pe.invalidateQueries({queryKey:Ce.budget(t)})},[t]),R=j.useCallback(()=>Object.entries(o).filter(([,D])=>$0(D,l)).reduce((D,[,V])=>D+V.balance,0),[o,l]);return{isLoading:n.isLoading,isFetching:n.isFetching,error:n.error,budget:i,accounts:o,accountGroups:l,categories:d,categoryGroups:h,isOwner:f,budgetUserIds:p,acceptedUserIds:g,totalAvailable:b,monthMap:_,setAccountsOptimistic:w,setAccountGroupsOptimistic:x,setCategoriesOptimistic:S,setCategoryGroupsOptimistic:C,refreshBudget:T,getOnBudgetTotal:R}}function Ys(t,e,n){const{addLoadingHold:r,removeLoadingHold:i}=jn(),o=Ut(),l=kT(t,e,n,{enabled:!!t});j.useEffect(()=>{const T=t?Ce.month(t,e,n):null;if(!T){i("month-query");return}const R=!!l.data,D=o.getQueryState(T),V=D?.dataUpdatedAt?Date.now()-D.dataUpdatedAt>hs:!1;return!R||V&&l.isFetching||l.isLoading?r("month-query","Loading month data..."):i("month-query"),()=>i("month-query")},[l.isLoading,l.isFetching,l.data,t,e,n,o,r,i]);const d=l.data?.month||null,h=j.useMemo(()=>d?.income||[],[d?.income]),f=j.useMemo(()=>d?.expenses||[],[d?.expenses]),p=j.useMemo(()=>d?.transfers||[],[d?.transfers]),g=j.useMemo(()=>d?.adjustments||[],[d?.adjustments]),b=j.useMemo(()=>d?.category_balances||[],[d?.category_balances]),_=j.useMemo(()=>d?.account_balances||[],[d?.account_balances]),w=d?.total_income||0,x=d?.total_expenses||0,S=d?.are_allocations_finalized||!1,C=d?.previous_month_income??0;return{isLoading:l.isLoading,isFetching:l.isFetching,error:l.error,month:d,income:h,expenses:f,transfers:p,adjustments:g,categoryBalances:b,accountBalances:_,totalIncome:w,totalExpenses:x,areAllocationsFinalized:S,previousMonthIncome:C}}const n3={trackChange:()=>{},clearChanges:()=>{},removeChange:()=>{},getChanges:()=>[],hasChanges:()=>!1,isSaving:!1,setIsSaving:()=>{},lastSaveTime:null,setLastSaveTime:()=>{},saveError:null,setSaveError:()=>{},clearSaveError:()=>{},syncError:null,setSyncError:()=>{}},GT=j.createContext(n3);function r3({children:t}){const[e,n]=j.useState(new Map),[r,i]=j.useState(!1),[o,l]=j.useState(null),[d,h]=j.useState(null),[f,p]=j.useState(null),g=j.useCallback($=>{i($)},[]),b=j.useCallback($=>{l($)},[]),_=j.useCallback($=>{h($)},[]),w=j.useCallback($=>$.type==="month"&&$.year!==void 0&&$.month!==void 0?`${$.type}:${$.budgetId}:${$.year}:${$.month}`:`${$.type}:${$.budgetId}`,[]),x=j.useCallback($=>{n(k=>{const M=new Map(k),B=w($);return M.set(B,{...$,timestamp:Date.now()}),M})},[w]),S=j.useCallback(()=>{n(new Map)},[]),C=j.useCallback($=>{n(k=>{const M=new Map(k),B=w($);return M.delete(B),M})},[w]),T=j.useCallback(()=>Array.from(e.values()),[e]),R=j.useCallback(()=>e.size>0,[e]),D=j.useCallback(()=>{h(null)},[]),V={trackChange:x,clearChanges:S,removeChange:C,getChanges:T,hasChanges:R,isSaving:r,lastSaveTime:o,saveError:d,clearSaveError:D,setIsSaving:g,setLastSaveTime:b,setSaveError:_,syncError:f,setSyncError:p};return u.jsx(GT.Provider,{value:V,children:t})}function pd(){const t=j.useContext(GT);if(!t)throw new Error("useSync must be used within a SyncProvider");return t}function Sm(){const{trackChange:t}=pd();return{updateBudgetCacheAndTrack:(n,r)=>{Pe.setQueryData(Ce.budget(n),r),t({type:"budget",budgetId:n})}}}function WT(){const t=Ut(),{currentViewingDocument:e}=Ze(),{saveCurrentDocument:n}=Rn(),{updateBudgetCacheAndTrack:r}=Sm(),i=Hn({onMutate:async l=>{const{budgetId:d,accounts:h}=l,f=Ce.budget(d);await t.cancelQueries({queryKey:f});const p=t.getQueryData(f);if(p){const b={...p,accounts:h};r(d,b)}if(e.type==="budget")try{await n(d,"budget")}catch(b){console.warn("[useUpdateAccounts] Failed to save current document immediately:",b)}return{previousData:p}},mutationFn:async l=>{const{accounts:d}=l;return{accounts:d}},onError:(l,d,h)=>{h?.previousData&&t.setQueryData(Ce.budget(d.budgetId),h.previousData)}});return{updateAccounts:{mutate:l=>i.mutate(l),mutateAsync:l=>i.mutateAsync(l),isPending:i.isPending,isError:i.isError,error:i.error,reset:i.reset}}}function s3(){const t=Ut(),{currentViewingDocument:e}=Ze(),{saveCurrentDocument:n}=Rn(),{updateBudgetCacheAndTrack:r}=Sm(),i=Hn({onMutate:async l=>{const{budgetId:d,accountGroups:h}=l,f=Ce.budget(d);await t.cancelQueries({queryKey:f});const p=t.getQueryData(f);if(p){const b={...p,accountGroups:h};r(d,b)}if(e.type==="budget")try{await n(d,"budget")}catch(b){console.warn("[useUpdateAccountGroups] Failed to save current document immediately:",b)}return{previousData:p}},mutationFn:async l=>{const{accountGroups:d}=l;return{accountGroups:d}},onError:(l,d,h)=>{h?.previousData&&t.setQueryData(Ce.budget(d.budgetId),h.previousData)}});return{updateAccountGroups:{mutate:l=>i.mutate(l),mutateAsync:l=>i.mutateAsync(l),isPending:i.isPending,isError:i.isError,error:i.error,reset:i.reset}}}function QT(){const t=Ut(),{currentViewingDocument:e}=Ze(),{saveCurrentDocument:n}=Rn(),{updateBudgetCacheAndTrack:r}=Sm(),i=Hn({onMutate:async l=>{const{budgetId:d,categories:h}=l,f=Ce.budget(d);await t.cancelQueries({queryKey:f});const p=t.getQueryData(f);if(p){const b={...p,categories:h,budget:{...p.budget,categories:h}};r(d,b)}if(e.type==="budget")try{await n(d,"budget")}catch(b){console.warn("[useUpdateCategories] Failed to save current document immediately:",b)}return{previousData:p}},mutationFn:async l=>{const{categories:d}=l;return{categories:d}},onError:(l,d,h)=>{h?.previousData&&t.setQueryData(Ce.budget(d.budgetId),h.previousData)}});return{updateCategories:{mutate:l=>i.mutate(l),mutateAsync:l=>i.mutateAsync(l),isPending:i.isPending,isError:i.isError,error:i.error,reset:i.reset}}}function i3(){const t=Ut(),{currentViewingDocument:e}=Ze(),{saveCurrentDocument:n}=Rn(),{updateBudgetCacheAndTrack:r}=Sm(),i=Hn({onMutate:async l=>{const{budgetId:d,categoryGroups:h}=l,f=Ce.budget(d);await t.cancelQueries({queryKey:f});const p=t.getQueryData(f);if(p){const b={...p,categoryGroups:h,budget:{...p.budget,category_groups:h}};r(d,b)}if(e.type==="budget")try{await n(d,"budget")}catch(b){console.warn("[useUpdateCategoryGroups] Failed to save current document immediately:",b)}return{previousData:p}},mutationFn:async l=>{const{categoryGroups:d}=l;return{categoryGroups:d}},onError:(l,d,h)=>{h?.previousData&&t.setQueryData(Ce.budget(d.budgetId),h.previousData)}});return{updateCategoryGroups:{mutate:l=>i.mutate(l),mutateAsync:l=>i.mutateAsync(l),isPending:i.isPending,isError:i.isError,error:i.error,reset:i.reset}}}async function gd(t){const{budgetId:e,updates:n,description:r}=t,{total_available:i,is_needs_recalculation:o,...l}=n,d={...l,updated_at:new Date().toISOString()},h=Pa(d);await cr("budgets",e,h,r,{merge:!0});const f=Pe.getQueryData(Ce.budget(e));f&&Pe.setQueryData(Ce.budget(e),{...f,budget:{...f.budget,...n}})}const KT=Object.freeze(Object.defineProperty({__proto__:null,writeBudgetData:gd},Symbol.toStringTag,{value:"Module"}));function a3(){const t=Ut(),e=Hn({onMutate:async r=>{const{budgetId:i,newName:o}=r,l=Ce.budget(i);await t.cancelQueries({queryKey:l});const d=t.getQueryData(l);return d&&t.setQueryData(l,{...d,budget:{...d.budget,name:o.trim()}}),{previousData:d}},mutationFn:async r=>{const{budgetId:i,newName:o}=r,l=o.trim();return await gd({budgetId:i,updates:{name:l},description:`renaming budget to "${l}"`}),{newName:l}},onError:(r,i,o)=>{o?.previousData&&t.setQueryData(Ce.budget(i.budgetId),o.previousData)}});return{renameBudget:{mutate:r=>e.mutate(r),mutateAsync:r=>e.mutateAsync(r),isPending:e.isPending,isError:e.isError,error:e.error,reset:e.reset}}}function o3({currentBudget:t,accounts:e,accountGroups:n,setAccountsOptimistic:r,setAccountGroupsOptimistic:i,saveAccounts:o,saveAccountGroups:l,setError:d}){const h=j.useCallback(async(p,g,b)=>{const _=e[p];if(!_)return;const w=b==="ungrouped"?en:b,x=Object.entries(e).filter(([,T])=>(T.account_group_id||"ungrouped")===b),S={};Object.entries(e).forEach(([T,R])=>{T!==p&&(S[T]={...R})});let C;if(g==="__group_end__"||x.length===0||!x.find(([T])=>T===g))C=(x.length>0?Math.max(...x.filter(([R])=>R!==p).map(([,R])=>R.sort_order)):-1)+1;else{const T=x.find(([R])=>R===g);if(T){const[,R]=T;C=R.sort_order,Object.entries(S).forEach(([D,V])=>{(V.account_group_id||"ungrouped")===b&&V.sort_order>=C&&(S[D]={...V,sort_order:V.sort_order+1})})}else C=0}if(S[p]={..._,account_group_id:w,sort_order:C},r(S),!!t)try{await o(S)}catch(T){d(T instanceof Error?T.message:"Failed to save changes")}},[t,e,r,o,d]),f=j.useCallback(async(p,g)=>{if(p===g)return;const b=Object.entries(n).sort(([,C],[,T])=>C.sort_order-T.sort_order),_=b.findIndex(([C])=>C===p),w=[...b],[x]=w.splice(_,1);if(g==="__end__")w.push(x);else{const C=w.findIndex(([T])=>T===g);w.splice(C,0,x)}const S={};if(w.forEach(([C,T],R)=>{S[C]={...T,sort_order:R}}),i(S),!!t)try{await l(S)}catch(C){d(C instanceof Error?C.message:"Failed to save new order")}},[t,n,i,l,d]);return{reorderAccountsInGroup:h,reorderGroups:f}}function l3(){const{selectedBudgetId:t}=Ze(),{budget:e,accounts:n,accountGroups:r,setAccountsOptimistic:i,setAccountGroupsOptimistic:o}=On(),{updateAccounts:l}=WT(),{updateAccountGroups:d}=s3(),[h,f]=j.useState(null),p=j.useCallback(async U=>{if(!t)throw new Error("No budget selected");await l.mutateAsync({budgetId:t,accounts:U})},[t,l]),g=j.useCallback(async U=>{if(!t)throw new Error("No budget selected");await d.mutateAsync({budgetId:t,accountGroups:U})},[t,d]),b=j.useCallback(async(U,q)=>{if(!t)throw new Error("No budget selected");await Promise.all([l.mutateAsync({budgetId:t,accounts:U}),d.mutateAsync({budgetId:t,accountGroups:q})])},[t,l,d]),_=j.useMemo(()=>Object.entries(n).filter(([,U])=>!U.is_hidden).reduce((U,[q,I])=>{const N=I.account_group_id||en;return U[N]||(U[N]=[]),U[N].push({...I,id:q}),U},{}),[n]),w=j.useMemo(()=>Object.entries(n).filter(([,U])=>U.is_hidden).map(([U,q])=>({...q,id:U})).sort((U,q)=>U.sort_order-q.sort_order),[n]),x=j.useMemo(()=>Object.entries(r).sort(([,U],[,q])=>U.sort_order-q.sort_order).map(([U,q])=>({...q,id:U})),[r]),S=j.useCallback((U,q)=>{if(!e)return;const I=q||en,N=Object.values(n).filter(Z=>Z.account_group_id===I),O=N.length>0?Math.max(...N.map(Z=>Z.sort_order)):-1,J=`account_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,Y={nickname:U.nickname,description:"",balance:0,account_group_id:I,sort_order:O+1,is_income_account:U.is_income_account??!1,is_income_default:U.is_income_default??!1,is_outgo_account:U.is_outgo_account??!1,is_outgo_default:U.is_outgo_default??!1,on_budget:U.on_budget!==!1,is_active:U.is_active!==!1,is_hidden:U.is_hidden??!1},G={...n};U.is_income_default&&Object.keys(G).forEach(Z=>{G[Z]={...G[Z],is_income_default:!1}}),U.is_outgo_default&&Object.keys(G).forEach(Z=>{G[Z]={...G[Z],is_outgo_default:!1}}),G[J]=Y,i(G),p(G).catch(Z=>f(Z instanceof Error?Z.message:"Failed to create account."))},[e,n,i,p]),C=j.useCallback((U,q)=>{if(!e)return;const I=n[U];if(!I)return;const N=I.account_group_id||en,O=q.account_group_id||en;let J=I.sort_order;if(N!==O){const G=Object.values(n).filter(Z=>Z.account_group_id===O);J=G.length>0?Math.max(...G.map(Z=>Z.sort_order))+1:0}const Y={};Object.entries(n).forEach(([G,Z])=>{G===U?Y[G]={...Z,nickname:q.nickname,account_group_id:O,sort_order:J,is_income_account:q.is_income_account??!1,is_income_default:q.is_income_default??!1,is_outgo_account:q.is_outgo_account??!1,is_outgo_default:q.is_outgo_default??!1,on_budget:q.on_budget!==!1,is_active:q.is_active!==!1,is_hidden:q.is_hidden??!1}:(Y[G]={...Z},q.is_income_default&&!I.is_income_default&&(Y[G].is_income_default=!1),q.is_outgo_default&&!I.is_outgo_default&&(Y[G].is_outgo_default=!1))}),i(Y),p(Y).catch(G=>f(G instanceof Error?G.message:"Failed to save account."))},[e,n,i,p]),T=j.useCallback(U=>{if(!confirm("Are you sure you want to delete this account?")||!e)return;const{[U]:q,...I}=n;i(I),p(I).catch(N=>f(N instanceof Error?N.message:"Failed to delete account."))},[e,n,i,p]),R=j.useCallback(async(U,q)=>{const I=n[U];if(!I)return;const N=I.account_group_id||en,O=Object.entries(n).filter(([,te])=>te.account_group_id===N).sort(([,te],[,z])=>te.sort_order-z.sort_order),J=O.findIndex(([te])=>te===U),Y=q==="up"?J-1:J+1;if(Y<0||Y>=O.length)return;const[G,Z]=O[Y],Q={};if(Object.entries(n).forEach(([te,z])=>{te===U?Q[te]={...z,sort_order:Z.sort_order}:te===G?Q[te]={...z,sort_order:I.sort_order}:Q[te]={...z}}),i(Q),!!e)try{await p(Q)}catch(te){i(n),f(te instanceof Error?te.message:"Failed to move account")}},[e,n,i,p]),D=j.useCallback(U=>{if(!e)return;const q=Object.values(r).map(Y=>Y.sort_order),I=q.length>0?Math.max(...q):-1,N=`account_group_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,O={name:U.name,sort_order:I+1,expected_balance:U.expected_balance,on_budget:U.on_budget??null,is_active:U.is_active??null},J={...r,[N]:O};o(J),g(J).catch(Y=>f(Y instanceof Error?Y.message:"Failed to create account type."))},[e,r,o,g]),V=j.useCallback((U,q)=>{if(!e)return;const I={...r,[U]:{...r[U],name:q.name,expected_balance:q.expected_balance,on_budget:q.on_budget??null,is_active:q.is_active??null}};o(I),g(I).catch(N=>f(N instanceof Error?N.message:"Failed to update account type."))},[e,r,o,g]),$=j.useCallback(U=>{if(U===en){alert("Cannot delete the default Ungrouped account type.");return}if(!confirm("Are you sure you want to delete this account type? Accounts in this type will move to Ungrouped.")||!e)return;const q={};Object.entries(n).forEach(([O,J])=>{q[O]=J.account_group_id===U?{...J,account_group_id:en}:J});const{[U]:I,...N}=r;i(q),o(N),b(q,N).catch(O=>f(O instanceof Error?O.message:"Failed to delete account type."))},[e,n,r,i,o,b]),k=j.useCallback(async(U,q)=>{const I=Object.entries(r).sort(([,G],[,Z])=>G.sort_order-Z.sort_order),N=I.findIndex(([G])=>G===U),O=q==="up"?N-1:N+1;if(O<0||O>=I.length)return;const[J]=I.splice(N,1);I.splice(O,0,J);const Y={};if(I.forEach(([G,Z],Q)=>{Y[G]={...Z,sort_order:Q}}),o(Y),!!e)try{await g(Y)}catch(G){o(r),f(G instanceof Error?G.message:"Failed to move account type")}},[e,r,o,g]),{reorderAccountsInGroup:M,reorderGroups:B}=o3({currentBudget:e,accounts:n,accountGroups:r,setAccountsOptimistic:i,setAccountGroupsOptimistic:o,saveAccounts:p,saveAccountGroups:g,setError:f});return{accounts:n,accountGroups:r,accountsByGroup:_,hiddenAccounts:w,sortedGroups:x,currentBudget:e,error:h,setError:f,handleCreateAccount:S,handleUpdateAccount:C,handleDeleteAccount:T,handleMoveAccount:R,handleCreateGroup:D,handleUpdateGroup:V,handleDeleteGroup:$,handleMoveGroup:k,reorderAccountsInGroup:M,reorderGroups:B}}function OS(t,e){if(!t)return{};const n={};return Object.entries(e).forEach(([r,i])=>{if(i.default_monthly_type==="percentage")return;const o=t.category_balances?.find(l=>l.category_id===r);o&&o.allocated>0?n[r]=o.allocated.toString():i.default_monthly_amount!==void 0&&i.default_monthly_amount>0?n[r]=i.default_monthly_amount.toString():n[r]=""}),n}function c3(){const{addLoadingHold:t,removeLoadingHold:e}=jn(),{selectedBudgetId:n,currentYear:r,currentMonthNumber:i}=Ze(),{categories:o,getOnBudgetTotal:l,totalAvailable:d}=On(),{month:h,isLoading:f,previousMonthIncome:p,areAllocationsFinalized:g}=Ys(n,r,i),b=j.useMemo(()=>h?.income?h.income.reduce((z,H)=>z+H.amount,0):0,[h]),{saveDraftAllocations:_}=O4(),{finalizeAllocations:w}=JP(),{deleteAllocations:x}=cA(),S=j.useMemo(()=>OS(h,o),[h,o]),[C,T]=j.useState(S),[R,D]=j.useState(!1),[V,$]=j.useState(null),k=j.useRef(null);j.useMemo(()=>Object.values(o).reduce((z,H)=>z+(H.balance??0),0),[o]),j.useEffect(()=>{if(!h)return;const z=`${h.year}-${h.month}`;k.current!==z&&(D(!1),T(OS(h,o)),k.current=z)},[h,o]);const M=j.useCallback((z,H)=>{if(H.default_monthly_type==="percentage"&&H.default_monthly_amount!==void 0)return Ae(H.default_monthly_amount/100*p);const re=C[z],ne=parseFloat(re||"0");return isNaN(ne)?0:Ae(ne)},[C,p]),B=j.useMemo(()=>Object.entries(o).reduce((z,[H,re])=>{const ne=M(H,re),ce=re.balance??0;if(ce<0){const he=Math.abs(ce),we=Math.max(0,ne-he);return z+we}return z+ne},0),[o,M]),U=l(),q=g?(h?.category_balances||[]).reduce((z,H)=>{const re=o[H.category_id]?.balance??0,ne=H.allocated,ce=re-ne;if(ce<0){const he=Math.abs(ce);return z+Math.max(0,ne-he)}return z+ne},0):0,I=R?d+q:d,N=j.useMemo(()=>R?I-B:I-B+q,[I,B,q,R]),O=j.useCallback((z,H)=>{T(re=>({...re,[z]:H}))},[]),J=j.useCallback(()=>{if(!h)return;const z={};Object.entries(o).forEach(([H,re])=>{if(re.default_monthly_type==="percentage")return;const ne=h.category_balances?.find(ce=>ce.category_id===H);ne&&ne.allocated>0?z[H]=ne.allocated.toString():re.default_monthly_amount!==void 0&&re.default_monthly_amount>0?z[H]=re.default_monthly_amount.toString():z[H]=""}),T(z),D(!1)},[h,o]),Y=j.useCallback(()=>{const z={};return Object.entries(o).forEach(([H,re])=>{const ne=M(H,re);ne>0&&(z[H]=ne)}),z},[o,M]),G=j.useCallback(async()=>{if(n){$(null),t("allocations-save","Saving allocations...");try{await _(n,r,i,Y()),D(!1)}catch(z){$(z instanceof Error?z.message:"Failed to save allocations")}finally{e("allocations-save")}}},[n,r,i,_,Y,t,e]),Z=j.useCallback(async()=>{if(n){$(null),t("allocations-finalize","Applying allocations...");try{await w({budgetId:n,year:r,month:i,allocations:Y(),onProgress:z=>{t("allocations-finalize",z.message)}}),D(!1)}catch(z){$(z instanceof Error?z.message:"Failed to finalize allocations")}finally{e("allocations-finalize")}}},[n,r,i,w,Y,t,e]),Q=j.useCallback(async()=>{if(n){$(null),t("allocations-delete","Deleting allocations...");try{await x({budgetId:n,year:r,month:i,onProgress:H=>{t("allocations-delete",H.message)}});const z={};Object.entries(o).forEach(([H,re])=>{re.default_monthly_type!=="percentage"&&(re.default_monthly_amount!==void 0&&re.default_monthly_amount>0?z[H]=re.default_monthly_amount.toString():z[H]="")}),T(z),D(!1)}catch(z){$(z instanceof Error?z.message:"Failed to delete allocations")}finally{e("allocations-delete")}}},[n,r,i,x,o,t,e]),te=B-q;return{localAllocations:C,isEditingAppliedAllocations:R,error:V,monthLoading:f,onBudgetTotal:U,availableNow:I,currentDraftTotal:B,draftChangeAmount:te,availableAfterApply:N,previousMonthIncome:p,currentMonthIncome:b,allocationsFinalized:g,getAllocationAmount:M,handleAllocationChange:O,resetAllocationsToSaved:J,handleSaveAllocations:G,handleFinalizeAllocations:Z,handleDeleteAllocations:Q,setIsEditingAppliedAllocations:D,setError:$}}function u3({budgetId:t,categories:e,currentYear:n,currentMonth:r,updateCategoriesWithBalances:i}){const o=Object.keys(e),l=o.length>0,d=j.useMemo(()=>{const w={};return Object.entries(e).forEach(([x,S])=>{w[x]={current:S.balance??0,total:S.balance??0}}),w},[e]),[h,f]=j.useState(!1),[p,g]=j.useState(null),b=j.useCallback(async()=>{if(!t||Object.keys(e).length===0)return null;const w=Object.keys(e),{total:x}=await DS(t,w,n,r),S={};Object.entries(e).forEach(([T,R])=>{const D=R.balance,V=x[T]??0;Math.abs(D-V)>.01&&(S[T]={stored:D,calculated:V})});const C=Object.keys(S).length>0?S:null;return g(C),C},[t,e,n,r]),_=j.useCallback(async()=>{if(!(!t||!l)){f(!0);try{const{total:w}=await DS(t,o,n,r),x={};Object.entries(e).forEach(([S,C])=>{x[S]={...C,balance:w[S]??0}}),await i(x),g(null)}finally{f(!1)}}},[t,e,i,n,r,o,l]);return{categoryBalances:d,loadingBalances:h,categoryBalanceMismatch:p,checkCategoryBalanceMismatch:b,recalculateAndSaveCategoryBalances:_}}function d3({categories:t,categoryGroups:e,currentBudget:n,setCategoriesOptimistic:r,setCategoryGroupsOptimistic:i,saveCategories:o,saveCategoryGroups:l,setError:d}){const[h,f]=j.useState(null),[p,g]=j.useState(null),[b,_]=j.useState(null),[w,x]=j.useState(null);function S(M,B){f("category"),g(B),M.dataTransfer.effectAllowed="move"}function C(M,B,U){M.preventDefault(),h==="category"&&(B!==p&&_(B),x(U))}function T(M,B){M.preventDefault(),h==="category"&&(x(B),_(null))}function R(){_(null)}function D(){x(null)}function V(){f(null),g(null),_(null),x(null)}async function $(M,B,U){if(M.preventDefault(),M.stopPropagation(),!p||h!=="category"){V();return}const q=t[p];if(!q)return;const I=U==="ungrouped"?Jt:U,N=Object.entries(t).filter(([,Y])=>(Y.category_group_id||"ungrouped")===U),O={};Object.entries(t).forEach(([Y,G])=>{Y!==p&&(O[Y]=G)});let J;if(B==="__group_end__"||N.length===0||!N.find(([Y])=>Y===B))J=(N.length>0?Math.max(...N.filter(([G])=>G!==p).map(([,G])=>G.sort_order)):-1)+1;else{const Y=N.find(([G])=>G===B);Y?(J=Y[1].sort_order,Object.entries(O).forEach(([G,Z])=>{(Z.category_group_id||"ungrouped")===U&&Z.sort_order>=J&&(O[G]={...Z,sort_order:Z.sort_order+1})})):J=0}if(O[p]={...q,category_group_id:I,sort_order:J},r(O),V(),!!n)try{await o(O)}catch(Y){d(Y instanceof Error?Y.message:"Failed to save changes")}}async function k(M,B){M.preventDefault(),h==="category"&&await $(M,"__group_end__",B)}return{dragType:h,draggedId:p,dragOverId:b,dragOverGroupId:w,setDragOverId:_,setDragOverGroupId:x,handleCategoryDragStart:S,handleCategoryDragOver:C,handleDragOverGroup:T,handleDragLeave:R,handleDragLeaveGroup:D,handleDragEnd:V,handleCategoryDrop:$,handleDropOnGroup:k}}function h3(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n}=Ze(),{budget:r,categories:i,categoryGroups:o,isLoading:l,setCategoriesOptimistic:d,setCategoryGroupsOptimistic:h,getOnBudgetTotal:f}=On(),{updateCategories:p}=QT(),{updateCategoryGroups:g}=i3(),[b,_]=j.useState(null),w=j.useCallback(async Z=>{if(!t)throw new Error("No budget selected");await p.mutateAsync({budgetId:t,categories:Z})},[t,p]),x=j.useCallback(async Z=>{if(!t)throw new Error("No budget selected");await g.mutateAsync({budgetId:t,categoryGroups:Z})},[t,g]),S=j.useCallback(async(Z,Q)=>{if(!t)throw new Error("No budget selected");await Promise.all([p.mutateAsync({budgetId:t,categories:Z}),g.mutateAsync({budgetId:t,categoryGroups:Q})])},[t,p,g]),{categoryBalances:C,loadingBalances:T,categoryBalanceMismatch:R,checkCategoryBalanceMismatch:D,recalculateAndSaveCategoryBalances:V}=u3({budgetId:t,categories:i,currentYear:e,currentMonth:n,updateCategoriesWithBalances:w}),$=d3({categories:i,categoryGroups:o,currentBudget:r,setCategoriesOptimistic:d,setCategoryGroupsOptimistic:h,saveCategories:w,saveCategoryGroups:x,setError:_});async function k(Z,Q){if(!r)return;const te=Q||Jt,z=Object.values(i).filter(he=>he.category_group_id===te),H=z.length>0?Math.max(...z.map(he=>he.sort_order)):-1,re=`category_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,ne={name:Z.name,description:Z.description??"",category_group_id:te,sort_order:H+1,default_monthly_amount:Z.default_monthly_amount??0,default_monthly_type:Z.default_monthly_type??"fixed",balance:0,is_hidden:Z.is_hidden??!1},ce={...i,[re]:ne};d(ce);try{await w(ce)}catch(he){d(i);const we=he instanceof Error?he.message:"Failed to create category";throw _(we),he}}async function M(Z,Q){if(r)try{const te=i[Z];if(!te)return;const z=te.category_group_id||Jt,H=Q.category_group_id||Jt;let re=te.sort_order;if(z!==H){const ce=Object.values(i).filter(he=>he.category_group_id===H&&he!==te);re=ce.length>0?Math.max(...ce.map(he=>he.sort_order))+1:0}const ne={...i,[Z]:{...te,name:Q.name,description:Q.description??"",category_group_id:H,sort_order:re,default_monthly_amount:Q.default_monthly_amount??0,default_monthly_type:Q.default_monthly_type??"fixed",is_hidden:Q.is_hidden??!1}};d(ne),await w(ne)}catch(te){_(te instanceof Error?te.message:"Failed to update category")}}async function B(Z){if(confirm("Are you sure you want to delete this category?")&&r)try{const{[Z]:Q,...te}=i;d(te),await w(te)}catch(Q){_(Q instanceof Error?Q.message:"Failed to delete category")}}async function U(Z,Q){const te=i[Z];if(!te)return;const z=te.category_group_id||Jt,H=Object.entries(i).filter(([,oe])=>oe.category_group_id===z).sort((oe,be)=>oe[1].sort_order-be[1].sort_order),re=H.findIndex(([oe])=>oe===Z),ne=Q==="up"?re-1:re+1;if(ne<0||ne>=H.length)return;const[ce,he]=H[ne],we={};if(Object.entries(i).forEach(([oe,be])=>{oe===Z?we[oe]={...be,sort_order:he.sort_order}:oe===ce?we[oe]={...be,sort_order:te.sort_order}:we[oe]=be}),d(we),!!r)try{await w(we)}catch(oe){d(i),_(oe instanceof Error?oe.message:"Failed to move category")}}async function q(Z){if(r)try{const Q=o.length>0?Math.max(...o.map(H=>H.sort_order)):-1,te={id:`category_group_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,name:Z.name,sort_order:Q+1},z=[...o,te];h(z),await x(z)}catch(Q){_(Q instanceof Error?Q.message:"Failed to create group")}}async function I(Z,Q){if(r)try{const te=o.map(z=>z.id===Z?{...z,name:Q.name}:z);h(te),await x(te)}catch(te){_(te instanceof Error?te.message:"Failed to update group")}}async function N(Z){if(Z===Jt){alert("Cannot delete the default Uncategorized category group.");return}if(confirm("Are you sure you want to delete this group? Categories in this group will move to Uncategorized.")&&r)try{const Q={};Object.entries(i).forEach(([z,H])=>{Q[z]=H.category_group_id===Z?{...H,category_group_id:Jt}:H});const te=o.filter(z=>z.id!==Z);d(Q),h(te),await S(Q,te)}catch(Q){_(Q instanceof Error?Q.message:"Failed to delete group")}}async function O(Z,Q){const te=o.filter(we=>we.id!==Jt).sort((we,oe)=>we.sort_order-oe.sort_order),z=o.find(we=>we.id===Jt),H=te.findIndex(we=>we.id===Z),re=Q==="up"?H-1:H+1;if(re<0||re>=te.length)return;const[ne]=te.splice(H,1);te.splice(re,0,ne);const ce=te.map((we,oe)=>({...we,sort_order:oe})),he=[...ce,...z?[{...z,sort_order:ce.length}]:[]];if(h(he),!!r)try{await x(he)}catch(we){h(o),_(we instanceof Error?we.message:"Failed to move group")}}const J=j.useMemo(()=>Object.entries(i).filter(([,Z])=>!Z.is_hidden).reduce((Z,[Q,te])=>{const z=te.category_group_id||Jt;return Z[z]||(Z[z]=[]),Z[z].push([Q,te]),Z},{}),[i]),Y=j.useMemo(()=>Object.entries(i).filter(([,Z])=>Z.is_hidden).map(([Z,Q])=>[Z,Q]).sort((Z,Q)=>Z[1].sort_order-Q[1].sort_order),[i]),G=j.useMemo(()=>[...o].sort((Z,Q)=>Z.sort_order-Q.sort_order),[o]);return{currentBudget:r,categories:i,categoryGroups:o,categoriesByGroup:J,hiddenCategories:Y,sortedGroups:G,categoryBalances:C,isLoading:l,loadingBalances:T,error:b,setError:_,getOnBudgetTotal:f,categoryBalanceMismatch:R,checkCategoryBalanceMismatch:D,recalculateAndSaveCategoryBalances:V,handleCreateCategory:k,handleUpdateCategory:M,handleDeleteCategory:B,handleMoveCategory:U,handleCreateGroup:q,handleUpdateGroup:I,handleDeleteGroup:N,handleMoveGroup:O,dragType:$.dragType,draggedId:$.draggedId,dragOverId:$.dragOverId,dragOverGroupId:$.dragOverGroupId,setDragOverId:$.setDragOverId,setDragOverGroupId:$.setDragOverGroupId,handleCategoryDragStart:$.handleCategoryDragStart,handleCategoryDragOver:$.handleCategoryDragOver,handleDragOverGroup:$.handleDragOverGroup,handleDragLeave:$.handleDragLeave,handleDragLeaveGroup:$.handleDragLeaveGroup,handleDragEnd:$.handleDragEnd,handleCategoryDrop:$.handleCategoryDrop,handleDropOnGroup:$.handleDropOnGroup}}function f3({categories:t,categoryBalances:e,totalAvailable:n,onBudgetTotal:r,isDataLoading:i,loadingBalances:o,currentBudget:l}){const d=j.useMemo(()=>Object.values(t).reduce((x,S)=>x+Math.max(0,S.balance??0),0),[t]),h=j.useMemo(()=>Object.values(e).reduce((x,S)=>x+Math.max(0,S.total),0),[e]),f=d,p=j.useMemo(()=>Object.values(t).reduce((x,S)=>x+Math.max(0,S.balance??0),0),[t]),g=n,b=j.useMemo(()=>Math.abs(d-h)>.01,[d,h]),_=j.useMemo(()=>Math.abs(r-(f+g))>.01,[r,f,g]),w=j.useMemo(()=>Math.abs(d-p)>.01,[d,p]);return j.useEffect(()=>{},[b,_,w,d,h,f,g,r,p,i,o,l]),{allocatedFromStored:d,allocatedFromCalculated:h,allocated:f,unallocated:g,monthViewAllTime:p,calculationMismatch:b,relationshipMismatch:_,monthViewMismatch:w}}function m3(t,e,n,r){const i={budget_id:e,year_month_ordinal:t.year_month_ordinal??qe(n,r),year:t.year??n,month:t.month??r,income:t.income||[],total_income:t.total_income??0,previous_month_income:t.previous_month_income??0,expenses:t.expenses||[],total_expenses:t.total_expenses??0,transfers:t.transfers||[],adjustments:t.adjustments||[],account_balances:t.account_balances||[],category_balances:t.category_balances||[],are_allocations_finalized:t.are_allocations_finalized??!1,created_at:t.created_at,updated_at:t.updated_at};return fd(i)}async function p3(t){const e=new Date,n=e.getFullYear(),r=e.getMonth()+1;let i=n,o=r-3;for(;o<=0;)o+=12,i-=1;const l=qe(i,o);return(await Zn("months","useInitialDataLoad: loading initial months",[{field:"budget_id",op:"==",value:t},{field:"year_month_ordinal",op:">=",value:l}])).docs.map(f=>{const p=f.data,g=p.year,b=p.month;return m3(p,t,g,b)}).sort((f,p)=>f.year!==p.year?f.year-p.year:f.month-p.month)}async function g3(t){const[e,n,r]=await Promise.all([U0(t),F0(t),p3(t)]);return{budget:e,payees:n,months:r}}function y3(t,e){return Bo({queryKey:t?["initialDataLoad",t]:["initialDataLoad","none"],queryFn:()=>g3(t),enabled:!!t&&e?.enabled!==!1,staleTime:1/0})}async function _3(t,e,n,r){const i=Ce.month(t,e,n),o=r.getQueryData(i);if(!o?.month)throw new Error(`Month ${e}/${n} not found in cache`);const l=o.month,d=await b3(t,e,n,r),h=Gu(l,d);return r.setQueryData(i,{month:h}),h}async function b3(t,e,n,r){const{year:i,month:o}=Ho(e,n),l=Ce.month(t,i,o),d=r.getQueryData(l);if(d?.month)return rc(d.month);try{const h=await nr(t,i,o,{description:`fetching previous month ${i}/${o} for recalculation`});if(h)return rc(h)}catch(h){console.warn(`[useLocalRecalculation] Could not fetch previous month ${i}/${o}:`,h)}return xm}const NS=300*1e3;function v3(t,e,n,r){const i={budget_id:e,year_month_ordinal:t.year_month_ordinal??qe(n,r),year:t.year??n,month:t.month??r,income:t.income||[],total_income:t.total_income??0,previous_month_income:t.previous_month_income??0,expenses:t.expenses||[],total_expenses:t.total_expenses??0,transfers:t.transfers||[],adjustments:t.adjustments||[],account_balances:t.account_balances||[],category_balances:t.category_balances||[],are_allocations_finalized:t.are_allocations_finalized??!1,created_at:t.created_at,updated_at:t.updated_at};return fd(i)}function PS(t,e){return e?t?new Date(e)>new Date(t):!0:!1}async function x3(t,e){const n=[],r=new Date,i=r.getFullYear(),o=r.getMonth()+1;let l=i,d=o-3;for(;d<=0;)d+=12,l-=1;const h=qe(l,d),[f,p,g]=await Promise.all([Pe.fetchQuery({queryKey:Ce.budget(t),queryFn:()=>U0(t),staleTime:0}).catch(()=>null),Pe.fetchQuery({queryKey:Ce.payees(t),queryFn:()=>F0(t),staleTime:0}).catch(()=>null),Zn("months","useSyncCheck: checking for remote changes",[{field:"budget_id",op:"==",value:t},{field:"year_month_ordinal",op:">=",value:h}]).catch(()=>({docs:[]}))]);if(f){const _=Pe.getQueryData(Ce.budget(t));if(_){const w=_.budget?.updated_at;PS(w,f.budget.updated_at)&&(e.some(S=>S.type==="budget"&&S.budgetId===t)?n.push("Budget document has been updated remotely (you have unsaved local changes)"):Pe.setQueryData(Ce.budget(t),f))}}p!==null&&Pe.getQueryData(Ce.payees(t));const b=g.docs.map(_=>{const w=_.data,x=w.year,S=w.month;return v3(w,t,x,S)});for(const _ of b){const w=Pe.getQueryData(Ce.month(t,_.year,_.month));w?.month&&PS(w.month.updated_at,_.updated_at)&&(e.some(S=>S.type==="month"&&S.budgetId===t&&S.year===_.year&&S.month===_.month)?n.push(`Month ${_.year}/${_.month} has been updated remotely (you have unsaved local changes)`):Pe.setQueryData(Ce.month(t,_.year,_.month),{month:_}))}return n}function w3(t,e){const{setSyncError:n,getChanges:r}=pd(),i=j.useRef(null),o=j.useRef(null),l=j.useRef(0),d=j.useRef(!1);j.useEffect(()=>{if(!t||!e||d.current)return;d.current=!0;const h=async()=>{try{const f=r(),p=await x3(t,f);if(p.length>0){const g=`Sync conflict detected: ${p.join("; ")}`;n(g),Jn.add({type:"error",message:g,autoDismissMs:0})}else n(null)}catch(f){console.error("[useSyncCheck] Sync check failed:",f);const p=`Failed to check for sync conflicts: ${f instanceof Error?f.message:String(f)}`;n(p),Jn.add({type:"error",message:p,autoDismissMs:0})}};return o.current=setTimeout(()=>{h(),l.current=Date.now(),i.current=setInterval(()=>{h(),l.current=Date.now()},NS)},NS),()=>{o.current&&clearTimeout(o.current),i.current&&clearInterval(i.current),d.current=!1}},[t,e,n,r])}function S3(t,e,n){const r=Ut(),i=j.useRef(null),o=j.useRef(null),l=j.useRef(null),d=j.useCallback((h,f)=>{if(!t)return;const p=Ce.month(t,h,f);if(r.getQueryData(p))return;const b=r.getQueryData(Ce.budget(t)),_=qe(h,f);b?.monthMap&&_ in b.monthMap&&r.prefetchQuery({queryKey:p,queryFn:async()=>{const x=await vm(t,h,f);return x?{month:x}:null},staleTime:hs}).catch(x=>{console.warn(`[useMonthPrefetch] Failed to prefetch month ${h}/${f}:`,x)})},[t,r]);j.useEffect(()=>{if(!t)return;const h=`${t}-${e}-${n}`;if(l.current===h)return;l.current=h;const f=Hu(e,n);d(f.year,f.month)},[t,e,n,d]),j.useEffect(()=>{if(i.current===null||o.current===null){i.current=e,o.current=n;return}if(i.current===e&&o.current===n)return;if(!t){i.current=e,o.current=n;return}const h=qe(i.current,o.current),g=qe(e,n)>h?Hu(e,n):Ho(e,n);d(g.year,g.month),i.current=e,o.current=n},[t,e,n,d])}function E3(t,e){const n={};Object.keys(e).forEach(l=>{n[l]=0});const r=Pe.getQueryData(Ce.budget(t));if(!r)return n;const i=r.budget.month_map||{},o=Object.keys(i).sort();for(const l of o){const d=parseInt(l.substring(0,4),10),h=parseInt(l.substring(4,6),10),f=Ce.month(t,d,h),p=Pe.getQueryData(f);if(!p?.month)continue;const g=p.month;for(const b of g.account_balances||[])b.account_id&&!Ke(b.account_id)&&n[b.account_id]===0&&(n[b.account_id]=b.start_balance??0)}for(const l of o){const d=parseInt(l.substring(0,4),10),h=parseInt(l.substring(4,6),10),f=Ce.month(t,d,h),p=Pe.getQueryData(f);if(!p?.month)continue;const g=p.month;for(const b of g.income||[])b.account_id&&!Ke(b.account_id)&&n[b.account_id]!==void 0&&(n[b.account_id]+=b.amount);for(const b of g.expenses||[])b.account_id&&!Ke(b.account_id)&&n[b.account_id]!==void 0&&(n[b.account_id]+=b.amount);for(const b of g.transfers||[])b.to_account_id&&!Ke(b.to_account_id)&&n[b.to_account_id]!==void 0&&(n[b.to_account_id]+=b.amount),b.from_account_id&&!Ke(b.from_account_id)&&n[b.from_account_id]!==void 0&&(n[b.from_account_id]-=b.amount);for(const b of g.adjustments||[])b.account_id&&!Ke(b.account_id)&&n[b.account_id]!==void 0&&(n[b.account_id]+=b.amount)}for(const l of Object.keys(n))n[l]=Ae(n[l]);return n}function YT(t){const e=Pe.getQueryData(Ce.budget(t));if(!e){console.warn("[recalculateBudgetAccountBalancesFromCache] Budget not in cache");return}const n=E3(t,e.accounts),r={};for(const[i,o]of Object.entries(e.accounts))r[i]={...o,balance:Ae(n[i]??o.balance)};Pe.setQueryData(Ce.budget(t),{...e,accounts:r,budget:{...e.budget,accounts:r}})}function BS(t){return{year:parseInt(t.substring(0,4),10),month:parseInt(t.substring(4,6),10)}}async function C3(t){const e=Pe.getQueryData(Ce.budget(t));if(!e){console.warn("[recalculateBudgetCategoryBalancesFromCache] Budget not in cache");return}const n=Object.keys(e.categories);if(n.length===0)return;const r=new Date,i=r.getFullYear(),o=r.getMonth()+1,l=qe(i,o),d=e.monthMap||{},h={};n.forEach(C=>{h[C]=0});const f=Object.keys(d).sort(),p=Ce.month(t,i,o),g=Pe.getQueryData(p);if(g?.month?.category_balances)for(const C of g.month.category_balances)n.includes(C.category_id)&&(h[C.category_id]=C.end_balance??0);else{let C=!1;for(let T=f.length-1;T>=0&&!C;T--){const R=f[T];if(R>l)continue;const{year:D,month:V}=BS(R),$=Ce.month(t,D,V),k=Pe.getQueryData($);if(k?.month?.category_balances){C=!0;for(const M of k.month.category_balances)n.includes(M.category_id)&&(h[M.category_id]=M.end_balance??0)}}if(!C&&f.length>0)for(const T of f){if(T>l)break;const{year:R,month:D}=BS(T),V=Ce.month(t,R,D),$=Pe.getQueryData(V);if($?.month){const k=$.month;if(k.are_allocations_finalized&&k.category_balances)for(const M of k.category_balances)n.includes(M.category_id)&&(h[M.category_id]=(h[M.category_id]||0)+(M.allocated||0));if(k.expenses)for(const M of k.expenses)n.includes(M.category_id)&&(h[M.category_id]=(h[M.category_id]||0)-M.amount);if(k.adjustments)for(const M of k.adjustments)M.category_id&&n.includes(M.category_id)&&(h[M.category_id]=(h[M.category_id]||0)+M.amount);if(k.transfers)for(const M of k.transfers)M.to_category_id&&n.includes(M.to_category_id)&&(h[M.to_category_id]=(h[M.to_category_id]||0)+M.amount),M.from_category_id&&n.includes(M.from_category_id)&&(h[M.from_category_id]=(h[M.from_category_id]||0)-M.amount)}}}const b=qe(i+Math.floor((o+Ws-1)/12),(o+Ws-1)%12+1);let _=i,w=o;for(let C=0;C<Ws*2;C++){const T=Hu(_,w);_=T.year,w=T.month;const R=qe(_,w);if(R>b||!(R in d))break;const D=Ce.month(t,_,w),V=Pe.getQueryData(D);if(!V?.month)break;const $=V.month;if($.are_allocations_finalized&&$.category_balances)for(const k of $.category_balances)n.includes(k.category_id)&&(h[k.category_id]=(h[k.category_id]||0)+(k.allocated||0));if($.expenses)for(const k of $.expenses)n.includes(k.category_id)&&(h[k.category_id]=(h[k.category_id]||0)-k.amount)}const x={};for(const C of n)x[C]=Ae(h[C]||0);const S={};for(const[C,T]of Object.entries(e.categories))S[C]={...T,balance:Ae(x[C]??T.balance)};Pe.setQueryData(Ce.budget(t),{...e,categories:S,budget:{...e.budget,categories:S}})}function T3(t){return{year:parseInt(t.substring(0,4),10),month:parseInt(t.substring(4,6),10)}}function A3(t,e){const n=new Date,r=n.getFullYear(),i=n.getMonth()+1,o=qe(r,i);let l=r,d=i+Ws;for(;d>12;)d-=12,l+=1;const h=qe(l,d),f=[],p=Object.keys(e).sort();for(const g of p){if(g<o)continue;if(g>h)break;const{year:b,month:_}=T3(g),w=Ce.month(t,b,_),x=Pe.getQueryState(w),S=!x?.data,C=x?.dataUpdatedAt?Date.now()-x.dataUpdatedAt>hs:!0;(S||C)&&f.push({year:b,month:_,ordinal:g})}return f}async function XT(t,e,n=!0){const r=Pe.getQueryData(Ce.budget(t));if(!r){console.warn("[ensureMonthsFreshAndRecalculateBalances] Budget not in cache");return}const i=r.monthMap||{},o=A3(t,i);if(!(o.length===0&&!n)){if(o.length>0){e?.(!0,`Refreshing ${o.length} month${o.length>1?"s":""}...`);try{await Promise.all(o.map(({year:l,month:d})=>nr(t,l,d,{description:`refreshing month ${l}/${d} for balance calculation`})))}finally{e?.(!1,"")}}YT(t),await C3(t)}}function ZT(t=!0){const{selectedBudgetId:e}=Ze(),{addLoadingHold:n,removeLoadingHold:r}=jn(),i=j.useRef(!1);j.useEffect(()=>{if(!t||!e||i.current)return;i.current=!0;let o=null;XT(e,(l,d)=>{l?(o="ensure-balances-fresh",n(o,d)):o&&(r(o),o=null)},!1).catch(l=>{console.error("[useEnsureBalancesFresh] Failed to ensure balances fresh:",l),o&&r(o)})},[t,e,n,r]),j.useEffect(()=>{e||(i.current=!1)},[e])}function j3(){const t=new Date,e=t.getFullYear(),n=t.getMonth()+1;let r=e,i=n-3;for(;i<=0;)i+=12,r-=1;return qe(r,i)}function R3(t,e){const n=qe(t,e),r=j3();return n>=r}function I3({budgetId:t,viewingYear:e,viewingMonth:n,initialDataLoadComplete:r,enabled:i=!0}){const o=Ut(),l=j.useRef(!1),d=j.useRef(null),h=j.useCallback(()=>{if(!t||!i||!r)return;const f=["initialDataLoad",t],p=o.getQueryState(f);if(!p?.dataUpdatedAt)return;Date.now()-p.dataUpdatedAt>hs&&!l.current&&(l.current=!0,o.invalidateQueries({queryKey:f}))},[t,i,r,o]);j.useEffect(()=>{r&&h()},[r,h]),j.useEffect(()=>{if(!i||!r)return;const f=()=>{document.visibilityState==="visible"&&(l.current=!1,h())};return document.addEventListener("visibilitychange",f),()=>{document.removeEventListener("visibilitychange",f)}},[i,r,h]),j.useEffect(()=>{l.current=!1,d.current=null},[t]),j.useEffect(()=>{if(!t||!i||!r||R3(e,n))return;const p=`${t}-${e}-${n}`;if(d.current===p)return;d.current=p;const g=[{year:e,month:n},Ho(e,n),Hu(e,n)];for(const{year:b,month:_}of g){const w=Ce.month(t,b,_);if(o.getQueryData(w)){const S=o.getQueryState(w);if(!(S?.dataUpdatedAt?Date.now()-S.dataUpdatedAt>hs:!1))continue}o.prefetchQuery({queryKey:w,queryFn:async()=>{const S=await vm(t,b,_);return S?{month:S}:null},staleTime:hs}).catch(S=>{console.warn(`[useStaleDataRefresh] Failed to prefetch month ${b}/${_}:`,S)})}},[t,i,r,e,n,o])}function La(){Pe.removeQueries({queryKey:["budget"]}),Pe.removeQueries({queryKey:["month"]}),Pe.removeQueries({queryKey:["accessibleBudgets"]}),Pe.removeQueries({queryKey:["payees"]}),Pe.removeQueries({queryKey:["user"]}),console.log("[Migration] All caches cleared")}async function Em(t){try{const e=await t();return La(),e}catch(e){throw La(),e}}const JT=j.createContext(null),zS={isOpen:!1,migrationName:"",stage:"",progress:null,currentItem:null,details:null,isComplete:!1,error:null};function D3({children:t}){const[e,n]=j.useState(zS),r=j.useCallback(()=>({setStage:d=>{n(h=>({...h,stage:d}))},setProgress:d=>{n(h=>({...h,progress:d}))},setCurrentItem:d=>{n(h=>({...h,currentItem:d}))},setDetails:d=>{n(h=>({...h,details:d}))},updateItemProgress:(d,h,f)=>{const p=h>0?Math.round(d/h*100):0;n(g=>({...g,progress:p,currentItem:f||`Item ${d} of ${h}`,details:`${d} / ${h} complete`}))}}),[]),i=j.useCallback(async(d,h)=>{n({isOpen:!0,migrationName:d,stage:"Starting migration...",progress:null,currentItem:null,details:null,isComplete:!1,error:null});const f=r();try{const p=await h(f);return La(),n(g=>({...g,isComplete:!0,stage:"Migration complete",progress:100,details:p.errors.length>0?`Completed with ${p.errors.length} error(s)`:"All operations successful"})),p}catch(p){La();const g=p instanceof Error?p.message:"Unknown error occurred";throw n(b=>({...b,isComplete:!0,error:g,stage:"Migration failed",progress:null})),p}},[r]),o=j.useCallback(()=>{n(d=>d.isComplete?zS:(console.warn("[MigrationProgress] Cannot close modal while migration is running"),d))},[]),l={state:e,runMigrationWithProgress:i,closeModal:o};return u.jsx(JT.Provider,{value:l,children:t})}function yd(){const t=j.useContext(JT);if(!t)throw new Error("useMigrationProgress must be used within MigrationProgressProvider");return t}async function k3(t){return(await Zn("budgets",`${t}: batch reading all budgets`)).docs.map(n=>({id:n.id,data:n.data}))}async function eA(t,e){return(await Zn("months",`${e}: batch reading months for budget ${t}`,[{field:"budget_id",op:"==",value:t}])).docs.map(i=>({id:i.id,data:i.data,budgetId:i.data.budget_id,year:i.data.year,month:i.data.month})).sort((i,o)=>i.year!==o.year?i.year-o.year:i.month-o.month)}async function rr(t){const e=await k3(t),n=await Zn("months",`${t}: batch reading all months`),r=new Map;for(const i of n.docs){const o=i.data.budget_id,l={id:i.id,data:i.data,budgetId:o,year:i.data.year,month:i.data.month};r.has(o)||r.set(o,[]),r.get(o).push(l)}for(const i of r.values())i.sort((o,l)=>o.year!==l.year?o.year-l.year:o.month-l.month);return{budgets:e,monthsByBudget:r}}async function Ha(t,e){if(t.length===0)return;const n=t.map(o=>{const l=md(o.data);return{collectionPath:"months",docId:No(o.budgetId,o.year,o.month),data:Pa({...l,updated_at:new Date().toISOString()})}});await z0(n,`${e}: batch writing ${t.length} months`);const r=new Map;for(const o of t)r.has(o.budgetId)||r.set(o.budgetId,[]),r.get(o.budgetId).push({year:o.year,month:o.month});const{ensureMonthsInMapBatch:i}=await Ra(async()=>{const{ensureMonthsInMapBatch:o}=await Promise.resolve().then(()=>k4);return{ensureMonthsInMapBatch:o}},void 0);for(const[o,l]of r)try{await i(o,l)}catch(d){console.warn(`[batchWriteMonths] Failed to update month_map for budget ${o}:`,d)}}async function Y0(t,e){if(t.length===0)return;const n=t.map(r=>{const i={...r.data};if(i.accounts&&typeof i.accounts=="object"){const o=i.accounts;i.accounts=Object.fromEntries(Object.entries(o).map(([l,d])=>{if(d&&typeof d=="object"){const{balance:h,...f}=d;return[l,f]}return[l,d]}))}if(i.categories&&typeof i.categories=="object"){const o=i.categories;i.categories=Object.fromEntries(Object.entries(o).map(([l,d])=>{if(d&&typeof d=="object"){const{balance:h,...f}=d;return[l,f]}return[l,d]}))}return delete i.total_available,delete i.is_needs_recalculation,{collectionPath:"budgets",docId:r.budgetId,data:Pa({...i,updated_at:new Date().toISOString()})}});await z0(n,`${e}: batch writing ${t.length} budgets`)}async function tA(t,e,n){if(e.length===0)return;let r=xm;const i=[];for(const p of e){const g=Gu(p,r);i.push(g),r=rc(g)}const o=i.map(p=>({budgetId:t,year:p.year,month:p.month,data:p}));await Ha(o,n);const l=r.accountEndBalances,d=r.categoryEndBalances,{exists:h,data:f}=await Lt("budgets",t,`${n}: reading budget for final update`);if(h&&f){const p=j4(f.month_map||{}),g={...d},b=f.categories||{};for(const _ of Object.keys(b))_ in g||(g[_]=0);await R4(t,l,g,p)}}async function M3(t,e){if(t.length===0)return;const n=new Map;for(const r of t)n.has(r.budgetId)||n.set(r.budgetId,[]),n.get(r.budgetId).push(r);for(const[r,i]of n){i.sort((d,h)=>d.year!==h.year?d.year-h.year:d.month-h.month),await Ha(i,e);const l=(await eA(r,e)).map(d=>d.data);await tA(r,l,e)}}async function O3(t){const{exists:e,data:n}=await Lt("budgets",t,`[delete all months] reading budget ${t} for reset`);if(!e||!n)return;const r=Object.fromEntries(Object.entries(n.accounts||{}).map(([o,l])=>{if(l&&typeof l=="object"){const{balance:d,...h}=l;return[o,h]}return[o,l]})),i=Object.fromEntries(Object.entries(n.categories||{}).map(([o,l])=>{if(l&&typeof l=="object"){const{balance:d,...h}=l;return[o,h]}return[o,l]}));await cr("budgets",t,{...n,accounts:r,categories:i,month_map:{},updated_at:new Date().toISOString()},`[delete all months] resetting budget ${t} (removing balances)`)}function N3({currentUser:t,onComplete:e}){const[n,r]=j.useState(!1),[i,o]=j.useState(!1),[l,d]=j.useState(null),[h,f]=j.useState(null),[p,g]=j.useState(null);async function b(){if(t){r(!0);try{const w=await Zn("months","delete all months: scanning for all months"),x=[],S=new Set;for(const C of w.docs){const{budget_id:T,year:R,month:D}=C.data;S.add(T),x.push({docId:C.id,budgetId:T,year:R,month:D})}x.sort((C,T)=>C.budgetId!==T.budgetId?C.budgetId.localeCompare(T.budgetId):C.year!==T.year?C.year-T.year:C.month-T.month),d({monthsToDelete:x,monthsCount:x.length,budgetCount:S.size})}catch{}finally{r(!1)}}}async function _(){if(!t||!l||l.monthsToDelete.length===0)return;o(!0),f(null);const w=l.monthsToDelete.length,x=new Set,S=[];for(const V of l.monthsToDelete)x.add(V.budgetId);g({phase:"deleting",deleted:0,total:w,currentMonth:null,budgetsRecalculated:0,totalBudgets:l.budgetCount,percentComplete:0});const C=l.monthsToDelete.map(V=>({collectionPath:"months",docId:V.docId}));let T=0;try{await xT(C,"delete all months: batch deleting all month documents",V=>{T=V,g({phase:"deleting",deleted:V,total:w,currentMonth:`Batch ${Math.ceil(V/500)} of ${Math.ceil(w/500)}`,budgetsRecalculated:0,totalBudgets:l.budgetCount,percentComplete:Math.round(V/w*70)})}),T=w}catch(V){S.push(`Batch delete failed: ${V instanceof Error?V.message:"Unknown error"}`)}const R=Array.from(x);let D=0;for(const V of R){g({phase:"resetting-budgets",deleted:T,total:w,currentMonth:`Budget ${D+1}/${R.length}`,budgetsRecalculated:D,totalBudgets:R.length,percentComplete:70+Math.round(D/R.length*25)});try{await O3(V),D++}catch{D++}}g({phase:"clearing-cache",deleted:T,total:w,currentMonth:null,budgetsRecalculated:D,totalBudgets:R.length,percentComplete:95}),La(),g({phase:"complete",deleted:T,total:w,currentMonth:null,budgetsRecalculated:D,totalBudgets:R.length,percentComplete:100}),f({deleted:T,errors:S,budgetsRecalculated:D}),o(!1),g(null),S.length===0&&(d({monthsToDelete:[],monthsCount:0,budgetCount:0}),e?.())}return{status:l,isScanning:n,scanStatus:b,isDeleting:i,deleteResult:h,deleteProgress:p,deleteAllMonths:_}}const Kg="sample@sample.com",xo="budget_1767746876726_xuj7nzl4l";function P3({currentUser:t,onComplete:e}){const[n,r]=j.useState(!1),[i,o]=j.useState(!1),[l,d]=j.useState(null),[h,f]=j.useState(null),[p,g]=j.useState(null);async function b(){if(t){r(!0);try{let x=(await Zn("budgets","delete sample user budget: scanning for sample user budgets",[{field:"owner_email",op:"==",value:Kg}])).docs;if(x.length===0){console.log("delete sample user budget: no budgets found by owner_email, checking fallback budget ID");const V=await Lt("budgets",xo,"delete sample user budget: checking fallback budget ID");V.exists&&V.data&&(console.log("delete sample user budget: found fallback budget",xo),x=[{id:xo,data:V.data}])}const S=[];let C=0,T=!1;for(const V of x){const $=V.id,k=V.data.name,B=(await Zn("months",`delete sample user budget: counting months for budget ${$}`,[{field:"budget_id",op:"==",value:$}])).docs.length;C+=B,S.push({budgetId:$,budgetName:k,monthCount:B}),(await Zn("payees",`delete sample user budget: checking payees for budget ${$}`,[{field:"budget_id",op:"==",value:$}])).docs.length>0&&(T=!0)}const R=[],D=await Zn("users","delete sample user budget: finding sample user document",[{field:"email",op:"==",value:Kg}]);D.docs.length>0&&D.docs[0].data.budget_ids?.includes(xo)&&(S.some(M=>M.budgetId===xo)||(console.log("delete sample user budget: found stale budget reference in sample user document",xo),R.push(xo))),d({budgets:S,totalBudgets:S.length,totalMonths:C,hasPayees:T,staleBudgetIds:R})}catch(w){console.error("Error scanning for sample user budgets:",w)}finally{r(!1)}}}async function _(){if(!t||!l||l.budgets.length===0&&l.staleBudgetIds.length===0)return;o(!0),f(null);const w=[];let x=0,S=0,C=0;const T=l.totalMonths,R=l.totalBudgets;g({phase:"deleting-months",monthsDeleted:0,totalMonths:T,budgetsDeleted:0,totalBudgets:R,percentComplete:0});for(const V of l.budgets)try{const k=(await Zn("months",`delete sample user budget: fetching month IDs for budget ${V.budgetId}`)).docs.filter(M=>M.data.budget_id===V.budgetId).map(M=>({collectionPath:"months",docId:M.id}));k.length>0&&(await xT(k,`delete sample user budget: deleting ${k.length} months for budget ${V.budgetId}`,M=>{x=M,g({phase:"deleting-months",monthsDeleted:x,totalMonths:T,budgetsDeleted:S,totalBudgets:R,percentComplete:Math.round(x/Math.max(T,1)*60)})}),x=k.length)}catch($){w.push(`Failed to delete months for budget ${V.budgetId}: ${$ instanceof Error?$.message:"Unknown error"}`)}g({phase:"deleting-payees",monthsDeleted:x,totalMonths:T,budgetsDeleted:S,totalBudgets:R,percentComplete:60});for(const V of l.budgets)try{await Oy("payees",V.budgetId,`delete sample user budget: deleting payees for budget ${V.budgetId}`),C++}catch{}g({phase:"deleting-budgets",monthsDeleted:x,totalMonths:T,budgetsDeleted:S,totalBudgets:R,percentComplete:70});for(const V of l.budgets)try{await Oy("budgets",V.budgetId,`delete sample user budget: deleting budget ${V.budgetId}`),S++,g({phase:"deleting-budgets",monthsDeleted:x,totalMonths:T,budgetsDeleted:S,totalBudgets:R,percentComplete:70+Math.round(S/R*10)})}catch($){w.push(`Failed to delete budget ${V.budgetId}: ${$ instanceof Error?$.message:"Unknown error"}`)}g({phase:"updating-user",monthsDeleted:x,totalMonths:T,budgetsDeleted:S,totalBudgets:R,percentComplete:80});const D=[...l.budgets.map(V=>V.budgetId),...l.staleBudgetIds];try{const V=await Zn("users","delete sample user budget: finding sample user document to remove budget references",[{field:"email",op:"==",value:Kg}]);if(V.docs.length>0){const $=V.docs[0],k=$.id,M=$.data,B=(M.budget_ids||[]).filter(U=>!D.includes(U));await cr("users",k,{...M,budget_ids:B,updated_at:new Date().toISOString()},"delete sample user budget: removing deleted budget IDs from sample user document"),console.log(`delete sample user budget: removed ${D.length} budget IDs from sample user document`)}else console.log("delete sample user budget: no sample user document found, skipping user update")}catch(V){w.push(`Failed to update sample user document: ${V instanceof Error?V.message:"Unknown error"}`)}g({phase:"clearing-cache",monthsDeleted:x,totalMonths:T,budgetsDeleted:S,totalBudgets:R,percentComplete:95}),La(),g({phase:"complete",monthsDeleted:x,totalMonths:T,budgetsDeleted:S,totalBudgets:R,percentComplete:100}),f({budgetsDeleted:S,monthsDeleted:x,payeesDeleted:C,errors:w}),o(!1),g(null),w.length===0&&(d({budgets:[],totalBudgets:0,totalMonths:0,hasPayees:!1,staleBudgetIds:[]}),e?.())}return{status:l,isScanning:n,scanStatus:b,isDeleting:i,deleteResult:h,deleteProgress:p,deleteSampleUserBudget:_}}function LS(t){if(!t)return 0;let e=0;for(const n of t)ht(n.start_balance??0)&&e++,ht(n.end_balance??0)&&e++,ht(n.allocated??0)&&e++,ht(n.spent??0)&&e++,ht(n.income??0)&&e++,ht(n.expenses??0)&&e++,ht(n.net_change??0)&&e++;return e}function US(t){if(!t)return 0;let e=0;for(const n of t)ht(n.amount??0)&&e++;return e}async function FS(){const t=await Zn("budgets","precision cleanup: scanning all budgets");let e=0,n=0,r=0,i=0;for(const g of t.docs){const b=g.data;let _=!1;ht(b.total_available??0)&&(i++,_=!0);const w=b.accounts;if(w&&typeof w=="object")for(const S of Object.values(w))ht(S.balance??0)&&(n++,_=!0);const x=b.categories;if(x&&typeof x=="object")for(const S of Object.values(x))ht(S.balance??0)&&(r++,_=!0),ht(S.default_monthly_amount??0)&&(r++,_=!0);_&&e++}const o=await Zn("months","precision cleanup: scanning all months");let l=0,d=0,h=0,f=0,p=0;for(const g of o.docs){const b=g.data;let _=!1;(ht(b.total_income??0)||ht(b.total_expenses??0)||ht(b.previous_month_income??0))&&(_=!0);const w=US(b.income);w>0&&(d+=w,_=!0);const x=US(b.expenses);x>0&&(h+=x,_=!0);const S=LS(b.category_balances);S>0&&(f+=S,_=!0);const C=LS(b.account_balances);C>0&&(p+=C,_=!0),_&&l++}return{totalBudgets:t.docs.length,budgetsWithPrecisionIssues:e,accountsWithPrecisionIssues:n,categoriesWithPrecisionIssues:r,totalAvailableWithPrecisionIssues:i,totalMonths:o.docs.length,monthsWithPrecisionIssues:l,incomeValuesWithPrecisionIssues:d,expenseValuesWithPrecisionIssues:h,categoryBalancesWithPrecisionIssues:f,accountBalancesWithPrecisionIssues:p}}function VS(t){const e={...t};return e.start_balance!==void 0&&(e.start_balance=Ae(e.start_balance)),e.end_balance!==void 0&&(e.end_balance=Ae(e.end_balance)),e.allocated!==void 0&&(e.allocated=Ae(e.allocated)),e.spent!==void 0&&(e.spent=Ae(e.spent)),e.income!==void 0&&(e.income=Ae(e.income)),e.expenses!==void 0&&(e.expenses=Ae(e.expenses)),e.transfers!==void 0&&(e.transfers=Ae(e.transfers)),e.adjustments!==void 0&&(e.adjustments=Ae(e.adjustments)),e.net_change!==void 0&&(e.net_change=Ae(e.net_change)),e}function B3(t,e){let n=!1;ht(t.total_available??0)&&(t.total_available=Ae(t.total_available??0),e.totalAvailableFixed++,n=!0);const r=t.accounts;if(r&&typeof r=="object")for(const[o,l]of Object.entries(r)){const d=l;ht(d.balance??0)&&(r[o].balance=Ae(d.balance??0),e.accountsFixed++,n=!0)}const i=t.categories;if(i&&typeof i=="object")for(const[o,l]of Object.entries(i)){const d=l;ht(d.balance??0)&&(i[o].balance=Ae(d.balance??0),e.categoriesFixed++,n=!0),ht(d.default_monthly_amount??0)&&(i[o].default_monthly_amount=Ae(d.default_monthly_amount??0),e.categoriesFixed++,n=!0)}return{fixed:n,data:t}}function z3(t,e){let n=!1;if(ht(t.total_income??0)&&(t.total_income=Ae(t.total_income??0),n=!0),ht(t.total_expenses??0)&&(t.total_expenses=Ae(t.total_expenses??0),n=!0),ht(t.previous_month_income??0)&&(t.previous_month_income=Ae(t.previous_month_income??0),n=!0),t.income&&Array.isArray(t.income)){const r=[];for(const i of t.income)ht(i.amount??0)?(r.push({...i,amount:Ae(i.amount??0)}),e.incomeValuesFixed++,n=!0):r.push(i);t.income=r}if(t.expenses&&Array.isArray(t.expenses)){const r=[];for(const i of t.expenses)ht(i.amount??0)?(r.push({...i,amount:Ae(i.amount??0)}),e.expenseValuesFixed++,n=!0):r.push(i);t.expenses=r}if(t.category_balances&&Array.isArray(t.category_balances)){const r=[];for(const i of t.category_balances)ht(i.start_balance??0)||ht(i.end_balance??0)||ht(i.allocated??0)||ht(i.spent??0)||ht(i.transfers??0)||ht(i.adjustments??0)?(r.push(VS(i)),e.categoryBalancesFixed++,n=!0):r.push(i);t.category_balances=r}if(t.account_balances&&Array.isArray(t.account_balances)){const r=[];for(const i of t.account_balances)ht(i.start_balance??0)||ht(i.end_balance??0)||ht(i.income??0)||ht(i.expenses??0)||ht(i.transfers??0)||ht(i.adjustments??0)||ht(i.net_change??0)?(r.push(VS(i)),e.accountBalancesFixed++,n=!0):r.push(i);t.account_balances=r}return{fixed:n,data:t}}function L3(t,e,n){const r={...t.data},{fixed:i,data:o}=B3(r,n),l=i?{budgetId:t.id,data:o}:null;i&&n.budgetsProcessed++;const d=[];let h=!1;for(const f of e){const p={...f.data},{fixed:g,data:b}=z3(p,n);g&&(n.monthsProcessed++,h=!0),d.push(b)}return{budgetUpdate:l,fixedMonths:d,hasMonthFixes:h}}async function U3(){const t={budgetsProcessed:0,accountsFixed:0,categoriesFixed:0,totalAvailableFixed:0,monthsProcessed:0,incomeValuesFixed:0,expenseValuesFixed:0,categoryBalancesFixed:0,accountBalancesFixed:0,errors:[]},{budgets:e,monthsByBudget:n}=await rr("precision cleanup"),r=[],i=[];for(const o of e)try{const l=n.get(o.id)||[],{budgetUpdate:d,fixedMonths:h,hasMonthFixes:f}=L3(o,l,t);d&&r.push(d),(f||h.length>0)&&i.push({budgetId:o.id,months:h})}catch(l){t.errors.push(`Budget ${o.id}: ${l instanceof Error?l.message:String(l)}`)}if(r.length>0)try{await Y0(r,"precision cleanup")}catch(o){t.errors.push(`Budget batch write: ${o instanceof Error?o.message:String(o)}`)}for(const{budgetId:o,months:l}of i)try{await tA(o,l,"precision cleanup")}catch(d){t.errors.push(`Budget ${o} recalc: ${d instanceof Error?d.message:String(d)}`)}return t}function F3({currentUser:t,onComplete:e}){const[n,r]=j.useState(null),[i,o]=j.useState(!1),[l,d]=j.useState(!1),[h,f]=j.useState(null),[p,g]=j.useState(null),b=n?n.accountsWithPrecisionIssues+n.categoriesWithPrecisionIssues+n.totalAvailableWithPrecisionIssues+n.incomeValuesWithPrecisionIssues+n.expenseValuesWithPrecisionIssues+n.categoryBalancesWithPrecisionIssues+n.accountBalancesWithPrecisionIssues:0,_=b>0,w=j.useCallback(async()=>{if(t){o(!0),g(null);try{const S=await FS();r(S),f(null)}catch(S){g(S instanceof Error?S.message:"Failed to scan for precision issues")}finally{o(!1)}}},[t]),x=j.useCallback(async()=>{if(!(!t||!_)){d(!0),g(null);try{const S=await Em(()=>U3());f(S);const C=await FS();r(C),e?.()}catch(S){g(S instanceof Error?S.message:"Failed to run precision cleanup")}finally{d(!1)}}},[t,_,e]);return{status:n,isScanning:i,isRunning:l,result:h,error:p,totalIssues:b,hasIssues:_,hasData:n!==null,scan:w,runCleanup:x}}function Cm(t){const e=t.income||[],n=t.expenses||[],r=Ae(e.reduce((d,h)=>d+h.amount,0)),i=Ae(n.reduce((d,h)=>d+h.amount,0)),o=V3(t),l=$3(t);return{...t,total_income:r,total_expenses:i,account_balances:o,category_balances:l}}function V3(t){const e=t.income||[],n=t.expenses||[],r=t.transfers||[],i=t.adjustments||[],o=t.account_balances||[],l=new Map;for(const f of o)Ke(f.account_id)||l.set(f.account_id,f);const d=new Set;for(const f of e)Ke(f.account_id)||d.add(f.account_id);for(const f of n)Ke(f.account_id)||d.add(f.account_id);for(const f of r)Ke(f.from_account_id)||d.add(f.from_account_id),Ke(f.to_account_id)||d.add(f.to_account_id);for(const f of i)Ke(f.account_id)||d.add(f.account_id);for(const f of o)Ke(f.account_id)||d.add(f.account_id);const h=[];for(const f of d){const p=l.get(f),g=Ae(p?.start_balance??0),b=Ae(e.filter(R=>R.account_id===f).reduce((R,D)=>R+D.amount,0)),_=Ae(n.filter(R=>R.account_id===f).reduce((R,D)=>R+D.amount,0)),w=Ae(r.filter(R=>R.from_account_id===f).reduce((R,D)=>R-D.amount,0)),x=Ae(r.filter(R=>R.to_account_id===f).reduce((R,D)=>R+D.amount,0)),S=Ae(x+w),C=Ae(i.filter(R=>R.account_id===f).reduce((R,D)=>R+D.amount,0)),T=Ae(b+_+S+C);h.push({account_id:f,start_balance:g,income:b,expenses:_,transfers:S,adjustments:C,net_change:T,end_balance:Ae(g+T)})}return h}function $3(t){const e=t.expenses||[],n=t.transfers||[],r=t.adjustments||[],i=t.category_balances||[],o=new Map;for(const g of i)ot(g.category_id)||o.set(g.category_id,g);const{spentMap:l,transfersMap:d,adjustmentsMap:h}=CT(e,n,r),f=new Set;for(const g of i)ot(g.category_id)||f.add(g.category_id);for(const g of e)ot(g.category_id)||f.add(g.category_id);for(const g of n)ot(g.from_category_id)||f.add(g.from_category_id),ot(g.to_category_id)||f.add(g.to_category_id);for(const g of r)ot(g.category_id)||f.add(g.category_id);const p=[];for(const g of f){const b=o.get(g),_=l[g]??0,w=d[g]??0,x=h[g]??0;if(b){const S=Ae(b.start_balance),C=Ae(b.allocated);p.push({category_id:g,start_balance:S,allocated:C,spent:_,transfers:w,adjustments:x,end_balance:Ae(S+C+_+w+x)})}else p.push({category_id:g,start_balance:0,allocated:0,spent:_,transfers:w,adjustments:x,end_balance:Ae(_+w+x)})}return p}const q3=["unknown","Unknown","UNKNOWN","","null","undefined","N/A","n/a"],H3=["unknown","Unknown","UNKNOWN","","null","undefined","N/A","n/a"];function Tm(t){return!t||Ke(t)?!0:q3.includes(t)}function Am(t){return!t||ot(t)?!0:H3.includes(t)}function nA(t){return Tm(t.account_id)||Am(t.category_id)}function G3(t){return{id:t.id.replace("expense_","adjustment_"),amount:t.amount,account_id:Tm(t.account_id)?Ht:t.account_id,category_id:Am(t.category_id)?Yt:t.category_id,date:t.date,description:t.description||t.payee,cleared:t.cleared,created_at:t.created_at}}function W3(t){const e=t.data,n=e.expenses||[],r=e.adjustments||[],i=[],o=[];let l=0,d=0;for(const f of n)nA(f)?(Tm(f.account_id)&&!Ke(f.account_id)&&l++,Am(f.category_id)&&!ot(f.category_id)&&d++,o.push(G3(f))):i.push(f);return o.length===0?{needsUpdate:!1,updatedMonth:null,stats:{expensesMigrated:0,invalidAccountsFixed:0,invalidCategoriesFixed:0}}:{needsUpdate:!0,updatedMonth:Cm({...e,expenses:i,adjustments:[...r,...o],transfers:e.transfers||[],updated_at:new Date().toISOString()}),stats:{expensesMigrated:o.length,invalidAccountsFixed:l,invalidCategoriesFixed:d}}}async function Q3(){const{budgets:t,monthsByBudget:e}=await rr("expense-to-adjustment-scan");let n=0,r=0,i=0,o=0;for(const l of t){const d=e.get(l.id)||[];n+=d.length;for(const h of d){const p=h.data.expenses||[];for(const g of p)nA(g)&&(r++,Tm(g.account_id)&&!Ke(g.account_id)&&i++,Am(g.category_id)&&!ot(g.category_id)&&o++)}}return{totalBudgets:t.length,totalMonths:n,expensesToMigrate:r,invalidAccountsToFix:i,invalidCategoriesToFix:o}}async function K3(){const{budgets:t,monthsByBudget:e}=await rr("expense-to-adjustment-migration"),n=[];let r=0,i=0,o=0;const l=[];for(const d of t){const h=e.get(d.id)||[];for(const f of h)try{const{needsUpdate:p,updatedMonth:g,stats:b}=W3(f);p&&g&&(n.push({budgetId:d.id,year:f.year,month:f.month,data:g}),r+=b.expensesMigrated,i+=b.invalidAccountsFixed,o+=b.invalidCategoriesFixed)}catch(p){l.push(`Month ${f.year}/${f.month} in budget ${d.id}: ${p instanceof Error?p.message:String(p)}`)}}return n.length>0&&await Ha(n,"expense-to-adjustment-migration"),{budgetsProcessed:t.length,monthsProcessed:n.length,expensesMigrated:r,invalidAccountsFixed:i,invalidCategoriesFixed:o,errors:l}}function Y3({currentUser:t,onComplete:e}){const[n,r]=j.useState(!1),[i,o]=j.useState(!1),[l,d]=j.useState(null),[h,f]=j.useState(null);async function p(){if(t){r(!0);try{const _=await Q3();d(_)}catch(_){console.error("Failed to scan for expense to adjustment migration:",_)}finally{r(!1)}}}async function g(){if(t){o(!0),f(null);try{const _=await Em(()=>K3());f(_),e?.()}catch(_){f({budgetsProcessed:0,monthsProcessed:0,expensesMigrated:0,invalidAccountsFixed:0,invalidCategoriesFixed:0,errors:[_ instanceof Error?_.message:"Unknown error"]})}finally{o(!1)}}}const b=l!==null&&l.expensesToMigrate>0;return{status:l,isScanning:n,scanStatus:p,hasItemsToMigrate:b,isRunning:i,result:h,runMigration:g}}function rA(t){const e=new Set,n=new Set,r=t.categories;if(r)for(const o of Object.keys(r))e.add(o);const i=t.accounts;if(i)for(const o of Object.keys(i))n.add(o);return{categoryIds:e,accountIds:n}}function va(t,e){return!t||ot(t)?!1:!e.has(t)}function Us(t,e){return!t||Ke(t)?!1:!e.has(t)}function X3(t,e){const n=t.data;let r=0,i=0,o=0,l=0,d=0,h=0,f=!1;const p=(n.expenses||[]).map(x=>{const S={...x};let C=!1;return va(x.category_id,e.categoryIds)&&(S.category_id=Yt,r++,C=!0),Us(x.account_id,e.accountIds)&&(S.account_id=Ht,i++,C=!0),C&&(o++,f=!0),S}),g=(n.income||[]).map(x=>{const S={...x};let C=!1;return Us(x.account_id,e.accountIds)&&(S.account_id=Ht,i++,C=!0),C&&(l++,f=!0),S}),b=(n.transfers||[]).map(x=>{const S={...x};let C=!1;return va(x.from_category_id,e.categoryIds)&&(S.from_category_id=Yt,r++,C=!0),va(x.to_category_id,e.categoryIds)&&(S.to_category_id=Yt,r++,C=!0),Us(x.from_account_id,e.accountIds)&&(S.from_account_id=Ht,i++,C=!0),Us(x.to_account_id,e.accountIds)&&(S.to_account_id=Ht,i++,C=!0),C&&(d++,f=!0),S}),_=(n.adjustments||[]).map(x=>{const S={...x};let C=!1;return va(x.category_id,e.categoryIds)&&(S.category_id=Yt,r++,C=!0),Us(x.account_id,e.accountIds)&&(S.account_id=Ht,i++,C=!0),C&&(h++,f=!0),S});return f?{needsUpdate:!0,updatedMonth:{...n,expenses:p,income:g,transfers:b,adjustments:_,updated_at:new Date().toISOString()},stats:{categoryIdsFixed:r,accountIdsFixed:i,affectedExpenses:o,affectedIncome:l,affectedTransfers:d,affectedAdjustments:h}}:{needsUpdate:!1,updatedMonth:null,stats:{categoryIdsFixed:0,accountIdsFixed:0,affectedExpenses:0,affectedIncome:0,affectedTransfers:0,affectedAdjustments:0}}}async function Z3(){const{budgets:t,monthsByBudget:e}=await rr("orphaned-id-scan");let n=0,r=0,i=0,o=0,l=0,d=0,h=0;for(const f of t){const p=rA(f.data),g=e.get(f.id)||[];n+=g.length;for(const b of g){const _=b.data;for(const w of _.expenses||[]){let x=!1;va(w.category_id,p.categoryIds)&&(r++,x=!0),Us(w.account_id,p.accountIds)&&(i++,x=!0),x&&o++}for(const w of _.income||[])Us(w.account_id,p.accountIds)&&(i++,l++);for(const w of _.transfers||[]){let x=!1;va(w.from_category_id,p.categoryIds)&&(r++,x=!0),va(w.to_category_id,p.categoryIds)&&(r++,x=!0),Us(w.from_account_id,p.accountIds)&&(i++,x=!0),Us(w.to_account_id,p.accountIds)&&(i++,x=!0),x&&d++}for(const w of _.adjustments||[]){let x=!1;va(w.category_id,p.categoryIds)&&(r++,x=!0),Us(w.account_id,p.accountIds)&&(i++,x=!0),x&&h++}}}return{totalBudgets:t.length,totalMonths:n,orphanedCategoryIds:r,orphanedAccountIds:i,affectedExpenses:o,affectedIncome:l,affectedTransfers:d,affectedAdjustments:h}}async function J3(){const{budgets:t,monthsByBudget:e}=await rr("orphaned-id-cleanup"),n=[];let r=0,i=0;const o=[];for(const l of t){const d=rA(l.data),h=e.get(l.id)||[];for(const f of h)try{const{needsUpdate:p,updatedMonth:g,stats:b}=X3(f,d);p&&g&&(n.push({budgetId:l.id,year:f.year,month:f.month,data:g}),r+=b.categoryIdsFixed,i+=b.accountIdsFixed)}catch(p){o.push(`Month ${f.year}/${f.month} in budget ${l.id}: ${p instanceof Error?p.message:String(p)}`)}}return n.length>0&&await Ha(n,"orphaned-id-cleanup"),{budgetsProcessed:t.length,monthsProcessed:n.length,categoryIdsFixed:r,accountIdsFixed:i,errors:o}}function eP({currentUser:t,onComplete:e}){const[n,r]=j.useState(!1),[i,o]=j.useState(!1),[l,d]=j.useState(null),[h,f]=j.useState(null);async function p(){if(t){r(!0);try{const _=await Z3();d(_)}catch(_){console.error("Failed to scan for orphaned IDs:",_)}finally{r(!1)}}}async function g(){if(t){o(!0),f(null);try{const _=await Em(()=>J3());f(_),e?.()}catch(_){f({budgetsProcessed:0,monthsProcessed:0,categoryIdsFixed:0,accountIdsFixed:0,errors:[_ instanceof Error?_.message:"Unknown error"]})}finally{o(!1)}}}const b=l!==null&&(l.orphanedCategoryIds>0||l.orphanedAccountIds>0);return{status:l,isScanning:n,scanStatus:p,hasItemsToFix:b,isRunning:i,result:h,runMigration:g}}function tP(t,e){if(t.date!==e.date||Math.abs(t.amount+e.amount)>.001)return null;const n=t.amount<0?t:e,r=t.amount<0?e:t,i=ot(t.category_id)&&ot(e.category_id),o=!Ke(t.account_id)&&!Ke(e.account_id),l=t.account_id!==e.account_id;if(i&&o&&l)return{negative:n,positive:r,type:"account"};const d=Ke(t.account_id)&&Ke(e.account_id),h=!ot(t.category_id)&&!ot(e.category_id),f=t.category_id!==e.category_id;return d&&h&&f?{negative:n,positive:r,type:"category"}:null}function sA(t){const e=[],n=new Set;for(let r=0;r<t.length;r++)if(!n.has(t[r].id))for(let i=r+1;i<t.length;i++){if(n.has(t[i].id))continue;const o=tP(t[r],t[i]);if(o){e.push(o),n.add(t[r].id),n.add(t[i].id);break}}return e}function nP(t){const{negative:e,positive:n,type:r}=t;return r==="account"?{id:`transfer_from_adj_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,amount:Math.abs(e.amount),from_account_id:e.account_id,to_account_id:n.account_id,from_category_id:Yt,to_category_id:Yt,date:e.date,description:e.description||n.description||"Transfer",cleared:e.cleared&&n.cleared,created_at:new Date().toISOString()}:{id:`transfer_from_adj_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,amount:Math.abs(e.amount),from_account_id:Ht,to_account_id:Ht,from_category_id:e.category_id,to_category_id:n.category_id,date:e.date,description:e.description||n.description||"Transfer",cleared:e.cleared&&n.cleared,created_at:new Date().toISOString()}}function rP(t){const e=t.data,n=e.adjustments||[],r=e.transfers||[],i=sA(n);if(i.length===0)return{needsUpdate:!1,updatedMonth:null,stats:{pairsConverted:0,adjustmentsRemoved:0}};const o=i.map(nP),l=new Set;for(const f of i)l.add(f.negative.id),l.add(f.positive.id);const d=n.filter(f=>!l.has(f.id));return{needsUpdate:!0,updatedMonth:{...e,adjustments:d,transfers:[...r,...o],updated_at:new Date().toISOString()},stats:{pairsConverted:i.length,adjustmentsRemoved:l.size}}}async function sP(){const{budgets:t,monthsByBudget:e}=await rr("adjustments-to-transfers-scan");let n=0,r=0,i=0,o=0;for(const l of t){const d=e.get(l.id)||[];n+=d.length;for(const h of d){const p=h.data.adjustments||[],g=sA(p);r+=g.length;for(const b of g)b.type==="account"?i++:o++}}return{totalBudgets:t.length,totalMonths:n,pairsFound:r,accountTransferPairs:i,categoryTransferPairs:o}}async function iP(){const{budgets:t,monthsByBudget:e}=await rr("adjustments-to-transfers-migration"),n=[];let r=0,i=0;const o=[];for(const l of t){const d=e.get(l.id)||[];for(const h of d)try{const{needsUpdate:f,updatedMonth:p,stats:g}=rP(h);f&&p&&(n.push({budgetId:l.id,year:h.year,month:h.month,data:p}),r+=g.pairsConverted,i+=g.adjustmentsRemoved)}catch(f){o.push(`Month ${h.year}/${h.month} in budget ${l.id}: ${f instanceof Error?f.message:String(f)}`)}}return n.length>0&&await Ha(n,"adjustments-to-transfers-migration"),{budgetsProcessed:t.length,monthsProcessed:n.length,transfersCreated:r,adjustmentsRemoved:i,errors:o}}function aP({currentUser:t,onComplete:e}){const[n,r]=j.useState(!1),[i,o]=j.useState(!1),[l,d]=j.useState(null),[h,f]=j.useState(null);async function p(){if(t){r(!0);try{const _=await sP();d(_)}catch(_){console.error("Failed to scan for adjustment pairs:",_)}finally{r(!1)}}}async function g(){if(t){o(!0),f(null);try{const _=await Em(()=>iP());f(_),e?.()}catch(_){f({budgetsProcessed:0,monthsProcessed:0,transfersCreated:0,adjustmentsRemoved:0,errors:[_ instanceof Error?_.message:"Unknown error"]})}finally{o(!1)}}}const b=l!==null&&l.pairsFound>0;return{status:l,isScanning:n,scanStatus:p,hasPairsToConvert:b,isRunning:i,result:h,runMigration:g}}function oP(t){const e=[];let n="",r=!1;for(let i=0;i<t.length;i++){const o=t[i];o==='"'?r=!r:o===","&&!r?(e.push(n.trim()),n=""):n+=o}return e.push(n.trim()),e}function lP(t){if(!t)return 0;let e=t.replace(/[$\s]/g,"");const n=e.startsWith("(")||e.startsWith("-");e=e.replace(/[()]/g,"").replace("-",""),e=e.replace(/,/g,"");const r=parseFloat(e);return isNaN(r)?0:n?-r:r}function cP(t){if(!t)return null;const e=t.split("/");if(e.length!==3)return null;const n=parseInt(e[0],10),r=parseInt(e[1],10),i=parseInt(e[2],10);return isNaN(n)||isNaN(r)||isNaN(i)||n<1||n>12||r<1||r>31?null:{year:i,month:n,day:r}}function uP(t){if(!t)return!1;const e=t.toLowerCase().trim();return e==="true"||e==="1"||e==="yes"}function dP(t,e){return e.toLowerCase()==="income"?"income":t.toLowerCase()==="budget allocation"?"allocation":"spend"}function hP(t){const e=t.split(`
`).filter(r=>r.trim()),n=[];for(const r of e){const i=oP(r);if(i.length<5)continue;const[o,l,d,h,f,p,g]=i;if(o.toLowerCase()==="cash flow"||o.toLowerCase()==="date")continue;const b=cP(o);if(!b)continue;const _=dP(l,d),w=lP(f),x=uP(g||"");n.push({recordType:_,date:o,year:b.year,month:b.month,day:b.day,payee:l,category:d,account:h,amount:w,description:p||"",cleared:x,rawLine:r})}return n}function fP(t){return!t.account_id||t.account_id.trim()===""?"Missing account_id (empty or undefined)":null}function mP(t){const e=[];return(!t.account_id||t.account_id.trim()==="")&&e.push("missing account_id"),(!t.category_id||t.category_id.trim()==="")&&e.push("missing category_id"),e.length>0?e.join(", "):null}function pP(t){const e=Ke(t.account_id)||!t.account_id||t.account_id.trim()==="",n=ot(t.category_id)||!t.category_id||t.category_id.trim()==="";return e&&n?"Both account_id and category_id are missing/NO_* (must have at least one real ID)":null}function gP(t){const e=[];if((!t.from_account_id||t.from_account_id.trim()==="")&&e.push("missing from_account_id"),(!t.to_account_id||t.to_account_id.trim()==="")&&e.push("missing to_account_id"),(!t.from_category_id||t.from_category_id.trim()==="")&&e.push("missing from_category_id"),(!t.to_category_id||t.to_category_id.trim()==="")&&e.push("missing to_category_id"),e.length>0)return e.join(", ");const n=t.from_account_id===t.to_account_id,r=t.from_category_id===t.to_category_id;if(n&&r)return"Transfer has same from/to on both account and category (nothing would transfer)";const i=Ke(t.from_account_id),o=Ke(t.to_account_id),l=ot(t.from_category_id),d=ot(t.to_category_id);return i&&o&&l&&d?"All from/to account and category IDs are NO_* (must involve at least one real entity)":i&&o&&r?"Both accounts are NO_ACCOUNT and categories are the same (nothing transfers)":l&&d&&n?"Both categories are NO_CATEGORY and accounts are the same (nothing transfers)":null}function Xh(t,e,n,r,i){return t.filter(o=>{const[l,d,h]=e.split("-").map(Number);return o.year!==l||o.month!==d||o.day!==h||Math.abs(Math.abs(o.amount)-Math.abs(n))>.01?!1:(r&&o.payee&&o.payee.toLowerCase()===r.toLowerCase()||i&&o.description&&o.description.toLowerCase().includes(i.toLowerCase()),!0)})}async function yP(t){const e=[];let n=0,r=0,i=0,o=0;const l=t?hP(t):[],{budgets:d,monthsByBudget:h}=await rr("account-category-validation");for(const f of d){const p=h.get(f.id)||[];for(const g of p){const b=g.data,_=`${b.year}-${String(b.month).padStart(2,"0")}`,w=b.income||[];n+=w.length;for(const T of w){const R=fP(T);R&&e.push({budgetId:f.id,monthKey:_,transactionType:"income",transactionId:T.id,violation:R,transactionDetails:{date:T.date,amount:T.amount,payee:T.payee,description:T.description,accountId:T.account_id},potentialSeedMatches:Xh(l,T.date,T.amount,T.payee,T.description)})}const x=b.expenses||[];r+=x.length;for(const T of x){const R=mP(T);R&&e.push({budgetId:f.id,monthKey:_,transactionType:"expense",transactionId:T.id,violation:R,transactionDetails:{date:T.date,amount:T.amount,payee:T.payee,description:T.description,accountId:T.account_id,categoryId:T.category_id},potentialSeedMatches:Xh(l,T.date,T.amount,T.payee,T.description)})}const S=b.adjustments||[];i+=S.length;for(const T of S){const R=pP(T);R&&e.push({budgetId:f.id,monthKey:_,transactionType:"adjustment",transactionId:T.id,violation:R,transactionDetails:{date:T.date,amount:T.amount,description:T.description,accountId:T.account_id,categoryId:T.category_id},potentialSeedMatches:Xh(l,T.date,T.amount,void 0,T.description)})}const C=b.transfers||[];o+=C.length;for(const T of C){const R=gP(T);R&&e.push({budgetId:f.id,monthKey:_,transactionType:"transfer",transactionId:T.id,violation:R,transactionDetails:{date:T.date,amount:T.amount,description:T.description,fromAccountId:T.from_account_id,toAccountId:T.to_account_id,fromCategoryId:T.from_category_id,toCategoryId:T.to_category_id},potentialSeedMatches:Xh(l,T.date,T.amount,void 0,T.description)})}}}return e.sort((f,p)=>{const g=f.monthKey.localeCompare(p.monthKey);return g!==0?g:f.transactionType.localeCompare(p.transactionType)}),{totalBudgets:d.length,totalMonths:Array.from(h.values()).reduce((f,p)=>f+p.length,0),totalIncome:n,totalExpenses:r,totalAdjustments:i,totalTransfers:o,violations:e,scannedAt:new Date().toISOString()}}function _P(t){const e=[];if(e.push("=".repeat(80),"ACCOUNT/CATEGORY VALIDATION REPORT",`Scanned at: ${t.scannedAt}`,"=".repeat(80),"","SUMMARY:"),e.push(`  Budgets scanned: ${t.totalBudgets}`,`  Months scanned: ${t.totalMonths}`,`  Income transactions: ${t.totalIncome}`,`  Expense transactions: ${t.totalExpenses}`,`  Adjustment transactions: ${t.totalAdjustments}`,`  Transfer transactions: ${t.totalTransfers}`,`  VIOLATIONS FOUND: ${t.violations.length}`,""),t.violations.length===0)return e.push(" No violations found!"),e.join(`
`);const n=new Map;for(const r of t.violations)n.has(r.transactionType)||n.set(r.transactionType,[]),n.get(r.transactionType).push(r);e.push("-".repeat(80),"VIOLATIONS BY TYPE:","-".repeat(80));for(const[r,i]of n){e.push("",`## ${r.toUpperCase()} (${i.length} violations)`,"");for(const o of i){if(e.push(`  [${o.monthKey}] ID: ${o.transactionId}`,`    Violation: ${o.violation}`,`    Date: ${o.transactionDetails.date}`,`    Amount: ${o.transactionDetails.amount}`),o.transactionDetails.payee&&e.push(`    Payee: ${o.transactionDetails.payee}`),o.transactionDetails.description&&e.push(`    Description: ${o.transactionDetails.description}`),o.transactionDetails.accountId!==void 0&&e.push(`    Account ID: ${o.transactionDetails.accountId||"(empty)"}`),o.transactionDetails.categoryId!==void 0&&e.push(`    Category ID: ${o.transactionDetails.categoryId||"(empty)"}`),o.transactionDetails.fromAccountId!==void 0&&e.push(`    From Account: ${o.transactionDetails.fromAccountId||"(empty)"}`,`    To Account: ${o.transactionDetails.toAccountId||"(empty)"}`,`    From Category: ${o.transactionDetails.fromCategoryId||"(empty)"}`,`    To Category: ${o.transactionDetails.toCategoryId||"(empty)"}`),o.potentialSeedMatches.length>0){e.push(`    POTENTIAL SEED MATCHES (${o.potentialSeedMatches.length}):`);for(const l of o.potentialSeedMatches.slice(0,5))e.push(`      - Line: ${l.rawLine}`,`        Type: ${l.recordType}, Date: ${l.date}, Payee: ${l.payee}`,`        Category: ${l.category}, Account: ${l.account}`);o.potentialSeedMatches.length>5&&e.push(`      ... and ${o.potentialSeedMatches.length-5} more matches`)}else e.push("    No seed matches found");e.push("")}}return e.join(`
`)}function bP({currentUser:t}){const[e,n]=j.useState(!1),[r,i]=j.useState(null),[o,l]=j.useState(null);async function d(h){if(t){n(!0),i(null),l(null);try{const f=await yP(h);i(f),l(_P(f))}catch(f){console.error("Failed to scan transactions:",f),l(`Error scanning: ${f instanceof Error?f.message:"Unknown error"}`)}finally{n(!1)}}}return{isScanning:e,status:r,report:o,scan:d,hasViolations:r!==null&&r.violations.length>0,violationCount:r?.violations.length??0}}async function vP(){const{budgets:t,monthsByBudget:e}=await rr("remove-total-fields-migration-scan");let n=0,r=0,i=0;for(const l of t){const d=e.get(l.id)||[];for(const h of d){const f=h.data,p="total_income"in f&&f.total_income!==void 0,g="total_expenses"in f&&f.total_expenses!==void 0;p&&r++,g&&i++,(p||g)&&n++}}const o=e.size>0?Array.from(e.values()).reduce((l,d)=>l+d.length,0):0;return{totalBudgets:t.length,totalMonths:o,monthsNeedingMigration:n,monthsWithTotalIncome:r,monthsWithTotalExpenses:i}}async function xP(t){const e={budgetsProcessed:0,monthsProcessed:0,monthsUpdated:0,errors:[]};t.setStage("Reading all budgets and months..."),t.setProgress(null);const{budgets:n,monthsByBudget:r}=await rr("remove-total-fields-migration");t.setDetails(`Found ${n.length} budget(s) to process`);const i=[];t.setStage("Processing months...");let o=0;for(const d of r.values())o+=d.length;let l=0;for(const d of n)try{const h=r.get(d.id)||[];for(const f of h){l++;const p=f.data;t.updateItemProgress(l,o,`Month ${p.year}/${p.month}`);const g="total_income"in p&&p.total_income!==void 0,b="total_expenses"in p&&p.total_expenses!==void 0;if(g||b){const{total_income:_,total_expenses:w,...x}=p;i.push({budgetId:d.id,year:p.year,month:p.month,data:{...x,updated_at:new Date().toISOString()}}),e.monthsUpdated++}e.monthsProcessed++}h.length>0&&e.budgetsProcessed++}catch(h){e.errors.push(`Budget ${d.id}: ${h instanceof Error?h.message:String(h)}`)}return i.length>0&&(t.setStage(`Writing ${i.length} month update(s)...`),t.setProgress(null),t.setCurrentItem(`${i.length} month(s) to update`),await Ha(i,"remove-total-fields-migration")),t.setStage("Migration complete"),t.setProgress(100),e}function wP({currentUser:t}){const[e,n]=j.useState(!1),[r,i]=j.useState(!1),[o,l]=j.useState(null),[d,h]=j.useState(null),{runMigrationWithProgress:f}=yd();async function p(){if(t){n(!0);try{const w=await vP();l(w)}catch(w){console.error("Failed to scan remove total fields status:",w)}finally{n(!1)}}}async function g(){if(t){i(!0),h(null);try{const w=await f("Remove Total Fields Migration",x=>xP(x));h(w)}catch(w){h({budgetsProcessed:0,monthsProcessed:0,monthsUpdated:0,errors:[w instanceof Error?w.message:"Unknown error"]})}finally{i(!1)}}}const b=o!==null&&o.monthsNeedingMigration>0,_=o?.monthsNeedingMigration??0;return{isScanning:e,isRunning:r,status:o,result:d,scanStatus:p,runMigration:g,needsMigration:b,totalItemsToFix:_}}async function SP(){const{budgets:t,monthsByBudget:e}=await rr("remove-previous-month-income-migration-scan");let n=0;for(const i of t){const o=e.get(i.id)||[];for(const l of o){const d=l.data;"previous_month_income"in d&&d.previous_month_income!==void 0&&n++}}const r=e.size>0?Array.from(e.values()).reduce((i,o)=>i+o.length,0):0;return{totalBudgets:t.length,totalMonths:r,monthsNeedingMigration:n}}async function EP(t){const e={budgetsProcessed:0,monthsProcessed:0,monthsUpdated:0,errors:[]},{budgets:n,monthsByBudget:r}=await rr("remove-previous-month-income-migration");t.setStage(`Processing ${n.length} budget(s)...`),t.setProgress(0);const i=[];for(let o=0;o<n.length;o++){const l=n[o];t.setProgress(o/n.length*100),t.setCurrentItem(`Budget ${o+1}/${n.length}: ${l.id}`);try{const d=r.get(l.id)||[];for(const h of d){const f=h.data;if("previous_month_income"in f&&f.previous_month_income!==void 0){const{previous_month_income:g,...b}=f;i.push({budgetId:l.id,year:f.year,month:f.month,data:{...b,updated_at:new Date().toISOString()}}),e.monthsUpdated++}e.monthsProcessed++}d.length>0&&e.budgetsProcessed++}catch(d){e.errors.push(`Budget ${l.id}: ${d instanceof Error?d.message:String(d)}`)}}return i.length>0&&(t.setStage(`Writing ${i.length} month update(s)...`),t.setProgress(null),t.setCurrentItem(`${i.length} month(s) to update`),await Ha(i,"remove-previous-month-income-migration")),t.setStage("Migration complete"),t.setProgress(100),e}function CP({currentUser:t}){const[e,n]=j.useState(!1),[r,i]=j.useState(!1),[o,l]=j.useState(null),[d,h]=j.useState(null),{runMigrationWithProgress:f}=yd();async function p(){if(t){n(!0);try{const w=await SP();l(w)}catch(w){console.error("Failed to scan remove previous month income status:",w)}finally{n(!1)}}}async function g(){if(t){i(!0),h(null);try{const w=await f("Remove Previous Month Income Migration",x=>EP(x));h(w)}catch(w){h({budgetsProcessed:0,monthsProcessed:0,monthsUpdated:0,errors:[w instanceof Error?w.message:"Unknown error"]})}finally{i(!1)}}}const b=o!==null&&o.monthsNeedingMigration>0,_=o?.monthsNeedingMigration??0;return{isScanning:e,isRunning:r,status:o,result:d,scanStatus:p,runMigration:g,needsMigration:b,totalItemsToFix:_}}async function TP(){const{budgets:t,monthsByBudget:e}=await rr("recalculate-start-balances-migration-scan"),n=hd(),r=qe(n.year,n.month);let i=0;for(const l of t){const h=(e.get(l.id)||[]).filter(f=>{const p=f.data;return qe(p.year,p.month)<=r});i+=h.length}const o=e.size>0?Array.from(e.values()).reduce((l,d)=>l+d.length,0):0;return{totalBudgets:t.length,totalMonths:o,monthsNeedingRecalculation:i}}async function AP(t){const e={budgetsProcessed:0,monthsProcessed:0,monthsUpdated:0,errors:[]};t.setStage("Reading all budgets and months..."),t.setProgress(null);const{budgets:n,monthsByBudget:r}=await rr("recalculate-start-balances-migration");t.setDetails(`Found ${n.length} budget(s) to process`);const i=hd(),o=qe(i.year,i.month),l=[];t.setStage("Processing months...");let d=0;for(const f of n){const g=(r.get(f.id)||[]).filter(b=>{const _=b.data;return qe(_.year,_.month)<=o});d+=g.length}let h=0;for(const f of n)try{const g=(r.get(f.id)||[]).filter(_=>{const w=_.data;return qe(w.year,w.month)<=o}).sort((_,w)=>{const x=_.data,S=w.data,C=qe(x.year,x.month),T=qe(S.year,S.month);return C.localeCompare(T)});if(g.length===0){e.budgetsProcessed++;continue}let b=xm;for(const _ of g){h++;const w=_.data,x=w.year,S=w.month;t.updateItemProgress(h,d,`Budget ${f.id}: ${x}/${S}`);const C={budget_id:f.id,year_month_ordinal:w.year_month_ordinal,year:x,month:S,income:w.income||[],total_income:0,previous_month_income:0,expenses:w.expenses||[],total_expenses:0,transfers:w.transfers||[],adjustments:w.adjustments||[],account_balances:w.account_balances||[],category_balances:w.category_balances||[],are_allocations_finalized:w.are_allocations_finalized??!1,created_at:w.created_at,updated_at:w.updated_at},T=fd(C),R=Gu(T,b);b=rc(R);const D=md(R);l.push({budgetId:f.id,year:x,month:S,data:D}),e.monthsUpdated++,e.monthsProcessed++}e.budgetsProcessed++}catch(p){e.errors.push(`Budget ${f.id}: ${p instanceof Error?p.message:String(p)}`)}return l.length>0&&(t.setStage(`Writing ${l.length} month update(s)...`),t.setProgress(null),t.setCurrentItem(`${l.length} month(s) to update`),await Ha(l,"recalculate-start-balances-migration")),t.setStage("Migration complete"),t.setProgress(100),e}function jP({currentUser:t}){const[e,n]=j.useState(!1),[r,i]=j.useState(!1),[o,l]=j.useState(null),[d,h]=j.useState(null),{runMigrationWithProgress:f}=yd();async function p(){if(t){n(!0);try{const w=await TP();l(w)}catch(w){console.error("Failed to scan recalculate start balances status:",w)}finally{n(!1)}}}async function g(){if(t){i(!0),h(null);try{const w=await f("Recalculate Start Balances Migration",x=>AP(x));h(w)}catch(w){h({budgetsProcessed:0,monthsProcessed:0,monthsUpdated:0,errors:[w instanceof Error?w.message:"Unknown error"]})}finally{i(!1)}}}const b=o!==null&&o.monthsNeedingRecalculation>0,_=o?.monthsNeedingRecalculation??0;return{isScanning:e,isRunning:r,status:o,result:d,scanStatus:p,runMigration:g,needsMigration:b,totalItemsToFix:_}}async function RP(){const{budgets:t,monthsByBudget:e}=await rr("repair-month-map-migration-scan");let n=0,r=0,i=0;for(const l of t){const d=e.get(l.id)||[],f=l.data.month_map||{},p=new Set;for(const _ of d){const w=qe(_.year,_.month);p.add(w)}let g=0;for(const _ of p)_ in f||g++;let b=0;for(const _ of Object.keys(f))p.has(_)||b++;(g>0||b>0)&&(n++,r+=g,i+=b)}const o=e.size>0?Array.from(e.values()).reduce((l,d)=>l+d.length,0):0;return{totalBudgets:t.length,totalMonths:o,budgetsNeedingRepair:n,totalMissingMonths:r,totalOrphanedEntries:i}}async function IP(t){const e={budgetsProcessed:0,budgetsUpdated:0,monthsAdded:0,orphanedEntriesRemoved:0,errors:[]};t.setStage("Reading all budgets and months..."),t.setProgress(null);const{budgets:n,monthsByBudget:r}=await rr("repair-month-map-migration");t.setDetails(`Found ${n.length} budget(s) to process`);const i=[];t.setStage("Processing budgets...");let o=0;for(const l of n)try{o++;const d=r.get(l.id)||[],f=l.data.month_map||{};t.updateItemProgress(o,n.length,`Budget ${l.id}`);const p=new Set;for(const w of d){const x=qe(w.year,w.month);p.add(x)}const g={...f};let b=0,_=0;for(const w of p)w in g||(g[w]={},b++);for(const w of Object.keys(g))p.has(w)||(delete g[w],_++);(b>0||_>0)&&(i.push({budgetId:l.id,data:{...l.data,month_map:g,updated_at:new Date().toISOString()}}),e.monthsAdded+=b,e.orphanedEntriesRemoved+=_,e.budgetsUpdated++),e.budgetsProcessed++}catch(d){e.errors.push(`Budget ${l.id}: ${d instanceof Error?d.message:String(d)}`)}return i.length>0&&(t.setStage(`Writing ${i.length} budget update(s)...`),t.setProgress(null),t.setCurrentItem(`${i.length} budget(s) to update`),await Y0(i,"repair-month-map-migration")),t.setStage("Migration complete"),t.setProgress(100),e}function DP({currentUser:t}){const[e,n]=j.useState(!1),[r,i]=j.useState(!1),[o,l]=j.useState(null),[d,h]=j.useState(null),{runMigrationWithProgress:f}=yd();async function p(){if(t){n(!0);try{const w=await RP();l(w)}catch(w){console.error("Failed to scan repair month map status:",w)}finally{n(!1)}}}async function g(){if(t){i(!0),h(null);try{const w=await f("Repair Month Map Migration",x=>IP(x));h(w)}catch(w){h({budgetsProcessed:0,budgetsUpdated:0,monthsAdded:0,orphanedEntriesRemoved:0,errors:[w instanceof Error?w.message:"Unknown error"]})}finally{i(!1)}}}const b=o!==null&&(o.totalMissingMonths>0||o.totalOrphanedEntries>0),_=o?o.totalMissingMonths+o.totalOrphanedEntries:0;return{isScanning:e,isRunning:r,status:o,result:d,scanStatus:p,runMigration:g,needsMigration:b,totalItemsToFix:_}}function Zh(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Yg={exports:{}};var $S;function kP(){return $S||($S=1,(function(t,e){(function(n){t.exports=n()})(function(){return(function n(r,i,o){function l(f,p){if(!i[f]){if(!r[f]){var g=typeof Zh=="function"&&Zh;if(!p&&g)return g(f,!0);if(d)return d(f,!0);var b=new Error("Cannot find module '"+f+"'");throw b.code="MODULE_NOT_FOUND",b}var _=i[f]={exports:{}};r[f][0].call(_.exports,function(w){var x=r[f][1][w];return l(x||w)},_,_.exports,n,r,i,o)}return i[f].exports}for(var d=typeof Zh=="function"&&Zh,h=0;h<o.length;h++)l(o[h]);return l})({1:[function(n,r,i){var o=n("./utils"),l=n("./support"),d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(h){for(var f,p,g,b,_,w,x,S=[],C=0,T=h.length,R=T,D=o.getTypeOf(h)!=="string";C<h.length;)R=T-C,g=D?(f=h[C++],p=C<T?h[C++]:0,C<T?h[C++]:0):(f=h.charCodeAt(C++),p=C<T?h.charCodeAt(C++):0,C<T?h.charCodeAt(C++):0),b=f>>2,_=(3&f)<<4|p>>4,w=1<R?(15&p)<<2|g>>6:64,x=2<R?63&g:64,S.push(d.charAt(b)+d.charAt(_)+d.charAt(w)+d.charAt(x));return S.join("")},i.decode=function(h){var f,p,g,b,_,w,x=0,S=0,C="data:";if(h.substr(0,C.length)===C)throw new Error("Invalid base64 input, it looks like a data url.");var T,R=3*(h=h.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(h.charAt(h.length-1)===d.charAt(64)&&R--,h.charAt(h.length-2)===d.charAt(64)&&R--,R%1!=0)throw new Error("Invalid base64 input, bad content length.");for(T=l.uint8array?new Uint8Array(0|R):new Array(0|R);x<h.length;)f=d.indexOf(h.charAt(x++))<<2|(b=d.indexOf(h.charAt(x++)))>>4,p=(15&b)<<4|(_=d.indexOf(h.charAt(x++)))>>2,g=(3&_)<<6|(w=d.indexOf(h.charAt(x++))),T[S++]=f,_!==64&&(T[S++]=p),w!==64&&(T[S++]=g);return T}},{"./support":30,"./utils":32}],2:[function(n,r,i){var o=n("./external"),l=n("./stream/DataWorker"),d=n("./stream/Crc32Probe"),h=n("./stream/DataLengthProbe");function f(p,g,b,_,w){this.compressedSize=p,this.uncompressedSize=g,this.crc32=b,this.compression=_,this.compressedContent=w}f.prototype={getContentWorker:function(){var p=new l(o.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new h("data_length")),g=this;return p.on("end",function(){if(this.streamInfo.data_length!==g.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),p},getCompressedWorker:function(){return new l(o.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},f.createWorkerFrom=function(p,g,b){return p.pipe(new d).pipe(new h("uncompressedSize")).pipe(g.compressWorker(b)).pipe(new h("compressedSize")).withStreamInfo("compression",g)},r.exports=f},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(n,r,i){var o=n("./stream/GenericWorker");i.STORE={magic:"\0\0",compressWorker:function(){return new o("STORE compression")},uncompressWorker:function(){return new o("STORE decompression")}},i.DEFLATE=n("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(n,r,i){var o=n("./utils"),l=(function(){for(var d,h=[],f=0;f<256;f++){d=f;for(var p=0;p<8;p++)d=1&d?3988292384^d>>>1:d>>>1;h[f]=d}return h})();r.exports=function(d,h){return d!==void 0&&d.length?o.getTypeOf(d)!=="string"?(function(f,p,g,b){var _=l,w=b+g;f^=-1;for(var x=b;x<w;x++)f=f>>>8^_[255&(f^p[x])];return-1^f})(0|h,d,d.length,0):(function(f,p,g,b){var _=l,w=b+g;f^=-1;for(var x=b;x<w;x++)f=f>>>8^_[255&(f^p.charCodeAt(x))];return-1^f})(0|h,d,d.length,0):0}},{"./utils":32}],5:[function(n,r,i){i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!0,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],6:[function(n,r,i){var o=null;o=typeof Promise<"u"?Promise:n("lie"),r.exports={Promise:o}},{lie:37}],7:[function(n,r,i){var o=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",l=n("pako"),d=n("./utils"),h=n("./stream/GenericWorker"),f=o?"uint8array":"array";function p(g,b){h.call(this,"FlateWorker/"+g),this._pako=null,this._pakoAction=g,this._pakoOptions=b,this.meta={}}i.magic="\b\0",d.inherits(p,h),p.prototype.processChunk=function(g){this.meta=g.meta,this._pako===null&&this._createPako(),this._pako.push(d.transformTo(f,g.data),!1)},p.prototype.flush=function(){h.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},p.prototype.cleanUp=function(){h.prototype.cleanUp.call(this),this._pako=null},p.prototype._createPako=function(){this._pako=new l[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var g=this;this._pako.onData=function(b){g.push({data:b,meta:g.meta})}},i.compressWorker=function(g){return new p("Deflate",g)},i.uncompressWorker=function(){return new p("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(n,r,i){function o(_,w){var x,S="";for(x=0;x<w;x++)S+=String.fromCharCode(255&_),_>>>=8;return S}function l(_,w,x,S,C,T){var R,D,V=_.file,$=_.compression,k=T!==f.utf8encode,M=d.transformTo("string",T(V.name)),B=d.transformTo("string",f.utf8encode(V.name)),U=V.comment,q=d.transformTo("string",T(U)),I=d.transformTo("string",f.utf8encode(U)),N=B.length!==V.name.length,O=I.length!==U.length,J="",Y="",G="",Z=V.dir,Q=V.date,te={crc32:0,compressedSize:0,uncompressedSize:0};w&&!x||(te.crc32=_.crc32,te.compressedSize=_.compressedSize,te.uncompressedSize=_.uncompressedSize);var z=0;w&&(z|=8),k||!N&&!O||(z|=2048);var H=0,re=0;Z&&(H|=16),C==="UNIX"?(re=798,H|=(function(ce,he){var we=ce;return ce||(we=he?16893:33204),(65535&we)<<16})(V.unixPermissions,Z)):(re=20,H|=(function(ce){return 63&(ce||0)})(V.dosPermissions)),R=Q.getUTCHours(),R<<=6,R|=Q.getUTCMinutes(),R<<=5,R|=Q.getUTCSeconds()/2,D=Q.getUTCFullYear()-1980,D<<=4,D|=Q.getUTCMonth()+1,D<<=5,D|=Q.getUTCDate(),N&&(Y=o(1,1)+o(p(M),4)+B,J+="up"+o(Y.length,2)+Y),O&&(G=o(1,1)+o(p(q),4)+I,J+="uc"+o(G.length,2)+G);var ne="";return ne+=`
\0`,ne+=o(z,2),ne+=$.magic,ne+=o(R,2),ne+=o(D,2),ne+=o(te.crc32,4),ne+=o(te.compressedSize,4),ne+=o(te.uncompressedSize,4),ne+=o(M.length,2),ne+=o(J.length,2),{fileRecord:g.LOCAL_FILE_HEADER+ne+M+J,dirRecord:g.CENTRAL_FILE_HEADER+o(re,2)+ne+o(q.length,2)+"\0\0\0\0"+o(H,4)+o(S,4)+M+J+q}}var d=n("../utils"),h=n("../stream/GenericWorker"),f=n("../utf8"),p=n("../crc32"),g=n("../signature");function b(_,w,x,S){h.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=w,this.zipPlatform=x,this.encodeFileName=S,this.streamFiles=_,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}d.inherits(b,h),b.prototype.push=function(_){var w=_.meta.percent||0,x=this.entriesCount,S=this._sources.length;this.accumulate?this.contentBuffer.push(_):(this.bytesWritten+=_.data.length,h.prototype.push.call(this,{data:_.data,meta:{currentFile:this.currentFile,percent:x?(w+100*(x-S-1))/x:100}}))},b.prototype.openedSource=function(_){this.currentSourceOffset=this.bytesWritten,this.currentFile=_.file.name;var w=this.streamFiles&&!_.file.dir;if(w){var x=l(_,w,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:x.fileRecord,meta:{percent:0}})}else this.accumulate=!0},b.prototype.closedSource=function(_){this.accumulate=!1;var w=this.streamFiles&&!_.file.dir,x=l(_,w,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(x.dirRecord),w)this.push({data:(function(S){return g.DATA_DESCRIPTOR+o(S.crc32,4)+o(S.compressedSize,4)+o(S.uncompressedSize,4)})(_),meta:{percent:100}});else for(this.push({data:x.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},b.prototype.flush=function(){for(var _=this.bytesWritten,w=0;w<this.dirRecords.length;w++)this.push({data:this.dirRecords[w],meta:{percent:100}});var x=this.bytesWritten-_,S=(function(C,T,R,D,V){var $=d.transformTo("string",V(D));return g.CENTRAL_DIRECTORY_END+"\0\0\0\0"+o(C,2)+o(C,2)+o(T,4)+o(R,4)+o($.length,2)+$})(this.dirRecords.length,x,_,this.zipComment,this.encodeFileName);this.push({data:S,meta:{percent:100}})},b.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},b.prototype.registerPrevious=function(_){this._sources.push(_);var w=this;return _.on("data",function(x){w.processChunk(x)}),_.on("end",function(){w.closedSource(w.previous.streamInfo),w._sources.length?w.prepareNextSource():w.end()}),_.on("error",function(x){w.error(x)}),this},b.prototype.resume=function(){return!!h.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},b.prototype.error=function(_){var w=this._sources;if(!h.prototype.error.call(this,_))return!1;for(var x=0;x<w.length;x++)try{w[x].error(_)}catch{}return!0},b.prototype.lock=function(){h.prototype.lock.call(this);for(var _=this._sources,w=0;w<_.length;w++)_[w].lock()},r.exports=b},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(n,r,i){var o=n("../compressions"),l=n("./ZipFileWorker");i.generateWorker=function(d,h,f){var p=new l(h.streamFiles,f,h.platform,h.encodeFileName),g=0;try{d.forEach(function(b,_){g++;var w=(function(T,R){var D=T||R,V=o[D];if(!V)throw new Error(D+" is not a valid compression method !");return V})(_.options.compression,h.compression),x=_.options.compressionOptions||h.compressionOptions||{},S=_.dir,C=_.date;_._compressWorker(w,x).withStreamInfo("file",{name:b,dir:S,date:C,comment:_.comment||"",unixPermissions:_.unixPermissions,dosPermissions:_.dosPermissions}).pipe(p)}),p.entriesCount=g}catch(b){p.error(b)}return p}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(n,r,i){function o(){if(!(this instanceof o))return new o;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var l=new o;for(var d in this)typeof this[d]!="function"&&(l[d]=this[d]);return l}}(o.prototype=n("./object")).loadAsync=n("./load"),o.support=n("./support"),o.defaults=n("./defaults"),o.version="3.10.1",o.loadAsync=function(l,d){return new o().loadAsync(l,d)},o.external=n("./external"),r.exports=o},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(n,r,i){var o=n("./utils"),l=n("./external"),d=n("./utf8"),h=n("./zipEntries"),f=n("./stream/Crc32Probe"),p=n("./nodejsUtils");function g(b){return new l.Promise(function(_,w){var x=b.decompressed.getContentWorker().pipe(new f);x.on("error",function(S){w(S)}).on("end",function(){x.streamInfo.crc32!==b.decompressed.crc32?w(new Error("Corrupted zip : CRC32 mismatch")):_()}).resume()})}r.exports=function(b,_){var w=this;return _=o.extend(_||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:d.utf8decode}),p.isNode&&p.isStream(b)?l.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):o.prepareContent("the loaded zip file",b,!0,_.optimizedBinaryString,_.base64).then(function(x){var S=new h(_);return S.load(x),S}).then(function(x){var S=[l.Promise.resolve(x)],C=x.files;if(_.checkCRC32)for(var T=0;T<C.length;T++)S.push(g(C[T]));return l.Promise.all(S)}).then(function(x){for(var S=x.shift(),C=S.files,T=0;T<C.length;T++){var R=C[T],D=R.fileNameStr,V=o.resolve(R.fileNameStr);w.file(V,R.decompressed,{binary:!0,optimizedBinaryString:!0,date:R.date,dir:R.dir,comment:R.fileCommentStr.length?R.fileCommentStr:null,unixPermissions:R.unixPermissions,dosPermissions:R.dosPermissions,createFolders:_.createFolders}),R.dir||(w.file(V).unsafeOriginalName=D)}return S.zipComment.length&&(w.comment=S.zipComment),w})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(n,r,i){var o=n("../utils"),l=n("../stream/GenericWorker");function d(h,f){l.call(this,"Nodejs stream input adapter for "+h),this._upstreamEnded=!1,this._bindStream(f)}o.inherits(d,l),d.prototype._bindStream=function(h){var f=this;(this._stream=h).pause(),h.on("data",function(p){f.push({data:p,meta:{percent:0}})}).on("error",function(p){f.isPaused?this.generatedError=p:f.error(p)}).on("end",function(){f.isPaused?f._upstreamEnded=!0:f.end()})},d.prototype.pause=function(){return!!l.prototype.pause.call(this)&&(this._stream.pause(),!0)},d.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},r.exports=d},{"../stream/GenericWorker":28,"../utils":32}],13:[function(n,r,i){var o=n("readable-stream").Readable;function l(d,h,f){o.call(this,h),this._helper=d;var p=this;d.on("data",function(g,b){p.push(g)||p._helper.pause(),f&&f(b)}).on("error",function(g){p.emit("error",g)}).on("end",function(){p.push(null)})}n("../utils").inherits(l,o),l.prototype._read=function(){this._helper.resume()},r.exports=l},{"../utils":32,"readable-stream":16}],14:[function(n,r,i){r.exports={isNode:typeof Buffer<"u",newBufferFrom:function(o,l){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(o,l);if(typeof o=="number")throw new Error('The "data" argument must not be a number');return new Buffer(o,l)},allocBuffer:function(o){if(Buffer.alloc)return Buffer.alloc(o);var l=new Buffer(o);return l.fill(0),l},isBuffer:function(o){return Buffer.isBuffer(o)},isStream:function(o){return o&&typeof o.on=="function"&&typeof o.pause=="function"&&typeof o.resume=="function"}}},{}],15:[function(n,r,i){function o(V,$,k){var M,B=d.getTypeOf($),U=d.extend(k||{},p);U.date=U.date||new Date,U.compression!==null&&(U.compression=U.compression.toUpperCase()),typeof U.unixPermissions=="string"&&(U.unixPermissions=parseInt(U.unixPermissions,8)),U.unixPermissions&&16384&U.unixPermissions&&(U.dir=!0),U.dosPermissions&&16&U.dosPermissions&&(U.dir=!0),U.dir&&(V=C(V)),U.createFolders&&(M=S(V))&&T.call(this,M,!0);var q=B==="string"&&U.binary===!1&&U.base64===!1;k&&k.binary!==void 0||(U.binary=!q),($ instanceof g&&$.uncompressedSize===0||U.dir||!$||$.length===0)&&(U.base64=!1,U.binary=!0,$="",U.compression="STORE",B="string");var I=null;I=$ instanceof g||$ instanceof h?$:w.isNode&&w.isStream($)?new x(V,$):d.prepareContent(V,$,U.binary,U.optimizedBinaryString,U.base64);var N=new b(V,I,U);this.files[V]=N}var l=n("./utf8"),d=n("./utils"),h=n("./stream/GenericWorker"),f=n("./stream/StreamHelper"),p=n("./defaults"),g=n("./compressedObject"),b=n("./zipObject"),_=n("./generate"),w=n("./nodejsUtils"),x=n("./nodejs/NodejsStreamInputAdapter"),S=function(V){V.slice(-1)==="/"&&(V=V.substring(0,V.length-1));var $=V.lastIndexOf("/");return 0<$?V.substring(0,$):""},C=function(V){return V.slice(-1)!=="/"&&(V+="/"),V},T=function(V,$){return $=$!==void 0?$:p.createFolders,V=C(V),this.files[V]||o.call(this,V,null,{dir:!0,createFolders:$}),this.files[V]};function R(V){return Object.prototype.toString.call(V)==="[object RegExp]"}var D={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(V){var $,k,M;for($ in this.files)M=this.files[$],(k=$.slice(this.root.length,$.length))&&$.slice(0,this.root.length)===this.root&&V(k,M)},filter:function(V){var $=[];return this.forEach(function(k,M){V(k,M)&&$.push(M)}),$},file:function(V,$,k){if(arguments.length!==1)return V=this.root+V,o.call(this,V,$,k),this;if(R(V)){var M=V;return this.filter(function(U,q){return!q.dir&&M.test(U)})}var B=this.files[this.root+V];return B&&!B.dir?B:null},folder:function(V){if(!V)return this;if(R(V))return this.filter(function(B,U){return U.dir&&V.test(B)});var $=this.root+V,k=T.call(this,$),M=this.clone();return M.root=k.name,M},remove:function(V){V=this.root+V;var $=this.files[V];if($||(V.slice(-1)!=="/"&&(V+="/"),$=this.files[V]),$&&!$.dir)delete this.files[V];else for(var k=this.filter(function(B,U){return U.name.slice(0,V.length)===V}),M=0;M<k.length;M++)delete this.files[k[M].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(V){var $,k={};try{if((k=d.extend(V||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:l.utf8encode})).type=k.type.toLowerCase(),k.compression=k.compression.toUpperCase(),k.type==="binarystring"&&(k.type="string"),!k.type)throw new Error("No output type specified.");d.checkSupport(k.type),k.platform!=="darwin"&&k.platform!=="freebsd"&&k.platform!=="linux"&&k.platform!=="sunos"||(k.platform="UNIX"),k.platform==="win32"&&(k.platform="DOS");var M=k.comment||this.comment||"";$=_.generateWorker(this,k,M)}catch(B){($=new h("error")).error(B)}return new f($,k.type||"string",k.mimeType)},generateAsync:function(V,$){return this.generateInternalStream(V).accumulate($)},generateNodeStream:function(V,$){return(V=V||{}).type||(V.type="nodebuffer"),this.generateInternalStream(V).toNodejsStream($)}};r.exports=D},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(n,r,i){r.exports=n("stream")},{stream:void 0}],17:[function(n,r,i){var o=n("./DataReader");function l(d){o.call(this,d);for(var h=0;h<this.data.length;h++)d[h]=255&d[h]}n("../utils").inherits(l,o),l.prototype.byteAt=function(d){return this.data[this.zero+d]},l.prototype.lastIndexOfSignature=function(d){for(var h=d.charCodeAt(0),f=d.charCodeAt(1),p=d.charCodeAt(2),g=d.charCodeAt(3),b=this.length-4;0<=b;--b)if(this.data[b]===h&&this.data[b+1]===f&&this.data[b+2]===p&&this.data[b+3]===g)return b-this.zero;return-1},l.prototype.readAndCheckSignature=function(d){var h=d.charCodeAt(0),f=d.charCodeAt(1),p=d.charCodeAt(2),g=d.charCodeAt(3),b=this.readData(4);return h===b[0]&&f===b[1]&&p===b[2]&&g===b[3]},l.prototype.readData=function(d){if(this.checkOffset(d),d===0)return[];var h=this.data.slice(this.zero+this.index,this.zero+this.index+d);return this.index+=d,h},r.exports=l},{"../utils":32,"./DataReader":18}],18:[function(n,r,i){var o=n("../utils");function l(d){this.data=d,this.length=d.length,this.index=0,this.zero=0}l.prototype={checkOffset:function(d){this.checkIndex(this.index+d)},checkIndex:function(d){if(this.length<this.zero+d||d<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+d+"). Corrupted zip ?")},setIndex:function(d){this.checkIndex(d),this.index=d},skip:function(d){this.setIndex(this.index+d)},byteAt:function(){},readInt:function(d){var h,f=0;for(this.checkOffset(d),h=this.index+d-1;h>=this.index;h--)f=(f<<8)+this.byteAt(h);return this.index+=d,f},readString:function(d){return o.transformTo("string",this.readData(d))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var d=this.readInt(4);return new Date(Date.UTC(1980+(d>>25&127),(d>>21&15)-1,d>>16&31,d>>11&31,d>>5&63,(31&d)<<1))}},r.exports=l},{"../utils":32}],19:[function(n,r,i){var o=n("./Uint8ArrayReader");function l(d){o.call(this,d)}n("../utils").inherits(l,o),l.prototype.readData=function(d){this.checkOffset(d);var h=this.data.slice(this.zero+this.index,this.zero+this.index+d);return this.index+=d,h},r.exports=l},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(n,r,i){var o=n("./DataReader");function l(d){o.call(this,d)}n("../utils").inherits(l,o),l.prototype.byteAt=function(d){return this.data.charCodeAt(this.zero+d)},l.prototype.lastIndexOfSignature=function(d){return this.data.lastIndexOf(d)-this.zero},l.prototype.readAndCheckSignature=function(d){return d===this.readData(4)},l.prototype.readData=function(d){this.checkOffset(d);var h=this.data.slice(this.zero+this.index,this.zero+this.index+d);return this.index+=d,h},r.exports=l},{"../utils":32,"./DataReader":18}],21:[function(n,r,i){var o=n("./ArrayReader");function l(d){o.call(this,d)}n("../utils").inherits(l,o),l.prototype.readData=function(d){if(this.checkOffset(d),d===0)return new Uint8Array(0);var h=this.data.subarray(this.zero+this.index,this.zero+this.index+d);return this.index+=d,h},r.exports=l},{"../utils":32,"./ArrayReader":17}],22:[function(n,r,i){var o=n("../utils"),l=n("../support"),d=n("./ArrayReader"),h=n("./StringReader"),f=n("./NodeBufferReader"),p=n("./Uint8ArrayReader");r.exports=function(g){var b=o.getTypeOf(g);return o.checkSupport(b),b!=="string"||l.uint8array?b==="nodebuffer"?new f(g):l.uint8array?new p(o.transformTo("uint8array",g)):new d(o.transformTo("array",g)):new h(g)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(n,r,i){i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(n,r,i){var o=n("./GenericWorker"),l=n("../utils");function d(h){o.call(this,"ConvertWorker to "+h),this.destType=h}l.inherits(d,o),d.prototype.processChunk=function(h){this.push({data:l.transformTo(this.destType,h.data),meta:h.meta})},r.exports=d},{"../utils":32,"./GenericWorker":28}],25:[function(n,r,i){var o=n("./GenericWorker"),l=n("../crc32");function d(){o.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}n("../utils").inherits(d,o),d.prototype.processChunk=function(h){this.streamInfo.crc32=l(h.data,this.streamInfo.crc32||0),this.push(h)},r.exports=d},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(n,r,i){var o=n("../utils"),l=n("./GenericWorker");function d(h){l.call(this,"DataLengthProbe for "+h),this.propName=h,this.withStreamInfo(h,0)}o.inherits(d,l),d.prototype.processChunk=function(h){if(h){var f=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=f+h.data.length}l.prototype.processChunk.call(this,h)},r.exports=d},{"../utils":32,"./GenericWorker":28}],27:[function(n,r,i){var o=n("../utils"),l=n("./GenericWorker");function d(h){l.call(this,"DataWorker");var f=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,h.then(function(p){f.dataIsReady=!0,f.data=p,f.max=p&&p.length||0,f.type=o.getTypeOf(p),f.isPaused||f._tickAndRepeat()},function(p){f.error(p)})}o.inherits(d,l),d.prototype.cleanUp=function(){l.prototype.cleanUp.call(this),this.data=null},d.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,o.delay(this._tickAndRepeat,[],this)),!0)},d.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(o.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},d.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var h=null,f=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":h=this.data.substring(this.index,f);break;case"uint8array":h=this.data.subarray(this.index,f);break;case"array":case"nodebuffer":h=this.data.slice(this.index,f)}return this.index=f,this.push({data:h,meta:{percent:this.max?this.index/this.max*100:0}})},r.exports=d},{"../utils":32,"./GenericWorker":28}],28:[function(n,r,i){function o(l){this.name=l||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}o.prototype={push:function(l){this.emit("data",l)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(l){this.emit("error",l)}return!0},error:function(l){return!this.isFinished&&(this.isPaused?this.generatedError=l:(this.isFinished=!0,this.emit("error",l),this.previous&&this.previous.error(l),this.cleanUp()),!0)},on:function(l,d){return this._listeners[l].push(d),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(l,d){if(this._listeners[l])for(var h=0;h<this._listeners[l].length;h++)this._listeners[l][h].call(this,d)},pipe:function(l){return l.registerPrevious(this)},registerPrevious:function(l){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=l.streamInfo,this.mergeStreamInfo(),this.previous=l;var d=this;return l.on("data",function(h){d.processChunk(h)}),l.on("end",function(){d.end()}),l.on("error",function(h){d.error(h)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var l=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),l=!0),this.previous&&this.previous.resume(),!l},flush:function(){},processChunk:function(l){this.push(l)},withStreamInfo:function(l,d){return this.extraStreamInfo[l]=d,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var l in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,l)&&(this.streamInfo[l]=this.extraStreamInfo[l])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var l="Worker "+this.name;return this.previous?this.previous+" -> "+l:l}},r.exports=o},{}],29:[function(n,r,i){var o=n("../utils"),l=n("./ConvertWorker"),d=n("./GenericWorker"),h=n("../base64"),f=n("../support"),p=n("../external"),g=null;if(f.nodestream)try{g=n("../nodejs/NodejsStreamOutputAdapter")}catch{}function b(w,x){return new p.Promise(function(S,C){var T=[],R=w._internalType,D=w._outputType,V=w._mimeType;w.on("data",function($,k){T.push($),x&&x(k)}).on("error",function($){T=[],C($)}).on("end",function(){try{var $=(function(k,M,B){switch(k){case"blob":return o.newBlob(o.transformTo("arraybuffer",M),B);case"base64":return h.encode(M);default:return o.transformTo(k,M)}})(D,(function(k,M){var B,U=0,q=null,I=0;for(B=0;B<M.length;B++)I+=M[B].length;switch(k){case"string":return M.join("");case"array":return Array.prototype.concat.apply([],M);case"uint8array":for(q=new Uint8Array(I),B=0;B<M.length;B++)q.set(M[B],U),U+=M[B].length;return q;case"nodebuffer":return Buffer.concat(M);default:throw new Error("concat : unsupported type '"+k+"'")}})(R,T),V);S($)}catch(k){C(k)}T=[]}).resume()})}function _(w,x,S){var C=x;switch(x){case"blob":case"arraybuffer":C="uint8array";break;case"base64":C="string"}try{this._internalType=C,this._outputType=x,this._mimeType=S,o.checkSupport(C),this._worker=w.pipe(new l(C)),w.lock()}catch(T){this._worker=new d("error"),this._worker.error(T)}}_.prototype={accumulate:function(w){return b(this,w)},on:function(w,x){var S=this;return w==="data"?this._worker.on(w,function(C){x.call(S,C.data,C.meta)}):this._worker.on(w,function(){o.delay(x,arguments,S)}),this},resume:function(){return o.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(w){if(o.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new g(this,{objectMode:this._outputType!=="nodebuffer"},w)}},r.exports=_},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(n,r,i){if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",i.nodebuffer=typeof Buffer<"u",i.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")i.blob=!1;else{var o=new ArrayBuffer(0);try{i.blob=new Blob([o],{type:"application/zip"}).size===0}catch{try{var l=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);l.append(o),i.blob=l.getBlob("application/zip").size===0}catch{i.blob=!1}}}try{i.nodestream=!!n("readable-stream").Readable}catch{i.nodestream=!1}},{"readable-stream":16}],31:[function(n,r,i){for(var o=n("./utils"),l=n("./support"),d=n("./nodejsUtils"),h=n("./stream/GenericWorker"),f=new Array(256),p=0;p<256;p++)f[p]=252<=p?6:248<=p?5:240<=p?4:224<=p?3:192<=p?2:1;f[254]=f[254]=1;function g(){h.call(this,"utf-8 decode"),this.leftOver=null}function b(){h.call(this,"utf-8 encode")}i.utf8encode=function(_){return l.nodebuffer?d.newBufferFrom(_,"utf-8"):(function(w){var x,S,C,T,R,D=w.length,V=0;for(T=0;T<D;T++)(64512&(S=w.charCodeAt(T)))==55296&&T+1<D&&(64512&(C=w.charCodeAt(T+1)))==56320&&(S=65536+(S-55296<<10)+(C-56320),T++),V+=S<128?1:S<2048?2:S<65536?3:4;for(x=l.uint8array?new Uint8Array(V):new Array(V),T=R=0;R<V;T++)(64512&(S=w.charCodeAt(T)))==55296&&T+1<D&&(64512&(C=w.charCodeAt(T+1)))==56320&&(S=65536+(S-55296<<10)+(C-56320),T++),S<128?x[R++]=S:(S<2048?x[R++]=192|S>>>6:(S<65536?x[R++]=224|S>>>12:(x[R++]=240|S>>>18,x[R++]=128|S>>>12&63),x[R++]=128|S>>>6&63),x[R++]=128|63&S);return x})(_)},i.utf8decode=function(_){return l.nodebuffer?o.transformTo("nodebuffer",_).toString("utf-8"):(function(w){var x,S,C,T,R=w.length,D=new Array(2*R);for(x=S=0;x<R;)if((C=w[x++])<128)D[S++]=C;else if(4<(T=f[C]))D[S++]=65533,x+=T-1;else{for(C&=T===2?31:T===3?15:7;1<T&&x<R;)C=C<<6|63&w[x++],T--;1<T?D[S++]=65533:C<65536?D[S++]=C:(C-=65536,D[S++]=55296|C>>10&1023,D[S++]=56320|1023&C)}return D.length!==S&&(D.subarray?D=D.subarray(0,S):D.length=S),o.applyFromCharCode(D)})(_=o.transformTo(l.uint8array?"uint8array":"array",_))},o.inherits(g,h),g.prototype.processChunk=function(_){var w=o.transformTo(l.uint8array?"uint8array":"array",_.data);if(this.leftOver&&this.leftOver.length){if(l.uint8array){var x=w;(w=new Uint8Array(x.length+this.leftOver.length)).set(this.leftOver,0),w.set(x,this.leftOver.length)}else w=this.leftOver.concat(w);this.leftOver=null}var S=(function(T,R){var D;for((R=R||T.length)>T.length&&(R=T.length),D=R-1;0<=D&&(192&T[D])==128;)D--;return D<0||D===0?R:D+f[T[D]]>R?D:R})(w),C=w;S!==w.length&&(l.uint8array?(C=w.subarray(0,S),this.leftOver=w.subarray(S,w.length)):(C=w.slice(0,S),this.leftOver=w.slice(S,w.length))),this.push({data:i.utf8decode(C),meta:_.meta})},g.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:i.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},i.Utf8DecodeWorker=g,o.inherits(b,h),b.prototype.processChunk=function(_){this.push({data:i.utf8encode(_.data),meta:_.meta})},i.Utf8EncodeWorker=b},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(n,r,i){var o=n("./support"),l=n("./base64"),d=n("./nodejsUtils"),h=n("./external");function f(x){return x}function p(x,S){for(var C=0;C<x.length;++C)S[C]=255&x.charCodeAt(C);return S}n("setimmediate"),i.newBlob=function(x,S){i.checkSupport("blob");try{return new Blob([x],{type:S})}catch{try{var C=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return C.append(x),C.getBlob(S)}catch{throw new Error("Bug : can't construct the Blob.")}}};var g={stringifyByChunk:function(x,S,C){var T=[],R=0,D=x.length;if(D<=C)return String.fromCharCode.apply(null,x);for(;R<D;)S==="array"||S==="nodebuffer"?T.push(String.fromCharCode.apply(null,x.slice(R,Math.min(R+C,D)))):T.push(String.fromCharCode.apply(null,x.subarray(R,Math.min(R+C,D)))),R+=C;return T.join("")},stringifyByChar:function(x){for(var S="",C=0;C<x.length;C++)S+=String.fromCharCode(x[C]);return S},applyCanBeUsed:{uint8array:(function(){try{return o.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}})(),nodebuffer:(function(){try{return o.nodebuffer&&String.fromCharCode.apply(null,d.allocBuffer(1)).length===1}catch{return!1}})()}};function b(x){var S=65536,C=i.getTypeOf(x),T=!0;if(C==="uint8array"?T=g.applyCanBeUsed.uint8array:C==="nodebuffer"&&(T=g.applyCanBeUsed.nodebuffer),T)for(;1<S;)try{return g.stringifyByChunk(x,C,S)}catch{S=Math.floor(S/2)}return g.stringifyByChar(x)}function _(x,S){for(var C=0;C<x.length;C++)S[C]=x[C];return S}i.applyFromCharCode=b;var w={};w.string={string:f,array:function(x){return p(x,new Array(x.length))},arraybuffer:function(x){return w.string.uint8array(x).buffer},uint8array:function(x){return p(x,new Uint8Array(x.length))},nodebuffer:function(x){return p(x,d.allocBuffer(x.length))}},w.array={string:b,array:f,arraybuffer:function(x){return new Uint8Array(x).buffer},uint8array:function(x){return new Uint8Array(x)},nodebuffer:function(x){return d.newBufferFrom(x)}},w.arraybuffer={string:function(x){return b(new Uint8Array(x))},array:function(x){return _(new Uint8Array(x),new Array(x.byteLength))},arraybuffer:f,uint8array:function(x){return new Uint8Array(x)},nodebuffer:function(x){return d.newBufferFrom(new Uint8Array(x))}},w.uint8array={string:b,array:function(x){return _(x,new Array(x.length))},arraybuffer:function(x){return x.buffer},uint8array:f,nodebuffer:function(x){return d.newBufferFrom(x)}},w.nodebuffer={string:b,array:function(x){return _(x,new Array(x.length))},arraybuffer:function(x){return w.nodebuffer.uint8array(x).buffer},uint8array:function(x){return _(x,new Uint8Array(x.length))},nodebuffer:f},i.transformTo=function(x,S){if(S=S||"",!x)return S;i.checkSupport(x);var C=i.getTypeOf(S);return w[C][x](S)},i.resolve=function(x){for(var S=x.split("/"),C=[],T=0;T<S.length;T++){var R=S[T];R==="."||R===""&&T!==0&&T!==S.length-1||(R===".."?C.pop():C.push(R))}return C.join("/")},i.getTypeOf=function(x){return typeof x=="string"?"string":Object.prototype.toString.call(x)==="[object Array]"?"array":o.nodebuffer&&d.isBuffer(x)?"nodebuffer":o.uint8array&&x instanceof Uint8Array?"uint8array":o.arraybuffer&&x instanceof ArrayBuffer?"arraybuffer":void 0},i.checkSupport=function(x){if(!o[x.toLowerCase()])throw new Error(x+" is not supported by this platform")},i.MAX_VALUE_16BITS=65535,i.MAX_VALUE_32BITS=-1,i.pretty=function(x){var S,C,T="";for(C=0;C<(x||"").length;C++)T+="\\x"+((S=x.charCodeAt(C))<16?"0":"")+S.toString(16).toUpperCase();return T},i.delay=function(x,S,C){setImmediate(function(){x.apply(C||null,S||[])})},i.inherits=function(x,S){function C(){}C.prototype=S.prototype,x.prototype=new C},i.extend=function(){var x,S,C={};for(x=0;x<arguments.length;x++)for(S in arguments[x])Object.prototype.hasOwnProperty.call(arguments[x],S)&&C[S]===void 0&&(C[S]=arguments[x][S]);return C},i.prepareContent=function(x,S,C,T,R){return h.Promise.resolve(S).then(function(D){return o.blob&&(D instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(D))!==-1)&&typeof FileReader<"u"?new h.Promise(function(V,$){var k=new FileReader;k.onload=function(M){V(M.target.result)},k.onerror=function(M){$(M.target.error)},k.readAsArrayBuffer(D)}):D}).then(function(D){var V=i.getTypeOf(D);return V?(V==="arraybuffer"?D=i.transformTo("uint8array",D):V==="string"&&(R?D=l.decode(D):C&&T!==!0&&(D=(function($){return p($,o.uint8array?new Uint8Array($.length):new Array($.length))})(D))),D):h.Promise.reject(new Error("Can't read the data of '"+x+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(n,r,i){var o=n("./reader/readerFor"),l=n("./utils"),d=n("./signature"),h=n("./zipEntry"),f=n("./support");function p(g){this.files=[],this.loadOptions=g}p.prototype={checkSignature:function(g){if(!this.reader.readAndCheckSignature(g)){this.reader.index-=4;var b=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+l.pretty(b)+", expected "+l.pretty(g)+")")}},isSignature:function(g,b){var _=this.reader.index;this.reader.setIndex(g);var w=this.reader.readString(4)===b;return this.reader.setIndex(_),w},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var g=this.reader.readData(this.zipCommentLength),b=f.uint8array?"uint8array":"array",_=l.transformTo(b,g);this.zipComment=this.loadOptions.decodeFileName(_)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var g,b,_,w=this.zip64EndOfCentralSize-44;0<w;)g=this.reader.readInt(2),b=this.reader.readInt(4),_=this.reader.readData(b),this.zip64ExtensibleData[g]={id:g,length:b,value:_}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var g,b;for(g=0;g<this.files.length;g++)b=this.files[g],this.reader.setIndex(b.localHeaderOffset),this.checkSignature(d.LOCAL_FILE_HEADER),b.readLocalPart(this.reader),b.handleUTF8(),b.processAttributes()},readCentralDir:function(){var g;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(d.CENTRAL_FILE_HEADER);)(g=new h({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(g);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var g=this.reader.lastIndexOfSignature(d.CENTRAL_DIRECTORY_END);if(g<0)throw this.isSignature(0,d.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(g);var b=g;if(this.checkSignature(d.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===l.MAX_VALUE_16BITS||this.diskWithCentralDirStart===l.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===l.MAX_VALUE_16BITS||this.centralDirRecords===l.MAX_VALUE_16BITS||this.centralDirSize===l.MAX_VALUE_32BITS||this.centralDirOffset===l.MAX_VALUE_32BITS){if(this.zip64=!0,(g=this.reader.lastIndexOfSignature(d.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(g),this.checkSignature(d.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,d.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(d.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(d.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var _=this.centralDirOffset+this.centralDirSize;this.zip64&&(_+=20,_+=12+this.zip64EndOfCentralSize);var w=b-_;if(0<w)this.isSignature(b,d.CENTRAL_FILE_HEADER)||(this.reader.zero=w);else if(w<0)throw new Error("Corrupted zip: missing "+Math.abs(w)+" bytes.")},prepareReader:function(g){this.reader=o(g)},load:function(g){this.prepareReader(g),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},r.exports=p},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(n,r,i){var o=n("./reader/readerFor"),l=n("./utils"),d=n("./compressedObject"),h=n("./crc32"),f=n("./utf8"),p=n("./compressions"),g=n("./support");function b(_,w){this.options=_,this.loadOptions=w}b.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(_){var w,x;if(_.skip(22),this.fileNameLength=_.readInt(2),x=_.readInt(2),this.fileName=_.readData(this.fileNameLength),_.skip(x),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((w=(function(S){for(var C in p)if(Object.prototype.hasOwnProperty.call(p,C)&&p[C].magic===S)return p[C];return null})(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+l.pretty(this.compressionMethod)+" unknown (inner file : "+l.transformTo("string",this.fileName)+")");this.decompressed=new d(this.compressedSize,this.uncompressedSize,this.crc32,w,_.readData(this.compressedSize))},readCentralPart:function(_){this.versionMadeBy=_.readInt(2),_.skip(2),this.bitFlag=_.readInt(2),this.compressionMethod=_.readString(2),this.date=_.readDate(),this.crc32=_.readInt(4),this.compressedSize=_.readInt(4),this.uncompressedSize=_.readInt(4);var w=_.readInt(2);if(this.extraFieldsLength=_.readInt(2),this.fileCommentLength=_.readInt(2),this.diskNumberStart=_.readInt(2),this.internalFileAttributes=_.readInt(2),this.externalFileAttributes=_.readInt(4),this.localHeaderOffset=_.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");_.skip(w),this.readExtraFields(_),this.parseZIP64ExtraField(_),this.fileComment=_.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var _=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),_==0&&(this.dosPermissions=63&this.externalFileAttributes),_==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var _=o(this.extraFields[1].value);this.uncompressedSize===l.MAX_VALUE_32BITS&&(this.uncompressedSize=_.readInt(8)),this.compressedSize===l.MAX_VALUE_32BITS&&(this.compressedSize=_.readInt(8)),this.localHeaderOffset===l.MAX_VALUE_32BITS&&(this.localHeaderOffset=_.readInt(8)),this.diskNumberStart===l.MAX_VALUE_32BITS&&(this.diskNumberStart=_.readInt(4))}},readExtraFields:function(_){var w,x,S,C=_.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});_.index+4<C;)w=_.readInt(2),x=_.readInt(2),S=_.readData(x),this.extraFields[w]={id:w,length:x,value:S};_.setIndex(C)},handleUTF8:function(){var _=g.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=f.utf8decode(this.fileName),this.fileCommentStr=f.utf8decode(this.fileComment);else{var w=this.findExtraFieldUnicodePath();if(w!==null)this.fileNameStr=w;else{var x=l.transformTo(_,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(x)}var S=this.findExtraFieldUnicodeComment();if(S!==null)this.fileCommentStr=S;else{var C=l.transformTo(_,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(C)}}},findExtraFieldUnicodePath:function(){var _=this.extraFields[28789];if(_){var w=o(_.value);return w.readInt(1)!==1||h(this.fileName)!==w.readInt(4)?null:f.utf8decode(w.readData(_.length-5))}return null},findExtraFieldUnicodeComment:function(){var _=this.extraFields[25461];if(_){var w=o(_.value);return w.readInt(1)!==1||h(this.fileComment)!==w.readInt(4)?null:f.utf8decode(w.readData(_.length-5))}return null}},r.exports=b},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(n,r,i){function o(w,x,S){this.name=w,this.dir=S.dir,this.date=S.date,this.comment=S.comment,this.unixPermissions=S.unixPermissions,this.dosPermissions=S.dosPermissions,this._data=x,this._dataBinary=S.binary,this.options={compression:S.compression,compressionOptions:S.compressionOptions}}var l=n("./stream/StreamHelper"),d=n("./stream/DataWorker"),h=n("./utf8"),f=n("./compressedObject"),p=n("./stream/GenericWorker");o.prototype={internalStream:function(w){var x=null,S="string";try{if(!w)throw new Error("No output type specified.");var C=(S=w.toLowerCase())==="string"||S==="text";S!=="binarystring"&&S!=="text"||(S="string"),x=this._decompressWorker();var T=!this._dataBinary;T&&!C&&(x=x.pipe(new h.Utf8EncodeWorker)),!T&&C&&(x=x.pipe(new h.Utf8DecodeWorker))}catch(R){(x=new p("error")).error(R)}return new l(x,S,"")},async:function(w,x){return this.internalStream(w).accumulate(x)},nodeStream:function(w,x){return this.internalStream(w||"nodebuffer").toNodejsStream(x)},_compressWorker:function(w,x){if(this._data instanceof f&&this._data.compression.magic===w.magic)return this._data.getCompressedWorker();var S=this._decompressWorker();return this._dataBinary||(S=S.pipe(new h.Utf8EncodeWorker)),f.createWorkerFrom(S,w,x)},_decompressWorker:function(){return this._data instanceof f?this._data.getContentWorker():this._data instanceof p?this._data:new d(this._data)}};for(var g=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],b=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},_=0;_<g.length;_++)o.prototype[g[_]]=b;r.exports=o},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(n,r,i){(function(o){var l,d,h=o.MutationObserver||o.WebKitMutationObserver;if(h){var f=0,p=new h(w),g=o.document.createTextNode("");p.observe(g,{characterData:!0}),l=function(){g.data=f=++f%2}}else if(o.setImmediate||o.MessageChannel===void 0)l="document"in o&&"onreadystatechange"in o.document.createElement("script")?function(){var x=o.document.createElement("script");x.onreadystatechange=function(){w(),x.onreadystatechange=null,x.parentNode.removeChild(x),x=null},o.document.documentElement.appendChild(x)}:function(){setTimeout(w,0)};else{var b=new o.MessageChannel;b.port1.onmessage=w,l=function(){b.port2.postMessage(0)}}var _=[];function w(){var x,S;d=!0;for(var C=_.length;C;){for(S=_,_=[],x=-1;++x<C;)S[x]();C=_.length}d=!1}r.exports=function(x){_.push(x)!==1||d||l()}}).call(this,typeof Vh<"u"?Vh:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(n,r,i){var o=n("immediate");function l(){}var d={},h=["REJECTED"],f=["FULFILLED"],p=["PENDING"];function g(C){if(typeof C!="function")throw new TypeError("resolver must be a function");this.state=p,this.queue=[],this.outcome=void 0,C!==l&&x(this,C)}function b(C,T,R){this.promise=C,typeof T=="function"&&(this.onFulfilled=T,this.callFulfilled=this.otherCallFulfilled),typeof R=="function"&&(this.onRejected=R,this.callRejected=this.otherCallRejected)}function _(C,T,R){o(function(){var D;try{D=T(R)}catch(V){return d.reject(C,V)}D===C?d.reject(C,new TypeError("Cannot resolve promise with itself")):d.resolve(C,D)})}function w(C){var T=C&&C.then;if(C&&(typeof C=="object"||typeof C=="function")&&typeof T=="function")return function(){T.apply(C,arguments)}}function x(C,T){var R=!1;function D(k){R||(R=!0,d.reject(C,k))}function V(k){R||(R=!0,d.resolve(C,k))}var $=S(function(){T(V,D)});$.status==="error"&&D($.value)}function S(C,T){var R={};try{R.value=C(T),R.status="success"}catch(D){R.status="error",R.value=D}return R}(r.exports=g).prototype.finally=function(C){if(typeof C!="function")return this;var T=this.constructor;return this.then(function(R){return T.resolve(C()).then(function(){return R})},function(R){return T.resolve(C()).then(function(){throw R})})},g.prototype.catch=function(C){return this.then(null,C)},g.prototype.then=function(C,T){if(typeof C!="function"&&this.state===f||typeof T!="function"&&this.state===h)return this;var R=new this.constructor(l);return this.state!==p?_(R,this.state===f?C:T,this.outcome):this.queue.push(new b(R,C,T)),R},b.prototype.callFulfilled=function(C){d.resolve(this.promise,C)},b.prototype.otherCallFulfilled=function(C){_(this.promise,this.onFulfilled,C)},b.prototype.callRejected=function(C){d.reject(this.promise,C)},b.prototype.otherCallRejected=function(C){_(this.promise,this.onRejected,C)},d.resolve=function(C,T){var R=S(w,T);if(R.status==="error")return d.reject(C,R.value);var D=R.value;if(D)x(C,D);else{C.state=f,C.outcome=T;for(var V=-1,$=C.queue.length;++V<$;)C.queue[V].callFulfilled(T)}return C},d.reject=function(C,T){C.state=h,C.outcome=T;for(var R=-1,D=C.queue.length;++R<D;)C.queue[R].callRejected(T);return C},g.resolve=function(C){return C instanceof this?C:d.resolve(new this(l),C)},g.reject=function(C){var T=new this(l);return d.reject(T,C)},g.all=function(C){var T=this;if(Object.prototype.toString.call(C)!=="[object Array]")return this.reject(new TypeError("must be an array"));var R=C.length,D=!1;if(!R)return this.resolve([]);for(var V=new Array(R),$=0,k=-1,M=new this(l);++k<R;)B(C[k],k);return M;function B(U,q){T.resolve(U).then(function(I){V[q]=I,++$!==R||D||(D=!0,d.resolve(M,V))},function(I){D||(D=!0,d.reject(M,I))})}},g.race=function(C){var T=this;if(Object.prototype.toString.call(C)!=="[object Array]")return this.reject(new TypeError("must be an array"));var R=C.length,D=!1;if(!R)return this.resolve([]);for(var V=-1,$=new this(l);++V<R;)k=C[V],T.resolve(k).then(function(M){D||(D=!0,d.resolve($,M))},function(M){D||(D=!0,d.reject($,M))});var k;return $}},{immediate:36}],38:[function(n,r,i){var o={};(0,n("./lib/utils/common").assign)(o,n("./lib/deflate"),n("./lib/inflate"),n("./lib/zlib/constants")),r.exports=o},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(n,r,i){var o=n("./zlib/deflate"),l=n("./utils/common"),d=n("./utils/strings"),h=n("./zlib/messages"),f=n("./zlib/zstream"),p=Object.prototype.toString,g=0,b=-1,_=0,w=8;function x(C){if(!(this instanceof x))return new x(C);this.options=l.assign({level:b,method:w,chunkSize:16384,windowBits:15,memLevel:8,strategy:_,to:""},C||{});var T=this.options;T.raw&&0<T.windowBits?T.windowBits=-T.windowBits:T.gzip&&0<T.windowBits&&T.windowBits<16&&(T.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new f,this.strm.avail_out=0;var R=o.deflateInit2(this.strm,T.level,T.method,T.windowBits,T.memLevel,T.strategy);if(R!==g)throw new Error(h[R]);if(T.header&&o.deflateSetHeader(this.strm,T.header),T.dictionary){var D;if(D=typeof T.dictionary=="string"?d.string2buf(T.dictionary):p.call(T.dictionary)==="[object ArrayBuffer]"?new Uint8Array(T.dictionary):T.dictionary,(R=o.deflateSetDictionary(this.strm,D))!==g)throw new Error(h[R]);this._dict_set=!0}}function S(C,T){var R=new x(T);if(R.push(C,!0),R.err)throw R.msg||h[R.err];return R.result}x.prototype.push=function(C,T){var R,D,V=this.strm,$=this.options.chunkSize;if(this.ended)return!1;D=T===~~T?T:T===!0?4:0,typeof C=="string"?V.input=d.string2buf(C):p.call(C)==="[object ArrayBuffer]"?V.input=new Uint8Array(C):V.input=C,V.next_in=0,V.avail_in=V.input.length;do{if(V.avail_out===0&&(V.output=new l.Buf8($),V.next_out=0,V.avail_out=$),(R=o.deflate(V,D))!==1&&R!==g)return this.onEnd(R),!(this.ended=!0);V.avail_out!==0&&(V.avail_in!==0||D!==4&&D!==2)||(this.options.to==="string"?this.onData(d.buf2binstring(l.shrinkBuf(V.output,V.next_out))):this.onData(l.shrinkBuf(V.output,V.next_out)))}while((0<V.avail_in||V.avail_out===0)&&R!==1);return D===4?(R=o.deflateEnd(this.strm),this.onEnd(R),this.ended=!0,R===g):D!==2||(this.onEnd(g),!(V.avail_out=0))},x.prototype.onData=function(C){this.chunks.push(C)},x.prototype.onEnd=function(C){C===g&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=l.flattenChunks(this.chunks)),this.chunks=[],this.err=C,this.msg=this.strm.msg},i.Deflate=x,i.deflate=S,i.deflateRaw=function(C,T){return(T=T||{}).raw=!0,S(C,T)},i.gzip=function(C,T){return(T=T||{}).gzip=!0,S(C,T)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(n,r,i){var o=n("./zlib/inflate"),l=n("./utils/common"),d=n("./utils/strings"),h=n("./zlib/constants"),f=n("./zlib/messages"),p=n("./zlib/zstream"),g=n("./zlib/gzheader"),b=Object.prototype.toString;function _(x){if(!(this instanceof _))return new _(x);this.options=l.assign({chunkSize:16384,windowBits:0,to:""},x||{});var S=this.options;S.raw&&0<=S.windowBits&&S.windowBits<16&&(S.windowBits=-S.windowBits,S.windowBits===0&&(S.windowBits=-15)),!(0<=S.windowBits&&S.windowBits<16)||x&&x.windowBits||(S.windowBits+=32),15<S.windowBits&&S.windowBits<48&&(15&S.windowBits)==0&&(S.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new p,this.strm.avail_out=0;var C=o.inflateInit2(this.strm,S.windowBits);if(C!==h.Z_OK)throw new Error(f[C]);this.header=new g,o.inflateGetHeader(this.strm,this.header)}function w(x,S){var C=new _(S);if(C.push(x,!0),C.err)throw C.msg||f[C.err];return C.result}_.prototype.push=function(x,S){var C,T,R,D,V,$,k=this.strm,M=this.options.chunkSize,B=this.options.dictionary,U=!1;if(this.ended)return!1;T=S===~~S?S:S===!0?h.Z_FINISH:h.Z_NO_FLUSH,typeof x=="string"?k.input=d.binstring2buf(x):b.call(x)==="[object ArrayBuffer]"?k.input=new Uint8Array(x):k.input=x,k.next_in=0,k.avail_in=k.input.length;do{if(k.avail_out===0&&(k.output=new l.Buf8(M),k.next_out=0,k.avail_out=M),(C=o.inflate(k,h.Z_NO_FLUSH))===h.Z_NEED_DICT&&B&&($=typeof B=="string"?d.string2buf(B):b.call(B)==="[object ArrayBuffer]"?new Uint8Array(B):B,C=o.inflateSetDictionary(this.strm,$)),C===h.Z_BUF_ERROR&&U===!0&&(C=h.Z_OK,U=!1),C!==h.Z_STREAM_END&&C!==h.Z_OK)return this.onEnd(C),!(this.ended=!0);k.next_out&&(k.avail_out!==0&&C!==h.Z_STREAM_END&&(k.avail_in!==0||T!==h.Z_FINISH&&T!==h.Z_SYNC_FLUSH)||(this.options.to==="string"?(R=d.utf8border(k.output,k.next_out),D=k.next_out-R,V=d.buf2string(k.output,R),k.next_out=D,k.avail_out=M-D,D&&l.arraySet(k.output,k.output,R,D,0),this.onData(V)):this.onData(l.shrinkBuf(k.output,k.next_out)))),k.avail_in===0&&k.avail_out===0&&(U=!0)}while((0<k.avail_in||k.avail_out===0)&&C!==h.Z_STREAM_END);return C===h.Z_STREAM_END&&(T=h.Z_FINISH),T===h.Z_FINISH?(C=o.inflateEnd(this.strm),this.onEnd(C),this.ended=!0,C===h.Z_OK):T!==h.Z_SYNC_FLUSH||(this.onEnd(h.Z_OK),!(k.avail_out=0))},_.prototype.onData=function(x){this.chunks.push(x)},_.prototype.onEnd=function(x){x===h.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=l.flattenChunks(this.chunks)),this.chunks=[],this.err=x,this.msg=this.strm.msg},i.Inflate=_,i.inflate=w,i.inflateRaw=function(x,S){return(S=S||{}).raw=!0,w(x,S)},i.ungzip=w},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(n,r,i){var o=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";i.assign=function(h){for(var f=Array.prototype.slice.call(arguments,1);f.length;){var p=f.shift();if(p){if(typeof p!="object")throw new TypeError(p+"must be non-object");for(var g in p)p.hasOwnProperty(g)&&(h[g]=p[g])}}return h},i.shrinkBuf=function(h,f){return h.length===f?h:h.subarray?h.subarray(0,f):(h.length=f,h)};var l={arraySet:function(h,f,p,g,b){if(f.subarray&&h.subarray)h.set(f.subarray(p,p+g),b);else for(var _=0;_<g;_++)h[b+_]=f[p+_]},flattenChunks:function(h){var f,p,g,b,_,w;for(f=g=0,p=h.length;f<p;f++)g+=h[f].length;for(w=new Uint8Array(g),f=b=0,p=h.length;f<p;f++)_=h[f],w.set(_,b),b+=_.length;return w}},d={arraySet:function(h,f,p,g,b){for(var _=0;_<g;_++)h[b+_]=f[p+_]},flattenChunks:function(h){return[].concat.apply([],h)}};i.setTyped=function(h){h?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,l)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,d))},i.setTyped(o)},{}],42:[function(n,r,i){var o=n("./common"),l=!0,d=!0;try{String.fromCharCode.apply(null,[0])}catch{l=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{d=!1}for(var h=new o.Buf8(256),f=0;f<256;f++)h[f]=252<=f?6:248<=f?5:240<=f?4:224<=f?3:192<=f?2:1;function p(g,b){if(b<65537&&(g.subarray&&d||!g.subarray&&l))return String.fromCharCode.apply(null,o.shrinkBuf(g,b));for(var _="",w=0;w<b;w++)_+=String.fromCharCode(g[w]);return _}h[254]=h[254]=1,i.string2buf=function(g){var b,_,w,x,S,C=g.length,T=0;for(x=0;x<C;x++)(64512&(_=g.charCodeAt(x)))==55296&&x+1<C&&(64512&(w=g.charCodeAt(x+1)))==56320&&(_=65536+(_-55296<<10)+(w-56320),x++),T+=_<128?1:_<2048?2:_<65536?3:4;for(b=new o.Buf8(T),x=S=0;S<T;x++)(64512&(_=g.charCodeAt(x)))==55296&&x+1<C&&(64512&(w=g.charCodeAt(x+1)))==56320&&(_=65536+(_-55296<<10)+(w-56320),x++),_<128?b[S++]=_:(_<2048?b[S++]=192|_>>>6:(_<65536?b[S++]=224|_>>>12:(b[S++]=240|_>>>18,b[S++]=128|_>>>12&63),b[S++]=128|_>>>6&63),b[S++]=128|63&_);return b},i.buf2binstring=function(g){return p(g,g.length)},i.binstring2buf=function(g){for(var b=new o.Buf8(g.length),_=0,w=b.length;_<w;_++)b[_]=g.charCodeAt(_);return b},i.buf2string=function(g,b){var _,w,x,S,C=b||g.length,T=new Array(2*C);for(_=w=0;_<C;)if((x=g[_++])<128)T[w++]=x;else if(4<(S=h[x]))T[w++]=65533,_+=S-1;else{for(x&=S===2?31:S===3?15:7;1<S&&_<C;)x=x<<6|63&g[_++],S--;1<S?T[w++]=65533:x<65536?T[w++]=x:(x-=65536,T[w++]=55296|x>>10&1023,T[w++]=56320|1023&x)}return p(T,w)},i.utf8border=function(g,b){var _;for((b=b||g.length)>g.length&&(b=g.length),_=b-1;0<=_&&(192&g[_])==128;)_--;return _<0||_===0?b:_+h[g[_]]>b?_:b}},{"./common":41}],43:[function(n,r,i){r.exports=function(o,l,d,h){for(var f=65535&o|0,p=o>>>16&65535|0,g=0;d!==0;){for(d-=g=2e3<d?2e3:d;p=p+(f=f+l[h++]|0)|0,--g;);f%=65521,p%=65521}return f|p<<16|0}},{}],44:[function(n,r,i){r.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(n,r,i){var o=(function(){for(var l,d=[],h=0;h<256;h++){l=h;for(var f=0;f<8;f++)l=1&l?3988292384^l>>>1:l>>>1;d[h]=l}return d})();r.exports=function(l,d,h,f){var p=o,g=f+h;l^=-1;for(var b=f;b<g;b++)l=l>>>8^p[255&(l^d[b])];return-1^l}},{}],46:[function(n,r,i){var o,l=n("../utils/common"),d=n("./trees"),h=n("./adler32"),f=n("./crc32"),p=n("./messages"),g=0,b=4,_=0,w=-2,x=-1,S=4,C=2,T=8,R=9,D=286,V=30,$=19,k=2*D+1,M=15,B=3,U=258,q=U+B+1,I=42,N=113,O=1,J=2,Y=3,G=4;function Z(L,de){return L.msg=p[de],de}function Q(L){return(L<<1)-(4<L?9:0)}function te(L){for(var de=L.length;0<=--de;)L[de]=0}function z(L){var de=L.state,ye=de.pending;ye>L.avail_out&&(ye=L.avail_out),ye!==0&&(l.arraySet(L.output,de.pending_buf,de.pending_out,ye,L.next_out),L.next_out+=ye,de.pending_out+=ye,L.total_out+=ye,L.avail_out-=ye,de.pending-=ye,de.pending===0&&(de.pending_out=0))}function H(L,de){d._tr_flush_block(L,0<=L.block_start?L.block_start:-1,L.strstart-L.block_start,de),L.block_start=L.strstart,z(L.strm)}function re(L,de){L.pending_buf[L.pending++]=de}function ne(L,de){L.pending_buf[L.pending++]=de>>>8&255,L.pending_buf[L.pending++]=255&de}function ce(L,de){var ye,ee,X=L.max_chain_length,ae=L.strstart,Ee=L.prev_length,Se=L.nice_match,ie=L.strstart>L.w_size-q?L.strstart-(L.w_size-q):0,Re=L.window,Ne=L.w_mask,Oe=L.prev,He=L.strstart+U,xt=Re[ae+Ee-1],nt=Re[ae+Ee];L.prev_length>=L.good_match&&(X>>=2),Se>L.lookahead&&(Se=L.lookahead);do if(Re[(ye=de)+Ee]===nt&&Re[ye+Ee-1]===xt&&Re[ye]===Re[ae]&&Re[++ye]===Re[ae+1]){ae+=2,ye++;do;while(Re[++ae]===Re[++ye]&&Re[++ae]===Re[++ye]&&Re[++ae]===Re[++ye]&&Re[++ae]===Re[++ye]&&Re[++ae]===Re[++ye]&&Re[++ae]===Re[++ye]&&Re[++ae]===Re[++ye]&&Re[++ae]===Re[++ye]&&ae<He);if(ee=U-(He-ae),ae=He-U,Ee<ee){if(L.match_start=de,Se<=(Ee=ee))break;xt=Re[ae+Ee-1],nt=Re[ae+Ee]}}while((de=Oe[de&Ne])>ie&&--X!=0);return Ee<=L.lookahead?Ee:L.lookahead}function he(L){var de,ye,ee,X,ae,Ee,Se,ie,Re,Ne,Oe=L.w_size;do{if(X=L.window_size-L.lookahead-L.strstart,L.strstart>=Oe+(Oe-q)){for(l.arraySet(L.window,L.window,Oe,Oe,0),L.match_start-=Oe,L.strstart-=Oe,L.block_start-=Oe,de=ye=L.hash_size;ee=L.head[--de],L.head[de]=Oe<=ee?ee-Oe:0,--ye;);for(de=ye=Oe;ee=L.prev[--de],L.prev[de]=Oe<=ee?ee-Oe:0,--ye;);X+=Oe}if(L.strm.avail_in===0)break;if(Ee=L.strm,Se=L.window,ie=L.strstart+L.lookahead,Re=X,Ne=void 0,Ne=Ee.avail_in,Re<Ne&&(Ne=Re),ye=Ne===0?0:(Ee.avail_in-=Ne,l.arraySet(Se,Ee.input,Ee.next_in,Ne,ie),Ee.state.wrap===1?Ee.adler=h(Ee.adler,Se,Ne,ie):Ee.state.wrap===2&&(Ee.adler=f(Ee.adler,Se,Ne,ie)),Ee.next_in+=Ne,Ee.total_in+=Ne,Ne),L.lookahead+=ye,L.lookahead+L.insert>=B)for(ae=L.strstart-L.insert,L.ins_h=L.window[ae],L.ins_h=(L.ins_h<<L.hash_shift^L.window[ae+1])&L.hash_mask;L.insert&&(L.ins_h=(L.ins_h<<L.hash_shift^L.window[ae+B-1])&L.hash_mask,L.prev[ae&L.w_mask]=L.head[L.ins_h],L.head[L.ins_h]=ae,ae++,L.insert--,!(L.lookahead+L.insert<B)););}while(L.lookahead<q&&L.strm.avail_in!==0)}function we(L,de){for(var ye,ee;;){if(L.lookahead<q){if(he(L),L.lookahead<q&&de===g)return O;if(L.lookahead===0)break}if(ye=0,L.lookahead>=B&&(L.ins_h=(L.ins_h<<L.hash_shift^L.window[L.strstart+B-1])&L.hash_mask,ye=L.prev[L.strstart&L.w_mask]=L.head[L.ins_h],L.head[L.ins_h]=L.strstart),ye!==0&&L.strstart-ye<=L.w_size-q&&(L.match_length=ce(L,ye)),L.match_length>=B)if(ee=d._tr_tally(L,L.strstart-L.match_start,L.match_length-B),L.lookahead-=L.match_length,L.match_length<=L.max_lazy_match&&L.lookahead>=B){for(L.match_length--;L.strstart++,L.ins_h=(L.ins_h<<L.hash_shift^L.window[L.strstart+B-1])&L.hash_mask,ye=L.prev[L.strstart&L.w_mask]=L.head[L.ins_h],L.head[L.ins_h]=L.strstart,--L.match_length!=0;);L.strstart++}else L.strstart+=L.match_length,L.match_length=0,L.ins_h=L.window[L.strstart],L.ins_h=(L.ins_h<<L.hash_shift^L.window[L.strstart+1])&L.hash_mask;else ee=d._tr_tally(L,0,L.window[L.strstart]),L.lookahead--,L.strstart++;if(ee&&(H(L,!1),L.strm.avail_out===0))return O}return L.insert=L.strstart<B-1?L.strstart:B-1,de===b?(H(L,!0),L.strm.avail_out===0?Y:G):L.last_lit&&(H(L,!1),L.strm.avail_out===0)?O:J}function oe(L,de){for(var ye,ee,X;;){if(L.lookahead<q){if(he(L),L.lookahead<q&&de===g)return O;if(L.lookahead===0)break}if(ye=0,L.lookahead>=B&&(L.ins_h=(L.ins_h<<L.hash_shift^L.window[L.strstart+B-1])&L.hash_mask,ye=L.prev[L.strstart&L.w_mask]=L.head[L.ins_h],L.head[L.ins_h]=L.strstart),L.prev_length=L.match_length,L.prev_match=L.match_start,L.match_length=B-1,ye!==0&&L.prev_length<L.max_lazy_match&&L.strstart-ye<=L.w_size-q&&(L.match_length=ce(L,ye),L.match_length<=5&&(L.strategy===1||L.match_length===B&&4096<L.strstart-L.match_start)&&(L.match_length=B-1)),L.prev_length>=B&&L.match_length<=L.prev_length){for(X=L.strstart+L.lookahead-B,ee=d._tr_tally(L,L.strstart-1-L.prev_match,L.prev_length-B),L.lookahead-=L.prev_length-1,L.prev_length-=2;++L.strstart<=X&&(L.ins_h=(L.ins_h<<L.hash_shift^L.window[L.strstart+B-1])&L.hash_mask,ye=L.prev[L.strstart&L.w_mask]=L.head[L.ins_h],L.head[L.ins_h]=L.strstart),--L.prev_length!=0;);if(L.match_available=0,L.match_length=B-1,L.strstart++,ee&&(H(L,!1),L.strm.avail_out===0))return O}else if(L.match_available){if((ee=d._tr_tally(L,0,L.window[L.strstart-1]))&&H(L,!1),L.strstart++,L.lookahead--,L.strm.avail_out===0)return O}else L.match_available=1,L.strstart++,L.lookahead--}return L.match_available&&(ee=d._tr_tally(L,0,L.window[L.strstart-1]),L.match_available=0),L.insert=L.strstart<B-1?L.strstart:B-1,de===b?(H(L,!0),L.strm.avail_out===0?Y:G):L.last_lit&&(H(L,!1),L.strm.avail_out===0)?O:J}function be(L,de,ye,ee,X){this.good_length=L,this.max_lazy=de,this.nice_length=ye,this.max_chain=ee,this.func=X}function Me(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=T,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new l.Buf16(2*k),this.dyn_dtree=new l.Buf16(2*(2*V+1)),this.bl_tree=new l.Buf16(2*(2*$+1)),te(this.dyn_ltree),te(this.dyn_dtree),te(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new l.Buf16(M+1),this.heap=new l.Buf16(2*D+1),te(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new l.Buf16(2*D+1),te(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function ze(L){var de;return L&&L.state?(L.total_in=L.total_out=0,L.data_type=C,(de=L.state).pending=0,de.pending_out=0,de.wrap<0&&(de.wrap=-de.wrap),de.status=de.wrap?I:N,L.adler=de.wrap===2?0:1,de.last_flush=g,d._tr_init(de),_):Z(L,w)}function at(L){var de=ze(L);return de===_&&(function(ye){ye.window_size=2*ye.w_size,te(ye.head),ye.max_lazy_match=o[ye.level].max_lazy,ye.good_match=o[ye.level].good_length,ye.nice_match=o[ye.level].nice_length,ye.max_chain_length=o[ye.level].max_chain,ye.strstart=0,ye.block_start=0,ye.lookahead=0,ye.insert=0,ye.match_length=ye.prev_length=B-1,ye.match_available=0,ye.ins_h=0})(L.state),de}function lt(L,de,ye,ee,X,ae){if(!L)return w;var Ee=1;if(de===x&&(de=6),ee<0?(Ee=0,ee=-ee):15<ee&&(Ee=2,ee-=16),X<1||R<X||ye!==T||ee<8||15<ee||de<0||9<de||ae<0||S<ae)return Z(L,w);ee===8&&(ee=9);var Se=new Me;return(L.state=Se).strm=L,Se.wrap=Ee,Se.gzhead=null,Se.w_bits=ee,Se.w_size=1<<Se.w_bits,Se.w_mask=Se.w_size-1,Se.hash_bits=X+7,Se.hash_size=1<<Se.hash_bits,Se.hash_mask=Se.hash_size-1,Se.hash_shift=~~((Se.hash_bits+B-1)/B),Se.window=new l.Buf8(2*Se.w_size),Se.head=new l.Buf16(Se.hash_size),Se.prev=new l.Buf16(Se.w_size),Se.lit_bufsize=1<<X+6,Se.pending_buf_size=4*Se.lit_bufsize,Se.pending_buf=new l.Buf8(Se.pending_buf_size),Se.d_buf=1*Se.lit_bufsize,Se.l_buf=3*Se.lit_bufsize,Se.level=de,Se.strategy=ae,Se.method=ye,at(L)}o=[new be(0,0,0,0,function(L,de){var ye=65535;for(ye>L.pending_buf_size-5&&(ye=L.pending_buf_size-5);;){if(L.lookahead<=1){if(he(L),L.lookahead===0&&de===g)return O;if(L.lookahead===0)break}L.strstart+=L.lookahead,L.lookahead=0;var ee=L.block_start+ye;if((L.strstart===0||L.strstart>=ee)&&(L.lookahead=L.strstart-ee,L.strstart=ee,H(L,!1),L.strm.avail_out===0)||L.strstart-L.block_start>=L.w_size-q&&(H(L,!1),L.strm.avail_out===0))return O}return L.insert=0,de===b?(H(L,!0),L.strm.avail_out===0?Y:G):(L.strstart>L.block_start&&(H(L,!1),L.strm.avail_out),O)}),new be(4,4,8,4,we),new be(4,5,16,8,we),new be(4,6,32,32,we),new be(4,4,16,16,oe),new be(8,16,32,32,oe),new be(8,16,128,128,oe),new be(8,32,128,256,oe),new be(32,128,258,1024,oe),new be(32,258,258,4096,oe)],i.deflateInit=function(L,de){return lt(L,de,T,15,8,0)},i.deflateInit2=lt,i.deflateReset=at,i.deflateResetKeep=ze,i.deflateSetHeader=function(L,de){return L&&L.state?L.state.wrap!==2?w:(L.state.gzhead=de,_):w},i.deflate=function(L,de){var ye,ee,X,ae;if(!L||!L.state||5<de||de<0)return L?Z(L,w):w;if(ee=L.state,!L.output||!L.input&&L.avail_in!==0||ee.status===666&&de!==b)return Z(L,L.avail_out===0?-5:w);if(ee.strm=L,ye=ee.last_flush,ee.last_flush=de,ee.status===I)if(ee.wrap===2)L.adler=0,re(ee,31),re(ee,139),re(ee,8),ee.gzhead?(re(ee,(ee.gzhead.text?1:0)+(ee.gzhead.hcrc?2:0)+(ee.gzhead.extra?4:0)+(ee.gzhead.name?8:0)+(ee.gzhead.comment?16:0)),re(ee,255&ee.gzhead.time),re(ee,ee.gzhead.time>>8&255),re(ee,ee.gzhead.time>>16&255),re(ee,ee.gzhead.time>>24&255),re(ee,ee.level===9?2:2<=ee.strategy||ee.level<2?4:0),re(ee,255&ee.gzhead.os),ee.gzhead.extra&&ee.gzhead.extra.length&&(re(ee,255&ee.gzhead.extra.length),re(ee,ee.gzhead.extra.length>>8&255)),ee.gzhead.hcrc&&(L.adler=f(L.adler,ee.pending_buf,ee.pending,0)),ee.gzindex=0,ee.status=69):(re(ee,0),re(ee,0),re(ee,0),re(ee,0),re(ee,0),re(ee,ee.level===9?2:2<=ee.strategy||ee.level<2?4:0),re(ee,3),ee.status=N);else{var Ee=T+(ee.w_bits-8<<4)<<8;Ee|=(2<=ee.strategy||ee.level<2?0:ee.level<6?1:ee.level===6?2:3)<<6,ee.strstart!==0&&(Ee|=32),Ee+=31-Ee%31,ee.status=N,ne(ee,Ee),ee.strstart!==0&&(ne(ee,L.adler>>>16),ne(ee,65535&L.adler)),L.adler=1}if(ee.status===69)if(ee.gzhead.extra){for(X=ee.pending;ee.gzindex<(65535&ee.gzhead.extra.length)&&(ee.pending!==ee.pending_buf_size||(ee.gzhead.hcrc&&ee.pending>X&&(L.adler=f(L.adler,ee.pending_buf,ee.pending-X,X)),z(L),X=ee.pending,ee.pending!==ee.pending_buf_size));)re(ee,255&ee.gzhead.extra[ee.gzindex]),ee.gzindex++;ee.gzhead.hcrc&&ee.pending>X&&(L.adler=f(L.adler,ee.pending_buf,ee.pending-X,X)),ee.gzindex===ee.gzhead.extra.length&&(ee.gzindex=0,ee.status=73)}else ee.status=73;if(ee.status===73)if(ee.gzhead.name){X=ee.pending;do{if(ee.pending===ee.pending_buf_size&&(ee.gzhead.hcrc&&ee.pending>X&&(L.adler=f(L.adler,ee.pending_buf,ee.pending-X,X)),z(L),X=ee.pending,ee.pending===ee.pending_buf_size)){ae=1;break}ae=ee.gzindex<ee.gzhead.name.length?255&ee.gzhead.name.charCodeAt(ee.gzindex++):0,re(ee,ae)}while(ae!==0);ee.gzhead.hcrc&&ee.pending>X&&(L.adler=f(L.adler,ee.pending_buf,ee.pending-X,X)),ae===0&&(ee.gzindex=0,ee.status=91)}else ee.status=91;if(ee.status===91)if(ee.gzhead.comment){X=ee.pending;do{if(ee.pending===ee.pending_buf_size&&(ee.gzhead.hcrc&&ee.pending>X&&(L.adler=f(L.adler,ee.pending_buf,ee.pending-X,X)),z(L),X=ee.pending,ee.pending===ee.pending_buf_size)){ae=1;break}ae=ee.gzindex<ee.gzhead.comment.length?255&ee.gzhead.comment.charCodeAt(ee.gzindex++):0,re(ee,ae)}while(ae!==0);ee.gzhead.hcrc&&ee.pending>X&&(L.adler=f(L.adler,ee.pending_buf,ee.pending-X,X)),ae===0&&(ee.status=103)}else ee.status=103;if(ee.status===103&&(ee.gzhead.hcrc?(ee.pending+2>ee.pending_buf_size&&z(L),ee.pending+2<=ee.pending_buf_size&&(re(ee,255&L.adler),re(ee,L.adler>>8&255),L.adler=0,ee.status=N)):ee.status=N),ee.pending!==0){if(z(L),L.avail_out===0)return ee.last_flush=-1,_}else if(L.avail_in===0&&Q(de)<=Q(ye)&&de!==b)return Z(L,-5);if(ee.status===666&&L.avail_in!==0)return Z(L,-5);if(L.avail_in!==0||ee.lookahead!==0||de!==g&&ee.status!==666){var Se=ee.strategy===2?(function(ie,Re){for(var Ne;;){if(ie.lookahead===0&&(he(ie),ie.lookahead===0)){if(Re===g)return O;break}if(ie.match_length=0,Ne=d._tr_tally(ie,0,ie.window[ie.strstart]),ie.lookahead--,ie.strstart++,Ne&&(H(ie,!1),ie.strm.avail_out===0))return O}return ie.insert=0,Re===b?(H(ie,!0),ie.strm.avail_out===0?Y:G):ie.last_lit&&(H(ie,!1),ie.strm.avail_out===0)?O:J})(ee,de):ee.strategy===3?(function(ie,Re){for(var Ne,Oe,He,xt,nt=ie.window;;){if(ie.lookahead<=U){if(he(ie),ie.lookahead<=U&&Re===g)return O;if(ie.lookahead===0)break}if(ie.match_length=0,ie.lookahead>=B&&0<ie.strstart&&(Oe=nt[He=ie.strstart-1])===nt[++He]&&Oe===nt[++He]&&Oe===nt[++He]){xt=ie.strstart+U;do;while(Oe===nt[++He]&&Oe===nt[++He]&&Oe===nt[++He]&&Oe===nt[++He]&&Oe===nt[++He]&&Oe===nt[++He]&&Oe===nt[++He]&&Oe===nt[++He]&&He<xt);ie.match_length=U-(xt-He),ie.match_length>ie.lookahead&&(ie.match_length=ie.lookahead)}if(ie.match_length>=B?(Ne=d._tr_tally(ie,1,ie.match_length-B),ie.lookahead-=ie.match_length,ie.strstart+=ie.match_length,ie.match_length=0):(Ne=d._tr_tally(ie,0,ie.window[ie.strstart]),ie.lookahead--,ie.strstart++),Ne&&(H(ie,!1),ie.strm.avail_out===0))return O}return ie.insert=0,Re===b?(H(ie,!0),ie.strm.avail_out===0?Y:G):ie.last_lit&&(H(ie,!1),ie.strm.avail_out===0)?O:J})(ee,de):o[ee.level].func(ee,de);if(Se!==Y&&Se!==G||(ee.status=666),Se===O||Se===Y)return L.avail_out===0&&(ee.last_flush=-1),_;if(Se===J&&(de===1?d._tr_align(ee):de!==5&&(d._tr_stored_block(ee,0,0,!1),de===3&&(te(ee.head),ee.lookahead===0&&(ee.strstart=0,ee.block_start=0,ee.insert=0))),z(L),L.avail_out===0))return ee.last_flush=-1,_}return de!==b?_:ee.wrap<=0?1:(ee.wrap===2?(re(ee,255&L.adler),re(ee,L.adler>>8&255),re(ee,L.adler>>16&255),re(ee,L.adler>>24&255),re(ee,255&L.total_in),re(ee,L.total_in>>8&255),re(ee,L.total_in>>16&255),re(ee,L.total_in>>24&255)):(ne(ee,L.adler>>>16),ne(ee,65535&L.adler)),z(L),0<ee.wrap&&(ee.wrap=-ee.wrap),ee.pending!==0?_:1)},i.deflateEnd=function(L){var de;return L&&L.state?(de=L.state.status)!==I&&de!==69&&de!==73&&de!==91&&de!==103&&de!==N&&de!==666?Z(L,w):(L.state=null,de===N?Z(L,-3):_):w},i.deflateSetDictionary=function(L,de){var ye,ee,X,ae,Ee,Se,ie,Re,Ne=de.length;if(!L||!L.state||(ae=(ye=L.state).wrap)===2||ae===1&&ye.status!==I||ye.lookahead)return w;for(ae===1&&(L.adler=h(L.adler,de,Ne,0)),ye.wrap=0,Ne>=ye.w_size&&(ae===0&&(te(ye.head),ye.strstart=0,ye.block_start=0,ye.insert=0),Re=new l.Buf8(ye.w_size),l.arraySet(Re,de,Ne-ye.w_size,ye.w_size,0),de=Re,Ne=ye.w_size),Ee=L.avail_in,Se=L.next_in,ie=L.input,L.avail_in=Ne,L.next_in=0,L.input=de,he(ye);ye.lookahead>=B;){for(ee=ye.strstart,X=ye.lookahead-(B-1);ye.ins_h=(ye.ins_h<<ye.hash_shift^ye.window[ee+B-1])&ye.hash_mask,ye.prev[ee&ye.w_mask]=ye.head[ye.ins_h],ye.head[ye.ins_h]=ee,ee++,--X;);ye.strstart=ee,ye.lookahead=B-1,he(ye)}return ye.strstart+=ye.lookahead,ye.block_start=ye.strstart,ye.insert=ye.lookahead,ye.lookahead=0,ye.match_length=ye.prev_length=B-1,ye.match_available=0,L.next_in=Se,L.input=ie,L.avail_in=Ee,ye.wrap=ae,_},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(n,r,i){r.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(n,r,i){r.exports=function(o,l){var d,h,f,p,g,b,_,w,x,S,C,T,R,D,V,$,k,M,B,U,q,I,N,O,J;d=o.state,h=o.next_in,O=o.input,f=h+(o.avail_in-5),p=o.next_out,J=o.output,g=p-(l-o.avail_out),b=p+(o.avail_out-257),_=d.dmax,w=d.wsize,x=d.whave,S=d.wnext,C=d.window,T=d.hold,R=d.bits,D=d.lencode,V=d.distcode,$=(1<<d.lenbits)-1,k=(1<<d.distbits)-1;e:do{R<15&&(T+=O[h++]<<R,R+=8,T+=O[h++]<<R,R+=8),M=D[T&$];t:for(;;){if(T>>>=B=M>>>24,R-=B,(B=M>>>16&255)===0)J[p++]=65535&M;else{if(!(16&B)){if((64&B)==0){M=D[(65535&M)+(T&(1<<B)-1)];continue t}if(32&B){d.mode=12;break e}o.msg="invalid literal/length code",d.mode=30;break e}U=65535&M,(B&=15)&&(R<B&&(T+=O[h++]<<R,R+=8),U+=T&(1<<B)-1,T>>>=B,R-=B),R<15&&(T+=O[h++]<<R,R+=8,T+=O[h++]<<R,R+=8),M=V[T&k];n:for(;;){if(T>>>=B=M>>>24,R-=B,!(16&(B=M>>>16&255))){if((64&B)==0){M=V[(65535&M)+(T&(1<<B)-1)];continue n}o.msg="invalid distance code",d.mode=30;break e}if(q=65535&M,R<(B&=15)&&(T+=O[h++]<<R,(R+=8)<B&&(T+=O[h++]<<R,R+=8)),_<(q+=T&(1<<B)-1)){o.msg="invalid distance too far back",d.mode=30;break e}if(T>>>=B,R-=B,(B=p-g)<q){if(x<(B=q-B)&&d.sane){o.msg="invalid distance too far back",d.mode=30;break e}if(N=C,(I=0)===S){if(I+=w-B,B<U){for(U-=B;J[p++]=C[I++],--B;);I=p-q,N=J}}else if(S<B){if(I+=w+S-B,(B-=S)<U){for(U-=B;J[p++]=C[I++],--B;);if(I=0,S<U){for(U-=B=S;J[p++]=C[I++],--B;);I=p-q,N=J}}}else if(I+=S-B,B<U){for(U-=B;J[p++]=C[I++],--B;);I=p-q,N=J}for(;2<U;)J[p++]=N[I++],J[p++]=N[I++],J[p++]=N[I++],U-=3;U&&(J[p++]=N[I++],1<U&&(J[p++]=N[I++]))}else{for(I=p-q;J[p++]=J[I++],J[p++]=J[I++],J[p++]=J[I++],2<(U-=3););U&&(J[p++]=J[I++],1<U&&(J[p++]=J[I++]))}break}}break}}while(h<f&&p<b);h-=U=R>>3,T&=(1<<(R-=U<<3))-1,o.next_in=h,o.next_out=p,o.avail_in=h<f?f-h+5:5-(h-f),o.avail_out=p<b?b-p+257:257-(p-b),d.hold=T,d.bits=R}},{}],49:[function(n,r,i){var o=n("../utils/common"),l=n("./adler32"),d=n("./crc32"),h=n("./inffast"),f=n("./inftrees"),p=1,g=2,b=0,_=-2,w=1,x=852,S=592;function C(I){return(I>>>24&255)+(I>>>8&65280)+((65280&I)<<8)+((255&I)<<24)}function T(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new o.Buf16(320),this.work=new o.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function R(I){var N;return I&&I.state?(N=I.state,I.total_in=I.total_out=N.total=0,I.msg="",N.wrap&&(I.adler=1&N.wrap),N.mode=w,N.last=0,N.havedict=0,N.dmax=32768,N.head=null,N.hold=0,N.bits=0,N.lencode=N.lendyn=new o.Buf32(x),N.distcode=N.distdyn=new o.Buf32(S),N.sane=1,N.back=-1,b):_}function D(I){var N;return I&&I.state?((N=I.state).wsize=0,N.whave=0,N.wnext=0,R(I)):_}function V(I,N){var O,J;return I&&I.state?(J=I.state,N<0?(O=0,N=-N):(O=1+(N>>4),N<48&&(N&=15)),N&&(N<8||15<N)?_:(J.window!==null&&J.wbits!==N&&(J.window=null),J.wrap=O,J.wbits=N,D(I))):_}function $(I,N){var O,J;return I?(J=new T,(I.state=J).window=null,(O=V(I,N))!==b&&(I.state=null),O):_}var k,M,B=!0;function U(I){if(B){var N;for(k=new o.Buf32(512),M=new o.Buf32(32),N=0;N<144;)I.lens[N++]=8;for(;N<256;)I.lens[N++]=9;for(;N<280;)I.lens[N++]=7;for(;N<288;)I.lens[N++]=8;for(f(p,I.lens,0,288,k,0,I.work,{bits:9}),N=0;N<32;)I.lens[N++]=5;f(g,I.lens,0,32,M,0,I.work,{bits:5}),B=!1}I.lencode=k,I.lenbits=9,I.distcode=M,I.distbits=5}function q(I,N,O,J){var Y,G=I.state;return G.window===null&&(G.wsize=1<<G.wbits,G.wnext=0,G.whave=0,G.window=new o.Buf8(G.wsize)),J>=G.wsize?(o.arraySet(G.window,N,O-G.wsize,G.wsize,0),G.wnext=0,G.whave=G.wsize):(J<(Y=G.wsize-G.wnext)&&(Y=J),o.arraySet(G.window,N,O-J,Y,G.wnext),(J-=Y)?(o.arraySet(G.window,N,O-J,J,0),G.wnext=J,G.whave=G.wsize):(G.wnext+=Y,G.wnext===G.wsize&&(G.wnext=0),G.whave<G.wsize&&(G.whave+=Y))),0}i.inflateReset=D,i.inflateReset2=V,i.inflateResetKeep=R,i.inflateInit=function(I){return $(I,15)},i.inflateInit2=$,i.inflate=function(I,N){var O,J,Y,G,Z,Q,te,z,H,re,ne,ce,he,we,oe,be,Me,ze,at,lt,L,de,ye,ee,X=0,ae=new o.Buf8(4),Ee=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!I||!I.state||!I.output||!I.input&&I.avail_in!==0)return _;(O=I.state).mode===12&&(O.mode=13),Z=I.next_out,Y=I.output,te=I.avail_out,G=I.next_in,J=I.input,Q=I.avail_in,z=O.hold,H=O.bits,re=Q,ne=te,de=b;e:for(;;)switch(O.mode){case w:if(O.wrap===0){O.mode=13;break}for(;H<16;){if(Q===0)break e;Q--,z+=J[G++]<<H,H+=8}if(2&O.wrap&&z===35615){ae[O.check=0]=255&z,ae[1]=z>>>8&255,O.check=d(O.check,ae,2,0),H=z=0,O.mode=2;break}if(O.flags=0,O.head&&(O.head.done=!1),!(1&O.wrap)||(((255&z)<<8)+(z>>8))%31){I.msg="incorrect header check",O.mode=30;break}if((15&z)!=8){I.msg="unknown compression method",O.mode=30;break}if(H-=4,L=8+(15&(z>>>=4)),O.wbits===0)O.wbits=L;else if(L>O.wbits){I.msg="invalid window size",O.mode=30;break}O.dmax=1<<L,I.adler=O.check=1,O.mode=512&z?10:12,H=z=0;break;case 2:for(;H<16;){if(Q===0)break e;Q--,z+=J[G++]<<H,H+=8}if(O.flags=z,(255&O.flags)!=8){I.msg="unknown compression method",O.mode=30;break}if(57344&O.flags){I.msg="unknown header flags set",O.mode=30;break}O.head&&(O.head.text=z>>8&1),512&O.flags&&(ae[0]=255&z,ae[1]=z>>>8&255,O.check=d(O.check,ae,2,0)),H=z=0,O.mode=3;case 3:for(;H<32;){if(Q===0)break e;Q--,z+=J[G++]<<H,H+=8}O.head&&(O.head.time=z),512&O.flags&&(ae[0]=255&z,ae[1]=z>>>8&255,ae[2]=z>>>16&255,ae[3]=z>>>24&255,O.check=d(O.check,ae,4,0)),H=z=0,O.mode=4;case 4:for(;H<16;){if(Q===0)break e;Q--,z+=J[G++]<<H,H+=8}O.head&&(O.head.xflags=255&z,O.head.os=z>>8),512&O.flags&&(ae[0]=255&z,ae[1]=z>>>8&255,O.check=d(O.check,ae,2,0)),H=z=0,O.mode=5;case 5:if(1024&O.flags){for(;H<16;){if(Q===0)break e;Q--,z+=J[G++]<<H,H+=8}O.length=z,O.head&&(O.head.extra_len=z),512&O.flags&&(ae[0]=255&z,ae[1]=z>>>8&255,O.check=d(O.check,ae,2,0)),H=z=0}else O.head&&(O.head.extra=null);O.mode=6;case 6:if(1024&O.flags&&(Q<(ce=O.length)&&(ce=Q),ce&&(O.head&&(L=O.head.extra_len-O.length,O.head.extra||(O.head.extra=new Array(O.head.extra_len)),o.arraySet(O.head.extra,J,G,ce,L)),512&O.flags&&(O.check=d(O.check,J,ce,G)),Q-=ce,G+=ce,O.length-=ce),O.length))break e;O.length=0,O.mode=7;case 7:if(2048&O.flags){if(Q===0)break e;for(ce=0;L=J[G+ce++],O.head&&L&&O.length<65536&&(O.head.name+=String.fromCharCode(L)),L&&ce<Q;);if(512&O.flags&&(O.check=d(O.check,J,ce,G)),Q-=ce,G+=ce,L)break e}else O.head&&(O.head.name=null);O.length=0,O.mode=8;case 8:if(4096&O.flags){if(Q===0)break e;for(ce=0;L=J[G+ce++],O.head&&L&&O.length<65536&&(O.head.comment+=String.fromCharCode(L)),L&&ce<Q;);if(512&O.flags&&(O.check=d(O.check,J,ce,G)),Q-=ce,G+=ce,L)break e}else O.head&&(O.head.comment=null);O.mode=9;case 9:if(512&O.flags){for(;H<16;){if(Q===0)break e;Q--,z+=J[G++]<<H,H+=8}if(z!==(65535&O.check)){I.msg="header crc mismatch",O.mode=30;break}H=z=0}O.head&&(O.head.hcrc=O.flags>>9&1,O.head.done=!0),I.adler=O.check=0,O.mode=12;break;case 10:for(;H<32;){if(Q===0)break e;Q--,z+=J[G++]<<H,H+=8}I.adler=O.check=C(z),H=z=0,O.mode=11;case 11:if(O.havedict===0)return I.next_out=Z,I.avail_out=te,I.next_in=G,I.avail_in=Q,O.hold=z,O.bits=H,2;I.adler=O.check=1,O.mode=12;case 12:if(N===5||N===6)break e;case 13:if(O.last){z>>>=7&H,H-=7&H,O.mode=27;break}for(;H<3;){if(Q===0)break e;Q--,z+=J[G++]<<H,H+=8}switch(O.last=1&z,H-=1,3&(z>>>=1)){case 0:O.mode=14;break;case 1:if(U(O),O.mode=20,N!==6)break;z>>>=2,H-=2;break e;case 2:O.mode=17;break;case 3:I.msg="invalid block type",O.mode=30}z>>>=2,H-=2;break;case 14:for(z>>>=7&H,H-=7&H;H<32;){if(Q===0)break e;Q--,z+=J[G++]<<H,H+=8}if((65535&z)!=(z>>>16^65535)){I.msg="invalid stored block lengths",O.mode=30;break}if(O.length=65535&z,H=z=0,O.mode=15,N===6)break e;case 15:O.mode=16;case 16:if(ce=O.length){if(Q<ce&&(ce=Q),te<ce&&(ce=te),ce===0)break e;o.arraySet(Y,J,G,ce,Z),Q-=ce,G+=ce,te-=ce,Z+=ce,O.length-=ce;break}O.mode=12;break;case 17:for(;H<14;){if(Q===0)break e;Q--,z+=J[G++]<<H,H+=8}if(O.nlen=257+(31&z),z>>>=5,H-=5,O.ndist=1+(31&z),z>>>=5,H-=5,O.ncode=4+(15&z),z>>>=4,H-=4,286<O.nlen||30<O.ndist){I.msg="too many length or distance symbols",O.mode=30;break}O.have=0,O.mode=18;case 18:for(;O.have<O.ncode;){for(;H<3;){if(Q===0)break e;Q--,z+=J[G++]<<H,H+=8}O.lens[Ee[O.have++]]=7&z,z>>>=3,H-=3}for(;O.have<19;)O.lens[Ee[O.have++]]=0;if(O.lencode=O.lendyn,O.lenbits=7,ye={bits:O.lenbits},de=f(0,O.lens,0,19,O.lencode,0,O.work,ye),O.lenbits=ye.bits,de){I.msg="invalid code lengths set",O.mode=30;break}O.have=0,O.mode=19;case 19:for(;O.have<O.nlen+O.ndist;){for(;be=(X=O.lencode[z&(1<<O.lenbits)-1])>>>16&255,Me=65535&X,!((oe=X>>>24)<=H);){if(Q===0)break e;Q--,z+=J[G++]<<H,H+=8}if(Me<16)z>>>=oe,H-=oe,O.lens[O.have++]=Me;else{if(Me===16){for(ee=oe+2;H<ee;){if(Q===0)break e;Q--,z+=J[G++]<<H,H+=8}if(z>>>=oe,H-=oe,O.have===0){I.msg="invalid bit length repeat",O.mode=30;break}L=O.lens[O.have-1],ce=3+(3&z),z>>>=2,H-=2}else if(Me===17){for(ee=oe+3;H<ee;){if(Q===0)break e;Q--,z+=J[G++]<<H,H+=8}H-=oe,L=0,ce=3+(7&(z>>>=oe)),z>>>=3,H-=3}else{for(ee=oe+7;H<ee;){if(Q===0)break e;Q--,z+=J[G++]<<H,H+=8}H-=oe,L=0,ce=11+(127&(z>>>=oe)),z>>>=7,H-=7}if(O.have+ce>O.nlen+O.ndist){I.msg="invalid bit length repeat",O.mode=30;break}for(;ce--;)O.lens[O.have++]=L}}if(O.mode===30)break;if(O.lens[256]===0){I.msg="invalid code -- missing end-of-block",O.mode=30;break}if(O.lenbits=9,ye={bits:O.lenbits},de=f(p,O.lens,0,O.nlen,O.lencode,0,O.work,ye),O.lenbits=ye.bits,de){I.msg="invalid literal/lengths set",O.mode=30;break}if(O.distbits=6,O.distcode=O.distdyn,ye={bits:O.distbits},de=f(g,O.lens,O.nlen,O.ndist,O.distcode,0,O.work,ye),O.distbits=ye.bits,de){I.msg="invalid distances set",O.mode=30;break}if(O.mode=20,N===6)break e;case 20:O.mode=21;case 21:if(6<=Q&&258<=te){I.next_out=Z,I.avail_out=te,I.next_in=G,I.avail_in=Q,O.hold=z,O.bits=H,h(I,ne),Z=I.next_out,Y=I.output,te=I.avail_out,G=I.next_in,J=I.input,Q=I.avail_in,z=O.hold,H=O.bits,O.mode===12&&(O.back=-1);break}for(O.back=0;be=(X=O.lencode[z&(1<<O.lenbits)-1])>>>16&255,Me=65535&X,!((oe=X>>>24)<=H);){if(Q===0)break e;Q--,z+=J[G++]<<H,H+=8}if(be&&(240&be)==0){for(ze=oe,at=be,lt=Me;be=(X=O.lencode[lt+((z&(1<<ze+at)-1)>>ze)])>>>16&255,Me=65535&X,!(ze+(oe=X>>>24)<=H);){if(Q===0)break e;Q--,z+=J[G++]<<H,H+=8}z>>>=ze,H-=ze,O.back+=ze}if(z>>>=oe,H-=oe,O.back+=oe,O.length=Me,be===0){O.mode=26;break}if(32&be){O.back=-1,O.mode=12;break}if(64&be){I.msg="invalid literal/length code",O.mode=30;break}O.extra=15&be,O.mode=22;case 22:if(O.extra){for(ee=O.extra;H<ee;){if(Q===0)break e;Q--,z+=J[G++]<<H,H+=8}O.length+=z&(1<<O.extra)-1,z>>>=O.extra,H-=O.extra,O.back+=O.extra}O.was=O.length,O.mode=23;case 23:for(;be=(X=O.distcode[z&(1<<O.distbits)-1])>>>16&255,Me=65535&X,!((oe=X>>>24)<=H);){if(Q===0)break e;Q--,z+=J[G++]<<H,H+=8}if((240&be)==0){for(ze=oe,at=be,lt=Me;be=(X=O.distcode[lt+((z&(1<<ze+at)-1)>>ze)])>>>16&255,Me=65535&X,!(ze+(oe=X>>>24)<=H);){if(Q===0)break e;Q--,z+=J[G++]<<H,H+=8}z>>>=ze,H-=ze,O.back+=ze}if(z>>>=oe,H-=oe,O.back+=oe,64&be){I.msg="invalid distance code",O.mode=30;break}O.offset=Me,O.extra=15&be,O.mode=24;case 24:if(O.extra){for(ee=O.extra;H<ee;){if(Q===0)break e;Q--,z+=J[G++]<<H,H+=8}O.offset+=z&(1<<O.extra)-1,z>>>=O.extra,H-=O.extra,O.back+=O.extra}if(O.offset>O.dmax){I.msg="invalid distance too far back",O.mode=30;break}O.mode=25;case 25:if(te===0)break e;if(ce=ne-te,O.offset>ce){if((ce=O.offset-ce)>O.whave&&O.sane){I.msg="invalid distance too far back",O.mode=30;break}he=ce>O.wnext?(ce-=O.wnext,O.wsize-ce):O.wnext-ce,ce>O.length&&(ce=O.length),we=O.window}else we=Y,he=Z-O.offset,ce=O.length;for(te<ce&&(ce=te),te-=ce,O.length-=ce;Y[Z++]=we[he++],--ce;);O.length===0&&(O.mode=21);break;case 26:if(te===0)break e;Y[Z++]=O.length,te--,O.mode=21;break;case 27:if(O.wrap){for(;H<32;){if(Q===0)break e;Q--,z|=J[G++]<<H,H+=8}if(ne-=te,I.total_out+=ne,O.total+=ne,ne&&(I.adler=O.check=O.flags?d(O.check,Y,ne,Z-ne):l(O.check,Y,ne,Z-ne)),ne=te,(O.flags?z:C(z))!==O.check){I.msg="incorrect data check",O.mode=30;break}H=z=0}O.mode=28;case 28:if(O.wrap&&O.flags){for(;H<32;){if(Q===0)break e;Q--,z+=J[G++]<<H,H+=8}if(z!==(4294967295&O.total)){I.msg="incorrect length check",O.mode=30;break}H=z=0}O.mode=29;case 29:de=1;break e;case 30:de=-3;break e;case 31:return-4;default:return _}return I.next_out=Z,I.avail_out=te,I.next_in=G,I.avail_in=Q,O.hold=z,O.bits=H,(O.wsize||ne!==I.avail_out&&O.mode<30&&(O.mode<27||N!==4))&&q(I,I.output,I.next_out,ne-I.avail_out)?(O.mode=31,-4):(re-=I.avail_in,ne-=I.avail_out,I.total_in+=re,I.total_out+=ne,O.total+=ne,O.wrap&&ne&&(I.adler=O.check=O.flags?d(O.check,Y,ne,I.next_out-ne):l(O.check,Y,ne,I.next_out-ne)),I.data_type=O.bits+(O.last?64:0)+(O.mode===12?128:0)+(O.mode===20||O.mode===15?256:0),(re==0&&ne===0||N===4)&&de===b&&(de=-5),de)},i.inflateEnd=function(I){if(!I||!I.state)return _;var N=I.state;return N.window&&(N.window=null),I.state=null,b},i.inflateGetHeader=function(I,N){var O;return I&&I.state?(2&(O=I.state).wrap)==0?_:((O.head=N).done=!1,b):_},i.inflateSetDictionary=function(I,N){var O,J=N.length;return I&&I.state?(O=I.state).wrap!==0&&O.mode!==11?_:O.mode===11&&l(1,N,J,0)!==O.check?-3:q(I,N,J,J)?(O.mode=31,-4):(O.havedict=1,b):_},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(n,r,i){var o=n("../utils/common"),l=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],d=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],h=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],f=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];r.exports=function(p,g,b,_,w,x,S,C){var T,R,D,V,$,k,M,B,U,q=C.bits,I=0,N=0,O=0,J=0,Y=0,G=0,Z=0,Q=0,te=0,z=0,H=null,re=0,ne=new o.Buf16(16),ce=new o.Buf16(16),he=null,we=0;for(I=0;I<=15;I++)ne[I]=0;for(N=0;N<_;N++)ne[g[b+N]]++;for(Y=q,J=15;1<=J&&ne[J]===0;J--);if(J<Y&&(Y=J),J===0)return w[x++]=20971520,w[x++]=20971520,C.bits=1,0;for(O=1;O<J&&ne[O]===0;O++);for(Y<O&&(Y=O),I=Q=1;I<=15;I++)if(Q<<=1,(Q-=ne[I])<0)return-1;if(0<Q&&(p===0||J!==1))return-1;for(ce[1]=0,I=1;I<15;I++)ce[I+1]=ce[I]+ne[I];for(N=0;N<_;N++)g[b+N]!==0&&(S[ce[g[b+N]]++]=N);if(k=p===0?(H=he=S,19):p===1?(H=l,re-=257,he=d,we-=257,256):(H=h,he=f,-1),I=O,$=x,Z=N=z=0,D=-1,V=(te=1<<(G=Y))-1,p===1&&852<te||p===2&&592<te)return 1;for(;;){for(M=I-Z,U=S[N]<k?(B=0,S[N]):S[N]>k?(B=he[we+S[N]],H[re+S[N]]):(B=96,0),T=1<<I-Z,O=R=1<<G;w[$+(z>>Z)+(R-=T)]=M<<24|B<<16|U|0,R!==0;);for(T=1<<I-1;z&T;)T>>=1;if(T!==0?(z&=T-1,z+=T):z=0,N++,--ne[I]==0){if(I===J)break;I=g[b+S[N]]}if(Y<I&&(z&V)!==D){for(Z===0&&(Z=Y),$+=O,Q=1<<(G=I-Z);G+Z<J&&!((Q-=ne[G+Z])<=0);)G++,Q<<=1;if(te+=1<<G,p===1&&852<te||p===2&&592<te)return 1;w[D=z&V]=Y<<24|G<<16|$-x|0}}return z!==0&&(w[$+z]=I-Z<<24|64<<16|0),C.bits=Y,0}},{"../utils/common":41}],51:[function(n,r,i){r.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(n,r,i){var o=n("../utils/common"),l=0,d=1;function h(X){for(var ae=X.length;0<=--ae;)X[ae]=0}var f=0,p=29,g=256,b=g+1+p,_=30,w=19,x=2*b+1,S=15,C=16,T=7,R=256,D=16,V=17,$=18,k=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],M=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],B=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],U=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],q=new Array(2*(b+2));h(q);var I=new Array(2*_);h(I);var N=new Array(512);h(N);var O=new Array(256);h(O);var J=new Array(p);h(J);var Y,G,Z,Q=new Array(_);function te(X,ae,Ee,Se,ie){this.static_tree=X,this.extra_bits=ae,this.extra_base=Ee,this.elems=Se,this.max_length=ie,this.has_stree=X&&X.length}function z(X,ae){this.dyn_tree=X,this.max_code=0,this.stat_desc=ae}function H(X){return X<256?N[X]:N[256+(X>>>7)]}function re(X,ae){X.pending_buf[X.pending++]=255&ae,X.pending_buf[X.pending++]=ae>>>8&255}function ne(X,ae,Ee){X.bi_valid>C-Ee?(X.bi_buf|=ae<<X.bi_valid&65535,re(X,X.bi_buf),X.bi_buf=ae>>C-X.bi_valid,X.bi_valid+=Ee-C):(X.bi_buf|=ae<<X.bi_valid&65535,X.bi_valid+=Ee)}function ce(X,ae,Ee){ne(X,Ee[2*ae],Ee[2*ae+1])}function he(X,ae){for(var Ee=0;Ee|=1&X,X>>>=1,Ee<<=1,0<--ae;);return Ee>>>1}function we(X,ae,Ee){var Se,ie,Re=new Array(S+1),Ne=0;for(Se=1;Se<=S;Se++)Re[Se]=Ne=Ne+Ee[Se-1]<<1;for(ie=0;ie<=ae;ie++){var Oe=X[2*ie+1];Oe!==0&&(X[2*ie]=he(Re[Oe]++,Oe))}}function oe(X){var ae;for(ae=0;ae<b;ae++)X.dyn_ltree[2*ae]=0;for(ae=0;ae<_;ae++)X.dyn_dtree[2*ae]=0;for(ae=0;ae<w;ae++)X.bl_tree[2*ae]=0;X.dyn_ltree[2*R]=1,X.opt_len=X.static_len=0,X.last_lit=X.matches=0}function be(X){8<X.bi_valid?re(X,X.bi_buf):0<X.bi_valid&&(X.pending_buf[X.pending++]=X.bi_buf),X.bi_buf=0,X.bi_valid=0}function Me(X,ae,Ee,Se){var ie=2*ae,Re=2*Ee;return X[ie]<X[Re]||X[ie]===X[Re]&&Se[ae]<=Se[Ee]}function ze(X,ae,Ee){for(var Se=X.heap[Ee],ie=Ee<<1;ie<=X.heap_len&&(ie<X.heap_len&&Me(ae,X.heap[ie+1],X.heap[ie],X.depth)&&ie++,!Me(ae,Se,X.heap[ie],X.depth));)X.heap[Ee]=X.heap[ie],Ee=ie,ie<<=1;X.heap[Ee]=Se}function at(X,ae,Ee){var Se,ie,Re,Ne,Oe=0;if(X.last_lit!==0)for(;Se=X.pending_buf[X.d_buf+2*Oe]<<8|X.pending_buf[X.d_buf+2*Oe+1],ie=X.pending_buf[X.l_buf+Oe],Oe++,Se===0?ce(X,ie,ae):(ce(X,(Re=O[ie])+g+1,ae),(Ne=k[Re])!==0&&ne(X,ie-=J[Re],Ne),ce(X,Re=H(--Se),Ee),(Ne=M[Re])!==0&&ne(X,Se-=Q[Re],Ne)),Oe<X.last_lit;);ce(X,R,ae)}function lt(X,ae){var Ee,Se,ie,Re=ae.dyn_tree,Ne=ae.stat_desc.static_tree,Oe=ae.stat_desc.has_stree,He=ae.stat_desc.elems,xt=-1;for(X.heap_len=0,X.heap_max=x,Ee=0;Ee<He;Ee++)Re[2*Ee]!==0?(X.heap[++X.heap_len]=xt=Ee,X.depth[Ee]=0):Re[2*Ee+1]=0;for(;X.heap_len<2;)Re[2*(ie=X.heap[++X.heap_len]=xt<2?++xt:0)]=1,X.depth[ie]=0,X.opt_len--,Oe&&(X.static_len-=Ne[2*ie+1]);for(ae.max_code=xt,Ee=X.heap_len>>1;1<=Ee;Ee--)ze(X,Re,Ee);for(ie=He;Ee=X.heap[1],X.heap[1]=X.heap[X.heap_len--],ze(X,Re,1),Se=X.heap[1],X.heap[--X.heap_max]=Ee,X.heap[--X.heap_max]=Se,Re[2*ie]=Re[2*Ee]+Re[2*Se],X.depth[ie]=(X.depth[Ee]>=X.depth[Se]?X.depth[Ee]:X.depth[Se])+1,Re[2*Ee+1]=Re[2*Se+1]=ie,X.heap[1]=ie++,ze(X,Re,1),2<=X.heap_len;);X.heap[--X.heap_max]=X.heap[1],(function(nt,Gn){var gs,sr,ys,vt,nn,Wn,Et=Gn.dyn_tree,Ga=Gn.max_code,Oi=Gn.stat_desc.static_tree,Wo=Gn.stat_desc.has_stree,Or=Gn.stat_desc.extra_bits,_s=Gn.stat_desc.extra_base,Ft=Gn.stat_desc.max_length,ir=0;for(vt=0;vt<=S;vt++)nt.bl_count[vt]=0;for(Et[2*nt.heap[nt.heap_max]+1]=0,gs=nt.heap_max+1;gs<x;gs++)Ft<(vt=Et[2*Et[2*(sr=nt.heap[gs])+1]+1]+1)&&(vt=Ft,ir++),Et[2*sr+1]=vt,Ga<sr||(nt.bl_count[vt]++,nn=0,_s<=sr&&(nn=Or[sr-_s]),Wn=Et[2*sr],nt.opt_len+=Wn*(vt+nn),Wo&&(nt.static_len+=Wn*(Oi[2*sr+1]+nn)));if(ir!==0){do{for(vt=Ft-1;nt.bl_count[vt]===0;)vt--;nt.bl_count[vt]--,nt.bl_count[vt+1]+=2,nt.bl_count[Ft]--,ir-=2}while(0<ir);for(vt=Ft;vt!==0;vt--)for(sr=nt.bl_count[vt];sr!==0;)Ga<(ys=nt.heap[--gs])||(Et[2*ys+1]!==vt&&(nt.opt_len+=(vt-Et[2*ys+1])*Et[2*ys],Et[2*ys+1]=vt),sr--)}})(X,ae),we(Re,xt,X.bl_count)}function L(X,ae,Ee){var Se,ie,Re=-1,Ne=ae[1],Oe=0,He=7,xt=4;for(Ne===0&&(He=138,xt=3),ae[2*(Ee+1)+1]=65535,Se=0;Se<=Ee;Se++)ie=Ne,Ne=ae[2*(Se+1)+1],++Oe<He&&ie===Ne||(Oe<xt?X.bl_tree[2*ie]+=Oe:ie!==0?(ie!==Re&&X.bl_tree[2*ie]++,X.bl_tree[2*D]++):Oe<=10?X.bl_tree[2*V]++:X.bl_tree[2*$]++,Re=ie,xt=(Oe=0)===Ne?(He=138,3):ie===Ne?(He=6,3):(He=7,4))}function de(X,ae,Ee){var Se,ie,Re=-1,Ne=ae[1],Oe=0,He=7,xt=4;for(Ne===0&&(He=138,xt=3),Se=0;Se<=Ee;Se++)if(ie=Ne,Ne=ae[2*(Se+1)+1],!(++Oe<He&&ie===Ne)){if(Oe<xt)for(;ce(X,ie,X.bl_tree),--Oe!=0;);else ie!==0?(ie!==Re&&(ce(X,ie,X.bl_tree),Oe--),ce(X,D,X.bl_tree),ne(X,Oe-3,2)):Oe<=10?(ce(X,V,X.bl_tree),ne(X,Oe-3,3)):(ce(X,$,X.bl_tree),ne(X,Oe-11,7));Re=ie,xt=(Oe=0)===Ne?(He=138,3):ie===Ne?(He=6,3):(He=7,4)}}h(Q);var ye=!1;function ee(X,ae,Ee,Se){ne(X,(f<<1)+(Se?1:0),3),(function(ie,Re,Ne,Oe){be(ie),re(ie,Ne),re(ie,~Ne),o.arraySet(ie.pending_buf,ie.window,Re,Ne,ie.pending),ie.pending+=Ne})(X,ae,Ee)}i._tr_init=function(X){ye||((function(){var ae,Ee,Se,ie,Re,Ne=new Array(S+1);for(ie=Se=0;ie<p-1;ie++)for(J[ie]=Se,ae=0;ae<1<<k[ie];ae++)O[Se++]=ie;for(O[Se-1]=ie,ie=Re=0;ie<16;ie++)for(Q[ie]=Re,ae=0;ae<1<<M[ie];ae++)N[Re++]=ie;for(Re>>=7;ie<_;ie++)for(Q[ie]=Re<<7,ae=0;ae<1<<M[ie]-7;ae++)N[256+Re++]=ie;for(Ee=0;Ee<=S;Ee++)Ne[Ee]=0;for(ae=0;ae<=143;)q[2*ae+1]=8,ae++,Ne[8]++;for(;ae<=255;)q[2*ae+1]=9,ae++,Ne[9]++;for(;ae<=279;)q[2*ae+1]=7,ae++,Ne[7]++;for(;ae<=287;)q[2*ae+1]=8,ae++,Ne[8]++;for(we(q,b+1,Ne),ae=0;ae<_;ae++)I[2*ae+1]=5,I[2*ae]=he(ae,5);Y=new te(q,k,g+1,b,S),G=new te(I,M,0,_,S),Z=new te(new Array(0),B,0,w,T)})(),ye=!0),X.l_desc=new z(X.dyn_ltree,Y),X.d_desc=new z(X.dyn_dtree,G),X.bl_desc=new z(X.bl_tree,Z),X.bi_buf=0,X.bi_valid=0,oe(X)},i._tr_stored_block=ee,i._tr_flush_block=function(X,ae,Ee,Se){var ie,Re,Ne=0;0<X.level?(X.strm.data_type===2&&(X.strm.data_type=(function(Oe){var He,xt=4093624447;for(He=0;He<=31;He++,xt>>>=1)if(1&xt&&Oe.dyn_ltree[2*He]!==0)return l;if(Oe.dyn_ltree[18]!==0||Oe.dyn_ltree[20]!==0||Oe.dyn_ltree[26]!==0)return d;for(He=32;He<g;He++)if(Oe.dyn_ltree[2*He]!==0)return d;return l})(X)),lt(X,X.l_desc),lt(X,X.d_desc),Ne=(function(Oe){var He;for(L(Oe,Oe.dyn_ltree,Oe.l_desc.max_code),L(Oe,Oe.dyn_dtree,Oe.d_desc.max_code),lt(Oe,Oe.bl_desc),He=w-1;3<=He&&Oe.bl_tree[2*U[He]+1]===0;He--);return Oe.opt_len+=3*(He+1)+5+5+4,He})(X),ie=X.opt_len+3+7>>>3,(Re=X.static_len+3+7>>>3)<=ie&&(ie=Re)):ie=Re=Ee+5,Ee+4<=ie&&ae!==-1?ee(X,ae,Ee,Se):X.strategy===4||Re===ie?(ne(X,2+(Se?1:0),3),at(X,q,I)):(ne(X,4+(Se?1:0),3),(function(Oe,He,xt,nt){var Gn;for(ne(Oe,He-257,5),ne(Oe,xt-1,5),ne(Oe,nt-4,4),Gn=0;Gn<nt;Gn++)ne(Oe,Oe.bl_tree[2*U[Gn]+1],3);de(Oe,Oe.dyn_ltree,He-1),de(Oe,Oe.dyn_dtree,xt-1)})(X,X.l_desc.max_code+1,X.d_desc.max_code+1,Ne+1),at(X,X.dyn_ltree,X.dyn_dtree)),oe(X),Se&&be(X)},i._tr_tally=function(X,ae,Ee){return X.pending_buf[X.d_buf+2*X.last_lit]=ae>>>8&255,X.pending_buf[X.d_buf+2*X.last_lit+1]=255&ae,X.pending_buf[X.l_buf+X.last_lit]=255&Ee,X.last_lit++,ae===0?X.dyn_ltree[2*Ee]++:(X.matches++,ae--,X.dyn_ltree[2*(O[Ee]+g+1)]++,X.dyn_dtree[2*H(ae)]++),X.last_lit===X.lit_bufsize-1},i._tr_align=function(X){ne(X,2,3),ce(X,R,q),(function(ae){ae.bi_valid===16?(re(ae,ae.bi_buf),ae.bi_buf=0,ae.bi_valid=0):8<=ae.bi_valid&&(ae.pending_buf[ae.pending++]=255&ae.bi_buf,ae.bi_buf>>=8,ae.bi_valid-=8)})(X)}},{"../utils/common":41}],53:[function(n,r,i){r.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(n,r,i){(function(o){(function(l,d){if(!l.setImmediate){var h,f,p,g,b=1,_={},w=!1,x=l.document,S=Object.getPrototypeOf&&Object.getPrototypeOf(l);S=S&&S.setTimeout?S:l,h={}.toString.call(l.process)==="[object process]"?function(D){process.nextTick(function(){T(D)})}:(function(){if(l.postMessage&&!l.importScripts){var D=!0,V=l.onmessage;return l.onmessage=function(){D=!1},l.postMessage("","*"),l.onmessage=V,D}})()?(g="setImmediate$"+Math.random()+"$",l.addEventListener?l.addEventListener("message",R,!1):l.attachEvent("onmessage",R),function(D){l.postMessage(g+D,"*")}):l.MessageChannel?((p=new MessageChannel).port1.onmessage=function(D){T(D.data)},function(D){p.port2.postMessage(D)}):x&&"onreadystatechange"in x.createElement("script")?(f=x.documentElement,function(D){var V=x.createElement("script");V.onreadystatechange=function(){T(D),V.onreadystatechange=null,f.removeChild(V),V=null},f.appendChild(V)}):function(D){setTimeout(T,0,D)},S.setImmediate=function(D){typeof D!="function"&&(D=new Function(""+D));for(var V=new Array(arguments.length-1),$=0;$<V.length;$++)V[$]=arguments[$+1];var k={callback:D,args:V};return _[b]=k,h(b),b++},S.clearImmediate=C}function C(D){delete _[D]}function T(D){if(w)setTimeout(T,0,D);else{var V=_[D];if(V){w=!0;try{(function($){var k=$.callback,M=$.args;switch(M.length){case 0:k();break;case 1:k(M[0]);break;case 2:k(M[0],M[1]);break;case 3:k(M[0],M[1],M[2]);break;default:k.apply(d,M)}})(V)}finally{C(D),w=!1}}}}function R(D){D.source===l&&typeof D.data=="string"&&D.data.indexOf(g)===0&&T(+D.data.slice(g.length))}})(typeof self>"u"?o===void 0?this:o:self)}).call(this,typeof Vh<"u"?Vh:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(Yg)),Yg.exports}var MP=kP();const jm=Q2(MP);function OP({currentUser:t,budgetId:e}){const[n,r]=j.useState(!1),[i,o]=j.useState(null),[l,d]=j.useState(null);async function h(){if(!t){d("Must be logged in to download budget");return}if(!e){d("No budget selected");return}r(!0),d(null),o({phase:"reading",current:0,total:1,percentComplete:0});try{o({phase:"reading",current:0,total:1,percentComplete:10});const{exists:f,data:p}=await Lt("budgets",e,`downloading budget ${e}`);if(!f||!p){d(`Budget ${e} not found`);return}const g=await eA(e,"download-budget");let b=null;try{const{exists:I,data:N}=await Lt("payees",e,`downloading payees for budget ${e}`);I&&N&&(b=N)}catch(I){console.warn(`Could not read payees for budget ${e}:`,I)}o({phase:"processing",current:0,total:g.length+1,percentComplete:20});const _=new jm,w=new Date,x=w.toISOString().split("T")[0],S=`budget_${e}`,{accounts:C,account_groups:T,categories:R,category_groups:D,...V}=p;_.file(`${S}/budget.json`,JSON.stringify(V,null,2)),_.file(`${S}/accounts.json`,JSON.stringify(C||{},null,2)),_.file(`${S}/account_groups.json`,JSON.stringify(T||{},null,2)),_.file(`${S}/categories.json`,JSON.stringify(R||{},null,2)),_.file(`${S}/category_groups.json`,JSON.stringify(D||[],null,2)),b&&_.file(`${S}/payees.json`,JSON.stringify(b,null,2));let $=0;for(const I of g){const N=I.data,O=`${S}/months/month_${N.year}_${String(N.month).padStart(2,"0")}`,J={};if(N.are_allocations_finalized&&N.category_balances)for(const Y of N.category_balances)Y.allocated!==void 0&&(J[Y.category_id]=Y.allocated);_.file(`${O}/metadata.json`,JSON.stringify({budget_id:N.budget_id,year_month_ordinal:N.year_month_ordinal,year:N.year,month:N.month,total_income:N.total_income,previous_month_income:N.previous_month_income,total_expenses:N.total_expenses,are_allocations_finalized:N.are_allocations_finalized,created_at:N.created_at,updated_at:N.updated_at,...N.are_allocations_finalized&&{allocations:J},downloaded_at:w.toISOString()},null,2)),_.file(`${O}/income.json`,JSON.stringify(N.income||[],null,2)),_.file(`${O}/expenses.json`,JSON.stringify(N.expenses||[],null,2)),_.file(`${O}/transfers.json`,JSON.stringify(N.transfers||[],null,2)),_.file(`${O}/adjustments.json`,JSON.stringify(N.adjustments||[],null,2)),_.file(`${O}/account_balances.json`,JSON.stringify(N.account_balances||[],null,2)),_.file(`${O}/category_balances.json`,JSON.stringify(N.category_balances||[],null,2)),$++,o({phase:"processing",current:$,total:g.length,percentComplete:20+Math.round($/g.length*60)})}o({phase:"zipping",current:0,total:1,percentComplete:80});const k=await _.generateAsync({type:"blob"});o({phase:"complete",current:1,total:1,percentComplete:100});const B=(p.name||"budget").replace(/[^a-z0-9]/gi,"_").toLowerCase(),U=URL.createObjectURL(k),q=document.createElement("a");q.href=U,q.download=`${x}_${B}_${e}.zip`,document.body.appendChild(q),q.click(),document.body.removeChild(q),URL.revokeObjectURL(U)}catch(f){d(f instanceof Error?f.message:"Unknown error during download")}finally{r(!1),o(null)}}return{isDownloading:n,progress:i,error:l,downloadBudget:h}}async function NP(t){const n=await new jm().loadAsync(t),r=new Set,i=new Set;for(const[o]of Object.entries(n.files)){const l=o.match(/^budget_([^/]+)\//);if(l){const d=l[1];r.add(d),o.match(/^budget_([^/]+)\/months\/month_\d{4}_\d{2}\//)&&i.add(o.split("/months/")[1].split("/")[0])}}return{budgetsFound:r.size,monthsFound:i.size,payeesFound:r.size,budgetsToRestore:Array.from(r)}}async function PP(t,e,n){const i=`${`${e}/months/`}${n}/`,o=`${i}metadata.json`,l=t.files[o];if(!l)return null;const d=await l.async("string"),h=JSON.parse(d),{downloaded_at:f,allocations:p,...g}=h,b=async S=>{const C=`${i}${S}`,T=t.files[C];if(T){const R=await T.async("string");return JSON.parse(R)}return[]},_={budget_id:g.budget_id,year:g.year,month:g.month,year_month_ordinal:g.year_month_ordinal,total_income:0,previous_month_income:0,total_expenses:0,are_allocations_finalized:g.are_allocations_finalized??!1,created_at:g.created_at||new Date().toISOString(),updated_at:new Date().toISOString(),income:await b("income.json"),expenses:await b("expenses.json"),transfers:await b("transfers.json"),adjustments:await b("adjustments.json"),account_balances:[],category_balances:[]},w=Pa(_);let x=Cm(w);if(h.are_allocations_finalized&&p!==void 0){const S=new Map;for(const R of x.category_balances)S.set(R.category_id,R);const C=[],T=new Set;for(const R of x.category_balances){const D=p[R.category_id];if(D!==void 0){const V=Ae(D);C.push({...R,allocated:V,end_balance:Ae(R.start_balance+V+R.spent+R.transfers+R.adjustments)})}else C.push(R);T.add(R.category_id)}for(const[R,D]of Object.entries(p))if(!T.has(R)){const V=Ae(D);C.push({category_id:R,start_balance:0,allocated:V,spent:0,transfers:0,adjustments:0,end_balance:V})}x={...x,category_balances:C}}return{budgetId:g.budget_id,year:g.year,month:g.month,data:x}}async function BP(t,e){const n=`budget_${e}`,r=async $=>{const k=t.files[$];if(k){const M=await k.async("string");return JSON.parse(M)}return null},i=`${n}/budget.json`,o=`${n}/accounts.json`,l=`${n}/account_groups.json`,d=`${n}/categories.json`,h=`${n}/category_groups.json`,f=await r(i);if(!f)throw new Error("Missing required file budget.json");const p=await r(o)||{},g=await r(l)||{},b=await r(d)||{},_=await r(h)||[],w=Pa({...f,accounts:p,account_groups:g,categories:b,category_groups:_}),x={budgetId:e,data:w},S=`${n}/payees.json`,C=await r(S);let T=null;if(C){const $={...C,budget_id:e,updated_at:new Date().toISOString()};T={collectionPath:"payees",docId:e,data:Pa($)}}const R=`${n}/months/`,D=new Set;for(const $ of Object.keys(t.files))if($.startsWith(R)&&$.includes("/metadata.json")){const k=$.split("/months/")[1].split("/")[0];D.add(k)}const V=[];for(const $ of D){const k=await PP(t,n,$);k&&V.push(k)}return{budgetUpdate:x,monthUpdates:V,payeeWrite:T}}function zP({currentUser:t}){const[e,n]=j.useState(!1),[r,i]=j.useState(!1),[o,l]=j.useState(null),[d,h]=j.useState(null),[f,p]=j.useState(null),[g,b]=j.useState(null);async function _(x){if(!t){p("Must be logged in to upload budget");return}n(!0),p(null),l(null),b(null);try{const S=await NP(x);l(S)}catch(S){p(S instanceof Error?S.message:"Failed to parse zip file")}finally{n(!1)}}async function w(x){if(!t){p("Must be logged in to upload budget");return}if(!o){p("Must scan file first");return}i(!0),p(null),h({phase:"parsing",current:0,total:1,percentComplete:0});const S=[];let C=0,T=0,R=0;try{h({phase:"parsing",current:0,total:1,percentComplete:10});const V=await new jm().loadAsync(x);h({phase:"validating",current:0,total:1,percentComplete:20}),h({phase:"uploading",current:0,total:o.budgetsToRestore.length,percentComplete:30});const $=[],k=[],M=[];for(let B=0;B<o.budgetsToRestore.length;B++){const U=o.budgetsToRestore[B];try{const{budgetUpdate:q,monthUpdates:I,payeeWrite:N}=await BP(V,U);$.push(q),k.push(...I),N&&M.push(N),h({phase:"uploading",current:B+1,total:o.budgetsToRestore.length,percentComplete:30+Math.round((B+1)/o.budgetsToRestore.length*50)})}catch(q){S.push(`Budget ${U}: ${q instanceof Error?q.message:String(q)}`)}}if(h({phase:"uploading",current:o.budgetsToRestore.length,total:o.budgetsToRestore.length,percentComplete:80}),$.length>0)try{console.log(`[Upload] Writing ${$.length} budget(s)...`),await Y0($,"upload-budget"),C=$.length,console.log(`[Upload] Successfully wrote ${C} budget(s)`)}catch(B){const U=`Failed to write budgets: ${B instanceof Error?B.message:String(B)}`;throw console.error(`[Upload] ${U}`,B),S.push(U),B}if(M.length>0)try{console.log(`[Upload] Writing ${M.length} payee doc(s)...`),await z0(M,"upload-budget: writing payees"),R=M.length,console.log(`[Upload] Successfully wrote ${R} payee doc(s)`)}catch(B){const U=`Failed to write payees: ${B instanceof Error?B.message:String(B)}`;throw console.error(`[Upload] ${U}`,B),S.push(U),B}if(k.length>0)try{console.log(`[Upload] Writing ${k.length} month(s) and recalculating...`),await M3(k,"upload-budget"),T=k.length,console.log(`[Upload] Successfully wrote ${T} month(s)`)}catch(B){const U=`Failed to write months: ${B instanceof Error?B.message:String(B)}`;throw console.error(`[Upload] ${U}`,B),S.push(U),B}h({phase:"complete",current:1,total:1,percentComplete:100}),b({success:S.length===0,budgetsRestored:C,monthsRestored:T,payeesRestored:R,errors:S}),console.log("[Upload] Clearing all caches after upload..."),La()}catch(D){const V=D instanceof Error?D.message:"Unknown error during upload";console.error("[Upload] Upload failed with error:",D),console.error("[Upload] Error details:",{errorMessage:V,budgetsRestored:C,monthsRestored:T,payeesRestored:R,errorsSoFar:S}),p(V),b({success:!1,budgetsRestored:C,monthsRestored:T,payeesRestored:R,errors:[...S,V]}),console.log("[Upload] Clearing all caches after failed upload (partial writes possible)..."),La()}finally{i(!1),h(null)}}return{isScanning:e,isUploading:r,status:o,progress:d,error:f,result:g,scanZipFile:_,uploadBudget:w}}function LP({isActive:t,onDragOver:e,onDragLeave:n,onDrop:r,label:i="Move to end"}){return u.jsxs("div",{onDragOver:e,onDragLeave:n,onDrop:r,style:G4,children:[u.jsx("div",{style:{...W4,opacity:t?1:.3,boxShadow:t?"0 0 8px rgba(100, 108, 255, 0.6)":"none"}}),t&&u.jsx("span",{style:Q4,children:i})]})}function Xt(t){return`$${Math.abs(t).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`}function br(t){return t<0?`-$${Math.abs(t).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`:`$${t.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`}function Fn(t){return t<0?`-$${Math.abs(t).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`:`$${t.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`}function Pt(t){return t===0?"$0.00":`${t>0?"+":"-"}${Xt(t)}`}function Bt(t){return`${t>=0?"+":"-"}${Xt(t)}`}function ct(t){return t===0?ge.zero:t>0?ge.success:ge.danger}function dn(t){return t===0?ge.zero:t>0?ge.success:ge.debt}function _c(t){return t===0?ge.zero:t<0?ge.error:ge.success}function bc(t){return t===0?ge.zero:t>0?ge.success:ge.error}async function iA(t,e){const{exists:n,data:r}=await Lt("feedback",t,`VALIDATION-READ: ${e}`);if(!n||!r)throw new Error(`Feedback document not found: ${t}`);return{items:r.items||[],user_email:r.user_email,created_at:r.created_at,updated_at:r.updated_at}}async function X0(t){const{docId:e,items:n,description:r}=t;await cr("feedback",e,{items:n,updated_at:new Date().toISOString()},r,{merge:!0})}async function UP(t,e,n,r){const{exists:i}=await Lt("feedback",t,"checking if user has existing feedback document");i?await cr("feedback",t,{items:$u(e),user_email:n,updated_at:new Date().toISOString()},r,{merge:!0}):await cr("feedback",t,{items:[e],user_email:n,created_at:new Date().toISOString(),updated_at:new Date().toISOString()},r)}function aA(){const t=Ut(),e=Hn({onMutate:async r=>{const{userId:i,userEmail:o,text:l,feedbackType:d,currentPath:h}=r,f=o||i,p=Ce.feedback();await t.cancelQueries({queryKey:p});const g=t.getQueryData(p),b=`feedback_optimistic_${Date.now()}`,_={id:b,text:`${l}

(Submitted from: ${h})`,created_at:new Date().toISOString(),is_done:!1,completed_at:null,sort_order:Date.now(),feedback_type:d,doc_id:f,user_email:o};return g&&t.setQueryData(p,{items:[...g.items,_]}),{previousData:g,optimisticId:b}},mutationFn:async r=>{const{userId:i,userEmail:o,text:l,feedbackType:d,currentPath:h}=r,f=o||i,p={id:`feedback_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,text:`${l}

(Submitted from: ${h})`,created_at:new Date().toISOString(),is_done:!1,completed_at:null,sort_order:Date.now(),feedback_type:d};return await UP(f,p,o,"submitting new feedback"),{feedbackItem:p,docId:f}},onSuccess:(r,i,o)=>{if(!o?.optimisticId)return;const l=t.getQueryData(Ce.feedback());l&&t.setQueryData(Ce.feedback(),{items:l.items.map(d=>d.id===o.optimisticId?{...r.feedbackItem,doc_id:r.docId,user_email:i.userEmail}:d)})},onError:(r,i,o)=>{o?.previousData&&t.setQueryData(Ce.feedback(),o.previousData)}});return{submitFeedback:{mutate:r=>e.mutate(r),mutateAsync:r=>e.mutateAsync(r),isPending:e.isPending,isError:e.isError,error:e.error,reset:e.reset}}}function FP(){const t=Ut(),e=Hn({onMutate:async r=>{const{item:i}=r,o=Ce.feedback(),l=!i.is_done,d=l?new Date().toISOString():null;await t.cancelQueries({queryKey:o});const h=t.getQueryData(o);return h&&t.setQueryData(o,{items:h.items.map(f=>f.id===i.id?{...f,is_done:l,completed_at:d}:f)}),{previousData:h}},mutationFn:async r=>{const{item:i}=r,o=!i.is_done,l=o?new Date().toISOString():null,d=await iA(i.doc_id,"toggle feedback");let h=!1;const f=d.items.map(p=>p.id===i.id?(h=!0,{...p,is_done:o,completed_at:l}):p);if(!h)throw console.error("[toggleFeedback] Item not found in document",{searchingFor:i.id,inDocument:i.doc_id,availableIds:d.items.map(p=>p.id)}),new Error(`Feedback item not found in document. Item ID: ${i.id}, Doc ID: ${i.doc_id}`);return await X0({docId:i.doc_id,items:f,description:`marking feedback item as ${o?"done":"not done"}`}),{itemId:i.id,isDone:o,completedAt:l}},onError:(r,i,o)=>{o?.previousData&&t.setQueryData(Ce.feedback(),o.previousData)}});return{toggleFeedback:{mutate:r=>e.mutate(r),mutateAsync:r=>e.mutateAsync(r),isPending:e.isPending,isError:e.isError,error:e.error,reset:e.reset}}}function VP(){const t=Ut(),e=Hn({onMutate:async r=>{const{docId:i,items:o}=r,l=Ce.feedback();await t.cancelQueries({queryKey:l});const d=t.getQueryData(l),h=new Map;return o.forEach(f=>{h.set(f.id,f.sort_order)}),d&&t.setQueryData(l,{items:d.items.map(f=>f.doc_id===i&&h.has(f.id)?{...f,sort_order:h.get(f.id)}:f)}),{previousData:d}},mutationFn:async r=>{const{docId:i,items:o}=r;return await X0({docId:i,items:o,description:"saving reordered feedback items"}),{docId:i,items:o}},onError:(r,i,o)=>{o?.previousData&&t.setQueryData(Ce.feedback(),o.previousData)}});return{updateSortOrder:{mutate:r=>e.mutate(r),mutateAsync:r=>e.mutateAsync(r),isPending:e.isPending,isError:e.isError,error:e.error,reset:e.reset}}}function Qs({isOpen:t,onClose:e,title:n,children:r,width:i="28rem"}){if(!t)return null;function o(){e()}return u.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0, 0, 0, 0.6)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1001,padding:"1rem"},onClick:o,children:u.jsxs("div",{style:{background:"#1a1a1a",color:"rgba(255, 255, 255, 0.87)",borderRadius:"12px",padding:"1.5rem",width:i,maxWidth:"calc(100vw - 2rem)",flexShrink:0,boxSizing:"border-box",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.5)"},onClick:l=>l.stopPropagation(),children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[u.jsx("h2",{style:{margin:0,fontSize:"1.25rem"},children:n}),u.jsx("button",{onClick:o,style:{background:"transparent",border:"none",color:"inherit",cursor:"pointer",fontSize:"1.5rem",opacity:.6,lineHeight:1},children:""})]}),r]})})}const $P=2e3,qP={critical_bug:{label:"Critical Bug",color:"#ff4757",bgColor:"rgba(255, 71, 87, 0.15)"},bug:{label:"Bug",color:"#ffa502",bgColor:"rgba(255, 165, 2, 0.15)"},new_feature:{label:"New Feature",color:"#2ed573",bgColor:"rgba(46, 213, 115, 0.15)"},core_feature:{label:"Core Feature",color:"#1e90ff",bgColor:"rgba(30, 144, 255, 0.15)"},qol:{label:"QOL",color:"#a55eea",bgColor:"rgba(165, 94, 234, 0.15)"}};function HP(){const[t,e]=j.useState(!1),[n,r]=j.useState(""),[i,o]=j.useState("bug"),[l,d]=j.useState(!1),h=j.useContext(_d),p=ki().get_current_firebase_user(),g=tr(),{submitFeedback:b}=aA();if(j.useEffect(()=>{if(l){const x=setTimeout(()=>d(!1),$P);return()=>clearTimeout(x)}},[l]),g.pathname.includes("/admin/feedback")||!h.is_logged_in)return null;function w(x){x.preventDefault(),!(!n.trim()||!h.username||!p)&&(b.mutate({userId:p.uid,userEmail:h.username,text:n.trim(),feedbackType:i,currentPath:g.pathname}),r(""),o("bug"),e(!1),d(!0))}return u.jsxs(u.Fragment,{children:[l&&u.jsxs("div",{style:{position:"fixed",bottom:"5rem",right:"1.5rem",background:"rgba(46, 213, 115, 0.95)",color:"white",padding:"0.75rem 1rem",borderRadius:"0.5rem",fontSize:"0.9rem",fontWeight:500,boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",zIndex:1001,display:"flex",alignItems:"center",gap:"0.5rem",animation:"fadeInUp 0.2s ease-out"},children:[u.jsx("span",{children:""}),u.jsx("span",{children:"Feedback submitted!"})]}),u.jsx("button",{onClick:()=>{e(!0)},style:{position:"fixed",bottom:"1.5rem",right:"1.5rem",width:"3rem",height:"3rem",borderRadius:"50%",background:ge.primary,color:"white",border:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1.25rem",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",transition:"transform 0.15s, box-shadow 0.15s",zIndex:1e3},title:"Send Feedback",onMouseEnter:x=>{x.currentTarget.style.transform="scale(1.1)",x.currentTarget.style.boxShadow="0 6px 16px rgba(0, 0, 0, 0.4)"},onMouseLeave:x=>{x.currentTarget.style.transform="scale(1)",x.currentTarget.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.3)"},children:""}),u.jsx(Qs,{isOpen:t,onClose:()=>{e(!1),o("bug")},title:"Send Feedback",children:u.jsxs("form",{onSubmit:w,children:[u.jsx("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"0.75rem",paddingBottom:"1rem",flexWrap:"wrap"},children:["critical_bug","bug","new_feature","core_feature","qol"].map(x=>{const S=qP[x],C=i===x;return u.jsxs("button",{type:"button",onClick:()=>{S.label,o(x)},style:{flex:1,padding:"0.6rem 0.5rem",border:`2px solid ${S.color}`,borderRadius:"0.5rem",background:C?S.bgColor:"transparent",color:C?S.color:"rgba(255,255,255,0.5)",cursor:"pointer",fontWeight:C?600:400,fontSize:"0.8rem",transition:"all 0.15s ease",opacity:C?1:.5,boxShadow:C?`0 0 12px ${S.bgColor}`:"none",position:"relative"},children:[S.label,C&&u.jsx("span",{style:{position:"absolute",bottom:"-14px",left:"10%",right:"10%",height:"3px",background:"white",borderRadius:"2px"}})]},x)})}),u.jsx(K0,{value:n,onChange:x=>r(x.target.value),placeholder:"Share your feedback, bug reports, or feature requests...",minHeight:"8rem",autoFocus:!0,required:!0}),u.jsxs(qa,{children:[u.jsx($e,{type:"button",variant:"secondary",actionName:"Cancel Feedback",onClick:()=>{e(!1),o("bug")},children:"Cancel"}),u.jsx($e,{type:"submit",actionName:"Submit Feedback",disabled:!n.trim(),children:"Submit"})]})]})})]})}function Qr({children:t,labelStyle:e,...n}){return u.jsxs("label",{style:{display:"flex",alignItems:"flex-start",gap:"0.75rem",flex:1,cursor:"pointer",...e},children:[u.jsx("input",{type:"checkbox",style:{width:"1.25rem",height:"1.25rem",marginTop:"0.1rem",cursor:"pointer",accentColor:ge.primary},...n}),t]})}function Z0({title:t,count:e,children:n,defaultExpanded:r=!1}){const[i,o]=j.useState(r);return u.jsxs("div",{style:{marginTop:"2rem"},children:[u.jsxs("button",{onClick:()=>o(!i),style:{background:"transparent",border:"none",color:"inherit",cursor:"pointer",display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 0",fontSize:"0.9rem",opacity:.7},children:[u.jsx("span",{style:{transition:"transform 0.2s",transform:i?"rotate(90deg)":"rotate(0deg)"},children:""}),t,e!==void 0&&` (${e})`]}),i&&n]})}const GP=t=>{switch(t){case 2:return 220;case 3:return 320;case 4:return 420;case 5:return 520;case 6:return 620;default:return t*100+20}},WP=t=>t<=4?2:t<=6?3:Math.ceil(t/2);function Lf(t){const{tabs:e,activeTab:n,variant:r="primary"}=t,i=e.filter(S=>!S.hidden),o=i.length,l=GP(o),d=WP(o),h=Math.floor(100/d),f=`tab-nav-${o}-${r}`,p=r==="primary",g=r==="secondary",b=r==="segmented",_=S=>{const C="color-mix(in srgb, currentColor 10%, transparent)",T="color-mix(in srgb, currentColor 3%, transparent)";return b?{flex:"1 1 0",padding:"0.75rem 1rem",border:"none",borderRadius:0,background:S?C:T,cursor:"pointer",fontWeight:S?600:400,fontSize:"0.95rem",color:"inherit",opacity:S?1:.55,transition:"all 0.15s",textDecoration:"none",display:"inline-flex",alignItems:"center",justifyContent:"center",gap:"0.25rem",position:"relative",boxSizing:"border-box",outline:"none",borderBottom:S?"2px solid currentColor":"2px solid transparent"}:g?{flex:"none",minWidth:"8.5rem",padding:"0.55rem 1rem 0.65rem",border:"none",borderRadius:"10px 10px 0 0",background:"transparent",cursor:"pointer",fontWeight:600,fontSize:"0.85rem",color:S?"inherit":"color-mix(in srgb, currentColor 55%, transparent)",transition:"color 0.15s",textDecoration:"none",display:"inline-flex",alignItems:"center",justifyContent:"center",gap:"0.25rem",position:"relative",boxSizing:"border-box",outline:"none",marginBottom:S?"-1px":"0"}:{flex:"1 1 0",padding:"0.7rem 0.75rem",border:"none",borderRadius:0,background:"transparent",cursor:"pointer",fontWeight:S?600:400,fontSize:"1rem",letterSpacing:"0.01em",color:"inherit",opacity:S?1:.6,transition:"all 0.15s",textDecoration:"none",display:"inline-flex",alignItems:"center",justifyContent:"center",gap:"0.25rem",position:"relative",boxSizing:"border-box",outline:"none"}},w=(S,C)=>u.jsxs(u.Fragment,{children:[u.jsx("span",{children:S.label}),S.checkmark&&u.jsx("span",{style:{color:ge.success,fontWeight:600},children:""}),p&&C&&u.jsx("span",{style:{position:"absolute",bottom:"-1px",left:"10%",right:"10%",height:"3px",background:"white",borderRadius:"2px"}})]}),x=()=>b?`
        .${f} {
          display: flex;
          margin-bottom: 0.75rem;
          border-bottom: 1px solid color-mix(in srgb, currentColor 15%, transparent);
        }
      `:g?`
        .${f} {
          display: flex;
          flex-wrap: nowrap;
          margin-bottom: 1rem;
          border-bottom: 1px solid color-mix(in srgb, currentColor 10%, transparent);
          justify-content: flex-start;
          padding-left: 0.75rem;
          position: relative;
        }
        .${f} > button,
        .${f} > a {
          margin-right: -8px;
          isolation: isolate;
        }
        .${f} > button:last-child,
        .${f} > a:last-child {
          margin-right: 0;
        }
        .${f} > button::before,
        .${f} > a::before {
          content: '';
          position: absolute;
          inset: 0;
          background: var(--tab-bg);
          border-radius: 10px 10px 0 0;
          z-index: -1;
          transform: perspective(50px) rotateX(5deg);
          transform-origin: bottom center;
          transition: background 0.15s;
          box-shadow: -1px 0 0 #242424, 1px 0 0 #242424;
        }
        .${f} > button:nth-child(1),
        .${f} > a:nth-child(1) {
          z-index: 4;
        }
        .${f} > button:nth-child(2),
        .${f} > a:nth-child(2) {
          z-index: 3;
        }
        .${f} > button:nth-child(3),
        .${f} > a:nth-child(3) {
          z-index: 2;
        }
        .${f} > button:nth-child(4),
        .${f} > a:nth-child(4) {
          z-index: 1;
        }
        .${f} > button.tab-active,
        .${f} > a.tab-active {
          z-index: 10;
        }
        .${f} > button.tab-active::before,
        .${f} > a.tab-active::before {
          background: var(--tab-bg-active);
        }
        .${f} > button:not(.tab-active):hover,
        .${f} > a:not(.tab-active):hover {
          color: color-mix(in srgb, currentColor 80%, transparent);
        }
        .${f} > button:not(.tab-active):hover::before,
        .${f} > a:not(.tab-active):hover::before {
          background: var(--tab-bg-hover);
        }
        @media (max-width: 480px) {
          .${f} {
            padding-left: 0;
            padding-right: 0;
          }
          .${f} > button,
          .${f} > a {
            flex: 0 0 27% !important;
            min-width: 27% !important;
            padding: 0.55rem 0.5rem 0.65rem !important;
            font-size: 0.8rem !important;
          }
        }
      `:`
      .${f} {
        display: flex;
        flex-wrap: wrap;
        margin-bottom: 0;
        border-bottom: 1px solid color-mix(in srgb, currentColor 25%, transparent);
      }
      @media (max-width: ${l}px) {
        .${f} > * {
          flex: 1 1 ${h}% !important;
          min-width: ${h}% !important;
        }
      }
    `;return u.jsxs(u.Fragment,{children:[u.jsx("style",{children:`
        ${x()}
        .${f} > button,
        .${f} > a {
          border: none !important;
          border-radius: 0 !important;
          outline: none !important;
        }
        .${f} > button:hover,
        .${f} > button:focus,
        .${f} > a:hover,
        .${f} > a:focus {
          border: none !important;
          border-color: transparent !important;
          ${p?"opacity: 0.85;":""}
          ${b?"background: color-mix(in srgb, currentColor 7%, transparent);":""}
        }
      `}),u.jsx("div",{className:f,children:i.map(S=>{const C=n===S.id;return t.mode==="link"?u.jsx(Tn,{to:`${t.linkPrefix}/${S.id}`,onClick:()=>(`${S.label}`,void 0),style:_(C),className:C?"tab-active":"",children:w(S,C)},S.id):u.jsx("button",{onClick:()=>{`${S.label}`,t.onTabChange(S.id)},style:_(C),className:C?"tab-active":"",children:w(S,C)},S.id)})})]})}function oA({items:t}){const[e,n]=j.useState(!1),r=j.useRef(null),o=tr().pathname;j.useEffect(()=>{function d(h){r.current&&!r.current.contains(h.target)&&n(!1)}if(e)return document.addEventListener("mousedown",d),()=>document.removeEventListener("mousedown",d)},[e]),j.useEffect(()=>{function d(h){h.key==="Escape"&&n(!1)}if(e)return document.addEventListener("keydown",d),()=>document.removeEventListener("keydown",d)},[e]);const l=t.filter(d=>d.hidden?!1:d.to?d.to==="/budget"?!(o==="/budget"||/^\/budget\/\d{4}\/\d{1,2}\/\w+$/.test(o)):d.to==="/account"||d.to==="/"?o!==d.to:!o.startsWith(d.to):!0);return u.jsxs("div",{ref:r,style:{position:"relative"},children:[u.jsx("button",{onClick:()=>{n(!e)},style:{display:"flex",alignItems:"center",justifyContent:"center",width:"2.5rem",height:"2.5rem",borderRadius:"8px",background:e?"color-mix(in srgb, currentColor 15%, transparent)":"color-mix(in srgb, currentColor 8%, transparent)",border:"none",cursor:"pointer",fontSize:"1.25rem",color:"inherit",transition:"background 0.15s",lineHeight:1},title:"Menu","aria-expanded":e,"aria-haspopup":"true",children:""}),e&&u.jsx("div",{style:{position:"absolute",top:"100%",right:0,marginTop:"0.5rem",minWidth:"180px",background:"#1a1a2e",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",borderRadius:"8px",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.3)",zIndex:1e3,overflow:"hidden"},children:l.map((d,h)=>{if(d.divider)return u.jsx("div",{style:{height:"1px",background:"color-mix(in srgb, currentColor 15%, transparent)",margin:"0.25rem 0"}},h);const f=u.jsxs(u.Fragment,{children:[d.icon&&u.jsx("span",{style:{width:"1.5rem",textAlign:"center"},children:d.icon}),u.jsx("span",{children:d.label})]}),p={display:"flex",alignItems:"center",gap:"0.75rem",padding:"0.75rem 1rem",fontSize:"0.95rem",color:"inherit",textDecoration:"none",cursor:"pointer",transition:"background 0.15s",background:"transparent",border:"none",width:"100%",textAlign:"left"},g={background:"color-mix(in srgb, currentColor 10%, transparent)"};return d.to?u.jsx(Tn,{to:d.to,style:p,onMouseEnter:b=>Object.assign(b.currentTarget.style,g),onMouseLeave:b=>b.currentTarget.style.background="transparent",onClick:()=>{`${d.label}`,n(!1)},children:f},h):u.jsx("button",{onClick:()=>{`${d.label}`,d.onClick?.(),n(!1)},style:p,onMouseEnter:b=>Object.assign(b.currentTarget.style,g),onMouseLeave:b=>b.currentTarget.style.background="transparent",children:f},h)})})]})}function QP({title:t,showBackArrow:e=!1,hideMenu:n=!1}){const{isAdmin:r}=Ze(),i=tr(),l=[...i.pathname==="/budget"||i.pathname.startsWith("/budget/")&&!i.pathname.startsWith("/budget/settings")&&!i.pathname.startsWith("/budget/admin")&&!i.pathname.startsWith("/budget/analytics")&&!i.pathname.startsWith("/budget/my-budgets")?[]:[{label:"Budget",icon:"",to:"/budget"}],{label:"Budget Settings",icon:"",to:"/budget/settings"},{label:"Analytics",icon:"",to:"/budget/analytics"},...r?[{label:"Admin",icon:"",to:"/budget/admin"}]:[],{label:"Switch Budgets",icon:"",to:"/budget/my-budgets"},{divider:!0,label:""},{label:"Exit Budget App",icon:"",to:"/"}];return u.jsxs("nav",{style:{marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%"},children:[u.jsx("div",{style:{flex:"0 0 auto"},children:e?u.jsx(Tn,{to:"/",onClick:()=>void 0,style:{opacity:.6,fontSize:"1.5rem",textDecoration:"none"},title:"Back to Home",children:""}):u.jsx(Tn,{to:"/budget",onClick:()=>void 0,title:"Budget Home",children:u.jsx("img",{src:"/budget-icon.svg",alt:"Budget",style:{width:"1.5rem",height:"1.5rem"}})})}),u.jsx("span",{style:{fontWeight:600,fontSize:"1.1rem",textAlign:"center",flex:"1 1 auto"},children:t}),u.jsx("div",{style:{flex:"0 0 auto"},children:n?u.jsx("div",{style:{width:"1.5rem"}}):u.jsx(oA,{items:l})})]})}function lA({children:t,style:e}){return u.jsx("div",{style:{width:"100%",maxWidth:"var(--content-max-width, 900px)",marginLeft:"auto",marginRight:"auto",...e},children:t})}function Ku({message:t,linkText:e,linkTo:n}){return u.jsx("div",{style:{gridColumn:"1 / -1",background:`color-mix(in srgb, ${ge.warning} 12%, transparent)`,border:`2px solid ${ge.warning}`,borderRadius:"8px",padding:"1rem 1.25rem",margin:"0.75rem 0",animation:"warningPulse 2s ease-in-out infinite"},children:u.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"0.75rem",flexWrap:"wrap"},children:[u.jsx("span",{style:{fontSize:"1.25rem",lineHeight:1.3},children:""}),u.jsxs("div",{style:{flex:1,minWidth:"200px"},children:[u.jsx("p",{style:{margin:0,fontWeight:500,color:ge.warning,fontSize:"0.95rem"},children:t}),u.jsxs(Tn,{to:n,style:{display:"inline-flex",alignItems:"center",gap:"0.35rem",marginTop:"0.5rem",color:ge.warning,fontWeight:600,fontSize:"0.9rem",textDecoration:"underline",textUnderlineOffset:"3px"},children:[e," "]})]})]})})}const KP={success:{bgColor:"rgba(46, 213, 115, 0.95)",color:"white",icon:""},error:{bgColor:"rgba(255, 71, 87, 0.95)",color:"white",icon:""},warning:{bgColor:"rgba(255, 165, 2, 0.95)",color:"white",icon:""},info:{bgColor:"rgba(30, 144, 255, 0.95)",color:"white",icon:""}};function YP({item:t,onDismiss:e}){const[n,r]=j.useState(!1);if(j.useEffect(()=>{if(t){if(r(!0),t.autoDismissMs&&t.autoDismissMs>0){const o=setTimeout(()=>{r(!1),setTimeout(()=>e(t.id),200)},t.autoDismissMs);return()=>clearTimeout(o)}}else r(!1)},[t,e]),!t||!n)return null;const i=KP[t.type];return u.jsxs("div",{style:{position:"fixed",bottom:"1.5rem",right:"1.5rem",left:"1.5rem",maxWidth:"600px",margin:"0 auto",background:i.bgColor,color:i.color,padding:"0.75rem 1rem",borderRadius:"0.5rem",fontSize:"0.9rem",fontWeight:500,boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",zIndex:1001,display:"flex",alignItems:"center",gap:"0.5rem",animation:n?"fadeInUp 0.2s ease-out":"fadeOut 0.2s ease-out",cursor:"pointer"},onClick:()=>{r(!1),setTimeout(()=>e(t.id),200)},children:[u.jsx("span",{children:i.icon}),u.jsx("span",{style:{flex:1},children:t.message}),u.jsx("span",{style:{fontSize:"1.2rem",lineHeight:1},children:""})]})}class XP{items=[];listeners=new Set;nextId=1;add(e){const n=`banner-${this.nextId++}`,r={...e,id:n};return this.items.push(r),this.notify(),n}remove(e){this.items=this.items.filter(n=>n.id!==e),this.notify()}getCurrent(){return this.items[0]||null}subscribe(e){return this.listeners.add(e),e(this.getCurrent()),()=>{this.listeners.delete(e)}}notify(){const e=this.getCurrent();this.listeners.forEach(n=>n(e))}}const Jn=new XP;function Rn(){const{removeChange:t,getChanges:e,clearChanges:n,hasChanges:r,setIsSaving:i,setLastSaveTime:o,setSaveError:l}=pd(),d=j.useRef(!1),h=j.useCallback(async(_,w,x,S)=>{const C=Ce.month(_,w,x),T=Pe.getQueryData(C);if(!T?.month)throw new Error(`Month ${w}/${x} not found in cache`);await H0({budgetId:_,month:T.month,description:`${S}: ${w}/${x}`,updateMonthMap:!1})},[]),f=j.useCallback(async(_,w)=>{const x=Ce.budget(_),S=Pe.getQueryData(x);if(!S)throw new Error(`Budget ${_} not found in cache`);const C=Object.fromEntries(Object.entries(S.budget.accounts||{}).map(([R,D])=>{const{balance:V,...$}=D;return[R,$]})),T=Object.fromEntries(Object.entries(S.budget.categories||{}).map(([R,D])=>{const{balance:V,...$}=D;return[R,$]}));await gd({budgetId:_,updates:{name:S.budget.name,user_ids:S.budget.user_ids,accepted_user_ids:S.budget.accepted_user_ids,owner_id:S.budget.owner_id,owner_email:S.budget.owner_email,accounts:C,account_groups:S.budget.account_groups,categories:T,category_groups:S.budget.category_groups,month_map:S.budget.month_map},description:`${w}: budget`})},[]),p=j.useCallback(async(_,w)=>{const x=Ce.payees(_),S=Pe.getQueryData(x);if(!S)throw new Error(`Payees for budget ${_} not found in cache`);await cr("payees",_,{budget_id:_,payees:S,updated_at:new Date().toISOString()},`${w}: payees`)},[]),g=j.useCallback(async(_="periodic save")=>{if(d.current||!r())return;d.current=!0,i(!0),l(null);const w=e(),x=[];try{const S=[],C=new Set,T=new Set;for(const R of w)R.type==="month"&&R.year!==void 0&&R.month!==void 0?S.push({budgetId:R.budgetId,year:R.year,month:R.month}):R.type==="budget"?C.add(R.budgetId):R.type==="payees"&&T.add(R.budgetId);for(const{budgetId:R,year:D,month:V}of S){const $=Ce.month(R,D,V),k=Pe.getQueryData($);if(k?.month){const M=Cm(k.month);Pe.setQueryData($,{month:M})}}for(const{budgetId:R,year:D,month:V}of S)try{await h(R,D,V,_)}catch($){const k=`Failed to save month ${D}/${V}: ${$ instanceof Error?$.message:String($)}`;x.push(k),console.error("[useBackgroundSave]",k,$)}for(const R of C)try{YT(R)}catch(D){console.warn("[useBackgroundSave] Failed to recalculate budget account balances from cache:",D)}for(const R of C)try{await f(R,_)}catch(D){const V=`Failed to save budget: ${D instanceof Error?D.message:String(D)}`;x.push(V),console.error("[useBackgroundSave]",V,D)}for(const R of T)try{await p(R,_)}catch(D){const V=`Failed to save payees: ${D instanceof Error?D.message:String(D)}`;x.push(V),console.error("[useBackgroundSave]",V,D)}if(x.length===0)n(),o(Date.now()),Jn.add({type:"success",message:"All changes saved successfully",autoDismissMs:2e3});else throw new Error(x.join("; "))}catch(S){const C=S instanceof Error?S.message:String(S);throw l(C),Jn.add({type:"error",message:`Failed to save changes: ${C}`,autoDismissMs:0}),S}finally{d.current=!1,i(!1)}},[r,e,n,h,f,p,i,o,l]),b=j.useCallback(async(_,w,x,S)=>{try{i(!0),l(null),w==="month"&&x!==void 0&&S!==void 0?(await h(_,x,S,"immediate save (current viewing document)"),t({type:"month",budgetId:_,year:x,month:S}),o(Date.now())):w==="budget"&&(await f(_,"immediate save (current viewing document)"),t({type:"budget",budgetId:_}),o(Date.now()))}catch(C){const T=C instanceof Error?C.message:String(C);throw l(T),Jn.add({type:"error",message:`Failed to save current document: ${T}`,autoDismissMs:0}),C}finally{i(!1)}},[h,f,t,i,o,l]);return{saveAllChanges:g,saveCurrentDocument:b}}async function ZP(t,e,n,r){const i=Pe.getQueryData(Ce.budget(t));if(!i){console.warn("[mutationHelpers] Budget not in cache, skipping local recalculation");return}const o=i.budget.month_map,l=qe(e,n),d=[];for(const[h]of Object.entries(o))if(h>=l){const f=parseInt(h.substring(0,4),10),p=parseInt(h.substring(4,6),10);d.push({year:f,month:p})}d.sort((h,f)=>h.year!==f.year?h.year-f.year:h.month-f.month);for(const{year:h,month:f}of d)try{await _3(t,h,f,Pe),r&&r({type:"month",budgetId:t,year:h,month:f})}catch(p){console.warn(`[mutationHelpers] Failed to recalculate month ${h}/${f} locally:`,p)}}function xr(){const{trackChange:t}=pd(),{addLoadingHold:e,removeLoadingHold:n}=jn();return{updateMonthCacheAndTrack:(o,l,d,h)=>{Pe.setQueryData(Ce.month(o,l,d),{month:h}),t({type:"month",budgetId:o,year:l,month:d})},recalculateMonthAndCascade:async(o,l,d,h)=>{const f="recalculate-month-cascade",p=h||((C,T)=>{C?e(f,T):n(f)}),g=Ce.month(o,l,d),b=Pe.getQueryData(g);if(b?.month){const C=Cm(b.month);Pe.setQueryData(g,{month:C})}const _=hd(),w=qe(_.year,_.month),x=qe(l,d),S=x<w;if(await ZP(o,l,d,t),S){p(!0,"Saving start balances...");try{const C=Pe.getQueryData(Ce.budget(o));if(!C){console.warn("[mutationHelpers] Budget not in cache, skipping start_balance save");return}const T=C.monthMap||{},R=[];for(const[D]of Object.entries(T))if(D>=x&&D<=w){const V=parseInt(D.substring(0,4),10),$=parseInt(D.substring(4,6),10);R.push({year:V,month:$})}R.sort((D,V)=>D.year!==V.year?D.year-V.year:D.month-V.month);for(const{year:D,month:V}of R){const $=Ce.month(o,D,V),k=Pe.getQueryData($);if(k?.month){const M=md(k.month);await H0({budgetId:o,month:M,description:`recalculation: saving start_balance for ${D}/${V}`,updateMonthMap:!1})}}}catch(C){console.error("[mutationHelpers] Failed to save start_balance for months at/before window:",C)}finally{p(!1,"")}}try{await XT(o,p)}catch(C){console.warn("[mutationHelpers] Failed to ensure months fresh and recalculate balances:",C)}t({type:"budget",budgetId:o})},trackChange:t}}function JP(){const{currentViewingDocument:t}=Ze(),{saveCurrentDocument:e}=Rn(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=xr();return{finalizeAllocations:async o=>{const{budgetId:l,year:d,month:h,allocations:f,onProgress:p}=o;p?.({phase:"saving",message:"Saving allocations..."});const g=await nr(l,d,h);if(!g)throw new Error(`Month not found: ${d}/${h}`);const b=g.category_balances?.map(S=>S.category_id)??[],_=g.category_balances.map(S=>{const C=Ae(f[S.category_id]??S.allocated);return{...S,allocated:C}});for(const[S,C]of Object.entries(f))b.includes(S)||_.push({category_id:S,start_balance:0,allocated:Ae(C),spent:0,transfers:0,adjustments:0,end_balance:0});const w={...g,category_balances:_,are_allocations_finalized:!0,updated_at:new Date().toISOString()};n(l,d,h,w),p?.({phase:"recalculating",message:"Recalculating month balances..."});try{await r(l,d,h)}catch(S){console.warn("[useFinalizeAllocations] Failed to recalculate month and cascade:",S)}if(t.type==="month"&&t.year===d&&t.month===h)try{await e(l,"month",d,h)}catch(S){console.warn("[useFinalizeAllocations] Failed to save current document immediately:",S)}return p?.({phase:"complete",message:"Allocations applied!"}),{updatedMonth:w}},isPending:!1,isError:!1,error:null}}function cA(){const{currentViewingDocument:t}=Ze(),{saveCurrentDocument:e}=Rn(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=xr();return{deleteAllocations:async o=>{const{budgetId:l,year:d,month:h,onProgress:f}=o;f?.({phase:"saving",message:"Deleting allocations..."});const p=await nr(l,d,h);if(!p)throw new Error(`Month not found: ${d}/${h}`);const g=p.category_balances.map(w=>({...w,allocated:0})),b={...p,category_balances:g,are_allocations_finalized:!1,updated_at:new Date().toISOString()};n(l,d,h,b),f?.({phase:"recalculating",message:"Recalculating month balances..."});try{await r(l,d,h)}catch(w){console.warn("[useDeleteAllocations] Failed to recalculate month and cascade:",w)}if(t.type==="month"&&t.year===d&&t.month===h)try{await e(l,"month",d,h)}catch(w){console.warn("[useDeleteAllocations] Failed to save current document immediately:",w)}return f?.({phase:"complete",message:"Allocations deleted!"}),{updatedMonth:b}},isPending:!1,isError:!1,error:null}}async function Rm(t,e,n){const r=e.trim();if(!r||n.includes(r))return null;const i=[...n,r].sort((o,l)=>o.toLowerCase().localeCompare(l.toLowerCase()));return await cr("payees",t,{budget_id:t,payees:i,updated_at:new Date().toISOString()},`adding new payee "${r}" to autocomplete list`),i}function eB(t,e){const n={id:e,amount:Ae(t.amount),account_id:t.accountId,date:t.date,created_at:new Date().toISOString()};return t.payee?.trim()&&(n.payee=t.payee.trim()),t.description&&(n.description=t.description),n}function tB(){const t=Ut(),{currentViewingDocument:e}=Ze(),{saveCurrentDocument:n}=Rn(),{updateMonthCacheAndTrack:r,recalculateMonthAndCascade:i,trackChange:o}=xr(),l=Hn({onMutate:async h=>{const{budgetId:f,year:p,month:g}=h,b=Ce.month(f,p,g);await t.cancelQueries({queryKey:b});const _=t.getQueryData(b),w=`income_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,x=eB(h,w);if(_?.month){const C={..._.month,income:[..._.month.income||[],x],updated_at:new Date().toISOString()};r(f,p,g,C)}try{await i(f,p,g)}catch(C){console.warn("[useAddIncome] Failed to recalculate month and cascade:",C)}if(h.payee?.trim()){const C=t.getQueryData(Ce.payees(f))||[],T=await Rm(f,h.payee,C);T&&(t.setQueryData(Ce.payees(f),T),o({type:"payees",budgetId:f}))}if(e.type==="month"&&e.year===p&&e.month===g)try{await n(f,"month",p,g)}catch(C){console.warn("[useAddIncome] Failed to save current document immediately:",C)}return{previousData:_,incomeId:w,newIncome:x}},mutationFn:async h=>{const{budgetId:f,year:p,month:g}=h,b=Ce.month(f,p,g),_=t.getQueryData(b);if(!_?.month)throw new Error("No month data in cache after optimistic update");const w=_.month,x=w.income?.[w.income.length-1];if(!x)throw new Error("Could not find new income in updated month");return{updatedMonth:w,newIncome:x}},onError:(h,f,p)=>{if(p?.previousData){const{budgetId:g,year:b,month:_}=f;t.setQueryData(Ce.month(g,b,_),p.previousData)}}});return{addIncome:async(h,f,p,g,b,_,w,x)=>l.mutateAsync({budgetId:h,year:f,month:p,amount:g,accountId:b,date:_,payee:w,description:x}),isPending:l.isPending,isError:l.isError,error:l.error}}function nB(t,e,n,r,i,o){if(!t)return!0;const l=t.payee||void 0,d=i?.trim()||void 0,h=t.description||void 0,f=o||void 0;return e!==t.amount||n!==t.account_id||r!==t.date||d!==l||f!==h}function rB(){const t=Ut(),{currentViewingDocument:e}=Ze(),{saveCurrentDocument:n}=Rn(),{updateMonthCacheAndTrack:r,recalculateMonthAndCascade:i,trackChange:o}=xr();return{updateIncome:async(d,h,f,p,g,b,_,w,x)=>{const S=await nr(d,h,f);if(!S)throw new Error(`Month not found: ${h}/${f}`);const C=(S.income||[]).find($=>$.id===p);if(!nB(C,g,b,_,w,x))return{updatedMonth:S,noOp:!0};const T={id:p,amount:Ae(g),account_id:b,date:_,created_at:(S.income||[]).find($=>$.id===p)?.created_at||new Date().toISOString()};w?.trim()&&(T.payee=w.trim()),x&&(T.description=x);const R=(S.income||[]).map($=>$.id===p?T:$),D={...S,income:R,updated_at:new Date().toISOString()};r(d,h,f,D);try{await i(d,h,f)}catch($){console.warn("[useUpdateIncome] Failed to recalculate month and cascade:",$)}if(w?.trim()){const $=t.getQueryData(Ce.payees(d))||[],k=await Rm(d,w,$);k&&(t.setQueryData(Ce.payees(d),k),o({type:"payees",budgetId:d}))}if(e.type==="month"&&e.year===h&&e.month===f)try{await n(d,"month",h,f)}catch($){console.warn("[useUpdateIncome] Failed to save current document immediately:",$)}return{updatedMonth:D}},isPending:!1,isError:!1,error:null}}function sB(){const{currentViewingDocument:t}=Ze(),{saveCurrentDocument:e}=Rn(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=xr();return{deleteIncome:async(o,l,d,h)=>{const f=await nr(o,l,d);if(!f)throw new Error(`Month not found: ${l}/${d}`);const p=(f.income||[]).filter(_=>_.id!==h),g={...f,income:p,updated_at:new Date().toISOString()};n(o,l,d,g);try{await r(o,l,d)}catch(_){console.warn("[useDeleteIncome] Failed to recalculate month and cascade:",_)}if(t.type==="month"&&t.year===l&&t.month===d)try{await e(o,"month",l,d)}catch(_){console.warn("[useDeleteIncome] Failed to save current document immediately:",_)}return{updatedMonth:g}},isPending:!1,isError:!1,error:null}}function iB(t,e){const n={id:e,amount:Ae(t.amount),category_id:t.categoryId,account_id:t.accountId,date:t.date,created_at:new Date().toISOString()};return t.payee?.trim()&&(n.payee=t.payee.trim()),t.description&&(n.description=t.description),t.cleared!==void 0&&(n.cleared=t.cleared),n}function aB(){const t=Ut(),{currentViewingDocument:e}=Ze(),{saveCurrentDocument:n}=Rn(),{updateMonthCacheAndTrack:r,recalculateMonthAndCascade:i,trackChange:o}=xr(),l=Hn({onMutate:async h=>{const{budgetId:f,year:p,month:g}=h,b=Ce.month(f,p,g);await t.cancelQueries({queryKey:b});const _=t.getQueryData(b),w=`expense_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,x=iB(h,w);if(_?.month){const C={..._.month,expenses:[..._.month.expenses||[],x],updated_at:new Date().toISOString()};r(f,p,g,C)}try{await i(f,p,g)}catch(C){console.warn("[useAddExpense] Failed to recalculate month and cascade:",C)}if(h.payee?.trim()){const C=t.getQueryData(Ce.payees(f))||[],T=await Rm(f,h.payee,C);T&&(t.setQueryData(Ce.payees(f),T),o({type:"payees",budgetId:f}))}if(e.type==="month"&&e.year===p&&e.month===g)try{await n(f,"month",p,g)}catch(C){console.warn("[useAddExpense] Failed to save current document immediately:",C)}return{previousData:_,expenseId:w,newExpense:x}},mutationFn:async h=>{const{budgetId:f,year:p,month:g}=h,b=Ce.month(f,p,g),_=t.getQueryData(b);if(!_?.month)throw new Error("No month data in cache after optimistic update");const w=_.month,x=w.expenses?.[w.expenses.length-1];if(!x)throw new Error("Could not find new expense in updated month");return{updatedMonth:w,newExpense:x}},onError:(h,f,p)=>{if(p?.previousData){const{budgetId:g,year:b,month:_}=f;t.setQueryData(Ce.month(g,b,_),p.previousData)}}});return{addExpense:async(h,f,p,g,b,_,w,x,S,C)=>l.mutateAsync({budgetId:h,year:f,month:p,amount:g,categoryId:b,accountId:_,date:w,payee:x,description:S,cleared:C}),isPending:l.isPending,isError:l.isError,error:l.error}}function oB(t,e,n,r,i,o,l,d){if(!t)return!0;const h=t.payee||void 0,f=o?.trim()||void 0,p=t.description||void 0,g=l||void 0;return e!==t.amount||n!==t.category_id||r!==t.account_id||i!==t.date||f!==h||g!==p||d!==t.cleared}function lB(){const t=Ut(),{currentViewingDocument:e}=Ze(),{saveCurrentDocument:n}=Rn(),{updateMonthCacheAndTrack:r,recalculateMonthAndCascade:i}=xr();return{updateExpense:async(l,d,h,f,p,g,b,_,w,x,S)=>{const C=await nr(l,d,h);if(!C)throw new Error(`Month not found: ${d}/${h}`);const T=(C.expenses||[]).find(k=>k.id===f);if(!oB(T,p,g,b,_,w,x,S))return{updatedMonth:C,noOp:!0};const R={id:f,amount:Ae(p),category_id:g,account_id:b,date:_,created_at:C.expenses?.find(k=>k.id===f)?.created_at||new Date().toISOString()};w?.trim()&&(R.payee=w.trim()),x&&(R.description=x),S!==void 0&&(R.cleared=S);const D=(C.expenses||[]).map(k=>k.id===f?R:k),V={...C,expenses:D,updated_at:new Date().toISOString()};r(l,d,h,V);try{await i(l,d,h)}catch(k){console.warn("[useUpdateExpense] Failed to recalculate month and cascade:",k)}if(w?.trim()){const k=t.getQueryData(Ce.payees(l))||[],M=await Rm(l,w,k);M&&t.setQueryData(Ce.payees(l),M)}if(e.type==="month"&&e.year===d&&e.month===h)try{await n(l,"month",d,h)}catch(k){console.warn("[useUpdateExpense] Failed to save current document immediately:",k)}return{updatedMonth:V}},isPending:!1,isError:!1,error:null}}function cB(){const{currentViewingDocument:t}=Ze(),{saveCurrentDocument:e}=Rn(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=xr();return{deleteExpense:async(o,l,d,h)=>{const f=await nr(o,l,d);if(!f)throw new Error(`Month not found: ${l}/${d}`);const p=(f.expenses||[]).filter(_=>_.id!==h),g={...f,expenses:p,updated_at:new Date().toISOString()};n(o,l,d,g);try{await r(o,l,d)}catch(_){console.warn("[useDeleteExpense] Failed to recalculate month and cascade:",_)}if(t.type==="month"&&t.year===l&&t.month===d)try{await e(o,"month",l,d)}catch(_){console.warn("[useDeleteExpense] Failed to save current document immediately:",_)}return{updatedMonth:g}},isPending:!1,isError:!1,error:null}}function uB(t,e){const n={id:e,amount:Ae(t.amount),from_account_id:t.fromAccountId,to_account_id:t.toAccountId,from_category_id:t.fromCategoryId,to_category_id:t.toCategoryId,date:t.date,created_at:new Date().toISOString()};return t.description&&(n.description=t.description),t.cleared!==void 0&&(n.cleared=t.cleared),n}function dB(){const t=Ut(),{currentViewingDocument:e}=Ze(),{saveCurrentDocument:n}=Rn(),{updateMonthCacheAndTrack:r,recalculateMonthAndCascade:i}=xr(),o=Hn({onMutate:async d=>{const{budgetId:h,year:f,month:p}=d,g=Ce.month(h,f,p);await t.cancelQueries({queryKey:g});const b=t.getQueryData(g),_=`transfer_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,w=uB(d,_);if(b?.month){const S={...b.month,transfers:[...b.month.transfers||[],w],updated_at:new Date().toISOString()};r(h,f,p,S)}try{await i(h,f,p)}catch(S){console.warn("[useAddTransfer] Failed to recalculate month and cascade:",S)}if(e.type==="month"&&e.year===f&&e.month===p)try{await n(h,"month",f,p)}catch(S){console.warn("[useAddTransfer] Failed to save current document immediately:",S)}return{previousData:b,transferId:_,newTransfer:w}},mutationFn:async d=>{const{budgetId:h,year:f,month:p}=d,g=Ce.month(h,f,p),b=t.getQueryData(g);if(!b?.month)throw new Error("No month data in cache after optimistic update");const _=b.month,w=_.transfers?.[_.transfers.length-1];if(!w)throw new Error("Could not find new transfer in updated month");return{updatedMonth:_,newTransfer:w}},onError:(d,h,f)=>{if(f?.previousData){const{budgetId:p,year:g,month:b}=h;t.setQueryData(Ce.month(p,g,b),f.previousData)}}});return{addTransfer:async(d,h,f,p,g,b,_,w,x,S,C)=>o.mutateAsync({budgetId:d,year:h,month:f,amount:p,fromAccountId:g,toAccountId:b,fromCategoryId:_,toCategoryId:w,date:x,description:S,cleared:C}),isPending:o.isPending,isError:o.isError,error:o.error}}function hB(t,e,n,r,i,o,l,d,h){if(!t)return!0;const f=t.description||void 0,p=d||void 0;return e!==t.amount||n!==t.from_account_id||r!==t.to_account_id||i!==t.from_category_id||o!==t.to_category_id||l!==t.date||p!==f||h!==t.cleared}function fB(){const{currentViewingDocument:t}=Ze(),{saveCurrentDocument:e}=Rn(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=xr();return{updateTransfer:async(o,l,d,h,f,p,g,b,_,w,x,S)=>{const C=await nr(o,l,d);if(!C)throw new Error(`Month not found: ${l}/${d}`);const T=(C.transfers||[]).find(k=>k.id===h);if(!hB(T,f,p,g,b,_,w,x,S))return{updatedMonth:C,noOp:!0};const R={id:h,amount:Ae(f),from_account_id:p,to_account_id:g,from_category_id:b,to_category_id:_,date:w,created_at:C.transfers?.find(k=>k.id===h)?.created_at||new Date().toISOString()};x&&(R.description=x),S!==void 0&&(R.cleared=S);const D=(C.transfers||[]).map(k=>k.id===h?R:k),V={...C,transfers:D,updated_at:new Date().toISOString()};n(o,l,d,V);try{await r(o,l,d)}catch(k){console.warn("[useUpdateTransfer] Failed to recalculate month and cascade:",k)}if(t.type==="month"&&t.year===l&&t.month===d)try{await e(o,"month",l,d)}catch(k){console.warn("[useUpdateTransfer] Failed to save current document immediately:",k)}return{updatedMonth:V}},isPending:!1,isError:!1,error:null}}function mB(){const{currentViewingDocument:t}=Ze(),{saveCurrentDocument:e}=Rn(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=xr();return{deleteTransfer:async(o,l,d,h)=>{const f=await nr(o,l,d);if(!f)throw new Error(`Month not found: ${l}/${d}`);const p=(f.transfers||[]).filter(_=>_.id!==h),g={...f,transfers:p,updated_at:new Date().toISOString()};n(o,l,d,g);try{await r(o,l,d)}catch(_){console.warn("[useDeleteTransfer] Failed to recalculate month and cascade:",_)}if(t.type==="month"&&t.year===l&&t.month===d)try{await e(o,"month",l,d)}catch(_){console.warn("[useDeleteTransfer] Failed to save current document immediately:",_)}return{updatedMonth:g}},isPending:!1,isError:!1,error:null}}function pB(t,e){const n={id:e,amount:Ae(t.amount),account_id:t.accountId,category_id:t.categoryId,date:t.date,created_at:new Date().toISOString()};return t.payee?.trim()&&(n.payee=t.payee.trim()),t.description&&(n.description=t.description),t.cleared!==void 0&&(n.cleared=t.cleared),n}function gB(){const t=Ut(),{currentViewingDocument:e}=Ze(),{saveCurrentDocument:n}=Rn(),{updateMonthCacheAndTrack:r,recalculateMonthAndCascade:i}=xr(),o=Hn({onMutate:async d=>{const{budgetId:h,year:f,month:p}=d,g=Ce.month(h,f,p);await t.cancelQueries({queryKey:g});const b=t.getQueryData(g),_=`adjustment_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,w=pB(d,_);if(b?.month){const S={...b.month,adjustments:[...b.month.adjustments||[],w],updated_at:new Date().toISOString()};r(h,f,p,S)}try{await i(h,f,p)}catch(S){console.warn("[useAddAdjustment] Failed to recalculate month and cascade:",S)}if(e.type==="month"&&e.year===f&&e.month===p)try{await n(h,"month",f,p)}catch(S){console.warn("[useAddAdjustment] Failed to save current document immediately:",S)}return{previousData:b,adjustmentId:_,newAdjustment:w}},mutationFn:async d=>{const{budgetId:h,year:f,month:p}=d,g=Ce.month(h,f,p),b=t.getQueryData(g);if(!b?.month)throw new Error("No month data in cache after optimistic update");const _=b.month,w=_.adjustments?.[_.adjustments.length-1];if(!w)throw new Error("Could not find new adjustment in updated month");return{updatedMonth:_,newAdjustment:w}},onError:(d,h,f)=>{if(f?.previousData){const{budgetId:p,year:g,month:b}=h;t.setQueryData(Ce.month(p,g,b),f.previousData)}}});return{addAdjustment:async(d,h,f,p,g,b,_,w,x,S)=>o.mutateAsync({budgetId:d,year:h,month:f,amount:p,accountId:g,categoryId:b,date:_,payee:w,description:x,cleared:S}),isPending:o.isPending,isError:o.isError,error:o.error}}function yB(t,e,n,r,i,o,l,d){if(!t)return!0;const h=t.payee||void 0,f=o?.trim()||void 0,p=t.description||void 0,g=l||void 0;return e!==t.amount||n!==t.account_id||r!==t.category_id||i!==t.date||f!==h||g!==p||d!==t.cleared}function _B(){const{currentViewingDocument:t}=Ze(),{saveCurrentDocument:e}=Rn(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=xr();return{updateAdjustment:async(o,l,d,h,f,p,g,b,_,w,x)=>{const S=await nr(o,l,d);if(!S)throw new Error(`Month not found: ${l}/${d}`);const C=(S.adjustments||[]).find($=>$.id===h);if(!yB(C,f,p,g,b,_,w,x))return{updatedMonth:S,noOp:!0};const T={id:h,amount:Ae(f),account_id:p,category_id:g,date:b,created_at:S.adjustments?.find($=>$.id===h)?.created_at||new Date().toISOString()};_?.trim()&&(T.payee=_.trim()),w&&(T.description=w),x!==void 0&&(T.cleared=x);const R=(S.adjustments||[]).map($=>$.id===h?T:$),D={...S,adjustments:R,updated_at:new Date().toISOString()};n(o,l,d,D);try{await r(o,l,d)}catch($){console.warn("[useUpdateAdjustment] Failed to recalculate month and cascade:",$)}if(t.type==="month"&&t.year===l&&t.month===d)try{await e(o,"month",l,d)}catch($){console.warn("[useUpdateAdjustment] Failed to save current document immediately:",$)}return{updatedMonth:D}},isPending:!1,isError:!1,error:null}}function bB(){const{currentViewingDocument:t}=Ze(),{saveCurrentDocument:e}=Rn(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=xr();return{deleteAdjustment:async(o,l,d,h)=>{const f=await nr(o,l,d);if(!f)throw new Error(`Month not found: ${l}/${d}`);const p=(f.adjustments||[]).filter(_=>_.id!==h),g={...f,adjustments:p,updated_at:new Date().toISOString()};n(o,l,d,g);try{await r(o,l,d)}catch(_){console.warn("[useDeleteAdjustment] Failed to recalculate month and cascade:",_)}if(t.type==="month"&&t.year===l&&t.month===d)try{await e(o,"month",l,d)}catch(_){console.warn("[useDeleteAdjustment] Failed to save current document immediately:",_)}return{updatedMonth:g}},isPending:!1,isError:!1,error:null}}function vB({budgetId:t,enabled:e,initialDataLoadComplete:n,months:r}){const{addLoadingHold:i,removeLoadingHold:o}=jn(),{updateAccounts:l}=WT(),{updateCategories:d}=QT(),h=j.useRef(!1);j.useEffect(()=>{if(!e||!t||!n||r.length===0||h.current)return;h.current=!0,(async()=>{try{i("initial-balance-calculation","Calculating balances...");const p=Pe.getQueryData(Ce.budget(t));if(!p){console.warn("[useInitialBalanceCalculation] No budget data in cache"),o("initial-balance-calculation");return}const{budget:g,accounts:b,categories:_}=p,w=Object.keys(_),x=[...r].sort((Q,te)=>Q.year!==te.year?Q.year-te.year:Q.month-te.month),S=hd(),C=qe(S.year,S.month),T=x[0],R=T?qe(T.year,T.month):null;let D=null;if(R&&R<=C)D=x.find(Q=>qe(Q.year,Q.month)===C)||null;else{const{readMonth:Q}=await Ra(async()=>{const{readMonth:te}=await Promise.resolve().then(()=>IS);return{readMonth:te}},void 0);D=await Q(t,S.year,S.month,{description:"initial balance calculation: fetching first window month"})}let V=!1;D&&(V=(D.category_balances||[]).some(Q=>!ot(Q.category_id)&&Q.start_balance!==0)||(D.account_balances||[]).some(Q=>!Ke(Q.account_id)&&Q.start_balance!==0));let $=xm;const k=[];if(!V&&D){let Q=S.year,te=S.month,z=!1;const H=120;for(let re=0;re<H&&!z;re++){const ne=Ho(Q,te);Q=ne.year,te=ne.month;const{readMonth:ce}=await Ra(async()=>{const{readMonth:we}=await Promise.resolve().then(()=>IS);return{readMonth:we}},void 0),he=await ce(t,Q,te,{description:"initial balance calculation: walking backward to find start_balance"});if(!he)z=!0;else if((he.category_balances||[]).some(oe=>!ot(oe.category_id)&&oe.start_balance!==0)||(he.account_balances||[]).some(oe=>!Ke(oe.account_id)&&oe.start_balance!==0)){z=!0;const oe={},be={};for(const Me of he.category_balances||[])ot(Me.category_id)||(oe[Me.category_id]=Ae(Me.end_balance??0));for(const Me of he.account_balances||[])Ke(Me.account_id)||(be[Me.account_id]=Ae(Me.end_balance??0));$={categoryEndBalances:oe,accountEndBalances:be,totalIncome:Ae(he.total_income??0)}}else k.push(he)}k.reverse();for(const re of k){const ne=Gu(re,$);if($=rc(ne),bm(re.year,re.month)){const ce=md(ne);await H0({budgetId:t,month:ce,description:`initial balance calculation: ensuring start_balance for ${re.year}/${re.month}`,updateMonthMap:!1})}}}else if(T){const Q={},te={};for(const z of T.category_balances||[])ot(z.category_id)||(Q[z.category_id]=Ae(z.start_balance??0));for(const z of T.account_balances||[])Ke(z.account_id)||(te[z.account_id]=Ae(z.start_balance??0));$={categoryEndBalances:Q,accountEndBalances:te,totalIncome:Ae(T.previous_month_income??0)}}const M=[];for(const Q of x){const te=Gu(Q,$);M.push(te),$=rc(te)}const B=$.accountEndBalances,U=$.categoryEndBalances,q=M.length>0?M[M.length-1]:x.length>0?x[x.length-1]:null;let I;q?I=await OT(t,w,U,q.year,q.month):(I={},w.forEach(Q=>{I[Q]=0}));const N={};Object.entries(b).forEach(([Q,te])=>{N[Q]={...te,balance:Ae(B[Q]??0)}});const O={};Object.entries(_).forEach(([Q,te])=>{O[Q]={...te,balance:Ae(I[Q]??0)}});const J=g.month_map||{},Y=new Set(x.map(Q=>qe(Q.year,Q.month))),G={};for(const Q of Object.keys(J))Y.has(Q)?G[Q]={}:G[Q]=J[Q];for(const Q of x){const te=qe(Q.year,Q.month);te in G||(G[te]={})}for(const Q of M)Pe.setQueryData(Ce.month(t,Q.year,Q.month),{month:Q});if(JSON.stringify(g.month_map)!==JSON.stringify(G)){i("initial-balance-calculation","Saving month map...");const{writeBudgetData:Q}=await Ra(async()=>{const{writeBudgetData:te}=await Promise.resolve().then(()=>KT);return{writeBudgetData:te}},void 0);await Q({budgetId:t,updates:{month_map:G},description:"initial balance calculation: updating month_map"})}Pe.setQueryData(Ce.budget(t),{...p,budget:{...g,month_map:G},accounts:N,categories:O})}catch(p){const g=p instanceof Error?p.message:"Failed to calculate initial balances";console.error("[useInitialBalanceCalculation] Error calculating balances:",p),Jn.add({type:"error",message:`Initial balance calculation failed: ${g}`,autoDismissMs:1e4})}finally{o("initial-balance-calculation")}})()},[e,t,n,r,i,o,l,d]),j.useEffect(()=>{t||(h.current=!1)},[t])}const xB={currentUserId:null,selectedBudgetId:null,currentYear:new Date().getFullYear(),currentMonthNumber:new Date().getMonth()+1,lastActiveTab:"categories",lastSettingsTab:"categories",lastAdminTab:"budget",currentViewingDocument:{type:null},setCurrentViewingDocument:()=>{},setSelectedBudgetId:()=>{},setCurrentYear:()=>{},setCurrentMonthNumber:()=>{},setLastActiveTab:()=>{},setLastSettingsTab:()=>{},setLastAdminTab:()=>{},pageTitle:"Budget",setPageTitle:()=>{},isInitialized:!1,needsFirstBudget:!1,initialDataLoadComplete:!1,goToPreviousMonth:()=>{},goToNextMonth:()=>{},pendingInvites:[],hasPendingInvites:!1,accessibleBudgets:[],isAdmin:!1,isTest:!1,loadAccessibleBudgets:async()=>{},switchToBudget:()=>{},checkBudgetInvite:async()=>null,clearCache:()=>{}},uA=j.createContext(xB);function wB({children:t}){const n=ki().get_current_firebase_user(),[r,i]=j.useState(null),[o,l]=j.useState(new Date().getFullYear()),[d,h]=j.useState(new Date().getMonth()+1),[f,p]=j.useState("categories"),[g,b]=j.useState("categories"),[_,w]=j.useState("budget"),[x,S]=j.useState("Budget"),C=j.useCallback(he=>{S(we=>we===he?we:he)},[]),[T,R]=j.useState({type:null}),[D,V]=j.useState(!1),[$,k]=j.useState(!1),M=MT(n?.uid||null,n?.email||null),B=M.data&&M.data.budget_ids.length===0,U=b4(n?.uid||null,M.data||null,{enabled:!!n?.uid&&!!M.data&&B}),q=y3(r,{enabled:!!r&&D}),[I,N]=j.useState(!1);j.useEffect(()=>{if(!q.data){N(!1);return}const{budget:he,payees:we,months:oe}=q.data,be=Date.now();Pe.setQueryData(Ce.budget(r),he,{updatedAt:be}),Pe.setQueryData(Ce.payees(r),we,{updatedAt:be});for(const Me of oe)Pe.setQueryData(Ce.month(r,Me.year,Me.month),{month:Me},{updatedAt:be});N(!0)},[q.data,r]),vB({budgetId:r,enabled:!!r&&D&&I,initialDataLoadComplete:I,months:q.data?.months||[]}),j.useEffect(()=>{r||N(!1)},[r]);const O=M.data?.permission_flags?.is_admin===!0,J=M.data?.permission_flags?.is_test===!0,Y=U.data?.pendingInvites||[],G=U.data?.budgets||[],Z=Y.length>0;j.useEffect(()=>{if(!n||D||M.isLoading)return;const he=M.data;if(!(!he&&!M.isError))if(he&&he.budget_ids.length>0)i(he.budget_ids[0]),k(!1),V(!0);else{if(U.isLoading)return;const we=U.data;k(!(we?.pendingInvites&&we.pendingInvites.length>0)),V(!0)}},[n,D,M.data,M.isLoading,M.isError,U.data,U.isLoading]);const Q=j.useCallback(()=>{d===1?(l(he=>he-1),h(12)):h(he=>he-1)},[d]),te=j.useCallback(()=>{d===12?(l(he=>he+1),h(1)):h(he=>he+1)},[d]),z=j.useCallback(async he=>{(he?.force||!U.data)&&await U.refetch()},[U]),H=j.useCallback(he=>{i(he),k(!1)},[]),re=j.useCallback(async he=>{if(!n)return null;try{const we=await C4(he,n.uid);return we&&we.isInvited&&!we.hasAccepted?{budgetId:he,budgetName:we.budgetName,ownerEmail:we.ownerEmail}:null}catch(we){return console.error("[BudgetContext] Error checking budget invite:",we),null}},[n]),ne=j.useCallback(()=>{Pe.clear()},[]),ce={currentUserId:n?.uid||null,selectedBudgetId:r,currentYear:o,currentMonthNumber:d,lastActiveTab:f,lastSettingsTab:g,lastAdminTab:_,currentViewingDocument:T,setCurrentViewingDocument:R,setSelectedBudgetId:i,setCurrentYear:l,setCurrentMonthNumber:h,setLastActiveTab:p,setLastSettingsTab:b,setLastAdminTab:w,pageTitle:x,setPageTitle:C,isInitialized:D,needsFirstBudget:$,initialDataLoadComplete:I,goToPreviousMonth:Q,goToNextMonth:te,pendingInvites:Y,hasPendingInvites:Z,accessibleBudgets:G,isAdmin:O,isTest:J,loadAccessibleBudgets:z,switchToBudget:H,checkBudgetInvite:re,clearCache:ne};return u.jsx(uA.Provider,{value:ce,children:t})}function Ze(){const t=j.useContext(uA);if(!t)throw new Error("useBudget must be used within a BudgetProvider");return t}const SB=function(){},EB={is_logged_in:!1,is_auth_checked:!1,username:"",set_user_context:SB},_d=j.createContext(EB);function qS({budget:t,isCurrent:e,isAccepting:n,isSwitching:r,isEditing:i,editName:o,isRenaming:l,onAccept:d,onSwitch:h,onStartEdit:f,onCancelEdit:p,onEditNameChange:g,onSaveEdit:b}){const _=e&&t.isOwner;return u.jsx("div",{style:{background:e?"color-mix(in srgb, #646cff 15%, transparent)":"color-mix(in srgb, currentColor 8%, transparent)",border:e?"2px solid color-mix(in srgb, #646cff 50%, transparent)":"1px solid transparent",padding:"1rem",borderRadius:"8px"},children:i?u.jsxs("form",{onSubmit:b,children:[u.jsx("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"0.5rem"},children:u.jsx("input",{type:"text",value:o,onChange:w=>g(w.target.value),placeholder:"Budget name",autoFocus:!0,style:{flex:1,padding:"0.5rem 0.75rem",borderRadius:"6px",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"1rem",fontWeight:600,color:"inherit"}})}),u.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[u.jsx("button",{type:"submit",disabled:l||!o.trim(),style:{background:"#22c55e",color:"white",border:"none",padding:"0.4rem 0.75rem",borderRadius:"6px",cursor:l||!o.trim()?"not-allowed":"pointer",fontWeight:500,opacity:l||!o.trim()?.7:1,fontSize:"0.8rem"},children:l?"Saving...":"Save"}),u.jsx("button",{type:"button",onClick:p,disabled:l,style:{background:"transparent",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)",padding:"0.4rem 0.75rem",borderRadius:"6px",cursor:l?"not-allowed":"pointer",fontWeight:500,opacity:l?.7:.8,fontSize:"0.8rem"},children:"Cancel"})]})]}):u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem",flexWrap:"wrap"},children:[u.jsxs("div",{style:{flex:1,minWidth:"200px"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flexWrap:"wrap",marginBottom:"0.25rem"},children:[u.jsx("span",{style:{fontWeight:600},children:t.name}),t.isOwner&&u.jsx("span",{style:{background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.65rem",textTransform:"uppercase",fontWeight:600},children:"Owner"}),e&&u.jsx("span",{style:{background:"color-mix(in srgb, #22c55e 20%, transparent)",color:"#4ade80",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.65rem",textTransform:"uppercase",fontWeight:600},children:"Active"}),t.isPending&&u.jsx("span",{style:{background:"color-mix(in srgb, #f59e0b 20%, transparent)",color:"#fbbf24",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.65rem",textTransform:"uppercase",fontWeight:600},children:"Pending"}),_&&u.jsx("button",{onClick:f,style:{background:"transparent",border:"none",padding:"0.15rem",cursor:"pointer",opacity:.5,fontSize:"0.8rem",lineHeight:1},title:"Rename budget",children:""})]}),u.jsx("p",{style:{margin:0,fontSize:"0.8rem",opacity:.6},children:t.ownerEmail?`Owner: ${t.ownerEmail}`:`ID: ${t.id}`})]}),u.jsx("div",{style:{display:"flex",gap:"0.5rem"},children:t.isPending?u.jsx("button",{onClick:d,disabled:n,style:{background:"#22c55e",color:"white",border:"none",padding:"0.5rem 1rem",borderRadius:"6px",cursor:n?"not-allowed":"pointer",fontWeight:500,opacity:n?.7:1,fontSize:"0.85rem"},children:n?"Accepting...":"Accept"}):e?null:u.jsx("button",{onClick:h,disabled:r,style:{background:"#646cff",color:"white",border:"none",padding:"0.5rem 1rem",borderRadius:"6px",cursor:r?"not-allowed":"pointer",fontWeight:500,opacity:r?.7:1,fontSize:"0.85rem"},children:r?"Switching...":"Switch"})})]})})}const Uf={critical_bug:{label:"Critical Bug",color:"#ff4757",bgColor:"rgba(255, 71, 87, 0.15)"},bug:{label:"Bug",color:"#ffa502",bgColor:"rgba(255, 165, 2, 0.15)"},new_feature:{label:"New Feature",color:"#2ed573",bgColor:"rgba(46, 213, 115, 0.15)"},core_feature:{label:"Core Feature",color:"#1e90ff",bgColor:"rgba(30, 144, 255, 0.15)"},qol:{label:"QOL",color:"#a55eea",bgColor:"rgba(165, 94, 234, 0.15)"}};function dA({type:t,onClick:e}){const n=t==="feature"?"new_feature":t,r=n&&n in Uf?n:"bug",i=Uf[r];return u.jsx("button",{type:"button",onClick:e,style:{padding:"0.25rem 0.5rem",borderRadius:"0.25rem",background:i.bgColor,color:i.color,fontSize:"0.7rem",fontWeight:600,textTransform:"uppercase",letterSpacing:"0.025em",flexShrink:0,border:"none",cursor:"pointer",transition:"opacity 0.15s, transform 0.15s"},onMouseEnter:o=>{o.currentTarget.style.opacity="0.8",o.currentTarget.style.transform="scale(1.05)"},onMouseLeave:o=>{o.currentTarget.style.opacity="1",o.currentTarget.style.transform="scale(1)"},title:"Click to change type",children:i.label})}function CB({item:t,isDragging:e,isDragOver:n,onDragStart:r,onDragOver:i,onDragLeave:o,onDragEnd:l,onDrop:d,onToggleDone:h,onTypeClick:f}){return u.jsxs("div",{onDragOver:p=>{p.stopPropagation(),i(p)},onDragLeave:p=>{p.stopPropagation(),o()},onDrop:p=>{p.stopPropagation(),d(p)},style:{position:"relative"},children:[u.jsx("div",{style:{...H4,opacity:n?1:0,boxShadow:n?"0 0 8px rgba(100, 108, 255, 0.6)":"none"}}),u.jsxs("div",{draggable:!0,onDragStart:r,onDragEnd:l,style:{...G0,cursor:"grab",opacity:e?.5:1,flexDirection:"column",alignItems:"stretch",gap:"0.5rem"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[u.jsx("span",{style:{...q4},children:""}),u.jsx("input",{type:"checkbox",checked:t.is_done,onChange:h,style:{width:"1.25rem",height:"1.25rem",cursor:"pointer",accentColor:ge.primary,flexShrink:0}}),u.jsx(dA,{type:t.feedback_type,onClick:f})]}),u.jsxs("div",{style:{marginLeft:"3.25rem"},children:[u.jsx("p",{style:{margin:0,lineHeight:1.5},children:t.text}),u.jsxs("p",{style:{margin:"0.5rem 0 0 0",fontSize:"0.8rem",opacity:.6},children:[t.user_email,"  ",Ny(t.created_at)]})]})]})]})}function TB({item:t,onToggleDone:e,onTypeClick:n}){return u.jsxs("div",{style:{...G0,opacity:.6,flexDirection:"column",alignItems:"stretch",gap:"0.5rem"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[u.jsx("input",{type:"checkbox",checked:t.is_done,onChange:e,style:{width:"1.25rem",height:"1.25rem",cursor:"pointer",accentColor:ge.primary,flexShrink:0}}),u.jsx(dA,{type:t.feedback_type,onClick:n})]}),u.jsxs("div",{style:{marginLeft:"2rem"},children:[u.jsx("p",{style:{margin:0,lineHeight:1.5,textDecoration:"line-through"},children:t.text}),u.jsxs("p",{style:{margin:"0.5rem 0 0 0",fontSize:"0.8rem",opacity:.8},children:[t.user_email,"  Created: ",Ny(t.created_at)]}),t.completed_at&&u.jsxs("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.8rem",color:ge.success},children:[" Completed: ",Ny(t.completed_at)]})]})]})}function $n({noMargin:t}={}){return u.jsx("span",{style:{display:"inline-block",width:"14px",height:"14px",border:"2px solid rgba(255, 255, 255, 0.3)",borderTopColor:"white",borderRadius:"50%",animation:"spin 0.8s linear infinite",marginRight:t?0:"0.5rem",verticalAlign:"middle"}})}function hA(){const{state:t,closeModal:e}=yd();if(!t.isOpen)return null;const n=t.isComplete;return u.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0, 0, 0, 0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1002,padding:"1rem"},onClick:n?e:void 0,children:u.jsxs("div",{style:{background:"#1a1a1a",color:"rgba(255, 255, 255, 0.87)",borderRadius:"16px",padding:"2rem",width:"32rem",maxWidth:"calc(100vw - 2rem)",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.5)"},onClick:r=>r.stopPropagation(),children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1.5rem"},children:[u.jsxs("h2",{style:{margin:0,fontSize:"1.25rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[!t.isComplete&&u.jsx($n,{noMargin:!0}),t.migrationName]}),n&&u.jsx("button",{onClick:e,style:{background:"transparent",border:"none",color:"inherit",cursor:"pointer",fontSize:"1.5rem",opacity:.6,lineHeight:1,padding:"0.25rem"},title:"Close",children:""})]}),u.jsxs("div",{style:{fontSize:"1rem",fontWeight:500,marginBottom:"1rem",color:t.error?"#ef4444":t.isComplete?"#22c55e":"inherit"},children:[t.error?" ":t.isComplete?" ":"",t.stage]}),u.jsx("div",{style:{background:"rgba(255, 255, 255, 0.1)",borderRadius:"8px",height:"12px",overflow:"hidden",marginBottom:"1rem"},children:t.progress!==null?u.jsx("div",{style:{background:t.error?"#ef4444":t.isComplete?"#22c55e":"#646cff",height:"100%",width:`${t.progress}%`,transition:"width 0.3s ease-out",borderRadius:"8px"}}):u.jsx("div",{style:{background:t.error?"#ef4444":"#646cff",height:"100%",width:"30%",borderRadius:"8px",animation:"progressIndeterminate 1.5s ease-in-out infinite"}})}),t.currentItem&&u.jsx("div",{style:{fontSize:"0.9rem",opacity:.8,marginBottom:"0.5rem",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:t.currentItem}),t.details&&u.jsx("div",{style:{fontSize:"0.85rem",opacity:.6,marginBottom:t.error?"1rem":0},children:t.details}),t.error&&u.jsx("div",{style:{background:"rgba(239, 68, 68, 0.1)",border:"1px solid rgba(239, 68, 68, 0.3)",borderRadius:"8px",padding:"0.75rem 1rem",fontSize:"0.9rem",color:"#ef4444"},children:t.error}),t.isComplete&&u.jsx("button",{onClick:e,style:{marginTop:"1.5rem",width:"100%",background:t.error?"rgba(239, 68, 68, 0.2)":"#646cff",color:"white",border:"none",padding:"0.75rem 1.5rem",borderRadius:"8px",cursor:"pointer",fontWeight:500,fontSize:"1rem"},children:t.error?"Close":"Done"}),!t.isComplete&&u.jsx("div",{style:{marginTop:"1rem",fontSize:"0.85rem",opacity:.5,textAlign:"center"},children:"Please wait  do not close this window"}),u.jsx("style",{children:`
            @keyframes progressIndeterminate {
              0% { transform: translateX(-100%); }
              100% { transform: translateX(400%); }
            }
          `})]})})}function yi({isOpen:t,onClose:e,onConfirm:n,migrationName:r,isDestructive:i=!1,onDownloadBackup:o,isDownloading:l=!1}){const[d,h]=j.useState(!1),f=j.useCallback(async()=>{o&&(await o(),h(!0))},[o]),p=j.useCallback(()=>{n(d?"downloaded":"already-have")},[d,n]),g=j.useCallback(()=>{n("cancelled"),e()},[n,e]);return u.jsxs(Qs,{isOpen:t,onClose:g,title:" Backup Recommended",children:[u.jsx("div",{style:{background:i?"color-mix(in srgb, #ef4444 15%, transparent)":"color-mix(in srgb, #f59e0b 15%, transparent)",border:`1px solid ${i?"color-mix(in srgb, #ef4444 40%, transparent)":"color-mix(in srgb, #f59e0b 40%, transparent)"}`,borderRadius:"8px",padding:"1rem",marginBottom:"1rem"},children:u.jsx("p",{style:{margin:0,color:i?"#fca5a5":"#fcd34d",fontWeight:500,fontSize:"0.95rem"},children:i?" This migration modifies your data. A backup is strongly recommended!":" Before running migrations, we recommend having a recent backup."})}),u.jsxs("p",{style:{margin:"0 0 0.75rem",opacity:.9},children:["You are about to run: ",u.jsx("strong",{children:r})]}),u.jsx("p",{style:{margin:"0 0 1rem",opacity:.8,fontSize:"0.9rem"},children:"Please ensure you have a recent backup of your data. You can download a diagnostic backup that includes all your budget and month data."}),o&&u.jsx("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",padding:"1rem",marginBottom:"1rem"},children:u.jsx($e,{variant:"secondary",onClick:f,disabled:l,actionName:"Download Backup Before Migration",style:{width:"100%"},children:l?u.jsxs(u.Fragment,{children:[u.jsx($n,{noMargin:!0})," Downloading Backup..."]}):d?" Backup Downloaded":" Download Backup Now"})}),u.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[u.jsx($e,{variant:"secondary",actionName:"Cancel Migration",onClick:g,children:"Cancel"}),u.jsx($e,{variant:i?"danger":"primary",actionName:`Proceed with ${r}`,onClick:p,disabled:l,children:d?" Proceed with Migration":" I Have a Backup - Proceed"})]})]})}function _i({migrationName:t,isDestructive:e=!1,onDownloadBackup:n}){const[r,i]=j.useState(!1),[o,l]=j.useState(!1),[d,h]=j.useState(null),f=j.useCallback(_=>{h(()=>_),i(!0)},[]),p=j.useCallback(_=>{_!=="cancelled"&&d&&d(),h(null),i(!1)},[d]),g=j.useCallback(()=>{h(null),i(!1)},[]),b=j.useCallback(async()=>{if(n){l(!0);try{await n()}finally{l(!1)}}},[n]);return{promptBeforeAction:f,promptProps:{isOpen:r,onClose:g,onConfirm:p,migrationName:t,isDestructive:e,onDownloadBackup:n?b:void 0,isDownloading:o}}}const AB={onetime:{borderColor:"color-mix(in srgb, #a855f7 30%, transparent)",iconBg:"color-mix(in srgb, #a855f7 15%, transparent)",headerBg:"color-mix(in srgb, #a855f7 8%, transparent)"},maintenance:{borderColor:"color-mix(in srgb, #3b82f6 30%, transparent)",iconBg:"color-mix(in srgb, #3b82f6 15%, transparent)",headerBg:"color-mix(in srgb, #3b82f6 8%, transparent)"},utility:{borderColor:"color-mix(in srgb, #22c55e 30%, transparent)",iconBg:"color-mix(in srgb, #22c55e 15%, transparent)",headerBg:"color-mix(in srgb, #22c55e 8%, transparent)"}};function J0({title:t,icon:e,description:n,type:r,children:i,onValidateAll:o,isValidating:l=!1,isAnyRunning:d=!1}){const h=AB[r],f=l||d,p=()=>{o&&!f&&o()};return u.jsxs("section",{style:{background:"color-mix(in srgb, currentColor 3%, transparent)",border:`1px solid ${h.borderColor}`,borderRadius:"12px",marginBottom:"1.5rem",overflow:"hidden"},children:[u.jsxs("div",{style:{background:h.headerBg,padding:"1.25rem 1.5rem",borderBottom:`2px solid ${h.borderColor}`,display:"flex",justifyContent:"space-between",alignItems:"flex-start",gap:"1rem"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"0.875rem",flex:1},children:[u.jsx("span",{style:{fontSize:"1.75rem",background:h.iconBg,padding:"0.625rem",borderRadius:"10px",lineHeight:1,display:"flex",alignItems:"center",justifyContent:"center",minWidth:"48px",minHeight:"48px"},children:e}),u.jsxs("div",{children:[u.jsx("h3",{style:{margin:"0 0 0.375rem 0",fontSize:"1.25rem",fontWeight:600,letterSpacing:"-0.01em"},children:t}),u.jsx("p",{style:{margin:0,opacity:.75,fontSize:"0.9rem",lineHeight:1.4},children:n})]})]}),o&&u.jsx("button",{onClick:p,disabled:f,style:{background:"color-mix(in srgb, #3b82f6 20%, transparent)",color:"#60a5fa",border:"1px solid color-mix(in srgb, #3b82f6 40%, transparent)",padding:"0.5rem 1rem",borderRadius:"6px",cursor:f?"not-allowed":"pointer",fontWeight:500,fontSize:"0.85rem",opacity:f?.6:1,display:"flex",alignItems:"center",gap:"0.4rem",flexShrink:0},children:l?u.jsxs(u.Fragment,{children:[u.jsx($n,{noMargin:!0})," Validating..."]}):" Validate All"})]}),u.jsx("div",{style:{padding:"0.75rem",background:"color-mix(in srgb, currentColor 1%, transparent)"},children:i})]})}const jB={unknown:{color:"#9ca3af",icon:"",text:"Unknown"},clean:{color:"#22c55e",icon:"",text:"Clean"},"needs-action":{color:"#f59e0b",icon:"",text:"Needs Action"},running:{color:"#60a5fa",icon:"",text:"Running"},complete:{color:"#22c55e",icon:"",text:"Complete"},error:{color:"#ef4444",icon:"",text:"Error"}};function Go({name:t,description:e,status:n,statusText:r,onCheck:i,isChecking:o,onRun:l,isRunning:d=!1,actionText:h="Run",disabled:f=!1,itemCount:p,details:g,isDestructive:b=!1}){const[_,w]=j.useState(!1),x=jB[n],S=r||x.text,C=f||d||o,T=()=>{i()},R=()=>{l&&l()},D=()=>{g&&w(!_)};return u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"8px",margin:"0.25rem 0",overflow:"hidden"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"0.75rem 1rem",gap:"1rem"},children:[u.jsx("div",{style:{width:"28px",height:"28px",borderRadius:"50%",background:`color-mix(in srgb, ${x.color} 20%, transparent)`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.85rem",flexShrink:0},children:d||o?u.jsx($n,{noMargin:!0}):x.icon}),u.jsxs("div",{style:{flex:1,minWidth:0},children:[u.jsx("div",{style:{fontWeight:500,fontSize:"0.95rem",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:t}),u.jsx("div",{style:{fontSize:"0.8rem",opacity:.6,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:e})]}),u.jsxs("div",{style:{color:x.color,fontSize:"0.8rem",fontWeight:500,display:"flex",alignItems:"center",gap:"0.25rem",flexShrink:0},children:[S,p!==void 0&&p>0&&u.jsx("span",{style:{background:`color-mix(in srgb, ${x.color} 20%, transparent)`,padding:"0.15rem 0.4rem",borderRadius:"4px",fontSize:"0.75rem"},children:p})]}),u.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:[u.jsx("button",{onClick:T,disabled:C,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",padding:"0.35rem 0.6rem",borderRadius:"4px",cursor:C?"not-allowed":"pointer",fontSize:"0.8rem",opacity:C?.5:1,display:"flex",alignItems:"center",gap:"0.25rem"},title:"Check status",children:o?u.jsx($n,{noMargin:!0}):""}),l&&n==="needs-action"&&u.jsx("button",{onClick:R,disabled:C,style:{background:b?"#ef4444":"#646cff",color:"white",border:"none",padding:"0.35rem 0.75rem",borderRadius:"4px",cursor:C?"not-allowed":"pointer",fontSize:"0.8rem",fontWeight:500,opacity:C?.6:1,display:"flex",alignItems:"center",gap:"0.25rem"},children:d?u.jsx($n,{noMargin:!0}):h}),g&&u.jsx("button",{onClick:D,style:{background:"transparent",color:"inherit",border:"none",padding:"0.35rem",borderRadius:"4px",cursor:"pointer",fontSize:"0.9rem",opacity:.6},title:_?"Collapse details":"Expand details",children:_?"":""})]})]}),_&&g&&u.jsx("div",{style:{borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)",padding:"1rem",background:"color-mix(in srgb, currentColor 2%, transparent)"},children:g})]})}function RB({name:t,description:e,onAction:n,actionText:r,actionIcon:i,isRunning:o=!1,disabled:l=!1,progress:d,error:h,isDestructive:f=!1}){const p=l||o,g=()=>{n()};return u.jsx("div",{style:{background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"8px",margin:"0.25rem 0",padding:"0.75rem 1rem"},children:u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},children:[u.jsxs("div",{style:{flex:1,minWidth:0},children:[u.jsx("div",{style:{fontWeight:500,fontSize:"0.95rem",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:t}),u.jsx("div",{style:{fontSize:"0.8rem",opacity:.6,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:e}),h&&u.jsx("div",{style:{fontSize:"0.8rem",color:"#ef4444",marginTop:"0.25rem"},children:h})]}),d!==void 0&&o&&u.jsxs("div",{style:{width:"100px",flexShrink:0},children:[u.jsx("div",{style:{background:"rgba(255, 255, 255, 0.1)",borderRadius:"4px",height:"6px",overflow:"hidden"},children:u.jsx("div",{style:{background:f?"#ef4444":"#646cff",height:"100%",width:`${d}%`,transition:"width 0.3s"}})}),u.jsxs("div",{style:{fontSize:"0.7rem",opacity:.6,textAlign:"center",marginTop:"0.15rem"},children:[d,"%"]})]}),u.jsx("button",{onClick:g,disabled:p,style:{background:f?"#ef4444":"#646cff",color:"white",border:"none",padding:"0.5rem 1rem",borderRadius:"6px",cursor:p?"not-allowed":"pointer",fontSize:"0.85rem",fontWeight:500,opacity:p?.6:1,display:"flex",alignItems:"center",gap:"0.4rem",flexShrink:0},children:o?u.jsxs(u.Fragment,{children:[u.jsx($n,{noMargin:!0})," Running..."]}):u.jsxs(u.Fragment,{children:[i&&u.jsx("span",{children:i}),r]})})]})})}function IB(t,e,n,r,i){return r?"running":i?i.errors.length>0?"error":"complete":e?n?"needs-action":"clean":"unknown"}function DB(t,e,n,r){return e?n?`${r} month(s) need migration`:"No data to migrate":"No data scanned"}function kB(t,e,n,r,i){return t?u.jsxs("div",{style:{fontSize:"0.85rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem",fontWeight:500},children:t.errors.length>0?" Completed with errors":" Migration complete"}),u.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[t.budgetsProcessed>0&&u.jsxs("li",{children:[t.budgetsProcessed," budget(s) processed"]}),t.monthsProcessed>0&&u.jsxs("li",{children:[t.monthsProcessed," month(s) processed"]}),t.monthsUpdated>0&&u.jsxs("li",{children:[t.monthsUpdated," month(s) updated"]}),t.monthsUpdated===0&&t.monthsProcessed>0&&u.jsx("li",{children:"No months needed updates"})]}),t.errors.length>0&&u.jsxs("div",{style:{marginTop:"0.5rem",color:"#ef4444"},children:[u.jsxs("div",{children:["Errors (",t.errors.length,"):"]}),u.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1.25rem"},children:[t.errors.slice(0,3).map((o,l)=>u.jsx("li",{children:o},l)),t.errors.length>3&&u.jsxs("li",{children:["...and ",t.errors.length-3," more"]})]})]})]}):e?n?u.jsxs("div",{style:{fontSize:"0.85rem"},children:[u.jsxs("div",{style:{marginBottom:"0.25rem"},children:["Found ",i," month(s) with total_income or total_expenses fields."]}),r&&u.jsxs("div",{style:{opacity:.6,fontSize:"0.8rem"},children:[r.monthsWithTotalIncome>0&&`${r.monthsWithTotalIncome} with total_income`,r.monthsWithTotalIncome>0&&r.monthsWithTotalExpenses>0&&", ",r.monthsWithTotalExpenses>0&&`${r.monthsWithTotalExpenses} with total_expenses`]})]}):u.jsxs("div",{style:{fontSize:"0.85rem"},children:[" All months are clean.",u.jsxs("div",{style:{marginTop:"0.25rem",opacity:.6},children:["Scanned ",r.totalMonths," month(s) across ",r.totalBudgets," budget(s)."]})]}):u.jsx("div",{style:{fontSize:"0.85rem",opacity:.7},children:"Click check to scan for months with total_income or total_expenses fields."})}function MB({status:t,hasData:e,needsMigration:n,totalItemsToFix:r,isChecking:i,isRunning:o,result:l,onCheck:d,onRun:h,disabled:f}){return u.jsx(Go,{name:"Remove Total Fields Migration",description:"Removes total_income and total_expenses from month documents. These are calculated from income/expenses arrays on-the-fly.",status:IB(t,e,n,o,l),statusText:DB(t,e,n,r),isChecking:i,isRunning:o,onCheck:d,onRun:n?h:void 0,actionText:n?`Migrate ${r}`:void 0,disabled:f,itemCount:r,details:kB(l,e,n,t,r)})}function OB(t,e,n,r,i){return r?"running":i?i.errors.length>0?"error":"complete":e?n?"needs-action":"clean":"unknown"}function NB(t,e,n,r){return e?n?`${r} month(s) need migration`:"No data to migrate":"No data scanned"}function PB(t,e,n,r,i){return t?u.jsxs("div",{style:{fontSize:"0.85rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem",fontWeight:500},children:t.errors.length>0?" Completed with errors":" Migration complete"}),u.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[t.budgetsProcessed>0&&u.jsxs("li",{children:[t.budgetsProcessed," budget(s) processed"]}),t.monthsProcessed>0&&u.jsxs("li",{children:[t.monthsProcessed," month(s) processed"]}),t.monthsUpdated>0&&u.jsxs("li",{children:[t.monthsUpdated," month(s) updated"]}),t.monthsUpdated===0&&t.monthsProcessed>0&&u.jsx("li",{children:"No months needed updates"})]}),t.errors.length>0&&u.jsxs("div",{style:{marginTop:"0.5rem",color:"#ef4444"},children:[u.jsxs("div",{children:["Errors (",t.errors.length,"):"]}),u.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1.25rem"},children:[t.errors.slice(0,3).map((o,l)=>u.jsx("li",{children:o},l)),t.errors.length>3&&u.jsxs("li",{children:["...and ",t.errors.length-3," more"]})]})]})]}):e?n?u.jsxs("div",{style:{fontSize:"0.85rem"},children:[u.jsxs("div",{style:{marginBottom:"0.25rem"},children:["Found ",i," month(s) with previous_month_income field."]}),u.jsx("div",{style:{opacity:.6,fontSize:"0.8rem"},children:"This field is now calculated from the previous month's income array."})]}):u.jsxs("div",{style:{fontSize:"0.85rem"},children:[" All months are clean.",u.jsxs("div",{style:{marginTop:"0.25rem",opacity:.6},children:["Scanned ",r.totalMonths," month(s) across ",r.totalBudgets," budget(s)."]})]}):u.jsx("div",{style:{fontSize:"0.85rem",opacity:.7},children:"Click check to scan for months with previous_month_income field."})}function BB({status:t,hasData:e,needsMigration:n,totalItemsToFix:r,isChecking:i,isRunning:o,result:l,onCheck:d,onRun:h,disabled:f}){return u.jsx(Go,{name:"Remove Previous Month Income Migration",description:"Removes previous_month_income from month documents. This is calculated from the previous month's income array on-the-fly.",status:OB(t,e,n,o,l),statusText:NB(t,e,n,r),isChecking:i,isRunning:o,onCheck:d,onRun:n?h:void 0,actionText:n?`Migrate ${r}`:void 0,disabled:f,itemCount:r,details:PB(l,e,n,t,r)})}function zB({disabled:t,onDownloadBackup:e,isDownloadingBackup:n,removeTotalFieldsMigration:r,removePreviousMonthIncomeMigration:i}){const o=r.isRunning||i.isRunning;return u.jsx(u.Fragment,{children:u.jsxs(J0,{title:"One-Time Migrations",icon:"",description:"Migrations that typically only need to be run once. Check status first, then apply if needed.",type:"onetime",isAnyRunning:o,children:[u.jsx(MB,{status:r.status,hasData:r.hasData,needsMigration:r.needsMigration,totalItemsToFix:r.totalItemsToFix,isChecking:r.isScanning,isRunning:r.isRunning,result:r.result,onCheck:r.scanStatus,onRun:r.runMigration,disabled:t}),u.jsx(BB,{status:i.status,hasData:i.hasData,needsMigration:i.needsMigration,totalItemsToFix:i.totalItemsToFix,isChecking:i.isScanning,isRunning:i.isRunning,result:i.result,onCheck:i.scanStatus,onRun:i.runMigration,disabled:t})]})})}const fA={unknown:{color:"#9ca3af",icon:""},clean:{color:"#22c55e",icon:""},"needs-action":{color:"#f59e0b",icon:""},running:{color:"#60a5fa",icon:""},complete:{color:"#22c55e",icon:""},error:{color:"#ef4444",icon:""}};function LB({check:t,disabled:e}){const n=fA[t.status],r=e||t.isRunning||t.isChecking;return u.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"0.5rem 0.75rem",gap:"0.75rem",borderRadius:"6px",background:"color-mix(in srgb, currentColor 3%, transparent)",marginBottom:"0.25rem"},children:[u.jsx("div",{style:{width:"20px",height:"20px",borderRadius:"50%",background:`color-mix(in srgb, ${n.color} 20%, transparent)`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.7rem",flexShrink:0},children:t.isRunning||t.isChecking?u.jsx($n,{noMargin:!0}):n.icon}),u.jsxs("div",{style:{flex:1,minWidth:0},children:[u.jsxs("div",{style:{fontWeight:500,fontSize:"0.85rem"},children:[t.name,t.issueCount>0&&u.jsxs("span",{style:{marginLeft:"0.5rem",color:n.color,fontSize:"0.75rem"},children:["(",t.issueCount,")"]})]}),u.jsx("div",{style:{fontSize:"0.75rem",opacity:.6},children:t.description}),t.details]}),u.jsxs("div",{style:{display:"flex",gap:"0.35rem",flexShrink:0},children:[u.jsx("button",{onClick:()=>{`${t.name}`,t.onCheck()},disabled:r,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",padding:"0.25rem 0.4rem",borderRadius:"4px",cursor:r?"not-allowed":"pointer",fontSize:"0.7rem",opacity:r?.5:1},title:"Check",children:t.isChecking?u.jsx($n,{noMargin:!0}):""}),t.canFix&&t.onFix&&u.jsx("button",{onClick:()=>{`${t.name}`,t.onFix()},disabled:r,style:{background:"#646cff",color:"white",border:"none",padding:"0.25rem 0.5rem",borderRadius:"4px",cursor:r?"not-allowed":"pointer",fontSize:"0.7rem",fontWeight:500,opacity:r?.6:1},children:t.isRunning?u.jsx($n,{noMargin:!0}):"Fix"})]})]})}function UB({accountCategoryValidation:t,orphanedIdCleanup:e,expenseToAdjustment:n,adjustmentsToTransfers:r,needsAction:i,totalIssues:o,isScanning:l,isRunning:d,disabled:h,onRunOrphaned:f,onRunExpense:p,onRunTransfers:g}){const[b,_]=j.useState(!1),x=d?"running":t.hasData&&e.hasData&&n.hasData&&r.hasData?i?"needs-action":"clean":"unknown",S=fA[x],C=[{id:"validation",name:"Account/Category Validation",status:t.isScanning?"running":t.hasData?t.hasViolations?"needs-action":"clean":"unknown",issueCount:t.violationCount,description:"Validates all transactions have proper account/category combinations",canFix:!1,onCheck:()=>t.scan(),isChecking:t.isScanning,isRunning:!1,details:t.hasViolations&&t.status&&u.jsxs("div",{style:{fontSize:"0.8rem",opacity:.8},children:[t.status.violations.filter(D=>D.transactionType==="income").length>0&&u.jsxs("span",{children:["Income: ",t.status.violations.filter(D=>D.transactionType==="income").length," "]}),t.status.violations.filter(D=>D.transactionType==="expense").length>0&&u.jsxs("span",{children:["Expenses: ",t.status.violations.filter(D=>D.transactionType==="expense").length," "]}),t.status.violations.filter(D=>D.transactionType==="adjustment").length>0&&u.jsxs("span",{children:["Adjustments: ",t.status.violations.filter(D=>D.transactionType==="adjustment").length," "]}),t.status.violations.filter(D=>D.transactionType==="transfer").length>0&&u.jsxs("span",{children:["Transfers: ",t.status.violations.filter(D=>D.transactionType==="transfer").length]})]})},{id:"orphaned",name:"Orphaned ID Cleanup",status:Xg(e),issueCount:e.totalOrphaned,description:"Finds transactions with deleted/invalid account/category IDs",canFix:e.hasItemsToFix,onCheck:e.scanStatus,onFix:f,isChecking:e.isScanning,isRunning:e.isRunning,details:e.hasItemsToFix&&e.status&&u.jsxs("div",{style:{fontSize:"0.8rem",opacity:.8},children:[e.status.orphanedCategoryIds>0&&u.jsxs("span",{children:["Categories: ",e.status.orphanedCategoryIds," "]}),e.status.orphanedAccountIds>0&&u.jsxs("span",{children:["Accounts: ",e.status.orphanedAccountIds]})]})},{id:"expense",name:"Expense  Adjustment",status:Xg(n,"hasItemsToMigrate"),issueCount:n.totalToMigrate,description:"Moves expenses without account/category to adjustments",canFix:n.hasItemsToMigrate,onCheck:n.scanStatus,onFix:p,isChecking:n.isScanning,isRunning:n.isRunning,details:n.hasItemsToMigrate&&n.status&&u.jsxs("div",{style:{fontSize:"0.8rem",opacity:.8},children:[n.status.expensesToMigrate," expense(s) with No Account or No Category"]})},{id:"transfers",name:"Adjustment  Transfers",status:Xg(r,"hasPairsToConvert"),issueCount:r.totalPairs,description:"Converts opposite adjustment pairs to transfers",canFix:r.hasPairsToConvert,onCheck:r.scanStatus,onFix:g,isChecking:r.isScanning,isRunning:r.isRunning,details:r.hasPairsToConvert&&r.status&&u.jsxs("div",{style:{fontSize:"0.8rem",opacity:.8},children:[r.status.accountTransferPairs>0&&u.jsxs("span",{children:["Account transfers: ",r.status.accountTransferPairs," "]}),r.status.categoryTransferPairs>0&&u.jsxs("span",{children:["Category transfers: ",r.status.categoryTransferPairs]})]})}],T=h||d||l,R=()=>{C.forEach(D=>D.onCheck())};return u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"8px",margin:"0.25rem 0",overflow:"hidden"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"0.75rem 1rem",gap:"1rem"},children:[u.jsx("div",{style:{width:"28px",height:"28px",borderRadius:"50%",background:`color-mix(in srgb, ${S.color} 20%, transparent)`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.85rem",flexShrink:0},children:d||l?u.jsx($n,{noMargin:!0}):S.icon}),u.jsxs("div",{style:{flex:1,minWidth:0},children:[u.jsx("div",{style:{fontWeight:500,fontSize:"0.95rem",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:"Transaction Type Audit"}),u.jsx("div",{style:{fontSize:"0.8rem",opacity:.6,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:"Validates account/category assignments and fixes invalid transactions"})]}),u.jsxs("div",{style:{color:S.color,fontSize:"0.8rem",fontWeight:500,display:"flex",alignItems:"center",gap:"0.25rem",flexShrink:0},children:[x==="unknown"?"Unknown":x==="clean"?"Clean":x==="running"?"Running":"Needs Action",o>0&&u.jsx("span",{style:{background:`color-mix(in srgb, ${S.color} 20%, transparent)`,padding:"0.15rem 0.4rem",borderRadius:"4px",fontSize:"0.75rem"},children:o})]}),u.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:[u.jsx("button",{onClick:R,disabled:T,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",padding:"0.35rem 0.6rem",borderRadius:"4px",cursor:T?"not-allowed":"pointer",fontSize:"0.8rem",opacity:T?.5:1,display:"flex",alignItems:"center",gap:"0.25rem"},title:"Check all",children:l?u.jsx($n,{noMargin:!0}):""}),u.jsx("button",{onClick:()=>_(!b),style:{background:"transparent",color:"inherit",border:"none",padding:"0.35rem",borderRadius:"4px",cursor:"pointer",fontSize:"0.9rem",opacity:.6},title:b?"Collapse":"Expand",children:b?"":""})]})]}),b&&u.jsx("div",{style:{borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)",padding:"0.5rem",background:"color-mix(in srgb, currentColor 2%, transparent)"},children:C.map(D=>u.jsx(LB,{check:D,disabled:h},D.id))})]})}function Xg(t,e="hasItemsToFix"){return t.isRunning?"running":t.result&&t.result.errors.length===0?"complete":t.isScanning?"running":t.hasData?t[e]?"needs-action":"clean":"unknown"}function FB({status:t,hasData:e,hasIssues:n,totalIssues:r,isChecking:i,isRunning:o,result:l,onCheck:d,onRun:h,disabled:f}){const p=()=>o?"running":e?l&&l.errors.length===0?"complete":l&&l.errors.length>0?"error":n?"needs-action":"clean":"unknown",g=()=>{if(l&&l.errors.length===0){const _=l.accountsFixed+l.categoriesFixed+l.totalAvailableFixed+l.incomeValuesFixed+l.expenseValuesFixed+l.categoryBalancesFixed+l.accountBalancesFixed;return _>0?`Fixed ${_}`:"Complete"}},b=()=>{if(l){const _=l.accountsFixed+l.categoriesFixed+l.totalAvailableFixed+l.incomeValuesFixed+l.expenseValuesFixed+l.categoryBalancesFixed+l.accountBalancesFixed;return u.jsxs("div",{style:{fontSize:"0.85rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem",fontWeight:500},children:l.errors.length>0?" Completed with errors":" Cleanup complete"}),u.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[l.budgetsProcessed>0&&u.jsxs("li",{children:[l.budgetsProcessed," budget(s) updated"]}),l.accountsFixed>0&&u.jsxs("li",{children:[l.accountsFixed," account balance(s) fixed"]}),l.categoriesFixed>0&&u.jsxs("li",{children:[l.categoriesFixed," category value(s) fixed"]}),l.totalAvailableFixed>0&&u.jsxs("li",{children:[l.totalAvailableFixed," total_available value(s) fixed"]}),l.monthsProcessed>0&&u.jsxs("li",{children:[l.monthsProcessed," month(s) updated"]}),l.incomeValuesFixed>0&&u.jsxs("li",{children:[l.incomeValuesFixed," income amount(s) fixed"]}),l.expenseValuesFixed>0&&u.jsxs("li",{children:[l.expenseValuesFixed," expense amount(s) fixed"]}),l.categoryBalancesFixed>0&&u.jsxs("li",{children:[l.categoryBalancesFixed," category balance(s) fixed"]}),l.accountBalancesFixed>0&&u.jsxs("li",{children:[l.accountBalancesFixed," account balance(s) fixed"]}),_===0&&u.jsx("li",{children:"No changes needed"})]}),l.errors.length>0&&u.jsxs("div",{style:{marginTop:"0.5rem",color:"#ef4444"},children:[u.jsxs("div",{children:["Errors (",l.errors.length,"):"]}),u.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1.25rem"},children:[l.errors.slice(0,3).map((w,x)=>u.jsx("li",{children:w},x)),l.errors.length>3&&u.jsxs("li",{children:["...and ",l.errors.length-3," more"]})]})]})]})}return e?n?u.jsxs("div",{style:{fontSize:"0.85rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem",color:"#fbbf24"},children:"Precision issues found:"}),u.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[t.budgetsWithPrecisionIssues>0&&u.jsxs("li",{children:[t.budgetsWithPrecisionIssues," budget(s) with issues:",u.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1rem",opacity:.8},children:[t.accountsWithPrecisionIssues>0&&u.jsxs("li",{children:[t.accountsWithPrecisionIssues," account balance(s)"]}),t.categoriesWithPrecisionIssues>0&&u.jsxs("li",{children:[t.categoriesWithPrecisionIssues," category value(s)"]}),t.totalAvailableWithPrecisionIssues>0&&u.jsxs("li",{children:[t.totalAvailableWithPrecisionIssues," total_available value(s)"]})]})]}),t.monthsWithPrecisionIssues>0&&u.jsxs("li",{children:[t.monthsWithPrecisionIssues," month(s) with issues:",u.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1rem",opacity:.8},children:[t.incomeValuesWithPrecisionIssues>0&&u.jsxs("li",{children:[t.incomeValuesWithPrecisionIssues," income amount(s)"]}),t.expenseValuesWithPrecisionIssues>0&&u.jsxs("li",{children:[t.expenseValuesWithPrecisionIssues," expense amount(s)"]}),t.categoryBalancesWithPrecisionIssues>0&&u.jsxs("li",{children:[t.categoryBalancesWithPrecisionIssues," category balance(s)"]}),t.accountBalancesWithPrecisionIssues>0&&u.jsxs("li",{children:[t.accountBalancesWithPrecisionIssues," account balance(s)"]})]})]})]}),u.jsxs("div",{style:{marginTop:"0.5rem",opacity:.6},children:["Scanned ",t.totalBudgets," budget(s) and ",t.totalMonths," month(s)."]})]}):u.jsxs("div",{style:{fontSize:"0.85rem"},children:[" All currency values have proper precision (2 decimal places).",u.jsxs("div",{style:{marginTop:"0.25rem",opacity:.6},children:["Scanned ",t.totalBudgets," budget(s) and ",t.totalMonths," month(s)."]})]}):u.jsx("div",{style:{fontSize:"0.85rem",opacity:.7},children:"Click check to scan for precision issues."})};return u.jsx(Go,{name:"Currency Precision",description:"Fixes floating-point precision by rounding all values to 2 decimal places",status:p(),statusText:g(),onCheck:d,isChecking:i,onRun:h,isRunning:o,actionText:`Fix ${r}`,disabled:f,itemCount:n?r:void 0,details:b(),isDestructive:!0})}function VB({status:t,hasData:e,needsMigration:n,totalItemsToFix:r,isChecking:i,isRunning:o,result:l,onCheck:d,onRun:h,disabled:f}){const p=()=>o?"running":e?l&&l.errors.length===0?"complete":l&&l.errors.length>0?"error":n?"needs-action":"clean":"unknown",g=()=>{if(l&&l.errors.length===0)return l.monthsUpdated>0?`Updated ${l.monthsUpdated} month(s)`:"Complete"},b=()=>l?u.jsxs("div",{style:{fontSize:"0.85rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem",fontWeight:500},children:l.errors.length>0?" Completed with errors":" Recalculation complete"}),u.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[l.budgetsProcessed>0&&u.jsxs("li",{children:[l.budgetsProcessed," budget(s) processed"]}),l.monthsProcessed>0&&u.jsxs("li",{children:[l.monthsProcessed," month(s) processed"]}),l.monthsUpdated>0&&u.jsxs("li",{children:[l.monthsUpdated," month(s) updated"]}),l.monthsUpdated===0&&u.jsx("li",{children:"No changes needed"})]}),l.errors.length>0&&u.jsxs("div",{style:{marginTop:"0.5rem",color:"#ef4444"},children:[u.jsxs("div",{children:["Errors (",l.errors.length,"):"]}),u.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1.25rem"},children:[l.errors.slice(0,3).map((_,w)=>u.jsx("li",{children:_},w)),l.errors.length>3&&u.jsxs("li",{children:["...and ",l.errors.length-3," more"]})]})]})]}):e?n?u.jsxs("div",{style:{fontSize:"0.85rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem",color:"#fbbf24"},children:"Months needing recalculation:"}),u.jsx("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:u.jsxs("li",{children:[t.monthsNeedingRecalculation," month(s) from first month up to earliest window month"]})}),u.jsxs("div",{style:{marginTop:"0.5rem",opacity:.6},children:["Scanned ",t.totalBudgets," budget(s) and ",t.totalMonths," month(s)."]})]}):u.jsxs("div",{style:{fontSize:"0.85rem"},children:[" All start balances are up to date.",u.jsxs("div",{style:{marginTop:"0.25rem",opacity:.6},children:["Scanned ",t.totalBudgets," budget(s) and ",t.totalMonths," month(s)."]})]}):u.jsx("div",{style:{fontSize:"0.85rem",opacity:.7},children:"Click check to scan for months needing recalculation."});return u.jsx(Go,{name:"Recalculate Start Balances",description:"Recalculates and saves start_balance for all months from the first month up to the earliest month in the window",status:p(),statusText:g(),onCheck:d,isChecking:i,onRun:h,isRunning:o,actionText:n?`Recalculate ${r}`:void 0,disabled:f,itemCount:n?r:void 0,details:b(),isDestructive:!0})}function $B({status:t,hasData:e,needsMigration:n,totalItemsToFix:r,isChecking:i,isRunning:o,result:l,onCheck:d,onRun:h,disabled:f}){const p=()=>o?"running":e?l&&l.errors.length===0?"complete":l&&l.errors.length>0?"error":n?"needs-action":"clean":"unknown",g=()=>{if(l&&l.errors.length===0){const _=l.monthsAdded+l.orphanedEntriesRemoved;return _>0?`Fixed ${_} issue(s)`:"Complete"}},b=()=>l?u.jsxs("div",{style:{fontSize:"0.85rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem",fontWeight:500},children:l.errors.length>0?" Completed with errors":" Repair complete"}),u.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[l.budgetsProcessed>0&&u.jsxs("li",{children:[l.budgetsProcessed," budget(s) processed"]}),l.budgetsUpdated>0&&u.jsxs("li",{children:[l.budgetsUpdated," budget(s) updated"]}),l.monthsAdded>0&&u.jsxs("li",{children:[l.monthsAdded," month(s) added to month_map"]}),l.orphanedEntriesRemoved>0&&u.jsxs("li",{children:[l.orphanedEntriesRemoved," orphaned entry(ies) removed"]}),l.monthsAdded===0&&l.orphanedEntriesRemoved===0&&u.jsx("li",{children:"No changes needed"})]}),l.errors.length>0&&u.jsxs("div",{style:{marginTop:"0.5rem",color:"#ef4444"},children:[u.jsxs("div",{children:["Errors (",l.errors.length,"):"]}),u.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1.25rem"},children:[l.errors.slice(0,3).map((_,w)=>u.jsx("li",{children:_},w)),l.errors.length>3&&u.jsxs("li",{children:["...and ",l.errors.length-3," more"]})]})]})]}):e?n?u.jsxs("div",{style:{fontSize:"0.85rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem",color:"#fbbf24"},children:"Month_map issues found:"}),u.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[t.totalMissingMonths>0&&u.jsxs("li",{children:[t.totalMissingMonths," month(s) missing from month_map"]}),t.totalOrphanedEntries>0&&u.jsxs("li",{children:[t.totalOrphanedEntries," orphaned entry(ies) in month_map"]}),t.budgetsNeedingRepair>0&&u.jsxs("li",{children:[t.budgetsNeedingRepair," budget(s) need repair"]})]}),u.jsxs("div",{style:{marginTop:"0.5rem",opacity:.6},children:["Scanned ",t.totalBudgets," budget(s) and ",t.totalMonths," month(s)."]})]}):u.jsxs("div",{style:{fontSize:"0.85rem"},children:[" All month_map entries are up to date.",u.jsxs("div",{style:{marginTop:"0.25rem",opacity:.6},children:["Scanned ",t.totalBudgets," budget(s) and ",t.totalMonths," month(s)."]})]}):u.jsx("div",{style:{fontSize:"0.85rem",opacity:.7},children:"Click check to scan for month_map issues."});return u.jsx(Go,{name:"Repair Month Map",description:"Updates month_map for all budgets by adding missing months and removing orphaned entries",status:p(),statusText:g(),onCheck:d,isChecking:i,onRun:h,isRunning:o,actionText:n?`Repair ${r}`:void 0,disabled:f,itemCount:n?r:void 0,details:b(),isDestructive:!0})}function qB({disabled:t,onDownloadBackup:e,isDownloadingBackup:n,accountCategoryValidation:r,orphanedIdCleanup:i,expenseToAdjustment:o,adjustmentsToTransfers:l,precisionCleanup:d,recalculateStartBalances:h,repairMonthMap:f}){const p=r.isScanning||i.isScanning||o.isScanning||l.isScanning||d.isScanning||h.isScanning||f.isScanning,g=i.isRunning||o.isRunning||l.isRunning||d.isRunning||h.isRunning||f.isRunning,b=async()=>{await Promise.all([r.scan(),i.scanStatus(),o.scanStatus(),l.scanStatus(),d.scan(),h.scanStatus(),f.scanStatus()])},_=_i({migrationName:"Orphaned ID Cleanup",isDestructive:!0,onDownloadBackup:e}),w=_i({migrationName:"Expense to Adjustment Migration",isDestructive:!0,onDownloadBackup:e}),x=_i({migrationName:"Adjustments to Transfers Migration",isDestructive:!0,onDownloadBackup:e}),S=_i({migrationName:"Currency Precision Cleanup",isDestructive:!0,onDownloadBackup:e}),C=_i({migrationName:"Recalculate Start Balances Migration",isDestructive:!0,onDownloadBackup:e}),T=_i({migrationName:"Repair Month Map Migration",isDestructive:!0,onDownloadBackup:e}),R=r.hasViolations||i.hasItemsToFix||o.hasItemsToMigrate||l.hasPairsToConvert,D=(r.violationCount||0)+(i.totalOrphaned||0)+(o.totalToMigrate||0)+(l.totalPairs||0);return u.jsxs(u.Fragment,{children:[u.jsxs(J0,{title:"Maintenance",icon:"",description:"Re-runnable database validation scripts. Validate all to see which need resolution.",type:"maintenance",onValidateAll:b,isValidating:p,isAnyRunning:g,children:[u.jsx(UB,{accountCategoryValidation:r,orphanedIdCleanup:i,expenseToAdjustment:o,adjustmentsToTransfers:l,needsAction:R,totalIssues:D,isScanning:r.isScanning||i.isScanning||o.isScanning||l.isScanning,isRunning:i.isRunning||o.isRunning||l.isRunning,disabled:t,onRunOrphaned:()=>_.promptBeforeAction(i.runMigration),onRunExpense:()=>w.promptBeforeAction(o.runMigration),onRunTransfers:()=>x.promptBeforeAction(l.runMigration)}),u.jsx(FB,{status:d.status,hasData:d.hasData,hasIssues:d.hasIssues,totalIssues:d.totalIssues,isChecking:d.isScanning,isRunning:d.isRunning,result:d.result,onCheck:d.scan,onRun:()=>S.promptBeforeAction(d.runCleanup),disabled:t}),u.jsx(VB,{status:h.status,hasData:h.hasData,needsMigration:h.needsMigration,totalItemsToFix:h.totalItemsToFix,isChecking:h.isScanning,isRunning:h.isRunning,result:h.result,onCheck:h.scanStatus,onRun:()=>C.promptBeforeAction(h.runMigration),disabled:t}),u.jsx($B,{status:f.status,hasData:f.hasData,needsMigration:f.needsMigration,totalItemsToFix:f.totalItemsToFix,isChecking:f.isScanning,isRunning:f.isRunning,result:f.result,onCheck:f.scanStatus,onRun:()=>T.promptBeforeAction(f.runMigration),disabled:t})]}),u.jsx(yi,{..._.promptProps,isDownloading:n}),u.jsx(yi,{...w.promptProps,isDownloading:n}),u.jsx(yi,{...x.promptProps,isDownloading:n}),u.jsx(yi,{...S.promptProps,isDownloading:n}),u.jsx(yi,{...C.promptProps,isDownloading:n}),u.jsx(yi,{...T.promptProps,isDownloading:n})]})}function HB({isDownloading:t,downloadProgress:e,downloadError:n,onDownload:r,isScanning:i,isUploading:o,uploadStatus:l,uploadProgress:d,uploadError:h,uploadResult:f,onScan:p,onUpload:g,disabled:b}){const _=j.useRef(null),[w,x]=j.useState(null),[S,C]=j.useState(!1),T=async q=>{const I=q.target.files?.[0];I&&(x(I),await p(I))},R=l!==null,D=R&&(l.budgetsFound>0||l.monthsFound>0),V=b||t||i||o,$=f?.success?"#22c55e":D?"#f59e0b":R?"#22c55e":"#9ca3af",k=f?.success?"":o||i||t?"":D?"":R?"":"",M=f?.success?"Uploaded":o?"Uploading":i?"Scanning":t?"Downloading":D?`${l.budgetsFound} budget(s), ${l.monthsFound} month(s) ready`:R?"Nothing to upload":"Select file",B=t?e?.percentComplete:d?.percentComplete,U=n||h;return u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"8px",margin:"0.25rem 0",overflow:"hidden"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"0.75rem 1rem",gap:"1rem"},children:[u.jsx("div",{style:{width:"28px",height:"28px",borderRadius:"50%",background:`color-mix(in srgb, ${$} 20%, transparent)`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.85rem",flexShrink:0},children:o||i||t?u.jsx($n,{noMargin:!0}):k}),u.jsxs("div",{style:{flex:1,minWidth:0},children:[u.jsx("div",{style:{fontWeight:500,fontSize:"0.95rem",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:" Budget Backup & Restore"}),u.jsx("div",{style:{fontSize:"0.8rem",opacity:.6,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:"Download selected budget as zip or restore from zip file"})]}),u.jsx("div",{style:{color:$,fontSize:"0.8rem",fontWeight:500,flexShrink:0},children:M}),u.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:[u.jsx("button",{onClick:()=>{r()},disabled:V,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",padding:"0.35rem 0.6rem",borderRadius:"4px",cursor:V?"not-allowed":"pointer",fontSize:"0.8rem",opacity:V?.5:1,display:"flex",alignItems:"center",gap:"0.25rem"},title:"Download all budgets as zip",children:t?u.jsx($n,{noMargin:!0}):""}),u.jsx("input",{ref:_,type:"file",accept:".zip",onChange:T,style:{display:"none"}}),u.jsx("button",{onClick:()=>_.current?.click(),disabled:V,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",padding:"0.35rem 0.6rem",borderRadius:"4px",cursor:V?"not-allowed":"pointer",fontSize:"0.8rem",opacity:V?.5:1,display:"flex",alignItems:"center",gap:"0.25rem"},title:"Select zip file to restore",children:i?u.jsx($n,{noMargin:!0}):""}),D&&w&&u.jsx("button",{onClick:async()=>{await g(w)},disabled:V,style:{background:"#646cff",color:"white",border:"none",padding:"0.35rem 0.75rem",borderRadius:"4px",cursor:V?"not-allowed":"pointer",fontSize:"0.8rem",fontWeight:500,opacity:V?.6:1,display:"flex",alignItems:"center",gap:"0.25rem"},children:o?u.jsx($n,{noMargin:!0}):"Upload"}),(R||f||U)&&u.jsx("button",{onClick:()=>C(!S),style:{background:"transparent",color:"inherit",border:"none",padding:"0.35rem",borderRadius:"4px",cursor:"pointer",fontSize:"0.9rem",opacity:.6},title:S?"Collapse":"Expand",children:S?"":""})]})]}),(t||o)&&B!==void 0&&u.jsxs("div",{style:{padding:"0 1rem 0.5rem 1rem"},children:[u.jsx("div",{style:{width:"100%",height:"4px",background:"color-mix(in srgb, currentColor 10%, transparent)",borderRadius:"2px",overflow:"hidden"},children:u.jsx("div",{style:{width:`${B}%`,height:"100%",background:"#646cff",transition:"width 0.3s ease"}})}),u.jsxs("div",{style:{fontSize:"0.75rem",opacity:.6,marginTop:"0.25rem",textAlign:"center"},children:[t?e?.phase:d?.phase,": ",B,"%"]})]}),S&&(R||f||U)&&u.jsxs("div",{style:{borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)",padding:"1rem",background:"color-mix(in srgb, currentColor 2%, transparent)",fontSize:"0.85rem"},children:[U&&u.jsxs("div",{style:{marginBottom:"0.75rem",color:"#ef4444"},children:[" Error: ",U]}),f&&u.jsx("div",{style:{marginBottom:l?"0.75rem":0,color:f.success?"#22c55e":"#ef4444"},children:f.success?u.jsxs(u.Fragment,{children:[" Restored ",f.budgetsRestored," budget(s), ",f.monthsRestored," month(s), ",f.payeesRestored," payee doc(s)"]}):u.jsxs(u.Fragment,{children:[" Upload failed: ",f.errors.join(", ")]})}),l&&u.jsxs(u.Fragment,{children:[u.jsxs("div",{style:{marginBottom:"0.25rem"},children:[u.jsx("strong",{children:"Found in zip:"})," ",l.budgetsFound," budget(s), ",l.monthsFound," month(s), ",l.payeesFound," payee doc(s)"]}),l.budgetsToRestore.length>0&&u.jsxs("div",{children:[u.jsx("strong",{children:"Budgets to restore:"})," ",l.budgetsToRestore.join(", ")]})]})]})]})}function GB({hasData:t,monthsCount:e,budgetCount:n,isChecking:r,isDeleting:i,deleteResult:o,onCheck:l,onDelete:d,disabled:h}){const[f,p]=j.useState(!1),g=()=>i?"running":t?o&&o.errors.length===0?"complete":e===0?"clean":"needs-action":"unknown",b=()=>o&&o.errors.length===0?`Deleted ${o.deleted}`:e===0?"No months":`${e} months`,_=()=>{p(!0)},w=()=>{p(!1),d()},x=()=>o?u.jsxs("div",{style:{fontSize:"0.85rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem",fontWeight:500},children:o.errors.length>0?" Completed with errors":" Deletion complete"}),u.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[u.jsxs("li",{children:[o.deleted," month(s) deleted"]}),o.budgetsRecalculated>0&&u.jsxs("li",{children:[o.budgetsRecalculated," budget(s) reset"]})]}),o.errors.length>0&&u.jsxs("div",{style:{marginTop:"0.5rem",color:"#ef4444"},children:[u.jsxs("div",{children:["Errors (",o.errors.length,"):"]}),u.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1.25rem"},children:[o.errors.slice(0,3).map((S,C)=>u.jsx("li",{children:S},C)),o.errors.length>3&&u.jsxs("li",{children:["...and ",o.errors.length-3," more"]})]})]})]}):t?e===0?u.jsx("div",{style:{fontSize:"0.85rem"},children:" No month documents found in Firebase."}):u.jsxs("div",{style:{fontSize:"0.85rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem",color:"#ef4444"},children:" DESTRUCTIVE ACTION"}),u.jsxs("div",{children:["Found ",e," month(s) across ",n," budget(s)."]}),u.jsx("div",{style:{marginTop:"0.5rem",opacity:.7},children:"This will permanently delete ALL month documents and reset all budgets."})]}):u.jsx("div",{style:{fontSize:"0.85rem",opacity:.7},children:"Click check to scan for months."});return u.jsxs(u.Fragment,{children:[u.jsx(Go,{name:"Delete ALL Months",description:"DESTRUCTIVE: Deletes all month documents from all budgets",status:g(),statusText:b(),onCheck:l,isChecking:r,onRun:e>0?_:void 0,isRunning:i,actionText:"Delete",disabled:h,itemCount:e>0?e:void 0,details:x(),isDestructive:!0}),u.jsxs(Qs,{isOpen:f,onClose:()=>p(!1),title:" Delete All Months?",children:[u.jsx("div",{style:{background:"color-mix(in srgb, #ef4444 15%, transparent)",border:"1px solid color-mix(in srgb, #ef4444 40%, transparent)",borderRadius:"8px",padding:"1rem",marginBottom:"1rem"},children:u.jsx("p",{style:{margin:0,color:"#fca5a5",fontWeight:500,fontSize:"0.95rem"},children:" This is a destructive operation that cannot be undone!"})}),u.jsxs("p",{style:{margin:"0 0 0.75rem",opacity:.9},children:["This will permanently delete ",u.jsxs("strong",{style:{color:"#ef4444"},children:[e," month(s)"]})," across"," ",u.jsxs("strong",{style:{color:"#ef4444"},children:[n," budget(s)"]}),"."]}),u.jsxs("ul",{style:{margin:"0 0 1.5rem",paddingLeft:"1.5rem",opacity:.8,fontSize:"0.9rem"},children:[u.jsx("li",{children:"All account balances  $0"}),u.jsx("li",{children:"All category balances  $0"}),u.jsx("li",{children:"Month history cleared"})]}),u.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[u.jsx($e,{variant:"secondary",actionName:"Cancel Delete All Months",onClick:()=>p(!1),children:"Cancel"}),u.jsxs($e,{variant:"danger",actionName:"Confirm Delete All Months",onClick:w,children:[" Delete All ",e," Months"]})]})]})]})}function WB({status:t,hasData:e,totalBudgets:n,totalMonths:r,isChecking:i,isDeleting:o,deleteResult:l,onCheck:d,onDelete:h,disabled:f}){const[p,g]=j.useState(!1),b=t?.staleBudgetIds??[],_=b.length>0,w=()=>o?"running":e?l&&l.errors.length===0?"complete":n===0&&!_?"clean":"needs-action":"unknown",x=()=>l&&l.errors.length===0?`Deleted ${l.budgetsDeleted}`:n===0&&!_?"Clean":_?`${b.length} stale ref(s)`:`${n} budget(s)`,S=()=>{g(!0)},C=()=>{g(!1),h()},T=()=>l?u.jsxs("div",{style:{fontSize:"0.85rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem",fontWeight:500},children:l.errors.length>0?" Completed with errors":" Deletion complete"}),u.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[l.budgetsDeleted>0&&u.jsxs("li",{children:[l.budgetsDeleted," budget(s) deleted"]}),l.monthsDeleted>0&&u.jsxs("li",{children:[l.monthsDeleted," month(s) deleted"]}),l.payeesDeleted>0&&u.jsxs("li",{children:[l.payeesDeleted," payee doc(s) deleted"]})]}),l.errors.length>0&&u.jsxs("div",{style:{marginTop:"0.5rem",color:"#ef4444"},children:[u.jsxs("div",{children:["Errors (",l.errors.length,"):"]}),u.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1.25rem"},children:[l.errors.slice(0,3).map((D,V)=>u.jsx("li",{children:D},V)),l.errors.length>3&&u.jsxs("li",{children:["...and ",l.errors.length-3," more"]})]})]})]}):e?n===0&&!_?u.jsx("div",{style:{fontSize:"0.85rem"},children:' No budget found for sample@sample.com  user is in "new user" state.'}):_?u.jsxs("div",{style:{fontSize:"0.85rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem",color:"#f59e0b"},children:" Found stale budget references:"}),u.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[b.slice(0,3).map(D=>u.jsx("li",{style:{opacity:.8},children:D},D)),b.length>3&&u.jsxs("li",{style:{opacity:.6},children:["...and ",b.length-3," more"]})]})]}):u.jsxs("div",{style:{fontSize:"0.85rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem",color:"#f59e0b"},children:" Sample user budget found:"}),u.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[u.jsxs("li",{children:[n," budget(s)"]}),u.jsxs("li",{children:[r," month(s)"]})]}),u.jsx("div",{style:{marginTop:"0.5rem",opacity:.7},children:"Deleting will reset sample@sample.com to a new user state."})]}):u.jsx("div",{style:{fontSize:"0.85rem",opacity:.7},children:"Click check to scan for sample user budget."}),R=n>0||_;return u.jsxs(u.Fragment,{children:[u.jsx(Go,{name:"Delete Sample User Budget",description:"Reset sample@sample.com to new user state",status:w(),statusText:x(),onCheck:d,isChecking:i,onRun:R?S:void 0,isRunning:o,actionText:"Delete",disabled:f,itemCount:R?n||b.length:void 0,details:T(),isDestructive:!0}),u.jsxs(Qs,{isOpen:p,onClose:()=>g(!1),title:" Delete Sample User Budget?",children:[u.jsx("div",{style:{background:"color-mix(in srgb, #f59e0b 15%, transparent)",border:"1px solid color-mix(in srgb, #f59e0b 40%, transparent)",borderRadius:"8px",padding:"1rem",marginBottom:"1rem"},children:u.jsx("p",{style:{margin:0,color:"#fcd34d",fontWeight:500,fontSize:"0.95rem"},children:" This will delete all data for sample@sample.com!"})}),n>0&&u.jsxs("p",{style:{margin:"0 0 0.75rem",opacity:.9},children:["This will permanently delete ",u.jsxs("strong",{style:{color:"#f59e0b"},children:[n," budget(s)"]})," and"," ",u.jsxs("strong",{style:{color:"#f59e0b"},children:[r," month(s)"]}),"."]}),_&&u.jsxs("p",{style:{margin:"0 0 0.75rem",opacity:.9},children:["This will remove ",u.jsxs("strong",{style:{color:"#f59e0b"},children:[b.length," stale reference(s)"]})," from the user document."]}),u.jsxs("ul",{style:{margin:"0 0 1.5rem",paddingLeft:"1.5rem",opacity:.8,fontSize:"0.9rem"},children:[u.jsx("li",{children:"Budget document deleted"}),u.jsx("li",{children:"All month documents deleted"}),u.jsx("li",{children:"Payees document deleted"}),u.jsx("li",{children:"User will see onboarding flow"})]}),u.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[u.jsx($e,{variant:"secondary",actionName:"Cancel Delete Sample User Budget",onClick:()=>g(!1),children:"Cancel"}),u.jsx($e,{variant:"danger",actionName:"Confirm Delete Sample User Budget",onClick:C,children:" Delete Sample User Data"})]})]})]})}function QB({onClearCache:t,disabled:e}){const[n,r]=j.useState(!1),i=()=>{r(!0)},o=()=>{r(!1),t()};return u.jsxs(u.Fragment,{children:[u.jsx(RB,{name:"Clear All Caches",description:"Clear cached data and reload to fetch fresh data from Firestore",onAction:i,actionText:"Clear & Reload",actionIcon:"",disabled:e,isDestructive:!0}),u.jsxs(Qs,{isOpen:n,onClose:()=>r(!1),title:"Clear Caches & Reload?",children:[u.jsx("p",{style:{margin:"0 0 1rem 0",opacity:.8},children:"This will clear all cached data and reload the page. The app will fetch fresh data from Firestore for everything."}),u.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[u.jsx($e,{variant:"secondary",actionName:"Cancel Clear Caches",onClick:()=>r(!1),children:"Cancel"}),u.jsx($e,{variant:"danger",actionName:"Confirm Clear Caches & Reload",onClick:o,children:"Clear & Reload"})]})]})]})}function KB({disabled:t,onDownloadBackup:e,isDownloadingBackup:n,budgetDownloadUpload:r,deleteAllMonths:i,deleteSampleUserBudget:o,onClearCache:l}){const d=r.isDownloading||r.isUploading||i.isDeleting||o.isDeleting,h=_i({migrationName:"Delete All Months",isDestructive:!0,onDownloadBackup:e}),f=_i({migrationName:"Delete Sample User Budget",isDestructive:!0,onDownloadBackup:e}),p=_i({migrationName:"Upload Budget",isDestructive:!0,onDownloadBackup:e});return u.jsxs(u.Fragment,{children:[u.jsxs(J0,{title:"Utilities",icon:"",description:"Administrative utilities for data management, downloads, and cache control.",type:"utility",isAnyRunning:d,children:[u.jsx(HB,{isDownloading:r.isDownloading,downloadProgress:r.downloadProgress,downloadError:r.downloadError,onDownload:r.downloadBudget,isScanning:r.isScanning,isUploading:r.isUploading,uploadStatus:r.uploadStatus,uploadProgress:r.uploadProgress,uploadError:r.uploadError,uploadResult:r.uploadResult,onScan:r.scanZipFile,onUpload:async g=>{p.promptBeforeAction(()=>{r.uploadBudget(g).catch(b=>console.error("Upload failed:",b))})},disabled:t}),u.jsxs("div",{style:{marginTop:"0.75rem",paddingTop:"0.75rem",borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},children:[u.jsx("div",{style:{fontSize:"0.75rem",opacity:.5,textTransform:"uppercase",letterSpacing:"0.05em",marginBottom:"0.5rem",paddingLeft:"0.5rem"},children:"Destructive Actions"}),u.jsx(GB,{status:i.status,hasData:i.hasData,monthsCount:i.monthsCount,budgetCount:i.budgetCount,isChecking:i.isScanning,isDeleting:i.isDeleting,deleteResult:i.deleteResult,deleteProgress:i.deleteProgress,onCheck:i.scanStatus,onDelete:()=>h.promptBeforeAction(i.deleteAllMonths),disabled:t}),u.jsx(WB,{status:o.status,hasData:o.hasData,totalBudgets:o.totalBudgets,totalMonths:o.totalMonths,isChecking:o.isScanning,isDeleting:o.isDeleting,deleteResult:o.deleteResult,deleteProgress:o.deleteProgress,onCheck:o.scanStatus,onDelete:()=>f.promptBeforeAction(o.deleteSampleUserBudget),disabled:t}),u.jsx(QB,{onClearCache:l,disabled:t})]})]}),u.jsx(yi,{...h.promptProps,isDownloading:n}),u.jsx(yi,{...f.promptProps,isDownloading:n}),u.jsx(yi,{...p.promptProps,isDownloading:n})]})}function YB({message:t="Loading...",spinnerColor:e=ge.primary,children:n,spinnerSize:r=4}){return u.jsxs("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(15, 15, 20, 0.95)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",zIndex:9999,gap:"1.5rem",backdropFilter:"blur(4px)"},children:[u.jsx("div",{style:{width:`${r}rem`,height:`${r}rem`,border:"3px solid rgba(255, 255, 255, 0.15)",borderTopColor:e,borderRadius:"50%",animation:"loadingOverlaySpin 0.8s linear infinite"}}),u.jsx("p",{style:{color:"rgba(255, 255, 255, 0.95)",fontSize:"1.2rem",fontWeight:600,letterSpacing:"0.02em",margin:0},children:t}),n,u.jsx("style",{children:`
        @keyframes loadingOverlaySpin {
          to { transform: rotate(360deg); }
        }
      `})]})}function XB(){return u.jsxs("div",{style:Pf,children:[u.jsx("nav",{style:{marginBottom:"1rem",display:"flex",alignItems:"center"},children:u.jsx(Tn,{to:"/",style:{display:"flex",alignItems:"center"},title:"Tarron Lane Home",children:u.jsx("img",{src:"/t-icon.svg",alt:"Tarron Lane Home",style:{width:"2rem",height:"2rem"}})})}),u.jsx("h1",{children:"Tarron Lane Homepage"}),u.jsx("nav",{children:u.jsxs("ul",{children:[u.jsx("li",{children:u.jsx(Tn,{to:"/sql-test",children:"SQL Test"})}),u.jsx("li",{children:u.jsx(Tn,{to:"/budget",children:"Budget"})}),u.jsx("li",{children:u.jsx(Tn,{to:"/account",children:"Account"})})]})})]})}function ZB(){const t=j.useContext(_d),e=ki(),[n,r]=j.useState(!1),i=tr(),o=Xu(),l=i.state?.from||"/";j.useEffect(()=>{t.is_logged_in&&l!=="/"&&o(l,{replace:!0})},[t.is_logged_in,l,o]);function d(){r(!0),e.logout_firebase_user().then(function(){Pe.clear(),window.location.href="/"})}return u.jsxs("div",{style:Pf,children:[u.jsxs("nav",{style:{marginBottom:"1rem",display:"grid",gridTemplateColumns:"1fr auto 1fr",alignItems:"center"},children:[u.jsx("div",{style:{display:"flex",alignItems:"center"},children:u.jsx(Tn,{to:"/",style:{opacity:.6,fontSize:"1.5rem",textDecoration:"none",padding:"0.25rem 0.5rem"},title:"Back to Home",children:""})}),u.jsxs(Tn,{to:"/",style:{display:"flex",alignItems:"center",gap:"0.5rem",textDecoration:"none",color:"inherit"},title:"Tarron Lane Home",children:[u.jsx("img",{src:"/t-icon.svg",alt:"Tarron Lane",style:{width:"1.5rem",height:"1.5rem"}}),u.jsx("span",{style:{fontWeight:600,fontSize:"1.1rem"},children:"Account"})]}),u.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:u.jsx(oA,{items:[{label:"Budget",icon:"",to:"/budget"},{label:"Account",icon:"",to:"/account"}]})})]}),u.jsx("h1",{children:"Account"}),t.is_logged_in?n?u.jsx("p",{children:"Logging Out..."}):u.jsxs(u.Fragment,{children:[u.jsxs("p",{children:["You are logged in as ",t.username]}),u.jsx("button",{onClick:d,style:{marginTop:"1rem"},children:"Logout"})]}):u.jsx(JB,{})]})}function JB(){const t=ki(),[e,n]=j.useState(""),[r,i]=j.useState(""),[o,l]=j.useState(!1),[d,h]=j.useState(!1),[f,p]=j.useState("");function g(w){n(w.target.value)}function b(w){i(w.target.value)}function _(w){w.preventDefault(),h(!0),p(""),Pe.clear(),t.login_firebase_user(e,r).then(function(){}).catch(function(){p("Incorrect login credentials")}).finally(function(){h(!1)})}return u.jsxs("form",{onSubmit:_,children:[u.jsxs("div",{children:[u.jsx("label",{htmlFor:"username",children:"Email: "}),u.jsx("input",{id:"username",type:"email",value:e,onChange:g})]}),u.jsxs("div",{children:[u.jsx("label",{htmlFor:"password",children:"Password: "}),u.jsxs("div",{style:{display:"inline-flex",alignItems:"center",position:"relative"},children:[u.jsx("input",{id:"password",type:o?"text":"password",value:r,onChange:b,style:{paddingRight:"2rem"}}),u.jsx("button",{type:"button",onClick:()=>l(!o),style:{position:"absolute",right:"0.25rem",background:"none",border:"none",cursor:"pointer",padding:"0.25rem",opacity:.6,fontSize:"1rem"},title:o?"Hide password":"Show password",children:o?"":""})]})]}),d?u.jsx("p",{children:"Logging in..."}):u.jsx("button",{children:"Login"}),f&&u.jsx("p",{style:{color:"red"},children:f})]})}const ez={categories:"balances",accounts:"balances",income:"transactions",spend:"transactions",transfers:"transactions",adjustments:"transactions"},tz={balances:"categories",transactions:"income"};function nz({activeTab:t,setActiveTab:e,allocationsFinalized:n}){const r=ez[t],i=j.useMemo(()=>[{id:"balances",label:"Balances"},{id:"transactions",label:"Transactions"}],[]),o=j.useMemo(()=>[{id:"categories",label:"Categories",checkmark:n},{id:"accounts",label:"Accounts"}],[n]),l=j.useMemo(()=>[{id:"income",label:"Income"},{id:"spend",label:"Spend"},{id:"transfers",label:"Transfers"},{id:"adjustments",label:"Adjustments"}],[]),d=f=>{e(tz[f])},h=r==="balances"?o:l;return u.jsxs("div",{children:[u.jsx(Lf,{mode:"button",tabs:i,activeTab:r,onTabChange:d,variant:"segmented"}),u.jsx(Lf,{mode:"button",tabs:h,activeTab:t,onTabChange:f=>e(f),variant:"secondary"})]})}function HS({direction:t,isDisabled:e,isLoading:n,disabledReason:r,onNavigate:i}){const[o,l]=j.useState(!1),d=n||e,h=t==="prev"?"":"",f=t==="prev"?"Previous month":"Next month",p=()=>{n||(e?(l(!0),setTimeout(()=>l(!1),2e3)):i())};return u.jsxs("div",{style:{position:"relative"},children:[u.jsx("button",{onClick:p,onMouseEnter:()=>e&&l(!0),onMouseLeave:()=>l(!1),style:{background:"color-mix(in srgb, currentColor 10%, transparent)",border:"none",borderRadius:"8px",padding:"0.75rem 1rem",cursor:d?"not-allowed":"pointer",fontSize:"1.25rem",opacity:d?.5:1,transition:"opacity 0.15s, background 0.15s"},title:e?void 0:f,children:h}),o&&e&&r&&u.jsx("div",{style:{position:"absolute",top:"100%",...t==="prev"?{left:0}:{right:0},marginTop:"0.5rem",padding:"0.5rem 0.75rem",background:ge.warning,color:"#000",borderRadius:"6px",fontSize:"0.75rem",fontWeight:500,width:"max-content",maxWidth:"min(300px, 50vw)",textAlign:"center",zIndex:20,boxShadow:"0 2px 8px rgba(0,0,0,0.3)"},children:r})]})}function rz({pickerYear:t,pickerMonth:e,currentYear:n,currentMonthNumber:r,minOrdinal:i,maxOrdinal:o,minAllowed:l,maxAllowed:d,monthMap:h,onYearChange:f,onMonthChange:p,onGo:g}){const b=t>l.year,_=t<d.year,w=Number(qe(t,e)),x=h?qe(t,e)in h:!1,S=w<=o,C=(x||S)&&w>=i;return u.jsxs("div",{style:{padding:"0.75rem",borderTop:"1px solid color-mix(in srgb, currentColor 15%, transparent)",marginTop:"0.25rem"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.5rem"},children:[u.jsx("button",{onClick:()=>f(t-1),disabled:!b,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",border:"none",borderRadius:"4px",padding:"0.25rem 0.5rem",cursor:b?"pointer":"not-allowed",fontSize:"0.8rem",opacity:b?1:.3},title:b?"Previous year":"Cannot go further back",children:""}),u.jsx("span",{style:{flex:1,textAlign:"center",fontSize:"0.9rem",fontWeight:500},children:t}),u.jsx("button",{onClick:()=>f(t+1),disabled:!_,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",border:"none",borderRadius:"4px",padding:"0.25rem 0.5rem",cursor:_?"pointer":"not-allowed",fontSize:"0.8rem",opacity:_?1:.3},title:_?"Next year":"Cannot go further ahead",children:""})]}),u.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"0.25rem",marginBottom:"0.5rem"},children:Nf.map((T,R)=>{const D=R+1,V=D===e,$=t===n&&D===r,k=Number(qe(t,D)),M=qe(t,D),B=k<i,U=k>o,q=k<Number(qe(n,r)),I=h?M in h:!1,N=B||U||q&&!I;let O=T;return B?O="Too far in the past":U?O="Too far in the future":q&&!I&&(O="Month not in budget"),u.jsx("button",{onClick:()=>p(D),disabled:N,style:{background:V?ge.primary:"color-mix(in srgb, currentColor 8%, transparent)",border:$?`1px solid ${ge.primary}`:"1px solid transparent",borderRadius:"4px",padding:"0.35rem 0.25rem",cursor:N?"not-allowed":"pointer",fontSize:"0.7rem",color:V?"#fff":"inherit",opacity:N?.3:1,transition:"background 0.15s"},title:O,children:T.slice(0,3)},D)})}),u.jsxs("button",{onClick:g,disabled:!C,style:{width:"100%",background:C?ge.primary:"color-mix(in srgb, currentColor 20%, transparent)",border:"none",borderRadius:"6px",padding:"0.5rem",cursor:C?"pointer":"not-allowed",fontSize:"0.85rem",color:C?"#fff":"inherit",fontWeight:500,opacity:C?1:.5},children:["Go to ",Nf[e-1]," ",t]})]})}function sz({isOpen:t,onClose:e,year:n,month:r,isDeleting:i,onConfirm:o}){return u.jsxs(Qs,{isOpen:t,onClose:e,title:" Delete Month?",children:[u.jsx("div",{style:{background:"color-mix(in srgb, #ef4444 15%, transparent)",border:"1px solid color-mix(in srgb, #ef4444 40%, transparent)",borderRadius:"8px",padding:"1rem",marginBottom:"1rem"},children:u.jsxs("p",{style:{margin:0,color:"#fca5a5",fontWeight:500,fontSize:"0.95rem"},children:[" This will permanently delete ",Nf[r-1]," ",n,"!"]})}),u.jsx("p",{style:{margin:"0 0 0.75rem",opacity:.9},children:"This month document and all its data (income, expenses, allocations) will be permanently deleted."}),u.jsx("p",{style:{margin:"0 0 1rem",opacity:.8,fontSize:"0.9rem"},children:"After deletion, you will be navigated to the previous month."}),u.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[u.jsx($e,{variant:"secondary",actionName:"Cancel Delete Month",onClick:e,disabled:i,children:"Cancel"}),u.jsx($e,{variant:"danger",actionName:"Confirm Delete Month",onClick:o,disabled:i,children:i?"Deleting...":" Delete Month"})]})]})}function iz(){const t=new Date;let e=t.getFullYear(),n=t.getMonth()+1+Ws;for(;n>12;)n-=12,e+=1;return{year:e,month:n}}function az(){const t=new Date;let e=t.getFullYear(),n=t.getMonth()+1-L0;for(;n<1;)n+=12,e-=1;return{year:e,month:n}}function oz(t){return Object.keys(t).sort()[0]}function lz(t){const e=parseInt(t.slice(0,4),10),n=parseInt(t.slice(4,6),10);return{year:e,month:n}}function cz(t){const e=oz(t);return e?lz(e):az()}function GS(t,e){return e===1?{year:t-1,month:12}:{year:t,month:e-1}}function uz(t,e){return e===12?{year:t+1,month:1}:{year:t,month:e+1}}function dz({onPreviousMonth:t,onNextMonth:e}){const{isLoading:n}=jn(),{currentYear:r,currentMonthNumber:i,isAdmin:o,selectedBudgetId:l,setCurrentYear:d,setCurrentMonthNumber:h}=Ze(),{budget:f,monthMap:p}=On(),{month:g}=Ys(l,r,i),b=GS(r,i),_=uz(r,i),w=iz(),x=Number(qe(w.year,w.month)),C=Number(qe(_.year,_.month))>x,T=qe(b.year,b.month),R=p?T in p:!1,D=!R,V=cz(p||{}),$=Number(qe(V.year,V.month)),[k,M]=j.useState(!1),[B,U]=j.useState(!1),[q,I]=j.useState(r),[N,O]=j.useState(i),[J,Y]=j.useState(!1),[G,Z]=j.useState(!1),Q=j.useRef(null),te=(()=>{if(!p||Object.keys(p).length===0)return!1;const he=qe(r,i),we=Math.max(...Object.keys(p).map(Number));return Number(he)===we})(),{trackChange:z}=pd();async function H(){if(l){Z(!0);try{const he=No(l,r,i);m4(l,r,i,z),await Oy("months",he,`deleting month ${r}/${i}`),`${r}${i}`,Pe.removeQueries({queryKey:Ce.month(l,r,i)});const we=GS(r,i);Y(!1),M(!1),window.location.href=`/budget/${we.year}/${we.month}/categories`}catch(he){console.error("Failed to delete month:",he),alert(`Failed to delete month: ${he instanceof Error?he.message:"Unknown error"}`)}finally{Z(!1)}}}j.useEffect(()=>{if(!k)return;function he(we){Q.current&&!Q.current.contains(we.target)&&(M(!1),U(!1))}return document.addEventListener("mousedown",he),()=>document.removeEventListener("mousedown",he)},[k]);function re(){B||(I(r),O(i)),U(!B)}function ne(){d(q),h(N),U(!1),M(!1)}async function ce(){if(!g||!f)return;const he=new Date,oe=`${he.toISOString().split("T")[0]}_month_${r}_${String(i).padStart(2,"0")}`,be=new jm,Me=[{name:`${oe}_income.json`,data:g.income||[]},{name:`${oe}_expenses.json`,data:g.expenses||[]},{name:`${oe}_transfers.json`,data:g.transfers||[]},{name:`${oe}_adjustments.json`,data:g.adjustments||[]},{name:`${oe}_account_balances.json`,data:g.account_balances||[]},{name:`${oe}_category_balances.json`,data:g.category_balances||[]}],ze={budget_id:f.id,budget_name:f.name,year_month_ordinal:g.year_month_ordinal,year:g.year,month:g.month,total_income:g.total_income,previous_month_income:g.previous_month_income,total_expenses:g.total_expenses,are_allocations_finalized:g.are_allocations_finalized,created_at:g.created_at,updated_at:g.updated_at,downloaded_at:he.toISOString()};Me.push({name:`${oe}_metadata.json`,data:ze});for(const de of Me)be.file(de.name,JSON.stringify(de.data,null,2));const at=await be.generateAsync({type:"blob"}),lt=URL.createObjectURL(at),L=document.createElement("a");L.href=lt,L.download=`${oe}.zip`,document.body.appendChild(L),L.click(),document.body.removeChild(L),URL.revokeObjectURL(lt),M(!1)}return u.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"1rem",marginBottom:"1.5rem",padding:"1rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"12px"},children:[u.jsx(HS,{direction:"prev",isDisabled:D,isLoading:n,disabledReason:R?void 0:"No previous month available in this budget",onNavigate:t}),u.jsxs("div",{ref:Q,style:{textAlign:"center",minWidth:"180px",position:"relative"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"flex-start",justifyContent:"center",gap:"0.25rem"},children:[u.jsxs("h2",{style:{margin:0,fontSize:"1.5rem"},children:[Nf[i-1]," ",r]}),u.jsx("button",{onClick:()=>M(!k),style:{background:"transparent",border:"none",cursor:"pointer",fontSize:"0.5rem",opacity:.4,padding:"0.15rem",borderRadius:"4px",transition:"opacity 0.15s, transform 0.15s",transform:k?"rotate(180deg)":"rotate(0deg)",marginTop:"0.25rem"},title:"Month options",children:""})]}),n&&u.jsxs(u.Fragment,{children:[u.jsx("style",{children:"@keyframes spin { to { transform: rotate(360deg); } }"}),u.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0.4rem",marginTop:"0.35rem"},children:[u.jsx("span",{style:{display:"inline-block",width:"14px",height:"14px",border:"2px solid color-mix(in srgb, currentColor 20%, transparent)",borderTopColor:ge.primary,borderRadius:"50%",animation:"spin 0.8s linear infinite"}}),u.jsx("span",{style:{fontSize:"0.8rem",opacity:.6},children:"Loading..."})]})]}),k&&u.jsxs("div",{style:{position:"absolute",top:"100%",left:"50%",transform:"translateX(-50%)",marginTop:"0.5rem",background:"var(--background, #242424)",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",borderRadius:"8px",padding:"0.25rem",zIndex:100,minWidth:"160px",boxShadow:"0 4px 12px rgba(0,0,0,0.3)"},children:[u.jsx("button",{onClick:re,style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%",background:"transparent",border:"none",borderRadius:"6px",padding:"0.5rem 0.75rem",cursor:"pointer",fontSize:"0.85rem",color:"inherit",textAlign:"left",transition:"background 0.15s"},title:"Jump to a specific month",children:" Go to Month"}),B&&u.jsx(rz,{pickerYear:q,pickerMonth:N,currentYear:r,currentMonthNumber:i,minOrdinal:$,maxOrdinal:x,minAllowed:V,maxAllowed:w,monthMap:p,onYearChange:I,onMonthChange:O,onGo:ne}),o&&g&&u.jsx("button",{onClick:()=>{ce()},style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%",background:"transparent",border:"none",borderRadius:"6px",padding:"0.5rem 0.75rem",cursor:"pointer",fontSize:"0.85rem",color:"inherit",textAlign:"left",transition:"background 0.15s"},title:"Download month document as JSON (for debugging)",children:" Download JSON"}),o&&g&&te&&u.jsx("button",{onClick:()=>Y(!0),style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%",background:"transparent",border:"none",borderRadius:"6px",padding:"0.5rem 0.75rem",cursor:"pointer",fontSize:"0.85rem",color:"#ef4444",textAlign:"left",transition:"background 0.15s"},title:"Delete this month (last month only)",children:" Delete Month"})]})]}),u.jsx(HS,{direction:"next",isDisabled:C,isLoading:n,disabledReason:"Cannot create months more than 3 months into the future",onNavigate:e}),u.jsx(sz,{isOpen:J,onClose:()=>Y(!1),year:r,month:i,isDeleting:G,onConfirm:H})]})}const e_={cursor:"pointer",fontSize:"0.9rem",padding:"0.35rem 0.5rem",borderRadius:"4px"},hz={...e_,background:ge.primary,border:"none",color:"white"},fz={...e_,background:"transparent",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)"},mz={...e_,background:"transparent",border:`1px solid ${ge.errorBorder}`,color:ge.error},WS=t=>({display:"flex",alignItems:"center",justifyContent:"center",width:"2.25rem",height:"100%",minHeight:"2.25rem",background:t?`color-mix(in srgb, ${ge.error} 15%, transparent)`:`color-mix(in srgb, ${ge.success} 15%, transparent)`,border:`1px solid ${t?ge.errorBorder:"rgba(74, 222, 128, 0.4)"}`,borderRadius:"4px 0 0 4px",cursor:"pointer",fontSize:"1rem",fontWeight:600,color:t?ge.error:ge.success,transition:"all 0.15s ease",flexShrink:0});function t_({accounts:t,accountGroups:e,categories:n,categoryGroups:r,payees:i,initialData:o,defaultAccountId:l,defaultDate:d,config:h,onSubmit:f,onCancel:p,onDelete:g,extraContent:b}){const{isWide:_}=HT(),{showCategory:w=!1,showCleared:x=!1,showSignToggle:S=!1,accountLabel:C="Account",payeePlaceholder:T="Payee name",descriptionPlaceholder:R="Optional note",submitLabel:D}=h,V=new Date().toISOString().split("T")[0],[$,k]=j.useState(o?.date||d||V),[M,B]=j.useState(o?.payee||""),[U,q]=j.useState(o?.categoryId||(h.showNoCategoryOption?Yt:"")),[I,N]=j.useState(o?.accountId||l||(h.showNoAccountOption?Ht:t[0]?t[0][0]:"")),O=o?.amount!==void 0?Math.abs(o.amount):void 0,[J,Y]=j.useState(O?.toString()||""),[G,Z]=j.useState(o?.description||""),[Q,te]=j.useState(o?.cleared||!1),[z,H]=j.useState(()=>S?o?.amount!==void 0?o.amount<0:!1:!0),[re,ne]=j.useState(!1),ce={},he=[];t.forEach(([Se,ie])=>{ie.account_group_id?(ce[ie.account_group_id]||(ce[ie.account_group_id]=[]),ce[ie.account_group_id].push([Se,ie])):he.push([Se,ie])});function we(Se){Se.preventDefault();const ie=parseFloat(J);if(isNaN(ie)||ie<=0||w&&!U||!I||!$)return;if(U===Yt&&I===Ht){ne(!0);return}ne(!1);const Oe=S&&z?-ie:ie;f({date:$,payee:M.trim()||void 0,categoryId:w?U:void 0,accountId:I,amount:Oe,description:G.trim()||void 0,cleared:x?Q:void 0})}!(U===Yt&&I===Ht)&&re&&ne(!1);const ze=h.showNoAccountOption?u.jsx(qT,{id:"txn-account",value:I,onChange:N,accounts:t,accountGroups:e,placeholder:Ba,required:!0,showNoAccountOption:!0}):u.jsxs(Qu,{id:"txn-account",value:I,onChange:Se=>N(Se.target.value),required:!0,style:{fontSize:"0.85rem",padding:"0.5rem"},children:[Object.entries(e).map(([Se,ie])=>{const Re=ce[Se];return Re?.length?u.jsx("optgroup",{label:ie.name,children:Re.map(([Ne,Oe])=>u.jsx("option",{value:Ne,children:Oe.nickname},Ne))},Se):null}),he.length>0&&u.jsx("optgroup",{label:"Other",children:he.map(([Se,ie])=>u.jsx("option",{value:Se,children:ie.nickname},Se))})]}),at=w&&n&&r?u.jsx(Nt,{label:"Category",htmlFor:"txn-category",children:u.jsx($T,{id:"txn-category",value:U,onChange:q,categories:n,categoryGroups:r,placeholder:h.showNoCategoryOption?Po:"Search...",required:!0,showNoCategoryOption:h.showNoCategoryOption})}):null,lt=x?u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.25rem",paddingBottom:"0.35rem"},children:[u.jsx("label",{htmlFor:"txn-cleared",style:{fontSize:"0.75rem",opacity:.7,fontWeight:500},children:"Clr"}),u.jsx(Qr,{id:"txn-cleared",checked:Q,onChange:Se=>te(Se.target.checked)})]}):null,L=u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.25rem",paddingBottom:"0.1rem"},children:[u.jsx("span",{style:{fontSize:"0.75rem",opacity:.7,fontWeight:500},children:""}),u.jsxs("div",{style:{display:"flex",gap:"0.25rem"},children:[u.jsx("button",{type:"submit",title:D,style:hz,children:""}),u.jsx("button",{type:"button",onClick:()=>{p()},title:"Cancel",style:fz,children:""}),g&&u.jsx("button",{type:"button",onClick:()=>{g()},title:"Delete",style:mz,children:""})]})]}),de=re?u.jsx("div",{style:{background:`color-mix(in srgb, ${ge.error} 15%, transparent)`,border:`1px solid ${ge.errorBorder}`,borderRadius:"6px",padding:"0.5rem 0.75rem",fontSize:"0.85rem",color:ge.error},children:'Cannot select both "No Category" and "No Account"  at least one must be a real category or account.'}):null,ye=u.jsxs(qa,{children:[u.jsx($e,{type:"submit",actionName:D,children:D}),u.jsx($e,{type:"button",variant:"secondary",actionName:"Cancel Transaction Form",onClick:p,children:"Cancel"}),g&&u.jsx($e,{type:"button",variant:"danger",actionName:"Delete Transaction",onClick:g,children:" Delete"})]}),ee=w&&n&&r,X={fontSize:"0.85rem",padding:"0.5rem"};if(!_)return u.jsxs(Ri,{actionName:D,onSubmit:we,children:[u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:[u.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[u.jsx(Nt,{label:"Date",htmlFor:"txn-date",children:u.jsx(zf,{id:"txn-date",value:$,onChange:Se=>k(Se.target.value),required:!0,autoFocus:!0})}),u.jsx(Nt,{label:S?z?"Amount (Expense)":"Amount (Refund)":"Amount",htmlFor:"txn-amount",children:S?u.jsxs("div",{className:"currency-with-sign",style:{display:"flex",alignItems:"stretch"},children:[u.jsx("button",{type:"button",onClick:()=>H(!z),style:WS(z),title:z?"Click to make this a refund (+)":"Click to make this an expense (-)",children:z?"":"+"}),u.jsx("div",{style:{flex:1},children:u.jsx(Ao,{id:"txn-amount",value:J,onChange:Y,placeholder:"$0.00",required:!0,style:{borderTopLeftRadius:0,borderBottomLeftRadius:0,borderLeft:"none",color:z?ge.error:ge.success}})})]}):u.jsx(Ao,{id:"txn-amount",value:J,onChange:Y,placeholder:"$0.00",required:!0})})]}),u.jsx(Nt,{label:"Payee",htmlFor:"txn-payee",children:u.jsx(MS,{id:"txn-payee",value:M,onChange:B,payees:i,placeholder:T})}),at,u.jsx(Nt,{label:C,htmlFor:"txn-account",children:ze}),u.jsx(Nt,{label:"Description (optional)",htmlFor:"txn-description",children:u.jsx(Ii,{id:"txn-description",value:G,onChange:Se=>Z(Se.target.value),placeholder:R})}),x&&u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx(Qr,{id:"txn-cleared-stacked",checked:Q,onChange:Se=>te(Se.target.checked)}),u.jsx("label",{htmlFor:"txn-cleared-stacked",style:{fontSize:"0.9rem",cursor:"pointer"},children:"Cleared (appeared in bank account)"})]}),de,b]}),ye]});const ae=S?"8.25rem":"6rem",Ee=ee?x?`6rem minmax(8rem, 1fr) minmax(8rem, 1fr) minmax(8rem, 1fr) ${ae} minmax(10rem, 2fr) auto auto`:`6rem minmax(8rem, 1fr) minmax(8rem, 1fr) minmax(8rem, 1fr) ${ae} minmax(10rem, 2fr) auto`:x?`6rem minmax(10rem, 1fr) minmax(10rem, 1fr) ${ae} minmax(12rem, 2fr) auto auto`:`6rem minmax(10rem, 1fr) minmax(10rem, 1fr) ${ae} minmax(12rem, 2fr) auto`;return u.jsxs(Ri,{actionName:D,onSubmit:we,children:[u.jsxs("div",{style:{display:"grid",gridTemplateColumns:Ee,gap:"1rem",alignItems:"end"},children:[u.jsx(Nt,{label:"Date",htmlFor:"txn-date",children:u.jsx(zf,{id:"txn-date",value:$,onChange:Se=>k(Se.target.value),required:!0,style:X,autoFocus:!0})}),u.jsx(Nt,{label:"Payee",htmlFor:"txn-payee",children:u.jsx(MS,{id:"txn-payee",value:M,onChange:B,payees:i,placeholder:T})}),at,u.jsx(Nt,{label:C,htmlFor:"txn-account",children:ze}),u.jsx(Nt,{label:S?z?"Amount ()":"Amount (+)":"Amount",htmlFor:"txn-amount",children:S?u.jsxs("div",{className:"currency-with-sign",style:{display:"flex",alignItems:"stretch"},children:[u.jsx("button",{type:"button",onClick:()=>H(!z),style:WS(z),title:z?"Click to make this a refund (+)":"Click to make this an expense (-)",children:z?"":"+"}),u.jsx("div",{style:{flex:1},children:u.jsx(Ao,{id:"txn-amount",value:J,onChange:Y,placeholder:"$0.00",required:!0,style:{borderTopLeftRadius:0,borderBottomLeftRadius:0,borderLeft:"none",color:z?ge.error:ge.success}})})]}):u.jsx(Ao,{id:"txn-amount",value:J,onChange:Y,placeholder:"$0.00",required:!0})}),u.jsx(Nt,{label:"Description",htmlFor:"txn-description",children:u.jsx(Ii,{id:"txn-description",value:G,onChange:Se=>Z(Se.target.value),placeholder:R,style:X})}),lt,L]}),de,b]})}function QS({accounts:t,accountGroups:e,payees:n,initialData:r,defaultAccountId:i,defaultDate:o,onSubmit:l,onCancel:d,onDelete:h,submitLabel:f}){function p(g){l(g.amount,g.accountId,g.date,g.payee,g.description)}return u.jsx(t_,{accounts:t,accountGroups:e,payees:n,initialData:r?{date:r.date,payee:r.payee,accountId:r.account_id,amount:r.amount,description:r.description}:void 0,defaultAccountId:i,defaultDate:o,config:{showCategory:!1,showCleared:!1,accountLabel:"Deposit To",payeePlaceholder:"e.g., Employer, Client name",descriptionPlaceholder:"e.g., January paycheck",submitLabel:f},onSubmit:p,onCancel:d,onDelete:h})}function pz({income:t,accountName:e,accountGroupName:n,onEdit:r,onDelete:i,isMobile:o,isEvenRow:l}){const d=t.date?new Date(t.date+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"}):"",h=n?`${n} / ${e}`:e,f=l?"transparent":"rgba(255,255,255,0.04)";if(o)return u.jsxs("div",{onClick:r,style:{gridColumn:"1 / -1",display:"grid",gridTemplateColumns:"1fr auto",gap:"0.5rem",padding:"0.75rem 1rem",background:f,cursor:"pointer",transition:"background 0.15s"},children:[u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{style:{fontSize:"0.75rem",opacity:.5,fontFamily:"monospace",minWidth:"3rem"},children:d}),u.jsx("span",{style:{fontWeight:500,fontSize:"0.9rem"},children:t.payee||""})]}),u.jsxs("span",{style:{fontSize:"0.75rem",opacity:.6},children:[" ",h]})]}),u.jsx("div",{style:{display:"flex",alignItems:"center"},children:u.jsxs("span",{style:{fontWeight:600,color:ge.success,fontFamily:"monospace"},children:["+",Xt(t.amount)]})})]});const p={padding:"0.6rem 0.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem"};return u.jsxs("div",{style:{gridColumn:"1 / -1",background:f,display:"grid",gridTemplateColumns:"5rem 1.5fr 7rem 1fr 6rem 1fr 3rem 4rem"},children:[u.jsx("div",{style:{...p,fontSize:"0.85rem",fontFamily:"monospace"},children:u.jsx("span",{style:{opacity:.6},children:d})}),u.jsx("div",{style:{...p,fontWeight:500,overflow:"hidden"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.payee||""})}),u.jsx("div",{style:{...p,overflow:"hidden"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.85rem",opacity:.7},children:h})}),u.jsxs("div",{style:{...p,justifyContent:"flex-end",fontWeight:600,color:ge.success,fontFamily:"monospace"},children:["+",Xt(t.amount)]}),u.jsx("div",{style:{...p,paddingLeft:"0.5rem",overflow:"hidden"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.8rem",opacity:.6},children:t.description||""})}),u.jsxs("div",{style:{...p,justifyContent:"flex-end",gap:"0.25rem"},children:[u.jsx("button",{onClick:r,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:g=>g.currentTarget.style.opacity="1",onMouseLeave:g=>g.currentTarget.style.opacity="0.5",title:"Edit",children:""}),u.jsx("button",{onClick:i,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:g=>g.currentTarget.style.opacity="1",onMouseLeave:g=>g.currentTarget.style.opacity="0.5",title:"Delete",children:""})]})]})}const Ol={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderTop:"1px solid rgba(255,255,255,0.1)"};function gz(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n,setCurrentYear:r,setCurrentMonthNumber:i}=Ze(),{accounts:o,accountGroups:l}=On(),{month:d,isLoading:h}=Ys(t,e,n),{addIncome:f}=tB(),{updateIncome:p}=rB(),{deleteIncome:g}=sB(),b=Mi(),[_,w]=j.useState(null),[x,S]=j.useState(!1),[C,T]=j.useState(null),V=V0(t,{enabled:x||C!==null}).data||[];function $(G){const Z=G.account_group_id?l[G.account_group_id]:void 0;return Z&&Z.is_active!==null?Z.is_active:G.is_active!==!1}function k(G){const Z=G.account_group_id?l[G.account_group_id]:void 0;return Z&&Z.on_budget!==null?Z.on_budget:G.on_budget!==!1}const M=Object.entries(o).filter(([,G])=>$(G)&&k(G)),B=M.filter(([,G])=>G.is_income_account),U=B.length>0?B:M,q=M.find(([,G])=>G.is_income_default),I=q?q[0]:void 0,N=d?.income.reduce((G,Z)=>G+Z.amount,0)||0;function O(G,Z,Q,te,z){if(!t)return;w(null),S(!1);const{year:H,month:re}=_m(Q);(H!==e||re!==n)&&(r(H),i(re)),f(t,H,re,G,Z,Q,te,z).catch(ne=>{w(ne instanceof Error?ne.message:"Failed to add income")})}function J(G,Z,Q,te,z,H){t&&(w(null),T(null),p(t,e,n,G,Z,Q,te,z,H).catch(re=>{w(re instanceof Error?re.message:"Failed to update income")}))}function Y(G){t&&confirm("Are you sure you want to delete this income entry?")&&(w(null),g(t,e,n,G).catch(Z=>{w(Z instanceof Error?Z.message:"Failed to delete income")}))}return u.jsxs("div",{style:{opacity:h?.5:1,transition:"opacity 0.15s ease-out",pointerEvents:h?"none":"auto"},children:[_&&u.jsx("div",{style:{background:`color-mix(in srgb, ${ge.error} 15%, transparent)`,border:`1px solid ${ge.error}`,borderRadius:"8px",padding:"0.75rem",marginBottom:"1rem",color:ge.error},children:_}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:b?"1fr":"5rem 1.5fr 2fr 7rem 1.5fr 3rem"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"#242424",borderBottom:"1px solid rgba(255,255,255,0.15)",display:b?"block":"grid",gridTemplateColumns:b?void 0:"subgrid"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem"},children:[u.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[u.jsx("span",{style:{fontWeight:600},children:"Income:"}),u.jsx("span",{style:{opacity:.6,fontSize:"0.8rem"},children:"Incoming money that should be factored into income calculations"}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"Total: "}),u.jsx("span",{style:{color:ct(N),fontWeight:600},children:Xt(N)})]})]}),u.jsx("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:!x&&u.jsx($e,{actionName:"Open Add Income Form",onClick:()=>S(!0),disabled:U.length===0,disabledReason:Object.keys(o).length===0?"Create an account first":"Set up an income account first",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:"+ Add Income"})})]}),!b&&u.jsxs(u.Fragment,{children:[u.jsx("div",{style:Ol,children:"Date"}),u.jsx("div",{style:Ol,children:"Payee"}),u.jsx("div",{style:Ol,children:"Account"}),u.jsx("div",{style:{...Ol,textAlign:"right"},children:"Amount"}),u.jsx("div",{style:Ol,children:"Description"}),u.jsx("div",{style:Ol})]})]}),u.jsx("div",{style:{gridColumn:"1 / -1",fontSize:"0.8rem",opacity:.55,fontStyle:"italic",padding:"0.5rem 0"},children:" All income entries on this page count towards the tithing owed calculation."}),U.length===0&&u.jsx(Ku,{message:Object.keys(o).length===0?"You need to create at least one account before adding income.":'No accounts are set up for income deposits. Edit an account and enable "Show in income deposit list".',linkText:"Manage accounts",linkTo:"/budget/settings/accounts"}),x&&u.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"1rem"},children:u.jsx(QS,{accounts:U,accountGroups:l,payees:V,defaultAccountId:I,defaultDate:ym(e,n),onSubmit:O,onCancel:()=>S(!1),submitLabel:"Add Income",isMobile:b})}),d?.income.slice().sort((G,Z)=>(G.date||"").localeCompare(Z.date||"")).map((G,Z)=>C===G.id?u.jsx("div",{style:{gridColumn:"1 / -1",padding:"0.5rem"},children:u.jsx(QS,{accounts:U,accountGroups:l,payees:V,initialData:G,onSubmit:(Q,te,z,H,re)=>J(G.id,Q,te,z,H,re),onCancel:()=>T(null),onDelete:()=>Y(G.id),submitLabel:"Save",isMobile:b})},G.id):u.jsx(pz,{income:G,accountName:Ke(G.account_id)?Ba:o[G.account_id]?.nickname||"Unknown Account",accountGroupName:Ke(G.account_id)?void 0:o[G.account_id]?.account_group_id?l[o[G.account_id].account_group_id]?.name:void 0,onEdit:()=>{G.payee||`${G.amount}`,T(G.id)},onDelete:()=>Y(G.id),isMobile:b,isEvenRow:Z%2===0},G.id)),(!d?.income||d.income.length===0)&&!x&&u.jsx("p",{style:{gridColumn:"1 / -1",opacity:.5,fontSize:"0.9rem",textAlign:"center",padding:"1.5rem"},children:"No income recorded for this month"}),u.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]})]})}function KS({accounts:t,accountGroups:e,categories:n,categoryGroups:r,payees:i,initialData:o,defaultAccountId:l,defaultDate:d,onSubmit:h,onCancel:f,onDelete:p,submitLabel:g}){function b(_){h(_.amount,_.categoryId,_.accountId,_.date,_.payee,_.description,_.cleared)}return u.jsx(t_,{accounts:t,accountGroups:e,categories:n,categoryGroups:r,payees:i,initialData:o?{date:o.date,payee:o.payee,categoryId:o.category_id,accountId:o.account_id,amount:o.amount,description:o.description,cleared:o.cleared}:void 0,defaultAccountId:l,defaultDate:d,config:{showCategory:!0,showCleared:!0,showNoCategoryOption:!1,showNoAccountOption:!1,showSignToggle:!0,accountLabel:"Pay From",payeePlaceholder:"e.g., Grocery Store",descriptionPlaceholder:"e.g., Weekly groceries",submitLabel:g},onSubmit:b,onCancel:f,onDelete:p})}function yz({expense:t,categoryName:e,accountName:n,accountGroupName:r,onEdit:i,onDelete:o,isMobile:l,isEvenRow:d}){const h=t.date?new Date(t.date+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"}):"",f=r?`${r} / ${n}`:n,p=d?"transparent":"rgba(255,255,255,0.04)";if(l)return u.jsxs("div",{onClick:i,style:{gridColumn:"1 / -1",display:"grid",gridTemplateColumns:"1fr auto",gap:"0.5rem",padding:"0.75rem 1rem",background:p,cursor:"pointer",transition:"background 0.15s"},children:[u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{style:{fontSize:"0.75rem",opacity:.5,fontFamily:"monospace",minWidth:"3rem"},children:h}),u.jsx("span",{style:{fontWeight:500,fontSize:"0.9rem"},children:t.payee||""}),t.cleared&&u.jsx("span",{style:{fontSize:"0.7rem",color:ge.success},title:"Cleared",children:""})]}),u.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap"},children:[u.jsx("span",{style:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px"},children:e}),u.jsxs("span",{style:{fontSize:"0.75rem",opacity:.6},children:[" ",f]})]})]}),u.jsx("div",{style:{display:"flex",alignItems:"center"},children:u.jsx("span",{style:{fontWeight:600,color:ct(t.amount),fontFamily:"monospace"},children:Bt(t.amount)})})]});const g={padding:"0.6rem 0.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem"};return u.jsxs("div",{style:{gridColumn:"1 / -1",background:p,display:"grid",gridTemplateColumns:"5rem 1.5fr 7rem 1fr 6rem 1fr 3rem 4rem"},children:[u.jsx("div",{style:{...g,fontSize:"0.85rem",fontFamily:"monospace"},children:u.jsx("span",{style:{opacity:.6},children:h})}),u.jsx("div",{style:{...g,fontWeight:500,overflow:"hidden"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.payee||""})}),u.jsx("div",{style:{...g,justifyContent:"center"},children:u.jsx("span",{style:{fontSize:"0.8rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e})}),u.jsx("div",{style:{...g,overflow:"hidden"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.85rem",opacity:.7},children:f})}),u.jsx("div",{style:{...g,justifyContent:"flex-end",fontWeight:600,color:ct(t.amount),fontFamily:"monospace"},children:Bt(t.amount)}),u.jsx("div",{style:{...g,paddingLeft:"0.5rem",overflow:"hidden"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.8rem",opacity:.6},children:t.description||""})}),u.jsx("div",{style:{...g,justifyContent:"center",color:t.cleared?ge.success:"inherit",opacity:t.cleared?1:.3,fontSize:"1rem"},children:t.cleared?"":""}),u.jsxs("div",{style:{...g,justifyContent:"flex-end",gap:"0.25rem"},children:[u.jsx("button",{onClick:i,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:b=>b.currentTarget.style.opacity="1",onMouseLeave:b=>b.currentTarget.style.opacity="0.5",title:"Edit",children:""}),u.jsx("button",{onClick:o,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:b=>b.currentTarget.style.opacity="1",onMouseLeave:b=>b.currentTarget.style.opacity="0.5",title:"Delete",children:""})]})]})}const fa={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderTop:"1px solid rgba(255,255,255,0.1)"};function _z(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n,setCurrentYear:r,setCurrentMonthNumber:i}=Ze(),{accounts:o,accountGroups:l,categories:d,categoryGroups:h}=On(),{month:f,isLoading:p}=Ys(t,e,n),{addExpense:g}=aB(),{updateExpense:b}=lB(),{deleteExpense:_}=cB(),w=Mi(),[x,S]=j.useState(null),[C,T]=j.useState(!1),[R,D]=j.useState(null),k=V0(t,{enabled:C||R!==null}).data||[];function M(Q){const te=Q.account_group_id?l[Q.account_group_id]:void 0;return te&&te.is_active!==null?te.is_active:Q.is_active!==!1}function B(Q){const te=Q.account_group_id?l[Q.account_group_id]:void 0;return te&&te.on_budget!==null?te.on_budget:Q.on_budget!==!1}const U=Object.entries(o).filter(([,Q])=>M(Q)&&B(Q)),q=U.filter(([,Q])=>Q.is_outgo_account),I=q.length>0?q:U,N=U.find(([,Q])=>Q.is_outgo_default),O=N?N[0]:void 0,J=f?.expenses?.reduce((Q,te)=>Q+te.amount,0)||0;function Y(Q,te,z,H,re,ne,ce){if(!t)return;S(null),T(!1);const{year:he,month:we}=_m(H);(he!==e||we!==n)&&(r(he),i(we)),g(t,he,we,Q,te,z,H,re,ne,ce).catch(oe=>{S(oe instanceof Error?oe.message:"Failed to add expense")})}function G(Q,te,z,H,re,ne,ce,he){t&&(S(null),D(null),b(t,e,n,Q,te,z,H,re,ne,ce,he).catch(we=>{S(we instanceof Error?we.message:"Failed to update expense")}))}function Z(Q){t&&confirm("Are you sure you want to delete this expense?")&&(S(null),_(t,e,n,Q).catch(te=>{S(te instanceof Error?te.message:"Failed to delete expense")}))}return u.jsxs("div",{style:{opacity:p?.5:1,transition:"opacity 0.15s ease-out",pointerEvents:p?"none":"auto"},children:[x&&u.jsx("div",{style:{background:`color-mix(in srgb, ${ge.error} 15%, transparent)`,border:`1px solid ${ge.error}`,borderRadius:"8px",padding:"0.75rem",marginBottom:"1rem",color:ge.error},children:x}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:w?"1fr":"5rem 1.5fr 7rem 1fr 6rem 1fr 3rem 4rem"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"#242424",borderBottom:"1px solid rgba(255,255,255,0.15)",display:w?"block":"grid",gridTemplateColumns:w?void 0:"subgrid"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem"},children:[u.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[u.jsx("span",{style:{fontWeight:600},children:"Expenses:"}),u.jsx("span",{style:{opacity:.6,fontSize:"0.8rem"},children:"Transactions that should be factored into spend calculations"}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"Total: "}),u.jsx("span",{style:{color:ct(J),fontWeight:600},children:Bt(J)})]})]}),u.jsx("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:!C&&u.jsx($e,{actionName:"Open Add Expense Form",onClick:()=>T(!0),disabled:I.length===0||Object.keys(d).length===0,disabledReason:I.length===0&&Object.keys(d).length===0?"Create accounts and categories first":I.length===0?"Create an expense account first":"Create a category first",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:"+ Add Expense"})})]}),!w&&u.jsxs(u.Fragment,{children:[u.jsx("div",{style:fa,children:"Date"}),u.jsx("div",{style:fa,children:"Payee"}),u.jsx("div",{style:{...fa,textAlign:"center"},children:"Category"}),u.jsx("div",{style:fa,children:"Account"}),u.jsx("div",{style:{...fa,textAlign:"right"},children:"Amount"}),u.jsx("div",{style:fa,children:"Description"}),u.jsx("div",{style:{...fa,textAlign:"center"},children:"Clr"}),u.jsx("div",{style:fa})]})]}),I.length===0&&u.jsx(Ku,{message:Object.keys(o).length===0?"You need to create at least one account before adding expenses.":'No accounts are set up for expenses. Edit an account and enable "Show in expense list".',linkText:"Manage accounts",linkTo:"/budget/settings/accounts"}),Object.keys(d).length===0&&u.jsx(Ku,{message:"You need to create at least one category before adding expenses.",linkText:"Create categories",linkTo:"/budget/settings/categories"}),C&&u.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"1rem"},children:u.jsx(KS,{accounts:I,accountGroups:l,categories:d,categoryGroups:h,payees:k,defaultAccountId:O,defaultDate:ym(e,n),onSubmit:Y,onCancel:()=>T(!1),submitLabel:"Add Expense",isMobile:w})}),f?.expenses?.slice().sort((Q,te)=>(Q.date||"").localeCompare(te.date||"")).map((Q,te)=>R===Q.id?u.jsx("div",{style:{gridColumn:"1 / -1",padding:"0.5rem"},children:u.jsx(KS,{accounts:I,accountGroups:l,categories:d,categoryGroups:h,payees:k,initialData:Q,onSubmit:(z,H,re,ne,ce,he,we)=>G(Q.id,z,H,re,ne,ce,he,we),onCancel:()=>D(null),onDelete:()=>Z(Q.id),submitLabel:"Save",isMobile:w})},Q.id):u.jsx(yz,{expense:Q,categoryName:ot(Q.category_id)?Po:d[Q.category_id]?.name||"Unknown Category",accountName:Ke(Q.account_id)?Ba:o[Q.account_id]?.nickname||"Unknown Account",accountGroupName:Ke(Q.account_id)?void 0:o[Q.account_id]?.account_group_id?l[o[Q.account_id].account_group_id]?.name:void 0,onEdit:()=>{Q.payee||`${Q.amount}`,D(Q.id)},onDelete:()=>Z(Q.id),isMobile:w,isEvenRow:te%2===0},Q.id)),(!f?.expenses||f.expenses.length===0)&&!C&&u.jsx("p",{style:{gridColumn:"1 / -1",opacity:.5,fontSize:"0.9rem",textAlign:"center",padding:"1.5rem"},children:"No expenses recorded for this month"}),u.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]})]})}const bz={background:ge.primary,border:"none",cursor:"pointer",fontSize:"0.9rem",padding:"0.35rem 0.5rem",borderRadius:"4px",color:"white"},vz={background:"transparent",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)",cursor:"pointer",fontSize:"0.9rem",padding:"0.35rem 0.5rem",borderRadius:"4px"},xz={background:"transparent",border:`1px solid ${ge.errorBorder}`,color:ge.error,cursor:"pointer",fontSize:"0.9rem",padding:"0.35rem 0.5rem",borderRadius:"4px"};function YS({accounts:t,accountGroups:e,categories:n,categoryGroups:r,initialData:i,defaultDate:o,onSubmit:l,onCancel:d,onDelete:h,submitLabel:f}){const{isWide:p}=HT(),g=new Date().toISOString().split("T")[0],[b,_]=j.useState(i?.date||o||g),[w,x]=j.useState(i?.amount?.toString()||""),[S,C]=j.useState(i?.from_account_id||Ht),[T,R]=j.useState(i?.to_account_id||Ht),[D,V]=j.useState(i?.from_category_id||Yt),[$,k]=j.useState(i?.to_category_id||Yt),[M,B]=j.useState(i?.description||""),[U,q]=j.useState(i?.cleared||!1),[I,N]=j.useState(null),O=D===Yt,J=$===Yt,Y=S===Ht,G=T===Ht;function Z(){return O&&J&&(Y&&G)?'A transfer must move between real categories or real accounts  not all "No" options.':Y!==G?'Both accounts must be real accounts, or both must be "No Account". Cannot transfer from a real account to nothing.':O!==J?'Both categories must be real categories, or both must be "No Category". Cannot transfer from a real category to nothing.':null}Z()===null&&I!==null&&N(null);function te(oe){oe.preventDefault();const be=parseFloat(w);if(isNaN(be)||be<=0||!S||!T||!D||!$||!b)return;const Me=Z();if(Me){N(Me);return}N(null),l(be,S,T,D,$,b,M.trim()||void 0,U)}const z=I?u.jsx("div",{style:{background:`color-mix(in srgb, ${ge.error} 15%, transparent)`,border:`1px solid ${ge.errorBorder}`,borderRadius:"6px",padding:"0.5rem 0.75rem",fontSize:"0.85rem",color:ge.error,marginTop:"0.5rem"},children:I}):null,H=(oe,be,Me,ze)=>u.jsx(Nt,{label:ze,htmlFor:oe,children:u.jsx(qT,{id:oe,value:be,onChange:Me,accounts:t,accountGroups:e,placeholder:Ba,required:!0,showNoAccountOption:!0})}),re=(oe,be,Me,ze)=>u.jsx(Nt,{label:ze,htmlFor:oe,children:u.jsx($T,{id:oe,value:be,onChange:Me,categories:n,categoryGroups:r,placeholder:Po,required:!0,showNoCategoryOption:!0})}),ne=u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.25rem",paddingBottom:"0.35rem"},children:[u.jsx("label",{htmlFor:"transfer-cleared",style:{fontSize:"0.75rem",opacity:.7,fontWeight:500},children:"Clr"}),u.jsx(Qr,{id:"transfer-cleared",checked:U,onChange:oe=>q(oe.target.checked)})]}),ce=u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.25rem",paddingBottom:"0.1rem"},children:[u.jsx("span",{style:{fontSize:"0.75rem",opacity:.7,fontWeight:500},children:""}),u.jsxs("div",{style:{display:"flex",gap:"0.25rem"},children:[u.jsx("button",{type:"submit",title:f,style:bz,children:""}),u.jsx("button",{type:"button",onClick:()=>{d()},title:"Cancel",style:vz,children:""}),h&&u.jsx("button",{type:"button",onClick:()=>{h()},title:"Delete",style:xz,children:""})]})]}),he=u.jsxs(qa,{children:[u.jsx($e,{type:"submit",actionName:f,children:f}),u.jsx($e,{type:"button",variant:"secondary",actionName:"Cancel Transfer Form",onClick:d,children:"Cancel"}),h&&u.jsx($e,{type:"button",variant:"danger",actionName:"Delete Transfer",onClick:h,children:" Delete"})]}),we={fontSize:"0.85rem",padding:"0.5rem"};return p?u.jsx(Ri,{actionName:f,onSubmit:te,children:u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[u.jsxs("div",{style:{display:"grid",gridTemplateColumns:"5.5rem 5.5rem 1fr 1fr 1.5fr",gap:"0.75rem",alignItems:"end"},children:[u.jsx(Nt,{label:"Date",htmlFor:"transfer-date",children:u.jsx(zf,{id:"transfer-date",value:b,onChange:oe=>_(oe.target.value),required:!0,style:we,autoFocus:!0})}),u.jsx(Nt,{label:"Amount",htmlFor:"transfer-amount",children:u.jsx(Ao,{id:"transfer-amount",value:w,onChange:x,placeholder:"$0.00",required:!0})}),re("from-category",D,V,"From Category"),H("from-account",S,C,"From Account"),u.jsx(Nt,{label:"Description",htmlFor:"transfer-description",children:u.jsx(Ii,{id:"transfer-description",value:M,onChange:oe=>B(oe.target.value),placeholder:"e.g., Transfer",style:we})})]}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:"5.5rem 5.5rem 1fr 1fr 1.5fr",gap:"0.75rem",alignItems:"end"},children:[u.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1.2rem",opacity:.5,paddingBottom:"0.5rem"},children:""}),u.jsx("div",{}),re("to-category",$,k,"To Category"),H("to-account",T,R,"To Account"),u.jsxs("div",{style:{display:"flex",gap:"0.75rem",alignItems:"end",paddingBottom:"0.25rem"},children:[ne,ce]})]}),z]})}):u.jsxs(Ri,{actionName:f,onSubmit:te,children:[u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:[u.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[u.jsx(Nt,{label:"Date",htmlFor:"transfer-date",children:u.jsx(zf,{id:"transfer-date",value:b,onChange:oe=>_(oe.target.value),required:!0,autoFocus:!0})}),u.jsx(Nt,{label:"Amount",htmlFor:"transfer-amount",children:u.jsx(Ao,{id:"transfer-amount",value:w,onChange:x,placeholder:"$0.00",required:!0})})]}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem",background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1rem",borderRadius:"8px"},children:[u.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"0.75rem",alignItems:"end"},children:[re("from-category",D,V,"From Cat."),H("from-account",S,C,"From Acct.")]}),u.jsx("div",{style:{display:"flex",justifyContent:"center",fontSize:"1.5rem",opacity:.5},children:""}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"0.75rem",alignItems:"end"},children:[re("to-category",$,k,"To Cat."),H("to-account",T,R,"To Acct.")]})]}),u.jsx(Nt,{label:"Description (optional)",htmlFor:"transfer-description",children:u.jsx(Ii,{id:"transfer-description",value:M,onChange:oe=>B(oe.target.value),placeholder:"e.g., Transfer to savings"})}),u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx(Qr,{id:"transfer-cleared-stacked",checked:U,onChange:oe=>q(oe.target.checked)}),u.jsx("label",{htmlFor:"transfer-cleared-stacked",style:{fontSize:"0.9rem",cursor:"pointer"},children:"Cleared (appeared in bank account)"})]}),z]}),he]})}function wz({transfer:t,fromCategoryName:e,toCategoryName:n,fromAccountName:r,toAccountName:i,fromAccountGroupName:o,toAccountGroupName:l,isFromCategoryNo:d,isToCategoryNo:h,isFromAccountNo:f,isToAccountNo:p,onEdit:g,onDelete:b,isMobile:_,isEvenRow:w}){const x=t.date?new Date(t.date+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"}):"",S=w?"transparent":"rgba(255,255,255,0.04)";if(_)return u.jsxs("div",{onClick:g,style:{gridColumn:"1 / -1",display:"flex",flexDirection:"column",gap:"0.5rem",padding:"0.75rem 1rem",background:S,cursor:"pointer",transition:"background 0.15s"},children:[u.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{style:{fontSize:"0.75rem",opacity:.5,fontFamily:"monospace",minWidth:"3rem"},children:x}),u.jsx("span",{style:{fontWeight:600,opacity:.8,fontFamily:"monospace"},children:Xt(t.amount)}),t.cleared&&u.jsx("span",{style:{fontSize:"0.7rem",color:ge.success},title:"Cleared",children:""})]})}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto 1fr",gap:"0.5rem",alignItems:"center"},children:[u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[u.jsx("span",{style:d?{fontSize:"0.7rem",opacity:.4}:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px",display:"inline-block",width:"fit-content"},children:e}),f?u.jsx("span",{style:{fontSize:"0.75rem",opacity:.4},children:r}):u.jsxs("div",{style:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px",display:"inline-flex",flexDirection:"column",gap:"0.1rem",width:"fit-content"},children:[o&&u.jsx("span",{style:{fontSize:"0.65rem",opacity:.6},children:o}),u.jsx("span",{children:r})]})]}),u.jsx("span",{style:{opacity:.5},children:""}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[u.jsx("span",{style:h?{fontSize:"0.7rem",opacity:.4}:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px",display:"inline-block",width:"fit-content"},children:n}),p?u.jsx("span",{style:{fontSize:"0.75rem",opacity:.4},children:i}):u.jsxs("div",{style:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px",display:"inline-flex",flexDirection:"column",gap:"0.1rem",width:"fit-content"},children:[l&&u.jsx("span",{style:{fontSize:"0.65rem",opacity:.6},children:l}),u.jsx("span",{children:i})]})]})]}),t.description&&u.jsx("div",{style:{fontSize:"0.75rem",opacity:.6},children:t.description})]});const C={padding:"0.6rem 0.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem"};return u.jsxs("div",{style:{gridColumn:"1 / -1",background:S,display:"grid",gridTemplateColumns:"5rem 6rem 1fr 1fr 2rem 1fr 1fr 1fr 3rem 4rem"},children:[u.jsx("div",{style:{...C,fontSize:"0.85rem",fontFamily:"monospace"},children:u.jsx("span",{style:{opacity:.6},children:x})}),u.jsx("div",{style:{...C,justifyContent:"flex-end",fontWeight:600,opacity:.8,fontFamily:"monospace"},children:Xt(t.amount)}),u.jsx("div",{style:{...C,justifyContent:"center"},children:u.jsx("span",{style:d?{fontSize:"0.8rem",opacity:.4}:{fontSize:"0.8rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e})}),u.jsx("div",{style:{...C,overflow:"hidden"},children:f?u.jsx("span",{style:{opacity:.4,fontSize:"0.85rem"},children:r}):u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.1rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden"},children:[o&&u.jsx("span",{style:{fontSize:"0.7rem",opacity:.6,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:o}),u.jsx("span",{style:{fontSize:"0.8rem",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:r})]})}),u.jsx("div",{style:{...C,justifyContent:"center",fontSize:"1rem"},children:u.jsx("span",{style:{opacity:.5},children:""})}),u.jsx("div",{style:{...C,justifyContent:"center"},children:u.jsx("span",{style:h?{fontSize:"0.8rem",opacity:.4}:{fontSize:"0.8rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:n})}),u.jsx("div",{style:{...C,overflow:"hidden"},children:p?u.jsx("span",{style:{opacity:.4,fontSize:"0.85rem"},children:i}):u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.1rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden"},children:[l&&u.jsx("span",{style:{fontSize:"0.7rem",opacity:.6,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:l}),u.jsx("span",{style:{fontSize:"0.8rem",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:i})]})}),u.jsx("div",{style:{...C,paddingLeft:"0.5rem",overflow:"hidden"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.8rem",opacity:.6},children:t.description||""})}),u.jsx("div",{style:{...C,justifyContent:"center",color:t.cleared?ge.success:"inherit",opacity:t.cleared?1:.3,fontSize:"1rem"},children:t.cleared?"":""}),u.jsxs("div",{style:{...C,justifyContent:"flex-end",gap:"0.25rem"},children:[u.jsx("button",{onClick:g,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:T=>T.currentTarget.style.opacity="1",onMouseLeave:T=>T.currentTarget.style.opacity="0.5",title:"Edit",children:""}),u.jsx("button",{onClick:b,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:T=>T.currentTarget.style.opacity="1",onMouseLeave:T=>T.currentTarget.style.opacity="0.5",title:"Delete",children:""})]})]})}const zs={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderTop:"1px solid rgba(255,255,255,0.1)"};function Sz(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n,setCurrentYear:r,setCurrentMonthNumber:i}=Ze(),{accounts:o,accountGroups:l,categories:d,categoryGroups:h}=On(),{month:f,isLoading:p}=Ys(t,e,n),{addTransfer:g}=dB(),{updateTransfer:b}=fB(),{deleteTransfer:_}=mB(),w=Mi(),[x,S]=j.useState(null),[C,T]=j.useState(!1),[R,D]=j.useState(null);function V(I){const N=I.account_group_id?l[I.account_group_id]:void 0;return N&&N.is_active!==null?N.is_active:I.is_active!==!1}function $(I){const N=I.account_group_id?l[I.account_group_id]:void 0;return N&&N.on_budget!==null?N.on_budget:I.on_budget!==!1}const k=Object.entries(o).filter(([,I])=>V(I)&&$(I));function M(I,N,O,J,Y,G,Z,Q){if(!t)return;S(null),T(!1);const{year:te,month:z}=_m(G);(te!==e||z!==n)&&(r(te),i(z)),g(t,te,z,I,N,O,J,Y,G,Z,Q).catch(H=>{S(H instanceof Error?H.message:"Failed to add transfer")})}function B(I,N,O,J,Y,G,Z,Q,te){t&&(S(null),D(null),b(t,e,n,I,N,O,J,Y,G,Z,Q,te).catch(z=>{S(z instanceof Error?z.message:"Failed to update transfer")}))}function U(I){t&&confirm("Are you sure you want to delete this transfer?")&&(S(null),_(t,e,n,I).catch(N=>{S(N instanceof Error?N.message:"Failed to delete transfer")}))}const q=k.length>=1&&Object.keys(d).length>=1;return u.jsxs("div",{style:{opacity:p?.5:1,transition:"opacity 0.15s ease-out",pointerEvents:p?"none":"auto"},children:[x&&u.jsx("div",{style:{background:`color-mix(in srgb, ${ge.error} 15%, transparent)`,border:`1px solid ${ge.error}`,borderRadius:"8px",padding:"0.75rem",marginBottom:"1rem",color:ge.error},children:x}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:w?"1fr":"5rem 6rem 1fr 1fr 2rem 1fr 1fr 1fr 3rem 4rem"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"#242424",borderBottom:"1px solid rgba(255,255,255,0.15)",display:w?"block":"grid",gridTemplateColumns:w?void 0:"subgrid"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem"},children:[u.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[u.jsx("span",{style:{fontWeight:600},children:"Transfers:"}),u.jsx("span",{style:{opacity:.6,fontSize:"0.8rem"},children:"Moving money between accounts and categories within the budget"})]}),u.jsx("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:!C&&u.jsx($e,{actionName:"Open Add Transfer Form",onClick:()=>T(!0),disabled:!q,disabledReason:k.length===0&&Object.keys(d).length===0?"Create accounts and categories first":k.length===0?"Create an account first":"Create a category first",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:"+ Add Transfer"})})]}),!w&&u.jsxs(u.Fragment,{children:[u.jsx("div",{style:zs,children:"Date"}),u.jsx("div",{style:{...zs,textAlign:"right"},children:"Amount"}),u.jsx("div",{style:{...zs,textAlign:"center"},children:"From Cat"}),u.jsx("div",{style:zs,children:"From Acct"}),u.jsx("div",{style:zs}),u.jsx("div",{style:{...zs,textAlign:"center"},children:"To Cat"}),u.jsx("div",{style:zs,children:"To Acct"}),u.jsx("div",{style:zs,children:"Description"}),u.jsx("div",{style:{...zs,textAlign:"center"},children:"Clr"}),u.jsx("div",{style:zs})]})]}),!q&&u.jsx(Ku,{message:"You need at least one account and one category before adding transfers.",linkText:"Manage accounts",linkTo:"/budget/settings/accounts"}),C&&u.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"1rem"},children:u.jsx(YS,{accounts:k,accountGroups:l,categories:d,categoryGroups:h,defaultDate:ym(e,n),onSubmit:M,onCancel:()=>T(!1),submitLabel:"Add Transfer"})}),f?.transfers?.slice().sort((I,N)=>(I.date||"").localeCompare(N.date||"")).map((I,N)=>R===I.id?u.jsx("div",{style:{gridColumn:"1 / -1",padding:"0.5rem"},children:u.jsx(YS,{accounts:k,accountGroups:l,categories:d,categoryGroups:h,initialData:I,onSubmit:(O,J,Y,G,Z,Q,te,z)=>B(I.id,O,J,Y,G,Z,Q,te,z),onCancel:()=>D(null),onDelete:()=>U(I.id),submitLabel:"Save"})},I.id):u.jsx(wz,{transfer:I,fromCategoryName:ot(I.from_category_id)?Po:d[I.from_category_id]?.name||"Unknown",toCategoryName:ot(I.to_category_id)?Po:d[I.to_category_id]?.name||"Unknown",fromAccountName:Ke(I.from_account_id)?Ba:o[I.from_account_id]?.nickname||"Unknown",toAccountName:Ke(I.to_account_id)?Ba:o[I.to_account_id]?.nickname||"Unknown",fromAccountGroupName:Ke(I.from_account_id)?void 0:o[I.from_account_id]?.account_group_id?l[o[I.from_account_id].account_group_id]?.name:void 0,toAccountGroupName:Ke(I.to_account_id)?void 0:o[I.to_account_id]?.account_group_id?l[o[I.to_account_id].account_group_id]?.name:void 0,isFromCategoryNo:ot(I.from_category_id),isToCategoryNo:ot(I.to_category_id),isFromAccountNo:Ke(I.from_account_id),isToAccountNo:Ke(I.to_account_id),onEdit:()=>{I.description||`${I.amount}`,D(I.id)},onDelete:()=>U(I.id),isMobile:w,isEvenRow:N%2===0},I.id)),(!f?.transfers||f.transfers.length===0)&&!C&&u.jsx("p",{style:{gridColumn:"1 / -1",opacity:.5,fontSize:"0.9rem",textAlign:"center",padding:"1.5rem"},children:"No transfers recorded for this month"}),u.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]})]})}function XS({accounts:t,accountGroups:e,categories:n,categoryGroups:r,payees:i,initialData:o,defaultAccountId:l,defaultDate:d,onSubmit:h,onCancel:f,onDelete:p,submitLabel:g}){function b(_){h(_.amount,_.accountId,_.categoryId,_.date,_.payee,_.description,_.cleared)}return u.jsx(t_,{accounts:t,accountGroups:e,categories:n,categoryGroups:r,payees:i,initialData:o?{date:o.date,payee:o.payee,categoryId:o.category_id,accountId:o.account_id,amount:o.amount,description:o.description,cleared:o.cleared}:void 0,defaultAccountId:l,defaultDate:d,config:{showCategory:!0,showCleared:!0,showNoCategoryOption:!0,showNoAccountOption:!0,showSignToggle:!0,accountLabel:"Account",payeePlaceholder:"e.g., Bank, Interest source",descriptionPlaceholder:"e.g., Starting balance, Correction",submitLabel:g},onSubmit:b,onCancel:f,onDelete:p})}function Ez({adjustment:t,categoryName:e,accountName:n,accountGroupName:r,onEdit:i,onDelete:o,isMobile:l,isEvenRow:d}){const h=t.date?new Date(t.date+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"}):"",f=r?`${r} / ${n}`:n,p=d?"transparent":"rgba(255,255,255,0.04)";if(l)return u.jsxs("div",{onClick:i,style:{gridColumn:"1 / -1",display:"flex",flexDirection:"column",gap:"0.25rem",padding:"0.75rem 1rem",background:p,cursor:"pointer",transition:"background 0.15s"},children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{style:{fontSize:"0.75rem",opacity:.5,fontFamily:"monospace"},children:h}),t.cleared&&u.jsx("span",{style:{fontSize:"0.7rem",color:ge.success},title:"Cleared",children:""})]}),u.jsx("span",{style:{fontWeight:600,color:ct(t.amount),fontFamily:"monospace"},children:Bt(t.amount)})]}),u.jsx("div",{style:{fontWeight:500,fontSize:"0.9rem"},children:t.description||"Adjustment"}),u.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap",alignItems:"center"},children:[u.jsx("span",{style:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px"},children:e}),u.jsx("span",{style:{fontSize:"0.75rem",opacity:.6},children:f})]})]});const g={padding:"0.6rem 0.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem"};return u.jsxs("div",{style:{gridColumn:"1 / -1",background:p,display:"grid",gridTemplateColumns:"5rem 1.5fr 7rem 1fr 6rem 1fr 3rem 4rem"},children:[u.jsx("div",{style:{...g,fontSize:"0.85rem",fontFamily:"monospace"},children:u.jsx("span",{style:{opacity:.6},children:h})}),u.jsx("div",{style:{...g,justifyContent:"center"},children:u.jsx("span",{style:{fontSize:"0.8rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e})}),u.jsx("div",{style:{...g,overflow:"hidden"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.85rem",opacity:.7},children:f})}),u.jsx("div",{style:{...g,justifyContent:"flex-end",fontWeight:600,color:ct(t.amount),fontFamily:"monospace"},children:Bt(t.amount)}),u.jsx("div",{style:{...g,paddingLeft:"0.5rem",overflow:"hidden"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.8rem",opacity:.6},children:t.description||""})}),u.jsx("div",{style:{...g,justifyContent:"center",color:t.cleared?ge.success:"inherit",opacity:t.cleared?1:.3,fontSize:"1rem"},children:t.cleared?"":""}),u.jsxs("div",{style:{...g,justifyContent:"flex-end",gap:"0.25rem"},children:[u.jsx("button",{onClick:i,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:b=>b.currentTarget.style.opacity="1",onMouseLeave:b=>b.currentTarget.style.opacity="0.5",title:"Edit",children:""}),u.jsx("button",{onClick:o,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:b=>b.currentTarget.style.opacity="1",onMouseLeave:b=>b.currentTarget.style.opacity="0.5",title:"Delete",children:""})]})]})}const wo={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderTop:"1px solid rgba(255,255,255,0.1)"};function Cz(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n,setCurrentYear:r,setCurrentMonthNumber:i}=Ze(),{accounts:o,accountGroups:l,categories:d,categoryGroups:h}=On(),{month:f,isLoading:p}=Ys(t,e,n),{addAdjustment:g}=gB(),{updateAdjustment:b}=_B(),{deleteAdjustment:_}=bB(),w=Mi(),[x,S]=j.useState(null),[C,T]=j.useState(!1),[R,D]=j.useState(null),k=V0(t,{enabled:C||R!==null}).data||[];function M(O){const J=O.account_group_id?l[O.account_group_id]:void 0;return J&&J.is_active!==null?J.is_active:O.is_active!==!1}function B(O){const J=O.account_group_id?l[O.account_group_id]:void 0;return J&&J.on_budget!==null?J.on_budget:O.on_budget!==!1}const U=Object.entries(o).filter(([,O])=>M(O)&&B(O));function q(O,J,Y,G,Z,Q,te){if(!t)return;S(null),T(!1);const{year:z,month:H}=_m(G);(z!==e||H!==n)&&(r(z),i(H)),g(t,z,H,O,J,Y,G,Z,Q,te).catch(re=>{S(re instanceof Error?re.message:"Failed to add adjustment")})}function I(O,J,Y,G,Z,Q,te,z){t&&(S(null),D(null),b(t,e,n,O,J,Y,G,Z,Q,te,z).catch(H=>{S(H instanceof Error?H.message:"Failed to update adjustment")}))}function N(O){t&&confirm("Are you sure you want to delete this adjustment?")&&(S(null),_(t,e,n,O).catch(J=>{S(J instanceof Error?J.message:"Failed to delete adjustment")}))}return u.jsxs("div",{style:{opacity:p?.5:1,transition:"opacity 0.15s ease-out",pointerEvents:p?"none":"auto"},children:[x&&u.jsx("div",{style:{background:`color-mix(in srgb, ${ge.error} 15%, transparent)`,border:`1px solid ${ge.error}`,borderRadius:"8px",padding:"0.75rem",marginBottom:"1rem",color:ge.error},children:x}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:w?"1fr":"5rem 1fr 1fr 6rem 1.5fr 3rem 4rem"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"#242424",borderBottom:"1px solid rgba(255,255,255,0.15)",display:w?"block":"grid",gridTemplateColumns:w?void 0:"subgrid"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem"},children:[u.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[u.jsx("span",{style:{fontWeight:600},children:"Adjustments:"}),u.jsx("span",{style:{opacity:.6,fontSize:"0.8rem"},children:"Incoming or outgoing transactions that should bypass income and spend calculations"})]}),u.jsx("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:!C&&u.jsx($e,{actionName:"Open Add Adjustment Form",onClick:()=>T(!0),disabled:Object.keys(d).length===0&&U.length===0,disabledReason:"Create an account or category first",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:"+ Add Adjustment"})})]}),!w&&u.jsxs(u.Fragment,{children:[u.jsx("div",{style:wo,children:"Date"}),u.jsx("div",{style:{...wo,textAlign:"center"},children:"Category"}),u.jsx("div",{style:wo,children:"Account"}),u.jsx("div",{style:{...wo,textAlign:"right"},children:"Amount"}),u.jsx("div",{style:wo,children:"Description"}),u.jsx("div",{style:{...wo,textAlign:"center"},children:"Clr"}),u.jsx("div",{style:wo})]})]}),U.length===0&&Object.keys(d).length===0&&u.jsx(Ku,{message:"You need to create at least one account or category before adding adjustments.",linkText:"Manage accounts",linkTo:"/budget/settings/accounts"}),C&&u.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"1rem"},children:u.jsx(XS,{accounts:U,accountGroups:l,categories:d,categoryGroups:h,payees:k,defaultDate:ym(e,n),onSubmit:q,onCancel:()=>T(!1),submitLabel:"Add Adjustment"})}),f?.adjustments?.slice().sort((O,J)=>(O.date||"").localeCompare(J.date||"")).map((O,J)=>R===O.id?u.jsx("div",{style:{gridColumn:"1 / -1",padding:"0.5rem"},children:u.jsx(XS,{accounts:U,accountGroups:l,categories:d,categoryGroups:h,payees:k,initialData:O,onSubmit:(Y,G,Z,Q,te,z,H)=>I(O.id,Y,G,Z,Q,te,z,H),onCancel:()=>D(null),onDelete:()=>N(O.id),submitLabel:"Save"})},O.id):u.jsx(Ez,{adjustment:O,categoryName:ot(O.category_id)?Po:d[O.category_id]?.name||"Unknown Category",accountName:Ke(O.account_id)?Ba:o[O.account_id]?.nickname||"Unknown Account",accountGroupName:Ke(O.account_id)?void 0:o[O.account_id]?.account_group_id?l[o[O.account_id].account_group_id]?.name:void 0,onEdit:()=>{O.description||`${O.amount}`,D(O.id)},onDelete:()=>N(O.id),isMobile:w,isEvenRow:J%2===0},O.id)),(!f?.adjustments||f.adjustments.length===0)&&!C&&u.jsx("p",{style:{gridColumn:"1 / -1",opacity:.5,fontSize:"0.9rem",textAlign:"center",padding:"1.5rem"},children:"No adjustments recorded for this month"}),u.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]})]})}function Tz({isOpen:t,onClose:e,onDeleted:n}){const{addLoadingHold:r,removeLoadingHold:i}=jn(),{selectedBudgetId:o,currentYear:l,currentMonthNumber:d}=Ze(),{deleteAllocations:h}=cA(),[f,p]=j.useState(null),g=async()=>{if(o){p(null),r("allocations-delete","Deleting allocations...");try{await h({budgetId:o,year:l,month:d}),e(),n?.()}catch(b){p(b instanceof Error?b.message:"Failed to delete allocations")}finally{i("allocations-delete")}}};return u.jsxs(Qs,{isOpen:t,onClose:e,title:"Delete Allocations",children:[f&&u.jsx(wm,{message:f,onDismiss:()=>p(null)}),u.jsx("p",{style:{margin:"0 0 1.5rem 0"},children:"Are you sure you want to delete all allocations for this month? This will remove all allocated amounts and reset the month to unfinalized."}),u.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[u.jsx($e,{actionName:"Cancel Delete Allocations",variant:"secondary",onClick:e,children:"Cancel"}),u.jsx($e,{actionName:"Confirm Delete Allocations",variant:"danger",onClick:g,children:"Delete Allocations"})]})]})}function mA({isDraftMode:t,isEditingAppliedAllocations:e,availableNow:n,currentMonthIncome:r,balanceTotals:i,draftChangeAmount:o,availableAfterApply:l,currentDraftTotal:d}){const h=t&&d!==void 0?d:i.allocated;return u.jsxs(u.Fragment,{children:[u.jsx("span",{style:{fontWeight:600,marginRight:"0.25rem"},children:t||e?"Allocations Worksheet:":"Month Summary:"}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:t?"Avail: ":"Inc: "}),t?u.jsx("span",{style:{color:ct(n),fontWeight:600},children:Fn(n)}):u.jsx("span",{style:{color:ge.success,fontWeight:600},children:Fn(r)})]}),u.jsxs("span",{children:[t&&u.jsx("span",{style:{opacity:.6},children:" "}),u.jsx("span",{style:{opacity:.6},children:t?"Draft: ":"Alloc: "}),u.jsx("span",{style:{color:bc(t?h:i.allocated),fontWeight:600,...t?ds:{}},children:Fn(t?h:i.allocated)}),e&&o!==0&&u.jsxs("span",{style:{fontSize:"0.85em",color:o>0?ge.warning:ge.success,marginLeft:"0.25rem"},children:["(",Bt(o),")"]})]}),!t&&u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"Spent: "}),u.jsx("span",{style:{color:_c(i.spent),fontWeight:600},children:Fn(i.spent)})]}),u.jsxs("span",{children:[t&&u.jsx("span",{style:{opacity:.6},children:"= "}),u.jsx("span",{style:{opacity:.6},children:t?"Remaining: ":"Net: "}),t?u.jsx("span",{style:{color:ct(l),fontWeight:600,...ds},children:Fn(l)}):u.jsx("span",{style:{color:ct(i.allocated+i.spent),fontWeight:600},children:Fn(i.allocated+i.spent)})]})]})}function Az({totals:t}){return u.jsxs(u.Fragment,{children:[u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"Start: "}),u.jsx("span",{style:{color:ct(t.start),fontWeight:600},children:Fn(t.start)})]}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"Inc: "}),u.jsx("span",{style:{color:ge.success,fontWeight:600},children:Fn(t.income)})]}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"Exp: "}),u.jsx("span",{style:{color:_c(t.expenses),fontWeight:600},children:Fn(t.expenses)})]}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"End: "}),u.jsx("span",{style:{color:ct(t.end),fontWeight:600},children:Fn(t.end)})]})]})}function n_({isDraftMode:t,isEditingAppliedAllocations:e,allocationsFinalized:n,onSave:r,onApply:i,onEdit:o,onCancel:l,onDelete:d}){return u.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:[t&&!e&&u.jsxs(u.Fragment,{children:[u.jsx($e,{actionName:"Save Draft Allocations",onClick:r,variant:"secondary",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:" Save"}),u.jsx($e,{actionName:"Apply Allocations",onClick:i,variant:"secondary",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:" Apply"})]}),!t&&n&&u.jsx($e,{actionName:"Edit Allocations",onClick:o,variant:"secondary",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:" Edit Allocations"}),e&&u.jsxs(u.Fragment,{children:[u.jsx($e,{actionName:"Apply Allocations",onClick:i,variant:"secondary",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:" Apply"}),u.jsx($e,{actionName:"Cancel Edit Allocations",onClick:l,variant:"secondary",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:""}),u.jsx($e,{actionName:"Open Delete Allocations Modal",onClick:d,variant:"secondary",style:{fontSize:"0.8rem",padding:"0.4em 0.8em",color:ge.error},children:""})]})]})}function ZS(t){return t===0?ge.zero:t>0?ge.success:ge.error}function jz({category:t,balance:e,localAllocation:n,previousMonthIncome:r,isDraftMode:i,onAllocationChange:o,projectedAllTime:l}){const d=t.default_monthly_type==="percentage"&&t.default_monthly_amount!==void 0&&t.default_monthly_amount>0,h=d?t.default_monthly_amount/100*r:0,f=d?h.toFixed(2):n,p=i&&!d,g=i?l:t.balance??0,b=t.balance??0,_=b<0,w=_?Math.abs(b):0,x=d?h:parseFloat(n)||0,S=_?Math.min(x,w):0,C=_?Math.max(0,x-w):0,T=_&&x>0&&C>0;return u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",padding:"0.75rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem"},children:u.jsx("span",{style:{fontWeight:500},children:t.name})}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr 1fr 1fr",gap:"0.25rem",fontSize:"0.75rem"},children:[u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:"Start"}),u.jsx("span",{style:{color:dn(e.start_balance)},children:br(e.start_balance)})]}),u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:"Alloc"}),p?u.jsxs(u.Fragment,{children:[u.jsx("input",{type:"text",inputMode:"decimal",value:f?`$${f}`:"",onChange:R=>{const D=R.target.value.replace(/[^\d.]/g,"");o(D)},placeholder:"$0",style:{width:"100%",maxWidth:"80px",padding:"0.25rem 0.35rem",borderRadius:"4px",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",background:"color-mix(in srgb, currentColor 8%, transparent)",fontSize:"0.8rem",color:"inherit",boxSizing:"border-box"}}),_&&x>0&&u.jsxs("div",{style:{fontSize:"0.65rem",marginTop:"0.15rem",lineHeight:1.3},children:[u.jsxs("span",{style:{color:ge.debt,display:"block"},children:[Xt(S),"  debt"]}),T&&u.jsxs("span",{style:{color:ge.success,display:"block"},children:[Xt(C),"  balance"]})]})]}):u.jsx("span",{style:{color:bc(e.allocated)},children:Bt(e.allocated)})]}),u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:"Spent"}),u.jsx("span",{style:{color:_c(e.spent)},children:Pt(e.spent)})]}),u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:"End"}),u.jsx("span",{style:{color:dn(e.end_balance),...i&&!d?ds:{}},children:br(e.end_balance)})]}),u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:i?"Proj. All-Time":"All-Time"}),u.jsx("span",{style:{color:dn(g),...i&&!d?ds:{}},children:br(g)})]})]}),(e.transfers!==0||e.adjustments!==0)&&u.jsxs("div",{style:{marginTop:"0.5rem",paddingTop:"0.5rem",borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)",display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",fontSize:"0.7rem",opacity:.7},children:[e.transfers!==0&&u.jsxs("span",{style:{color:ZS(e.transfers)},children:[Bt(e.transfers)," transfers"]}),e.adjustments!==0&&u.jsxs("span",{style:{color:ZS(e.adjustments)},children:[Bt(e.adjustments)," adjust"]})]}),i&&d&&u.jsx("div",{style:{marginTop:"0.5rem"},children:u.jsxs("span",{style:{fontSize:"0.8rem"},children:[u.jsxs("span",{style:{opacity:.6},children:[Xt(r),"  "]}),u.jsxs("span",{style:{color:ge.success},children:[t.default_monthly_amount,"%"]}),u.jsx("span",{style:{opacity:.6},children:" = "}),u.jsx("span",{style:{color:ge.success},children:Xt(h)})]})})]})}function Ff(t){return t===0?ge.zero:t>0?ge.success:ge.error}function JS({name:t,categories:e,groupTotals:n,getCategoryBalance:r,localAllocations:i,savedAllocations:o,previousMonthIncome:l,isDraftMode:d,onAllocationChange:h,isMobile:f,isUngrouped:p,isFirstGroup:g=!1,getAllocationAmount:b,gridTemplateColumns:_}){const w={paddingTop:"0.6rem",paddingBottom:"0.6rem",paddingLeft:"0.5rem",paddingRight:"0.5rem",marginTop:g?0:"1.25rem",borderTop:"1px solid rgba(255,255,255,0.2)",borderBottom:za,background:"rgba(255,255,255,0.04)",display:"flex",alignItems:"center",fontSize:"0.9rem",fontWeight:600},x=n.allocated+n.spent+n.transfers+n.adjustments,S=e.reduce((C,[T,R])=>{const D=R.balance??0;let V=D;if(d){const $=b(T,R),k=o[T]??0,M=$-k;V=D+M}return C+Math.max(0,V)},0);return u.jsxs("div",{style:{display:"contents"},children:[!f&&u.jsxs(u.Fragment,{children:[u.jsxs("div",{style:{...w,paddingLeft:"0.5rem",opacity:p?.7:1},children:[u.jsx("span",{children:t}),u.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",e.length,")"]})]}),u.jsx("div",{style:{...w,justifyContent:"flex-end",color:dn(n.start)},children:Kt.showGroupTotals}),u.jsx("div",{style:{...w,justifyContent:d?"center":"flex-end",color:bc(n.allocated)},children:Kt.showGroupTotals}),u.jsx("div",{style:{...w,justifyContent:"flex-end",color:_c(n.spent)},children:Kt.showGroupTotals}),u.jsx("div",{style:{...w,justifyContent:"flex-end",color:Ff(n.transfers)},children:Kt.showGroupTotals}),u.jsx("div",{style:{...w,justifyContent:"flex-end",color:Ff(n.adjustments)},children:Kt.showGroupTotals}),u.jsx("div",{style:{...w,justifyContent:"flex-end",color:dn(x)},children:Kt.showGroupTotals}),u.jsx("div",{style:{...w,justifyContent:"flex-end",color:dn(n.end),paddingRight:"1rem",borderRight:"2px solid rgba(128, 128, 128, 0.4)"},children:Kt.showGroupTotals}),u.jsx("div",{style:{...w,justifyContent:"flex-end",color:dn(S)},children:Kt.showGroupTotals})]}),!d&&f&&u.jsxs("div",{style:{gridColumn:"1 / -1",paddingTop:"0.6rem",paddingBottom:"0.6rem",paddingLeft:"0.5rem",paddingRight:"0.5rem",marginTop:g?0:"1.25rem",borderTop:"1px solid rgba(255,255,255,0.2)",borderBottom:za,background:"rgba(255,255,255,0.04)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[u.jsxs("span",{style:{fontWeight:600,opacity:p?.7:1},children:[t,u.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",e.length,")"]})]}),Kt.showGroupTotals]}),e.map(([C,T],R)=>{const D=r(C);if(!D)return null;const V=T.balance??0;let $=V;if(d){const k=b(C,T),M=o[C]??0,B=k-M;$=V+B}return f?u.jsx("div",{style:{gridColumn:"1 / -1"},children:u.jsx(jz,{category:T,balance:D,localAllocation:i[C]||"",previousMonthIncome:l,isDraftMode:d,onAllocationChange:k=>h(C,k),projectedAllTime:$})},C):u.jsx(Rz,{category:T,balance:D,localAllocation:i[C]||"",previousMonthIncome:l,isDraftMode:d,onAllocationChange:k=>h(C,k),allTimeBalance:$,isEvenRow:R%2===0,gridTemplateColumns:_},C)})]})}function Rz({category:t,balance:e,localAllocation:n,previousMonthIncome:r,isDraftMode:i,onAllocationChange:o,allTimeBalance:l,isEvenRow:d,gridTemplateColumns:h}){const f=t.default_monthly_type==="percentage"&&t.default_monthly_amount!==void 0&&t.default_monthly_amount>0,p=f?t.default_monthly_amount/100*r:0,g=f?p.toFixed(2):n,b=t.balance??0,_=b<0,w=_?Math.abs(b):0,x=f?p:parseFloat(n)||0,S=_?Math.min(x,w):0,C=_?Math.max(0,x-w):0,T=_&&x>0&&C>0,R=d?"transparent":"rgba(255,255,255,0.04)",D={paddingTop:"0.6rem",paddingBottom:"0.6rem",paddingLeft:"0.5rem",paddingRight:"0.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem",minHeight:"2.4rem",boxSizing:"border-box"},V=e.allocated+e.spent+e.transfers+e.adjustments;return u.jsxs("div",{style:{gridColumn:"1 / -1",background:R,display:"grid",gridTemplateColumns:h},children:[u.jsx("div",{style:{paddingTop:"0.6rem",paddingBottom:"0.6rem",paddingRight:"0.5rem",paddingLeft:"1.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem",fontWeight:500,overflow:"hidden",borderLeft:"2px solid rgba(255,255,255,0.1)",minHeight:"2.4rem",boxSizing:"border-box"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.name})}),u.jsx("div",{style:{...D,justifyContent:"flex-end",color:dn(e.start_balance)},children:br(e.start_balance)}),i?u.jsx("div",{style:{...D,justifyContent:"center",flexDirection:"column",gap:"0.1rem"},children:f?u.jsxs("span",{style:{fontSize:"0.85rem"},children:[u.jsxs("span",{style:{color:ge.success},children:[t.default_monthly_amount,"%"]}),u.jsx("span",{style:{opacity:.5},children:" = "}),u.jsx("span",{style:{color:ge.success},children:Xt(p)})]}):u.jsxs(u.Fragment,{children:[u.jsx("input",{type:"text",inputMode:"decimal",value:g?`$${g}`:"",onChange:$=>{const k=$.target.value.replace(/[^\d.]/g,"");o(k)},placeholder:"$0.00",style:{width:"100px",padding:"0.2rem 0.5rem",borderRadius:"4px",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"0.9rem",lineHeight:1,color:"inherit",boxSizing:"border-box"}}),_&&x>0&&u.jsxs("div",{style:{fontSize:"0.6rem",whiteSpace:"nowrap",textAlign:"center",lineHeight:1.3,display:"flex",flexDirection:"column",alignItems:"center"},children:[u.jsxs("span",{style:{color:ge.debt},children:[Xt(S),"  debt"]}),T&&u.jsxs("span",{style:{color:ge.success},children:[Xt(C),"  bal"]})]})]})}):(()=>{const $=e.start_balance<0,k=$?Math.abs(e.start_balance):0,M=$?Math.min(e.allocated,k):0,B=$?Math.max(0,e.allocated-k):0,U=$&&e.allocated>0;return u.jsxs("div",{style:{...D,justifyContent:"flex-end",flexDirection:"column",alignItems:"flex-end",gap:"0.1rem",color:bc(e.allocated)},children:[u.jsxs("span",{children:["+",Xt(e.allocated)]}),U&&u.jsxs("div",{style:{fontSize:"0.6rem",whiteSpace:"nowrap",textAlign:"right",lineHeight:1.3,display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[u.jsxs("span",{style:{color:ge.debt},children:[Xt(M),"  debt"]}),B>0&&u.jsxs("span",{style:{color:ge.success},children:[Xt(B),"  bal"]})]})]})})(),u.jsx("div",{style:{...D,justifyContent:"flex-end",color:_c(e.spent)},children:Pt(e.spent)}),u.jsx("div",{style:{...D,justifyContent:"flex-end",color:Ff(e.transfers)},children:Bt(e.transfers)}),u.jsx("div",{style:{...D,justifyContent:"flex-end",color:Ff(e.adjustments)},children:Bt(e.adjustments)}),u.jsx("div",{style:{...D,justifyContent:"flex-end",color:dn(V),...i&&!f?ds:{}},children:Bt(V)}),u.jsx("div",{style:{...D,justifyContent:"flex-end",fontWeight:600,color:dn(e.end_balance),paddingRight:"1rem",borderRight:"2px solid rgba(128, 128, 128, 0.4)",...i&&!f?ds:{}},children:br(e.end_balance)}),u.jsx("div",{style:{...D,justifyContent:"flex-end",color:dn(l),...i&&!f?ds:{}},children:br(l)})]})}function Iz(t,e){const{includeHidden:n=!1}={},r=Object.entries(t).filter(([,i])=>n||!i.is_hidden).reduce((i,[o,l])=>{const d=l.category_group_id||"ungrouped";return i[d]||(i[d]=[]),i[d].push([o,l]),i},{});return Object.keys(r).forEach(i=>{r[i].sort((o,l)=>o[1].sort_order-l[1].sort_order)}),r}function Dz(t,e,n,r,i){const o={};t?.category_balances&&t.category_balances.forEach(d=>{o[d.category_id]=d});const l={};return Object.entries(e).forEach(([d,h])=>{const f=o[d],p=Ae(f?.start_balance??0);let g=0;n?g=Ae(i(d,h)):r&&f&&(g=Ae(f.allocated));const b=wT(d,t?.expenses||[]),_=ST(d,t?.transfers||[]),w=ET(d,t?.adjustments||[]);l[d]={category_id:d,start_balance:p,allocated:g,spent:b,transfers:_,adjustments:w,end_balance:Ae(p+g+b+_+w)}}),l}function kz(t,e){const n={};t?.account_balances&&t.account_balances.forEach(i=>{n[i.account_id]=i});const r={};return Object.entries(e).forEach(([i,o])=>{const l=n[i],d=Ae(l?.start_balance??o.balance);let h=0;t?.income&&(h=Ae(t.income.filter(_=>_.account_id===i).reduce((_,w)=>_+w.amount,0)));let f=0;t?.expenses&&(f=Ae(t.expenses.filter(_=>_.account_id===i).reduce((_,w)=>_+w.amount,0)));let p=0;if(t?.transfers){let _=0;t.transfers.forEach(w=>{w.to_account_id===i&&(_+=w.amount),w.from_account_id===i&&(_-=w.amount)}),p=Ae(_)}let g=0;t?.adjustments&&(g=Ae(t.adjustments.filter(_=>_.account_id===i).reduce((_,w)=>_+w.amount,0)));const b=Ae(h+f+p+g);r[i]={account_id:i,start_balance:d,income:h,expenses:f,transfers:p,adjustments:g,net_change:b,end_balance:Ae(d+b)}}),r}function Mz(t){return Object.values(t).reduce((e,n)=>({start:e.start+n.start_balance,income:e.income+n.income,expenses:e.expenses+n.expenses,transfers:e.transfers+n.transfers,adjustments:e.adjustments+n.adjustments,netChange:e.netChange+n.net_change,end:e.end+n.end_balance}),{start:0,income:0,expenses:0,transfers:0,adjustments:0,netChange:0,end:0})}function Oz(t){return Object.values(t).reduce((e,n)=>({start:e.start+n.start_balance,allocated:e.allocated+n.allocated,spent:e.spent+n.spent,transfers:e.transfers+n.transfers,adjustments:e.adjustments+n.adjustments,end:e.end+Math.max(0,n.end_balance)}),{start:0,allocated:0,spent:0,transfers:0,adjustments:0,end:0})}function pA(t,e){const n={},r={};return t?.account_balances&&t.account_balances.forEach(i=>{r[i.account_id]=i}),t?(Object.entries(e).forEach(([i,o])=>{const l=r[i],d=Ae(l?.start_balance??o.balance);let h=0,f=0;t?.income&&t.income.filter(T=>T.account_id===i).forEach(T=>{f+=T.amount,h+=T.amount});let p=0,g=0;t?.expenses&&t.expenses.filter(T=>T.account_id===i).forEach(T=>{g+=T.amount,T.cleared===!0&&(p+=T.amount)});let b=0,_=0;t?.transfers&&t.transfers.forEach(T=>{T.to_account_id===i&&(_+=T.amount,T.cleared===!0&&(b+=T.amount)),T.from_account_id===i&&(_-=T.amount,T.cleared===!0&&(b-=T.amount))});let w=0,x=0;t?.adjustments&&t.adjustments.filter(T=>T.account_id===i).forEach(T=>{x+=T.amount,T.cleared===!0&&(w+=T.amount)});const S=Ae(h+p+b+w),C=Ae(f+g+_+x);n[i]={account_id:i,cleared_balance:Ae(d+S),uncleared_balance:Ae(d+C)}}),n):(Object.entries(e).forEach(([i,o])=>{const l=Ae(o.balance??0);n[i]={account_id:i,cleared_balance:l,uncleared_balance:l}}),n)}function e1(t){return t===0?ge.zero:t>0?ge.success:ge.error}function Nz({isDraftMode:t,allocationsFinalized:e,balanceTotals:n,grandAllTime:r,onSave:i,onApply:o,onEdit:l,onCancel:d,onDelete:h}){const f={paddingTop:"0.6rem",paddingBottom:"0.6rem",paddingLeft:"0.5rem",paddingRight:"0.5rem",borderTop:"2px solid rgba(255,255,255,0.3)",borderBottom:"2px solid rgba(255,255,255,0.3)",fontWeight:600,display:"flex",alignItems:"center",fontSize:"0.9rem"},p=n.allocated+n.spent+n.transfers+n.adjustments;return u.jsxs(u.Fragment,{children:[u.jsxs("div",{style:{...f,gap:"0.75rem"},children:["Grand Totals",!t&&u.jsx(n_,{isDraftMode:!1,isEditingAppliedAllocations:!1,allocationsFinalized:e,onSave:i,onApply:o,onEdit:l,onCancel:d,onDelete:h})]}),u.jsx("div",{style:{...f,justifyContent:"flex-end",color:dn(n.start)},children:br(n.start)}),u.jsxs("div",{style:{...f,justifyContent:t?"center":"flex-end",color:bc(n.allocated),...t?ds:{}},children:["+",Xt(n.allocated)]}),u.jsx("div",{style:{...f,justifyContent:"flex-end",color:_c(n.spent)},children:Pt(n.spent)}),u.jsx("div",{style:{...f,justifyContent:"flex-end",color:e1(n.transfers)},children:Bt(n.transfers)}),u.jsx("div",{style:{...f,justifyContent:"flex-end",color:e1(n.adjustments)},children:Bt(n.adjustments)}),u.jsx("div",{style:{...f,justifyContent:"flex-end",color:dn(p),...t?ds:{}},children:Bt(p)}),u.jsx("div",{style:{...f,justifyContent:"flex-end",color:dn(n.end),paddingRight:"1rem",borderRight:"2px solid rgba(128, 128, 128, 0.4)",...t?ds:{}},children:br(n.end)}),u.jsx("div",{style:{...f,justifyContent:"flex-end",color:dn(r),...t?ds:{}},children:br(r)})]})}function Pz({allocationsFinalized:t,availableNow:e,currentMonthIncome:n,balanceTotals:r,draftChangeAmount:i,availableAfterApply:o,currentDraftTotal:l,onSave:d,onApply:h,onEdit:f,onCancel:p,onDelete:g}){return u.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem",borderTop:"2px solid rgba(255,255,255,0.3)",borderBottom:"2px solid rgba(255,255,255,0.3)"},children:[u.jsx("span",{style:{fontWeight:600},children:"Grand Totals:"}),u.jsx(mA,{isDraftMode:!1,isEditingAppliedAllocations:!1,availableNow:e,currentMonthIncome:n,balanceTotals:r,draftChangeAmount:i,availableAfterApply:o,currentDraftTotal:l}),u.jsx(n_,{isDraftMode:!1,isEditingAppliedAllocations:!1,allocationsFinalized:t,onSave:d,onApply:h,onEdit:f,onCancel:p,onDelete:g})]})}const gi={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderBottom:"2px solid rgba(255,255,255,0.2)"};function Bz(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n}=Ze(),{categories:r,categoryGroups:i}=On(),{month:o}=Ys(t,e,n),l=Mi(),[d,h]=j.useState(!1),{localAllocations:f,isEditingAppliedAllocations:p,error:g,availableNow:b,currentDraftTotal:_,draftChangeAmount:w,availableAfterApply:x,previousMonthIncome:S,currentMonthIncome:C,allocationsFinalized:T,getAllocationAmount:R,handleAllocationChange:D,resetAllocationsToSaved:V,handleSaveAllocations:$,handleFinalizeAllocations:k,setIsEditingAppliedAllocations:M,setError:B}=c3(),U=[...i].sort((te,z)=>te.sort_order-z.sort_order),q=j.useMemo(()=>Iz(r),[r]),I=!T||p,N=j.useMemo(()=>Dz(o,r,I,T,R),[o,r,I,T,R]),O=te=>N[te],J=j.useMemo(()=>Oz(N),[N]),Y=j.useMemo(()=>{const te={};if(o?.category_balances)for(const z of o.category_balances)te[z.category_id]=z.allocated;return te},[o]),G=j.useMemo(()=>Object.entries(r).reduce((te,[z,H])=>{const re=H.balance??0;let ne=re;if(I){const ce=R(z,H),he=Y[z]??0,we=ce-he;ne=re+we}return te+Math.max(0,ne)},0),[r,I,R,Y]),Z=j.useMemo(()=>Object.values(r).reduce((te,z)=>te+Math.max(0,z.balance??0),0),[r]);j.useEffect(()=>{if(!t||I)return;if(Math.abs(G-Z)>.01){const z=Math.abs(G-Z);console.error("[MonthCategories] Month View vs Settings Mismatch:",{grandAllTime:G,settingsPageAllocated:Z,difference:z,message:'Month view "ALL-TIME" does not match settings page "Allocated" total. These should always match.'}),Jn.add({type:"error",message:`Balance display mismatch: Month view "ALL-TIME" (${Xt(G)})  Settings "Allocated" (${Xt(Z)}). Difference: ${Xt(z)}. Budget may need recalculation.`,autoDismissMs:1e4})}},[G,Z,I,t]);const Q={onSave:$,onApply:k,onEdit:()=>M(!0),onCancel:V,onDelete:()=>h(!0)};return u.jsxs(u.Fragment,{children:[g&&u.jsx(wm,{message:g,onDismiss:()=>B(null)}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:l?"1fr":I?"2fr 1fr 200px 1fr 1fr 1fr 1fr 1fr 120px":"2fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 120px"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"#242424",display:l?"block":"grid",gridTemplateColumns:l?void 0:"subgrid"},children:[I&&u.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexDirection:l?"column":"row",flexWrap:"wrap",alignItems:l?"stretch":"center",gap:l?"0.5rem":"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:l?"0.5rem":"0.25rem"},children:[u.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:l?void 0:1,alignItems:"center"},children:u.jsx(mA,{isDraftMode:I,isEditingAppliedAllocations:p,availableNow:b,currentMonthIncome:C,balanceTotals:J,draftChangeAmount:w,availableAfterApply:x,currentDraftTotal:_})}),u.jsx(n_,{isDraftMode:I,isEditingAppliedAllocations:p,allocationsFinalized:T,...Q})]}),!l&&u.jsxs(u.Fragment,{children:[u.jsx("div",{style:gi,children:"Category"}),u.jsx("div",{style:{...gi,textAlign:"right"},children:"Start"}),u.jsx("div",{style:{...gi,textAlign:I?"center":"right"},children:"Allocated"}),u.jsx("div",{style:{...gi,textAlign:"right"},children:"Spent"}),u.jsx("div",{style:{...gi,textAlign:"right"},children:"Transfers"}),u.jsx("div",{style:{...gi,textAlign:"right"},children:"Adjust"}),u.jsx("div",{style:{...gi,textAlign:"right"},children:"Net Change"}),u.jsx("div",{style:{...gi,textAlign:"right",paddingRight:"1rem",borderRight:"2px solid rgba(128, 128, 128, 0.4)"},children:"End"}),u.jsx("div",{style:{...gi,textAlign:"right"},children:"All-Time"})]}),!l&&u.jsx(Nz,{isDraftMode:I,allocationsFinalized:T,balanceTotals:J,grandAllTime:G,...Q}),!I&&l&&u.jsx(Pz,{allocationsFinalized:T,availableNow:b,currentMonthIncome:C,balanceTotals:J,draftChangeAmount:w,availableAfterApply:x,currentDraftTotal:_,...Q})]}),Object.keys(r).length===0&&u.jsxs("p",{style:{gridColumn:"1 / -1",opacity:.6,textAlign:"center",padding:"2rem"},children:["No categories yet. ",u.jsx(Tn,{to:"/budget/settings/categories",style:{opacity:1},children:"Create categories "})]}),U.map((te,z)=>{const H=q[te.id]||[];if(H.length===0)return null;const re=H.reduce((ne,[ce])=>{const he=O(ce);return he?{start:ne.start+he.start_balance,allocated:ne.allocated+he.allocated,spent:ne.spent+he.spent,transfers:ne.transfers+he.transfers,adjustments:ne.adjustments+he.adjustments,end:ne.end+he.end_balance}:ne},{start:0,allocated:0,spent:0,transfers:0,adjustments:0,end:0});return u.jsx(JS,{name:te.name,categories:H,groupTotals:re,getCategoryBalance:O,localAllocations:f,savedAllocations:Y,previousMonthIncome:S,isDraftMode:I,onAllocationChange:D,isMobile:l,isFirstGroup:z===0,getAllocationAmount:R,gridTemplateColumns:I?"2fr 1fr 200px 1fr 1fr 1fr 1fr 1fr 120px":"2fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 120px"},te.id)}),q[Jt]?.length>0&&(()=>{const te=q[Jt],z=te.reduce((re,[ne])=>{const ce=O(ne);return ce?{start:re.start+ce.start_balance,allocated:re.allocated+ce.allocated,spent:re.spent+ce.spent,transfers:re.transfers+ce.transfers,adjustments:re.adjustments+ce.adjustments,end:re.end+ce.end_balance}:re},{start:0,allocated:0,spent:0,transfers:0,adjustments:0,end:0}),H=U.length===0;return u.jsx(JS,{name:"Uncategorized",categories:te,groupTotals:z,getCategoryBalance:O,localAllocations:f,savedAllocations:Y,previousMonthIncome:S,isDraftMode:I,onAllocationChange:D,isMobile:l,isUngrouped:!0,isFirstGroup:H,getAllocationAmount:R,gridTemplateColumns:I?"2fr 1fr 200px 1fr 1fr 1fr 1fr 1fr 120px":"2fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 120px"},Jt)})(),u.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]}),u.jsx(Tz,{isOpen:d,onClose:()=>h(!1),onDeleted:()=>M(!1)})]})}function gA(t){return t===0?ge.zero:t>0?ge.success:ge.error}function yA(t){return t===0?ge.zero:t<0?ge.error:ge.success}function xa(t){return t===0?ge.zero:t>0?ge.success:ge.error}function t1({name:t,accounts:e,groupTotals:n,accountBalances:r,accountClearedBalances:i,isMobile:o,isUngrouped:l,isFirstGroup:d=!1}){const h={padding:"0.6rem 0.5rem",marginTop:d?0:"1.25rem",borderTop:"1px solid rgba(255,255,255,0.2)",borderBottom:za,background:"rgba(255,255,255,0.04)",display:"flex",alignItems:"center",fontSize:"0.9rem",fontWeight:600};return u.jsxs("div",{style:{display:"contents"},children:[!o&&u.jsxs(u.Fragment,{children:[u.jsxs("div",{style:{...h,opacity:l?.7:1},children:[u.jsx("span",{children:t}),u.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",e.length,")"]})]}),u.jsx("div",{style:{...h,justifyContent:"flex-end",color:ct(n.start)},children:Kt.showGroupTotals}),u.jsx("div",{style:{...h,justifyContent:"flex-end",color:gA(n.income)},children:Kt.showGroupTotals}),u.jsx("div",{style:{...h,justifyContent:"flex-end",color:yA(n.expenses)},children:Kt.showGroupTotals}),u.jsx("div",{style:{...h,justifyContent:"flex-end",color:xa(n.transfers)},children:Kt.showGroupTotals}),u.jsx("div",{style:{...h,justifyContent:"flex-end",color:xa(n.adjustments)},children:Kt.showGroupTotals}),u.jsx("div",{style:{...h,justifyContent:"flex-end",color:xa(n.netChange)},children:Kt.showGroupTotals}),u.jsx("div",{style:{...h,justifyContent:"flex-end",color:ct(n.end)},children:Kt.showGroupTotals}),u.jsx("div",{style:{...h,justifyContent:"flex-end"},children:Kt.showGroupTotals}),u.jsx("div",{style:{...h,justifyContent:"flex-end"},children:Kt.showGroupTotals}),u.jsx("div",{style:{...h,justifyContent:"flex-end"},children:Kt.showGroupTotals})]}),o&&u.jsxs("div",{style:{gridColumn:"1 / -1",padding:"0.6rem 0.5rem",marginTop:d?0:"1.25rem",borderTop:"1px solid rgba(255,255,255,0.2)",borderBottom:za,background:"rgba(255,255,255,0.04)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[u.jsxs("span",{style:{fontWeight:600,opacity:l?.7:1},children:[t,u.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",e.length,")"]})]}),Kt.showGroupTotals]}),e.map(([f,p],g)=>{const b=r[f];if(!b)return null;const _=i?.[f];return o?u.jsx("div",{style:{gridColumn:"1 / -1"},children:u.jsx(Lz,{account:p,balance:b,clearedBalance:_})},f):u.jsx(zz,{account:p,balance:b,clearedBalance:_,isEvenRow:g%2===0},f)})]})}function zz({account:t,balance:e,clearedBalance:n,isEvenRow:r}){const i=r?"transparent":"rgba(255,255,255,0.04)",o={padding:"0.5rem 0.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem"};return u.jsxs("div",{style:{gridColumn:"1 / -1",background:i,display:"grid",gridTemplateColumns:"2fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr"},children:[u.jsx("div",{style:{...o,fontWeight:500,overflow:"hidden",paddingLeft:"1.5rem",borderLeft:"2px solid rgba(255,255,255,0.1)"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.nickname})}),u.jsx("div",{style:{...o,justifyContent:"flex-end",color:ct(e.start_balance)},children:Pt(e.start_balance)}),u.jsxs("div",{style:{...o,justifyContent:"flex-end",color:gA(e.income)},children:["+",Xt(e.income)]}),u.jsx("div",{style:{...o,justifyContent:"flex-end",color:yA(e.expenses)},children:Pt(e.expenses)}),u.jsx("div",{style:{...o,justifyContent:"flex-end",color:xa(e.transfers)},children:Bt(e.transfers)}),u.jsx("div",{style:{...o,justifyContent:"flex-end",color:xa(e.adjustments)},children:Bt(e.adjustments)}),u.jsx("div",{style:{...o,justifyContent:"flex-end",color:xa(e.net_change)},children:Bt(e.net_change)}),u.jsx("div",{style:{...o,justifyContent:"flex-end",fontWeight:600,color:ct(e.end_balance)},children:Pt(e.end_balance)}),n?u.jsx("div",{style:{...o,justifyContent:"flex-end",color:ct(n.uncleared_balance),fontWeight:600},children:Pt(n.uncleared_balance)}):u.jsx("div",{style:{...o,justifyContent:"flex-end",opacity:.3,color:"#9ca3af"},children:""}),n?u.jsx("div",{style:{...o,justifyContent:"flex-end",color:ct(n.cleared_balance)},children:Math.abs(n.uncleared_balance-n.cleared_balance)<.01?u.jsx("span",{style:{opacity:.3,color:"#9ca3af"},children:""}):Pt(n.cleared_balance)}):u.jsx("div",{style:{...o,justifyContent:"flex-end",opacity:.3,color:"#9ca3af"},children:""}),n&&Math.abs(n.uncleared_balance-n.cleared_balance)>=.01?u.jsx("div",{style:{...o,justifyContent:"flex-end",color:xa(n.uncleared_balance-n.cleared_balance)},children:Bt(n.uncleared_balance-n.cleared_balance)}):u.jsx("div",{style:{...o,justifyContent:"flex-end",opacity:.3,color:"#9ca3af"},children:""})]})}function Lz({account:t,balance:e,clearedBalance:n}){return u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",padding:"0.75rem",marginBottom:"0.25rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem"},children:u.jsx("span",{style:{fontWeight:500},children:t.nickname})}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:n&&Math.abs(n.uncleared_balance-n.cleared_balance)>=.01?"1fr 1fr 1fr 1fr":"1fr 1fr 1fr",gap:"0.25rem",fontSize:"0.75rem"},children:[u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:"Start"}),u.jsx("span",{children:Pt(e.start_balance)})]}),u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:"Net Change"}),u.jsx("span",{style:{color:ct(e.net_change)},children:Bt(e.net_change)})]}),u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:"End"}),u.jsx("span",{style:{color:ct(e.end_balance)},children:Pt(e.end_balance)})]}),n&&u.jsxs(u.Fragment,{children:[u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:"Total"}),u.jsx("span",{style:{color:ct(n.uncleared_balance),fontWeight:600},children:Pt(n.uncleared_balance)})]}),Math.abs(n.uncleared_balance-n.cleared_balance)>=.01?u.jsxs(u.Fragment,{children:[u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:"Cleared"}),u.jsx("span",{style:{color:ct(n.cleared_balance)},children:Pt(n.cleared_balance)})]}),u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:"Uncleared"}),u.jsx("span",{style:{color:xa(n.uncleared_balance-n.cleared_balance)},children:Bt(n.uncleared_balance-n.cleared_balance)})]})]}):u.jsxs(u.Fragment,{children:[u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:"Cleared"}),u.jsx("span",{style:{opacity:.3,color:"#9ca3af"},children:""})]}),u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:"Uncleared"}),u.jsx("span",{style:{opacity:.3,color:"#9ca3af"},children:""})]})]})]})]}),(e.income!==0||e.expenses!==0||e.transfers!==0||e.adjustments!==0)&&u.jsxs("div",{style:{marginTop:"0.5rem",paddingTop:"0.5rem",borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)",display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",fontSize:"0.7rem",opacity:.7},children:[e.income!==0&&u.jsxs("span",{children:[Bt(e.income)," income"]}),e.expenses!==0&&u.jsxs("span",{children:[Pt(e.expenses)," expenses"]}),e.transfers!==0&&u.jsxs("span",{children:[Bt(e.transfers)," transfers"]}),e.adjustments!==0&&u.jsxs("span",{children:[Bt(e.adjustments)," adjust"]})]})]})}const ls={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderBottom:"2px solid rgba(255,255,255,0.2)"};function Uz(t){return t===0?ge.zero:t>0?ge.success:ge.error}function Fz(t){return t===0?ge.zero:t<0?ge.error:ge.success}function Zg(t){return t===0?ge.zero:t>0?ge.success:ge.error}function Vz(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n}=Ze(),{accounts:r,accountGroups:i}=On(),{month:o}=Ys(t,e,n),l=Mi(),d=j.useMemo(()=>Object.entries(i).map(([x,S])=>({id:x,...S})).sort((x,S)=>x.sort_order-S.sort_order),[i]),h=j.useMemo(()=>{const x={};return Object.entries(r).filter(([,S])=>!S.is_hidden).forEach(([S,C])=>{const T=C.account_group_id||en;x[T]||(x[T]=[]),x[T].push([S,C])}),Object.keys(x).forEach(S=>{x[S].sort((C,T)=>C[1].sort_order-T[1].sort_order)}),x},[r]),f=j.useMemo(()=>kz(o,r),[o,r]),p=j.useMemo(()=>pA(o,r),[o,r]),g=j.useMemo(()=>Mz(f),[f]),b=g.income+g.expenses,w={...{padding:"0.6rem 0.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem"},borderTop:"2px solid rgba(255,255,255,0.3)",borderBottom:"2px solid rgba(255,255,255,0.3)",fontWeight:600};return u.jsx(u.Fragment,{children:u.jsxs("div",{style:{display:"grid",gridTemplateColumns:l?"1fr":"2fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"#242424",display:l?"block":"grid",gridTemplateColumns:l?void 0:"subgrid"},children:[!l&&u.jsxs(u.Fragment,{children:[u.jsx("div",{style:ls,children:"Account"}),u.jsx("div",{style:{...ls,textAlign:"right"},children:"Start"}),u.jsx("div",{style:{...ls,textAlign:"right"},children:"Income"}),u.jsx("div",{style:{...ls,textAlign:"right"},children:"Expenses"}),u.jsx("div",{style:{...ls,textAlign:"right"},children:"Transfers"}),u.jsx("div",{style:{...ls,textAlign:"right"},children:"Adjust"}),u.jsx("div",{style:{...ls,textAlign:"right"},children:"Net Change"}),u.jsx("div",{style:{...ls,textAlign:"right"},children:"End"}),u.jsx("div",{style:{...ls,textAlign:"right"},children:"Total"}),u.jsx("div",{style:{...ls,textAlign:"right"},children:"Cleared"}),u.jsx("div",{style:{...ls,textAlign:"right"},children:"Uncleared"})]}),l?u.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem",borderTop:"2px solid rgba(255,255,255,0.3)",borderBottom:"2px solid rgba(255,255,255,0.3)"},children:[u.jsx("span",{style:{fontWeight:600},children:"Grand Totals:"}),u.jsx(Az,{totals:g})]}):u.jsxs(u.Fragment,{children:[u.jsx("div",{style:{...w},children:"Grand Totals"}),u.jsx("div",{style:{...w,justifyContent:"flex-end",color:ct(g.start)},children:Pt(g.start)}),u.jsxs("div",{style:{...w,justifyContent:"flex-end",color:Uz(g.income)},children:["+",Xt(g.income)]}),u.jsx("div",{style:{...w,justifyContent:"flex-end",color:Fz(g.expenses)},children:Pt(g.expenses)}),u.jsx("div",{style:{...w,justifyContent:"flex-end",color:Zg(g.transfers)},children:Bt(g.transfers)}),u.jsx("div",{style:{...w,justifyContent:"flex-end",color:Zg(g.adjustments)},children:Bt(g.adjustments)}),u.jsx("div",{style:{...w,justifyContent:"flex-end",color:Zg(b)},children:Bt(b)}),u.jsx("div",{style:{...w,justifyContent:"flex-end",color:ct(g.end)},children:Pt(g.end)}),u.jsx("div",{style:{...w,justifyContent:"flex-end"},children:Object.keys(p).length>0?Pt(Object.values(p).reduce((x,S)=>x+S.uncleared_balance,0)):u.jsx("span",{style:{opacity:.3,color:"#9ca3af"},children:""})}),u.jsx("div",{style:{...w,justifyContent:"flex-end"},children:(()=>{if(Object.keys(p).length===0)return u.jsx("span",{style:{opacity:.3,color:"#9ca3af"},children:""});const x=Object.values(p).reduce((C,T)=>C+T.cleared_balance,0),S=Object.values(p).reduce((C,T)=>C+T.uncleared_balance,0);return Math.abs(S-x)<.01?u.jsx("span",{style:{opacity:.3,color:"#9ca3af"},children:""}):Pt(x)})()}),u.jsx("div",{style:{...w,justifyContent:"flex-end"},children:(()=>{if(Object.keys(p).length===0)return u.jsx("span",{style:{opacity:.3,color:"#9ca3af"},children:""});const x=Object.values(p).reduce((T,R)=>T+R.cleared_balance,0),C=Object.values(p).reduce((T,R)=>T+R.uncleared_balance,0)-x;return Math.abs(C)<.01?u.jsx("span",{style:{opacity:.3,color:"#9ca3af"},children:""}):Bt(C)})()})]})]}),Object.keys(r).length===0&&u.jsxs("p",{style:{gridColumn:"1 / -1",opacity:.6,textAlign:"center",padding:"2rem"},children:["No accounts yet."," ",u.jsx(Tn,{to:"/budget/settings/accounts",style:{opacity:1},children:"Add accounts "})]}),d.map((x,S)=>{const C=h[x.id]||[];if(C.length===0)return null;const T=C.reduce((R,[D])=>{const V=f[D];return V?{start:R.start+V.start_balance,income:R.income+V.income,expenses:R.expenses+V.expenses,transfers:R.transfers+V.transfers,adjustments:R.adjustments+V.adjustments,netChange:R.netChange+V.net_change,end:R.end+V.end_balance}:R},{start:0,income:0,expenses:0,transfers:0,adjustments:0,netChange:0,end:0});return u.jsx(t1,{name:x.name,accounts:C,groupTotals:T,accountBalances:f,accountClearedBalances:p,isMobile:l,isFirstGroup:S===0},x.id)}),h[en]?.length>0&&(()=>{const x=h[en],S=x.reduce((T,[R])=>{const D=f[R];return D?{start:T.start+D.start_balance,income:T.income+D.income,expenses:T.expenses+D.expenses,transfers:T.transfers+D.transfers,adjustments:T.adjustments+D.adjustments,netChange:T.netChange+D.net_change,end:T.end+D.end_balance}:T},{start:0,income:0,expenses:0,transfers:0,adjustments:0,netChange:0,end:0}),C=d.length===0;return u.jsx(t1,{name:"Ungrouped",accounts:x,groupTotals:S,accountBalances:f,accountClearedBalances:p,isMobile:l,isUngrouped:!0,isFirstGroup:C},en)})(),u.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]})})}const $z=["income","categories","accounts","spend","transfers","adjustments"];function n1(t){const e=t.year?parseInt(t.year,10):null,n=t.month?parseInt(t.month,10):null,r=t.tab&&$z.includes(t.tab)?t.tab:null;return{year:e&&!isNaN(e)&&e>=2e3&&e<=2100?e:null,month:n&&!isNaN(n)&&n>=1&&n<=12?n:null,tab:r}}function qz(){const t=new Date;return{year:t.getFullYear(),month:t.getMonth()+1}}function r1(){const t=$5(),e=Xu(),[n,r]=I1(),{addLoadingHold:i,removeLoadingHold:o}=jn(),{selectedBudgetId:l,setSelectedBudgetId:d,currentYear:h,currentMonthNumber:f,lastActiveTab:p,setCurrentYear:g,setCurrentMonthNumber:b,setLastActiveTab:_,setPageTitle:w,goToPreviousMonth:x,goToNextMonth:S,hasPendingInvites:C,needsFirstBudget:T,initialDataLoadComplete:R}=Ze(),{budget:D,isLoading:V}=On(),$=!V,[k,M]=j.useState(!1);j.useEffect(()=>(!$||!R?i("budget-data","Loading budget data..."):o("budget-data"),()=>o("budget-data")),[$,R,i,o]);const B=j.useRef(!1),U=n.get("error"),[q,I]=j.useState(U);j.useEffect(()=>{U&&(n.delete("error"),r(n,{replace:!0}))},[U,n,r]);const[N,O]=j.useState(()=>{const{tab:H}=n1(t);return H??p}),J=H=>{O(H),_(H)};j.useEffect(()=>{if(B.current)return;const{year:H,month:re}=n1(t);H&&g(H),re&&b(re),B.current=!0},[t,g,b]),j.useEffect(()=>{if(!B.current)return;const H=`/budget/${h}/${f}/${N}`,re=`/budget/${t.year}/${t.month}/${t.tab}`;H!==re&&e(H,{replace:!0})},[h,f,N,e,t]);const{month:Y,error:G,isLoading:Z}=Ys($&&R?l:null,h,f);j.useEffect(()=>{if(!G||k)return;const H=G.message||"";if(H.includes("Budget")&&H.includes("does not exist")){queueMicrotask(()=>{d(null),e("/budget/my-budgets?context=budget-not-found",{replace:!0})});return}(H.includes("months in the past")||H.includes("Refusing to create month"))&&queueMicrotask(()=>{i("month-redirect","Redirecting to current month..."),M(!0);const{year:re,month:ne}=qz();I(`Cannot create month ${h}/${f} - it's too far in the past. Redirected to current month.`),g(re),b(ne)})},[G,k,h,f,g,b,i,d,e]),j.useEffect(()=>{k&&Y&&!Z&&queueMicrotask(()=>{M(!1),o("month-redirect")})},[k,Y,Z,o]),j.useLayoutEffect(()=>{w(D?.name||"Budget")},[D?.name,w]);const{setCurrentViewingDocument:Q}=Ze();if(j.useEffect(()=>(D&&h&&f&&Q({type:"month",year:h,month:f}),()=>{Q({type:null})}),[D,h,f,Q]),j.useEffect(()=>{if($&&!k){if(!D&&!l){e("/budget/my-budgets",{replace:!0});return}if(!D&&C){e("/budget/my-budgets",{replace:!0});return}if(T){e("/budget/my-budgets",{replace:!0});return}}},[$,k,D,l,C,T,e]),S3(R?l:null,h,f),I3({budgetId:l,viewingYear:h,viewingMonth:f,initialDataLoadComplete:R,enabled:!!l&&R}),!$||!R||k||!D)return null;function te(){I(null),x()}function z(){I(null),S()}return u.jsxs(u.Fragment,{children:[q&&u.jsx(wm,{message:q,onDismiss:()=>I(null)}),u.jsx(dz,{onPreviousMonth:te,onNextMonth:z}),u.jsx(nz,{activeTab:N,setActiveTab:J,allocationsFinalized:Y?.are_allocations_finalized}),N==="income"&&u.jsx(gz,{},`${h}-${f}`),N==="categories"&&u.jsx(Bz,{},`${h}-${f}`),N==="accounts"&&u.jsx(Vz,{},`${h}-${f}`),N==="spend"&&u.jsx(_z,{},`${h}-${f}`),N==="transfers"&&u.jsx(Sz,{},`${h}-${f}`),N==="adjustments"&&u.jsx(Cz,{},`${h}-${f}`)]})}function Hz(){const{setPageTitle:t}=Ze();return j.useLayoutEffect(()=>{t("Analytics")},[t]),u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"50vh",textAlign:"center",gap:"1.5rem"},children:[u.jsx("div",{style:{fontSize:"4rem",opacity:.8},children:""}),u.jsx("h1",{style:{margin:0,fontSize:"2rem",fontWeight:600},children:"Analytics"}),u.jsx("p",{style:{margin:0,fontSize:"1.25rem",opacity:.6,maxWidth:"400px"},children:"Coming Soon"}),u.jsx("p",{style:{margin:0,fontSize:"0.95rem",opacity:.5,maxWidth:"500px",lineHeight:1.6},children:"Track spending trends, category breakdowns, and insights about your budget over time."}),u.jsx(Tn,{to:"/budget",style:{marginTop:"1rem",padding:"0.75rem 1.5rem",background:ge.primary,color:"white",borderRadius:"8px",textDecoration:"none",fontWeight:500,transition:"opacity 0.15s"},children:"Back to Budget"})]})}function Gz(){const t=Ut();return{createBudget:Hn({mutationFn:async({name:n,userId:r,userEmail:i})=>{const o=`budget_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,l=new Date().toISOString(),d={name:n.trim()||"My Budget",user_ids:[r],accepted_user_ids:[r],owner_id:r,owner_email:i,accounts:{},account_groups:{[en]:{name:"Ungrouped",sort_order:0,expected_balance:"positive",on_budget:null,is_active:null}},categories:{},category_groups:[{id:Jt,name:"Uncategorized",sort_order:0}],month_map:{},created_at:l,updated_at:l};return await cr("budgets",o,d,"creating new budget document"),await cr("users",r,{uid:r,email:i,budget_ids:$u(o),updated_at:l},"adding new budget to user's budget list",{merge:!0}),{budgetId:o,budget:{id:o,...d}}},onSuccess:(n,{userId:r})=>{t.invalidateQueries({queryKey:Ce.user(r)}),t.invalidateQueries({queryKey:Ce.accessibleBudgets(r)})}})}}function Wz(){const t=Ut();return{acceptInvite:Hn({mutationFn:async({budgetId:n,userId:r})=>{const i=new Date().toISOString(),{exists:o,data:l}=await Lt("budgets",n,"validating user was invited to this budget");if(!o||!l)throw new Error("Budget not found");if(!l.user_ids?.includes(r))throw new Error("You have not been invited to this budget");if(l.accepted_user_ids?.includes(r))throw new Error("You have already accepted this invite");return await cr("users",r,{uid:r,budget_ids:$u(n),updated_at:i},"adding accepted budget to user's budget list",{merge:!0}),await cr("budgets",n,{accepted_user_ids:$u(r),updated_at:i},"marking user as accepted in budget's accepted_user_ids",{merge:!0}),{budgetId:n}},onSuccess:(n,{userId:r})=>{t.invalidateQueries({queryKey:Ce.user(r)}),t.invalidateQueries({queryKey:Ce.accessibleBudgets(r)}),t.invalidateQueries({queryKey:Ce.budget(n.budgetId)})}})}}function Qz(){const t=Ut(),e=Hn({onMutate:async r=>{const{budgetId:i,userId:o}=r,l=Ce.budget(i);await t.cancelQueries({queryKey:l});const d=t.getQueryData(l);return d&&t.setQueryData(l,{...d,budget:{...d.budget,user_ids:[...d.budget.user_ids,o]}}),{previousData:d}},mutationFn:async r=>{const{budgetId:i,userId:o}=r,{exists:l,data:d}=await Lt("budgets",i,"validating user is not already invited");if(!l||!d)throw new Error("Budget not found");if(d.user_ids?.includes(o))throw new Error("User is already invited");return await gd({budgetId:i,updates:{user_ids:$u(o)},description:"adding user to budget's invited users list"}),{budgetId:i}},onError:(r,i,o)=>{o?.previousData&&t.setQueryData(Ce.budget(i.budgetId),o.previousData)}});return{inviteUser:{mutate:r=>e.mutate(r),mutateAsync:r=>e.mutateAsync(r),isPending:e.isPending,isError:e.isError,error:e.error,reset:e.reset}}}function Kz(){const t=Ut(),e=Hn({onMutate:async r=>{const{budgetId:i,userId:o}=r,l=Ce.budget(i);await t.cancelQueries({queryKey:l});const d=t.getQueryData(l);return d&&t.setQueryData(l,{...d,budget:{...d.budget,user_ids:d.budget.user_ids.filter(h=>h!==o),accepted_user_ids:d.budget.accepted_user_ids.filter(h=>h!==o)}}),{previousData:d}},mutationFn:async r=>{const{budgetId:i,userId:o}=r;return await gd({budgetId:i,updates:{user_ids:jS(o),accepted_user_ids:jS(o)},description:"removing user from budget's access lists"}),{budgetId:i}},onError:(r,i,o)=>{o?.previousData&&t.setQueryData(Ce.budget(i.budgetId),o.previousData)}});return{revokeUser:{mutate:r=>e.mutate(r),mutateAsync:r=>e.mutateAsync(r),isPending:e.isPending,isError:e.isError,error:e.error,reset:e.reset}}}function Yz({message:t,onDismiss:e}){return u.jsxs("div",{style:{background:"rgba(220, 38, 38, 0.1)",border:"1px solid rgba(220, 38, 38, 0.3)",color:"#f87171",padding:"0.75rem 1rem",borderRadius:"8px",marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[u.jsx("span",{children:t}),u.jsx("button",{onClick:e,style:{background:"transparent",border:"none",color:"#f87171",cursor:"pointer",fontSize:"1.2rem",padding:"0 0.25rem",lineHeight:1},children:""})]})}function Xz({message:t,onDismiss:e}){return u.jsxs("div",{style:{background:"rgba(34, 197, 94, 0.1)",border:"1px solid rgba(34, 197, 94, 0.3)",color:"#4ade80",padding:"0.75rem 1rem",borderRadius:"8px",marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[u.jsx("span",{children:t}),u.jsx("button",{onClick:e,style:{background:"transparent",border:"none",color:"#4ade80",cursor:"pointer",fontSize:"1.2rem",padding:"0 0.25rem",lineHeight:1},children:""})]})}function Zz({budgetIdInput:t,setBudgetIdInput:e,isCheckingManual:n,manualInvite:r,isAccepting:i,onCheckInvite:o,onAcceptInvite:l,onCancel:d}){return u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px"},children:[u.jsxs("h3",{style:{margin:"0 0 0.75rem 0",fontSize:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{children:""})," Join Budget by ID"]}),u.jsx("p",{style:{margin:"0 0 1rem 0",fontSize:"0.9rem",opacity:.7},children:"If someone shared a budget ID with you, enter it below to accept the invitation:"}),r?u.jsxs("div",{style:{background:"color-mix(in srgb, #22c55e 10%, transparent)",border:"1px solid color-mix(in srgb, #22c55e 30%, transparent)",padding:"1rem",borderRadius:"8px"},children:[u.jsx("p",{style:{margin:"0 0 0.75rem 0",fontWeight:500},children:" You've been invited to join:"}),u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 8%, transparent)",padding:"0.75rem 1rem",borderRadius:"6px",marginBottom:"1rem"},children:[u.jsx("p",{style:{margin:"0 0 0.25rem 0",fontWeight:600,fontSize:"1.1rem"},children:r.budgetName}),r.ownerEmail&&u.jsxs("p",{style:{margin:0,fontSize:"0.9rem",opacity:.7},children:["Owner: ",r.ownerEmail]})]}),u.jsxs("div",{style:{display:"flex",gap:"0.75rem"},children:[u.jsx("button",{onClick:l,disabled:i===r.budgetId,style:{background:"#22c55e",color:"white",border:"none",padding:"0.6rem 1.25rem",borderRadius:"6px",cursor:i===r.budgetId?"not-allowed":"pointer",fontWeight:500,opacity:i===r.budgetId?.7:1},children:i===r.budgetId?"Accepting...":"Accept Invitation"}),u.jsx("button",{onClick:d,disabled:i===r.budgetId,style:{background:"transparent",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)",padding:"0.6rem 1.25rem",borderRadius:"6px",cursor:i===r.budgetId?"not-allowed":"pointer",fontWeight:500,opacity:i===r.budgetId?.7:.8},children:"Cancel"})]})]}):u.jsxs("form",{onSubmit:o,style:{display:"flex",gap:"0.75rem"},children:[u.jsx("input",{type:"text",value:t,onChange:h=>e(h.target.value),placeholder:"Enter Budget ID",style:{flex:1,padding:"0.6rem 0.8rem",borderRadius:"6px",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"0.95rem",color:"inherit"}}),u.jsx("button",{type:"submit",disabled:n||!t.trim(),style:{background:"#646cff",color:"white",border:"none",padding:"0.6rem 1.25rem",borderRadius:"6px",cursor:n||!t.trim()?"not-allowed":"pointer",fontWeight:500,opacity:n||!t.trim()?.7:1,whiteSpace:"nowrap"},children:n?"Checking...":"Check Invite"})]})]})}function Jz({currentUserId:t}){return u.jsxs("div",{style:{marginTop:"1.5rem",padding:"1rem",background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"6px",fontSize:"0.85rem",opacity:.7},children:[u.jsx("p",{style:{margin:"0 0 0.5rem 0"},children:" Share your User ID with budget owners so they can invite you:"}),u.jsx("code",{style:{display:"block",padding:"0.5rem 0.75rem",background:"color-mix(in srgb, currentColor 8%, transparent)",borderRadius:"4px",fontSize:"0.8rem",wordBreak:"break-all"},children:t})]})}function eL(){const{addLoadingHold:t,removeLoadingHold:e}=jn(),{selectedBudgetId:n,currentUserId:r,accessibleBudgets:i,loadAccessibleBudgets:o,switchToBudget:l,checkBudgetInvite:d,isInitialized:h,setPageTitle:f,needsFirstBudget:p}=Ze(),{requireUserEmail:g}=ki(),b=j.useRef(!1),[_,w]=I1(),x=_.get("context");j.useEffect(()=>{x&&(_.delete("context"),w(_,{replace:!0}))},[x,_,w]);const S=x==="budget-not-found",C=p&&i.length===0;j.useLayoutEffect(()=>{f("My Budgets")},[f]),j.useEffect(()=>{h&&!b.current&&(b.current=!0,o())},[h,o]);const{budget:T,isLoading:R}=On(),{renameBudget:D}=a3(),{acceptInvite:V}=Wz(),{createBudget:$}=Gz(),[k,M]=j.useState(null),[B,U]=j.useState(null),[q,I]=j.useState(null),[N,O]=j.useState(null),[J,Y]=j.useState(null),[G,Z]=j.useState(""),[Q,te]=j.useState(!1),[z,H]=j.useState(""),[re,ne]=j.useState(!1),[ce,he]=j.useState(null),[we,oe]=j.useState(""),[be,Me]=j.useState(!1);async function ze(ie){if(ie!==T?.id){M(ie),I(null),O(null);try{await l(ie),O("Switched to budget successfully!"),await o({force:!0})}catch(Re){I(Re instanceof Error?Re.message:"Failed to switch budget")}finally{M(null)}}}async function at(ie){if(r){U(ie),I(null),O(null);try{await V.mutateAsync({budgetId:ie,userId:r}),O("Invitation accepted! You now have access to this budget."),await o({force:!0})}catch(Re){I(Re instanceof Error?Re.message:"Failed to accept invitation")}finally{U(null)}}}async function lt(ie){if(ie.preventDefault(),!!z.trim()){ne(!0),I(null),he(null);try{const Re=await d(z.trim());Re?he(Re):I("No pending invitation found for this budget ID. Make sure you've been invited by the budget owner.")}catch(Re){I(Re instanceof Error?Re.message:"Failed to check invitation")}finally{ne(!1)}}}async function L(){if(!(!ce||!r)){ce.budgetName,U(ce.budgetId),I(null);try{await V.mutateAsync({budgetId:ce.budgetId,userId:r}),O(`Successfully joined "${ce.budgetName}"!`),he(null),H(""),await o({force:!0})}catch(ie){I(ie instanceof Error?ie.message:"Failed to accept invitation")}finally{U(null)}}}function de(ie,Re){Z(Re),Y(ie)}async function ye(ie){if(ie.preventDefault(),!(!G.trim()||!J||!n)){G.trim(),te(!0),I(null),O(null);try{await D.mutateAsync({budgetId:n,newName:G.trim()}),O("Budget renamed successfully!"),Y(null),await o({force:!0})}catch(Re){I(Re instanceof Error?Re.message:"Failed to rename budget")}finally{te(!1)}}}async function ee(ie){if(ie.preventDefault(),!!r){we.trim(),Me(!0),I(null),O(null);try{const Re=await $.mutateAsync({name:we.trim()||"My Budget",userId:r,userEmail:g()});await l(Re.budgetId),O("Budget created successfully!"),oe(""),await o({force:!0})}catch(Re){I(Re instanceof Error?Re.message:"Failed to create budget")}finally{Me(!1)}}}const X=i.filter(ie=>!ie.isPending),ae=i.filter(ie=>ie.isPending);if(j.useEffect(()=>(R||!h?t("my-budgets","Loading your budgets..."):e("my-budgets"),()=>e("my-budgets")),[R,h,t,e]),R||!h)return null;let Ee="My Budgets",Se="Switch between budgets, accept invitations, or create a new budget.";return S?(Ee="Budget Not Found",Se="Your selected budget could not be found. It may have been deleted. Select another budget or create a new one."):C&&(Ee="Welcome!",Se="Get started by creating your first budget or accepting an invitation."),u.jsxs("div",{children:[u.jsx("h1",{children:Ee}),u.jsx("p",{style:{opacity:.7,marginBottom:"1.5rem"},children:Se}),q&&u.jsx(Yz,{message:q,onDismiss:()=>I(null)}),N&&u.jsx(Xz,{message:N,onDismiss:()=>O(null)}),ae.length>0&&u.jsxs("div",{style:{background:"color-mix(in srgb, #f59e0b 10%, transparent)",border:"1px solid color-mix(in srgb, #f59e0b 30%, transparent)",padding:"1.25rem",borderRadius:"8px",marginBottom:"1.5rem"},children:[u.jsxs("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{children:""})," Pending Invitations (",ae.length,")"]}),u.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:ae.map(ie=>u.jsx(qS,{budget:ie,isCurrent:!1,isAccepting:B===ie.id,isSwitching:!1,isEditing:!1,editName:"",isRenaming:!1,onAccept:()=>at(ie.id),onSwitch:()=>{},onStartEdit:()=>{},onCancelEdit:()=>{},onEditNameChange:()=>{},onSaveEdit:()=>{}},ie.id))})]}),X.length>0&&u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px",marginBottom:"1.5rem"},children:[u.jsxs("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{children:""})," Your Budgets (",X.length,")"]}),u.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:X.map(ie=>u.jsx(qS,{budget:ie,isCurrent:ie.id===n,isAccepting:!1,isSwitching:k===ie.id,isEditing:J===ie.id,editName:J===ie.id?G:"",isRenaming:Q,onAccept:()=>{},onSwitch:()=>ze(ie.id),onStartEdit:()=>de(ie.id,ie.name),onCancelEdit:()=>{Y(null),Z("")},onEditNameChange:Z,onSaveEdit:ye},ie.id))})]}),u.jsxs("div",{style:{background:"color-mix(in srgb, #646cff 8%, transparent)",border:"1px solid color-mix(in srgb, #646cff 25%, transparent)",padding:"1.5rem",borderRadius:"8px",marginBottom:"1.5rem"},children:[u.jsxs("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{children:""})," Create New Budget"]}),u.jsxs("form",{onSubmit:ee,children:[u.jsxs("div",{style:{marginBottom:"1rem"},children:[u.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.9rem",opacity:.8},children:"Budget Name"}),u.jsx("input",{type:"text",value:we,onChange:ie=>oe(ie.target.value),placeholder:"My Budget",style:{width:"100%",padding:"0.6rem 0.8rem",borderRadius:"6px",border:"1px solid color-mix(in srgb, currentColor 25%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"0.95rem",color:"inherit",boxSizing:"border-box"}}),u.jsx("p",{style:{margin:"0.5rem 0 0 0",fontSize:"0.8rem",opacity:.5},children:"You can always rename this later"})]}),u.jsx("button",{type:"submit",disabled:be,style:{background:ge.primary,color:"white",border:"none",padding:"0.6rem 1.5rem",borderRadius:"6px",cursor:be?"not-allowed":"pointer",fontWeight:500,opacity:be?.7:1,fontSize:"0.9rem"},children:be?"Creating...":"Create Budget"})]})]}),u.jsx(Zz,{budgetIdInput:z,setBudgetIdInput:H,isCheckingManual:re,manualInvite:ce,isAccepting:B,onCheckInvite:lt,onAcceptInvite:L,onCancel:()=>{he(null),H("")}}),r&&u.jsx(Jz,{currentUserId:r})]})}const tL=["accounts","categories","users"];function nL(){const{addLoadingHold:t,removeLoadingHold:e}=jn(),{lastSettingsTab:n,setLastSettingsTab:r,setPageTitle:i,selectedBudgetId:o,setCurrentViewingDocument:l}=Ze();j.useLayoutEffect(()=>{i("Budget Settings")},[i]),j.useEffect(()=>(o&&l({type:"budget"}),()=>{l({type:null})}),[o,l]);const{isOwner:d,isLoading:h,isFetching:f}=On();j.useEffect(()=>(h||f?t("settings","Loading settings..."):e("settings"),()=>e("settings")),[h,f,t,e]);const p=tr(),g=p.pathname==="/budget/settings",b=j.useMemo(()=>{const C=p.pathname;return C.includes("/settings/accounts")?"accounts":C.includes("/settings/categories")?"categories":C.includes("/settings/users")?"users":"categories"},[p.pathname]),_=b==="users";j.useEffect(()=>{g||r(b)},[b,g,r]);function w(){return!tL.includes(n)||n==="users"&&!d?"categories":n}const x=j.useMemo(()=>[{id:"accounts",label:"Accounts",icon:""},{id:"categories",label:"Categories",icon:""},{id:"users",label:"Users",icon:"",hidden:!d}],[d]);return h||f?null:!d&&_?u.jsxs("div",{children:[u.jsx("h1",{children:"Access Denied"}),u.jsx("p",{style:{opacity:.7},children:"Only the budget owner can access this section."}),u.jsx("p",{style:{marginTop:"1rem"},children:u.jsx(Tn,{to:"/budget/settings/categories",children:"Go to Categories "})})]}):u.jsxs("div",{children:[u.jsx(Lf,{mode:"link",linkPrefix:"/budget/settings",tabs:x,activeTab:g?w():b}),g?u.jsx($f,{to:`/budget/settings/${w()}`,replace:!0}):u.jsx(lA,{children:u.jsx(qf,{})})]})}function r_({initialData:t,onSubmit:e,onCancel:n,submitLabel:r,accountGroups:i,showGroupSelector:o=!1,showIncomeSettings:l=!1,hasExistingIncomeDefault:d=!1,hasExistingOutgoDefault:h=!1,currentGroupId:f,onDelete:p}){const[g,b]=j.useState(t||{nickname:"",account_group_id:null,is_income_account:!1,is_income_default:!1,is_outgo_account:!1,is_outgo_default:!1,on_budget:!0,is_active:!0,is_hidden:!1}),_=g.account_group_id||f,w=_?i.find(D=>D.id===_):null,x=!!(w&&w.is_active!==null),S=!!(w&&w.on_budget!==null);function C(D){D.preventDefault(),g.nickname.trim()&&e(g)}function T(D){b({...g,is_income_account:D,is_income_default:D?g.is_income_default:!1})}function R(D){b({...g,is_outgo_account:D,is_outgo_default:D?g.is_outgo_default:!1})}return u.jsxs(Ri,{actionName:r==="Create Account"?"Create Account":"Update Account",onSubmit:C,children:[u.jsx(Nt,{label:"Account Nickname",htmlFor:"account-nickname",children:u.jsx(Ii,{id:"account-nickname",type:"text",value:g.nickname,onChange:D=>b({...g,nickname:D.target.value}),placeholder:"e.g., Main Checking, Savings",required:!0,autoFocus:!0})}),o&&u.jsx(Nt,{label:"Account Type",htmlFor:"account-group",children:u.jsxs(Qu,{id:"account-group",value:g.account_group_id||en,onChange:D=>b({...g,account_group_id:D.target.value===en?null:D.target.value}),children:[u.jsx("option",{value:en,children:"Ungrouped"}),i.map(D=>u.jsx("option",{value:D.id,children:D.name},D.id))]})}),l&&u.jsxs("div",{style:{padding:"0.75rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",display:"flex",flexDirection:"column",gap:"0.75rem"},children:[u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[u.jsx("p",{style:{margin:0,fontSize:"0.85rem",opacity:.7},children:"Account Status"}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[u.jsx(Qr,{id:"is-active",checked:(()=>{if(x&&w){const D=w.is_active;return D===null||D===void 0?!1:D}return g.is_active??!0})(),onChange:D=>b({...g,is_active:D.target.checked}),disabled:x,children:u.jsx("span",{style:{opacity:x?.5:1},children:"Active account"})}),x&&w&&u.jsxs("p",{style:{margin:0,fontSize:"0.7rem",opacity:.6,marginLeft:"2rem",color:ge.warning},children:['Set by account type "',w.name,'"']})]}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[u.jsx(Qr,{id:"on-budget",checked:(()=>{if(S&&w){const D=w.on_budget;return D===null||D===void 0?!1:D}return g.on_budget??!0})(),onChange:D=>b({...g,on_budget:D.target.checked}),disabled:S,children:u.jsx("span",{style:{opacity:S?.5:1},children:"On budget (affects budget totals)"})}),S&&w&&u.jsxs("p",{style:{margin:0,fontSize:"0.7rem",opacity:.6,marginLeft:"2rem",color:ge.warning},children:['Set by account type "',w.name,'"']})]}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[u.jsx(Qr,{id:"is-hidden",checked:g.is_hidden||!1,onChange:D=>b({...g,is_hidden:D.target.checked}),children:"Hidden account"}),u.jsx("p",{style:{margin:0,fontSize:"0.7rem",opacity:.6,marginLeft:"2rem"},children:"Hidden accounts don't appear in dropdowns or balance displays. Use for historical accounts that aren't actively used."})]})]}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[u.jsx("p",{style:{margin:0,fontSize:"0.85rem",opacity:.7},children:"Income Settings"}),u.jsx(Qr,{id:"is-income-account",checked:g.is_income_account||!1,onChange:D=>T(D.target.checked),children:"Show in income deposit list"}),g.is_income_account&&u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem",marginLeft:"2rem"},children:[u.jsx(Qr,{id:"is-income-default",checked:g.is_income_default||!1,onChange:D=>b({...g,is_income_default:D.target.checked}),disabled:d&&!t?.is_income_default,children:"Default account for new income"}),d&&!t?.is_income_default&&u.jsx("p",{style:{margin:0,fontSize:"0.75rem",opacity:.5},children:"Another account is already set as default"})]})]}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[u.jsx("p",{style:{margin:0,fontSize:"0.85rem",opacity:.7},children:"Expense Settings"}),u.jsx(Qr,{id:"is-outgo-account",checked:g.is_outgo_account||!1,onChange:D=>R(D.target.checked),children:"Show in expense account list"}),g.is_outgo_account&&u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem",marginLeft:"2rem"},children:[u.jsx(Qr,{id:"is-outgo-default",checked:g.is_outgo_default||!1,onChange:D=>b({...g,is_outgo_default:D.target.checked}),disabled:h&&!t?.is_outgo_default,children:"Default account for new expenses"}),h&&!t?.is_outgo_default&&u.jsx("p",{style:{margin:0,fontSize:"0.75rem",opacity:.5},children:"Another account is already set as default"})]})]})]}),u.jsxs(qa,{children:[u.jsx($e,{type:"submit",actionName:r,children:r}),u.jsx($e,{type:"button",variant:"secondary",actionName:"Cancel Account Form",onClick:n,children:"Cancel"}),p&&u.jsx($e,{type:"button",variant:"secondary",actionName:"Delete Account",onClick:D=>{D.preventDefault(),p()},style:{color:"#ff6b6b",borderColor:"#ff6b6b"},children:" Delete"})]})]})}function s1({label:t,value:e,onChange:n,trueLabel:r,falseLabel:i,undefinedLabel:o}){function l(){n(e===void 0?!0:e===!0?!1:void 0)}const d=e===!0?r:e===!1?i:o,h=e===!0?ge.success:e===!1?ge.warning:"inherit",f=e===!0?"":e===!1?"":"";return u.jsxs("button",{type:"button",onClick:l,style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 0.75rem",background:e!==void 0?`color-mix(in srgb, ${h} 15%, transparent)`:"color-mix(in srgb, currentColor 8%, transparent)",border:e!==void 0?`1px solid color-mix(in srgb, ${h} 40%, transparent)`:"1px solid color-mix(in srgb, currentColor 20%, transparent)",borderRadius:"6px",cursor:"pointer",fontSize:"0.85rem",color:"inherit",textAlign:"left",width:"100%"},children:[u.jsx("span",{style:{width:"1.25rem",height:"1.25rem",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"4px",background:e!==void 0?h:"color-mix(in srgb, currentColor 20%, transparent)",color:e!==void 0?"white":"inherit",fontWeight:600,fontSize:"0.75rem"},children:f}),u.jsxs("span",{style:{flex:1},children:[u.jsxs("span",{style:{opacity:.7},children:[t,":"]})," ",u.jsx("span",{style:{fontWeight:500,color:h},children:d})]}),u.jsx("span",{style:{fontSize:"0.7rem",opacity:.5},children:"click to cycle"})]})}function i1({initialData:t,onSubmit:e,onCancel:n,submitLabel:r}){const[i,o]=j.useState(t||{name:"",expected_balance:"positive"});function l(d){d.preventDefault(),i.name.trim()&&e(i)}return u.jsxs(Ri,{actionName:r==="Create Account Type"?"Create Account Type":"Update Account Type",onSubmit:l,children:[u.jsx(Nt,{label:"Account Type Name",htmlFor:"group-name",children:u.jsx(Ii,{id:"group-name",type:"text",value:i.name,onChange:d=>o({...i,name:d.target.value}),placeholder:"e.g., Checking, Savings, Credit Cards, Investments",required:!0,autoFocus:!0})}),u.jsx(Nt,{label:"Expected Balance",htmlFor:"expected-balance",children:u.jsxs(Qu,{id:"expected-balance",value:i.expected_balance,onChange:d=>o({...i,expected_balance:d.target.value}),children:[u.jsx("option",{value:"positive",children:"Normally Positive (e.g., Checking, Savings)"}),u.jsx("option",{value:"negative",children:"Normally Negative (e.g., Credit Cards, Loans)"}),u.jsx("option",{value:"any",children:"Either (no warnings)"})]})}),u.jsxs("div",{style:{padding:"0.75rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",display:"flex",flexDirection:"column",gap:"0.5rem"},children:[u.jsxs("p",{style:{margin:0,fontSize:"0.85rem",opacity:.7},children:["Group-Level Overrides ",u.jsx("span",{style:{fontSize:"0.75rem",opacity:.6},children:"(applies to all accounts in this type)"})]}),u.jsx(s1,{label:"Active status",value:i.is_active,onChange:d=>o({...i,is_active:d}),trueLabel:"All active",falseLabel:"All inactive",undefinedLabel:"Per account"}),u.jsx(s1,{label:"Budget status",value:i.on_budget,onChange:d=>o({...i,on_budget:d}),trueLabel:"All on budget",falseLabel:"All off budget",undefinedLabel:"Per account"})]}),u.jsxs(qa,{children:[u.jsx($e,{type:"submit",actionName:r,children:r}),u.jsx($e,{type:"button",variant:"secondary",actionName:"Cancel Account Type Form",onClick:n,children:"Cancel"})]})]})}function Nl({icon:t,label:e,variant:n,title:r}){const o={success:{background:`color-mix(in srgb, ${ge.success} 20%, transparent)`,border:`1px solid color-mix(in srgb, ${ge.success} 40%, transparent)`,color:ge.success,opacity:1},warning:{background:`color-mix(in srgb, ${ge.warning} 15%, transparent)`,border:`1px solid color-mix(in srgb, ${ge.warning} 35%, transparent)`,color:ge.warning,opacity:1},muted:{background:"color-mix(in srgb, currentColor 12%, transparent)",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",color:"inherit",opacity:.7},income:{background:`color-mix(in srgb, ${ge.success} 10%, transparent)`,border:`1px solid color-mix(in srgb, ${ge.success} 25%, transparent)`,color:ge.success,opacity:.7},expense:{background:`color-mix(in srgb, ${ge.warning} 10%, transparent)`,border:`1px solid color-mix(in srgb, ${ge.warning} 25%, transparent)`,color:ge.warning,opacity:.7}}[n];return u.jsxs("span",{title:r||e,style:{display:"inline-flex",alignItems:"center",gap:"0.25rem",background:o.background,border:o.border,padding:"0.15rem 0.4rem",borderRadius:"4px",fontSize:"0.7rem",fontWeight:500,textTransform:"uppercase",letterSpacing:"0.3px",color:o.color,opacity:o.opacity,whiteSpace:"nowrap"},children:[u.jsx("span",{style:{fontSize:"0.75rem"},children:t}),e]})}function a1({account:t,accountGroups:e}){const n=[],r=t.account_group_id?e.find(l=>l.id===t.account_group_id):null,i=r&&r.is_active!==null?r.is_active:t.is_active!==!1,o=r&&r.on_budget!==null?r.on_budget:t.on_budget!==!1;if(!i){const l=r&&r.is_active!==null;n.push(u.jsx(Nl,{icon:"",label:l?"Inactive (type)":"Inactive",variant:"warning",title:l?`Set by "${r.name}" account type`:"Account is inactive/archived"},"inactive"))}if(!o){const l=r&&r.on_budget!==null;n.push(u.jsx(Nl,{icon:"",label:l?"Off Budget (type)":"Off Budget",variant:"warning",title:l?`Set by "${r.name}" account type`:"Tracking only - not included in budget"},"off-budget"))}return t.is_income_default?n.push(u.jsx(Nl,{icon:"",label:"Income Default",variant:"success",title:"Default income deposit account"},"income-default")):t.is_income_account&&n.push(u.jsx(Nl,{icon:"",label:"Income",variant:"income",title:"Income deposit account"},"income")),t.is_outgo_default?n.push(u.jsx(Nl,{icon:"",label:"Expense Default",variant:"warning",title:"Default expense account"},"outgo-default")):t.is_outgo_account&&n.push(u.jsx(Nl,{icon:"",label:"Expense",variant:"expense",title:"Expense account"},"outgo")),n.length===0?null:u.jsx(u.Fragment,{children:n})}function rL({account:t,accountIndex:e,allGroups:n,allAccounts:r,clearedBalance:i,onEdit:o,onDelete:l,onMoveUp:d,onMoveDown:h,canMoveUp:f,canMoveDown:p,editingAccountId:g,setEditingAccountId:b,onUpdateAccount:_,isMobile:w}){if(g===t.id)return u.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"0.5rem"},children:u.jsx(r_,{initialData:{nickname:t.nickname,account_group_id:t.account_group_id,is_income_account:t.is_income_account,is_income_default:t.is_income_default,is_outgo_account:t.is_outgo_account,is_outgo_default:t.is_outgo_default,on_budget:t.on_budget,is_active:t.is_active},onSubmit:T=>{_(t.id,T),b(null)},onCancel:()=>b(null),onDelete:()=>{t.nickname,l(t.id),b(null)},submitLabel:"Save",accountGroups:n,showGroupSelector:!0,showIncomeSettings:!0,currentGroupId:t.account_group_id,hasExistingIncomeDefault:Object.entries(r).some(([T,R])=>R.is_income_default&&T!==t.id),hasExistingOutgoDefault:Object.entries(r).some(([T,R])=>R.is_outgo_default&&T!==t.id)})});if(w)return u.jsx("div",{style:{gridColumn:"1 / -1"},children:u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",padding:"0.75rem",marginBottom:"0.25rem"},children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"},children:[u.jsx("span",{style:{fontWeight:500},children:t.nickname}),u.jsx("div",{style:{display:"flex",gap:"1rem",fontSize:"0.85rem"},children:i?u.jsxs(u.Fragment,{children:[u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[u.jsx("span",{style:{opacity:.6,fontSize:"0.7rem"},children:"Total"}),u.jsx("span",{style:{color:ct(i.uncleared_balance),fontWeight:600},children:Pt(i.uncleared_balance)})]}),Math.abs(i.uncleared_balance-i.cleared_balance)>=.01?u.jsxs(u.Fragment,{children:[u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[u.jsx("span",{style:{opacity:.6,fontSize:"0.7rem"},children:"Cleared"}),u.jsx("span",{style:{color:ct(i.cleared_balance)},children:Pt(i.cleared_balance)})]}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[u.jsx("span",{style:{opacity:.6,fontSize:"0.7rem"},children:"Uncleared"}),u.jsx("span",{style:{color:ct(i.uncleared_balance-i.cleared_balance)},children:Pt(i.uncleared_balance-i.cleared_balance)})]})]}):u.jsxs(u.Fragment,{children:[u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[u.jsx("span",{style:{opacity:.6,fontSize:"0.7rem"},children:"Cleared"}),u.jsx("span",{style:{opacity:.3,color:"#9ca3af"},children:""})]}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[u.jsx("span",{style:{opacity:.6,fontSize:"0.7rem"},children:"Uncleared"}),u.jsx("span",{style:{opacity:.3,color:"#9ca3af"},children:""})]})]})]}):u.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:u.jsx("span",{style:{color:ct(t.balance),fontWeight:600},children:Pt(t.balance)})})})]}),u.jsx("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap",marginBottom:"0.5rem"},children:u.jsx(a1,{account:t,accountGroups:n})}),u.jsxs("div",{style:{display:"flex",gap:"0.5rem",justifyContent:"flex-end"},children:[u.jsx("button",{onClick:T=>{T.stopPropagation(),t.nickname,o(t.id)},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Edit",children:""}),u.jsx("button",{onClick:T=>{T.stopPropagation(),d()},disabled:!f,style:{background:"transparent",border:"none",cursor:f?"pointer":"default",opacity:f?.6:.2,fontSize:"0.9rem",padding:"0.25rem"},title:"Move up",children:""}),u.jsx("button",{onClick:T=>{T.stopPropagation(),h()},disabled:!p,style:{background:"transparent",border:"none",cursor:p?"pointer":"default",opacity:p?.6:.2,fontSize:"0.9rem",padding:"0.25rem"},title:"Move down",children:""})]})]})});const S=e%2===0?"transparent":"rgba(255,255,255,0.04)",C={padding:"0.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem"};return u.jsxs("div",{style:{gridColumn:"1 / -1",background:S,display:"grid",gridTemplateColumns:"2fr 1fr 1fr 1fr 1.5fr 1fr"},children:[u.jsx("div",{style:{...C,fontWeight:500,overflow:"hidden",paddingLeft:"1.5rem",borderLeft:"2px solid rgba(255,255,255,0.1)"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.nickname})}),i?u.jsx("div",{style:{...C,justifyContent:"flex-end",color:ct(i.uncleared_balance),fontWeight:600},children:Pt(i.uncleared_balance)}):u.jsx("div",{style:{...C,justifyContent:"flex-end",color:ct(t.balance),fontWeight:600},children:Pt(t.balance)}),i?u.jsx("div",{style:{...C,justifyContent:"flex-end",color:ct(i.cleared_balance)},children:Math.abs(i.uncleared_balance-i.cleared_balance)<.01?u.jsx("span",{style:{opacity:.3,color:"#9ca3af"},children:""}):Pt(i.cleared_balance)}):u.jsx("div",{style:{...C,justifyContent:"flex-end",color:ct(t.balance),fontWeight:600},children:Pt(t.balance)}),i&&Math.abs(i.uncleared_balance-i.cleared_balance)>=.01?u.jsx("div",{style:{...C,justifyContent:"flex-end",color:ct(i.uncleared_balance-i.cleared_balance)},children:Pt(i.uncleared_balance-i.cleared_balance)}):u.jsx("div",{style:{...C,justifyContent:"flex-end",opacity:.3,color:"#9ca3af"},children:""}),u.jsx("div",{style:{...C,gap:"0.25rem",flexWrap:"wrap"},children:u.jsx(a1,{account:t,accountGroups:n})}),u.jsxs("div",{style:{...C,justifyContent:"flex-end",gap:"0.25rem"},children:[u.jsx("button",{onClick:T=>{T.stopPropagation(),t.nickname,o(t.id)},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Edit",children:""}),u.jsx("button",{onClick:T=>{T.stopPropagation(),d()},disabled:!f,style:{background:"transparent",border:"none",cursor:f?"pointer":"default",opacity:f?.6:.2,fontSize:"0.9rem",padding:"0.25rem"},title:"Move up",children:""}),u.jsx("button",{onClick:T=>{T.stopPropagation(),h()},disabled:!p,style:{background:"transparent",border:"none",cursor:p?"pointer":"default",opacity:p?.6:.2,fontSize:"0.9rem",padding:"0.25rem"},title:"Move down",children:""})]})]})}function o1({group:t,accounts:e,allGroups:n,allAccounts:r,accountClearedBalances:i,editingAccountId:o,createForGroupId:l,setEditingAccountId:d,setCreateForGroupId:h,onUpdateAccount:f,onDeleteAccount:p,onMoveAccount:g,onCreateAccount:b,isMobile:_,isUngrouped:w,canMoveGroupUp:x,canMoveGroupDown:S,onEditGroup:C,onDeleteGroup:T,onMoveGroupUp:R,onMoveGroupDown:D}){const V=[...e].sort((k,M)=>k.sort_order-M.sort_order);V.reduce((k,M)=>k+M.balance,0);const $={padding:"0.6rem 0.5rem",marginTop:"1.25rem",borderTop:"1px solid rgba(255,255,255,0.2)",borderBottom:za,background:"rgba(255,255,255,0.04)",display:"flex",alignItems:"center",fontSize:"0.9rem",fontWeight:600};return u.jsxs("div",{style:{display:"contents"},children:[!_&&u.jsxs(u.Fragment,{children:[u.jsxs("div",{style:{...$,opacity:w?.7:1,justifyContent:"space-between"},children:[u.jsxs("span",{children:[u.jsx("span",{children:t.name}),u.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",V.length,")"]})]}),u.jsx("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center",flexShrink:0},children:!w&&u.jsxs(u.Fragment,{children:[u.jsx($e,{variant:"small",actionName:`Open Add Account Form (${t.name})`,onClick:()=>h(t.id),disabled:l!==null,children:"+ Account"}),u.jsx("button",{onClick:()=>{t.name,C()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Edit account type",children:""}),u.jsx("button",{onClick:()=>{t.name,T()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Delete account type",children:""}),u.jsxs("div",{style:Bf,children:[u.jsx("button",{onClick:R,disabled:!x,style:{...ba,opacity:x?.6:.2,cursor:x?"pointer":"default"},title:"Move up","aria-label":"Move up",children:""}),u.jsx("button",{onClick:D,disabled:!S,style:{...ba,opacity:S?.6:.2,cursor:S?"pointer":"default"},title:"Move down","aria-label":"Move down",children:""})]})]})})]}),u.jsx("div",{style:$}),u.jsx("div",{style:$}),u.jsx("div",{style:$}),u.jsx("div",{style:$}),u.jsx("div",{style:$})]}),_&&u.jsxs("div",{style:{gridColumn:"1 / -1",padding:"0.6rem 0.5rem",marginTop:"1.25rem",borderTop:"1px solid rgba(255,255,255,0.2)",borderBottom:za,background:"rgba(255,255,255,0.04)"},children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"},children:[u.jsxs("span",{style:{fontWeight:600,opacity:w?.7:1},children:[t.name,u.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",V.length,")"]})]}),Kt.showGroupTotals]}),!w&&u.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center",flexWrap:"wrap"},children:[u.jsx($e,{variant:"small",actionName:`Open Add Account Form (${t.name})`,onClick:()=>h(t.id),disabled:l!==null,children:"+ Account"}),u.jsx("button",{onClick:()=>{t.name,C()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Edit account type",children:""}),u.jsx("button",{onClick:()=>{t.name,T()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Delete account type",children:""}),u.jsxs("div",{style:Bf,children:[u.jsx("button",{onClick:R,disabled:!x,style:{...ba,opacity:x?.6:.2,cursor:x?"pointer":"default"},title:"Move up","aria-label":"Move up",children:""}),u.jsx("button",{onClick:D,disabled:!S,style:{...ba,opacity:S?.6:.2,cursor:S?"pointer":"default"},title:"Move down","aria-label":"Move down",children:""})]})]})]}),V.map((k,M)=>u.jsx(rL,{account:k,accountIndex:M,totalAccounts:V.length,allGroups:n,allAccounts:r,clearedBalance:i?.[k.id],onEdit:d,onDelete:p,onMoveUp:()=>g(k.id,"up"),onMoveDown:()=>g(k.id,"down"),canMoveUp:M>0,canMoveDown:M<V.length-1,editingAccountId:o,setEditingAccountId:d,onUpdateAccount:f,isMobile:_},k.id)),l===t.id&&u.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"0.5rem"},children:u.jsx(r_,{initialData:{nickname:"",account_group_id:t.id},onSubmit:k=>b(k,t.id),onCancel:()=>h(null),submitLabel:"Create",accountGroups:n,showIncomeSettings:!0,currentGroupId:t.id})})]})}function sL({hiddenAccounts:t,accounts:e,sortedGroups:n,editingAccountId:r,setEditingAccountId:i,onUpdateAccount:o}){return t.length===0?null:u.jsx("div",{style:{marginBottom:"2rem"},children:u.jsxs(Z0,{title:"Hidden Accounts",count:t.length,children:[u.jsxs("div",{style:{padding:"0.75rem",marginBottom:"1rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",fontSize:"0.85rem"},children:[u.jsxs("p",{style:{margin:"0 0 0.5rem 0",opacity:.8},children:[u.jsx("strong",{children:" Hidden accounts"})," are excluded from dropdowns and balance displays. They're useful for historical accounts (like closed bank accounts or old 401Ks) that you want to keep for record-keeping but don't need in everyday use."]}),u.jsx("p",{style:{margin:0,opacity:.6},children:'To unhide an account, click it to edit and uncheck "Hidden account".'})]}),u.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:t.map(l=>r===l.id?u.jsx(r_,{initialData:{nickname:l.nickname,account_group_id:l.account_group_id,is_income_account:l.is_income_account,is_income_default:l.is_income_default,is_outgo_account:l.is_outgo_account,is_outgo_default:l.is_outgo_default,on_budget:l.on_budget,is_active:l.is_active,is_hidden:l.is_hidden},onSubmit:d=>{o(l.id,d),i(null)},onCancel:()=>i(null),submitLabel:"Save",accountGroups:n,showGroupSelector:!0,showIncomeSettings:!0,currentGroupId:l.account_group_id,hasExistingIncomeDefault:Object.entries(e).some(([d,h])=>h.is_income_default&&d!==l.id),hasExistingOutgoDefault:Object.entries(e).some(([d,h])=>h.is_outgo_default&&d!==l.id)},l.id):u.jsxs("div",{onClick:()=>i(l.id),style:{padding:"0.75rem 1rem",background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"8px",cursor:"pointer",display:"flex",justifyContent:"space-between",alignItems:"center",opacity:.7},children:[u.jsx("span",{children:l.nickname}),u.jsx("span",{style:{color:ct(l.balance),fontWeight:500},children:Pt(l.balance)})]},l.id))})]})})}function iL(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n}=Ze(),{isLoading:r,isFetching:i,accounts:o}=On(),{month:l}=Ys(t,e,n),{accounts:d,accountsByGroup:h,hiddenAccounts:f,sortedGroups:p,currentBudget:g,error:b,setError:_,handleCreateAccount:w,handleUpdateAccount:x,handleDeleteAccount:S,handleMoveAccount:C,handleCreateGroup:T,handleUpdateGroup:R,handleDeleteGroup:D,handleMoveGroup:V}=l3(),$=Mi(),{addLoadingHold:k,removeLoadingHold:M}=jn(),B=r||i||!g;ZT(!B&&!!g),j.useEffect(()=>(B?k("accounts","Loading accounts..."):M("accounts"),()=>M("accounts")),[B,k,M]);const[U,q]=j.useState(null),[I,N]=j.useState(null),[O,J]=j.useState(null),[Y,G]=j.useState(!1),Z=j.useMemo(()=>{const ne=Object.values(d),ce=ne.reduce((oe,be)=>oe+(be.balance??0),0);let he=0,we=0;for(const oe of ne){const be=p.find(ze=>ze.id===oe.account_group_id);oe.on_budget===!0||oe.on_budget===void 0&&be?.on_budget!==!1?he+=oe.balance??0:we+=oe.balance??0}return{count:ne.length,groupCount:p.filter(oe=>oe.id!==en).length,totalBalance:ce,onBudgetTotal:he,offBudgetTotal:we}},[d,p]),Q=j.useMemo(()=>p.filter(ne=>ne.id!==en),[p]),te=j.useMemo(()=>({id:en,name:"Ungrouped",sort_order:Q.length,expected_balance:"any",on_budget:null,is_active:null}),[Q.length]),z=h[en]||[],H=j.useMemo(()=>l?pA(l,o):{},[l,o]),re={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",paddingTop:"0.75rem",paddingBottom:"0.5rem",paddingLeft:"0.5rem",paddingRight:"0.5rem",borderBottom:"2px solid rgba(255,255,255,0.2)"};return j.useEffect(()=>{b&&(console.error("[Settings/Accounts] Error:",b),Jn.add({type:"error",message:"Failed to update accounts. See console for details.",autoDismissMs:0}),_(null))},[b,_]),B||!g?B?null:u.jsx("p",{children:"No budget found. Please log in."}):u.jsxs("div",{children:[u.jsxs("div",{style:{display:"grid",gridTemplateColumns:$?"1fr":"2fr 1fr 1fr 1fr 1.5fr 1fr",marginBottom:"1.5rem"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:50,backgroundColor:"#242424",display:$?"block":"grid",gridTemplateColumns:$?void 0:"subgrid"},children:[u.jsx("div",{style:{gridColumn:"1 / -1",marginLeft:"calc(-1 * var(--page-padding, 2rem))",marginRight:"calc(-1 * var(--page-padding, 2rem))",paddingLeft:"var(--page-padding, 2rem)",paddingRight:"var(--page-padding, 2rem)",paddingTop:"0.5rem",paddingBottom:"0.5rem"},children:u.jsx("div",{style:{display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingBottom:"0.5rem",borderBottom:"1px solid rgba(255,255,255,0.15)"},children:u.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[u.jsx("span",{style:{fontWeight:600},children:"Accounts:"}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"On-Budget: "}),u.jsx("span",{style:{color:ct(Z.onBudgetTotal),fontWeight:600},children:Fn(Z.onBudgetTotal)})]}),Z.offBudgetTotal!==0&&u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"Off-Budget: "}),u.jsx("span",{style:{fontWeight:600,opacity:.7},children:Fn(Z.offBudgetTotal)})]}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"Total: "}),u.jsx("span",{style:{color:ct(Z.totalBalance),fontWeight:600},children:Fn(Z.totalBalance)})]}),u.jsx("span",{style:{opacity:.5,fontSize:"0.8rem"},children:"Use  buttons to reorder accounts."})]})})}),!$&&u.jsxs(u.Fragment,{children:[u.jsx("div",{style:re,children:"Account"}),u.jsx("div",{style:{...re,textAlign:"right"},children:"Total"}),u.jsx("div",{style:{...re,textAlign:"right"},children:"Cleared"}),u.jsx("div",{style:{...re,textAlign:"right"},children:"Uncleared"}),u.jsx("div",{style:re,children:"Flags"}),u.jsx("div",{style:{...re,textAlign:"right"},children:"Actions"})]})]}),Object.keys(d).length===0&&Q.length===0&&u.jsx("p",{style:{gridColumn:"1 / -1",opacity:.7,textAlign:"center",padding:"2rem"},children:"No accounts yet. Create an account type first, then add accounts!"}),Q.map((ne,ce)=>{const he=h[ne.id]||[];return he.length===0&&O!==ne.id&&I!==ne.id?null:O===ne.id?u.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"1rem"},children:u.jsx(i1,{initialData:{name:ne.name,expected_balance:ne.expected_balance||"positive",on_budget:ne.on_budget??void 0,is_active:ne.is_active??void 0},onSubmit:we=>{R(ne.id,we),J(null)},onCancel:()=>J(null),submitLabel:"Save"})},ne.id):u.jsx(o1,{group:ne,accounts:he,allGroups:Q,allAccounts:d,accountClearedBalances:H,editingAccountId:U,createForGroupId:I,setEditingAccountId:q,setCreateForGroupId:N,onUpdateAccount:(we,oe)=>{x(we,oe),q(null)},onDeleteAccount:S,onMoveAccount:C,onCreateAccount:w,isMobile:$,canMoveGroupUp:ce>0,canMoveGroupDown:ce<Q.length-1,onEditGroup:()=>J(ne.id),onDeleteGroup:()=>D(ne.id),onMoveGroupUp:()=>V(ne.id,"up"),onMoveGroupDown:()=>V(ne.id,"down")},ne.id)}),(z.length>0||I==="ungrouped")&&u.jsx(o1,{group:te,accounts:z,allGroups:Q,allAccounts:d,accountClearedBalances:H,editingAccountId:U,createForGroupId:I,setEditingAccountId:q,setCreateForGroupId:N,onUpdateAccount:(ne,ce)=>{x(ne,ce),q(null)},onDeleteAccount:S,onMoveAccount:C,onCreateAccount:w,isMobile:$,isUngrouped:!0,canMoveGroupUp:!1,canMoveGroupDown:!1,onEditGroup:()=>{},onDeleteGroup:()=>{},onMoveGroupUp:()=>{},onMoveGroupDown:()=>{}}),u.jsx("div",{style:{gridColumn:"1 / -1",height:"1rem"}})]}),u.jsx(sL,{hiddenAccounts:f,accounts:d,sortedGroups:Q,editingAccountId:U,setEditingAccountId:q,onUpdateAccount:x}),Y?u.jsx(i1,{onSubmit:ne=>{T(ne),G(!1)},onCancel:()=>G(!1),submitLabel:"Create Account Type"}):u.jsx($e,{variant:"primary-large",actionName:"Open Add Account Type Form",onClick:()=>G(!0),children:"+ Add Account Type"})]})}function s_({initialData:t,onSubmit:e,onCancel:n,submitLabel:r,categoryGroups:i=[],showGroupSelector:o=!1,onDelete:l}){const[d,h]=j.useState(t||{name:"",category_group_id:null,is_hidden:!1}),[f,p]=j.useState(t?.default_monthly_amount?.toString()||""),[g,b]=j.useState(t?.default_monthly_type||"fixed"),[_,w]=j.useState(!1);function x(S){if(S.preventDefault(),!d.name.trim())return;w(!0);const C=parseFloat(f),T=!isNaN(C)&&C>0;Promise.resolve(e({...d,description:d.description?.trim()||void 0,default_monthly_amount:T?C:void 0,default_monthly_type:T?g:void 0})).catch(R=>{console.error("[CategoryForm] Error submitting form:",R)}).finally(()=>{w(!1)}),n()}return u.jsxs(Ri,{actionName:r==="Create"?"Create Category":"Update Category",onSubmit:x,children:[u.jsx(Nt,{label:"Category Name",htmlFor:"category-name",children:u.jsx(Ii,{id:"category-name",type:"text",value:d.name,onChange:S=>h({...d,name:S.target.value}),placeholder:"e.g., Groceries, Rent, Gas",required:!0,autoFocus:!0})}),u.jsx(Nt,{label:"Description (optional)",htmlFor:"category-description",children:u.jsx(K0,{id:"category-description",value:d.description||"",onChange:S=>h({...d,description:S.target.value}),placeholder:"What is this category used for?",minHeight:"3rem"})}),o&&u.jsx(Nt,{label:"Category Group",htmlFor:"category-group",children:u.jsxs(Qu,{id:"category-group",value:d.category_group_id||Jt,onChange:S=>h({...d,category_group_id:S.target.value===Jt?null:S.target.value}),children:[u.jsx("option",{value:Jt,children:"Uncategorized"}),i.map(S=>u.jsx("option",{value:S.id,children:S.name},S.id))]})}),u.jsxs(Nt,{label:"Default Monthly Allocation (optional)",htmlFor:"default-amount",children:[u.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center"},children:[u.jsxs(Qu,{id:"default-type",value:g,onChange:S=>b(S.target.value),style:{width:"auto",flex:"0 0 auto"},children:[u.jsx("option",{value:"fixed",children:"Fixed $"}),u.jsx("option",{value:"percentage",children:"% of Prev Income"})]}),g==="fixed"?u.jsx(Ao,{id:"default-amount",value:f,onChange:p,placeholder:"$0.00"}):u.jsx(Ii,{id:"default-amount",type:"number",value:f,onChange:S=>p(S.target.value),placeholder:"0",min:"0",max:"100",step:"0.1",style:{width:"80px"}}),g==="percentage"&&u.jsx("span",{style:{opacity:.6},children:"%"})]}),u.jsx("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.75rem",opacity:.6},children:g==="fixed"?"Suggested fixed amount to allocate each month":"Percentage of previous month's total income"})]}),o&&u.jsxs("div",{style:{padding:"0.75rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px"},children:[u.jsx(Qr,{id:"is-hidden",checked:d.is_hidden||!1,onChange:S=>h({...d,is_hidden:S.target.checked}),children:"Hidden category"}),u.jsx("p",{style:{margin:"0.25rem 0 0 2rem",fontSize:"0.7rem",opacity:.6},children:"Hidden categories don't appear in dropdowns or balance displays. Use for historical categories that aren't actively used."})]}),u.jsxs(qa,{children:[u.jsx($e,{type:"submit",actionName:r==="Create"?"Create Category":"Save Category",isLoading:_,children:r}),u.jsx($e,{type:"button",variant:"secondary",actionName:"Cancel Category Form",onClick:n,children:"Cancel"}),l&&u.jsx($e,{type:"button",variant:"secondary",actionName:"Delete Category",onClick:S=>{S.preventDefault(),l()},style:{color:"#ff6b6b",borderColor:"#ff6b6b"},children:" Delete"})]})]})}function l1({initialData:t,onSubmit:e,onCancel:n,submitLabel:r}){const[i,o]=j.useState(t||{name:""}),[l,d]=j.useState(!1);function h(f){f.preventDefault(),i.name.trim()&&(d(!0),e(i))}return u.jsxs(Ri,{actionName:r==="Create Group"?"Create Category Group":"Update Category Group",onSubmit:h,children:[u.jsx(Nt,{label:"Group Name",htmlFor:"group-name",children:u.jsx(Ii,{id:"group-name",type:"text",value:i.name,onChange:f=>o({...i,name:f.target.value}),placeholder:"e.g., Housing, Transportation, Food",required:!0,autoFocus:!0})}),u.jsxs(qa,{children:[u.jsx($e,{type:"submit",actionName:r==="Create Group"?"Create Category Group":"Save Category Group",isLoading:l,children:r}),u.jsx($e,{type:"button",variant:"secondary",actionName:"Cancel Category Group Form",onClick:n,children:"Cancel"})]})]})}function aL({category:t,catId:e,categoryIndex:n,categoryGroups:r,categoryBalances:i,loadingBalances:o,onEdit:l,onDelete:d,onMoveUp:h,onMoveDown:f,canMoveUp:p,canMoveDown:g,editingCategoryId:b,setEditingCategoryId:_,onUpdateCategory:w,isMobile:x}){const S=i[e]||{current:0,total:0};if(b===e)return u.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"0.5rem"},children:u.jsx(s_,{initialData:{name:t.name,description:t.description,category_group_id:t.category_group_id,default_monthly_amount:t.default_monthly_amount,default_monthly_type:t.default_monthly_type,is_hidden:t.is_hidden},onSubmit:D=>{w(e,D),_(null)},onCancel:()=>_(null),onDelete:()=>{t.name,d(e),_(null)},submitLabel:"Save",categoryGroups:r,showGroupSelector:!0})});if(x)return u.jsx("div",{style:{gridColumn:"1 / -1"},children:u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",padding:"0.75rem",marginBottom:"0.25rem"},children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"},children:[u.jsx("span",{style:{fontWeight:500},children:t.name}),u.jsxs("div",{style:{display:"flex",gap:"1rem",fontSize:"0.85rem"},children:[t.default_monthly_amount!==void 0&&t.default_monthly_amount>0&&u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[u.jsx("span",{style:{opacity:.6,fontSize:"0.7rem"},children:"Default"}),u.jsx("span",{style:{opacity:.7},children:t.default_monthly_type==="percentage"?`${t.default_monthly_amount}%`:`${Xt(t.default_monthly_amount)}/mo`})]}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[u.jsx("span",{style:{opacity:.6,fontSize:"0.7rem"},children:"Available Now"}),u.jsx("span",{style:{color:dn(S.current),fontWeight:600},children:o?"...":br(S.current)})]}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[u.jsx("span",{style:{opacity:.6,fontSize:"0.7rem"},children:"Total Allocated"}),u.jsx("span",{style:{color:dn(S.total)},children:o?"...":br(S.total)})]})]})]}),t.description&&u.jsx("p",{style:{fontSize:"0.8rem",opacity:.6,margin:"0 0 0.5rem 0"},children:t.description}),t.default_monthly_amount!==void 0&&t.default_monthly_amount>0&&u.jsxs("div",{style:{fontSize:"0.75rem",opacity:.8,marginBottom:"0.5rem"},children:["Default: ",t.default_monthly_type==="percentage"?u.jsxs(u.Fragment,{children:[u.jsxs("span",{style:{color:ge.success,fontWeight:500},children:[t.default_monthly_amount,"%"]})," of prev income"]}):u.jsxs(u.Fragment,{children:[u.jsx("span",{style:{color:ge.success,fontWeight:500},children:t.default_monthly_amount}),"/mo"]})]}),u.jsxs("div",{style:{display:"flex",gap:"0.5rem",justifyContent:"flex-end"},children:[u.jsx("button",{onClick:D=>{D.stopPropagation(),t.name,l(e)},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Edit",children:""}),u.jsx("button",{onClick:D=>{D.stopPropagation(),h()},disabled:!p,style:{background:"transparent",border:"none",cursor:p?"pointer":"default",opacity:p?.6:.2,fontSize:"0.9rem",padding:"0.25rem"},title:"Move up",children:""}),u.jsx("button",{onClick:D=>{D.stopPropagation(),f()},disabled:!g,style:{background:"transparent",border:"none",cursor:g?"pointer":"default",opacity:g?.6:.2,fontSize:"0.9rem",padding:"0.25rem"},title:"Move down",children:""})]})]})});const T=n%2===0?"transparent":"rgba(255,255,255,0.04)",R={padding:"0.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem"};return u.jsxs("div",{style:{gridColumn:"1 / -1",background:T,display:"grid",gridTemplateColumns:"2fr 1fr 1fr 1fr 2fr 1fr"},children:[u.jsx("div",{style:{...R,fontWeight:500,overflow:"hidden",paddingLeft:"1.5rem",borderLeft:"2px solid rgba(255,255,255,0.1)"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.name})}),u.jsx("div",{style:{...R,justifyContent:"flex-end",opacity:.7,fontSize:"0.85rem"},children:t.default_monthly_amount!==void 0&&t.default_monthly_amount>0?u.jsx("span",{children:t.default_monthly_type==="percentage"?`${t.default_monthly_amount}%`:`${br(t.default_monthly_amount)}/mo`}):u.jsx("span",{style:{opacity:.3,fontStyle:"italic",color:"#9ca3af"},children:""})}),u.jsx("div",{style:{...R,justifyContent:"flex-end",color:dn(S.current),fontWeight:600},children:o?"...":br(S.current)}),u.jsx("div",{style:{...R,justifyContent:"flex-end",color:dn(S.total)},children:o?"...":br(S.total)}),u.jsx("div",{style:{...R,opacity:.7,fontSize:"0.85rem"},children:t.description?u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.description}):u.jsx("span",{style:{opacity:.3,fontStyle:"italic",color:"#9ca3af"},children:""})}),u.jsxs("div",{style:{...R,justifyContent:"flex-end",gap:"0.25rem"},children:[u.jsx("button",{onClick:D=>{D.stopPropagation(),t.name,l(e)},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Edit",children:""}),u.jsx("button",{onClick:D=>{D.stopPropagation(),h()},disabled:!p,style:{background:"transparent",border:"none",cursor:p?"pointer":"default",opacity:p?.6:.2,fontSize:"0.9rem",padding:"0.25rem"},title:"Move up",children:""}),u.jsx("button",{onClick:D=>{D.stopPropagation(),f()},disabled:!g,style:{background:"transparent",border:"none",cursor:g?"pointer":"default",opacity:g?.6:.2,fontSize:"0.9rem",padding:"0.25rem"},title:"Move down",children:""})]})]})}function c1({group:t,categories:e,categoryGroups:n,categoryBalances:r,loadingBalances:i,editingCategoryId:o,createForGroupId:l,setEditingCategoryId:d,setCreateForGroupId:h,handleUpdateCategory:f,handleDeleteCategory:p,handleMoveCategory:g,handleCreateCategory:b,isMobile:_,isUngrouped:w,startRowIndex:x=0,canMoveGroupUp:S,canMoveGroupDown:C,onEditGroup:T,onDeleteGroup:R,onMoveGroupUp:D,onMoveGroupDown:V}){const $=j.useMemo(()=>[...e].sort((U,q)=>U[1].sort_order-q[1].sort_order),[e]),k=$.reduce((U,[q])=>{const I=r[q];return U+(I?.current||0)},0),M=x===0,B={padding:"0.6rem 0.5rem",marginTop:M?0:"1.25rem",borderTop:"1px solid rgba(255,255,255,0.2)",borderBottom:za,background:"rgba(255,255,255,0.04)",display:"flex",alignItems:"center",fontSize:"0.9rem",fontWeight:600,minWidth:0,overflow:"visible"};return u.jsxs("div",{style:{display:"contents"},children:[!_&&u.jsxs(u.Fragment,{children:[u.jsx("div",{style:{...B,opacity:w?.7:1},children:u.jsxs("span",{style:{whiteSpace:"nowrap"},children:[u.jsx("span",{children:t.name}),u.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",$.length,")"]})]})}),u.jsx("div",{style:B}),u.jsx("div",{style:{...B,justifyContent:"flex-end",color:dn(k)},children:Kt.showGroupTotals}),u.jsx("div",{style:{...B,justifyContent:"flex-end",color:dn($.reduce((U,[q])=>{const I=r[q];return U+(I?.total||0)},0))},children:Kt.showGroupTotals}),u.jsx("div",{style:B}),u.jsx("div",{style:{...B,justifyContent:"flex-end",gap:"0.25rem"},children:!w&&u.jsxs(u.Fragment,{children:[u.jsx($e,{variant:"small",actionName:`Open Add Category Form (${t.name})`,onClick:()=>h(t.id),disabled:l!==null,children:"+ Category"}),u.jsx("button",{onClick:()=>{t.name,T()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Edit group",children:""}),u.jsx("button",{onClick:()=>{t.name,R()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Delete group",children:""}),u.jsxs("div",{style:Bf,children:[u.jsx("button",{onClick:D,disabled:!S,style:{...ba,opacity:S?.6:.2,cursor:S?"pointer":"default"},title:"Move group up","aria-label":"Move group up",children:""}),u.jsx("button",{onClick:V,disabled:!C,style:{...ba,opacity:C?.6:.2,cursor:C?"pointer":"default"},title:"Move group down","aria-label":"Move group down",children:""})]})]})})]}),_&&u.jsxs("div",{style:{gridColumn:"1 / -1",padding:"0.6rem 0.5rem",marginTop:M?0:"1.25rem",borderTop:"1px solid rgba(255,255,255,0.2)",borderBottom:za,background:"rgba(255,255,255,0.04)"},children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"},children:[u.jsxs("span",{style:{fontWeight:600,opacity:w?.7:1,whiteSpace:"nowrap"},children:[t.name,u.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",$.length,")"]})]}),Kt.showGroupTotals]}),!w&&u.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center",flexWrap:"wrap"},children:[u.jsx($e,{variant:"small",actionName:`Open Add Category Form (${t.name})`,onClick:()=>h(t.id),disabled:l!==null,children:"+ Category"}),u.jsx("button",{onClick:()=>{t.name,T()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Edit group",children:""}),u.jsx("button",{onClick:()=>{t.name,R()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Delete group",children:""}),u.jsxs("div",{style:Bf,children:[u.jsx("button",{onClick:D,disabled:!S,style:{...ba,opacity:S?.6:.2,cursor:S?"pointer":"default"},title:"Move group up","aria-label":"Move group up",children:""}),u.jsx("button",{onClick:V,disabled:!C,style:{...ba,opacity:C?.6:.2,cursor:C?"pointer":"default"},title:"Move group down","aria-label":"Move group down",children:""})]})]})]}),$.map(([U,q],I)=>{const N=x+I;return u.jsx(aL,{category:q,catId:U,categoryIndex:N,totalCategories:$.length,categoryGroups:n,categoryBalances:r,loadingBalances:i,onEdit:d,onDelete:p,onMoveUp:()=>g(U,"up"),onMoveDown:()=>g(U,"down"),canMoveUp:I>0,canMoveDown:I<$.length-1,editingCategoryId:o,setEditingCategoryId:d,onUpdateCategory:f,isMobile:_},U)}),l===t.id&&u.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"0.5rem"},children:u.jsx(s_,{initialData:{name:"",category_group_id:t.id},onSubmit:U=>b(U,t.id),onCancel:()=>h(null),submitLabel:"Create",categoryGroups:n})})]})}function oL({onBudgetTotal:t,allocated:e,unallocated:n,relationshipMismatch:r,calculationMismatch:i}){return u.jsx("div",{style:{gridColumn:"1 / -1",marginLeft:"calc(-1 * var(--page-padding, 2rem))",marginRight:"calc(-1 * var(--page-padding, 2rem))",paddingLeft:"var(--page-padding, 2rem)",paddingRight:"var(--page-padding, 2rem)",paddingTop:"0.5rem",paddingBottom:"0.5rem"},children:u.jsx("div",{style:{display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingBottom:"0.5rem",borderBottom:"1px solid rgba(255,255,255,0.15)"},children:u.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[u.jsx("span",{style:{fontWeight:600},children:"Categories:"}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"On Budget: "}),u.jsx("span",{style:{color:ct(t),fontWeight:600},children:Fn(t)})]}),u.jsx("span",{style:{opacity:r?1:.5,color:r?"#ef4444":void 0,fontWeight:r?700:void 0},children:r?"":"="}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"Allocated: "}),u.jsx("span",{style:{color:bc(e),fontWeight:600},children:Fn(e)})]}),u.jsx("span",{style:{opacity:r?1:.5,color:r?"#ef4444":void 0,fontWeight:r?700:void 0},children:"+"}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"Unallocated: "}),u.jsx("span",{style:{color:ct(n),fontWeight:600},children:Fn(n)})]}),u.jsx("span",{style:{opacity:.6},children:"Use  buttons to reorder categories."})]})})})}function lL(){const{isLoading:t,isFetching:e,totalAvailable:n}=On(),{currentBudget:r,categories:i,categoryGroups:o,categoriesByGroup:l,hiddenCategories:d,sortedGroups:h,categoryBalances:f,isLoading:p,loadingBalances:g,error:b,setError:_,getOnBudgetTotal:w,handleCreateCategory:x,handleUpdateCategory:S,handleDeleteCategory:C,handleMoveCategory:T,handleCreateGroup:R,handleUpdateGroup:D,handleDeleteGroup:V,handleMoveGroup:$}=h3(),k=Mi(),{addLoadingHold:M,removeLoadingHold:B}=jn(),U=t||p||e||!r;ZT(!U&&!!r),j.useEffect(()=>(U?M("categories","Loading categories..."):B("categories"),()=>B("categories")),[U,M,B]);const[q,I]=j.useState(null),[N,O]=j.useState(null),[J,Y]=j.useState(null),[G,Z]=j.useState(!1),Q=j.useMemo(()=>h.filter(oe=>oe.id!==Jt),[h]),te=j.useMemo(()=>({id:Jt,name:"Uncategorized",sort_order:Q.length}),[Q.length]),z=(l[Jt]||[]).sort((oe,be)=>oe[1].sort_order-be[1].sort_order);j.useEffect(()=>{b&&(console.error("[Settings/Categories] Error:",b),Jn.add({type:"error",message:"Failed to update categories. See console for details.",autoDismissMs:0}),_(null))},[b,_]);const H=j.useMemo(()=>w(),[w]),{allocated:re,unallocated:ne,calculationMismatch:ce,relationshipMismatch:he}=f3({categories:i,categoryBalances:f,totalAvailable:n,onBudgetTotal:H,isDataLoading:U,loadingBalances:g,currentBudget:r});if(U||!r)return U?null:u.jsx("p",{children:"No budget found. Please log in."});const we={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",paddingTop:"0.75rem",paddingBottom:"0.5rem",paddingLeft:"0.5rem",paddingRight:"0.5rem",borderBottom:"2px solid rgba(255,255,255,0.2)"};return u.jsxs("div",{children:[u.jsxs("div",{style:{display:"grid",gridTemplateColumns:k?"1fr":"2fr 1fr 1fr 1fr 2fr 1fr",marginBottom:"1.5rem"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:50,backgroundColor:"#242424",display:k?"block":"grid",gridTemplateColumns:k?void 0:"subgrid"},children:[u.jsx(oL,{onBudgetTotal:H,allocated:re,unallocated:ne,relationshipMismatch:he,calculationMismatch:ce}),!k&&u.jsxs(u.Fragment,{children:[u.jsx("div",{style:we,children:"Category"}),u.jsx("div",{style:{...we,textAlign:"right"},children:"Default"}),u.jsx("div",{style:{...we,textAlign:"right"},children:"Available Now"}),u.jsx("div",{style:{...we,textAlign:"right"},children:"Total Allocated"}),u.jsx("div",{style:we,children:"Description"}),u.jsx("div",{style:{...we,textAlign:"right"},children:"Actions"})]})]}),Object.keys(i).length===0&&o.length===0&&u.jsx("p",{style:{gridColumn:"1 / -1",opacity:.7,textAlign:"center",padding:"2rem"},children:"No categories yet. Create a group first, then add categories!"}),(()=>{const oe={};let be=0;return Q.forEach(Me=>{const ze=(l[Me.id]||[]).sort((at,lt)=>at[1].sort_order-lt[1].sort_order);oe[Me.id]=be,be+=ze.length}),Q.map((Me,ze)=>{const at=(l[Me.id]||[]).sort((lt,L)=>lt[1].sort_order-L[1].sort_order);return at.length===0&&J!==Me.id&&N!==Me.id?null:J===Me.id?u.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"1rem"},children:u.jsx(l1,{initialData:{name:Me.name},onSubmit:lt=>{D(Me.id,lt),Y(null)},onCancel:()=>Y(null),submitLabel:"Save"})},Me.id):u.jsx(c1,{group:Me,categories:at,categoryGroups:o,categoryBalances:f,loadingBalances:g,editingCategoryId:q,createForGroupId:N,setEditingCategoryId:I,setCreateForGroupId:O,handleUpdateCategory:S,handleDeleteCategory:C,handleMoveCategory:T,handleCreateCategory:x,isMobile:k,canMoveGroupUp:ze>0,canMoveGroupDown:ze<Q.length-1,onEditGroup:()=>Y(Me.id),onDeleteGroup:()=>V(Me.id),onMoveGroupUp:()=>$(Me.id,"up"),onMoveGroupDown:()=>$(Me.id,"down"),startRowIndex:oe[Me.id]??0},Me.id)})})(),(z.length>0||N==="ungrouped")&&(()=>{const oe=Q.reduce((be,Me)=>{const ze=(l[Me.id]||[]).sort((at,lt)=>at[1].sort_order-lt[1].sort_order);return be+ze.length},0);return u.jsx(c1,{group:te,categories:z,categoryGroups:o,categoryBalances:f,loadingBalances:g,editingCategoryId:q,createForGroupId:N,setEditingCategoryId:I,setCreateForGroupId:O,handleUpdateCategory:S,handleDeleteCategory:C,handleMoveCategory:T,handleCreateCategory:x,isMobile:k,isUngrouped:!0,canMoveGroupUp:!1,canMoveGroupDown:!1,onEditGroup:()=>{},onDeleteGroup:()=>{},onMoveGroupUp:()=>{},onMoveGroupDown:()=>{},startRowIndex:oe})})(),u.jsx("div",{style:{gridColumn:"1 / -1",height:"1rem"}})]}),d.length>0&&u.jsx("div",{style:{marginBottom:"2rem"},children:u.jsxs(Z0,{title:"Hidden Categories",count:d.length,children:[u.jsxs("div",{style:{padding:"0.75rem",marginBottom:"1rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",fontSize:"0.85rem"},children:[u.jsxs("p",{style:{margin:"0 0 0.5rem 0",opacity:.8},children:[u.jsx("strong",{children:" Hidden categories"})," are excluded from dropdowns and balance displays. They're useful for historical categories that you want to keep for record-keeping but don't need in everyday use."]}),u.jsx("p",{style:{margin:0,opacity:.6},children:'To unhide a category, click it to edit and uncheck "Hidden category".'})]}),u.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:d.map(([oe,be])=>q===oe?u.jsx(s_,{initialData:{name:be.name,description:be.description,category_group_id:be.category_group_id,default_monthly_amount:be.default_monthly_amount,default_monthly_type:be.default_monthly_type,is_hidden:be.is_hidden},onSubmit:Me=>{S(oe,Me),I(null)},onCancel:()=>I(null),submitLabel:"Save",categoryGroups:o,showGroupSelector:!0},oe):u.jsxs("div",{onClick:()=>I(oe),style:{padding:"0.75rem 1rem",background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"8px",cursor:"pointer",display:"flex",justifyContent:"space-between",alignItems:"center",opacity:.7},children:[u.jsx("span",{children:be.name}),u.jsx("span",{style:{color:ct(be.balance),fontWeight:500},children:Fn(be.balance)})]},oe))})]})}),G?u.jsx(l1,{onSubmit:oe=>{R(oe),Z(!1)},onCancel:()=>Z(!1),submitLabel:"Create Group"}):u.jsx($e,{variant:"primary-large",actionName:"Open Add Category Group Form",onClick:()=>Z(!0),children:"+ Add Category Group"})]})}function cL(){const{selectedBudgetId:t,currentUserId:e}=Ze(),{addLoadingHold:n,removeLoadingHold:r}=jn(),{budget:i,budgetUserIds:o,acceptedUserIds:l,isLoading:d}=On();j.useEffect(()=>(d||!i?n("users","Loading users..."):r("users"),()=>r("users")),[d,i,n,r]);const{inviteUser:h}=Qz(),{revokeUser:f}=Kz(),[p,g]=j.useState(""),[b,_]=j.useState(!1),[w,x]=j.useState(null),[S,C]=j.useState(null);if(d)return null;if(!i)return u.jsx("p",{children:"No budget found."});async function T($){if($.preventDefault(),!(!p.trim()||!i||!t)){_(!0),x(null),C(null);try{await h.mutateAsync({budgetId:t,userId:p.trim()}),g(""),C("Invite sent! The user can now accept the invitation from their account.")}catch(k){x(k instanceof Error?k.message:"Failed to invite user")}finally{_(!1)}}}async function R($){if(!i||!t)return;if($===i.owner_id){x("Cannot revoke the budget owner");return}if($===e){x("Cannot revoke yourself from the budget");return}const k=l.includes($);if(confirm(k?"Are you sure you want to revoke this user's access? They will lose access to this budget.":"Are you sure you want to cancel this invitation?")){x(null),C(null);try{await f.mutateAsync({budgetId:t,userId:$}),C(k?"User access revoked.":"Invitation cancelled.")}catch(B){x(B instanceof Error?B.message:"Failed to revoke user")}}}const D=o.filter($=>l.includes($)),V=o.filter($=>!l.includes($));return u.jsxs("div",{children:[u.jsx("h2",{style:{marginTop:0},children:"Budget Users"}),u.jsx("p",{style:{opacity:.7,marginBottom:"1.5rem"},children:"Invite users to access this budget. They must accept the invitation before they can access it."}),w&&u.jsxs("div",{style:{background:"rgba(220, 38, 38, 0.1)",border:"1px solid rgba(220, 38, 38, 0.3)",color:"#f87171",padding:"0.75rem 1rem",borderRadius:"8px",marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[u.jsx("span",{children:w}),u.jsx("button",{onClick:()=>x(null),style:{background:"transparent",border:"none",color:"#f87171",cursor:"pointer",fontSize:"1.2rem",padding:"0 0.25rem",lineHeight:1},children:""})]}),S&&u.jsxs("div",{style:{background:"rgba(34, 197, 94, 0.1)",border:"1px solid rgba(34, 197, 94, 0.3)",color:"#4ade80",padding:"0.75rem 1rem",borderRadius:"8px",marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[u.jsx("span",{children:S}),u.jsx("button",{onClick:()=>C(null),style:{background:"transparent",border:"none",color:"#4ade80",cursor:"pointer",fontSize:"1.2rem",padding:"0 0.25rem",lineHeight:1},children:""})]}),u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px",marginBottom:"1.5rem"},children:[u.jsxs("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem"},children:["Active Users (",D.length,")"]}),D.length===0?u.jsx("p",{style:{opacity:.6,margin:0},children:"No users have accepted invitations yet."}):u.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:D.map($=>{const k=$===i.owner_id,M=$===e;return u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 8%, transparent)",padding:"0.75rem 1rem",borderRadius:"6px",display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem"},children:[u.jsx("div",{style:{flex:1,minWidth:0},children:u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flexWrap:"wrap"},children:[u.jsx("code",{style:{fontSize:"0.85rem",background:"color-mix(in srgb, currentColor 10%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",wordBreak:"break-all"},children:$}),k&&u.jsx("span",{style:{background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.7rem",textTransform:"uppercase",fontWeight:600},children:"Owner"}),M&&u.jsx("span",{style:{background:"color-mix(in srgb, #22c55e 20%, transparent)",color:"#4ade80",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.7rem",textTransform:"uppercase",fontWeight:600},children:"You"})]})}),!k&&!M&&u.jsx("button",{onClick:()=>R($),style:{background:"transparent",border:"1px solid rgba(220, 38, 38, 0.4)",color:"#f87171",padding:"0.4rem 0.75rem",borderRadius:"6px",cursor:"pointer",fontSize:"0.8rem",whiteSpace:"nowrap"},children:"Revoke Access"})]},$)})})]}),V.length>0&&u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px",marginBottom:"1.5rem"},children:[u.jsxs("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem"},children:["Pending Invitations (",V.length,")"]}),u.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:V.map($=>u.jsxs("div",{style:{background:"color-mix(in srgb, #f59e0b 10%, transparent)",border:"1px solid color-mix(in srgb, #f59e0b 30%, transparent)",padding:"0.75rem 1rem",borderRadius:"6px",display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem"},children:[u.jsx("div",{style:{flex:1,minWidth:0},children:u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flexWrap:"wrap"},children:[u.jsx("code",{style:{fontSize:"0.85rem",background:"color-mix(in srgb, currentColor 10%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",wordBreak:"break-all"},children:$}),u.jsx("span",{style:{background:"color-mix(in srgb, #f59e0b 20%, transparent)",color:"#fbbf24",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.7rem",textTransform:"uppercase",fontWeight:600},children:"Pending"})]})}),u.jsx("button",{onClick:()=>R($),style:{background:"transparent",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)",color:"inherit",padding:"0.4rem 0.75rem",borderRadius:"6px",cursor:"pointer",fontSize:"0.8rem",whiteSpace:"nowrap",opacity:.8},children:"Cancel Invite"})]},$))})]}),u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px"},children:[u.jsx("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem"},children:"Invite User"}),u.jsxs("form",{onSubmit:T,style:{display:"flex",gap:"0.75rem"},children:[u.jsx("input",{type:"text",value:p,onChange:$=>g($.target.value),placeholder:"Enter Firebase User ID",style:{flex:1,padding:"0.6rem 0.8rem",borderRadius:"6px",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"0.95rem",color:"inherit"}}),u.jsx("button",{type:"submit",disabled:b||!p.trim(),style:{background:"#646cff",color:"white",border:"none",padding:"0.6rem 1.25rem",borderRadius:"6px",cursor:b||!p.trim()?"not-allowed":"pointer",fontWeight:500,opacity:b||!p.trim()?.7:1,whiteSpace:"nowrap"},children:b?"Inviting...":"Send Invite"})]}),u.jsx("p",{style:{margin:"1rem 0 0 0",fontSize:"0.85rem",opacity:.6},children:" The invited user will need to accept the invitation from their Account page using this budget's ID:"}),u.jsx("code",{style:{display:"block",marginTop:"0.5rem",padding:"0.5rem 0.75rem",background:"color-mix(in srgb, currentColor 10%, transparent)",borderRadius:"6px",fontSize:"0.85rem",wordBreak:"break-all"},children:i.id})]})]})}const uL=["budget","feedback","migration","tests"];function dL(){const{isAdmin:t,isTest:e,lastAdminTab:n,setLastAdminTab:r,setPageTitle:i}=Ze(),l=ki().get_current_firebase_user(),d=MT(l?.uid||null,l?.email||null);j.useLayoutEffect(()=>{i("Budget Admin")},[i]);const h=tr(),f=h.pathname==="/budget/admin",p=j.useMemo(()=>{const w=h.pathname;return w.includes("/admin/budget")?"budget":w.includes("/admin/feedback")?"feedback":w.includes("/admin/migration")?"migration":w.includes("/admin/tests")?"tests":"budget"},[h.pathname]),g=p==="tests";j.useEffect(()=>{f||r(p)},[p,f,r]);function b(){return!uL.includes(n)||n==="tests"&&!e?"budget":n}const _=j.useMemo(()=>[{id:"budget",label:"Budget",icon:""},{id:"feedback",label:"Feedback",icon:""},{id:"migration",label:"Migration",icon:""},{id:"tests",label:"Tests",icon:"",hidden:!e}],[e]);return d.isLoading||d.isFetching?null:t?!e&&g?u.jsxs("div",{children:[u.jsx("h1",{children:"Access Denied"}),u.jsx("p",{style:{opacity:.7},children:"Only test users can access this section."}),u.jsx("p",{style:{marginTop:"1rem"},children:u.jsx(Tn,{to:"/budget/admin/budget",children:"Go to Admin "})})]}):u.jsxs("div",{children:[u.jsx(Lf,{mode:"link",linkPrefix:"/budget/admin",tabs:_,activeTab:p}),f?u.jsx($f,{to:`/budget/admin/${b()}`,replace:!0}):u.jsx(qf,{})]}):u.jsxs("div",{children:[u.jsx("h1",{children:"Access Denied"}),u.jsx("p",{style:{opacity:.7},children:"Only administrators can access this section."}),u.jsx("p",{style:{marginTop:"1rem"},children:u.jsx(Tn,{to:"/budget",children:"Go to Budget "})})]})}function hL(){const{addLoadingHold:t,removeLoadingHold:e}=jn(),{isAdmin:n}=Ze(),{budget:r,accounts:i,accountGroups:o,categories:l,categoryGroups:d,isOwner:h,isLoading:f}=On();return j.useEffect(()=>(f?t("settings-budget","Loading budget info..."):e("settings-budget"),()=>e("settings-budget")),[f,t,e]),f?null:r?u.jsxs("div",{children:[u.jsx("h2",{style:{marginTop:0},children:"Budget Summary"}),u.jsx("p",{style:{opacity:.7,marginBottom:"1.5rem"},children:"Information about the currently selected budget."}),u.jsx("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px",marginBottom:"1.5rem"},children:u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem",fontSize:"0.95rem"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{children:""}),u.jsx("span",{style:{opacity:.7,minWidth:"80px"},children:"Name:"}),u.jsx("strong",{children:r.name})]}),u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{children:""}),u.jsx("span",{style:{opacity:.7,minWidth:"80px"},children:"ID:"}),u.jsx("code",{style:{background:"color-mix(in srgb, currentColor 10%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",fontSize:"0.85rem"},children:r.id})]}),u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{children:""}),u.jsx("span",{style:{opacity:.7,minWidth:"80px"},children:"Owner:"}),u.jsx("strong",{children:r.owner_email||r.owner_id})]}),u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{children:""}),u.jsx("span",{style:{opacity:.7,minWidth:"80px"},children:"Users:"}),u.jsxs("span",{children:[r.user_ids.length," user",r.user_ids.length!==1?"s":"",u.jsxs("span",{style:{opacity:.7},children:["  ",h?"You are the owner":"Shared with you"]})]})]})]})}),n&&u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px"},children:[u.jsx("h3",{style:{margin:"0 0 0.75rem 0",fontSize:"1rem"},children:"Admin Tools"}),u.jsx("button",{onClick:()=>{const p={...r,accounts:i,account_groups:o,categories:l,category_groups:d,_meta:{downloaded_at:new Date().toISOString()}},g=new Blob([JSON.stringify(p,null,2)],{type:"application/json"}),b=URL.createObjectURL(g),_=document.createElement("a");_.href=b,_.download=`budget_${r.id}.json`,document.body.appendChild(_),_.click(),document.body.removeChild(_),URL.revokeObjectURL(b)},style:{display:"inline-flex",alignItems:"center",gap:"0.5rem",background:"color-mix(in srgb, currentColor 10%, transparent)",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",borderRadius:"6px",padding:"0.5rem 0.75rem",cursor:"pointer",fontSize:"0.85rem",color:"inherit",transition:"background 0.15s"},title:"Download budget document as JSON (for debugging)",children:" Download Budget JSON"})]})]}):u.jsx("p",{style:{opacity:.7},children:"No budget selected."})}function u1({selectedType:t,onSelect:e}){return u.jsx("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"0.75rem",paddingBottom:"1rem",flexWrap:"wrap"},children:["critical_bug","bug","new_feature","core_feature","qol"].map(n=>{const r=Uf[n],i=t==="feature"?"new_feature":t,o=i===n||!i&&n==="bug";return u.jsxs("button",{type:"button",onClick:()=>{r.label,e(n)},style:{flex:1,padding:"0.6rem 0.75rem",border:`2px solid ${r.color}`,borderRadius:"0.5rem",background:o?r.bgColor:"transparent",color:o?r.color:"rgba(255,255,255,0.5)",cursor:"pointer",fontWeight:o?600:400,fontSize:"0.85rem",transition:"all 0.15s ease",opacity:o?1:.5,boxShadow:o?`0 0 12px ${r.bgColor}`:"none",position:"relative"},children:[r.label,o&&u.jsx("span",{style:{position:"absolute",bottom:"-14px",left:"10%",right:"10%",height:"3px",background:"white",borderRadius:"2px"}})]},n)})})}function fL(){const[t,e]=j.useState(null),[n,r]=j.useState(null),[i,o]=j.useState(!1),[l,d]=j.useState(""),[h,f]=j.useState("bug"),[p,g]=j.useState(null),[b,_]=j.useState(!1),[w,x]=j.useState(null),S=j.useContext(_d),T=ki().get_current_firebase_user(),R=Ut(),D=w4(),{submitFeedback:V}=aA(),{toggleFeedback:$}=FP(),{updateSortOrder:k}=VP(),M=D.data?.items||[],B=Mi(),{addLoadingHold:U,removeLoadingHold:q}=jn();j.useEffect(()=>(D.isLoading?U("settings-feedback","Loading feedback..."):q("settings-feedback"),()=>q("settings-feedback")),[D.isLoading,U,q]);function I(oe){oe.preventDefault(),!(!l.trim()||!S.username||!T)&&(V.mutate({userId:T.uid,userEmail:S.username,text:l.trim(),feedbackType:h,currentPath:"/settings/feedback"}),d(""),f("bug"),o(!1))}function N(oe){oe.is_done?O(oe):g(oe)}async function O(oe){try{await $.mutateAsync({item:oe})}catch(be){console.error("[Feedback] Error updating feedback:",be),Jn.add({type:"error",message:"Failed to update feedback",autoDismissMs:5e3})}}function J(){p&&(O(p),g(null))}async function Y(){_(!1);const oe="mark-all-feedback-complete";U(oe,`Marking ${Q.length} item${Q.length!==1?"s":""} as complete...`);try{const be=new Date().toISOString(),Me=new Set(Q.map(de=>de.id)),ze=new Map;for(const de of Q)ze.has(de.doc_id)||ze.set(de.doc_id,[]),ze.get(de.doc_id).push(de);const at=[];for(const[de,ye]of ze){const ee=(async()=>{const ae=(await iA(de,"mark all feedback complete")).items.map(Ee=>Me.has(Ee.id)?{...Ee,is_done:!0,completed_at:be}:Ee);await X0({docId:de,items:ae,description:`marking ${ye.length} feedback item${ye.length!==1?"s":""} as complete`})})();at.push(ee)}await Promise.all(at);const lt=Ce.feedback(),L=R.getQueryData(lt);L&&R.setQueryData(lt,{items:L.items.map(de=>Me.has(de.id)?{...de,is_done:!0,completed_at:be}:de)}),await R.invalidateQueries({queryKey:lt}),Jn.add({type:"success",message:`Marked ${Q.length} item${Q.length!==1?"s":""} as complete`,autoDismissMs:3e3})}catch(be){console.error("[Feedback] Error marking all as complete:",be),Jn.add({type:"error",message:"Failed to mark all items as complete",autoDismissMs:5e3}),await R.invalidateQueries({queryKey:Ce.feedback()})}finally{q(oe)}}function G(){Y()}async function Z(oe){if(w){try{const Me=M.filter(ze=>ze.doc_id===w.doc_id).map(ze=>({id:ze.id,text:ze.text,created_at:ze.created_at,is_done:ze.is_done,completed_at:ze.completed_at,sort_order:ze.sort_order,feedback_type:ze.id===w.id?oe:ze.feedback_type}));await k.mutateAsync({docId:w.doc_id,items:Me})}catch(be){console.error("[Feedback] Error updating feedback type:",be),Jn.add({type:"error",message:"Failed to update feedback type",autoDismissMs:5e3})}x(null)}}const Q=M.filter(oe=>!oe.is_done).sort((oe,be)=>oe.sort_order-be.sort_order),te=M.filter(oe=>oe.is_done).sort((oe,be)=>new Date(be.completed_at||0).getTime()-new Date(oe.completed_at||0).getTime());function z(oe,be){e(be),oe.dataTransfer.effectAllowed="move"}function H(oe,be){oe.preventDefault(),be!==t&&r(be)}function re(){r(null)}function ne(){e(null),r(null)}async function ce(oe,be){if(oe.preventDefault(),!t||t===be){ne();return}const Me=Q.findIndex(de=>de.id===t),ze=[...Q],[at]=ze.splice(Me,1);if(be==="__end__")ze.push(at);else{const de=ze.findIndex(ye=>ye.id===be);ze.splice(de,0,at)}const lt=ze.map((de,ye)=>({...de,sort_order:ye}));ne();const L=new Map;for(const de of lt)L.has(de.doc_id)||L.set(de.doc_id,[]),L.get(de.doc_id).push({id:de.id,text:de.text,created_at:de.created_at,is_done:de.is_done,completed_at:de.completed_at,sort_order:de.sort_order,feedback_type:de.feedback_type});for(const de of te)L.has(de.doc_id)||L.set(de.doc_id,[]),L.get(de.doc_id).push({id:de.id,text:de.text,created_at:de.created_at,is_done:de.is_done,completed_at:de.completed_at,sort_order:de.sort_order,feedback_type:de.feedback_type});try{for(const[de,ye]of L)await k.mutateAsync({docId:de,items:ye})}catch(de){console.error("[Feedback] Error saving order:",de),Jn.add({type:"error",message:"Failed to save order",autoDismissMs:5e3})}}function he(){const oe=we(Q),be=new Blob([oe],{type:"text/markdown"}),Me=URL.createObjectURL(be),ze=document.createElement("a");ze.href=Me,ze.download=`feedback-${new Date().toISOString().split("T")[0]}.md`,document.body.appendChild(ze),ze.click(),document.body.removeChild(ze),URL.revokeObjectURL(Me)}function we(oe){let be=`# Feedback Export

`;return be+=`Generated: ${new Date().toISOString()}

`,oe.length>0&&(be+=`## Pending

`,oe.forEach((Me,ze)=>{const at=Me.feedback_type?Uf[Me.feedback_type]?.label||Me.feedback_type:"Unknown";be+=`### ${ze+1}. [${at}] ${Me.text.split(`
`)[0].substring(0,60)}${Me.text.split(`
`)[0].length>60?"...":""}

`,be+=`- **Type:** ${at}
`,be+=`- **Created:** ${Me.created_at}
`,be+=`- **User:** ${Me.user_email||Me.doc_id}
`,be+=`- **ID:** ${Me.id}

`,be+=`${Me.text}

`,be+=`---

`})),be}return D.isLoading?null:u.jsxs("div",{children:[u.jsxs("div",{style:{display:"flex",flexDirection:B?"column":"row",justifyContent:"space-between",alignItems:B?"stretch":"flex-start",gap:B?"0.75rem":"1rem",marginTop:"1.5rem",marginBottom:"0.5rem"},children:[u.jsxs("div",{children:[u.jsx("h2",{style:{marginTop:0},children:"Feedback"}),u.jsx("p",{style:{...zT,fontSize:"0.9rem"},children:"View and manage user feedback. Drag to reorder pending items."})]}),u.jsxs("div",{style:{display:"flex",gap:"0.75rem",flexDirection:B?"column":"row"},children:[u.jsx($e,{variant:"secondary",actionName:"Download Feedback as Markdown",onClick:he,disabled:Q.length===0,style:B?{width:"100%"}:void 0,children:"Download Markdown"}),u.jsx($e,{variant:"secondary",actionName:"Mark All Complete",onClick:()=>_(!0),disabled:Q.length===0,style:B?{width:"100%"}:void 0,children:"Mark All Complete"})]})]}),u.jsxs("div",{style:kS,children:[Q.length===0&&!i&&u.jsx("p",{style:{opacity:.7},children:"No pending feedback."}),Q.map(oe=>u.jsx(CB,{item:oe,isDragging:t===oe.id,isDragOver:n===oe.id,onDragStart:be=>z(be,oe.id),onDragOver:be=>H(be,oe.id),onDragLeave:re,onDragEnd:ne,onDrop:be=>ce(be,oe.id),onToggleDone:()=>N(oe),onTypeClick:()=>x(oe)},oe.id)),t&&Q.length>0&&u.jsx(LP,{isActive:n==="__end__",onDragOver:oe=>H(oe,"__end__"),onDragLeave:re,onDrop:oe=>ce(oe,"__end__")})]}),i?u.jsxs(Ri,{actionName:"Add Feedback",onSubmit:I,children:[u.jsx(u1,{selectedType:h,onSelect:f}),u.jsx(K0,{value:l,onChange:oe=>d(oe.target.value),placeholder:"Enter your feedback, bug report, or feature request...",autoFocus:!0,required:!0}),u.jsxs(qa,{children:[u.jsx($e,{type:"submit",actionName:"Add Feedback",disabled:!l.trim(),children:"Add Feedback"}),u.jsx($e,{type:"button",variant:"secondary",actionName:"Cancel Add Feedback",onClick:()=>{o(!1),d(""),f("bug")},children:"Cancel"})]})]}):u.jsx($e,{variant:"primary-large",actionName:"Open Add Feedback Form",onClick:()=>o(!0),children:"+ Add Feedback"}),te.length>0&&u.jsx(Z0,{title:"Completed",count:te.length,children:u.jsx("div",{style:{...kS,marginTop:"0.5rem"},children:te.map(oe=>u.jsx(TB,{item:oe,onToggleDone:()=>N(oe),onTypeClick:()=>x(oe)},oe.id))})}),u.jsxs(Qs,{isOpen:p!==null,onClose:()=>g(null),title:"Mark as Complete",children:[u.jsx("p",{style:{margin:"0 0 1.5rem 0"},children:"Are you sure you want to mark this feedback item as complete?"}),p&&u.jsxs("p",{style:{margin:"0 0 1.5rem 0",padding:"0.75rem",background:"rgba(255,255,255,0.05)",borderRadius:"0.5rem",fontSize:"0.9rem"},children:['"',p.text,'"']}),u.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[u.jsx($e,{variant:"secondary",actionName:"Cancel Mark Complete",onClick:()=>g(null),children:"Cancel"}),u.jsx($e,{variant:"primary",actionName:"Confirm Mark Complete",onClick:J,children:"Mark Complete"})]})]}),u.jsxs(Qs,{isOpen:b,onClose:()=>_(!1),title:"Mark All as Complete",children:[u.jsxs("p",{style:{margin:"0 0 1.5rem 0"},children:["Are you sure you want to mark all ",Q.length," pending feedback item",Q.length!==1?"s":""," as complete?"]}),u.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[u.jsx($e,{variant:"secondary",actionName:"Cancel Mark All Complete",onClick:()=>_(!1),children:"Cancel"}),u.jsx($e,{variant:"primary",actionName:"Confirm Mark All Complete",onClick:G,children:"Mark All Complete"})]})]}),u.jsxs(Qs,{isOpen:w!==null,onClose:()=>x(null),title:"Change Feedback Type",children:[u.jsx("p",{style:{margin:"0 0 1rem 0",fontSize:"0.9rem",opacity:.8},children:"Select a new type for this feedback:"}),u.jsx(u1,{selectedType:w?.feedback_type||"bug",onSelect:Z}),u.jsx($e,{variant:"secondary",actionName:"Cancel Change Feedback Type",onClick:()=>x(null),style:{width:"100%"},children:"Cancel"})]})]})}function mL(){Pe.clear(),window.location.reload()}function pL(){const e=ki().get_current_firebase_user(),{selectedBudgetId:n}=Ze(),r=wP({currentUser:e}),i=CP({currentUser:e}),o=bP({currentUser:e}),l=eP({currentUser:e}),d=Y3({currentUser:e}),h=aP({currentUser:e}),f=F3({currentUser:e}),p=jP({currentUser:e}),g=DP({currentUser:e}),b=OP({currentUser:e,budgetId:n}),_=zP({currentUser:e}),w=N3({currentUser:e}),x=P3({currentUser:e}),S=r.isScanning||i.isScanning||o.isScanning||l.isScanning||d.isScanning||h.isScanning||f.isScanning||p.isScanning||g.isScanning||w.isScanning||x.isScanning,C=r.isRunning||i.isRunning||l.isRunning||d.isRunning||h.isRunning||f.isRunning||p.isRunning||g.isRunning||w.isDeleting||x.isDeleting||b.isDownloading||_.isUploading,T=async()=>{await Promise.all([r.scanStatus(),i.scanStatus(),o.scan(),l.scanStatus(),d.scanStatus(),h.scanStatus(),f.scan(),p.scanStatus(),g.scanStatus(),w.scanStatus(),x.scanStatus()])};return u.jsxs("div",{children:[u.jsx("style",{children:"@keyframes spin { to { transform: rotate(360deg); } }"}),u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"},children:[u.jsx("h2",{style:{margin:0},children:"Data Migrations"}),u.jsxs("button",{onClick:T,disabled:S||C,style:{background:"#646cff",color:"white",border:"none",padding:"0.5rem 1rem",borderRadius:"6px",cursor:S||C?"not-allowed":"pointer",fontWeight:500,opacity:S||C?.7:1,display:"flex",alignItems:"center",gap:"0.4rem",minWidth:"130px",minHeight:"36px"},children:[u.jsx("span",{style:{width:"18px",height:"18px",display:"inline-flex",justifyContent:"center",alignItems:"center",flexShrink:0},children:S?u.jsx($n,{noMargin:!0}):""}),"Refresh All"]})]}),u.jsx("p",{style:{opacity:.7,marginBottom:"1.5rem"},children:'Run migrations to validate and fix your database. Click "Refresh All" to scan Firestore directly.'}),u.jsx(zB,{disabled:!e,onDownloadBackup:b.downloadBudget,isDownloadingBackup:b.isDownloading,removeTotalFieldsMigration:{status:r.status,hasData:!!r.status,needsMigration:r.needsMigration,totalItemsToFix:r.totalItemsToFix,isScanning:r.isScanning,isRunning:r.isRunning,result:r.result,scanStatus:r.scanStatus,runMigration:r.runMigration},removePreviousMonthIncomeMigration:{status:i.status,hasData:!!i.status,needsMigration:i.needsMigration,totalItemsToFix:i.totalItemsToFix,isScanning:i.isScanning,isRunning:i.isRunning,result:i.result,scanStatus:i.scanStatus,runMigration:i.runMigration}}),u.jsx(qB,{disabled:!e,onDownloadBackup:b.downloadBudget,isDownloadingBackup:b.isDownloading,accountCategoryValidation:{status:o.status,hasData:!!o.status,hasViolations:o.hasViolations,violationCount:o.violationCount,isScanning:o.isScanning,report:o.report,scan:o.scan},orphanedIdCleanup:{status:l.status,hasData:!!l.status,hasItemsToFix:l.hasItemsToFix,totalOrphaned:l.status?l.status.orphanedCategoryIds+l.status.orphanedAccountIds:0,isScanning:l.isScanning,isRunning:l.isRunning,result:l.result,scanStatus:l.scanStatus,runMigration:l.runMigration},expenseToAdjustment:{status:d.status,hasData:!!d.status,hasItemsToMigrate:d.hasItemsToMigrate,totalToMigrate:d.status?.expensesToMigrate??0,isScanning:d.isScanning,isRunning:d.isRunning,result:d.result,scanStatus:d.scanStatus,runMigration:d.runMigration},adjustmentsToTransfers:{status:h.status,hasData:!!h.status,hasPairsToConvert:h.hasPairsToConvert,totalPairs:h.status?.pairsFound??0,isScanning:h.isScanning,isRunning:h.isRunning,result:h.result,scanStatus:h.scanStatus,runMigration:h.runMigration},precisionCleanup:{status:f.status,hasData:f.hasData,hasIssues:f.hasIssues,totalIssues:f.totalIssues,isScanning:f.isScanning,isRunning:f.isRunning,result:f.result,scan:f.scan,runCleanup:f.runCleanup},recalculateStartBalances:{status:p.status,hasData:!!p.status,needsMigration:p.needsMigration,totalItemsToFix:p.totalItemsToFix,isScanning:p.isScanning,isRunning:p.isRunning,result:p.result,scanStatus:p.scanStatus,runMigration:p.runMigration},repairMonthMap:{status:g.status,hasData:!!g.status,needsMigration:g.needsMigration,totalItemsToFix:g.totalItemsToFix,isScanning:g.isScanning,isRunning:g.isRunning,result:g.result,scanStatus:g.scanStatus,runMigration:g.runMigration}}),u.jsx(KB,{disabled:!e,onDownloadBackup:b.downloadBudget,isDownloadingBackup:b.isDownloading,budgetDownloadUpload:{isDownloading:b.isDownloading,downloadProgress:b.progress,downloadError:b.error,downloadBudget:b.downloadBudget,isScanning:_.isScanning,isUploading:_.isUploading,uploadStatus:_.status,uploadProgress:_.progress,uploadError:_.error,uploadResult:_.result,scanZipFile:_.scanZipFile,uploadBudget:_.uploadBudget},deleteAllMonths:{status:w.status,hasData:!!w.status,monthsCount:w.status?.monthsCount??0,budgetCount:w.status?.budgetCount??0,isScanning:w.isScanning,isDeleting:w.isDeleting,deleteResult:w.deleteResult,deleteProgress:w.deleteProgress,scanStatus:w.scanStatus,deleteAllMonths:w.deleteAllMonths},deleteSampleUserBudget:{status:x.status,hasData:!!x.status,totalBudgets:x.status?.totalBudgets??0,totalMonths:x.status?.totalMonths??0,isScanning:x.isScanning,isDeleting:x.isDeleting,deleteResult:x.deleteResult,deleteProgress:x.deleteProgress,scanStatus:x.scanStatus,deleteSampleUserBudget:x.deleteSampleUserBudget},onClearCache:mL}),u.jsx("div",{style:{background:"color-mix(in srgb, currentColor 3%, transparent)",padding:"1rem",borderRadius:"8px",fontSize:"0.85rem"},children:u.jsxs("p",{style:{margin:0,opacity:.7},children:[u.jsx("strong",{children:"Note:"})," These migrations will process ",u.jsx("strong",{children:"all budgets and months"})," in the system, not just the ones you own or are invited to."]})}),u.jsx(hA,{})]})}function Pl({name:t,description:e,expectedBehavior:n,result:r,onRun:i,disabled:o,expectedToSucceed:l}){const d=r?.status==="passed"?ge.success:r?.status==="failed"?ge.danger:r?.status==="running"?ge.warning:"inherit";return u.jsxs("div",{style:{...G0,display:"flex",flexDirection:"column",gap:"0.5rem"},children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",gap:"1rem"},children:[u.jsxs("div",{style:{flex:1},children:[u.jsx("h4",{style:{margin:0,fontSize:"0.95rem"},children:t}),u.jsx("p",{style:{margin:"0.25rem 0 0",opacity:.7,fontSize:"0.85rem"},children:e}),u.jsxs("p",{style:{margin:"0.25rem 0 0",fontSize:"0.8rem",color:l?ge.success:ge.warning},children:["Expected: ",n]})]}),u.jsx($e,{onClick:i,disabled:o,variant:"secondary",style:{flexShrink:0},children:r?.status==="running"?"":"Run"})]}),r&&r.status!=="pending"&&u.jsx("div",{style:{padding:"0.5rem 0.75rem",borderRadius:"6px",background:`color-mix(in srgb, ${d} 15%, transparent)`,border:`1px solid color-mix(in srgb, ${d} 30%, transparent)`,fontSize:"0.85rem",color:d},children:r.message})]})}function gL({totalCount:t,passedCount:e,failedCount:n}){return u.jsxs("div",{style:{display:"flex",gap:"1rem",padding:"0.75rem 1rem",borderRadius:"8px",background:"color-mix(in srgb, currentColor 5%, transparent)",marginBottom:"1rem"},children:[u.jsxs("span",{children:["Total: ",u.jsx("strong",{children:t})]}),u.jsxs("span",{style:{color:ge.success},children:["Passed: ",u.jsx("strong",{children:e})]}),u.jsxs("span",{style:{color:ge.danger},children:["Failed: ",u.jsx("strong",{children:n})]})]})}const d1=[{name:"Read unauthorized budget",expectedToFail:!0},{name:"Read another user's document",expectedToFail:!0},{name:"Read unauthorized budget month",expectedToFail:!0},{name:"Toggle is_admin in own permission_flags",expectedToFail:!0},{name:"Toggle is_test in own permission_flags",expectedToFail:!0},{name:"Read own user document",expectedToFail:!1}];function yL(){const{currentUserId:t}=Ze(),[e,n]=j.useState([]),[r,i]=j.useState(!1);function o(_,w){n(x=>x.map(S=>S.name===_?{...S,...w}:S))}async function l(_,w,x){o(_,{status:"running",message:"Running..."});try{const S=await w();x?o(_,{status:"failed",message:` ${S}`}):o(_,{status:"passed",message:` ${S}`})}catch(S){const C=S instanceof Error?S.message:"Unknown error";x?o(_,{status:"passed",message:` Blocked as expected: ${C}`}):o(_,{status:"failed",message:` ${C}`})}}async function d(){i(!0),n(d1.map(_=>({..._,status:"pending",message:""})));for(const _ of d1)await h(_.name);i(!1)}async function h(_){switch(_){case"Read unauthorized budget":await l(_,async()=>(await Lt("budgets","unauthorized_budget_test_12345","security test: attempting unauthorized budget read"),"Was able to read budget (unexpected)"),!0);break;case"Read another user's document":await l(_,async()=>(await Lt("users","another_user_test_12345","security test: attempting unauthorized user read"),"Was able to read user document (unexpected)"),!0);break;case"Read unauthorized budget month":await l(_,async()=>(await Lt("months","unauthorized_budget_test_12345_2024_01","security test: attempting unauthorized month read"),"Was able to read month document for unauthorized budget (unexpected)"),!0);break;case"Toggle is_admin in own permission_flags":await l(_,async()=>{if(!t)throw new Error("Not authenticated");const{data:w}=await Lt("users",t,"security test: reading own user to get current is_admin value"),x=w?.permission_flags?.is_admin??!1;return await qu("users",t,{"permission_flags.is_admin":!x},"security test: attempting to toggle is_admin (should fail)"),`Was able to change is_admin from ${x} to ${!x} (SECURITY ISSUE!)`},!0);break;case"Toggle is_test in own permission_flags":await l(_,async()=>{if(!t)throw new Error("Not authenticated");const{data:w}=await Lt("users",t,"security test: reading own user to get current is_test value"),x=w?.permission_flags?.is_test??!1;return await qu("users",t,{"permission_flags.is_test":!x},"security test: attempting to toggle is_test (should fail)"),`Was able to change is_test from ${x} to ${!x} (SECURITY ISSUE!)`},!0);break;case"Read own user document":await l(_,async()=>{if(!t)throw new Error("Not authenticated");const{exists:w}=await Lt("users",t,"security test: reading own user document (should succeed)");if(w)return"Successfully read own document";throw new Error("Document does not exist")},!1);break}}async function f(_){e.find(x=>x.name===_)||n(x=>[...x,{name:_,status:"pending",message:"",expectedToFail:!0}]),i(!0),await h(_),i(!1)}const p=e.filter(_=>_.status==="passed").length,g=e.filter(_=>_.status==="failed").length,b=e.length;return u.jsxs("div",{children:[u.jsx("p",{style:zT,children:'Run security tests to verify Firestore rules are working correctly. Tests that are expected to fail (blocked by security rules) should show as "passed".'}),u.jsx("div",{style:{marginBottom:"1.5rem"},children:u.jsx($e,{onClick:d,disabled:r,variant:"primary",children:r?"Running Tests...":"Run All Tests"})}),e.length>0&&u.jsx(gL,{totalCount:b,passedCount:p,failedCount:g}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:[u.jsx("h3",{style:{margin:"0.5rem 0"},children:"Individual Tests"}),u.jsx(Pl,{name:"Read unauthorized budget",description:"Try to read a budget the user doesn't have access to",expectedBehavior:"Should be blocked by Firestore rules",result:e.find(_=>_.name==="Read unauthorized budget"),onRun:()=>f("Read unauthorized budget"),disabled:r}),u.jsx(Pl,{name:"Read another user's document",description:"Try to read another user's profile document",expectedBehavior:"Should be blocked by Firestore rules",result:e.find(_=>_.name==="Read another user's document"),onRun:()=>f("Read another user's document"),disabled:r}),u.jsx(Pl,{name:"Read unauthorized budget month",description:"Try to read a month document for a budget you don't have access to",expectedBehavior:"Should be blocked - months inherit budget access",result:e.find(_=>_.name==="Read unauthorized budget month"),onRun:()=>f("Read unauthorized budget month"),disabled:r}),u.jsx(Pl,{name:"Toggle is_admin in own permission_flags",description:"Try to change your admin privileges (toggles current value)",expectedBehavior:"Should be blocked - permission_flags is protected",result:e.find(_=>_.name==="Toggle is_admin in own permission_flags"),onRun:()=>f("Toggle is_admin in own permission_flags"),disabled:r}),u.jsx(Pl,{name:"Toggle is_test in own permission_flags",description:"Try to change your test privileges (toggles current value)",expectedBehavior:"Should be blocked - permission_flags is protected",result:e.find(_=>_.name==="Toggle is_test in own permission_flags"),onRun:()=>f("Toggle is_test in own permission_flags"),disabled:r}),u.jsx(Pl,{name:"Read own user document",description:"Read your own user profile document",expectedBehavior:"Should succeed - users can read their own data",result:e.find(_=>_.name==="Read own user document"),onRun:()=>f("Read own user document"),disabled:r,expectedToSucceed:!0})]}),g>0&&u.jsxs(wm,{style:{marginTop:"1.5rem"},children:[" ",g," test(s) failed! This may indicate a security vulnerability in your Firestore rules."]})]})}function _L({children:t}){const{addLoadingHold:e,removeLoadingHold:n}=jn(),r=j.useContext(_d),i=tr();return j.useEffect(()=>(r.is_auth_checked?n("protected-route"):e("protected-route","Checking authentication..."),()=>n("protected-route")),[r.is_auth_checked,e,n]),r.is_auth_checked?r.is_logged_in?t?u.jsx(u.Fragment,{children:t}):u.jsx(qf,{}):u.jsx($f,{to:"/account",state:{from:i.pathname},replace:!0}):null}function bL(){const{addLoadingHold:t,removeLoadingHold:e}=jn(),{isInitialized:n,pageTitle:r}=Ze(),{isLoading:i,error:o}=On();return j.useEffect(()=>{n?e("budget-init"):t("budget-init",i?"Fetching data from server...":"Loading budget...")},[n,i,t,e]),j.useEffect(()=>()=>e("budget-init"),[e]),o?(console.error("[BudgetLayout] Error:",o),u.jsx("div",{style:Pf,children:u.jsxs("p",{style:{color:"#ef4444"},children:["Error: ",o.message]})})):u.jsx("div",{style:{...Pf,paddingBottom:"5rem"},children:u.jsxs(lA,{children:[u.jsx(QP,{title:r}),n&&u.jsx(qf,{})]})})}const vL={is_logged_in:!1,is_auth_checked:!1,username:"",set_user_context:()=>{}};function xL(){const{isLoading:t,loadingMessage:e}=jn();return t?u.jsx(YB,{message:e}):null}function wL(){const[t,e]=j.useState(null);return j.useEffect(()=>Jn.subscribe(e),[]),t?u.jsx(YP,{item:t,onDismiss:n=>Jn.remove(n)}):null}function SL(){const{selectedBudgetId:t,isInitialized:e}=Ze(),n=Ut(),r=t?["initialDataLoad",t]:null,i=r?n.getQueryState(r)?.status==="success":!1;return Rn(),w3(t,i&&e),u.jsxs(u.Fragment,{children:[u.jsxs(sj,{children:[u.jsx(En,{path:"/",element:u.jsx(XB,{})}),u.jsx(En,{path:"/account",element:u.jsx(ZB,{})}),u.jsx(En,{path:"/budget",element:u.jsx(_L,{}),children:u.jsxs(En,{element:u.jsx(bL,{}),children:[u.jsx(En,{index:!0,element:u.jsx(r1,{})}),u.jsx(En,{path:":year/:month/:tab/:view?",element:u.jsx(r1,{})}),u.jsx(En,{path:"analytics",element:u.jsx(Hz,{})}),u.jsx(En,{path:"my-budgets",element:u.jsx(eL,{})}),u.jsxs(En,{path:"settings",element:u.jsx(nL,{}),children:[u.jsx(En,{index:!0,element:u.jsx($f,{to:"categories",replace:!0})}),u.jsx(En,{path:"accounts",element:u.jsx(iL,{})}),u.jsx(En,{path:"categories",element:u.jsx(lL,{})}),u.jsx(En,{path:"users",element:u.jsx(cL,{})})]}),u.jsxs(En,{path:"admin",element:u.jsx(dL,{}),children:[u.jsx(En,{path:"budget",element:u.jsx(hL,{})}),u.jsx(En,{path:"feedback",element:u.jsx(fL,{})}),u.jsx(En,{path:"migration",element:u.jsx(pL,{})}),u.jsx(En,{path:"tests",element:u.jsx(yL,{})})]})]})})]}),u.jsx(HP,{}),u.jsx(hA,{}),u.jsx(wL,{})]})}function EL(){const[t,e]=j.useState(vL),n=ki(),r=j.useRef(!1),{addLoadingHold:i,removeLoadingHold:o}=jn();return j.useEffect(function(){r.current||(r.current=!0,n.set_user_listener(l=>{e({is_logged_in:l!=null,is_auth_checked:!0,username:l?.email??"",set_user_context:e})}))},[n]),j.useEffect(()=>{t.is_auth_checked?o("auth"):i("auth","Authenticating...")},[t.is_auth_checked,i,o]),t.is_auth_checked?u.jsx(_d.Provider,{value:t,children:u.jsx(SM,{children:u.jsx(wB,{children:u.jsx(r3,{children:u.jsx(D3,{children:u.jsx(Rj,{children:u.jsx(SL,{})})})})})})}):null}function CL(){return u.jsxs(xR,{children:[u.jsx(xL,{}),u.jsx(EL,{})]})}s5.createRoot(document.getElementById("root")).render(u.jsx(j.StrictMode,{children:u.jsx(CL,{})}));
