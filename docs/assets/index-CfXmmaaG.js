(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function n(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=n(i);fetch(i.href,o)}})();var Mh=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function P2(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var bg={exports:{}},pu={};var wx;function B2(){if(wx)return pu;wx=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function n(r,i,o){var l=null;if(o!==void 0&&(l=""+o),i.key!==void 0&&(l=""+i.key),"key"in i){o={};for(var d in i)d!=="key"&&(o[d]=i[d])}else o=i;return i=o.ref,{$$typeof:t,type:r,key:l,ref:i!==void 0?i:null,props:o}}return pu.Fragment=e,pu.jsx=n,pu.jsxs=n,pu}var Sx;function z2(){return Sx||(Sx=1,bg.exports=B2()),bg.exports}var u=z2(),vg={exports:{}},Je={};var Ex;function L2(){if(Ex)return Je;Ex=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),o=Symbol.for("react.consumer"),l=Symbol.for("react.context"),d=Symbol.for("react.forward_ref"),h=Symbol.for("react.suspense"),m=Symbol.for("react.memo"),p=Symbol.for("react.lazy"),g=Symbol.for("react.activity"),v=Symbol.iterator;function b(z){return z===null||typeof z!="object"?null:(z=v&&z[v]||z["@@iterator"],typeof z=="function"?z:null)}var E={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},x=Object.assign,S={};function C(z,G,te){this.props=z,this.context=G,this.refs=S,this.updater=te||E}C.prototype.isReactComponent={},C.prototype.setState=function(z,G){if(typeof z!="object"&&typeof z!="function"&&z!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,z,G,"setState")},C.prototype.forceUpdate=function(z){this.updater.enqueueForceUpdate(this,z,"forceUpdate")};function T(){}T.prototype=C.prototype;function I(z,G,te){this.props=z,this.context=G,this.refs=S,this.updater=te||E}var O=I.prototype=new T;O.constructor=I,x(O,C.prototype),O.isPureReactComponent=!0;var U=Array.isArray;function $(){}var k={H:null,A:null,T:null,S:null},R=Object.prototype.hasOwnProperty;function N(z,G,te){var se=te.ref;return{$$typeof:t,type:z,key:G,ref:se!==void 0?se:null,props:te}}function V(z,G){return N(z.type,G,z.props)}function H(z){return typeof z=="object"&&z!==null&&z.$$typeof===t}function j(z){var G={"=":"=0",":":"=2"};return"$"+z.replace(/[=:]/g,function(te){return G[te]})}var B=/\/+/g;function M(z,G){return typeof z=="object"&&z!==null&&z.key!=null?j(""+z.key):G.toString(36)}function Z(z){switch(z.status){case"fulfilled":return z.value;case"rejected":throw z.reason;default:switch(typeof z.status=="string"?z.then($,$):(z.status="pending",z.then(function(G){z.status==="pending"&&(z.status="fulfilled",z.value=G)},function(G){z.status==="pending"&&(z.status="rejected",z.reason=G)})),z.status){case"fulfilled":return z.value;case"rejected":throw z.reason}}throw z}function K(z,G,te,se,ie){var ce=typeof z;(ce==="undefined"||ce==="boolean")&&(z=null);var we=!1;if(z===null)we=!0;else switch(ce){case"bigint":case"string":case"number":we=!0;break;case"object":switch(z.$$typeof){case t:case e:we=!0;break;case p:return we=z._init,K(we(z._payload),G,te,se,ie)}}if(we)return ie=ie(z),we=se===""?"."+M(z,0):se,U(ie)?(te="",we!=null&&(te=we.replace(B,"$&/")+"/"),K(ie,G,te,"",function(Ue){return Ue})):ie!=null&&(H(ie)&&(ie=V(ie,te+(ie.key==null||z&&z.key===ie.key?"":(""+ie.key).replace(B,"$&/")+"/")+we)),G.push(ie)),1;we=0;var he=se===""?".":se+":";if(U(z))for(var Ee=0;Ee<z.length;Ee++)se=z[Ee],ce=he+M(se,Ee),we+=K(se,G,te,ce,ie);else if(Ee=b(z),typeof Ee=="function")for(z=Ee.call(z),Ee=0;!(se=z.next()).done;)se=se.value,ce=he+M(se,Ee++),we+=K(se,G,te,ce,ie);else if(ce==="object"){if(typeof z.then=="function")return K(Z(z),G,te,se,ie);throw G=String(z),Error("Objects are not valid as a React child (found: "+(G==="[object Object]"?"object with keys {"+Object.keys(z).join(", ")+"}":G)+"). If you meant to render a collection of children, use an array instead.")}return we}function q(z,G,te){if(z==null)return z;var se=[],ie=0;return K(z,se,"","",function(ce){return G.call(te,ce,ie++)}),se}function W(z){if(z._status===-1){var G=z._result;G=G(),G.then(function(te){(z._status===0||z._status===-1)&&(z._status=1,z._result=te)},function(te){(z._status===0||z._status===-1)&&(z._status=2,z._result=te)}),z._status===-1&&(z._status=0,z._result=G)}if(z._status===1)return z._result.default;throw z._result}var X=typeof reportError=="function"?reportError:function(z){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var G=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof z=="object"&&z!==null&&typeof z.message=="string"?String(z.message):String(z),error:z});if(!window.dispatchEvent(G))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",z);return}console.error(z)},re={map:q,forEach:function(z,G,te){q(z,function(){G.apply(this,arguments)},te)},count:function(z){var G=0;return q(z,function(){G++}),G},toArray:function(z){return q(z,function(G){return G})||[]},only:function(z){if(!H(z))throw Error("React.Children.only expected to receive a single React element child.");return z}};return Je.Activity=g,Je.Children=re,Je.Component=C,Je.Fragment=n,Je.Profiler=i,Je.PureComponent=I,Je.StrictMode=r,Je.Suspense=h,Je.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=k,Je.__COMPILER_RUNTIME={__proto__:null,c:function(z){return k.H.useMemoCache(z)}},Je.cache=function(z){return function(){return z.apply(null,arguments)}},Je.cacheSignal=function(){return null},Je.cloneElement=function(z,G,te){if(z==null)throw Error("The argument must be a React element, but you passed "+z+".");var se=x({},z.props),ie=z.key;if(G!=null)for(ce in G.key!==void 0&&(ie=""+G.key),G)!R.call(G,ce)||ce==="key"||ce==="__self"||ce==="__source"||ce==="ref"&&G.ref===void 0||(se[ce]=G[ce]);var ce=arguments.length-2;if(ce===1)se.children=te;else if(1<ce){for(var we=Array(ce),he=0;he<ce;he++)we[he]=arguments[he+2];se.children=we}return N(z.type,ie,se)},Je.createContext=function(z){return z={$$typeof:l,_currentValue:z,_currentValue2:z,_threadCount:0,Provider:null,Consumer:null},z.Provider=z,z.Consumer={$$typeof:o,_context:z},z},Je.createElement=function(z,G,te){var se,ie={},ce=null;if(G!=null)for(se in G.key!==void 0&&(ce=""+G.key),G)R.call(G,se)&&se!=="key"&&se!=="__self"&&se!=="__source"&&(ie[se]=G[se]);var we=arguments.length-2;if(we===1)ie.children=te;else if(1<we){for(var he=Array(we),Ee=0;Ee<we;Ee++)he[Ee]=arguments[Ee+2];ie.children=he}if(z&&z.defaultProps)for(se in we=z.defaultProps,we)ie[se]===void 0&&(ie[se]=we[se]);return N(z,ce,ie)},Je.createRef=function(){return{current:null}},Je.forwardRef=function(z){return{$$typeof:d,render:z}},Je.isValidElement=H,Je.lazy=function(z){return{$$typeof:p,_payload:{_status:-1,_result:z},_init:W}},Je.memo=function(z,G){return{$$typeof:m,type:z,compare:G===void 0?null:G}},Je.startTransition=function(z){var G=k.T,te={};k.T=te;try{var se=z(),ie=k.S;ie!==null&&ie(te,se),typeof se=="object"&&se!==null&&typeof se.then=="function"&&se.then($,X)}catch(ce){X(ce)}finally{G!==null&&te.types!==null&&(G.types=te.types),k.T=G}},Je.unstable_useCacheRefresh=function(){return k.H.useCacheRefresh()},Je.use=function(z){return k.H.use(z)},Je.useActionState=function(z,G,te){return k.H.useActionState(z,G,te)},Je.useCallback=function(z,G){return k.H.useCallback(z,G)},Je.useContext=function(z){return k.H.useContext(z)},Je.useDebugValue=function(){},Je.useDeferredValue=function(z,G){return k.H.useDeferredValue(z,G)},Je.useEffect=function(z,G){return k.H.useEffect(z,G)},Je.useEffectEvent=function(z){return k.H.useEffectEvent(z)},Je.useId=function(){return k.H.useId()},Je.useImperativeHandle=function(z,G,te){return k.H.useImperativeHandle(z,G,te)},Je.useInsertionEffect=function(z,G){return k.H.useInsertionEffect(z,G)},Je.useLayoutEffect=function(z,G){return k.H.useLayoutEffect(z,G)},Je.useMemo=function(z,G){return k.H.useMemo(z,G)},Je.useOptimistic=function(z,G){return k.H.useOptimistic(z,G)},Je.useReducer=function(z,G,te){return k.H.useReducer(z,G,te)},Je.useRef=function(z){return k.H.useRef(z)},Je.useState=function(z){return k.H.useState(z)},Je.useSyncExternalStore=function(z,G,te){return k.H.useSyncExternalStore(z,G,te)},Je.useTransition=function(){return k.H.useTransition()},Je.version="19.2.3",Je}var Cx;function Dy(){return Cx||(Cx=1,vg.exports=L2()),vg.exports}var D=Dy(),xg={exports:{}},gu={},wg={exports:{}},Sg={};var Tx;function U2(){return Tx||(Tx=1,(function(t){function e(K,q){var W=K.length;K.push(q);e:for(;0<W;){var X=W-1>>>1,re=K[X];if(0<i(re,q))K[X]=q,K[W]=re,W=X;else break e}}function n(K){return K.length===0?null:K[0]}function r(K){if(K.length===0)return null;var q=K[0],W=K.pop();if(W!==q){K[0]=W;e:for(var X=0,re=K.length,z=re>>>1;X<z;){var G=2*(X+1)-1,te=K[G],se=G+1,ie=K[se];if(0>i(te,W))se<re&&0>i(ie,te)?(K[X]=ie,K[se]=W,X=se):(K[X]=te,K[G]=W,X=G);else if(se<re&&0>i(ie,W))K[X]=ie,K[se]=W,X=se;else break e}}return q}function i(K,q){var W=K.sortIndex-q.sortIndex;return W!==0?W:K.id-q.id}if(t.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var o=performance;t.unstable_now=function(){return o.now()}}else{var l=Date,d=l.now();t.unstable_now=function(){return l.now()-d}}var h=[],m=[],p=1,g=null,v=3,b=!1,E=!1,x=!1,S=!1,C=typeof setTimeout=="function"?setTimeout:null,T=typeof clearTimeout=="function"?clearTimeout:null,I=typeof setImmediate<"u"?setImmediate:null;function O(K){for(var q=n(m);q!==null;){if(q.callback===null)r(m);else if(q.startTime<=K)r(m),q.sortIndex=q.expirationTime,e(h,q);else break;q=n(m)}}function U(K){if(x=!1,O(K),!E)if(n(h)!==null)E=!0,$||($=!0,j());else{var q=n(m);q!==null&&Z(U,q.startTime-K)}}var $=!1,k=-1,R=5,N=-1;function V(){return S?!0:!(t.unstable_now()-N<R)}function H(){if(S=!1,$){var K=t.unstable_now();N=K;var q=!0;try{e:{E=!1,x&&(x=!1,T(k),k=-1),b=!0;var W=v;try{t:{for(O(K),g=n(h);g!==null&&!(g.expirationTime>K&&V());){var X=g.callback;if(typeof X=="function"){g.callback=null,v=g.priorityLevel;var re=X(g.expirationTime<=K);if(K=t.unstable_now(),typeof re=="function"){g.callback=re,O(K),q=!0;break t}g===n(h)&&r(h),O(K)}else r(h);g=n(h)}if(g!==null)q=!0;else{var z=n(m);z!==null&&Z(U,z.startTime-K),q=!1}}break e}finally{g=null,v=W,b=!1}q=void 0}}finally{q?j():$=!1}}}var j;if(typeof I=="function")j=function(){I(H)};else if(typeof MessageChannel<"u"){var B=new MessageChannel,M=B.port2;B.port1.onmessage=H,j=function(){M.postMessage(null)}}else j=function(){C(H,0)};function Z(K,q){k=C(function(){K(t.unstable_now())},q)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(K){K.callback=null},t.unstable_forceFrameRate=function(K){0>K||125<K?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):R=0<K?Math.floor(1e3/K):5},t.unstable_getCurrentPriorityLevel=function(){return v},t.unstable_next=function(K){switch(v){case 1:case 2:case 3:var q=3;break;default:q=v}var W=v;v=q;try{return K()}finally{v=W}},t.unstable_requestPaint=function(){S=!0},t.unstable_runWithPriority=function(K,q){switch(K){case 1:case 2:case 3:case 4:case 5:break;default:K=3}var W=v;v=K;try{return q()}finally{v=W}},t.unstable_scheduleCallback=function(K,q,W){var X=t.unstable_now();switch(typeof W=="object"&&W!==null?(W=W.delay,W=typeof W=="number"&&0<W?X+W:X):W=X,K){case 1:var re=-1;break;case 2:re=250;break;case 5:re=1073741823;break;case 4:re=1e4;break;default:re=5e3}return re=W+re,K={id:p++,callback:q,priorityLevel:K,startTime:W,expirationTime:re,sortIndex:-1},W>X?(K.sortIndex=W,e(m,K),n(h)===null&&K===n(m)&&(x?(T(k),k=-1):x=!0,Z(U,W-X))):(K.sortIndex=re,e(h,K),E||b||(E=!0,$||($=!0,j()))),K},t.unstable_shouldYield=V,t.unstable_wrapCallback=function(K){var q=v;return function(){var W=v;v=q;try{return K.apply(this,arguments)}finally{v=W}}}})(Sg)),Sg}var Ax;function F2(){return Ax||(Ax=1,wg.exports=U2()),wg.exports}var Eg={exports:{}},Kn={};var jx;function V2(){if(jx)return Kn;jx=1;var t=Dy();function e(h){var m="https://react.dev/errors/"+h;if(1<arguments.length){m+="?args[]="+encodeURIComponent(arguments[1]);for(var p=2;p<arguments.length;p++)m+="&args[]="+encodeURIComponent(arguments[p])}return"Minified React error #"+h+"; visit "+m+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function n(){}var r={d:{f:n,r:function(){throw Error(e(522))},D:n,C:n,L:n,m:n,X:n,S:n,M:n},p:0,findDOMNode:null},i=Symbol.for("react.portal");function o(h,m,p){var g=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:i,key:g==null?null:""+g,children:h,containerInfo:m,implementation:p}}var l=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function d(h,m){if(h==="font")return"";if(typeof m=="string")return m==="use-credentials"?m:""}return Kn.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=r,Kn.createPortal=function(h,m){var p=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!m||m.nodeType!==1&&m.nodeType!==9&&m.nodeType!==11)throw Error(e(299));return o(h,m,null,p)},Kn.flushSync=function(h){var m=l.T,p=r.p;try{if(l.T=null,r.p=2,h)return h()}finally{l.T=m,r.p=p,r.d.f()}},Kn.preconnect=function(h,m){typeof h=="string"&&(m?(m=m.crossOrigin,m=typeof m=="string"?m==="use-credentials"?m:"":void 0):m=null,r.d.C(h,m))},Kn.prefetchDNS=function(h){typeof h=="string"&&r.d.D(h)},Kn.preinit=function(h,m){if(typeof h=="string"&&m&&typeof m.as=="string"){var p=m.as,g=d(p,m.crossOrigin),v=typeof m.integrity=="string"?m.integrity:void 0,b=typeof m.fetchPriority=="string"?m.fetchPriority:void 0;p==="style"?r.d.S(h,typeof m.precedence=="string"?m.precedence:void 0,{crossOrigin:g,integrity:v,fetchPriority:b}):p==="script"&&r.d.X(h,{crossOrigin:g,integrity:v,fetchPriority:b,nonce:typeof m.nonce=="string"?m.nonce:void 0})}},Kn.preinitModule=function(h,m){if(typeof h=="string")if(typeof m=="object"&&m!==null){if(m.as==null||m.as==="script"){var p=d(m.as,m.crossOrigin);r.d.M(h,{crossOrigin:p,integrity:typeof m.integrity=="string"?m.integrity:void 0,nonce:typeof m.nonce=="string"?m.nonce:void 0})}}else m==null&&r.d.M(h)},Kn.preload=function(h,m){if(typeof h=="string"&&typeof m=="object"&&m!==null&&typeof m.as=="string"){var p=m.as,g=d(p,m.crossOrigin);r.d.L(h,p,{crossOrigin:g,integrity:typeof m.integrity=="string"?m.integrity:void 0,nonce:typeof m.nonce=="string"?m.nonce:void 0,type:typeof m.type=="string"?m.type:void 0,fetchPriority:typeof m.fetchPriority=="string"?m.fetchPriority:void 0,referrerPolicy:typeof m.referrerPolicy=="string"?m.referrerPolicy:void 0,imageSrcSet:typeof m.imageSrcSet=="string"?m.imageSrcSet:void 0,imageSizes:typeof m.imageSizes=="string"?m.imageSizes:void 0,media:typeof m.media=="string"?m.media:void 0})}},Kn.preloadModule=function(h,m){if(typeof h=="string")if(m){var p=d(m.as,m.crossOrigin);r.d.m(h,{as:typeof m.as=="string"&&m.as!=="script"?m.as:void 0,crossOrigin:p,integrity:typeof m.integrity=="string"?m.integrity:void 0})}else r.d.m(h)},Kn.requestFormReset=function(h){r.d.r(h)},Kn.unstable_batchedUpdates=function(h,m){return h(m)},Kn.useFormState=function(h,m,p){return l.H.useFormState(h,m,p)},Kn.useFormStatus=function(){return l.H.useHostTransitionStatus()},Kn.version="19.2.3",Kn}var Rx;function $2(){if(Rx)return Eg.exports;Rx=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),Eg.exports=V2(),Eg.exports}var Ix;function q2(){if(Ix)return gu;Ix=1;var t=F2(),e=Dy(),n=$2();function r(s){var a="https://react.dev/errors/"+s;if(1<arguments.length){a+="?args[]="+encodeURIComponent(arguments[1]);for(var c=2;c<arguments.length;c++)a+="&args[]="+encodeURIComponent(arguments[c])}return"Minified React error #"+s+"; visit "+a+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(s){return!(!s||s.nodeType!==1&&s.nodeType!==9&&s.nodeType!==11)}function o(s){var a=s,c=s;if(s.alternate)for(;a.return;)a=a.return;else{s=a;do a=s,(a.flags&4098)!==0&&(c=a.return),s=a.return;while(s)}return a.tag===3?c:null}function l(s){if(s.tag===13){var a=s.memoizedState;if(a===null&&(s=s.alternate,s!==null&&(a=s.memoizedState)),a!==null)return a.dehydrated}return null}function d(s){if(s.tag===31){var a=s.memoizedState;if(a===null&&(s=s.alternate,s!==null&&(a=s.memoizedState)),a!==null)return a.dehydrated}return null}function h(s){if(o(s)!==s)throw Error(r(188))}function m(s){var a=s.alternate;if(!a){if(a=o(s),a===null)throw Error(r(188));return a!==s?null:s}for(var c=s,f=a;;){var _=c.return;if(_===null)break;var w=_.alternate;if(w===null){if(f=_.return,f!==null){c=f;continue}break}if(_.child===w.child){for(w=_.child;w;){if(w===c)return h(_),s;if(w===f)return h(_),a;w=w.sibling}throw Error(r(188))}if(c.return!==f.return)c=_,f=w;else{for(var P=!1,Q=_.child;Q;){if(Q===c){P=!0,c=_,f=w;break}if(Q===f){P=!0,f=_,c=w;break}Q=Q.sibling}if(!P){for(Q=w.child;Q;){if(Q===c){P=!0,c=w,f=_;break}if(Q===f){P=!0,f=w,c=_;break}Q=Q.sibling}if(!P)throw Error(r(189))}}if(c.alternate!==f)throw Error(r(190))}if(c.tag!==3)throw Error(r(188));return c.stateNode.current===c?s:a}function p(s){var a=s.tag;if(a===5||a===26||a===27||a===6)return s;for(s=s.child;s!==null;){if(a=p(s),a!==null)return a;s=s.sibling}return null}var g=Object.assign,v=Symbol.for("react.element"),b=Symbol.for("react.transitional.element"),E=Symbol.for("react.portal"),x=Symbol.for("react.fragment"),S=Symbol.for("react.strict_mode"),C=Symbol.for("react.profiler"),T=Symbol.for("react.consumer"),I=Symbol.for("react.context"),O=Symbol.for("react.forward_ref"),U=Symbol.for("react.suspense"),$=Symbol.for("react.suspense_list"),k=Symbol.for("react.memo"),R=Symbol.for("react.lazy"),N=Symbol.for("react.activity"),V=Symbol.for("react.memo_cache_sentinel"),H=Symbol.iterator;function j(s){return s===null||typeof s!="object"?null:(s=H&&s[H]||s["@@iterator"],typeof s=="function"?s:null)}var B=Symbol.for("react.client.reference");function M(s){if(s==null)return null;if(typeof s=="function")return s.$$typeof===B?null:s.displayName||s.name||null;if(typeof s=="string")return s;switch(s){case x:return"Fragment";case C:return"Profiler";case S:return"StrictMode";case U:return"Suspense";case $:return"SuspenseList";case N:return"Activity"}if(typeof s=="object")switch(s.$$typeof){case E:return"Portal";case I:return s.displayName||"Context";case T:return(s._context.displayName||"Context")+".Consumer";case O:var a=s.render;return s=s.displayName,s||(s=a.displayName||a.name||"",s=s!==""?"ForwardRef("+s+")":"ForwardRef"),s;case k:return a=s.displayName||null,a!==null?a:M(s.type)||"Memo";case R:a=s._payload,s=s._init;try{return M(s(a))}catch{}}return null}var Z=Array.isArray,K=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,q=n.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,W={pending:!1,data:null,method:null,action:null},X=[],re=-1;function z(s){return{current:s}}function G(s){0>re||(s.current=X[re],X[re]=null,re--)}function te(s,a){re++,X[re]=s.current,s.current=a}var se=z(null),ie=z(null),ce=z(null),we=z(null);function he(s,a){switch(te(ce,a),te(ie,s),te(se,null),a.nodeType){case 9:case 11:s=(s=a.documentElement)&&(s=s.namespaceURI)?Hv(s):0;break;default:if(s=a.tagName,a=a.namespaceURI)a=Hv(a),s=Gv(a,s);else switch(s){case"svg":s=1;break;case"math":s=2;break;default:s=0}}G(se),te(se,s)}function Ee(){G(se),G(ie),G(ce)}function Ue(s){s.memoizedState!==null&&te(we,s);var a=se.current,c=Gv(a,s.type);a!==c&&(te(ie,s),te(se,c))}function Be(s){ie.current===s&&(G(se),G(ie)),we.current===s&&(G(we),du._currentValue=W)}var gt,yt;function L(s){if(gt===void 0)try{throw Error()}catch(c){var a=c.stack.trim().match(/\n( *(at )?)/);gt=a&&a[1]||"",yt=-1<c.stack.indexOf(`
    at`)?" (<anonymous>)":-1<c.stack.indexOf("@")?"@unknown:0:0":""}return`
`+gt+s+yt}var de=!1;function ye(s,a){if(!s||de)return"";de=!0;var c=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var f={DetermineComponentFrameRoot:function(){try{if(a){var Re=function(){throw Error()};if(Object.defineProperty(Re.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Re,[])}catch(ve){var _e=ve}Reflect.construct(s,[],Re)}else{try{Re.call()}catch(ve){_e=ve}s.call(Re.prototype)}}else{try{throw Error()}catch(ve){_e=ve}(Re=s())&&typeof Re.catch=="function"&&Re.catch(function(){})}}catch(ve){if(ve&&_e&&typeof ve.stack=="string")return[ve.stack,_e.stack]}return[null,null]}};f.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var _=Object.getOwnPropertyDescriptor(f.DetermineComponentFrameRoot,"name");_&&_.configurable&&Object.defineProperty(f.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var w=f.DetermineComponentFrameRoot(),P=w[0],Q=w[1];if(P&&Q){var ne=P.split(`
`),ge=Q.split(`
`);for(_=f=0;f<ne.length&&!ne[f].includes("DetermineComponentFrameRoot");)f++;for(;_<ge.length&&!ge[_].includes("DetermineComponentFrameRoot");)_++;if(f===ne.length||_===ge.length)for(f=ne.length-1,_=ge.length-1;1<=f&&0<=_&&ne[f]!==ge[_];)_--;for(;1<=f&&0<=_;f--,_--)if(ne[f]!==ge[_]){if(f!==1||_!==1)do if(f--,_--,0>_||ne[f]!==ge[_]){var Ce=`
`+ne[f].replace(" at new "," at ");return s.displayName&&Ce.includes("<anonymous>")&&(Ce=Ce.replace("<anonymous>",s.displayName)),Ce}while(1<=f&&0<=_);break}}}finally{de=!1,Error.prepareStackTrace=c}return(c=s?s.displayName||s.name:"")?L(c):""}function ee(s,a){switch(s.tag){case 26:case 27:case 5:return L(s.type);case 16:return L("Lazy");case 13:return s.child!==a&&a!==null?L("Suspense Fallback"):L("Suspense");case 19:return L("SuspenseList");case 0:case 15:return ye(s.type,!1);case 11:return ye(s.type.render,!1);case 1:return ye(s.type,!0);case 31:return L("Activity");default:return""}}function J(s){try{var a="",c=null;do a+=ee(s,c),c=s,s=s.return;while(s);return a}catch(f){return`
Error generating stack: `+f.message+`
`+f.stack}}var oe=Object.prototype.hasOwnProperty,Se=t.unstable_scheduleCallback,xe=t.unstable_cancelCallback,ae=t.unstable_shouldYield,Ae=t.unstable_requestPaint,Oe=t.unstable_now,De=t.unstable_getCurrentPriorityLevel,qe=t.unstable_ImmediatePriority,xt=t.unstable_UserBlockingPriority,nt=t.unstable_NormalPriority,Qn=t.unstable_LowPriority,fs=t.unstable_IdlePriority,er=t.log,ms=t.unstable_setDisableYieldValue,bt=null,Jt=null;function Wn(s){if(typeof er=="function"&&ms(s),Jt&&typeof Jt.setStrictMode=="function")try{Jt.setStrictMode(bt,s)}catch{}}var Et=Math.clz32?Math.clz32:Lo,La=Math.log,Ti=Math.LN2;function Lo(s){return s>>>=0,s===0?32:31-(La(s)/Ti|0)|0}var Rr=256,ps=262144,Lt=4194304;function tr(s){var a=s&42;if(a!==0)return a;switch(s&-s){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return s&261888;case 262144:case 524288:case 1048576:case 2097152:return s&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return s&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return s}}function gs(s,a,c){var f=s.pendingLanes;if(f===0)return 0;var _=0,w=s.suspendedLanes,P=s.pingedLanes;s=s.warmLanes;var Q=f&134217727;return Q!==0?(f=Q&~w,f!==0?_=tr(f):(P&=Q,P!==0?_=tr(P):c||(c=Q&~s,c!==0&&(_=tr(c))))):(Q=f&~w,Q!==0?_=tr(Q):P!==0?_=tr(P):c||(c=f&~s,c!==0&&(_=tr(c)))),_===0?0:a!==0&&a!==_&&(a&w)===0&&(w=_&-_,c=a&-a,w>=c||w===32&&(c&4194048)!==0)?a:_}function Qr(s,a){return(s.pendingLanes&~(s.suspendedLanes&~s.pingedLanes)&a)===0}function Sm(s,a){switch(s){case 1:case 2:case 4:case 8:case 64:return a+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function ud(){var s=Lt;return Lt<<=1,(Lt&62914560)===0&&(Lt=4194304),s}function ys(s){for(var a=[],c=0;31>c;c++)a.push(s);return a}function Ua(s,a){s.pendingLanes|=a,a!==268435456&&(s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0)}function Em(s,a,c,f,_,w){var P=s.pendingLanes;s.pendingLanes=c,s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0,s.expiredLanes&=c,s.entangledLanes&=c,s.errorRecoveryDisabledLanes&=c,s.shellSuspendCounter=0;var Q=s.entanglements,ne=s.expirationTimes,ge=s.hiddenUpdates;for(c=P&~c;0<c;){var Ce=31-Et(c),Re=1<<Ce;Q[Ce]=0,ne[Ce]=-1;var _e=ge[Ce];if(_e!==null)for(ge[Ce]=null,Ce=0;Ce<_e.length;Ce++){var ve=_e[Ce];ve!==null&&(ve.lane&=-536870913)}c&=~Re}f!==0&&Fa(s,f,0),w!==0&&_===0&&s.tag!==0&&(s.suspendedLanes|=w&~(P&~a))}function Fa(s,a,c){s.pendingLanes|=a,s.suspendedLanes&=~a;var f=31-Et(a);s.entangledLanes|=a,s.entanglements[f]=s.entanglements[f]|1073741824|c&261930}function gc(s,a){var c=s.entangledLanes|=a;for(s=s.entanglements;c;){var f=31-Et(c),_=1<<f;_&a|s[f]&a&&(s[f]|=a),c&=~_}}function yc(s,a){var c=a&-a;return c=(c&42)!==0?1:Va(c),(c&(s.suspendedLanes|a))!==0?0:c}function Va(s){switch(s){case 2:s=1;break;case 8:s=4;break;case 32:s=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:s=128;break;case 268435456:s=134217728;break;default:s=0}return s}function Hs(s){return s&=-s,2<s?8<s?(s&134217727)!==0?32:268435456:8:2}function dd(){var s=q.p;return s!==0?s:(s=window.event,s===void 0?32:px(s.type))}function Wr(s,a){var c=q.p;try{return q.p=s,a()}finally{q.p=c}}var Kr=Math.random().toString(36).slice(2),un="__reactFiber$"+Kr,jn="__reactProps$"+Kr,_s="__reactContainer$"+Kr,Uo="__reactEvents$"+Kr,Cm="__reactListeners$"+Kr,hd="__reactHandles$"+Kr,fd="__reactResources$"+Kr,bs="__reactMarker$"+Kr;function Fo(s){delete s[un],delete s[jn],delete s[Uo],delete s[Cm],delete s[hd]}function vs(s){var a=s[un];if(a)return a;for(var c=s.parentNode;c;){if(a=c[_s]||c[un]){if(c=a.alternate,a.child!==null||c!==null&&c.child!==null)for(s=Jv(s);s!==null;){if(c=s[un])return c;s=Jv(s)}return a}s=c,c=s.parentNode}return null}function Ir(s){if(s=s[un]||s[_s]){var a=s.tag;if(a===5||a===6||a===13||a===31||a===26||a===27||a===3)return s}return null}function yr(s){var a=s.tag;if(a===5||a===26||a===27||a===6)return s.stateNode;throw Error(r(33))}function xs(s){var a=s[fd];return a||(a=s[fd]={hoistableStyles:new Map,hoistableScripts:new Map}),a}function dn(s){s[bs]=!0}var _c=new Set,bc={};function ws(s,a){Ss(s,a),Ss(s+"Capture",a)}function Ss(s,a){for(bc[s]=a,s=0;s<a.length;s++)_c.add(a[s])}var vc=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),xc={},wc={};function md(s){return oe.call(wc,s)?!0:oe.call(xc,s)?!1:vc.test(s)?wc[s]=!0:(xc[s]=!0,!1)}function Vo(s,a,c){if(md(a))if(c===null)s.removeAttribute(a);else{switch(typeof c){case"undefined":case"function":case"symbol":s.removeAttribute(a);return;case"boolean":var f=a.toLowerCase().slice(0,5);if(f!=="data-"&&f!=="aria-"){s.removeAttribute(a);return}}s.setAttribute(a,""+c)}}function _r(s,a,c){if(c===null)s.removeAttribute(a);else{switch(typeof c){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(a);return}s.setAttribute(a,""+c)}}function hn(s,a,c,f){if(f===null)s.removeAttribute(c);else{switch(typeof f){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(c);return}s.setAttributeNS(a,c,""+f)}}function Rn(s){switch(typeof s){case"bigint":case"boolean":case"number":case"string":case"undefined":return s;case"object":return s;default:return""}}function Ai(s){var a=s.type;return(s=s.nodeName)&&s.toLowerCase()==="input"&&(a==="checkbox"||a==="radio")}function Sc(s,a,c){var f=Object.getOwnPropertyDescriptor(s.constructor.prototype,a);if(!s.hasOwnProperty(a)&&typeof f<"u"&&typeof f.get=="function"&&typeof f.set=="function"){var _=f.get,w=f.set;return Object.defineProperty(s,a,{configurable:!0,get:function(){return _.call(this)},set:function(P){c=""+P,w.call(this,P)}}),Object.defineProperty(s,a,{enumerable:f.enumerable}),{getValue:function(){return c},setValue:function(P){c=""+P},stopTracking:function(){s._valueTracker=null,delete s[a]}}}}function Rt(s){if(!s._valueTracker){var a=Ai(s)?"checked":"value";s._valueTracker=Sc(s,a,""+s[a])}}function $a(s){if(!s)return!1;var a=s._valueTracker;if(!a)return!0;var c=a.getValue(),f="";return s&&(f=Ai(s)?s.checked?"true":"false":s.value),s=f,s!==c?(a.setValue(s),!0):!1}function Es(s){if(s=s||(typeof document<"u"?document:void 0),typeof s>"u")return null;try{return s.activeElement||s.body}catch{return s.body}}var qa=/[\n"\\]/g;function ir(s){return s.replace(qa,function(a){return"\\"+a.charCodeAt(0).toString(16)+" "})}function $o(s,a,c,f,_,w,P,Q){s.name="",P!=null&&typeof P!="function"&&typeof P!="symbol"&&typeof P!="boolean"?s.type=P:s.removeAttribute("type"),a!=null?P==="number"?(a===0&&s.value===""||s.value!=a)&&(s.value=""+Rn(a)):s.value!==""+Rn(a)&&(s.value=""+Rn(a)):P!=="submit"&&P!=="reset"||s.removeAttribute("value"),a!=null?Ec(s,P,Rn(a)):c!=null?Ec(s,P,Rn(c)):f!=null&&s.removeAttribute("value"),_==null&&w!=null&&(s.defaultChecked=!!w),_!=null&&(s.checked=_&&typeof _!="function"&&typeof _!="symbol"),Q!=null&&typeof Q!="function"&&typeof Q!="symbol"&&typeof Q!="boolean"?s.name=""+Rn(Q):s.removeAttribute("name")}function pd(s,a,c,f,_,w,P,Q){if(w!=null&&typeof w!="function"&&typeof w!="symbol"&&typeof w!="boolean"&&(s.type=w),a!=null||c!=null){if(!(w!=="submit"&&w!=="reset"||a!=null)){Rt(s);return}c=c!=null?""+Rn(c):"",a=a!=null?""+Rn(a):c,Q||a===s.value||(s.value=a),s.defaultValue=a}f=f??_,f=typeof f!="function"&&typeof f!="symbol"&&!!f,s.checked=Q?s.checked:!!f,s.defaultChecked=!!f,P!=null&&typeof P!="function"&&typeof P!="symbol"&&typeof P!="boolean"&&(s.name=P),Rt(s)}function Ec(s,a,c){a==="number"&&Es(s.ownerDocument)===s||s.defaultValue===""+c||(s.defaultValue=""+c)}function ji(s,a,c,f){if(s=s.options,a){a={};for(var _=0;_<c.length;_++)a["$"+c[_]]=!0;for(c=0;c<s.length;c++)_=a.hasOwnProperty("$"+s[c].value),s[c].selected!==_&&(s[c].selected=_),_&&f&&(s[c].defaultSelected=!0)}else{for(c=""+Rn(c),a=null,_=0;_<s.length;_++){if(s[_].value===c){s[_].selected=!0,f&&(s[_].defaultSelected=!0);return}a!==null||s[_].disabled||(a=s[_])}a!==null&&(a.selected=!0)}}function gd(s,a,c){if(a!=null&&(a=""+Rn(a),a!==s.value&&(s.value=a),c==null)){s.defaultValue!==a&&(s.defaultValue=a);return}s.defaultValue=c!=null?""+Rn(c):""}function Ri(s,a,c,f){if(a==null){if(f!=null){if(c!=null)throw Error(r(92));if(Z(f)){if(1<f.length)throw Error(r(93));f=f[0]}c=f}c==null&&(c=""),a=c}c=Rn(a),s.defaultValue=c,f=s.textContent,f===c&&f!==""&&f!==null&&(s.value=f),Rt(s)}function ar(s,a){if(a){var c=s.firstChild;if(c&&c===s.lastChild&&c.nodeType===3){c.nodeValue=a;return}}s.textContent=a}var yd=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Cc(s,a,c){var f=a.indexOf("--")===0;c==null||typeof c=="boolean"||c===""?f?s.setProperty(a,""):a==="float"?s.cssFloat="":s[a]="":f?s.setProperty(a,c):typeof c!="number"||c===0||yd.has(a)?a==="float"?s.cssFloat=c:s[a]=(""+c).trim():s[a]=c+"px"}function Tc(s,a,c){if(a!=null&&typeof a!="object")throw Error(r(62));if(s=s.style,c!=null){for(var f in c)!c.hasOwnProperty(f)||a!=null&&a.hasOwnProperty(f)||(f.indexOf("--")===0?s.setProperty(f,""):f==="float"?s.cssFloat="":s[f]="");for(var _ in a)f=a[_],a.hasOwnProperty(_)&&c[_]!==f&&Cc(s,_,f)}else for(var w in a)a.hasOwnProperty(w)&&Cc(s,w,a[w])}function qo(s){if(s.indexOf("-")===-1)return!1;switch(s){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var _d=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Ii=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Ho(s){return Ii.test(""+s)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":s}function Yr(){}var Ac=null;function kr(s){return s=s.target||s.srcElement||window,s.correspondingUseElement&&(s=s.correspondingUseElement),s.nodeType===3?s.parentNode:s}var ki=null,Cs=null;function Ha(s){var a=Ir(s);if(a&&(s=a.stateNode)){var c=s[jn]||null;e:switch(s=a.stateNode,a.type){case"input":if($o(s,c.value,c.defaultValue,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name),a=c.name,c.type==="radio"&&a!=null){for(c=s;c.parentNode;)c=c.parentNode;for(c=c.querySelectorAll('input[name="'+ir(""+a)+'"][type="radio"]'),a=0;a<c.length;a++){var f=c[a];if(f!==s&&f.form===s.form){var _=f[jn]||null;if(!_)throw Error(r(90));$o(f,_.value,_.defaultValue,_.defaultValue,_.checked,_.defaultChecked,_.type,_.name)}}for(a=0;a<c.length;a++)f=c[a],f.form===s.form&&$a(f)}break e;case"textarea":gd(s,c.value,c.defaultValue);break e;case"select":a=c.value,a!=null&&ji(s,!!c.multiple,a,!1)}}}var Go=!1;function Di(s,a,c){if(Go)return s(a,c);Go=!0;try{var f=s(a);return f}finally{if(Go=!1,(ki!==null||Cs!==null)&&(dh(),ki&&(a=ki,s=Cs,Cs=ki=null,Ha(a),s)))for(a=0;a<s.length;a++)Ha(s[a])}}function Xr(s,a){var c=s.stateNode;if(c===null)return null;var f=c[jn]||null;if(f===null)return null;c=f[a];e:switch(a){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(f=!f.disabled)||(s=s.type,f=!(s==="button"||s==="input"||s==="select"||s==="textarea")),s=!f;break e;default:s=!1}if(s)return null;if(c&&typeof c!="function")throw Error(r(231,a,typeof c));return c}var Dr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Ga=!1;if(Dr)try{var Dt={};Object.defineProperty(Dt,"passive",{get:function(){Ga=!0}}),window.addEventListener("test",Dt,Dt),window.removeEventListener("test",Dt,Dt)}catch{Ga=!1}var Ts=null,jc=null,Qa=null;function Rc(){if(Qa)return Qa;var s,a=jc,c=a.length,f,_="value"in Ts?Ts.value:Ts.textContent,w=_.length;for(s=0;s<c&&a[s]===_[s];s++);var P=c-s;for(f=1;f<=P&&a[c-f]===_[w-f];f++);return Qa=_.slice(s,1<f?1-f:void 0)}function Wa(s){var a=s.keyCode;return"charCode"in s?(s=s.charCode,s===0&&a===13&&(s=13)):s=a,s===10&&(s=13),32<=s||s===13?s:0}function Gs(){return!0}function Zr(){return!1}function Nn(s){function a(c,f,_,w,P){this._reactName=c,this._targetInst=_,this.type=f,this.nativeEvent=w,this.target=P,this.currentTarget=null;for(var Q in s)s.hasOwnProperty(Q)&&(c=s[Q],this[Q]=c?c(w):w[Q]);return this.isDefaultPrevented=(w.defaultPrevented!=null?w.defaultPrevented:w.returnValue===!1)?Gs:Zr,this.isPropagationStopped=Zr,this}return g(a.prototype,{preventDefault:function(){this.defaultPrevented=!0;var c=this.nativeEvent;c&&(c.preventDefault?c.preventDefault():typeof c.returnValue!="unknown"&&(c.returnValue=!1),this.isDefaultPrevented=Gs)},stopPropagation:function(){var c=this.nativeEvent;c&&(c.stopPropagation?c.stopPropagation():typeof c.cancelBubble!="unknown"&&(c.cancelBubble=!0),this.isPropagationStopped=Gs)},persist:function(){},isPersistent:Gs}),a}var Qs={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(s){return s.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},As=Nn(Qs),Mi=g({},Qs,{view:0,detail:0}),Ic=Nn(Mi),Oi,Qo,js,Wo=g({},Mi,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Ni,button:0,buttons:0,relatedTarget:function(s){return s.relatedTarget===void 0?s.fromElement===s.srcElement?s.toElement:s.fromElement:s.relatedTarget},movementX:function(s){return"movementX"in s?s.movementX:(s!==js&&(js&&s.type==="mousemove"?(Oi=s.screenX-js.screenX,Qo=s.screenY-js.screenY):Qo=Oi=0,js=s),Oi)},movementY:function(s){return"movementY"in s?s.movementY:Qo}}),kc=Nn(Wo),Ka=g({},Wo,{dataTransfer:0}),bd=Nn(Ka),vd=g({},Mi,{relatedTarget:0}),Ya=Nn(vd),Dc=g({},Qs,{animationName:0,elapsedTime:0,pseudoElement:0}),xd=Nn(Dc),Ko=g({},Qs,{clipboardData:function(s){return"clipboardData"in s?s.clipboardData:window.clipboardData}}),wd=Nn(Ko),Sd=g({},Qs,{data:0}),Rs=Nn(Sd),Ed={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Cd={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Td={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Ad(s){var a=this.nativeEvent;return a.getModifierState?a.getModifierState(s):(s=Td[s])?!!a[s]:!1}function Ni(){return Ad}var nr=g({},Mi,{key:function(s){if(s.key){var a=Ed[s.key]||s.key;if(a!=="Unidentified")return a}return s.type==="keypress"?(s=Wa(s),s===13?"Enter":String.fromCharCode(s)):s.type==="keydown"||s.type==="keyup"?Cd[s.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Ni,charCode:function(s){return s.type==="keypress"?Wa(s):0},keyCode:function(s){return s.type==="keydown"||s.type==="keyup"?s.keyCode:0},which:function(s){return s.type==="keypress"?Wa(s):s.type==="keydown"||s.type==="keyup"?s.keyCode:0}}),jd=Nn(nr),Rd=g({},Wo,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Ws=Nn(Rd),y=g({},Mi,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Ni}),A=Nn(y),F=g({},Qs,{propertyName:0,elapsedTime:0,pseudoElement:0}),Y=Nn(F),fe=g({},Wo,{deltaX:function(s){return"deltaX"in s?s.deltaX:"wheelDeltaX"in s?-s.wheelDeltaX:0},deltaY:function(s){return"deltaY"in s?s.deltaY:"wheelDeltaY"in s?-s.wheelDeltaY:"wheelDelta"in s?-s.wheelDelta:0},deltaZ:0,deltaMode:0}),be=Nn(fe),Ne=g({},Qs,{newState:0,oldState:0}),rt=Nn(Ne),nn=[9,13,27,32],Ct=Dr&&"CompositionEvent"in window,Qt=null;Dr&&"documentMode"in document&&(Qt=document.documentMode);var Mr=Dr&&"TextEvent"in window&&!Qt,Is=Dr&&(!Ct||Qt&&8<Qt&&11>=Qt),Jr=" ",es=!1;function Xa(s,a){switch(s){case"keyup":return nn.indexOf(a.keyCode)!==-1;case"keydown":return a.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Yo(s){return s=s.detail,typeof s=="object"&&"data"in s?s.data:null}var Xo=!1;function aA(s,a){switch(s){case"compositionend":return Yo(a);case"keypress":return a.which!==32?null:(es=!0,Jr);case"textInput":return s=a.data,s===Jr&&es?null:s;default:return null}}function oA(s,a){if(Xo)return s==="compositionend"||!Ct&&Xa(s,a)?(s=Rc(),Qa=jc=Ts=null,Xo=!1,s):null;switch(s){case"paste":return null;case"keypress":if(!(a.ctrlKey||a.altKey||a.metaKey)||a.ctrlKey&&a.altKey){if(a.char&&1<a.char.length)return a.char;if(a.which)return String.fromCharCode(a.which)}return null;case"compositionend":return Is&&a.locale!=="ko"?null:a.data;default:return null}}var lA={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function n_(s){var a=s&&s.nodeName&&s.nodeName.toLowerCase();return a==="input"?!!lA[s.type]:a==="textarea"}function r_(s,a,c,f){ki?Cs?Cs.push(f):Cs=[f]:ki=f,a=_h(a,"onChange"),0<a.length&&(c=new As("onChange","change",null,c,f),s.push({event:c,listeners:a}))}var Mc=null,Oc=null;function cA(s){Lv(s,0)}function Id(s){var a=yr(s);if($a(a))return s}function s_(s,a){if(s==="change")return a}var i_=!1;if(Dr){var Tm;if(Dr){var Am="oninput"in document;if(!Am){var a_=document.createElement("div");a_.setAttribute("oninput","return;"),Am=typeof a_.oninput=="function"}Tm=Am}else Tm=!1;i_=Tm&&(!document.documentMode||9<document.documentMode)}function o_(){Mc&&(Mc.detachEvent("onpropertychange",l_),Oc=Mc=null)}function l_(s){if(s.propertyName==="value"&&Id(Oc)){var a=[];r_(a,Oc,s,kr(s)),Di(cA,a)}}function uA(s,a,c){s==="focusin"?(o_(),Mc=a,Oc=c,Mc.attachEvent("onpropertychange",l_)):s==="focusout"&&o_()}function dA(s){if(s==="selectionchange"||s==="keyup"||s==="keydown")return Id(Oc)}function hA(s,a){if(s==="click")return Id(a)}function fA(s,a){if(s==="input"||s==="change")return Id(a)}function mA(s,a){return s===a&&(s!==0||1/s===1/a)||s!==s&&a!==a}var br=typeof Object.is=="function"?Object.is:mA;function Nc(s,a){if(br(s,a))return!0;if(typeof s!="object"||s===null||typeof a!="object"||a===null)return!1;var c=Object.keys(s),f=Object.keys(a);if(c.length!==f.length)return!1;for(f=0;f<c.length;f++){var _=c[f];if(!oe.call(a,_)||!br(s[_],a[_]))return!1}return!0}function c_(s){for(;s&&s.firstChild;)s=s.firstChild;return s}function u_(s,a){var c=c_(s);s=0;for(var f;c;){if(c.nodeType===3){if(f=s+c.textContent.length,s<=a&&f>=a)return{node:c,offset:a-s};s=f}e:{for(;c;){if(c.nextSibling){c=c.nextSibling;break e}c=c.parentNode}c=void 0}c=c_(c)}}function d_(s,a){return s&&a?s===a?!0:s&&s.nodeType===3?!1:a&&a.nodeType===3?d_(s,a.parentNode):"contains"in s?s.contains(a):s.compareDocumentPosition?!!(s.compareDocumentPosition(a)&16):!1:!1}function h_(s){s=s!=null&&s.ownerDocument!=null&&s.ownerDocument.defaultView!=null?s.ownerDocument.defaultView:window;for(var a=Es(s.document);a instanceof s.HTMLIFrameElement;){try{var c=typeof a.contentWindow.location.href=="string"}catch{c=!1}if(c)s=a.contentWindow;else break;a=Es(s.document)}return a}function jm(s){var a=s&&s.nodeName&&s.nodeName.toLowerCase();return a&&(a==="input"&&(s.type==="text"||s.type==="search"||s.type==="tel"||s.type==="url"||s.type==="password")||a==="textarea"||s.contentEditable==="true")}var pA=Dr&&"documentMode"in document&&11>=document.documentMode,Zo=null,Rm=null,Pc=null,Im=!1;function f_(s,a,c){var f=c.window===c?c.document:c.nodeType===9?c:c.ownerDocument;Im||Zo==null||Zo!==Es(f)||(f=Zo,"selectionStart"in f&&jm(f)?f={start:f.selectionStart,end:f.selectionEnd}:(f=(f.ownerDocument&&f.ownerDocument.defaultView||window).getSelection(),f={anchorNode:f.anchorNode,anchorOffset:f.anchorOffset,focusNode:f.focusNode,focusOffset:f.focusOffset}),Pc&&Nc(Pc,f)||(Pc=f,f=_h(Rm,"onSelect"),0<f.length&&(a=new As("onSelect","select",null,a,c),s.push({event:a,listeners:f}),a.target=Zo)))}function Za(s,a){var c={};return c[s.toLowerCase()]=a.toLowerCase(),c["Webkit"+s]="webkit"+a,c["Moz"+s]="moz"+a,c}var Jo={animationend:Za("Animation","AnimationEnd"),animationiteration:Za("Animation","AnimationIteration"),animationstart:Za("Animation","AnimationStart"),transitionrun:Za("Transition","TransitionRun"),transitionstart:Za("Transition","TransitionStart"),transitioncancel:Za("Transition","TransitionCancel"),transitionend:Za("Transition","TransitionEnd")},km={},m_={};Dr&&(m_=document.createElement("div").style,"AnimationEvent"in window||(delete Jo.animationend.animation,delete Jo.animationiteration.animation,delete Jo.animationstart.animation),"TransitionEvent"in window||delete Jo.transitionend.transition);function Ja(s){if(km[s])return km[s];if(!Jo[s])return s;var a=Jo[s],c;for(c in a)if(a.hasOwnProperty(c)&&c in m_)return km[s]=a[c];return s}var p_=Ja("animationend"),g_=Ja("animationiteration"),y_=Ja("animationstart"),gA=Ja("transitionrun"),yA=Ja("transitionstart"),_A=Ja("transitioncancel"),__=Ja("transitionend"),b_=new Map,Dm="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Dm.push("scrollEnd");function ts(s,a){b_.set(s,a),ws(a,[s])}var kd=typeof reportError=="function"?reportError:function(s){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var a=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof s=="object"&&s!==null&&typeof s.message=="string"?String(s.message):String(s),error:s});if(!window.dispatchEvent(a))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",s);return}console.error(s)},Or=[],el=0,Mm=0;function Dd(){for(var s=el,a=Mm=el=0;a<s;){var c=Or[a];Or[a++]=null;var f=Or[a];Or[a++]=null;var _=Or[a];Or[a++]=null;var w=Or[a];if(Or[a++]=null,f!==null&&_!==null){var P=f.pending;P===null?_.next=_:(_.next=P.next,P.next=_),f.pending=_}w!==0&&v_(c,_,w)}}function Md(s,a,c,f){Or[el++]=s,Or[el++]=a,Or[el++]=c,Or[el++]=f,Mm|=f,s.lanes|=f,s=s.alternate,s!==null&&(s.lanes|=f)}function Om(s,a,c,f){return Md(s,a,c,f),Od(s)}function eo(s,a){return Md(s,null,null,a),Od(s)}function v_(s,a,c){s.lanes|=c;var f=s.alternate;f!==null&&(f.lanes|=c);for(var _=!1,w=s.return;w!==null;)w.childLanes|=c,f=w.alternate,f!==null&&(f.childLanes|=c),w.tag===22&&(s=w.stateNode,s===null||s._visibility&1||(_=!0)),s=w,w=w.return;return s.tag===3?(w=s.stateNode,_&&a!==null&&(_=31-Et(c),s=w.hiddenUpdates,f=s[_],f===null?s[_]=[a]:f.push(a),a.lane=c|536870912),w):null}function Od(s){if(50<su)throw su=0,$p=null,Error(r(185));for(var a=s.return;a!==null;)s=a,a=s.return;return s.tag===3?s.stateNode:null}var tl={};function bA(s,a,c,f){this.tag=s,this.key=c,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=a,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=f,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function vr(s,a,c,f){return new bA(s,a,c,f)}function Nm(s){return s=s.prototype,!(!s||!s.isReactComponent)}function Ks(s,a){var c=s.alternate;return c===null?(c=vr(s.tag,a,s.key,s.mode),c.elementType=s.elementType,c.type=s.type,c.stateNode=s.stateNode,c.alternate=s,s.alternate=c):(c.pendingProps=a,c.type=s.type,c.flags=0,c.subtreeFlags=0,c.deletions=null),c.flags=s.flags&65011712,c.childLanes=s.childLanes,c.lanes=s.lanes,c.child=s.child,c.memoizedProps=s.memoizedProps,c.memoizedState=s.memoizedState,c.updateQueue=s.updateQueue,a=s.dependencies,c.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext},c.sibling=s.sibling,c.index=s.index,c.ref=s.ref,c.refCleanup=s.refCleanup,c}function x_(s,a){s.flags&=65011714;var c=s.alternate;return c===null?(s.childLanes=0,s.lanes=a,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=c.childLanes,s.lanes=c.lanes,s.child=c.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=c.memoizedProps,s.memoizedState=c.memoizedState,s.updateQueue=c.updateQueue,s.type=c.type,a=c.dependencies,s.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext}),s}function Nd(s,a,c,f,_,w){var P=0;if(f=s,typeof s=="function")Nm(s)&&(P=1);else if(typeof s=="string")P=E2(s,c,se.current)?26:s==="html"||s==="head"||s==="body"?27:5;else e:switch(s){case N:return s=vr(31,c,a,_),s.elementType=N,s.lanes=w,s;case x:return to(c.children,_,w,a);case S:P=8,_|=24;break;case C:return s=vr(12,c,a,_|2),s.elementType=C,s.lanes=w,s;case U:return s=vr(13,c,a,_),s.elementType=U,s.lanes=w,s;case $:return s=vr(19,c,a,_),s.elementType=$,s.lanes=w,s;default:if(typeof s=="object"&&s!==null)switch(s.$$typeof){case I:P=10;break e;case T:P=9;break e;case O:P=11;break e;case k:P=14;break e;case R:P=16,f=null;break e}P=29,c=Error(r(130,s===null?"null":typeof s,"")),f=null}return a=vr(P,c,a,_),a.elementType=s,a.type=f,a.lanes=w,a}function to(s,a,c,f){return s=vr(7,s,f,a),s.lanes=c,s}function Pm(s,a,c){return s=vr(6,s,null,a),s.lanes=c,s}function w_(s){var a=vr(18,null,null,0);return a.stateNode=s,a}function Bm(s,a,c){return a=vr(4,s.children!==null?s.children:[],s.key,a),a.lanes=c,a.stateNode={containerInfo:s.containerInfo,pendingChildren:null,implementation:s.implementation},a}var S_=new WeakMap;function Nr(s,a){if(typeof s=="object"&&s!==null){var c=S_.get(s);return c!==void 0?c:(a={value:s,source:a,stack:J(a)},S_.set(s,a),a)}return{value:s,source:a,stack:J(a)}}var nl=[],rl=0,Pd=null,Bc=0,Pr=[],Br=0,Pi=null,ks=1,Ds="";function Ys(s,a){nl[rl++]=Bc,nl[rl++]=Pd,Pd=s,Bc=a}function E_(s,a,c){Pr[Br++]=ks,Pr[Br++]=Ds,Pr[Br++]=Pi,Pi=s;var f=ks;s=Ds;var _=32-Et(f)-1;f&=~(1<<_),c+=1;var w=32-Et(a)+_;if(30<w){var P=_-_%5;w=(f&(1<<P)-1).toString(32),f>>=P,_-=P,ks=1<<32-Et(a)+_|c<<_|f,Ds=w+s}else ks=1<<w|c<<_|f,Ds=s}function zm(s){s.return!==null&&(Ys(s,1),E_(s,1,0))}function Lm(s){for(;s===Pd;)Pd=nl[--rl],nl[rl]=null,Bc=nl[--rl],nl[rl]=null;for(;s===Pi;)Pi=Pr[--Br],Pr[Br]=null,Ds=Pr[--Br],Pr[Br]=null,ks=Pr[--Br],Pr[Br]=null}function C_(s,a){Pr[Br++]=ks,Pr[Br++]=Ds,Pr[Br++]=Pi,ks=a.id,Ds=a.overflow,Pi=s}var Pn=null,Vt=null,pt=!1,Bi=null,zr=!1,Um=Error(r(519));function zi(s){var a=Error(r(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw zc(Nr(a,s)),Um}function T_(s){var a=s.stateNode,c=s.type,f=s.memoizedProps;switch(a[un]=s,a[jn]=f,c){case"dialog":lt("cancel",a),lt("close",a);break;case"iframe":case"object":case"embed":lt("load",a);break;case"video":case"audio":for(c=0;c<au.length;c++)lt(au[c],a);break;case"source":lt("error",a);break;case"img":case"image":case"link":lt("error",a),lt("load",a);break;case"details":lt("toggle",a);break;case"input":lt("invalid",a),pd(a,f.value,f.defaultValue,f.checked,f.defaultChecked,f.type,f.name,!0);break;case"select":lt("invalid",a);break;case"textarea":lt("invalid",a),Ri(a,f.value,f.defaultValue,f.children)}c=f.children,typeof c!="string"&&typeof c!="number"&&typeof c!="bigint"||a.textContent===""+c||f.suppressHydrationWarning===!0||$v(a.textContent,c)?(f.popover!=null&&(lt("beforetoggle",a),lt("toggle",a)),f.onScroll!=null&&lt("scroll",a),f.onScrollEnd!=null&&lt("scrollend",a),f.onClick!=null&&(a.onclick=Yr),a=!0):a=!1,a||zi(s,!0)}function A_(s){for(Pn=s.return;Pn;)switch(Pn.tag){case 5:case 31:case 13:zr=!1;return;case 27:case 3:zr=!0;return;default:Pn=Pn.return}}function sl(s){if(s!==Pn)return!1;if(!pt)return A_(s),pt=!0,!1;var a=s.tag,c;if((c=a!==3&&a!==27)&&((c=a===5)&&(c=s.type,c=!(c!=="form"&&c!=="button")||sg(s.type,s.memoizedProps)),c=!c),c&&Vt&&zi(s),A_(s),a===13){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(r(317));Vt=Zv(s)}else if(a===31){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(r(317));Vt=Zv(s)}else a===27?(a=Vt,Zi(s.type)?(s=cg,cg=null,Vt=s):Vt=a):Vt=Pn?Ur(s.stateNode.nextSibling):null;return!0}function no(){Vt=Pn=null,pt=!1}function Fm(){var s=Bi;return s!==null&&(ur===null?ur=s:ur.push.apply(ur,s),Bi=null),s}function zc(s){Bi===null?Bi=[s]:Bi.push(s)}var Vm=z(null),ro=null,Xs=null;function Li(s,a,c){te(Vm,a._currentValue),a._currentValue=c}function Zs(s){s._currentValue=Vm.current,G(Vm)}function $m(s,a,c){for(;s!==null;){var f=s.alternate;if((s.childLanes&a)!==a?(s.childLanes|=a,f!==null&&(f.childLanes|=a)):f!==null&&(f.childLanes&a)!==a&&(f.childLanes|=a),s===c)break;s=s.return}}function qm(s,a,c,f){var _=s.child;for(_!==null&&(_.return=s);_!==null;){var w=_.dependencies;if(w!==null){var P=_.child;w=w.firstContext;e:for(;w!==null;){var Q=w;w=_;for(var ne=0;ne<a.length;ne++)if(Q.context===a[ne]){w.lanes|=c,Q=w.alternate,Q!==null&&(Q.lanes|=c),$m(w.return,c,s),f||(P=null);break e}w=Q.next}}else if(_.tag===18){if(P=_.return,P===null)throw Error(r(341));P.lanes|=c,w=P.alternate,w!==null&&(w.lanes|=c),$m(P,c,s),P=null}else P=_.child;if(P!==null)P.return=_;else for(P=_;P!==null;){if(P===s){P=null;break}if(_=P.sibling,_!==null){_.return=P.return,P=_;break}P=P.return}_=P}}function il(s,a,c,f){s=null;for(var _=a,w=!1;_!==null;){if(!w){if((_.flags&524288)!==0)w=!0;else if((_.flags&262144)!==0)break}if(_.tag===10){var P=_.alternate;if(P===null)throw Error(r(387));if(P=P.memoizedProps,P!==null){var Q=_.type;br(_.pendingProps.value,P.value)||(s!==null?s.push(Q):s=[Q])}}else if(_===we.current){if(P=_.alternate,P===null)throw Error(r(387));P.memoizedState.memoizedState!==_.memoizedState.memoizedState&&(s!==null?s.push(du):s=[du])}_=_.return}s!==null&&qm(a,s,c,f),a.flags|=262144}function Bd(s){for(s=s.firstContext;s!==null;){if(!br(s.context._currentValue,s.memoizedValue))return!0;s=s.next}return!1}function so(s){ro=s,Xs=null,s=s.dependencies,s!==null&&(s.firstContext=null)}function Bn(s){return j_(ro,s)}function zd(s,a){return ro===null&&so(s),j_(s,a)}function j_(s,a){var c=a._currentValue;if(a={context:a,memoizedValue:c,next:null},Xs===null){if(s===null)throw Error(r(308));Xs=a,s.dependencies={lanes:0,firstContext:a},s.flags|=524288}else Xs=Xs.next=a;return c}var vA=typeof AbortController<"u"?AbortController:function(){var s=[],a=this.signal={aborted:!1,addEventListener:function(c,f){s.push(f)}};this.abort=function(){a.aborted=!0,s.forEach(function(c){return c()})}},xA=t.unstable_scheduleCallback,wA=t.unstable_NormalPriority,fn={$$typeof:I,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Hm(){return{controller:new vA,data:new Map,refCount:0}}function Lc(s){s.refCount--,s.refCount===0&&xA(wA,function(){s.controller.abort()})}var Uc=null,Gm=0,al=0,ol=null;function SA(s,a){if(Uc===null){var c=Uc=[];Gm=0,al=Kp(),ol={status:"pending",value:void 0,then:function(f){c.push(f)}}}return Gm++,a.then(R_,R_),a}function R_(){if(--Gm===0&&Uc!==null){ol!==null&&(ol.status="fulfilled");var s=Uc;Uc=null,al=0,ol=null;for(var a=0;a<s.length;a++)(0,s[a])()}}function EA(s,a){var c=[],f={status:"pending",value:null,reason:null,then:function(_){c.push(_)}};return s.then(function(){f.status="fulfilled",f.value=a;for(var _=0;_<c.length;_++)(0,c[_])(a)},function(_){for(f.status="rejected",f.reason=_,_=0;_<c.length;_++)(0,c[_])(void 0)}),f}var I_=K.S;K.S=function(s,a){fv=Oe(),typeof a=="object"&&a!==null&&typeof a.then=="function"&&SA(s,a),I_!==null&&I_(s,a)};var io=z(null);function Qm(){var s=io.current;return s!==null?s:zt.pooledCache}function Ld(s,a){a===null?te(io,io.current):te(io,a.pool)}function k_(){var s=Qm();return s===null?null:{parent:fn._currentValue,pool:s}}var ll=Error(r(460)),Wm=Error(r(474)),Ud=Error(r(542)),Fd={then:function(){}};function D_(s){return s=s.status,s==="fulfilled"||s==="rejected"}function M_(s,a,c){switch(c=s[c],c===void 0?s.push(a):c!==a&&(a.then(Yr,Yr),a=c),a.status){case"fulfilled":return a.value;case"rejected":throw s=a.reason,N_(s),s;default:if(typeof a.status=="string")a.then(Yr,Yr);else{if(s=zt,s!==null&&100<s.shellSuspendCounter)throw Error(r(482));s=a,s.status="pending",s.then(function(f){if(a.status==="pending"){var _=a;_.status="fulfilled",_.value=f}},function(f){if(a.status==="pending"){var _=a;_.status="rejected",_.reason=f}})}switch(a.status){case"fulfilled":return a.value;case"rejected":throw s=a.reason,N_(s),s}throw oo=a,ll}}function ao(s){try{var a=s._init;return a(s._payload)}catch(c){throw c!==null&&typeof c=="object"&&typeof c.then=="function"?(oo=c,ll):c}}var oo=null;function O_(){if(oo===null)throw Error(r(459));var s=oo;return oo=null,s}function N_(s){if(s===ll||s===Ud)throw Error(r(483))}var cl=null,Fc=0;function Vd(s){var a=Fc;return Fc+=1,cl===null&&(cl=[]),M_(cl,s,a)}function Vc(s,a){a=a.props.ref,s.ref=a!==void 0?a:null}function $d(s,a){throw a.$$typeof===v?Error(r(525)):(s=Object.prototype.toString.call(a),Error(r(31,s==="[object Object]"?"object with keys {"+Object.keys(a).join(", ")+"}":s)))}function P_(s){function a(ue,le){if(s){var pe=ue.deletions;pe===null?(ue.deletions=[le],ue.flags|=16):pe.push(le)}}function c(ue,le){if(!s)return null;for(;le!==null;)a(ue,le),le=le.sibling;return null}function f(ue){for(var le=new Map;ue!==null;)ue.key!==null?le.set(ue.key,ue):le.set(ue.index,ue),ue=ue.sibling;return le}function _(ue,le){return ue=Ks(ue,le),ue.index=0,ue.sibling=null,ue}function w(ue,le,pe){return ue.index=pe,s?(pe=ue.alternate,pe!==null?(pe=pe.index,pe<le?(ue.flags|=67108866,le):pe):(ue.flags|=67108866,le)):(ue.flags|=1048576,le)}function P(ue){return s&&ue.alternate===null&&(ue.flags|=67108866),ue}function Q(ue,le,pe,Te){return le===null||le.tag!==6?(le=Pm(pe,ue.mode,Te),le.return=ue,le):(le=_(le,pe),le.return=ue,le)}function ne(ue,le,pe,Te){var He=pe.type;return He===x?Ce(ue,le,pe.props.children,Te,pe.key):le!==null&&(le.elementType===He||typeof He=="object"&&He!==null&&He.$$typeof===R&&ao(He)===le.type)?(le=_(le,pe.props),Vc(le,pe),le.return=ue,le):(le=Nd(pe.type,pe.key,pe.props,null,ue.mode,Te),Vc(le,pe),le.return=ue,le)}function ge(ue,le,pe,Te){return le===null||le.tag!==4||le.stateNode.containerInfo!==pe.containerInfo||le.stateNode.implementation!==pe.implementation?(le=Bm(pe,ue.mode,Te),le.return=ue,le):(le=_(le,pe.children||[]),le.return=ue,le)}function Ce(ue,le,pe,Te,He){return le===null||le.tag!==7?(le=to(pe,ue.mode,Te,He),le.return=ue,le):(le=_(le,pe),le.return=ue,le)}function Re(ue,le,pe){if(typeof le=="string"&&le!==""||typeof le=="number"||typeof le=="bigint")return le=Pm(""+le,ue.mode,pe),le.return=ue,le;if(typeof le=="object"&&le!==null){switch(le.$$typeof){case b:return pe=Nd(le.type,le.key,le.props,null,ue.mode,pe),Vc(pe,le),pe.return=ue,pe;case E:return le=Bm(le,ue.mode,pe),le.return=ue,le;case R:return le=ao(le),Re(ue,le,pe)}if(Z(le)||j(le))return le=to(le,ue.mode,pe,null),le.return=ue,le;if(typeof le.then=="function")return Re(ue,Vd(le),pe);if(le.$$typeof===I)return Re(ue,zd(ue,le),pe);$d(ue,le)}return null}function _e(ue,le,pe,Te){var He=le!==null?le.key:null;if(typeof pe=="string"&&pe!==""||typeof pe=="number"||typeof pe=="bigint")return He!==null?null:Q(ue,le,""+pe,Te);if(typeof pe=="object"&&pe!==null){switch(pe.$$typeof){case b:return pe.key===He?ne(ue,le,pe,Te):null;case E:return pe.key===He?ge(ue,le,pe,Te):null;case R:return pe=ao(pe),_e(ue,le,pe,Te)}if(Z(pe)||j(pe))return He!==null?null:Ce(ue,le,pe,Te,null);if(typeof pe.then=="function")return _e(ue,le,Vd(pe),Te);if(pe.$$typeof===I)return _e(ue,le,zd(ue,pe),Te);$d(ue,pe)}return null}function ve(ue,le,pe,Te,He){if(typeof Te=="string"&&Te!==""||typeof Te=="number"||typeof Te=="bigint")return ue=ue.get(pe)||null,Q(le,ue,""+Te,He);if(typeof Te=="object"&&Te!==null){switch(Te.$$typeof){case b:return ue=ue.get(Te.key===null?pe:Te.key)||null,ne(le,ue,Te,He);case E:return ue=ue.get(Te.key===null?pe:Te.key)||null,ge(le,ue,Te,He);case R:return Te=ao(Te),ve(ue,le,pe,Te,He)}if(Z(Te)||j(Te))return ue=ue.get(pe)||null,Ce(le,ue,Te,He,null);if(typeof Te.then=="function")return ve(ue,le,pe,Vd(Te),He);if(Te.$$typeof===I)return ve(ue,le,pe,zd(le,Te),He);$d(le,Te)}return null}function Fe(ue,le,pe,Te){for(var He=null,wt=null,$e=le,it=le=0,dt=null;$e!==null&&it<pe.length;it++){$e.index>it?(dt=$e,$e=null):dt=$e.sibling;var St=_e(ue,$e,pe[it],Te);if(St===null){$e===null&&($e=dt);break}s&&$e&&St.alternate===null&&a(ue,$e),le=w(St,le,it),wt===null?He=St:wt.sibling=St,wt=St,$e=dt}if(it===pe.length)return c(ue,$e),pt&&Ys(ue,it),He;if($e===null){for(;it<pe.length;it++)$e=Re(ue,pe[it],Te),$e!==null&&(le=w($e,le,it),wt===null?He=$e:wt.sibling=$e,wt=$e);return pt&&Ys(ue,it),He}for($e=f($e);it<pe.length;it++)dt=ve($e,ue,it,pe[it],Te),dt!==null&&(s&&dt.alternate!==null&&$e.delete(dt.key===null?it:dt.key),le=w(dt,le,it),wt===null?He=dt:wt.sibling=dt,wt=dt);return s&&$e.forEach(function(ra){return a(ue,ra)}),pt&&Ys(ue,it),He}function Qe(ue,le,pe,Te){if(pe==null)throw Error(r(151));for(var He=null,wt=null,$e=le,it=le=0,dt=null,St=pe.next();$e!==null&&!St.done;it++,St=pe.next()){$e.index>it?(dt=$e,$e=null):dt=$e.sibling;var ra=_e(ue,$e,St.value,Te);if(ra===null){$e===null&&($e=dt);break}s&&$e&&ra.alternate===null&&a(ue,$e),le=w(ra,le,it),wt===null?He=ra:wt.sibling=ra,wt=ra,$e=dt}if(St.done)return c(ue,$e),pt&&Ys(ue,it),He;if($e===null){for(;!St.done;it++,St=pe.next())St=Re(ue,St.value,Te),St!==null&&(le=w(St,le,it),wt===null?He=St:wt.sibling=St,wt=St);return pt&&Ys(ue,it),He}for($e=f($e);!St.done;it++,St=pe.next())St=ve($e,ue,it,St.value,Te),St!==null&&(s&&St.alternate!==null&&$e.delete(St.key===null?it:St.key),le=w(St,le,it),wt===null?He=St:wt.sibling=St,wt=St);return s&&$e.forEach(function(N2){return a(ue,N2)}),pt&&Ys(ue,it),He}function Nt(ue,le,pe,Te){if(typeof pe=="object"&&pe!==null&&pe.type===x&&pe.key===null&&(pe=pe.props.children),typeof pe=="object"&&pe!==null){switch(pe.$$typeof){case b:e:{for(var He=pe.key;le!==null;){if(le.key===He){if(He=pe.type,He===x){if(le.tag===7){c(ue,le.sibling),Te=_(le,pe.props.children),Te.return=ue,ue=Te;break e}}else if(le.elementType===He||typeof He=="object"&&He!==null&&He.$$typeof===R&&ao(He)===le.type){c(ue,le.sibling),Te=_(le,pe.props),Vc(Te,pe),Te.return=ue,ue=Te;break e}c(ue,le);break}else a(ue,le);le=le.sibling}pe.type===x?(Te=to(pe.props.children,ue.mode,Te,pe.key),Te.return=ue,ue=Te):(Te=Nd(pe.type,pe.key,pe.props,null,ue.mode,Te),Vc(Te,pe),Te.return=ue,ue=Te)}return P(ue);case E:e:{for(He=pe.key;le!==null;){if(le.key===He)if(le.tag===4&&le.stateNode.containerInfo===pe.containerInfo&&le.stateNode.implementation===pe.implementation){c(ue,le.sibling),Te=_(le,pe.children||[]),Te.return=ue,ue=Te;break e}else{c(ue,le);break}else a(ue,le);le=le.sibling}Te=Bm(pe,ue.mode,Te),Te.return=ue,ue=Te}return P(ue);case R:return pe=ao(pe),Nt(ue,le,pe,Te)}if(Z(pe))return Fe(ue,le,pe,Te);if(j(pe)){if(He=j(pe),typeof He!="function")throw Error(r(150));return pe=He.call(pe),Qe(ue,le,pe,Te)}if(typeof pe.then=="function")return Nt(ue,le,Vd(pe),Te);if(pe.$$typeof===I)return Nt(ue,le,zd(ue,pe),Te);$d(ue,pe)}return typeof pe=="string"&&pe!==""||typeof pe=="number"||typeof pe=="bigint"?(pe=""+pe,le!==null&&le.tag===6?(c(ue,le.sibling),Te=_(le,pe),Te.return=ue,ue=Te):(c(ue,le),Te=Pm(pe,ue.mode,Te),Te.return=ue,ue=Te),P(ue)):c(ue,le)}return function(ue,le,pe,Te){try{Fc=0;var He=Nt(ue,le,pe,Te);return cl=null,He}catch($e){if($e===ll||$e===Ud)throw $e;var wt=vr(29,$e,null,ue.mode);return wt.lanes=Te,wt.return=ue,wt}}}var lo=P_(!0),B_=P_(!1),Ui=!1;function Km(s){s.updateQueue={baseState:s.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Ym(s,a){s=s.updateQueue,a.updateQueue===s&&(a.updateQueue={baseState:s.baseState,firstBaseUpdate:s.firstBaseUpdate,lastBaseUpdate:s.lastBaseUpdate,shared:s.shared,callbacks:null})}function Fi(s){return{lane:s,tag:0,payload:null,callback:null,next:null}}function Vi(s,a,c){var f=s.updateQueue;if(f===null)return null;if(f=f.shared,(Tt&2)!==0){var _=f.pending;return _===null?a.next=a:(a.next=_.next,_.next=a),f.pending=a,a=Od(s),v_(s,null,c),a}return Md(s,f,a,c),Od(s)}function $c(s,a,c){if(a=a.updateQueue,a!==null&&(a=a.shared,(c&4194048)!==0)){var f=a.lanes;f&=s.pendingLanes,c|=f,a.lanes=c,gc(s,c)}}function Xm(s,a){var c=s.updateQueue,f=s.alternate;if(f!==null&&(f=f.updateQueue,c===f)){var _=null,w=null;if(c=c.firstBaseUpdate,c!==null){do{var P={lane:c.lane,tag:c.tag,payload:c.payload,callback:null,next:null};w===null?_=w=P:w=w.next=P,c=c.next}while(c!==null);w===null?_=w=a:w=w.next=a}else _=w=a;c={baseState:f.baseState,firstBaseUpdate:_,lastBaseUpdate:w,shared:f.shared,callbacks:f.callbacks},s.updateQueue=c;return}s=c.lastBaseUpdate,s===null?c.firstBaseUpdate=a:s.next=a,c.lastBaseUpdate=a}var Zm=!1;function qc(){if(Zm){var s=ol;if(s!==null)throw s}}function Hc(s,a,c,f){Zm=!1;var _=s.updateQueue;Ui=!1;var w=_.firstBaseUpdate,P=_.lastBaseUpdate,Q=_.shared.pending;if(Q!==null){_.shared.pending=null;var ne=Q,ge=ne.next;ne.next=null,P===null?w=ge:P.next=ge,P=ne;var Ce=s.alternate;Ce!==null&&(Ce=Ce.updateQueue,Q=Ce.lastBaseUpdate,Q!==P&&(Q===null?Ce.firstBaseUpdate=ge:Q.next=ge,Ce.lastBaseUpdate=ne))}if(w!==null){var Re=_.baseState;P=0,Ce=ge=ne=null,Q=w;do{var _e=Q.lane&-536870913,ve=_e!==Q.lane;if(ve?(ut&_e)===_e:(f&_e)===_e){_e!==0&&_e===al&&(Zm=!0),Ce!==null&&(Ce=Ce.next={lane:0,tag:Q.tag,payload:Q.payload,callback:null,next:null});e:{var Fe=s,Qe=Q;_e=a;var Nt=c;switch(Qe.tag){case 1:if(Fe=Qe.payload,typeof Fe=="function"){Re=Fe.call(Nt,Re,_e);break e}Re=Fe;break e;case 3:Fe.flags=Fe.flags&-65537|128;case 0:if(Fe=Qe.payload,_e=typeof Fe=="function"?Fe.call(Nt,Re,_e):Fe,_e==null)break e;Re=g({},Re,_e);break e;case 2:Ui=!0}}_e=Q.callback,_e!==null&&(s.flags|=64,ve&&(s.flags|=8192),ve=_.callbacks,ve===null?_.callbacks=[_e]:ve.push(_e))}else ve={lane:_e,tag:Q.tag,payload:Q.payload,callback:Q.callback,next:null},Ce===null?(ge=Ce=ve,ne=Re):Ce=Ce.next=ve,P|=_e;if(Q=Q.next,Q===null){if(Q=_.shared.pending,Q===null)break;ve=Q,Q=ve.next,ve.next=null,_.lastBaseUpdate=ve,_.shared.pending=null}}while(!0);Ce===null&&(ne=Re),_.baseState=ne,_.firstBaseUpdate=ge,_.lastBaseUpdate=Ce,w===null&&(_.shared.lanes=0),Qi|=P,s.lanes=P,s.memoizedState=Re}}function z_(s,a){if(typeof s!="function")throw Error(r(191,s));s.call(a)}function L_(s,a){var c=s.callbacks;if(c!==null)for(s.callbacks=null,s=0;s<c.length;s++)z_(c[s],a)}var ul=z(null),qd=z(0);function U_(s,a){s=oi,te(qd,s),te(ul,a),oi=s|a.baseLanes}function Jm(){te(qd,oi),te(ul,ul.current)}function ep(){oi=qd.current,G(ul),G(qd)}var xr=z(null),Lr=null;function $i(s){var a=s.alternate;te(rn,rn.current&1),te(xr,s),Lr===null&&(a===null||ul.current!==null||a.memoizedState!==null)&&(Lr=s)}function tp(s){te(rn,rn.current),te(xr,s),Lr===null&&(Lr=s)}function F_(s){s.tag===22?(te(rn,rn.current),te(xr,s),Lr===null&&(Lr=s)):qi()}function qi(){te(rn,rn.current),te(xr,xr.current)}function wr(s){G(xr),Lr===s&&(Lr=null),G(rn)}var rn=z(0);function Hd(s){for(var a=s;a!==null;){if(a.tag===13){var c=a.memoizedState;if(c!==null&&(c=c.dehydrated,c===null||og(c)||lg(c)))return a}else if(a.tag===19&&(a.memoizedProps.revealOrder==="forwards"||a.memoizedProps.revealOrder==="backwards"||a.memoizedProps.revealOrder==="unstable_legacy-backwards"||a.memoizedProps.revealOrder==="together")){if((a.flags&128)!==0)return a}else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===s)break;for(;a.sibling===null;){if(a.return===null||a.return===s)return null;a=a.return}a.sibling.return=a.return,a=a.sibling}return null}var Js=0,st=null,Mt=null,mn=null,Gd=!1,dl=!1,co=!1,Qd=0,Gc=0,hl=null,CA=0;function en(){throw Error(r(321))}function np(s,a){if(a===null)return!1;for(var c=0;c<a.length&&c<s.length;c++)if(!br(s[c],a[c]))return!1;return!0}function rp(s,a,c,f,_,w){return Js=w,st=a,a.memoizedState=null,a.updateQueue=null,a.lanes=0,K.H=s===null||s.memoizedState===null?Eb:_p,co=!1,w=c(f,_),co=!1,dl&&(w=$_(a,c,f,_)),V_(s),w}function V_(s){K.H=Kc;var a=Mt!==null&&Mt.next!==null;if(Js=0,mn=Mt=st=null,Gd=!1,Gc=0,hl=null,a)throw Error(r(300));s===null||pn||(s=s.dependencies,s!==null&&Bd(s)&&(pn=!0))}function $_(s,a,c,f){st=s;var _=0;do{if(dl&&(hl=null),Gc=0,dl=!1,25<=_)throw Error(r(301));if(_+=1,mn=Mt=null,s.updateQueue!=null){var w=s.updateQueue;w.lastEffect=null,w.events=null,w.stores=null,w.memoCache!=null&&(w.memoCache.index=0)}K.H=Cb,w=a(c,f)}while(dl);return w}function TA(){var s=K.H,a=s.useState()[0];return a=typeof a.then=="function"?Qc(a):a,s=s.useState()[0],(Mt!==null?Mt.memoizedState:null)!==s&&(st.flags|=1024),a}function sp(){var s=Qd!==0;return Qd=0,s}function ip(s,a,c){a.updateQueue=s.updateQueue,a.flags&=-2053,s.lanes&=~c}function ap(s){if(Gd){for(s=s.memoizedState;s!==null;){var a=s.queue;a!==null&&(a.pending=null),s=s.next}Gd=!1}Js=0,mn=Mt=st=null,dl=!1,Gc=Qd=0,hl=null}function rr(){var s={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return mn===null?st.memoizedState=mn=s:mn=mn.next=s,mn}function sn(){if(Mt===null){var s=st.alternate;s=s!==null?s.memoizedState:null}else s=Mt.next;var a=mn===null?st.memoizedState:mn.next;if(a!==null)mn=a,Mt=s;else{if(s===null)throw st.alternate===null?Error(r(467)):Error(r(310));Mt=s,s={memoizedState:Mt.memoizedState,baseState:Mt.baseState,baseQueue:Mt.baseQueue,queue:Mt.queue,next:null},mn===null?st.memoizedState=mn=s:mn=mn.next=s}return mn}function Wd(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Qc(s){var a=Gc;return Gc+=1,hl===null&&(hl=[]),s=M_(hl,s,a),a=st,(mn===null?a.memoizedState:mn.next)===null&&(a=a.alternate,K.H=a===null||a.memoizedState===null?Eb:_p),s}function Kd(s){if(s!==null&&typeof s=="object"){if(typeof s.then=="function")return Qc(s);if(s.$$typeof===I)return Bn(s)}throw Error(r(438,String(s)))}function op(s){var a=null,c=st.updateQueue;if(c!==null&&(a=c.memoCache),a==null){var f=st.alternate;f!==null&&(f=f.updateQueue,f!==null&&(f=f.memoCache,f!=null&&(a={data:f.data.map(function(_){return _.slice()}),index:0})))}if(a==null&&(a={data:[],index:0}),c===null&&(c=Wd(),st.updateQueue=c),c.memoCache=a,c=a.data[a.index],c===void 0)for(c=a.data[a.index]=Array(s),f=0;f<s;f++)c[f]=V;return a.index++,c}function ei(s,a){return typeof a=="function"?a(s):a}function Yd(s){var a=sn();return lp(a,Mt,s)}function lp(s,a,c){var f=s.queue;if(f===null)throw Error(r(311));f.lastRenderedReducer=c;var _=s.baseQueue,w=f.pending;if(w!==null){if(_!==null){var P=_.next;_.next=w.next,w.next=P}a.baseQueue=_=w,f.pending=null}if(w=s.baseState,_===null)s.memoizedState=w;else{a=_.next;var Q=P=null,ne=null,ge=a,Ce=!1;do{var Re=ge.lane&-536870913;if(Re!==ge.lane?(ut&Re)===Re:(Js&Re)===Re){var _e=ge.revertLane;if(_e===0)ne!==null&&(ne=ne.next={lane:0,revertLane:0,gesture:null,action:ge.action,hasEagerState:ge.hasEagerState,eagerState:ge.eagerState,next:null}),Re===al&&(Ce=!0);else if((Js&_e)===_e){ge=ge.next,_e===al&&(Ce=!0);continue}else Re={lane:0,revertLane:ge.revertLane,gesture:null,action:ge.action,hasEagerState:ge.hasEagerState,eagerState:ge.eagerState,next:null},ne===null?(Q=ne=Re,P=w):ne=ne.next=Re,st.lanes|=_e,Qi|=_e;Re=ge.action,co&&c(w,Re),w=ge.hasEagerState?ge.eagerState:c(w,Re)}else _e={lane:Re,revertLane:ge.revertLane,gesture:ge.gesture,action:ge.action,hasEagerState:ge.hasEagerState,eagerState:ge.eagerState,next:null},ne===null?(Q=ne=_e,P=w):ne=ne.next=_e,st.lanes|=Re,Qi|=Re;ge=ge.next}while(ge!==null&&ge!==a);if(ne===null?P=w:ne.next=Q,!br(w,s.memoizedState)&&(pn=!0,Ce&&(c=ol,c!==null)))throw c;s.memoizedState=w,s.baseState=P,s.baseQueue=ne,f.lastRenderedState=w}return _===null&&(f.lanes=0),[s.memoizedState,f.dispatch]}function cp(s){var a=sn(),c=a.queue;if(c===null)throw Error(r(311));c.lastRenderedReducer=s;var f=c.dispatch,_=c.pending,w=a.memoizedState;if(_!==null){c.pending=null;var P=_=_.next;do w=s(w,P.action),P=P.next;while(P!==_);br(w,a.memoizedState)||(pn=!0),a.memoizedState=w,a.baseQueue===null&&(a.baseState=w),c.lastRenderedState=w}return[w,f]}function q_(s,a,c){var f=st,_=sn(),w=pt;if(w){if(c===void 0)throw Error(r(407));c=c()}else c=a();var P=!br((Mt||_).memoizedState,c);if(P&&(_.memoizedState=c,pn=!0),_=_.queue,hp(Q_.bind(null,f,_,s),[s]),_.getSnapshot!==a||P||mn!==null&&mn.memoizedState.tag&1){if(f.flags|=2048,fl(9,{destroy:void 0},G_.bind(null,f,_,c,a),null),zt===null)throw Error(r(349));w||(Js&127)!==0||H_(f,a,c)}return c}function H_(s,a,c){s.flags|=16384,s={getSnapshot:a,value:c},a=st.updateQueue,a===null?(a=Wd(),st.updateQueue=a,a.stores=[s]):(c=a.stores,c===null?a.stores=[s]:c.push(s))}function G_(s,a,c,f){a.value=c,a.getSnapshot=f,W_(a)&&K_(s)}function Q_(s,a,c){return c(function(){W_(a)&&K_(s)})}function W_(s){var a=s.getSnapshot;s=s.value;try{var c=a();return!br(s,c)}catch{return!0}}function K_(s){var a=eo(s,2);a!==null&&dr(a,s,2)}function up(s){var a=rr();if(typeof s=="function"){var c=s;if(s=c(),co){Wn(!0);try{c()}finally{Wn(!1)}}}return a.memoizedState=a.baseState=s,a.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ei,lastRenderedState:s},a}function Y_(s,a,c,f){return s.baseState=c,lp(s,Mt,typeof f=="function"?f:ei)}function AA(s,a,c,f,_){if(Jd(s))throw Error(r(485));if(s=a.action,s!==null){var w={payload:_,action:s,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(P){w.listeners.push(P)}};K.T!==null?c(!0):w.isTransition=!1,f(w),c=a.pending,c===null?(w.next=a.pending=w,X_(a,w)):(w.next=c.next,a.pending=c.next=w)}}function X_(s,a){var c=a.action,f=a.payload,_=s.state;if(a.isTransition){var w=K.T,P={};K.T=P;try{var Q=c(_,f),ne=K.S;ne!==null&&ne(P,Q),Z_(s,a,Q)}catch(ge){dp(s,a,ge)}finally{w!==null&&P.types!==null&&(w.types=P.types),K.T=w}}else try{w=c(_,f),Z_(s,a,w)}catch(ge){dp(s,a,ge)}}function Z_(s,a,c){c!==null&&typeof c=="object"&&typeof c.then=="function"?c.then(function(f){J_(s,a,f)},function(f){return dp(s,a,f)}):J_(s,a,c)}function J_(s,a,c){a.status="fulfilled",a.value=c,eb(a),s.state=c,a=s.pending,a!==null&&(c=a.next,c===a?s.pending=null:(c=c.next,a.next=c,X_(s,c)))}function dp(s,a,c){var f=s.pending;if(s.pending=null,f!==null){f=f.next;do a.status="rejected",a.reason=c,eb(a),a=a.next;while(a!==f)}s.action=null}function eb(s){s=s.listeners;for(var a=0;a<s.length;a++)(0,s[a])()}function tb(s,a){return a}function nb(s,a){if(pt){var c=zt.formState;if(c!==null){e:{var f=st;if(pt){if(Vt){t:{for(var _=Vt,w=zr;_.nodeType!==8;){if(!w){_=null;break t}if(_=Ur(_.nextSibling),_===null){_=null;break t}}w=_.data,_=w==="F!"||w==="F"?_:null}if(_){Vt=Ur(_.nextSibling),f=_.data==="F!";break e}}zi(f)}f=!1}f&&(a=c[0])}}return c=rr(),c.memoizedState=c.baseState=a,f={pending:null,lanes:0,dispatch:null,lastRenderedReducer:tb,lastRenderedState:a},c.queue=f,c=xb.bind(null,st,f),f.dispatch=c,f=up(!1),w=yp.bind(null,st,!1,f.queue),f=rr(),_={state:a,dispatch:null,action:s,pending:null},f.queue=_,c=AA.bind(null,st,_,w,c),_.dispatch=c,f.memoizedState=s,[a,c,!1]}function rb(s){var a=sn();return sb(a,Mt,s)}function sb(s,a,c){if(a=lp(s,a,tb)[0],s=Yd(ei)[0],typeof a=="object"&&a!==null&&typeof a.then=="function")try{var f=Qc(a)}catch(P){throw P===ll?Ud:P}else f=a;a=sn();var _=a.queue,w=_.dispatch;return c!==a.memoizedState&&(st.flags|=2048,fl(9,{destroy:void 0},jA.bind(null,_,c),null)),[f,w,s]}function jA(s,a){s.action=a}function ib(s){var a=sn(),c=Mt;if(c!==null)return sb(a,c,s);sn(),a=a.memoizedState,c=sn();var f=c.queue.dispatch;return c.memoizedState=s,[a,f,!1]}function fl(s,a,c,f){return s={tag:s,create:c,deps:f,inst:a,next:null},a=st.updateQueue,a===null&&(a=Wd(),st.updateQueue=a),c=a.lastEffect,c===null?a.lastEffect=s.next=s:(f=c.next,c.next=s,s.next=f,a.lastEffect=s),s}function ab(){return sn().memoizedState}function Xd(s,a,c,f){var _=rr();st.flags|=s,_.memoizedState=fl(1|a,{destroy:void 0},c,f===void 0?null:f)}function Zd(s,a,c,f){var _=sn();f=f===void 0?null:f;var w=_.memoizedState.inst;Mt!==null&&f!==null&&np(f,Mt.memoizedState.deps)?_.memoizedState=fl(a,w,c,f):(st.flags|=s,_.memoizedState=fl(1|a,w,c,f))}function ob(s,a){Xd(8390656,8,s,a)}function hp(s,a){Zd(2048,8,s,a)}function RA(s){st.flags|=4;var a=st.updateQueue;if(a===null)a=Wd(),st.updateQueue=a,a.events=[s];else{var c=a.events;c===null?a.events=[s]:c.push(s)}}function lb(s){var a=sn().memoizedState;return RA({ref:a,nextImpl:s}),function(){if((Tt&2)!==0)throw Error(r(440));return a.impl.apply(void 0,arguments)}}function cb(s,a){return Zd(4,2,s,a)}function ub(s,a){return Zd(4,4,s,a)}function db(s,a){if(typeof a=="function"){s=s();var c=a(s);return function(){typeof c=="function"?c():a(null)}}if(a!=null)return s=s(),a.current=s,function(){a.current=null}}function hb(s,a,c){c=c!=null?c.concat([s]):null,Zd(4,4,db.bind(null,a,s),c)}function fp(){}function fb(s,a){var c=sn();a=a===void 0?null:a;var f=c.memoizedState;return a!==null&&np(a,f[1])?f[0]:(c.memoizedState=[s,a],s)}function mb(s,a){var c=sn();a=a===void 0?null:a;var f=c.memoizedState;if(a!==null&&np(a,f[1]))return f[0];if(f=s(),co){Wn(!0);try{s()}finally{Wn(!1)}}return c.memoizedState=[f,a],f}function mp(s,a,c){return c===void 0||(Js&1073741824)!==0&&(ut&261930)===0?s.memoizedState=a:(s.memoizedState=c,s=pv(),st.lanes|=s,Qi|=s,c)}function pb(s,a,c,f){return br(c,a)?c:ul.current!==null?(s=mp(s,c,f),br(s,a)||(pn=!0),s):(Js&42)===0||(Js&1073741824)!==0&&(ut&261930)===0?(pn=!0,s.memoizedState=c):(s=pv(),st.lanes|=s,Qi|=s,a)}function gb(s,a,c,f,_){var w=q.p;q.p=w!==0&&8>w?w:8;var P=K.T,Q={};K.T=Q,yp(s,!1,a,c);try{var ne=_(),ge=K.S;if(ge!==null&&ge(Q,ne),ne!==null&&typeof ne=="object"&&typeof ne.then=="function"){var Ce=EA(ne,f);Wc(s,a,Ce,Cr(s))}else Wc(s,a,f,Cr(s))}catch(Re){Wc(s,a,{then:function(){},status:"rejected",reason:Re},Cr())}finally{q.p=w,P!==null&&Q.types!==null&&(P.types=Q.types),K.T=P}}function IA(){}function pp(s,a,c,f){if(s.tag!==5)throw Error(r(476));var _=yb(s).queue;gb(s,_,a,W,c===null?IA:function(){return _b(s),c(f)})}function yb(s){var a=s.memoizedState;if(a!==null)return a;a={memoizedState:W,baseState:W,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ei,lastRenderedState:W},next:null};var c={};return a.next={memoizedState:c,baseState:c,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ei,lastRenderedState:c},next:null},s.memoizedState=a,s=s.alternate,s!==null&&(s.memoizedState=a),a}function _b(s){var a=yb(s);a.next===null&&(a=s.alternate.memoizedState),Wc(s,a.next.queue,{},Cr())}function gp(){return Bn(du)}function bb(){return sn().memoizedState}function vb(){return sn().memoizedState}function kA(s){for(var a=s.return;a!==null;){switch(a.tag){case 24:case 3:var c=Cr();s=Fi(c);var f=Vi(a,s,c);f!==null&&(dr(f,a,c),$c(f,a,c)),a={cache:Hm()},s.payload=a;return}a=a.return}}function DA(s,a,c){var f=Cr();c={lane:f,revertLane:0,gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null},Jd(s)?wb(a,c):(c=Om(s,a,c,f),c!==null&&(dr(c,s,f),Sb(c,a,f)))}function xb(s,a,c){var f=Cr();Wc(s,a,c,f)}function Wc(s,a,c,f){var _={lane:f,revertLane:0,gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null};if(Jd(s))wb(a,_);else{var w=s.alternate;if(s.lanes===0&&(w===null||w.lanes===0)&&(w=a.lastRenderedReducer,w!==null))try{var P=a.lastRenderedState,Q=w(P,c);if(_.hasEagerState=!0,_.eagerState=Q,br(Q,P))return Md(s,a,_,0),zt===null&&Dd(),!1}catch{}if(c=Om(s,a,_,f),c!==null)return dr(c,s,f),Sb(c,a,f),!0}return!1}function yp(s,a,c,f){if(f={lane:2,revertLane:Kp(),gesture:null,action:f,hasEagerState:!1,eagerState:null,next:null},Jd(s)){if(a)throw Error(r(479))}else a=Om(s,c,f,2),a!==null&&dr(a,s,2)}function Jd(s){var a=s.alternate;return s===st||a!==null&&a===st}function wb(s,a){dl=Gd=!0;var c=s.pending;c===null?a.next=a:(a.next=c.next,c.next=a),s.pending=a}function Sb(s,a,c){if((c&4194048)!==0){var f=a.lanes;f&=s.pendingLanes,c|=f,a.lanes=c,gc(s,c)}}var Kc={readContext:Bn,use:Kd,useCallback:en,useContext:en,useEffect:en,useImperativeHandle:en,useLayoutEffect:en,useInsertionEffect:en,useMemo:en,useReducer:en,useRef:en,useState:en,useDebugValue:en,useDeferredValue:en,useTransition:en,useSyncExternalStore:en,useId:en,useHostTransitionStatus:en,useFormState:en,useActionState:en,useOptimistic:en,useMemoCache:en,useCacheRefresh:en};Kc.useEffectEvent=en;var Eb={readContext:Bn,use:Kd,useCallback:function(s,a){return rr().memoizedState=[s,a===void 0?null:a],s},useContext:Bn,useEffect:ob,useImperativeHandle:function(s,a,c){c=c!=null?c.concat([s]):null,Xd(4194308,4,db.bind(null,a,s),c)},useLayoutEffect:function(s,a){return Xd(4194308,4,s,a)},useInsertionEffect:function(s,a){Xd(4,2,s,a)},useMemo:function(s,a){var c=rr();a=a===void 0?null:a;var f=s();if(co){Wn(!0);try{s()}finally{Wn(!1)}}return c.memoizedState=[f,a],f},useReducer:function(s,a,c){var f=rr();if(c!==void 0){var _=c(a);if(co){Wn(!0);try{c(a)}finally{Wn(!1)}}}else _=a;return f.memoizedState=f.baseState=_,s={pending:null,lanes:0,dispatch:null,lastRenderedReducer:s,lastRenderedState:_},f.queue=s,s=s.dispatch=DA.bind(null,st,s),[f.memoizedState,s]},useRef:function(s){var a=rr();return s={current:s},a.memoizedState=s},useState:function(s){s=up(s);var a=s.queue,c=xb.bind(null,st,a);return a.dispatch=c,[s.memoizedState,c]},useDebugValue:fp,useDeferredValue:function(s,a){var c=rr();return mp(c,s,a)},useTransition:function(){var s=up(!1);return s=gb.bind(null,st,s.queue,!0,!1),rr().memoizedState=s,[!1,s]},useSyncExternalStore:function(s,a,c){var f=st,_=rr();if(pt){if(c===void 0)throw Error(r(407));c=c()}else{if(c=a(),zt===null)throw Error(r(349));(ut&127)!==0||H_(f,a,c)}_.memoizedState=c;var w={value:c,getSnapshot:a};return _.queue=w,ob(Q_.bind(null,f,w,s),[s]),f.flags|=2048,fl(9,{destroy:void 0},G_.bind(null,f,w,c,a),null),c},useId:function(){var s=rr(),a=zt.identifierPrefix;if(pt){var c=Ds,f=ks;c=(f&~(1<<32-Et(f)-1)).toString(32)+c,a="_"+a+"R_"+c,c=Qd++,0<c&&(a+="H"+c.toString(32)),a+="_"}else c=CA++,a="_"+a+"r_"+c.toString(32)+"_";return s.memoizedState=a},useHostTransitionStatus:gp,useFormState:nb,useActionState:nb,useOptimistic:function(s){var a=rr();a.memoizedState=a.baseState=s;var c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return a.queue=c,a=yp.bind(null,st,!0,c),c.dispatch=a,[s,a]},useMemoCache:op,useCacheRefresh:function(){return rr().memoizedState=kA.bind(null,st)},useEffectEvent:function(s){var a=rr(),c={impl:s};return a.memoizedState=c,function(){if((Tt&2)!==0)throw Error(r(440));return c.impl.apply(void 0,arguments)}}},_p={readContext:Bn,use:Kd,useCallback:fb,useContext:Bn,useEffect:hp,useImperativeHandle:hb,useInsertionEffect:cb,useLayoutEffect:ub,useMemo:mb,useReducer:Yd,useRef:ab,useState:function(){return Yd(ei)},useDebugValue:fp,useDeferredValue:function(s,a){var c=sn();return pb(c,Mt.memoizedState,s,a)},useTransition:function(){var s=Yd(ei)[0],a=sn().memoizedState;return[typeof s=="boolean"?s:Qc(s),a]},useSyncExternalStore:q_,useId:bb,useHostTransitionStatus:gp,useFormState:rb,useActionState:rb,useOptimistic:function(s,a){var c=sn();return Y_(c,Mt,s,a)},useMemoCache:op,useCacheRefresh:vb};_p.useEffectEvent=lb;var Cb={readContext:Bn,use:Kd,useCallback:fb,useContext:Bn,useEffect:hp,useImperativeHandle:hb,useInsertionEffect:cb,useLayoutEffect:ub,useMemo:mb,useReducer:cp,useRef:ab,useState:function(){return cp(ei)},useDebugValue:fp,useDeferredValue:function(s,a){var c=sn();return Mt===null?mp(c,s,a):pb(c,Mt.memoizedState,s,a)},useTransition:function(){var s=cp(ei)[0],a=sn().memoizedState;return[typeof s=="boolean"?s:Qc(s),a]},useSyncExternalStore:q_,useId:bb,useHostTransitionStatus:gp,useFormState:ib,useActionState:ib,useOptimistic:function(s,a){var c=sn();return Mt!==null?Y_(c,Mt,s,a):(c.baseState=s,[s,c.queue.dispatch])},useMemoCache:op,useCacheRefresh:vb};Cb.useEffectEvent=lb;function bp(s,a,c,f){a=s.memoizedState,c=c(f,a),c=c==null?a:g({},a,c),s.memoizedState=c,s.lanes===0&&(s.updateQueue.baseState=c)}var vp={enqueueSetState:function(s,a,c){s=s._reactInternals;var f=Cr(),_=Fi(f);_.payload=a,c!=null&&(_.callback=c),a=Vi(s,_,f),a!==null&&(dr(a,s,f),$c(a,s,f))},enqueueReplaceState:function(s,a,c){s=s._reactInternals;var f=Cr(),_=Fi(f);_.tag=1,_.payload=a,c!=null&&(_.callback=c),a=Vi(s,_,f),a!==null&&(dr(a,s,f),$c(a,s,f))},enqueueForceUpdate:function(s,a){s=s._reactInternals;var c=Cr(),f=Fi(c);f.tag=2,a!=null&&(f.callback=a),a=Vi(s,f,c),a!==null&&(dr(a,s,c),$c(a,s,c))}};function Tb(s,a,c,f,_,w,P){return s=s.stateNode,typeof s.shouldComponentUpdate=="function"?s.shouldComponentUpdate(f,w,P):a.prototype&&a.prototype.isPureReactComponent?!Nc(c,f)||!Nc(_,w):!0}function Ab(s,a,c,f){s=a.state,typeof a.componentWillReceiveProps=="function"&&a.componentWillReceiveProps(c,f),typeof a.UNSAFE_componentWillReceiveProps=="function"&&a.UNSAFE_componentWillReceiveProps(c,f),a.state!==s&&vp.enqueueReplaceState(a,a.state,null)}function uo(s,a){var c=a;if("ref"in a){c={};for(var f in a)f!=="ref"&&(c[f]=a[f])}if(s=s.defaultProps){c===a&&(c=g({},c));for(var _ in s)c[_]===void 0&&(c[_]=s[_])}return c}function jb(s){kd(s)}function Rb(s){console.error(s)}function Ib(s){kd(s)}function eh(s,a){try{var c=s.onUncaughtError;c(a.value,{componentStack:a.stack})}catch(f){setTimeout(function(){throw f})}}function kb(s,a,c){try{var f=s.onCaughtError;f(c.value,{componentStack:c.stack,errorBoundary:a.tag===1?a.stateNode:null})}catch(_){setTimeout(function(){throw _})}}function xp(s,a,c){return c=Fi(c),c.tag=3,c.payload={element:null},c.callback=function(){eh(s,a)},c}function Db(s){return s=Fi(s),s.tag=3,s}function Mb(s,a,c,f){var _=c.type.getDerivedStateFromError;if(typeof _=="function"){var w=f.value;s.payload=function(){return _(w)},s.callback=function(){kb(a,c,f)}}var P=c.stateNode;P!==null&&typeof P.componentDidCatch=="function"&&(s.callback=function(){kb(a,c,f),typeof _!="function"&&(Wi===null?Wi=new Set([this]):Wi.add(this));var Q=f.stack;this.componentDidCatch(f.value,{componentStack:Q!==null?Q:""})})}function MA(s,a,c,f,_){if(c.flags|=32768,f!==null&&typeof f=="object"&&typeof f.then=="function"){if(a=c.alternate,a!==null&&il(a,c,_,!0),c=xr.current,c!==null){switch(c.tag){case 31:case 13:return Lr===null?hh():c.alternate===null&&tn===0&&(tn=3),c.flags&=-257,c.flags|=65536,c.lanes=_,f===Fd?c.flags|=16384:(a=c.updateQueue,a===null?c.updateQueue=new Set([f]):a.add(f),Gp(s,f,_)),!1;case 22:return c.flags|=65536,f===Fd?c.flags|=16384:(a=c.updateQueue,a===null?(a={transitions:null,markerInstances:null,retryQueue:new Set([f])},c.updateQueue=a):(c=a.retryQueue,c===null?a.retryQueue=new Set([f]):c.add(f)),Gp(s,f,_)),!1}throw Error(r(435,c.tag))}return Gp(s,f,_),hh(),!1}if(pt)return a=xr.current,a!==null?((a.flags&65536)===0&&(a.flags|=256),a.flags|=65536,a.lanes=_,f!==Um&&(s=Error(r(422),{cause:f}),zc(Nr(s,c)))):(f!==Um&&(a=Error(r(423),{cause:f}),zc(Nr(a,c))),s=s.current.alternate,s.flags|=65536,_&=-_,s.lanes|=_,f=Nr(f,c),_=xp(s.stateNode,f,_),Xm(s,_),tn!==4&&(tn=2)),!1;var w=Error(r(520),{cause:f});if(w=Nr(w,c),ru===null?ru=[w]:ru.push(w),tn!==4&&(tn=2),a===null)return!0;f=Nr(f,c),c=a;do{switch(c.tag){case 3:return c.flags|=65536,s=_&-_,c.lanes|=s,s=xp(c.stateNode,f,s),Xm(c,s),!1;case 1:if(a=c.type,w=c.stateNode,(c.flags&128)===0&&(typeof a.getDerivedStateFromError=="function"||w!==null&&typeof w.componentDidCatch=="function"&&(Wi===null||!Wi.has(w))))return c.flags|=65536,_&=-_,c.lanes|=_,_=Db(_),Mb(_,s,c,f),Xm(c,_),!1}c=c.return}while(c!==null);return!1}var wp=Error(r(461)),pn=!1;function zn(s,a,c,f){a.child=s===null?B_(a,null,c,f):lo(a,s.child,c,f)}function Ob(s,a,c,f,_){c=c.render;var w=a.ref;if("ref"in f){var P={};for(var Q in f)Q!=="ref"&&(P[Q]=f[Q])}else P=f;return so(a),f=rp(s,a,c,P,w,_),Q=sp(),s!==null&&!pn?(ip(s,a,_),ti(s,a,_)):(pt&&Q&&zm(a),a.flags|=1,zn(s,a,f,_),a.child)}function Nb(s,a,c,f,_){if(s===null){var w=c.type;return typeof w=="function"&&!Nm(w)&&w.defaultProps===void 0&&c.compare===null?(a.tag=15,a.type=w,Pb(s,a,w,f,_)):(s=Nd(c.type,null,f,a,a.mode,_),s.ref=a.ref,s.return=a,a.child=s)}if(w=s.child,!Ip(s,_)){var P=w.memoizedProps;if(c=c.compare,c=c!==null?c:Nc,c(P,f)&&s.ref===a.ref)return ti(s,a,_)}return a.flags|=1,s=Ks(w,f),s.ref=a.ref,s.return=a,a.child=s}function Pb(s,a,c,f,_){if(s!==null){var w=s.memoizedProps;if(Nc(w,f)&&s.ref===a.ref)if(pn=!1,a.pendingProps=f=w,Ip(s,_))(s.flags&131072)!==0&&(pn=!0);else return a.lanes=s.lanes,ti(s,a,_)}return Sp(s,a,c,f,_)}function Bb(s,a,c,f){var _=f.children,w=s!==null?s.memoizedState:null;if(s===null&&a.stateNode===null&&(a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),f.mode==="hidden"){if((a.flags&128)!==0){if(w=w!==null?w.baseLanes|c:c,s!==null){for(f=a.child=s.child,_=0;f!==null;)_=_|f.lanes|f.childLanes,f=f.sibling;f=_&~w}else f=0,a.child=null;return zb(s,a,w,c,f)}if((c&536870912)!==0)a.memoizedState={baseLanes:0,cachePool:null},s!==null&&Ld(a,w!==null?w.cachePool:null),w!==null?U_(a,w):Jm(),F_(a);else return f=a.lanes=536870912,zb(s,a,w!==null?w.baseLanes|c:c,c,f)}else w!==null?(Ld(a,w.cachePool),U_(a,w),qi(),a.memoizedState=null):(s!==null&&Ld(a,null),Jm(),qi());return zn(s,a,_,c),a.child}function Yc(s,a){return s!==null&&s.tag===22||a.stateNode!==null||(a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),a.sibling}function zb(s,a,c,f,_){var w=Qm();return w=w===null?null:{parent:fn._currentValue,pool:w},a.memoizedState={baseLanes:c,cachePool:w},s!==null&&Ld(a,null),Jm(),F_(a),s!==null&&il(s,a,f,!0),a.childLanes=_,null}function th(s,a){return a=rh({mode:a.mode,children:a.children},s.mode),a.ref=s.ref,s.child=a,a.return=s,a}function Lb(s,a,c){return lo(a,s.child,null,c),s=th(a,a.pendingProps),s.flags|=2,wr(a),a.memoizedState=null,s}function OA(s,a,c){var f=a.pendingProps,_=(a.flags&128)!==0;if(a.flags&=-129,s===null){if(pt){if(f.mode==="hidden")return s=th(a,f),a.lanes=536870912,Yc(null,s);if(tp(a),(s=Vt)?(s=Xv(s,zr),s=s!==null&&s.data==="&"?s:null,s!==null&&(a.memoizedState={dehydrated:s,treeContext:Pi!==null?{id:ks,overflow:Ds}:null,retryLane:536870912,hydrationErrors:null},c=w_(s),c.return=a,a.child=c,Pn=a,Vt=null)):s=null,s===null)throw zi(a);return a.lanes=536870912,null}return th(a,f)}var w=s.memoizedState;if(w!==null){var P=w.dehydrated;if(tp(a),_)if(a.flags&256)a.flags&=-257,a=Lb(s,a,c);else if(a.memoizedState!==null)a.child=s.child,a.flags|=128,a=null;else throw Error(r(558));else if(pn||il(s,a,c,!1),_=(c&s.childLanes)!==0,pn||_){if(f=zt,f!==null&&(P=yc(f,c),P!==0&&P!==w.retryLane))throw w.retryLane=P,eo(s,P),dr(f,s,P),wp;hh(),a=Lb(s,a,c)}else s=w.treeContext,Vt=Ur(P.nextSibling),Pn=a,pt=!0,Bi=null,zr=!1,s!==null&&C_(a,s),a=th(a,f),a.flags|=4096;return a}return s=Ks(s.child,{mode:f.mode,children:f.children}),s.ref=a.ref,a.child=s,s.return=a,s}function nh(s,a){var c=a.ref;if(c===null)s!==null&&s.ref!==null&&(a.flags|=4194816);else{if(typeof c!="function"&&typeof c!="object")throw Error(r(284));(s===null||s.ref!==c)&&(a.flags|=4194816)}}function Sp(s,a,c,f,_){return so(a),c=rp(s,a,c,f,void 0,_),f=sp(),s!==null&&!pn?(ip(s,a,_),ti(s,a,_)):(pt&&f&&zm(a),a.flags|=1,zn(s,a,c,_),a.child)}function Ub(s,a,c,f,_,w){return so(a),a.updateQueue=null,c=$_(a,f,c,_),V_(s),f=sp(),s!==null&&!pn?(ip(s,a,w),ti(s,a,w)):(pt&&f&&zm(a),a.flags|=1,zn(s,a,c,w),a.child)}function Fb(s,a,c,f,_){if(so(a),a.stateNode===null){var w=tl,P=c.contextType;typeof P=="object"&&P!==null&&(w=Bn(P)),w=new c(f,w),a.memoizedState=w.state!==null&&w.state!==void 0?w.state:null,w.updater=vp,a.stateNode=w,w._reactInternals=a,w=a.stateNode,w.props=f,w.state=a.memoizedState,w.refs={},Km(a),P=c.contextType,w.context=typeof P=="object"&&P!==null?Bn(P):tl,w.state=a.memoizedState,P=c.getDerivedStateFromProps,typeof P=="function"&&(bp(a,c,P,f),w.state=a.memoizedState),typeof c.getDerivedStateFromProps=="function"||typeof w.getSnapshotBeforeUpdate=="function"||typeof w.UNSAFE_componentWillMount!="function"&&typeof w.componentWillMount!="function"||(P=w.state,typeof w.componentWillMount=="function"&&w.componentWillMount(),typeof w.UNSAFE_componentWillMount=="function"&&w.UNSAFE_componentWillMount(),P!==w.state&&vp.enqueueReplaceState(w,w.state,null),Hc(a,f,w,_),qc(),w.state=a.memoizedState),typeof w.componentDidMount=="function"&&(a.flags|=4194308),f=!0}else if(s===null){w=a.stateNode;var Q=a.memoizedProps,ne=uo(c,Q);w.props=ne;var ge=w.context,Ce=c.contextType;P=tl,typeof Ce=="object"&&Ce!==null&&(P=Bn(Ce));var Re=c.getDerivedStateFromProps;Ce=typeof Re=="function"||typeof w.getSnapshotBeforeUpdate=="function",Q=a.pendingProps!==Q,Ce||typeof w.UNSAFE_componentWillReceiveProps!="function"&&typeof w.componentWillReceiveProps!="function"||(Q||ge!==P)&&Ab(a,w,f,P),Ui=!1;var _e=a.memoizedState;w.state=_e,Hc(a,f,w,_),qc(),ge=a.memoizedState,Q||_e!==ge||Ui?(typeof Re=="function"&&(bp(a,c,Re,f),ge=a.memoizedState),(ne=Ui||Tb(a,c,ne,f,_e,ge,P))?(Ce||typeof w.UNSAFE_componentWillMount!="function"&&typeof w.componentWillMount!="function"||(typeof w.componentWillMount=="function"&&w.componentWillMount(),typeof w.UNSAFE_componentWillMount=="function"&&w.UNSAFE_componentWillMount()),typeof w.componentDidMount=="function"&&(a.flags|=4194308)):(typeof w.componentDidMount=="function"&&(a.flags|=4194308),a.memoizedProps=f,a.memoizedState=ge),w.props=f,w.state=ge,w.context=P,f=ne):(typeof w.componentDidMount=="function"&&(a.flags|=4194308),f=!1)}else{w=a.stateNode,Ym(s,a),P=a.memoizedProps,Ce=uo(c,P),w.props=Ce,Re=a.pendingProps,_e=w.context,ge=c.contextType,ne=tl,typeof ge=="object"&&ge!==null&&(ne=Bn(ge)),Q=c.getDerivedStateFromProps,(ge=typeof Q=="function"||typeof w.getSnapshotBeforeUpdate=="function")||typeof w.UNSAFE_componentWillReceiveProps!="function"&&typeof w.componentWillReceiveProps!="function"||(P!==Re||_e!==ne)&&Ab(a,w,f,ne),Ui=!1,_e=a.memoizedState,w.state=_e,Hc(a,f,w,_),qc();var ve=a.memoizedState;P!==Re||_e!==ve||Ui||s!==null&&s.dependencies!==null&&Bd(s.dependencies)?(typeof Q=="function"&&(bp(a,c,Q,f),ve=a.memoizedState),(Ce=Ui||Tb(a,c,Ce,f,_e,ve,ne)||s!==null&&s.dependencies!==null&&Bd(s.dependencies))?(ge||typeof w.UNSAFE_componentWillUpdate!="function"&&typeof w.componentWillUpdate!="function"||(typeof w.componentWillUpdate=="function"&&w.componentWillUpdate(f,ve,ne),typeof w.UNSAFE_componentWillUpdate=="function"&&w.UNSAFE_componentWillUpdate(f,ve,ne)),typeof w.componentDidUpdate=="function"&&(a.flags|=4),typeof w.getSnapshotBeforeUpdate=="function"&&(a.flags|=1024)):(typeof w.componentDidUpdate!="function"||P===s.memoizedProps&&_e===s.memoizedState||(a.flags|=4),typeof w.getSnapshotBeforeUpdate!="function"||P===s.memoizedProps&&_e===s.memoizedState||(a.flags|=1024),a.memoizedProps=f,a.memoizedState=ve),w.props=f,w.state=ve,w.context=ne,f=Ce):(typeof w.componentDidUpdate!="function"||P===s.memoizedProps&&_e===s.memoizedState||(a.flags|=4),typeof w.getSnapshotBeforeUpdate!="function"||P===s.memoizedProps&&_e===s.memoizedState||(a.flags|=1024),f=!1)}return w=f,nh(s,a),f=(a.flags&128)!==0,w||f?(w=a.stateNode,c=f&&typeof c.getDerivedStateFromError!="function"?null:w.render(),a.flags|=1,s!==null&&f?(a.child=lo(a,s.child,null,_),a.child=lo(a,null,c,_)):zn(s,a,c,_),a.memoizedState=w.state,s=a.child):s=ti(s,a,_),s}function Vb(s,a,c,f){return no(),a.flags|=256,zn(s,a,c,f),a.child}var Ep={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Cp(s){return{baseLanes:s,cachePool:k_()}}function Tp(s,a,c){return s=s!==null?s.childLanes&~c:0,a&&(s|=Er),s}function $b(s,a,c){var f=a.pendingProps,_=!1,w=(a.flags&128)!==0,P;if((P=w)||(P=s!==null&&s.memoizedState===null?!1:(rn.current&2)!==0),P&&(_=!0,a.flags&=-129),P=(a.flags&32)!==0,a.flags&=-33,s===null){if(pt){if(_?$i(a):qi(),(s=Vt)?(s=Xv(s,zr),s=s!==null&&s.data!=="&"?s:null,s!==null&&(a.memoizedState={dehydrated:s,treeContext:Pi!==null?{id:ks,overflow:Ds}:null,retryLane:536870912,hydrationErrors:null},c=w_(s),c.return=a,a.child=c,Pn=a,Vt=null)):s=null,s===null)throw zi(a);return lg(s)?a.lanes=32:a.lanes=536870912,null}var Q=f.children;return f=f.fallback,_?(qi(),_=a.mode,Q=rh({mode:"hidden",children:Q},_),f=to(f,_,c,null),Q.return=a,f.return=a,Q.sibling=f,a.child=Q,f=a.child,f.memoizedState=Cp(c),f.childLanes=Tp(s,P,c),a.memoizedState=Ep,Yc(null,f)):($i(a),Ap(a,Q))}var ne=s.memoizedState;if(ne!==null&&(Q=ne.dehydrated,Q!==null)){if(w)a.flags&256?($i(a),a.flags&=-257,a=jp(s,a,c)):a.memoizedState!==null?(qi(),a.child=s.child,a.flags|=128,a=null):(qi(),Q=f.fallback,_=a.mode,f=rh({mode:"visible",children:f.children},_),Q=to(Q,_,c,null),Q.flags|=2,f.return=a,Q.return=a,f.sibling=Q,a.child=f,lo(a,s.child,null,c),f=a.child,f.memoizedState=Cp(c),f.childLanes=Tp(s,P,c),a.memoizedState=Ep,a=Yc(null,f));else if($i(a),lg(Q)){if(P=Q.nextSibling&&Q.nextSibling.dataset,P)var ge=P.dgst;P=ge,f=Error(r(419)),f.stack="",f.digest=P,zc({value:f,source:null,stack:null}),a=jp(s,a,c)}else if(pn||il(s,a,c,!1),P=(c&s.childLanes)!==0,pn||P){if(P=zt,P!==null&&(f=yc(P,c),f!==0&&f!==ne.retryLane))throw ne.retryLane=f,eo(s,f),dr(P,s,f),wp;og(Q)||hh(),a=jp(s,a,c)}else og(Q)?(a.flags|=192,a.child=s.child,a=null):(s=ne.treeContext,Vt=Ur(Q.nextSibling),Pn=a,pt=!0,Bi=null,zr=!1,s!==null&&C_(a,s),a=Ap(a,f.children),a.flags|=4096);return a}return _?(qi(),Q=f.fallback,_=a.mode,ne=s.child,ge=ne.sibling,f=Ks(ne,{mode:"hidden",children:f.children}),f.subtreeFlags=ne.subtreeFlags&65011712,ge!==null?Q=Ks(ge,Q):(Q=to(Q,_,c,null),Q.flags|=2),Q.return=a,f.return=a,f.sibling=Q,a.child=f,Yc(null,f),f=a.child,Q=s.child.memoizedState,Q===null?Q=Cp(c):(_=Q.cachePool,_!==null?(ne=fn._currentValue,_=_.parent!==ne?{parent:ne,pool:ne}:_):_=k_(),Q={baseLanes:Q.baseLanes|c,cachePool:_}),f.memoizedState=Q,f.childLanes=Tp(s,P,c),a.memoizedState=Ep,Yc(s.child,f)):($i(a),c=s.child,s=c.sibling,c=Ks(c,{mode:"visible",children:f.children}),c.return=a,c.sibling=null,s!==null&&(P=a.deletions,P===null?(a.deletions=[s],a.flags|=16):P.push(s)),a.child=c,a.memoizedState=null,c)}function Ap(s,a){return a=rh({mode:"visible",children:a},s.mode),a.return=s,s.child=a}function rh(s,a){return s=vr(22,s,null,a),s.lanes=0,s}function jp(s,a,c){return lo(a,s.child,null,c),s=Ap(a,a.pendingProps.children),s.flags|=2,a.memoizedState=null,s}function qb(s,a,c){s.lanes|=a;var f=s.alternate;f!==null&&(f.lanes|=a),$m(s.return,a,c)}function Rp(s,a,c,f,_,w){var P=s.memoizedState;P===null?s.memoizedState={isBackwards:a,rendering:null,renderingStartTime:0,last:f,tail:c,tailMode:_,treeForkCount:w}:(P.isBackwards=a,P.rendering=null,P.renderingStartTime=0,P.last=f,P.tail=c,P.tailMode=_,P.treeForkCount=w)}function Hb(s,a,c){var f=a.pendingProps,_=f.revealOrder,w=f.tail;f=f.children;var P=rn.current,Q=(P&2)!==0;if(Q?(P=P&1|2,a.flags|=128):P&=1,te(rn,P),zn(s,a,f,c),f=pt?Bc:0,!Q&&s!==null&&(s.flags&128)!==0)e:for(s=a.child;s!==null;){if(s.tag===13)s.memoizedState!==null&&qb(s,c,a);else if(s.tag===19)qb(s,c,a);else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===a)break e;for(;s.sibling===null;){if(s.return===null||s.return===a)break e;s=s.return}s.sibling.return=s.return,s=s.sibling}switch(_){case"forwards":for(c=a.child,_=null;c!==null;)s=c.alternate,s!==null&&Hd(s)===null&&(_=c),c=c.sibling;c=_,c===null?(_=a.child,a.child=null):(_=c.sibling,c.sibling=null),Rp(a,!1,_,c,w,f);break;case"backwards":case"unstable_legacy-backwards":for(c=null,_=a.child,a.child=null;_!==null;){if(s=_.alternate,s!==null&&Hd(s)===null){a.child=_;break}s=_.sibling,_.sibling=c,c=_,_=s}Rp(a,!0,c,null,w,f);break;case"together":Rp(a,!1,null,null,void 0,f);break;default:a.memoizedState=null}return a.child}function ti(s,a,c){if(s!==null&&(a.dependencies=s.dependencies),Qi|=a.lanes,(c&a.childLanes)===0)if(s!==null){if(il(s,a,c,!1),(c&a.childLanes)===0)return null}else return null;if(s!==null&&a.child!==s.child)throw Error(r(153));if(a.child!==null){for(s=a.child,c=Ks(s,s.pendingProps),a.child=c,c.return=a;s.sibling!==null;)s=s.sibling,c=c.sibling=Ks(s,s.pendingProps),c.return=a;c.sibling=null}return a.child}function Ip(s,a){return(s.lanes&a)!==0?!0:(s=s.dependencies,!!(s!==null&&Bd(s)))}function NA(s,a,c){switch(a.tag){case 3:he(a,a.stateNode.containerInfo),Li(a,fn,s.memoizedState.cache),no();break;case 27:case 5:Ue(a);break;case 4:he(a,a.stateNode.containerInfo);break;case 10:Li(a,a.type,a.memoizedProps.value);break;case 31:if(a.memoizedState!==null)return a.flags|=128,tp(a),null;break;case 13:var f=a.memoizedState;if(f!==null)return f.dehydrated!==null?($i(a),a.flags|=128,null):(c&a.child.childLanes)!==0?$b(s,a,c):($i(a),s=ti(s,a,c),s!==null?s.sibling:null);$i(a);break;case 19:var _=(s.flags&128)!==0;if(f=(c&a.childLanes)!==0,f||(il(s,a,c,!1),f=(c&a.childLanes)!==0),_){if(f)return Hb(s,a,c);a.flags|=128}if(_=a.memoizedState,_!==null&&(_.rendering=null,_.tail=null,_.lastEffect=null),te(rn,rn.current),f)break;return null;case 22:return a.lanes=0,Bb(s,a,c,a.pendingProps);case 24:Li(a,fn,s.memoizedState.cache)}return ti(s,a,c)}function Gb(s,a,c){if(s!==null)if(s.memoizedProps!==a.pendingProps)pn=!0;else{if(!Ip(s,c)&&(a.flags&128)===0)return pn=!1,NA(s,a,c);pn=(s.flags&131072)!==0}else pn=!1,pt&&(a.flags&1048576)!==0&&E_(a,Bc,a.index);switch(a.lanes=0,a.tag){case 16:e:{var f=a.pendingProps;if(s=ao(a.elementType),a.type=s,typeof s=="function")Nm(s)?(f=uo(s,f),a.tag=1,a=Fb(null,a,s,f,c)):(a.tag=0,a=Sp(null,a,s,f,c));else{if(s!=null){var _=s.$$typeof;if(_===O){a.tag=11,a=Ob(null,a,s,f,c);break e}else if(_===k){a.tag=14,a=Nb(null,a,s,f,c);break e}}throw a=M(s)||s,Error(r(306,a,""))}}return a;case 0:return Sp(s,a,a.type,a.pendingProps,c);case 1:return f=a.type,_=uo(f,a.pendingProps),Fb(s,a,f,_,c);case 3:e:{if(he(a,a.stateNode.containerInfo),s===null)throw Error(r(387));f=a.pendingProps;var w=a.memoizedState;_=w.element,Ym(s,a),Hc(a,f,null,c);var P=a.memoizedState;if(f=P.cache,Li(a,fn,f),f!==w.cache&&qm(a,[fn],c,!0),qc(),f=P.element,w.isDehydrated)if(w={element:f,isDehydrated:!1,cache:P.cache},a.updateQueue.baseState=w,a.memoizedState=w,a.flags&256){a=Vb(s,a,f,c);break e}else if(f!==_){_=Nr(Error(r(424)),a),zc(_),a=Vb(s,a,f,c);break e}else for(s=a.stateNode.containerInfo,s.nodeType===9?s=s.body:s=s.nodeName==="HTML"?s.ownerDocument.body:s,Vt=Ur(s.firstChild),Pn=a,pt=!0,Bi=null,zr=!0,c=B_(a,null,f,c),a.child=c;c;)c.flags=c.flags&-3|4096,c=c.sibling;else{if(no(),f===_){a=ti(s,a,c);break e}zn(s,a,f,c)}a=a.child}return a;case 26:return nh(s,a),s===null?(c=rx(a.type,null,a.pendingProps,null))?a.memoizedState=c:pt||(c=a.type,s=a.pendingProps,f=bh(ce.current).createElement(c),f[un]=a,f[jn]=s,Ln(f,c,s),dn(f),a.stateNode=f):a.memoizedState=rx(a.type,s.memoizedProps,a.pendingProps,s.memoizedState),null;case 27:return Ue(a),s===null&&pt&&(f=a.stateNode=ex(a.type,a.pendingProps,ce.current),Pn=a,zr=!0,_=Vt,Zi(a.type)?(cg=_,Vt=Ur(f.firstChild)):Vt=_),zn(s,a,a.pendingProps.children,c),nh(s,a),s===null&&(a.flags|=4194304),a.child;case 5:return s===null&&pt&&((_=f=Vt)&&(f=d2(f,a.type,a.pendingProps,zr),f!==null?(a.stateNode=f,Pn=a,Vt=Ur(f.firstChild),zr=!1,_=!0):_=!1),_||zi(a)),Ue(a),_=a.type,w=a.pendingProps,P=s!==null?s.memoizedProps:null,f=w.children,sg(_,w)?f=null:P!==null&&sg(_,P)&&(a.flags|=32),a.memoizedState!==null&&(_=rp(s,a,TA,null,null,c),du._currentValue=_),nh(s,a),zn(s,a,f,c),a.child;case 6:return s===null&&pt&&((s=c=Vt)&&(c=h2(c,a.pendingProps,zr),c!==null?(a.stateNode=c,Pn=a,Vt=null,s=!0):s=!1),s||zi(a)),null;case 13:return $b(s,a,c);case 4:return he(a,a.stateNode.containerInfo),f=a.pendingProps,s===null?a.child=lo(a,null,f,c):zn(s,a,f,c),a.child;case 11:return Ob(s,a,a.type,a.pendingProps,c);case 7:return zn(s,a,a.pendingProps,c),a.child;case 8:return zn(s,a,a.pendingProps.children,c),a.child;case 12:return zn(s,a,a.pendingProps.children,c),a.child;case 10:return f=a.pendingProps,Li(a,a.type,f.value),zn(s,a,f.children,c),a.child;case 9:return _=a.type._context,f=a.pendingProps.children,so(a),_=Bn(_),f=f(_),a.flags|=1,zn(s,a,f,c),a.child;case 14:return Nb(s,a,a.type,a.pendingProps,c);case 15:return Pb(s,a,a.type,a.pendingProps,c);case 19:return Hb(s,a,c);case 31:return OA(s,a,c);case 22:return Bb(s,a,c,a.pendingProps);case 24:return so(a),f=Bn(fn),s===null?(_=Qm(),_===null&&(_=zt,w=Hm(),_.pooledCache=w,w.refCount++,w!==null&&(_.pooledCacheLanes|=c),_=w),a.memoizedState={parent:f,cache:_},Km(a),Li(a,fn,_)):((s.lanes&c)!==0&&(Ym(s,a),Hc(a,null,null,c),qc()),_=s.memoizedState,w=a.memoizedState,_.parent!==f?(_={parent:f,cache:f},a.memoizedState=_,a.lanes===0&&(a.memoizedState=a.updateQueue.baseState=_),Li(a,fn,f)):(f=w.cache,Li(a,fn,f),f!==_.cache&&qm(a,[fn],c,!0))),zn(s,a,a.pendingProps.children,c),a.child;case 29:throw a.pendingProps}throw Error(r(156,a.tag))}function ni(s){s.flags|=4}function kp(s,a,c,f,_){if((a=(s.mode&32)!==0)&&(a=!1),a){if(s.flags|=16777216,(_&335544128)===_)if(s.stateNode.complete)s.flags|=8192;else if(bv())s.flags|=8192;else throw oo=Fd,Wm}else s.flags&=-16777217}function Qb(s,a){if(a.type!=="stylesheet"||(a.state.loading&4)!==0)s.flags&=-16777217;else if(s.flags|=16777216,!lx(a))if(bv())s.flags|=8192;else throw oo=Fd,Wm}function sh(s,a){a!==null&&(s.flags|=4),s.flags&16384&&(a=s.tag!==22?ud():536870912,s.lanes|=a,yl|=a)}function Xc(s,a){if(!pt)switch(s.tailMode){case"hidden":a=s.tail;for(var c=null;a!==null;)a.alternate!==null&&(c=a),a=a.sibling;c===null?s.tail=null:c.sibling=null;break;case"collapsed":c=s.tail;for(var f=null;c!==null;)c.alternate!==null&&(f=c),c=c.sibling;f===null?a||s.tail===null?s.tail=null:s.tail.sibling=null:f.sibling=null}}function $t(s){var a=s.alternate!==null&&s.alternate.child===s.child,c=0,f=0;if(a)for(var _=s.child;_!==null;)c|=_.lanes|_.childLanes,f|=_.subtreeFlags&65011712,f|=_.flags&65011712,_.return=s,_=_.sibling;else for(_=s.child;_!==null;)c|=_.lanes|_.childLanes,f|=_.subtreeFlags,f|=_.flags,_.return=s,_=_.sibling;return s.subtreeFlags|=f,s.childLanes=c,a}function PA(s,a,c){var f=a.pendingProps;switch(Lm(a),a.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return $t(a),null;case 1:return $t(a),null;case 3:return c=a.stateNode,f=null,s!==null&&(f=s.memoizedState.cache),a.memoizedState.cache!==f&&(a.flags|=2048),Zs(fn),Ee(),c.pendingContext&&(c.context=c.pendingContext,c.pendingContext=null),(s===null||s.child===null)&&(sl(a)?ni(a):s===null||s.memoizedState.isDehydrated&&(a.flags&256)===0||(a.flags|=1024,Fm())),$t(a),null;case 26:var _=a.type,w=a.memoizedState;return s===null?(ni(a),w!==null?($t(a),Qb(a,w)):($t(a),kp(a,_,null,f,c))):w?w!==s.memoizedState?(ni(a),$t(a),Qb(a,w)):($t(a),a.flags&=-16777217):(s=s.memoizedProps,s!==f&&ni(a),$t(a),kp(a,_,s,f,c)),null;case 27:if(Be(a),c=ce.current,_=a.type,s!==null&&a.stateNode!=null)s.memoizedProps!==f&&ni(a);else{if(!f){if(a.stateNode===null)throw Error(r(166));return $t(a),null}s=se.current,sl(a)?T_(a):(s=ex(_,f,c),a.stateNode=s,ni(a))}return $t(a),null;case 5:if(Be(a),_=a.type,s!==null&&a.stateNode!=null)s.memoizedProps!==f&&ni(a);else{if(!f){if(a.stateNode===null)throw Error(r(166));return $t(a),null}if(w=se.current,sl(a))T_(a);else{var P=bh(ce.current);switch(w){case 1:w=P.createElementNS("http://www.w3.org/2000/svg",_);break;case 2:w=P.createElementNS("http://www.w3.org/1998/Math/MathML",_);break;default:switch(_){case"svg":w=P.createElementNS("http://www.w3.org/2000/svg",_);break;case"math":w=P.createElementNS("http://www.w3.org/1998/Math/MathML",_);break;case"script":w=P.createElement("div"),w.innerHTML="<script><\/script>",w=w.removeChild(w.firstChild);break;case"select":w=typeof f.is=="string"?P.createElement("select",{is:f.is}):P.createElement("select"),f.multiple?w.multiple=!0:f.size&&(w.size=f.size);break;default:w=typeof f.is=="string"?P.createElement(_,{is:f.is}):P.createElement(_)}}w[un]=a,w[jn]=f;e:for(P=a.child;P!==null;){if(P.tag===5||P.tag===6)w.appendChild(P.stateNode);else if(P.tag!==4&&P.tag!==27&&P.child!==null){P.child.return=P,P=P.child;continue}if(P===a)break e;for(;P.sibling===null;){if(P.return===null||P.return===a)break e;P=P.return}P.sibling.return=P.return,P=P.sibling}a.stateNode=w;e:switch(Ln(w,_,f),_){case"button":case"input":case"select":case"textarea":f=!!f.autoFocus;break e;case"img":f=!0;break e;default:f=!1}f&&ni(a)}}return $t(a),kp(a,a.type,s===null?null:s.memoizedProps,a.pendingProps,c),null;case 6:if(s&&a.stateNode!=null)s.memoizedProps!==f&&ni(a);else{if(typeof f!="string"&&a.stateNode===null)throw Error(r(166));if(s=ce.current,sl(a)){if(s=a.stateNode,c=a.memoizedProps,f=null,_=Pn,_!==null)switch(_.tag){case 27:case 5:f=_.memoizedProps}s[un]=a,s=!!(s.nodeValue===c||f!==null&&f.suppressHydrationWarning===!0||$v(s.nodeValue,c)),s||zi(a,!0)}else s=bh(s).createTextNode(f),s[un]=a,a.stateNode=s}return $t(a),null;case 31:if(c=a.memoizedState,s===null||s.memoizedState!==null){if(f=sl(a),c!==null){if(s===null){if(!f)throw Error(r(318));if(s=a.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(r(557));s[un]=a}else no(),(a.flags&128)===0&&(a.memoizedState=null),a.flags|=4;$t(a),s=!1}else c=Fm(),s!==null&&s.memoizedState!==null&&(s.memoizedState.hydrationErrors=c),s=!0;if(!s)return a.flags&256?(wr(a),a):(wr(a),null);if((a.flags&128)!==0)throw Error(r(558))}return $t(a),null;case 13:if(f=a.memoizedState,s===null||s.memoizedState!==null&&s.memoizedState.dehydrated!==null){if(_=sl(a),f!==null&&f.dehydrated!==null){if(s===null){if(!_)throw Error(r(318));if(_=a.memoizedState,_=_!==null?_.dehydrated:null,!_)throw Error(r(317));_[un]=a}else no(),(a.flags&128)===0&&(a.memoizedState=null),a.flags|=4;$t(a),_=!1}else _=Fm(),s!==null&&s.memoizedState!==null&&(s.memoizedState.hydrationErrors=_),_=!0;if(!_)return a.flags&256?(wr(a),a):(wr(a),null)}return wr(a),(a.flags&128)!==0?(a.lanes=c,a):(c=f!==null,s=s!==null&&s.memoizedState!==null,c&&(f=a.child,_=null,f.alternate!==null&&f.alternate.memoizedState!==null&&f.alternate.memoizedState.cachePool!==null&&(_=f.alternate.memoizedState.cachePool.pool),w=null,f.memoizedState!==null&&f.memoizedState.cachePool!==null&&(w=f.memoizedState.cachePool.pool),w!==_&&(f.flags|=2048)),c!==s&&c&&(a.child.flags|=8192),sh(a,a.updateQueue),$t(a),null);case 4:return Ee(),s===null&&Jp(a.stateNode.containerInfo),$t(a),null;case 10:return Zs(a.type),$t(a),null;case 19:if(G(rn),f=a.memoizedState,f===null)return $t(a),null;if(_=(a.flags&128)!==0,w=f.rendering,w===null)if(_)Xc(f,!1);else{if(tn!==0||s!==null&&(s.flags&128)!==0)for(s=a.child;s!==null;){if(w=Hd(s),w!==null){for(a.flags|=128,Xc(f,!1),s=w.updateQueue,a.updateQueue=s,sh(a,s),a.subtreeFlags=0,s=c,c=a.child;c!==null;)x_(c,s),c=c.sibling;return te(rn,rn.current&1|2),pt&&Ys(a,f.treeForkCount),a.child}s=s.sibling}f.tail!==null&&Oe()>ch&&(a.flags|=128,_=!0,Xc(f,!1),a.lanes=4194304)}else{if(!_)if(s=Hd(w),s!==null){if(a.flags|=128,_=!0,s=s.updateQueue,a.updateQueue=s,sh(a,s),Xc(f,!0),f.tail===null&&f.tailMode==="hidden"&&!w.alternate&&!pt)return $t(a),null}else 2*Oe()-f.renderingStartTime>ch&&c!==536870912&&(a.flags|=128,_=!0,Xc(f,!1),a.lanes=4194304);f.isBackwards?(w.sibling=a.child,a.child=w):(s=f.last,s!==null?s.sibling=w:a.child=w,f.last=w)}return f.tail!==null?(s=f.tail,f.rendering=s,f.tail=s.sibling,f.renderingStartTime=Oe(),s.sibling=null,c=rn.current,te(rn,_?c&1|2:c&1),pt&&Ys(a,f.treeForkCount),s):($t(a),null);case 22:case 23:return wr(a),ep(),f=a.memoizedState!==null,s!==null?s.memoizedState!==null!==f&&(a.flags|=8192):f&&(a.flags|=8192),f?(c&536870912)!==0&&(a.flags&128)===0&&($t(a),a.subtreeFlags&6&&(a.flags|=8192)):$t(a),c=a.updateQueue,c!==null&&sh(a,c.retryQueue),c=null,s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(c=s.memoizedState.cachePool.pool),f=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(f=a.memoizedState.cachePool.pool),f!==c&&(a.flags|=2048),s!==null&&G(io),null;case 24:return c=null,s!==null&&(c=s.memoizedState.cache),a.memoizedState.cache!==c&&(a.flags|=2048),Zs(fn),$t(a),null;case 25:return null;case 30:return null}throw Error(r(156,a.tag))}function BA(s,a){switch(Lm(a),a.tag){case 1:return s=a.flags,s&65536?(a.flags=s&-65537|128,a):null;case 3:return Zs(fn),Ee(),s=a.flags,(s&65536)!==0&&(s&128)===0?(a.flags=s&-65537|128,a):null;case 26:case 27:case 5:return Be(a),null;case 31:if(a.memoizedState!==null){if(wr(a),a.alternate===null)throw Error(r(340));no()}return s=a.flags,s&65536?(a.flags=s&-65537|128,a):null;case 13:if(wr(a),s=a.memoizedState,s!==null&&s.dehydrated!==null){if(a.alternate===null)throw Error(r(340));no()}return s=a.flags,s&65536?(a.flags=s&-65537|128,a):null;case 19:return G(rn),null;case 4:return Ee(),null;case 10:return Zs(a.type),null;case 22:case 23:return wr(a),ep(),s!==null&&G(io),s=a.flags,s&65536?(a.flags=s&-65537|128,a):null;case 24:return Zs(fn),null;case 25:return null;default:return null}}function Wb(s,a){switch(Lm(a),a.tag){case 3:Zs(fn),Ee();break;case 26:case 27:case 5:Be(a);break;case 4:Ee();break;case 31:a.memoizedState!==null&&wr(a);break;case 13:wr(a);break;case 19:G(rn);break;case 10:Zs(a.type);break;case 22:case 23:wr(a),ep(),s!==null&&G(io);break;case 24:Zs(fn)}}function Zc(s,a){try{var c=a.updateQueue,f=c!==null?c.lastEffect:null;if(f!==null){var _=f.next;c=_;do{if((c.tag&s)===s){f=void 0;var w=c.create,P=c.inst;f=w(),P.destroy=f}c=c.next}while(c!==_)}}catch(Q){kt(a,a.return,Q)}}function Hi(s,a,c){try{var f=a.updateQueue,_=f!==null?f.lastEffect:null;if(_!==null){var w=_.next;f=w;do{if((f.tag&s)===s){var P=f.inst,Q=P.destroy;if(Q!==void 0){P.destroy=void 0,_=a;var ne=c,ge=Q;try{ge()}catch(Ce){kt(_,ne,Ce)}}}f=f.next}while(f!==w)}}catch(Ce){kt(a,a.return,Ce)}}function Kb(s){var a=s.updateQueue;if(a!==null){var c=s.stateNode;try{L_(a,c)}catch(f){kt(s,s.return,f)}}}function Yb(s,a,c){c.props=uo(s.type,s.memoizedProps),c.state=s.memoizedState;try{c.componentWillUnmount()}catch(f){kt(s,a,f)}}function Jc(s,a){try{var c=s.ref;if(c!==null){switch(s.tag){case 26:case 27:case 5:var f=s.stateNode;break;case 30:f=s.stateNode;break;default:f=s.stateNode}typeof c=="function"?s.refCleanup=c(f):c.current=f}}catch(_){kt(s,a,_)}}function Ms(s,a){var c=s.ref,f=s.refCleanup;if(c!==null)if(typeof f=="function")try{f()}catch(_){kt(s,a,_)}finally{s.refCleanup=null,s=s.alternate,s!=null&&(s.refCleanup=null)}else if(typeof c=="function")try{c(null)}catch(_){kt(s,a,_)}else c.current=null}function Xb(s){var a=s.type,c=s.memoizedProps,f=s.stateNode;try{e:switch(a){case"button":case"input":case"select":case"textarea":c.autoFocus&&f.focus();break e;case"img":c.src?f.src=c.src:c.srcSet&&(f.srcset=c.srcSet)}}catch(_){kt(s,s.return,_)}}function Dp(s,a,c){try{var f=s.stateNode;i2(f,s.type,c,a),f[jn]=a}catch(_){kt(s,s.return,_)}}function Zb(s){return s.tag===5||s.tag===3||s.tag===26||s.tag===27&&Zi(s.type)||s.tag===4}function Mp(s){e:for(;;){for(;s.sibling===null;){if(s.return===null||Zb(s.return))return null;s=s.return}for(s.sibling.return=s.return,s=s.sibling;s.tag!==5&&s.tag!==6&&s.tag!==18;){if(s.tag===27&&Zi(s.type)||s.flags&2||s.child===null||s.tag===4)continue e;s.child.return=s,s=s.child}if(!(s.flags&2))return s.stateNode}}function Op(s,a,c){var f=s.tag;if(f===5||f===6)s=s.stateNode,a?(c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c).insertBefore(s,a):(a=c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c,a.appendChild(s),c=c._reactRootContainer,c!=null||a.onclick!==null||(a.onclick=Yr));else if(f!==4&&(f===27&&Zi(s.type)&&(c=s.stateNode,a=null),s=s.child,s!==null))for(Op(s,a,c),s=s.sibling;s!==null;)Op(s,a,c),s=s.sibling}function ih(s,a,c){var f=s.tag;if(f===5||f===6)s=s.stateNode,a?c.insertBefore(s,a):c.appendChild(s);else if(f!==4&&(f===27&&Zi(s.type)&&(c=s.stateNode),s=s.child,s!==null))for(ih(s,a,c),s=s.sibling;s!==null;)ih(s,a,c),s=s.sibling}function Jb(s){var a=s.stateNode,c=s.memoizedProps;try{for(var f=s.type,_=a.attributes;_.length;)a.removeAttributeNode(_[0]);Ln(a,f,c),a[un]=s,a[jn]=c}catch(w){kt(s,s.return,w)}}var ri=!1,gn=!1,Np=!1,ev=typeof WeakSet=="function"?WeakSet:Set,In=null;function zA(s,a){if(s=s.containerInfo,ng=Th,s=h_(s),jm(s)){if("selectionStart"in s)var c={start:s.selectionStart,end:s.selectionEnd};else e:{c=(c=s.ownerDocument)&&c.defaultView||window;var f=c.getSelection&&c.getSelection();if(f&&f.rangeCount!==0){c=f.anchorNode;var _=f.anchorOffset,w=f.focusNode;f=f.focusOffset;try{c.nodeType,w.nodeType}catch{c=null;break e}var P=0,Q=-1,ne=-1,ge=0,Ce=0,Re=s,_e=null;t:for(;;){for(var ve;Re!==c||_!==0&&Re.nodeType!==3||(Q=P+_),Re!==w||f!==0&&Re.nodeType!==3||(ne=P+f),Re.nodeType===3&&(P+=Re.nodeValue.length),(ve=Re.firstChild)!==null;)_e=Re,Re=ve;for(;;){if(Re===s)break t;if(_e===c&&++ge===_&&(Q=P),_e===w&&++Ce===f&&(ne=P),(ve=Re.nextSibling)!==null)break;Re=_e,_e=Re.parentNode}Re=ve}c=Q===-1||ne===-1?null:{start:Q,end:ne}}else c=null}c=c||{start:0,end:0}}else c=null;for(rg={focusedElem:s,selectionRange:c},Th=!1,In=a;In!==null;)if(a=In,s=a.child,(a.subtreeFlags&1028)!==0&&s!==null)s.return=a,In=s;else for(;In!==null;){switch(a=In,w=a.alternate,s=a.flags,a.tag){case 0:if((s&4)!==0&&(s=a.updateQueue,s=s!==null?s.events:null,s!==null))for(c=0;c<s.length;c++)_=s[c],_.ref.impl=_.nextImpl;break;case 11:case 15:break;case 1:if((s&1024)!==0&&w!==null){s=void 0,c=a,_=w.memoizedProps,w=w.memoizedState,f=c.stateNode;try{var Fe=uo(c.type,_);s=f.getSnapshotBeforeUpdate(Fe,w),f.__reactInternalSnapshotBeforeUpdate=s}catch(Qe){kt(c,c.return,Qe)}}break;case 3:if((s&1024)!==0){if(s=a.stateNode.containerInfo,c=s.nodeType,c===9)ag(s);else if(c===1)switch(s.nodeName){case"HEAD":case"HTML":case"BODY":ag(s);break;default:s.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((s&1024)!==0)throw Error(r(163))}if(s=a.sibling,s!==null){s.return=a.return,In=s;break}In=a.return}}function tv(s,a,c){var f=c.flags;switch(c.tag){case 0:case 11:case 15:ii(s,c),f&4&&Zc(5,c);break;case 1:if(ii(s,c),f&4)if(s=c.stateNode,a===null)try{s.componentDidMount()}catch(P){kt(c,c.return,P)}else{var _=uo(c.type,a.memoizedProps);a=a.memoizedState;try{s.componentDidUpdate(_,a,s.__reactInternalSnapshotBeforeUpdate)}catch(P){kt(c,c.return,P)}}f&64&&Kb(c),f&512&&Jc(c,c.return);break;case 3:if(ii(s,c),f&64&&(s=c.updateQueue,s!==null)){if(a=null,c.child!==null)switch(c.child.tag){case 27:case 5:a=c.child.stateNode;break;case 1:a=c.child.stateNode}try{L_(s,a)}catch(P){kt(c,c.return,P)}}break;case 27:a===null&&f&4&&Jb(c);case 26:case 5:ii(s,c),a===null&&f&4&&Xb(c),f&512&&Jc(c,c.return);break;case 12:ii(s,c);break;case 31:ii(s,c),f&4&&sv(s,c);break;case 13:ii(s,c),f&4&&iv(s,c),f&64&&(s=c.memoizedState,s!==null&&(s=s.dehydrated,s!==null&&(c=QA.bind(null,c),f2(s,c))));break;case 22:if(f=c.memoizedState!==null||ri,!f){a=a!==null&&a.memoizedState!==null||gn,_=ri;var w=gn;ri=f,(gn=a)&&!w?ai(s,c,(c.subtreeFlags&8772)!==0):ii(s,c),ri=_,gn=w}break;case 30:break;default:ii(s,c)}}function nv(s){var a=s.alternate;a!==null&&(s.alternate=null,nv(a)),s.child=null,s.deletions=null,s.sibling=null,s.tag===5&&(a=s.stateNode,a!==null&&Fo(a)),s.stateNode=null,s.return=null,s.dependencies=null,s.memoizedProps=null,s.memoizedState=null,s.pendingProps=null,s.stateNode=null,s.updateQueue=null}var Wt=null,or=!1;function si(s,a,c){for(c=c.child;c!==null;)rv(s,a,c),c=c.sibling}function rv(s,a,c){if(Jt&&typeof Jt.onCommitFiberUnmount=="function")try{Jt.onCommitFiberUnmount(bt,c)}catch{}switch(c.tag){case 26:gn||Ms(c,a),si(s,a,c),c.memoizedState?c.memoizedState.count--:c.stateNode&&(c=c.stateNode,c.parentNode.removeChild(c));break;case 27:gn||Ms(c,a);var f=Wt,_=or;Zi(c.type)&&(Wt=c.stateNode,or=!1),si(s,a,c),lu(c.stateNode),Wt=f,or=_;break;case 5:gn||Ms(c,a);case 6:if(f=Wt,_=or,Wt=null,si(s,a,c),Wt=f,or=_,Wt!==null)if(or)try{(Wt.nodeType===9?Wt.body:Wt.nodeName==="HTML"?Wt.ownerDocument.body:Wt).removeChild(c.stateNode)}catch(w){kt(c,a,w)}else try{Wt.removeChild(c.stateNode)}catch(w){kt(c,a,w)}break;case 18:Wt!==null&&(or?(s=Wt,Kv(s.nodeType===9?s.body:s.nodeName==="HTML"?s.ownerDocument.body:s,c.stateNode),Cl(s)):Kv(Wt,c.stateNode));break;case 4:f=Wt,_=or,Wt=c.stateNode.containerInfo,or=!0,si(s,a,c),Wt=f,or=_;break;case 0:case 11:case 14:case 15:Hi(2,c,a),gn||Hi(4,c,a),si(s,a,c);break;case 1:gn||(Ms(c,a),f=c.stateNode,typeof f.componentWillUnmount=="function"&&Yb(c,a,f)),si(s,a,c);break;case 21:si(s,a,c);break;case 22:gn=(f=gn)||c.memoizedState!==null,si(s,a,c),gn=f;break;default:si(s,a,c)}}function sv(s,a){if(a.memoizedState===null&&(s=a.alternate,s!==null&&(s=s.memoizedState,s!==null))){s=s.dehydrated;try{Cl(s)}catch(c){kt(a,a.return,c)}}}function iv(s,a){if(a.memoizedState===null&&(s=a.alternate,s!==null&&(s=s.memoizedState,s!==null&&(s=s.dehydrated,s!==null))))try{Cl(s)}catch(c){kt(a,a.return,c)}}function LA(s){switch(s.tag){case 31:case 13:case 19:var a=s.stateNode;return a===null&&(a=s.stateNode=new ev),a;case 22:return s=s.stateNode,a=s._retryCache,a===null&&(a=s._retryCache=new ev),a;default:throw Error(r(435,s.tag))}}function ah(s,a){var c=LA(s);a.forEach(function(f){if(!c.has(f)){c.add(f);var _=WA.bind(null,s,f);f.then(_,_)}})}function lr(s,a){var c=a.deletions;if(c!==null)for(var f=0;f<c.length;f++){var _=c[f],w=s,P=a,Q=P;e:for(;Q!==null;){switch(Q.tag){case 27:if(Zi(Q.type)){Wt=Q.stateNode,or=!1;break e}break;case 5:Wt=Q.stateNode,or=!1;break e;case 3:case 4:Wt=Q.stateNode.containerInfo,or=!0;break e}Q=Q.return}if(Wt===null)throw Error(r(160));rv(w,P,_),Wt=null,or=!1,w=_.alternate,w!==null&&(w.return=null),_.return=null}if(a.subtreeFlags&13886)for(a=a.child;a!==null;)av(a,s),a=a.sibling}var ns=null;function av(s,a){var c=s.alternate,f=s.flags;switch(s.tag){case 0:case 11:case 14:case 15:lr(a,s),cr(s),f&4&&(Hi(3,s,s.return),Zc(3,s),Hi(5,s,s.return));break;case 1:lr(a,s),cr(s),f&512&&(gn||c===null||Ms(c,c.return)),f&64&&ri&&(s=s.updateQueue,s!==null&&(f=s.callbacks,f!==null&&(c=s.shared.hiddenCallbacks,s.shared.hiddenCallbacks=c===null?f:c.concat(f))));break;case 26:var _=ns;if(lr(a,s),cr(s),f&512&&(gn||c===null||Ms(c,c.return)),f&4){var w=c!==null?c.memoizedState:null;if(f=s.memoizedState,c===null)if(f===null)if(s.stateNode===null){e:{f=s.type,c=s.memoizedProps,_=_.ownerDocument||_;t:switch(f){case"title":w=_.getElementsByTagName("title")[0],(!w||w[bs]||w[un]||w.namespaceURI==="http://www.w3.org/2000/svg"||w.hasAttribute("itemprop"))&&(w=_.createElement(f),_.head.insertBefore(w,_.querySelector("head > title"))),Ln(w,f,c),w[un]=s,dn(w),f=w;break e;case"link":var P=ax("link","href",_).get(f+(c.href||""));if(P){for(var Q=0;Q<P.length;Q++)if(w=P[Q],w.getAttribute("href")===(c.href==null||c.href===""?null:c.href)&&w.getAttribute("rel")===(c.rel==null?null:c.rel)&&w.getAttribute("title")===(c.title==null?null:c.title)&&w.getAttribute("crossorigin")===(c.crossOrigin==null?null:c.crossOrigin)){P.splice(Q,1);break t}}w=_.createElement(f),Ln(w,f,c),_.head.appendChild(w);break;case"meta":if(P=ax("meta","content",_).get(f+(c.content||""))){for(Q=0;Q<P.length;Q++)if(w=P[Q],w.getAttribute("content")===(c.content==null?null:""+c.content)&&w.getAttribute("name")===(c.name==null?null:c.name)&&w.getAttribute("property")===(c.property==null?null:c.property)&&w.getAttribute("http-equiv")===(c.httpEquiv==null?null:c.httpEquiv)&&w.getAttribute("charset")===(c.charSet==null?null:c.charSet)){P.splice(Q,1);break t}}w=_.createElement(f),Ln(w,f,c),_.head.appendChild(w);break;default:throw Error(r(468,f))}w[un]=s,dn(w),f=w}s.stateNode=f}else ox(_,s.type,s.stateNode);else s.stateNode=ix(_,f,s.memoizedProps);else w!==f?(w===null?c.stateNode!==null&&(c=c.stateNode,c.parentNode.removeChild(c)):w.count--,f===null?ox(_,s.type,s.stateNode):ix(_,f,s.memoizedProps)):f===null&&s.stateNode!==null&&Dp(s,s.memoizedProps,c.memoizedProps)}break;case 27:lr(a,s),cr(s),f&512&&(gn||c===null||Ms(c,c.return)),c!==null&&f&4&&Dp(s,s.memoizedProps,c.memoizedProps);break;case 5:if(lr(a,s),cr(s),f&512&&(gn||c===null||Ms(c,c.return)),s.flags&32){_=s.stateNode;try{ar(_,"")}catch(Fe){kt(s,s.return,Fe)}}f&4&&s.stateNode!=null&&(_=s.memoizedProps,Dp(s,_,c!==null?c.memoizedProps:_)),f&1024&&(Np=!0);break;case 6:if(lr(a,s),cr(s),f&4){if(s.stateNode===null)throw Error(r(162));f=s.memoizedProps,c=s.stateNode;try{c.nodeValue=f}catch(Fe){kt(s,s.return,Fe)}}break;case 3:if(wh=null,_=ns,ns=vh(a.containerInfo),lr(a,s),ns=_,cr(s),f&4&&c!==null&&c.memoizedState.isDehydrated)try{Cl(a.containerInfo)}catch(Fe){kt(s,s.return,Fe)}Np&&(Np=!1,ov(s));break;case 4:f=ns,ns=vh(s.stateNode.containerInfo),lr(a,s),cr(s),ns=f;break;case 12:lr(a,s),cr(s);break;case 31:lr(a,s),cr(s),f&4&&(f=s.updateQueue,f!==null&&(s.updateQueue=null,ah(s,f)));break;case 13:lr(a,s),cr(s),s.child.flags&8192&&s.memoizedState!==null!=(c!==null&&c.memoizedState!==null)&&(lh=Oe()),f&4&&(f=s.updateQueue,f!==null&&(s.updateQueue=null,ah(s,f)));break;case 22:_=s.memoizedState!==null;var ne=c!==null&&c.memoizedState!==null,ge=ri,Ce=gn;if(ri=ge||_,gn=Ce||ne,lr(a,s),gn=Ce,ri=ge,cr(s),f&8192)e:for(a=s.stateNode,a._visibility=_?a._visibility&-2:a._visibility|1,_&&(c===null||ne||ri||gn||ho(s)),c=null,a=s;;){if(a.tag===5||a.tag===26){if(c===null){ne=c=a;try{if(w=ne.stateNode,_)P=w.style,typeof P.setProperty=="function"?P.setProperty("display","none","important"):P.display="none";else{Q=ne.stateNode;var Re=ne.memoizedProps.style,_e=Re!=null&&Re.hasOwnProperty("display")?Re.display:null;Q.style.display=_e==null||typeof _e=="boolean"?"":(""+_e).trim()}}catch(Fe){kt(ne,ne.return,Fe)}}}else if(a.tag===6){if(c===null){ne=a;try{ne.stateNode.nodeValue=_?"":ne.memoizedProps}catch(Fe){kt(ne,ne.return,Fe)}}}else if(a.tag===18){if(c===null){ne=a;try{var ve=ne.stateNode;_?Yv(ve,!0):Yv(ne.stateNode,!1)}catch(Fe){kt(ne,ne.return,Fe)}}}else if((a.tag!==22&&a.tag!==23||a.memoizedState===null||a===s)&&a.child!==null){a.child.return=a,a=a.child;continue}if(a===s)break e;for(;a.sibling===null;){if(a.return===null||a.return===s)break e;c===a&&(c=null),a=a.return}c===a&&(c=null),a.sibling.return=a.return,a=a.sibling}f&4&&(f=s.updateQueue,f!==null&&(c=f.retryQueue,c!==null&&(f.retryQueue=null,ah(s,c))));break;case 19:lr(a,s),cr(s),f&4&&(f=s.updateQueue,f!==null&&(s.updateQueue=null,ah(s,f)));break;case 30:break;case 21:break;default:lr(a,s),cr(s)}}function cr(s){var a=s.flags;if(a&2){try{for(var c,f=s.return;f!==null;){if(Zb(f)){c=f;break}f=f.return}if(c==null)throw Error(r(160));switch(c.tag){case 27:var _=c.stateNode,w=Mp(s);ih(s,w,_);break;case 5:var P=c.stateNode;c.flags&32&&(ar(P,""),c.flags&=-33);var Q=Mp(s);ih(s,Q,P);break;case 3:case 4:var ne=c.stateNode.containerInfo,ge=Mp(s);Op(s,ge,ne);break;default:throw Error(r(161))}}catch(Ce){kt(s,s.return,Ce)}s.flags&=-3}a&4096&&(s.flags&=-4097)}function ov(s){if(s.subtreeFlags&1024)for(s=s.child;s!==null;){var a=s;ov(a),a.tag===5&&a.flags&1024&&a.stateNode.reset(),s=s.sibling}}function ii(s,a){if(a.subtreeFlags&8772)for(a=a.child;a!==null;)tv(s,a.alternate,a),a=a.sibling}function ho(s){for(s=s.child;s!==null;){var a=s;switch(a.tag){case 0:case 11:case 14:case 15:Hi(4,a,a.return),ho(a);break;case 1:Ms(a,a.return);var c=a.stateNode;typeof c.componentWillUnmount=="function"&&Yb(a,a.return,c),ho(a);break;case 27:lu(a.stateNode);case 26:case 5:Ms(a,a.return),ho(a);break;case 22:a.memoizedState===null&&ho(a);break;case 30:ho(a);break;default:ho(a)}s=s.sibling}}function ai(s,a,c){for(c=c&&(a.subtreeFlags&8772)!==0,a=a.child;a!==null;){var f=a.alternate,_=s,w=a,P=w.flags;switch(w.tag){case 0:case 11:case 15:ai(_,w,c),Zc(4,w);break;case 1:if(ai(_,w,c),f=w,_=f.stateNode,typeof _.componentDidMount=="function")try{_.componentDidMount()}catch(ge){kt(f,f.return,ge)}if(f=w,_=f.updateQueue,_!==null){var Q=f.stateNode;try{var ne=_.shared.hiddenCallbacks;if(ne!==null)for(_.shared.hiddenCallbacks=null,_=0;_<ne.length;_++)z_(ne[_],Q)}catch(ge){kt(f,f.return,ge)}}c&&P&64&&Kb(w),Jc(w,w.return);break;case 27:Jb(w);case 26:case 5:ai(_,w,c),c&&f===null&&P&4&&Xb(w),Jc(w,w.return);break;case 12:ai(_,w,c);break;case 31:ai(_,w,c),c&&P&4&&sv(_,w);break;case 13:ai(_,w,c),c&&P&4&&iv(_,w);break;case 22:w.memoizedState===null&&ai(_,w,c),Jc(w,w.return);break;case 30:break;default:ai(_,w,c)}a=a.sibling}}function Pp(s,a){var c=null;s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(c=s.memoizedState.cachePool.pool),s=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(s=a.memoizedState.cachePool.pool),s!==c&&(s!=null&&s.refCount++,c!=null&&Lc(c))}function Bp(s,a){s=null,a.alternate!==null&&(s=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==s&&(a.refCount++,s!=null&&Lc(s))}function rs(s,a,c,f){if(a.subtreeFlags&10256)for(a=a.child;a!==null;)lv(s,a,c,f),a=a.sibling}function lv(s,a,c,f){var _=a.flags;switch(a.tag){case 0:case 11:case 15:rs(s,a,c,f),_&2048&&Zc(9,a);break;case 1:rs(s,a,c,f);break;case 3:rs(s,a,c,f),_&2048&&(s=null,a.alternate!==null&&(s=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==s&&(a.refCount++,s!=null&&Lc(s)));break;case 12:if(_&2048){rs(s,a,c,f),s=a.stateNode;try{var w=a.memoizedProps,P=w.id,Q=w.onPostCommit;typeof Q=="function"&&Q(P,a.alternate===null?"mount":"update",s.passiveEffectDuration,-0)}catch(ne){kt(a,a.return,ne)}}else rs(s,a,c,f);break;case 31:rs(s,a,c,f);break;case 13:rs(s,a,c,f);break;case 23:break;case 22:w=a.stateNode,P=a.alternate,a.memoizedState!==null?w._visibility&2?rs(s,a,c,f):eu(s,a):w._visibility&2?rs(s,a,c,f):(w._visibility|=2,ml(s,a,c,f,(a.subtreeFlags&10256)!==0||!1)),_&2048&&Pp(P,a);break;case 24:rs(s,a,c,f),_&2048&&Bp(a.alternate,a);break;default:rs(s,a,c,f)}}function ml(s,a,c,f,_){for(_=_&&((a.subtreeFlags&10256)!==0||!1),a=a.child;a!==null;){var w=s,P=a,Q=c,ne=f,ge=P.flags;switch(P.tag){case 0:case 11:case 15:ml(w,P,Q,ne,_),Zc(8,P);break;case 23:break;case 22:var Ce=P.stateNode;P.memoizedState!==null?Ce._visibility&2?ml(w,P,Q,ne,_):eu(w,P):(Ce._visibility|=2,ml(w,P,Q,ne,_)),_&&ge&2048&&Pp(P.alternate,P);break;case 24:ml(w,P,Q,ne,_),_&&ge&2048&&Bp(P.alternate,P);break;default:ml(w,P,Q,ne,_)}a=a.sibling}}function eu(s,a){if(a.subtreeFlags&10256)for(a=a.child;a!==null;){var c=s,f=a,_=f.flags;switch(f.tag){case 22:eu(c,f),_&2048&&Pp(f.alternate,f);break;case 24:eu(c,f),_&2048&&Bp(f.alternate,f);break;default:eu(c,f)}a=a.sibling}}var tu=8192;function pl(s,a,c){if(s.subtreeFlags&tu)for(s=s.child;s!==null;)cv(s,a,c),s=s.sibling}function cv(s,a,c){switch(s.tag){case 26:pl(s,a,c),s.flags&tu&&s.memoizedState!==null&&C2(c,ns,s.memoizedState,s.memoizedProps);break;case 5:pl(s,a,c);break;case 3:case 4:var f=ns;ns=vh(s.stateNode.containerInfo),pl(s,a,c),ns=f;break;case 22:s.memoizedState===null&&(f=s.alternate,f!==null&&f.memoizedState!==null?(f=tu,tu=16777216,pl(s,a,c),tu=f):pl(s,a,c));break;default:pl(s,a,c)}}function uv(s){var a=s.alternate;if(a!==null&&(s=a.child,s!==null)){a.child=null;do a=s.sibling,s.sibling=null,s=a;while(s!==null)}}function nu(s){var a=s.deletions;if((s.flags&16)!==0){if(a!==null)for(var c=0;c<a.length;c++){var f=a[c];In=f,hv(f,s)}uv(s)}if(s.subtreeFlags&10256)for(s=s.child;s!==null;)dv(s),s=s.sibling}function dv(s){switch(s.tag){case 0:case 11:case 15:nu(s),s.flags&2048&&Hi(9,s,s.return);break;case 3:nu(s);break;case 12:nu(s);break;case 22:var a=s.stateNode;s.memoizedState!==null&&a._visibility&2&&(s.return===null||s.return.tag!==13)?(a._visibility&=-3,oh(s)):nu(s);break;default:nu(s)}}function oh(s){var a=s.deletions;if((s.flags&16)!==0){if(a!==null)for(var c=0;c<a.length;c++){var f=a[c];In=f,hv(f,s)}uv(s)}for(s=s.child;s!==null;){switch(a=s,a.tag){case 0:case 11:case 15:Hi(8,a,a.return),oh(a);break;case 22:c=a.stateNode,c._visibility&2&&(c._visibility&=-3,oh(a));break;default:oh(a)}s=s.sibling}}function hv(s,a){for(;In!==null;){var c=In;switch(c.tag){case 0:case 11:case 15:Hi(8,c,a);break;case 23:case 22:if(c.memoizedState!==null&&c.memoizedState.cachePool!==null){var f=c.memoizedState.cachePool.pool;f!=null&&f.refCount++}break;case 24:Lc(c.memoizedState.cache)}if(f=c.child,f!==null)f.return=c,In=f;else e:for(c=s;In!==null;){f=In;var _=f.sibling,w=f.return;if(nv(f),f===c){In=null;break e}if(_!==null){_.return=w,In=_;break e}In=w}}}var UA={getCacheForType:function(s){var a=Bn(fn),c=a.data.get(s);return c===void 0&&(c=s(),a.data.set(s,c)),c},cacheSignal:function(){return Bn(fn).controller.signal}},FA=typeof WeakMap=="function"?WeakMap:Map,Tt=0,zt=null,ot=null,ut=0,It=0,Sr=null,Gi=!1,gl=!1,zp=!1,oi=0,tn=0,Qi=0,fo=0,Lp=0,Er=0,yl=0,ru=null,ur=null,Up=!1,lh=0,fv=0,ch=1/0,uh=null,Wi=null,wn=0,Ki=null,_l=null,li=0,Fp=0,Vp=null,mv=null,su=0,$p=null;function Cr(){return(Tt&2)!==0&&ut!==0?ut&-ut:K.T!==null?Kp():dd()}function pv(){if(Er===0)if((ut&536870912)===0||pt){var s=ps;ps<<=1,(ps&3932160)===0&&(ps=262144),Er=s}else Er=536870912;return s=xr.current,s!==null&&(s.flags|=32),Er}function dr(s,a,c){(s===zt&&(It===2||It===9)||s.cancelPendingCommit!==null)&&(bl(s,0),Yi(s,ut,Er,!1)),Ua(s,c),((Tt&2)===0||s!==zt)&&(s===zt&&((Tt&2)===0&&(fo|=c),tn===4&&Yi(s,ut,Er,!1)),Os(s))}function gv(s,a,c){if((Tt&6)!==0)throw Error(r(327));var f=!c&&(a&127)===0&&(a&s.expiredLanes)===0||Qr(s,a),_=f?qA(s,a):Hp(s,a,!0),w=f;do{if(_===0){gl&&!f&&Yi(s,a,0,!1);break}else{if(c=s.current.alternate,w&&!VA(c)){_=Hp(s,a,!1),w=!1;continue}if(_===2){if(w=a,s.errorRecoveryDisabledLanes&w)var P=0;else P=s.pendingLanes&-536870913,P=P!==0?P:P&536870912?536870912:0;if(P!==0){a=P;e:{var Q=s;_=ru;var ne=Q.current.memoizedState.isDehydrated;if(ne&&(bl(Q,P).flags|=256),P=Hp(Q,P,!1),P!==2){if(zp&&!ne){Q.errorRecoveryDisabledLanes|=w,fo|=w,_=4;break e}w=ur,ur=_,w!==null&&(ur===null?ur=w:ur.push.apply(ur,w))}_=P}if(w=!1,_!==2)continue}}if(_===1){bl(s,0),Yi(s,a,0,!0);break}e:{switch(f=s,w=_,w){case 0:case 1:throw Error(r(345));case 4:if((a&4194048)!==a)break;case 6:Yi(f,a,Er,!Gi);break e;case 2:ur=null;break;case 3:case 5:break;default:throw Error(r(329))}if((a&62914560)===a&&(_=lh+300-Oe(),10<_)){if(Yi(f,a,Er,!Gi),gs(f,0,!0)!==0)break e;li=a,f.timeoutHandle=Qv(yv.bind(null,f,c,ur,uh,Up,a,Er,fo,yl,Gi,w,"Throttled",-0,0),_);break e}yv(f,c,ur,uh,Up,a,Er,fo,yl,Gi,w,null,-0,0)}}break}while(!0);Os(s)}function yv(s,a,c,f,_,w,P,Q,ne,ge,Ce,Re,_e,ve){if(s.timeoutHandle=-1,Re=a.subtreeFlags,Re&8192||(Re&16785408)===16785408){Re={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Yr},cv(a,w,Re);var Fe=(w&62914560)===w?lh-Oe():(w&4194048)===w?fv-Oe():0;if(Fe=T2(Re,Fe),Fe!==null){li=w,s.cancelPendingCommit=Fe(Cv.bind(null,s,a,w,c,f,_,P,Q,ne,Ce,Re,null,_e,ve)),Yi(s,w,P,!ge);return}}Cv(s,a,w,c,f,_,P,Q,ne)}function VA(s){for(var a=s;;){var c=a.tag;if((c===0||c===11||c===15)&&a.flags&16384&&(c=a.updateQueue,c!==null&&(c=c.stores,c!==null)))for(var f=0;f<c.length;f++){var _=c[f],w=_.getSnapshot;_=_.value;try{if(!br(w(),_))return!1}catch{return!1}}if(c=a.child,a.subtreeFlags&16384&&c!==null)c.return=a,a=c;else{if(a===s)break;for(;a.sibling===null;){if(a.return===null||a.return===s)return!0;a=a.return}a.sibling.return=a.return,a=a.sibling}}return!0}function Yi(s,a,c,f){a&=~Lp,a&=~fo,s.suspendedLanes|=a,s.pingedLanes&=~a,f&&(s.warmLanes|=a),f=s.expirationTimes;for(var _=a;0<_;){var w=31-Et(_),P=1<<w;f[w]=-1,_&=~P}c!==0&&Fa(s,c,a)}function dh(){return(Tt&6)===0?(iu(0),!1):!0}function qp(){if(ot!==null){if(It===0)var s=ot.return;else s=ot,Xs=ro=null,ap(s),cl=null,Fc=0,s=ot;for(;s!==null;)Wb(s.alternate,s),s=s.return;ot=null}}function bl(s,a){var c=s.timeoutHandle;c!==-1&&(s.timeoutHandle=-1,l2(c)),c=s.cancelPendingCommit,c!==null&&(s.cancelPendingCommit=null,c()),li=0,qp(),zt=s,ot=c=Ks(s.current,null),ut=a,It=0,Sr=null,Gi=!1,gl=Qr(s,a),zp=!1,yl=Er=Lp=fo=Qi=tn=0,ur=ru=null,Up=!1,(a&8)!==0&&(a|=a&32);var f=s.entangledLanes;if(f!==0)for(s=s.entanglements,f&=a;0<f;){var _=31-Et(f),w=1<<_;a|=s[_],f&=~w}return oi=a,Dd(),c}function _v(s,a){st=null,K.H=Kc,a===ll||a===Ud?(a=O_(),It=3):a===Wm?(a=O_(),It=4):It=a===wp?8:a!==null&&typeof a=="object"&&typeof a.then=="function"?6:1,Sr=a,ot===null&&(tn=1,eh(s,Nr(a,s.current)))}function bv(){var s=xr.current;return s===null?!0:(ut&4194048)===ut?Lr===null:(ut&62914560)===ut||(ut&536870912)!==0?s===Lr:!1}function vv(){var s=K.H;return K.H=Kc,s===null?Kc:s}function xv(){var s=K.A;return K.A=UA,s}function hh(){tn=4,Gi||(ut&4194048)!==ut&&xr.current!==null||(gl=!0),(Qi&134217727)===0&&(fo&134217727)===0||zt===null||Yi(zt,ut,Er,!1)}function Hp(s,a,c){var f=Tt;Tt|=2;var _=vv(),w=xv();(zt!==s||ut!==a)&&(uh=null,bl(s,a)),a=!1;var P=tn;e:do try{if(It!==0&&ot!==null){var Q=ot,ne=Sr;switch(It){case 8:qp(),P=6;break e;case 3:case 2:case 9:case 6:xr.current===null&&(a=!0);var ge=It;if(It=0,Sr=null,vl(s,Q,ne,ge),c&&gl){P=0;break e}break;default:ge=It,It=0,Sr=null,vl(s,Q,ne,ge)}}$A(),P=tn;break}catch(Ce){_v(s,Ce)}while(!0);return a&&s.shellSuspendCounter++,Xs=ro=null,Tt=f,K.H=_,K.A=w,ot===null&&(zt=null,ut=0,Dd()),P}function $A(){for(;ot!==null;)wv(ot)}function qA(s,a){var c=Tt;Tt|=2;var f=vv(),_=xv();zt!==s||ut!==a?(uh=null,ch=Oe()+500,bl(s,a)):gl=Qr(s,a);e:do try{if(It!==0&&ot!==null){a=ot;var w=Sr;t:switch(It){case 1:It=0,Sr=null,vl(s,a,w,1);break;case 2:case 9:if(D_(w)){It=0,Sr=null,Sv(a);break}a=function(){It!==2&&It!==9||zt!==s||(It=7),Os(s)},w.then(a,a);break e;case 3:It=7;break e;case 4:It=5;break e;case 7:D_(w)?(It=0,Sr=null,Sv(a)):(It=0,Sr=null,vl(s,a,w,7));break;case 5:var P=null;switch(ot.tag){case 26:P=ot.memoizedState;case 5:case 27:var Q=ot;if(P?lx(P):Q.stateNode.complete){It=0,Sr=null;var ne=Q.sibling;if(ne!==null)ot=ne;else{var ge=Q.return;ge!==null?(ot=ge,fh(ge)):ot=null}break t}}It=0,Sr=null,vl(s,a,w,5);break;case 6:It=0,Sr=null,vl(s,a,w,6);break;case 8:qp(),tn=6;break e;default:throw Error(r(462))}}HA();break}catch(Ce){_v(s,Ce)}while(!0);return Xs=ro=null,K.H=f,K.A=_,Tt=c,ot!==null?0:(zt=null,ut=0,Dd(),tn)}function HA(){for(;ot!==null&&!ae();)wv(ot)}function wv(s){var a=Gb(s.alternate,s,oi);s.memoizedProps=s.pendingProps,a===null?fh(s):ot=a}function Sv(s){var a=s,c=a.alternate;switch(a.tag){case 15:case 0:a=Ub(c,a,a.pendingProps,a.type,void 0,ut);break;case 11:a=Ub(c,a,a.pendingProps,a.type.render,a.ref,ut);break;case 5:ap(a);default:Wb(c,a),a=ot=x_(a,oi),a=Gb(c,a,oi)}s.memoizedProps=s.pendingProps,a===null?fh(s):ot=a}function vl(s,a,c,f){Xs=ro=null,ap(a),cl=null,Fc=0;var _=a.return;try{if(MA(s,_,a,c,ut)){tn=1,eh(s,Nr(c,s.current)),ot=null;return}}catch(w){if(_!==null)throw ot=_,w;tn=1,eh(s,Nr(c,s.current)),ot=null;return}a.flags&32768?(pt||f===1?s=!0:gl||(ut&536870912)!==0?s=!1:(Gi=s=!0,(f===2||f===9||f===3||f===6)&&(f=xr.current,f!==null&&f.tag===13&&(f.flags|=16384))),Ev(a,s)):fh(a)}function fh(s){var a=s;do{if((a.flags&32768)!==0){Ev(a,Gi);return}s=a.return;var c=PA(a.alternate,a,oi);if(c!==null){ot=c;return}if(a=a.sibling,a!==null){ot=a;return}ot=a=s}while(a!==null);tn===0&&(tn=5)}function Ev(s,a){do{var c=BA(s.alternate,s);if(c!==null){c.flags&=32767,ot=c;return}if(c=s.return,c!==null&&(c.flags|=32768,c.subtreeFlags=0,c.deletions=null),!a&&(s=s.sibling,s!==null)){ot=s;return}ot=s=c}while(s!==null);tn=6,ot=null}function Cv(s,a,c,f,_,w,P,Q,ne){s.cancelPendingCommit=null;do mh();while(wn!==0);if((Tt&6)!==0)throw Error(r(327));if(a!==null){if(a===s.current)throw Error(r(177));if(w=a.lanes|a.childLanes,w|=Mm,Em(s,c,w,P,Q,ne),s===zt&&(ot=zt=null,ut=0),_l=a,Ki=s,li=c,Fp=w,Vp=_,mv=f,(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?(s.callbackNode=null,s.callbackPriority=0,KA(nt,function(){return Iv(),null})):(s.callbackNode=null,s.callbackPriority=0),f=(a.flags&13878)!==0,(a.subtreeFlags&13878)!==0||f){f=K.T,K.T=null,_=q.p,q.p=2,P=Tt,Tt|=4;try{zA(s,a,c)}finally{Tt=P,q.p=_,K.T=f}}wn=1,Tv(),Av(),jv()}}function Tv(){if(wn===1){wn=0;var s=Ki,a=_l,c=(a.flags&13878)!==0;if((a.subtreeFlags&13878)!==0||c){c=K.T,K.T=null;var f=q.p;q.p=2;var _=Tt;Tt|=4;try{av(a,s);var w=rg,P=h_(s.containerInfo),Q=w.focusedElem,ne=w.selectionRange;if(P!==Q&&Q&&Q.ownerDocument&&d_(Q.ownerDocument.documentElement,Q)){if(ne!==null&&jm(Q)){var ge=ne.start,Ce=ne.end;if(Ce===void 0&&(Ce=ge),"selectionStart"in Q)Q.selectionStart=ge,Q.selectionEnd=Math.min(Ce,Q.value.length);else{var Re=Q.ownerDocument||document,_e=Re&&Re.defaultView||window;if(_e.getSelection){var ve=_e.getSelection(),Fe=Q.textContent.length,Qe=Math.min(ne.start,Fe),Nt=ne.end===void 0?Qe:Math.min(ne.end,Fe);!ve.extend&&Qe>Nt&&(P=Nt,Nt=Qe,Qe=P);var ue=u_(Q,Qe),le=u_(Q,Nt);if(ue&&le&&(ve.rangeCount!==1||ve.anchorNode!==ue.node||ve.anchorOffset!==ue.offset||ve.focusNode!==le.node||ve.focusOffset!==le.offset)){var pe=Re.createRange();pe.setStart(ue.node,ue.offset),ve.removeAllRanges(),Qe>Nt?(ve.addRange(pe),ve.extend(le.node,le.offset)):(pe.setEnd(le.node,le.offset),ve.addRange(pe))}}}}for(Re=[],ve=Q;ve=ve.parentNode;)ve.nodeType===1&&Re.push({element:ve,left:ve.scrollLeft,top:ve.scrollTop});for(typeof Q.focus=="function"&&Q.focus(),Q=0;Q<Re.length;Q++){var Te=Re[Q];Te.element.scrollLeft=Te.left,Te.element.scrollTop=Te.top}}Th=!!ng,rg=ng=null}finally{Tt=_,q.p=f,K.T=c}}s.current=a,wn=2}}function Av(){if(wn===2){wn=0;var s=Ki,a=_l,c=(a.flags&8772)!==0;if((a.subtreeFlags&8772)!==0||c){c=K.T,K.T=null;var f=q.p;q.p=2;var _=Tt;Tt|=4;try{tv(s,a.alternate,a)}finally{Tt=_,q.p=f,K.T=c}}wn=3}}function jv(){if(wn===4||wn===3){wn=0,Ae();var s=Ki,a=_l,c=li,f=mv;(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?wn=5:(wn=0,_l=Ki=null,Rv(s,s.pendingLanes));var _=s.pendingLanes;if(_===0&&(Wi=null),Hs(c),a=a.stateNode,Jt&&typeof Jt.onCommitFiberRoot=="function")try{Jt.onCommitFiberRoot(bt,a,void 0,(a.current.flags&128)===128)}catch{}if(f!==null){a=K.T,_=q.p,q.p=2,K.T=null;try{for(var w=s.onRecoverableError,P=0;P<f.length;P++){var Q=f[P];w(Q.value,{componentStack:Q.stack})}}finally{K.T=a,q.p=_}}(li&3)!==0&&mh(),Os(s),_=s.pendingLanes,(c&261930)!==0&&(_&42)!==0?s===$p?su++:(su=0,$p=s):su=0,iu(0)}}function Rv(s,a){(s.pooledCacheLanes&=a)===0&&(a=s.pooledCache,a!=null&&(s.pooledCache=null,Lc(a)))}function mh(){return Tv(),Av(),jv(),Iv()}function Iv(){if(wn!==5)return!1;var s=Ki,a=Fp;Fp=0;var c=Hs(li),f=K.T,_=q.p;try{q.p=32>c?32:c,K.T=null,c=Vp,Vp=null;var w=Ki,P=li;if(wn=0,_l=Ki=null,li=0,(Tt&6)!==0)throw Error(r(331));var Q=Tt;if(Tt|=4,dv(w.current),lv(w,w.current,P,c),Tt=Q,iu(0,!1),Jt&&typeof Jt.onPostCommitFiberRoot=="function")try{Jt.onPostCommitFiberRoot(bt,w)}catch{}return!0}finally{q.p=_,K.T=f,Rv(s,a)}}function kv(s,a,c){a=Nr(c,a),a=xp(s.stateNode,a,2),s=Vi(s,a,2),s!==null&&(Ua(s,2),Os(s))}function kt(s,a,c){if(s.tag===3)kv(s,s,c);else for(;a!==null;){if(a.tag===3){kv(a,s,c);break}else if(a.tag===1){var f=a.stateNode;if(typeof a.type.getDerivedStateFromError=="function"||typeof f.componentDidCatch=="function"&&(Wi===null||!Wi.has(f))){s=Nr(c,s),c=Db(2),f=Vi(a,c,2),f!==null&&(Mb(c,f,a,s),Ua(f,2),Os(f));break}}a=a.return}}function Gp(s,a,c){var f=s.pingCache;if(f===null){f=s.pingCache=new FA;var _=new Set;f.set(a,_)}else _=f.get(a),_===void 0&&(_=new Set,f.set(a,_));_.has(c)||(zp=!0,_.add(c),s=GA.bind(null,s,a,c),a.then(s,s))}function GA(s,a,c){var f=s.pingCache;f!==null&&f.delete(a),s.pingedLanes|=s.suspendedLanes&c,s.warmLanes&=~c,zt===s&&(ut&c)===c&&(tn===4||tn===3&&(ut&62914560)===ut&&300>Oe()-lh?(Tt&2)===0&&bl(s,0):Lp|=c,yl===ut&&(yl=0)),Os(s)}function Dv(s,a){a===0&&(a=ud()),s=eo(s,a),s!==null&&(Ua(s,a),Os(s))}function QA(s){var a=s.memoizedState,c=0;a!==null&&(c=a.retryLane),Dv(s,c)}function WA(s,a){var c=0;switch(s.tag){case 31:case 13:var f=s.stateNode,_=s.memoizedState;_!==null&&(c=_.retryLane);break;case 19:f=s.stateNode;break;case 22:f=s.stateNode._retryCache;break;default:throw Error(r(314))}f!==null&&f.delete(a),Dv(s,c)}function KA(s,a){return Se(s,a)}var ph=null,xl=null,Qp=!1,gh=!1,Wp=!1,Xi=0;function Os(s){s!==xl&&s.next===null&&(xl===null?ph=xl=s:xl=xl.next=s),gh=!0,Qp||(Qp=!0,XA())}function iu(s,a){if(!Wp&&gh){Wp=!0;do for(var c=!1,f=ph;f!==null;){if(s!==0){var _=f.pendingLanes;if(_===0)var w=0;else{var P=f.suspendedLanes,Q=f.pingedLanes;w=(1<<31-Et(42|s)+1)-1,w&=_&~(P&~Q),w=w&201326741?w&201326741|1:w?w|2:0}w!==0&&(c=!0,Pv(f,w))}else w=ut,w=gs(f,f===zt?w:0,f.cancelPendingCommit!==null||f.timeoutHandle!==-1),(w&3)===0||Qr(f,w)||(c=!0,Pv(f,w));f=f.next}while(c);Wp=!1}}function YA(){Mv()}function Mv(){gh=Qp=!1;var s=0;Xi!==0&&o2()&&(s=Xi);for(var a=Oe(),c=null,f=ph;f!==null;){var _=f.next,w=Ov(f,a);w===0?(f.next=null,c===null?ph=_:c.next=_,_===null&&(xl=c)):(c=f,(s!==0||(w&3)!==0)&&(gh=!0)),f=_}wn!==0&&wn!==5||iu(s),Xi!==0&&(Xi=0)}function Ov(s,a){for(var c=s.suspendedLanes,f=s.pingedLanes,_=s.expirationTimes,w=s.pendingLanes&-62914561;0<w;){var P=31-Et(w),Q=1<<P,ne=_[P];ne===-1?((Q&c)===0||(Q&f)!==0)&&(_[P]=Sm(Q,a)):ne<=a&&(s.expiredLanes|=Q),w&=~Q}if(a=zt,c=ut,c=gs(s,s===a?c:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),f=s.callbackNode,c===0||s===a&&(It===2||It===9)||s.cancelPendingCommit!==null)return f!==null&&f!==null&&xe(f),s.callbackNode=null,s.callbackPriority=0;if((c&3)===0||Qr(s,c)){if(a=c&-c,a===s.callbackPriority)return a;switch(f!==null&&xe(f),Hs(c)){case 2:case 8:c=xt;break;case 32:c=nt;break;case 268435456:c=fs;break;default:c=nt}return f=Nv.bind(null,s),c=Se(c,f),s.callbackPriority=a,s.callbackNode=c,a}return f!==null&&f!==null&&xe(f),s.callbackPriority=2,s.callbackNode=null,2}function Nv(s,a){if(wn!==0&&wn!==5)return s.callbackNode=null,s.callbackPriority=0,null;var c=s.callbackNode;if(mh()&&s.callbackNode!==c)return null;var f=ut;return f=gs(s,s===zt?f:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),f===0?null:(gv(s,f,a),Ov(s,Oe()),s.callbackNode!=null&&s.callbackNode===c?Nv.bind(null,s):null)}function Pv(s,a){if(mh())return null;gv(s,a,!0)}function XA(){c2(function(){(Tt&6)!==0?Se(qe,YA):Mv()})}function Kp(){if(Xi===0){var s=al;s===0&&(s=Rr,Rr<<=1,(Rr&261888)===0&&(Rr=256)),Xi=s}return Xi}function Bv(s){return s==null||typeof s=="symbol"||typeof s=="boolean"?null:typeof s=="function"?s:Ho(""+s)}function zv(s,a){var c=a.ownerDocument.createElement("input");return c.name=a.name,c.value=a.value,s.id&&c.setAttribute("form",s.id),a.parentNode.insertBefore(c,a),s=new FormData(s),c.parentNode.removeChild(c),s}function ZA(s,a,c,f,_){if(a==="submit"&&c&&c.stateNode===_){var w=Bv((_[jn]||null).action),P=f.submitter;P&&(a=(a=P[jn]||null)?Bv(a.formAction):P.getAttribute("formAction"),a!==null&&(w=a,P=null));var Q=new As("action","action",null,f,_);s.push({event:Q,listeners:[{instance:null,listener:function(){if(f.defaultPrevented){if(Xi!==0){var ne=P?zv(_,P):new FormData(_);pp(c,{pending:!0,data:ne,method:_.method,action:w},null,ne)}}else typeof w=="function"&&(Q.preventDefault(),ne=P?zv(_,P):new FormData(_),pp(c,{pending:!0,data:ne,method:_.method,action:w},w,ne))},currentTarget:_}]})}}for(var Yp=0;Yp<Dm.length;Yp++){var Xp=Dm[Yp],JA=Xp.toLowerCase(),e2=Xp[0].toUpperCase()+Xp.slice(1);ts(JA,"on"+e2)}ts(p_,"onAnimationEnd"),ts(g_,"onAnimationIteration"),ts(y_,"onAnimationStart"),ts("dblclick","onDoubleClick"),ts("focusin","onFocus"),ts("focusout","onBlur"),ts(gA,"onTransitionRun"),ts(yA,"onTransitionStart"),ts(_A,"onTransitionCancel"),ts(__,"onTransitionEnd"),Ss("onMouseEnter",["mouseout","mouseover"]),Ss("onMouseLeave",["mouseout","mouseover"]),Ss("onPointerEnter",["pointerout","pointerover"]),Ss("onPointerLeave",["pointerout","pointerover"]),ws("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),ws("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),ws("onBeforeInput",["compositionend","keypress","textInput","paste"]),ws("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),ws("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),ws("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var au="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),t2=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(au));function Lv(s,a){a=(a&4)!==0;for(var c=0;c<s.length;c++){var f=s[c],_=f.event;f=f.listeners;e:{var w=void 0;if(a)for(var P=f.length-1;0<=P;P--){var Q=f[P],ne=Q.instance,ge=Q.currentTarget;if(Q=Q.listener,ne!==w&&_.isPropagationStopped())break e;w=Q,_.currentTarget=ge;try{w(_)}catch(Ce){kd(Ce)}_.currentTarget=null,w=ne}else for(P=0;P<f.length;P++){if(Q=f[P],ne=Q.instance,ge=Q.currentTarget,Q=Q.listener,ne!==w&&_.isPropagationStopped())break e;w=Q,_.currentTarget=ge;try{w(_)}catch(Ce){kd(Ce)}_.currentTarget=null,w=ne}}}}function lt(s,a){var c=a[Uo];c===void 0&&(c=a[Uo]=new Set);var f=s+"__bubble";c.has(f)||(Uv(a,s,2,!1),c.add(f))}function Zp(s,a,c){var f=0;a&&(f|=4),Uv(c,s,f,a)}var yh="_reactListening"+Math.random().toString(36).slice(2);function Jp(s){if(!s[yh]){s[yh]=!0,_c.forEach(function(c){c!=="selectionchange"&&(t2.has(c)||Zp(c,!1,s),Zp(c,!0,s))});var a=s.nodeType===9?s:s.ownerDocument;a===null||a[yh]||(a[yh]=!0,Zp("selectionchange",!1,a))}}function Uv(s,a,c,f){switch(px(a)){case 2:var _=R2;break;case 8:_=I2;break;default:_=mg}c=_.bind(null,a,c,s),_=void 0,!Ga||a!=="touchstart"&&a!=="touchmove"&&a!=="wheel"||(_=!0),f?_!==void 0?s.addEventListener(a,c,{capture:!0,passive:_}):s.addEventListener(a,c,!0):_!==void 0?s.addEventListener(a,c,{passive:_}):s.addEventListener(a,c,!1)}function eg(s,a,c,f,_){var w=f;if((a&1)===0&&(a&2)===0&&f!==null)e:for(;;){if(f===null)return;var P=f.tag;if(P===3||P===4){var Q=f.stateNode.containerInfo;if(Q===_)break;if(P===4)for(P=f.return;P!==null;){var ne=P.tag;if((ne===3||ne===4)&&P.stateNode.containerInfo===_)return;P=P.return}for(;Q!==null;){if(P=vs(Q),P===null)return;if(ne=P.tag,ne===5||ne===6||ne===26||ne===27){f=w=P;continue e}Q=Q.parentNode}}f=f.return}Di(function(){var ge=w,Ce=kr(c),Re=[];e:{var _e=b_.get(s);if(_e!==void 0){var ve=As,Fe=s;switch(s){case"keypress":if(Wa(c)===0)break e;case"keydown":case"keyup":ve=jd;break;case"focusin":Fe="focus",ve=Ya;break;case"focusout":Fe="blur",ve=Ya;break;case"beforeblur":case"afterblur":ve=Ya;break;case"click":if(c.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ve=kc;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ve=bd;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ve=A;break;case p_:case g_:case y_:ve=xd;break;case __:ve=Y;break;case"scroll":case"scrollend":ve=Ic;break;case"wheel":ve=be;break;case"copy":case"cut":case"paste":ve=wd;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ve=Ws;break;case"toggle":case"beforetoggle":ve=rt}var Qe=(a&4)!==0,Nt=!Qe&&(s==="scroll"||s==="scrollend"),ue=Qe?_e!==null?_e+"Capture":null:_e;Qe=[];for(var le=ge,pe;le!==null;){var Te=le;if(pe=Te.stateNode,Te=Te.tag,Te!==5&&Te!==26&&Te!==27||pe===null||ue===null||(Te=Xr(le,ue),Te!=null&&Qe.push(ou(le,Te,pe))),Nt)break;le=le.return}0<Qe.length&&(_e=new ve(_e,Fe,null,c,Ce),Re.push({event:_e,listeners:Qe}))}}if((a&7)===0){e:{if(_e=s==="mouseover"||s==="pointerover",ve=s==="mouseout"||s==="pointerout",_e&&c!==Ac&&(Fe=c.relatedTarget||c.fromElement)&&(vs(Fe)||Fe[_s]))break e;if((ve||_e)&&(_e=Ce.window===Ce?Ce:(_e=Ce.ownerDocument)?_e.defaultView||_e.parentWindow:window,ve?(Fe=c.relatedTarget||c.toElement,ve=ge,Fe=Fe?vs(Fe):null,Fe!==null&&(Nt=o(Fe),Qe=Fe.tag,Fe!==Nt||Qe!==5&&Qe!==27&&Qe!==6)&&(Fe=null)):(ve=null,Fe=ge),ve!==Fe)){if(Qe=kc,Te="onMouseLeave",ue="onMouseEnter",le="mouse",(s==="pointerout"||s==="pointerover")&&(Qe=Ws,Te="onPointerLeave",ue="onPointerEnter",le="pointer"),Nt=ve==null?_e:yr(ve),pe=Fe==null?_e:yr(Fe),_e=new Qe(Te,le+"leave",ve,c,Ce),_e.target=Nt,_e.relatedTarget=pe,Te=null,vs(Ce)===ge&&(Qe=new Qe(ue,le+"enter",Fe,c,Ce),Qe.target=pe,Qe.relatedTarget=Nt,Te=Qe),Nt=Te,ve&&Fe)t:{for(Qe=n2,ue=ve,le=Fe,pe=0,Te=ue;Te;Te=Qe(Te))pe++;Te=0;for(var He=le;He;He=Qe(He))Te++;for(;0<pe-Te;)ue=Qe(ue),pe--;for(;0<Te-pe;)le=Qe(le),Te--;for(;pe--;){if(ue===le||le!==null&&ue===le.alternate){Qe=ue;break t}ue=Qe(ue),le=Qe(le)}Qe=null}else Qe=null;ve!==null&&Fv(Re,_e,ve,Qe,!1),Fe!==null&&Nt!==null&&Fv(Re,Nt,Fe,Qe,!0)}}e:{if(_e=ge?yr(ge):window,ve=_e.nodeName&&_e.nodeName.toLowerCase(),ve==="select"||ve==="input"&&_e.type==="file")var wt=s_;else if(n_(_e))if(i_)wt=fA;else{wt=dA;var $e=uA}else ve=_e.nodeName,!ve||ve.toLowerCase()!=="input"||_e.type!=="checkbox"&&_e.type!=="radio"?ge&&qo(ge.elementType)&&(wt=s_):wt=hA;if(wt&&(wt=wt(s,ge))){r_(Re,wt,c,Ce);break e}$e&&$e(s,_e,ge),s==="focusout"&&ge&&_e.type==="number"&&ge.memoizedProps.value!=null&&Ec(_e,"number",_e.value)}switch($e=ge?yr(ge):window,s){case"focusin":(n_($e)||$e.contentEditable==="true")&&(Zo=$e,Rm=ge,Pc=null);break;case"focusout":Pc=Rm=Zo=null;break;case"mousedown":Im=!0;break;case"contextmenu":case"mouseup":case"dragend":Im=!1,f_(Re,c,Ce);break;case"selectionchange":if(pA)break;case"keydown":case"keyup":f_(Re,c,Ce)}var it;if(Ct)e:{switch(s){case"compositionstart":var dt="onCompositionStart";break e;case"compositionend":dt="onCompositionEnd";break e;case"compositionupdate":dt="onCompositionUpdate";break e}dt=void 0}else Xo?Xa(s,c)&&(dt="onCompositionEnd"):s==="keydown"&&c.keyCode===229&&(dt="onCompositionStart");dt&&(Is&&c.locale!=="ko"&&(Xo||dt!=="onCompositionStart"?dt==="onCompositionEnd"&&Xo&&(it=Rc()):(Ts=Ce,jc="value"in Ts?Ts.value:Ts.textContent,Xo=!0)),$e=_h(ge,dt),0<$e.length&&(dt=new Rs(dt,s,null,c,Ce),Re.push({event:dt,listeners:$e}),it?dt.data=it:(it=Yo(c),it!==null&&(dt.data=it)))),(it=Mr?aA(s,c):oA(s,c))&&(dt=_h(ge,"onBeforeInput"),0<dt.length&&($e=new Rs("onBeforeInput","beforeinput",null,c,Ce),Re.push({event:$e,listeners:dt}),$e.data=it)),ZA(Re,s,ge,c,Ce)}Lv(Re,a)})}function ou(s,a,c){return{instance:s,listener:a,currentTarget:c}}function _h(s,a){for(var c=a+"Capture",f=[];s!==null;){var _=s,w=_.stateNode;if(_=_.tag,_!==5&&_!==26&&_!==27||w===null||(_=Xr(s,c),_!=null&&f.unshift(ou(s,_,w)),_=Xr(s,a),_!=null&&f.push(ou(s,_,w))),s.tag===3)return f;s=s.return}return[]}function n2(s){if(s===null)return null;do s=s.return;while(s&&s.tag!==5&&s.tag!==27);return s||null}function Fv(s,a,c,f,_){for(var w=a._reactName,P=[];c!==null&&c!==f;){var Q=c,ne=Q.alternate,ge=Q.stateNode;if(Q=Q.tag,ne!==null&&ne===f)break;Q!==5&&Q!==26&&Q!==27||ge===null||(ne=ge,_?(ge=Xr(c,w),ge!=null&&P.unshift(ou(c,ge,ne))):_||(ge=Xr(c,w),ge!=null&&P.push(ou(c,ge,ne)))),c=c.return}P.length!==0&&s.push({event:a,listeners:P})}var r2=/\r\n?/g,s2=/\u0000|\uFFFD/g;function Vv(s){return(typeof s=="string"?s:""+s).replace(r2,`
`).replace(s2,"")}function $v(s,a){return a=Vv(a),Vv(s)===a}function Ot(s,a,c,f,_,w){switch(c){case"children":typeof f=="string"?a==="body"||a==="textarea"&&f===""||ar(s,f):(typeof f=="number"||typeof f=="bigint")&&a!=="body"&&ar(s,""+f);break;case"className":_r(s,"class",f);break;case"tabIndex":_r(s,"tabindex",f);break;case"dir":case"role":case"viewBox":case"width":case"height":_r(s,c,f);break;case"style":Tc(s,f,w);break;case"data":if(a!=="object"){_r(s,"data",f);break}case"src":case"href":if(f===""&&(a!=="a"||c!=="href")){s.removeAttribute(c);break}if(f==null||typeof f=="function"||typeof f=="symbol"||typeof f=="boolean"){s.removeAttribute(c);break}f=Ho(""+f),s.setAttribute(c,f);break;case"action":case"formAction":if(typeof f=="function"){s.setAttribute(c,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof w=="function"&&(c==="formAction"?(a!=="input"&&Ot(s,a,"name",_.name,_,null),Ot(s,a,"formEncType",_.formEncType,_,null),Ot(s,a,"formMethod",_.formMethod,_,null),Ot(s,a,"formTarget",_.formTarget,_,null)):(Ot(s,a,"encType",_.encType,_,null),Ot(s,a,"method",_.method,_,null),Ot(s,a,"target",_.target,_,null)));if(f==null||typeof f=="symbol"||typeof f=="boolean"){s.removeAttribute(c);break}f=Ho(""+f),s.setAttribute(c,f);break;case"onClick":f!=null&&(s.onclick=Yr);break;case"onScroll":f!=null&&lt("scroll",s);break;case"onScrollEnd":f!=null&&lt("scrollend",s);break;case"dangerouslySetInnerHTML":if(f!=null){if(typeof f!="object"||!("__html"in f))throw Error(r(61));if(c=f.__html,c!=null){if(_.children!=null)throw Error(r(60));s.innerHTML=c}}break;case"multiple":s.multiple=f&&typeof f!="function"&&typeof f!="symbol";break;case"muted":s.muted=f&&typeof f!="function"&&typeof f!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(f==null||typeof f=="function"||typeof f=="boolean"||typeof f=="symbol"){s.removeAttribute("xlink:href");break}c=Ho(""+f),s.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",c);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":f!=null&&typeof f!="function"&&typeof f!="symbol"?s.setAttribute(c,""+f):s.removeAttribute(c);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":f&&typeof f!="function"&&typeof f!="symbol"?s.setAttribute(c,""):s.removeAttribute(c);break;case"capture":case"download":f===!0?s.setAttribute(c,""):f!==!1&&f!=null&&typeof f!="function"&&typeof f!="symbol"?s.setAttribute(c,f):s.removeAttribute(c);break;case"cols":case"rows":case"size":case"span":f!=null&&typeof f!="function"&&typeof f!="symbol"&&!isNaN(f)&&1<=f?s.setAttribute(c,f):s.removeAttribute(c);break;case"rowSpan":case"start":f==null||typeof f=="function"||typeof f=="symbol"||isNaN(f)?s.removeAttribute(c):s.setAttribute(c,f);break;case"popover":lt("beforetoggle",s),lt("toggle",s),Vo(s,"popover",f);break;case"xlinkActuate":hn(s,"http://www.w3.org/1999/xlink","xlink:actuate",f);break;case"xlinkArcrole":hn(s,"http://www.w3.org/1999/xlink","xlink:arcrole",f);break;case"xlinkRole":hn(s,"http://www.w3.org/1999/xlink","xlink:role",f);break;case"xlinkShow":hn(s,"http://www.w3.org/1999/xlink","xlink:show",f);break;case"xlinkTitle":hn(s,"http://www.w3.org/1999/xlink","xlink:title",f);break;case"xlinkType":hn(s,"http://www.w3.org/1999/xlink","xlink:type",f);break;case"xmlBase":hn(s,"http://www.w3.org/XML/1998/namespace","xml:base",f);break;case"xmlLang":hn(s,"http://www.w3.org/XML/1998/namespace","xml:lang",f);break;case"xmlSpace":hn(s,"http://www.w3.org/XML/1998/namespace","xml:space",f);break;case"is":Vo(s,"is",f);break;case"innerText":case"textContent":break;default:(!(2<c.length)||c[0]!=="o"&&c[0]!=="O"||c[1]!=="n"&&c[1]!=="N")&&(c=_d.get(c)||c,Vo(s,c,f))}}function tg(s,a,c,f,_,w){switch(c){case"style":Tc(s,f,w);break;case"dangerouslySetInnerHTML":if(f!=null){if(typeof f!="object"||!("__html"in f))throw Error(r(61));if(c=f.__html,c!=null){if(_.children!=null)throw Error(r(60));s.innerHTML=c}}break;case"children":typeof f=="string"?ar(s,f):(typeof f=="number"||typeof f=="bigint")&&ar(s,""+f);break;case"onScroll":f!=null&&lt("scroll",s);break;case"onScrollEnd":f!=null&&lt("scrollend",s);break;case"onClick":f!=null&&(s.onclick=Yr);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!bc.hasOwnProperty(c))e:{if(c[0]==="o"&&c[1]==="n"&&(_=c.endsWith("Capture"),a=c.slice(2,_?c.length-7:void 0),w=s[jn]||null,w=w!=null?w[c]:null,typeof w=="function"&&s.removeEventListener(a,w,_),typeof f=="function")){typeof w!="function"&&w!==null&&(c in s?s[c]=null:s.hasAttribute(c)&&s.removeAttribute(c)),s.addEventListener(a,f,_);break e}c in s?s[c]=f:f===!0?s.setAttribute(c,""):Vo(s,c,f)}}}function Ln(s,a,c){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":lt("error",s),lt("load",s);var f=!1,_=!1,w;for(w in c)if(c.hasOwnProperty(w)){var P=c[w];if(P!=null)switch(w){case"src":f=!0;break;case"srcSet":_=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(r(137,a));default:Ot(s,a,w,P,c,null)}}_&&Ot(s,a,"srcSet",c.srcSet,c,null),f&&Ot(s,a,"src",c.src,c,null);return;case"input":lt("invalid",s);var Q=w=P=_=null,ne=null,ge=null;for(f in c)if(c.hasOwnProperty(f)){var Ce=c[f];if(Ce!=null)switch(f){case"name":_=Ce;break;case"type":P=Ce;break;case"checked":ne=Ce;break;case"defaultChecked":ge=Ce;break;case"value":w=Ce;break;case"defaultValue":Q=Ce;break;case"children":case"dangerouslySetInnerHTML":if(Ce!=null)throw Error(r(137,a));break;default:Ot(s,a,f,Ce,c,null)}}pd(s,w,Q,ne,ge,P,_,!1);return;case"select":lt("invalid",s),f=P=w=null;for(_ in c)if(c.hasOwnProperty(_)&&(Q=c[_],Q!=null))switch(_){case"value":w=Q;break;case"defaultValue":P=Q;break;case"multiple":f=Q;default:Ot(s,a,_,Q,c,null)}a=w,c=P,s.multiple=!!f,a!=null?ji(s,!!f,a,!1):c!=null&&ji(s,!!f,c,!0);return;case"textarea":lt("invalid",s),w=_=f=null;for(P in c)if(c.hasOwnProperty(P)&&(Q=c[P],Q!=null))switch(P){case"value":f=Q;break;case"defaultValue":_=Q;break;case"children":w=Q;break;case"dangerouslySetInnerHTML":if(Q!=null)throw Error(r(91));break;default:Ot(s,a,P,Q,c,null)}Ri(s,f,_,w);return;case"option":for(ne in c)c.hasOwnProperty(ne)&&(f=c[ne],f!=null)&&(ne==="selected"?s.selected=f&&typeof f!="function"&&typeof f!="symbol":Ot(s,a,ne,f,c,null));return;case"dialog":lt("beforetoggle",s),lt("toggle",s),lt("cancel",s),lt("close",s);break;case"iframe":case"object":lt("load",s);break;case"video":case"audio":for(f=0;f<au.length;f++)lt(au[f],s);break;case"image":lt("error",s),lt("load",s);break;case"details":lt("toggle",s);break;case"embed":case"source":case"link":lt("error",s),lt("load",s);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(ge in c)if(c.hasOwnProperty(ge)&&(f=c[ge],f!=null))switch(ge){case"children":case"dangerouslySetInnerHTML":throw Error(r(137,a));default:Ot(s,a,ge,f,c,null)}return;default:if(qo(a)){for(Ce in c)c.hasOwnProperty(Ce)&&(f=c[Ce],f!==void 0&&tg(s,a,Ce,f,c,void 0));return}}for(Q in c)c.hasOwnProperty(Q)&&(f=c[Q],f!=null&&Ot(s,a,Q,f,c,null))}function i2(s,a,c,f){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var _=null,w=null,P=null,Q=null,ne=null,ge=null,Ce=null;for(ve in c){var Re=c[ve];if(c.hasOwnProperty(ve)&&Re!=null)switch(ve){case"checked":break;case"value":break;case"defaultValue":ne=Re;default:f.hasOwnProperty(ve)||Ot(s,a,ve,null,f,Re)}}for(var _e in f){var ve=f[_e];if(Re=c[_e],f.hasOwnProperty(_e)&&(ve!=null||Re!=null))switch(_e){case"type":w=ve;break;case"name":_=ve;break;case"checked":ge=ve;break;case"defaultChecked":Ce=ve;break;case"value":P=ve;break;case"defaultValue":Q=ve;break;case"children":case"dangerouslySetInnerHTML":if(ve!=null)throw Error(r(137,a));break;default:ve!==Re&&Ot(s,a,_e,ve,f,Re)}}$o(s,P,Q,ne,ge,Ce,w,_);return;case"select":ve=P=Q=_e=null;for(w in c)if(ne=c[w],c.hasOwnProperty(w)&&ne!=null)switch(w){case"value":break;case"multiple":ve=ne;default:f.hasOwnProperty(w)||Ot(s,a,w,null,f,ne)}for(_ in f)if(w=f[_],ne=c[_],f.hasOwnProperty(_)&&(w!=null||ne!=null))switch(_){case"value":_e=w;break;case"defaultValue":Q=w;break;case"multiple":P=w;default:w!==ne&&Ot(s,a,_,w,f,ne)}a=Q,c=P,f=ve,_e!=null?ji(s,!!c,_e,!1):!!f!=!!c&&(a!=null?ji(s,!!c,a,!0):ji(s,!!c,c?[]:"",!1));return;case"textarea":ve=_e=null;for(Q in c)if(_=c[Q],c.hasOwnProperty(Q)&&_!=null&&!f.hasOwnProperty(Q))switch(Q){case"value":break;case"children":break;default:Ot(s,a,Q,null,f,_)}for(P in f)if(_=f[P],w=c[P],f.hasOwnProperty(P)&&(_!=null||w!=null))switch(P){case"value":_e=_;break;case"defaultValue":ve=_;break;case"children":break;case"dangerouslySetInnerHTML":if(_!=null)throw Error(r(91));break;default:_!==w&&Ot(s,a,P,_,f,w)}gd(s,_e,ve);return;case"option":for(var Fe in c)_e=c[Fe],c.hasOwnProperty(Fe)&&_e!=null&&!f.hasOwnProperty(Fe)&&(Fe==="selected"?s.selected=!1:Ot(s,a,Fe,null,f,_e));for(ne in f)_e=f[ne],ve=c[ne],f.hasOwnProperty(ne)&&_e!==ve&&(_e!=null||ve!=null)&&(ne==="selected"?s.selected=_e&&typeof _e!="function"&&typeof _e!="symbol":Ot(s,a,ne,_e,f,ve));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Qe in c)_e=c[Qe],c.hasOwnProperty(Qe)&&_e!=null&&!f.hasOwnProperty(Qe)&&Ot(s,a,Qe,null,f,_e);for(ge in f)if(_e=f[ge],ve=c[ge],f.hasOwnProperty(ge)&&_e!==ve&&(_e!=null||ve!=null))switch(ge){case"children":case"dangerouslySetInnerHTML":if(_e!=null)throw Error(r(137,a));break;default:Ot(s,a,ge,_e,f,ve)}return;default:if(qo(a)){for(var Nt in c)_e=c[Nt],c.hasOwnProperty(Nt)&&_e!==void 0&&!f.hasOwnProperty(Nt)&&tg(s,a,Nt,void 0,f,_e);for(Ce in f)_e=f[Ce],ve=c[Ce],!f.hasOwnProperty(Ce)||_e===ve||_e===void 0&&ve===void 0||tg(s,a,Ce,_e,f,ve);return}}for(var ue in c)_e=c[ue],c.hasOwnProperty(ue)&&_e!=null&&!f.hasOwnProperty(ue)&&Ot(s,a,ue,null,f,_e);for(Re in f)_e=f[Re],ve=c[Re],!f.hasOwnProperty(Re)||_e===ve||_e==null&&ve==null||Ot(s,a,Re,_e,f,ve)}function qv(s){switch(s){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function a2(){if(typeof performance.getEntriesByType=="function"){for(var s=0,a=0,c=performance.getEntriesByType("resource"),f=0;f<c.length;f++){var _=c[f],w=_.transferSize,P=_.initiatorType,Q=_.duration;if(w&&Q&&qv(P)){for(P=0,Q=_.responseEnd,f+=1;f<c.length;f++){var ne=c[f],ge=ne.startTime;if(ge>Q)break;var Ce=ne.transferSize,Re=ne.initiatorType;Ce&&qv(Re)&&(ne=ne.responseEnd,P+=Ce*(ne<Q?1:(Q-ge)/(ne-ge)))}if(--f,a+=8*(w+P)/(_.duration/1e3),s++,10<s)break}}if(0<s)return a/s/1e6}return navigator.connection&&(s=navigator.connection.downlink,typeof s=="number")?s:5}var ng=null,rg=null;function bh(s){return s.nodeType===9?s:s.ownerDocument}function Hv(s){switch(s){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Gv(s,a){if(s===0)switch(a){case"svg":return 1;case"math":return 2;default:return 0}return s===1&&a==="foreignObject"?0:s}function sg(s,a){return s==="textarea"||s==="noscript"||typeof a.children=="string"||typeof a.children=="number"||typeof a.children=="bigint"||typeof a.dangerouslySetInnerHTML=="object"&&a.dangerouslySetInnerHTML!==null&&a.dangerouslySetInnerHTML.__html!=null}var ig=null;function o2(){var s=window.event;return s&&s.type==="popstate"?s===ig?!1:(ig=s,!0):(ig=null,!1)}var Qv=typeof setTimeout=="function"?setTimeout:void 0,l2=typeof clearTimeout=="function"?clearTimeout:void 0,Wv=typeof Promise=="function"?Promise:void 0,c2=typeof queueMicrotask=="function"?queueMicrotask:typeof Wv<"u"?function(s){return Wv.resolve(null).then(s).catch(u2)}:Qv;function u2(s){setTimeout(function(){throw s})}function Zi(s){return s==="head"}function Kv(s,a){var c=a,f=0;do{var _=c.nextSibling;if(s.removeChild(c),_&&_.nodeType===8)if(c=_.data,c==="/$"||c==="/&"){if(f===0){s.removeChild(_),Cl(a);return}f--}else if(c==="$"||c==="$?"||c==="$~"||c==="$!"||c==="&")f++;else if(c==="html")lu(s.ownerDocument.documentElement);else if(c==="head"){c=s.ownerDocument.head,lu(c);for(var w=c.firstChild;w;){var P=w.nextSibling,Q=w.nodeName;w[bs]||Q==="SCRIPT"||Q==="STYLE"||Q==="LINK"&&w.rel.toLowerCase()==="stylesheet"||c.removeChild(w),w=P}}else c==="body"&&lu(s.ownerDocument.body);c=_}while(c);Cl(a)}function Yv(s,a){var c=s;s=0;do{var f=c.nextSibling;if(c.nodeType===1?a?(c._stashedDisplay=c.style.display,c.style.display="none"):(c.style.display=c._stashedDisplay||"",c.getAttribute("style")===""&&c.removeAttribute("style")):c.nodeType===3&&(a?(c._stashedText=c.nodeValue,c.nodeValue=""):c.nodeValue=c._stashedText||""),f&&f.nodeType===8)if(c=f.data,c==="/$"){if(s===0)break;s--}else c!=="$"&&c!=="$?"&&c!=="$~"&&c!=="$!"||s++;c=f}while(c)}function ag(s){var a=s.firstChild;for(a&&a.nodeType===10&&(a=a.nextSibling);a;){var c=a;switch(a=a.nextSibling,c.nodeName){case"HTML":case"HEAD":case"BODY":ag(c),Fo(c);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(c.rel.toLowerCase()==="stylesheet")continue}s.removeChild(c)}}function d2(s,a,c,f){for(;s.nodeType===1;){var _=c;if(s.nodeName.toLowerCase()!==a.toLowerCase()){if(!f&&(s.nodeName!=="INPUT"||s.type!=="hidden"))break}else if(f){if(!s[bs])switch(a){case"meta":if(!s.hasAttribute("itemprop"))break;return s;case"link":if(w=s.getAttribute("rel"),w==="stylesheet"&&s.hasAttribute("data-precedence"))break;if(w!==_.rel||s.getAttribute("href")!==(_.href==null||_.href===""?null:_.href)||s.getAttribute("crossorigin")!==(_.crossOrigin==null?null:_.crossOrigin)||s.getAttribute("title")!==(_.title==null?null:_.title))break;return s;case"style":if(s.hasAttribute("data-precedence"))break;return s;case"script":if(w=s.getAttribute("src"),(w!==(_.src==null?null:_.src)||s.getAttribute("type")!==(_.type==null?null:_.type)||s.getAttribute("crossorigin")!==(_.crossOrigin==null?null:_.crossOrigin))&&w&&s.hasAttribute("async")&&!s.hasAttribute("itemprop"))break;return s;default:return s}}else if(a==="input"&&s.type==="hidden"){var w=_.name==null?null:""+_.name;if(_.type==="hidden"&&s.getAttribute("name")===w)return s}else return s;if(s=Ur(s.nextSibling),s===null)break}return null}function h2(s,a,c){if(a==="")return null;for(;s.nodeType!==3;)if((s.nodeType!==1||s.nodeName!=="INPUT"||s.type!=="hidden")&&!c||(s=Ur(s.nextSibling),s===null))return null;return s}function Xv(s,a){for(;s.nodeType!==8;)if((s.nodeType!==1||s.nodeName!=="INPUT"||s.type!=="hidden")&&!a||(s=Ur(s.nextSibling),s===null))return null;return s}function og(s){return s.data==="$?"||s.data==="$~"}function lg(s){return s.data==="$!"||s.data==="$?"&&s.ownerDocument.readyState!=="loading"}function f2(s,a){var c=s.ownerDocument;if(s.data==="$~")s._reactRetry=a;else if(s.data!=="$?"||c.readyState!=="loading")a();else{var f=function(){a(),c.removeEventListener("DOMContentLoaded",f)};c.addEventListener("DOMContentLoaded",f),s._reactRetry=f}}function Ur(s){for(;s!=null;s=s.nextSibling){var a=s.nodeType;if(a===1||a===3)break;if(a===8){if(a=s.data,a==="$"||a==="$!"||a==="$?"||a==="$~"||a==="&"||a==="F!"||a==="F")break;if(a==="/$"||a==="/&")return null}}return s}var cg=null;function Zv(s){s=s.nextSibling;for(var a=0;s;){if(s.nodeType===8){var c=s.data;if(c==="/$"||c==="/&"){if(a===0)return Ur(s.nextSibling);a--}else c!=="$"&&c!=="$!"&&c!=="$?"&&c!=="$~"&&c!=="&"||a++}s=s.nextSibling}return null}function Jv(s){s=s.previousSibling;for(var a=0;s;){if(s.nodeType===8){var c=s.data;if(c==="$"||c==="$!"||c==="$?"||c==="$~"||c==="&"){if(a===0)return s;a--}else c!=="/$"&&c!=="/&"||a++}s=s.previousSibling}return null}function ex(s,a,c){switch(a=bh(c),s){case"html":if(s=a.documentElement,!s)throw Error(r(452));return s;case"head":if(s=a.head,!s)throw Error(r(453));return s;case"body":if(s=a.body,!s)throw Error(r(454));return s;default:throw Error(r(451))}}function lu(s){for(var a=s.attributes;a.length;)s.removeAttributeNode(a[0]);Fo(s)}var Fr=new Map,tx=new Set;function vh(s){return typeof s.getRootNode=="function"?s.getRootNode():s.nodeType===9?s:s.ownerDocument}var ci=q.d;q.d={f:m2,r:p2,D:g2,C:y2,L:_2,m:b2,X:x2,S:v2,M:w2};function m2(){var s=ci.f(),a=dh();return s||a}function p2(s){var a=Ir(s);a!==null&&a.tag===5&&a.type==="form"?_b(a):ci.r(s)}var wl=typeof document>"u"?null:document;function nx(s,a,c){var f=wl;if(f&&typeof a=="string"&&a){var _=ir(a);_='link[rel="'+s+'"][href="'+_+'"]',typeof c=="string"&&(_+='[crossorigin="'+c+'"]'),tx.has(_)||(tx.add(_),s={rel:s,crossOrigin:c,href:a},f.querySelector(_)===null&&(a=f.createElement("link"),Ln(a,"link",s),dn(a),f.head.appendChild(a)))}}function g2(s){ci.D(s),nx("dns-prefetch",s,null)}function y2(s,a){ci.C(s,a),nx("preconnect",s,a)}function _2(s,a,c){ci.L(s,a,c);var f=wl;if(f&&s&&a){var _='link[rel="preload"][as="'+ir(a)+'"]';a==="image"&&c&&c.imageSrcSet?(_+='[imagesrcset="'+ir(c.imageSrcSet)+'"]',typeof c.imageSizes=="string"&&(_+='[imagesizes="'+ir(c.imageSizes)+'"]')):_+='[href="'+ir(s)+'"]';var w=_;switch(a){case"style":w=Sl(s);break;case"script":w=El(s)}Fr.has(w)||(s=g({rel:"preload",href:a==="image"&&c&&c.imageSrcSet?void 0:s,as:a},c),Fr.set(w,s),f.querySelector(_)!==null||a==="style"&&f.querySelector(cu(w))||a==="script"&&f.querySelector(uu(w))||(a=f.createElement("link"),Ln(a,"link",s),dn(a),f.head.appendChild(a)))}}function b2(s,a){ci.m(s,a);var c=wl;if(c&&s){var f=a&&typeof a.as=="string"?a.as:"script",_='link[rel="modulepreload"][as="'+ir(f)+'"][href="'+ir(s)+'"]',w=_;switch(f){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":w=El(s)}if(!Fr.has(w)&&(s=g({rel:"modulepreload",href:s},a),Fr.set(w,s),c.querySelector(_)===null)){switch(f){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(c.querySelector(uu(w)))return}f=c.createElement("link"),Ln(f,"link",s),dn(f),c.head.appendChild(f)}}}function v2(s,a,c){ci.S(s,a,c);var f=wl;if(f&&s){var _=xs(f).hoistableStyles,w=Sl(s);a=a||"default";var P=_.get(w);if(!P){var Q={loading:0,preload:null};if(P=f.querySelector(cu(w)))Q.loading=5;else{s=g({rel:"stylesheet",href:s,"data-precedence":a},c),(c=Fr.get(w))&&ug(s,c);var ne=P=f.createElement("link");dn(ne),Ln(ne,"link",s),ne._p=new Promise(function(ge,Ce){ne.onload=ge,ne.onerror=Ce}),ne.addEventListener("load",function(){Q.loading|=1}),ne.addEventListener("error",function(){Q.loading|=2}),Q.loading|=4,xh(P,a,f)}P={type:"stylesheet",instance:P,count:1,state:Q},_.set(w,P)}}}function x2(s,a){ci.X(s,a);var c=wl;if(c&&s){var f=xs(c).hoistableScripts,_=El(s),w=f.get(_);w||(w=c.querySelector(uu(_)),w||(s=g({src:s,async:!0},a),(a=Fr.get(_))&&dg(s,a),w=c.createElement("script"),dn(w),Ln(w,"link",s),c.head.appendChild(w)),w={type:"script",instance:w,count:1,state:null},f.set(_,w))}}function w2(s,a){ci.M(s,a);var c=wl;if(c&&s){var f=xs(c).hoistableScripts,_=El(s),w=f.get(_);w||(w=c.querySelector(uu(_)),w||(s=g({src:s,async:!0,type:"module"},a),(a=Fr.get(_))&&dg(s,a),w=c.createElement("script"),dn(w),Ln(w,"link",s),c.head.appendChild(w)),w={type:"script",instance:w,count:1,state:null},f.set(_,w))}}function rx(s,a,c,f){var _=(_=ce.current)?vh(_):null;if(!_)throw Error(r(446));switch(s){case"meta":case"title":return null;case"style":return typeof c.precedence=="string"&&typeof c.href=="string"?(a=Sl(c.href),c=xs(_).hoistableStyles,f=c.get(a),f||(f={type:"style",instance:null,count:0,state:null},c.set(a,f)),f):{type:"void",instance:null,count:0,state:null};case"link":if(c.rel==="stylesheet"&&typeof c.href=="string"&&typeof c.precedence=="string"){s=Sl(c.href);var w=xs(_).hoistableStyles,P=w.get(s);if(P||(_=_.ownerDocument||_,P={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},w.set(s,P),(w=_.querySelector(cu(s)))&&!w._p&&(P.instance=w,P.state.loading=5),Fr.has(s)||(c={rel:"preload",as:"style",href:c.href,crossOrigin:c.crossOrigin,integrity:c.integrity,media:c.media,hrefLang:c.hrefLang,referrerPolicy:c.referrerPolicy},Fr.set(s,c),w||S2(_,s,c,P.state))),a&&f===null)throw Error(r(528,""));return P}if(a&&f!==null)throw Error(r(529,""));return null;case"script":return a=c.async,c=c.src,typeof c=="string"&&a&&typeof a!="function"&&typeof a!="symbol"?(a=El(c),c=xs(_).hoistableScripts,f=c.get(a),f||(f={type:"script",instance:null,count:0,state:null},c.set(a,f)),f):{type:"void",instance:null,count:0,state:null};default:throw Error(r(444,s))}}function Sl(s){return'href="'+ir(s)+'"'}function cu(s){return'link[rel="stylesheet"]['+s+"]"}function sx(s){return g({},s,{"data-precedence":s.precedence,precedence:null})}function S2(s,a,c,f){s.querySelector('link[rel="preload"][as="style"]['+a+"]")?f.loading=1:(a=s.createElement("link"),f.preload=a,a.addEventListener("load",function(){return f.loading|=1}),a.addEventListener("error",function(){return f.loading|=2}),Ln(a,"link",c),dn(a),s.head.appendChild(a))}function El(s){return'[src="'+ir(s)+'"]'}function uu(s){return"script[async]"+s}function ix(s,a,c){if(a.count++,a.instance===null)switch(a.type){case"style":var f=s.querySelector('style[data-href~="'+ir(c.href)+'"]');if(f)return a.instance=f,dn(f),f;var _=g({},c,{"data-href":c.href,"data-precedence":c.precedence,href:null,precedence:null});return f=(s.ownerDocument||s).createElement("style"),dn(f),Ln(f,"style",_),xh(f,c.precedence,s),a.instance=f;case"stylesheet":_=Sl(c.href);var w=s.querySelector(cu(_));if(w)return a.state.loading|=4,a.instance=w,dn(w),w;f=sx(c),(_=Fr.get(_))&&ug(f,_),w=(s.ownerDocument||s).createElement("link"),dn(w);var P=w;return P._p=new Promise(function(Q,ne){P.onload=Q,P.onerror=ne}),Ln(w,"link",f),a.state.loading|=4,xh(w,c.precedence,s),a.instance=w;case"script":return w=El(c.src),(_=s.querySelector(uu(w)))?(a.instance=_,dn(_),_):(f=c,(_=Fr.get(w))&&(f=g({},c),dg(f,_)),s=s.ownerDocument||s,_=s.createElement("script"),dn(_),Ln(_,"link",f),s.head.appendChild(_),a.instance=_);case"void":return null;default:throw Error(r(443,a.type))}else a.type==="stylesheet"&&(a.state.loading&4)===0&&(f=a.instance,a.state.loading|=4,xh(f,c.precedence,s));return a.instance}function xh(s,a,c){for(var f=c.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),_=f.length?f[f.length-1]:null,w=_,P=0;P<f.length;P++){var Q=f[P];if(Q.dataset.precedence===a)w=Q;else if(w!==_)break}w?w.parentNode.insertBefore(s,w.nextSibling):(a=c.nodeType===9?c.head:c,a.insertBefore(s,a.firstChild))}function ug(s,a){s.crossOrigin==null&&(s.crossOrigin=a.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=a.referrerPolicy),s.title==null&&(s.title=a.title)}function dg(s,a){s.crossOrigin==null&&(s.crossOrigin=a.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=a.referrerPolicy),s.integrity==null&&(s.integrity=a.integrity)}var wh=null;function ax(s,a,c){if(wh===null){var f=new Map,_=wh=new Map;_.set(c,f)}else _=wh,f=_.get(c),f||(f=new Map,_.set(c,f));if(f.has(s))return f;for(f.set(s,null),c=c.getElementsByTagName(s),_=0;_<c.length;_++){var w=c[_];if(!(w[bs]||w[un]||s==="link"&&w.getAttribute("rel")==="stylesheet")&&w.namespaceURI!=="http://www.w3.org/2000/svg"){var P=w.getAttribute(a)||"";P=s+P;var Q=f.get(P);Q?Q.push(w):f.set(P,[w])}}return f}function ox(s,a,c){s=s.ownerDocument||s,s.head.insertBefore(c,a==="title"?s.querySelector("head > title"):null)}function E2(s,a,c){if(c===1||a.itemProp!=null)return!1;switch(s){case"meta":case"title":return!0;case"style":if(typeof a.precedence!="string"||typeof a.href!="string"||a.href==="")break;return!0;case"link":if(typeof a.rel!="string"||typeof a.href!="string"||a.href===""||a.onLoad||a.onError)break;return a.rel==="stylesheet"?(s=a.disabled,typeof a.precedence=="string"&&s==null):!0;case"script":if(a.async&&typeof a.async!="function"&&typeof a.async!="symbol"&&!a.onLoad&&!a.onError&&a.src&&typeof a.src=="string")return!0}return!1}function lx(s){return!(s.type==="stylesheet"&&(s.state.loading&3)===0)}function C2(s,a,c,f){if(c.type==="stylesheet"&&(typeof f.media!="string"||matchMedia(f.media).matches!==!1)&&(c.state.loading&4)===0){if(c.instance===null){var _=Sl(f.href),w=a.querySelector(cu(_));if(w){a=w._p,a!==null&&typeof a=="object"&&typeof a.then=="function"&&(s.count++,s=Sh.bind(s),a.then(s,s)),c.state.loading|=4,c.instance=w,dn(w);return}w=a.ownerDocument||a,f=sx(f),(_=Fr.get(_))&&ug(f,_),w=w.createElement("link"),dn(w);var P=w;P._p=new Promise(function(Q,ne){P.onload=Q,P.onerror=ne}),Ln(w,"link",f),c.instance=w}s.stylesheets===null&&(s.stylesheets=new Map),s.stylesheets.set(c,a),(a=c.state.preload)&&(c.state.loading&3)===0&&(s.count++,c=Sh.bind(s),a.addEventListener("load",c),a.addEventListener("error",c))}}var hg=0;function T2(s,a){return s.stylesheets&&s.count===0&&Ch(s,s.stylesheets),0<s.count||0<s.imgCount?function(c){var f=setTimeout(function(){if(s.stylesheets&&Ch(s,s.stylesheets),s.unsuspend){var w=s.unsuspend;s.unsuspend=null,w()}},6e4+a);0<s.imgBytes&&hg===0&&(hg=62500*a2());var _=setTimeout(function(){if(s.waitingForImages=!1,s.count===0&&(s.stylesheets&&Ch(s,s.stylesheets),s.unsuspend)){var w=s.unsuspend;s.unsuspend=null,w()}},(s.imgBytes>hg?50:800)+a);return s.unsuspend=c,function(){s.unsuspend=null,clearTimeout(f),clearTimeout(_)}}:null}function Sh(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)Ch(this,this.stylesheets);else if(this.unsuspend){var s=this.unsuspend;this.unsuspend=null,s()}}}var Eh=null;function Ch(s,a){s.stylesheets=null,s.unsuspend!==null&&(s.count++,Eh=new Map,a.forEach(A2,s),Eh=null,Sh.call(s))}function A2(s,a){if(!(a.state.loading&4)){var c=Eh.get(s);if(c)var f=c.get(null);else{c=new Map,Eh.set(s,c);for(var _=s.querySelectorAll("link[data-precedence],style[data-precedence]"),w=0;w<_.length;w++){var P=_[w];(P.nodeName==="LINK"||P.getAttribute("media")!=="not all")&&(c.set(P.dataset.precedence,P),f=P)}f&&c.set(null,f)}_=a.instance,P=_.getAttribute("data-precedence"),w=c.get(P)||f,w===f&&c.set(null,_),c.set(P,_),this.count++,f=Sh.bind(this),_.addEventListener("load",f),_.addEventListener("error",f),w?w.parentNode.insertBefore(_,w.nextSibling):(s=s.nodeType===9?s.head:s,s.insertBefore(_,s.firstChild)),a.state.loading|=4}}var du={$$typeof:I,Provider:null,Consumer:null,_currentValue:W,_currentValue2:W,_threadCount:0};function j2(s,a,c,f,_,w,P,Q,ne){this.tag=1,this.containerInfo=s,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=ys(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ys(0),this.hiddenUpdates=ys(null),this.identifierPrefix=f,this.onUncaughtError=_,this.onCaughtError=w,this.onRecoverableError=P,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=ne,this.incompleteTransitions=new Map}function cx(s,a,c,f,_,w,P,Q,ne,ge,Ce,Re){return s=new j2(s,a,c,P,ne,ge,Ce,Re,Q),a=1,w===!0&&(a|=24),w=vr(3,null,null,a),s.current=w,w.stateNode=s,a=Hm(),a.refCount++,s.pooledCache=a,a.refCount++,w.memoizedState={element:f,isDehydrated:c,cache:a},Km(w),s}function ux(s){return s?(s=tl,s):tl}function dx(s,a,c,f,_,w){_=ux(_),f.context===null?f.context=_:f.pendingContext=_,f=Fi(a),f.payload={element:c},w=w===void 0?null:w,w!==null&&(f.callback=w),c=Vi(s,f,a),c!==null&&(dr(c,s,a),$c(c,s,a))}function hx(s,a){if(s=s.memoizedState,s!==null&&s.dehydrated!==null){var c=s.retryLane;s.retryLane=c!==0&&c<a?c:a}}function fg(s,a){hx(s,a),(s=s.alternate)&&hx(s,a)}function fx(s){if(s.tag===13||s.tag===31){var a=eo(s,67108864);a!==null&&dr(a,s,67108864),fg(s,67108864)}}function mx(s){if(s.tag===13||s.tag===31){var a=Cr();a=Va(a);var c=eo(s,a);c!==null&&dr(c,s,a),fg(s,a)}}var Th=!0;function R2(s,a,c,f){var _=K.T;K.T=null;var w=q.p;try{q.p=2,mg(s,a,c,f)}finally{q.p=w,K.T=_}}function I2(s,a,c,f){var _=K.T;K.T=null;var w=q.p;try{q.p=8,mg(s,a,c,f)}finally{q.p=w,K.T=_}}function mg(s,a,c,f){if(Th){var _=pg(f);if(_===null)eg(s,a,f,Ah,c),gx(s,f);else if(D2(_,s,a,c,f))f.stopPropagation();else if(gx(s,f),a&4&&-1<k2.indexOf(s)){for(;_!==null;){var w=Ir(_);if(w!==null)switch(w.tag){case 3:if(w=w.stateNode,w.current.memoizedState.isDehydrated){var P=tr(w.pendingLanes);if(P!==0){var Q=w;for(Q.pendingLanes|=2,Q.entangledLanes|=2;P;){var ne=1<<31-Et(P);Q.entanglements[1]|=ne,P&=~ne}Os(w),(Tt&6)===0&&(ch=Oe()+500,iu(0))}}break;case 31:case 13:Q=eo(w,2),Q!==null&&dr(Q,w,2),dh(),fg(w,2)}if(w=pg(f),w===null&&eg(s,a,f,Ah,c),w===_)break;_=w}_!==null&&f.stopPropagation()}else eg(s,a,f,null,c)}}function pg(s){return s=kr(s),gg(s)}var Ah=null;function gg(s){if(Ah=null,s=vs(s),s!==null){var a=o(s);if(a===null)s=null;else{var c=a.tag;if(c===13){if(s=l(a),s!==null)return s;s=null}else if(c===31){if(s=d(a),s!==null)return s;s=null}else if(c===3){if(a.stateNode.current.memoizedState.isDehydrated)return a.tag===3?a.stateNode.containerInfo:null;s=null}else a!==s&&(s=null)}}return Ah=s,null}function px(s){switch(s){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(De()){case qe:return 2;case xt:return 8;case nt:case Qn:return 32;case fs:return 268435456;default:return 32}default:return 32}}var yg=!1,Ji=null,ea=null,ta=null,hu=new Map,fu=new Map,na=[],k2="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function gx(s,a){switch(s){case"focusin":case"focusout":Ji=null;break;case"dragenter":case"dragleave":ea=null;break;case"mouseover":case"mouseout":ta=null;break;case"pointerover":case"pointerout":hu.delete(a.pointerId);break;case"gotpointercapture":case"lostpointercapture":fu.delete(a.pointerId)}}function mu(s,a,c,f,_,w){return s===null||s.nativeEvent!==w?(s={blockedOn:a,domEventName:c,eventSystemFlags:f,nativeEvent:w,targetContainers:[_]},a!==null&&(a=Ir(a),a!==null&&fx(a)),s):(s.eventSystemFlags|=f,a=s.targetContainers,_!==null&&a.indexOf(_)===-1&&a.push(_),s)}function D2(s,a,c,f,_){switch(a){case"focusin":return Ji=mu(Ji,s,a,c,f,_),!0;case"dragenter":return ea=mu(ea,s,a,c,f,_),!0;case"mouseover":return ta=mu(ta,s,a,c,f,_),!0;case"pointerover":var w=_.pointerId;return hu.set(w,mu(hu.get(w)||null,s,a,c,f,_)),!0;case"gotpointercapture":return w=_.pointerId,fu.set(w,mu(fu.get(w)||null,s,a,c,f,_)),!0}return!1}function yx(s){var a=vs(s.target);if(a!==null){var c=o(a);if(c!==null){if(a=c.tag,a===13){if(a=l(c),a!==null){s.blockedOn=a,Wr(s.priority,function(){mx(c)});return}}else if(a===31){if(a=d(c),a!==null){s.blockedOn=a,Wr(s.priority,function(){mx(c)});return}}else if(a===3&&c.stateNode.current.memoizedState.isDehydrated){s.blockedOn=c.tag===3?c.stateNode.containerInfo:null;return}}}s.blockedOn=null}function jh(s){if(s.blockedOn!==null)return!1;for(var a=s.targetContainers;0<a.length;){var c=pg(s.nativeEvent);if(c===null){c=s.nativeEvent;var f=new c.constructor(c.type,c);Ac=f,c.target.dispatchEvent(f),Ac=null}else return a=Ir(c),a!==null&&fx(a),s.blockedOn=c,!1;a.shift()}return!0}function _x(s,a,c){jh(s)&&c.delete(a)}function M2(){yg=!1,Ji!==null&&jh(Ji)&&(Ji=null),ea!==null&&jh(ea)&&(ea=null),ta!==null&&jh(ta)&&(ta=null),hu.forEach(_x),fu.forEach(_x)}function Rh(s,a){s.blockedOn===a&&(s.blockedOn=null,yg||(yg=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,M2)))}var Ih=null;function bx(s){Ih!==s&&(Ih=s,t.unstable_scheduleCallback(t.unstable_NormalPriority,function(){Ih===s&&(Ih=null);for(var a=0;a<s.length;a+=3){var c=s[a],f=s[a+1],_=s[a+2];if(typeof f!="function"){if(gg(f||c)===null)continue;break}var w=Ir(c);w!==null&&(s.splice(a,3),a-=3,pp(w,{pending:!0,data:_,method:c.method,action:f},f,_))}}))}function Cl(s){function a(ne){return Rh(ne,s)}Ji!==null&&Rh(Ji,s),ea!==null&&Rh(ea,s),ta!==null&&Rh(ta,s),hu.forEach(a),fu.forEach(a);for(var c=0;c<na.length;c++){var f=na[c];f.blockedOn===s&&(f.blockedOn=null)}for(;0<na.length&&(c=na[0],c.blockedOn===null);)yx(c),c.blockedOn===null&&na.shift();if(c=(s.ownerDocument||s).$$reactFormReplay,c!=null)for(f=0;f<c.length;f+=3){var _=c[f],w=c[f+1],P=_[jn]||null;if(typeof w=="function")P||bx(c);else if(P){var Q=null;if(w&&w.hasAttribute("formAction")){if(_=w,P=w[jn]||null)Q=P.formAction;else if(gg(_)!==null)continue}else Q=P.action;typeof Q=="function"?c[f+1]=Q:(c.splice(f,3),f-=3),bx(c)}}}function vx(){function s(w){w.canIntercept&&w.info==="react-transition"&&w.intercept({handler:function(){return new Promise(function(P){return _=P})},focusReset:"manual",scroll:"manual"})}function a(){_!==null&&(_(),_=null),f||setTimeout(c,20)}function c(){if(!f&&!navigation.transition){var w=navigation.currentEntry;w&&w.url!=null&&navigation.navigate(w.url,{state:w.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var f=!1,_=null;return navigation.addEventListener("navigate",s),navigation.addEventListener("navigatesuccess",a),navigation.addEventListener("navigateerror",a),setTimeout(c,100),function(){f=!0,navigation.removeEventListener("navigate",s),navigation.removeEventListener("navigatesuccess",a),navigation.removeEventListener("navigateerror",a),_!==null&&(_(),_=null)}}}function _g(s){this._internalRoot=s}kh.prototype.render=_g.prototype.render=function(s){var a=this._internalRoot;if(a===null)throw Error(r(409));var c=a.current,f=Cr();dx(c,f,s,a,null,null)},kh.prototype.unmount=_g.prototype.unmount=function(){var s=this._internalRoot;if(s!==null){this._internalRoot=null;var a=s.containerInfo;dx(s.current,2,null,s,null,null),dh(),a[_s]=null}};function kh(s){this._internalRoot=s}kh.prototype.unstable_scheduleHydration=function(s){if(s){var a=dd();s={blockedOn:null,target:s,priority:a};for(var c=0;c<na.length&&a!==0&&a<na[c].priority;c++);na.splice(c,0,s),c===0&&yx(s)}};var xx=e.version;if(xx!=="19.2.3")throw Error(r(527,xx,"19.2.3"));q.findDOMNode=function(s){var a=s._reactInternals;if(a===void 0)throw typeof s.render=="function"?Error(r(188)):(s=Object.keys(s).join(","),Error(r(268,s)));return s=m(a),s=s!==null?p(s):null,s=s===null?null:s.stateNode,s};var O2={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:K,reconcilerVersion:"19.2.3"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Dh=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Dh.isDisabled&&Dh.supportsFiber)try{bt=Dh.inject(O2),Jt=Dh}catch{}}return gu.createRoot=function(s,a){if(!i(s))throw Error(r(299));var c=!1,f="",_=jb,w=Rb,P=Ib;return a!=null&&(a.unstable_strictMode===!0&&(c=!0),a.identifierPrefix!==void 0&&(f=a.identifierPrefix),a.onUncaughtError!==void 0&&(_=a.onUncaughtError),a.onCaughtError!==void 0&&(w=a.onCaughtError),a.onRecoverableError!==void 0&&(P=a.onRecoverableError)),a=cx(s,1,!1,null,null,c,f,null,_,w,P,vx),s[_s]=a.current,Jp(s),new _g(a)},gu.hydrateRoot=function(s,a,c){if(!i(s))throw Error(r(299));var f=!1,_="",w=jb,P=Rb,Q=Ib,ne=null;return c!=null&&(c.unstable_strictMode===!0&&(f=!0),c.identifierPrefix!==void 0&&(_=c.identifierPrefix),c.onUncaughtError!==void 0&&(w=c.onUncaughtError),c.onCaughtError!==void 0&&(P=c.onCaughtError),c.onRecoverableError!==void 0&&(Q=c.onRecoverableError),c.formState!==void 0&&(ne=c.formState)),a=cx(s,1,!0,a,c??null,f,_,ne,w,P,Q,vx),a.context=ux(null),c=a.current,f=Cr(),f=Va(f),_=Fi(f),_.callback=null,Vi(c,_,f),c=f,a.current.lanes=c,Ua(a,c),Os(a),s[_s]=a.current,Jp(s),new kh(a)},gu.version="19.2.3",gu}var kx;function H2(){if(kx)return xg.exports;kx=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),xg.exports=q2(),xg.exports}var G2=H2();var Dx="popstate";function Q2(t={}){function e(r,i){let{pathname:o,search:l,hash:d}=r.location;return Wg("",{pathname:o,search:l,hash:d},i.state&&i.state.usr||null,i.state&&i.state.key||"default")}function n(r,i){return typeof i=="string"?i:Iu(i)}return K2(e,n,null,t)}function Yt(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function Ar(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function W2(){return Math.random().toString(36).substring(2,10)}function Mx(t,e){return{usr:t.state,key:t.key,idx:e}}function Wg(t,e,n=null,r){return{pathname:typeof t=="string"?t:t.pathname,search:"",hash:"",...typeof e=="string"?Zl(e):e,state:n,key:e&&e.key||r||W2()}}function Iu({pathname:t="/",search:e="",hash:n=""}){return e&&e!=="?"&&(t+=e.charAt(0)==="?"?e:"?"+e),n&&n!=="#"&&(t+=n.charAt(0)==="#"?n:"#"+n),t}function Zl(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substring(n),t=t.substring(0,n));let r=t.indexOf("?");r>=0&&(e.search=t.substring(r),t=t.substring(0,r)),t&&(e.pathname=t)}return e}function K2(t,e,n,r={}){let{window:i=document.defaultView,v5Compat:o=!1}=r,l=i.history,d="POP",h=null,m=p();m==null&&(m=0,l.replaceState({...l.state,idx:m},""));function p(){return(l.state||{idx:null}).idx}function g(){d="POP";let S=p(),C=S==null?null:S-m;m=S,h&&h({action:d,location:x.location,delta:C})}function v(S,C){d="PUSH";let T=Wg(x.location,S,C);m=p()+1;let I=Mx(T,m),O=x.createHref(T);try{l.pushState(I,"",O)}catch(U){if(U instanceof DOMException&&U.name==="DataCloneError")throw U;i.location.assign(O)}o&&h&&h({action:d,location:x.location,delta:1})}function b(S,C){d="REPLACE";let T=Wg(x.location,S,C);m=p();let I=Mx(T,m),O=x.createHref(T);l.replaceState(I,"",O),o&&h&&h({action:d,location:x.location,delta:0})}function E(S){return Y2(S)}let x={get action(){return d},get location(){return t(i,l)},listen(S){if(h)throw new Error("A history only accepts one active listener");return i.addEventListener(Dx,g),h=S,()=>{i.removeEventListener(Dx,g),h=null}},createHref(S){return e(i,S)},createURL:E,encodeLocation(S){let C=E(S);return{pathname:C.pathname,search:C.search,hash:C.hash}},push:v,replace:b,go(S){return l.go(S)}};return x}function Y2(t,e=!1){let n="http://localhost";typeof window<"u"&&(n=window.location.origin!=="null"?window.location.origin:window.location.href),Yt(n,"No window.location.(origin|href) available to create URL");let r=typeof t=="string"?t:Iu(t);return r=r.replace(/ $/,"%20"),!e&&r.startsWith("//")&&(r=n+r),new URL(r,n)}function cS(t,e,n="/"){return X2(t,e,n,!1)}function X2(t,e,n,r){let i=typeof e=="string"?Zl(e):e,o=pi(i.pathname||"/",n);if(o==null)return null;let l=uS(t);Z2(l);let d=null;for(let h=0;d==null&&h<l.length;++h){let m=c5(o);d=o5(l[h],m,r)}return d}function uS(t,e=[],n=[],r="",i=!1){let o=(l,d,h=i,m)=>{let p={relativePath:m===void 0?l.path||"":m,caseSensitive:l.caseSensitive===!0,childrenIndex:d,route:l};if(p.relativePath.startsWith("/")){if(!p.relativePath.startsWith(r)&&h)return;Yt(p.relativePath.startsWith(r),`Absolute route path "${p.relativePath}" nested under path "${r}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),p.relativePath=p.relativePath.slice(r.length)}let g=fi([r,p.relativePath]),v=n.concat(p);l.children&&l.children.length>0&&(Yt(l.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${g}".`),uS(l.children,e,v,g,h)),!(l.path==null&&!l.index)&&e.push({path:g,score:i5(g,l.index),routesMeta:v})};return t.forEach((l,d)=>{if(l.path===""||!l.path?.includes("?"))o(l,d);else for(let h of dS(l.path))o(l,d,!0,h)}),e}function dS(t){let e=t.split("/");if(e.length===0)return[];let[n,...r]=e,i=n.endsWith("?"),o=n.replace(/\?$/,"");if(r.length===0)return i?[o,""]:[o];let l=dS(r.join("/")),d=[];return d.push(...l.map(h=>h===""?o:[o,h].join("/"))),i&&d.push(...l),d.map(h=>t.startsWith("/")&&h===""?"/":h)}function Z2(t){t.sort((e,n)=>e.score!==n.score?n.score-e.score:a5(e.routesMeta.map(r=>r.childrenIndex),n.routesMeta.map(r=>r.childrenIndex)))}var J2=/^:[\w-]+$/,e5=3,t5=2,n5=1,r5=10,s5=-2,Ox=t=>t==="*";function i5(t,e){let n=t.split("/"),r=n.length;return n.some(Ox)&&(r+=s5),e&&(r+=t5),n.filter(i=>!Ox(i)).reduce((i,o)=>i+(J2.test(o)?e5:o===""?n5:r5),r)}function a5(t,e){return t.length===e.length&&t.slice(0,-1).every((r,i)=>r===e[i])?t[t.length-1]-e[e.length-1]:0}function o5(t,e,n=!1){let{routesMeta:r}=t,i={},o="/",l=[];for(let d=0;d<r.length;++d){let h=r[d],m=d===r.length-1,p=o==="/"?e:e.slice(o.length)||"/",g=nf({path:h.relativePath,caseSensitive:h.caseSensitive,end:m},p),v=h.route;if(!g&&m&&n&&!r[r.length-1].route.index&&(g=nf({path:h.relativePath,caseSensitive:h.caseSensitive,end:!1},p)),!g)return null;Object.assign(i,g.params),l.push({params:i,pathname:fi([o,g.pathname]),pathnameBase:f5(fi([o,g.pathnameBase])),route:v}),g.pathnameBase!=="/"&&(o=fi([o,g.pathnameBase]))}return l}function nf(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,r]=l5(t.path,t.caseSensitive,t.end),i=e.match(n);if(!i)return null;let o=i[0],l=o.replace(/(.)\/+$/,"$1"),d=i.slice(1);return{params:r.reduce((m,{paramName:p,isOptional:g},v)=>{if(p==="*"){let E=d[v]||"";l=o.slice(0,o.length-E.length).replace(/(.)\/+$/,"$1")}const b=d[v];return g&&!b?m[p]=void 0:m[p]=(b||"").replace(/%2F/g,"/"),m},{}),pathname:o,pathnameBase:l,pattern:t}}function l5(t,e=!1,n=!0){Ar(t==="*"||!t.endsWith("*")||t.endsWith("/*"),`Route path "${t}" will be treated as if it were "${t.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${t.replace(/\*$/,"/*")}".`);let r=[],i="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(l,d,h)=>(r.push({paramName:d,isOptional:h!=null}),h?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return t.endsWith("*")?(r.push({paramName:"*"}),i+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?i+="\\/*$":t!==""&&t!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,e?void 0:"i"),r]}function c5(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return Ar(!1,`The URL path "${t}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),t}}function pi(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,r=t.charAt(n);return r&&r!=="/"?null:t.slice(n)||"/"}var hS=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,u5=t=>hS.test(t);function d5(t,e="/"){let{pathname:n,search:r="",hash:i=""}=typeof t=="string"?Zl(t):t,o;if(n)if(u5(n))o=n;else{if(n.includes("//")){let l=n;n=n.replace(/\/\/+/g,"/"),Ar(!1,`Pathnames cannot have embedded double slashes - normalizing ${l} -> ${n}`)}n.startsWith("/")?o=Nx(n.substring(1),"/"):o=Nx(n,e)}else o=e;return{pathname:o,search:m5(r),hash:p5(i)}}function Nx(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(i=>{i===".."?n.length>1&&n.pop():i!=="."&&n.push(i)}),n.length>1?n.join("/"):"/"}function Cg(t,e,n,r){return`Cannot include a '${t}' character in a manually specified \`to.${e}\` field [${JSON.stringify(r)}].  Please separate it out to the \`to.${n}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function h5(t){return t.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function My(t){let e=h5(t);return e.map((n,r)=>r===e.length-1?n.pathname:n.pathnameBase)}function Oy(t,e,n,r=!1){let i;typeof t=="string"?i=Zl(t):(i={...t},Yt(!i.pathname||!i.pathname.includes("?"),Cg("?","pathname","search",i)),Yt(!i.pathname||!i.pathname.includes("#"),Cg("#","pathname","hash",i)),Yt(!i.search||!i.search.includes("#"),Cg("#","search","hash",i)));let o=t===""||i.pathname==="",l=o?"/":i.pathname,d;if(l==null)d=n;else{let g=e.length-1;if(!r&&l.startsWith("..")){let v=l.split("/");for(;v[0]==="..";)v.shift(),g-=1;i.pathname=v.join("/")}d=g>=0?e[g]:"/"}let h=d5(i,d),m=l&&l!=="/"&&l.endsWith("/"),p=(o||l===".")&&n.endsWith("/");return!h.pathname.endsWith("/")&&(m||p)&&(h.pathname+="/"),h}var fi=t=>t.join("/").replace(/\/\/+/g,"/"),f5=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),m5=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,p5=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t,g5=class{constructor(t,e,n,r=!1){this.status=t,this.statusText=e||"",this.internal=r,n instanceof Error?(this.data=n.toString(),this.error=n):this.data=n}};function y5(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}function _5(t){return t.map(e=>e.route.path).filter(Boolean).join("/").replace(/\/\/*/g,"/")||"/"}var fS=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function mS(t,e){let n=t;if(typeof n!="string"||!hS.test(n))return{absoluteURL:void 0,isExternal:!1,to:n};let r=n,i=!1;if(fS)try{let o=new URL(window.location.href),l=n.startsWith("//")?new URL(o.protocol+n):new URL(n),d=pi(l.pathname,e);l.origin===o.origin&&d!=null?n=d+l.search+l.hash:i=!0}catch{Ar(!1,`<Link to="${n}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}return{absoluteURL:r,isExternal:i,to:n}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var pS=["POST","PUT","PATCH","DELETE"];new Set(pS);var b5=["GET",...pS];new Set(b5);var Jl=D.createContext(null);Jl.displayName="DataRouter";var Pf=D.createContext(null);Pf.displayName="DataRouterState";var v5=D.createContext(!1),gS=D.createContext({isTransitioning:!1});gS.displayName="ViewTransition";var x5=D.createContext(new Map);x5.displayName="Fetchers";var w5=D.createContext(null);w5.displayName="Await";var jr=D.createContext(null);jr.displayName="Navigation";var Hu=D.createContext(null);Hu.displayName="Location";var Hr=D.createContext({outlet:null,matches:[],isDataRoute:!1});Hr.displayName="Route";var Ny=D.createContext(null);Ny.displayName="RouteError";var yS="REACT_ROUTER_ERROR",S5="REDIRECT",E5="ROUTE_ERROR_RESPONSE";function C5(t){if(t.startsWith(`${yS}:${S5}:{`))try{let e=JSON.parse(t.slice(28));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.location=="string"&&typeof e.reloadDocument=="boolean"&&typeof e.replace=="boolean")return e}catch{}}function T5(t){if(t.startsWith(`${yS}:${E5}:{`))try{let e=JSON.parse(t.slice(40));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string")return new g5(e.status,e.statusText,e.data)}catch{}}function A5(t,{relative:e}={}){Yt(ec(),"useHref() may be used only in the context of a <Router> component.");let{basename:n,navigator:r}=D.useContext(jr),{hash:i,pathname:o,search:l}=Qu(t,{relative:e}),d=o;return n!=="/"&&(d=o==="/"?n:fi([n,o])),r.createHref({pathname:d,search:l,hash:i})}function ec(){return D.useContext(Hu)!=null}function On(){return Yt(ec(),"useLocation() may be used only in the context of a <Router> component."),D.useContext(Hu).location}var _S="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function bS(t){D.useContext(jr).static||D.useLayoutEffect(t)}function Gu(){let{isDataRoute:t}=D.useContext(Hr);return t?$5():j5()}function j5(){Yt(ec(),"useNavigate() may be used only in the context of a <Router> component.");let t=D.useContext(Jl),{basename:e,navigator:n}=D.useContext(jr),{matches:r}=D.useContext(Hr),{pathname:i}=On(),o=JSON.stringify(My(r)),l=D.useRef(!1);return bS(()=>{l.current=!0}),D.useCallback((h,m={})=>{if(Ar(l.current,_S),!l.current)return;if(typeof h=="number"){n.go(h);return}let p=Oy(h,JSON.parse(o),i,m.relative==="path");t==null&&e!=="/"&&(p.pathname=p.pathname==="/"?e:fi([e,p.pathname])),(m.replace?n.replace:n.push)(p,m.state,m)},[e,n,o,i,t])}var R5=D.createContext(null);function I5(t){let e=D.useContext(Hr).outlet;return D.useMemo(()=>e&&D.createElement(R5.Provider,{value:t},e),[e,t])}function k5(){let{matches:t}=D.useContext(Hr),e=t[t.length-1];return e?e.params:{}}function Qu(t,{relative:e}={}){let{matches:n}=D.useContext(Hr),{pathname:r}=On(),i=JSON.stringify(My(n));return D.useMemo(()=>Oy(t,JSON.parse(i),r,e==="path"),[t,i,r,e])}function D5(t,e){return vS(t,e)}function vS(t,e,n,r,i){Yt(ec(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:o}=D.useContext(jr),{matches:l}=D.useContext(Hr),d=l[l.length-1],h=d?d.params:{},m=d?d.pathname:"/",p=d?d.pathnameBase:"/",g=d&&d.route;{let T=g&&g.path||"";wS(m,!g||T.endsWith("*")||T.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${m}" (under <Route path="${T}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${T}"> to <Route path="${T==="/"?"*":`${T}/*`}">.`)}let v=On(),b;if(e){let T=typeof e=="string"?Zl(e):e;Yt(p==="/"||T.pathname?.startsWith(p),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${p}" but pathname "${T.pathname}" was given in the \`location\` prop.`),b=T}else b=v;let E=b.pathname||"/",x=E;if(p!=="/"){let T=p.replace(/^\//,"").split("/");x="/"+E.replace(/^\//,"").split("/").slice(T.length).join("/")}let S=cS(t,{pathname:x});Ar(g||S!=null,`No routes matched location "${b.pathname}${b.search}${b.hash}" `),Ar(S==null||S[S.length-1].route.element!==void 0||S[S.length-1].route.Component!==void 0||S[S.length-1].route.lazy!==void 0,`Matched leaf route at location "${b.pathname}${b.search}${b.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let C=B5(S&&S.map(T=>Object.assign({},T,{params:Object.assign({},h,T.params),pathname:fi([p,o.encodeLocation?o.encodeLocation(T.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:T.pathname]),pathnameBase:T.pathnameBase==="/"?p:fi([p,o.encodeLocation?o.encodeLocation(T.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:T.pathnameBase])})),l,n,r,i);return e&&C?D.createElement(Hu.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...b},navigationType:"POP"}},C):C}function M5(){let t=V5(),e=y5(t)?`${t.status} ${t.statusText}`:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,r="rgba(200,200,200, 0.5)",i={padding:"0.5rem",backgroundColor:r},o={padding:"2px 4px",backgroundColor:r},l=null;return console.error("Error handled by React Router default ErrorBoundary:",t),l=D.createElement(D.Fragment,null,D.createElement("p",null," Hey developer "),D.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",D.createElement("code",{style:o},"ErrorBoundary")," or"," ",D.createElement("code",{style:o},"errorElement")," prop on your route.")),D.createElement(D.Fragment,null,D.createElement("h2",null,"Unexpected Application Error!"),D.createElement("h3",{style:{fontStyle:"italic"}},e),n?D.createElement("pre",{style:i},n):null,l)}var O5=D.createElement(M5,null),xS=class extends D.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,e){return e.location!==t.location||e.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:e.error,location:e.location,revalidation:t.revalidation||e.revalidation}}componentDidCatch(t,e){this.props.onError?this.props.onError(t,e):console.error("React Router caught the following error during render",t)}render(){let t=this.state.error;if(this.context&&typeof t=="object"&&t&&"digest"in t&&typeof t.digest=="string"){const n=T5(t.digest);n&&(t=n)}let e=t!==void 0?D.createElement(Hr.Provider,{value:this.props.routeContext},D.createElement(Ny.Provider,{value:t,children:this.props.component})):this.props.children;return this.context?D.createElement(N5,{error:t},e):e}};xS.contextType=v5;var Tg=new WeakMap;function N5({children:t,error:e}){let{basename:n}=D.useContext(jr);if(typeof e=="object"&&e&&"digest"in e&&typeof e.digest=="string"){let r=C5(e.digest);if(r){let i=Tg.get(e);if(i)throw i;let o=mS(r.location,n);if(fS&&!Tg.get(e))if(o.isExternal||r.reloadDocument)window.location.href=o.absoluteURL||o.to;else{const l=Promise.resolve().then(()=>window.__reactRouterDataRouter.navigate(o.to,{replace:r.replace}));throw Tg.set(e,l),l}return D.createElement("meta",{httpEquiv:"refresh",content:`0;url=${o.absoluteURL||o.to}`})}}return t}function P5({routeContext:t,match:e,children:n}){let r=D.useContext(Jl);return r&&r.static&&r.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=e.route.id),D.createElement(Hr.Provider,{value:t},n)}function B5(t,e=[],n=null,r=null,i=null){if(t==null){if(!n)return null;if(n.errors)t=n.matches;else if(e.length===0&&!n.initialized&&n.matches.length>0)t=n.matches;else return null}let o=t,l=n?.errors;if(l!=null){let p=o.findIndex(g=>g.route.id&&l?.[g.route.id]!==void 0);Yt(p>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(l).join(",")}`),o=o.slice(0,Math.min(o.length,p+1))}let d=!1,h=-1;if(n)for(let p=0;p<o.length;p++){let g=o[p];if((g.route.HydrateFallback||g.route.hydrateFallbackElement)&&(h=p),g.route.id){let{loaderData:v,errors:b}=n,E=g.route.loader&&!v.hasOwnProperty(g.route.id)&&(!b||b[g.route.id]===void 0);if(g.route.lazy||E){d=!0,h>=0?o=o.slice(0,h+1):o=[o[0]];break}}}let m=n&&r?(p,g)=>{r(p,{location:n.location,params:n.matches?.[0]?.params??{},unstable_pattern:_5(n.matches),errorInfo:g})}:void 0;return o.reduceRight((p,g,v)=>{let b,E=!1,x=null,S=null;n&&(b=l&&g.route.id?l[g.route.id]:void 0,x=g.route.errorElement||O5,d&&(h<0&&v===0?(wS("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),E=!0,S=null):h===v&&(E=!0,S=g.route.hydrateFallbackElement||null)));let C=e.concat(o.slice(0,v+1)),T=()=>{let I;return b?I=x:E?I=S:g.route.Component?I=D.createElement(g.route.Component,null):g.route.element?I=g.route.element:I=p,D.createElement(P5,{match:g,routeContext:{outlet:p,matches:C,isDataRoute:n!=null},children:I})};return n&&(g.route.ErrorBoundary||g.route.errorElement||v===0)?D.createElement(xS,{location:n.location,revalidation:n.revalidation,component:x,error:b,children:T(),routeContext:{outlet:null,matches:C,isDataRoute:!0},onError:m}):T()},null)}function Py(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function z5(t){let e=D.useContext(Jl);return Yt(e,Py(t)),e}function L5(t){let e=D.useContext(Pf);return Yt(e,Py(t)),e}function U5(t){let e=D.useContext(Hr);return Yt(e,Py(t)),e}function By(t){let e=U5(t),n=e.matches[e.matches.length-1];return Yt(n.route.id,`${t} can only be used on routes that contain a unique "id"`),n.route.id}function F5(){return By("useRouteId")}function V5(){let t=D.useContext(Ny),e=L5("useRouteError"),n=By("useRouteError");return t!==void 0?t:e.errors?.[n]}function $5(){let{router:t}=z5("useNavigate"),e=By("useNavigate"),n=D.useRef(!1);return bS(()=>{n.current=!0}),D.useCallback(async(i,o={})=>{Ar(n.current,_S),n.current&&(typeof i=="number"?await t.navigate(i):await t.navigate(i,{fromRouteId:e,...o}))},[t,e])}var Px={};function wS(t,e,n){!e&&!Px[t]&&(Px[t]=!0,Ar(!1,n))}D.memo(q5);function q5({routes:t,future:e,state:n,onError:r}){return vS(t,void 0,n,r,e)}function Bf({to:t,replace:e,state:n,relative:r}){Yt(ec(),"<Navigate> may be used only in the context of a <Router> component.");let{static:i}=D.useContext(jr);Ar(!i,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:o}=D.useContext(Hr),{pathname:l}=On(),d=Gu(),h=Oy(t,My(o),l,r==="path"),m=JSON.stringify(h);return D.useEffect(()=>{d(JSON.parse(m),{replace:e,state:n,relative:r})},[d,m,r,e,n]),null}function zf(t){return I5(t.context)}function Sn(t){Yt(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function H5({basename:t="/",children:e=null,location:n,navigationType:r="POP",navigator:i,static:o=!1,unstable_useTransitions:l}){Yt(!ec(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let d=t.replace(/^\/*/,"/"),h=D.useMemo(()=>({basename:d,navigator:i,static:o,unstable_useTransitions:l,future:{}}),[d,i,o,l]);typeof n=="string"&&(n=Zl(n));let{pathname:m="/",search:p="",hash:g="",state:v=null,key:b="default"}=n,E=D.useMemo(()=>{let x=pi(m,d);return x==null?null:{location:{pathname:x,search:p,hash:g,state:v,key:b},navigationType:r}},[d,m,p,g,v,b,r]);return Ar(E!=null,`<Router basename="${d}"> is not able to match the URL "${m}${p}${g}" because it does not start with the basename, so the <Router> won't render anything.`),E==null?null:D.createElement(jr.Provider,{value:h},D.createElement(Hu.Provider,{children:e,value:E}))}function G5({children:t,location:e}){return D5(Kg(t),e)}function Kg(t,e=[]){let n=[];return D.Children.forEach(t,(r,i)=>{if(!D.isValidElement(r))return;let o=[...e,i];if(r.type===D.Fragment){n.push.apply(n,Kg(r.props.children,o));return}Yt(r.type===Sn,`[${typeof r.type=="string"?r.type:r.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),Yt(!r.props.index||!r.props.children,"An index route cannot have child routes.");let l={id:r.props.id||o.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,middleware:r.props.middleware,loader:r.props.loader,action:r.props.action,hydrateFallbackElement:r.props.hydrateFallbackElement,HydrateFallback:r.props.HydrateFallback,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.hasErrorBoundary===!0||r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(l.children=Kg(r.props.children,o)),n.push(l)}),n}var qh="get",Hh="application/x-www-form-urlencoded";function Lf(t){return typeof HTMLElement<"u"&&t instanceof HTMLElement}function Q5(t){return Lf(t)&&t.tagName.toLowerCase()==="button"}function W5(t){return Lf(t)&&t.tagName.toLowerCase()==="form"}function K5(t){return Lf(t)&&t.tagName.toLowerCase()==="input"}function Y5(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function X5(t,e){return t.button===0&&(!e||e==="_self")&&!Y5(t)}function Yg(t=""){return new URLSearchParams(typeof t=="string"||Array.isArray(t)||t instanceof URLSearchParams?t:Object.keys(t).reduce((e,n)=>{let r=t[n];return e.concat(Array.isArray(r)?r.map(i=>[n,i]):[[n,r]])},[]))}function Z5(t,e){let n=Yg(t);return e&&e.forEach((r,i)=>{n.has(i)||e.getAll(i).forEach(o=>{n.append(i,o)})}),n}var Oh=null;function J5(){if(Oh===null)try{new FormData(document.createElement("form"),0),Oh=!1}catch{Oh=!0}return Oh}var ej=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function Ag(t){return t!=null&&!ej.has(t)?(Ar(!1,`"${t}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${Hh}"`),null):t}function tj(t,e){let n,r,i,o,l;if(W5(t)){let d=t.getAttribute("action");r=d?pi(d,e):null,n=t.getAttribute("method")||qh,i=Ag(t.getAttribute("enctype"))||Hh,o=new FormData(t)}else if(Q5(t)||K5(t)&&(t.type==="submit"||t.type==="image")){let d=t.form;if(d==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let h=t.getAttribute("formaction")||d.getAttribute("action");if(r=h?pi(h,e):null,n=t.getAttribute("formmethod")||d.getAttribute("method")||qh,i=Ag(t.getAttribute("formenctype"))||Ag(d.getAttribute("enctype"))||Hh,o=new FormData(d,t),!J5()){let{name:m,type:p,value:g}=t;if(p==="image"){let v=m?`${m}.`:"";o.append(`${v}x`,"0"),o.append(`${v}y`,"0")}else m&&o.append(m,g)}}else{if(Lf(t))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');n=qh,r=null,i=Hh,l=t}return o&&i==="text/plain"&&(l=o,o=void 0),{action:r,method:n.toLowerCase(),encType:i,formData:o,body:l}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function zy(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function nj(t,e,n){let r=typeof t=="string"?new URL(t,typeof window>"u"?"server://singlefetch/":window.location.origin):t;return r.pathname==="/"?r.pathname=`_root.${n}`:e&&pi(r.pathname,e)==="/"?r.pathname=`${e.replace(/\/$/,"")}/_root.${n}`:r.pathname=`${r.pathname.replace(/\/$/,"")}.${n}`,r}async function rj(t,e){if(t.id in e)return e[t.id];try{let n=await import(t.module);return e[t.id]=n,n}catch(n){return console.error(`Error loading route module \`${t.module}\`, reloading page...`),console.error(n),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function sj(t){return t==null?!1:t.href==null?t.rel==="preload"&&typeof t.imageSrcSet=="string"&&typeof t.imageSizes=="string":typeof t.rel=="string"&&typeof t.href=="string"}async function ij(t,e,n){let r=await Promise.all(t.map(async i=>{let o=e.routes[i.route.id];if(o){let l=await rj(o,n);return l.links?l.links():[]}return[]}));return cj(r.flat(1).filter(sj).filter(i=>i.rel==="stylesheet"||i.rel==="preload").map(i=>i.rel==="stylesheet"?{...i,rel:"prefetch",as:"style"}:{...i,rel:"prefetch"}))}function Bx(t,e,n,r,i,o){let l=(h,m)=>n[m]?h.route.id!==n[m].route.id:!0,d=(h,m)=>n[m].pathname!==h.pathname||n[m].route.path?.endsWith("*")&&n[m].params["*"]!==h.params["*"];return o==="assets"?e.filter((h,m)=>l(h,m)||d(h,m)):o==="data"?e.filter((h,m)=>{let p=r.routes[h.route.id];if(!p||!p.hasLoader)return!1;if(l(h,m)||d(h,m))return!0;if(h.route.shouldRevalidate){let g=h.route.shouldRevalidate({currentUrl:new URL(i.pathname+i.search+i.hash,window.origin),currentParams:n[0]?.params||{},nextUrl:new URL(t,window.origin),nextParams:h.params,defaultShouldRevalidate:!0});if(typeof g=="boolean")return g}return!0}):[]}function aj(t,e,{includeHydrateFallback:n}={}){return oj(t.map(r=>{let i=e.routes[r.route.id];if(!i)return[];let o=[i.module];return i.clientActionModule&&(o=o.concat(i.clientActionModule)),i.clientLoaderModule&&(o=o.concat(i.clientLoaderModule)),n&&i.hydrateFallbackModule&&(o=o.concat(i.hydrateFallbackModule)),i.imports&&(o=o.concat(i.imports)),o}).flat(1))}function oj(t){return[...new Set(t)]}function lj(t){let e={},n=Object.keys(t).sort();for(let r of n)e[r]=t[r];return e}function cj(t,e){let n=new Set;return new Set(e),t.reduce((r,i)=>{let o=JSON.stringify(lj(i));return n.has(o)||(n.add(o),r.push({key:o,link:i})),r},[])}function SS(){let t=D.useContext(Jl);return zy(t,"You must render this element inside a <DataRouterContext.Provider> element"),t}function uj(){let t=D.useContext(Pf);return zy(t,"You must render this element inside a <DataRouterStateContext.Provider> element"),t}var Ly=D.createContext(void 0);Ly.displayName="FrameworkContext";function ES(){let t=D.useContext(Ly);return zy(t,"You must render this element inside a <HydratedRouter> element"),t}function dj(t,e){let n=D.useContext(Ly),[r,i]=D.useState(!1),[o,l]=D.useState(!1),{onFocus:d,onBlur:h,onMouseEnter:m,onMouseLeave:p,onTouchStart:g}=e,v=D.useRef(null);D.useEffect(()=>{if(t==="render"&&l(!0),t==="viewport"){let x=C=>{C.forEach(T=>{l(T.isIntersecting)})},S=new IntersectionObserver(x,{threshold:.5});return v.current&&S.observe(v.current),()=>{S.disconnect()}}},[t]),D.useEffect(()=>{if(r){let x=setTimeout(()=>{l(!0)},100);return()=>{clearTimeout(x)}}},[r]);let b=()=>{i(!0)},E=()=>{i(!1),l(!1)};return n?t!=="intent"?[o,v,{}]:[o,v,{onFocus:yu(d,b),onBlur:yu(h,E),onMouseEnter:yu(m,b),onMouseLeave:yu(p,E),onTouchStart:yu(g,b)}]:[!1,v,{}]}function yu(t,e){return n=>{t&&t(n),n.defaultPrevented||e(n)}}function hj({page:t,...e}){let{router:n}=SS(),r=D.useMemo(()=>cS(n.routes,t,n.basename),[n.routes,t,n.basename]);return r?D.createElement(mj,{page:t,matches:r,...e}):null}function fj(t){let{manifest:e,routeModules:n}=ES(),[r,i]=D.useState([]);return D.useEffect(()=>{let o=!1;return ij(t,e,n).then(l=>{o||i(l)}),()=>{o=!0}},[t,e,n]),r}function mj({page:t,matches:e,...n}){let r=On(),{manifest:i,routeModules:o}=ES(),{basename:l}=SS(),{loaderData:d,matches:h}=uj(),m=D.useMemo(()=>Bx(t,e,h,i,r,"data"),[t,e,h,i,r]),p=D.useMemo(()=>Bx(t,e,h,i,r,"assets"),[t,e,h,i,r]),g=D.useMemo(()=>{if(t===r.pathname+r.search+r.hash)return[];let E=new Set,x=!1;if(e.forEach(C=>{let T=i.routes[C.route.id];!T||!T.hasLoader||(!m.some(I=>I.route.id===C.route.id)&&C.route.id in d&&o[C.route.id]?.shouldRevalidate||T.hasClientLoader?x=!0:E.add(C.route.id))}),E.size===0)return[];let S=nj(t,l,"data");return x&&E.size>0&&S.searchParams.set("_routes",e.filter(C=>E.has(C.route.id)).map(C=>C.route.id).join(",")),[S.pathname+S.search]},[l,d,r,i,m,e,t,o]),v=D.useMemo(()=>aj(p,i),[p,i]),b=fj(p);return D.createElement(D.Fragment,null,g.map(E=>D.createElement("link",{key:E,rel:"prefetch",as:"fetch",href:E,...n})),v.map(E=>D.createElement("link",{key:E,rel:"modulepreload",href:E,...n})),b.map(({key:E,link:x})=>D.createElement("link",{key:E,nonce:n.nonce,...x})))}function pj(...t){return e=>{t.forEach(n=>{typeof n=="function"?n(e):n!=null&&(n.current=e)})}}var gj=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{gj&&(window.__reactRouterVersion="7.11.0")}catch{}function yj({basename:t,children:e,unstable_useTransitions:n,window:r}){let i=D.useRef();i.current==null&&(i.current=Q2({window:r,v5Compat:!0}));let o=i.current,[l,d]=D.useState({action:o.action,location:o.location}),h=D.useCallback(m=>{n===!1?d(m):D.startTransition(()=>d(m))},[n]);return D.useLayoutEffect(()=>o.listen(h),[o,h]),D.createElement(H5,{basename:t,children:e,location:l.location,navigationType:l.action,navigator:o,unstable_useTransitions:n})}var CS=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Cn=D.forwardRef(function({onClick:e,discover:n="render",prefetch:r="none",relative:i,reloadDocument:o,replace:l,state:d,target:h,to:m,preventScrollReset:p,viewTransition:g,unstable_defaultShouldRevalidate:v,...b},E){let{basename:x,unstable_useTransitions:S}=D.useContext(jr),C=typeof m=="string"&&CS.test(m),T=mS(m,x);m=T.to;let I=A5(m,{relative:i}),[O,U,$]=dj(r,b),k=xj(m,{replace:l,state:d,target:h,preventScrollReset:p,relative:i,viewTransition:g,unstable_defaultShouldRevalidate:v,unstable_useTransitions:S});function R(V){e&&e(V),V.defaultPrevented||k(V)}let N=D.createElement("a",{...b,...$,href:T.absoluteURL||I,onClick:T.isExternal||o?e:R,ref:pj(E,U),target:h,"data-discover":!C&&n==="render"?"true":void 0});return O&&!C?D.createElement(D.Fragment,null,N,D.createElement(hj,{page:I})):N});Cn.displayName="Link";var _j=D.forwardRef(function({"aria-current":e="page",caseSensitive:n=!1,className:r="",end:i=!1,style:o,to:l,viewTransition:d,children:h,...m},p){let g=Qu(l,{relative:m.relative}),v=On(),b=D.useContext(Pf),{navigator:E,basename:x}=D.useContext(jr),S=b!=null&&Tj(g)&&d===!0,C=E.encodeLocation?E.encodeLocation(g).pathname:g.pathname,T=v.pathname,I=b&&b.navigation&&b.navigation.location?b.navigation.location.pathname:null;n||(T=T.toLowerCase(),I=I?I.toLowerCase():null,C=C.toLowerCase()),I&&x&&(I=pi(I,x)||I);const O=C!=="/"&&C.endsWith("/")?C.length-1:C.length;let U=T===C||!i&&T.startsWith(C)&&T.charAt(O)==="/",$=I!=null&&(I===C||!i&&I.startsWith(C)&&I.charAt(C.length)==="/"),k={isActive:U,isPending:$,isTransitioning:S},R=U?e:void 0,N;typeof r=="function"?N=r(k):N=[r,U?"active":null,$?"pending":null,S?"transitioning":null].filter(Boolean).join(" ");let V=typeof o=="function"?o(k):o;return D.createElement(Cn,{...m,"aria-current":R,className:N,ref:p,style:V,to:l,viewTransition:d},typeof h=="function"?h(k):h)});_j.displayName="NavLink";var bj=D.forwardRef(({discover:t="render",fetcherKey:e,navigate:n,reloadDocument:r,replace:i,state:o,method:l=qh,action:d,onSubmit:h,relative:m,preventScrollReset:p,viewTransition:g,unstable_defaultShouldRevalidate:v,...b},E)=>{let{unstable_useTransitions:x}=D.useContext(jr),S=Ej(),C=Cj(d,{relative:m}),T=l.toLowerCase()==="get"?"get":"post",I=typeof d=="string"&&CS.test(d),O=U=>{if(h&&h(U),U.defaultPrevented)return;U.preventDefault();let $=U.nativeEvent.submitter,k=$?.getAttribute("formmethod")||l,R=()=>S($||U.currentTarget,{fetcherKey:e,method:k,navigate:n,replace:i,state:o,relative:m,preventScrollReset:p,viewTransition:g,unstable_defaultShouldRevalidate:v});x&&n!==!1?D.startTransition(()=>R()):R()};return D.createElement("form",{ref:E,method:T,action:C,onSubmit:r?h:O,...b,"data-discover":!I&&t==="render"?"true":void 0})});bj.displayName="Form";function vj(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function TS(t){let e=D.useContext(Jl);return Yt(e,vj(t)),e}function xj(t,{target:e,replace:n,state:r,preventScrollReset:i,relative:o,viewTransition:l,unstable_defaultShouldRevalidate:d,unstable_useTransitions:h}={}){let m=Gu(),p=On(),g=Qu(t,{relative:o});return D.useCallback(v=>{if(X5(v,e)){v.preventDefault();let b=n!==void 0?n:Iu(p)===Iu(g),E=()=>m(t,{replace:b,state:r,preventScrollReset:i,relative:o,viewTransition:l,unstable_defaultShouldRevalidate:d});h?D.startTransition(()=>E()):E()}},[p,m,g,n,r,e,t,i,o,l,d,h])}function AS(t){Ar(typeof URLSearchParams<"u","You cannot use the `useSearchParams` hook in a browser that does not support the URLSearchParams API. If you need to support Internet Explorer 11, we recommend you load a polyfill such as https://github.com/ungap/url-search-params.");let e=D.useRef(Yg(t)),n=D.useRef(!1),r=On(),i=D.useMemo(()=>Z5(r.search,n.current?null:e.current),[r.search]),o=Gu(),l=D.useCallback((d,h)=>{const m=Yg(typeof d=="function"?d(new URLSearchParams(i)):d);n.current=!0,o("?"+m,h)},[o,i]);return[i,l]}var wj=0,Sj=()=>`__${String(++wj)}__`;function Ej(){let{router:t}=TS("useSubmit"),{basename:e}=D.useContext(jr),n=F5(),r=t.fetch,i=t.navigate;return D.useCallback(async(o,l={})=>{let{action:d,method:h,encType:m,formData:p,body:g}=tj(o,e);if(l.navigate===!1){let v=l.fetcherKey||Sj();await r(v,n,l.action||d,{unstable_defaultShouldRevalidate:l.unstable_defaultShouldRevalidate,preventScrollReset:l.preventScrollReset,formData:p,body:g,formMethod:l.method||h,formEncType:l.encType||m,flushSync:l.flushSync})}else await i(l.action||d,{unstable_defaultShouldRevalidate:l.unstable_defaultShouldRevalidate,preventScrollReset:l.preventScrollReset,formData:p,body:g,formMethod:l.method||h,formEncType:l.encType||m,replace:l.replace,state:l.state,fromRouteId:n,flushSync:l.flushSync,viewTransition:l.viewTransition})},[r,i,e,n])}function Cj(t,{relative:e}={}){let{basename:n}=D.useContext(jr),r=D.useContext(Hr);Yt(r,"useFormAction must be used inside a RouteContext");let[i]=r.matches.slice(-1),o={...Qu(t||".",{relative:e})},l=On();if(t==null){o.search=l.search;let d=new URLSearchParams(o.search),h=d.getAll("index");if(h.some(p=>p==="")){d.delete("index"),h.filter(g=>g).forEach(g=>d.append("index",g));let p=d.toString();o.search=p?`?${p}`:""}}return(!t||t===".")&&i.route.index&&(o.search=o.search?o.search.replace(/^\?/,"?index&"):"?index"),n!=="/"&&(o.pathname=o.pathname==="/"?n:fi([n,o.pathname])),Iu(o)}function Tj(t,{relative:e}={}){let n=D.useContext(gS);Yt(n!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:r}=TS("useViewTransitionState"),i=Qu(t,{relative:e});if(!n.isTransitioning)return!1;let o=pi(n.currentLocation.pathname,r)||n.currentLocation.pathname,l=pi(n.nextLocation.pathname,r)||n.nextLocation.pathname;return nf(i.pathname,l)!=null||nf(i.pathname,o)!=null}var tc=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(t){return this.listeners.add(t),this.onSubscribe(),()=>{this.listeners.delete(t),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},Aj={setTimeout:(t,e)=>setTimeout(t,e),clearTimeout:t=>clearTimeout(t),setInterval:(t,e)=>setInterval(t,e),clearInterval:t=>clearInterval(t)},jj=class{#e=Aj;#t=!1;setTimeoutProvider(t){this.#e=t}setTimeout(t,e){return this.#e.setTimeout(t,e)}clearTimeout(t){this.#e.clearTimeout(t)}setInterval(t,e){return this.#e.setInterval(t,e)}clearInterval(t){this.#e.clearInterval(t)}},_o=new jj;function Rj(t){setTimeout(t,0)}var Eo=typeof window>"u"||"Deno"in globalThis;function sr(){}function Ij(t,e){return typeof t=="function"?t(e):t}function Xg(t){return typeof t=="number"&&t>=0&&t!==1/0}function jS(t,e){return Math.max(t+(e||0)-Date.now(),0)}function ma(t,e){return typeof t=="function"?t(e):t}function Vr(t,e){return typeof t=="function"?t(e):t}function zx(t,e){const{type:n="all",exact:r,fetchStatus:i,predicate:o,queryKey:l,stale:d}=t;if(l){if(r){if(e.queryHash!==Uy(l,e.options))return!1}else if(!ku(e.queryKey,l))return!1}if(n!=="all"){const h=e.isActive();if(n==="active"&&!h||n==="inactive"&&h)return!1}return!(typeof d=="boolean"&&e.isStale()!==d||i&&i!==e.state.fetchStatus||o&&!o(e))}function Lx(t,e){const{exact:n,status:r,predicate:i,mutationKey:o}=t;if(o){if(!e.options.mutationKey)return!1;if(n){if(Co(e.options.mutationKey)!==Co(o))return!1}else if(!ku(e.options.mutationKey,o))return!1}return!(r&&e.state.status!==r||i&&!i(e))}function Uy(t,e){return(e?.queryKeyHashFn||Co)(t)}function Co(t){return JSON.stringify(t,(e,n)=>Zg(n)?Object.keys(n).sort().reduce((r,i)=>(r[i]=n[i],r),{}):n)}function ku(t,e){return t===e?!0:typeof t!=typeof e?!1:t&&e&&typeof t=="object"&&typeof e=="object"?Object.keys(e).every(n=>ku(t[n],e[n])):!1}var kj=Object.prototype.hasOwnProperty;function RS(t,e){if(t===e)return t;const n=Ux(t)&&Ux(e);if(!n&&!(Zg(t)&&Zg(e)))return e;const i=(n?t:Object.keys(t)).length,o=n?e:Object.keys(e),l=o.length,d=n?new Array(l):{};let h=0;for(let m=0;m<l;m++){const p=n?m:o[m],g=t[p],v=e[p];if(g===v){d[p]=g,(n?m<i:kj.call(t,p))&&h++;continue}if(g===null||v===null||typeof g!="object"||typeof v!="object"){d[p]=v;continue}const b=RS(g,v);d[p]=b,b===g&&h++}return i===l&&h===i?t:d}function rf(t,e){if(!e||Object.keys(t).length!==Object.keys(e).length)return!1;for(const n in t)if(t[n]!==e[n])return!1;return!0}function Ux(t){return Array.isArray(t)&&t.length===Object.keys(t).length}function Zg(t){if(!Fx(t))return!1;const e=t.constructor;if(e===void 0)return!0;const n=e.prototype;return!(!Fx(n)||!n.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(t)!==Object.prototype)}function Fx(t){return Object.prototype.toString.call(t)==="[object Object]"}function Dj(t){return new Promise(e=>{_o.setTimeout(e,t)})}function Jg(t,e,n){return typeof n.structuralSharing=="function"?n.structuralSharing(t,e):n.structuralSharing!==!1?RS(t,e):e}function Mj(t,e,n=0){const r=[...t,e];return n&&r.length>n?r.slice(1):r}function Oj(t,e,n=0){const r=[e,...t];return n&&r.length>n?r.slice(0,-1):r}var Fy=Symbol();function IS(t,e){return!t.queryFn&&e?.initialPromise?()=>e.initialPromise:!t.queryFn||t.queryFn===Fy?()=>Promise.reject(new Error(`Missing queryFn: '${t.queryHash}'`)):t.queryFn}function kS(t,e){return typeof t=="function"?t(...e):!!t}var Nj=class extends tc{#e;#t;#n;constructor(){super(),this.#n=t=>{if(!Eo&&window.addEventListener){const e=()=>t();return window.addEventListener("visibilitychange",e,!1),()=>{window.removeEventListener("visibilitychange",e)}}}}onSubscribe(){this.#t||this.setEventListener(this.#n)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(t){this.#n=t,this.#t?.(),this.#t=t(e=>{typeof e=="boolean"?this.setFocused(e):this.onFocus()})}setFocused(t){this.#e!==t&&(this.#e=t,this.onFocus())}onFocus(){const t=this.isFocused();this.listeners.forEach(e=>{e(t)})}isFocused(){return typeof this.#e=="boolean"?this.#e:globalThis.document?.visibilityState!=="hidden"}},Vy=new Nj;function ey(){let t,e;const n=new Promise((i,o)=>{t=i,e=o});n.status="pending",n.catch(()=>{});function r(i){Object.assign(n,i),delete n.resolve,delete n.reject}return n.resolve=i=>{r({status:"fulfilled",value:i}),t(i)},n.reject=i=>{r({status:"rejected",reason:i}),e(i)},n}var Pj=Rj;function Bj(){let t=[],e=0,n=d=>{d()},r=d=>{d()},i=Pj;const o=d=>{e?t.push(d):i(()=>{n(d)})},l=()=>{const d=t;t=[],d.length&&i(()=>{r(()=>{d.forEach(h=>{n(h)})})})};return{batch:d=>{let h;e++;try{h=d()}finally{e--,e||l()}return h},batchCalls:d=>(...h)=>{o(()=>{d(...h)})},schedule:o,setNotifyFunction:d=>{n=d},setBatchNotifyFunction:d=>{r=d},setScheduler:d=>{i=d}}}var En=Bj(),zj=class extends tc{#e=!0;#t;#n;constructor(){super(),this.#n=t=>{if(!Eo&&window.addEventListener){const e=()=>t(!0),n=()=>t(!1);return window.addEventListener("online",e,!1),window.addEventListener("offline",n,!1),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",n)}}}}onSubscribe(){this.#t||this.setEventListener(this.#n)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(t){this.#n=t,this.#t?.(),this.#t=t(this.setOnline.bind(this))}setOnline(t){this.#e!==t&&(this.#e=t,this.listeners.forEach(n=>{n(t)}))}isOnline(){return this.#e}},sf=new zj;function Lj(t){return Math.min(1e3*2**t,3e4)}function DS(t){return(t??"online")==="online"?sf.isOnline():!0}var ty=class extends Error{constructor(t){super("CancelledError"),this.revert=t?.revert,this.silent=t?.silent}};function MS(t){let e=!1,n=0,r;const i=ey(),o=()=>i.status!=="pending",l=x=>{if(!o()){const S=new ty(x);v(S),t.onCancel?.(S)}},d=()=>{e=!0},h=()=>{e=!1},m=()=>Vy.isFocused()&&(t.networkMode==="always"||sf.isOnline())&&t.canRun(),p=()=>DS(t.networkMode)&&t.canRun(),g=x=>{o()||(r?.(),i.resolve(x))},v=x=>{o()||(r?.(),i.reject(x))},b=()=>new Promise(x=>{r=S=>{(o()||m())&&x(S)},t.onPause?.()}).then(()=>{r=void 0,o()||t.onContinue?.()}),E=()=>{if(o())return;let x;const S=n===0?t.initialPromise:void 0;try{x=S??t.fn()}catch(C){x=Promise.reject(C)}Promise.resolve(x).then(g).catch(C=>{if(o())return;const T=t.retry??(Eo?0:3),I=t.retryDelay??Lj,O=typeof I=="function"?I(n,C):I,U=T===!0||typeof T=="number"&&n<T||typeof T=="function"&&T(n,C);if(e||!U){v(C);return}n++,t.onFail?.(n,C),Dj(O).then(()=>m()?void 0:b()).then(()=>{e?v(C):E()})})};return{promise:i,status:()=>i.status,cancel:l,continue:()=>(r?.(),i),cancelRetry:d,continueRetry:h,canStart:p,start:()=>(p()?E():b().then(E),i)}}var OS=class{#e;destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),Xg(this.gcTime)&&(this.#e=_o.setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(t){this.gcTime=Math.max(this.gcTime||0,t??(Eo?1/0:300*1e3))}clearGcTimeout(){this.#e&&(_o.clearTimeout(this.#e),this.#e=void 0)}},Uj=class extends OS{#e;#t;#n;#s;#r;#a;#o;constructor(e){super(),this.#o=!1,this.#a=e.defaultOptions,this.setOptions(e.options),this.observers=[],this.#s=e.client,this.#n=this.#s.getQueryCache(),this.queryKey=e.queryKey,this.queryHash=e.queryHash,this.#e=$x(this.options),this.state=e.state??this.#e,this.scheduleGc()}get meta(){return this.options.meta}get promise(){return this.#r?.promise}setOptions(e){if(this.options={...this.#a,...e},this.updateGcTime(this.options.gcTime),this.state&&this.state.data===void 0){const n=$x(this.options);n.data!==void 0&&(this.setState(Vx(n.data,n.dataUpdatedAt)),this.#e=n)}}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&this.#n.remove(this)}setData(e,n){const r=Jg(this.state.data,e,this.options);return this.#i({data:r,type:"success",dataUpdatedAt:n?.updatedAt,manual:n?.manual}),r}setState(e,n){this.#i({type:"setState",state:e,setStateOptions:n})}cancel(e){const n=this.#r?.promise;return this.#r?.cancel(e),n?n.then(sr).catch(sr):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(this.#e)}isActive(){return this.observers.some(e=>Vr(e.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===Fy||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(e=>ma(e.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(e=>e.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(e=0){return this.state.data===void 0?!0:e==="static"?!1:this.state.isInvalidated?!0:!jS(this.state.dataUpdatedAt,e)}onFocus(){this.observers.find(n=>n.shouldFetchOnWindowFocus())?.refetch({cancelRefetch:!1}),this.#r?.continue()}onOnline(){this.observers.find(n=>n.shouldFetchOnReconnect())?.refetch({cancelRefetch:!1}),this.#r?.continue()}addObserver(e){this.observers.includes(e)||(this.observers.push(e),this.clearGcTimeout(),this.#n.notify({type:"observerAdded",query:this,observer:e}))}removeObserver(e){this.observers.includes(e)&&(this.observers=this.observers.filter(n=>n!==e),this.observers.length||(this.#r&&(this.#o?this.#r.cancel({revert:!0}):this.#r.cancelRetry()),this.scheduleGc()),this.#n.notify({type:"observerRemoved",query:this,observer:e}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||this.#i({type:"invalidate"})}async fetch(e,n){if(this.state.fetchStatus!=="idle"&&this.#r?.status()!=="rejected"){if(this.state.data!==void 0&&n?.cancelRefetch)this.cancel({silent:!0});else if(this.#r)return this.#r.continueRetry(),this.#r.promise}if(e&&this.setOptions(e),!this.options.queryFn){const h=this.observers.find(m=>m.options.queryFn);h&&this.setOptions(h.options)}const r=new AbortController,i=h=>{Object.defineProperty(h,"signal",{enumerable:!0,get:()=>(this.#o=!0,r.signal)})},o=()=>{const h=IS(this.options,n),p=(()=>{const g={client:this.#s,queryKey:this.queryKey,meta:this.meta};return i(g),g})();return this.#o=!1,this.options.persister?this.options.persister(h,p,this):h(p)},d=(()=>{const h={fetchOptions:n,options:this.options,queryKey:this.queryKey,client:this.#s,state:this.state,fetchFn:o};return i(h),h})();this.options.behavior?.onFetch(d,this),this.#t=this.state,(this.state.fetchStatus==="idle"||this.state.fetchMeta!==d.fetchOptions?.meta)&&this.#i({type:"fetch",meta:d.fetchOptions?.meta}),this.#r=MS({initialPromise:n?.initialPromise,fn:d.fetchFn,onCancel:h=>{h instanceof ty&&h.revert&&this.setState({...this.#t,fetchStatus:"idle"}),r.abort()},onFail:(h,m)=>{this.#i({type:"failed",failureCount:h,error:m})},onPause:()=>{this.#i({type:"pause"})},onContinue:()=>{this.#i({type:"continue"})},retry:d.options.retry,retryDelay:d.options.retryDelay,networkMode:d.options.networkMode,canRun:()=>!0});try{const h=await this.#r.start();if(h===void 0)throw new Error(`${this.queryHash} data is undefined`);return this.setData(h),this.#n.config.onSuccess?.(h,this),this.#n.config.onSettled?.(h,this.state.error,this),h}catch(h){if(h instanceof ty){if(h.silent)return this.#r.promise;if(h.revert){if(this.state.data===void 0)throw h;return this.state.data}}throw this.#i({type:"error",error:h}),this.#n.config.onError?.(h,this),this.#n.config.onSettled?.(this.state.data,h,this),h}finally{this.scheduleGc()}}#i(e){const n=r=>{switch(e.type){case"failed":return{...r,fetchFailureCount:e.failureCount,fetchFailureReason:e.error};case"pause":return{...r,fetchStatus:"paused"};case"continue":return{...r,fetchStatus:"fetching"};case"fetch":return{...r,...NS(r.data,this.options),fetchMeta:e.meta??null};case"success":const i={...r,...Vx(e.data,e.dataUpdatedAt),dataUpdateCount:r.dataUpdateCount+1,...!e.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return this.#t=e.manual?i:void 0,i;case"error":const o=e.error;return{...r,error:o,errorUpdateCount:r.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:r.fetchFailureCount+1,fetchFailureReason:o,fetchStatus:"idle",status:"error"};case"invalidate":return{...r,isInvalidated:!0};case"setState":return{...r,...e.state}}};this.state=n(this.state),En.batch(()=>{this.observers.forEach(r=>{r.onQueryUpdate()}),this.#n.notify({query:this,type:"updated",action:e})})}};function NS(t,e){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:DS(e.networkMode)?"fetching":"paused",...t===void 0&&{error:null,status:"pending"}}}function Vx(t,e){return{data:t,dataUpdatedAt:e??Date.now(),error:null,isInvalidated:!1,status:"success"}}function $x(t){const e=typeof t.initialData=="function"?t.initialData():t.initialData,n=e!==void 0,r=n?typeof t.initialDataUpdatedAt=="function"?t.initialDataUpdatedAt():t.initialDataUpdatedAt:0;return{data:e,dataUpdateCount:0,dataUpdatedAt:n?r??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:n?"success":"pending",fetchStatus:"idle"}}var Fj=class extends tc{constructor(t,e){super(),this.options=e,this.#e=t,this.#i=null,this.#o=ey(),this.bindMethods(),this.setOptions(e)}#e;#t=void 0;#n=void 0;#s=void 0;#r;#a;#o;#i;#p;#h;#f;#c;#u;#l;#m=new Set;bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(this.#t.addObserver(this),qx(this.#t,this.options)?this.#d():this.updateResult(),this.#b())}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return ny(this.#t,this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return ny(this.#t,this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,this.#v(),this.#x(),this.#t.removeObserver(this)}setOptions(t){const e=this.options,n=this.#t;if(this.options=this.#e.defaultQueryOptions(t),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof Vr(this.options.enabled,this.#t)!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");this.#w(),this.#t.setOptions(this.options),e._defaulted&&!rf(this.options,e)&&this.#e.getQueryCache().notify({type:"observerOptionsUpdated",query:this.#t,observer:this});const r=this.hasListeners();r&&Hx(this.#t,n,this.options,e)&&this.#d(),this.updateResult(),r&&(this.#t!==n||Vr(this.options.enabled,this.#t)!==Vr(e.enabled,this.#t)||ma(this.options.staleTime,this.#t)!==ma(e.staleTime,this.#t))&&this.#g();const i=this.#y();r&&(this.#t!==n||Vr(this.options.enabled,this.#t)!==Vr(e.enabled,this.#t)||i!==this.#l)&&this.#_(i)}getOptimisticResult(t){const e=this.#e.getQueryCache().build(this.#e,t),n=this.createResult(e,t);return $j(this,n)&&(this.#s=n,this.#a=this.options,this.#r=this.#t.state),n}getCurrentResult(){return this.#s}trackResult(t,e){return new Proxy(t,{get:(n,r)=>(this.trackProp(r),e?.(r),r==="promise"&&(this.trackProp("data"),!this.options.experimental_prefetchInRender&&this.#o.status==="pending"&&this.#o.reject(new Error("experimental_prefetchInRender feature flag is not enabled"))),Reflect.get(n,r))})}trackProp(t){this.#m.add(t)}getCurrentQuery(){return this.#t}refetch({...t}={}){return this.fetch({...t})}fetchOptimistic(t){const e=this.#e.defaultQueryOptions(t),n=this.#e.getQueryCache().build(this.#e,e);return n.fetch().then(()=>this.createResult(n,e))}fetch(t){return this.#d({...t,cancelRefetch:t.cancelRefetch??!0}).then(()=>(this.updateResult(),this.#s))}#d(t){this.#w();let e=this.#t.fetch(this.options,t);return t?.throwOnError||(e=e.catch(sr)),e}#g(){this.#v();const t=ma(this.options.staleTime,this.#t);if(Eo||this.#s.isStale||!Xg(t))return;const n=jS(this.#s.dataUpdatedAt,t)+1;this.#c=_o.setTimeout(()=>{this.#s.isStale||this.updateResult()},n)}#y(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(this.#t):this.options.refetchInterval)??!1}#_(t){this.#x(),this.#l=t,!(Eo||Vr(this.options.enabled,this.#t)===!1||!Xg(this.#l)||this.#l===0)&&(this.#u=_o.setInterval(()=>{(this.options.refetchIntervalInBackground||Vy.isFocused())&&this.#d()},this.#l))}#b(){this.#g(),this.#_(this.#y())}#v(){this.#c&&(_o.clearTimeout(this.#c),this.#c=void 0)}#x(){this.#u&&(_o.clearInterval(this.#u),this.#u=void 0)}createResult(t,e){const n=this.#t,r=this.options,i=this.#s,o=this.#r,l=this.#a,h=t!==n?t.state:this.#n,{state:m}=t;let p={...m},g=!1,v;if(e._optimisticResults){const R=this.hasListeners(),N=!R&&qx(t,e),V=R&&Hx(t,n,e,r);(N||V)&&(p={...p,...NS(m.data,t.options)}),e._optimisticResults==="isRestoring"&&(p.fetchStatus="idle")}let{error:b,errorUpdatedAt:E,status:x}=p;v=p.data;let S=!1;if(e.placeholderData!==void 0&&v===void 0&&x==="pending"){let R;i?.isPlaceholderData&&e.placeholderData===l?.placeholderData?(R=i.data,S=!0):R=typeof e.placeholderData=="function"?e.placeholderData(this.#f?.state.data,this.#f):e.placeholderData,R!==void 0&&(x="success",v=Jg(i?.data,R,e),g=!0)}if(e.select&&v!==void 0&&!S)if(i&&v===o?.data&&e.select===this.#p)v=this.#h;else try{this.#p=e.select,v=e.select(v),v=Jg(i?.data,v,e),this.#h=v,this.#i=null}catch(R){this.#i=R}this.#i&&(b=this.#i,v=this.#h,E=Date.now(),x="error");const C=p.fetchStatus==="fetching",T=x==="pending",I=x==="error",O=T&&C,U=v!==void 0,k={status:x,fetchStatus:p.fetchStatus,isPending:T,isSuccess:x==="success",isError:I,isInitialLoading:O,isLoading:O,data:v,dataUpdatedAt:p.dataUpdatedAt,error:b,errorUpdatedAt:E,failureCount:p.fetchFailureCount,failureReason:p.fetchFailureReason,errorUpdateCount:p.errorUpdateCount,isFetched:p.dataUpdateCount>0||p.errorUpdateCount>0,isFetchedAfterMount:p.dataUpdateCount>h.dataUpdateCount||p.errorUpdateCount>h.errorUpdateCount,isFetching:C,isRefetching:C&&!T,isLoadingError:I&&!U,isPaused:p.fetchStatus==="paused",isPlaceholderData:g,isRefetchError:I&&U,isStale:$y(t,e),refetch:this.refetch,promise:this.#o,isEnabled:Vr(e.enabled,t)!==!1};if(this.options.experimental_prefetchInRender){const R=H=>{k.status==="error"?H.reject(k.error):k.data!==void 0&&H.resolve(k.data)},N=()=>{const H=this.#o=k.promise=ey();R(H)},V=this.#o;switch(V.status){case"pending":t.queryHash===n.queryHash&&R(V);break;case"fulfilled":(k.status==="error"||k.data!==V.value)&&N();break;case"rejected":(k.status!=="error"||k.error!==V.reason)&&N();break}}return k}updateResult(){const t=this.#s,e=this.createResult(this.#t,this.options);if(this.#r=this.#t.state,this.#a=this.options,this.#r.data!==void 0&&(this.#f=this.#t),rf(e,t))return;this.#s=e;const n=()=>{if(!t)return!0;const{notifyOnChangeProps:r}=this.options,i=typeof r=="function"?r():r;if(i==="all"||!i&&!this.#m.size)return!0;const o=new Set(i??this.#m);return this.options.throwOnError&&o.add("error"),Object.keys(this.#s).some(l=>{const d=l;return this.#s[d]!==t[d]&&o.has(d)})};this.#S({listeners:n()})}#w(){const t=this.#e.getQueryCache().build(this.#e,this.options);if(t===this.#t)return;const e=this.#t;this.#t=t,this.#n=t.state,this.hasListeners()&&(e?.removeObserver(this),t.addObserver(this))}onQueryUpdate(){this.updateResult(),this.hasListeners()&&this.#b()}#S(t){En.batch(()=>{t.listeners&&this.listeners.forEach(e=>{e(this.#s)}),this.#e.getQueryCache().notify({query:this.#t,type:"observerResultsUpdated"})})}};function Vj(t,e){return Vr(e.enabled,t)!==!1&&t.state.data===void 0&&!(t.state.status==="error"&&e.retryOnMount===!1)}function qx(t,e){return Vj(t,e)||t.state.data!==void 0&&ny(t,e,e.refetchOnMount)}function ny(t,e,n){if(Vr(e.enabled,t)!==!1&&ma(e.staleTime,t)!=="static"){const r=typeof n=="function"?n(t):n;return r==="always"||r!==!1&&$y(t,e)}return!1}function Hx(t,e,n,r){return(t!==e||Vr(r.enabled,t)===!1)&&(!n.suspense||t.state.status!=="error")&&$y(t,n)}function $y(t,e){return Vr(e.enabled,t)!==!1&&t.isStaleByTime(ma(e.staleTime,t))}function $j(t,e){return!rf(t.getCurrentResult(),e)}function Gx(t){return{onFetch:(e,n)=>{const r=e.options,i=e.fetchOptions?.meta?.fetchMore?.direction,o=e.state.data?.pages||[],l=e.state.data?.pageParams||[];let d={pages:[],pageParams:[]},h=0;const m=async()=>{let p=!1;const g=E=>{Object.defineProperty(E,"signal",{enumerable:!0,get:()=>(e.signal.aborted?p=!0:e.signal.addEventListener("abort",()=>{p=!0}),e.signal)})},v=IS(e.options,e.fetchOptions),b=async(E,x,S)=>{if(p)return Promise.reject();if(x==null&&E.pages.length)return Promise.resolve(E);const T=(()=>{const $={client:e.client,queryKey:e.queryKey,pageParam:x,direction:S?"backward":"forward",meta:e.options.meta};return g($),$})(),I=await v(T),{maxPages:O}=e.options,U=S?Oj:Mj;return{pages:U(E.pages,I,O),pageParams:U(E.pageParams,x,O)}};if(i&&o.length){const E=i==="backward",x=E?qj:Qx,S={pages:o,pageParams:l},C=x(r,S);d=await b(S,C,E)}else{const E=t??o.length;do{const x=h===0?l[0]??r.initialPageParam:Qx(r,d);if(h>0&&x==null)break;d=await b(d,x),h++}while(h<E)}return d};e.options.persister?e.fetchFn=()=>e.options.persister?.(m,{client:e.client,queryKey:e.queryKey,meta:e.options.meta,signal:e.signal},n):e.fetchFn=m}}}function Qx(t,{pages:e,pageParams:n}){const r=e.length-1;return e.length>0?t.getNextPageParam(e[r],e,n[r],n):void 0}function qj(t,{pages:e,pageParams:n}){return e.length>0?t.getPreviousPageParam?.(e[0],e,n[0],n):void 0}var Hj=class extends OS{#e;#t;#n;#s;constructor(e){super(),this.#e=e.client,this.mutationId=e.mutationId,this.#n=e.mutationCache,this.#t=[],this.state=e.state||PS(),this.setOptions(e.options),this.scheduleGc()}setOptions(e){this.options=e,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(e){this.#t.includes(e)||(this.#t.push(e),this.clearGcTimeout(),this.#n.notify({type:"observerAdded",mutation:this,observer:e}))}removeObserver(e){this.#t=this.#t.filter(n=>n!==e),this.scheduleGc(),this.#n.notify({type:"observerRemoved",mutation:this,observer:e})}optionalRemove(){this.#t.length||(this.state.status==="pending"?this.scheduleGc():this.#n.remove(this))}continue(){return this.#s?.continue()??this.execute(this.state.variables)}async execute(e){const n=()=>{this.#r({type:"continue"})},r={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};this.#s=MS({fn:()=>this.options.mutationFn?this.options.mutationFn(e,r):Promise.reject(new Error("No mutationFn found")),onFail:(l,d)=>{this.#r({type:"failed",failureCount:l,error:d})},onPause:()=>{this.#r({type:"pause"})},onContinue:n,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>this.#n.canRun(this)});const i=this.state.status==="pending",o=!this.#s.canStart();try{if(i)n();else{this.#r({type:"pending",variables:e,isPaused:o}),await this.#n.config.onMutate?.(e,this,r);const d=await this.options.onMutate?.(e,r);d!==this.state.context&&this.#r({type:"pending",context:d,variables:e,isPaused:o})}const l=await this.#s.start();return await this.#n.config.onSuccess?.(l,e,this.state.context,this,r),await this.options.onSuccess?.(l,e,this.state.context,r),await this.#n.config.onSettled?.(l,null,this.state.variables,this.state.context,this,r),await this.options.onSettled?.(l,null,e,this.state.context,r),this.#r({type:"success",data:l}),l}catch(l){try{throw await this.#n.config.onError?.(l,e,this.state.context,this,r),await this.options.onError?.(l,e,this.state.context,r),await this.#n.config.onSettled?.(void 0,l,this.state.variables,this.state.context,this,r),await this.options.onSettled?.(void 0,l,e,this.state.context,r),l}finally{this.#r({type:"error",error:l})}}finally{this.#n.runNext(this)}}#r(e){const n=r=>{switch(e.type){case"failed":return{...r,failureCount:e.failureCount,failureReason:e.error};case"pause":return{...r,isPaused:!0};case"continue":return{...r,isPaused:!1};case"pending":return{...r,context:e.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:e.isPaused,status:"pending",variables:e.variables,submittedAt:Date.now()};case"success":return{...r,data:e.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...r,data:void 0,error:e.error,failureCount:r.failureCount+1,failureReason:e.error,isPaused:!1,status:"error"}}};this.state=n(this.state),En.batch(()=>{this.#t.forEach(r=>{r.onMutationUpdate(e)}),this.#n.notify({mutation:this,type:"updated",action:e})})}};function PS(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var Gj=class extends tc{constructor(t={}){super(),this.config=t,this.#e=new Set,this.#t=new Map,this.#n=0}#e;#t;#n;build(t,e,n){const r=new Hj({client:t,mutationCache:this,mutationId:++this.#n,options:t.defaultMutationOptions(e),state:n});return this.add(r),r}add(t){this.#e.add(t);const e=Nh(t);if(typeof e=="string"){const n=this.#t.get(e);n?n.push(t):this.#t.set(e,[t])}this.notify({type:"added",mutation:t})}remove(t){if(this.#e.delete(t)){const e=Nh(t);if(typeof e=="string"){const n=this.#t.get(e);if(n)if(n.length>1){const r=n.indexOf(t);r!==-1&&n.splice(r,1)}else n[0]===t&&this.#t.delete(e)}}this.notify({type:"removed",mutation:t})}canRun(t){const e=Nh(t);if(typeof e=="string"){const r=this.#t.get(e)?.find(i=>i.state.status==="pending");return!r||r===t}else return!0}runNext(t){const e=Nh(t);return typeof e=="string"?this.#t.get(e)?.find(r=>r!==t&&r.state.isPaused)?.continue()??Promise.resolve():Promise.resolve()}clear(){En.batch(()=>{this.#e.forEach(t=>{this.notify({type:"removed",mutation:t})}),this.#e.clear(),this.#t.clear()})}getAll(){return Array.from(this.#e)}find(t){const e={exact:!0,...t};return this.getAll().find(n=>Lx(e,n))}findAll(t={}){return this.getAll().filter(e=>Lx(t,e))}notify(t){En.batch(()=>{this.listeners.forEach(e=>{e(t)})})}resumePausedMutations(){const t=this.getAll().filter(e=>e.state.isPaused);return En.batch(()=>Promise.all(t.map(e=>e.continue().catch(sr))))}};function Nh(t){return t.options.scope?.id}var Qj=class extends tc{#e;#t=void 0;#n;#s;constructor(e,n){super(),this.#e=e,this.setOptions(n),this.bindMethods(),this.#r()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){const n=this.options;this.options=this.#e.defaultMutationOptions(e),rf(this.options,n)||this.#e.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#n,observer:this}),n?.mutationKey&&this.options.mutationKey&&Co(n.mutationKey)!==Co(this.options.mutationKey)?this.reset():this.#n?.state.status==="pending"&&this.#n.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#n?.removeObserver(this)}onMutationUpdate(e){this.#r(),this.#a(e)}getCurrentResult(){return this.#t}reset(){this.#n?.removeObserver(this),this.#n=void 0,this.#r(),this.#a()}mutate(e,n){return this.#s=n,this.#n?.removeObserver(this),this.#n=this.#e.getMutationCache().build(this.#e,this.options),this.#n.addObserver(this),this.#n.execute(e)}#r(){const e=this.#n?.state??PS();this.#t={...e,isPending:e.status==="pending",isSuccess:e.status==="success",isError:e.status==="error",isIdle:e.status==="idle",mutate:this.mutate,reset:this.reset}}#a(e){En.batch(()=>{if(this.#s&&this.hasListeners()){const n=this.#t.variables,r=this.#t.context,i={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};e?.type==="success"?(this.#s.onSuccess?.(e.data,n,r,i),this.#s.onSettled?.(e.data,null,n,r,i)):e?.type==="error"&&(this.#s.onError?.(e.error,n,r,i),this.#s.onSettled?.(void 0,e.error,n,r,i))}this.listeners.forEach(n=>{n(this.#t)})})}},Wj=class extends tc{constructor(t={}){super(),this.config=t,this.#e=new Map}#e;build(t,e,n){const r=e.queryKey,i=e.queryHash??Uy(r,e);let o=this.get(i);return o||(o=new Uj({client:t,queryKey:r,queryHash:i,options:t.defaultQueryOptions(e),state:n,defaultOptions:t.getQueryDefaults(r)}),this.add(o)),o}add(t){this.#e.has(t.queryHash)||(this.#e.set(t.queryHash,t),this.notify({type:"added",query:t}))}remove(t){const e=this.#e.get(t.queryHash);e&&(t.destroy(),e===t&&this.#e.delete(t.queryHash),this.notify({type:"removed",query:t}))}clear(){En.batch(()=>{this.getAll().forEach(t=>{this.remove(t)})})}get(t){return this.#e.get(t)}getAll(){return[...this.#e.values()]}find(t){const e={exact:!0,...t};return this.getAll().find(n=>zx(e,n))}findAll(t={}){const e=this.getAll();return Object.keys(t).length>0?e.filter(n=>zx(t,n)):e}notify(t){En.batch(()=>{this.listeners.forEach(e=>{e(t)})})}onFocus(){En.batch(()=>{this.getAll().forEach(t=>{t.onFocus()})})}onOnline(){En.batch(()=>{this.getAll().forEach(t=>{t.onOnline()})})}},Kj=class{#e;#t;#n;#s;#r;#a;#o;#i;constructor(t={}){this.#e=t.queryCache||new Wj,this.#t=t.mutationCache||new Gj,this.#n=t.defaultOptions||{},this.#s=new Map,this.#r=new Map,this.#a=0}mount(){this.#a++,this.#a===1&&(this.#o=Vy.subscribe(async t=>{t&&(await this.resumePausedMutations(),this.#e.onFocus())}),this.#i=sf.subscribe(async t=>{t&&(await this.resumePausedMutations(),this.#e.onOnline())}))}unmount(){this.#a--,this.#a===0&&(this.#o?.(),this.#o=void 0,this.#i?.(),this.#i=void 0)}isFetching(t){return this.#e.findAll({...t,fetchStatus:"fetching"}).length}isMutating(t){return this.#t.findAll({...t,status:"pending"}).length}getQueryData(t){const e=this.defaultQueryOptions({queryKey:t});return this.#e.get(e.queryHash)?.state.data}ensureQueryData(t){const e=this.defaultQueryOptions(t),n=this.#e.build(this,e),r=n.state.data;return r===void 0?this.fetchQuery(t):(t.revalidateIfStale&&n.isStaleByTime(ma(e.staleTime,n))&&this.prefetchQuery(e),Promise.resolve(r))}getQueriesData(t){return this.#e.findAll(t).map(({queryKey:e,state:n})=>{const r=n.data;return[e,r]})}setQueryData(t,e,n){const r=this.defaultQueryOptions({queryKey:t}),o=this.#e.get(r.queryHash)?.state.data,l=Ij(e,o);if(l!==void 0)return this.#e.build(this,r).setData(l,{...n,manual:!0})}setQueriesData(t,e,n){return En.batch(()=>this.#e.findAll(t).map(({queryKey:r})=>[r,this.setQueryData(r,e,n)]))}getQueryState(t){const e=this.defaultQueryOptions({queryKey:t});return this.#e.get(e.queryHash)?.state}removeQueries(t){const e=this.#e;En.batch(()=>{e.findAll(t).forEach(n=>{e.remove(n)})})}resetQueries(t,e){const n=this.#e;return En.batch(()=>(n.findAll(t).forEach(r=>{r.reset()}),this.refetchQueries({type:"active",...t},e)))}cancelQueries(t,e={}){const n={revert:!0,...e},r=En.batch(()=>this.#e.findAll(t).map(i=>i.cancel(n)));return Promise.all(r).then(sr).catch(sr)}invalidateQueries(t,e={}){return En.batch(()=>(this.#e.findAll(t).forEach(n=>{n.invalidate()}),t?.refetchType==="none"?Promise.resolve():this.refetchQueries({...t,type:t?.refetchType??t?.type??"active"},e)))}refetchQueries(t,e={}){const n={...e,cancelRefetch:e.cancelRefetch??!0},r=En.batch(()=>this.#e.findAll(t).filter(i=>!i.isDisabled()&&!i.isStatic()).map(i=>{let o=i.fetch(void 0,n);return n.throwOnError||(o=o.catch(sr)),i.state.fetchStatus==="paused"?Promise.resolve():o}));return Promise.all(r).then(sr)}fetchQuery(t){const e=this.defaultQueryOptions(t);e.retry===void 0&&(e.retry=!1);const n=this.#e.build(this,e);return n.isStaleByTime(ma(e.staleTime,n))?n.fetch(e):Promise.resolve(n.state.data)}prefetchQuery(t){return this.fetchQuery(t).then(sr).catch(sr)}fetchInfiniteQuery(t){return t.behavior=Gx(t.pages),this.fetchQuery(t)}prefetchInfiniteQuery(t){return this.fetchInfiniteQuery(t).then(sr).catch(sr)}ensureInfiniteQueryData(t){return t.behavior=Gx(t.pages),this.ensureQueryData(t)}resumePausedMutations(){return sf.isOnline()?this.#t.resumePausedMutations():Promise.resolve()}getQueryCache(){return this.#e}getMutationCache(){return this.#t}getDefaultOptions(){return this.#n}setDefaultOptions(t){this.#n=t}setQueryDefaults(t,e){this.#s.set(Co(t),{queryKey:t,defaultOptions:e})}getQueryDefaults(t){const e=[...this.#s.values()],n={};return e.forEach(r=>{ku(t,r.queryKey)&&Object.assign(n,r.defaultOptions)}),n}setMutationDefaults(t,e){this.#r.set(Co(t),{mutationKey:t,defaultOptions:e})}getMutationDefaults(t){const e=[...this.#r.values()],n={};return e.forEach(r=>{ku(t,r.mutationKey)&&Object.assign(n,r.defaultOptions)}),n}defaultQueryOptions(t){if(t._defaulted)return t;const e={...this.#n.queries,...this.getQueryDefaults(t.queryKey),...t,_defaulted:!0};return e.queryHash||(e.queryHash=Uy(e.queryKey,e)),e.refetchOnReconnect===void 0&&(e.refetchOnReconnect=e.networkMode!=="always"),e.throwOnError===void 0&&(e.throwOnError=!!e.suspense),!e.networkMode&&e.persister&&(e.networkMode="offlineFirst"),e.queryFn===Fy&&(e.enabled=!1),e}defaultMutationOptions(t){return t?._defaulted?t:{...this.#n.mutations,...t?.mutationKey&&this.getMutationDefaults(t.mutationKey),...t,_defaulted:!0}}clear(){this.#e.clear(),this.#t.clear()}},BS=D.createContext(void 0),Ft=t=>{const e=D.useContext(BS);if(!e)throw new Error("No QueryClient set, use QueryClientProvider to set one");return e},Yj=({client:t,children:e})=>(D.useEffect(()=>(t.mount(),()=>{t.unmount()}),[t]),u.jsx(BS.Provider,{value:t,children:e})),zS=D.createContext(!1),Xj=()=>D.useContext(zS);zS.Provider;function Zj(){let t=!1;return{clearReset:()=>{t=!1},reset:()=>{t=!0},isReset:()=>t}}var Jj=D.createContext(Zj()),eR=()=>D.useContext(Jj),tR=(t,e)=>{(t.suspense||t.throwOnError||t.experimental_prefetchInRender)&&(e.isReset()||(t.retryOnMount=!1))},nR=t=>{D.useEffect(()=>{t.clearReset()},[t])},rR=({result:t,errorResetBoundary:e,throwOnError:n,query:r,suspense:i})=>t.isError&&!e.isReset()&&!t.isFetching&&r&&(i&&t.data===void 0||kS(n,[t.error,r])),sR=t=>{if(t.suspense){const n=i=>i==="static"?i:Math.max(i??1e3,1e3),r=t.staleTime;t.staleTime=typeof r=="function"?(...i)=>n(r(...i)):n(r),typeof t.gcTime=="number"&&(t.gcTime=Math.max(t.gcTime,1e3))}},iR=(t,e)=>t.isLoading&&t.isFetching&&!e,aR=(t,e)=>t?.suspense&&e.isPending,Wx=(t,e,n)=>e.fetchOptimistic(t).catch(()=>{n.clearReset()});function oR(t,e,n){const r=Xj(),i=eR(),o=Ft(),l=o.defaultQueryOptions(t);o.getDefaultOptions().queries?._experimental_beforeQuery?.(l),l._optimisticResults=r?"isRestoring":"optimistic",sR(l),tR(l,i),nR(i);const d=!o.getQueryCache().get(l.queryHash),[h]=D.useState(()=>new e(o,l)),m=h.getOptimisticResult(l),p=!r&&t.subscribed!==!1;if(D.useSyncExternalStore(D.useCallback(g=>{const v=p?h.subscribe(En.batchCalls(g)):sr;return h.updateResult(),v},[h,p]),()=>h.getCurrentResult(),()=>h.getCurrentResult()),D.useEffect(()=>{h.setOptions(l)},[l,h]),aR(l,m))throw Wx(l,h,i);if(rR({result:m,errorResetBoundary:i,throwOnError:l.throwOnError,query:o.getQueryCache().get(l.queryHash),suspense:l.suspense}))throw m.error;return o.getDefaultOptions().queries?._experimental_afterQuery?.(l,m),l.experimental_prefetchInRender&&!Eo&&iR(m,r)&&(d?Wx(l,h,i):o.getQueryCache().get(l.queryHash)?.promise)?.catch(sr).finally(()=>{h.updateResult()}),l.notifyOnChangeProps?m:h.trackResult(m)}function ko(t,e){return oR(t,Fj)}function Hn(t,e){const n=Ft(),[r]=D.useState(()=>new Qj(n,t));D.useEffect(()=>{r.setOptions(t)},[r,t]);const i=D.useSyncExternalStore(D.useCallback(l=>r.subscribe(En.batchCalls(l)),[r]),()=>r.getCurrentResult(),()=>r.getCurrentResult()),o=D.useCallback((l,d)=>{r.mutate(l,d).catch(sr)},[r]);if(i.error&&kS(r.options.throwOnError,[i.error]))throw i.error;return{...i,mutate:o,mutateAsync:i.mutate}}const lR={isLoading:!1,loadingMessage:"Loading...",addLoadingHold:()=>{},removeLoadingHold:()=>{}},LS=D.createContext(lR);function cR({children:t}){const[e,n]=D.useState(new Map),r=D.useCallback((h,m)=>{n(p=>new Map(p).set(h,m))},[]),i=D.useCallback(h=>{n(m=>{const p=new Map(m);return p.delete(h),p})},[]),o=e.size>0,l=e.size>0&&Array.from(e.values()).pop()||"Loading...",d={isLoading:o,loadingMessage:l,addLoadingHold:r,removeLoadingHold:i};return u.jsx(LS.Provider,{value:d,children:t})}function Gn(){const t=D.useContext(LS);if(!t)throw new Error("useApp must be used within an AppProvider");return t}const uR=()=>{};var Kx={};const US=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let i=t.charCodeAt(r);i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=i&63|128):(i&64512)===55296&&r+1<t.length&&(t.charCodeAt(r+1)&64512)===56320?(i=65536+((i&1023)<<10)+(t.charCodeAt(++r)&1023),e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=i&63|128):(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=i&63|128)}return e},dR=function(t){const e=[];let n=0,r=0;for(;n<t.length;){const i=t[n++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){const o=t[n++];e[r++]=String.fromCharCode((i&31)<<6|o&63)}else if(i>239&&i<365){const o=t[n++],l=t[n++],d=t[n++],h=((i&7)<<18|(o&63)<<12|(l&63)<<6|d&63)-65536;e[r++]=String.fromCharCode(55296+(h>>10)),e[r++]=String.fromCharCode(56320+(h&1023))}else{const o=t[n++],l=t[n++];e[r++]=String.fromCharCode((i&15)<<12|(o&63)<<6|l&63)}}return e.join("")},FS={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<t.length;i+=3){const o=t[i],l=i+1<t.length,d=l?t[i+1]:0,h=i+2<t.length,m=h?t[i+2]:0,p=o>>2,g=(o&3)<<4|d>>4;let v=(d&15)<<2|m>>6,b=m&63;h||(b=64,l||(v=64)),r.push(n[p],n[g],n[v],n[b])}return r.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(US(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):dR(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<t.length;){const o=n[t.charAt(i++)],d=i<t.length?n[t.charAt(i)]:0;++i;const m=i<t.length?n[t.charAt(i)]:64;++i;const g=i<t.length?n[t.charAt(i)]:64;if(++i,o==null||d==null||m==null||g==null)throw new hR;const v=o<<2|d>>4;if(r.push(v),m!==64){const b=d<<4&240|m>>2;if(r.push(b),g!==64){const E=m<<6&192|g;r.push(E)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class hR extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const fR=function(t){const e=US(t);return FS.encodeByteArray(e,!0)},af=function(t){return fR(t).replace(/\./g,"")},VS=function(t){try{return FS.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function mR(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const pR=()=>mR().__FIREBASE_DEFAULTS__,gR=()=>{if(typeof process>"u"||typeof Kx>"u")return;const t=Kx.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},yR=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&VS(t[1]);return e&&JSON.parse(e)},Uf=()=>{try{return uR()||pR()||gR()||yR()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},$S=t=>Uf()?.emulatorHosts?.[t],_R=t=>{const e=$S(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(n+1),10);return e[0]==="["?[e.substring(1,n-1),r]:[e.substring(0,n),r]},qS=()=>Uf()?.config,HS=t=>Uf()?.[`_${t}`];class bR{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,r)=>{n?this.reject(n):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,r))}}}function nc(t){try{return(t.startsWith("http://")||t.startsWith("https://")?new URL(t).hostname:t).endsWith(".cloudworkstations.dev")}catch{return!1}}async function GS(t){return(await fetch(t,{credentials:"include"})).ok}function vR(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n={alg:"none",type:"JWT"},r=e||"demo-project",i=t.iat||0,o=t.sub||t.user_id;if(!o)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const l={iss:`https://securetoken.google.com/${r}`,aud:r,iat:i,exp:i+3600,auth_time:i,sub:o,user_id:o,firebase:{sign_in_provider:"custom",identities:{}},...t};return[af(JSON.stringify(n)),af(JSON.stringify(l)),""].join(".")}const Eu={};function xR(){const t={prod:[],emulator:[]};for(const e of Object.keys(Eu))Eu[e]?t.emulator.push(e):t.prod.push(e);return t}function wR(t){let e=document.getElementById(t),n=!1;return e||(e=document.createElement("div"),e.setAttribute("id",t),n=!0),{created:n,element:e}}let Yx=!1;function QS(t,e){if(typeof window>"u"||typeof document>"u"||!nc(window.location.host)||Eu[t]===e||Eu[t]||Yx)return;Eu[t]=e;function n(v){return`__firebase__banner__${v}`}const r="__firebase__banner",o=xR().prod.length>0;function l(){const v=document.getElementById(r);v&&v.remove()}function d(v){v.style.display="flex",v.style.background="#7faaf0",v.style.position="fixed",v.style.bottom="5px",v.style.left="5px",v.style.padding=".5em",v.style.borderRadius="5px",v.style.alignItems="center"}function h(v,b){v.setAttribute("width","24"),v.setAttribute("id",b),v.setAttribute("height","24"),v.setAttribute("viewBox","0 0 24 24"),v.setAttribute("fill","none"),v.style.marginLeft="-6px"}function m(){const v=document.createElement("span");return v.style.cursor="pointer",v.style.marginLeft="16px",v.style.fontSize="24px",v.innerHTML=" &times;",v.onclick=()=>{Yx=!0,l()},v}function p(v,b){v.setAttribute("id",b),v.innerText="Learn more",v.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",v.setAttribute("target","__blank"),v.style.paddingLeft="5px",v.style.textDecoration="underline"}function g(){const v=wR(r),b=n("text"),E=document.getElementById(b)||document.createElement("span"),x=n("learnmore"),S=document.getElementById(x)||document.createElement("a"),C=n("preprendIcon"),T=document.getElementById(C)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(v.created){const I=v.element;d(I),p(S,x);const O=m();h(T,C),I.append(T,E,S,O),document.body.appendChild(I)}o?(E.innerText="Preview backend disconnected.",T.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(T.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,E.innerText="Preview backend running in this workspace."),E.setAttribute("id",b)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",g):g()}function Jn(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function SR(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Jn())}function ER(){const t=Uf()?.forceEnvironment;if(t==="node")return!0;if(t==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function CR(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function TR(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function AR(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function jR(){const t=Jn();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function RR(){return!ER()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function IR(){try{return typeof indexedDB=="object"}catch{return!1}}function kR(){return new Promise((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{e(i.error?.message||"")}}catch(n){e(n)}})}const DR="FirebaseError";class Si extends Error{constructor(e,n,r){super(n),this.code=e,this.customData=r,this.name=DR,Object.setPrototypeOf(this,Si.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Wu.prototype.create)}}class Wu{constructor(e,n,r){this.service=e,this.serviceName=n,this.errors=r}create(e,...n){const r=n[0]||{},i=`${this.service}/${e}`,o=this.errors[e],l=o?MR(o,r):"Error",d=`${this.serviceName}: ${l} (${i}).`;return new Si(i,d,r)}}function MR(t,e){return t.replace(OR,(n,r)=>{const i=e[r];return i!=null?String(i):`<${r}?>`})}const OR=/\{\$([^}]+)}/g;function NR(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function gi(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const i of n){if(!r.includes(i))return!1;const o=t[i],l=e[i];if(Xx(o)&&Xx(l)){if(!gi(o,l))return!1}else if(o!==l)return!1}for(const i of r)if(!n.includes(i))return!1;return!0}function Xx(t){return t!==null&&typeof t=="object"}function Ku(t){const e=[];for(const[n,r]of Object.entries(t))Array.isArray(r)?r.forEach(i=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function _u(t){const e={};return t.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[i,o]=r.split("=");e[decodeURIComponent(i)]=decodeURIComponent(o)}}),e}function bu(t){const e=t.indexOf("?");if(!e)return"";const n=t.indexOf("#",e);return t.substring(e,n>0?n:void 0)}function PR(t,e){const n=new BR(t,e);return n.subscribe.bind(n)}class BR{constructor(e,n){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(n=>{n.next(e)})}error(e){this.forEachObserver(n=>{n.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,n,r){let i;if(e===void 0&&n===void 0&&r===void 0)throw new Error("Missing Observer.");zR(e,["next","error","complete"])?i=e:i={next:e,error:n,complete:r},i.next===void 0&&(i.next=jg),i.error===void 0&&(i.error=jg),i.complete===void 0&&(i.complete=jg);const o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),o}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let n=0;n<this.observers.length;n++)this.sendOne(n,e)}sendOne(e,n){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{n(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function zR(t,e){if(typeof t!="object"||t===null)return!1;for(const n of e)if(n in t&&typeof t[n]=="function")return!0;return!1}function jg(){}function vn(t){return t&&t._delegate?t._delegate:t}class To{constructor(e,n,r){this.name=e,this.instanceFactory=n,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const go="[DEFAULT]";class LR{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){const r=new bR;if(this.instancesDeferred.set(n,r),this.isInitialized(n)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:n});i&&r.resolve(i)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){const n=this.normalizeInstanceIdentifier(e?.identifier),r=e?.optional??!1;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(i){if(r)return null;throw i}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(FR(e))try{this.getOrInitializeService({instanceIdentifier:go})}catch{}for(const[n,r]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(n);try{const o=this.getOrInitializeService({instanceIdentifier:i});r.resolve(o)}catch{}}}}clearInstance(e=go){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=go){return this.instances.has(e)}getOptions(e=go){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:n={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:r,options:n});for(const[o,l]of this.instancesDeferred.entries()){const d=this.normalizeInstanceIdentifier(o);r===d&&l.resolve(i)}return i}onInit(e,n){const r=this.normalizeInstanceIdentifier(n),i=this.onInitCallbacks.get(r)??new Set;i.add(e),this.onInitCallbacks.set(r,i);const o=this.instances.get(r);return o&&e(o,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,n){const r=this.onInitCallbacks.get(n);if(r)for(const i of r)try{i(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:UR(e),options:n}),this.instances.set(e,r),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=go){return this.component?this.component.multipleInstances?e:go:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function UR(t){return t===go?void 0:t}function FR(t){return t.instantiationMode==="EAGER"}class VR{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const n=new LR(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}}var ht;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(ht||(ht={}));const $R={debug:ht.DEBUG,verbose:ht.VERBOSE,info:ht.INFO,warn:ht.WARN,error:ht.ERROR,silent:ht.SILENT},qR=ht.INFO,HR={[ht.DEBUG]:"log",[ht.VERBOSE]:"log",[ht.INFO]:"info",[ht.WARN]:"warn",[ht.ERROR]:"error"},GR=(t,e,...n)=>{if(e<t.logLevel)return;const r=new Date().toISOString(),i=HR[e];if(i)console[i](`[${r}]  ${t.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class qy{constructor(e){this.name=e,this._logLevel=qR,this._logHandler=GR,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in ht))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?$R[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,ht.DEBUG,...e),this._logHandler(this,ht.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,ht.VERBOSE,...e),this._logHandler(this,ht.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,ht.INFO,...e),this._logHandler(this,ht.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,ht.WARN,...e),this._logHandler(this,ht.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,ht.ERROR,...e),this._logHandler(this,ht.ERROR,...e)}}const QR=(t,e)=>e.some(n=>t instanceof n);let Zx,Jx;function WR(){return Zx||(Zx=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function KR(){return Jx||(Jx=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const WS=new WeakMap,ry=new WeakMap,KS=new WeakMap,Rg=new WeakMap,Hy=new WeakMap;function YR(t){const e=new Promise((n,r)=>{const i=()=>{t.removeEventListener("success",o),t.removeEventListener("error",l)},o=()=>{n(pa(t.result)),i()},l=()=>{r(t.error),i()};t.addEventListener("success",o),t.addEventListener("error",l)});return e.then(n=>{n instanceof IDBCursor&&WS.set(n,t)}).catch(()=>{}),Hy.set(e,t),e}function XR(t){if(ry.has(t))return;const e=new Promise((n,r)=>{const i=()=>{t.removeEventListener("complete",o),t.removeEventListener("error",l),t.removeEventListener("abort",l)},o=()=>{n(),i()},l=()=>{r(t.error||new DOMException("AbortError","AbortError")),i()};t.addEventListener("complete",o),t.addEventListener("error",l),t.addEventListener("abort",l)});ry.set(t,e)}let sy={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return ry.get(t);if(e==="objectStoreNames")return t.objectStoreNames||KS.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return pa(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function ZR(t){sy=t(sy)}function JR(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const r=t.call(Ig(this),e,...n);return KS.set(r,e.sort?e.sort():[e]),pa(r)}:KR().includes(t)?function(...e){return t.apply(Ig(this),e),pa(WS.get(this))}:function(...e){return pa(t.apply(Ig(this),e))}}function eI(t){return typeof t=="function"?JR(t):(t instanceof IDBTransaction&&XR(t),QR(t,WR())?new Proxy(t,sy):t)}function pa(t){if(t instanceof IDBRequest)return YR(t);if(Rg.has(t))return Rg.get(t);const e=eI(t);return e!==t&&(Rg.set(t,e),Hy.set(e,t)),e}const Ig=t=>Hy.get(t);function tI(t,e,{blocked:n,upgrade:r,blocking:i,terminated:o}={}){const l=indexedDB.open(t,e),d=pa(l);return r&&l.addEventListener("upgradeneeded",h=>{r(pa(l.result),h.oldVersion,h.newVersion,pa(l.transaction),h)}),n&&l.addEventListener("blocked",h=>n(h.oldVersion,h.newVersion,h)),d.then(h=>{o&&h.addEventListener("close",()=>o()),i&&h.addEventListener("versionchange",m=>i(m.oldVersion,m.newVersion,m))}).catch(()=>{}),d}const nI=["get","getKey","getAll","getAllKeys","count"],rI=["put","add","delete","clear"],kg=new Map;function ew(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(kg.get(e))return kg.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,i=rI.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(i||nI.includes(n)))return;const o=async function(l,...d){const h=this.transaction(l,i?"readwrite":"readonly");let m=h.store;return r&&(m=m.index(d.shift())),(await Promise.all([m[n](...d),i&&h.done]))[0]};return kg.set(e,o),o}ZR(t=>({...t,get:(e,n,r)=>ew(e,n)||t.get(e,n,r),has:(e,n)=>!!ew(e,n)||t.has(e,n)}));class sI{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(iI(n)){const r=n.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(n=>n).join(" ")}}function iI(t){return t.getComponent()?.type==="VERSION"}const iy="@firebase/app",tw="0.14.6";const yi=new qy("@firebase/app"),aI="@firebase/app-compat",oI="@firebase/analytics-compat",lI="@firebase/analytics",cI="@firebase/app-check-compat",uI="@firebase/app-check",dI="@firebase/auth",hI="@firebase/auth-compat",fI="@firebase/database",mI="@firebase/data-connect",pI="@firebase/database-compat",gI="@firebase/functions",yI="@firebase/functions-compat",_I="@firebase/installations",bI="@firebase/installations-compat",vI="@firebase/messaging",xI="@firebase/messaging-compat",wI="@firebase/performance",SI="@firebase/performance-compat",EI="@firebase/remote-config",CI="@firebase/remote-config-compat",TI="@firebase/storage",AI="@firebase/storage-compat",jI="@firebase/firestore",RI="@firebase/ai",II="@firebase/firestore-compat",kI="firebase",DI="12.6.0";const ay="[DEFAULT]",MI={[iy]:"fire-core",[aI]:"fire-core-compat",[lI]:"fire-analytics",[oI]:"fire-analytics-compat",[uI]:"fire-app-check",[cI]:"fire-app-check-compat",[dI]:"fire-auth",[hI]:"fire-auth-compat",[fI]:"fire-rtdb",[mI]:"fire-data-connect",[pI]:"fire-rtdb-compat",[gI]:"fire-fn",[yI]:"fire-fn-compat",[_I]:"fire-iid",[bI]:"fire-iid-compat",[vI]:"fire-fcm",[xI]:"fire-fcm-compat",[wI]:"fire-perf",[SI]:"fire-perf-compat",[EI]:"fire-rc",[CI]:"fire-rc-compat",[TI]:"fire-gcs",[AI]:"fire-gcs-compat",[jI]:"fire-fst",[II]:"fire-fst-compat",[RI]:"fire-vertex","fire-js":"fire-js",[kI]:"fire-js-all"};const of=new Map,OI=new Map,oy=new Map;function nw(t,e){try{t.container.addComponent(e)}catch(n){yi.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function Fl(t){const e=t.name;if(oy.has(e))return yi.debug(`There were multiple attempts to register component ${e}.`),!1;oy.set(e,t);for(const n of of.values())nw(n,t);for(const n of OI.values())nw(n,t);return!0}function Gy(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function ss(t){return t==null?!1:t.settings!==void 0}const NI={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},ga=new Wu("app","Firebase",NI);class PI{constructor(e,n,r){this._isDeleted=!1,this._options={...e},this._config={...n},this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new To("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw ga.create("app-deleted",{appName:this._name})}}const rc=DI;function YS(t,e={}){let n=t;typeof e!="object"&&(e={name:e});const r={name:ay,automaticDataCollectionEnabled:!0,...e},i=r.name;if(typeof i!="string"||!i)throw ga.create("bad-app-name",{appName:String(i)});if(n||(n=qS()),!n)throw ga.create("no-options");const o=of.get(i);if(o){if(gi(n,o.options)&&gi(r,o.config))return o;throw ga.create("duplicate-app",{appName:i})}const l=new VR(i);for(const h of oy.values())l.addComponent(h);const d=new PI(n,r,l);return of.set(i,d),d}function XS(t=ay){const e=of.get(t);if(!e&&t===ay&&qS())return YS();if(!e)throw ga.create("no-app",{appName:t});return e}function ya(t,e,n){let r=MI[t]??t;n&&(r+=`-${n}`);const i=r.match(/\s|\//),o=e.match(/\s|\//);if(i||o){const l=[`Unable to register library "${r}" with version "${e}":`];i&&l.push(`library name "${r}" contains illegal characters (whitespace or "/")`),i&&o&&l.push("and"),o&&l.push(`version name "${e}" contains illegal characters (whitespace or "/")`),yi.warn(l.join(" "));return}Fl(new To(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}const BI="firebase-heartbeat-database",zI=1,Du="firebase-heartbeat-store";let Dg=null;function ZS(){return Dg||(Dg=tI(BI,zI,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(Du)}catch(n){console.warn(n)}}}}).catch(t=>{throw ga.create("idb-open",{originalErrorMessage:t.message})})),Dg}async function LI(t){try{const n=(await ZS()).transaction(Du),r=await n.objectStore(Du).get(JS(t));return await n.done,r}catch(e){if(e instanceof Si)yi.warn(e.message);else{const n=ga.create("idb-get",{originalErrorMessage:e?.message});yi.warn(n.message)}}}async function rw(t,e){try{const r=(await ZS()).transaction(Du,"readwrite");await r.objectStore(Du).put(e,JS(t)),await r.done}catch(n){if(n instanceof Si)yi.warn(n.message);else{const r=ga.create("idb-set",{originalErrorMessage:n?.message});yi.warn(r.message)}}}function JS(t){return`${t.name}!${t.options.appId}`}const UI=1024,FI=30;class VI{constructor(e){this.container=e,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new qI(n),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){try{const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=sw();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(i=>i.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:n}),this._heartbeatsCache.heartbeats.length>FI){const i=HI(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(i,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){yi.warn(e)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const e=sw(),{heartbeatsToSend:n,unsentEntries:r}=$I(this._heartbeatsCache.heartbeats),i=af(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(e){return yi.warn(e),""}}}function sw(){return new Date().toISOString().substring(0,10)}function $I(t,e=UI){const n=[];let r=t.slice();for(const i of t){const o=n.find(l=>l.agent===i.agent);if(o){if(o.dates.push(i.date),iw(n)>e){o.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),iw(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}class qI{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return IR()?kR().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const n=await LI(this.app);return n?.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return rw(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return rw(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function iw(t){return af(JSON.stringify({version:2,heartbeats:t})).length}function HI(t){if(t.length===0)return-1;let e=0,n=t[0].date;for(let r=1;r<t.length;r++)t[r].date<n&&(n=t[r].date,e=r);return e}function GI(t){Fl(new To("platform-logger",e=>new sI(e),"PRIVATE")),Fl(new To("heartbeat",e=>new VI(e),"PRIVATE")),ya(iy,tw,t),ya(iy,tw,"esm2020"),ya("fire-js","")}GI("");function eE(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const QI=eE,tE=new Wu("auth","Firebase",eE());const lf=new qy("@firebase/auth");function WI(t,...e){lf.logLevel<=ht.WARN&&lf.warn(`Auth (${rc}): ${t}`,...e)}function Gh(t,...e){lf.logLevel<=ht.ERROR&&lf.error(`Auth (${rc}): ${t}`,...e)}function cs(t,...e){throw Qy(t,...e)}function zs(t,...e){return Qy(t,...e)}function nE(t,e,n){const r={...QI(),[e]:n};return new Wu("auth","Firebase",r).create(e,{appName:t.name})}function _a(t){return nE(t,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Qy(t,...e){if(typeof t!="string"){const n=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=t.name),t._errorFactory.create(n,...r)}return tE.create(t,...e)}function We(t,e,...n){if(!t)throw Qy(e,...n)}function di(t){const e="INTERNAL ASSERTION FAILED: "+t;throw Gh(e),new Error(e)}function _i(t,e){t||di(e)}function ly(){return typeof self<"u"&&self.location?.href||""}function KI(){return aw()==="http:"||aw()==="https:"}function aw(){return typeof self<"u"&&self.location?.protocol||null}function YI(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(KI()||TR()||"connection"in navigator)?navigator.onLine:!0}function XI(){if(typeof navigator>"u")return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}class Yu{constructor(e,n){this.shortDelay=e,this.longDelay=n,_i(n>e,"Short delay should be less than long delay!"),this.isMobile=SR()||AR()}get(){return YI()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function Wy(t,e){_i(t.emulator,"Emulator should always be set here");const{url:n}=t.emulator;return e?`${n}${e.startsWith("/")?e.slice(1):e}`:n}class rE{static initialize(e,n,r){this.fetchImpl=e,n&&(this.headersImpl=n),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;di("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;di("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;di("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const ZI={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};const JI=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],ek=new Yu(3e4,6e4);function Do(t,e){return t.tenantId&&!e.tenantId?{...e,tenantId:t.tenantId}:e}async function ka(t,e,n,r,i={}){return sE(t,i,async()=>{let o={},l={};r&&(e==="GET"?l=r:o={body:JSON.stringify(r)});const d=Ku({key:t.config.apiKey,...l}).slice(1),h=await t._getAdditionalHeaders();h["Content-Type"]="application/json",t.languageCode&&(h["X-Firebase-Locale"]=t.languageCode);const m={method:e,headers:h,...o};return CR()||(m.referrerPolicy="no-referrer"),t.emulatorConfig&&nc(t.emulatorConfig.host)&&(m.credentials="include"),rE.fetch()(await iE(t,t.config.apiHost,n,d),m)})}async function sE(t,e,n){t._canInitEmulator=!1;const r={...ZI,...e};try{const i=new nk(t),o=await Promise.race([n(),i.promise]);i.clearNetworkTimeout();const l=await o.json();if("needConfirmation"in l)throw Ph(t,"account-exists-with-different-credential",l);if(o.ok&&!("errorMessage"in l))return l;{const d=o.ok?l.errorMessage:l.error.message,[h,m]=d.split(" : ");if(h==="FEDERATED_USER_ID_ALREADY_LINKED")throw Ph(t,"credential-already-in-use",l);if(h==="EMAIL_EXISTS")throw Ph(t,"email-already-in-use",l);if(h==="USER_DISABLED")throw Ph(t,"user-disabled",l);const p=r[h]||h.toLowerCase().replace(/[_\s]+/g,"-");if(m)throw nE(t,p,m);cs(t,p)}}catch(i){if(i instanceof Si)throw i;cs(t,"network-request-failed",{message:String(i)})}}async function Ff(t,e,n,r,i={}){const o=await ka(t,e,n,r,i);return"mfaPendingCredential"in o&&cs(t,"multi-factor-auth-required",{_serverResponse:o}),o}async function iE(t,e,n,r){const i=`${e}${n}?${r}`,o=t,l=o.config.emulator?Wy(t.config,i):`${t.config.apiScheme}://${i}`;return JI.includes(n)&&(await o._persistenceManagerAvailable,o._getPersistenceType()==="COOKIE")?o._getPersistence()._getFinalTarget(l).toString():l}function tk(t){switch(t){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class nk{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((n,r)=>{this.timer=setTimeout(()=>r(zs(this.auth,"network-request-failed")),ek.get())})}}function Ph(t,e,n){const r={appName:t.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const i=zs(t,e,r);return i.customData._tokenResponse=n,i}function ow(t){return t!==void 0&&t.enterprise!==void 0}class rk{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const n of this.recaptchaEnforcementState)if(n.provider&&n.provider===e)return tk(n.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function sk(t,e){return ka(t,"GET","/v2/recaptchaConfig",Do(t,e))}async function ik(t,e){return ka(t,"POST","/v1/accounts:delete",e)}async function cf(t,e){return ka(t,"POST","/v1/accounts:lookup",e)}function Cu(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function ak(t,e=!1){const n=vn(t),r=await n.getIdToken(e),i=Ky(r);We(i&&i.exp&&i.auth_time&&i.iat,n.auth,"internal-error");const o=typeof i.firebase=="object"?i.firebase:void 0,l=o?.sign_in_provider;return{claims:i,token:r,authTime:Cu(Mg(i.auth_time)),issuedAtTime:Cu(Mg(i.iat)),expirationTime:Cu(Mg(i.exp)),signInProvider:l||null,signInSecondFactor:o?.sign_in_second_factor||null}}function Mg(t){return Number(t)*1e3}function Ky(t){const[e,n,r]=t.split(".");if(e===void 0||n===void 0||r===void 0)return Gh("JWT malformed, contained fewer than 3 sections"),null;try{const i=VS(n);return i?JSON.parse(i):(Gh("Failed to decode base64 JWT payload"),null)}catch(i){return Gh("Caught error parsing JWT payload as JSON",i?.toString()),null}}function lw(t){const e=Ky(t);return We(e,"internal-error"),We(typeof e.exp<"u","internal-error"),We(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}async function Mu(t,e,n=!1){if(n)return e;try{return await e}catch(r){throw r instanceof Si&&ok(r)&&t.auth.currentUser===t&&await t.auth.signOut(),r}}function ok({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}class lk{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const n=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),n}else{this.errorBackoff=3e4;const r=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;const n=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},n)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class cy{constructor(e,n){this.createdAt=e,this.lastLoginAt=n,this._initializeTime()}_initializeTime(){this.lastSignInTime=Cu(this.lastLoginAt),this.creationTime=Cu(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function uf(t){const e=t.auth,n=await t.getIdToken(),r=await Mu(t,cf(e,{idToken:n}));We(r?.users.length,e,"internal-error");const i=r.users[0];t._notifyReloadListener(i);const o=i.providerUserInfo?.length?aE(i.providerUserInfo):[],l=uk(t.providerData,o),d=t.isAnonymous,h=!(t.email&&i.passwordHash)&&!l?.length,m=d?h:!1,p={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:l,metadata:new cy(i.createdAt,i.lastLoginAt),isAnonymous:m};Object.assign(t,p)}async function ck(t){const e=vn(t);await uf(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function uk(t,e){return[...t.filter(r=>!e.some(i=>i.providerId===r.providerId)),...e]}function aE(t){return t.map(({providerId:e,...n})=>({providerId:e,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}))}async function dk(t,e){const n=await sE(t,{},async()=>{const r=Ku({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:o}=t.config,l=await iE(t,i,"/v1/token",`key=${o}`),d=await t._getAdditionalHeaders();d["Content-Type"]="application/x-www-form-urlencoded";const h={method:"POST",headers:d,body:r};return t.emulatorConfig&&nc(t.emulatorConfig.host)&&(h.credentials="include"),rE.fetch()(l,h)});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}async function hk(t,e){return ka(t,"POST","/v2/accounts:revokeToken",Do(t,e))}class Nl{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){We(e.idToken,"internal-error"),We(typeof e.idToken<"u","internal-error"),We(typeof e.refreshToken<"u","internal-error");const n="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):lw(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,n)}updateFromIdToken(e){We(e.length!==0,"internal-error");const n=lw(e);this.updateTokensAndExpiration(e,null,n)}async getToken(e,n=!1){return!n&&this.accessToken&&!this.isExpired?this.accessToken:(We(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,n){const{accessToken:r,refreshToken:i,expiresIn:o}=await dk(e,n);this.updateTokensAndExpiration(r,i,Number(o))}updateTokensAndExpiration(e,n,r){this.refreshToken=n||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,n){const{refreshToken:r,accessToken:i,expirationTime:o}=n,l=new Nl;return r&&(We(typeof r=="string","internal-error",{appName:e}),l.refreshToken=r),i&&(We(typeof i=="string","internal-error",{appName:e}),l.accessToken=i),o&&(We(typeof o=="number","internal-error",{appName:e}),l.expirationTime=o),l}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Nl,this.toJSON())}_performRefresh(){return di("not implemented")}}function sa(t,e){We(typeof t=="string"||typeof t>"u","internal-error",{appName:e})}class is{constructor({uid:e,auth:n,stsTokenManager:r,...i}){this.providerId="firebase",this.proactiveRefresh=new lk(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new cy(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const n=await Mu(this,this.stsTokenManager.getToken(this.auth,e));return We(n,this.auth,"internal-error"),this.accessToken!==n&&(this.accessToken=n,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),n}getIdTokenResult(e){return ak(this,e)}reload(){return ck(this)}_assign(e){this!==e&&(We(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(n=>({...n})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const n=new is({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return n.metadata._copy(this.metadata),n}_onReload(e){We(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,n=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),n&&await uf(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(ss(this.auth.app))return Promise.reject(_a(this.auth));const e=await this.getIdToken();return await Mu(this,ik(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,n){const r=n.displayName??void 0,i=n.email??void 0,o=n.phoneNumber??void 0,l=n.photoURL??void 0,d=n.tenantId??void 0,h=n._redirectEventId??void 0,m=n.createdAt??void 0,p=n.lastLoginAt??void 0,{uid:g,emailVerified:v,isAnonymous:b,providerData:E,stsTokenManager:x}=n;We(g&&x,e,"internal-error");const S=Nl.fromJSON(this.name,x);We(typeof g=="string",e,"internal-error"),sa(r,e.name),sa(i,e.name),We(typeof v=="boolean",e,"internal-error"),We(typeof b=="boolean",e,"internal-error"),sa(o,e.name),sa(l,e.name),sa(d,e.name),sa(h,e.name),sa(m,e.name),sa(p,e.name);const C=new is({uid:g,auth:e,email:i,emailVerified:v,displayName:r,isAnonymous:b,photoURL:l,phoneNumber:o,tenantId:d,stsTokenManager:S,createdAt:m,lastLoginAt:p});return E&&Array.isArray(E)&&(C.providerData=E.map(T=>({...T}))),h&&(C._redirectEventId=h),C}static async _fromIdTokenResponse(e,n,r=!1){const i=new Nl;i.updateFromServerResponse(n);const o=new is({uid:n.localId,auth:e,stsTokenManager:i,isAnonymous:r});return await uf(o),o}static async _fromGetAccountInfoResponse(e,n,r){const i=n.users[0];We(i.localId!==void 0,"internal-error");const o=i.providerUserInfo!==void 0?aE(i.providerUserInfo):[],l=!(i.email&&i.passwordHash)&&!o?.length,d=new Nl;d.updateFromIdToken(r);const h=new is({uid:i.localId,auth:e,stsTokenManager:d,isAnonymous:l}),m={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:o,metadata:new cy(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!o?.length};return Object.assign(h,m),h}}const cw=new Map;function hi(t){_i(t instanceof Function,"Expected a class definition");let e=cw.get(t);return e?(_i(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,cw.set(t,e),e)}class oE{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,n){this.storage[e]=n}async _get(e){const n=this.storage[e];return n===void 0?null:n}async _remove(e){delete this.storage[e]}_addListener(e,n){}_removeListener(e,n){}}oE.type="NONE";const uw=oE;function Qh(t,e,n){return`firebase:${t}:${e}:${n}`}class Pl{constructor(e,n,r){this.persistence=e,this.auth=n,this.userKey=r;const{config:i,name:o}=this.auth;this.fullUserKey=Qh(this.userKey,i.apiKey,o),this.fullPersistenceKey=Qh("persistence",i.apiKey,o),this.boundEventHandler=n._onStorageEvent.bind(n),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const n=await cf(this.auth,{idToken:e}).catch(()=>{});return n?is._fromGetAccountInfoResponse(this.auth,n,e):null}return is._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const n=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,n)return this.setCurrentUser(n)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,n,r="authUser"){if(!n.length)return new Pl(hi(uw),e,r);const i=(await Promise.all(n.map(async m=>{if(await m._isAvailable())return m}))).filter(m=>m);let o=i[0]||hi(uw);const l=Qh(r,e.config.apiKey,e.name);let d=null;for(const m of n)try{const p=await m._get(l);if(p){let g;if(typeof p=="string"){const v=await cf(e,{idToken:p}).catch(()=>{});if(!v)break;g=await is._fromGetAccountInfoResponse(e,v,p)}else g=is._fromJSON(e,p);m!==o&&(d=g),o=m;break}}catch{}const h=i.filter(m=>m._shouldAllowMigration);return!o._shouldAllowMigration||!h.length?new Pl(o,e,r):(o=h[0],d&&await o._set(l,d.toJSON()),await Promise.all(n.map(async m=>{if(m!==o)try{await m._remove(l)}catch{}})),new Pl(o,e,r))}}function dw(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(dE(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(lE(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(fE(e))return"Blackberry";if(mE(e))return"Webos";if(cE(e))return"Safari";if((e.includes("chrome/")||uE(e))&&!e.includes("edge/"))return"Chrome";if(hE(e))return"Android";{const n=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=t.match(n);if(r?.length===2)return r[1]}return"Other"}function lE(t=Jn()){return/firefox\//i.test(t)}function cE(t=Jn()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function uE(t=Jn()){return/crios\//i.test(t)}function dE(t=Jn()){return/iemobile/i.test(t)}function hE(t=Jn()){return/android/i.test(t)}function fE(t=Jn()){return/blackberry/i.test(t)}function mE(t=Jn()){return/webos/i.test(t)}function Yy(t=Jn()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function fk(t=Jn()){return Yy(t)&&!!window.navigator?.standalone}function mk(){return jR()&&document.documentMode===10}function pE(t=Jn()){return Yy(t)||hE(t)||mE(t)||fE(t)||/windows phone/i.test(t)||dE(t)}function gE(t,e=[]){let n;switch(t){case"Browser":n=dw(Jn());break;case"Worker":n=`${dw(Jn())}-${t}`;break;default:n=t}const r=e.length?e.join(","):"FirebaseCore-web";return`${n}/JsCore/${rc}/${r}`}class pk{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,n){const r=o=>new Promise((l,d)=>{try{const h=e(o);l(h)}catch(h){d(h)}});r.onAbort=n,this.queue.push(r);const i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const n=[];try{for(const r of this.queue)await r(e),r.onAbort&&n.push(r.onAbort)}catch(r){n.reverse();for(const i of n)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r?.message})}}}async function gk(t,e={}){return ka(t,"GET","/v2/passwordPolicy",Do(t,e))}const yk=6;class _k{constructor(e){const n=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=n.minPasswordLength??yk,n.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=n.maxPasswordLength),n.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=n.containsLowercaseCharacter),n.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=n.containsUppercaseCharacter),n.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=n.containsNumericCharacter),n.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=n.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const n={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,n),this.validatePasswordCharacterOptions(e,n),n.isValid&&(n.isValid=n.meetsMinPasswordLength??!0),n.isValid&&(n.isValid=n.meetsMaxPasswordLength??!0),n.isValid&&(n.isValid=n.containsLowercaseLetter??!0),n.isValid&&(n.isValid=n.containsUppercaseLetter??!0),n.isValid&&(n.isValid=n.containsNumericCharacter??!0),n.isValid&&(n.isValid=n.containsNonAlphanumericCharacter??!0),n}validatePasswordLengthOptions(e,n){const r=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;r&&(n.meetsMinPasswordLength=e.length>=r),i&&(n.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,n){this.updatePasswordCharacterOptionsStatuses(n,!1,!1,!1,!1);let r;for(let i=0;i<e.length;i++)r=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(n,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,n,r,i,o){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=n)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=o))}}class bk{constructor(e,n,r,i){this.app=e,this.heartbeatServiceProvider=n,this.appCheckServiceProvider=r,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new hw(this),this.idTokenSubscription=new hw(this),this.beforeStateQueue=new pk(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=tE,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion,this._persistenceManagerAvailable=new Promise(o=>this._resolvePersistenceManagerAvailable=o)}_initializeWithPersistence(e,n){return n&&(this._popupRedirectResolver=hi(n)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await Pl.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(n),this.lastNotifiedUid=this.currentUser?.uid||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const n=await cf(this,{idToken:e}),r=await is._fromGetAccountInfoResponse(this,n,e);await this.directlySetCurrentUser(r)}catch(n){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",n),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(ss(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(l=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(l,l))}):this.directlySetCurrentUser(null)}const n=await this.assertedPersistence.getCurrentUser();let r=n,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=this.redirectUser?._redirectEventId,l=r?._redirectEventId,d=await this.tryRedirectSignIn(e);(!o||o===l)&&d?.user&&(r=d.user,i=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(r)}catch(o){r=n,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return We(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let n=null;try{n=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return n}async reloadAndSetCurrentUserOrClear(e){try{await uf(e)}catch(n){if(n?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=XI()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(ss(this.app))return Promise.reject(_a(this));const n=e?vn(e):null;return n&&We(n.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(n&&n._clone(this))}async _updateCurrentUser(e,n=!1){if(!this._deleted)return e&&We(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),n||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return ss(this.app)?Promise.reject(_a(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return ss(this.app)?Promise.reject(_a(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(hi(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const n=this._getPasswordPolicyInternal();return n.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):n.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await gk(this),n=new _k(e);this.tenantId===null?this._projectPasswordPolicy=n:this._tenantPasswordPolicies[this.tenantId]=n}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new Wu("auth","Firebase",e())}onAuthStateChanged(e,n,r){return this.registerStateListener(this.authStateSubscription,e,n,r)}beforeAuthStateChanged(e,n){return this.beforeStateQueue.pushCallback(e,n)}onIdTokenChanged(e,n,r){return this.registerStateListener(this.idTokenSubscription,e,n,r)}authStateReady(){return new Promise((e,n)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},n)}})}async revokeAccessToken(e){if(this.currentUser){const n=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:n};this.tenantId!=null&&(r.tenantId=this.tenantId),await hk(this,r)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,n){const r=await this.getOrInitRedirectPersistenceManager(n);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const n=e&&hi(e)||this._popupRedirectResolver;We(n,this,"argument-error"),this.redirectPersistenceManager=await Pl.create(this,[hi(n._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,n,r,i){if(this._deleted)return()=>{};const o=typeof n=="function"?n:n.next.bind(n);let l=!1;const d=this._isInitialized?Promise.resolve():this._initializationPromise;if(We(d,this,"internal-error"),d.then(()=>{l||o(this.currentUser)}),typeof n=="function"){const h=e.addObserver(n,r,i);return()=>{l=!0,h()}}else{const h=e.addObserver(n);return()=>{l=!0,h()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return We(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=gE(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const n=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();n&&(e["X-Firebase-Client"]=n);const r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){if(ss(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&WI(`Error while retrieving App Check token: ${e.error}`),e?.token}}function sc(t){return vn(t)}class hw{constructor(e){this.auth=e,this.observer=null,this.addObserver=PR(n=>this.observer=n)}get next(){return We(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let Vf={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function vk(t){Vf=t}function yE(t){return Vf.loadJS(t)}function xk(){return Vf.recaptchaEnterpriseScript}function wk(){return Vf.gapiScript}function Sk(t){return`__${t}${Math.floor(Math.random()*1e6)}`}class Ek{constructor(){this.enterprise=new Ck}ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}class Ck{ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}const Tk="recaptcha-enterprise",_E="NO_RECAPTCHA";class Ak{constructor(e){this.type=Tk,this.auth=sc(e)}async verify(e="verify",n=!1){async function r(o){if(!n){if(o.tenantId==null&&o._agentRecaptchaConfig!=null)return o._agentRecaptchaConfig.siteKey;if(o.tenantId!=null&&o._tenantRecaptchaConfigs[o.tenantId]!==void 0)return o._tenantRecaptchaConfigs[o.tenantId].siteKey}return new Promise(async(l,d)=>{sk(o,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(h=>{if(h.recaptchaKey===void 0)d(new Error("recaptcha Enterprise site key undefined"));else{const m=new rk(h);return o.tenantId==null?o._agentRecaptchaConfig=m:o._tenantRecaptchaConfigs[o.tenantId]=m,l(m.siteKey)}}).catch(h=>{d(h)})})}function i(o,l,d){const h=window.grecaptcha;ow(h)?h.enterprise.ready(()=>{h.enterprise.execute(o,{action:e}).then(m=>{l(m)}).catch(()=>{l(_E)})}):d(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new Ek().execute("siteKey",{action:"verify"}):new Promise((o,l)=>{r(this.auth).then(d=>{if(!n&&ow(window.grecaptcha))i(d,o,l);else{if(typeof window>"u"){l(new Error("RecaptchaVerifier is only supported in browser"));return}let h=xk();h.length!==0&&(h+=d),yE(h).then(()=>{i(d,o,l)}).catch(m=>{l(m)})}}).catch(d=>{l(d)})})}}async function fw(t,e,n,r=!1,i=!1){const o=new Ak(t);let l;if(i)l=_E;else try{l=await o.verify(n)}catch{l=await o.verify(n,!0)}const d={...e};if(n==="mfaSmsEnrollment"||n==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in d){const h=d.phoneEnrollmentInfo.phoneNumber,m=d.phoneEnrollmentInfo.recaptchaToken;Object.assign(d,{phoneEnrollmentInfo:{phoneNumber:h,recaptchaToken:m,captchaResponse:l,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in d){const h=d.phoneSignInInfo.recaptchaToken;Object.assign(d,{phoneSignInInfo:{recaptchaToken:h,captchaResponse:l,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return d}return r?Object.assign(d,{captchaResp:l}):Object.assign(d,{captchaResponse:l}),Object.assign(d,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(d,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),d}async function mw(t,e,n,r,i){if(t._getRecaptchaConfig()?.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const o=await fw(t,e,n,n==="getOobCode");return r(t,o)}else return r(t,e).catch(async o=>{if(o.code==="auth/missing-recaptcha-token"){console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const l=await fw(t,e,n,n==="getOobCode");return r(t,l)}else return Promise.reject(o)})}function jk(t,e){const n=Gy(t,"auth");if(n.isInitialized()){const i=n.getImmediate(),o=n.getOptions();if(gi(o,e??{}))return i;cs(i,"already-initialized")}return n.initialize({options:e})}function Rk(t,e){const n=e?.persistence||[],r=(Array.isArray(n)?n:[n]).map(hi);e?.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(r,e?.popupRedirectResolver)}function Ik(t,e,n){const r=sc(t);We(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const i=!1,o=bE(e),{host:l,port:d}=kk(e),h=d===null?"":`:${d}`,m={url:`${o}//${l}${h}/`},p=Object.freeze({host:l,port:d,protocol:o.replace(":",""),options:Object.freeze({disableWarnings:i})});if(!r._canInitEmulator){We(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),We(gi(m,r.config.emulator)&&gi(p,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=m,r.emulatorConfig=p,r.settings.appVerificationDisabledForTesting=!0,nc(l)?(GS(`${o}//${l}${h}`),QS("Auth",!0)):Dk()}function bE(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function kk(t){const e=bE(t),n=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){const o=i[1];return{host:o,port:pw(r.substr(o.length+1))}}else{const[o,l]=r.split(":");return{host:o,port:pw(l)}}}function pw(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}function Dk(){function t(){const e=document.createElement("p"),n=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",n.position="fixed",n.width="100%",n.backgroundColor="#ffffff",n.border=".1em solid #000000",n.color="#b50000",n.bottom="0px",n.left="0px",n.margin="0px",n.zIndex="10000",n.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",t):t())}class Xy{constructor(e,n){this.providerId=e,this.signInMethod=n}toJSON(){return di("not implemented")}_getIdTokenResponse(e){return di("not implemented")}_linkToIdToken(e,n){return di("not implemented")}_getReauthenticationResolver(e){return di("not implemented")}}async function Mk(t,e){return ka(t,"POST","/v1/accounts:signUp",e)}async function Ok(t,e){return Ff(t,"POST","/v1/accounts:signInWithPassword",Do(t,e))}async function Nk(t,e){return Ff(t,"POST","/v1/accounts:signInWithEmailLink",Do(t,e))}async function Pk(t,e){return Ff(t,"POST","/v1/accounts:signInWithEmailLink",Do(t,e))}class Ou extends Xy{constructor(e,n,r,i=null){super("password",r),this._email=e,this._password=n,this._tenantId=i}static _fromEmailAndPassword(e,n){return new Ou(e,n,"password")}static _fromEmailAndCode(e,n,r=null){return new Ou(e,n,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e;if(n?.email&&n?.password){if(n.signInMethod==="password")return this._fromEmailAndPassword(n.email,n.password);if(n.signInMethod==="emailLink")return this._fromEmailAndCode(n.email,n.password,n.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const n={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return mw(e,n,"signInWithPassword",Ok);case"emailLink":return Nk(e,{email:this._email,oobCode:this._password});default:cs(e,"internal-error")}}async _linkToIdToken(e,n){switch(this.signInMethod){case"password":const r={idToken:n,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return mw(e,r,"signUpPassword",Mk);case"emailLink":return Pk(e,{idToken:n,email:this._email,oobCode:this._password});default:cs(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function Bl(t,e){return Ff(t,"POST","/v1/accounts:signInWithIdp",Do(t,e))}const Bk="http://localhost";class Ao extends Xy{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const n=new Ao(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(n.idToken=e.idToken),e.accessToken&&(n.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(n.nonce=e.nonce),e.pendingToken&&(n.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(n.accessToken=e.oauthToken,n.secret=e.oauthTokenSecret):cs("argument-error"),n}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:i,...o}=n;if(!r||!i)return null;const l=new Ao(r,i);return l.idToken=o.idToken||void 0,l.accessToken=o.accessToken||void 0,l.secret=o.secret,l.nonce=o.nonce,l.pendingToken=o.pendingToken||null,l}_getIdTokenResponse(e){const n=this.buildRequest();return Bl(e,n)}_linkToIdToken(e,n){const r=this.buildRequest();return r.idToken=n,Bl(e,r)}_getReauthenticationResolver(e){const n=this.buildRequest();return n.autoCreate=!1,Bl(e,n)}buildRequest(){const e={requestUri:Bk,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const n={};this.idToken&&(n.id_token=this.idToken),this.accessToken&&(n.access_token=this.accessToken),this.secret&&(n.oauth_token_secret=this.secret),n.providerId=this.providerId,this.nonce&&!this.pendingToken&&(n.nonce=this.nonce),e.postBody=Ku(n)}return e}}function zk(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function Lk(t){const e=_u(bu(t)).link,n=e?_u(bu(e)).deep_link_id:null,r=_u(bu(t)).deep_link_id;return(r?_u(bu(r)).link:null)||r||n||e||t}class Zy{constructor(e){const n=_u(bu(e)),r=n.apiKey??null,i=n.oobCode??null,o=zk(n.mode??null);We(r&&i&&o,"argument-error"),this.apiKey=r,this.operation=o,this.code=i,this.continueUrl=n.continueUrl??null,this.languageCode=n.lang??null,this.tenantId=n.tenantId??null}static parseLink(e){const n=Lk(e);try{return new Zy(n)}catch{return null}}}class ic{constructor(){this.providerId=ic.PROVIDER_ID}static credential(e,n){return Ou._fromEmailAndPassword(e,n)}static credentialWithLink(e,n){const r=Zy.parseLink(n);return We(r,"argument-error"),Ou._fromEmailAndCode(e,r.code,r.tenantId)}}ic.PROVIDER_ID="password";ic.EMAIL_PASSWORD_SIGN_IN_METHOD="password";ic.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class vE{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class Xu extends vE{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class oa extends Xu{constructor(){super("facebook.com")}static credential(e){return Ao._fromParams({providerId:oa.PROVIDER_ID,signInMethod:oa.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return oa.credentialFromTaggedObject(e)}static credentialFromError(e){return oa.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return oa.credential(e.oauthAccessToken)}catch{return null}}}oa.FACEBOOK_SIGN_IN_METHOD="facebook.com";oa.PROVIDER_ID="facebook.com";class la extends Xu{constructor(){super("google.com"),this.addScope("profile")}static credential(e,n){return Ao._fromParams({providerId:la.PROVIDER_ID,signInMethod:la.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:n})}static credentialFromResult(e){return la.credentialFromTaggedObject(e)}static credentialFromError(e){return la.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:n,oauthAccessToken:r}=e;if(!n&&!r)return null;try{return la.credential(n,r)}catch{return null}}}la.GOOGLE_SIGN_IN_METHOD="google.com";la.PROVIDER_ID="google.com";class ca extends Xu{constructor(){super("github.com")}static credential(e){return Ao._fromParams({providerId:ca.PROVIDER_ID,signInMethod:ca.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return ca.credentialFromTaggedObject(e)}static credentialFromError(e){return ca.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return ca.credential(e.oauthAccessToken)}catch{return null}}}ca.GITHUB_SIGN_IN_METHOD="github.com";ca.PROVIDER_ID="github.com";class ua extends Xu{constructor(){super("twitter.com")}static credential(e,n){return Ao._fromParams({providerId:ua.PROVIDER_ID,signInMethod:ua.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:n})}static credentialFromResult(e){return ua.credentialFromTaggedObject(e)}static credentialFromError(e){return ua.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:n,oauthTokenSecret:r}=e;if(!n||!r)return null;try{return ua.credential(n,r)}catch{return null}}}ua.TWITTER_SIGN_IN_METHOD="twitter.com";ua.PROVIDER_ID="twitter.com";class Vl{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,n,r,i=!1){const o=await is._fromIdTokenResponse(e,r,i),l=gw(r);return new Vl({user:o,providerId:l,_tokenResponse:r,operationType:n})}static async _forOperation(e,n,r){await e._updateTokensIfNecessary(r,!0);const i=gw(r);return new Vl({user:e,providerId:i,_tokenResponse:r,operationType:n})}}function gw(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}class df extends Si{constructor(e,n,r,i){super(n.code,n.message),this.operationType=r,this.user=i,Object.setPrototypeOf(this,df.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:n.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,n,r,i){return new df(e,n,r,i)}}function xE(t,e,n,r){return(e==="reauthenticate"?n._getReauthenticationResolver(t):n._getIdTokenResponse(t)).catch(o=>{throw o.code==="auth/multi-factor-auth-required"?df._fromErrorAndOperation(t,o,e,r):o})}async function Uk(t,e,n=!1){const r=await Mu(t,e._linkToIdToken(t.auth,await t.getIdToken()),n);return Vl._forOperation(t,"link",r)}async function Fk(t,e,n=!1){const{auth:r}=t;if(ss(r.app))return Promise.reject(_a(r));const i="reauthenticate";try{const o=await Mu(t,xE(r,i,e,t),n);We(o.idToken,r,"internal-error");const l=Ky(o.idToken);We(l,r,"internal-error");const{sub:d}=l;return We(t.uid===d,r,"user-mismatch"),Vl._forOperation(t,i,o)}catch(o){throw o?.code==="auth/user-not-found"&&cs(r,"user-mismatch"),o}}async function wE(t,e,n=!1){if(ss(t.app))return Promise.reject(_a(t));const r="signIn",i=await xE(t,r,e),o=await Vl._fromIdTokenResponse(t,r,i);return n||await t._updateCurrentUser(o.user),o}async function Vk(t,e){return wE(sc(t),e)}async function $k(t){const e=sc(t);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}function qk(t,e,n){return ss(t.app)?Promise.reject(_a(t)):Vk(vn(t),ic.credential(e,n)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&$k(t),r})}function Hk(t,e,n,r){return vn(t).onIdTokenChanged(e,n,r)}function Gk(t,e,n){return vn(t).beforeAuthStateChanged(e,n)}function Qk(t,e,n,r){return vn(t).onAuthStateChanged(e,n,r)}function Wk(t){return vn(t).signOut()}const hf="__sak";class SE{constructor(e,n){this.storageRetriever=e,this.type=n}_isAvailable(){try{return this.storage?(this.storage.setItem(hf,"1"),this.storage.removeItem(hf),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,n){return this.storage.setItem(e,JSON.stringify(n)),Promise.resolve()}_get(e){const n=this.storage.getItem(e);return Promise.resolve(n?JSON.parse(n):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}const Kk=1e3,Yk=10;class EE extends SE{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,n)=>this.onStorageEvent(e,n),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=pE(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const n of Object.keys(this.listeners)){const r=this.storage.getItem(n),i=this.localCache[n];r!==i&&e(n,i,r)}}onStorageEvent(e,n=!1){if(!e.key){this.forAllChangedKeys((l,d,h)=>{this.notifyListeners(l,h)});return}const r=e.key;n?this.detachListener():this.stopPolling();const i=()=>{const l=this.storage.getItem(r);!n&&this.localCache[r]===l||this.notifyListeners(r,l)},o=this.storage.getItem(r);mk()&&o!==e.newValue&&e.newValue!==e.oldValue?setTimeout(i,Yk):i()}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const i of Array.from(r))i(n&&JSON.parse(n))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,n,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:n,newValue:r}),!0)})},Kk)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,n){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,n){await super._set(e,n),this.localCache[e]=JSON.stringify(n)}async _get(e){const n=await super._get(e);return this.localCache[e]=JSON.stringify(n),n}async _remove(e){await super._remove(e),delete this.localCache[e]}}EE.type="LOCAL";const Xk=EE;class CE extends SE{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,n){}_removeListener(e,n){}}CE.type="SESSION";const TE=CE;function Zk(t){return Promise.all(t.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(n){return{fulfilled:!1,reason:n}}}))}class $f{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const n=this.receivers.find(i=>i.isListeningto(e));if(n)return n;const r=new $f(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const n=e,{eventId:r,eventType:i,data:o}=n.data,l=this.handlersMap[i];if(!l?.size)return;n.ports[0].postMessage({status:"ack",eventId:r,eventType:i});const d=Array.from(l).map(async m=>m(n.origin,o)),h=await Zk(d);n.ports[0].postMessage({status:"done",eventId:r,eventType:i,response:h})}_subscribe(e,n){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(n)}_unsubscribe(e,n){this.handlersMap[e]&&n&&this.handlersMap[e].delete(n),(!n||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}$f.receivers=[];function Jy(t="",e=10){let n="";for(let r=0;r<e;r++)n+=Math.floor(Math.random()*10);return t+n}class Jk{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,n,r=50){const i=typeof MessageChannel<"u"?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let o,l;return new Promise((d,h)=>{const m=Jy("",20);i.port1.start();const p=setTimeout(()=>{h(new Error("unsupported_event"))},r);l={messageChannel:i,onMessage(g){const v=g;if(v.data.eventId===m)switch(v.data.status){case"ack":clearTimeout(p),o=setTimeout(()=>{h(new Error("timeout"))},3e3);break;case"done":clearTimeout(o),d(v.data.response);break;default:clearTimeout(p),clearTimeout(o),h(new Error("invalid_response"));break}}},this.handlers.add(l),i.port1.addEventListener("message",l.onMessage),this.target.postMessage({eventType:e,eventId:m,data:n},[i.port2])}).finally(()=>{l&&this.removeMessageHandler(l)})}}function Ls(){return window}function eD(t){Ls().location.href=t}function AE(){return typeof Ls().WorkerGlobalScope<"u"&&typeof Ls().importScripts=="function"}async function tD(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function nD(){return navigator?.serviceWorker?.controller||null}function rD(){return AE()?self:null}const jE="firebaseLocalStorageDb",sD=1,ff="firebaseLocalStorage",RE="fbase_key";class Zu{constructor(e){this.request=e}toPromise(){return new Promise((e,n)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{n(this.request.error)})})}}function qf(t,e){return t.transaction([ff],e?"readwrite":"readonly").objectStore(ff)}function iD(){const t=indexedDB.deleteDatabase(jE);return new Zu(t).toPromise()}function uy(){const t=indexedDB.open(jE,sD);return new Promise((e,n)=>{t.addEventListener("error",()=>{n(t.error)}),t.addEventListener("upgradeneeded",()=>{const r=t.result;try{r.createObjectStore(ff,{keyPath:RE})}catch(i){n(i)}}),t.addEventListener("success",async()=>{const r=t.result;r.objectStoreNames.contains(ff)?e(r):(r.close(),await iD(),e(await uy()))})})}async function yw(t,e,n){const r=qf(t,!0).put({[RE]:e,value:n});return new Zu(r).toPromise()}async function aD(t,e){const n=qf(t,!1).get(e),r=await new Zu(n).toPromise();return r===void 0?null:r.value}function _w(t,e){const n=qf(t,!0).delete(e);return new Zu(n).toPromise()}const oD=800,lD=3;class IE{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await uy(),this.db)}async _withRetries(e){let n=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(n++>lD)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return AE()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=$f._getInstance(rD()),this.receiver._subscribe("keyChanged",async(e,n)=>({keyProcessed:(await this._poll()).includes(n.key)})),this.receiver._subscribe("ping",async(e,n)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await tD(),!this.activeServiceWorker)return;this.sender=new Jk(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||nD()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await uy();return await yw(e,hf,"1"),await _w(e,hf),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,n){return this._withPendingWrite(async()=>(await this._withRetries(r=>yw(r,e,n)),this.localCache[e]=n,this.notifyServiceWorker(e)))}async _get(e){const n=await this._withRetries(r=>aD(r,e));return this.localCache[e]=n,n}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(n=>_w(n,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(i=>{const o=qf(i,!1).getAll();return new Zu(o).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const n=[],r=new Set;if(e.length!==0)for(const{fbase_key:i,value:o}of e)r.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(o)&&(this.notifyListeners(i,o),n.push(i));for(const i of Object.keys(this.localCache))this.localCache[i]&&!r.has(i)&&(this.notifyListeners(i,null),n.push(i));return n}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const i of Array.from(r))i(n)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),oD)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,n){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}IE.type="LOCAL";const cD=IE;new Yu(3e4,6e4);function uD(t,e){return e?hi(e):(We(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}class e0 extends Xy{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Bl(e,this._buildIdpRequest())}_linkToIdToken(e,n){return Bl(e,this._buildIdpRequest(n))}_getReauthenticationResolver(e){return Bl(e,this._buildIdpRequest())}_buildIdpRequest(e){const n={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(n.idToken=e),n}}function dD(t){return wE(t.auth,new e0(t),t.bypassAuthState)}function hD(t){const{auth:e,user:n}=t;return We(n,e,"internal-error"),Fk(n,new e0(t),t.bypassAuthState)}async function fD(t){const{auth:e,user:n}=t;return We(n,e,"internal-error"),Uk(n,new e0(t),t.bypassAuthState)}class kE{constructor(e,n,r,i,o=!1){this.auth=e,this.resolver=r,this.user=i,this.bypassAuthState=o,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(n)?n:[n]}execute(){return new Promise(async(e,n)=>{this.pendingPromise={resolve:e,reject:n};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:n,sessionId:r,postBody:i,tenantId:o,error:l,type:d}=e;if(l){this.reject(l);return}const h={auth:this.auth,requestUri:n,sessionId:r,tenantId:o||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(d)(h))}catch(m){this.reject(m)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return dD;case"linkViaPopup":case"linkViaRedirect":return fD;case"reauthViaPopup":case"reauthViaRedirect":return hD;default:cs(this.auth,"internal-error")}}resolve(e){_i(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){_i(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const mD=new Yu(2e3,1e4);class Ol extends kE{constructor(e,n,r,i,o){super(e,n,i,o),this.provider=r,this.authWindow=null,this.pollId=null,Ol.currentPopupAction&&Ol.currentPopupAction.cancel(),Ol.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return We(e,this.auth,"internal-error"),e}async onExecution(){_i(this.filter.length===1,"Popup operations only handle one event");const e=Jy();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(n=>{this.reject(n)}),this.resolver._isIframeWebStorageSupported(this.auth,n=>{n||this.reject(zs(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(zs(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Ol.currentPopupAction=null}pollUserCancellation(){const e=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(zs(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,mD.get())};e()}}Ol.currentPopupAction=null;const pD="pendingRedirect",Wh=new Map;class gD extends kE{constructor(e,n,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],n,void 0,r),this.eventId=null}async execute(){let e=Wh.get(this.auth._key());if(!e){try{const r=await yD(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(n){e=()=>Promise.reject(n)}Wh.set(this.auth._key(),e)}return this.bypassAuthState||Wh.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const n=await this.auth._redirectUserForId(e.eventId);if(n)return this.user=n,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function yD(t,e){const n=vD(e),r=bD(t);if(!await r._isAvailable())return!1;const i=await r._get(n)==="true";return await r._remove(n),i}function _D(t,e){Wh.set(t._key(),e)}function bD(t){return hi(t._redirectPersistence)}function vD(t){return Qh(pD,t.config.apiKey,t.name)}async function xD(t,e,n=!1){if(ss(t.app))return Promise.reject(_a(t));const r=sc(t),i=uD(r,e),l=await new gD(r,i,n).execute();return l&&!n&&(delete l.user._redirectEventId,await r._persistUserIfCurrent(l.user),await r._setRedirectUser(null,e)),l}const wD=600*1e3;class SD{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let n=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(n=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!ED(e)||(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=e,n=!0)),n}sendToConsumer(e,n){if(e.error&&!DE(e)){const r=e.error.code?.split("auth/")[1]||"internal-error";n.onError(zs(this.auth,r))}else n.onAuthEvent(e)}isEventForConsumer(e,n){const r=n.eventId===null||!!e.eventId&&e.eventId===n.eventId;return n.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=wD&&this.cachedEventUids.clear(),this.cachedEventUids.has(bw(e))}saveEventToCache(e){this.cachedEventUids.add(bw(e)),this.lastProcessedEventTime=Date.now()}}function bw(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(e=>e).join("-")}function DE({type:t,error:e}){return t==="unknown"&&e?.code==="auth/no-auth-event"}function ED(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return DE(t);default:return!1}}async function CD(t,e={}){return ka(t,"GET","/v1/projects",e)}const TD=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,AD=/^https?/;async function jD(t){if(t.config.emulator)return;const{authorizedDomains:e}=await CD(t);for(const n of e)try{if(RD(n))return}catch{}cs(t,"unauthorized-domain")}function RD(t){const e=ly(),{protocol:n,hostname:r}=new URL(e);if(t.startsWith("chrome-extension://")){const l=new URL(t);return l.hostname===""&&r===""?n==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):n==="chrome-extension:"&&l.hostname===r}if(!AD.test(n))return!1;if(TD.test(t))return r===t;const i=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}const ID=new Yu(3e4,6e4);function vw(){const t=Ls().___jsl;if(t?.H){for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let n=0;n<t.CP.length;n++)t.CP[n]=null}}function kD(t){return new Promise((e,n)=>{function r(){vw(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{vw(),n(zs(t,"network-request-failed"))},timeout:ID.get()})}if(Ls().gapi?.iframes?.Iframe)e(gapi.iframes.getContext());else if(Ls().gapi?.load)r();else{const i=Sk("iframefcb");return Ls()[i]=()=>{gapi.load?r():n(zs(t,"network-request-failed"))},yE(`${wk()}?onload=${i}`).catch(o=>n(o))}}).catch(e=>{throw Kh=null,e})}let Kh=null;function DD(t){return Kh=Kh||kD(t),Kh}const MD=new Yu(5e3,15e3),OD="__/auth/iframe",ND="emulator/auth/iframe",PD={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},BD=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function zD(t){const e=t.config;We(e.authDomain,t,"auth-domain-config-required");const n=e.emulator?Wy(e,ND):`https://${t.config.authDomain}/${OD}`,r={apiKey:e.apiKey,appName:t.name,v:rc},i=BD.get(t.config.apiHost);i&&(r.eid=i);const o=t._getFrameworks();return o.length&&(r.fw=o.join(",")),`${n}?${Ku(r).slice(1)}`}async function LD(t){const e=await DD(t),n=Ls().gapi;return We(n,t,"internal-error"),e.open({where:document.body,url:zD(t),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:PD,dontclear:!0},r=>new Promise(async(i,o)=>{await r.restyle({setHideOnLeave:!1});const l=zs(t,"network-request-failed"),d=Ls().setTimeout(()=>{o(l)},MD.get());function h(){Ls().clearTimeout(d),i(r)}r.ping(h).then(h,()=>{o(l)})}))}const UD={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},FD=500,VD=600,$D="_blank",qD="http://localhost";class xw{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function HD(t,e,n,r=FD,i=VD){const o=Math.max((window.screen.availHeight-i)/2,0).toString(),l=Math.max((window.screen.availWidth-r)/2,0).toString();let d="";const h={...UD,width:r.toString(),height:i.toString(),top:o,left:l},m=Jn().toLowerCase();n&&(d=uE(m)?$D:n),lE(m)&&(e=e||qD,h.scrollbars="yes");const p=Object.entries(h).reduce((v,[b,E])=>`${v}${b}=${E},`,"");if(fk(m)&&d!=="_self")return GD(e||"",d),new xw(null);const g=window.open(e||"",d,p);We(g,t,"popup-blocked");try{g.focus()}catch{}return new xw(g)}function GD(t,e){const n=document.createElement("a");n.href=t,n.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}const QD="__/auth/handler",WD="emulator/auth/handler",KD=encodeURIComponent("fac");async function ww(t,e,n,r,i,o){We(t.config.authDomain,t,"auth-domain-config-required"),We(t.config.apiKey,t,"invalid-api-key");const l={apiKey:t.config.apiKey,appName:t.name,authType:n,redirectUrl:r,v:rc,eventId:i};if(e instanceof vE){e.setDefaultLanguage(t.languageCode),l.providerId=e.providerId||"",NR(e.getCustomParameters())||(l.customParameters=JSON.stringify(e.getCustomParameters()));for(const[p,g]of Object.entries({}))l[p]=g}if(e instanceof Xu){const p=e.getScopes().filter(g=>g!=="");p.length>0&&(l.scopes=p.join(","))}t.tenantId&&(l.tid=t.tenantId);const d=l;for(const p of Object.keys(d))d[p]===void 0&&delete d[p];const h=await t._getAppCheckToken(),m=h?`#${KD}=${encodeURIComponent(h)}`:"";return`${YD(t)}?${Ku(d).slice(1)}${m}`}function YD({config:t}){return t.emulator?Wy(t,WD):`https://${t.authDomain}/${QD}`}const Og="webStorageSupport";class XD{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=TE,this._completeRedirectFn=xD,this._overrideRedirectResult=_D}async _openPopup(e,n,r,i){_i(this.eventManagers[e._key()]?.manager,"_initialize() not called before _openPopup()");const o=await ww(e,n,r,ly(),i);return HD(e,o,Jy())}async _openRedirect(e,n,r,i){await this._originValidation(e);const o=await ww(e,n,r,ly(),i);return eD(o),new Promise(()=>{})}_initialize(e){const n=e._key();if(this.eventManagers[n]){const{manager:i,promise:o}=this.eventManagers[n];return i?Promise.resolve(i):(_i(o,"If manager is not set, promise should be"),o)}const r=this.initAndGetManager(e);return this.eventManagers[n]={promise:r},r.catch(()=>{delete this.eventManagers[n]}),r}async initAndGetManager(e){const n=await LD(e),r=new SD(e);return n.register("authEvent",i=>(We(i?.authEvent,e,"invalid-auth-event"),{status:r.onEvent(i.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=n,r}_isIframeWebStorageSupported(e,n){this.iframes[e._key()].send(Og,{type:Og},i=>{const o=i?.[0]?.[Og];o!==void 0&&n(!!o),cs(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const n=e._key();return this.originValidationPromises[n]||(this.originValidationPromises[n]=jD(e)),this.originValidationPromises[n]}get _shouldInitProactively(){return pE()||cE()||Yy()}}const ZD=XD;var Sw="@firebase/auth",Ew="1.12.0";class JD{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const n=this.auth.onIdTokenChanged(r=>{e(r?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,n),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const n=this.internalListeners.get(e);n&&(this.internalListeners.delete(e),n(),this.updateProactiveRefresh())}assertAuthConfigured(){We(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function eM(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function tM(t){Fl(new To("auth",(e,{options:n})=>{const r=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),o=e.getProvider("app-check-internal"),{apiKey:l,authDomain:d}=r.options;We(l&&!l.includes(":"),"invalid-api-key",{appName:r.name});const h={apiKey:l,authDomain:d,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:gE(t)},m=new bk(r,i,o,h);return Rk(m,n),m},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,n,r)=>{e.getProvider("auth-internal").initialize()})),Fl(new To("auth-internal",e=>{const n=sc(e.getProvider("auth").getImmediate());return(r=>new JD(r))(n)},"PRIVATE").setInstantiationMode("EXPLICIT")),ya(Sw,Ew,eM(t)),ya(Sw,Ew,"esm2020")}const nM=300,rM=HS("authIdTokenMaxAge")||nM;let Cw=null;const sM=t=>async e=>{const n=e&&await e.getIdTokenResult(),r=n&&(new Date().getTime()-Date.parse(n.issuedAtTime))/1e3;if(r&&r>rM)return;const i=n?.token;Cw!==i&&(Cw=i,await fetch(t,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))};function iM(t=XS()){const e=Gy(t,"auth");if(e.isInitialized())return e.getImmediate();const n=jk(t,{popupRedirectResolver:ZD,persistence:[cD,Xk,TE]}),r=HS("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const o=new URL(r,location.origin);if(location.origin===o.origin){const l=sM(o.toString());Gk(n,l,()=>l(n.currentUser)),Hk(n,d=>l(d))}}const i=$S("auth");return i&&Ik(n,`http://${i}`),n}function aM(){return document.getElementsByTagName("head")?.[0]??document}vk({loadJS(t){return new Promise((e,n)=>{const r=document.createElement("script");r.setAttribute("src",t),r.onload=e,r.onerror=i=>{const o=zs("internal-error");o.customData=i,n(o)},r.type="text/javascript",r.charset="UTF-8",aM().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});tM("Browser");var oM="firebase",lM="12.7.0";ya(oM,lM,"app");const cM={apiKey:"AIzaSyCfvR8bEeW2CXdD31Ec34doRNThnbryXJo",authDomain:"budget-tkl.firebaseapp.com",projectId:"budget-tkl",storageBucket:"budget-tkl.firebasestorage.app",messagingSenderId:"631248313026",appId:"1:631248313026:web:36574d789a42b2d102f95b"},ME=YS(cM);function Da(){const t=iM(ME);async function e(){return!1}async function n(h,m){return qk(t,h,m)}function r(){return Wk(t)}function i(h){Qk(t,m=>{h(m)})}function o(){return t.currentUser}function l(){const h=t.currentUser;if(!h)throw new Error("Not authenticated");if(!h.email)throw new Error("Email is required but not available for this account");return h.email}return{set_user_listener:i,delete_firebase_user:e,login_firebase_user:n,logout_firebase_user:r,get_current_firebase_user:o,requireUserEmail:l}}const ac=300*1e3,uM=1800*1e3,Le=new Kj({defaultOptions:{queries:{staleTime:ac,gcTime:uM,refetchOnWindowFocus:!1,refetchOnReconnect:!0,retry:1,refetchOnMount:!0},mutations:{retry:1}}});Le.getQueryCache().subscribe(t=>{const e=t?.query;if(e&&t.type==="updated"){const{state:n}=e;n.status==="error"&&n.error&&console.error("[RQ] Query FAILED:",e.queryKey,n.error)}});const ke={user:t=>["user",t],budget:t=>["budget",t],month:(t,e,n)=>["month",t,e,n],payees:t=>["payees",t],accessibleBudgets:t=>["accessibleBudgets",t],feedback:()=>["feedback"]};function dM({children:t}){return u.jsx(Yj,{client:Le,children:t})}var Tw=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var ba,OE;(function(){var t;function e(k,R){function N(){}N.prototype=R.prototype,k.F=R.prototype,k.prototype=new N,k.prototype.constructor=k,k.D=function(V,H,j){for(var B=Array(arguments.length-2),M=2;M<arguments.length;M++)B[M-2]=arguments[M];return R.prototype[H].apply(V,B)}}function n(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(r,n),r.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(k,R,N){N||(N=0);const V=Array(16);if(typeof R=="string")for(var H=0;H<16;++H)V[H]=R.charCodeAt(N++)|R.charCodeAt(N++)<<8|R.charCodeAt(N++)<<16|R.charCodeAt(N++)<<24;else for(H=0;H<16;++H)V[H]=R[N++]|R[N++]<<8|R[N++]<<16|R[N++]<<24;R=k.g[0],N=k.g[1],H=k.g[2];let j=k.g[3],B;B=R+(j^N&(H^j))+V[0]+3614090360&4294967295,R=N+(B<<7&4294967295|B>>>25),B=j+(H^R&(N^H))+V[1]+3905402710&4294967295,j=R+(B<<12&4294967295|B>>>20),B=H+(N^j&(R^N))+V[2]+606105819&4294967295,H=j+(B<<17&4294967295|B>>>15),B=N+(R^H&(j^R))+V[3]+3250441966&4294967295,N=H+(B<<22&4294967295|B>>>10),B=R+(j^N&(H^j))+V[4]+4118548399&4294967295,R=N+(B<<7&4294967295|B>>>25),B=j+(H^R&(N^H))+V[5]+1200080426&4294967295,j=R+(B<<12&4294967295|B>>>20),B=H+(N^j&(R^N))+V[6]+2821735955&4294967295,H=j+(B<<17&4294967295|B>>>15),B=N+(R^H&(j^R))+V[7]+4249261313&4294967295,N=H+(B<<22&4294967295|B>>>10),B=R+(j^N&(H^j))+V[8]+1770035416&4294967295,R=N+(B<<7&4294967295|B>>>25),B=j+(H^R&(N^H))+V[9]+2336552879&4294967295,j=R+(B<<12&4294967295|B>>>20),B=H+(N^j&(R^N))+V[10]+4294925233&4294967295,H=j+(B<<17&4294967295|B>>>15),B=N+(R^H&(j^R))+V[11]+2304563134&4294967295,N=H+(B<<22&4294967295|B>>>10),B=R+(j^N&(H^j))+V[12]+1804603682&4294967295,R=N+(B<<7&4294967295|B>>>25),B=j+(H^R&(N^H))+V[13]+4254626195&4294967295,j=R+(B<<12&4294967295|B>>>20),B=H+(N^j&(R^N))+V[14]+2792965006&4294967295,H=j+(B<<17&4294967295|B>>>15),B=N+(R^H&(j^R))+V[15]+1236535329&4294967295,N=H+(B<<22&4294967295|B>>>10),B=R+(H^j&(N^H))+V[1]+4129170786&4294967295,R=N+(B<<5&4294967295|B>>>27),B=j+(N^H&(R^N))+V[6]+3225465664&4294967295,j=R+(B<<9&4294967295|B>>>23),B=H+(R^N&(j^R))+V[11]+643717713&4294967295,H=j+(B<<14&4294967295|B>>>18),B=N+(j^R&(H^j))+V[0]+3921069994&4294967295,N=H+(B<<20&4294967295|B>>>12),B=R+(H^j&(N^H))+V[5]+3593408605&4294967295,R=N+(B<<5&4294967295|B>>>27),B=j+(N^H&(R^N))+V[10]+38016083&4294967295,j=R+(B<<9&4294967295|B>>>23),B=H+(R^N&(j^R))+V[15]+3634488961&4294967295,H=j+(B<<14&4294967295|B>>>18),B=N+(j^R&(H^j))+V[4]+3889429448&4294967295,N=H+(B<<20&4294967295|B>>>12),B=R+(H^j&(N^H))+V[9]+568446438&4294967295,R=N+(B<<5&4294967295|B>>>27),B=j+(N^H&(R^N))+V[14]+3275163606&4294967295,j=R+(B<<9&4294967295|B>>>23),B=H+(R^N&(j^R))+V[3]+4107603335&4294967295,H=j+(B<<14&4294967295|B>>>18),B=N+(j^R&(H^j))+V[8]+1163531501&4294967295,N=H+(B<<20&4294967295|B>>>12),B=R+(H^j&(N^H))+V[13]+2850285829&4294967295,R=N+(B<<5&4294967295|B>>>27),B=j+(N^H&(R^N))+V[2]+4243563512&4294967295,j=R+(B<<9&4294967295|B>>>23),B=H+(R^N&(j^R))+V[7]+1735328473&4294967295,H=j+(B<<14&4294967295|B>>>18),B=N+(j^R&(H^j))+V[12]+2368359562&4294967295,N=H+(B<<20&4294967295|B>>>12),B=R+(N^H^j)+V[5]+4294588738&4294967295,R=N+(B<<4&4294967295|B>>>28),B=j+(R^N^H)+V[8]+2272392833&4294967295,j=R+(B<<11&4294967295|B>>>21),B=H+(j^R^N)+V[11]+1839030562&4294967295,H=j+(B<<16&4294967295|B>>>16),B=N+(H^j^R)+V[14]+4259657740&4294967295,N=H+(B<<23&4294967295|B>>>9),B=R+(N^H^j)+V[1]+2763975236&4294967295,R=N+(B<<4&4294967295|B>>>28),B=j+(R^N^H)+V[4]+1272893353&4294967295,j=R+(B<<11&4294967295|B>>>21),B=H+(j^R^N)+V[7]+4139469664&4294967295,H=j+(B<<16&4294967295|B>>>16),B=N+(H^j^R)+V[10]+3200236656&4294967295,N=H+(B<<23&4294967295|B>>>9),B=R+(N^H^j)+V[13]+681279174&4294967295,R=N+(B<<4&4294967295|B>>>28),B=j+(R^N^H)+V[0]+3936430074&4294967295,j=R+(B<<11&4294967295|B>>>21),B=H+(j^R^N)+V[3]+3572445317&4294967295,H=j+(B<<16&4294967295|B>>>16),B=N+(H^j^R)+V[6]+76029189&4294967295,N=H+(B<<23&4294967295|B>>>9),B=R+(N^H^j)+V[9]+3654602809&4294967295,R=N+(B<<4&4294967295|B>>>28),B=j+(R^N^H)+V[12]+3873151461&4294967295,j=R+(B<<11&4294967295|B>>>21),B=H+(j^R^N)+V[15]+530742520&4294967295,H=j+(B<<16&4294967295|B>>>16),B=N+(H^j^R)+V[2]+3299628645&4294967295,N=H+(B<<23&4294967295|B>>>9),B=R+(H^(N|~j))+V[0]+4096336452&4294967295,R=N+(B<<6&4294967295|B>>>26),B=j+(N^(R|~H))+V[7]+1126891415&4294967295,j=R+(B<<10&4294967295|B>>>22),B=H+(R^(j|~N))+V[14]+2878612391&4294967295,H=j+(B<<15&4294967295|B>>>17),B=N+(j^(H|~R))+V[5]+4237533241&4294967295,N=H+(B<<21&4294967295|B>>>11),B=R+(H^(N|~j))+V[12]+1700485571&4294967295,R=N+(B<<6&4294967295|B>>>26),B=j+(N^(R|~H))+V[3]+2399980690&4294967295,j=R+(B<<10&4294967295|B>>>22),B=H+(R^(j|~N))+V[10]+4293915773&4294967295,H=j+(B<<15&4294967295|B>>>17),B=N+(j^(H|~R))+V[1]+2240044497&4294967295,N=H+(B<<21&4294967295|B>>>11),B=R+(H^(N|~j))+V[8]+1873313359&4294967295,R=N+(B<<6&4294967295|B>>>26),B=j+(N^(R|~H))+V[15]+4264355552&4294967295,j=R+(B<<10&4294967295|B>>>22),B=H+(R^(j|~N))+V[6]+2734768916&4294967295,H=j+(B<<15&4294967295|B>>>17),B=N+(j^(H|~R))+V[13]+1309151649&4294967295,N=H+(B<<21&4294967295|B>>>11),B=R+(H^(N|~j))+V[4]+4149444226&4294967295,R=N+(B<<6&4294967295|B>>>26),B=j+(N^(R|~H))+V[11]+3174756917&4294967295,j=R+(B<<10&4294967295|B>>>22),B=H+(R^(j|~N))+V[2]+718787259&4294967295,H=j+(B<<15&4294967295|B>>>17),B=N+(j^(H|~R))+V[9]+3951481745&4294967295,k.g[0]=k.g[0]+R&4294967295,k.g[1]=k.g[1]+(H+(B<<21&4294967295|B>>>11))&4294967295,k.g[2]=k.g[2]+H&4294967295,k.g[3]=k.g[3]+j&4294967295}r.prototype.v=function(k,R){R===void 0&&(R=k.length);const N=R-this.blockSize,V=this.C;let H=this.h,j=0;for(;j<R;){if(H==0)for(;j<=N;)i(this,k,j),j+=this.blockSize;if(typeof k=="string"){for(;j<R;)if(V[H++]=k.charCodeAt(j++),H==this.blockSize){i(this,V),H=0;break}}else for(;j<R;)if(V[H++]=k[j++],H==this.blockSize){i(this,V),H=0;break}}this.h=H,this.o+=R},r.prototype.A=function(){var k=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);k[0]=128;for(var R=1;R<k.length-8;++R)k[R]=0;R=this.o*8;for(var N=k.length-8;N<k.length;++N)k[N]=R&255,R/=256;for(this.v(k),k=Array(16),R=0,N=0;N<4;++N)for(let V=0;V<32;V+=8)k[R++]=this.g[N]>>>V&255;return k};function o(k,R){var N=d;return Object.prototype.hasOwnProperty.call(N,k)?N[k]:N[k]=R(k)}function l(k,R){this.h=R;const N=[];let V=!0;for(let H=k.length-1;H>=0;H--){const j=k[H]|0;V&&j==R||(N[H]=j,V=!1)}this.g=N}var d={};function h(k){return-128<=k&&k<128?o(k,function(R){return new l([R|0],R<0?-1:0)}):new l([k|0],k<0?-1:0)}function m(k){if(isNaN(k)||!isFinite(k))return g;if(k<0)return S(m(-k));const R=[];let N=1;for(let V=0;k>=N;V++)R[V]=k/N|0,N*=4294967296;return new l(R,0)}function p(k,R){if(k.length==0)throw Error("number format error: empty string");if(R=R||10,R<2||36<R)throw Error("radix out of range: "+R);if(k.charAt(0)=="-")return S(p(k.substring(1),R));if(k.indexOf("-")>=0)throw Error('number format error: interior "-" character');const N=m(Math.pow(R,8));let V=g;for(let j=0;j<k.length;j+=8){var H=Math.min(8,k.length-j);const B=parseInt(k.substring(j,j+H),R);H<8?(H=m(Math.pow(R,H)),V=V.j(H).add(m(B))):(V=V.j(N),V=V.add(m(B)))}return V}var g=h(0),v=h(1),b=h(16777216);t=l.prototype,t.m=function(){if(x(this))return-S(this).m();let k=0,R=1;for(let N=0;N<this.g.length;N++){const V=this.i(N);k+=(V>=0?V:4294967296+V)*R,R*=4294967296}return k},t.toString=function(k){if(k=k||10,k<2||36<k)throw Error("radix out of range: "+k);if(E(this))return"0";if(x(this))return"-"+S(this).toString(k);const R=m(Math.pow(k,6));var N=this;let V="";for(;;){const H=O(N,R).g;N=C(N,H.j(R));let j=((N.g.length>0?N.g[0]:N.h)>>>0).toString(k);if(N=H,E(N))return j+V;for(;j.length<6;)j="0"+j;V=j+V}},t.i=function(k){return k<0?0:k<this.g.length?this.g[k]:this.h};function E(k){if(k.h!=0)return!1;for(let R=0;R<k.g.length;R++)if(k.g[R]!=0)return!1;return!0}function x(k){return k.h==-1}t.l=function(k){return k=C(this,k),x(k)?-1:E(k)?0:1};function S(k){const R=k.g.length,N=[];for(let V=0;V<R;V++)N[V]=~k.g[V];return new l(N,~k.h).add(v)}t.abs=function(){return x(this)?S(this):this},t.add=function(k){const R=Math.max(this.g.length,k.g.length),N=[];let V=0;for(let H=0;H<=R;H++){let j=V+(this.i(H)&65535)+(k.i(H)&65535),B=(j>>>16)+(this.i(H)>>>16)+(k.i(H)>>>16);V=B>>>16,j&=65535,B&=65535,N[H]=B<<16|j}return new l(N,N[N.length-1]&-2147483648?-1:0)};function C(k,R){return k.add(S(R))}t.j=function(k){if(E(this)||E(k))return g;if(x(this))return x(k)?S(this).j(S(k)):S(S(this).j(k));if(x(k))return S(this.j(S(k)));if(this.l(b)<0&&k.l(b)<0)return m(this.m()*k.m());const R=this.g.length+k.g.length,N=[];for(var V=0;V<2*R;V++)N[V]=0;for(V=0;V<this.g.length;V++)for(let H=0;H<k.g.length;H++){const j=this.i(V)>>>16,B=this.i(V)&65535,M=k.i(H)>>>16,Z=k.i(H)&65535;N[2*V+2*H]+=B*Z,T(N,2*V+2*H),N[2*V+2*H+1]+=j*Z,T(N,2*V+2*H+1),N[2*V+2*H+1]+=B*M,T(N,2*V+2*H+1),N[2*V+2*H+2]+=j*M,T(N,2*V+2*H+2)}for(k=0;k<R;k++)N[k]=N[2*k+1]<<16|N[2*k];for(k=R;k<2*R;k++)N[k]=0;return new l(N,0)};function T(k,R){for(;(k[R]&65535)!=k[R];)k[R+1]+=k[R]>>>16,k[R]&=65535,R++}function I(k,R){this.g=k,this.h=R}function O(k,R){if(E(R))throw Error("division by zero");if(E(k))return new I(g,g);if(x(k))return R=O(S(k),R),new I(S(R.g),S(R.h));if(x(R))return R=O(k,S(R)),new I(S(R.g),R.h);if(k.g.length>30){if(x(k)||x(R))throw Error("slowDivide_ only works with positive integers.");for(var N=v,V=R;V.l(k)<=0;)N=U(N),V=U(V);var H=$(N,1),j=$(V,1);for(V=$(V,2),N=$(N,2);!E(V);){var B=j.add(V);B.l(k)<=0&&(H=H.add(N),j=B),V=$(V,1),N=$(N,1)}return R=C(k,H.j(R)),new I(H,R)}for(H=g;k.l(R)>=0;){for(N=Math.max(1,Math.floor(k.m()/R.m())),V=Math.ceil(Math.log(N)/Math.LN2),V=V<=48?1:Math.pow(2,V-48),j=m(N),B=j.j(R);x(B)||B.l(k)>0;)N-=V,j=m(N),B=j.j(R);E(j)&&(j=v),H=H.add(j),k=C(k,B)}return new I(H,k)}t.B=function(k){return O(this,k).h},t.and=function(k){const R=Math.max(this.g.length,k.g.length),N=[];for(let V=0;V<R;V++)N[V]=this.i(V)&k.i(V);return new l(N,this.h&k.h)},t.or=function(k){const R=Math.max(this.g.length,k.g.length),N=[];for(let V=0;V<R;V++)N[V]=this.i(V)|k.i(V);return new l(N,this.h|k.h)},t.xor=function(k){const R=Math.max(this.g.length,k.g.length),N=[];for(let V=0;V<R;V++)N[V]=this.i(V)^k.i(V);return new l(N,this.h^k.h)};function U(k){const R=k.g.length+1,N=[];for(let V=0;V<R;V++)N[V]=k.i(V)<<1|k.i(V-1)>>>31;return new l(N,k.h)}function $(k,R){const N=R>>5;R%=32;const V=k.g.length-N,H=[];for(let j=0;j<V;j++)H[j]=R>0?k.i(j+N)>>>R|k.i(j+N+1)<<32-R:k.i(j+N);return new l(H,k.h)}r.prototype.digest=r.prototype.A,r.prototype.reset=r.prototype.u,r.prototype.update=r.prototype.v,OE=r,l.prototype.add=l.prototype.add,l.prototype.multiply=l.prototype.j,l.prototype.modulo=l.prototype.B,l.prototype.compare=l.prototype.l,l.prototype.toNumber=l.prototype.m,l.prototype.toString=l.prototype.toString,l.prototype.getBits=l.prototype.i,l.fromNumber=m,l.fromString=p,ba=l}).apply(typeof Tw<"u"?Tw:typeof self<"u"?self:typeof window<"u"?window:{});var Bh=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var NE,vu,PE,Yh,dy,BE,zE,LE;(function(){var t,e=Object.defineProperty;function n(y){y=[typeof globalThis=="object"&&globalThis,y,typeof window=="object"&&window,typeof self=="object"&&self,typeof Bh=="object"&&Bh];for(var A=0;A<y.length;++A){var F=y[A];if(F&&F.Math==Math)return F}throw Error("Cannot find global object")}var r=n(this);function i(y,A){if(A)e:{var F=r;y=y.split(".");for(var Y=0;Y<y.length-1;Y++){var fe=y[Y];if(!(fe in F))break e;F=F[fe]}y=y[y.length-1],Y=F[y],A=A(Y),A!=Y&&A!=null&&e(F,y,{configurable:!0,writable:!0,value:A})}}i("Symbol.dispose",function(y){return y||Symbol("Symbol.dispose")}),i("Array.prototype.values",function(y){return y||function(){return this[Symbol.iterator]()}}),i("Object.entries",function(y){return y||function(A){var F=[],Y;for(Y in A)Object.prototype.hasOwnProperty.call(A,Y)&&F.push([Y,A[Y]]);return F}});var o=o||{},l=this||self;function d(y){var A=typeof y;return A=="object"&&y!=null||A=="function"}function h(y,A,F){return y.call.apply(y.bind,arguments)}function m(y,A,F){return m=h,m.apply(null,arguments)}function p(y,A){var F=Array.prototype.slice.call(arguments,1);return function(){var Y=F.slice();return Y.push.apply(Y,arguments),y.apply(this,Y)}}function g(y,A){function F(){}F.prototype=A.prototype,y.Z=A.prototype,y.prototype=new F,y.prototype.constructor=y,y.Ob=function(Y,fe,be){for(var Ne=Array(arguments.length-2),rt=2;rt<arguments.length;rt++)Ne[rt-2]=arguments[rt];return A.prototype[fe].apply(Y,Ne)}}var v=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?y=>y&&AsyncContext.Snapshot.wrap(y):y=>y;function b(y){const A=y.length;if(A>0){const F=Array(A);for(let Y=0;Y<A;Y++)F[Y]=y[Y];return F}return[]}function E(y,A){for(let Y=1;Y<arguments.length;Y++){const fe=arguments[Y];var F=typeof fe;if(F=F!="object"?F:fe?Array.isArray(fe)?"array":F:"null",F=="array"||F=="object"&&typeof fe.length=="number"){F=y.length||0;const be=fe.length||0;y.length=F+be;for(let Ne=0;Ne<be;Ne++)y[F+Ne]=fe[Ne]}else y.push(fe)}}class x{constructor(A,F){this.i=A,this.j=F,this.h=0,this.g=null}get(){let A;return this.h>0?(this.h--,A=this.g,this.g=A.next,A.next=null):A=this.i(),A}}function S(y){l.setTimeout(()=>{throw y},0)}function C(){var y=k;let A=null;return y.g&&(A=y.g,y.g=y.g.next,y.g||(y.h=null),A.next=null),A}class T{constructor(){this.h=this.g=null}add(A,F){const Y=I.get();Y.set(A,F),this.h?this.h.next=Y:this.g=Y,this.h=Y}}var I=new x(()=>new O,y=>y.reset());class O{constructor(){this.next=this.g=this.h=null}set(A,F){this.h=A,this.g=F,this.next=null}reset(){this.next=this.g=this.h=null}}let U,$=!1,k=new T,R=()=>{const y=Promise.resolve(void 0);U=()=>{y.then(N)}};function N(){for(var y;y=C();){try{y.h.call(y.g)}catch(F){S(F)}var A=I;A.j(y),A.h<100&&(A.h++,y.next=A.g,A.g=y)}$=!1}function V(){this.u=this.u,this.C=this.C}V.prototype.u=!1,V.prototype.dispose=function(){this.u||(this.u=!0,this.N())},V.prototype[Symbol.dispose]=function(){this.dispose()},V.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function H(y,A){this.type=y,this.g=this.target=A,this.defaultPrevented=!1}H.prototype.h=function(){this.defaultPrevented=!0};var j=(function(){if(!l.addEventListener||!Object.defineProperty)return!1;var y=!1,A=Object.defineProperty({},"passive",{get:function(){y=!0}});try{const F=()=>{};l.addEventListener("test",F,A),l.removeEventListener("test",F,A)}catch{}return y})();function B(y){return/^[\s\xa0]*$/.test(y)}function M(y,A){H.call(this,y?y.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,y&&this.init(y,A)}g(M,H),M.prototype.init=function(y,A){const F=this.type=y.type,Y=y.changedTouches&&y.changedTouches.length?y.changedTouches[0]:null;this.target=y.target||y.srcElement,this.g=A,A=y.relatedTarget,A||(F=="mouseover"?A=y.fromElement:F=="mouseout"&&(A=y.toElement)),this.relatedTarget=A,Y?(this.clientX=Y.clientX!==void 0?Y.clientX:Y.pageX,this.clientY=Y.clientY!==void 0?Y.clientY:Y.pageY,this.screenX=Y.screenX||0,this.screenY=Y.screenY||0):(this.clientX=y.clientX!==void 0?y.clientX:y.pageX,this.clientY=y.clientY!==void 0?y.clientY:y.pageY,this.screenX=y.screenX||0,this.screenY=y.screenY||0),this.button=y.button,this.key=y.key||"",this.ctrlKey=y.ctrlKey,this.altKey=y.altKey,this.shiftKey=y.shiftKey,this.metaKey=y.metaKey,this.pointerId=y.pointerId||0,this.pointerType=y.pointerType,this.state=y.state,this.i=y,y.defaultPrevented&&M.Z.h.call(this)},M.prototype.h=function(){M.Z.h.call(this);const y=this.i;y.preventDefault?y.preventDefault():y.returnValue=!1};var Z="closure_listenable_"+(Math.random()*1e6|0),K=0;function q(y,A,F,Y,fe){this.listener=y,this.proxy=null,this.src=A,this.type=F,this.capture=!!Y,this.ha=fe,this.key=++K,this.da=this.fa=!1}function W(y){y.da=!0,y.listener=null,y.proxy=null,y.src=null,y.ha=null}function X(y,A,F){for(const Y in y)A.call(F,y[Y],Y,y)}function re(y,A){for(const F in y)A.call(void 0,y[F],F,y)}function z(y){const A={};for(const F in y)A[F]=y[F];return A}const G="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function te(y,A){let F,Y;for(let fe=1;fe<arguments.length;fe++){Y=arguments[fe];for(F in Y)y[F]=Y[F];for(let be=0;be<G.length;be++)F=G[be],Object.prototype.hasOwnProperty.call(Y,F)&&(y[F]=Y[F])}}function se(y){this.src=y,this.g={},this.h=0}se.prototype.add=function(y,A,F,Y,fe){const be=y.toString();y=this.g[be],y||(y=this.g[be]=[],this.h++);const Ne=ce(y,A,Y,fe);return Ne>-1?(A=y[Ne],F||(A.fa=!1)):(A=new q(A,this.src,be,!!Y,fe),A.fa=F,y.push(A)),A};function ie(y,A){const F=A.type;if(F in y.g){var Y=y.g[F],fe=Array.prototype.indexOf.call(Y,A,void 0),be;(be=fe>=0)&&Array.prototype.splice.call(Y,fe,1),be&&(W(A),y.g[F].length==0&&(delete y.g[F],y.h--))}}function ce(y,A,F,Y){for(let fe=0;fe<y.length;++fe){const be=y[fe];if(!be.da&&be.listener==A&&be.capture==!!F&&be.ha==Y)return fe}return-1}var we="closure_lm_"+(Math.random()*1e6|0),he={};function Ee(y,A,F,Y,fe){if(Array.isArray(A)){for(let be=0;be<A.length;be++)Ee(y,A[be],F,Y,fe);return null}return F=J(F),y&&y[Z]?y.J(A,F,d(Y)?!!Y.capture:!1,fe):Ue(y,A,F,!1,Y,fe)}function Ue(y,A,F,Y,fe,be){if(!A)throw Error("Invalid event type");const Ne=d(fe)?!!fe.capture:!!fe;let rt=ye(y);if(rt||(y[we]=rt=new se(y)),F=rt.add(A,F,Y,Ne,be),F.proxy)return F;if(Y=Be(),F.proxy=Y,Y.src=y,Y.listener=F,y.addEventListener)j||(fe=Ne),fe===void 0&&(fe=!1),y.addEventListener(A.toString(),Y,fe);else if(y.attachEvent)y.attachEvent(L(A.toString()),Y);else if(y.addListener&&y.removeListener)y.addListener(Y);else throw Error("addEventListener and attachEvent are unavailable.");return F}function Be(){function y(F){return A.call(y.src,y.listener,F)}const A=de;return y}function gt(y,A,F,Y,fe){if(Array.isArray(A))for(var be=0;be<A.length;be++)gt(y,A[be],F,Y,fe);else Y=d(Y)?!!Y.capture:!!Y,F=J(F),y&&y[Z]?(y=y.i,be=String(A).toString(),be in y.g&&(A=y.g[be],F=ce(A,F,Y,fe),F>-1&&(W(A[F]),Array.prototype.splice.call(A,F,1),A.length==0&&(delete y.g[be],y.h--)))):y&&(y=ye(y))&&(A=y.g[A.toString()],y=-1,A&&(y=ce(A,F,Y,fe)),(F=y>-1?A[y]:null)&&yt(F))}function yt(y){if(typeof y!="number"&&y&&!y.da){var A=y.src;if(A&&A[Z])ie(A.i,y);else{var F=y.type,Y=y.proxy;A.removeEventListener?A.removeEventListener(F,Y,y.capture):A.detachEvent?A.detachEvent(L(F),Y):A.addListener&&A.removeListener&&A.removeListener(Y),(F=ye(A))?(ie(F,y),F.h==0&&(F.src=null,A[we]=null)):W(y)}}}function L(y){return y in he?he[y]:he[y]="on"+y}function de(y,A){if(y.da)y=!0;else{A=new M(A,this);const F=y.listener,Y=y.ha||y.src;y.fa&&yt(y),y=F.call(Y,A)}return y}function ye(y){return y=y[we],y instanceof se?y:null}var ee="__closure_events_fn_"+(Math.random()*1e9>>>0);function J(y){return typeof y=="function"?y:(y[ee]||(y[ee]=function(A){return y.handleEvent(A)}),y[ee])}function oe(){V.call(this),this.i=new se(this),this.M=this,this.G=null}g(oe,V),oe.prototype[Z]=!0,oe.prototype.removeEventListener=function(y,A,F,Y){gt(this,y,A,F,Y)};function Se(y,A){var F,Y=y.G;if(Y)for(F=[];Y;Y=Y.G)F.push(Y);if(y=y.M,Y=A.type||A,typeof A=="string")A=new H(A,y);else if(A instanceof H)A.target=A.target||y;else{var fe=A;A=new H(Y,y),te(A,fe)}fe=!0;let be,Ne;if(F)for(Ne=F.length-1;Ne>=0;Ne--)be=A.g=F[Ne],fe=xe(be,Y,!0,A)&&fe;if(be=A.g=y,fe=xe(be,Y,!0,A)&&fe,fe=xe(be,Y,!1,A)&&fe,F)for(Ne=0;Ne<F.length;Ne++)be=A.g=F[Ne],fe=xe(be,Y,!1,A)&&fe}oe.prototype.N=function(){if(oe.Z.N.call(this),this.i){var y=this.i;for(const A in y.g){const F=y.g[A];for(let Y=0;Y<F.length;Y++)W(F[Y]);delete y.g[A],y.h--}}this.G=null},oe.prototype.J=function(y,A,F,Y){return this.i.add(String(y),A,!1,F,Y)},oe.prototype.K=function(y,A,F,Y){return this.i.add(String(y),A,!0,F,Y)};function xe(y,A,F,Y){if(A=y.i.g[String(A)],!A)return!0;A=A.concat();let fe=!0;for(let be=0;be<A.length;++be){const Ne=A[be];if(Ne&&!Ne.da&&Ne.capture==F){const rt=Ne.listener,nn=Ne.ha||Ne.src;Ne.fa&&ie(y.i,Ne),fe=rt.call(nn,Y)!==!1&&fe}}return fe&&!Y.defaultPrevented}function ae(y,A){if(typeof y!="function")if(y&&typeof y.handleEvent=="function")y=m(y.handleEvent,y);else throw Error("Invalid listener argument");return Number(A)>2147483647?-1:l.setTimeout(y,A||0)}function Ae(y){y.g=ae(()=>{y.g=null,y.i&&(y.i=!1,Ae(y))},y.l);const A=y.h;y.h=null,y.m.apply(null,A)}class Oe extends V{constructor(A,F){super(),this.m=A,this.l=F,this.h=null,this.i=!1,this.g=null}j(A){this.h=arguments,this.g?this.i=!0:Ae(this)}N(){super.N(),this.g&&(l.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function De(y){V.call(this),this.h=y,this.g={}}g(De,V);var qe=[];function xt(y){X(y.g,function(A,F){this.g.hasOwnProperty(F)&&yt(A)},y),y.g={}}De.prototype.N=function(){De.Z.N.call(this),xt(this)},De.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var nt=l.JSON.stringify,Qn=l.JSON.parse,fs=class{stringify(y){return l.JSON.stringify(y,void 0)}parse(y){return l.JSON.parse(y,void 0)}};function er(){}function ms(){}var bt={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function Jt(){H.call(this,"d")}g(Jt,H);function Wn(){H.call(this,"c")}g(Wn,H);var Et={},La=null;function Ti(){return La=La||new oe}Et.Ia="serverreachability";function Lo(y){H.call(this,Et.Ia,y)}g(Lo,H);function Rr(y){const A=Ti();Se(A,new Lo(A))}Et.STAT_EVENT="statevent";function ps(y,A){H.call(this,Et.STAT_EVENT,y),this.stat=A}g(ps,H);function Lt(y){const A=Ti();Se(A,new ps(A,y))}Et.Ja="timingevent";function tr(y,A){H.call(this,Et.Ja,y),this.size=A}g(tr,H);function gs(y,A){if(typeof y!="function")throw Error("Fn must not be null and must be a function");return l.setTimeout(function(){y()},A)}function Qr(){this.g=!0}Qr.prototype.ua=function(){this.g=!1};function Sm(y,A,F,Y,fe,be){y.info(function(){if(y.g)if(be){var Ne="",rt=be.split("&");for(let Ct=0;Ct<rt.length;Ct++){var nn=rt[Ct].split("=");if(nn.length>1){const Qt=nn[0];nn=nn[1];const Mr=Qt.split("_");Ne=Mr.length>=2&&Mr[1]=="type"?Ne+(Qt+"="+nn+"&"):Ne+(Qt+"=redacted&")}}}else Ne=null;else Ne=be;return"XMLHTTP REQ ("+Y+") [attempt "+fe+"]: "+A+`
`+F+`
`+Ne})}function ud(y,A,F,Y,fe,be,Ne){y.info(function(){return"XMLHTTP RESP ("+Y+") [ attempt "+fe+"]: "+A+`
`+F+`
`+be+" "+Ne})}function ys(y,A,F,Y){y.info(function(){return"XMLHTTP TEXT ("+A+"): "+Em(y,F)+(Y?" "+Y:"")})}function Ua(y,A){y.info(function(){return"TIMEOUT: "+A})}Qr.prototype.info=function(){};function Em(y,A){if(!y.g)return A;if(!A)return null;try{const be=JSON.parse(A);if(be){for(y=0;y<be.length;y++)if(Array.isArray(be[y])){var F=be[y];if(!(F.length<2)){var Y=F[1];if(Array.isArray(Y)&&!(Y.length<1)){var fe=Y[0];if(fe!="noop"&&fe!="stop"&&fe!="close")for(let Ne=1;Ne<Y.length;Ne++)Y[Ne]=""}}}}return nt(be)}catch{return A}}var Fa={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},gc={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},yc;function Va(){}g(Va,er),Va.prototype.g=function(){return new XMLHttpRequest},yc=new Va;function Hs(y){return encodeURIComponent(String(y))}function dd(y){var A=1;y=y.split(":");const F=[];for(;A>0&&y.length;)F.push(y.shift()),A--;return y.length&&F.push(y.join(":")),F}function Wr(y,A,F,Y){this.j=y,this.i=A,this.l=F,this.S=Y||1,this.V=new De(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new Kr}function Kr(){this.i=null,this.g="",this.h=!1}var un={},jn={};function _s(y,A,F){y.M=1,y.A=$a(hn(A)),y.u=F,y.R=!0,Uo(y,null)}function Uo(y,A){y.F=Date.now(),bs(y),y.B=hn(y.A);var F=y.B,Y=y.S;Array.isArray(Y)||(Y=[String(Y)]),qo(F.i,"t",Y),y.C=0,F=y.j.L,y.h=new Kr,y.g=Td(y.j,F?A:null,!y.u),y.P>0&&(y.O=new Oe(m(y.Y,y,y.g),y.P)),A=y.V,F=y.g,Y=y.ba;var fe="readystatechange";Array.isArray(fe)||(fe&&(qe[0]=fe.toString()),fe=qe);for(let be=0;be<fe.length;be++){const Ne=Ee(F,fe[be],Y||A.handleEvent,!1,A.h||A);if(!Ne)break;A.g[Ne.key]=Ne}A=y.J?z(y.J):{},y.u?(y.v||(y.v="POST"),A["Content-Type"]="application/x-www-form-urlencoded",y.g.ea(y.B,y.v,y.u,A)):(y.v="GET",y.g.ea(y.B,y.v,null,A)),Rr(),Sm(y.i,y.v,y.B,y.l,y.S,y.u)}Wr.prototype.ba=function(y){y=y.target;const A=this.O;A&&Zr(y)==3?A.j():this.Y(y)},Wr.prototype.Y=function(y){try{if(y==this.g)e:{const rt=Zr(this.g),nn=this.g.ya(),Ct=this.g.ca();if(!(rt<3)&&(rt!=3||this.g&&(this.h.h||this.g.la()||Nn(this.g)))){this.K||rt!=4||nn==7||(nn==8||Ct<=0?Rr(3):Rr(2)),vs(this);var A=this.g.ca();this.X=A;var F=Cm(this);if(this.o=A==200,ud(this.i,this.v,this.B,this.l,this.S,rt,A),this.o){if(this.U&&!this.L){t:{if(this.g){var Y,fe=this.g;if((Y=fe.g?fe.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!B(Y)){var be=Y;break t}}be=null}if(y=be)ys(this.i,this.l,y,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,xs(this,y);else{this.o=!1,this.m=3,Lt(12),yr(this),Ir(this);break e}}if(this.R){y=!0;let Qt;for(;!this.K&&this.C<F.length;)if(Qt=fd(this,F),Qt==jn){rt==4&&(this.m=4,Lt(14),y=!1),ys(this.i,this.l,null,"[Incomplete Response]");break}else if(Qt==un){this.m=4,Lt(15),ys(this.i,this.l,F,"[Invalid Chunk]"),y=!1;break}else ys(this.i,this.l,Qt,null),xs(this,Qt);if(hd(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),rt!=4||F.length!=0||this.h.h||(this.m=1,Lt(16),y=!1),this.o=this.o&&y,!y)ys(this.i,this.l,F,"[Invalid Chunked Response]"),yr(this),Ir(this);else if(F.length>0&&!this.W){this.W=!0;var Ne=this.j;Ne.g==this&&Ne.aa&&!Ne.P&&(Ne.j.info("Great, no buffering proxy detected. Bytes received: "+F.length),Dc(Ne),Ne.P=!0,Lt(11))}}else ys(this.i,this.l,F,null),xs(this,F);rt==4&&yr(this),this.o&&!this.K&&(rt==4?wd(this.j,this):(this.o=!1,bs(this)))}else Qs(this.g),A==400&&F.indexOf("Unknown SID")>0?(this.m=3,Lt(12)):(this.m=0,Lt(13)),yr(this),Ir(this)}}}catch{}};function Cm(y){if(!hd(y))return y.g.la();const A=Nn(y.g);if(A==="")return"";let F="";const Y=A.length,fe=Zr(y.g)==4;if(!y.h.i){if(typeof TextDecoder>"u")return yr(y),Ir(y),"";y.h.i=new l.TextDecoder}for(let be=0;be<Y;be++)y.h.h=!0,F+=y.h.i.decode(A[be],{stream:!(fe&&be==Y-1)});return A.length=0,y.h.g+=F,y.C=0,y.h.g}function hd(y){return y.g?y.v=="GET"&&y.M!=2&&y.j.Aa:!1}function fd(y,A){var F=y.C,Y=A.indexOf(`
`,F);return Y==-1?jn:(F=Number(A.substring(F,Y)),isNaN(F)?un:(Y+=1,Y+F>A.length?jn:(A=A.slice(Y,Y+F),y.C=Y+F,A)))}Wr.prototype.cancel=function(){this.K=!0,yr(this)};function bs(y){y.T=Date.now()+y.H,Fo(y,y.H)}function Fo(y,A){if(y.D!=null)throw Error("WatchDog timer not null");y.D=gs(m(y.aa,y),A)}function vs(y){y.D&&(l.clearTimeout(y.D),y.D=null)}Wr.prototype.aa=function(){this.D=null;const y=Date.now();y-this.T>=0?(Ua(this.i,this.B),this.M!=2&&(Rr(),Lt(17)),yr(this),this.m=2,Ir(this)):Fo(this,this.T-y)};function Ir(y){y.j.I==0||y.K||wd(y.j,y)}function yr(y){vs(y);var A=y.O;A&&typeof A.dispose=="function"&&A.dispose(),y.O=null,xt(y.V),y.g&&(A=y.g,y.g=null,A.abort(),A.dispose())}function xs(y,A){try{var F=y.j;if(F.I!=0&&(F.g==y||Ss(F.h,y))){if(!y.L&&Ss(F.h,y)&&F.I==3){try{var Y=F.Ba.g.parse(A)}catch{Y=null}if(Array.isArray(Y)&&Y.length==3){var fe=Y;if(fe[0]==0){e:if(!F.v){if(F.g)if(F.g.F+3e3<y.F)Ko(F),Oi(F);else break e;Ya(F),Lt(18)}}else F.xa=fe[1],0<F.xa-F.K&&fe[2]<37500&&F.F&&F.A==0&&!F.C&&(F.C=gs(m(F.Va,F),6e3));ws(F.h)<=1&&F.ta&&(F.ta=void 0)}else Rs(F,11)}else if((y.L||F.g==y)&&Ko(F),!B(A))for(fe=F.Ba.g.parse(A),A=0;A<fe.length;A++){let Ct=fe[A];const Qt=Ct[0];if(!(Qt<=F.K))if(F.K=Qt,Ct=Ct[1],F.I==2)if(Ct[0]=="c"){F.M=Ct[1],F.ba=Ct[2];const Mr=Ct[3];Mr!=null&&(F.ka=Mr,F.j.info("VER="+F.ka));const Is=Ct[4];Is!=null&&(F.za=Is,F.j.info("SVER="+F.za));const Jr=Ct[5];Jr!=null&&typeof Jr=="number"&&Jr>0&&(Y=1.5*Jr,F.O=Y,F.j.info("backChannelRequestTimeoutMs_="+Y)),Y=F;const es=y.g;if(es){const Xa=es.g?es.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Xa){var be=Y.h;be.g||Xa.indexOf("spdy")==-1&&Xa.indexOf("quic")==-1&&Xa.indexOf("h2")==-1||(be.j=be.l,be.g=new Set,be.h&&(vc(be,be.h),be.h=null))}if(Y.G){const Yo=es.g?es.g.getResponseHeader("X-HTTP-Session-Id"):null;Yo&&(Y.wa=Yo,Rt(Y.J,Y.G,Yo))}}F.I=3,F.l&&F.l.ra(),F.aa&&(F.T=Date.now()-y.F,F.j.info("Handshake RTT: "+F.T+"ms")),Y=F;var Ne=y;if(Y.na=Cd(Y,Y.L?Y.ba:null,Y.W),Ne.L){xc(Y.h,Ne);var rt=Ne,nn=Y.O;nn&&(rt.H=nn),rt.D&&(vs(rt),bs(rt)),Y.g=Ne}else vd(Y);F.i.length>0&&js(F)}else Ct[0]!="stop"&&Ct[0]!="close"||Rs(F,7);else F.I==3&&(Ct[0]=="stop"||Ct[0]=="close"?Ct[0]=="stop"?Rs(F,7):Ic(F):Ct[0]!="noop"&&F.l&&F.l.qa(Ct),F.A=0)}}Rr(4)}catch{}}var dn=class{constructor(y,A){this.g=y,this.map=A}};function _c(y){this.l=y||10,l.PerformanceNavigationTiming?(y=l.performance.getEntriesByType("navigation"),y=y.length>0&&(y[0].nextHopProtocol=="hq"||y[0].nextHopProtocol=="h2")):y=!!(l.chrome&&l.chrome.loadTimes&&l.chrome.loadTimes()&&l.chrome.loadTimes().wasFetchedViaSpdy),this.j=y?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function bc(y){return y.h?!0:y.g?y.g.size>=y.j:!1}function ws(y){return y.h?1:y.g?y.g.size:0}function Ss(y,A){return y.h?y.h==A:y.g?y.g.has(A):!1}function vc(y,A){y.g?y.g.add(A):y.h=A}function xc(y,A){y.h&&y.h==A?y.h=null:y.g&&y.g.has(A)&&y.g.delete(A)}_c.prototype.cancel=function(){if(this.i=wc(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const y of this.g.values())y.cancel();this.g.clear()}};function wc(y){if(y.h!=null)return y.i.concat(y.h.G);if(y.g!=null&&y.g.size!==0){let A=y.i;for(const F of y.g.values())A=A.concat(F.G);return A}return b(y.i)}var md=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Vo(y,A){if(y){y=y.split("&");for(let F=0;F<y.length;F++){const Y=y[F].indexOf("=");let fe,be=null;Y>=0?(fe=y[F].substring(0,Y),be=y[F].substring(Y+1)):fe=y[F],A(fe,be?decodeURIComponent(be.replace(/\+/g," ")):"")}}}function _r(y){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let A;y instanceof _r?(this.l=y.l,Rn(this,y.j),this.o=y.o,this.g=y.g,Ai(this,y.u),this.h=y.h,Sc(this,_d(y.i)),this.m=y.m):y&&(A=String(y).match(md))?(this.l=!1,Rn(this,A[1]||"",!0),this.o=Es(A[2]||""),this.g=Es(A[3]||"",!0),Ai(this,A[4]),this.h=Es(A[5]||"",!0),Sc(this,A[6]||"",!0),this.m=Es(A[7]||"")):(this.l=!1,this.i=new Ri(null,this.l))}_r.prototype.toString=function(){const y=[];var A=this.j;A&&y.push(qa(A,$o,!0),":");var F=this.g;return(F||A=="file")&&(y.push("//"),(A=this.o)&&y.push(qa(A,$o,!0),"@"),y.push(Hs(F).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),F=this.u,F!=null&&y.push(":",String(F))),(F=this.h)&&(this.g&&F.charAt(0)!="/"&&y.push("/"),y.push(qa(F,F.charAt(0)=="/"?Ec:pd,!0))),(F=this.i.toString())&&y.push("?",F),(F=this.m)&&y.push("#",qa(F,gd)),y.join("")},_r.prototype.resolve=function(y){const A=hn(this);let F=!!y.j;F?Rn(A,y.j):F=!!y.o,F?A.o=y.o:F=!!y.g,F?A.g=y.g:F=y.u!=null;var Y=y.h;if(F)Ai(A,y.u);else if(F=!!y.h){if(Y.charAt(0)!="/")if(this.g&&!this.h)Y="/"+Y;else{var fe=A.h.lastIndexOf("/");fe!=-1&&(Y=A.h.slice(0,fe+1)+Y)}if(fe=Y,fe==".."||fe==".")Y="";else if(fe.indexOf("./")!=-1||fe.indexOf("/.")!=-1){Y=fe.lastIndexOf("/",0)==0,fe=fe.split("/");const be=[];for(let Ne=0;Ne<fe.length;){const rt=fe[Ne++];rt=="."?Y&&Ne==fe.length&&be.push(""):rt==".."?((be.length>1||be.length==1&&be[0]!="")&&be.pop(),Y&&Ne==fe.length&&be.push("")):(be.push(rt),Y=!0)}Y=be.join("/")}else Y=fe}return F?A.h=Y:F=y.i.toString()!=="",F?Sc(A,_d(y.i)):F=!!y.m,F&&(A.m=y.m),A};function hn(y){return new _r(y)}function Rn(y,A,F){y.j=F?Es(A,!0):A,y.j&&(y.j=y.j.replace(/:$/,""))}function Ai(y,A){if(A){if(A=Number(A),isNaN(A)||A<0)throw Error("Bad port number "+A);y.u=A}else y.u=null}function Sc(y,A,F){A instanceof Ri?(y.i=A,Ho(y.i,y.l)):(F||(A=qa(A,ji)),y.i=new Ri(A,y.l))}function Rt(y,A,F){y.i.set(A,F)}function $a(y){return Rt(y,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),y}function Es(y,A){return y?A?decodeURI(y.replace(/%25/g,"%2525")):decodeURIComponent(y):""}function qa(y,A,F){return typeof y=="string"?(y=encodeURI(y).replace(A,ir),F&&(y=y.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),y):null}function ir(y){return y=y.charCodeAt(0),"%"+(y>>4&15).toString(16)+(y&15).toString(16)}var $o=/[#\/\?@]/g,pd=/[#\?:]/g,Ec=/[#\?]/g,ji=/[#\?@]/g,gd=/#/g;function Ri(y,A){this.h=this.g=null,this.i=y||null,this.j=!!A}function ar(y){y.g||(y.g=new Map,y.h=0,y.i&&Vo(y.i,function(A,F){y.add(decodeURIComponent(A.replace(/\+/g," ")),F)}))}t=Ri.prototype,t.add=function(y,A){ar(this),this.i=null,y=Ii(this,y);let F=this.g.get(y);return F||this.g.set(y,F=[]),F.push(A),this.h+=1,this};function yd(y,A){ar(y),A=Ii(y,A),y.g.has(A)&&(y.i=null,y.h-=y.g.get(A).length,y.g.delete(A))}function Cc(y,A){return ar(y),A=Ii(y,A),y.g.has(A)}t.forEach=function(y,A){ar(this),this.g.forEach(function(F,Y){F.forEach(function(fe){y.call(A,fe,Y,this)},this)},this)};function Tc(y,A){ar(y);let F=[];if(typeof A=="string")Cc(y,A)&&(F=F.concat(y.g.get(Ii(y,A))));else for(y=Array.from(y.g.values()),A=0;A<y.length;A++)F=F.concat(y[A]);return F}t.set=function(y,A){return ar(this),this.i=null,y=Ii(this,y),Cc(this,y)&&(this.h-=this.g.get(y).length),this.g.set(y,[A]),this.h+=1,this},t.get=function(y,A){return y?(y=Tc(this,y),y.length>0?String(y[0]):A):A};function qo(y,A,F){yd(y,A),F.length>0&&(y.i=null,y.g.set(Ii(y,A),b(F)),y.h+=F.length)}t.toString=function(){if(this.i)return this.i;if(!this.g)return"";const y=[],A=Array.from(this.g.keys());for(let Y=0;Y<A.length;Y++){var F=A[Y];const fe=Hs(F);F=Tc(this,F);for(let be=0;be<F.length;be++){let Ne=fe;F[be]!==""&&(Ne+="="+Hs(F[be])),y.push(Ne)}}return this.i=y.join("&")};function _d(y){const A=new Ri;return A.i=y.i,y.g&&(A.g=new Map(y.g),A.h=y.h),A}function Ii(y,A){return A=String(A),y.j&&(A=A.toLowerCase()),A}function Ho(y,A){A&&!y.j&&(ar(y),y.i=null,y.g.forEach(function(F,Y){const fe=Y.toLowerCase();Y!=fe&&(yd(this,Y),qo(this,fe,F))},y)),y.j=A}function Yr(y,A){const F=new Qr;if(l.Image){const Y=new Image;Y.onload=p(kr,F,"TestLoadImage: loaded",!0,A,Y),Y.onerror=p(kr,F,"TestLoadImage: error",!1,A,Y),Y.onabort=p(kr,F,"TestLoadImage: abort",!1,A,Y),Y.ontimeout=p(kr,F,"TestLoadImage: timeout",!1,A,Y),l.setTimeout(function(){Y.ontimeout&&Y.ontimeout()},1e4),Y.src=y}else A(!1)}function Ac(y,A){const F=new Qr,Y=new AbortController,fe=setTimeout(()=>{Y.abort(),kr(F,"TestPingServer: timeout",!1,A)},1e4);fetch(y,{signal:Y.signal}).then(be=>{clearTimeout(fe),be.ok?kr(F,"TestPingServer: ok",!0,A):kr(F,"TestPingServer: server error",!1,A)}).catch(()=>{clearTimeout(fe),kr(F,"TestPingServer: error",!1,A)})}function kr(y,A,F,Y,fe){try{fe&&(fe.onload=null,fe.onerror=null,fe.onabort=null,fe.ontimeout=null),Y(F)}catch{}}function ki(){this.g=new fs}function Cs(y){this.i=y.Sb||null,this.h=y.ab||!1}g(Cs,er),Cs.prototype.g=function(){return new Ha(this.i,this.h)};function Ha(y,A){oe.call(this),this.H=y,this.o=A,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}g(Ha,oe),t=Ha.prototype,t.open=function(y,A){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=y,this.D=A,this.readyState=1,Xr(this)},t.send=function(y){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const A={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};y&&(A.body=y),(this.H||l).fetch(new Request(this.D,A)).then(this.Pa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,Di(this)),this.readyState=0},t.Pa=function(y){if(this.g&&(this.l=y,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=y.headers,this.readyState=2,Xr(this)),this.g&&(this.readyState=3,Xr(this),this.g)))if(this.responseType==="arraybuffer")y.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof l.ReadableStream<"u"&&"body"in y){if(this.j=y.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;Go(this)}else y.text().then(this.Oa.bind(this),this.ga.bind(this))};function Go(y){y.j.read().then(y.Ma.bind(y)).catch(y.ga.bind(y))}t.Ma=function(y){if(this.g){if(this.o&&y.value)this.response.push(y.value);else if(!this.o){var A=y.value?y.value:new Uint8Array(0);(A=this.B.decode(A,{stream:!y.done}))&&(this.response=this.responseText+=A)}y.done?Di(this):Xr(this),this.readyState==3&&Go(this)}},t.Oa=function(y){this.g&&(this.response=this.responseText=y,Di(this))},t.Na=function(y){this.g&&(this.response=y,Di(this))},t.ga=function(){this.g&&Di(this)};function Di(y){y.readyState=4,y.l=null,y.j=null,y.B=null,Xr(y)}t.setRequestHeader=function(y,A){this.A.append(y,A)},t.getResponseHeader=function(y){return this.h&&this.h.get(y.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";const y=[],A=this.h.entries();for(var F=A.next();!F.done;)F=F.value,y.push(F[0]+": "+F[1]),F=A.next();return y.join(`\r
`)};function Xr(y){y.onreadystatechange&&y.onreadystatechange.call(y)}Object.defineProperty(Ha.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(y){this.m=y?"include":"same-origin"}});function Dr(y){let A="";return X(y,function(F,Y){A+=Y,A+=":",A+=F,A+=`\r
`}),A}function Ga(y,A,F){e:{for(Y in F){var Y=!1;break e}Y=!0}Y||(F=Dr(F),typeof y=="string"?F!=null&&Hs(F):Rt(y,A,F))}function Dt(y){oe.call(this),this.headers=new Map,this.L=y||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}g(Dt,oe);var Ts=/^https?$/i,jc=["POST","PUT"];t=Dt.prototype,t.Fa=function(y){this.H=y},t.ea=function(y,A,F,Y){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+y);A=A?A.toUpperCase():"GET",this.D=y,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():yc.g(),this.g.onreadystatechange=v(m(this.Ca,this));try{this.B=!0,this.g.open(A,String(y),!0),this.B=!1}catch(be){Qa(this,be);return}if(y=F||"",F=new Map(this.headers),Y)if(Object.getPrototypeOf(Y)===Object.prototype)for(var fe in Y)F.set(fe,Y[fe]);else if(typeof Y.keys=="function"&&typeof Y.get=="function")for(const be of Y.keys())F.set(be,Y.get(be));else throw Error("Unknown input type for opt_headers: "+String(Y));Y=Array.from(F.keys()).find(be=>be.toLowerCase()=="content-type"),fe=l.FormData&&y instanceof l.FormData,!(Array.prototype.indexOf.call(jc,A,void 0)>=0)||Y||fe||F.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[be,Ne]of F)this.g.setRequestHeader(be,Ne);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(y),this.v=!1}catch(be){Qa(this,be)}};function Qa(y,A){y.h=!1,y.g&&(y.j=!0,y.g.abort(),y.j=!1),y.l=A,y.o=5,Rc(y),Gs(y)}function Rc(y){y.A||(y.A=!0,Se(y,"complete"),Se(y,"error"))}t.abort=function(y){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=y||7,Se(this,"complete"),Se(this,"abort"),Gs(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Gs(this,!0)),Dt.Z.N.call(this)},t.Ca=function(){this.u||(this.B||this.v||this.j?Wa(this):this.Xa())},t.Xa=function(){Wa(this)};function Wa(y){if(y.h&&typeof o<"u"){if(y.v&&Zr(y)==4)setTimeout(y.Ca.bind(y),0);else if(Se(y,"readystatechange"),Zr(y)==4){y.h=!1;try{const be=y.ca();e:switch(be){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var A=!0;break e;default:A=!1}var F;if(!(F=A)){var Y;if(Y=be===0){let Ne=String(y.D).match(md)[1]||null;!Ne&&l.self&&l.self.location&&(Ne=l.self.location.protocol.slice(0,-1)),Y=!Ts.test(Ne?Ne.toLowerCase():"")}F=Y}if(F)Se(y,"complete"),Se(y,"success");else{y.o=6;try{var fe=Zr(y)>2?y.g.statusText:""}catch{fe=""}y.l=fe+" ["+y.ca()+"]",Rc(y)}}finally{Gs(y)}}}}function Gs(y,A){if(y.g){y.m&&(clearTimeout(y.m),y.m=null);const F=y.g;y.g=null,A||Se(y,"ready");try{F.onreadystatechange=null}catch{}}}t.isActive=function(){return!!this.g};function Zr(y){return y.g?y.g.readyState:0}t.ca=function(){try{return Zr(this)>2?this.g.status:-1}catch{return-1}},t.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},t.La=function(y){if(this.g){var A=this.g.responseText;return y&&A.indexOf(y)==0&&(A=A.substring(y.length)),Qn(A)}};function Nn(y){try{if(!y.g)return null;if("response"in y.g)return y.g.response;switch(y.F){case"":case"text":return y.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in y.g)return y.g.mozResponseArrayBuffer}return null}catch{return null}}function Qs(y){const A={};y=(y.g&&Zr(y)>=2&&y.g.getAllResponseHeaders()||"").split(`\r
`);for(let Y=0;Y<y.length;Y++){if(B(y[Y]))continue;var F=dd(y[Y]);const fe=F[0];if(F=F[1],typeof F!="string")continue;F=F.trim();const be=A[fe]||[];A[fe]=be,be.push(F)}re(A,function(Y){return Y.join(", ")})}t.ya=function(){return this.o},t.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function As(y,A,F){return F&&F.internalChannelParams&&F.internalChannelParams[y]||A}function Mi(y){this.za=0,this.i=[],this.j=new Qr,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=As("failFast",!1,y),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=As("baseRetryDelayMs",5e3,y),this.Za=As("retryDelaySeedMs",1e4,y),this.Ta=As("forwardChannelMaxRetries",2,y),this.va=As("forwardChannelRequestTimeoutMs",2e4,y),this.ma=y&&y.xmlHttpFactory||void 0,this.Ua=y&&y.Rb||void 0,this.Aa=y&&y.useFetchStreams||!1,this.O=void 0,this.L=y&&y.supportsCrossDomainXhr||!1,this.M="",this.h=new _c(y&&y.concurrentRequestLimit),this.Ba=new ki,this.S=y&&y.fastHandshake||!1,this.R=y&&y.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=y&&y.Pb||!1,y&&y.ua&&this.j.ua(),y&&y.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&y&&y.detectBufferingProxy||!1,this.ia=void 0,y&&y.longPollingTimeout&&y.longPollingTimeout>0&&(this.ia=y.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}t=Mi.prototype,t.ka=8,t.I=1,t.connect=function(y,A,F,Y){Lt(0),this.W=y,this.H=A||{},F&&Y!==void 0&&(this.H.OSID=F,this.H.OAID=Y),this.F=this.X,this.J=Cd(this,null,this.W),js(this)};function Ic(y){if(Qo(y),y.I==3){var A=y.V++,F=hn(y.J);if(Rt(F,"SID",y.M),Rt(F,"RID",A),Rt(F,"TYPE","terminate"),Ka(y,F),A=new Wr(y,y.j,A),A.M=2,A.A=$a(hn(F)),F=!1,l.navigator&&l.navigator.sendBeacon)try{F=l.navigator.sendBeacon(A.A.toString(),"")}catch{}!F&&l.Image&&(new Image().src=A.A,F=!0),F||(A.g=Td(A.j,null),A.g.ea(A.A)),A.F=Date.now(),bs(A)}Ed(y)}function Oi(y){y.g&&(Dc(y),y.g.cancel(),y.g=null)}function Qo(y){Oi(y),y.v&&(l.clearTimeout(y.v),y.v=null),Ko(y),y.h.cancel(),y.m&&(typeof y.m=="number"&&l.clearTimeout(y.m),y.m=null)}function js(y){if(!bc(y.h)&&!y.m){y.m=!0;var A=y.Ea;U||R(),$||(U(),$=!0),k.add(A,y),y.D=0}}function Wo(y,A){return ws(y.h)>=y.h.j-(y.m?1:0)?!1:y.m?(y.i=A.G.concat(y.i),!0):y.I==1||y.I==2||y.D>=(y.Sa?0:y.Ta)?!1:(y.m=gs(m(y.Ea,y,A),Sd(y,y.D)),y.D++,!0)}t.Ea=function(y){if(this.m)if(this.m=null,this.I==1){if(!y){this.V=Math.floor(Math.random()*1e5),y=this.V++;const fe=new Wr(this,this.j,y);let be=this.o;if(this.U&&(be?(be=z(be),te(be,this.U)):be=this.U),this.u!==null||this.R||(fe.J=be,be=null),this.S)e:{for(var A=0,F=0;F<this.i.length;F++){t:{var Y=this.i[F];if("__data__"in Y.map&&(Y=Y.map.__data__,typeof Y=="string")){Y=Y.length;break t}Y=void 0}if(Y===void 0)break;if(A+=Y,A>4096){A=F;break e}if(A===4096||F===this.i.length-1){A=F+1;break e}}A=1e3}else A=1e3;A=bd(this,fe,A),F=hn(this.J),Rt(F,"RID",y),Rt(F,"CVER",22),this.G&&Rt(F,"X-HTTP-Session-Id",this.G),Ka(this,F),be&&(this.R?A="headers="+Hs(Dr(be))+"&"+A:this.u&&Ga(F,this.u,be)),vc(this.h,fe),this.Ra&&Rt(F,"TYPE","init"),this.S?(Rt(F,"$req",A),Rt(F,"SID","null"),fe.U=!0,_s(fe,F,null)):_s(fe,F,A),this.I=2}}else this.I==3&&(y?kc(this,y):this.i.length==0||bc(this.h)||kc(this))};function kc(y,A){var F;A?F=A.l:F=y.V++;const Y=hn(y.J);Rt(Y,"SID",y.M),Rt(Y,"RID",F),Rt(Y,"AID",y.K),Ka(y,Y),y.u&&y.o&&Ga(Y,y.u,y.o),F=new Wr(y,y.j,F,y.D+1),y.u===null&&(F.J=y.o),A&&(y.i=A.G.concat(y.i)),A=bd(y,F,1e3),F.H=Math.round(y.va*.5)+Math.round(y.va*.5*Math.random()),vc(y.h,F),_s(F,Y,A)}function Ka(y,A){y.H&&X(y.H,function(F,Y){Rt(A,Y,F)}),y.l&&X({},function(F,Y){Rt(A,Y,F)})}function bd(y,A,F){F=Math.min(y.i.length,F);const Y=y.l?m(y.l.Ka,y.l,y):null;e:{var fe=y.i;let rt=-1;for(;;){const nn=["count="+F];rt==-1?F>0?(rt=fe[0].g,nn.push("ofs="+rt)):rt=0:nn.push("ofs="+rt);let Ct=!0;for(let Qt=0;Qt<F;Qt++){var be=fe[Qt].g;const Mr=fe[Qt].map;if(be-=rt,be<0)rt=Math.max(0,fe[Qt].g-100),Ct=!1;else try{be="req"+be+"_"||"";try{var Ne=Mr instanceof Map?Mr:Object.entries(Mr);for(const[Is,Jr]of Ne){let es=Jr;d(Jr)&&(es=nt(Jr)),nn.push(be+Is+"="+encodeURIComponent(es))}}catch(Is){throw nn.push(be+"type="+encodeURIComponent("_badmap")),Is}}catch{Y&&Y(Mr)}}if(Ct){Ne=nn.join("&");break e}}Ne=void 0}return y=y.i.splice(0,F),A.G=y,Ne}function vd(y){if(!y.g&&!y.v){y.Y=1;var A=y.Da;U||R(),$||(U(),$=!0),k.add(A,y),y.A=0}}function Ya(y){return y.g||y.v||y.A>=3?!1:(y.Y++,y.v=gs(m(y.Da,y),Sd(y,y.A)),y.A++,!0)}t.Da=function(){if(this.v=null,xd(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var y=4*this.T;this.j.info("BP detection timer enabled: "+y),this.B=gs(m(this.Wa,this),y)}},t.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,Lt(10),Oi(this),xd(this))};function Dc(y){y.B!=null&&(l.clearTimeout(y.B),y.B=null)}function xd(y){y.g=new Wr(y,y.j,"rpc",y.Y),y.u===null&&(y.g.J=y.o),y.g.P=0;var A=hn(y.na);Rt(A,"RID","rpc"),Rt(A,"SID",y.M),Rt(A,"AID",y.K),Rt(A,"CI",y.F?"0":"1"),!y.F&&y.ia&&Rt(A,"TO",y.ia),Rt(A,"TYPE","xmlhttp"),Ka(y,A),y.u&&y.o&&Ga(A,y.u,y.o),y.O&&(y.g.H=y.O);var F=y.g;y=y.ba,F.M=1,F.A=$a(hn(A)),F.u=null,F.R=!0,Uo(F,y)}t.Va=function(){this.C!=null&&(this.C=null,Oi(this),Ya(this),Lt(19))};function Ko(y){y.C!=null&&(l.clearTimeout(y.C),y.C=null)}function wd(y,A){var F=null;if(y.g==A){Ko(y),Dc(y),y.g=null;var Y=2}else if(Ss(y.h,A))F=A.G,xc(y.h,A),Y=1;else return;if(y.I!=0){if(A.o)if(Y==1){F=A.u?A.u.length:0,A=Date.now()-A.F;var fe=y.D;Y=Ti(),Se(Y,new tr(Y,F)),js(y)}else vd(y);else if(fe=A.m,fe==3||fe==0&&A.X>0||!(Y==1&&Wo(y,A)||Y==2&&Ya(y)))switch(F&&F.length>0&&(A=y.h,A.i=A.i.concat(F)),fe){case 1:Rs(y,5);break;case 4:Rs(y,10);break;case 3:Rs(y,6);break;default:Rs(y,2)}}}function Sd(y,A){let F=y.Qa+Math.floor(Math.random()*y.Za);return y.isActive()||(F*=2),F*A}function Rs(y,A){if(y.j.info("Error code "+A),A==2){var F=m(y.bb,y),Y=y.Ua;const fe=!Y;Y=new _r(Y||"//www.google.com/images/cleardot.gif"),l.location&&l.location.protocol=="http"||Rn(Y,"https"),$a(Y),fe?Yr(Y.toString(),F):Ac(Y.toString(),F)}else Lt(2);y.I=0,y.l&&y.l.pa(A),Ed(y),Qo(y)}t.bb=function(y){y?(this.j.info("Successfully pinged google.com"),Lt(2)):(this.j.info("Failed to ping google.com"),Lt(1))};function Ed(y){if(y.I=0,y.ja=[],y.l){const A=wc(y.h);(A.length!=0||y.i.length!=0)&&(E(y.ja,A),E(y.ja,y.i),y.h.i.length=0,b(y.i),y.i.length=0),y.l.oa()}}function Cd(y,A,F){var Y=F instanceof _r?hn(F):new _r(F);if(Y.g!="")A&&(Y.g=A+"."+Y.g),Ai(Y,Y.u);else{var fe=l.location;Y=fe.protocol,A=A?A+"."+fe.hostname:fe.hostname,fe=+fe.port;const be=new _r(null);Y&&Rn(be,Y),A&&(be.g=A),fe&&Ai(be,fe),F&&(be.h=F),Y=be}return F=y.G,A=y.wa,F&&A&&Rt(Y,F,A),Rt(Y,"VER",y.ka),Ka(y,Y),Y}function Td(y,A,F){if(A&&!y.L)throw Error("Can't create secondary domain capable XhrIo object.");return A=y.Aa&&!y.ma?new Dt(new Cs({ab:F})):new Dt(y.ma),A.Fa(y.L),A}t.isActive=function(){return!!this.l&&this.l.isActive(this)};function Ad(){}t=Ad.prototype,t.ra=function(){},t.qa=function(){},t.pa=function(){},t.oa=function(){},t.isActive=function(){return!0},t.Ka=function(){};function Ni(){}Ni.prototype.g=function(y,A){return new nr(y,A)};function nr(y,A){oe.call(this),this.g=new Mi(A),this.l=y,this.h=A&&A.messageUrlParams||null,y=A&&A.messageHeaders||null,A&&A.clientProtocolHeaderRequired&&(y?y["X-Client-Protocol"]="webchannel":y={"X-Client-Protocol":"webchannel"}),this.g.o=y,y=A&&A.initMessageHeaders||null,A&&A.messageContentType&&(y?y["X-WebChannel-Content-Type"]=A.messageContentType:y={"X-WebChannel-Content-Type":A.messageContentType}),A&&A.sa&&(y?y["X-WebChannel-Client-Profile"]=A.sa:y={"X-WebChannel-Client-Profile":A.sa}),this.g.U=y,(y=A&&A.Qb)&&!B(y)&&(this.g.u=y),this.A=A&&A.supportsCrossDomainXhr||!1,this.v=A&&A.sendRawJson||!1,(A=A&&A.httpSessionIdParam)&&!B(A)&&(this.g.G=A,y=this.h,y!==null&&A in y&&(y=this.h,A in y&&delete y[A])),this.j=new Ws(this)}g(nr,oe),nr.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},nr.prototype.close=function(){Ic(this.g)},nr.prototype.o=function(y){var A=this.g;if(typeof y=="string"){var F={};F.__data__=y,y=F}else this.v&&(F={},F.__data__=nt(y),y=F);A.i.push(new dn(A.Ya++,y)),A.I==3&&js(A)},nr.prototype.N=function(){this.g.l=null,delete this.j,Ic(this.g),delete this.g,nr.Z.N.call(this)};function jd(y){Jt.call(this),y.__headers__&&(this.headers=y.__headers__,this.statusCode=y.__status__,delete y.__headers__,delete y.__status__);var A=y.__sm__;if(A){e:{for(const F in A){y=F;break e}y=void 0}(this.i=y)&&(y=this.i,A=A!==null&&y in A?A[y]:void 0),this.data=A}else this.data=y}g(jd,Jt);function Rd(){Wn.call(this),this.status=1}g(Rd,Wn);function Ws(y){this.g=y}g(Ws,Ad),Ws.prototype.ra=function(){Se(this.g,"a")},Ws.prototype.qa=function(y){Se(this.g,new jd(y))},Ws.prototype.pa=function(y){Se(this.g,new Rd)},Ws.prototype.oa=function(){Se(this.g,"b")},Ni.prototype.createWebChannel=Ni.prototype.g,nr.prototype.send=nr.prototype.o,nr.prototype.open=nr.prototype.m,nr.prototype.close=nr.prototype.close,LE=function(){return new Ni},zE=function(){return Ti()},BE=Et,dy={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},Fa.NO_ERROR=0,Fa.TIMEOUT=8,Fa.HTTP_ERROR=6,Yh=Fa,gc.COMPLETE="complete",PE=gc,ms.EventType=bt,bt.OPEN="a",bt.CLOSE="b",bt.ERROR="c",bt.MESSAGE="d",oe.prototype.listen=oe.prototype.J,vu=ms,Dt.prototype.listenOnce=Dt.prototype.K,Dt.prototype.getLastError=Dt.prototype.Ha,Dt.prototype.getLastErrorCode=Dt.prototype.ya,Dt.prototype.getStatus=Dt.prototype.ca,Dt.prototype.getResponseJson=Dt.prototype.La,Dt.prototype.getResponseText=Dt.prototype.la,Dt.prototype.send=Dt.prototype.ea,Dt.prototype.setWithCredentials=Dt.prototype.Fa,NE=Dt}).apply(typeof Bh<"u"?Bh:typeof self<"u"?self:typeof window<"u"?window:{});const Aw="@firebase/firestore",jw="4.9.3";class Xn{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Xn.UNAUTHENTICATED=new Xn(null),Xn.GOOGLE_CREDENTIALS=new Xn("google-credentials-uid"),Xn.FIRST_PARTY=new Xn("first-party-uid"),Xn.MOCK_USER=new Xn("mock-user");let oc="12.7.0";const jo=new qy("@firebase/firestore");function Il(){return jo.logLevel}function ze(t,...e){if(jo.logLevel<=ht.DEBUG){const n=e.map(t0);jo.debug(`Firestore (${oc}): ${t}`,...n)}}function bi(t,...e){if(jo.logLevel<=ht.ERROR){const n=e.map(t0);jo.error(`Firestore (${oc}): ${t}`,...n)}}function $l(t,...e){if(jo.logLevel<=ht.WARN){const n=e.map(t0);jo.warn(`Firestore (${oc}): ${t}`,...n)}}function t0(t){if(typeof t=="string")return t;try{return(function(n){return JSON.stringify(n)})(t)}catch{return t}}function Ke(t,e,n){let r="Unexpected state";typeof e=="string"?r=e:n=e,UE(t,r,n)}function UE(t,e,n){let r=`FIRESTORE (${oc}) INTERNAL ASSERTION FAILED: ${e} (ID: ${t.toString(16)})`;if(n!==void 0)try{r+=" CONTEXT: "+JSON.stringify(n)}catch{r+=" CONTEXT: "+n}throw bi(r),new Error(r)}function jt(t,e,n,r){let i="Unexpected state";typeof n=="string"?i=n:r=n,t||UE(e,i,r)}function tt(t,e){return t}const je={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Pe extends Si{constructor(e,n){super(e,n),this.code=e,this.message=n,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class mi{constructor(){this.promise=new Promise(((e,n)=>{this.resolve=e,this.reject=n}))}}class FE{constructor(e,n){this.user=n,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class hM{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,n){e.enqueueRetryable((()=>n(Xn.UNAUTHENTICATED)))}shutdown(){}}class fM{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,n){this.changeListener=n,e.enqueueRetryable((()=>n(this.token.user)))}shutdown(){this.changeListener=null}}class mM{constructor(e){this.t=e,this.currentUser=Xn.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,n){jt(this.o===void 0,42304);let r=this.i;const i=h=>this.i!==r?(r=this.i,n(h)):Promise.resolve();let o=new mi;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new mi,e.enqueueRetryable((()=>i(this.currentUser)))};const l=()=>{const h=o;e.enqueueRetryable((async()=>{await h.promise,await i(this.currentUser)}))},d=h=>{ze("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=h,this.o&&(this.auth.addAuthTokenListener(this.o),l())};this.t.onInit((h=>d(h))),setTimeout((()=>{if(!this.auth){const h=this.t.getImmediate({optional:!0});h?d(h):(ze("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new mi)}}),0),l()}getToken(){const e=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then((r=>this.i!==e?(ze("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(jt(typeof r.accessToken=="string",31837,{l:r}),new FE(r.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return jt(e===null||typeof e=="string",2055,{h:e}),new Xn(e)}}class pM{constructor(e,n,r){this.P=e,this.T=n,this.I=r,this.type="FirstParty",this.user=Xn.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class gM{constructor(e,n,r){this.P=e,this.T=n,this.I=r}getToken(){return Promise.resolve(new pM(this.P,this.T,this.I))}start(e,n){e.enqueueRetryable((()=>n(Xn.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class Rw{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class yM{constructor(e,n){this.V=n,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,ss(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,n){jt(this.o===void 0,3512);const r=o=>{o.error!=null&&ze("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${o.error.message}`);const l=o.token!==this.m;return this.m=o.token,ze("FirebaseAppCheckTokenProvider",`Received ${l?"new":"existing"} token.`),l?n(o.token):Promise.resolve()};this.o=o=>{e.enqueueRetryable((()=>r(o)))};const i=o=>{ze("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=o,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((o=>i(o))),setTimeout((()=>{if(!this.appCheck){const o=this.V.getImmediate({optional:!0});o?i(o):ze("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new Rw(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((n=>n?(jt(typeof n.token=="string",44558,{tokenResult:n}),this.m=n.token,new Rw(n.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function _M(t){const e=typeof self<"u"&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(n);else for(let r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}class n0{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const i=_M(40);for(let o=0;o<i.length;++o)r.length<20&&i[o]<n&&(r+=e.charAt(i[o]%62))}return r}}function ft(t,e){return t<e?-1:t>e?1:0}function hy(t,e){const n=Math.min(t.length,e.length);for(let r=0;r<n;r++){const i=t.charAt(r),o=e.charAt(r);if(i!==o)return Ng(i)===Ng(o)?ft(i,o):Ng(i)?1:-1}return ft(t.length,e.length)}const bM=55296,vM=57343;function Ng(t){const e=t.charCodeAt(0);return e>=bM&&e<=vM}function ql(t,e,n){return t.length===e.length&&t.every(((r,i)=>n(r,e[i])))}const Iw="__name__";class Ps{constructor(e,n,r){n===void 0?n=0:n>e.length&&Ke(637,{offset:n,range:e.length}),r===void 0?r=e.length-n:r>e.length-n&&Ke(1746,{length:r,range:e.length-n}),this.segments=e,this.offset=n,this.len=r}get length(){return this.len}isEqual(e){return Ps.comparator(this,e)===0}child(e){const n=this.segments.slice(this.offset,this.limit());return e instanceof Ps?e.forEach((r=>{n.push(r)})):n.push(e),this.construct(n)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}forEach(e){for(let n=this.offset,r=this.limit();n<r;n++)e(this.segments[n])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,n){const r=Math.min(e.length,n.length);for(let i=0;i<r;i++){const o=Ps.compareSegments(e.get(i),n.get(i));if(o!==0)return o}return ft(e.length,n.length)}static compareSegments(e,n){const r=Ps.isNumericId(e),i=Ps.isNumericId(n);return r&&!i?-1:!r&&i?1:r&&i?Ps.extractNumericId(e).compare(Ps.extractNumericId(n)):hy(e,n)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return ba.fromString(e.substring(4,e.length-2))}}class Ut extends Ps{construct(e,n,r){return new Ut(e,n,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const n=[];for(const r of e){if(r.indexOf("//")>=0)throw new Pe(je.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);n.push(...r.split("/").filter((i=>i.length>0)))}return new Ut(n)}static emptyPath(){return new Ut([])}}const xM=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Fn extends Ps{construct(e,n,r){return new Fn(e,n,r)}static isValidIdentifier(e){return xM.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Fn.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===Iw}static keyField(){return new Fn([Iw])}static fromServerFormat(e){const n=[];let r="",i=0;const o=()=>{if(r.length===0)throw new Pe(je.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);n.push(r),r=""};let l=!1;for(;i<e.length;){const d=e[i];if(d==="\\"){if(i+1===e.length)throw new Pe(je.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const h=e[i+1];if(h!=="\\"&&h!=="."&&h!=="`")throw new Pe(je.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=h,i+=2}else d==="`"?(l=!l,i++):d!=="."||l?(r+=d,i++):(o(),i++)}if(o(),l)throw new Pe(je.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Fn(n)}static emptyPath(){return new Fn([])}}class Ge{constructor(e){this.path=e}static fromPath(e){return new Ge(Ut.fromString(e))}static fromName(e){return new Ge(Ut.fromString(e).popFirst(5))}static empty(){return new Ge(Ut.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Ut.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,n){return Ut.comparator(e.path,n.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Ge(new Ut(e.slice()))}}function VE(t,e,n){if(!n)throw new Pe(je.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function wM(t,e,n,r){if(e===!0&&r===!0)throw new Pe(je.INVALID_ARGUMENT,`${t} and ${n} cannot be used together.`)}function kw(t){if(!Ge.isDocumentKey(t))throw new Pe(je.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function Dw(t){if(Ge.isDocumentKey(t))throw new Pe(je.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function $E(t){return typeof t=="object"&&t!==null&&(Object.getPrototypeOf(t)===Object.prototype||Object.getPrototypeOf(t)===null)}function Hf(t){if(t===void 0)return"undefined";if(t===null)return"null";if(typeof t=="string")return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if(typeof t=="number"||typeof t=="boolean")return""+t;if(typeof t=="object"){if(t instanceof Array)return"an array";{const e=(function(r){return r.constructor?r.constructor.name:null})(t);return e?`a custom ${e} object`:"an object"}}return typeof t=="function"?"a function":Ke(12329,{type:typeof t})}function us(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new Pe(je.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=Hf(t);throw new Pe(je.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}function bn(t,e){const n={typeString:t};return e&&(n.value=e),n}function Ju(t,e){if(!$E(t))throw new Pe(je.INVALID_ARGUMENT,"JSON must be an object");let n;for(const r in e)if(e[r]){const i=e[r].typeString,o="value"in e[r]?{value:e[r].value}:void 0;if(!(r in t)){n=`JSON missing required field: '${r}'`;break}const l=t[r];if(i&&typeof l!==i){n=`JSON field '${r}' must be a ${i}.`;break}if(o!==void 0&&l!==o.value){n=`Expected '${r}' field to equal '${o.value}'`;break}}if(n)throw new Pe(je.INVALID_ARGUMENT,n);return!0}const Mw=-62135596800,Ow=1e6;class Ht{static now(){return Ht.fromMillis(Date.now())}static fromDate(e){return Ht.fromMillis(e.getTime())}static fromMillis(e){const n=Math.floor(e/1e3),r=Math.floor((e-1e3*n)*Ow);return new Ht(n,r)}constructor(e,n){if(this.seconds=e,this.nanoseconds=n,n<0)throw new Pe(je.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new Pe(je.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(e<Mw)throw new Pe(je.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Pe(je.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/Ow}_compareTo(e){return this.seconds===e.seconds?ft(this.nanoseconds,e.nanoseconds):ft(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:Ht._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(Ju(e,Ht._jsonSchema))return new Ht(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-Mw;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}Ht._jsonSchemaVersion="firestore/timestamp/1.0",Ht._jsonSchema={type:bn("string",Ht._jsonSchemaVersion),seconds:bn("number"),nanoseconds:bn("number")};class Ze{static fromTimestamp(e){return new Ze(e)}static min(){return new Ze(new Ht(0,0))}static max(){return new Ze(new Ht(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const Nu=-1;function SM(t,e){const n=t.toTimestamp().seconds,r=t.toTimestamp().nanoseconds+1,i=Ze.fromTimestamp(r===1e9?new Ht(n+1,0):new Ht(n,r));return new xa(i,Ge.empty(),e)}function EM(t){return new xa(t.readTime,t.key,Nu)}class xa{constructor(e,n,r){this.readTime=e,this.documentKey=n,this.largestBatchId=r}static min(){return new xa(Ze.min(),Ge.empty(),Nu)}static max(){return new xa(Ze.max(),Ge.empty(),Nu)}}function CM(t,e){let n=t.readTime.compareTo(e.readTime);return n!==0?n:(n=Ge.comparator(t.documentKey,e.documentKey),n!==0?n:ft(t.largestBatchId,e.largestBatchId))}const TM="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class AM{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function lc(t){if(t.code!==je.FAILED_PRECONDITION||t.message!==TM)throw t;ze("LocalStore","Unexpectedly lost primary lease")}class Ie{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((n=>{this.isDone=!0,this.result=n,this.nextCallback&&this.nextCallback(n)}),(n=>{this.isDone=!0,this.error=n,this.catchCallback&&this.catchCallback(n)}))}catch(e){return this.next(void 0,e)}next(e,n){return this.callbackAttached&&Ke(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new Ie(((r,i)=>{this.nextCallback=o=>{this.wrapSuccess(e,o).next(r,i)},this.catchCallback=o=>{this.wrapFailure(n,o).next(r,i)}}))}toPromise(){return new Promise(((e,n)=>{this.next(e,n)}))}wrapUserFunction(e){try{const n=e();return n instanceof Ie?n:Ie.resolve(n)}catch(n){return Ie.reject(n)}}wrapSuccess(e,n){return e?this.wrapUserFunction((()=>e(n))):Ie.resolve(n)}wrapFailure(e,n){return e?this.wrapUserFunction((()=>e(n))):Ie.reject(n)}static resolve(e){return new Ie(((n,r)=>{n(e)}))}static reject(e){return new Ie(((n,r)=>{r(e)}))}static waitFor(e){return new Ie(((n,r)=>{let i=0,o=0,l=!1;e.forEach((d=>{++i,d.next((()=>{++o,l&&o===i&&n()}),(h=>r(h)))})),l=!0,o===i&&n()}))}static or(e){let n=Ie.resolve(!1);for(const r of e)n=n.next((i=>i?Ie.resolve(i):r()));return n}static forEach(e,n){const r=[];return e.forEach(((i,o)=>{r.push(n.call(this,i,o))})),this.waitFor(r)}static mapArray(e,n){return new Ie(((r,i)=>{const o=e.length,l=new Array(o);let d=0;for(let h=0;h<o;h++){const m=h;n(e[m]).next((p=>{l[m]=p,++d,d===o&&r(l)}),(p=>i(p)))}}))}static doWhile(e,n){return new Ie(((r,i)=>{const o=()=>{e()===!0?n().next((()=>{o()}),i):r()};o()}))}}function jM(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}function cc(t){return t.name==="IndexedDbTransactionError"}class Gf{constructor(e,n){this.previousValue=e,n&&(n.sequenceNumberHandler=r=>this.ae(r),this.ue=r=>n.writeSequenceNumber(r))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}Gf.ce=-1;const r0=-1;function Qf(t){return t==null}function mf(t){return t===0&&1/t==-1/0}function RM(t){return typeof t=="number"&&Number.isInteger(t)&&!mf(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}const qE="";function IM(t){let e="";for(let n=0;n<t.length;n++)e.length>0&&(e=Nw(e)),e=kM(t.get(n),e);return Nw(e)}function kM(t,e){let n=e;const r=t.length;for(let i=0;i<r;i++){const o=t.charAt(i);switch(o){case"\0":n+="";break;case qE:n+="";break;default:n+=o}}return n}function Nw(t){return t+qE+""}function Pw(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Ma(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function HE(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}class Zt{constructor(e,n){this.comparator=e,this.root=n||Un.EMPTY}insert(e,n){return new Zt(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,Un.BLACK,null,null))}remove(e){return new Zt(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Un.BLACK,null,null))}get(e){let n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(r===0)return n.value;r<0?n=n.left:r>0&&(n=n.right)}return null}indexOf(e){let n=0,r=this.root;for(;!r.isEmpty();){const i=this.comparator(e,r.key);if(i===0)return n+r.left.size;i<0?r=r.left:(n+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((n,r)=>(e(n,r),!1)))}toString(){const e=[];return this.inorderTraversal(((n,r)=>(e.push(`${n}:${r}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new zh(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new zh(this.root,e,this.comparator,!1)}getReverseIterator(){return new zh(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new zh(this.root,e,this.comparator,!0)}}class zh{constructor(e,n,r,i){this.isReverse=i,this.nodeStack=[];let o=1;for(;!e.isEmpty();)if(o=n?r(e.key,n):1,n&&i&&(o*=-1),o<0)e=this.isReverse?e.left:e.right;else{if(o===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const n={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return n}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Un{constructor(e,n,r,i,o){this.key=e,this.value=n,this.color=r??Un.RED,this.left=i??Un.EMPTY,this.right=o??Un.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,n,r,i,o){return new Un(e??this.key,n??this.value,r??this.color,i??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,r){let i=this;const o=r(e,i.key);return i=o<0?i.copy(null,null,null,i.left.insert(e,n,r),null):o===0?i.copy(null,n,null,null,null):i.copy(null,null,null,null,i.right.insert(e,n,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return Un.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,n){let r,i=this;if(n(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),n(e,i.key)===0){if(i.right.isEmpty())return Un.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Un.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Un.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Ke(43730,{key:this.key,value:this.value});if(this.right.isRed())throw Ke(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw Ke(27949);return e+(this.isRed()?0:1)}}Un.EMPTY=null,Un.RED=!0,Un.BLACK=!1;Un.EMPTY=new class{constructor(){this.size=0}get key(){throw Ke(57766)}get value(){throw Ke(16141)}get color(){throw Ke(16727)}get left(){throw Ke(29726)}get right(){throw Ke(36894)}copy(e,n,r,i,o){return this}insert(e,n,r){return new Un(e,n)}remove(e,n){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Tn{constructor(e){this.comparator=e,this.data=new Zt(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((n,r)=>(e(n),!1)))}forEachInRange(e,n){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;n(i.key)}}forEachWhile(e,n){let r;for(r=n!==void 0?this.data.getIteratorFrom(n):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const n=this.data.getIteratorFrom(e);return n.hasNext()?n.getNext().key:null}getIterator(){return new Bw(this.data.getIterator())}getIteratorFrom(e){return new Bw(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let n=this;return n.size<e.size&&(n=e,e=this),e.forEach((r=>{n=n.add(r)})),n}isEqual(e){if(!(e instanceof Tn)||this.size!==e.size)return!1;const n=this.data.getIterator(),r=e.data.getIterator();for(;n.hasNext();){const i=n.getNext().key,o=r.getNext().key;if(this.comparator(i,o)!==0)return!1}return!0}toArray(){const e=[];return this.forEach((n=>{e.push(n)})),e}toString(){const e=[];return this.forEach((n=>e.push(n))),"SortedSet("+e.toString()+")"}copy(e){const n=new Tn(this.comparator);return n.data=e,n}}class Bw{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class Tr{constructor(e){this.fields=e,e.sort(Fn.comparator)}static empty(){return new Tr([])}unionWith(e){let n=new Tn(Fn.comparator);for(const r of this.fields)n=n.add(r);for(const r of e)n=n.add(r);return new Tr(n.toArray())}covers(e){for(const n of this.fields)if(n.isPrefixOf(e))return!0;return!1}isEqual(e){return ql(this.fields,e.fields,((n,r)=>n.isEqual(r)))}}class GE extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class $n{constructor(e){this.binaryString=e}static fromBase64String(e){const n=(function(i){try{return atob(i)}catch(o){throw typeof DOMException<"u"&&o instanceof DOMException?new GE("Invalid base64 string: "+o):o}})(e);return new $n(n)}static fromUint8Array(e){const n=(function(i){let o="";for(let l=0;l<i.length;++l)o+=String.fromCharCode(i[l]);return o})(e);return new $n(n)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(n){return btoa(n)})(this.binaryString)}toUint8Array(){return(function(n){const r=new Uint8Array(n.length);for(let i=0;i<n.length;i++)r[i]=n.charCodeAt(i);return r})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return ft(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}$n.EMPTY_BYTE_STRING=new $n("");const DM=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function wa(t){if(jt(!!t,39018),typeof t=="string"){let e=0;const n=DM.exec(t);if(jt(!!n,46558,{timestamp:t}),n[1]){let i=n[1];i=(i+"000000000").substr(0,9),e=Number(i)}const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:on(t.seconds),nanos:on(t.nanos)}}function on(t){return typeof t=="number"?t:typeof t=="string"?Number(t):0}function Sa(t){return typeof t=="string"?$n.fromBase64String(t):$n.fromUint8Array(t)}const QE="server_timestamp",WE="__type__",KE="__previous_value__",YE="__local_write_time__";function s0(t){return(t?.mapValue?.fields||{})[WE]?.stringValue===QE}function Wf(t){const e=t.mapValue.fields[KE];return s0(e)?Wf(e):e}function Pu(t){const e=wa(t.mapValue.fields[YE].timestampValue);return new Ht(e.seconds,e.nanos)}class MM{constructor(e,n,r,i,o,l,d,h,m,p){this.databaseId=e,this.appId=n,this.persistenceKey=r,this.host=i,this.ssl=o,this.forceLongPolling=l,this.autoDetectLongPolling=d,this.longPollingOptions=h,this.useFetchStreams=m,this.isUsingEmulator=p}}const pf="(default)";class Bu{constructor(e,n){this.projectId=e,this.database=n||pf}static empty(){return new Bu("","")}get isDefaultDatabase(){return this.database===pf}isEqual(e){return e instanceof Bu&&e.projectId===this.projectId&&e.database===this.database}}const XE="__type__",OM="__max__",Lh={mapValue:{}},ZE="__vector__",gf="value";function Ea(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?s0(t)?4:PM(t)?9007199254740991:NM(t)?10:11:Ke(28295,{value:t})}function qs(t,e){if(t===e)return!0;const n=Ea(t);if(n!==Ea(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Pu(t).isEqual(Pu(e));case 3:return(function(i,o){if(typeof i.timestampValue=="string"&&typeof o.timestampValue=="string"&&i.timestampValue.length===o.timestampValue.length)return i.timestampValue===o.timestampValue;const l=wa(i.timestampValue),d=wa(o.timestampValue);return l.seconds===d.seconds&&l.nanos===d.nanos})(t,e);case 5:return t.stringValue===e.stringValue;case 6:return(function(i,o){return Sa(i.bytesValue).isEqual(Sa(o.bytesValue))})(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return(function(i,o){return on(i.geoPointValue.latitude)===on(o.geoPointValue.latitude)&&on(i.geoPointValue.longitude)===on(o.geoPointValue.longitude)})(t,e);case 2:return(function(i,o){if("integerValue"in i&&"integerValue"in o)return on(i.integerValue)===on(o.integerValue);if("doubleValue"in i&&"doubleValue"in o){const l=on(i.doubleValue),d=on(o.doubleValue);return l===d?mf(l)===mf(d):isNaN(l)&&isNaN(d)}return!1})(t,e);case 9:return ql(t.arrayValue.values||[],e.arrayValue.values||[],qs);case 10:case 11:return(function(i,o){const l=i.mapValue.fields||{},d=o.mapValue.fields||{};if(Pw(l)!==Pw(d))return!1;for(const h in l)if(l.hasOwnProperty(h)&&(d[h]===void 0||!qs(l[h],d[h])))return!1;return!0})(t,e);default:return Ke(52216,{left:t})}}function zu(t,e){return(t.values||[]).find((n=>qs(n,e)))!==void 0}function Hl(t,e){if(t===e)return 0;const n=Ea(t),r=Ea(e);if(n!==r)return ft(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return ft(t.booleanValue,e.booleanValue);case 2:return(function(o,l){const d=on(o.integerValue||o.doubleValue),h=on(l.integerValue||l.doubleValue);return d<h?-1:d>h?1:d===h?0:isNaN(d)?isNaN(h)?0:-1:1})(t,e);case 3:return zw(t.timestampValue,e.timestampValue);case 4:return zw(Pu(t),Pu(e));case 5:return hy(t.stringValue,e.stringValue);case 6:return(function(o,l){const d=Sa(o),h=Sa(l);return d.compareTo(h)})(t.bytesValue,e.bytesValue);case 7:return(function(o,l){const d=o.split("/"),h=l.split("/");for(let m=0;m<d.length&&m<h.length;m++){const p=ft(d[m],h[m]);if(p!==0)return p}return ft(d.length,h.length)})(t.referenceValue,e.referenceValue);case 8:return(function(o,l){const d=ft(on(o.latitude),on(l.latitude));return d!==0?d:ft(on(o.longitude),on(l.longitude))})(t.geoPointValue,e.geoPointValue);case 9:return Lw(t.arrayValue,e.arrayValue);case 10:return(function(o,l){const d=o.fields||{},h=l.fields||{},m=d[gf]?.arrayValue,p=h[gf]?.arrayValue,g=ft(m?.values?.length||0,p?.values?.length||0);return g!==0?g:Lw(m,p)})(t.mapValue,e.mapValue);case 11:return(function(o,l){if(o===Lh.mapValue&&l===Lh.mapValue)return 0;if(o===Lh.mapValue)return 1;if(l===Lh.mapValue)return-1;const d=o.fields||{},h=Object.keys(d),m=l.fields||{},p=Object.keys(m);h.sort(),p.sort();for(let g=0;g<h.length&&g<p.length;++g){const v=hy(h[g],p[g]);if(v!==0)return v;const b=Hl(d[h[g]],m[p[g]]);if(b!==0)return b}return ft(h.length,p.length)})(t.mapValue,e.mapValue);default:throw Ke(23264,{he:n})}}function zw(t,e){if(typeof t=="string"&&typeof e=="string"&&t.length===e.length)return ft(t,e);const n=wa(t),r=wa(e),i=ft(n.seconds,r.seconds);return i!==0?i:ft(n.nanos,r.nanos)}function Lw(t,e){const n=t.values||[],r=e.values||[];for(let i=0;i<n.length&&i<r.length;++i){const o=Hl(n[i],r[i]);if(o)return o}return ft(n.length,r.length)}function Gl(t){return fy(t)}function fy(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?(function(n){const r=wa(n);return`time(${r.seconds},${r.nanos})`})(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?(function(n){return Sa(n).toBase64()})(t.bytesValue):"referenceValue"in t?(function(n){return Ge.fromName(n).toString()})(t.referenceValue):"geoPointValue"in t?(function(n){return`geo(${n.latitude},${n.longitude})`})(t.geoPointValue):"arrayValue"in t?(function(n){let r="[",i=!0;for(const o of n.values||[])i?i=!1:r+=",",r+=fy(o);return r+"]"})(t.arrayValue):"mapValue"in t?(function(n){const r=Object.keys(n.fields||{}).sort();let i="{",o=!0;for(const l of r)o?o=!1:i+=",",i+=`${l}:${fy(n.fields[l])}`;return i+"}"})(t.mapValue):Ke(61005,{value:t})}function Xh(t){switch(Ea(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=Wf(t);return e?16+Xh(e):16;case 5:return 2*t.stringValue.length;case 6:return Sa(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return(function(r){return(r.values||[]).reduce(((i,o)=>i+Xh(o)),0)})(t.arrayValue);case 10:case 11:return(function(r){let i=0;return Ma(r.fields,((o,l)=>{i+=o.length+Xh(l)})),i})(t.mapValue);default:throw Ke(13486,{value:t})}}function Uw(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function my(t){return!!t&&"integerValue"in t}function i0(t){return!!t&&"arrayValue"in t}function Fw(t){return!!t&&"nullValue"in t}function Vw(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Zh(t){return!!t&&"mapValue"in t}function NM(t){return(t?.mapValue?.fields||{})[XE]?.stringValue===ZE}function Tu(t){if(t.geoPointValue)return{geoPointValue:{...t.geoPointValue}};if(t.timestampValue&&typeof t.timestampValue=="object")return{timestampValue:{...t.timestampValue}};if(t.mapValue){const e={mapValue:{fields:{}}};return Ma(t.mapValue.fields,((n,r)=>e.mapValue.fields[n]=Tu(r))),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=Tu(t.arrayValue.values[n]);return e}return{...t}}function PM(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue===OM}class fr{constructor(e){this.value=e}static empty(){return new fr({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let n=this.value;for(let r=0;r<e.length-1;++r)if(n=(n.mapValue.fields||{})[e.get(r)],!Zh(n))return null;return n=(n.mapValue.fields||{})[e.lastSegment()],n||null}}set(e,n){this.getFieldsMap(e.popLast())[e.lastSegment()]=Tu(n)}setAll(e){let n=Fn.emptyPath(),r={},i=[];e.forEach(((l,d)=>{if(!n.isImmediateParentOf(d)){const h=this.getFieldsMap(n);this.applyChanges(h,r,i),r={},i=[],n=d.popLast()}l?r[d.lastSegment()]=Tu(l):i.push(d.lastSegment())}));const o=this.getFieldsMap(n);this.applyChanges(o,r,i)}delete(e){const n=this.field(e.popLast());Zh(n)&&n.mapValue.fields&&delete n.mapValue.fields[e.lastSegment()]}isEqual(e){return qs(this.value,e.value)}getFieldsMap(e){let n=this.value;n.mapValue.fields||(n.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=n.mapValue.fields[e.get(r)];Zh(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},n.mapValue.fields[e.get(r)]=i),n=i}return n.mapValue.fields}applyChanges(e,n,r){Ma(n,((i,o)=>e[i]=o));for(const i of r)delete e[i]}clone(){return new fr(Tu(this.value))}}function JE(t){const e=[];return Ma(t.fields,((n,r)=>{const i=new Fn([n]);if(Zh(r)){const o=JE(r.mapValue).fields;if(o.length===0)e.push(i);else for(const l of o)e.push(i.child(l))}else e.push(i)})),new Tr(e)}class Zn{constructor(e,n,r,i,o,l,d){this.key=e,this.documentType=n,this.version=r,this.readTime=i,this.createTime=o,this.data=l,this.documentState=d}static newInvalidDocument(e){return new Zn(e,0,Ze.min(),Ze.min(),Ze.min(),fr.empty(),0)}static newFoundDocument(e,n,r,i){return new Zn(e,1,n,Ze.min(),r,i,0)}static newNoDocument(e,n){return new Zn(e,2,n,Ze.min(),Ze.min(),fr.empty(),0)}static newUnknownDocument(e,n){return new Zn(e,3,n,Ze.min(),Ze.min(),fr.empty(),2)}convertToFoundDocument(e,n){return!this.createTime.isEqual(Ze.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=n,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=fr.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=fr.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Ze.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Zn&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Zn(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class yf{constructor(e,n){this.position=e,this.inclusive=n}}function $w(t,e,n){let r=0;for(let i=0;i<t.position.length;i++){const o=e[i],l=t.position[i];if(o.field.isKeyField()?r=Ge.comparator(Ge.fromName(l.referenceValue),n.key):r=Hl(l,n.data.field(o.field)),o.dir==="desc"&&(r*=-1),r!==0)break}return r}function qw(t,e){if(t===null)return e===null;if(e===null||t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!qs(t.position[n],e.position[n]))return!1;return!0}class _f{constructor(e,n="asc"){this.field=e,this.dir=n}}function BM(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}class eC{}class _n extends eC{constructor(e,n,r){super(),this.field=e,this.op=n,this.value=r}static create(e,n,r){return e.isKeyField()?n==="in"||n==="not-in"?this.createKeyFieldInFilter(e,n,r):new LM(e,n,r):n==="array-contains"?new VM(e,r):n==="in"?new $M(e,r):n==="not-in"?new qM(e,r):n==="array-contains-any"?new HM(e,r):new _n(e,n,r)}static createKeyFieldInFilter(e,n,r){return n==="in"?new UM(e,r):new FM(e,r)}matches(e){const n=e.data.field(this.field);return this.op==="!="?n!==null&&n.nullValue===void 0&&this.matchesComparison(Hl(n,this.value)):n!==null&&Ea(this.value)===Ea(n)&&this.matchesComparison(Hl(n,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Ke(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class ds extends eC{constructor(e,n){super(),this.filters=e,this.op=n,this.Pe=null}static create(e,n){return new ds(e,n)}matches(e){return tC(this)?this.filters.find((n=>!n.matches(e)))===void 0:this.filters.find((n=>n.matches(e)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((e,n)=>e.concat(n.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function tC(t){return t.op==="and"}function nC(t){return zM(t)&&tC(t)}function zM(t){for(const e of t.filters)if(e instanceof ds)return!1;return!0}function py(t){if(t instanceof _n)return t.field.canonicalString()+t.op.toString()+Gl(t.value);if(nC(t))return t.filters.map((e=>py(e))).join(",");{const e=t.filters.map((n=>py(n))).join(",");return`${t.op}(${e})`}}function rC(t,e){return t instanceof _n?(function(r,i){return i instanceof _n&&r.op===i.op&&r.field.isEqual(i.field)&&qs(r.value,i.value)})(t,e):t instanceof ds?(function(r,i){return i instanceof ds&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce(((o,l,d)=>o&&rC(l,i.filters[d])),!0):!1})(t,e):void Ke(19439)}function sC(t){return t instanceof _n?(function(n){return`${n.field.canonicalString()} ${n.op} ${Gl(n.value)}`})(t):t instanceof ds?(function(n){return n.op.toString()+" {"+n.getFilters().map(sC).join(" ,")+"}"})(t):"Filter"}class LM extends _n{constructor(e,n,r){super(e,n,r),this.key=Ge.fromName(r.referenceValue)}matches(e){const n=Ge.comparator(e.key,this.key);return this.matchesComparison(n)}}class UM extends _n{constructor(e,n){super(e,"in",n),this.keys=iC("in",n)}matches(e){return this.keys.some((n=>n.isEqual(e.key)))}}class FM extends _n{constructor(e,n){super(e,"not-in",n),this.keys=iC("not-in",n)}matches(e){return!this.keys.some((n=>n.isEqual(e.key)))}}function iC(t,e){return(e.arrayValue?.values||[]).map((n=>Ge.fromName(n.referenceValue)))}class VM extends _n{constructor(e,n){super(e,"array-contains",n)}matches(e){const n=e.data.field(this.field);return i0(n)&&zu(n.arrayValue,this.value)}}class $M extends _n{constructor(e,n){super(e,"in",n)}matches(e){const n=e.data.field(this.field);return n!==null&&zu(this.value.arrayValue,n)}}class qM extends _n{constructor(e,n){super(e,"not-in",n)}matches(e){if(zu(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const n=e.data.field(this.field);return n!==null&&n.nullValue===void 0&&!zu(this.value.arrayValue,n)}}class HM extends _n{constructor(e,n){super(e,"array-contains-any",n)}matches(e){const n=e.data.field(this.field);return!(!i0(n)||!n.arrayValue.values)&&n.arrayValue.values.some((r=>zu(this.value.arrayValue,r)))}}class GM{constructor(e,n=null,r=[],i=[],o=null,l=null,d=null){this.path=e,this.collectionGroup=n,this.orderBy=r,this.filters=i,this.limit=o,this.startAt=l,this.endAt=d,this.Te=null}}function Hw(t,e=null,n=[],r=[],i=null,o=null,l=null){return new GM(t,e,n,r,i,o,l)}function a0(t){const e=tt(t);if(e.Te===null){let n=e.path.canonicalString();e.collectionGroup!==null&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map((r=>py(r))).join(","),n+="|ob:",n+=e.orderBy.map((r=>(function(o){return o.field.canonicalString()+o.dir})(r))).join(","),Qf(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map((r=>Gl(r))).join(",")),e.endAt&&(n+="|ub:",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map((r=>Gl(r))).join(",")),e.Te=n}return e.Te}function o0(t,e){if(t.limit!==e.limit||t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!BM(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!rC(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!qw(t.startAt,e.startAt)&&qw(t.endAt,e.endAt)}function gy(t){return Ge.isDocumentKey(t.path)&&t.collectionGroup===null&&t.filters.length===0}class ed{constructor(e,n=null,r=[],i=[],o=null,l="F",d=null,h=null){this.path=e,this.collectionGroup=n,this.explicitOrderBy=r,this.filters=i,this.limit=o,this.limitType=l,this.startAt=d,this.endAt=h,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function QM(t,e,n,r,i,o,l,d){return new ed(t,e,n,r,i,o,l,d)}function l0(t){return new ed(t)}function Gw(t){return t.filters.length===0&&t.limit===null&&t.startAt==null&&t.endAt==null&&(t.explicitOrderBy.length===0||t.explicitOrderBy.length===1&&t.explicitOrderBy[0].field.isKeyField())}function aC(t){return t.collectionGroup!==null}function Au(t){const e=tt(t);if(e.Ie===null){e.Ie=[];const n=new Set;for(const o of e.explicitOrderBy)e.Ie.push(o),n.add(o.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(l){let d=new Tn(Fn.comparator);return l.filters.forEach((h=>{h.getFlattenedFilters().forEach((m=>{m.isInequality()&&(d=d.add(m.field))}))})),d})(e).forEach((o=>{n.has(o.canonicalString())||o.isKeyField()||e.Ie.push(new _f(o,r))})),n.has(Fn.keyField().canonicalString())||e.Ie.push(new _f(Fn.keyField(),r))}return e.Ie}function Us(t){const e=tt(t);return e.Ee||(e.Ee=WM(e,Au(t))),e.Ee}function WM(t,e){if(t.limitType==="F")return Hw(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map((i=>{const o=i.dir==="desc"?"asc":"desc";return new _f(i.field,o)}));const n=t.endAt?new yf(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new yf(t.startAt.position,t.startAt.inclusive):null;return Hw(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}}function yy(t,e){const n=t.filters.concat([e]);return new ed(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}function _y(t,e,n){return new ed(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Kf(t,e){return o0(Us(t),Us(e))&&t.limitType===e.limitType}function oC(t){return`${a0(Us(t))}|lt:${t.limitType}`}function kl(t){return`Query(target=${(function(n){let r=n.path.canonicalString();return n.collectionGroup!==null&&(r+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(r+=`, filters: [${n.filters.map((i=>sC(i))).join(", ")}]`),Qf(n.limit)||(r+=", limit: "+n.limit),n.orderBy.length>0&&(r+=`, orderBy: [${n.orderBy.map((i=>(function(l){return`${l.field.canonicalString()} (${l.dir})`})(i))).join(", ")}]`),n.startAt&&(r+=", startAt: ",r+=n.startAt.inclusive?"b:":"a:",r+=n.startAt.position.map((i=>Gl(i))).join(",")),n.endAt&&(r+=", endAt: ",r+=n.endAt.inclusive?"a:":"b:",r+=n.endAt.position.map((i=>Gl(i))).join(",")),`Target(${r})`})(Us(t))}; limitType=${t.limitType})`}function Yf(t,e){return e.isFoundDocument()&&(function(r,i){const o=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(o):Ge.isDocumentKey(r.path)?r.path.isEqual(o):r.path.isImmediateParentOf(o)})(t,e)&&(function(r,i){for(const o of Au(r))if(!o.field.isKeyField()&&i.data.field(o.field)===null)return!1;return!0})(t,e)&&(function(r,i){for(const o of r.filters)if(!o.matches(i))return!1;return!0})(t,e)&&(function(r,i){return!(r.startAt&&!(function(l,d,h){const m=$w(l,d,h);return l.inclusive?m<=0:m<0})(r.startAt,Au(r),i)||r.endAt&&!(function(l,d,h){const m=$w(l,d,h);return l.inclusive?m>=0:m>0})(r.endAt,Au(r),i))})(t,e)}function KM(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function lC(t){return(e,n)=>{let r=!1;for(const i of Au(t)){const o=YM(i,e,n);if(o!==0)return o;r=r||i.field.isKeyField()}return 0}}function YM(t,e,n){const r=t.field.isKeyField()?Ge.comparator(e.key,n.key):(function(o,l,d){const h=l.data.field(o),m=d.data.field(o);return h!==null&&m!==null?Hl(h,m):Ke(42886)})(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return Ke(19790,{direction:t.dir})}}class Mo{constructor(e,n){this.mapKeyFn=e,this.equalsFn=n,this.inner={},this.innerSize=0}get(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r!==void 0){for(const[i,o]of r)if(this.equalsFn(i,e))return o}}has(e){return this.get(e)!==void 0}set(e,n){const r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,n]],void this.innerSize++;for(let o=0;o<i.length;o++)if(this.equalsFn(i[o][0],e))return void(i[o]=[e,n]);i.push([e,n]),this.innerSize++}delete(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[n]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Ma(this.inner,((n,r)=>{for(const[i,o]of r)e(i,o)}))}isEmpty(){return HE(this.inner)}size(){return this.innerSize}}const XM=new Zt(Ge.comparator);function vi(){return XM}const cC=new Zt(Ge.comparator);function xu(...t){let e=cC;for(const n of t)e=e.insert(n.key,n);return e}function uC(t){let e=cC;return t.forEach(((n,r)=>e=e.insert(n,r.overlayedDocument))),e}function bo(){return ju()}function dC(){return ju()}function ju(){return new Mo((t=>t.toString()),((t,e)=>t.isEqual(e)))}const ZM=new Zt(Ge.comparator),JM=new Tn(Ge.comparator);function mt(...t){let e=JM;for(const n of t)e=e.add(n);return e}const eO=new Tn(ft);function tO(){return eO}function c0(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:mf(e)?"-0":e}}function hC(t){return{integerValue:""+t}}function nO(t,e){return RM(e)?hC(e):c0(t,e)}class Xf{constructor(){this._=void 0}}function rO(t,e,n){return t instanceof bf?(function(i,o){const l={fields:{[WE]:{stringValue:QE},[YE]:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return o&&s0(o)&&(o=Wf(o)),o&&(l.fields[KE]=o),{mapValue:l}})(n,e):t instanceof Ql?mC(t,e):t instanceof Wl?pC(t,e):(function(i,o){const l=fC(i,o),d=Qw(l)+Qw(i.Ae);return my(l)&&my(i.Ae)?hC(d):c0(i.serializer,d)})(t,e)}function sO(t,e,n){return t instanceof Ql?mC(t,e):t instanceof Wl?pC(t,e):n}function fC(t,e){return t instanceof vf?(function(r){return my(r)||(function(o){return!!o&&"doubleValue"in o})(r)})(e)?e:{integerValue:0}:null}class bf extends Xf{}class Ql extends Xf{constructor(e){super(),this.elements=e}}function mC(t,e){const n=gC(e);for(const r of t.elements)n.some((i=>qs(i,r)))||n.push(r);return{arrayValue:{values:n}}}class Wl extends Xf{constructor(e){super(),this.elements=e}}function pC(t,e){let n=gC(e);for(const r of t.elements)n=n.filter((i=>!qs(i,r)));return{arrayValue:{values:n}}}class vf extends Xf{constructor(e,n){super(),this.serializer=e,this.Ae=n}}function Qw(t){return on(t.integerValue||t.doubleValue)}function gC(t){return i0(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}class yC{constructor(e,n){this.field=e,this.transform=n}}function iO(t,e){return t.field.isEqual(e.field)&&(function(r,i){return r instanceof Ql&&i instanceof Ql||r instanceof Wl&&i instanceof Wl?ql(r.elements,i.elements,qs):r instanceof vf&&i instanceof vf?qs(r.Ae,i.Ae):r instanceof bf&&i instanceof bf})(t.transform,e.transform)}class aO{constructor(e,n){this.version=e,this.transformResults=n}}class pr{constructor(e,n){this.updateTime=e,this.exists=n}static none(){return new pr}static exists(e){return new pr(void 0,e)}static updateTime(e){return new pr(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Jh(t,e){return t.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(t.updateTime):t.exists===void 0||t.exists===e.isFoundDocument()}class Zf{}function _C(t,e){if(!t.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return t.isNoDocument()?new Jf(t.key,pr.none()):new td(t.key,t.data,pr.none());{const n=t.data,r=fr.empty();let i=new Tn(Fn.comparator);for(let o of e.fields)if(!i.has(o)){let l=n.field(o);l===null&&o.length>1&&(o=o.popLast(),l=n.field(o)),l===null?r.delete(o):r.set(o,l),i=i.add(o)}return new Oa(t.key,r,new Tr(i.toArray()),pr.none())}}function oO(t,e,n){t instanceof td?(function(i,o,l){const d=i.value.clone(),h=Kw(i.fieldTransforms,o,l.transformResults);d.setAll(h),o.convertToFoundDocument(l.version,d).setHasCommittedMutations()})(t,e,n):t instanceof Oa?(function(i,o,l){if(!Jh(i.precondition,o))return void o.convertToUnknownDocument(l.version);const d=Kw(i.fieldTransforms,o,l.transformResults),h=o.data;h.setAll(bC(i)),h.setAll(d),o.convertToFoundDocument(l.version,h).setHasCommittedMutations()})(t,e,n):(function(i,o,l){o.convertToNoDocument(l.version).setHasCommittedMutations()})(0,e,n)}function Ru(t,e,n,r){return t instanceof td?(function(o,l,d,h){if(!Jh(o.precondition,l))return d;const m=o.value.clone(),p=Yw(o.fieldTransforms,h,l);return m.setAll(p),l.convertToFoundDocument(l.version,m).setHasLocalMutations(),null})(t,e,n,r):t instanceof Oa?(function(o,l,d,h){if(!Jh(o.precondition,l))return d;const m=Yw(o.fieldTransforms,h,l),p=l.data;return p.setAll(bC(o)),p.setAll(m),l.convertToFoundDocument(l.version,p).setHasLocalMutations(),d===null?null:d.unionWith(o.fieldMask.fields).unionWith(o.fieldTransforms.map((g=>g.field)))})(t,e,n,r):(function(o,l,d){return Jh(o.precondition,l)?(l.convertToNoDocument(l.version).setHasLocalMutations(),null):d})(t,e,n)}function lO(t,e){let n=null;for(const r of t.fieldTransforms){const i=e.data.field(r.field),o=fC(r.transform,i||null);o!=null&&(n===null&&(n=fr.empty()),n.set(r.field,o))}return n||null}function Ww(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!(function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&ql(r,i,((o,l)=>iO(o,l)))})(t.fieldTransforms,e.fieldTransforms)&&(t.type===0?t.value.isEqual(e.value):t.type!==1||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class td extends Zf{constructor(e,n,r,i=[]){super(),this.key=e,this.value=n,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class Oa extends Zf{constructor(e,n,r,i,o=[]){super(),this.key=e,this.data=n,this.fieldMask=r,this.precondition=i,this.fieldTransforms=o,this.type=1}getFieldMask(){return this.fieldMask}}function bC(t){const e=new Map;return t.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const r=t.data.field(n);e.set(n,r)}})),e}function Kw(t,e,n){const r=new Map;jt(t.length===n.length,32656,{Re:n.length,Ve:t.length});for(let i=0;i<n.length;i++){const o=t[i],l=o.transform,d=e.data.field(o.field);r.set(o.field,sO(l,d,n[i]))}return r}function Yw(t,e,n){const r=new Map;for(const i of t){const o=i.transform,l=n.data.field(i.field);r.set(i.field,rO(o,l,e))}return r}class Jf extends Zf{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class cO extends Zf{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class uO{constructor(e,n,r,i){this.batchId=e,this.localWriteTime=n,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,n){const r=n.mutationResults;for(let i=0;i<this.mutations.length;i++){const o=this.mutations[i];o.key.isEqual(e.key)&&oO(o,e,r[i])}}applyToLocalView(e,n){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(n=Ru(r,e,n,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(n=Ru(r,e,n,this.localWriteTime));return n}applyToLocalDocumentSet(e,n){const r=dC();return this.mutations.forEach((i=>{const o=e.get(i.key),l=o.overlayedDocument;let d=this.applyToLocalView(l,o.mutatedFields);d=n.has(i.key)?null:d;const h=_C(l,d);h!==null&&r.set(i.key,h),l.isValidDocument()||l.convertToNoDocument(Ze.min())})),r}keys(){return this.mutations.reduce(((e,n)=>e.add(n.key)),mt())}isEqual(e){return this.batchId===e.batchId&&ql(this.mutations,e.mutations,((n,r)=>Ww(n,r)))&&ql(this.baseMutations,e.baseMutations,((n,r)=>Ww(n,r)))}}class u0{constructor(e,n,r,i){this.batch=e,this.commitVersion=n,this.mutationResults=r,this.docVersions=i}static from(e,n,r){jt(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let i=(function(){return ZM})();const o=e.mutations;for(let l=0;l<o.length;l++)i=i.insert(o[l].key,r[l].version);return new u0(e,n,r,i)}}class dO{constructor(e,n){this.largestBatchId=e,this.mutation=n}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class hO{constructor(e,n){this.count=e,this.unchangedNames=n}}var yn,_t;function fO(t){switch(t){case je.OK:return Ke(64938);case je.CANCELLED:case je.UNKNOWN:case je.DEADLINE_EXCEEDED:case je.RESOURCE_EXHAUSTED:case je.INTERNAL:case je.UNAVAILABLE:case je.UNAUTHENTICATED:return!1;case je.INVALID_ARGUMENT:case je.NOT_FOUND:case je.ALREADY_EXISTS:case je.PERMISSION_DENIED:case je.FAILED_PRECONDITION:case je.ABORTED:case je.OUT_OF_RANGE:case je.UNIMPLEMENTED:case je.DATA_LOSS:return!0;default:return Ke(15467,{code:t})}}function vC(t){if(t===void 0)return bi("GRPC error has no .code"),je.UNKNOWN;switch(t){case yn.OK:return je.OK;case yn.CANCELLED:return je.CANCELLED;case yn.UNKNOWN:return je.UNKNOWN;case yn.DEADLINE_EXCEEDED:return je.DEADLINE_EXCEEDED;case yn.RESOURCE_EXHAUSTED:return je.RESOURCE_EXHAUSTED;case yn.INTERNAL:return je.INTERNAL;case yn.UNAVAILABLE:return je.UNAVAILABLE;case yn.UNAUTHENTICATED:return je.UNAUTHENTICATED;case yn.INVALID_ARGUMENT:return je.INVALID_ARGUMENT;case yn.NOT_FOUND:return je.NOT_FOUND;case yn.ALREADY_EXISTS:return je.ALREADY_EXISTS;case yn.PERMISSION_DENIED:return je.PERMISSION_DENIED;case yn.FAILED_PRECONDITION:return je.FAILED_PRECONDITION;case yn.ABORTED:return je.ABORTED;case yn.OUT_OF_RANGE:return je.OUT_OF_RANGE;case yn.UNIMPLEMENTED:return je.UNIMPLEMENTED;case yn.DATA_LOSS:return je.DATA_LOSS;default:return Ke(39323,{code:t})}}(_t=yn||(yn={}))[_t.OK=0]="OK",_t[_t.CANCELLED=1]="CANCELLED",_t[_t.UNKNOWN=2]="UNKNOWN",_t[_t.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",_t[_t.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",_t[_t.NOT_FOUND=5]="NOT_FOUND",_t[_t.ALREADY_EXISTS=6]="ALREADY_EXISTS",_t[_t.PERMISSION_DENIED=7]="PERMISSION_DENIED",_t[_t.UNAUTHENTICATED=16]="UNAUTHENTICATED",_t[_t.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",_t[_t.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",_t[_t.ABORTED=10]="ABORTED",_t[_t.OUT_OF_RANGE=11]="OUT_OF_RANGE",_t[_t.UNIMPLEMENTED=12]="UNIMPLEMENTED",_t[_t.INTERNAL=13]="INTERNAL",_t[_t.UNAVAILABLE=14]="UNAVAILABLE",_t[_t.DATA_LOSS=15]="DATA_LOSS";function mO(){return new TextEncoder}const pO=new ba([4294967295,4294967295],0);function Xw(t){const e=mO().encode(t),n=new OE;return n.update(e),new Uint8Array(n.digest())}function Zw(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),o=e.getUint32(12,!0);return[new ba([n,r],0),new ba([i,o],0)]}class d0{constructor(e,n,r){if(this.bitmap=e,this.padding=n,this.hashCount=r,n<0||n>=8)throw new wu(`Invalid padding: ${n}`);if(r<0)throw new wu(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new wu(`Invalid hash count: ${r}`);if(e.length===0&&n!==0)throw new wu(`Invalid padding when bitmap length is 0: ${n}`);this.ge=8*e.length-n,this.pe=ba.fromNumber(this.ge)}ye(e,n,r){let i=e.add(n.multiply(ba.fromNumber(r)));return i.compare(pO)===1&&(i=new ba([i.getBits(0),i.getBits(1)],0)),i.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const n=Xw(e),[r,i]=Zw(n);for(let o=0;o<this.hashCount;o++){const l=this.ye(r,i,o);if(!this.we(l))return!1}return!0}static create(e,n,r){const i=e%8==0?0:8-e%8,o=new Uint8Array(Math.ceil(e/8)),l=new d0(o,i,n);return r.forEach((d=>l.insert(d))),l}insert(e){if(this.ge===0)return;const n=Xw(e),[r,i]=Zw(n);for(let o=0;o<this.hashCount;o++){const l=this.ye(r,i,o);this.Se(l)}}Se(e){const n=Math.floor(e/8),r=e%8;this.bitmap[n]|=1<<r}}class wu extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class em{constructor(e,n,r,i,o){this.snapshotVersion=e,this.targetChanges=n,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=o}static createSynthesizedRemoteEventForCurrentChange(e,n,r){const i=new Map;return i.set(e,nd.createSynthesizedTargetChangeForCurrentChange(e,n,r)),new em(Ze.min(),i,new Zt(ft),vi(),mt())}}class nd{constructor(e,n,r,i,o){this.resumeToken=e,this.current=n,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=o}static createSynthesizedTargetChangeForCurrentChange(e,n,r){return new nd(r,n,mt(),mt(),mt())}}class ef{constructor(e,n,r,i){this.be=e,this.removedTargetIds=n,this.key=r,this.De=i}}class xC{constructor(e,n){this.targetId=e,this.Ce=n}}class wC{constructor(e,n,r=$n.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=n,this.resumeToken=r,this.cause=i}}class Jw{constructor(){this.ve=0,this.Fe=e1(),this.Me=$n.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=mt(),n=mt(),r=mt();return this.Fe.forEach(((i,o)=>{switch(o){case 0:e=e.add(i);break;case 2:n=n.add(i);break;case 1:r=r.add(i);break;default:Ke(38017,{changeType:o})}})),new nd(this.Me,this.xe,e,n,r)}qe(){this.Oe=!1,this.Fe=e1()}Qe(e,n){this.Oe=!0,this.Fe=this.Fe.insert(e,n)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,jt(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class gO{constructor(e){this.Ge=e,this.ze=new Map,this.je=vi(),this.Je=Uh(),this.He=Uh(),this.Ye=new Zt(ft)}Ze(e){for(const n of e.be)e.De&&e.De.isFoundDocument()?this.Xe(n,e.De):this.et(n,e.key,e.De);for(const n of e.removedTargetIds)this.et(n,e.key,e.De)}tt(e){this.forEachTarget(e,(n=>{const r=this.nt(n);switch(e.state){case 0:this.rt(n)&&r.Le(e.resumeToken);break;case 1:r.Ke(),r.Ne||r.qe(),r.Le(e.resumeToken);break;case 2:r.Ke(),r.Ne||this.removeTarget(n);break;case 3:this.rt(n)&&(r.We(),r.Le(e.resumeToken));break;case 4:this.rt(n)&&(this.it(n),r.Le(e.resumeToken));break;default:Ke(56790,{state:e.state})}}))}forEachTarget(e,n){e.targetIds.length>0?e.targetIds.forEach(n):this.ze.forEach(((r,i)=>{this.rt(i)&&n(i)}))}st(e){const n=e.targetId,r=e.Ce.count,i=this.ot(n);if(i){const o=i.target;if(gy(o))if(r===0){const l=new Ge(o.path);this.et(n,l,Zn.newNoDocument(l,Ze.min()))}else jt(r===1,20013,{expectedCount:r});else{const l=this._t(n);if(l!==r){const d=this.ut(e),h=d?this.ct(d,e,l):1;if(h!==0){this.it(n);const m=h===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(n,m)}}}}}ut(e){const n=e.Ce.unchangedNames;if(!n||!n.bits)return null;const{bits:{bitmap:r="",padding:i=0},hashCount:o=0}=n;let l,d;try{l=Sa(r).toUint8Array()}catch(h){if(h instanceof GE)return $l("Decoding the base64 bloom filter in existence filter failed ("+h.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw h}try{d=new d0(l,i,o)}catch(h){return $l(h instanceof wu?"BloomFilter error: ":"Applying bloom filter failed: ",h),null}return d.ge===0?null:d}ct(e,n,r){return n.Ce.count===r-this.Pt(e,n.targetId)?0:2}Pt(e,n){const r=this.Ge.getRemoteKeysForTarget(n);let i=0;return r.forEach((o=>{const l=this.Ge.ht(),d=`projects/${l.projectId}/databases/${l.database}/documents/${o.path.canonicalString()}`;e.mightContain(d)||(this.et(n,o,null),i++)})),i}Tt(e){const n=new Map;this.ze.forEach(((o,l)=>{const d=this.ot(l);if(d){if(o.current&&gy(d.target)){const h=new Ge(d.target.path);this.It(h).has(l)||this.Et(l,h)||this.et(l,h,Zn.newNoDocument(h,e))}o.Be&&(n.set(l,o.ke()),o.qe())}}));let r=mt();this.He.forEach(((o,l)=>{let d=!0;l.forEachWhile((h=>{const m=this.ot(h);return!m||m.purpose==="TargetPurposeLimboResolution"||(d=!1,!1)})),d&&(r=r.add(o))})),this.je.forEach(((o,l)=>l.setReadTime(e)));const i=new em(e,n,this.Ye,this.je,r);return this.je=vi(),this.Je=Uh(),this.He=Uh(),this.Ye=new Zt(ft),i}Xe(e,n){if(!this.rt(e))return;const r=this.Et(e,n.key)?2:0;this.nt(e).Qe(n.key,r),this.je=this.je.insert(n.key,n),this.Je=this.Je.insert(n.key,this.It(n.key).add(e)),this.He=this.He.insert(n.key,this.dt(n.key).add(e))}et(e,n,r){if(!this.rt(e))return;const i=this.nt(e);this.Et(e,n)?i.Qe(n,1):i.$e(n),this.He=this.He.insert(n,this.dt(n).delete(e)),this.He=this.He.insert(n,this.dt(n).add(e)),r&&(this.je=this.je.insert(n,r))}removeTarget(e){this.ze.delete(e)}_t(e){const n=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+n.addedDocuments.size-n.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let n=this.ze.get(e);return n||(n=new Jw,this.ze.set(e,n)),n}dt(e){let n=this.He.get(e);return n||(n=new Tn(ft),this.He=this.He.insert(e,n)),n}It(e){let n=this.Je.get(e);return n||(n=new Tn(ft),this.Je=this.Je.insert(e,n)),n}rt(e){const n=this.ot(e)!==null;return n||ze("WatchChangeAggregator","Detected inactive target",e),n}ot(e){const n=this.ze.get(e);return n&&n.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new Jw),this.Ge.getRemoteKeysForTarget(e).forEach((n=>{this.et(e,n,null)}))}Et(e,n){return this.Ge.getRemoteKeysForTarget(e).has(n)}}function Uh(){return new Zt(Ge.comparator)}function e1(){return new Zt(Ge.comparator)}const yO={asc:"ASCENDING",desc:"DESCENDING"},_O={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},bO={and:"AND",or:"OR"};class vO{constructor(e,n){this.databaseId=e,this.useProto3Json=n}}function by(t,e){return t.useProto3Json||Qf(e)?e:{value:e}}function xf(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function SC(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function xO(t,e){return xf(t,e.toTimestamp())}function Fs(t){return jt(!!t,49232),Ze.fromTimestamp((function(n){const r=wa(n);return new Ht(r.seconds,r.nanos)})(t))}function h0(t,e){return vy(t,e).canonicalString()}function vy(t,e){const n=(function(i){return new Ut(["projects",i.projectId,"databases",i.database])})(t).child("documents");return e===void 0?n:n.child(e)}function EC(t){const e=Ut.fromString(t);return jt(RC(e),10190,{key:e.toString()}),e}function xy(t,e){return h0(t.databaseId,e.path)}function Pg(t,e){const n=EC(e);if(n.get(1)!==t.databaseId.projectId)throw new Pe(je.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new Pe(je.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new Ge(TC(n))}function CC(t,e){return h0(t.databaseId,e)}function wO(t){const e=EC(t);return e.length===4?Ut.emptyPath():TC(e)}function wy(t){return new Ut(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function TC(t){return jt(t.length>4&&t.get(4)==="documents",29091,{key:t.toString()}),t.popFirst(5)}function t1(t,e,n){return{name:xy(t,e),fields:n.value.mapValue.fields}}function SO(t,e){let n;if("targetChange"in e){e.targetChange;const r=(function(m){return m==="NO_CHANGE"?0:m==="ADD"?1:m==="REMOVE"?2:m==="CURRENT"?3:m==="RESET"?4:Ke(39313,{state:m})})(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],o=(function(m,p){return m.useProto3Json?(jt(p===void 0||typeof p=="string",58123),$n.fromBase64String(p||"")):(jt(p===void 0||p instanceof Buffer||p instanceof Uint8Array,16193),$n.fromUint8Array(p||new Uint8Array))})(t,e.targetChange.resumeToken),l=e.targetChange.cause,d=l&&(function(m){const p=m.code===void 0?je.UNKNOWN:vC(m.code);return new Pe(p,m.message||"")})(l);n=new wC(r,i,o,d||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const i=Pg(t,r.document.name),o=Fs(r.document.updateTime),l=r.document.createTime?Fs(r.document.createTime):Ze.min(),d=new fr({mapValue:{fields:r.document.fields}}),h=Zn.newFoundDocument(i,o,l,d),m=r.targetIds||[],p=r.removedTargetIds||[];n=new ef(m,p,h.key,h)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const i=Pg(t,r.document),o=r.readTime?Fs(r.readTime):Ze.min(),l=Zn.newNoDocument(i,o),d=r.removedTargetIds||[];n=new ef([],d,l.key,l)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const i=Pg(t,r.document),o=r.removedTargetIds||[];n=new ef([],o,i,null)}else{if(!("filter"in e))return Ke(11601,{Rt:e});{e.filter;const r=e.filter;r.targetId;const{count:i=0,unchangedNames:o}=r,l=new hO(i,o),d=r.targetId;n=new xC(d,l)}}return n}function EO(t,e){let n;if(e instanceof td)n={update:t1(t,e.key,e.value)};else if(e instanceof Jf)n={delete:xy(t,e.key)};else if(e instanceof Oa)n={update:t1(t,e.key,e.data),updateMask:MO(e.fieldMask)};else{if(!(e instanceof cO))return Ke(16599,{Vt:e.type});n={verify:xy(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map((r=>(function(o,l){const d=l.transform;if(d instanceof bf)return{fieldPath:l.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(d instanceof Ql)return{fieldPath:l.field.canonicalString(),appendMissingElements:{values:d.elements}};if(d instanceof Wl)return{fieldPath:l.field.canonicalString(),removeAllFromArray:{values:d.elements}};if(d instanceof vf)return{fieldPath:l.field.canonicalString(),increment:d.Ae};throw Ke(20930,{transform:l.transform})})(0,r)))),e.precondition.isNone||(n.currentDocument=(function(i,o){return o.updateTime!==void 0?{updateTime:xO(i,o.updateTime)}:o.exists!==void 0?{exists:o.exists}:Ke(27497)})(t,e.precondition)),n}function CO(t,e){return t&&t.length>0?(jt(e!==void 0,14353),t.map((n=>(function(i,o){let l=i.updateTime?Fs(i.updateTime):Fs(o);return l.isEqual(Ze.min())&&(l=Fs(o)),new aO(l,i.transformResults||[])})(n,e)))):[]}function TO(t,e){return{documents:[CC(t,e.path)]}}function AO(t,e){const n={structuredQuery:{}},r=e.path;let i;e.collectionGroup!==null?(i=r,n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=CC(t,i);const o=(function(m){if(m.length!==0)return jC(ds.create(m,"and"))})(e.filters);o&&(n.structuredQuery.where=o);const l=(function(m){if(m.length!==0)return m.map((p=>(function(v){return{field:Dl(v.field),direction:IO(v.dir)}})(p)))})(e.orderBy);l&&(n.structuredQuery.orderBy=l);const d=by(t,e.limit);return d!==null&&(n.structuredQuery.limit=d),e.startAt&&(n.structuredQuery.startAt=(function(m){return{before:m.inclusive,values:m.position}})(e.startAt)),e.endAt&&(n.structuredQuery.endAt=(function(m){return{before:!m.inclusive,values:m.position}})(e.endAt)),{ft:n,parent:i}}function jO(t){let e=wO(t.parent);const n=t.structuredQuery,r=n.from?n.from.length:0;let i=null;if(r>0){jt(r===1,65062);const p=n.from[0];p.allDescendants?i=p.collectionId:e=e.child(p.collectionId)}let o=[];n.where&&(o=(function(g){const v=AC(g);return v instanceof ds&&nC(v)?v.getFilters():[v]})(n.where));let l=[];n.orderBy&&(l=(function(g){return g.map((v=>(function(E){return new _f(Ml(E.field),(function(S){switch(S){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(E.direction))})(v)))})(n.orderBy));let d=null;n.limit&&(d=(function(g){let v;return v=typeof g=="object"?g.value:g,Qf(v)?null:v})(n.limit));let h=null;n.startAt&&(h=(function(g){const v=!!g.before,b=g.values||[];return new yf(b,v)})(n.startAt));let m=null;return n.endAt&&(m=(function(g){const v=!g.before,b=g.values||[];return new yf(b,v)})(n.endAt)),QM(e,i,l,o,d,"F",h,m)}function RO(t,e){const n=(function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Ke(28987,{purpose:i})}})(e.purpose);return n==null?null:{"goog-listen-tags":n}}function AC(t){return t.unaryFilter!==void 0?(function(n){switch(n.unaryFilter.op){case"IS_NAN":const r=Ml(n.unaryFilter.field);return _n.create(r,"==",{doubleValue:NaN});case"IS_NULL":const i=Ml(n.unaryFilter.field);return _n.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const o=Ml(n.unaryFilter.field);return _n.create(o,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const l=Ml(n.unaryFilter.field);return _n.create(l,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return Ke(61313);default:return Ke(60726)}})(t):t.fieldFilter!==void 0?(function(n){return _n.create(Ml(n.fieldFilter.field),(function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return Ke(58110);default:return Ke(50506)}})(n.fieldFilter.op),n.fieldFilter.value)})(t):t.compositeFilter!==void 0?(function(n){return ds.create(n.compositeFilter.filters.map((r=>AC(r))),(function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return Ke(1026)}})(n.compositeFilter.op))})(t):Ke(30097,{filter:t})}function IO(t){return yO[t]}function kO(t){return _O[t]}function DO(t){return bO[t]}function Dl(t){return{fieldPath:t.canonicalString()}}function Ml(t){return Fn.fromServerFormat(t.fieldPath)}function jC(t){return t instanceof _n?(function(n){if(n.op==="=="){if(Vw(n.value))return{unaryFilter:{field:Dl(n.field),op:"IS_NAN"}};if(Fw(n.value))return{unaryFilter:{field:Dl(n.field),op:"IS_NULL"}}}else if(n.op==="!="){if(Vw(n.value))return{unaryFilter:{field:Dl(n.field),op:"IS_NOT_NAN"}};if(Fw(n.value))return{unaryFilter:{field:Dl(n.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Dl(n.field),op:kO(n.op),value:n.value}}})(t):t instanceof ds?(function(n){const r=n.getFilters().map((i=>jC(i)));return r.length===1?r[0]:{compositeFilter:{op:DO(n.op),filters:r}}})(t):Ke(54877,{filter:t})}function MO(t){const e=[];return t.fields.forEach((n=>e.push(n.canonicalString()))),{fieldPaths:e}}function RC(t){return t.length>=4&&t.get(0)==="projects"&&t.get(2)==="databases"}class da{constructor(e,n,r,i,o=Ze.min(),l=Ze.min(),d=$n.EMPTY_BYTE_STRING,h=null){this.target=e,this.targetId=n,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=o,this.lastLimboFreeSnapshotVersion=l,this.resumeToken=d,this.expectedCount=h}withSequenceNumber(e){return new da(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,n){return new da(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new da(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new da(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class OO{constructor(e){this.yt=e}}function NO(t){const e=jO({parent:t.parent,structuredQuery:t.structuredQuery});return t.limitType==="LAST"?_y(e,e.limit,"L"):e}class PO{constructor(){this.Cn=new BO}addToCollectionParentIndex(e,n){return this.Cn.add(n),Ie.resolve()}getCollectionParents(e,n){return Ie.resolve(this.Cn.getEntries(n))}addFieldIndex(e,n){return Ie.resolve()}deleteFieldIndex(e,n){return Ie.resolve()}deleteAllFieldIndexes(e){return Ie.resolve()}createTargetIndexes(e,n){return Ie.resolve()}getDocumentsMatchingTarget(e,n){return Ie.resolve(null)}getIndexType(e,n){return Ie.resolve(0)}getFieldIndexes(e,n){return Ie.resolve([])}getNextCollectionGroupToUpdate(e){return Ie.resolve(null)}getMinOffset(e,n){return Ie.resolve(xa.min())}getMinOffsetFromCollectionGroup(e,n){return Ie.resolve(xa.min())}updateCollectionGroup(e,n,r){return Ie.resolve()}updateIndexEntries(e,n){return Ie.resolve()}}class BO{constructor(){this.index={}}add(e){const n=e.lastSegment(),r=e.popLast(),i=this.index[n]||new Tn(Ut.comparator),o=!i.has(r);return this.index[n]=i.add(r),o}has(e){const n=e.lastSegment(),r=e.popLast(),i=this.index[n];return i&&i.has(r)}getEntries(e){return(this.index[e]||new Tn(Ut.comparator)).toArray()}}const n1={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},IC=41943040;class hr{static withCacheSize(e){return new hr(e,hr.DEFAULT_COLLECTION_PERCENTILE,hr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,n,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=n,this.maximumSequenceNumbersToCollect=r}}hr.DEFAULT_COLLECTION_PERCENTILE=10,hr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,hr.DEFAULT=new hr(IC,hr.DEFAULT_COLLECTION_PERCENTILE,hr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),hr.DISABLED=new hr(-1,0,0);class Kl{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new Kl(0)}static cr(){return new Kl(-1)}}const r1="LruGarbageCollector",zO=1048576;function s1([t,e],[n,r]){const i=ft(t,n);return i===0?ft(e,r):i}class LO{constructor(e){this.Ir=e,this.buffer=new Tn(s1),this.Er=0}dr(){return++this.Er}Ar(e){const n=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(n);else{const r=this.buffer.last();s1(n,r)<0&&(this.buffer=this.buffer.delete(r).add(n))}}get maxValue(){return this.buffer.last()[0]}}class UO{constructor(e,n,r){this.garbageCollector=e,this.asyncQueue=n,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){ze(r1,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(n){cc(n)?ze(r1,"Ignoring IndexedDB error during garbage collection: ",n):await lc(n)}await this.Vr(3e5)}))}}class FO{constructor(e,n){this.mr=e,this.params=n}calculateTargetCount(e,n){return this.mr.gr(e).next((r=>Math.floor(n/100*r)))}nthSequenceNumber(e,n){if(n===0)return Ie.resolve(Gf.ce);const r=new LO(n);return this.mr.forEachTarget(e,(i=>r.Ar(i.sequenceNumber))).next((()=>this.mr.pr(e,(i=>r.Ar(i))))).next((()=>r.maxValue))}removeTargets(e,n,r){return this.mr.removeTargets(e,n,r)}removeOrphanedDocuments(e,n){return this.mr.removeOrphanedDocuments(e,n)}collect(e,n){return this.params.cacheSizeCollectionThreshold===-1?(ze("LruGarbageCollector","Garbage collection skipped; disabled"),Ie.resolve(n1)):this.getCacheSize(e).next((r=>r<this.params.cacheSizeCollectionThreshold?(ze("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),n1):this.yr(e,n)))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,n){let r,i,o,l,d,h,m;const p=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((g=>(g>this.params.maximumSequenceNumbersToCollect?(ze("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${g}`),i=this.params.maximumSequenceNumbersToCollect):i=g,l=Date.now(),this.nthSequenceNumber(e,i)))).next((g=>(r=g,d=Date.now(),this.removeTargets(e,r,n)))).next((g=>(o=g,h=Date.now(),this.removeOrphanedDocuments(e,r)))).next((g=>(m=Date.now(),Il()<=ht.DEBUG&&ze("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${l-p}ms
	Determined least recently used ${i} in `+(d-l)+`ms
	Removed ${o} targets in `+(h-d)+`ms
	Removed ${g} documents in `+(m-h)+`ms
Total Duration: ${m-p}ms`),Ie.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:o,documentsRemoved:g}))))}}function VO(t,e){return new FO(t,e)}class $O{constructor(){this.changes=new Mo((e=>e.toString()),((e,n)=>e.isEqual(n))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,n){this.assertNotApplied(),this.changes.set(e,Zn.newInvalidDocument(e).setReadTime(n))}getEntry(e,n){this.assertNotApplied();const r=this.changes.get(n);return r!==void 0?Ie.resolve(r):this.getFromCache(e,n)}getEntries(e,n){return this.getAllFromCache(e,n)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class qO{constructor(e,n){this.overlayedDocument=e,this.mutatedFields=n}}class HO{constructor(e,n,r,i){this.remoteDocumentCache=e,this.mutationQueue=n,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,n){let r=null;return this.documentOverlayCache.getOverlay(e,n).next((i=>(r=i,this.remoteDocumentCache.getEntry(e,n)))).next((i=>(r!==null&&Ru(r.mutation,i,Tr.empty(),Ht.now()),i)))}getDocuments(e,n){return this.remoteDocumentCache.getEntries(e,n).next((r=>this.getLocalViewOfDocuments(e,r,mt()).next((()=>r))))}getLocalViewOfDocuments(e,n,r=mt()){const i=bo();return this.populateOverlays(e,i,n).next((()=>this.computeViews(e,n,i,r).next((o=>{let l=xu();return o.forEach(((d,h)=>{l=l.insert(d,h.overlayedDocument)})),l}))))}getOverlayedDocuments(e,n){const r=bo();return this.populateOverlays(e,r,n).next((()=>this.computeViews(e,n,r,mt())))}populateOverlays(e,n,r){const i=[];return r.forEach((o=>{n.has(o)||i.push(o)})),this.documentOverlayCache.getOverlays(e,i).next((o=>{o.forEach(((l,d)=>{n.set(l,d)}))}))}computeViews(e,n,r,i){let o=vi();const l=ju(),d=(function(){return ju()})();return n.forEach(((h,m)=>{const p=r.get(m.key);i.has(m.key)&&(p===void 0||p.mutation instanceof Oa)?o=o.insert(m.key,m):p!==void 0?(l.set(m.key,p.mutation.getFieldMask()),Ru(p.mutation,m,p.mutation.getFieldMask(),Ht.now())):l.set(m.key,Tr.empty())})),this.recalculateAndSaveOverlays(e,o).next((h=>(h.forEach(((m,p)=>l.set(m,p))),n.forEach(((m,p)=>d.set(m,new qO(p,l.get(m)??null)))),d)))}recalculateAndSaveOverlays(e,n){const r=ju();let i=new Zt(((l,d)=>l-d)),o=mt();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,n).next((l=>{for(const d of l)d.keys().forEach((h=>{const m=n.get(h);if(m===null)return;let p=r.get(h)||Tr.empty();p=d.applyToLocalView(m,p),r.set(h,p);const g=(i.get(d.batchId)||mt()).add(h);i=i.insert(d.batchId,g)}))})).next((()=>{const l=[],d=i.getReverseIterator();for(;d.hasNext();){const h=d.getNext(),m=h.key,p=h.value,g=dC();p.forEach((v=>{if(!o.has(v)){const b=_C(n.get(v),r.get(v));b!==null&&g.set(v,b),o=o.add(v)}})),l.push(this.documentOverlayCache.saveOverlays(e,m,g))}return Ie.waitFor(l)})).next((()=>r))}recalculateAndSaveOverlaysForDocumentKeys(e,n){return this.remoteDocumentCache.getEntries(e,n).next((r=>this.recalculateAndSaveOverlays(e,r)))}getDocumentsMatchingQuery(e,n,r,i){return(function(l){return Ge.isDocumentKey(l.path)&&l.collectionGroup===null&&l.filters.length===0})(n)?this.getDocumentsMatchingDocumentQuery(e,n.path):aC(n)?this.getDocumentsMatchingCollectionGroupQuery(e,n,r,i):this.getDocumentsMatchingCollectionQuery(e,n,r,i)}getNextDocuments(e,n,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,n,r,i).next((o=>{const l=i-o.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,n,r.largestBatchId,i-o.size):Ie.resolve(bo());let d=Nu,h=o;return l.next((m=>Ie.forEach(m,((p,g)=>(d<g.largestBatchId&&(d=g.largestBatchId),o.get(p)?Ie.resolve():this.remoteDocumentCache.getEntry(e,p).next((v=>{h=h.insert(p,v)}))))).next((()=>this.populateOverlays(e,m,o))).next((()=>this.computeViews(e,h,m,mt()))).next((p=>({batchId:d,changes:uC(p)})))))}))}getDocumentsMatchingDocumentQuery(e,n){return this.getDocument(e,new Ge(n)).next((r=>{let i=xu();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i}))}getDocumentsMatchingCollectionGroupQuery(e,n,r,i){const o=n.collectionGroup;let l=xu();return this.indexManager.getCollectionParents(e,o).next((d=>Ie.forEach(d,(h=>{const m=(function(g,v){return new ed(v,null,g.explicitOrderBy.slice(),g.filters.slice(),g.limit,g.limitType,g.startAt,g.endAt)})(n,h.child(o));return this.getDocumentsMatchingCollectionQuery(e,m,r,i).next((p=>{p.forEach(((g,v)=>{l=l.insert(g,v)}))}))})).next((()=>l))))}getDocumentsMatchingCollectionQuery(e,n,r,i){let o;return this.documentOverlayCache.getOverlaysForCollection(e,n.path,r.largestBatchId).next((l=>(o=l,this.remoteDocumentCache.getDocumentsMatchingQuery(e,n,r,o,i)))).next((l=>{o.forEach(((h,m)=>{const p=m.getKey();l.get(p)===null&&(l=l.insert(p,Zn.newInvalidDocument(p)))}));let d=xu();return l.forEach(((h,m)=>{const p=o.get(h);p!==void 0&&Ru(p.mutation,m,Tr.empty(),Ht.now()),Yf(n,m)&&(d=d.insert(h,m))})),d}))}}class GO{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,n){return Ie.resolve(this.Lr.get(n))}saveBundleMetadata(e,n){return this.Lr.set(n.id,(function(i){return{id:i.id,version:i.version,createTime:Fs(i.createTime)}})(n)),Ie.resolve()}getNamedQuery(e,n){return Ie.resolve(this.kr.get(n))}saveNamedQuery(e,n){return this.kr.set(n.name,(function(i){return{name:i.name,query:NO(i.bundledQuery),readTime:Fs(i.readTime)}})(n)),Ie.resolve()}}class QO{constructor(){this.overlays=new Zt(Ge.comparator),this.qr=new Map}getOverlay(e,n){return Ie.resolve(this.overlays.get(n))}getOverlays(e,n){const r=bo();return Ie.forEach(n,(i=>this.getOverlay(e,i).next((o=>{o!==null&&r.set(i,o)})))).next((()=>r))}saveOverlays(e,n,r){return r.forEach(((i,o)=>{this.St(e,n,o)})),Ie.resolve()}removeOverlaysForBatchId(e,n,r){const i=this.qr.get(r);return i!==void 0&&(i.forEach((o=>this.overlays=this.overlays.remove(o))),this.qr.delete(r)),Ie.resolve()}getOverlaysForCollection(e,n,r){const i=bo(),o=n.length+1,l=new Ge(n.child("")),d=this.overlays.getIteratorFrom(l);for(;d.hasNext();){const h=d.getNext().value,m=h.getKey();if(!n.isPrefixOf(m.path))break;m.path.length===o&&h.largestBatchId>r&&i.set(h.getKey(),h)}return Ie.resolve(i)}getOverlaysForCollectionGroup(e,n,r,i){let o=new Zt(((m,p)=>m-p));const l=this.overlays.getIterator();for(;l.hasNext();){const m=l.getNext().value;if(m.getKey().getCollectionGroup()===n&&m.largestBatchId>r){let p=o.get(m.largestBatchId);p===null&&(p=bo(),o=o.insert(m.largestBatchId,p)),p.set(m.getKey(),m)}}const d=bo(),h=o.getIterator();for(;h.hasNext()&&(h.getNext().value.forEach(((m,p)=>d.set(m,p))),!(d.size()>=i)););return Ie.resolve(d)}St(e,n,r){const i=this.overlays.get(r.key);if(i!==null){const l=this.qr.get(i.largestBatchId).delete(r.key);this.qr.set(i.largestBatchId,l)}this.overlays=this.overlays.insert(r.key,new dO(n,r));let o=this.qr.get(n);o===void 0&&(o=mt(),this.qr.set(n,o)),this.qr.set(n,o.add(r.key))}}class WO{constructor(){this.sessionToken=$n.EMPTY_BYTE_STRING}getSessionToken(e){return Ie.resolve(this.sessionToken)}setSessionToken(e,n){return this.sessionToken=n,Ie.resolve()}}class f0{constructor(){this.Qr=new Tn(kn.$r),this.Ur=new Tn(kn.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,n){const r=new kn(e,n);this.Qr=this.Qr.add(r),this.Ur=this.Ur.add(r)}Wr(e,n){e.forEach((r=>this.addReference(r,n)))}removeReference(e,n){this.Gr(new kn(e,n))}zr(e,n){e.forEach((r=>this.removeReference(r,n)))}jr(e){const n=new Ge(new Ut([])),r=new kn(n,e),i=new kn(n,e+1),o=[];return this.Ur.forEachInRange([r,i],(l=>{this.Gr(l),o.push(l.key)})),o}Jr(){this.Qr.forEach((e=>this.Gr(e)))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const n=new Ge(new Ut([])),r=new kn(n,e),i=new kn(n,e+1);let o=mt();return this.Ur.forEachInRange([r,i],(l=>{o=o.add(l.key)})),o}containsKey(e){const n=new kn(e,0),r=this.Qr.firstAfterOrEqual(n);return r!==null&&e.isEqual(r.key)}}class kn{constructor(e,n){this.key=e,this.Yr=n}static $r(e,n){return Ge.comparator(e.key,n.key)||ft(e.Yr,n.Yr)}static Kr(e,n){return ft(e.Yr,n.Yr)||Ge.comparator(e.key,n.key)}}class KO{constructor(e,n){this.indexManager=e,this.referenceDelegate=n,this.mutationQueue=[],this.tr=1,this.Zr=new Tn(kn.$r)}checkEmpty(e){return Ie.resolve(this.mutationQueue.length===0)}addMutationBatch(e,n,r,i){const o=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const l=new uO(o,n,r,i);this.mutationQueue.push(l);for(const d of i)this.Zr=this.Zr.add(new kn(d.key,o)),this.indexManager.addToCollectionParentIndex(e,d.key.path.popLast());return Ie.resolve(l)}lookupMutationBatch(e,n){return Ie.resolve(this.Xr(n))}getNextMutationBatchAfterBatchId(e,n){const r=n+1,i=this.ei(r),o=i<0?0:i;return Ie.resolve(this.mutationQueue.length>o?this.mutationQueue[o]:null)}getHighestUnacknowledgedBatchId(){return Ie.resolve(this.mutationQueue.length===0?r0:this.tr-1)}getAllMutationBatches(e){return Ie.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,n){const r=new kn(n,0),i=new kn(n,Number.POSITIVE_INFINITY),o=[];return this.Zr.forEachInRange([r,i],(l=>{const d=this.Xr(l.Yr);o.push(d)})),Ie.resolve(o)}getAllMutationBatchesAffectingDocumentKeys(e,n){let r=new Tn(ft);return n.forEach((i=>{const o=new kn(i,0),l=new kn(i,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([o,l],(d=>{r=r.add(d.Yr)}))})),Ie.resolve(this.ti(r))}getAllMutationBatchesAffectingQuery(e,n){const r=n.path,i=r.length+1;let o=r;Ge.isDocumentKey(o)||(o=o.child(""));const l=new kn(new Ge(o),0);let d=new Tn(ft);return this.Zr.forEachWhile((h=>{const m=h.key.path;return!!r.isPrefixOf(m)&&(m.length===i&&(d=d.add(h.Yr)),!0)}),l),Ie.resolve(this.ti(d))}ti(e){const n=[];return e.forEach((r=>{const i=this.Xr(r);i!==null&&n.push(i)})),n}removeMutationBatch(e,n){jt(this.ni(n.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Zr;return Ie.forEach(n.mutations,(i=>{const o=new kn(i.key,n.batchId);return r=r.delete(o),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)})).next((()=>{this.Zr=r}))}ir(e){}containsKey(e,n){const r=new kn(n,0),i=this.Zr.firstAfterOrEqual(r);return Ie.resolve(n.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,Ie.resolve()}ni(e,n){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const n=this.ei(e);return n<0||n>=this.mutationQueue.length?null:this.mutationQueue[n]}}class YO{constructor(e){this.ri=e,this.docs=(function(){return new Zt(Ge.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,n){const r=n.key,i=this.docs.get(r),o=i?i.size:0,l=this.ri(n);return this.docs=this.docs.insert(r,{document:n.mutableCopy(),size:l}),this.size+=l-o,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const n=this.docs.get(e);n&&(this.docs=this.docs.remove(e),this.size-=n.size)}getEntry(e,n){const r=this.docs.get(n);return Ie.resolve(r?r.document.mutableCopy():Zn.newInvalidDocument(n))}getEntries(e,n){let r=vi();return n.forEach((i=>{const o=this.docs.get(i);r=r.insert(i,o?o.document.mutableCopy():Zn.newInvalidDocument(i))})),Ie.resolve(r)}getDocumentsMatchingQuery(e,n,r,i){let o=vi();const l=n.path,d=new Ge(l.child("__id-9223372036854775808__")),h=this.docs.getIteratorFrom(d);for(;h.hasNext();){const{key:m,value:{document:p}}=h.getNext();if(!l.isPrefixOf(m.path))break;m.path.length>l.length+1||CM(EM(p),r)<=0||(i.has(p.key)||Yf(n,p))&&(o=o.insert(p.key,p.mutableCopy()))}return Ie.resolve(o)}getAllFromCollectionGroup(e,n,r,i){Ke(9500)}ii(e,n){return Ie.forEach(this.docs,(r=>n(r)))}newChangeBuffer(e){return new XO(this)}getSize(e){return Ie.resolve(this.size)}}class XO extends $O{constructor(e){super(),this.Nr=e}applyChanges(e){const n=[];return this.changes.forEach(((r,i)=>{i.isValidDocument()?n.push(this.Nr.addEntry(e,i)):this.Nr.removeEntry(r)})),Ie.waitFor(n)}getFromCache(e,n){return this.Nr.getEntry(e,n)}getAllFromCache(e,n){return this.Nr.getEntries(e,n)}}class ZO{constructor(e){this.persistence=e,this.si=new Mo((n=>a0(n)),o0),this.lastRemoteSnapshotVersion=Ze.min(),this.highestTargetId=0,this.oi=0,this._i=new f0,this.targetCount=0,this.ai=Kl.ur()}forEachTarget(e,n){return this.si.forEach(((r,i)=>n(i))),Ie.resolve()}getLastRemoteSnapshotVersion(e){return Ie.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return Ie.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),Ie.resolve(this.highestTargetId)}setTargetsMetadata(e,n,r){return r&&(this.lastRemoteSnapshotVersion=r),n>this.oi&&(this.oi=n),Ie.resolve()}Pr(e){this.si.set(e.target,e);const n=e.targetId;n>this.highestTargetId&&(this.ai=new Kl(n),this.highestTargetId=n),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,n){return this.Pr(n),this.targetCount+=1,Ie.resolve()}updateTargetData(e,n){return this.Pr(n),Ie.resolve()}removeTargetData(e,n){return this.si.delete(n.target),this._i.jr(n.targetId),this.targetCount-=1,Ie.resolve()}removeTargets(e,n,r){let i=0;const o=[];return this.si.forEach(((l,d)=>{d.sequenceNumber<=n&&r.get(d.targetId)===null&&(this.si.delete(l),o.push(this.removeMatchingKeysForTargetId(e,d.targetId)),i++)})),Ie.waitFor(o).next((()=>i))}getTargetCount(e){return Ie.resolve(this.targetCount)}getTargetData(e,n){const r=this.si.get(n)||null;return Ie.resolve(r)}addMatchingKeys(e,n,r){return this._i.Wr(n,r),Ie.resolve()}removeMatchingKeys(e,n,r){this._i.zr(n,r);const i=this.persistence.referenceDelegate,o=[];return i&&n.forEach((l=>{o.push(i.markPotentiallyOrphaned(e,l))})),Ie.waitFor(o)}removeMatchingKeysForTargetId(e,n){return this._i.jr(n),Ie.resolve()}getMatchingKeysForTargetId(e,n){const r=this._i.Hr(n);return Ie.resolve(r)}containsKey(e,n){return Ie.resolve(this._i.containsKey(n))}}class kC{constructor(e,n){this.ui={},this.overlays={},this.ci=new Gf(0),this.li=!1,this.li=!0,this.hi=new WO,this.referenceDelegate=e(this),this.Pi=new ZO(this),this.indexManager=new PO,this.remoteDocumentCache=(function(i){return new YO(i)})((r=>this.referenceDelegate.Ti(r))),this.serializer=new OO(n),this.Ii=new GO(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let n=this.overlays[e.toKey()];return n||(n=new QO,this.overlays[e.toKey()]=n),n}getMutationQueue(e,n){let r=this.ui[e.toKey()];return r||(r=new KO(n,this.referenceDelegate),this.ui[e.toKey()]=r),r}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,n,r){ze("MemoryPersistence","Starting transaction:",e);const i=new JO(this.ci.next());return this.referenceDelegate.Ei(),r(i).next((o=>this.referenceDelegate.di(i).next((()=>o)))).toPromise().then((o=>(i.raiseOnCommittedEvent(),o)))}Ai(e,n){return Ie.or(Object.values(this.ui).map((r=>()=>r.containsKey(e,n))))}}class JO extends AM{constructor(e){super(),this.currentSequenceNumber=e}}class m0{constructor(e){this.persistence=e,this.Ri=new f0,this.Vi=null}static mi(e){return new m0(e)}get fi(){if(this.Vi)return this.Vi;throw Ke(60996)}addReference(e,n,r){return this.Ri.addReference(r,n),this.fi.delete(r.toString()),Ie.resolve()}removeReference(e,n,r){return this.Ri.removeReference(r,n),this.fi.add(r.toString()),Ie.resolve()}markPotentiallyOrphaned(e,n){return this.fi.add(n.toString()),Ie.resolve()}removeTarget(e,n){this.Ri.jr(n.targetId).forEach((i=>this.fi.add(i.toString())));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,n.targetId).next((i=>{i.forEach((o=>this.fi.add(o.toString())))})).next((()=>r.removeTargetData(e,n)))}Ei(){this.Vi=new Set}di(e){const n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Ie.forEach(this.fi,(r=>{const i=Ge.fromPath(r);return this.gi(e,i).next((o=>{o||n.removeEntry(i,Ze.min())}))})).next((()=>(this.Vi=null,n.apply(e))))}updateLimboDocument(e,n){return this.gi(e,n).next((r=>{r?this.fi.delete(n.toString()):this.fi.add(n.toString())}))}Ti(e){return 0}gi(e,n){return Ie.or([()=>Ie.resolve(this.Ri.containsKey(n)),()=>this.persistence.getTargetCache().containsKey(e,n),()=>this.persistence.Ai(e,n)])}}class wf{constructor(e,n){this.persistence=e,this.pi=new Mo((r=>IM(r.path)),((r,i)=>r.isEqual(i))),this.garbageCollector=VO(this,n)}static mi(e,n){return new wf(e,n)}Ei(){}di(e){return Ie.resolve()}forEachTarget(e,n){return this.persistence.getTargetCache().forEachTarget(e,n)}gr(e){const n=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next((r=>n.next((i=>r+i))))}wr(e){let n=0;return this.pr(e,(r=>{n++})).next((()=>n))}pr(e,n){return Ie.forEach(this.pi,((r,i)=>this.br(e,r,i).next((o=>o?Ie.resolve():n(i)))))}removeTargets(e,n,r){return this.persistence.getTargetCache().removeTargets(e,n,r)}removeOrphanedDocuments(e,n){let r=0;const i=this.persistence.getRemoteDocumentCache(),o=i.newChangeBuffer();return i.ii(e,(l=>this.br(e,l,n).next((d=>{d||(r++,o.removeEntry(l,Ze.min()))})))).next((()=>o.apply(e))).next((()=>r))}markPotentiallyOrphaned(e,n){return this.pi.set(n,e.currentSequenceNumber),Ie.resolve()}removeTarget(e,n){const r=n.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,n,r){return this.pi.set(r,e.currentSequenceNumber),Ie.resolve()}removeReference(e,n,r){return this.pi.set(r,e.currentSequenceNumber),Ie.resolve()}updateLimboDocument(e,n){return this.pi.set(n,e.currentSequenceNumber),Ie.resolve()}Ti(e){let n=e.key.toString().length;return e.isFoundDocument()&&(n+=Xh(e.data.value)),n}br(e,n,r){return Ie.or([()=>this.persistence.Ai(e,n),()=>this.persistence.getTargetCache().containsKey(e,n),()=>{const i=this.pi.get(n);return Ie.resolve(i!==void 0&&i>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class p0{constructor(e,n,r,i){this.targetId=e,this.fromCache=n,this.Es=r,this.ds=i}static As(e,n){let r=mt(),i=mt();for(const o of n.docChanges)switch(o.type){case 0:r=r.add(o.doc.key);break;case 1:i=i.add(o.doc.key)}return new p0(e,n.fromCache,r,i)}}class eN{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class tN{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(function(){return RR()?8:jM(Jn())>0?6:4})()}initialize(e,n){this.ps=e,this.indexManager=n,this.Rs=!0}getDocumentsMatchingQuery(e,n,r,i){const o={result:null};return this.ys(e,n).next((l=>{o.result=l})).next((()=>{if(!o.result)return this.ws(e,n,i,r).next((l=>{o.result=l}))})).next((()=>{if(o.result)return;const l=new eN;return this.Ss(e,n,l).next((d=>{if(o.result=d,this.Vs)return this.bs(e,n,l,d.size)}))})).next((()=>o.result))}bs(e,n,r,i){return r.documentReadCount<this.fs?(Il()<=ht.DEBUG&&ze("QueryEngine","SDK will not create cache indexes for query:",kl(n),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),Ie.resolve()):(Il()<=ht.DEBUG&&ze("QueryEngine","Query:",kl(n),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.gs*i?(Il()<=ht.DEBUG&&ze("QueryEngine","The SDK decides to create cache indexes for query:",kl(n),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Us(n))):Ie.resolve())}ys(e,n){if(Gw(n))return Ie.resolve(null);let r=Us(n);return this.indexManager.getIndexType(e,r).next((i=>i===0?null:(n.limit!==null&&i===1&&(n=_y(n,null,"F"),r=Us(n)),this.indexManager.getDocumentsMatchingTarget(e,r).next((o=>{const l=mt(...o);return this.ps.getDocuments(e,l).next((d=>this.indexManager.getMinOffset(e,r).next((h=>{const m=this.Ds(n,d);return this.Cs(n,m,l,h.readTime)?this.ys(e,_y(n,null,"F")):this.vs(e,m,n,h)}))))})))))}ws(e,n,r,i){return Gw(n)||i.isEqual(Ze.min())?Ie.resolve(null):this.ps.getDocuments(e,r).next((o=>{const l=this.Ds(n,o);return this.Cs(n,l,r,i)?Ie.resolve(null):(Il()<=ht.DEBUG&&ze("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),kl(n)),this.vs(e,l,n,SM(i,Nu)).next((d=>d)))}))}Ds(e,n){let r=new Tn(lC(e));return n.forEach(((i,o)=>{Yf(e,o)&&(r=r.add(o))})),r}Cs(e,n,r,i){if(e.limit===null)return!1;if(r.size!==n.size)return!0;const o=e.limitType==="F"?n.last():n.first();return!!o&&(o.hasPendingWrites||o.version.compareTo(i)>0)}Ss(e,n,r){return Il()<=ht.DEBUG&&ze("QueryEngine","Using full collection scan to execute query:",kl(n)),this.ps.getDocumentsMatchingQuery(e,n,xa.min(),r)}vs(e,n,r,i){return this.ps.getDocumentsMatchingQuery(e,r,i).next((o=>(n.forEach((l=>{o=o.insert(l.key,l)})),o)))}}const g0="LocalStore",nN=3e8;class rN{constructor(e,n,r,i){this.persistence=e,this.Fs=n,this.serializer=i,this.Ms=new Zt(ft),this.xs=new Mo((o=>a0(o)),o0),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(r)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new HO(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(n=>e.collect(n,this.Ms)))}}function sN(t,e,n,r){return new rN(t,e,n,r)}async function DC(t,e){const n=tt(t);return await n.persistence.runTransaction("Handle user change","readonly",(r=>{let i;return n.mutationQueue.getAllMutationBatches(r).next((o=>(i=o,n.Bs(e),n.mutationQueue.getAllMutationBatches(r)))).next((o=>{const l=[],d=[];let h=mt();for(const m of i){l.push(m.batchId);for(const p of m.mutations)h=h.add(p.key)}for(const m of o){d.push(m.batchId);for(const p of m.mutations)h=h.add(p.key)}return n.localDocuments.getDocuments(r,h).next((m=>({Ls:m,removedBatchIds:l,addedBatchIds:d})))}))}))}function iN(t,e){const n=tt(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(r=>{const i=e.batch.keys(),o=n.Ns.newChangeBuffer({trackRemovals:!0});return(function(d,h,m,p){const g=m.batch,v=g.keys();let b=Ie.resolve();return v.forEach((E=>{b=b.next((()=>p.getEntry(h,E))).next((x=>{const S=m.docVersions.get(E);jt(S!==null,48541),x.version.compareTo(S)<0&&(g.applyToRemoteDocument(x,m),x.isValidDocument()&&(x.setReadTime(m.commitVersion),p.addEntry(x)))}))})),b.next((()=>d.mutationQueue.removeMutationBatch(h,g)))})(n,r,e,o).next((()=>o.apply(r))).next((()=>n.mutationQueue.performConsistencyCheck(r))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,(function(d){let h=mt();for(let m=0;m<d.mutationResults.length;++m)d.mutationResults[m].transformResults.length>0&&(h=h.add(d.batch.mutations[m].key));return h})(e)))).next((()=>n.localDocuments.getDocuments(r,i)))}))}function MC(t){const e=tt(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(n=>e.Pi.getLastRemoteSnapshotVersion(n)))}function aN(t,e){const n=tt(t),r=e.snapshotVersion;let i=n.Ms;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(o=>{const l=n.Ns.newChangeBuffer({trackRemovals:!0});i=n.Ms;const d=[];e.targetChanges.forEach(((p,g)=>{const v=i.get(g);if(!v)return;d.push(n.Pi.removeMatchingKeys(o,p.removedDocuments,g).next((()=>n.Pi.addMatchingKeys(o,p.addedDocuments,g))));let b=v.withSequenceNumber(o.currentSequenceNumber);e.targetMismatches.get(g)!==null?b=b.withResumeToken($n.EMPTY_BYTE_STRING,Ze.min()).withLastLimboFreeSnapshotVersion(Ze.min()):p.resumeToken.approximateByteSize()>0&&(b=b.withResumeToken(p.resumeToken,r)),i=i.insert(g,b),(function(x,S,C){return x.resumeToken.approximateByteSize()===0||S.snapshotVersion.toMicroseconds()-x.snapshotVersion.toMicroseconds()>=nN?!0:C.addedDocuments.size+C.modifiedDocuments.size+C.removedDocuments.size>0})(v,b,p)&&d.push(n.Pi.updateTargetData(o,b))}));let h=vi(),m=mt();if(e.documentUpdates.forEach((p=>{e.resolvedLimboDocuments.has(p)&&d.push(n.persistence.referenceDelegate.updateLimboDocument(o,p))})),d.push(oN(o,l,e.documentUpdates).next((p=>{h=p.ks,m=p.qs}))),!r.isEqual(Ze.min())){const p=n.Pi.getLastRemoteSnapshotVersion(o).next((g=>n.Pi.setTargetsMetadata(o,o.currentSequenceNumber,r)));d.push(p)}return Ie.waitFor(d).next((()=>l.apply(o))).next((()=>n.localDocuments.getLocalViewOfDocuments(o,h,m))).next((()=>h))})).then((o=>(n.Ms=i,o)))}function oN(t,e,n){let r=mt(),i=mt();return n.forEach((o=>r=r.add(o))),e.getEntries(t,r).next((o=>{let l=vi();return n.forEach(((d,h)=>{const m=o.get(d);h.isFoundDocument()!==m.isFoundDocument()&&(i=i.add(d)),h.isNoDocument()&&h.version.isEqual(Ze.min())?(e.removeEntry(d,h.readTime),l=l.insert(d,h)):!m.isValidDocument()||h.version.compareTo(m.version)>0||h.version.compareTo(m.version)===0&&m.hasPendingWrites?(e.addEntry(h),l=l.insert(d,h)):ze(g0,"Ignoring outdated watch update for ",d,". Current version:",m.version," Watch version:",h.version)})),{ks:l,qs:i}}))}function lN(t,e){const n=tt(t);return n.persistence.runTransaction("Get next mutation batch","readonly",(r=>(e===void 0&&(e=r0),n.mutationQueue.getNextMutationBatchAfterBatchId(r,e))))}function cN(t,e){const n=tt(t);return n.persistence.runTransaction("Allocate target","readwrite",(r=>{let i;return n.Pi.getTargetData(r,e).next((o=>o?(i=o,Ie.resolve(i)):n.Pi.allocateTargetId(r).next((l=>(i=new da(e,l,"TargetPurposeListen",r.currentSequenceNumber),n.Pi.addTargetData(r,i).next((()=>i)))))))})).then((r=>{const i=n.Ms.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(n.Ms=n.Ms.insert(r.targetId,r),n.xs.set(e,r.targetId)),r}))}async function Sy(t,e,n){const r=tt(t),i=r.Ms.get(e),o=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",o,(l=>r.persistence.referenceDelegate.removeTarget(l,i)))}catch(l){if(!cc(l))throw l;ze(g0,`Failed to update sequence numbers for target ${e}: ${l}`)}r.Ms=r.Ms.remove(e),r.xs.delete(i.target)}function i1(t,e,n){const r=tt(t);let i=Ze.min(),o=mt();return r.persistence.runTransaction("Execute query","readwrite",(l=>(function(h,m,p){const g=tt(h),v=g.xs.get(p);return v!==void 0?Ie.resolve(g.Ms.get(v)):g.Pi.getTargetData(m,p)})(r,l,Us(e)).next((d=>{if(d)return i=d.lastLimboFreeSnapshotVersion,r.Pi.getMatchingKeysForTargetId(l,d.targetId).next((h=>{o=h}))})).next((()=>r.Fs.getDocumentsMatchingQuery(l,e,n?i:Ze.min(),n?o:mt()))).next((d=>(uN(r,KM(e),d),{documents:d,Qs:o})))))}function uN(t,e,n){let r=t.Os.get(e)||Ze.min();n.forEach(((i,o)=>{o.readTime.compareTo(r)>0&&(r=o.readTime)})),t.Os.set(e,r)}class a1{constructor(){this.activeTargetIds=tO()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class dN{constructor(){this.Mo=new a1,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,n,r){}addLocalQueryTarget(e,n=!0){return n&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,n,r){this.xo[e]=n}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new a1,Promise.resolve()}handleUserChange(e,n,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class hN{Oo(e){}shutdown(){}}const o1="ConnectivityMonitor";class l1{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){ze(o1,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){ze(o1,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}let Fh=null;function Ey(){return Fh===null?Fh=(function(){return 268435456+Math.round(2147483648*Math.random())})():Fh++,"0x"+Fh.toString(16)}const Bg="RestConnection",fN={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class mN{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const n=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Uo=n+"://"+e.host,this.Ko=`projects/${r}/databases/${i}`,this.Wo=this.databaseId.database===pf?`project_id=${r}`:`project_id=${r}&database_id=${i}`}Go(e,n,r,i,o){const l=Ey(),d=this.zo(e,n.toUriEncodedString());ze(Bg,`Sending RPC '${e}' ${l}:`,d,r);const h={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(h,i,o);const{host:m}=new URL(d),p=nc(m);return this.Jo(e,d,h,r,p).then((g=>(ze(Bg,`Received RPC '${e}' ${l}: `,g),g)),(g=>{throw $l(Bg,`RPC '${e}' ${l} failed with error: `,g,"url: ",d,"request:",r),g}))}Ho(e,n,r,i,o,l){return this.Go(e,n,r,i,o)}jo(e,n,r){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+oc})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach(((i,o)=>e[o]=i)),r&&r.headers.forEach(((i,o)=>e[o]=i))}zo(e,n){const r=fN[e];return`${this.Uo}/v1/${n}:${r}`}terminate(){}}class pN{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}const Yn="WebChannelConnection";class gN extends mN{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,n,r,i,o){const l=Ey();return new Promise(((d,h)=>{const m=new NE;m.setWithCredentials(!0),m.listenOnce(PE.COMPLETE,(()=>{try{switch(m.getLastErrorCode()){case Yh.NO_ERROR:const g=m.getResponseJson();ze(Yn,`XHR for RPC '${e}' ${l} received:`,JSON.stringify(g)),d(g);break;case Yh.TIMEOUT:ze(Yn,`RPC '${e}' ${l} timed out`),h(new Pe(je.DEADLINE_EXCEEDED,"Request time out"));break;case Yh.HTTP_ERROR:const v=m.getStatus();if(ze(Yn,`RPC '${e}' ${l} failed with status:`,v,"response text:",m.getResponseText()),v>0){let b=m.getResponseJson();Array.isArray(b)&&(b=b[0]);const E=b?.error;if(E&&E.status&&E.message){const x=(function(C){const T=C.toLowerCase().replace(/_/g,"-");return Object.values(je).indexOf(T)>=0?T:je.UNKNOWN})(E.status);h(new Pe(x,E.message))}else h(new Pe(je.UNKNOWN,"Server responded with status "+m.getStatus()))}else h(new Pe(je.UNAVAILABLE,"Connection failed."));break;default:Ke(9055,{l_:e,streamId:l,h_:m.getLastErrorCode(),P_:m.getLastError()})}}finally{ze(Yn,`RPC '${e}' ${l} completed.`)}}));const p=JSON.stringify(i);ze(Yn,`RPC '${e}' ${l} sending request:`,i),m.send(n,"POST",p,r,15)}))}T_(e,n,r){const i=Ey(),o=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],l=LE(),d=zE(),h={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},m=this.longPollingOptions.timeoutSeconds;m!==void 0&&(h.longPollingTimeout=Math.round(1e3*m)),this.useFetchStreams&&(h.useFetchStreams=!0),this.jo(h.initMessageHeaders,n,r),h.encodeInitMessageHeaders=!0;const p=o.join("");ze(Yn,`Creating RPC '${e}' stream ${i}: ${p}`,h);const g=l.createWebChannel(p,h);this.I_(g);let v=!1,b=!1;const E=new pN({Yo:S=>{b?ze(Yn,`Not sending because RPC '${e}' stream ${i} is closed:`,S):(v||(ze(Yn,`Opening RPC '${e}' stream ${i} transport.`),g.open(),v=!0),ze(Yn,`RPC '${e}' stream ${i} sending:`,S),g.send(S))},Zo:()=>g.close()}),x=(S,C,T)=>{S.listen(C,(I=>{try{T(I)}catch(O){setTimeout((()=>{throw O}),0)}}))};return x(g,vu.EventType.OPEN,(()=>{b||(ze(Yn,`RPC '${e}' stream ${i} transport opened.`),E.o_())})),x(g,vu.EventType.CLOSE,(()=>{b||(b=!0,ze(Yn,`RPC '${e}' stream ${i} transport closed`),E.a_(),this.E_(g))})),x(g,vu.EventType.ERROR,(S=>{b||(b=!0,$l(Yn,`RPC '${e}' stream ${i} transport errored. Name:`,S.name,"Message:",S.message),E.a_(new Pe(je.UNAVAILABLE,"The operation could not be completed")))})),x(g,vu.EventType.MESSAGE,(S=>{if(!b){const C=S.data[0];jt(!!C,16349);const T=C,I=T?.error||T[0]?.error;if(I){ze(Yn,`RPC '${e}' stream ${i} received error:`,I);const O=I.status;let U=(function(R){const N=yn[R];if(N!==void 0)return vC(N)})(O),$=I.message;U===void 0&&(U=je.INTERNAL,$="Unknown error status: "+O+" with message "+I.message),b=!0,E.a_(new Pe(U,$)),g.close()}else ze(Yn,`RPC '${e}' stream ${i} received:`,C),E.u_(C)}})),x(d,BE.STAT_EVENT,(S=>{S.stat===dy.PROXY?ze(Yn,`RPC '${e}' stream ${i} detected buffering proxy`):S.stat===dy.NOPROXY&&ze(Yn,`RPC '${e}' stream ${i} detected no buffering proxy`)})),setTimeout((()=>{E.__()}),0),E}terminate(){this.c_.forEach((e=>e.close())),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter((n=>n===e))}}function zg(){return typeof document<"u"?document:null}function tm(t){return new vO(t,!0)}class OC{constructor(e,n,r=1e3,i=1.5,o=6e4){this.Mi=e,this.timerId=n,this.d_=r,this.A_=i,this.R_=o,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const n=Math.floor(this.V_+this.y_()),r=Math.max(0,Date.now()-this.f_),i=Math.max(0,n-r);i>0&&ze("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.V_} ms, delay with jitter: ${n} ms, last attempt: ${r} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,i,(()=>(this.f_=Date.now(),e()))),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}const c1="PersistentStream";class NC{constructor(e,n,r,i,o,l,d,h){this.Mi=e,this.S_=r,this.b_=i,this.connection=o,this.authCredentialsProvider=l,this.appCheckCredentialsProvider=d,this.listener=h,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new OC(e,n)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,(()=>this.k_())))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,n){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():n&&n.code===je.RESOURCE_EXHAUSTED?(bi(n.toString()),bi("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):n&&n.code===je.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(n)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),n=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([r,i])=>{this.D_===n&&this.G_(r,i)}),(r=>{e((()=>{const i=new Pe(je.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(i)}))}))}G_(e,n){const r=this.W_(this.D_);this.stream=this.j_(e,n),this.stream.Xo((()=>{r((()=>this.listener.Xo()))})),this.stream.t_((()=>{r((()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.t_())))})),this.stream.r_((i=>{r((()=>this.z_(i)))})),this.stream.onMessage((i=>{r((()=>++this.F_==1?this.J_(i):this.onNext(i)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(e){return ze(c1,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return n=>{this.Mi.enqueueAndForget((()=>this.D_===e?n():(ze(c1,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class yN extends NC{constructor(e,n,r,i,o,l){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",n,r,i,l),this.serializer=o}j_(e,n){return this.connection.T_("Listen",e,n)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const n=SO(this.serializer,e),r=(function(o){if(!("targetChange"in o))return Ze.min();const l=o.targetChange;return l.targetIds&&l.targetIds.length?Ze.min():l.readTime?Fs(l.readTime):Ze.min()})(e);return this.listener.H_(n,r)}Y_(e){const n={};n.database=wy(this.serializer),n.addTarget=(function(o,l){let d;const h=l.target;if(d=gy(h)?{documents:TO(o,h)}:{query:AO(o,h).ft},d.targetId=l.targetId,l.resumeToken.approximateByteSize()>0){d.resumeToken=SC(o,l.resumeToken);const m=by(o,l.expectedCount);m!==null&&(d.expectedCount=m)}else if(l.snapshotVersion.compareTo(Ze.min())>0){d.readTime=xf(o,l.snapshotVersion.toTimestamp());const m=by(o,l.expectedCount);m!==null&&(d.expectedCount=m)}return d})(this.serializer,e);const r=RO(this.serializer,e);r&&(n.labels=r),this.q_(n)}Z_(e){const n={};n.database=wy(this.serializer),n.removeTarget=e,this.q_(n)}}class _N extends NC{constructor(e,n,r,i,o,l){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",n,r,i,l),this.serializer=o}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,n){return this.connection.T_("Write",e,n)}J_(e){return jt(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,jt(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){jt(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const n=CO(e.writeResults,e.commitTime),r=Fs(e.commitTime);return this.listener.na(r,n)}ra(){const e={};e.database=wy(this.serializer),this.q_(e)}ea(e){const n={streamToken:this.lastStreamToken,writes:e.map((r=>EO(this.serializer,r)))};this.q_(n)}}class bN{}class vN extends bN{constructor(e,n,r,i){super(),this.authCredentials=e,this.appCheckCredentials=n,this.connection=r,this.serializer=i,this.ia=!1}sa(){if(this.ia)throw new Pe(je.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,n,r,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([o,l])=>this.connection.Go(e,vy(n,r),i,o,l))).catch((o=>{throw o.name==="FirebaseError"?(o.code===je.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new Pe(je.UNKNOWN,o.toString())}))}Ho(e,n,r,i,o){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([l,d])=>this.connection.Ho(e,vy(n,r),i,l,d,o))).catch((l=>{throw l.name==="FirebaseError"?(l.code===je.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),l):new Pe(je.UNKNOWN,l.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}class xN{constructor(e,n){this.asyncQueue=e,this.onlineStateHandler=n,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const n=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(bi(n),this.aa=!1):ze("OnlineStateTracker",n)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}const Ro="RemoteStore";class wN{constructor(e,n,r,i,o){this.localStore=e,this.datastore=n,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=o,this.Aa.Oo((l=>{r.enqueueAndForget((async()=>{Oo(this)&&(ze(Ro,"Restarting streams for network reachability change."),await(async function(h){const m=tt(h);m.Ea.add(4),await rd(m),m.Ra.set("Unknown"),m.Ea.delete(4),await nm(m)})(this))}))})),this.Ra=new xN(r,i)}}async function nm(t){if(Oo(t))for(const e of t.da)await e(!0)}async function rd(t){for(const e of t.da)await e(!1)}function PC(t,e){const n=tt(t);n.Ia.has(e.targetId)||(n.Ia.set(e.targetId,e),v0(n)?b0(n):uc(n).O_()&&_0(n,e))}function y0(t,e){const n=tt(t),r=uc(n);n.Ia.delete(e),r.O_()&&BC(n,e),n.Ia.size===0&&(r.O_()?r.L_():Oo(n)&&n.Ra.set("Unknown"))}function _0(t,e){if(t.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Ze.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}uc(t).Y_(e)}function BC(t,e){t.Va.Ue(e),uc(t).Z_(e)}function b0(t){t.Va=new gO({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),At:e=>t.Ia.get(e)||null,ht:()=>t.datastore.serializer.databaseId}),uc(t).start(),t.Ra.ua()}function v0(t){return Oo(t)&&!uc(t).x_()&&t.Ia.size>0}function Oo(t){return tt(t).Ea.size===0}function zC(t){t.Va=void 0}async function SN(t){t.Ra.set("Online")}async function EN(t){t.Ia.forEach(((e,n)=>{_0(t,e)}))}async function CN(t,e){zC(t),v0(t)?(t.Ra.ha(e),b0(t)):t.Ra.set("Unknown")}async function TN(t,e,n){if(t.Ra.set("Online"),e instanceof wC&&e.state===2&&e.cause)try{await(async function(i,o){const l=o.cause;for(const d of o.targetIds)i.Ia.has(d)&&(await i.remoteSyncer.rejectListen(d,l),i.Ia.delete(d),i.Va.removeTarget(d))})(t,e)}catch(r){ze(Ro,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await Sf(t,r)}else if(e instanceof ef?t.Va.Ze(e):e instanceof xC?t.Va.st(e):t.Va.tt(e),!n.isEqual(Ze.min()))try{const r=await MC(t.localStore);n.compareTo(r)>=0&&await(function(o,l){const d=o.Va.Tt(l);return d.targetChanges.forEach(((h,m)=>{if(h.resumeToken.approximateByteSize()>0){const p=o.Ia.get(m);p&&o.Ia.set(m,p.withResumeToken(h.resumeToken,l))}})),d.targetMismatches.forEach(((h,m)=>{const p=o.Ia.get(h);if(!p)return;o.Ia.set(h,p.withResumeToken($n.EMPTY_BYTE_STRING,p.snapshotVersion)),BC(o,h);const g=new da(p.target,h,m,p.sequenceNumber);_0(o,g)})),o.remoteSyncer.applyRemoteEvent(d)})(t,n)}catch(r){ze(Ro,"Failed to raise snapshot:",r),await Sf(t,r)}}async function Sf(t,e,n){if(!cc(e))throw e;t.Ea.add(1),await rd(t),t.Ra.set("Offline"),n||(n=()=>MC(t.localStore)),t.asyncQueue.enqueueRetryable((async()=>{ze(Ro,"Retrying IndexedDB access"),await n(),t.Ea.delete(1),await nm(t)}))}function LC(t,e){return e().catch((n=>Sf(t,n,e)))}async function rm(t){const e=tt(t),n=Ca(e);let r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:r0;for(;AN(e);)try{const i=await lN(e.localStore,r);if(i===null){e.Ta.length===0&&n.L_();break}r=i.batchId,jN(e,i)}catch(i){await Sf(e,i)}UC(e)&&FC(e)}function AN(t){return Oo(t)&&t.Ta.length<10}function jN(t,e){t.Ta.push(e);const n=Ca(t);n.O_()&&n.X_&&n.ea(e.mutations)}function UC(t){return Oo(t)&&!Ca(t).x_()&&t.Ta.length>0}function FC(t){Ca(t).start()}async function RN(t){Ca(t).ra()}async function IN(t){const e=Ca(t);for(const n of t.Ta)e.ea(n.mutations)}async function kN(t,e,n){const r=t.Ta.shift(),i=u0.from(r,e,n);await LC(t,(()=>t.remoteSyncer.applySuccessfulWrite(i))),await rm(t)}async function DN(t,e){e&&Ca(t).X_&&await(async function(r,i){if((function(l){return fO(l)&&l!==je.ABORTED})(i.code)){const o=r.Ta.shift();Ca(r).B_(),await LC(r,(()=>r.remoteSyncer.rejectFailedWrite(o.batchId,i))),await rm(r)}})(t,e),UC(t)&&FC(t)}async function u1(t,e){const n=tt(t);n.asyncQueue.verifyOperationInProgress(),ze(Ro,"RemoteStore received new credentials");const r=Oo(n);n.Ea.add(3),await rd(n),r&&n.Ra.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.Ea.delete(3),await nm(n)}async function MN(t,e){const n=tt(t);e?(n.Ea.delete(2),await nm(n)):e||(n.Ea.add(2),await rd(n),n.Ra.set("Unknown"))}function uc(t){return t.ma||(t.ma=(function(n,r,i){const o=tt(n);return o.sa(),new yN(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,i)})(t.datastore,t.asyncQueue,{Xo:SN.bind(null,t),t_:EN.bind(null,t),r_:CN.bind(null,t),H_:TN.bind(null,t)}),t.da.push((async e=>{e?(t.ma.B_(),v0(t)?b0(t):t.Ra.set("Unknown")):(await t.ma.stop(),zC(t))}))),t.ma}function Ca(t){return t.fa||(t.fa=(function(n,r,i){const o=tt(n);return o.sa(),new _N(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,i)})(t.datastore,t.asyncQueue,{Xo:()=>Promise.resolve(),t_:RN.bind(null,t),r_:DN.bind(null,t),ta:IN.bind(null,t),na:kN.bind(null,t)}),t.da.push((async e=>{e?(t.fa.B_(),await rm(t)):(await t.fa.stop(),t.Ta.length>0&&(ze(Ro,`Stopping write stream with ${t.Ta.length} pending writes`),t.Ta=[]))}))),t.fa}class x0{constructor(e,n,r,i,o){this.asyncQueue=e,this.timerId=n,this.targetTimeMs=r,this.op=i,this.removalCallback=o,this.deferred=new mi,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((l=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,n,r,i,o){const l=Date.now()+r,d=new x0(e,n,l,i,o);return d.start(r),d}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Pe(je.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function w0(t,e){if(bi("AsyncQueue",`${e}: ${t}`),cc(t))return new Pe(je.UNAVAILABLE,`${e}: ${t}`);throw t}class zl{static emptySet(e){return new zl(e.comparator)}constructor(e){this.comparator=e?(n,r)=>e(n,r)||Ge.comparator(n.key,r.key):(n,r)=>Ge.comparator(n.key,r.key),this.keyedMap=xu(),this.sortedSet=new Zt(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const n=this.keyedMap.get(e);return n?this.sortedSet.indexOf(n):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((n,r)=>(e(n),!1)))}add(e){const n=this.delete(e.key);return n.copy(n.keyedMap.insert(e.key,e),n.sortedSet.insert(e,null))}delete(e){const n=this.get(e);return n?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(n)):this}isEqual(e){if(!(e instanceof zl)||this.size!==e.size)return!1;const n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;n.hasNext();){const i=n.getNext().key,o=r.getNext().key;if(!i.isEqual(o))return!1}return!0}toString(){const e=[];return this.forEach((n=>{e.push(n.toString())})),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,n){const r=new zl;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r}}class d1{constructor(){this.ga=new Zt(Ge.comparator)}track(e){const n=e.doc.key,r=this.ga.get(n);r?e.type!==0&&r.type===3?this.ga=this.ga.insert(n,e):e.type===3&&r.type!==1?this.ga=this.ga.insert(n,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.ga=this.ga.insert(n,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.ga=this.ga.insert(n,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.ga=this.ga.remove(n):e.type===1&&r.type===2?this.ga=this.ga.insert(n,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.ga=this.ga.insert(n,{type:2,doc:e.doc}):Ke(63341,{Rt:e,pa:r}):this.ga=this.ga.insert(n,e)}ya(){const e=[];return this.ga.inorderTraversal(((n,r)=>{e.push(r)})),e}}class Yl{constructor(e,n,r,i,o,l,d,h,m){this.query=e,this.docs=n,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=o,this.fromCache=l,this.syncStateChanged=d,this.excludesMetadataChanges=h,this.hasCachedResults=m}static fromInitialDocuments(e,n,r,i,o){const l=[];return n.forEach((d=>{l.push({type:0,doc:d})})),new Yl(e,n,zl.emptySet(n),l,r,i,!0,!1,o)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Kf(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const n=this.docChanges,r=e.docChanges;if(n.length!==r.length)return!1;for(let i=0;i<n.length;i++)if(n[i].type!==r[i].type||!n[i].doc.isEqual(r[i].doc))return!1;return!0}}class ON{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some((e=>e.Da()))}}class NN{constructor(){this.queries=h1(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(n,r){const i=tt(n),o=i.queries;i.queries=h1(),o.forEach(((l,d)=>{for(const h of d.Sa)h.onError(r)}))})(this,new Pe(je.ABORTED,"Firestore shutting down"))}}function h1(){return new Mo((t=>oC(t)),Kf)}async function VC(t,e){const n=tt(t);let r=3;const i=e.query;let o=n.queries.get(i);o?!o.ba()&&e.Da()&&(r=2):(o=new ON,r=e.Da()?0:1);try{switch(r){case 0:o.wa=await n.onListen(i,!0);break;case 1:o.wa=await n.onListen(i,!1);break;case 2:await n.onFirstRemoteStoreListen(i)}}catch(l){const d=w0(l,`Initialization of query '${kl(e.query)}' failed`);return void e.onError(d)}n.queries.set(i,o),o.Sa.push(e),e.va(n.onlineState),o.wa&&e.Fa(o.wa)&&S0(n)}async function $C(t,e){const n=tt(t),r=e.query;let i=3;const o=n.queries.get(r);if(o){const l=o.Sa.indexOf(e);l>=0&&(o.Sa.splice(l,1),o.Sa.length===0?i=e.Da()?0:1:!o.ba()&&e.Da()&&(i=2))}switch(i){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}}function PN(t,e){const n=tt(t);let r=!1;for(const i of e){const o=i.query,l=n.queries.get(o);if(l){for(const d of l.Sa)d.Fa(i)&&(r=!0);l.wa=i}}r&&S0(n)}function BN(t,e,n){const r=tt(t),i=r.queries.get(e);if(i)for(const o of i.Sa)o.onError(n);r.queries.delete(e)}function S0(t){t.Ca.forEach((e=>{e.next()}))}var Cy,f1;(f1=Cy||(Cy={})).Ma="default",f1.Cache="cache";class qC{constructor(e,n,r){this.query=e,this.xa=n,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){const r=[];for(const i of e.docChanges)i.type!==3&&r.push(i);e=new Yl(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let n=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),n=!0):this.La(e,this.onlineState)&&(this.ka(e),n=!0),this.Na=e,n}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let n=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),n=!0),n}La(e,n){if(!e.fromCache||!this.Da())return!0;const r=n!=="Offline";return(!this.options.qa||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||n==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const n=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!n)&&this.options.includeMetadataChanges===!0}ka(e){e=Yl.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==Cy.Cache}}class HC{constructor(e){this.key=e}}class GC{constructor(e){this.key=e}}class zN{constructor(e,n){this.query=e,this.Ya=n,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=mt(),this.mutatedKeys=mt(),this.eu=lC(e),this.tu=new zl(this.eu)}get nu(){return this.Ya}ru(e,n){const r=n?n.iu:new d1,i=n?n.tu:this.tu;let o=n?n.mutatedKeys:this.mutatedKeys,l=i,d=!1;const h=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,m=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal(((p,g)=>{const v=i.get(p),b=Yf(this.query,g)?g:null,E=!!v&&this.mutatedKeys.has(v.key),x=!!b&&(b.hasLocalMutations||this.mutatedKeys.has(b.key)&&b.hasCommittedMutations);let S=!1;v&&b?v.data.isEqual(b.data)?E!==x&&(r.track({type:3,doc:b}),S=!0):this.su(v,b)||(r.track({type:2,doc:b}),S=!0,(h&&this.eu(b,h)>0||m&&this.eu(b,m)<0)&&(d=!0)):!v&&b?(r.track({type:0,doc:b}),S=!0):v&&!b&&(r.track({type:1,doc:v}),S=!0,(h||m)&&(d=!0)),S&&(b?(l=l.add(b),o=x?o.add(p):o.delete(p)):(l=l.delete(p),o=o.delete(p)))})),this.query.limit!==null)for(;l.size>this.query.limit;){const p=this.query.limitType==="F"?l.last():l.first();l=l.delete(p.key),o=o.delete(p.key),r.track({type:1,doc:p})}return{tu:l,iu:r,Cs:d,mutatedKeys:o}}su(e,n){return e.hasLocalMutations&&n.hasCommittedMutations&&!n.hasLocalMutations}applyChanges(e,n,r,i){const o=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const l=e.iu.ya();l.sort(((p,g)=>(function(b,E){const x=S=>{switch(S){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Ke(20277,{Rt:S})}};return x(b)-x(E)})(p.type,g.type)||this.eu(p.doc,g.doc))),this.ou(r),i=i??!1;const d=n&&!i?this._u():[],h=this.Xa.size===0&&this.current&&!i?1:0,m=h!==this.Za;return this.Za=h,l.length!==0||m?{snapshot:new Yl(this.query,e.tu,o,l,e.mutatedKeys,h===0,m,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:d}:{au:d}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new d1,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach((n=>this.Ya=this.Ya.add(n))),e.modifiedDocuments.forEach((n=>{})),e.removedDocuments.forEach((n=>this.Ya=this.Ya.delete(n))),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=mt(),this.tu.forEach((r=>{this.uu(r.key)&&(this.Xa=this.Xa.add(r.key))}));const n=[];return e.forEach((r=>{this.Xa.has(r)||n.push(new GC(r))})),this.Xa.forEach((r=>{e.has(r)||n.push(new HC(r))})),n}cu(e){this.Ya=e.Qs,this.Xa=mt();const n=this.ru(e.documents);return this.applyChanges(n,!0)}lu(){return Yl.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const E0="SyncEngine";class LN{constructor(e,n,r){this.query=e,this.targetId=n,this.view=r}}class UN{constructor(e){this.key=e,this.hu=!1}}class FN{constructor(e,n,r,i,o,l){this.localStore=e,this.remoteStore=n,this.eventManager=r,this.sharedClientState=i,this.currentUser=o,this.maxConcurrentLimboResolutions=l,this.Pu={},this.Tu=new Mo((d=>oC(d)),Kf),this.Iu=new Map,this.Eu=new Set,this.du=new Zt(Ge.comparator),this.Au=new Map,this.Ru=new f0,this.Vu={},this.mu=new Map,this.fu=Kl.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function VN(t,e,n=!0){const r=ZC(t);let i;const o=r.Tu.get(e);return o?(r.sharedClientState.addLocalQueryTarget(o.targetId),i=o.view.lu()):i=await QC(r,e,n,!0),i}async function $N(t,e){const n=ZC(t);await QC(n,e,!0,!1)}async function QC(t,e,n,r){const i=await cN(t.localStore,Us(e)),o=i.targetId,l=t.sharedClientState.addLocalQueryTarget(o,n);let d;return r&&(d=await qN(t,e,o,l==="current",i.resumeToken)),t.isPrimaryClient&&n&&PC(t.remoteStore,i),d}async function qN(t,e,n,r,i){t.pu=(g,v,b)=>(async function(x,S,C,T){let I=S.view.ru(C);I.Cs&&(I=await i1(x.localStore,S.query,!1).then((({documents:k})=>S.view.ru(k,I))));const O=T&&T.targetChanges.get(S.targetId),U=T&&T.targetMismatches.get(S.targetId)!=null,$=S.view.applyChanges(I,x.isPrimaryClient,O,U);return p1(x,S.targetId,$.au),$.snapshot})(t,g,v,b);const o=await i1(t.localStore,e,!0),l=new zN(e,o.Qs),d=l.ru(o.documents),h=nd.createSynthesizedTargetChangeForCurrentChange(n,r&&t.onlineState!=="Offline",i),m=l.applyChanges(d,t.isPrimaryClient,h);p1(t,n,m.au);const p=new LN(e,n,l);return t.Tu.set(e,p),t.Iu.has(n)?t.Iu.get(n).push(e):t.Iu.set(n,[e]),m.snapshot}async function HN(t,e,n){const r=tt(t),i=r.Tu.get(e),o=r.Iu.get(i.targetId);if(o.length>1)return r.Iu.set(i.targetId,o.filter((l=>!Kf(l,e)))),void r.Tu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||await Sy(r.localStore,i.targetId,!1).then((()=>{r.sharedClientState.clearQueryState(i.targetId),n&&y0(r.remoteStore,i.targetId),Ty(r,i.targetId)})).catch(lc)):(Ty(r,i.targetId),await Sy(r.localStore,i.targetId,!0))}async function GN(t,e){const n=tt(t),r=n.Tu.get(e),i=n.Iu.get(r.targetId);n.isPrimaryClient&&i.length===1&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),y0(n.remoteStore,r.targetId))}async function QN(t,e,n){const r=e6(t);try{const i=await(function(l,d){const h=tt(l),m=Ht.now(),p=d.reduce(((b,E)=>b.add(E.key)),mt());let g,v;return h.persistence.runTransaction("Locally write mutations","readwrite",(b=>{let E=vi(),x=mt();return h.Ns.getEntries(b,p).next((S=>{E=S,E.forEach(((C,T)=>{T.isValidDocument()||(x=x.add(C))}))})).next((()=>h.localDocuments.getOverlayedDocuments(b,E))).next((S=>{g=S;const C=[];for(const T of d){const I=lO(T,g.get(T.key).overlayedDocument);I!=null&&C.push(new Oa(T.key,I,JE(I.value.mapValue),pr.exists(!0)))}return h.mutationQueue.addMutationBatch(b,m,C,d)})).next((S=>{v=S;const C=S.applyToLocalDocumentSet(g,x);return h.documentOverlayCache.saveOverlays(b,S.batchId,C)}))})).then((()=>({batchId:v.batchId,changes:uC(g)})))})(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),(function(l,d,h){let m=l.Vu[l.currentUser.toKey()];m||(m=new Zt(ft)),m=m.insert(d,h),l.Vu[l.currentUser.toKey()]=m})(r,i.batchId,n),await sd(r,i.changes),await rm(r.remoteStore)}catch(i){const o=w0(i,"Failed to persist write");n.reject(o)}}async function WC(t,e){const n=tt(t);try{const r=await aN(n.localStore,e);e.targetChanges.forEach(((i,o)=>{const l=n.Au.get(o);l&&(jt(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1,22616),i.addedDocuments.size>0?l.hu=!0:i.modifiedDocuments.size>0?jt(l.hu,14607):i.removedDocuments.size>0&&(jt(l.hu,42227),l.hu=!1))})),await sd(n,r,e)}catch(r){await lc(r)}}function m1(t,e,n){const r=tt(t);if(r.isPrimaryClient&&n===0||!r.isPrimaryClient&&n===1){const i=[];r.Tu.forEach(((o,l)=>{const d=l.view.va(e);d.snapshot&&i.push(d.snapshot)})),(function(l,d){const h=tt(l);h.onlineState=d;let m=!1;h.queries.forEach(((p,g)=>{for(const v of g.Sa)v.va(d)&&(m=!0)})),m&&S0(h)})(r.eventManager,e),i.length&&r.Pu.H_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function WN(t,e,n){const r=tt(t);r.sharedClientState.updateQueryState(e,"rejected",n);const i=r.Au.get(e),o=i&&i.key;if(o){let l=new Zt(Ge.comparator);l=l.insert(o,Zn.newNoDocument(o,Ze.min()));const d=mt().add(o),h=new em(Ze.min(),new Map,new Zt(ft),l,d);await WC(r,h),r.du=r.du.remove(o),r.Au.delete(e),C0(r)}else await Sy(r.localStore,e,!1).then((()=>Ty(r,e,n))).catch(lc)}async function KN(t,e){const n=tt(t),r=e.batch.batchId;try{const i=await iN(n.localStore,e);YC(n,r,null),KC(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await sd(n,i)}catch(i){await lc(i)}}async function YN(t,e,n){const r=tt(t);try{const i=await(function(l,d){const h=tt(l);return h.persistence.runTransaction("Reject batch","readwrite-primary",(m=>{let p;return h.mutationQueue.lookupMutationBatch(m,d).next((g=>(jt(g!==null,37113),p=g.keys(),h.mutationQueue.removeMutationBatch(m,g)))).next((()=>h.mutationQueue.performConsistencyCheck(m))).next((()=>h.documentOverlayCache.removeOverlaysForBatchId(m,p,d))).next((()=>h.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(m,p))).next((()=>h.localDocuments.getDocuments(m,p)))}))})(r.localStore,e);YC(r,e,n),KC(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),await sd(r,i)}catch(i){await lc(i)}}function KC(t,e){(t.mu.get(e)||[]).forEach((n=>{n.resolve()})),t.mu.delete(e)}function YC(t,e,n){const r=tt(t);let i=r.Vu[r.currentUser.toKey()];if(i){const o=i.get(e);o&&(n?o.reject(n):o.resolve(),i=i.remove(e)),r.Vu[r.currentUser.toKey()]=i}}function Ty(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.Iu.get(e))t.Tu.delete(r),n&&t.Pu.yu(r,n);t.Iu.delete(e),t.isPrimaryClient&&t.Ru.jr(e).forEach((r=>{t.Ru.containsKey(r)||XC(t,r)}))}function XC(t,e){t.Eu.delete(e.path.canonicalString());const n=t.du.get(e);n!==null&&(y0(t.remoteStore,n),t.du=t.du.remove(e),t.Au.delete(n),C0(t))}function p1(t,e,n){for(const r of n)r instanceof HC?(t.Ru.addReference(r.key,e),XN(t,r)):r instanceof GC?(ze(E0,"Document no longer in limbo: "+r.key),t.Ru.removeReference(r.key,e),t.Ru.containsKey(r.key)||XC(t,r.key)):Ke(19791,{wu:r})}function XN(t,e){const n=e.key,r=n.path.canonicalString();t.du.get(n)||t.Eu.has(r)||(ze(E0,"New document in limbo: "+n),t.Eu.add(r),C0(t))}function C0(t){for(;t.Eu.size>0&&t.du.size<t.maxConcurrentLimboResolutions;){const e=t.Eu.values().next().value;t.Eu.delete(e);const n=new Ge(Ut.fromString(e)),r=t.fu.next();t.Au.set(r,new UN(n)),t.du=t.du.insert(n,r),PC(t.remoteStore,new da(Us(l0(n.path)),r,"TargetPurposeLimboResolution",Gf.ce))}}async function sd(t,e,n){const r=tt(t),i=[],o=[],l=[];r.Tu.isEmpty()||(r.Tu.forEach(((d,h)=>{l.push(r.pu(h,e,n).then((m=>{if((m||n)&&r.isPrimaryClient){const p=m?!m.fromCache:n?.targetChanges.get(h.targetId)?.current;r.sharedClientState.updateQueryState(h.targetId,p?"current":"not-current")}if(m){i.push(m);const p=p0.As(h.targetId,m);o.push(p)}})))})),await Promise.all(l),r.Pu.H_(i),await(async function(h,m){const p=tt(h);try{await p.persistence.runTransaction("notifyLocalViewChanges","readwrite",(g=>Ie.forEach(m,(v=>Ie.forEach(v.Es,(b=>p.persistence.referenceDelegate.addReference(g,v.targetId,b))).next((()=>Ie.forEach(v.ds,(b=>p.persistence.referenceDelegate.removeReference(g,v.targetId,b)))))))))}catch(g){if(!cc(g))throw g;ze(g0,"Failed to update sequence numbers: "+g)}for(const g of m){const v=g.targetId;if(!g.fromCache){const b=p.Ms.get(v),E=b.snapshotVersion,x=b.withLastLimboFreeSnapshotVersion(E);p.Ms=p.Ms.insert(v,x)}}})(r.localStore,o))}async function ZN(t,e){const n=tt(t);if(!n.currentUser.isEqual(e)){ze(E0,"User change. New user:",e.toKey());const r=await DC(n.localStore,e);n.currentUser=e,(function(o,l){o.mu.forEach((d=>{d.forEach((h=>{h.reject(new Pe(je.CANCELLED,l))}))})),o.mu.clear()})(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await sd(n,r.Ls)}}function JN(t,e){const n=tt(t),r=n.Au.get(e);if(r&&r.hu)return mt().add(r.key);{let i=mt();const o=n.Iu.get(e);if(!o)return i;for(const l of o){const d=n.Tu.get(l);i=i.unionWith(d.view.nu)}return i}}function ZC(t){const e=tt(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=WC.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=JN.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=WN.bind(null,e),e.Pu.H_=PN.bind(null,e.eventManager),e.Pu.yu=BN.bind(null,e.eventManager),e}function e6(t){const e=tt(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=KN.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=YN.bind(null,e),e}class Ef{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=tm(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,n){return null}Mu(e,n){return null}vu(e){return sN(this.persistence,new tN,e.initialUser,this.serializer)}Cu(e){return new kC(m0.mi,this.serializer)}Du(e){return new dN}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Ef.provider={build:()=>new Ef};class t6 extends Ef{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,n){jt(this.persistence.referenceDelegate instanceof wf,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new UO(r,e.asyncQueue,n)}Cu(e){const n=this.cacheSizeBytes!==void 0?hr.withCacheSize(this.cacheSizeBytes):hr.DEFAULT;return new kC((r=>wf.mi(r,n)),this.serializer)}}class Ay{async initialize(e,n){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>m1(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=ZN.bind(null,this.syncEngine),await MN(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new NN})()}createDatastore(e){const n=tm(e.databaseInfo.databaseId),r=(function(o){return new gN(o)})(e.databaseInfo);return(function(o,l,d,h){return new vN(o,l,d,h)})(e.authCredentials,e.appCheckCredentials,r,n)}createRemoteStore(e){return(function(r,i,o,l,d){return new wN(r,i,o,l,d)})(this.localStore,this.datastore,e.asyncQueue,(n=>m1(this.syncEngine,n,0)),(function(){return l1.v()?new l1:new hN})())}createSyncEngine(e,n){return(function(i,o,l,d,h,m,p){const g=new FN(i,o,l,d,h,m);return p&&(g.gu=!0),g})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,n)}async terminate(){await(async function(n){const r=tt(n);ze(Ro,"RemoteStore shutting down."),r.Ea.add(5),await rd(r),r.Aa.shutdown(),r.Ra.set("Unknown")})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}Ay.provider={build:()=>new Ay};class JC{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):bi("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,n){setTimeout((()=>{this.muted||e(n)}),0)}}const Ta="FirestoreClient";class n6{constructor(e,n,r,i,o){this.authCredentials=e,this.appCheckCredentials=n,this.asyncQueue=r,this.databaseInfo=i,this.user=Xn.UNAUTHENTICATED,this.clientId=n0.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=o,this.authCredentials.start(r,(async l=>{ze(Ta,"Received user=",l.uid),await this.authCredentialListener(l),this.user=l})),this.appCheckCredentials.start(r,(l=>(ze(Ta,"Received new app check token=",l),this.appCheckCredentialListener(l,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new mi;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){const r=w0(n,"Failed to shutdown persistence");e.reject(r)}})),e.promise}}async function Lg(t,e){t.asyncQueue.verifyOperationInProgress(),ze(Ta,"Initializing OfflineComponentProvider");const n=t.configuration;await e.initialize(n);let r=n.initialUser;t.setCredentialChangeListener((async i=>{r.isEqual(i)||(await DC(e.localStore,i),r=i)})),e.persistence.setDatabaseDeletedListener((()=>t.terminate())),t._offlineComponents=e}async function g1(t,e){t.asyncQueue.verifyOperationInProgress();const n=await r6(t);ze(Ta,"Initializing OnlineComponentProvider"),await e.initialize(n,t.configuration),t.setCredentialChangeListener((r=>u1(e.remoteStore,r))),t.setAppCheckTokenChangeListener(((r,i)=>u1(e.remoteStore,i))),t._onlineComponents=e}async function r6(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){ze(Ta,"Using user provided OfflineComponentProvider");try{await Lg(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!(function(i){return i.name==="FirebaseError"?i.code===je.FAILED_PRECONDITION||i.code===je.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11})(n))throw n;$l("Error using user provided cache. Falling back to memory cache: "+n),await Lg(t,new Ef)}}else ze(Ta,"Using default OfflineComponentProvider"),await Lg(t,new t6(void 0));return t._offlineComponents}async function eT(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(ze(Ta,"Using user provided OnlineComponentProvider"),await g1(t,t._uninitializedComponentsProvider._online)):(ze(Ta,"Using default OnlineComponentProvider"),await g1(t,new Ay))),t._onlineComponents}function s6(t){return eT(t).then((e=>e.syncEngine))}async function tT(t){const e=await eT(t),n=e.eventManager;return n.onListen=VN.bind(null,e.syncEngine),n.onUnlisten=HN.bind(null,e.syncEngine),n.onFirstRemoteStoreListen=$N.bind(null,e.syncEngine),n.onLastRemoteStoreUnlisten=GN.bind(null,e.syncEngine),n}function i6(t,e,n={}){const r=new mi;return t.asyncQueue.enqueueAndForget((async()=>(function(o,l,d,h,m){const p=new JC({next:v=>{p.Nu(),l.enqueueAndForget((()=>$C(o,g)));const b=v.docs.has(d);!b&&v.fromCache?m.reject(new Pe(je.UNAVAILABLE,"Failed to get document because the client is offline.")):b&&v.fromCache&&h&&h.source==="server"?m.reject(new Pe(je.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):m.resolve(v)},error:v=>m.reject(v)}),g=new qC(l0(d.path),p,{includeMetadataChanges:!0,qa:!0});return VC(o,g)})(await tT(t),t.asyncQueue,e,n,r))),r.promise}function a6(t,e,n={}){const r=new mi;return t.asyncQueue.enqueueAndForget((async()=>(function(o,l,d,h,m){const p=new JC({next:v=>{p.Nu(),l.enqueueAndForget((()=>$C(o,g))),v.fromCache&&h.source==="server"?m.reject(new Pe(je.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):m.resolve(v)},error:v=>m.reject(v)}),g=new qC(d,p,{includeMetadataChanges:!0,qa:!0});return VC(o,g)})(await tT(t),t.asyncQueue,e,n,r))),r.promise}function nT(t){const e={};return t.timeoutSeconds!==void 0&&(e.timeoutSeconds=t.timeoutSeconds),e}const y1=new Map;const rT="firestore.googleapis.com",_1=!0;class b1{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new Pe(je.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=rT,this.ssl=_1}else this.host=e.host,this.ssl=e.ssl??_1;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=IC;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<zO)throw new Pe(je.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}wM("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=nT(e.experimentalLongPollingOptions??{}),(function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new Pe(je.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new Pe(je.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new Pe(je.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(r,i){return r.timeoutSeconds===i.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class sm{constructor(e,n,r,i){this._authCredentials=e,this._appCheckCredentials=n,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new b1({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Pe(je.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new Pe(je.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new b1(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(r){if(!r)return new hM;switch(r.type){case"firstParty":return new gM(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new Pe(je.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(n){const r=y1.get(n);r&&(ze("ComponentProvider","Removing Datastore"),y1.delete(n),r.terminate())})(this),Promise.resolve()}}function o6(t,e,n,r={}){t=us(t,sm);const i=nc(e),o=t._getSettings(),l={...o,emulatorOptions:t._getEmulatorOptions()},d=`${e}:${n}`;i&&(GS(`https://${d}`),QS("Firestore",!0)),o.host!==rT&&o.host!==d&&$l("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const h={...o,host:d,ssl:i,emulatorOptions:r};if(!gi(h,l)&&(t._setSettings(h),r.mockUserToken)){let m,p;if(typeof r.mockUserToken=="string")m=r.mockUserToken,p=Xn.MOCK_USER;else{m=vR(r.mockUserToken,t._app?.options.projectId);const g=r.mockUserToken.sub||r.mockUserToken.user_id;if(!g)throw new Pe(je.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");p=new Xn(g)}t._authCredentials=new fM(new FE(m,p))}}class dc{constructor(e,n,r){this.converter=n,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new dc(this.firestore,e,this._query)}}class cn{constructor(e,n,r){this.converter=n,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new va(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new cn(this.firestore,e,this._key)}toJSON(){return{type:cn._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,n,r){if(Ju(n,cn._jsonSchema))return new cn(e,r||null,new Ge(Ut.fromString(n.referencePath)))}}cn._jsonSchemaVersion="firestore/documentReference/1.0",cn._jsonSchema={type:bn("string",cn._jsonSchemaVersion),referencePath:bn("string")};class va extends dc{constructor(e,n,r){super(e,n,l0(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new cn(this.firestore,null,new Ge(e))}withConverter(e){return new va(this.firestore,e,this._path)}}function l6(t,e,...n){if(t=vn(t),VE("collection","path",e),t instanceof sm){const r=Ut.fromString(e,...n);return Dw(r),new va(t,null,r)}{if(!(t instanceof cn||t instanceof va))throw new Pe(je.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(Ut.fromString(e,...n));return Dw(r),new va(t.firestore,null,r)}}function hc(t,e,...n){if(t=vn(t),arguments.length===1&&(e=n0.newId()),VE("doc","path",e),t instanceof sm){const r=Ut.fromString(e,...n);return kw(r),new cn(t,null,new Ge(r))}{if(!(t instanceof cn||t instanceof va))throw new Pe(je.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(Ut.fromString(e,...n));return kw(r),new cn(t.firestore,t instanceof va?t.converter:null,new Ge(r))}}const v1="AsyncQueue";class x1{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new OC(this,"async_queue_retry"),this._c=()=>{const r=zg();r&&ze(v1,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=e;const n=zg();n&&typeof n.addEventListener=="function"&&n.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const n=zg();n&&typeof n.removeEventListener=="function"&&n.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise((()=>{}));const n=new mi;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(e().then(n.resolve,n.reject),n.promise))).then((()=>n.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Xu.push(e),this.lc())))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!cc(e))throw e;ze(v1,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_((()=>this.lc()))}}cc(e){const n=this.ac.then((()=>(this.rc=!0,e().catch((r=>{throw this.nc=r,this.rc=!1,bi("INTERNAL UNHANDLED ERROR: ",w1(r)),r})).then((r=>(this.rc=!1,r))))));return this.ac=n,n}enqueueAfterDelay(e,n,r){this.uc(),this.oc.indexOf(e)>-1&&(n=0);const i=x0.createAndSchedule(this,e,n,r,(o=>this.hc(o)));return this.tc.push(i),i}uc(){this.nc&&Ke(47125,{Pc:w1(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const n of this.tc)if(n.timerId===e)return!0;return!1}Ec(e){return this.Tc().then((()=>{this.tc.sort(((n,r)=>n.targetTimeMs-r.targetTimeMs));for(const n of this.tc)if(n.skipDelay(),e!=="all"&&n.timerId===e)break;return this.Tc()}))}dc(e){this.oc.push(e)}hc(e){const n=this.tc.indexOf(e);this.tc.splice(n,1)}}function w1(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+`
`+t.stack),e}class No extends sm{constructor(e,n,r,i){super(e,n,r,i),this.type="firestore",this._queue=new x1,this._persistenceKey=i?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new x1(e),this._firestoreClient=void 0,await e}}}function c6(t,e){const n=typeof t=="object"?t:XS(),r=typeof t=="string"?t:pf,i=Gy(n,"firestore").getImmediate({identifier:r});if(!i._initialized){const o=_R("firestore");o&&o6(i,...o)}return i}function im(t){if(t._terminated)throw new Pe(je.FAILED_PRECONDITION,"The client has already been terminated.");return t._firestoreClient||u6(t),t._firestoreClient}function u6(t){const e=t._freezeSettings(),n=(function(i,o,l,d){return new MM(i,o,l,d.host,d.ssl,d.experimentalForceLongPolling,d.experimentalAutoDetectLongPolling,nT(d.experimentalLongPollingOptions),d.useFetchStreams,d.isUsingEmulator)})(t._databaseId,t._app?.options.appId||"",t._persistenceKey,e);t._componentsProvider||e.localCache?._offlineComponentProvider&&e.localCache?._onlineComponentProvider&&(t._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),t._firestoreClient=new n6(t._authCredentials,t._appCheckCredentials,t._queue,n,t._componentsProvider&&(function(i){const o=i?._online.build();return{_offline:i?._offline.build(o),_online:o}})(t._componentsProvider))}class qr{constructor(e){this._byteString=e}static fromBase64String(e){try{return new qr($n.fromBase64String(e))}catch(n){throw new Pe(je.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+n)}}static fromUint8Array(e){return new qr($n.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:qr._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(Ju(e,qr._jsonSchema))return qr.fromBase64String(e.bytes)}}qr._jsonSchemaVersion="firestore/bytes/1.0",qr._jsonSchema={type:bn("string",qr._jsonSchemaVersion),bytes:bn("string")};class id{constructor(...e){for(let n=0;n<e.length;++n)if(e[n].length===0)throw new Pe(je.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Fn(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class ad{constructor(e){this._methodName=e}}class Vs{constructor(e,n){if(!isFinite(e)||e<-90||e>90)throw new Pe(je.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(n)||n<-180||n>180)throw new Pe(je.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=e,this._long=n}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return ft(this._lat,e._lat)||ft(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Vs._jsonSchemaVersion}}static fromJSON(e){if(Ju(e,Vs._jsonSchema))return new Vs(e.latitude,e.longitude)}}Vs._jsonSchemaVersion="firestore/geoPoint/1.0",Vs._jsonSchema={type:bn("string",Vs._jsonSchemaVersion),latitude:bn("number"),longitude:bn("number")};class $s{constructor(e){this._values=(e||[]).map((n=>n))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(r,i){if(r.length!==i.length)return!1;for(let o=0;o<r.length;++o)if(r[o]!==i[o])return!1;return!0})(this._values,e._values)}toJSON(){return{type:$s._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(Ju(e,$s._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every((n=>typeof n=="number")))return new $s(e.vectorValues);throw new Pe(je.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}$s._jsonSchemaVersion="firestore/vectorValue/1.0",$s._jsonSchema={type:bn("string",$s._jsonSchemaVersion),vectorValues:bn("object")};const d6=/^__.*__$/;class h6{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return this.fieldMask!==null?new Oa(e,this.data,this.fieldMask,n,this.fieldTransforms):new td(e,this.data,n,this.fieldTransforms)}}class sT{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return new Oa(e,this.data,this.fieldMask,n,this.fieldTransforms)}}function iT(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Ke(40011,{Ac:t})}}class am{constructor(e,n,r,i,o,l){this.settings=e,this.databaseId=n,this.serializer=r,this.ignoreUndefinedProperties=i,o===void 0&&this.Rc(),this.fieldTransforms=o||[],this.fieldMask=l||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new am({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){const n=this.path?.child(e),r=this.Vc({path:n,fc:!1});return r.gc(e),r}yc(e){const n=this.path?.child(e),r=this.Vc({path:n,fc:!1});return r.Rc(),r}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return Cf(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find((n=>e.isPrefixOf(n)))!==void 0||this.fieldTransforms.find((n=>e.isPrefixOf(n.field)))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(iT(this.Ac)&&d6.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class f6{constructor(e,n,r){this.databaseId=e,this.ignoreUndefinedProperties=n,this.serializer=r||tm(e)}Cc(e,n,r,i=!1){return new am({Ac:e,methodName:n,Dc:r,path:Fn.emptyPath(),fc:!1,bc:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function om(t){const e=t._freezeSettings(),n=tm(t._databaseId);return new f6(t._databaseId,!!e.ignoreUndefinedProperties,n)}function aT(t,e,n,r,i,o={}){const l=t.Cc(o.merge||o.mergeFields?2:0,e,n,i);j0("Data must be an object, but it was:",l,r);const d=uT(r,l);let h,m;if(o.merge)h=new Tr(l.fieldMask),m=l.fieldTransforms;else if(o.mergeFields){const p=[];for(const g of o.mergeFields){const v=jy(e,g,n);if(!l.contains(v))throw new Pe(je.INVALID_ARGUMENT,`Field '${v}' is specified in your field mask but missing from your input data.`);hT(p,v)||p.push(v)}h=new Tr(p),m=l.fieldTransforms.filter((g=>h.covers(g.field)))}else h=null,m=l.fieldTransforms;return new h6(new fr(d),h,m)}class lm extends ad{_toFieldTransform(e){if(e.Ac!==2)throw e.Ac===1?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof lm}}function oT(t,e,n){return new am({Ac:3,Dc:e.settings.Dc,methodName:t._methodName,fc:n},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class T0 extends ad{constructor(e,n){super(e),this.vc=n}_toFieldTransform(e){const n=oT(this,e,!0),r=this.vc.map((o=>Po(o,n))),i=new Ql(r);return new yC(e.path,i)}isEqual(e){return e instanceof T0&&gi(this.vc,e.vc)}}class A0 extends ad{constructor(e,n){super(e),this.vc=n}_toFieldTransform(e){const n=oT(this,e,!0),r=this.vc.map((o=>Po(o,n))),i=new Wl(r);return new yC(e.path,i)}isEqual(e){return e instanceof A0&&gi(this.vc,e.vc)}}function lT(t,e,n,r){const i=t.Cc(1,e,n);j0("Data must be an object, but it was:",i,r);const o=[],l=fr.empty();Ma(r,((h,m)=>{const p=R0(e,h,n);m=vn(m);const g=i.yc(p);if(m instanceof lm)o.push(p);else{const v=Po(m,g);v!=null&&(o.push(p),l.set(p,v))}}));const d=new Tr(o);return new sT(l,d,i.fieldTransforms)}function cT(t,e,n,r,i,o){const l=t.Cc(1,e,n),d=[jy(e,r,n)],h=[i];if(o.length%2!=0)throw new Pe(je.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let v=0;v<o.length;v+=2)d.push(jy(e,o[v])),h.push(o[v+1]);const m=[],p=fr.empty();for(let v=d.length-1;v>=0;--v)if(!hT(m,d[v])){const b=d[v];let E=h[v];E=vn(E);const x=l.yc(b);if(E instanceof lm)m.push(b);else{const S=Po(E,x);S!=null&&(m.push(b),p.set(b,S))}}const g=new Tr(m);return new sT(p,g,l.fieldTransforms)}function m6(t,e,n,r=!1){return Po(n,t.Cc(r?4:3,e))}function Po(t,e){if(dT(t=vn(t)))return j0("Unsupported field value:",e,t),uT(t,e);if(t instanceof ad)return(function(r,i){if(!iT(i.Ac))throw i.Sc(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Sc(`${r._methodName}() is not currently supported inside arrays`);const o=r._toFieldTransform(i);o&&i.fieldTransforms.push(o)})(t,e),null;if(t===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return(function(r,i){const o=[];let l=0;for(const d of r){let h=Po(d,i.wc(l));h==null&&(h={nullValue:"NULL_VALUE"}),o.push(h),l++}return{arrayValue:{values:o}}})(t,e)}return(function(r,i){if((r=vn(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return nO(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const o=Ht.fromDate(r);return{timestampValue:xf(i.serializer,o)}}if(r instanceof Ht){const o=new Ht(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:xf(i.serializer,o)}}if(r instanceof Vs)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof qr)return{bytesValue:SC(i.serializer,r._byteString)};if(r instanceof cn){const o=i.databaseId,l=r.firestore._databaseId;if(!l.isEqual(o))throw i.Sc(`Document reference is for database ${l.projectId}/${l.database} but should be for database ${o.projectId}/${o.database}`);return{referenceValue:h0(r.firestore._databaseId||i.databaseId,r._key.path)}}if(r instanceof $s)return(function(l,d){return{mapValue:{fields:{[XE]:{stringValue:ZE},[gf]:{arrayValue:{values:l.toArray().map((m=>{if(typeof m!="number")throw d.Sc("VectorValues must only contain numeric values.");return c0(d.serializer,m)}))}}}}}})(r,i);throw i.Sc(`Unsupported field value: ${Hf(r)}`)})(t,e)}function uT(t,e){const n={};return HE(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Ma(t,((r,i)=>{const o=Po(i,e.mc(r));o!=null&&(n[r]=o)})),{mapValue:{fields:n}}}function dT(t){return!(typeof t!="object"||t===null||t instanceof Array||t instanceof Date||t instanceof Ht||t instanceof Vs||t instanceof qr||t instanceof cn||t instanceof ad||t instanceof $s)}function j0(t,e,n){if(!dT(n)||!$E(n)){const r=Hf(n);throw r==="an object"?e.Sc(t+" a custom object"):e.Sc(t+" "+r)}}function jy(t,e,n){if((e=vn(e))instanceof id)return e._internalPath;if(typeof e=="string")return R0(t,e);throw Cf("Field path arguments must be of type string or ",t,!1,void 0,n)}const p6=new RegExp("[~\\*/\\[\\]]");function R0(t,e,n){if(e.search(p6)>=0)throw Cf(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new id(...e.split("."))._internalPath}catch{throw Cf(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function Cf(t,e,n,r,i){const o=r&&!r.isEmpty(),l=i!==void 0;let d=`Function ${e}() called with invalid data`;n&&(d+=" (via `toFirestore()`)"),d+=". ";let h="";return(o||l)&&(h+=" (found",o&&(h+=` in field ${r}`),l&&(h+=` in document ${i}`),h+=")"),new Pe(je.INVALID_ARGUMENT,d+t+h)}function hT(t,e){return t.some((n=>n.isEqual(e)))}class fT{constructor(e,n,r,i,o){this._firestore=e,this._userDataWriter=n,this._key=r,this._document=i,this._converter=o}get id(){return this._key.path.lastSegment()}get ref(){return new cn(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new g6(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const n=this._document.data.field(I0("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n)}}}class g6 extends fT{data(){return super.data()}}function I0(t,e){return typeof e=="string"?R0(t,e):e instanceof id?e._internalPath:e._delegate._internalPath}function y6(t){if(t.limitType==="L"&&t.explicitOrderBy.length===0)throw new Pe(je.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class k0{}class _6 extends k0{}function b6(t,e,...n){let r=[];e instanceof k0&&r.push(e),r=r.concat(n),(function(o){const l=o.filter((h=>h instanceof D0)).length,d=o.filter((h=>h instanceof cm)).length;if(l>1||l>0&&d>0)throw new Pe(je.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")})(r);for(const i of r)t=i._apply(t);return t}class cm extends _6{constructor(e,n,r){super(),this._field=e,this._op=n,this._value=r,this.type="where"}static _create(e,n,r){return new cm(e,n,r)}_apply(e){const n=this._parse(e);return mT(e._query,n),new dc(e.firestore,e.converter,yy(e._query,n))}_parse(e){const n=om(e.firestore);return(function(o,l,d,h,m,p,g){let v;if(m.isKeyField()){if(p==="array-contains"||p==="array-contains-any")throw new Pe(je.INVALID_ARGUMENT,`Invalid Query. You can't perform '${p}' queries on documentId().`);if(p==="in"||p==="not-in"){E1(g,p);const E=[];for(const x of g)E.push(S1(h,o,x));v={arrayValue:{values:E}}}else v=S1(h,o,g)}else p!=="in"&&p!=="not-in"&&p!=="array-contains-any"||E1(g,p),v=m6(d,l,g,p==="in"||p==="not-in");return _n.create(m,p,v)})(e._query,"where",n,e.firestore._databaseId,this._field,this._op,this._value)}}function v6(t,e,n){const r=e,i=I0("where",t);return cm._create(i,r,n)}class D0 extends k0{constructor(e,n){super(),this.type=e,this._queryConstraints=n}static _create(e,n){return new D0(e,n)}_parse(e){const n=this._queryConstraints.map((r=>r._parse(e))).filter((r=>r.getFilters().length>0));return n.length===1?n[0]:ds.create(n,this._getOperator())}_apply(e){const n=this._parse(e);return n.getFilters().length===0?e:((function(i,o){let l=i;const d=o.getFlattenedFilters();for(const h of d)mT(l,h),l=yy(l,h)})(e._query,n),new dc(e.firestore,e.converter,yy(e._query,n)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function S1(t,e,n){if(typeof(n=vn(n))=="string"){if(n==="")throw new Pe(je.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!aC(e)&&n.indexOf("/")!==-1)throw new Pe(je.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=e.path.child(Ut.fromString(n));if(!Ge.isDocumentKey(r))throw new Pe(je.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Uw(t,new Ge(r))}if(n instanceof cn)return Uw(t,n._key);throw new Pe(je.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Hf(n)}.`)}function E1(t,e){if(!Array.isArray(t)||t.length===0)throw new Pe(je.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function mT(t,e){const n=(function(i,o){for(const l of i)for(const d of l.getFlattenedFilters())if(o.indexOf(d.op)>=0)return d.op;return null})(t.filters,(function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(e.op));if(n!==null)throw n===e.op?new Pe(je.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new Pe(je.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}class x6{convertValue(e,n="none"){switch(Ea(e)){case 0:return null;case 1:return e.booleanValue;case 2:return on(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,n);case 5:return e.stringValue;case 6:return this.convertBytes(Sa(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,n);case 11:return this.convertObject(e.mapValue,n);case 10:return this.convertVectorValue(e.mapValue);default:throw Ke(62114,{value:e})}}convertObject(e,n){return this.convertObjectMap(e.fields,n)}convertObjectMap(e,n="none"){const r={};return Ma(e,((i,o)=>{r[i]=this.convertValue(o,n)})),r}convertVectorValue(e){const n=e.fields?.[gf].arrayValue?.values?.map((r=>on(r.doubleValue)));return new $s(n)}convertGeoPoint(e){return new Vs(on(e.latitude),on(e.longitude))}convertArray(e,n){return(e.values||[]).map((r=>this.convertValue(r,n)))}convertServerTimestamp(e,n){switch(n){case"previous":const r=Wf(e);return r==null?null:this.convertValue(r,n);case"estimate":return this.convertTimestamp(Pu(e));default:return null}}convertTimestamp(e){const n=wa(e);return new Ht(n.seconds,n.nanos)}convertDocumentKey(e,n){const r=Ut.fromString(e);jt(RC(r),9688,{name:e});const i=new Bu(r.get(1),r.get(3)),o=new Ge(r.popFirst(5));return i.isEqual(n)||bi(`Document ${o} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${n.projectId}/${n.database}) instead.`),o}}function pT(t,e,n){let r;return r=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,r}class Su{constructor(e,n){this.hasPendingWrites=e,this.fromCache=n}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class So extends fT{constructor(e,n,r,i,o,l){super(e,n,r,i,l),this._firestore=e,this._firestoreImpl=e,this.metadata=o}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const n=new tf(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(n,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,n={}){if(this._document){const r=this._document.data.field(I0("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,n.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new Pe(je.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,n={};return n.type=So._jsonSchemaVersion,n.bundle="",n.bundleSource="DocumentSnapshot",n.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?n:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),n.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),n)}}So._jsonSchemaVersion="firestore/documentSnapshot/1.0",So._jsonSchema={type:bn("string",So._jsonSchemaVersion),bundleSource:bn("string","DocumentSnapshot"),bundleName:bn("string"),bundle:bn("string")};class tf extends So{data(e={}){return super.data(e)}}class Ll{constructor(e,n,r,i){this._firestore=e,this._userDataWriter=n,this._snapshot=i,this.metadata=new Su(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){const e=[];return this.forEach((n=>e.push(n))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,n){this._snapshot.docs.forEach((r=>{e.call(n,new tf(this._firestore,this._userDataWriter,r.key,r,new Su(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const n=!!e.includeMetadataChanges;if(n&&this._snapshot.excludesMetadataChanges)throw new Pe(je.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===n||(this._cachedChanges=(function(i,o){if(i._snapshot.oldDocs.isEmpty()){let l=0;return i._snapshot.docChanges.map((d=>{const h=new tf(i._firestore,i._userDataWriter,d.doc.key,d.doc,new Su(i._snapshot.mutatedKeys.has(d.doc.key),i._snapshot.fromCache),i.query.converter);return d.doc,{type:"added",doc:h,oldIndex:-1,newIndex:l++}}))}{let l=i._snapshot.oldDocs;return i._snapshot.docChanges.filter((d=>o||d.type!==3)).map((d=>{const h=new tf(i._firestore,i._userDataWriter,d.doc.key,d.doc,new Su(i._snapshot.mutatedKeys.has(d.doc.key),i._snapshot.fromCache),i.query.converter);let m=-1,p=-1;return d.type!==0&&(m=l.indexOf(d.doc.key),l=l.delete(d.doc.key)),d.type!==1&&(l=l.add(d.doc),p=l.indexOf(d.doc.key)),{type:w6(d.type),doc:h,oldIndex:m,newIndex:p}}))}})(this,n),this._cachedChangesIncludeMetadataChanges=n),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new Pe(je.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=Ll._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=n0.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const n=[],r=[],i=[];return this.docs.forEach((o=>{o._document!==null&&(n.push(o._document),r.push(this._userDataWriter.convertObjectMap(o._document.data.value.mapValue.fields,"previous")),i.push(o.ref.path))})),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function w6(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Ke(61501,{type:t})}}function S6(t){t=us(t,cn);const e=us(t.firestore,No);return i6(im(e),t._key).then((n=>j6(e,t,n)))}Ll._jsonSchemaVersion="firestore/querySnapshot/1.0",Ll._jsonSchema={type:bn("string",Ll._jsonSchemaVersion),bundleSource:bn("string","QuerySnapshot"),bundleName:bn("string"),bundle:bn("string")};class gT extends x6{constructor(e){super(),this.firestore=e}convertBytes(e){return new qr(e)}convertReference(e){const n=this.convertDocumentKey(e,this.firestore._databaseId);return new cn(this.firestore,null,n)}}function E6(t){t=us(t,dc);const e=us(t.firestore,No),n=im(e),r=new gT(e);return y6(t._query),a6(n,t._query).then((i=>new Ll(e,r,t,i)))}function C6(t,e,n){t=us(t,cn);const r=us(t.firestore,No),i=pT(t.converter,e,n);return um(r,[aT(om(r),"setDoc",t._key,i,t.converter!==null,n).toMutation(t._key,pr.none())])}function T6(t,e,n,...r){t=us(t,cn);const i=us(t.firestore,No),o=om(i);let l;return l=typeof(e=vn(e))=="string"||e instanceof id?cT(o,"updateDoc",t._key,e,n,r):lT(o,"updateDoc",t._key,e),um(i,[l.toMutation(t._key,pr.exists(!0))])}function A6(t){return um(us(t.firestore,No),[new Jf(t._key,pr.none())])}function um(t,e){return(function(r,i){const o=new mi;return r.asyncQueue.enqueueAndForget((async()=>QN(await s6(r),i,o))),o.promise})(im(t),e)}function j6(t,e,n){const r=n.docs.get(e._key),i=new gT(t);return new So(t,i,e._key,r,new Su(n.hasPendingWrites,n.fromCache),e.converter)}class R6{constructor(e,n){this._firestore=e,this._commitHandler=n,this._mutations=[],this._committed=!1,this._dataReader=om(e)}set(e,n,r){this._verifyNotCommitted();const i=Ug(e,this._firestore),o=pT(i.converter,n,r),l=aT(this._dataReader,"WriteBatch.set",i._key,o,i.converter!==null,r);return this._mutations.push(l.toMutation(i._key,pr.none())),this}update(e,n,r,...i){this._verifyNotCommitted();const o=Ug(e,this._firestore);let l;return l=typeof(n=vn(n))=="string"||n instanceof id?cT(this._dataReader,"WriteBatch.update",o._key,n,r,i):lT(this._dataReader,"WriteBatch.update",o._key,n),this._mutations.push(l.toMutation(o._key,pr.exists(!0))),this}delete(e){this._verifyNotCommitted();const n=Ug(e,this._firestore);return this._mutations=this._mutations.concat(new Jf(n._key,pr.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new Pe(je.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Ug(t,e){if((t=vn(t)).firestore!==e)throw new Pe(je.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}function Lu(...t){return new T0("arrayUnion",t)}function C1(...t){return new A0("arrayRemove",t)}function yT(t){return im(t=us(t,No)),new R6(t,(e=>um(t,e)))}(function(e,n=!0){(function(i){oc=i})(rc),Fl(new To("firestore",((r,{instanceIdentifier:i,options:o})=>{const l=r.getProvider("app").getImmediate(),d=new No(new mM(r.getProvider("auth-internal")),new yM(l,r.getProvider("app-check-internal")),(function(m,p){if(!Object.prototype.hasOwnProperty.apply(m.options,["projectId"]))throw new Pe(je.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Bu(m.options.projectId,p)})(l,i),l);return o={useFetchStreams:n,...o},d._setSettings(o),d}),"PUBLIC").setMultipleInstances(!0)),ya(Aw,jw,e),ya(Aw,jw,"esm2020")})();function Bo(){return c6(ME)}const an={showGroupTotals:!1};function zo(t,e,n,r=1,i,o){let l=e;if(e.startsWith("budgets/"))l="budgets";else if(e.startsWith("months/")){const p=e.replace("months/","").split("_");if(p.length>=2){const g=p[p.length-1];l=`months/${p[p.length-2]}/${g}`}}console.log(`[Firebase] ${t}(${r}): ${l}${i===!1?" [NOT FOUND]":""}`)}async function At(t,e,n){const r=hc(Bo(),t,e),i=`${t}/${e}`,o=await S6(r),l=o.exists(),d=l?o.data():null;return zo("READ",i,n,1,l),{exists:l,data:d,ref:r}}async function Dn(t,e,n){const r=Bo(),i=l6(r,t);let o;if(n&&n.length>0){const m=n.map(p=>v6(p.field,p.op,p.value));o=b6(i,...m)}else o=i;const l=await E6(o),d=l.docs.map(m=>({id:m.id,data:m.data()}));let h=t;if(n&&n.length>0){const m=n.map(p=>`${p.field} ${p.op} ${JSON.stringify(p.value)}`).join(", ");h+=` WHERE ${m}`}return zo("QUERY",h,e,l.docs.length,void 0),{docs:d}}async function qn(t,e,n,r,i){const o=hc(Bo(),t,e),l=`${t}/${e}`;return zo("WRITE",l,r,1,void 0),C6(o,n,i??{})}async function dm(t,e){const r=Bo();for(let i=0;i<t.length;i+=500){const o=t.slice(i,i+500),l=yT(r);for(const{collectionPath:d,docId:h,data:m}of o){const p=hc(r,d,h);l.set(p,m)}zo("BATCH_WRITE",`${o.length} docs`,e,o.length,void 0);try{await l.commit()}catch(d){throw console.error(`[Firebase] BATCH_WRITE ERROR in ${e}:`,d),console.error("[Firebase] Failed batch details:",{batchIndex:Math.floor(i/500)+1,totalBatches:Math.ceil(t.length/500),docsInBatch:o.length,firstDoc:o[0]?`${o[0].collectionPath}/${o[0].docId}`:"none"}),d}}}async function Tf(t,e,n,r){const i=hc(Bo(),t,e),o=`${t}/${e}`;return zo("UPDATE",o,r,1,void 0),T6(i,n)}async function Ry(t,e,n){const r=hc(Bo(),t,e),i=`${t}/${e}`;return zo("DELETE",i),A6(r)}async function _T(t,e,n){const i=Bo();for(let o=0;o<t.length;o+=500){const l=t.slice(o,o+500),d=yT(i);for(const{collectionPath:h,docId:m}of l){const p=hc(i,h,m);d.delete(p)}zo("BATCH_DELETE",`${l.length} docs`,e,l.length),await d.commit(),n?.(o+l.length)}}const yo={mobile:640,tablet:768,wide:1200},I6=yo.mobile,Uu=["January","February","March","April","May","June","July","August","September","October","November","December"],Af=3,jf=3,Xt="ungrouped_accounts",ln="ungrouped_categories";function k6(t={}){const e={};return Object.entries(t).forEach(([n,r])=>{e[n]={nickname:r.nickname??"",description:r.description??"",balance:r.balance??0,account_group_id:r.account_group_id??Xt,sort_order:r.sort_order??0,is_income_account:r.is_income_account??!1,is_income_default:r.is_income_default??!1,is_outgo_account:r.is_outgo_account??!1,is_outgo_default:r.is_outgo_default??!1,on_budget:r.on_budget??!0,is_active:r.is_active??!0}}),e}function D6(t={}){const e={};return Object.entries(t).forEach(([n,r])=>{e[n]={name:r.name,sort_order:r.sort_order??0,expected_balance:r.expected_balance??"positive",on_budget:r.on_budget!==void 0?r.on_budget:null,is_active:r.is_active!==void 0?r.is_active:null}}),e[Xt]||(e[Xt]={name:"Ungrouped",sort_order:0,expected_balance:"positive",on_budget:null,is_active:null}),e}function M6(t={}){const e={};return Object.entries(t).forEach(([n,r])=>{e[n]={name:r.name,description:r.description,category_group_id:r.category_group_id??ln,sort_order:r.sort_order??0,default_monthly_amount:r.default_monthly_amount,default_monthly_type:r.default_monthly_type,balance:r.balance??0,is_hidden:r.is_hidden??!1}}),e}function O6(t=[]){const e=t.map(r=>({id:r.id,name:r.name,sort_order:r.sort_order??0}));return e.some(r=>r.id===ln)||e.push({id:ln,name:"Uncategorized",sort_order:0}),e.sort((r,i)=>r.sort_order-i.sort_order),e}function N6(t={}){const e={};return Object.entries(t).forEach(([n,r])=>{e[n]={needs_recalculation:r?.needs_recalculation??!1}}),e}async function M0(t){const{exists:e,data:n}=await At("budgets",t,"loading budget data (cache miss or stale)");if(!e||!n)throw new Error(`Budget ${t} not found`);const r=k6(n.accounts),i=D6(n.account_groups),o=M6(n.categories),l=O6(n.category_groups),d=n.total_available??0,h=N6(n.month_map),m=n.is_needs_recalculation??!1;return{budget:{id:t,name:n.name,user_ids:n.user_ids||[],accepted_user_ids:n.accepted_user_ids||[],owner_id:n.owner_id||n.user_ids?.[0]||"",owner_email:n.owner_email||"",accounts:r,account_groups:i,categories:o,category_groups:l,total_available:d,is_needs_recalculation:m,month_map:h},accounts:r,accountGroups:i,categories:o,categoryGroups:l,isNeedsRecalculation:m,monthMap:h}}function P6(t,e){const{initialDataLoadComplete:n}=Ye(),r=!!t&&e?.enabled!==!1&&n;return ko({queryKey:t?ke.budget(t):["budget","none"],queryFn:()=>M0(t),enabled:r,staleTime:ac})}function hs(t,e,n){const r=n.toString().padStart(2,"0");return`${t}_${e}_${r}`}function Xl(t,e){return e===1?{year:t-1,month:12}:{year:t,month:e-1}}function bT(t,e){return e===12?{year:t+1,month:1}:{year:t,month:e+1}}function vt(t,e){return`${t}${e.toString().padStart(2,"0")}`}function Iy(t){return new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit"})}function hm(t,e){const n=new Date,r=n.getFullYear(),i=n.getMonth()+1;if(t===r&&e===i){const o=n.getDate();return`${r}-${String(i).padStart(2,"0")}-${String(o).padStart(2,"0")}`}return`${t}-${String(e).padStart(2,"0")}-01`}function fm(t){const[e,n]=t.split("-").map(Number);return{year:e,month:n}}function Me(t){return Math.round((t+Number.EPSILON)*100)/100}function ct(t){if(t==null||isNaN(t))return!1;const e=t*100;return Math.abs(e-Math.round(e))>1e-9}function Aa(t){if(t==null)return t;if(Array.isArray(t))return t.map(e=>Aa(e));if(typeof t=="object"){const e={};for(const[n,r]of Object.entries(t))r!==void 0&&(e[n]=Aa(r));return e}return t}function B6(t,e,n,r){return{budget_id:e,year_month_ordinal:t.year_month_ordinal??vt(n,r),year:t.year??n,month:t.month??r,income:t.income||[],total_income:t.total_income??0,previous_month_income:t.previous_month_income??0,expenses:t.expenses||[],total_expenses:t.total_expenses??0,transfers:t.transfers||[],adjustments:t.adjustments||[],account_balances:t.account_balances||[],category_balances:t.category_balances||[],are_allocations_finalized:t.are_allocations_finalized??!1,created_at:t.created_at,updated_at:t.updated_at}}async function Gr(t,e,n,r){const i=hs(t,e,n);return(await Le.fetchQuery({queryKey:ke.month(t,e,n),queryFn:async()=>{const{exists:l,data:d}=await At("months",i,r?.description??`reading month ${e}/${n}`);return!l||!d?null:{month:B6(d,t,e,n)}},staleTime:ac}))?.month??null}async function z6(t,e,n){const r=vt(e,n);return(await Dn("months","getFutureMonths: querying months after specified month",[{field:"budget_id",op:"==",value:t},{field:"year_month_ordinal",op:">",value:r}])).docs.map(l=>({id:l.id,...l.data})).sort((l,d)=>l.year!==d.year?l.year-d.year:l.month-d.month)}function L6(t){const e={},n={};return t.category_balances&&t.category_balances.forEach(r=>{e[r.category_id]=r.end_balance}),t.account_balances&&t.account_balances.forEach(r=>{n[r.account_id]=r.end_balance}),{categoryEndBalances:e,accountEndBalances:n}}function U6(){const t=new Date,e=t.getFullYear(),n=t.getMonth()+1,r=[];for(let i=jf;i>0;i--){let o=e,l=n-i;for(;l<1;)l+=12,o-=1;r.push(vt(o,l))}r.push(vt(e,n));for(let i=1;i<=Af;i++){let o=e,l=n+i;for(;l>12;)l-=12,o+=1;r.push(vt(o,l))}return r}function F6(t,e){const n=ke.budget(t),r=Le.getQueryData(n);if(!r?.monthMap)return!1;for(const[i,o]of Object.entries(r.monthMap))if(i>=e&&!o.needs_recalculation)return!1;return!0}function V6(t,e,n){const r=ke.budget(t),i=Le.getQueryData(r);i&&Le.setQueryData(r,{...i,isNeedsRecalculation:!0,monthMap:n,budget:{...i.budget,is_needs_recalculation:!0,month_map:n}})}function $6(t,e,n){const r=ke.budget(t),i=Le.getQueryData(r);i&&Le.setQueryData(r,{...i,monthMap:e,budget:{...i.budget,month_map:e}})}function q6(t,e,n,r){const i=vt(e,n),o=ke.budget(t),l=Le.getQueryData(o);if(!l)return console.warn(`[removeMonthFromMap] Budget ${t} not found in cache`),{};const d=l.monthMap||{},{[i]:h,...m}=d,p=m;return Le.setQueryData(o,{...l,monthMap:p,budget:{...l.budget,month_map:p}}),r&&r({type:"budget",budgetId:t}),p}async function H6(t,e,n,r){const{bypassDateLimit:i=!1}={},o=new Date,l=o.getFullYear(),d=o.getMonth()+1,h=(e-l)*12+(n-d);if(!i&&h>Af){const R=`[createMonth] Refusing to create month ${e}/${n} - it's ${h} months in the future (max allowed: ${Af}). This likely indicates a bug in month navigation.`;throw console.error(R),new Error(R)}if(!i&&h<-jf){const R=`[createMonth] Refusing to create month ${e}/${n} - it's ${Math.abs(h)} months in the past (max allowed: ${jf}). Existing months can still be viewed, but new months cannot be created this far back.`;throw console.error(R),new Error(R)}const{exists:m,data:p}=await At("budgets",t,"validating budget exists before creating month");if(!m||!p){Le.removeQueries({queryKey:ke.budget(t)});const R=`[createMonth] Budget ${t} does not exist. It may have been deleted. Please refresh the page.`;throw console.error(R),new Error(R)}const g=o.toISOString(),v=hs(t,e,n);let b=0,E={},x={};if(n>1||e>new Date().getFullYear()-10){const{year:R,month:N}=Xl(e,n),V=hs(t,R,N);try{const{exists:H,data:j}=await At("months",V,"fetching previous month to create start balances for new month");if(H&&j){const B={budget_id:t,year_month_ordinal:j.year_month_ordinal??vt(R,N),year:j.year??R,month:j.month??N,income:j.income||[],total_income:j.total_income??0,previous_month_income:j.previous_month_income??0,expenses:j.expenses||[],total_expenses:j.total_expenses??0,transfers:j.transfers||[],adjustments:j.adjustments||[],account_balances:j.account_balances||[],category_balances:j.category_balances||[],are_allocations_finalized:j.are_allocations_finalized??!1,created_at:j.created_at,updated_at:j.updated_at};b=B.total_income;const{categoryEndBalances:M,accountEndBalances:Z}=L6(B);E=M,x=Z}}catch(H){if(H instanceof Error&&H.message.includes("Missing or insufficient permissions"))console.warn(`[createMonth] Permission error reading previous month ${R}/${N}, starting with zero balances`);else throw H}}const S=Object.entries(E).map(([R,N])=>({category_id:R,start_balance:N,allocated:0,spent:0,transfers:0,adjustments:0,end_balance:N})),C=Object.entries(x).map(([R,N])=>({account_id:R,start_balance:N,income:0,expenses:0,transfers:0,adjustments:0,net_change:0,end_balance:N})),T={budget_id:t,year_month_ordinal:vt(e,n),year:e,month:n,income:[],total_income:0,previous_month_income:b,expenses:[],total_expenses:0,transfers:[],adjustments:[],account_balances:C,category_balances:S,are_allocations_finalized:!1,created_at:g,updated_at:g},I={budget_id:t,year_month_ordinal:vt(e,n),year:e,month:n,income:[],total_income:0,previous_month_income:b,expenses:[],total_expenses:0,transfers:[],adjustments:[],account_balances:C,category_balances:S,are_allocations_finalized:!1,created_at:g,updated_at:g};await qn("months",v,I,"creating new month document (first time viewing this month)"),Le.setQueryData(ke.month(t,e,n),{month:T});const O=vt(e,n),$={...p.month_map||{},[O]:{needs_recalculation:!1}},k=$;return $6(t,k),await Tf("budgets",t,{month_map:k,updated_at:g},`adding month ${e}/${n} to budget month_map`),T}function G6(t,e,n,r){return{budget_id:e,year_month_ordinal:t.year_month_ordinal??vt(n,r),year:t.year??n,month:t.month??r,income:t.income||[],total_income:t.total_income??0,previous_month_income:t.previous_month_income??0,expenses:t.expenses||[],total_expenses:t.total_expenses??0,transfers:t.transfers||[],adjustments:t.adjustments||[],account_balances:t.account_balances||[],category_balances:t.category_balances||[],are_allocations_finalized:t.are_allocations_finalized??!1,created_at:t.created_at,updated_at:t.updated_at}}async function O0(t,e,n){const r=hs(t,e,n);try{const{exists:i,data:o}=await At("months",r,`loading month ${e}/${n}`);return!i||!o?null:G6(o,t,e,n)}catch(i){if(i instanceof Error&&i.message.includes("Missing or insufficient permissions"))return console.warn(`[readMonthDirect] Permission error reading month ${e}/${n}, treating as not found`),null;throw i}}async function Q6(t,e,n,r){const i=await O0(t,e,n);if(i)return i;let o=!1;if(r){const l=r.getQueryData(ke.budget(t));l?.monthMap&&(o=vt(e,n)in l.monthMap)}else{const{exists:l,data:d}=await At("budgets",t,"checking month_map before creating month");if(l&&d?.month_map){const h=vt(e,n),m=d.month_map;o=h in m}}if(o)return H6(t,e,n);throw new Error(`Month ${e}/${n} does not exist in budget. Cannot create months that are not in month_map.`)}function W6(t,e,n,r){const i=Ft(),{initialDataLoadComplete:o}=Ye(),l=t?ke.month(t,e,n):["month","none"],d=!!t&&r?.enabled!==!1&&o;return ko({queryKey:l,queryFn:async()=>({month:await Q6(t,e,n,i)}),enabled:d,staleTime:ac})}async function N0(t){const{exists:e,data:n}=await At("payees",t,"loading payees for autocomplete (cache miss or stale)");return e&&n?n.payees||[]:[]}function P0(t,e){const{initialDataLoadComplete:n}=Ye(),r=!!t&&e?.enabled!==!1&&n;return ko({queryKey:t?ke.payees(t):["payees","none"],queryFn:()=>N0(t),enabled:r,staleTime:ac})}async function K6(t,e){const{exists:n,data:r}=await At("users",t,"loading user profile (cache miss or stale)");if(n&&r)return r;const i={uid:t,email:e,budget_ids:[],created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return await qn("users",t,i,"creating new user document (first login)"),i}function Y6(t,e,n){return ko({queryKey:t?ke.user(t):["user","none"],queryFn:()=>K6(t,e),enabled:!!t&&n?.enabled!==!1})}async function X6(t,e){const n=await Dn("budgets","loading budgets user has access to (cache miss or stale)",[{field:"user_ids",op:"array-contains",value:t}]),r=[],i=[];for(const o of n.docs){const l=o.data;l.accepted_user_ids?.includes(t)||e?.budget_ids?.includes(o.id)?r.push({id:o.id,name:l.name||"Unnamed Budget",ownerEmail:l.owner_email||null,isOwner:l.owner_id===t,isPending:!1}):i.push({budgetId:o.id,budgetName:l.name||"Unnamed Budget",ownerEmail:l.owner_email||null})}return{budgets:r,pendingInvites:i}}function Z6(t,e,n){return ko({queryKey:t?ke.accessibleBudgets(t):["accessibleBudgets","none"],queryFn:async()=>t?X6(t,e):{budgets:[],pendingInvites:[]},enabled:!!t&&n?.enabled!==!1,staleTime:60*1e3})}function J6(t){if(Array.isArray(t))return t;if(t&&typeof t=="object"&&!Array.isArray(t)){const e=t;if(e._methodName==="arrayUnion"&&Array.isArray(e.vc))return console.warn("[fetchFeedback] Found corrupted arrayUnion in feedback document - extracting items from vc"),e.vc}return[]}async function e4(){const t=await Dn("feedback","admin loading all feedback (cache miss or stale)"),e=[];for(const n of t.docs){const r=J6(n.data.items),i=n.data.user_email||n.id;r.forEach(o=>{e.push({...o,doc_id:n.id,user_email:i})})}return{items:e}}function t4(t){return ko({queryKey:ke.feedback(),queryFn:e4,enabled:t?.enabled!==!1})}const Kt="__NO_CATEGORY__",Io="No Category";function at(t){return t===Kt}const qt="__NO_ACCOUNT__",ja="No Account";function et(t){return t===qt}const B0={categoryEndBalances:{},accountEndBalances:{},totalIncome:0};function z0(t,e){const n=t.income||[],r=t.expenses||[],i=Me(n.reduce((g,v)=>g+v.amount,0)),o=Me(r.reduce((g,v)=>g+v.amount,0)),l=n4(t),{transfersMap:d,adjustmentsMap:h}=r4(t),m=s4(t.category_balances,e.categoryEndBalances,l,d,h),p=i4(t,e.accountEndBalances);return{...t,total_income:i,total_expenses:o,previous_month_income:e.totalIncome,category_balances:m,account_balances:p,updated_at:new Date().toISOString()}}function n4(t){const e={};for(const n of t.transfers||[])at(n.from_category_id)||(e[n.from_category_id]=(e[n.from_category_id]||0)-n.amount),at(n.to_category_id)||(e[n.to_category_id]=(e[n.to_category_id]||0)+n.amount);for(const n of t.adjustments||[])at(n.category_id)||(e[n.category_id]=(e[n.category_id]||0)+n.amount);for(const n of Object.keys(e))e[n]=Me(e[n]);return e}function r4(t){const e={},n={};for(const r of t.transfers||[])at(r.from_category_id)||(e[r.from_category_id]=(e[r.from_category_id]||0)-r.amount),at(r.to_category_id)||(e[r.to_category_id]=(e[r.to_category_id]||0)+r.amount);for(const r of t.adjustments||[])at(r.category_id)||(n[r.category_id]=(n[r.category_id]||0)+r.amount);for(const r of Object.keys(e))e[r]=Me(e[r]);for(const r of Object.keys(n))n[r]=Me(n[r]);return{transfersMap:e,adjustmentsMap:n}}function s4(t,e,n,r,i){const o=new Map;for(const h of t)at(h.category_id)||o.set(h.category_id,h);const l=new Set;for(const h of t)at(h.category_id)||l.add(h.category_id);for(const h of Object.keys(e))at(h)||l.add(h);for(const h of Object.keys(n))at(h)||l.add(h);const d=[];for(const h of l){const m=o.get(h),p=Me(e[h]??0),g=Me(m?.allocated??0),v=Me(m?.spent??0),b=Me(r[h]??0),E=Me(i[h]??0);d.push({category_id:h,start_balance:p,allocated:g,spent:v,transfers:b,adjustments:E,end_balance:Me(p+g+v+b+E)})}return d}function i4(t,e){const n=new Set;for(const i of t.income||[])et(i.account_id)||n.add(i.account_id);for(const i of t.expenses||[])et(i.account_id)||n.add(i.account_id);for(const i of t.transfers||[])et(i.from_account_id)||n.add(i.from_account_id),et(i.to_account_id)||n.add(i.to_account_id);for(const i of t.adjustments||[])et(i.account_id)||n.add(i.account_id);for(const i of Object.keys(e))et(i)||n.add(i);for(const i of t.account_balances||[])et(i.account_id)||n.add(i.account_id);const r=[];for(const i of n){const o=Me(e[i]??0),l=Me((t.income||[]).filter(b=>b.account_id===i).reduce((b,E)=>b+E.amount,0)),d=Me((t.expenses||[]).filter(b=>b.account_id===i).reduce((b,E)=>b+E.amount,0)),h=Me((t.transfers||[]).filter(b=>b.from_account_id===i).reduce((b,E)=>b-E.amount,0)),m=Me((t.transfers||[]).filter(b=>b.to_account_id===i).reduce((b,E)=>b+E.amount,0)),p=Me(m+h),g=Me((t.adjustments||[]).filter(b=>b.account_id===i).reduce((b,E)=>b+E.amount,0)),v=Me(l+d+p+g);r.push({account_id:i,start_balance:o,income:l,expenses:d,transfers:p,adjustments:g,net_change:v,end_balance:Me(o+v)})}return r}function Fu(t){const e={},n={};for(const r of t.category_balances||[])at(r.category_id)||(e[r.category_id]=Me(r.end_balance));for(const r of t.account_balances||[])et(r.account_id)||(n[r.account_id]=Me(r.end_balance));return{categoryEndBalances:e,accountEndBalances:n,totalIncome:Me(t.total_income)}}const a4=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function o4(t){return{year:parseInt(t.slice(0,4),10),month:parseInt(t.slice(4,6),10)}}function vT(t={}){const e={};return Object.entries(t).forEach(([n,r])=>{e[n]={needs_recalculation:r?.needs_recalculation??!1}}),e}function xT(t){return Object.entries(t).filter(([,e])=>e.needs_recalculation).map(([e])=>e).sort()}function l4(t){return Object.keys(t).sort()}async function c4(t,e){const{year:n,month:r}=o4(e),i=hs(t,n,r),{exists:o,data:l}=await At("months",i,`[recalc] fetching month ${n}/${r}`);return!o||!l?null:{id:i,budget_id:t,year_month_ordinal:l.year_month_ordinal??vt(n,r),year:l.year??n,month:l.month??r,income:l.income||[],total_income:l.total_income??0,previous_month_income:l.previous_month_income??0,expenses:l.expenses||[],total_expenses:l.total_expenses??0,transfers:l.transfers||[],adjustments:l.adjustments||[],account_balances:l.account_balances||[],category_balances:l.category_balances||[],are_allocations_finalized:l.are_allocations_finalized??!1,created_at:l.created_at,updated_at:l.updated_at}}async function u4(t,e,n){n?.(0,e.length);const r=await Promise.all(e.map(i=>c4(t,i)));return n?.(e.length,e.length),r.filter(i=>i!==null)}function L0(t){const e={};for(const n of Object.keys(t))e[n]={needs_recalculation:!1};return e}function U0(t,e,n){const r=Object.entries(t).reduce((o,[,l])=>{const d=l.account_group_id?n[l.account_group_id]:void 0,h=d&&d.on_budget!==null?d.on_budget:l.on_budget!==!1,m=d&&d.is_active!==null?d.is_active:l.is_active!==!1;return h&&m?o+(l.balance??0):o},0),i=Object.values(e).reduce((o,l)=>{const d=l.balance??0;return o+(d>0?d:0)},0);return Me(r-i)}async function wT(t,e,n,r){const{exists:i,data:o}=await At("budgets",t,"[recalc] reading budget for balance update");if(!i||!o)return;const l={...o.accounts};for(const[p,g]of Object.entries(e))l[p]&&(l[p]={...l[p],balance:Me(g)});const d={...o.categories};for(const[p,g]of Object.entries(n))d[p]&&(d[p]={...d[p],balance:Me(g)});const h=L0(r),m=U0(l,d,o.account_groups||{});await qn("budgets",t,{...o,accounts:l,categories:d,total_available:m,is_needs_recalculation:!1,month_map:h,updated_at:new Date().toISOString()},"[recalc] saving balances and clearing flags"),h4(t,l,d,m,h)}function d4(t,e){const n=Le.getQueryData(ke.budget(t));n&&Le.setQueryData(ke.budget(t),{...n,isNeedsRecalculation:!1,monthMap:e,budget:{...n.budget,is_needs_recalculation:!1,month_map:e}})}function h4(t,e,n,r,i){const o=Le.getQueryData(ke.budget(t));if(o){const l={};for(const[h,m]of Object.entries(o.accounts)){const p=e[h];l[h]=p?{...m,balance:p.balance??m.balance}:m}const d={};for(const[h,m]of Object.entries(o.categories)){const p=n[h];d[h]=p?{...m,balance:p.balance??m.balance}:m}Le.setQueryData(ke.budget(t),{...o,accounts:l,categories:d,isNeedsRecalculation:!1,monthMap:i,budget:{...o.budget,accounts:e,categories:n,total_available:r,is_needs_recalculation:!1,month_map:i}})}}async function T1(t,e){const{exists:n,data:r}=await At("budgets",t,"[recalc] reading budget to clear flags");if(!n||!r)return;const i=L0(e);await qn("budgets",t,{...r,total_available:U0(r.accounts||{},r.categories||{},r.account_groups||{}),is_needs_recalculation:!1,month_map:i,updated_at:new Date().toISOString()},"[recalc] clearing flags"),d4(t,i)}const Fg=new Map;async function f4(t,e={}){const n=Fg.get(t);if(n)return n;const r=m4(t,e);Fg.set(t,r);try{return await r}finally{Fg.delete(t)}}async function m4(t,e={}){const{onProgress:n}=e;n?.({phase:"reading-budget",monthsProcessed:0,totalMonths:0,percentComplete:5});const{exists:r,data:i}=await At("budgets",t,"[recalc] reading budget for month_map");if(!r||!i)return n?.({phase:"complete",monthsProcessed:0,totalMonths:0,percentComplete:100}),{monthsRecalculated:0,budgetUpdated:!1};const o=vT(i.month_map),l=xT(o);if(l.length===0&&!i.is_needs_recalculation)return n?.({phase:"complete",monthsProcessed:0,totalMonths:0,percentComplete:100}),{monthsRecalculated:0,budgetUpdated:!1};const d=l4(o),h=l.length>0?l[0]:null;if(!h)return await T1(t,o),n?.({phase:"complete",monthsProcessed:0,totalMonths:0,percentComplete:100}),{monthsRecalculated:0,budgetUpdated:!0};const m=d.indexOf(h),p=m>0,g=p?d.slice(m-1):d.slice(m),v=p?g.length-1:g.length;n?.({phase:"fetching-months",monthsFetched:0,totalMonthsToFetch:g.length,monthsProcessed:0,totalMonths:v,percentComplete:10});const b=await u4(t,g,(k,R)=>{n?.({phase:"fetching-months",monthsFetched:k,totalMonthsToFetch:R,monthsProcessed:0,totalMonths:v,percentComplete:k===0?10:30})});if(b.length===0)return await T1(t,o),n?.({phase:"complete",monthsProcessed:0,totalMonths:0,percentComplete:100}),{monthsRecalculated:0,budgetUpdated:!0};const E=p?1:0,x=b.length-1,S=x-E+1;let C=B0;p&&b.length>0&&(C=Fu(b[0]));const T=[];let I=0;for(let k=E;k<=x;k++){const R=b[k],N=`${a4[R.month-1]} ${R.year}`;n?.({phase:"recalculating",currentMonth:N,monthsProcessed:I,totalMonths:S,percentComplete:Math.round(30+I/S*40)});const V=z0(R,C);T.push(V),C=Fu(V),I++}n?.({phase:"saving",monthsProcessed:I,totalMonths:S,percentComplete:75});const O=T.map(k=>({collectionPath:"months",docId:hs(t,k.year,k.month),data:k}));await dm(O,`[recalc] batch write ${T.length} months`);for(const k of T)Le.setQueryData(ke.month(t,k.year,k.month),{month:k});n?.({phase:"saving",monthsProcessed:I,totalMonths:S,percentComplete:92});const U=C.accountEndBalances,$=C.categoryEndBalances;return await wT(t,U,$,o),n?.({phase:"complete",monthsProcessed:I,totalMonths:S,percentComplete:100}),{monthsRecalculated:I,budgetUpdated:!0,finalAccountBalances:U}}async function p4(t,e,n){const r=vt(e,n);if(F6(t,r))return{markedCount:0,budgetUpdated:!1};const{exists:i,data:o}=await At("budgets",t,"reading budget for month_map update");if(!i||!o)return console.warn(`[markMonthsNeedRecalculation] Budget ${t} not found`),{markedCount:0,budgetUpdated:!1};const d={...o.month_map||{}},h=U6();for(const v of h)d[v]||(d[v]={needs_recalculation:!1});let m=0;for(const v of h)v>=r&&(d[v]?.needs_recalculation||(d[v]={needs_recalculation:!0},m++));const p=o.is_needs_recalculation===!0;if(m===0&&p)return{markedCount:0,budgetUpdated:!1};const g=d;return V6(t,r,g),await Tf("budgets",t,{is_needs_recalculation:!0,month_map:g,updated_at:new Date().toISOString()},`marking budget and ${m} future months as needing recalculation`),{markedCount:m,budgetUpdated:!0}}async function g4(t,e){return Le.fetchQuery({queryKey:["budgetInvite",t,e],queryFn:async()=>{const{exists:n,data:r}=await At("budgets",t,"checking if user has pending invite for budget");return!n||!r?null:{isInvited:r.user_ids?.includes(e)??!1,hasAccepted:r.accepted_user_ids?.includes(e)??!1,budgetName:r.name||"Unnamed Budget",ownerEmail:r.owner_email||null}},staleTime:60*1e3})}async function ky(t,e,n){const r=await Gr(t,e,n,{description:`fetching month for balance calculation (walking ${e}/${n})`});return r?{year:r.year,month:r.month,category_balances:r.category_balances,are_allocations_finalized:r.are_allocations_finalized,expenses:r.expenses}:null}async function y4(t,e,n,r){const i={};e.forEach(v=>{i[v]=0});const o=await ky(t,n,r);if(o?.category_balances){for(const v of o.category_balances)e.includes(v.category_id)&&(i[v.category_id]=v.end_balance);return i}const l={};e.forEach(v=>{l[v]=0});const d=[];o&&d.push(o);let h=n,m=r,p=!1;const g=120;for(let v=0;v<g&&!p;v++){const b=Xl(h,m);h=b.year,m=b.month;const E=await ky(t,h,m);if(!E)p=!0;else if(E.category_balances){p=!0;for(const x of E.category_balances)e.includes(x.category_id)&&(l[x.category_id]=x.end_balance)}else d.push(E)}d.reverse(),Object.assign(i,l);for(const v of d){if(v.are_allocations_finalized&&v.category_balances)for(const b of v.category_balances)e.includes(b.category_id)&&(i[b.category_id]=(i[b.category_id]||0)+b.allocated);if(v.expenses)for(const b of v.expenses)e.includes(b.category_id)&&(i[b.category_id]=(i[b.category_id]||0)-b.amount)}return i}async function _4(t,e,n,r,i){const o={...n};let l=r,d=i;const h=24;for(let m=0;m<h;m++){const p=bT(l,d);l=p.year,d=p.month;const g=await ky(t,l,d);if(!g)break;if(g.are_allocations_finalized&&g.category_balances)for(const v of g.category_balances)e.includes(v.category_id)&&(o[v.category_id]=(o[v.category_id]||0)+v.allocated);if(g.expenses)for(const v of g.expenses)e.includes(v.category_id)&&(o[v.category_id]=(o[v.category_id]||0)-v.amount)}return o}async function A1(t,e,n,r){const i=await y4(t,e,n,r),o=await _4(t,e,i,n,r);return{current:i,total:o}}async function ST(t,e,n){const r=hs(t,e.year,e.month);await qn("months",r,e,`writeMonthData: ${n}`)}async function ET(t,e,n){await p4(t,e,n)}async function CT(t){const{budgetId:e,month:n,description:r,cascadeRecalculation:i=!0}=t;await ST(e,n,r||`${n.year}/${n.month}`),Le.setQueryData(ke.month(e,n.year,n.month),{month:n}),i&&await ET(e,n.year,n.month)}function b4(){const t=Ft();return{writeData:Hn({mutationFn:async({budgetId:n,month:r,description:i,cascadeRecalculation:o=!0})=>(await ST(n,r,i||`${r.year}/${r.month}`),{budgetId:n,year:r.year,month:r.month,cascadeRecalculation:o}),onMutate:async({budgetId:n,month:r})=>{const i=ke.month(n,r.year,r.month);await t.cancelQueries({queryKey:i});const o=t.getQueryData(i);return t.setQueryData(i,{month:r}),{oldMonthQueryData:o,monthKey:i}},onSuccess:async({budgetId:n,year:r,month:i,cascadeRecalculation:o})=>{o&&await ET(n,r,i)},onError:(n,r,i)=>{i?.oldMonthQueryData&&t.setQueryData(i.monthKey,i.oldMonthQueryData)}})}}function v4(t,e,n,r){const i={};t.category_balances&&t.category_balances.forEach(h=>{i[h.category_id]=h});const o=t.expenses??[],l={};for(const h of t.transfers||[])at(h.from_category_id)||(l[h.from_category_id]=(l[h.from_category_id]||0)-h.amount),at(h.to_category_id)||(l[h.to_category_id]=(l[h.to_category_id]||0)+h.amount);const d={};for(const h of t.adjustments||[])at(h.category_id)||(d[h.category_id]=(d[h.category_id]||0)+h.amount);return e.map(h=>{const m=i[h],p=Me(m?.start_balance??0),g=Me(n[h]??0),v=Me(o.filter(x=>x.category_id===h).reduce((x,S)=>x+S.amount,0)),b=Me(l[h]??0),E=Me(d[h]??0);return{category_id:h,start_balance:p,allocated:g,spent:v,transfers:b,adjustments:E,end_balance:Me(p+g+v+b+E)}})}function x4(){const{writeData:t}=b4();return{saveDraftAllocations:async(n,r,i,o)=>{const l=await Gr(n,r,i);if(!l)throw new Error(`Month not found: ${r}/${i}`);const d=l.category_balances.map(m=>({...m,allocated:o[m.category_id]??m.allocated})),h={...l,category_balances:d,updated_at:new Date().toISOString()};return await t.mutateAsync({budgetId:n,month:h,cascadeRecalculation:!1}),{updatedMonth:h}},isPending:t.isPending,isError:t.isError,error:t.error}}const me={primary:"#646cff",error:"#f87171",errorBg:"rgba(220, 38, 38, 0.1)",errorBorder:"rgba(220, 38, 38, 0.3)",success:"#4ade80",danger:"#f87171",warning:"#facc15",debt:"#fb923c",zero:"rgba(255, 255, 255, 0.4)"},as={textDecoration:"underline",textDecorationStyle:"dotted",textUnderlineOffset:"3px"},Ra="1px solid color-mix(in srgb, currentColor 20%, transparent)",Rf={maxWidth:"var(--page-max-width, 85rem)",margin:"0 auto",padding:"var(--page-padding, 2rem)"},F0={background:"color-mix(in srgb, currentColor 8%, transparent)",padding:"1rem 1.25rem",borderRadius:"8px",display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem"},w4={background:"color-mix(in srgb, currentColor 8%, transparent)",padding:"1.25rem",borderRadius:"8px",display:"flex",flexDirection:"column",gap:"1rem"},S4={display:"flex",flexDirection:"column",gap:"0.5rem"},E4={fontSize:"0.9rem",fontWeight:500},Na={padding:"0.6rem 0.8rem",borderRadius:"6px",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"1rem",color:"inherit",width:"100%",boxSizing:"border-box"},C4={...Na,cursor:"pointer"},V0={padding:"0.6rem 1.25rem",borderRadius:"6px",cursor:"pointer",fontWeight:500,fontSize:"0.9rem",transition:"opacity 0.15s"},TT={...V0,background:me.primary,color:"white",border:"none"},T4={...TT,padding:"0.75rem 1.5rem",borderRadius:"8px"},A4={...V0,background:"transparent",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)"},j4={...V0,background:"transparent",border:`1px solid ${me.errorBorder}`,color:me.error},R4={background:"transparent",border:"1px solid color-mix(in srgb, currentColor 25%, transparent)",padding:"0.35rem 0.75rem",borderRadius:"6px",cursor:"pointer",fontSize:"0.8rem",opacity:.8,transition:"opacity 0.15s"},ha={background:"transparent",border:"1px solid color-mix(in srgb, currentColor 15%, transparent)",padding:"0.25rem 0.35rem",borderRadius:"4px",cursor:"pointer",fontSize:"0.75rem",lineHeight:1,display:"flex",alignItems:"center",justifyContent:"center",opacity:.6,transition:"opacity 0.15s, background 0.15s"},If={display:"flex",flexDirection:"column",gap:"2px"},I4={display:"flex",gap:"0.75rem",marginTop:"0.5rem"},k4={opacity:.4,cursor:"grab"},D4={position:"absolute",top:"-4px",left:0,right:0,height:"3px",background:me.primary,borderRadius:"2px",transition:"opacity 0.15s"},M4={position:"relative",height:"2rem",marginTop:"-0.25rem"},O4={position:"absolute",top:"50%",left:0,right:0,height:"3px",background:me.primary,borderRadius:"2px",transition:"opacity 0.15s"},N4={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"0.75rem",opacity:.7,background:"var(--background, #1a1a1a)",padding:"0 0.5rem",whiteSpace:"nowrap"},P4={background:me.errorBg,border:`1px solid ${me.errorBorder}`,color:me.error,padding:"0.75rem 1rem",borderRadius:"8px",marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem"},B4={background:"transparent",border:"none",color:me.error,cursor:"pointer",fontSize:"1.2rem",padding:"0 0.25rem",lineHeight:1},AT={opacity:.7,marginBottom:"1.5rem"},j1={display:"flex",flexDirection:"column",gap:"0.5rem",marginBottom:"1.5rem"};function mm({message:t,children:e,onDismiss:n,style:r}){return u.jsxs("div",{style:{...P4,...r},children:[u.jsx("span",{children:e??t}),n&&u.jsx("button",{onClick:n,style:B4,children:""})]})}const z4={primary:TT,"primary-large":T4,secondary:A4,danger:j4,small:R4},L4={position:"absolute",bottom:"100%",left:"50%",transform:"translateX(-50%)",background:me.warning,color:"#1a1a1a",padding:"0.5rem 0.75rem",borderRadius:"6px",fontSize:"0.8rem",fontWeight:500,whiteSpace:"nowrap",marginBottom:"0.5rem",zIndex:100,boxShadow:"0 2px 8px rgba(0,0,0,0.3)",animation:"tooltipFadeIn 0.15s ease-out"},U4={position:"absolute",top:"100%",left:"50%",transform:"translateX(-50%)",width:0,height:0,borderLeft:"6px solid transparent",borderRight:"6px solid transparent",borderTop:`6px solid ${me.warning}`};function Ve({variant:t="primary",isLoading:e,loadingText:n="Saving...",children:r,disabled:i,style:o,actionName:l,disabledReason:d,onClick:h,...m}){const p=z4[t],g=i||e,[v,b]=D.useState(!1);function E(C){h?.(C)}function x(C){g&&d&&(C.preventDefault(),C.stopPropagation(),b(!0),setTimeout(()=>b(!1),3e3))}const S=g?{cursor:"not-allowed",opacity:.35,filter:"grayscale(50%)"}:{};return u.jsxs("div",{style:{position:"relative",display:"inline-block"},onClick:x,children:[v&&d&&u.jsxs("div",{style:L4,children:[d,u.jsx("div",{style:U4})]}),u.jsx("button",{disabled:g,style:{...p,cursor:g?"not-allowed":"pointer",...S,...o},onClick:E,...m,children:e?n:r})]})}function jT(t,e){const n=t.toLowerCase(),r=e.toLowerCase();if(r.includes(n)){const d=r.indexOf(n);return{match:!0,score:d===0||/\s/.test(r[d-1])?100:90}}let i=0,o=0,l=0;for(let d=0;d<r.length&&i<n.length;d++)r[d]===n[i]?(i++,l++,o+=l*2):l=0;return i===n.length?{match:!0,score:o}:{match:!1,score:0}}function RT(t){return[...t].sort((e,n)=>!e.groupId&&n.groupId?1:e.groupId&&!n.groupId?-1:!e.groupId&&!n.groupId?e.sortOrder-n.sortOrder:e.groupSortOrder!==n.groupSortOrder?e.groupSortOrder-n.groupSortOrder:e.sortOrder-n.sortOrder)}function IT(t){const e=RT(t),n=[];let r="__initial__";return e.forEach(i=>{i.groupId!==r&&(r=i.groupId,n.push({groupId:i.groupId,groupName:i.groupName,groupSortOrder:i.groupSortOrder,items:[]})),n[n.length-1].items.push(i)}),n}function kT(t,e,n){return e.trim()?t.map(i=>{const o=n(i);let l=0,d=!1;for(const h of o){const m=jT(e,h);m.match&&(d=!0,l=Math.max(l,m.score))}return{item:i,score:l,hasMatch:d}}).filter(({hasMatch:i})=>i).sort((i,o)=>o.score!==i.score?o.score-i.score:!i.item.groupId&&o.item.groupId?1:i.item.groupId&&!o.item.groupId?-1:i.item.groupSortOrder!==o.item.groupSortOrder?i.item.groupSortOrder-o.item.groupSortOrder:i.item.sortOrder-o.item.sortOrder).map(({item:i})=>i):RT(t)}const $0={position:"absolute",top:"100%",left:0,right:0,marginTop:"4px",background:"var(--background, #1a1a1a)",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",borderRadius:"6px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",zIndex:1e3},Vu={padding:"0.6rem 0.8rem",cursor:"pointer",transition:"background 0.1s"};function R1({id:t,value:e,onChange:n,payees:r,placeholder:i="Enter payee name",autoFocus:o}){const[l,d]=D.useState(!1),[h,m]=D.useState(-1),p=D.useRef(null),g=D.useRef(null),v=e.trim()?r.map(x=>({payee:x,...jT(e,x)})).filter(x=>x.match).sort((x,S)=>S.score-x.score).slice(0,8).map(x=>x.payee):[];D.useEffect(()=>{function x(S){p.current&&!p.current.contains(S.target)&&d(!1)}return document.addEventListener("mousedown",x),()=>document.removeEventListener("mousedown",x)},[]);function b(x){!l||v.length===0||(x.key==="ArrowDown"?(x.preventDefault(),m(S=>Math.min(S+1,v.length-1))):x.key==="ArrowUp"?(x.preventDefault(),m(S=>Math.max(S-1,-1))):x.key==="Enter"&&h>=0?(x.preventDefault(),n(v[h]),d(!1),m(-1)):x.key==="Escape"&&(d(!1),m(-1)))}function E(x){n(x),d(!1),m(-1),g.current?.focus()}return u.jsxs("div",{ref:p,style:{position:"relative"},children:[u.jsx("input",{ref:g,id:t,type:"text",value:e,onChange:x=>{n(x.target.value),d(!0),m(-1)},onFocus:()=>d(!0),onKeyDown:b,placeholder:i,autoComplete:"off",autoFocus:o,style:Na}),l&&v.length>0&&u.jsx("div",{style:{...$0,maxHeight:"200px",overflowY:"auto"},children:v.map((x,S)=>u.jsx("div",{onClick:()=>E(x),style:{...Vu,background:S===h?`color-mix(in srgb, ${me.primary} 20%, transparent)`:"transparent",borderBottom:S<v.length-1?"1px solid color-mix(in srgb, currentColor 10%, transparent)":"none"},onMouseEnter:()=>m(S),children:x},x))})]})}function DT({id:t,value:e,onChange:n,categories:r,categoryGroups:i,placeholder:o="Search categories...",required:l,showNoCategoryOption:d=!1,showHiddenCategories:h=!1}){const m=Object.fromEntries(i.map(q=>[q.id,q.name])),p=Object.fromEntries(i.map(q=>[q.id,q.sort_order])),g=h?r:Object.fromEntries(Object.entries(r).filter(([,q])=>!q.is_hidden)),v=Object.entries(g).map(([q,W])=>({id:q,name:W.name,groupId:W.category_group_id,groupName:W.category_group_id&&m[W.category_group_id]||null,sortOrder:W.sort_order,groupSortOrder:W.category_group_id?p[W.category_group_id]??999:999})),b=e===Kt,E=b?null:e?r[e]:null,x=b?"":E?.name||"",[S,C]=D.useState(x),[T,I]=D.useState(!1),[O,U]=D.useState(-1),$=D.useRef(null),k=D.useRef(null);D.useEffect(()=>{if(e===Kt)C("");else if(e){const q=r[e];C(q?.name||"")}},[e,r]);const R=kT(v,S,q=>[q.name]),N=IT(R);D.useEffect(()=>{function q(W){if($.current&&!$.current.contains(W.target))if(I(!1),e===Kt)C("");else{const X=e?r[e]:null;C(X?.name||"")}}return document.addEventListener("mousedown",q),()=>document.removeEventListener("mousedown",q)},[e,r]);function V(q){if(q.key==="ArrowDown")q.preventDefault(),T?U(W=>Math.min(W+1,R.length-1)):(I(!0),U(0));else if(q.key==="ArrowUp")q.preventDefault(),U(W=>Math.max(W-1,0));else if(q.key==="Enter")q.preventDefault(),T&&O>=0&&R[O]&&H(R[O]);else if(q.key==="Escape")if(I(!1),U(-1),e===Kt)C("");else{const W=e?r[e]:null;C(W?.name||"")}else if(q.key==="Tab")if(T&&O>=0&&R[O])H(R[O]);else if(I(!1),U(-1),e===Kt)C("");else{const W=e?r[e]:null;C(W?.name||"")}}function H(q){n(q.id),C(q.id===Kt?"":q.name),I(!1),U(-1)}function j(){n(Kt),C(""),I(!1),U(-1)}function B(q){const W=q.target.value;C(W),I(!0),U(W.trim()?0:-1),W!==x&&(d&&W.trim()===""?n(Kt):n(""))}function M(){I(!0),d&&(e===Kt||S.trim()==="")?U(-1):R.length>0&&U(0)}let Z=-1;const K=()=>++Z;return u.jsxs("div",{ref:$,style:{position:"relative"},children:[u.jsx("input",{ref:k,id:t,type:"text",value:S,onChange:B,onFocus:M,onKeyDown:V,placeholder:o,autoComplete:"off",required:l&&!d,style:{...Na,borderColor:l&&!e?me.error:void 0}}),T&&u.jsxs("div",{style:{...$0,maxHeight:"250px",overflowY:"auto"},children:[d&&u.jsx("div",{onClick:j,onMouseEnter:()=>U(-1),style:{...Vu,opacity:.7,fontStyle:"italic",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)",background:O===-1?`color-mix(in srgb, ${me.primary} 20%, transparent)`:"transparent"},children:Io}),N.map((q,W)=>u.jsxs("div",{children:[q.groupName&&u.jsx("div",{style:{padding:"0.4rem 0.8rem",fontSize:"0.75rem",textTransform:"uppercase",letterSpacing:"0.5px",opacity:.6,background:"color-mix(in srgb, currentColor 5%, transparent)",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},children:q.groupName}),q.items.map(X=>{const re=K();return u.jsx("div",{onClick:()=>H(X),style:{...Vu,paddingLeft:q.groupName?"1.2rem":"0.8rem",background:re===O?`color-mix(in srgb, ${me.primary} 20%, transparent)`:"transparent",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},onMouseEnter:()=>U(re),children:X.name},X.id)})]},`group-${W}`)),R.length===0&&S.trim()&&!d&&u.jsx("div",{style:{padding:"0.6rem 0.8rem",opacity:.6,fontStyle:"italic"},children:"No matching categories"})]})]})}function MT({id:t,value:e,onChange:n,accounts:r,accountGroups:i,placeholder:o="Search accounts...",required:l,showNoAccountOption:d=!1,showHiddenAccounts:h=!1}){const p=(h?r:r.filter(([,Z])=>!Z.is_hidden)).map(([Z,K])=>({id:Z,name:K.nickname,groupId:K.account_group_id,groupName:K.account_group_id&&i[K.account_group_id]?.name||null,sortOrder:K.sort_order,groupSortOrder:K.account_group_id?i[K.account_group_id]?.sort_order??999:999})),g=e===qt,v=g?null:r.find(([Z])=>Z===e)?.[1],b=g?"":v?.nickname||"",[E,x]=D.useState(b),[S,C]=D.useState(!1),[T,I]=D.useState(-1),O=D.useRef(null),U=D.useRef(null);D.useEffect(()=>{if(e===qt)x("");else if(e){const Z=r.find(([K])=>K===e)?.[1];x(Z?.nickname||"")}},[e,r]);const $=kT(p,E,Z=>[Z.name]),k=IT($);D.useEffect(()=>{function Z(K){if(O.current&&!O.current.contains(K.target))if(C(!1),e===qt)x("");else{const q=r.find(([W])=>W===e)?.[1];x(q?.nickname||"")}}return document.addEventListener("mousedown",Z),()=>document.removeEventListener("mousedown",Z)},[e,r]);function R(Z){if(Z.key==="ArrowDown")Z.preventDefault(),S?I(K=>Math.min(K+1,$.length-1)):(C(!0),I(0));else if(Z.key==="ArrowUp")Z.preventDefault(),I(K=>Math.max(K-1,0));else if(Z.key==="Enter")Z.preventDefault(),S&&T>=0&&$[T]&&N($[T]);else if(Z.key==="Escape")if(C(!1),I(-1),e===qt)x("");else{const K=r.find(([q])=>q===e)?.[1];x(K?.nickname||"")}else if(Z.key==="Tab")if(S&&T>=0&&$[T])N($[T]);else if(C(!1),I(-1),e===qt)x("");else{const K=r.find(([q])=>q===e)?.[1];x(K?.nickname||"")}}function N(Z){n(Z.id),x(Z.id===qt?"":Z.name),C(!1),I(-1)}function V(){n(qt),x(""),C(!1),I(-1)}function H(Z){const K=Z.target.value;x(K),C(!0),I(K.trim()?0:-1),K!==b&&(d&&K.trim()===""?n(qt):n(""))}function j(){C(!0),d&&(e===qt||E.trim()==="")?I(-1):$.length>0&&I(0)}let B=-1;const M=()=>++B;return u.jsxs("div",{ref:O,style:{position:"relative"},children:[u.jsx("input",{ref:U,id:t,type:"text",value:E,onChange:H,onFocus:j,onKeyDown:R,placeholder:o,autoComplete:"off",required:l&&!d,style:{...Na,borderColor:l&&!e?me.error:void 0}}),S&&u.jsxs("div",{style:{...$0,maxHeight:"250px",overflowY:"auto"},children:[d&&u.jsx("div",{onClick:V,onMouseEnter:()=>I(-1),style:{...Vu,opacity:.7,fontStyle:"italic",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)",background:T===-1?`color-mix(in srgb, ${me.primary} 20%, transparent)`:"transparent"},children:ja}),k.map((Z,K)=>u.jsxs("div",{children:[Z.groupName&&u.jsx("div",{style:{padding:"0.4rem 0.8rem",fontSize:"0.75rem",textTransform:"uppercase",letterSpacing:"0.5px",opacity:.6,background:"color-mix(in srgb, currentColor 5%, transparent)",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},children:Z.groupName}),Z.items.map(q=>{const W=M();return u.jsx("div",{onClick:()=>N(q),style:{...Vu,paddingLeft:Z.groupName?"1.2rem":"0.8rem",background:W===T?`color-mix(in srgb, ${me.primary} 20%, transparent)`:"transparent",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},onMouseEnter:()=>I(W),children:q.name},q.id)})]},`group-${K}`)),$.length===0&&E.trim()&&!d&&u.jsx("div",{style:{padding:"0.6rem 0.8rem",opacity:.6,fontStyle:"italic"},children:"No matching accounts"})]})]})}function xi({children:t,onSubmit:e,actionName:n}){function r(i){e(i)}return u.jsx("form",{onSubmit:r,style:w4,children:t})}function Pt({label:t,htmlFor:e,children:n,hint:r,style:i}){return u.jsxs("div",{style:{...S4,...i},children:[u.jsx("label",{htmlFor:e,style:E4,children:t}),n,r&&u.jsx("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.85rem",opacity:.6},children:r})]})}function wi(t){return u.jsx("input",{style:Na,...t})}function F4(t){if(!t)return"";try{return new Date(t+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"})}catch{return t}}function kf({value:t,onChange:e,style:n,autoFocus:r,...i}){const o=D.useRef(null),l=D.useRef(null),d=F4(t);D.useEffect(()=>{r&&l.current?.focus()},[r]);function h(){o.current?.showPicker?.()}function m(p){p.key==="Enter"&&(p.preventDefault(),o.current?.showPicker?.())}return u.jsxs("div",{style:{position:"relative"},children:[u.jsx("input",{ref:o,type:"date",value:t||"",onChange:e,style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",opacity:0,pointerEvents:"none"},...i}),u.jsx("div",{ref:l,tabIndex:0,onClick:h,onKeyDown:m,style:{...Na,cursor:"pointer",display:"flex",alignItems:"center",fontSize:"0.85rem",fontFamily:"monospace",color:t?"inherit":"color-mix(in srgb, currentColor 50%, transparent)",...n},children:d||"Select date"})]})}function $u({children:t,...e}){return u.jsx("select",{style:C4,...e,children:t})}function q0({minHeight:t="6rem",style:e,...n}){return u.jsx("textarea",{style:{...Na,width:"100%",minHeight:t,resize:"vertical",fontFamily:"inherit",boxSizing:"border-box",...e},...n})}function Pa({children:t}){return u.jsx("div",{style:I4,children:t})}function Vg(t){const n=t.replace(/[^\d.]/g,"").split("."),r=n[0]||"",i=n[1],o=r.replace(/\B(?=(\d{3})+(?!\d))/g,",");return i!==void 0?`$${o}.${i.slice(0,2)}`:o?`$${o}`:""}function V4(t){return t.replace(/[$,]/g,"")}function vo({id:t,value:e,onChange:n,placeholder:r="$0.00",required:i,autoFocus:o,style:l}){const[d,h]=D.useState(()=>Vg(e)),m=D.useRef(null);D.useEffect(()=>{const g=Vg(e);V4(d)!==e&&h(g)},[e]);function p(g){const v=g.target.value;if(!v||v==="$"){h(""),n("");return}const E=v.replace(/[^\d.]/g,"").split(".");let x=E[0];E.length>1&&(x+="."+E.slice(1).join("").slice(0,2));const S=Vg(x);h(S),n(x)}return u.jsx("input",{ref:m,id:t,type:"text",inputMode:"decimal",value:d,onChange:p,placeholder:r,required:i,autoFocus:o,style:{...Na,...l}})}function Ei(t=I6){const[e,n]=D.useState(()=>typeof window>"u"?!1:window.innerWidth<t);return D.useEffect(()=>{const r=window.matchMedia(`(max-width: ${t-1}px)`);function i(l){n(l.matches)}i(r),r.addEventListener("change",i);function o(){n(window.innerWidth<t)}return window.addEventListener("resize",o),()=>{r.removeEventListener("change",i),window.removeEventListener("resize",o)}},[t]),e}function OT(){const[t,e]=D.useState(()=>typeof window>"u"?1200:window.innerWidth);return D.useEffect(()=>{function n(){e(window.innerWidth)}return window.addEventListener("resize",n),n(),()=>window.removeEventListener("resize",n)},[]),{width:t,isWide:t>=yo.wide,isMedium:t>=yo.tablet&&t<yo.wide,isNarrowMedium:t>=yo.mobile&&t<yo.tablet,isMobile:t<yo.mobile}}function An(){const{selectedBudgetId:t,currentUserId:e}=Ye(),n=P6(t),r=n.data,i=r?.budget||null,o=D.useMemo(()=>r?.accounts||{},[r?.accounts]),l=D.useMemo(()=>r?.accountGroups||{},[r?.accountGroups]),d=D.useMemo(()=>r?.categories||{},[r?.categories]),h=D.useMemo(()=>r?.categoryGroups||[],[r?.categoryGroups]),m=i?.owner_id===e,p=D.useMemo(()=>i?.user_ids||[],[i?.user_ids]),g=D.useMemo(()=>i?.accepted_user_ids||[],[i?.accepted_user_ids]),v=i?.total_available??0,b=D.useMemo(()=>r?.monthMap||{},[r?.monthMap]),E=D.useCallback(O=>{if(!t)return;const U=Le.getQueryData(ke.budget(t));U&&Le.setQueryData(ke.budget(t),{...U,accounts:O})},[t]),x=D.useCallback(O=>{if(!t)return;const U=Le.getQueryData(ke.budget(t));U&&Le.setQueryData(ke.budget(t),{...U,accountGroups:O})},[t]),S=D.useCallback(O=>{if(!t)return;const U=Le.getQueryData(ke.budget(t));U&&Le.setQueryData(ke.budget(t),{...U,categories:O})},[t]),C=D.useCallback(O=>{if(!t)return;const U=Le.getQueryData(ke.budget(t));U&&Le.setQueryData(ke.budget(t),{...U,categoryGroups:O})},[t]),T=D.useCallback(async()=>{t&&await Le.invalidateQueries({queryKey:ke.budget(t)})},[t]),I=D.useCallback(()=>Object.entries(o).filter(([,O])=>{const U=O.account_group_id?l[O.account_group_id]:void 0,$=U&&U.on_budget!==null?U.on_budget:O.on_budget!==!1,k=U&&U.is_active!==null?U.is_active:O.is_active!==!1;return $&&k}).reduce((O,[,U])=>O+U.balance,0),[o,l]);return{isLoading:n.isLoading,isFetching:n.isFetching,error:n.error,budget:i,accounts:o,accountGroups:l,categories:d,categoryGroups:h,isOwner:m,budgetUserIds:p,acceptedUserIds:g,totalAvailable:v,monthMap:b,setAccountsOptimistic:E,setAccountGroupsOptimistic:x,setCategoriesOptimistic:S,setCategoryGroupsOptimistic:C,refreshBudget:T,getOnBudgetTotal:I}}function Ci(t,e,n){const{addLoadingHold:r,removeLoadingHold:i}=Gn(),o=Ft(),l=W6(t,e,n,{enabled:!!t});D.useEffect(()=>{const T=t?ke.month(t,e,n):null;return!(T?o.getQueryData(T):null)&&l.isLoading?r("month-query","Loading month data..."):i("month-query"),()=>i("month-query")},[l.isLoading,t,e,n,o,r,i]);const d=l.data?.month||null,h=D.useMemo(()=>d?.income||[],[d?.income]),m=D.useMemo(()=>d?.expenses||[],[d?.expenses]),p=D.useMemo(()=>d?.transfers||[],[d?.transfers]),g=D.useMemo(()=>d?.adjustments||[],[d?.adjustments]),v=D.useMemo(()=>d?.category_balances||[],[d?.category_balances]),b=D.useMemo(()=>d?.account_balances||[],[d?.account_balances]),E=d?.total_income||0,x=d?.total_expenses||0,S=d?.are_allocations_finalized||!1,C=d?.previous_month_income??0;return{isLoading:l.isLoading,isFetching:l.isFetching,error:l.error,month:d,income:h,expenses:m,transfers:p,adjustments:g,categoryBalances:v,accountBalances:b,totalIncome:E,totalExpenses:x,areAllocationsFinalized:S,previousMonthIncome:C}}const $4={trackChange:()=>{},clearChanges:()=>{},removeChange:()=>{},getChanges:()=>[],hasChanges:()=>!1,isSaving:!1,setIsSaving:()=>{},lastSaveTime:null,setLastSaveTime:()=>{},saveError:null,setSaveError:()=>{},clearSaveError:()=>{},syncError:null,setSyncError:()=>{}},NT=D.createContext($4);function q4({children:t}){const[e,n]=D.useState(new Map),[r,i]=D.useState(!1),[o,l]=D.useState(null),[d,h]=D.useState(null),[m,p]=D.useState(null),g=D.useCallback($=>{i($)},[]),v=D.useCallback($=>{l($)},[]),b=D.useCallback($=>{h($)},[]),E=D.useCallback($=>$.type==="month"&&$.year!==void 0&&$.month!==void 0?`${$.type}:${$.budgetId}:${$.year}:${$.month}`:`${$.type}:${$.budgetId}`,[]),x=D.useCallback($=>{n(k=>{const R=new Map(k),N=E($);return R.set(N,{...$,timestamp:Date.now()}),R})},[E]),S=D.useCallback(()=>{n(new Map)},[]),C=D.useCallback($=>{n(k=>{const R=new Map(k),N=E($);return R.delete(N),R})},[E]),T=D.useCallback(()=>Array.from(e.values()),[e]),I=D.useCallback(()=>e.size>0,[e]),O=D.useCallback(()=>{h(null)},[]),U={trackChange:x,clearChanges:S,removeChange:C,getChanges:T,hasChanges:I,isSaving:r,lastSaveTime:o,saveError:d,clearSaveError:O,setIsSaving:g,setLastSaveTime:v,setSaveError:b,syncError:m,setSyncError:p};return u.jsx(NT.Provider,{value:U,children:t})}function fc(){const t=D.useContext(NT);if(!t)throw new Error("useSync must be used within a SyncProvider");return t}function pm(){const{trackChange:t}=fc();return{updateBudgetCacheAndTrack:(n,r)=>{Le.setQueryData(ke.budget(n),r),t({type:"budget",budgetId:n})}}}function PT(){const t=Ft(),{currentViewingDocument:e}=Ye(),{saveCurrentDocument:n}=xn(),{updateBudgetCacheAndTrack:r}=pm(),i=Hn({onMutate:async l=>{const{budgetId:d,accounts:h}=l,m=ke.budget(d);await t.cancelQueries({queryKey:m});const p=t.getQueryData(m);if(p){const v={...p,accounts:h};r(d,v)}if(e.type==="budget")try{await n(d,"budget")}catch(v){console.warn("[useUpdateAccounts] Failed to save current document immediately:",v)}return{previousData:p}},mutationFn:async l=>{const{accounts:d}=l;return{accounts:d}},onError:(l,d,h)=>{h?.previousData&&t.setQueryData(ke.budget(d.budgetId),h.previousData)}});return{updateAccounts:{mutate:l=>i.mutate(l),mutateAsync:l=>i.mutateAsync(l),isPending:i.isPending,isError:i.isError,error:i.error,reset:i.reset}}}function H4(){const t=Ft(),{currentViewingDocument:e}=Ye(),{saveCurrentDocument:n}=xn(),{updateBudgetCacheAndTrack:r}=pm(),i=Hn({onMutate:async l=>{const{budgetId:d,accountGroups:h}=l,m=ke.budget(d);await t.cancelQueries({queryKey:m});const p=t.getQueryData(m);if(p){const v={...p,accountGroups:h};r(d,v)}if(e.type==="budget")try{await n(d,"budget")}catch(v){console.warn("[useUpdateAccountGroups] Failed to save current document immediately:",v)}return{previousData:p}},mutationFn:async l=>{const{accountGroups:d}=l;return{accountGroups:d}},onError:(l,d,h)=>{h?.previousData&&t.setQueryData(ke.budget(d.budgetId),h.previousData)}});return{updateAccountGroups:{mutate:l=>i.mutate(l),mutateAsync:l=>i.mutateAsync(l),isPending:i.isPending,isError:i.isError,error:i.error,reset:i.reset}}}function BT(){const t=Ft(),{currentViewingDocument:e}=Ye(),{saveCurrentDocument:n}=xn(),{updateBudgetCacheAndTrack:r}=pm(),i=Hn({onMutate:async l=>{const{budgetId:d,categories:h}=l,m=ke.budget(d);await t.cancelQueries({queryKey:m});const p=t.getQueryData(m);if(p){const v={...p,categories:h};r(d,v)}if(e.type==="budget")try{await n(d,"budget")}catch(v){console.warn("[useUpdateCategories] Failed to save current document immediately:",v)}return{previousData:p}},mutationFn:async l=>{const{categories:d}=l;return{categories:d}},onError:(l,d,h)=>{h?.previousData&&t.setQueryData(ke.budget(d.budgetId),h.previousData)}});return{updateCategories:{mutate:l=>i.mutate(l),mutateAsync:l=>i.mutateAsync(l),isPending:i.isPending,isError:i.isError,error:i.error,reset:i.reset}}}function G4(){const t=Ft(),{currentViewingDocument:e}=Ye(),{saveCurrentDocument:n}=xn(),{updateBudgetCacheAndTrack:r}=pm(),i=Hn({onMutate:async l=>{const{budgetId:d,categoryGroups:h}=l,m=ke.budget(d);await t.cancelQueries({queryKey:m});const p=t.getQueryData(m);if(p){const v={...p,categoryGroups:h};r(d,v)}if(e.type==="budget")try{await n(d,"budget")}catch(v){console.warn("[useUpdateCategoryGroups] Failed to save current document immediately:",v)}return{previousData:p}},mutationFn:async l=>{const{categoryGroups:d}=l;return{categoryGroups:d}},onError:(l,d,h)=>{h?.previousData&&t.setQueryData(ke.budget(d.budgetId),h.previousData)}});return{updateCategoryGroups:{mutate:l=>i.mutate(l),mutateAsync:l=>i.mutateAsync(l),isPending:i.isPending,isError:i.isError,error:i.error,reset:i.reset}}}async function gm(t){const{budgetId:e,updates:n,description:r}=t,i={...n,updated_at:new Date().toISOString()},o=Aa(i);await qn("budgets",e,o,r,{merge:!0});const l=Le.getQueryData(ke.budget(e));l&&Le.setQueryData(ke.budget(e),{...l,budget:{...l.budget,...n}})}function Q4(){const t=Ft(),e=Hn({onMutate:async r=>{const{budgetId:i,newName:o}=r,l=ke.budget(i);await t.cancelQueries({queryKey:l});const d=t.getQueryData(l);return d&&t.setQueryData(l,{...d,budget:{...d.budget,name:o.trim()}}),{previousData:d}},mutationFn:async r=>{const{budgetId:i,newName:o}=r,l=o.trim();return await gm({budgetId:i,updates:{name:l},description:`renaming budget to "${l}"`}),{newName:l}},onError:(r,i,o)=>{o?.previousData&&t.setQueryData(ke.budget(i.budgetId),o.previousData)}});return{renameBudget:{mutate:r=>e.mutate(r),mutateAsync:r=>e.mutateAsync(r),isPending:e.isPending,isError:e.isError,error:e.error,reset:e.reset}}}function W4({currentBudget:t,accounts:e,accountGroups:n,setAccountsOptimistic:r,setAccountGroupsOptimistic:i,saveAccounts:o,saveAccountGroups:l,setError:d}){const h=D.useCallback(async(p,g,v)=>{const b=e[p];if(!b)return;const E=v==="ungrouped"?Xt:v,x=Object.entries(e).filter(([,T])=>(T.account_group_id||"ungrouped")===v),S={};Object.entries(e).forEach(([T,I])=>{T!==p&&(S[T]={...I})});let C;if(g==="__group_end__"||x.length===0||!x.find(([T])=>T===g))C=(x.length>0?Math.max(...x.filter(([I])=>I!==p).map(([,I])=>I.sort_order)):-1)+1;else{const T=x.find(([I])=>I===g);if(T){const[,I]=T;C=I.sort_order,Object.entries(S).forEach(([O,U])=>{(U.account_group_id||"ungrouped")===v&&U.sort_order>=C&&(S[O]={...U,sort_order:U.sort_order+1})})}else C=0}if(S[p]={...b,account_group_id:E,sort_order:C},r(S),!!t)try{await o(S)}catch(T){d(T instanceof Error?T.message:"Failed to save changes")}},[t,e,r,o,d]),m=D.useCallback(async(p,g)=>{if(p===g)return;const v=Object.entries(n).sort(([,C],[,T])=>C.sort_order-T.sort_order),b=v.findIndex(([C])=>C===p),E=[...v],[x]=E.splice(b,1);if(g==="__end__")E.push(x);else{const C=E.findIndex(([T])=>T===g);E.splice(C,0,x)}const S={};if(E.forEach(([C,T],I)=>{S[C]={...T,sort_order:I}}),i(S),!!t)try{await l(S)}catch(C){d(C instanceof Error?C.message:"Failed to save new order")}},[t,n,i,l,d]);return{reorderAccountsInGroup:h,reorderGroups:m}}function K4(){const{selectedBudgetId:t}=Ye(),{budget:e,accounts:n,accountGroups:r,setAccountsOptimistic:i,setAccountGroupsOptimistic:o}=An(),{updateAccounts:l}=PT(),{updateAccountGroups:d}=H4(),[h,m]=D.useState(null),p=D.useCallback(async V=>{if(!t)throw new Error("No budget selected");await l.mutateAsync({budgetId:t,accounts:V})},[t,l]),g=D.useCallback(async V=>{if(!t)throw new Error("No budget selected");await d.mutateAsync({budgetId:t,accountGroups:V})},[t,d]),v=D.useCallback(async(V,H)=>{if(!t)throw new Error("No budget selected");await Promise.all([l.mutateAsync({budgetId:t,accounts:V}),d.mutateAsync({budgetId:t,accountGroups:H})])},[t,l,d]),b=D.useMemo(()=>Object.entries(n).filter(([,V])=>!V.is_hidden).reduce((V,[H,j])=>{const B=j.account_group_id||Xt;return V[B]||(V[B]=[]),V[B].push({...j,id:H}),V},{}),[n]),E=D.useMemo(()=>Object.entries(n).filter(([,V])=>V.is_hidden).map(([V,H])=>({...H,id:V})).sort((V,H)=>V.sort_order-H.sort_order),[n]),x=D.useMemo(()=>Object.entries(r).sort(([,V],[,H])=>V.sort_order-H.sort_order).map(([V,H])=>({...H,id:V})),[r]),S=D.useCallback((V,H)=>{if(!e)return;const j=H||Xt,B=Object.values(n).filter(W=>W.account_group_id===j),M=B.length>0?Math.max(...B.map(W=>W.sort_order)):-1,Z=`account_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,K={nickname:V.nickname,description:"",balance:0,account_group_id:j,sort_order:M+1,is_income_account:V.is_income_account??!1,is_income_default:V.is_income_default??!1,is_outgo_account:V.is_outgo_account??!1,is_outgo_default:V.is_outgo_default??!1,on_budget:V.on_budget!==!1,is_active:V.is_active!==!1,is_hidden:V.is_hidden??!1},q={...n};V.is_income_default&&Object.keys(q).forEach(W=>{q[W]={...q[W],is_income_default:!1}}),V.is_outgo_default&&Object.keys(q).forEach(W=>{q[W]={...q[W],is_outgo_default:!1}}),q[Z]=K,i(q),p(q).catch(W=>m(W instanceof Error?W.message:"Failed to create account."))},[e,n,i,p]),C=D.useCallback((V,H)=>{if(!e)return;const j=n[V];if(!j)return;const B=j.account_group_id||Xt,M=H.account_group_id||Xt;let Z=j.sort_order;if(B!==M){const q=Object.values(n).filter(W=>W.account_group_id===M);Z=q.length>0?Math.max(...q.map(W=>W.sort_order))+1:0}const K={};Object.entries(n).forEach(([q,W])=>{q===V?K[q]={...W,nickname:H.nickname,account_group_id:M,sort_order:Z,is_income_account:H.is_income_account??!1,is_income_default:H.is_income_default??!1,is_outgo_account:H.is_outgo_account??!1,is_outgo_default:H.is_outgo_default??!1,on_budget:H.on_budget!==!1,is_active:H.is_active!==!1,is_hidden:H.is_hidden??!1}:(K[q]={...W},H.is_income_default&&!j.is_income_default&&(K[q].is_income_default=!1),H.is_outgo_default&&!j.is_outgo_default&&(K[q].is_outgo_default=!1))}),i(K),p(K).catch(q=>m(q instanceof Error?q.message:"Failed to save account."))},[e,n,i,p]),T=D.useCallback(V=>{if(!confirm("Are you sure you want to delete this account?")||!e)return;const{[V]:H,...j}=n;i(j),p(j).catch(B=>m(B instanceof Error?B.message:"Failed to delete account."))},[e,n,i,p]),I=D.useCallback(async(V,H)=>{const j=n[V];if(!j)return;const B=j.account_group_id||Xt,M=Object.entries(n).filter(([,re])=>re.account_group_id===B).sort(([,re],[,z])=>re.sort_order-z.sort_order),Z=M.findIndex(([re])=>re===V),K=H==="up"?Z-1:Z+1;if(K<0||K>=M.length)return;const[q,W]=M[K],X={};if(Object.entries(n).forEach(([re,z])=>{re===V?X[re]={...z,sort_order:W.sort_order}:re===q?X[re]={...z,sort_order:j.sort_order}:X[re]={...z}}),i(X),!!e)try{await p(X)}catch(re){i(n),m(re instanceof Error?re.message:"Failed to move account")}},[e,n,i,p]),O=D.useCallback(V=>{if(!e)return;const H=Object.values(r).map(K=>K.sort_order),j=H.length>0?Math.max(...H):-1,B=`account_group_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,M={name:V.name,sort_order:j+1,expected_balance:V.expected_balance,on_budget:V.on_budget??null,is_active:V.is_active??null},Z={...r,[B]:M};o(Z),g(Z).catch(K=>m(K instanceof Error?K.message:"Failed to create account type."))},[e,r,o,g]),U=D.useCallback((V,H)=>{if(!e)return;const j={...r,[V]:{...r[V],name:H.name,expected_balance:H.expected_balance,on_budget:H.on_budget??null,is_active:H.is_active??null}};o(j),g(j).catch(B=>m(B instanceof Error?B.message:"Failed to update account type."))},[e,r,o,g]),$=D.useCallback(V=>{if(V===Xt){alert("Cannot delete the default Ungrouped account type.");return}if(!confirm("Are you sure you want to delete this account type? Accounts in this type will move to Ungrouped.")||!e)return;const H={};Object.entries(n).forEach(([M,Z])=>{H[M]=Z.account_group_id===V?{...Z,account_group_id:Xt}:Z});const{[V]:j,...B}=r;i(H),o(B),v(H,B).catch(M=>m(M instanceof Error?M.message:"Failed to delete account type."))},[e,n,r,i,o,v]),k=D.useCallback(async(V,H)=>{const j=Object.entries(r).sort(([,q],[,W])=>q.sort_order-W.sort_order),B=j.findIndex(([q])=>q===V),M=H==="up"?B-1:B+1;if(M<0||M>=j.length)return;const[Z]=j.splice(B,1);j.splice(M,0,Z);const K={};if(j.forEach(([q,W],X)=>{K[q]={...W,sort_order:X}}),o(K),!!e)try{await g(K)}catch(q){o(r),m(q instanceof Error?q.message:"Failed to move account type")}},[e,r,o,g]),{reorderAccountsInGroup:R,reorderGroups:N}=W4({currentBudget:e,accounts:n,accountGroups:r,setAccountsOptimistic:i,setAccountGroupsOptimistic:o,saveAccounts:p,saveAccountGroups:g,setError:m});return{accounts:n,accountGroups:r,accountsByGroup:b,hiddenAccounts:E,sortedGroups:x,currentBudget:e,error:h,setError:m,handleCreateAccount:S,handleUpdateAccount:C,handleDeleteAccount:T,handleMoveAccount:I,handleCreateGroup:O,handleUpdateGroup:U,handleDeleteGroup:$,handleMoveGroup:k,reorderAccountsInGroup:R,reorderGroups:N}}function I1(t,e){if(!t)return{};const n={};return Object.entries(e).forEach(([r,i])=>{if(i.default_monthly_type==="percentage")return;const o=t.category_balances?.find(l=>l.category_id===r);o&&o.allocated>0?n[r]=o.allocated.toString():i.default_monthly_amount!==void 0&&i.default_monthly_amount>0?n[r]=i.default_monthly_amount.toString():n[r]=""}),n}function Y4(){const{addLoadingHold:t,removeLoadingHold:e}=Gn(),{selectedBudgetId:n,currentYear:r,currentMonthNumber:i}=Ye(),{categories:o,getOnBudgetTotal:l,totalAvailable:d}=An(),{month:h,isLoading:m,previousMonthIncome:p,areAllocationsFinalized:g}=Ci(n,r,i),v=D.useMemo(()=>h?.income?h.income.reduce((z,G)=>z+G.amount,0):0,[h]),{saveDraftAllocations:b}=x4(),{finalizeAllocations:E}=CP(),{deleteAllocations:x}=YT(),S=D.useMemo(()=>I1(h,o),[h,o]),[C,T]=D.useState(S),[I,O]=D.useState(!1),[U,$]=D.useState(null),k=D.useRef(null);D.useMemo(()=>Object.values(o).reduce((z,G)=>z+(G.balance??0),0),[o]),D.useEffect(()=>{if(!h)return;const z=`${h.year}-${h.month}`;k.current!==z&&(O(!1),T(I1(h,o)),k.current=z)},[h,o]);const R=D.useCallback((z,G)=>{if(G.default_monthly_type==="percentage"&&G.default_monthly_amount!==void 0)return Me(G.default_monthly_amount/100*p);const te=C[z],se=parseFloat(te||"0");return isNaN(se)?0:Me(se)},[C,p]),N=D.useMemo(()=>Object.entries(o).reduce((z,[G,te])=>{const se=R(G,te),ie=te.balance??0;if(ie<0){const ce=Math.abs(ie),we=Math.max(0,se-ce);return z+we}return z+se},0),[o,R]),V=l(),H=g?(h?.category_balances||[]).reduce((z,G)=>{const te=o[G.category_id]?.balance??0,se=G.allocated,ie=te-se;if(ie<0){const ce=Math.abs(ie);return z+Math.max(0,se-ce)}return z+se},0):0,j=I?d+H:d,B=D.useMemo(()=>I?j-N:j-N+H,[j,N,H,I]),M=D.useCallback((z,G)=>{T(te=>({...te,[z]:G}))},[]),Z=D.useCallback(()=>{if(!h)return;const z={};Object.entries(o).forEach(([G,te])=>{if(te.default_monthly_type==="percentage")return;const se=h.category_balances?.find(ie=>ie.category_id===G);se&&se.allocated>0?z[G]=se.allocated.toString():te.default_monthly_amount!==void 0&&te.default_monthly_amount>0?z[G]=te.default_monthly_amount.toString():z[G]=""}),T(z),O(!1)},[h,o]),K=D.useCallback(()=>{const z={};return Object.entries(o).forEach(([G,te])=>{const se=R(G,te);se>0&&(z[G]=se)}),z},[o,R]),q=D.useCallback(async()=>{if(n){$(null),t("allocations-save","Saving allocations...");try{await b(n,r,i,K()),O(!1)}catch(z){$(z instanceof Error?z.message:"Failed to save allocations")}finally{e("allocations-save")}}},[n,r,i,b,K,t,e]),W=D.useCallback(async()=>{if(n){$(null),t("allocations-finalize","Applying allocations...");try{await E({budgetId:n,year:r,month:i,allocations:K(),onProgress:z=>{t("allocations-finalize",z.message)}}),O(!1)}catch(z){$(z instanceof Error?z.message:"Failed to finalize allocations")}finally{e("allocations-finalize")}}},[n,r,i,E,K,t,e]),X=D.useCallback(async()=>{if(n){$(null),t("allocations-delete","Deleting allocations...");try{await x({budgetId:n,year:r,month:i,onProgress:G=>{t("allocations-delete",G.message)}});const z={};Object.entries(o).forEach(([G,te])=>{te.default_monthly_type!=="percentage"&&(te.default_monthly_amount!==void 0&&te.default_monthly_amount>0?z[G]=te.default_monthly_amount.toString():z[G]="")}),T(z),O(!1)}catch(z){$(z instanceof Error?z.message:"Failed to delete allocations")}finally{e("allocations-delete")}}},[n,r,i,x,o,t,e]),re=N-H;return{localAllocations:C,isEditingAppliedAllocations:I,error:U,monthLoading:m,onBudgetTotal:V,availableNow:j,currentDraftTotal:N,draftChangeAmount:re,availableAfterApply:B,previousMonthIncome:p,currentMonthIncome:v,allocationsFinalized:g,getAllocationAmount:R,handleAllocationChange:M,resetAllocationsToSaved:Z,handleSaveAllocations:q,handleFinalizeAllocations:W,handleDeleteAllocations:X,setIsEditingAppliedAllocations:O,setError:$}}function X4({budgetId:t,categories:e,currentYear:n,currentMonth:r,updateCategoriesWithBalances:i}){const o=D.useMemo(()=>{const v={};return Object.entries(e).forEach(([b,E])=>{v[b]={current:E.balance??0,total:E.balance??0}}),v},[e]),[l,d]=D.useState(!1),[h,m]=D.useState(null),p=D.useCallback(async()=>{if(!t||Object.keys(e).length===0)return null;const v=Object.keys(e),{total:b}=await A1(t,v,n,r),E={};Object.entries(e).forEach(([S,C])=>{const T=C.balance,I=b[S]??0;Math.abs(T-I)>.01&&(E[S]={stored:T,calculated:I})});const x=Object.keys(E).length>0?E:null;return m(x),x},[t,e,n,r]),g=D.useCallback(async()=>{if(!(!t||Object.keys(e).length===0)){d(!0);try{const v=Object.keys(e),{total:b}=await A1(t,v,n,r),E={};Object.entries(e).forEach(([x,S])=>{E[x]={...S,balance:b[x]??0}}),await i(E),m(null)}finally{d(!1)}}},[t,e,i,n,r]);return{categoryBalances:o,loadingBalances:l,categoryBalanceMismatch:h,checkCategoryBalanceMismatch:p,recalculateAndSaveCategoryBalances:g}}function Z4({categories:t,categoryGroups:e,currentBudget:n,setCategoriesOptimistic:r,setCategoryGroupsOptimistic:i,saveCategories:o,saveCategoryGroups:l,setError:d}){const[h,m]=D.useState(null),[p,g]=D.useState(null),[v,b]=D.useState(null),[E,x]=D.useState(null);function S(R,N){m("category"),g(N),R.dataTransfer.effectAllowed="move"}function C(R,N,V){R.preventDefault(),h==="category"&&(N!==p&&b(N),x(V))}function T(R,N){R.preventDefault(),h==="category"&&(x(N),b(null))}function I(){b(null)}function O(){x(null)}function U(){m(null),g(null),b(null),x(null)}async function $(R,N,V){if(R.preventDefault(),R.stopPropagation(),!p||h!=="category"){U();return}const H=t[p];if(!H)return;const j=V==="ungrouped"?ln:V,B=Object.entries(t).filter(([,K])=>(K.category_group_id||"ungrouped")===V),M={};Object.entries(t).forEach(([K,q])=>{K!==p&&(M[K]=q)});let Z;if(N==="__group_end__"||B.length===0||!B.find(([K])=>K===N))Z=(B.length>0?Math.max(...B.filter(([q])=>q!==p).map(([,q])=>q.sort_order)):-1)+1;else{const K=B.find(([q])=>q===N);K?(Z=K[1].sort_order,Object.entries(M).forEach(([q,W])=>{(W.category_group_id||"ungrouped")===V&&W.sort_order>=Z&&(M[q]={...W,sort_order:W.sort_order+1})})):Z=0}if(M[p]={...H,category_group_id:j,sort_order:Z},r(M),U(),!!n)try{await o(M)}catch(K){d(K instanceof Error?K.message:"Failed to save changes")}}async function k(R,N){R.preventDefault(),h==="category"&&await $(R,"__group_end__",N)}return{dragType:h,draggedId:p,dragOverId:v,dragOverGroupId:E,setDragOverId:b,setDragOverGroupId:x,handleCategoryDragStart:S,handleCategoryDragOver:C,handleDragOverGroup:T,handleDragLeave:I,handleDragLeaveGroup:O,handleDragEnd:U,handleCategoryDrop:$,handleDropOnGroup:k}}function J4(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n}=Ye(),{budget:r,categories:i,categoryGroups:o,isLoading:l,setCategoriesOptimistic:d,setCategoryGroupsOptimistic:h,getOnBudgetTotal:m}=An(),{updateCategories:p}=BT(),{updateCategoryGroups:g}=G4(),[v,b]=D.useState(null),E=D.useCallback(async W=>{if(!t)throw new Error("No budget selected");await p.mutateAsync({budgetId:t,categories:W})},[t,p]),x=D.useCallback(async W=>{if(!t)throw new Error("No budget selected");await g.mutateAsync({budgetId:t,categoryGroups:W})},[t,g]),S=D.useCallback(async(W,X)=>{if(!t)throw new Error("No budget selected");await Promise.all([p.mutateAsync({budgetId:t,categories:W}),g.mutateAsync({budgetId:t,categoryGroups:X})])},[t,p,g]),{categoryBalances:C,loadingBalances:T,categoryBalanceMismatch:I,checkCategoryBalanceMismatch:O,recalculateAndSaveCategoryBalances:U}=X4({budgetId:t,categories:i,currentYear:e,currentMonth:n,updateCategoriesWithBalances:E}),$=Z4({categories:i,categoryGroups:o,currentBudget:r,setCategoriesOptimistic:d,setCategoryGroupsOptimistic:h,saveCategories:E,saveCategoryGroups:x,setError:b});async function k(W,X){if(!r)return;const re=X||ln,z=Object.values(i).filter(ce=>ce.category_group_id===re),G=z.length>0?Math.max(...z.map(ce=>ce.sort_order)):-1,te=`category_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,se={name:W.name,description:W.description??"",category_group_id:re,sort_order:G+1,default_monthly_amount:W.default_monthly_amount??0,default_monthly_type:W.default_monthly_type??"fixed",balance:0,is_hidden:W.is_hidden??!1},ie={...i,[te]:se};d(ie);try{await E(ie)}catch(ce){d(i),b(ce instanceof Error?ce.message:"Failed to create category")}}async function R(W,X){if(r)try{const re=i[W];if(!re)return;const z=re.category_group_id||ln,G=X.category_group_id||ln;let te=re.sort_order;if(z!==G){const ie=Object.values(i).filter(ce=>ce.category_group_id===G).filter((ce,we,he)=>i[W]!==he[we]);te=ie.length>0?Math.max(...ie.map(ce=>ce.sort_order))+1:0}const se={...i,[W]:{...re,name:X.name,description:X.description??"",category_group_id:G,sort_order:te,default_monthly_amount:X.default_monthly_amount??0,default_monthly_type:X.default_monthly_type??"fixed",is_hidden:X.is_hidden??!1}};d(se),await E(se)}catch(re){b(re instanceof Error?re.message:"Failed to update category")}}async function N(W){if(confirm("Are you sure you want to delete this category?")&&r)try{const{[W]:X,...re}=i;d(re),await E(re)}catch(X){b(X instanceof Error?X.message:"Failed to delete category")}}async function V(W,X){const re=i[W];if(!re)return;const z=re.category_group_id||ln,G=Object.entries(i).filter(([,he])=>he.category_group_id===z).sort((he,Ee)=>he[1].sort_order-Ee[1].sort_order),te=G.findIndex(([he])=>he===W),se=X==="up"?te-1:te+1;if(se<0||se>=G.length)return;const[ie,ce]=G[se],we={};if(Object.entries(i).forEach(([he,Ee])=>{he===W?we[he]={...Ee,sort_order:ce.sort_order}:he===ie?we[he]={...Ee,sort_order:re.sort_order}:we[he]=Ee}),d(we),!!r)try{await E(we)}catch(he){d(i),b(he instanceof Error?he.message:"Failed to move category")}}async function H(W){if(r)try{const X=o.length>0?Math.max(...o.map(G=>G.sort_order)):-1,re={id:`category_group_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,name:W.name,sort_order:X+1},z=[...o,re];h(z),await x(z)}catch(X){b(X instanceof Error?X.message:"Failed to create group")}}async function j(W,X){if(r)try{const re=o.map(z=>z.id===W?{...z,name:X.name}:z);h(re),await x(re)}catch(re){b(re instanceof Error?re.message:"Failed to update group")}}async function B(W){if(W===ln){alert("Cannot delete the default Uncategorized category group.");return}if(confirm("Are you sure you want to delete this group? Categories in this group will move to Uncategorized.")&&r)try{const X={};Object.entries(i).forEach(([z,G])=>{X[z]=G.category_group_id===W?{...G,category_group_id:ln}:G});const re=o.filter(z=>z.id!==W);d(X),h(re),await S(X,re)}catch(X){b(X instanceof Error?X.message:"Failed to delete group")}}async function M(W,X){const re=[...o].sort((ie,ce)=>ie.sort_order-ce.sort_order),z=re.findIndex(ie=>ie.id===W),G=X==="up"?z-1:z+1;if(G<0||G>=re.length)return;const[te]=re.splice(z,1);re.splice(G,0,te);const se=re.map((ie,ce)=>({...ie,sort_order:ce}));if(h(se),!!r)try{await x(se)}catch(ie){h(o),b(ie instanceof Error?ie.message:"Failed to move group")}}const Z=Object.entries(i).filter(([,W])=>!W.is_hidden).reduce((W,[X,re])=>{const z=re.category_group_id||ln;return W[z]||(W[z]=[]),W[z].push([X,re]),W},{}),K=Object.entries(i).filter(([,W])=>W.is_hidden).map(([W,X])=>[W,X]).sort((W,X)=>W[1].sort_order-X[1].sort_order),q=[...o].sort((W,X)=>W.sort_order-X.sort_order);return{currentBudget:r,categories:i,categoryGroups:o,categoriesByGroup:Z,hiddenCategories:K,sortedGroups:q,categoryBalances:C,isLoading:l,loadingBalances:T,error:v,setError:b,getOnBudgetTotal:m,categoryBalanceMismatch:I,checkCategoryBalanceMismatch:O,recalculateAndSaveCategoryBalances:U,handleCreateCategory:k,handleUpdateCategory:R,handleDeleteCategory:N,handleMoveCategory:V,handleCreateGroup:H,handleUpdateGroup:j,handleDeleteGroup:B,handleMoveGroup:M,dragType:$.dragType,draggedId:$.draggedId,dragOverId:$.dragOverId,dragOverGroupId:$.dragOverGroupId,setDragOverId:$.setDragOverId,setDragOverGroupId:$.setDragOverGroupId,handleCategoryDragStart:$.handleCategoryDragStart,handleCategoryDragOver:$.handleCategoryDragOver,handleDragOverGroup:$.handleDragOverGroup,handleDragLeave:$.handleDragLeave,handleDragLeaveGroup:$.handleDragLeaveGroup,handleDragEnd:$.handleDragEnd,handleCategoryDrop:$.handleCategoryDrop,handleDropOnGroup:$.handleDropOnGroup}}function e3(t){switch(t.phase){case"reading-budget":return"Reading budget data...";case"fetching-months":return t.totalMonthsToFetch?`Loading ${t.totalMonthsToFetch} months...`:"Loading months...";case"recalculating":return t.currentMonth?`Recalculating ${t.currentMonth}...`:"Recalculating balances...";case"saving":return t.totalMonths?`Saving ${t.totalMonths} months...`:"Saving results...";case"complete":return"Recalculation complete!";default:return"Recalculating..."}}function od({budgetId:t,year:e,month:n,monthMap:r,checkAnyMonth:i=!1,requireMonthLoaded:o=!1,currentMonth:l,additionalCondition:d=!0,onProgress:h,onError:m,logPrefix:p="[AutoRecalc]"}){const[g,v]=D.useState(null),b=D.useRef(!1),E=D.useRef(null),x=D.useRef(null),S=On(),C=D.useRef(null),{addLoadingHold:T,removeLoadingHold:I}=Gn();return D.useEffect(()=>{if(!t||!d||o&&!l)return;let O;const U=S.pathname;if(i){C.current!==U&&(E.current=null,C.current=U);const R=xT(r);if(R.length===0||b.current||(O=`any-${R[0]}`,E.current===O))return}else{if(e===void 0||n===void 0){console.warn(`${p} year and month are required when checkAnyMonth is false`);return}const R=vt(e,n),N=r[R]?.needs_recalculation===!0;if(O=`${e}-${n}`,(C.current!==U||x.current!==O)&&(E.current=null,C.current=U,x.current=O),E.current===O)return;if(!N||b.current){E.current=O;return}`${e}${String(n).padStart(2,"0")}`}b.current=!0,E.current=O;const $=`recalc-${t}`;T($,"Recalculating balances..."),f4(t,{onProgress:R=>{v(R);const N=e3(R);T($,N),h?.(R)}}).then(()=>{Le.invalidateQueries({queryKey:["month",t]})}).catch(R=>{const N=R instanceof Error?R:new Error(String(R));m?m(N):console.error(`${p} Recalculation failed:`,N)}).finally(()=>{b.current=!1,v(null),I($)})},[t,e,n,r,i,o,l,d,h,m,p,S.pathname,T,I]),{recalcProgress:g,isRecalculating:g!==null}}function t3(t,e,n,r){return{budget_id:e,year_month_ordinal:t.year_month_ordinal??vt(n,r),year:t.year??n,month:t.month??r,income:t.income||[],total_income:t.total_income??0,previous_month_income:t.previous_month_income??0,expenses:t.expenses||[],total_expenses:t.total_expenses??0,transfers:t.transfers||[],adjustments:t.adjustments||[],account_balances:t.account_balances||[],category_balances:t.category_balances||[],are_allocations_finalized:t.are_allocations_finalized??!1,created_at:t.created_at,updated_at:t.updated_at}}async function n3(t){const e=new Date,n=e.getFullYear(),r=e.getMonth()+1;let i=n,o=r-3;for(;o<=0;)o+=12,i-=1;const l=vt(i,o);return(await Dn("months","useInitialDataLoad: loading initial months",[{field:"budget_id",op:"==",value:t},{field:"year_month_ordinal",op:">=",value:l}])).docs.map(m=>{const p=m.data,g=p.year,v=p.month;return t3(p,t,g,v)}).sort((m,p)=>m.year!==p.year?m.year-p.year:m.month-p.month)}async function r3(t){const[e,n,r]=await Promise.all([M0(t),N0(t),n3(t)]);return{budget:e,payees:n,months:r}}function s3(t,e){return ko({queryKey:t?["initialDataLoad",t]:["initialDataLoad","none"],queryFn:()=>r3(t),enabled:!!t&&e?.enabled!==!1,staleTime:1/0})}async function i3(t,e,n,r){const i=ke.month(t,e,n),o=r.getQueryData(i);if(!o?.month)throw new Error(`Month ${e}/${n} not found in cache`);const l=o.month,d=await a3(t,e,n,r),h=z0(l,d);return r.setQueryData(i,{month:h}),h}async function a3(t,e,n,r){const{year:i,month:o}=Xl(e,n),l=ke.month(t,i,o),d=r.getQueryData(l);if(d?.month)return Fu(d.month);try{const h=await O0(t,i,o);if(h)return r.setQueryData(l,{month:h}),Fu(h)}catch(h){console.warn(`[useLocalRecalculation] Could not fetch previous month ${i}/${o}:`,h)}return B0}function o3(){const t=On(),{saveAllChanges:e}=xn(),{hasChanges:n}=fc(),r=D.useRef(null);D.useEffect(()=>{const i=t.pathname;if(r.current===null){r.current=i;return}r.current!==i&&n()&&queueMicrotask(()=>{e("navigation save (page change)").catch(o=>{console.error("[useNavigationSave] Failed to save on navigation:",o)})}),r.current=i},[t.pathname,n,e])}const k1=300*1e3;function l3(t,e,n,r){return{budget_id:e,year_month_ordinal:t.year_month_ordinal??vt(n,r),year:t.year??n,month:t.month??r,income:t.income||[],total_income:t.total_income??0,previous_month_income:t.previous_month_income??0,expenses:t.expenses||[],total_expenses:t.total_expenses??0,transfers:t.transfers||[],adjustments:t.adjustments||[],account_balances:t.account_balances||[],category_balances:t.category_balances||[],are_allocations_finalized:t.are_allocations_finalized??!1,created_at:t.created_at,updated_at:t.updated_at}}function D1(t,e){return e?t?new Date(e)>new Date(t):!0:!1}async function c3(t,e){const n=[],r=new Date,i=r.getFullYear(),o=r.getMonth()+1;let l=i,d=o-3;for(;d<=0;)d+=12,l-=1;const h=vt(l,d),[m,p,g]=await Promise.all([Le.fetchQuery({queryKey:ke.budget(t),queryFn:()=>M0(t),staleTime:0}).catch(()=>null),Le.fetchQuery({queryKey:ke.payees(t),queryFn:()=>N0(t),staleTime:0}).catch(()=>null),Dn("months","useSyncCheck: checking for remote changes",[{field:"budget_id",op:"==",value:t},{field:"year_month_ordinal",op:">=",value:h}]).catch(()=>({docs:[]}))]);if(m){const b=Le.getQueryData(ke.budget(t));if(b){const E=b.budget?.updated_at;D1(E,m.budget.updated_at)&&(e.some(S=>S.type==="budget"&&S.budgetId===t)?n.push("Budget document has been updated remotely (you have unsaved local changes)"):Le.setQueryData(ke.budget(t),m))}}p!==null&&Le.getQueryData(ke.payees(t));const v=g.docs.map(b=>{const E=b.data,x=E.year,S=E.month;return l3(E,t,x,S)});for(const b of v){const E=Le.getQueryData(ke.month(t,b.year,b.month));E?.month&&D1(E.month.updated_at,b.updated_at)&&(e.some(S=>S.type==="month"&&S.budgetId===t&&S.year===b.year&&S.month===b.month)?n.push(`Month ${b.year}/${b.month} has been updated remotely (you have unsaved local changes)`):Le.setQueryData(ke.month(t,b.year,b.month),{month:b}))}return n}function u3(t,e){const{setSyncError:n,getChanges:r}=fc(),i=D.useRef(null),o=D.useRef(null),l=D.useRef(0),d=D.useRef(!1);D.useEffect(()=>{if(!t||!e||d.current)return;d.current=!0;const h=async()=>{try{const m=r(),p=await c3(t,m);if(p.length>0){const g=`Sync conflict detected: ${p.join("; ")}`;n(g),mr.add({type:"error",message:g,autoDismissMs:0})}else n(null)}catch(m){console.error("[useSyncCheck] Sync check failed:",m);const p=`Failed to check for sync conflicts: ${m instanceof Error?m.message:String(m)}`;n(p),mr.add({type:"error",message:p,autoDismissMs:0})}};return o.current=setTimeout(()=>{h(),l.current=Date.now(),i.current=setInterval(()=>{h(),l.current=Date.now()},k1)},k1),()=>{o.current&&clearTimeout(o.current),i.current&&clearInterval(i.current),d.current=!1}},[t,e,n,r])}function d3(t,e,n){const r=Ft(),i=D.useRef(null),o=D.useRef(null);D.useEffect(()=>{if(i.current===null||o.current===null){i.current=e,o.current=n;return}if(i.current===e&&o.current===n)return;if(!t){i.current=e,o.current=n;return}const l=vt(i.current,o.current),m=vt(e,n)>l?bT(e,n):Xl(e,n),p=ke.month(t,m.year,m.month);if(!r.getQueryData(p)){const v=r.getQueryData(ke.budget(t)),b=vt(m.year,m.month);v?.monthMap&&b in v.monthMap&&r.prefetchQuery({queryKey:p,queryFn:async()=>{const x=await O0(t,m.year,m.month);return x?{month:x}:null},staleTime:ac}).catch(x=>{console.warn(`[useMonthPrefetch] Failed to prefetch month ${m.year}/${m.month}:`,x)})}i.current=e,o.current=n},[t,e,n,r])}function Ia(){Le.removeQueries({queryKey:["budget"]}),Le.removeQueries({queryKey:["month"]}),Le.removeQueries({queryKey:["accessibleBudgets"]}),Le.removeQueries({queryKey:["payees"]}),Le.removeQueries({queryKey:["user"]}),console.log("[Migration] All caches cleared")}async function ym(t){try{const e=await t();return Ia(),e}catch(e){throw Ia(),e}}const zT=D.createContext(null),M1={isOpen:!1,migrationName:"",stage:"",progress:null,currentItem:null,details:null,isComplete:!1,error:null};function h3({children:t}){const[e,n]=D.useState(M1),r=D.useCallback(()=>({setStage:d=>{n(h=>({...h,stage:d}))},setProgress:d=>{n(h=>({...h,progress:d}))},setCurrentItem:d=>{n(h=>({...h,currentItem:d}))},setDetails:d=>{n(h=>({...h,details:d}))},updateItemProgress:(d,h,m)=>{const p=h>0?Math.round(d/h*100):0;n(g=>({...g,progress:p,currentItem:m||`Item ${d} of ${h}`,details:`${d} / ${h} complete`}))}}),[]),i=D.useCallback(async(d,h)=>{n({isOpen:!0,migrationName:d,stage:"Starting migration...",progress:null,currentItem:null,details:null,isComplete:!1,error:null});const m=r();try{const p=await h(m);return Ia(),n(g=>({...g,isComplete:!0,stage:"Migration complete",progress:100,details:p.errors.length>0?`Completed with ${p.errors.length} error(s)`:"All operations successful"})),p}catch(p){Ia();const g=p instanceof Error?p.message:"Unknown error occurred";throw n(v=>({...v,isComplete:!0,error:g,stage:"Migration failed",progress:null})),p}},[r]),o=D.useCallback(()=>{n(d=>d.isComplete?M1:(console.warn("[MigrationProgress] Cannot close modal while migration is running"),d))},[]),l={state:e,runMigrationWithProgress:i,closeModal:o};return u.jsx(zT.Provider,{value:l,children:t})}function f3(){const t=D.useContext(zT);if(!t)throw new Error("useMigrationProgress must be used within MigrationProgressProvider");return t}async function m3(t){return(await Dn("budgets",`${t}: batch reading all budgets`)).docs.map(n=>({id:n.id,data:n.data}))}async function LT(t,e){return(await Dn("months",`${e}: batch reading months for budget ${t}`,[{field:"budget_id",op:"==",value:t}])).docs.map(i=>({id:i.id,data:i.data,budgetId:i.data.budget_id,year:i.data.year,month:i.data.month})).sort((i,o)=>i.year!==o.year?i.year-o.year:i.month-o.month)}async function Ba(t){const e=await m3(t),n=await Dn("months",`${t}: batch reading all months`),r=new Map;for(const i of n.docs){const o=i.data.budget_id,l={id:i.id,data:i.data,budgetId:o,year:i.data.year,month:i.data.month};r.has(o)||r.set(o,[]),r.get(o).push(l)}for(const i of r.values())i.sort((o,l)=>o.year!==l.year?o.year-l.year:o.month-l.month);return{budgets:e,monthsByBudget:r}}async function ld(t,e){if(t.length===0)return;const n=t.map(r=>({collectionPath:"months",docId:hs(r.budgetId,r.year,r.month),data:Aa({...r.data,updated_at:new Date().toISOString()})}));await dm(n,`${e}: batch writing ${t.length} months`)}async function UT(t,e){if(t.length===0)return;const n=t.map(r=>({collectionPath:"budgets",docId:r.budgetId,data:Aa({...r.data,updated_at:new Date().toISOString()})}));await dm(n,`${e}: batch writing ${t.length} budgets`)}async function FT(t,e,n){if(e.length===0)return;let r=B0;const i=[];for(const p of e){const g=z0(p,r);i.push(g),r=Fu(g)}const o=i.map(p=>({budgetId:t,year:p.year,month:p.month,data:p}));await ld(o,n);const l=r.accountEndBalances,d=r.categoryEndBalances,{exists:h,data:m}=await At("budgets",t,`${n}: reading budget for final update`);if(h&&m){const p=vT(m.month_map||{}),g=L0(p),v={...d},b=m.categories||{};for(const E of Object.keys(b))E in v||(v[E]=0);await wT(t,l,v,g)}}async function p3(t,e){if(t.length===0)return;const n=new Map;for(const r of t)n.has(r.budgetId)||n.set(r.budgetId,[]),n.get(r.budgetId).push(r);for(const[r,i]of n){i.sort((d,h)=>d.year!==h.year?d.year-h.year:d.month-h.month),await ld(i,e);const l=(await LT(r,e)).map(d=>d.data);await FT(r,l,e)}}async function g3(t){const{exists:e,data:n}=await At("budgets",t,`[delete all months] reading budget ${t} for reset`);if(!e||!n)return;const r={...n.accounts};for(const o of Object.keys(r))r[o]&&typeof r[o]=="object"&&(r[o]={...r[o],balance:0});const i={...n.categories};for(const o of Object.keys(i))i[o]&&typeof i[o]=="object"&&(i[o]={...i[o],balance:0});await qn("budgets",t,{...n,accounts:r,categories:i,month_map:{},total_available:0,is_needs_recalculation:!1,updated_at:new Date().toISOString()},`[delete all months] resetting budget ${t} balances to zero`)}function y3({currentUser:t,onComplete:e}){const[n,r]=D.useState(!1),[i,o]=D.useState(!1),[l,d]=D.useState(null),[h,m]=D.useState(null),[p,g]=D.useState(null);async function v(){if(t){r(!0);try{const E=await Dn("months","delete all months: scanning for all months"),x=[],S=new Set;for(const C of E.docs){const{budget_id:T,year:I,month:O}=C.data;S.add(T),x.push({docId:C.id,budgetId:T,year:I,month:O})}x.sort((C,T)=>C.budgetId!==T.budgetId?C.budgetId.localeCompare(T.budgetId):C.year!==T.year?C.year-T.year:C.month-T.month),d({monthsToDelete:x,monthsCount:x.length,budgetCount:S.size})}catch{}finally{r(!1)}}}async function b(){if(!t||!l||l.monthsToDelete.length===0)return;o(!0),m(null);const E=l.monthsToDelete.length,x=new Set,S=[];for(const U of l.monthsToDelete)x.add(U.budgetId);g({phase:"deleting",deleted:0,total:E,currentMonth:null,budgetsRecalculated:0,totalBudgets:l.budgetCount,percentComplete:0});const C=l.monthsToDelete.map(U=>({collectionPath:"months",docId:U.docId}));let T=0;try{await _T(C,"delete all months: batch deleting all month documents",U=>{T=U,g({phase:"deleting",deleted:U,total:E,currentMonth:`Batch ${Math.ceil(U/500)} of ${Math.ceil(E/500)}`,budgetsRecalculated:0,totalBudgets:l.budgetCount,percentComplete:Math.round(U/E*70)})}),T=E}catch(U){S.push(`Batch delete failed: ${U instanceof Error?U.message:"Unknown error"}`)}const I=Array.from(x);let O=0;for(const U of I){g({phase:"resetting-budgets",deleted:T,total:E,currentMonth:`Budget ${O+1}/${I.length}`,budgetsRecalculated:O,totalBudgets:I.length,percentComplete:70+Math.round(O/I.length*25)});try{await g3(U),O++}catch{O++}}g({phase:"clearing-cache",deleted:T,total:E,currentMonth:null,budgetsRecalculated:O,totalBudgets:I.length,percentComplete:95}),Ia(),g({phase:"complete",deleted:T,total:E,currentMonth:null,budgetsRecalculated:O,totalBudgets:I.length,percentComplete:100}),m({deleted:T,errors:S,budgetsRecalculated:O}),o(!1),g(null),S.length===0&&(d({monthsToDelete:[],monthsCount:0,budgetCount:0}),e?.())}return{status:l,isScanning:n,scanStatus:v,isDeleting:i,deleteResult:h,deleteProgress:p,deleteAllMonths:b}}const $g="sample@sample.com",mo="budget_1767746876726_xuj7nzl4l";function _3({currentUser:t,onComplete:e}){const[n,r]=D.useState(!1),[i,o]=D.useState(!1),[l,d]=D.useState(null),[h,m]=D.useState(null),[p,g]=D.useState(null);async function v(){if(t){r(!0);try{let x=(await Dn("budgets","delete sample user budget: scanning for sample user budgets",[{field:"owner_email",op:"==",value:$g}])).docs;if(x.length===0){console.log("delete sample user budget: no budgets found by owner_email, checking fallback budget ID");const U=await At("budgets",mo,"delete sample user budget: checking fallback budget ID");U.exists&&U.data&&(console.log("delete sample user budget: found fallback budget",mo),x=[{id:mo,data:U.data}])}const S=[];let C=0,T=!1;for(const U of x){const $=U.id,k=U.data.name,N=(await Dn("months",`delete sample user budget: counting months for budget ${$}`,[{field:"budget_id",op:"==",value:$}])).docs.length;C+=N,S.push({budgetId:$,budgetName:k,monthCount:N}),(await Dn("payees",`delete sample user budget: checking payees for budget ${$}`,[{field:"budget_id",op:"==",value:$}])).docs.length>0&&(T=!0)}const I=[],O=await Dn("users","delete sample user budget: finding sample user document",[{field:"email",op:"==",value:$g}]);O.docs.length>0&&O.docs[0].data.budget_ids?.includes(mo)&&(S.some(R=>R.budgetId===mo)||(console.log("delete sample user budget: found stale budget reference in sample user document",mo),I.push(mo))),d({budgets:S,totalBudgets:S.length,totalMonths:C,hasPayees:T,staleBudgetIds:I})}catch(E){console.error("Error scanning for sample user budgets:",E)}finally{r(!1)}}}async function b(){if(!t||!l||l.budgets.length===0&&l.staleBudgetIds.length===0)return;o(!0),m(null);const E=[];let x=0,S=0,C=0;const T=l.totalMonths,I=l.totalBudgets;g({phase:"deleting-months",monthsDeleted:0,totalMonths:T,budgetsDeleted:0,totalBudgets:I,percentComplete:0});for(const U of l.budgets)try{const k=(await Dn("months",`delete sample user budget: fetching month IDs for budget ${U.budgetId}`)).docs.filter(R=>R.data.budget_id===U.budgetId).map(R=>({collectionPath:"months",docId:R.id}));k.length>0&&(await _T(k,`delete sample user budget: deleting ${k.length} months for budget ${U.budgetId}`,R=>{x=R,g({phase:"deleting-months",monthsDeleted:x,totalMonths:T,budgetsDeleted:S,totalBudgets:I,percentComplete:Math.round(x/Math.max(T,1)*60)})}),x=k.length)}catch($){E.push(`Failed to delete months for budget ${U.budgetId}: ${$ instanceof Error?$.message:"Unknown error"}`)}g({phase:"deleting-payees",monthsDeleted:x,totalMonths:T,budgetsDeleted:S,totalBudgets:I,percentComplete:60});for(const U of l.budgets)try{await Ry("payees",U.budgetId,`delete sample user budget: deleting payees for budget ${U.budgetId}`),C++}catch{}g({phase:"deleting-budgets",monthsDeleted:x,totalMonths:T,budgetsDeleted:S,totalBudgets:I,percentComplete:70});for(const U of l.budgets)try{await Ry("budgets",U.budgetId,`delete sample user budget: deleting budget ${U.budgetId}`),S++,g({phase:"deleting-budgets",monthsDeleted:x,totalMonths:T,budgetsDeleted:S,totalBudgets:I,percentComplete:70+Math.round(S/I*10)})}catch($){E.push(`Failed to delete budget ${U.budgetId}: ${$ instanceof Error?$.message:"Unknown error"}`)}g({phase:"updating-user",monthsDeleted:x,totalMonths:T,budgetsDeleted:S,totalBudgets:I,percentComplete:80});const O=[...l.budgets.map(U=>U.budgetId),...l.staleBudgetIds];try{const U=await Dn("users","delete sample user budget: finding sample user document to remove budget references",[{field:"email",op:"==",value:$g}]);if(U.docs.length>0){const $=U.docs[0],k=$.id,R=$.data,N=(R.budget_ids||[]).filter(V=>!O.includes(V));await qn("users",k,{...R,budget_ids:N,updated_at:new Date().toISOString()},"delete sample user budget: removing deleted budget IDs from sample user document"),console.log(`delete sample user budget: removed ${O.length} budget IDs from sample user document`)}else console.log("delete sample user budget: no sample user document found, skipping user update")}catch(U){E.push(`Failed to update sample user document: ${U instanceof Error?U.message:"Unknown error"}`)}g({phase:"clearing-cache",monthsDeleted:x,totalMonths:T,budgetsDeleted:S,totalBudgets:I,percentComplete:95}),Ia(),g({phase:"complete",monthsDeleted:x,totalMonths:T,budgetsDeleted:S,totalBudgets:I,percentComplete:100}),m({budgetsDeleted:S,monthsDeleted:x,payeesDeleted:C,errors:E}),o(!1),g(null),E.length===0&&(d({budgets:[],totalBudgets:0,totalMonths:0,hasPayees:!1,staleBudgetIds:[]}),e?.())}return{status:l,isScanning:n,scanStatus:v,isDeleting:i,deleteResult:h,deleteProgress:p,deleteSampleUserBudget:b}}function O1(t){if(!t)return 0;let e=0;for(const n of t)ct(n.start_balance??0)&&e++,ct(n.end_balance??0)&&e++,ct(n.allocated??0)&&e++,ct(n.spent??0)&&e++,ct(n.income??0)&&e++,ct(n.expenses??0)&&e++,ct(n.net_change??0)&&e++;return e}function N1(t){if(!t)return 0;let e=0;for(const n of t)ct(n.amount??0)&&e++;return e}async function P1(){const t=await Dn("budgets","precision cleanup: scanning all budgets");let e=0,n=0,r=0,i=0;for(const g of t.docs){const v=g.data;let b=!1;ct(v.total_available??0)&&(i++,b=!0);const E=v.accounts;if(E&&typeof E=="object")for(const S of Object.values(E))ct(S.balance??0)&&(n++,b=!0);const x=v.categories;if(x&&typeof x=="object")for(const S of Object.values(x))ct(S.balance??0)&&(r++,b=!0),ct(S.default_monthly_amount??0)&&(r++,b=!0);b&&e++}const o=await Dn("months","precision cleanup: scanning all months");let l=0,d=0,h=0,m=0,p=0;for(const g of o.docs){const v=g.data;let b=!1;(ct(v.total_income??0)||ct(v.total_expenses??0)||ct(v.previous_month_income??0))&&(b=!0);const E=N1(v.income);E>0&&(d+=E,b=!0);const x=N1(v.expenses);x>0&&(h+=x,b=!0);const S=O1(v.category_balances);S>0&&(m+=S,b=!0);const C=O1(v.account_balances);C>0&&(p+=C,b=!0),b&&l++}return{totalBudgets:t.docs.length,budgetsWithPrecisionIssues:e,accountsWithPrecisionIssues:n,categoriesWithPrecisionIssues:r,totalAvailableWithPrecisionIssues:i,totalMonths:o.docs.length,monthsWithPrecisionIssues:l,incomeValuesWithPrecisionIssues:d,expenseValuesWithPrecisionIssues:h,categoryBalancesWithPrecisionIssues:m,accountBalancesWithPrecisionIssues:p}}function B1(t){const e={...t};return e.start_balance!==void 0&&(e.start_balance=Me(e.start_balance)),e.end_balance!==void 0&&(e.end_balance=Me(e.end_balance)),e.allocated!==void 0&&(e.allocated=Me(e.allocated)),e.spent!==void 0&&(e.spent=Me(e.spent)),e.income!==void 0&&(e.income=Me(e.income)),e.expenses!==void 0&&(e.expenses=Me(e.expenses)),e.transfers!==void 0&&(e.transfers=Me(e.transfers)),e.adjustments!==void 0&&(e.adjustments=Me(e.adjustments)),e.net_change!==void 0&&(e.net_change=Me(e.net_change)),e}function b3(t,e){let n=!1;ct(t.total_available??0)&&(t.total_available=Me(t.total_available??0),e.totalAvailableFixed++,n=!0);const r=t.accounts;if(r&&typeof r=="object")for(const[o,l]of Object.entries(r)){const d=l;ct(d.balance??0)&&(r[o].balance=Me(d.balance??0),e.accountsFixed++,n=!0)}const i=t.categories;if(i&&typeof i=="object")for(const[o,l]of Object.entries(i)){const d=l;ct(d.balance??0)&&(i[o].balance=Me(d.balance??0),e.categoriesFixed++,n=!0),ct(d.default_monthly_amount??0)&&(i[o].default_monthly_amount=Me(d.default_monthly_amount??0),e.categoriesFixed++,n=!0)}return{fixed:n,data:t}}function v3(t,e){let n=!1;if(ct(t.total_income??0)&&(t.total_income=Me(t.total_income??0),n=!0),ct(t.total_expenses??0)&&(t.total_expenses=Me(t.total_expenses??0),n=!0),ct(t.previous_month_income??0)&&(t.previous_month_income=Me(t.previous_month_income??0),n=!0),t.income&&Array.isArray(t.income)){const r=[];for(const i of t.income)ct(i.amount??0)?(r.push({...i,amount:Me(i.amount??0)}),e.incomeValuesFixed++,n=!0):r.push(i);t.income=r}if(t.expenses&&Array.isArray(t.expenses)){const r=[];for(const i of t.expenses)ct(i.amount??0)?(r.push({...i,amount:Me(i.amount??0)}),e.expenseValuesFixed++,n=!0):r.push(i);t.expenses=r}if(t.category_balances&&Array.isArray(t.category_balances)){const r=[];for(const i of t.category_balances)ct(i.start_balance??0)||ct(i.end_balance??0)||ct(i.allocated??0)||ct(i.spent??0)||ct(i.transfers??0)||ct(i.adjustments??0)?(r.push(B1(i)),e.categoryBalancesFixed++,n=!0):r.push(i);t.category_balances=r}if(t.account_balances&&Array.isArray(t.account_balances)){const r=[];for(const i of t.account_balances)ct(i.start_balance??0)||ct(i.end_balance??0)||ct(i.income??0)||ct(i.expenses??0)||ct(i.transfers??0)||ct(i.adjustments??0)||ct(i.net_change??0)?(r.push(B1(i)),e.accountBalancesFixed++,n=!0):r.push(i);t.account_balances=r}return{fixed:n,data:t}}function x3(t,e,n){const r={...t.data},{fixed:i,data:o}=b3(r,n),l=i?{budgetId:t.id,data:o}:null;i&&n.budgetsProcessed++;const d=[];let h=!1;for(const m of e){const p={...m.data},{fixed:g,data:v}=v3(p,n);g&&(n.monthsProcessed++,h=!0),d.push(v)}return{budgetUpdate:l,fixedMonths:d,hasMonthFixes:h}}async function w3(){const t={budgetsProcessed:0,accountsFixed:0,categoriesFixed:0,totalAvailableFixed:0,monthsProcessed:0,incomeValuesFixed:0,expenseValuesFixed:0,categoryBalancesFixed:0,accountBalancesFixed:0,errors:[]},{budgets:e,monthsByBudget:n}=await Ba("precision cleanup"),r=[],i=[];for(const o of e)try{const l=n.get(o.id)||[],{budgetUpdate:d,fixedMonths:h,hasMonthFixes:m}=x3(o,l,t);d&&r.push(d),(m||h.length>0)&&i.push({budgetId:o.id,months:h})}catch(l){t.errors.push(`Budget ${o.id}: ${l instanceof Error?l.message:String(l)}`)}if(r.length>0)try{await UT(r,"precision cleanup")}catch(o){t.errors.push(`Budget batch write: ${o instanceof Error?o.message:String(o)}`)}for(const{budgetId:o,months:l}of i)try{await FT(o,l,"precision cleanup")}catch(d){t.errors.push(`Budget ${o} recalc: ${d instanceof Error?d.message:String(d)}`)}return t}function S3({currentUser:t,onComplete:e}){const[n,r]=D.useState(null),[i,o]=D.useState(!1),[l,d]=D.useState(!1),[h,m]=D.useState(null),[p,g]=D.useState(null),v=n?n.accountsWithPrecisionIssues+n.categoriesWithPrecisionIssues+n.totalAvailableWithPrecisionIssues+n.incomeValuesWithPrecisionIssues+n.expenseValuesWithPrecisionIssues+n.categoryBalancesWithPrecisionIssues+n.accountBalancesWithPrecisionIssues:0,b=v>0,E=D.useCallback(async()=>{if(t){o(!0),g(null);try{const S=await P1();r(S),m(null)}catch(S){g(S instanceof Error?S.message:"Failed to scan for precision issues")}finally{o(!1)}}},[t]),x=D.useCallback(async()=>{if(!(!t||!b)){d(!0),g(null);try{const S=await ym(()=>w3());m(S);const C=await P1();r(C),e?.()}catch(S){g(S instanceof Error?S.message:"Failed to run precision cleanup")}finally{d(!1)}}},[t,b,e]);return{status:n,isScanning:i,isRunning:l,result:h,error:p,totalIssues:v,hasIssues:b,hasData:n!==null,scan:E,runCleanup:x}}function _m(t){const e=t.income||[],n=t.expenses||[],r=Me(e.reduce((d,h)=>d+h.amount,0)),i=Me(n.reduce((d,h)=>d+h.amount,0)),o=E3(t),l=C3(t);return{...t,total_income:r,total_expenses:i,account_balances:o,category_balances:l}}function E3(t){const e=t.income||[],n=t.expenses||[],r=t.transfers||[],i=t.adjustments||[],o=t.account_balances||[],l=new Map;for(const m of o)et(m.account_id)||l.set(m.account_id,m);const d=new Set;for(const m of e)et(m.account_id)||d.add(m.account_id);for(const m of n)et(m.account_id)||d.add(m.account_id);for(const m of r)et(m.from_account_id)||d.add(m.from_account_id),et(m.to_account_id)||d.add(m.to_account_id);for(const m of i)et(m.account_id)||d.add(m.account_id);for(const m of o)et(m.account_id)||d.add(m.account_id);const h=[];for(const m of d){const p=l.get(m),g=Me(p?.start_balance??0),v=Me(e.filter(I=>I.account_id===m).reduce((I,O)=>I+O.amount,0)),b=Me(n.filter(I=>I.account_id===m).reduce((I,O)=>I+O.amount,0)),E=Me(r.filter(I=>I.from_account_id===m).reduce((I,O)=>I-O.amount,0)),x=Me(r.filter(I=>I.to_account_id===m).reduce((I,O)=>I+O.amount,0)),S=Me(x+E),C=Me(i.filter(I=>I.account_id===m).reduce((I,O)=>I+O.amount,0)),T=Me(v+b+S+C);h.push({account_id:m,start_balance:g,income:v,expenses:b,transfers:S,adjustments:C,net_change:T,end_balance:Me(g+T)})}return h}function C3(t){const e=t.expenses||[],n=t.transfers||[],r=t.adjustments||[],i=t.category_balances||[],o=new Map;for(const g of i)at(g.category_id)||o.set(g.category_id,g);const l=new Map;for(const g of e){if(at(g.category_id))continue;const v=l.get(g.category_id)||0;l.set(g.category_id,v+g.amount)}const d=new Map;for(const g of n){if(!at(g.from_category_id)){const v=d.get(g.from_category_id)||0;d.set(g.from_category_id,v-g.amount)}if(!at(g.to_category_id)){const v=d.get(g.to_category_id)||0;d.set(g.to_category_id,v+g.amount)}}const h=new Map;for(const g of r)if(!at(g.category_id)){const v=h.get(g.category_id)||0;h.set(g.category_id,v+g.amount)}const m=new Set;for(const g of i)at(g.category_id)||m.add(g.category_id);for(const g of e)at(g.category_id)||m.add(g.category_id);for(const g of n)at(g.from_category_id)||m.add(g.from_category_id),at(g.to_category_id)||m.add(g.to_category_id);for(const g of r)at(g.category_id)||m.add(g.category_id);const p=[];for(const g of m){const v=o.get(g),b=Me(l.get(g)??0),E=Me(d.get(g)??0),x=Me(h.get(g)??0);if(v){const S=Me(v.start_balance),C=Me(v.allocated);p.push({category_id:g,start_balance:S,allocated:C,spent:b,transfers:E,adjustments:x,end_balance:Me(S+C+b+E+x)})}else p.push({category_id:g,start_balance:0,allocated:0,spent:b,transfers:E,adjustments:x,end_balance:Me(b+E+x)})}return p}const T3=["unknown","Unknown","UNKNOWN","","null","undefined","N/A","n/a"],A3=["unknown","Unknown","UNKNOWN","","null","undefined","N/A","n/a"];function bm(t){return!t||et(t)?!0:T3.includes(t)}function vm(t){return!t||at(t)?!0:A3.includes(t)}function VT(t){return bm(t.account_id)||vm(t.category_id)}function j3(t){return{id:t.id.replace("expense_","adjustment_"),amount:t.amount,account_id:bm(t.account_id)?qt:t.account_id,category_id:vm(t.category_id)?Kt:t.category_id,date:t.date,description:t.description||t.payee,cleared:t.cleared,created_at:t.created_at}}function R3(t){const e=t.data,n=e.expenses||[],r=e.adjustments||[],i=[],o=[];let l=0,d=0;for(const m of n)VT(m)?(bm(m.account_id)&&!et(m.account_id)&&l++,vm(m.category_id)&&!at(m.category_id)&&d++,o.push(j3(m))):i.push(m);return o.length===0?{needsUpdate:!1,updatedMonth:null,stats:{expensesMigrated:0,invalidAccountsFixed:0,invalidCategoriesFixed:0}}:{needsUpdate:!0,updatedMonth:_m({...e,expenses:i,adjustments:[...r,...o],transfers:e.transfers||[],updated_at:new Date().toISOString()}),stats:{expensesMigrated:o.length,invalidAccountsFixed:l,invalidCategoriesFixed:d}}}async function I3(){const{budgets:t,monthsByBudget:e}=await Ba("expense-to-adjustment-scan");let n=0,r=0,i=0,o=0;for(const l of t){const d=e.get(l.id)||[];n+=d.length;for(const h of d){const p=h.data.expenses||[];for(const g of p)VT(g)&&(r++,bm(g.account_id)&&!et(g.account_id)&&i++,vm(g.category_id)&&!at(g.category_id)&&o++)}}return{totalBudgets:t.length,totalMonths:n,expensesToMigrate:r,invalidAccountsToFix:i,invalidCategoriesToFix:o}}async function k3(){const{budgets:t,monthsByBudget:e}=await Ba("expense-to-adjustment-migration"),n=[];let r=0,i=0,o=0;const l=[];for(const d of t){const h=e.get(d.id)||[];for(const m of h)try{const{needsUpdate:p,updatedMonth:g,stats:v}=R3(m);p&&g&&(n.push({budgetId:d.id,year:m.year,month:m.month,data:g}),r+=v.expensesMigrated,i+=v.invalidAccountsFixed,o+=v.invalidCategoriesFixed)}catch(p){l.push(`Month ${m.year}/${m.month} in budget ${d.id}: ${p instanceof Error?p.message:String(p)}`)}}return n.length>0&&await ld(n,"expense-to-adjustment-migration"),{budgetsProcessed:t.length,monthsProcessed:n.length,expensesMigrated:r,invalidAccountsFixed:i,invalidCategoriesFixed:o,errors:l}}function D3({currentUser:t,onComplete:e}){const[n,r]=D.useState(!1),[i,o]=D.useState(!1),[l,d]=D.useState(null),[h,m]=D.useState(null);async function p(){if(t){r(!0);try{const b=await I3();d(b)}catch(b){console.error("Failed to scan for expense to adjustment migration:",b)}finally{r(!1)}}}async function g(){if(t){o(!0),m(null);try{const b=await ym(()=>k3());m(b),e?.()}catch(b){m({budgetsProcessed:0,monthsProcessed:0,expensesMigrated:0,invalidAccountsFixed:0,invalidCategoriesFixed:0,errors:[b instanceof Error?b.message:"Unknown error"]})}finally{o(!1)}}}const v=l!==null&&l.expensesToMigrate>0;return{status:l,isScanning:n,scanStatus:p,hasItemsToMigrate:v,isRunning:i,result:h,runMigration:g}}function $T(t){const e=new Set,n=new Set,r=t.categories;if(r)for(const o of Object.keys(r))e.add(o);const i=t.accounts;if(i)for(const o of Object.keys(i))n.add(o);return{categoryIds:e,accountIds:n}}function fa(t,e){return!t||at(t)?!1:!e.has(t)}function Bs(t,e){return!t||et(t)?!1:!e.has(t)}function M3(t,e){const n=t.data;let r=0,i=0,o=0,l=0,d=0,h=0,m=!1;const p=(n.expenses||[]).map(x=>{const S={...x};let C=!1;return fa(x.category_id,e.categoryIds)&&(S.category_id=Kt,r++,C=!0),Bs(x.account_id,e.accountIds)&&(S.account_id=qt,i++,C=!0),C&&(o++,m=!0),S}),g=(n.income||[]).map(x=>{const S={...x};let C=!1;return Bs(x.account_id,e.accountIds)&&(S.account_id=qt,i++,C=!0),C&&(l++,m=!0),S}),v=(n.transfers||[]).map(x=>{const S={...x};let C=!1;return fa(x.from_category_id,e.categoryIds)&&(S.from_category_id=Kt,r++,C=!0),fa(x.to_category_id,e.categoryIds)&&(S.to_category_id=Kt,r++,C=!0),Bs(x.from_account_id,e.accountIds)&&(S.from_account_id=qt,i++,C=!0),Bs(x.to_account_id,e.accountIds)&&(S.to_account_id=qt,i++,C=!0),C&&(d++,m=!0),S}),b=(n.adjustments||[]).map(x=>{const S={...x};let C=!1;return fa(x.category_id,e.categoryIds)&&(S.category_id=Kt,r++,C=!0),Bs(x.account_id,e.accountIds)&&(S.account_id=qt,i++,C=!0),C&&(h++,m=!0),S});return m?{needsUpdate:!0,updatedMonth:{...n,expenses:p,income:g,transfers:v,adjustments:b,updated_at:new Date().toISOString()},stats:{categoryIdsFixed:r,accountIdsFixed:i,affectedExpenses:o,affectedIncome:l,affectedTransfers:d,affectedAdjustments:h}}:{needsUpdate:!1,updatedMonth:null,stats:{categoryIdsFixed:0,accountIdsFixed:0,affectedExpenses:0,affectedIncome:0,affectedTransfers:0,affectedAdjustments:0}}}async function O3(){const{budgets:t,monthsByBudget:e}=await Ba("orphaned-id-scan");let n=0,r=0,i=0,o=0,l=0,d=0,h=0;for(const m of t){const p=$T(m.data),g=e.get(m.id)||[];n+=g.length;for(const v of g){const b=v.data;for(const E of b.expenses||[]){let x=!1;fa(E.category_id,p.categoryIds)&&(r++,x=!0),Bs(E.account_id,p.accountIds)&&(i++,x=!0),x&&o++}for(const E of b.income||[])Bs(E.account_id,p.accountIds)&&(i++,l++);for(const E of b.transfers||[]){let x=!1;fa(E.from_category_id,p.categoryIds)&&(r++,x=!0),fa(E.to_category_id,p.categoryIds)&&(r++,x=!0),Bs(E.from_account_id,p.accountIds)&&(i++,x=!0),Bs(E.to_account_id,p.accountIds)&&(i++,x=!0),x&&d++}for(const E of b.adjustments||[]){let x=!1;fa(E.category_id,p.categoryIds)&&(r++,x=!0),Bs(E.account_id,p.accountIds)&&(i++,x=!0),x&&h++}}}return{totalBudgets:t.length,totalMonths:n,orphanedCategoryIds:r,orphanedAccountIds:i,affectedExpenses:o,affectedIncome:l,affectedTransfers:d,affectedAdjustments:h}}async function N3(){const{budgets:t,monthsByBudget:e}=await Ba("orphaned-id-cleanup"),n=[];let r=0,i=0;const o=[];for(const l of t){const d=$T(l.data),h=e.get(l.id)||[];for(const m of h)try{const{needsUpdate:p,updatedMonth:g,stats:v}=M3(m,d);p&&g&&(n.push({budgetId:l.id,year:m.year,month:m.month,data:g}),r+=v.categoryIdsFixed,i+=v.accountIdsFixed)}catch(p){o.push(`Month ${m.year}/${m.month} in budget ${l.id}: ${p instanceof Error?p.message:String(p)}`)}}return n.length>0&&await ld(n,"orphaned-id-cleanup"),{budgetsProcessed:t.length,monthsProcessed:n.length,categoryIdsFixed:r,accountIdsFixed:i,errors:o}}function P3({currentUser:t,onComplete:e}){const[n,r]=D.useState(!1),[i,o]=D.useState(!1),[l,d]=D.useState(null),[h,m]=D.useState(null);async function p(){if(t){r(!0);try{const b=await O3();d(b)}catch(b){console.error("Failed to scan for orphaned IDs:",b)}finally{r(!1)}}}async function g(){if(t){o(!0),m(null);try{const b=await ym(()=>N3());m(b),e?.()}catch(b){m({budgetsProcessed:0,monthsProcessed:0,categoryIdsFixed:0,accountIdsFixed:0,errors:[b instanceof Error?b.message:"Unknown error"]})}finally{o(!1)}}}const v=l!==null&&(l.orphanedCategoryIds>0||l.orphanedAccountIds>0);return{status:l,isScanning:n,scanStatus:p,hasItemsToFix:v,isRunning:i,result:h,runMigration:g}}function B3(t,e){if(t.date!==e.date||Math.abs(t.amount+e.amount)>.001)return null;const n=t.amount<0?t:e,r=t.amount<0?e:t,i=at(t.category_id)&&at(e.category_id),o=!et(t.account_id)&&!et(e.account_id),l=t.account_id!==e.account_id;if(i&&o&&l)return{negative:n,positive:r,type:"account"};const d=et(t.account_id)&&et(e.account_id),h=!at(t.category_id)&&!at(e.category_id),m=t.category_id!==e.category_id;return d&&h&&m?{negative:n,positive:r,type:"category"}:null}function qT(t){const e=[],n=new Set;for(let r=0;r<t.length;r++)if(!n.has(t[r].id))for(let i=r+1;i<t.length;i++){if(n.has(t[i].id))continue;const o=B3(t[r],t[i]);if(o){e.push(o),n.add(t[r].id),n.add(t[i].id);break}}return e}function z3(t){const{negative:e,positive:n,type:r}=t;return r==="account"?{id:`transfer_from_adj_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,amount:Math.abs(e.amount),from_account_id:e.account_id,to_account_id:n.account_id,from_category_id:Kt,to_category_id:Kt,date:e.date,description:e.description||n.description||"Transfer",cleared:e.cleared&&n.cleared,created_at:new Date().toISOString()}:{id:`transfer_from_adj_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,amount:Math.abs(e.amount),from_account_id:qt,to_account_id:qt,from_category_id:e.category_id,to_category_id:n.category_id,date:e.date,description:e.description||n.description||"Transfer",cleared:e.cleared&&n.cleared,created_at:new Date().toISOString()}}function L3(t){const e=t.data,n=e.adjustments||[],r=e.transfers||[],i=qT(n);if(i.length===0)return{needsUpdate:!1,updatedMonth:null,stats:{pairsConverted:0,adjustmentsRemoved:0}};const o=i.map(z3),l=new Set;for(const m of i)l.add(m.negative.id),l.add(m.positive.id);const d=n.filter(m=>!l.has(m.id));return{needsUpdate:!0,updatedMonth:{...e,adjustments:d,transfers:[...r,...o],updated_at:new Date().toISOString()},stats:{pairsConverted:i.length,adjustmentsRemoved:l.size}}}async function U3(){const{budgets:t,monthsByBudget:e}=await Ba("adjustments-to-transfers-scan");let n=0,r=0,i=0,o=0;for(const l of t){const d=e.get(l.id)||[];n+=d.length;for(const h of d){const p=h.data.adjustments||[],g=qT(p);r+=g.length;for(const v of g)v.type==="account"?i++:o++}}return{totalBudgets:t.length,totalMonths:n,pairsFound:r,accountTransferPairs:i,categoryTransferPairs:o}}async function F3(){const{budgets:t,monthsByBudget:e}=await Ba("adjustments-to-transfers-migration"),n=[];let r=0,i=0;const o=[];for(const l of t){const d=e.get(l.id)||[];for(const h of d)try{const{needsUpdate:m,updatedMonth:p,stats:g}=L3(h);m&&p&&(n.push({budgetId:l.id,year:h.year,month:h.month,data:p}),r+=g.pairsConverted,i+=g.adjustmentsRemoved)}catch(m){o.push(`Month ${h.year}/${h.month} in budget ${l.id}: ${m instanceof Error?m.message:String(m)}`)}}return n.length>0&&await ld(n,"adjustments-to-transfers-migration"),{budgetsProcessed:t.length,monthsProcessed:n.length,transfersCreated:r,adjustmentsRemoved:i,errors:o}}function V3({currentUser:t,onComplete:e}){const[n,r]=D.useState(!1),[i,o]=D.useState(!1),[l,d]=D.useState(null),[h,m]=D.useState(null);async function p(){if(t){r(!0);try{const b=await U3();d(b)}catch(b){console.error("Failed to scan for adjustment pairs:",b)}finally{r(!1)}}}async function g(){if(t){o(!0),m(null);try{const b=await ym(()=>F3());m(b),e?.()}catch(b){m({budgetsProcessed:0,monthsProcessed:0,transfersCreated:0,adjustmentsRemoved:0,errors:[b instanceof Error?b.message:"Unknown error"]})}finally{o(!1)}}}const v=l!==null&&l.pairsFound>0;return{status:l,isScanning:n,scanStatus:p,hasPairsToConvert:v,isRunning:i,result:h,runMigration:g}}function $3(t){const e=[];let n="",r=!1;for(let i=0;i<t.length;i++){const o=t[i];o==='"'?r=!r:o===","&&!r?(e.push(n.trim()),n=""):n+=o}return e.push(n.trim()),e}function q3(t){if(!t)return 0;let e=t.replace(/[$\s]/g,"");const n=e.startsWith("(")||e.startsWith("-");e=e.replace(/[()]/g,"").replace("-",""),e=e.replace(/,/g,"");const r=parseFloat(e);return isNaN(r)?0:n?-r:r}function H3(t){if(!t)return null;const e=t.split("/");if(e.length!==3)return null;const n=parseInt(e[0],10),r=parseInt(e[1],10),i=parseInt(e[2],10);return isNaN(n)||isNaN(r)||isNaN(i)||n<1||n>12||r<1||r>31?null:{year:i,month:n,day:r}}function G3(t){if(!t)return!1;const e=t.toLowerCase().trim();return e==="true"||e==="1"||e==="yes"}function Q3(t,e){return e.toLowerCase()==="income"?"income":t.toLowerCase()==="budget allocation"?"allocation":"spend"}function W3(t){const e=t.split(`
`).filter(r=>r.trim()),n=[];for(const r of e){const i=$3(r);if(i.length<5)continue;const[o,l,d,h,m,p,g]=i;if(o.toLowerCase()==="cash flow"||o.toLowerCase()==="date")continue;const v=H3(o);if(!v)continue;const b=Q3(l,d),E=q3(m),x=G3(g||"");n.push({recordType:b,date:o,year:v.year,month:v.month,day:v.day,payee:l,category:d,account:h,amount:E,description:p||"",cleared:x,rawLine:r})}return n}function K3(t){return!t.account_id||t.account_id.trim()===""?"Missing account_id (empty or undefined)":null}function Y3(t){const e=[];return(!t.account_id||t.account_id.trim()==="")&&e.push("missing account_id"),(!t.category_id||t.category_id.trim()==="")&&e.push("missing category_id"),e.length>0?e.join(", "):null}function X3(t){const e=et(t.account_id)||!t.account_id||t.account_id.trim()==="",n=at(t.category_id)||!t.category_id||t.category_id.trim()==="";return e&&n?"Both account_id and category_id are missing/NO_* (must have at least one real ID)":null}function Z3(t){const e=[];if((!t.from_account_id||t.from_account_id.trim()==="")&&e.push("missing from_account_id"),(!t.to_account_id||t.to_account_id.trim()==="")&&e.push("missing to_account_id"),(!t.from_category_id||t.from_category_id.trim()==="")&&e.push("missing from_category_id"),(!t.to_category_id||t.to_category_id.trim()==="")&&e.push("missing to_category_id"),e.length>0)return e.join(", ");const n=t.from_account_id===t.to_account_id,r=t.from_category_id===t.to_category_id;if(n&&r)return"Transfer has same from/to on both account and category (nothing would transfer)";const i=et(t.from_account_id),o=et(t.to_account_id),l=at(t.from_category_id),d=at(t.to_category_id);return i&&o&&l&&d?"All from/to account and category IDs are NO_* (must involve at least one real entity)":i&&o&&r?"Both accounts are NO_ACCOUNT and categories are the same (nothing transfers)":l&&d&&n?"Both categories are NO_CATEGORY and accounts are the same (nothing transfers)":null}function Vh(t,e,n,r,i){return t.filter(o=>{const[l,d,h]=e.split("-").map(Number);return o.year!==l||o.month!==d||o.day!==h||Math.abs(Math.abs(o.amount)-Math.abs(n))>.01?!1:(r&&o.payee&&o.payee.toLowerCase()===r.toLowerCase()||i&&o.description&&o.description.toLowerCase().includes(i.toLowerCase()),!0)})}async function J3(t){const e=[];let n=0,r=0,i=0,o=0;const l=t?W3(t):[],{budgets:d,monthsByBudget:h}=await Ba("account-category-validation");for(const m of d){const p=h.get(m.id)||[];for(const g of p){const v=g.data,b=`${v.year}-${String(v.month).padStart(2,"0")}`,E=v.income||[];n+=E.length;for(const T of E){const I=K3(T);I&&e.push({budgetId:m.id,monthKey:b,transactionType:"income",transactionId:T.id,violation:I,transactionDetails:{date:T.date,amount:T.amount,payee:T.payee,description:T.description,accountId:T.account_id},potentialSeedMatches:Vh(l,T.date,T.amount,T.payee,T.description)})}const x=v.expenses||[];r+=x.length;for(const T of x){const I=Y3(T);I&&e.push({budgetId:m.id,monthKey:b,transactionType:"expense",transactionId:T.id,violation:I,transactionDetails:{date:T.date,amount:T.amount,payee:T.payee,description:T.description,accountId:T.account_id,categoryId:T.category_id},potentialSeedMatches:Vh(l,T.date,T.amount,T.payee,T.description)})}const S=v.adjustments||[];i+=S.length;for(const T of S){const I=X3(T);I&&e.push({budgetId:m.id,monthKey:b,transactionType:"adjustment",transactionId:T.id,violation:I,transactionDetails:{date:T.date,amount:T.amount,description:T.description,accountId:T.account_id,categoryId:T.category_id},potentialSeedMatches:Vh(l,T.date,T.amount,void 0,T.description)})}const C=v.transfers||[];o+=C.length;for(const T of C){const I=Z3(T);I&&e.push({budgetId:m.id,monthKey:b,transactionType:"transfer",transactionId:T.id,violation:I,transactionDetails:{date:T.date,amount:T.amount,description:T.description,fromAccountId:T.from_account_id,toAccountId:T.to_account_id,fromCategoryId:T.from_category_id,toCategoryId:T.to_category_id},potentialSeedMatches:Vh(l,T.date,T.amount,void 0,T.description)})}}}return e.sort((m,p)=>{const g=m.monthKey.localeCompare(p.monthKey);return g!==0?g:m.transactionType.localeCompare(p.transactionType)}),{totalBudgets:d.length,totalMonths:Array.from(h.values()).reduce((m,p)=>m+p.length,0),totalIncome:n,totalExpenses:r,totalAdjustments:i,totalTransfers:o,violations:e,scannedAt:new Date().toISOString()}}function eP(t){const e=[];if(e.push("=".repeat(80),"ACCOUNT/CATEGORY VALIDATION REPORT",`Scanned at: ${t.scannedAt}`,"=".repeat(80),"","SUMMARY:"),e.push(`  Budgets scanned: ${t.totalBudgets}`,`  Months scanned: ${t.totalMonths}`,`  Income transactions: ${t.totalIncome}`,`  Expense transactions: ${t.totalExpenses}`,`  Adjustment transactions: ${t.totalAdjustments}`,`  Transfer transactions: ${t.totalTransfers}`,`  VIOLATIONS FOUND: ${t.violations.length}`,""),t.violations.length===0)return e.push(" No violations found!"),e.join(`
`);const n=new Map;for(const r of t.violations)n.has(r.transactionType)||n.set(r.transactionType,[]),n.get(r.transactionType).push(r);e.push("-".repeat(80),"VIOLATIONS BY TYPE:","-".repeat(80));for(const[r,i]of n){e.push("",`## ${r.toUpperCase()} (${i.length} violations)`,"");for(const o of i){if(e.push(`  [${o.monthKey}] ID: ${o.transactionId}`,`    Violation: ${o.violation}`,`    Date: ${o.transactionDetails.date}`,`    Amount: ${o.transactionDetails.amount}`),o.transactionDetails.payee&&e.push(`    Payee: ${o.transactionDetails.payee}`),o.transactionDetails.description&&e.push(`    Description: ${o.transactionDetails.description}`),o.transactionDetails.accountId!==void 0&&e.push(`    Account ID: ${o.transactionDetails.accountId||"(empty)"}`),o.transactionDetails.categoryId!==void 0&&e.push(`    Category ID: ${o.transactionDetails.categoryId||"(empty)"}`),o.transactionDetails.fromAccountId!==void 0&&e.push(`    From Account: ${o.transactionDetails.fromAccountId||"(empty)"}`,`    To Account: ${o.transactionDetails.toAccountId||"(empty)"}`,`    From Category: ${o.transactionDetails.fromCategoryId||"(empty)"}`,`    To Category: ${o.transactionDetails.toCategoryId||"(empty)"}`),o.potentialSeedMatches.length>0){e.push(`    POTENTIAL SEED MATCHES (${o.potentialSeedMatches.length}):`);for(const l of o.potentialSeedMatches.slice(0,5))e.push(`      - Line: ${l.rawLine}`,`        Type: ${l.recordType}, Date: ${l.date}, Payee: ${l.payee}`,`        Category: ${l.category}, Account: ${l.account}`);o.potentialSeedMatches.length>5&&e.push(`      ... and ${o.potentialSeedMatches.length-5} more matches`)}else e.push("    No seed matches found");e.push("")}}return e.join(`
`)}function tP({currentUser:t}){const[e,n]=D.useState(!1),[r,i]=D.useState(null),[o,l]=D.useState(null);async function d(h){if(t){n(!0),i(null),l(null);try{const m=await J3(h);i(m),l(eP(m))}catch(m){console.error("Failed to scan transactions:",m),l(`Error scanning: ${m instanceof Error?m.message:"Unknown error"}`)}finally{n(!1)}}}return{isScanning:e,status:r,report:o,scan:d,hasViolations:r!==null&&r.violations.length>0,violationCount:r?.violations.length??0}}function $h(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var qg={exports:{}};var z1;function nP(){return z1||(z1=1,(function(t,e){(function(n){t.exports=n()})(function(){return(function n(r,i,o){function l(m,p){if(!i[m]){if(!r[m]){var g=typeof $h=="function"&&$h;if(!p&&g)return g(m,!0);if(d)return d(m,!0);var v=new Error("Cannot find module '"+m+"'");throw v.code="MODULE_NOT_FOUND",v}var b=i[m]={exports:{}};r[m][0].call(b.exports,function(E){var x=r[m][1][E];return l(x||E)},b,b.exports,n,r,i,o)}return i[m].exports}for(var d=typeof $h=="function"&&$h,h=0;h<o.length;h++)l(o[h]);return l})({1:[function(n,r,i){var o=n("./utils"),l=n("./support"),d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(h){for(var m,p,g,v,b,E,x,S=[],C=0,T=h.length,I=T,O=o.getTypeOf(h)!=="string";C<h.length;)I=T-C,g=O?(m=h[C++],p=C<T?h[C++]:0,C<T?h[C++]:0):(m=h.charCodeAt(C++),p=C<T?h.charCodeAt(C++):0,C<T?h.charCodeAt(C++):0),v=m>>2,b=(3&m)<<4|p>>4,E=1<I?(15&p)<<2|g>>6:64,x=2<I?63&g:64,S.push(d.charAt(v)+d.charAt(b)+d.charAt(E)+d.charAt(x));return S.join("")},i.decode=function(h){var m,p,g,v,b,E,x=0,S=0,C="data:";if(h.substr(0,C.length)===C)throw new Error("Invalid base64 input, it looks like a data url.");var T,I=3*(h=h.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(h.charAt(h.length-1)===d.charAt(64)&&I--,h.charAt(h.length-2)===d.charAt(64)&&I--,I%1!=0)throw new Error("Invalid base64 input, bad content length.");for(T=l.uint8array?new Uint8Array(0|I):new Array(0|I);x<h.length;)m=d.indexOf(h.charAt(x++))<<2|(v=d.indexOf(h.charAt(x++)))>>4,p=(15&v)<<4|(b=d.indexOf(h.charAt(x++)))>>2,g=(3&b)<<6|(E=d.indexOf(h.charAt(x++))),T[S++]=m,b!==64&&(T[S++]=p),E!==64&&(T[S++]=g);return T}},{"./support":30,"./utils":32}],2:[function(n,r,i){var o=n("./external"),l=n("./stream/DataWorker"),d=n("./stream/Crc32Probe"),h=n("./stream/DataLengthProbe");function m(p,g,v,b,E){this.compressedSize=p,this.uncompressedSize=g,this.crc32=v,this.compression=b,this.compressedContent=E}m.prototype={getContentWorker:function(){var p=new l(o.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new h("data_length")),g=this;return p.on("end",function(){if(this.streamInfo.data_length!==g.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),p},getCompressedWorker:function(){return new l(o.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},m.createWorkerFrom=function(p,g,v){return p.pipe(new d).pipe(new h("uncompressedSize")).pipe(g.compressWorker(v)).pipe(new h("compressedSize")).withStreamInfo("compression",g)},r.exports=m},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(n,r,i){var o=n("./stream/GenericWorker");i.STORE={magic:"\0\0",compressWorker:function(){return new o("STORE compression")},uncompressWorker:function(){return new o("STORE decompression")}},i.DEFLATE=n("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(n,r,i){var o=n("./utils"),l=(function(){for(var d,h=[],m=0;m<256;m++){d=m;for(var p=0;p<8;p++)d=1&d?3988292384^d>>>1:d>>>1;h[m]=d}return h})();r.exports=function(d,h){return d!==void 0&&d.length?o.getTypeOf(d)!=="string"?(function(m,p,g,v){var b=l,E=v+g;m^=-1;for(var x=v;x<E;x++)m=m>>>8^b[255&(m^p[x])];return-1^m})(0|h,d,d.length,0):(function(m,p,g,v){var b=l,E=v+g;m^=-1;for(var x=v;x<E;x++)m=m>>>8^b[255&(m^p.charCodeAt(x))];return-1^m})(0|h,d,d.length,0):0}},{"./utils":32}],5:[function(n,r,i){i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!0,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],6:[function(n,r,i){var o=null;o=typeof Promise<"u"?Promise:n("lie"),r.exports={Promise:o}},{lie:37}],7:[function(n,r,i){var o=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",l=n("pako"),d=n("./utils"),h=n("./stream/GenericWorker"),m=o?"uint8array":"array";function p(g,v){h.call(this,"FlateWorker/"+g),this._pako=null,this._pakoAction=g,this._pakoOptions=v,this.meta={}}i.magic="\b\0",d.inherits(p,h),p.prototype.processChunk=function(g){this.meta=g.meta,this._pako===null&&this._createPako(),this._pako.push(d.transformTo(m,g.data),!1)},p.prototype.flush=function(){h.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},p.prototype.cleanUp=function(){h.prototype.cleanUp.call(this),this._pako=null},p.prototype._createPako=function(){this._pako=new l[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var g=this;this._pako.onData=function(v){g.push({data:v,meta:g.meta})}},i.compressWorker=function(g){return new p("Deflate",g)},i.uncompressWorker=function(){return new p("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(n,r,i){function o(b,E){var x,S="";for(x=0;x<E;x++)S+=String.fromCharCode(255&b),b>>>=8;return S}function l(b,E,x,S,C,T){var I,O,U=b.file,$=b.compression,k=T!==m.utf8encode,R=d.transformTo("string",T(U.name)),N=d.transformTo("string",m.utf8encode(U.name)),V=U.comment,H=d.transformTo("string",T(V)),j=d.transformTo("string",m.utf8encode(V)),B=N.length!==U.name.length,M=j.length!==V.length,Z="",K="",q="",W=U.dir,X=U.date,re={crc32:0,compressedSize:0,uncompressedSize:0};E&&!x||(re.crc32=b.crc32,re.compressedSize=b.compressedSize,re.uncompressedSize=b.uncompressedSize);var z=0;E&&(z|=8),k||!B&&!M||(z|=2048);var G=0,te=0;W&&(G|=16),C==="UNIX"?(te=798,G|=(function(ie,ce){var we=ie;return ie||(we=ce?16893:33204),(65535&we)<<16})(U.unixPermissions,W)):(te=20,G|=(function(ie){return 63&(ie||0)})(U.dosPermissions)),I=X.getUTCHours(),I<<=6,I|=X.getUTCMinutes(),I<<=5,I|=X.getUTCSeconds()/2,O=X.getUTCFullYear()-1980,O<<=4,O|=X.getUTCMonth()+1,O<<=5,O|=X.getUTCDate(),B&&(K=o(1,1)+o(p(R),4)+N,Z+="up"+o(K.length,2)+K),M&&(q=o(1,1)+o(p(H),4)+j,Z+="uc"+o(q.length,2)+q);var se="";return se+=`
\0`,se+=o(z,2),se+=$.magic,se+=o(I,2),se+=o(O,2),se+=o(re.crc32,4),se+=o(re.compressedSize,4),se+=o(re.uncompressedSize,4),se+=o(R.length,2),se+=o(Z.length,2),{fileRecord:g.LOCAL_FILE_HEADER+se+R+Z,dirRecord:g.CENTRAL_FILE_HEADER+o(te,2)+se+o(H.length,2)+"\0\0\0\0"+o(G,4)+o(S,4)+R+Z+H}}var d=n("../utils"),h=n("../stream/GenericWorker"),m=n("../utf8"),p=n("../crc32"),g=n("../signature");function v(b,E,x,S){h.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=E,this.zipPlatform=x,this.encodeFileName=S,this.streamFiles=b,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}d.inherits(v,h),v.prototype.push=function(b){var E=b.meta.percent||0,x=this.entriesCount,S=this._sources.length;this.accumulate?this.contentBuffer.push(b):(this.bytesWritten+=b.data.length,h.prototype.push.call(this,{data:b.data,meta:{currentFile:this.currentFile,percent:x?(E+100*(x-S-1))/x:100}}))},v.prototype.openedSource=function(b){this.currentSourceOffset=this.bytesWritten,this.currentFile=b.file.name;var E=this.streamFiles&&!b.file.dir;if(E){var x=l(b,E,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:x.fileRecord,meta:{percent:0}})}else this.accumulate=!0},v.prototype.closedSource=function(b){this.accumulate=!1;var E=this.streamFiles&&!b.file.dir,x=l(b,E,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(x.dirRecord),E)this.push({data:(function(S){return g.DATA_DESCRIPTOR+o(S.crc32,4)+o(S.compressedSize,4)+o(S.uncompressedSize,4)})(b),meta:{percent:100}});else for(this.push({data:x.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},v.prototype.flush=function(){for(var b=this.bytesWritten,E=0;E<this.dirRecords.length;E++)this.push({data:this.dirRecords[E],meta:{percent:100}});var x=this.bytesWritten-b,S=(function(C,T,I,O,U){var $=d.transformTo("string",U(O));return g.CENTRAL_DIRECTORY_END+"\0\0\0\0"+o(C,2)+o(C,2)+o(T,4)+o(I,4)+o($.length,2)+$})(this.dirRecords.length,x,b,this.zipComment,this.encodeFileName);this.push({data:S,meta:{percent:100}})},v.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},v.prototype.registerPrevious=function(b){this._sources.push(b);var E=this;return b.on("data",function(x){E.processChunk(x)}),b.on("end",function(){E.closedSource(E.previous.streamInfo),E._sources.length?E.prepareNextSource():E.end()}),b.on("error",function(x){E.error(x)}),this},v.prototype.resume=function(){return!!h.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},v.prototype.error=function(b){var E=this._sources;if(!h.prototype.error.call(this,b))return!1;for(var x=0;x<E.length;x++)try{E[x].error(b)}catch{}return!0},v.prototype.lock=function(){h.prototype.lock.call(this);for(var b=this._sources,E=0;E<b.length;E++)b[E].lock()},r.exports=v},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(n,r,i){var o=n("../compressions"),l=n("./ZipFileWorker");i.generateWorker=function(d,h,m){var p=new l(h.streamFiles,m,h.platform,h.encodeFileName),g=0;try{d.forEach(function(v,b){g++;var E=(function(T,I){var O=T||I,U=o[O];if(!U)throw new Error(O+" is not a valid compression method !");return U})(b.options.compression,h.compression),x=b.options.compressionOptions||h.compressionOptions||{},S=b.dir,C=b.date;b._compressWorker(E,x).withStreamInfo("file",{name:v,dir:S,date:C,comment:b.comment||"",unixPermissions:b.unixPermissions,dosPermissions:b.dosPermissions}).pipe(p)}),p.entriesCount=g}catch(v){p.error(v)}return p}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(n,r,i){function o(){if(!(this instanceof o))return new o;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var l=new o;for(var d in this)typeof this[d]!="function"&&(l[d]=this[d]);return l}}(o.prototype=n("./object")).loadAsync=n("./load"),o.support=n("./support"),o.defaults=n("./defaults"),o.version="3.10.1",o.loadAsync=function(l,d){return new o().loadAsync(l,d)},o.external=n("./external"),r.exports=o},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(n,r,i){var o=n("./utils"),l=n("./external"),d=n("./utf8"),h=n("./zipEntries"),m=n("./stream/Crc32Probe"),p=n("./nodejsUtils");function g(v){return new l.Promise(function(b,E){var x=v.decompressed.getContentWorker().pipe(new m);x.on("error",function(S){E(S)}).on("end",function(){x.streamInfo.crc32!==v.decompressed.crc32?E(new Error("Corrupted zip : CRC32 mismatch")):b()}).resume()})}r.exports=function(v,b){var E=this;return b=o.extend(b||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:d.utf8decode}),p.isNode&&p.isStream(v)?l.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):o.prepareContent("the loaded zip file",v,!0,b.optimizedBinaryString,b.base64).then(function(x){var S=new h(b);return S.load(x),S}).then(function(x){var S=[l.Promise.resolve(x)],C=x.files;if(b.checkCRC32)for(var T=0;T<C.length;T++)S.push(g(C[T]));return l.Promise.all(S)}).then(function(x){for(var S=x.shift(),C=S.files,T=0;T<C.length;T++){var I=C[T],O=I.fileNameStr,U=o.resolve(I.fileNameStr);E.file(U,I.decompressed,{binary:!0,optimizedBinaryString:!0,date:I.date,dir:I.dir,comment:I.fileCommentStr.length?I.fileCommentStr:null,unixPermissions:I.unixPermissions,dosPermissions:I.dosPermissions,createFolders:b.createFolders}),I.dir||(E.file(U).unsafeOriginalName=O)}return S.zipComment.length&&(E.comment=S.zipComment),E})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(n,r,i){var o=n("../utils"),l=n("../stream/GenericWorker");function d(h,m){l.call(this,"Nodejs stream input adapter for "+h),this._upstreamEnded=!1,this._bindStream(m)}o.inherits(d,l),d.prototype._bindStream=function(h){var m=this;(this._stream=h).pause(),h.on("data",function(p){m.push({data:p,meta:{percent:0}})}).on("error",function(p){m.isPaused?this.generatedError=p:m.error(p)}).on("end",function(){m.isPaused?m._upstreamEnded=!0:m.end()})},d.prototype.pause=function(){return!!l.prototype.pause.call(this)&&(this._stream.pause(),!0)},d.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},r.exports=d},{"../stream/GenericWorker":28,"../utils":32}],13:[function(n,r,i){var o=n("readable-stream").Readable;function l(d,h,m){o.call(this,h),this._helper=d;var p=this;d.on("data",function(g,v){p.push(g)||p._helper.pause(),m&&m(v)}).on("error",function(g){p.emit("error",g)}).on("end",function(){p.push(null)})}n("../utils").inherits(l,o),l.prototype._read=function(){this._helper.resume()},r.exports=l},{"../utils":32,"readable-stream":16}],14:[function(n,r,i){r.exports={isNode:typeof Buffer<"u",newBufferFrom:function(o,l){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(o,l);if(typeof o=="number")throw new Error('The "data" argument must not be a number');return new Buffer(o,l)},allocBuffer:function(o){if(Buffer.alloc)return Buffer.alloc(o);var l=new Buffer(o);return l.fill(0),l},isBuffer:function(o){return Buffer.isBuffer(o)},isStream:function(o){return o&&typeof o.on=="function"&&typeof o.pause=="function"&&typeof o.resume=="function"}}},{}],15:[function(n,r,i){function o(U,$,k){var R,N=d.getTypeOf($),V=d.extend(k||{},p);V.date=V.date||new Date,V.compression!==null&&(V.compression=V.compression.toUpperCase()),typeof V.unixPermissions=="string"&&(V.unixPermissions=parseInt(V.unixPermissions,8)),V.unixPermissions&&16384&V.unixPermissions&&(V.dir=!0),V.dosPermissions&&16&V.dosPermissions&&(V.dir=!0),V.dir&&(U=C(U)),V.createFolders&&(R=S(U))&&T.call(this,R,!0);var H=N==="string"&&V.binary===!1&&V.base64===!1;k&&k.binary!==void 0||(V.binary=!H),($ instanceof g&&$.uncompressedSize===0||V.dir||!$||$.length===0)&&(V.base64=!1,V.binary=!0,$="",V.compression="STORE",N="string");var j=null;j=$ instanceof g||$ instanceof h?$:E.isNode&&E.isStream($)?new x(U,$):d.prepareContent(U,$,V.binary,V.optimizedBinaryString,V.base64);var B=new v(U,j,V);this.files[U]=B}var l=n("./utf8"),d=n("./utils"),h=n("./stream/GenericWorker"),m=n("./stream/StreamHelper"),p=n("./defaults"),g=n("./compressedObject"),v=n("./zipObject"),b=n("./generate"),E=n("./nodejsUtils"),x=n("./nodejs/NodejsStreamInputAdapter"),S=function(U){U.slice(-1)==="/"&&(U=U.substring(0,U.length-1));var $=U.lastIndexOf("/");return 0<$?U.substring(0,$):""},C=function(U){return U.slice(-1)!=="/"&&(U+="/"),U},T=function(U,$){return $=$!==void 0?$:p.createFolders,U=C(U),this.files[U]||o.call(this,U,null,{dir:!0,createFolders:$}),this.files[U]};function I(U){return Object.prototype.toString.call(U)==="[object RegExp]"}var O={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(U){var $,k,R;for($ in this.files)R=this.files[$],(k=$.slice(this.root.length,$.length))&&$.slice(0,this.root.length)===this.root&&U(k,R)},filter:function(U){var $=[];return this.forEach(function(k,R){U(k,R)&&$.push(R)}),$},file:function(U,$,k){if(arguments.length!==1)return U=this.root+U,o.call(this,U,$,k),this;if(I(U)){var R=U;return this.filter(function(V,H){return!H.dir&&R.test(V)})}var N=this.files[this.root+U];return N&&!N.dir?N:null},folder:function(U){if(!U)return this;if(I(U))return this.filter(function(N,V){return V.dir&&U.test(N)});var $=this.root+U,k=T.call(this,$),R=this.clone();return R.root=k.name,R},remove:function(U){U=this.root+U;var $=this.files[U];if($||(U.slice(-1)!=="/"&&(U+="/"),$=this.files[U]),$&&!$.dir)delete this.files[U];else for(var k=this.filter(function(N,V){return V.name.slice(0,U.length)===U}),R=0;R<k.length;R++)delete this.files[k[R].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(U){var $,k={};try{if((k=d.extend(U||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:l.utf8encode})).type=k.type.toLowerCase(),k.compression=k.compression.toUpperCase(),k.type==="binarystring"&&(k.type="string"),!k.type)throw new Error("No output type specified.");d.checkSupport(k.type),k.platform!=="darwin"&&k.platform!=="freebsd"&&k.platform!=="linux"&&k.platform!=="sunos"||(k.platform="UNIX"),k.platform==="win32"&&(k.platform="DOS");var R=k.comment||this.comment||"";$=b.generateWorker(this,k,R)}catch(N){($=new h("error")).error(N)}return new m($,k.type||"string",k.mimeType)},generateAsync:function(U,$){return this.generateInternalStream(U).accumulate($)},generateNodeStream:function(U,$){return(U=U||{}).type||(U.type="nodebuffer"),this.generateInternalStream(U).toNodejsStream($)}};r.exports=O},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(n,r,i){r.exports=n("stream")},{stream:void 0}],17:[function(n,r,i){var o=n("./DataReader");function l(d){o.call(this,d);for(var h=0;h<this.data.length;h++)d[h]=255&d[h]}n("../utils").inherits(l,o),l.prototype.byteAt=function(d){return this.data[this.zero+d]},l.prototype.lastIndexOfSignature=function(d){for(var h=d.charCodeAt(0),m=d.charCodeAt(1),p=d.charCodeAt(2),g=d.charCodeAt(3),v=this.length-4;0<=v;--v)if(this.data[v]===h&&this.data[v+1]===m&&this.data[v+2]===p&&this.data[v+3]===g)return v-this.zero;return-1},l.prototype.readAndCheckSignature=function(d){var h=d.charCodeAt(0),m=d.charCodeAt(1),p=d.charCodeAt(2),g=d.charCodeAt(3),v=this.readData(4);return h===v[0]&&m===v[1]&&p===v[2]&&g===v[3]},l.prototype.readData=function(d){if(this.checkOffset(d),d===0)return[];var h=this.data.slice(this.zero+this.index,this.zero+this.index+d);return this.index+=d,h},r.exports=l},{"../utils":32,"./DataReader":18}],18:[function(n,r,i){var o=n("../utils");function l(d){this.data=d,this.length=d.length,this.index=0,this.zero=0}l.prototype={checkOffset:function(d){this.checkIndex(this.index+d)},checkIndex:function(d){if(this.length<this.zero+d||d<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+d+"). Corrupted zip ?")},setIndex:function(d){this.checkIndex(d),this.index=d},skip:function(d){this.setIndex(this.index+d)},byteAt:function(){},readInt:function(d){var h,m=0;for(this.checkOffset(d),h=this.index+d-1;h>=this.index;h--)m=(m<<8)+this.byteAt(h);return this.index+=d,m},readString:function(d){return o.transformTo("string",this.readData(d))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var d=this.readInt(4);return new Date(Date.UTC(1980+(d>>25&127),(d>>21&15)-1,d>>16&31,d>>11&31,d>>5&63,(31&d)<<1))}},r.exports=l},{"../utils":32}],19:[function(n,r,i){var o=n("./Uint8ArrayReader");function l(d){o.call(this,d)}n("../utils").inherits(l,o),l.prototype.readData=function(d){this.checkOffset(d);var h=this.data.slice(this.zero+this.index,this.zero+this.index+d);return this.index+=d,h},r.exports=l},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(n,r,i){var o=n("./DataReader");function l(d){o.call(this,d)}n("../utils").inherits(l,o),l.prototype.byteAt=function(d){return this.data.charCodeAt(this.zero+d)},l.prototype.lastIndexOfSignature=function(d){return this.data.lastIndexOf(d)-this.zero},l.prototype.readAndCheckSignature=function(d){return d===this.readData(4)},l.prototype.readData=function(d){this.checkOffset(d);var h=this.data.slice(this.zero+this.index,this.zero+this.index+d);return this.index+=d,h},r.exports=l},{"../utils":32,"./DataReader":18}],21:[function(n,r,i){var o=n("./ArrayReader");function l(d){o.call(this,d)}n("../utils").inherits(l,o),l.prototype.readData=function(d){if(this.checkOffset(d),d===0)return new Uint8Array(0);var h=this.data.subarray(this.zero+this.index,this.zero+this.index+d);return this.index+=d,h},r.exports=l},{"../utils":32,"./ArrayReader":17}],22:[function(n,r,i){var o=n("../utils"),l=n("../support"),d=n("./ArrayReader"),h=n("./StringReader"),m=n("./NodeBufferReader"),p=n("./Uint8ArrayReader");r.exports=function(g){var v=o.getTypeOf(g);return o.checkSupport(v),v!=="string"||l.uint8array?v==="nodebuffer"?new m(g):l.uint8array?new p(o.transformTo("uint8array",g)):new d(o.transformTo("array",g)):new h(g)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(n,r,i){i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(n,r,i){var o=n("./GenericWorker"),l=n("../utils");function d(h){o.call(this,"ConvertWorker to "+h),this.destType=h}l.inherits(d,o),d.prototype.processChunk=function(h){this.push({data:l.transformTo(this.destType,h.data),meta:h.meta})},r.exports=d},{"../utils":32,"./GenericWorker":28}],25:[function(n,r,i){var o=n("./GenericWorker"),l=n("../crc32");function d(){o.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}n("../utils").inherits(d,o),d.prototype.processChunk=function(h){this.streamInfo.crc32=l(h.data,this.streamInfo.crc32||0),this.push(h)},r.exports=d},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(n,r,i){var o=n("../utils"),l=n("./GenericWorker");function d(h){l.call(this,"DataLengthProbe for "+h),this.propName=h,this.withStreamInfo(h,0)}o.inherits(d,l),d.prototype.processChunk=function(h){if(h){var m=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=m+h.data.length}l.prototype.processChunk.call(this,h)},r.exports=d},{"../utils":32,"./GenericWorker":28}],27:[function(n,r,i){var o=n("../utils"),l=n("./GenericWorker");function d(h){l.call(this,"DataWorker");var m=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,h.then(function(p){m.dataIsReady=!0,m.data=p,m.max=p&&p.length||0,m.type=o.getTypeOf(p),m.isPaused||m._tickAndRepeat()},function(p){m.error(p)})}o.inherits(d,l),d.prototype.cleanUp=function(){l.prototype.cleanUp.call(this),this.data=null},d.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,o.delay(this._tickAndRepeat,[],this)),!0)},d.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(o.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},d.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var h=null,m=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":h=this.data.substring(this.index,m);break;case"uint8array":h=this.data.subarray(this.index,m);break;case"array":case"nodebuffer":h=this.data.slice(this.index,m)}return this.index=m,this.push({data:h,meta:{percent:this.max?this.index/this.max*100:0}})},r.exports=d},{"../utils":32,"./GenericWorker":28}],28:[function(n,r,i){function o(l){this.name=l||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}o.prototype={push:function(l){this.emit("data",l)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(l){this.emit("error",l)}return!0},error:function(l){return!this.isFinished&&(this.isPaused?this.generatedError=l:(this.isFinished=!0,this.emit("error",l),this.previous&&this.previous.error(l),this.cleanUp()),!0)},on:function(l,d){return this._listeners[l].push(d),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(l,d){if(this._listeners[l])for(var h=0;h<this._listeners[l].length;h++)this._listeners[l][h].call(this,d)},pipe:function(l){return l.registerPrevious(this)},registerPrevious:function(l){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=l.streamInfo,this.mergeStreamInfo(),this.previous=l;var d=this;return l.on("data",function(h){d.processChunk(h)}),l.on("end",function(){d.end()}),l.on("error",function(h){d.error(h)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var l=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),l=!0),this.previous&&this.previous.resume(),!l},flush:function(){},processChunk:function(l){this.push(l)},withStreamInfo:function(l,d){return this.extraStreamInfo[l]=d,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var l in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,l)&&(this.streamInfo[l]=this.extraStreamInfo[l])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var l="Worker "+this.name;return this.previous?this.previous+" -> "+l:l}},r.exports=o},{}],29:[function(n,r,i){var o=n("../utils"),l=n("./ConvertWorker"),d=n("./GenericWorker"),h=n("../base64"),m=n("../support"),p=n("../external"),g=null;if(m.nodestream)try{g=n("../nodejs/NodejsStreamOutputAdapter")}catch{}function v(E,x){return new p.Promise(function(S,C){var T=[],I=E._internalType,O=E._outputType,U=E._mimeType;E.on("data",function($,k){T.push($),x&&x(k)}).on("error",function($){T=[],C($)}).on("end",function(){try{var $=(function(k,R,N){switch(k){case"blob":return o.newBlob(o.transformTo("arraybuffer",R),N);case"base64":return h.encode(R);default:return o.transformTo(k,R)}})(O,(function(k,R){var N,V=0,H=null,j=0;for(N=0;N<R.length;N++)j+=R[N].length;switch(k){case"string":return R.join("");case"array":return Array.prototype.concat.apply([],R);case"uint8array":for(H=new Uint8Array(j),N=0;N<R.length;N++)H.set(R[N],V),V+=R[N].length;return H;case"nodebuffer":return Buffer.concat(R);default:throw new Error("concat : unsupported type '"+k+"'")}})(I,T),U);S($)}catch(k){C(k)}T=[]}).resume()})}function b(E,x,S){var C=x;switch(x){case"blob":case"arraybuffer":C="uint8array";break;case"base64":C="string"}try{this._internalType=C,this._outputType=x,this._mimeType=S,o.checkSupport(C),this._worker=E.pipe(new l(C)),E.lock()}catch(T){this._worker=new d("error"),this._worker.error(T)}}b.prototype={accumulate:function(E){return v(this,E)},on:function(E,x){var S=this;return E==="data"?this._worker.on(E,function(C){x.call(S,C.data,C.meta)}):this._worker.on(E,function(){o.delay(x,arguments,S)}),this},resume:function(){return o.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(E){if(o.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new g(this,{objectMode:this._outputType!=="nodebuffer"},E)}},r.exports=b},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(n,r,i){if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",i.nodebuffer=typeof Buffer<"u",i.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")i.blob=!1;else{var o=new ArrayBuffer(0);try{i.blob=new Blob([o],{type:"application/zip"}).size===0}catch{try{var l=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);l.append(o),i.blob=l.getBlob("application/zip").size===0}catch{i.blob=!1}}}try{i.nodestream=!!n("readable-stream").Readable}catch{i.nodestream=!1}},{"readable-stream":16}],31:[function(n,r,i){for(var o=n("./utils"),l=n("./support"),d=n("./nodejsUtils"),h=n("./stream/GenericWorker"),m=new Array(256),p=0;p<256;p++)m[p]=252<=p?6:248<=p?5:240<=p?4:224<=p?3:192<=p?2:1;m[254]=m[254]=1;function g(){h.call(this,"utf-8 decode"),this.leftOver=null}function v(){h.call(this,"utf-8 encode")}i.utf8encode=function(b){return l.nodebuffer?d.newBufferFrom(b,"utf-8"):(function(E){var x,S,C,T,I,O=E.length,U=0;for(T=0;T<O;T++)(64512&(S=E.charCodeAt(T)))==55296&&T+1<O&&(64512&(C=E.charCodeAt(T+1)))==56320&&(S=65536+(S-55296<<10)+(C-56320),T++),U+=S<128?1:S<2048?2:S<65536?3:4;for(x=l.uint8array?new Uint8Array(U):new Array(U),T=I=0;I<U;T++)(64512&(S=E.charCodeAt(T)))==55296&&T+1<O&&(64512&(C=E.charCodeAt(T+1)))==56320&&(S=65536+(S-55296<<10)+(C-56320),T++),S<128?x[I++]=S:(S<2048?x[I++]=192|S>>>6:(S<65536?x[I++]=224|S>>>12:(x[I++]=240|S>>>18,x[I++]=128|S>>>12&63),x[I++]=128|S>>>6&63),x[I++]=128|63&S);return x})(b)},i.utf8decode=function(b){return l.nodebuffer?o.transformTo("nodebuffer",b).toString("utf-8"):(function(E){var x,S,C,T,I=E.length,O=new Array(2*I);for(x=S=0;x<I;)if((C=E[x++])<128)O[S++]=C;else if(4<(T=m[C]))O[S++]=65533,x+=T-1;else{for(C&=T===2?31:T===3?15:7;1<T&&x<I;)C=C<<6|63&E[x++],T--;1<T?O[S++]=65533:C<65536?O[S++]=C:(C-=65536,O[S++]=55296|C>>10&1023,O[S++]=56320|1023&C)}return O.length!==S&&(O.subarray?O=O.subarray(0,S):O.length=S),o.applyFromCharCode(O)})(b=o.transformTo(l.uint8array?"uint8array":"array",b))},o.inherits(g,h),g.prototype.processChunk=function(b){var E=o.transformTo(l.uint8array?"uint8array":"array",b.data);if(this.leftOver&&this.leftOver.length){if(l.uint8array){var x=E;(E=new Uint8Array(x.length+this.leftOver.length)).set(this.leftOver,0),E.set(x,this.leftOver.length)}else E=this.leftOver.concat(E);this.leftOver=null}var S=(function(T,I){var O;for((I=I||T.length)>T.length&&(I=T.length),O=I-1;0<=O&&(192&T[O])==128;)O--;return O<0||O===0?I:O+m[T[O]]>I?O:I})(E),C=E;S!==E.length&&(l.uint8array?(C=E.subarray(0,S),this.leftOver=E.subarray(S,E.length)):(C=E.slice(0,S),this.leftOver=E.slice(S,E.length))),this.push({data:i.utf8decode(C),meta:b.meta})},g.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:i.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},i.Utf8DecodeWorker=g,o.inherits(v,h),v.prototype.processChunk=function(b){this.push({data:i.utf8encode(b.data),meta:b.meta})},i.Utf8EncodeWorker=v},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(n,r,i){var o=n("./support"),l=n("./base64"),d=n("./nodejsUtils"),h=n("./external");function m(x){return x}function p(x,S){for(var C=0;C<x.length;++C)S[C]=255&x.charCodeAt(C);return S}n("setimmediate"),i.newBlob=function(x,S){i.checkSupport("blob");try{return new Blob([x],{type:S})}catch{try{var C=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return C.append(x),C.getBlob(S)}catch{throw new Error("Bug : can't construct the Blob.")}}};var g={stringifyByChunk:function(x,S,C){var T=[],I=0,O=x.length;if(O<=C)return String.fromCharCode.apply(null,x);for(;I<O;)S==="array"||S==="nodebuffer"?T.push(String.fromCharCode.apply(null,x.slice(I,Math.min(I+C,O)))):T.push(String.fromCharCode.apply(null,x.subarray(I,Math.min(I+C,O)))),I+=C;return T.join("")},stringifyByChar:function(x){for(var S="",C=0;C<x.length;C++)S+=String.fromCharCode(x[C]);return S},applyCanBeUsed:{uint8array:(function(){try{return o.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}})(),nodebuffer:(function(){try{return o.nodebuffer&&String.fromCharCode.apply(null,d.allocBuffer(1)).length===1}catch{return!1}})()}};function v(x){var S=65536,C=i.getTypeOf(x),T=!0;if(C==="uint8array"?T=g.applyCanBeUsed.uint8array:C==="nodebuffer"&&(T=g.applyCanBeUsed.nodebuffer),T)for(;1<S;)try{return g.stringifyByChunk(x,C,S)}catch{S=Math.floor(S/2)}return g.stringifyByChar(x)}function b(x,S){for(var C=0;C<x.length;C++)S[C]=x[C];return S}i.applyFromCharCode=v;var E={};E.string={string:m,array:function(x){return p(x,new Array(x.length))},arraybuffer:function(x){return E.string.uint8array(x).buffer},uint8array:function(x){return p(x,new Uint8Array(x.length))},nodebuffer:function(x){return p(x,d.allocBuffer(x.length))}},E.array={string:v,array:m,arraybuffer:function(x){return new Uint8Array(x).buffer},uint8array:function(x){return new Uint8Array(x)},nodebuffer:function(x){return d.newBufferFrom(x)}},E.arraybuffer={string:function(x){return v(new Uint8Array(x))},array:function(x){return b(new Uint8Array(x),new Array(x.byteLength))},arraybuffer:m,uint8array:function(x){return new Uint8Array(x)},nodebuffer:function(x){return d.newBufferFrom(new Uint8Array(x))}},E.uint8array={string:v,array:function(x){return b(x,new Array(x.length))},arraybuffer:function(x){return x.buffer},uint8array:m,nodebuffer:function(x){return d.newBufferFrom(x)}},E.nodebuffer={string:v,array:function(x){return b(x,new Array(x.length))},arraybuffer:function(x){return E.nodebuffer.uint8array(x).buffer},uint8array:function(x){return b(x,new Uint8Array(x.length))},nodebuffer:m},i.transformTo=function(x,S){if(S=S||"",!x)return S;i.checkSupport(x);var C=i.getTypeOf(S);return E[C][x](S)},i.resolve=function(x){for(var S=x.split("/"),C=[],T=0;T<S.length;T++){var I=S[T];I==="."||I===""&&T!==0&&T!==S.length-1||(I===".."?C.pop():C.push(I))}return C.join("/")},i.getTypeOf=function(x){return typeof x=="string"?"string":Object.prototype.toString.call(x)==="[object Array]"?"array":o.nodebuffer&&d.isBuffer(x)?"nodebuffer":o.uint8array&&x instanceof Uint8Array?"uint8array":o.arraybuffer&&x instanceof ArrayBuffer?"arraybuffer":void 0},i.checkSupport=function(x){if(!o[x.toLowerCase()])throw new Error(x+" is not supported by this platform")},i.MAX_VALUE_16BITS=65535,i.MAX_VALUE_32BITS=-1,i.pretty=function(x){var S,C,T="";for(C=0;C<(x||"").length;C++)T+="\\x"+((S=x.charCodeAt(C))<16?"0":"")+S.toString(16).toUpperCase();return T},i.delay=function(x,S,C){setImmediate(function(){x.apply(C||null,S||[])})},i.inherits=function(x,S){function C(){}C.prototype=S.prototype,x.prototype=new C},i.extend=function(){var x,S,C={};for(x=0;x<arguments.length;x++)for(S in arguments[x])Object.prototype.hasOwnProperty.call(arguments[x],S)&&C[S]===void 0&&(C[S]=arguments[x][S]);return C},i.prepareContent=function(x,S,C,T,I){return h.Promise.resolve(S).then(function(O){return o.blob&&(O instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(O))!==-1)&&typeof FileReader<"u"?new h.Promise(function(U,$){var k=new FileReader;k.onload=function(R){U(R.target.result)},k.onerror=function(R){$(R.target.error)},k.readAsArrayBuffer(O)}):O}).then(function(O){var U=i.getTypeOf(O);return U?(U==="arraybuffer"?O=i.transformTo("uint8array",O):U==="string"&&(I?O=l.decode(O):C&&T!==!0&&(O=(function($){return p($,o.uint8array?new Uint8Array($.length):new Array($.length))})(O))),O):h.Promise.reject(new Error("Can't read the data of '"+x+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(n,r,i){var o=n("./reader/readerFor"),l=n("./utils"),d=n("./signature"),h=n("./zipEntry"),m=n("./support");function p(g){this.files=[],this.loadOptions=g}p.prototype={checkSignature:function(g){if(!this.reader.readAndCheckSignature(g)){this.reader.index-=4;var v=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+l.pretty(v)+", expected "+l.pretty(g)+")")}},isSignature:function(g,v){var b=this.reader.index;this.reader.setIndex(g);var E=this.reader.readString(4)===v;return this.reader.setIndex(b),E},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var g=this.reader.readData(this.zipCommentLength),v=m.uint8array?"uint8array":"array",b=l.transformTo(v,g);this.zipComment=this.loadOptions.decodeFileName(b)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var g,v,b,E=this.zip64EndOfCentralSize-44;0<E;)g=this.reader.readInt(2),v=this.reader.readInt(4),b=this.reader.readData(v),this.zip64ExtensibleData[g]={id:g,length:v,value:b}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var g,v;for(g=0;g<this.files.length;g++)v=this.files[g],this.reader.setIndex(v.localHeaderOffset),this.checkSignature(d.LOCAL_FILE_HEADER),v.readLocalPart(this.reader),v.handleUTF8(),v.processAttributes()},readCentralDir:function(){var g;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(d.CENTRAL_FILE_HEADER);)(g=new h({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(g);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var g=this.reader.lastIndexOfSignature(d.CENTRAL_DIRECTORY_END);if(g<0)throw this.isSignature(0,d.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(g);var v=g;if(this.checkSignature(d.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===l.MAX_VALUE_16BITS||this.diskWithCentralDirStart===l.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===l.MAX_VALUE_16BITS||this.centralDirRecords===l.MAX_VALUE_16BITS||this.centralDirSize===l.MAX_VALUE_32BITS||this.centralDirOffset===l.MAX_VALUE_32BITS){if(this.zip64=!0,(g=this.reader.lastIndexOfSignature(d.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(g),this.checkSignature(d.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,d.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(d.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(d.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var b=this.centralDirOffset+this.centralDirSize;this.zip64&&(b+=20,b+=12+this.zip64EndOfCentralSize);var E=v-b;if(0<E)this.isSignature(v,d.CENTRAL_FILE_HEADER)||(this.reader.zero=E);else if(E<0)throw new Error("Corrupted zip: missing "+Math.abs(E)+" bytes.")},prepareReader:function(g){this.reader=o(g)},load:function(g){this.prepareReader(g),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},r.exports=p},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(n,r,i){var o=n("./reader/readerFor"),l=n("./utils"),d=n("./compressedObject"),h=n("./crc32"),m=n("./utf8"),p=n("./compressions"),g=n("./support");function v(b,E){this.options=b,this.loadOptions=E}v.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(b){var E,x;if(b.skip(22),this.fileNameLength=b.readInt(2),x=b.readInt(2),this.fileName=b.readData(this.fileNameLength),b.skip(x),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((E=(function(S){for(var C in p)if(Object.prototype.hasOwnProperty.call(p,C)&&p[C].magic===S)return p[C];return null})(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+l.pretty(this.compressionMethod)+" unknown (inner file : "+l.transformTo("string",this.fileName)+")");this.decompressed=new d(this.compressedSize,this.uncompressedSize,this.crc32,E,b.readData(this.compressedSize))},readCentralPart:function(b){this.versionMadeBy=b.readInt(2),b.skip(2),this.bitFlag=b.readInt(2),this.compressionMethod=b.readString(2),this.date=b.readDate(),this.crc32=b.readInt(4),this.compressedSize=b.readInt(4),this.uncompressedSize=b.readInt(4);var E=b.readInt(2);if(this.extraFieldsLength=b.readInt(2),this.fileCommentLength=b.readInt(2),this.diskNumberStart=b.readInt(2),this.internalFileAttributes=b.readInt(2),this.externalFileAttributes=b.readInt(4),this.localHeaderOffset=b.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");b.skip(E),this.readExtraFields(b),this.parseZIP64ExtraField(b),this.fileComment=b.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var b=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),b==0&&(this.dosPermissions=63&this.externalFileAttributes),b==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var b=o(this.extraFields[1].value);this.uncompressedSize===l.MAX_VALUE_32BITS&&(this.uncompressedSize=b.readInt(8)),this.compressedSize===l.MAX_VALUE_32BITS&&(this.compressedSize=b.readInt(8)),this.localHeaderOffset===l.MAX_VALUE_32BITS&&(this.localHeaderOffset=b.readInt(8)),this.diskNumberStart===l.MAX_VALUE_32BITS&&(this.diskNumberStart=b.readInt(4))}},readExtraFields:function(b){var E,x,S,C=b.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});b.index+4<C;)E=b.readInt(2),x=b.readInt(2),S=b.readData(x),this.extraFields[E]={id:E,length:x,value:S};b.setIndex(C)},handleUTF8:function(){var b=g.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=m.utf8decode(this.fileName),this.fileCommentStr=m.utf8decode(this.fileComment);else{var E=this.findExtraFieldUnicodePath();if(E!==null)this.fileNameStr=E;else{var x=l.transformTo(b,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(x)}var S=this.findExtraFieldUnicodeComment();if(S!==null)this.fileCommentStr=S;else{var C=l.transformTo(b,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(C)}}},findExtraFieldUnicodePath:function(){var b=this.extraFields[28789];if(b){var E=o(b.value);return E.readInt(1)!==1||h(this.fileName)!==E.readInt(4)?null:m.utf8decode(E.readData(b.length-5))}return null},findExtraFieldUnicodeComment:function(){var b=this.extraFields[25461];if(b){var E=o(b.value);return E.readInt(1)!==1||h(this.fileComment)!==E.readInt(4)?null:m.utf8decode(E.readData(b.length-5))}return null}},r.exports=v},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(n,r,i){function o(E,x,S){this.name=E,this.dir=S.dir,this.date=S.date,this.comment=S.comment,this.unixPermissions=S.unixPermissions,this.dosPermissions=S.dosPermissions,this._data=x,this._dataBinary=S.binary,this.options={compression:S.compression,compressionOptions:S.compressionOptions}}var l=n("./stream/StreamHelper"),d=n("./stream/DataWorker"),h=n("./utf8"),m=n("./compressedObject"),p=n("./stream/GenericWorker");o.prototype={internalStream:function(E){var x=null,S="string";try{if(!E)throw new Error("No output type specified.");var C=(S=E.toLowerCase())==="string"||S==="text";S!=="binarystring"&&S!=="text"||(S="string"),x=this._decompressWorker();var T=!this._dataBinary;T&&!C&&(x=x.pipe(new h.Utf8EncodeWorker)),!T&&C&&(x=x.pipe(new h.Utf8DecodeWorker))}catch(I){(x=new p("error")).error(I)}return new l(x,S,"")},async:function(E,x){return this.internalStream(E).accumulate(x)},nodeStream:function(E,x){return this.internalStream(E||"nodebuffer").toNodejsStream(x)},_compressWorker:function(E,x){if(this._data instanceof m&&this._data.compression.magic===E.magic)return this._data.getCompressedWorker();var S=this._decompressWorker();return this._dataBinary||(S=S.pipe(new h.Utf8EncodeWorker)),m.createWorkerFrom(S,E,x)},_decompressWorker:function(){return this._data instanceof m?this._data.getContentWorker():this._data instanceof p?this._data:new d(this._data)}};for(var g=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],v=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},b=0;b<g.length;b++)o.prototype[g[b]]=v;r.exports=o},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(n,r,i){(function(o){var l,d,h=o.MutationObserver||o.WebKitMutationObserver;if(h){var m=0,p=new h(E),g=o.document.createTextNode("");p.observe(g,{characterData:!0}),l=function(){g.data=m=++m%2}}else if(o.setImmediate||o.MessageChannel===void 0)l="document"in o&&"onreadystatechange"in o.document.createElement("script")?function(){var x=o.document.createElement("script");x.onreadystatechange=function(){E(),x.onreadystatechange=null,x.parentNode.removeChild(x),x=null},o.document.documentElement.appendChild(x)}:function(){setTimeout(E,0)};else{var v=new o.MessageChannel;v.port1.onmessage=E,l=function(){v.port2.postMessage(0)}}var b=[];function E(){var x,S;d=!0;for(var C=b.length;C;){for(S=b,b=[],x=-1;++x<C;)S[x]();C=b.length}d=!1}r.exports=function(x){b.push(x)!==1||d||l()}}).call(this,typeof Mh<"u"?Mh:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(n,r,i){var o=n("immediate");function l(){}var d={},h=["REJECTED"],m=["FULFILLED"],p=["PENDING"];function g(C){if(typeof C!="function")throw new TypeError("resolver must be a function");this.state=p,this.queue=[],this.outcome=void 0,C!==l&&x(this,C)}function v(C,T,I){this.promise=C,typeof T=="function"&&(this.onFulfilled=T,this.callFulfilled=this.otherCallFulfilled),typeof I=="function"&&(this.onRejected=I,this.callRejected=this.otherCallRejected)}function b(C,T,I){o(function(){var O;try{O=T(I)}catch(U){return d.reject(C,U)}O===C?d.reject(C,new TypeError("Cannot resolve promise with itself")):d.resolve(C,O)})}function E(C){var T=C&&C.then;if(C&&(typeof C=="object"||typeof C=="function")&&typeof T=="function")return function(){T.apply(C,arguments)}}function x(C,T){var I=!1;function O(k){I||(I=!0,d.reject(C,k))}function U(k){I||(I=!0,d.resolve(C,k))}var $=S(function(){T(U,O)});$.status==="error"&&O($.value)}function S(C,T){var I={};try{I.value=C(T),I.status="success"}catch(O){I.status="error",I.value=O}return I}(r.exports=g).prototype.finally=function(C){if(typeof C!="function")return this;var T=this.constructor;return this.then(function(I){return T.resolve(C()).then(function(){return I})},function(I){return T.resolve(C()).then(function(){throw I})})},g.prototype.catch=function(C){return this.then(null,C)},g.prototype.then=function(C,T){if(typeof C!="function"&&this.state===m||typeof T!="function"&&this.state===h)return this;var I=new this.constructor(l);return this.state!==p?b(I,this.state===m?C:T,this.outcome):this.queue.push(new v(I,C,T)),I},v.prototype.callFulfilled=function(C){d.resolve(this.promise,C)},v.prototype.otherCallFulfilled=function(C){b(this.promise,this.onFulfilled,C)},v.prototype.callRejected=function(C){d.reject(this.promise,C)},v.prototype.otherCallRejected=function(C){b(this.promise,this.onRejected,C)},d.resolve=function(C,T){var I=S(E,T);if(I.status==="error")return d.reject(C,I.value);var O=I.value;if(O)x(C,O);else{C.state=m,C.outcome=T;for(var U=-1,$=C.queue.length;++U<$;)C.queue[U].callFulfilled(T)}return C},d.reject=function(C,T){C.state=h,C.outcome=T;for(var I=-1,O=C.queue.length;++I<O;)C.queue[I].callRejected(T);return C},g.resolve=function(C){return C instanceof this?C:d.resolve(new this(l),C)},g.reject=function(C){var T=new this(l);return d.reject(T,C)},g.all=function(C){var T=this;if(Object.prototype.toString.call(C)!=="[object Array]")return this.reject(new TypeError("must be an array"));var I=C.length,O=!1;if(!I)return this.resolve([]);for(var U=new Array(I),$=0,k=-1,R=new this(l);++k<I;)N(C[k],k);return R;function N(V,H){T.resolve(V).then(function(j){U[H]=j,++$!==I||O||(O=!0,d.resolve(R,U))},function(j){O||(O=!0,d.reject(R,j))})}},g.race=function(C){var T=this;if(Object.prototype.toString.call(C)!=="[object Array]")return this.reject(new TypeError("must be an array"));var I=C.length,O=!1;if(!I)return this.resolve([]);for(var U=-1,$=new this(l);++U<I;)k=C[U],T.resolve(k).then(function(R){O||(O=!0,d.resolve($,R))},function(R){O||(O=!0,d.reject($,R))});var k;return $}},{immediate:36}],38:[function(n,r,i){var o={};(0,n("./lib/utils/common").assign)(o,n("./lib/deflate"),n("./lib/inflate"),n("./lib/zlib/constants")),r.exports=o},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(n,r,i){var o=n("./zlib/deflate"),l=n("./utils/common"),d=n("./utils/strings"),h=n("./zlib/messages"),m=n("./zlib/zstream"),p=Object.prototype.toString,g=0,v=-1,b=0,E=8;function x(C){if(!(this instanceof x))return new x(C);this.options=l.assign({level:v,method:E,chunkSize:16384,windowBits:15,memLevel:8,strategy:b,to:""},C||{});var T=this.options;T.raw&&0<T.windowBits?T.windowBits=-T.windowBits:T.gzip&&0<T.windowBits&&T.windowBits<16&&(T.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new m,this.strm.avail_out=0;var I=o.deflateInit2(this.strm,T.level,T.method,T.windowBits,T.memLevel,T.strategy);if(I!==g)throw new Error(h[I]);if(T.header&&o.deflateSetHeader(this.strm,T.header),T.dictionary){var O;if(O=typeof T.dictionary=="string"?d.string2buf(T.dictionary):p.call(T.dictionary)==="[object ArrayBuffer]"?new Uint8Array(T.dictionary):T.dictionary,(I=o.deflateSetDictionary(this.strm,O))!==g)throw new Error(h[I]);this._dict_set=!0}}function S(C,T){var I=new x(T);if(I.push(C,!0),I.err)throw I.msg||h[I.err];return I.result}x.prototype.push=function(C,T){var I,O,U=this.strm,$=this.options.chunkSize;if(this.ended)return!1;O=T===~~T?T:T===!0?4:0,typeof C=="string"?U.input=d.string2buf(C):p.call(C)==="[object ArrayBuffer]"?U.input=new Uint8Array(C):U.input=C,U.next_in=0,U.avail_in=U.input.length;do{if(U.avail_out===0&&(U.output=new l.Buf8($),U.next_out=0,U.avail_out=$),(I=o.deflate(U,O))!==1&&I!==g)return this.onEnd(I),!(this.ended=!0);U.avail_out!==0&&(U.avail_in!==0||O!==4&&O!==2)||(this.options.to==="string"?this.onData(d.buf2binstring(l.shrinkBuf(U.output,U.next_out))):this.onData(l.shrinkBuf(U.output,U.next_out)))}while((0<U.avail_in||U.avail_out===0)&&I!==1);return O===4?(I=o.deflateEnd(this.strm),this.onEnd(I),this.ended=!0,I===g):O!==2||(this.onEnd(g),!(U.avail_out=0))},x.prototype.onData=function(C){this.chunks.push(C)},x.prototype.onEnd=function(C){C===g&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=l.flattenChunks(this.chunks)),this.chunks=[],this.err=C,this.msg=this.strm.msg},i.Deflate=x,i.deflate=S,i.deflateRaw=function(C,T){return(T=T||{}).raw=!0,S(C,T)},i.gzip=function(C,T){return(T=T||{}).gzip=!0,S(C,T)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(n,r,i){var o=n("./zlib/inflate"),l=n("./utils/common"),d=n("./utils/strings"),h=n("./zlib/constants"),m=n("./zlib/messages"),p=n("./zlib/zstream"),g=n("./zlib/gzheader"),v=Object.prototype.toString;function b(x){if(!(this instanceof b))return new b(x);this.options=l.assign({chunkSize:16384,windowBits:0,to:""},x||{});var S=this.options;S.raw&&0<=S.windowBits&&S.windowBits<16&&(S.windowBits=-S.windowBits,S.windowBits===0&&(S.windowBits=-15)),!(0<=S.windowBits&&S.windowBits<16)||x&&x.windowBits||(S.windowBits+=32),15<S.windowBits&&S.windowBits<48&&(15&S.windowBits)==0&&(S.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new p,this.strm.avail_out=0;var C=o.inflateInit2(this.strm,S.windowBits);if(C!==h.Z_OK)throw new Error(m[C]);this.header=new g,o.inflateGetHeader(this.strm,this.header)}function E(x,S){var C=new b(S);if(C.push(x,!0),C.err)throw C.msg||m[C.err];return C.result}b.prototype.push=function(x,S){var C,T,I,O,U,$,k=this.strm,R=this.options.chunkSize,N=this.options.dictionary,V=!1;if(this.ended)return!1;T=S===~~S?S:S===!0?h.Z_FINISH:h.Z_NO_FLUSH,typeof x=="string"?k.input=d.binstring2buf(x):v.call(x)==="[object ArrayBuffer]"?k.input=new Uint8Array(x):k.input=x,k.next_in=0,k.avail_in=k.input.length;do{if(k.avail_out===0&&(k.output=new l.Buf8(R),k.next_out=0,k.avail_out=R),(C=o.inflate(k,h.Z_NO_FLUSH))===h.Z_NEED_DICT&&N&&($=typeof N=="string"?d.string2buf(N):v.call(N)==="[object ArrayBuffer]"?new Uint8Array(N):N,C=o.inflateSetDictionary(this.strm,$)),C===h.Z_BUF_ERROR&&V===!0&&(C=h.Z_OK,V=!1),C!==h.Z_STREAM_END&&C!==h.Z_OK)return this.onEnd(C),!(this.ended=!0);k.next_out&&(k.avail_out!==0&&C!==h.Z_STREAM_END&&(k.avail_in!==0||T!==h.Z_FINISH&&T!==h.Z_SYNC_FLUSH)||(this.options.to==="string"?(I=d.utf8border(k.output,k.next_out),O=k.next_out-I,U=d.buf2string(k.output,I),k.next_out=O,k.avail_out=R-O,O&&l.arraySet(k.output,k.output,I,O,0),this.onData(U)):this.onData(l.shrinkBuf(k.output,k.next_out)))),k.avail_in===0&&k.avail_out===0&&(V=!0)}while((0<k.avail_in||k.avail_out===0)&&C!==h.Z_STREAM_END);return C===h.Z_STREAM_END&&(T=h.Z_FINISH),T===h.Z_FINISH?(C=o.inflateEnd(this.strm),this.onEnd(C),this.ended=!0,C===h.Z_OK):T!==h.Z_SYNC_FLUSH||(this.onEnd(h.Z_OK),!(k.avail_out=0))},b.prototype.onData=function(x){this.chunks.push(x)},b.prototype.onEnd=function(x){x===h.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=l.flattenChunks(this.chunks)),this.chunks=[],this.err=x,this.msg=this.strm.msg},i.Inflate=b,i.inflate=E,i.inflateRaw=function(x,S){return(S=S||{}).raw=!0,E(x,S)},i.ungzip=E},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(n,r,i){var o=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";i.assign=function(h){for(var m=Array.prototype.slice.call(arguments,1);m.length;){var p=m.shift();if(p){if(typeof p!="object")throw new TypeError(p+"must be non-object");for(var g in p)p.hasOwnProperty(g)&&(h[g]=p[g])}}return h},i.shrinkBuf=function(h,m){return h.length===m?h:h.subarray?h.subarray(0,m):(h.length=m,h)};var l={arraySet:function(h,m,p,g,v){if(m.subarray&&h.subarray)h.set(m.subarray(p,p+g),v);else for(var b=0;b<g;b++)h[v+b]=m[p+b]},flattenChunks:function(h){var m,p,g,v,b,E;for(m=g=0,p=h.length;m<p;m++)g+=h[m].length;for(E=new Uint8Array(g),m=v=0,p=h.length;m<p;m++)b=h[m],E.set(b,v),v+=b.length;return E}},d={arraySet:function(h,m,p,g,v){for(var b=0;b<g;b++)h[v+b]=m[p+b]},flattenChunks:function(h){return[].concat.apply([],h)}};i.setTyped=function(h){h?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,l)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,d))},i.setTyped(o)},{}],42:[function(n,r,i){var o=n("./common"),l=!0,d=!0;try{String.fromCharCode.apply(null,[0])}catch{l=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{d=!1}for(var h=new o.Buf8(256),m=0;m<256;m++)h[m]=252<=m?6:248<=m?5:240<=m?4:224<=m?3:192<=m?2:1;function p(g,v){if(v<65537&&(g.subarray&&d||!g.subarray&&l))return String.fromCharCode.apply(null,o.shrinkBuf(g,v));for(var b="",E=0;E<v;E++)b+=String.fromCharCode(g[E]);return b}h[254]=h[254]=1,i.string2buf=function(g){var v,b,E,x,S,C=g.length,T=0;for(x=0;x<C;x++)(64512&(b=g.charCodeAt(x)))==55296&&x+1<C&&(64512&(E=g.charCodeAt(x+1)))==56320&&(b=65536+(b-55296<<10)+(E-56320),x++),T+=b<128?1:b<2048?2:b<65536?3:4;for(v=new o.Buf8(T),x=S=0;S<T;x++)(64512&(b=g.charCodeAt(x)))==55296&&x+1<C&&(64512&(E=g.charCodeAt(x+1)))==56320&&(b=65536+(b-55296<<10)+(E-56320),x++),b<128?v[S++]=b:(b<2048?v[S++]=192|b>>>6:(b<65536?v[S++]=224|b>>>12:(v[S++]=240|b>>>18,v[S++]=128|b>>>12&63),v[S++]=128|b>>>6&63),v[S++]=128|63&b);return v},i.buf2binstring=function(g){return p(g,g.length)},i.binstring2buf=function(g){for(var v=new o.Buf8(g.length),b=0,E=v.length;b<E;b++)v[b]=g.charCodeAt(b);return v},i.buf2string=function(g,v){var b,E,x,S,C=v||g.length,T=new Array(2*C);for(b=E=0;b<C;)if((x=g[b++])<128)T[E++]=x;else if(4<(S=h[x]))T[E++]=65533,b+=S-1;else{for(x&=S===2?31:S===3?15:7;1<S&&b<C;)x=x<<6|63&g[b++],S--;1<S?T[E++]=65533:x<65536?T[E++]=x:(x-=65536,T[E++]=55296|x>>10&1023,T[E++]=56320|1023&x)}return p(T,E)},i.utf8border=function(g,v){var b;for((v=v||g.length)>g.length&&(v=g.length),b=v-1;0<=b&&(192&g[b])==128;)b--;return b<0||b===0?v:b+h[g[b]]>v?b:v}},{"./common":41}],43:[function(n,r,i){r.exports=function(o,l,d,h){for(var m=65535&o|0,p=o>>>16&65535|0,g=0;d!==0;){for(d-=g=2e3<d?2e3:d;p=p+(m=m+l[h++]|0)|0,--g;);m%=65521,p%=65521}return m|p<<16|0}},{}],44:[function(n,r,i){r.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(n,r,i){var o=(function(){for(var l,d=[],h=0;h<256;h++){l=h;for(var m=0;m<8;m++)l=1&l?3988292384^l>>>1:l>>>1;d[h]=l}return d})();r.exports=function(l,d,h,m){var p=o,g=m+h;l^=-1;for(var v=m;v<g;v++)l=l>>>8^p[255&(l^d[v])];return-1^l}},{}],46:[function(n,r,i){var o,l=n("../utils/common"),d=n("./trees"),h=n("./adler32"),m=n("./crc32"),p=n("./messages"),g=0,v=4,b=0,E=-2,x=-1,S=4,C=2,T=8,I=9,O=286,U=30,$=19,k=2*O+1,R=15,N=3,V=258,H=V+N+1,j=42,B=113,M=1,Z=2,K=3,q=4;function W(L,de){return L.msg=p[de],de}function X(L){return(L<<1)-(4<L?9:0)}function re(L){for(var de=L.length;0<=--de;)L[de]=0}function z(L){var de=L.state,ye=de.pending;ye>L.avail_out&&(ye=L.avail_out),ye!==0&&(l.arraySet(L.output,de.pending_buf,de.pending_out,ye,L.next_out),L.next_out+=ye,de.pending_out+=ye,L.total_out+=ye,L.avail_out-=ye,de.pending-=ye,de.pending===0&&(de.pending_out=0))}function G(L,de){d._tr_flush_block(L,0<=L.block_start?L.block_start:-1,L.strstart-L.block_start,de),L.block_start=L.strstart,z(L.strm)}function te(L,de){L.pending_buf[L.pending++]=de}function se(L,de){L.pending_buf[L.pending++]=de>>>8&255,L.pending_buf[L.pending++]=255&de}function ie(L,de){var ye,ee,J=L.max_chain_length,oe=L.strstart,Se=L.prev_length,xe=L.nice_match,ae=L.strstart>L.w_size-H?L.strstart-(L.w_size-H):0,Ae=L.window,Oe=L.w_mask,De=L.prev,qe=L.strstart+V,xt=Ae[oe+Se-1],nt=Ae[oe+Se];L.prev_length>=L.good_match&&(J>>=2),xe>L.lookahead&&(xe=L.lookahead);do if(Ae[(ye=de)+Se]===nt&&Ae[ye+Se-1]===xt&&Ae[ye]===Ae[oe]&&Ae[++ye]===Ae[oe+1]){oe+=2,ye++;do;while(Ae[++oe]===Ae[++ye]&&Ae[++oe]===Ae[++ye]&&Ae[++oe]===Ae[++ye]&&Ae[++oe]===Ae[++ye]&&Ae[++oe]===Ae[++ye]&&Ae[++oe]===Ae[++ye]&&Ae[++oe]===Ae[++ye]&&Ae[++oe]===Ae[++ye]&&oe<qe);if(ee=V-(qe-oe),oe=qe-V,Se<ee){if(L.match_start=de,xe<=(Se=ee))break;xt=Ae[oe+Se-1],nt=Ae[oe+Se]}}while((de=De[de&Oe])>ae&&--J!=0);return Se<=L.lookahead?Se:L.lookahead}function ce(L){var de,ye,ee,J,oe,Se,xe,ae,Ae,Oe,De=L.w_size;do{if(J=L.window_size-L.lookahead-L.strstart,L.strstart>=De+(De-H)){for(l.arraySet(L.window,L.window,De,De,0),L.match_start-=De,L.strstart-=De,L.block_start-=De,de=ye=L.hash_size;ee=L.head[--de],L.head[de]=De<=ee?ee-De:0,--ye;);for(de=ye=De;ee=L.prev[--de],L.prev[de]=De<=ee?ee-De:0,--ye;);J+=De}if(L.strm.avail_in===0)break;if(Se=L.strm,xe=L.window,ae=L.strstart+L.lookahead,Ae=J,Oe=void 0,Oe=Se.avail_in,Ae<Oe&&(Oe=Ae),ye=Oe===0?0:(Se.avail_in-=Oe,l.arraySet(xe,Se.input,Se.next_in,Oe,ae),Se.state.wrap===1?Se.adler=h(Se.adler,xe,Oe,ae):Se.state.wrap===2&&(Se.adler=m(Se.adler,xe,Oe,ae)),Se.next_in+=Oe,Se.total_in+=Oe,Oe),L.lookahead+=ye,L.lookahead+L.insert>=N)for(oe=L.strstart-L.insert,L.ins_h=L.window[oe],L.ins_h=(L.ins_h<<L.hash_shift^L.window[oe+1])&L.hash_mask;L.insert&&(L.ins_h=(L.ins_h<<L.hash_shift^L.window[oe+N-1])&L.hash_mask,L.prev[oe&L.w_mask]=L.head[L.ins_h],L.head[L.ins_h]=oe,oe++,L.insert--,!(L.lookahead+L.insert<N)););}while(L.lookahead<H&&L.strm.avail_in!==0)}function we(L,de){for(var ye,ee;;){if(L.lookahead<H){if(ce(L),L.lookahead<H&&de===g)return M;if(L.lookahead===0)break}if(ye=0,L.lookahead>=N&&(L.ins_h=(L.ins_h<<L.hash_shift^L.window[L.strstart+N-1])&L.hash_mask,ye=L.prev[L.strstart&L.w_mask]=L.head[L.ins_h],L.head[L.ins_h]=L.strstart),ye!==0&&L.strstart-ye<=L.w_size-H&&(L.match_length=ie(L,ye)),L.match_length>=N)if(ee=d._tr_tally(L,L.strstart-L.match_start,L.match_length-N),L.lookahead-=L.match_length,L.match_length<=L.max_lazy_match&&L.lookahead>=N){for(L.match_length--;L.strstart++,L.ins_h=(L.ins_h<<L.hash_shift^L.window[L.strstart+N-1])&L.hash_mask,ye=L.prev[L.strstart&L.w_mask]=L.head[L.ins_h],L.head[L.ins_h]=L.strstart,--L.match_length!=0;);L.strstart++}else L.strstart+=L.match_length,L.match_length=0,L.ins_h=L.window[L.strstart],L.ins_h=(L.ins_h<<L.hash_shift^L.window[L.strstart+1])&L.hash_mask;else ee=d._tr_tally(L,0,L.window[L.strstart]),L.lookahead--,L.strstart++;if(ee&&(G(L,!1),L.strm.avail_out===0))return M}return L.insert=L.strstart<N-1?L.strstart:N-1,de===v?(G(L,!0),L.strm.avail_out===0?K:q):L.last_lit&&(G(L,!1),L.strm.avail_out===0)?M:Z}function he(L,de){for(var ye,ee,J;;){if(L.lookahead<H){if(ce(L),L.lookahead<H&&de===g)return M;if(L.lookahead===0)break}if(ye=0,L.lookahead>=N&&(L.ins_h=(L.ins_h<<L.hash_shift^L.window[L.strstart+N-1])&L.hash_mask,ye=L.prev[L.strstart&L.w_mask]=L.head[L.ins_h],L.head[L.ins_h]=L.strstart),L.prev_length=L.match_length,L.prev_match=L.match_start,L.match_length=N-1,ye!==0&&L.prev_length<L.max_lazy_match&&L.strstart-ye<=L.w_size-H&&(L.match_length=ie(L,ye),L.match_length<=5&&(L.strategy===1||L.match_length===N&&4096<L.strstart-L.match_start)&&(L.match_length=N-1)),L.prev_length>=N&&L.match_length<=L.prev_length){for(J=L.strstart+L.lookahead-N,ee=d._tr_tally(L,L.strstart-1-L.prev_match,L.prev_length-N),L.lookahead-=L.prev_length-1,L.prev_length-=2;++L.strstart<=J&&(L.ins_h=(L.ins_h<<L.hash_shift^L.window[L.strstart+N-1])&L.hash_mask,ye=L.prev[L.strstart&L.w_mask]=L.head[L.ins_h],L.head[L.ins_h]=L.strstart),--L.prev_length!=0;);if(L.match_available=0,L.match_length=N-1,L.strstart++,ee&&(G(L,!1),L.strm.avail_out===0))return M}else if(L.match_available){if((ee=d._tr_tally(L,0,L.window[L.strstart-1]))&&G(L,!1),L.strstart++,L.lookahead--,L.strm.avail_out===0)return M}else L.match_available=1,L.strstart++,L.lookahead--}return L.match_available&&(ee=d._tr_tally(L,0,L.window[L.strstart-1]),L.match_available=0),L.insert=L.strstart<N-1?L.strstart:N-1,de===v?(G(L,!0),L.strm.avail_out===0?K:q):L.last_lit&&(G(L,!1),L.strm.avail_out===0)?M:Z}function Ee(L,de,ye,ee,J){this.good_length=L,this.max_lazy=de,this.nice_length=ye,this.max_chain=ee,this.func=J}function Ue(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=T,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new l.Buf16(2*k),this.dyn_dtree=new l.Buf16(2*(2*U+1)),this.bl_tree=new l.Buf16(2*(2*$+1)),re(this.dyn_ltree),re(this.dyn_dtree),re(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new l.Buf16(R+1),this.heap=new l.Buf16(2*O+1),re(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new l.Buf16(2*O+1),re(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Be(L){var de;return L&&L.state?(L.total_in=L.total_out=0,L.data_type=C,(de=L.state).pending=0,de.pending_out=0,de.wrap<0&&(de.wrap=-de.wrap),de.status=de.wrap?j:B,L.adler=de.wrap===2?0:1,de.last_flush=g,d._tr_init(de),b):W(L,E)}function gt(L){var de=Be(L);return de===b&&(function(ye){ye.window_size=2*ye.w_size,re(ye.head),ye.max_lazy_match=o[ye.level].max_lazy,ye.good_match=o[ye.level].good_length,ye.nice_match=o[ye.level].nice_length,ye.max_chain_length=o[ye.level].max_chain,ye.strstart=0,ye.block_start=0,ye.lookahead=0,ye.insert=0,ye.match_length=ye.prev_length=N-1,ye.match_available=0,ye.ins_h=0})(L.state),de}function yt(L,de,ye,ee,J,oe){if(!L)return E;var Se=1;if(de===x&&(de=6),ee<0?(Se=0,ee=-ee):15<ee&&(Se=2,ee-=16),J<1||I<J||ye!==T||ee<8||15<ee||de<0||9<de||oe<0||S<oe)return W(L,E);ee===8&&(ee=9);var xe=new Ue;return(L.state=xe).strm=L,xe.wrap=Se,xe.gzhead=null,xe.w_bits=ee,xe.w_size=1<<xe.w_bits,xe.w_mask=xe.w_size-1,xe.hash_bits=J+7,xe.hash_size=1<<xe.hash_bits,xe.hash_mask=xe.hash_size-1,xe.hash_shift=~~((xe.hash_bits+N-1)/N),xe.window=new l.Buf8(2*xe.w_size),xe.head=new l.Buf16(xe.hash_size),xe.prev=new l.Buf16(xe.w_size),xe.lit_bufsize=1<<J+6,xe.pending_buf_size=4*xe.lit_bufsize,xe.pending_buf=new l.Buf8(xe.pending_buf_size),xe.d_buf=1*xe.lit_bufsize,xe.l_buf=3*xe.lit_bufsize,xe.level=de,xe.strategy=oe,xe.method=ye,gt(L)}o=[new Ee(0,0,0,0,function(L,de){var ye=65535;for(ye>L.pending_buf_size-5&&(ye=L.pending_buf_size-5);;){if(L.lookahead<=1){if(ce(L),L.lookahead===0&&de===g)return M;if(L.lookahead===0)break}L.strstart+=L.lookahead,L.lookahead=0;var ee=L.block_start+ye;if((L.strstart===0||L.strstart>=ee)&&(L.lookahead=L.strstart-ee,L.strstart=ee,G(L,!1),L.strm.avail_out===0)||L.strstart-L.block_start>=L.w_size-H&&(G(L,!1),L.strm.avail_out===0))return M}return L.insert=0,de===v?(G(L,!0),L.strm.avail_out===0?K:q):(L.strstart>L.block_start&&(G(L,!1),L.strm.avail_out),M)}),new Ee(4,4,8,4,we),new Ee(4,5,16,8,we),new Ee(4,6,32,32,we),new Ee(4,4,16,16,he),new Ee(8,16,32,32,he),new Ee(8,16,128,128,he),new Ee(8,32,128,256,he),new Ee(32,128,258,1024,he),new Ee(32,258,258,4096,he)],i.deflateInit=function(L,de){return yt(L,de,T,15,8,0)},i.deflateInit2=yt,i.deflateReset=gt,i.deflateResetKeep=Be,i.deflateSetHeader=function(L,de){return L&&L.state?L.state.wrap!==2?E:(L.state.gzhead=de,b):E},i.deflate=function(L,de){var ye,ee,J,oe;if(!L||!L.state||5<de||de<0)return L?W(L,E):E;if(ee=L.state,!L.output||!L.input&&L.avail_in!==0||ee.status===666&&de!==v)return W(L,L.avail_out===0?-5:E);if(ee.strm=L,ye=ee.last_flush,ee.last_flush=de,ee.status===j)if(ee.wrap===2)L.adler=0,te(ee,31),te(ee,139),te(ee,8),ee.gzhead?(te(ee,(ee.gzhead.text?1:0)+(ee.gzhead.hcrc?2:0)+(ee.gzhead.extra?4:0)+(ee.gzhead.name?8:0)+(ee.gzhead.comment?16:0)),te(ee,255&ee.gzhead.time),te(ee,ee.gzhead.time>>8&255),te(ee,ee.gzhead.time>>16&255),te(ee,ee.gzhead.time>>24&255),te(ee,ee.level===9?2:2<=ee.strategy||ee.level<2?4:0),te(ee,255&ee.gzhead.os),ee.gzhead.extra&&ee.gzhead.extra.length&&(te(ee,255&ee.gzhead.extra.length),te(ee,ee.gzhead.extra.length>>8&255)),ee.gzhead.hcrc&&(L.adler=m(L.adler,ee.pending_buf,ee.pending,0)),ee.gzindex=0,ee.status=69):(te(ee,0),te(ee,0),te(ee,0),te(ee,0),te(ee,0),te(ee,ee.level===9?2:2<=ee.strategy||ee.level<2?4:0),te(ee,3),ee.status=B);else{var Se=T+(ee.w_bits-8<<4)<<8;Se|=(2<=ee.strategy||ee.level<2?0:ee.level<6?1:ee.level===6?2:3)<<6,ee.strstart!==0&&(Se|=32),Se+=31-Se%31,ee.status=B,se(ee,Se),ee.strstart!==0&&(se(ee,L.adler>>>16),se(ee,65535&L.adler)),L.adler=1}if(ee.status===69)if(ee.gzhead.extra){for(J=ee.pending;ee.gzindex<(65535&ee.gzhead.extra.length)&&(ee.pending!==ee.pending_buf_size||(ee.gzhead.hcrc&&ee.pending>J&&(L.adler=m(L.adler,ee.pending_buf,ee.pending-J,J)),z(L),J=ee.pending,ee.pending!==ee.pending_buf_size));)te(ee,255&ee.gzhead.extra[ee.gzindex]),ee.gzindex++;ee.gzhead.hcrc&&ee.pending>J&&(L.adler=m(L.adler,ee.pending_buf,ee.pending-J,J)),ee.gzindex===ee.gzhead.extra.length&&(ee.gzindex=0,ee.status=73)}else ee.status=73;if(ee.status===73)if(ee.gzhead.name){J=ee.pending;do{if(ee.pending===ee.pending_buf_size&&(ee.gzhead.hcrc&&ee.pending>J&&(L.adler=m(L.adler,ee.pending_buf,ee.pending-J,J)),z(L),J=ee.pending,ee.pending===ee.pending_buf_size)){oe=1;break}oe=ee.gzindex<ee.gzhead.name.length?255&ee.gzhead.name.charCodeAt(ee.gzindex++):0,te(ee,oe)}while(oe!==0);ee.gzhead.hcrc&&ee.pending>J&&(L.adler=m(L.adler,ee.pending_buf,ee.pending-J,J)),oe===0&&(ee.gzindex=0,ee.status=91)}else ee.status=91;if(ee.status===91)if(ee.gzhead.comment){J=ee.pending;do{if(ee.pending===ee.pending_buf_size&&(ee.gzhead.hcrc&&ee.pending>J&&(L.adler=m(L.adler,ee.pending_buf,ee.pending-J,J)),z(L),J=ee.pending,ee.pending===ee.pending_buf_size)){oe=1;break}oe=ee.gzindex<ee.gzhead.comment.length?255&ee.gzhead.comment.charCodeAt(ee.gzindex++):0,te(ee,oe)}while(oe!==0);ee.gzhead.hcrc&&ee.pending>J&&(L.adler=m(L.adler,ee.pending_buf,ee.pending-J,J)),oe===0&&(ee.status=103)}else ee.status=103;if(ee.status===103&&(ee.gzhead.hcrc?(ee.pending+2>ee.pending_buf_size&&z(L),ee.pending+2<=ee.pending_buf_size&&(te(ee,255&L.adler),te(ee,L.adler>>8&255),L.adler=0,ee.status=B)):ee.status=B),ee.pending!==0){if(z(L),L.avail_out===0)return ee.last_flush=-1,b}else if(L.avail_in===0&&X(de)<=X(ye)&&de!==v)return W(L,-5);if(ee.status===666&&L.avail_in!==0)return W(L,-5);if(L.avail_in!==0||ee.lookahead!==0||de!==g&&ee.status!==666){var xe=ee.strategy===2?(function(ae,Ae){for(var Oe;;){if(ae.lookahead===0&&(ce(ae),ae.lookahead===0)){if(Ae===g)return M;break}if(ae.match_length=0,Oe=d._tr_tally(ae,0,ae.window[ae.strstart]),ae.lookahead--,ae.strstart++,Oe&&(G(ae,!1),ae.strm.avail_out===0))return M}return ae.insert=0,Ae===v?(G(ae,!0),ae.strm.avail_out===0?K:q):ae.last_lit&&(G(ae,!1),ae.strm.avail_out===0)?M:Z})(ee,de):ee.strategy===3?(function(ae,Ae){for(var Oe,De,qe,xt,nt=ae.window;;){if(ae.lookahead<=V){if(ce(ae),ae.lookahead<=V&&Ae===g)return M;if(ae.lookahead===0)break}if(ae.match_length=0,ae.lookahead>=N&&0<ae.strstart&&(De=nt[qe=ae.strstart-1])===nt[++qe]&&De===nt[++qe]&&De===nt[++qe]){xt=ae.strstart+V;do;while(De===nt[++qe]&&De===nt[++qe]&&De===nt[++qe]&&De===nt[++qe]&&De===nt[++qe]&&De===nt[++qe]&&De===nt[++qe]&&De===nt[++qe]&&qe<xt);ae.match_length=V-(xt-qe),ae.match_length>ae.lookahead&&(ae.match_length=ae.lookahead)}if(ae.match_length>=N?(Oe=d._tr_tally(ae,1,ae.match_length-N),ae.lookahead-=ae.match_length,ae.strstart+=ae.match_length,ae.match_length=0):(Oe=d._tr_tally(ae,0,ae.window[ae.strstart]),ae.lookahead--,ae.strstart++),Oe&&(G(ae,!1),ae.strm.avail_out===0))return M}return ae.insert=0,Ae===v?(G(ae,!0),ae.strm.avail_out===0?K:q):ae.last_lit&&(G(ae,!1),ae.strm.avail_out===0)?M:Z})(ee,de):o[ee.level].func(ee,de);if(xe!==K&&xe!==q||(ee.status=666),xe===M||xe===K)return L.avail_out===0&&(ee.last_flush=-1),b;if(xe===Z&&(de===1?d._tr_align(ee):de!==5&&(d._tr_stored_block(ee,0,0,!1),de===3&&(re(ee.head),ee.lookahead===0&&(ee.strstart=0,ee.block_start=0,ee.insert=0))),z(L),L.avail_out===0))return ee.last_flush=-1,b}return de!==v?b:ee.wrap<=0?1:(ee.wrap===2?(te(ee,255&L.adler),te(ee,L.adler>>8&255),te(ee,L.adler>>16&255),te(ee,L.adler>>24&255),te(ee,255&L.total_in),te(ee,L.total_in>>8&255),te(ee,L.total_in>>16&255),te(ee,L.total_in>>24&255)):(se(ee,L.adler>>>16),se(ee,65535&L.adler)),z(L),0<ee.wrap&&(ee.wrap=-ee.wrap),ee.pending!==0?b:1)},i.deflateEnd=function(L){var de;return L&&L.state?(de=L.state.status)!==j&&de!==69&&de!==73&&de!==91&&de!==103&&de!==B&&de!==666?W(L,E):(L.state=null,de===B?W(L,-3):b):E},i.deflateSetDictionary=function(L,de){var ye,ee,J,oe,Se,xe,ae,Ae,Oe=de.length;if(!L||!L.state||(oe=(ye=L.state).wrap)===2||oe===1&&ye.status!==j||ye.lookahead)return E;for(oe===1&&(L.adler=h(L.adler,de,Oe,0)),ye.wrap=0,Oe>=ye.w_size&&(oe===0&&(re(ye.head),ye.strstart=0,ye.block_start=0,ye.insert=0),Ae=new l.Buf8(ye.w_size),l.arraySet(Ae,de,Oe-ye.w_size,ye.w_size,0),de=Ae,Oe=ye.w_size),Se=L.avail_in,xe=L.next_in,ae=L.input,L.avail_in=Oe,L.next_in=0,L.input=de,ce(ye);ye.lookahead>=N;){for(ee=ye.strstart,J=ye.lookahead-(N-1);ye.ins_h=(ye.ins_h<<ye.hash_shift^ye.window[ee+N-1])&ye.hash_mask,ye.prev[ee&ye.w_mask]=ye.head[ye.ins_h],ye.head[ye.ins_h]=ee,ee++,--J;);ye.strstart=ee,ye.lookahead=N-1,ce(ye)}return ye.strstart+=ye.lookahead,ye.block_start=ye.strstart,ye.insert=ye.lookahead,ye.lookahead=0,ye.match_length=ye.prev_length=N-1,ye.match_available=0,L.next_in=xe,L.input=ae,L.avail_in=Se,ye.wrap=oe,b},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(n,r,i){r.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(n,r,i){r.exports=function(o,l){var d,h,m,p,g,v,b,E,x,S,C,T,I,O,U,$,k,R,N,V,H,j,B,M,Z;d=o.state,h=o.next_in,M=o.input,m=h+(o.avail_in-5),p=o.next_out,Z=o.output,g=p-(l-o.avail_out),v=p+(o.avail_out-257),b=d.dmax,E=d.wsize,x=d.whave,S=d.wnext,C=d.window,T=d.hold,I=d.bits,O=d.lencode,U=d.distcode,$=(1<<d.lenbits)-1,k=(1<<d.distbits)-1;e:do{I<15&&(T+=M[h++]<<I,I+=8,T+=M[h++]<<I,I+=8),R=O[T&$];t:for(;;){if(T>>>=N=R>>>24,I-=N,(N=R>>>16&255)===0)Z[p++]=65535&R;else{if(!(16&N)){if((64&N)==0){R=O[(65535&R)+(T&(1<<N)-1)];continue t}if(32&N){d.mode=12;break e}o.msg="invalid literal/length code",d.mode=30;break e}V=65535&R,(N&=15)&&(I<N&&(T+=M[h++]<<I,I+=8),V+=T&(1<<N)-1,T>>>=N,I-=N),I<15&&(T+=M[h++]<<I,I+=8,T+=M[h++]<<I,I+=8),R=U[T&k];n:for(;;){if(T>>>=N=R>>>24,I-=N,!(16&(N=R>>>16&255))){if((64&N)==0){R=U[(65535&R)+(T&(1<<N)-1)];continue n}o.msg="invalid distance code",d.mode=30;break e}if(H=65535&R,I<(N&=15)&&(T+=M[h++]<<I,(I+=8)<N&&(T+=M[h++]<<I,I+=8)),b<(H+=T&(1<<N)-1)){o.msg="invalid distance too far back",d.mode=30;break e}if(T>>>=N,I-=N,(N=p-g)<H){if(x<(N=H-N)&&d.sane){o.msg="invalid distance too far back",d.mode=30;break e}if(B=C,(j=0)===S){if(j+=E-N,N<V){for(V-=N;Z[p++]=C[j++],--N;);j=p-H,B=Z}}else if(S<N){if(j+=E+S-N,(N-=S)<V){for(V-=N;Z[p++]=C[j++],--N;);if(j=0,S<V){for(V-=N=S;Z[p++]=C[j++],--N;);j=p-H,B=Z}}}else if(j+=S-N,N<V){for(V-=N;Z[p++]=C[j++],--N;);j=p-H,B=Z}for(;2<V;)Z[p++]=B[j++],Z[p++]=B[j++],Z[p++]=B[j++],V-=3;V&&(Z[p++]=B[j++],1<V&&(Z[p++]=B[j++]))}else{for(j=p-H;Z[p++]=Z[j++],Z[p++]=Z[j++],Z[p++]=Z[j++],2<(V-=3););V&&(Z[p++]=Z[j++],1<V&&(Z[p++]=Z[j++]))}break}}break}}while(h<m&&p<v);h-=V=I>>3,T&=(1<<(I-=V<<3))-1,o.next_in=h,o.next_out=p,o.avail_in=h<m?m-h+5:5-(h-m),o.avail_out=p<v?v-p+257:257-(p-v),d.hold=T,d.bits=I}},{}],49:[function(n,r,i){var o=n("../utils/common"),l=n("./adler32"),d=n("./crc32"),h=n("./inffast"),m=n("./inftrees"),p=1,g=2,v=0,b=-2,E=1,x=852,S=592;function C(j){return(j>>>24&255)+(j>>>8&65280)+((65280&j)<<8)+((255&j)<<24)}function T(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new o.Buf16(320),this.work=new o.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function I(j){var B;return j&&j.state?(B=j.state,j.total_in=j.total_out=B.total=0,j.msg="",B.wrap&&(j.adler=1&B.wrap),B.mode=E,B.last=0,B.havedict=0,B.dmax=32768,B.head=null,B.hold=0,B.bits=0,B.lencode=B.lendyn=new o.Buf32(x),B.distcode=B.distdyn=new o.Buf32(S),B.sane=1,B.back=-1,v):b}function O(j){var B;return j&&j.state?((B=j.state).wsize=0,B.whave=0,B.wnext=0,I(j)):b}function U(j,B){var M,Z;return j&&j.state?(Z=j.state,B<0?(M=0,B=-B):(M=1+(B>>4),B<48&&(B&=15)),B&&(B<8||15<B)?b:(Z.window!==null&&Z.wbits!==B&&(Z.window=null),Z.wrap=M,Z.wbits=B,O(j))):b}function $(j,B){var M,Z;return j?(Z=new T,(j.state=Z).window=null,(M=U(j,B))!==v&&(j.state=null),M):b}var k,R,N=!0;function V(j){if(N){var B;for(k=new o.Buf32(512),R=new o.Buf32(32),B=0;B<144;)j.lens[B++]=8;for(;B<256;)j.lens[B++]=9;for(;B<280;)j.lens[B++]=7;for(;B<288;)j.lens[B++]=8;for(m(p,j.lens,0,288,k,0,j.work,{bits:9}),B=0;B<32;)j.lens[B++]=5;m(g,j.lens,0,32,R,0,j.work,{bits:5}),N=!1}j.lencode=k,j.lenbits=9,j.distcode=R,j.distbits=5}function H(j,B,M,Z){var K,q=j.state;return q.window===null&&(q.wsize=1<<q.wbits,q.wnext=0,q.whave=0,q.window=new o.Buf8(q.wsize)),Z>=q.wsize?(o.arraySet(q.window,B,M-q.wsize,q.wsize,0),q.wnext=0,q.whave=q.wsize):(Z<(K=q.wsize-q.wnext)&&(K=Z),o.arraySet(q.window,B,M-Z,K,q.wnext),(Z-=K)?(o.arraySet(q.window,B,M-Z,Z,0),q.wnext=Z,q.whave=q.wsize):(q.wnext+=K,q.wnext===q.wsize&&(q.wnext=0),q.whave<q.wsize&&(q.whave+=K))),0}i.inflateReset=O,i.inflateReset2=U,i.inflateResetKeep=I,i.inflateInit=function(j){return $(j,15)},i.inflateInit2=$,i.inflate=function(j,B){var M,Z,K,q,W,X,re,z,G,te,se,ie,ce,we,he,Ee,Ue,Be,gt,yt,L,de,ye,ee,J=0,oe=new o.Buf8(4),Se=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!j||!j.state||!j.output||!j.input&&j.avail_in!==0)return b;(M=j.state).mode===12&&(M.mode=13),W=j.next_out,K=j.output,re=j.avail_out,q=j.next_in,Z=j.input,X=j.avail_in,z=M.hold,G=M.bits,te=X,se=re,de=v;e:for(;;)switch(M.mode){case E:if(M.wrap===0){M.mode=13;break}for(;G<16;){if(X===0)break e;X--,z+=Z[q++]<<G,G+=8}if(2&M.wrap&&z===35615){oe[M.check=0]=255&z,oe[1]=z>>>8&255,M.check=d(M.check,oe,2,0),G=z=0,M.mode=2;break}if(M.flags=0,M.head&&(M.head.done=!1),!(1&M.wrap)||(((255&z)<<8)+(z>>8))%31){j.msg="incorrect header check",M.mode=30;break}if((15&z)!=8){j.msg="unknown compression method",M.mode=30;break}if(G-=4,L=8+(15&(z>>>=4)),M.wbits===0)M.wbits=L;else if(L>M.wbits){j.msg="invalid window size",M.mode=30;break}M.dmax=1<<L,j.adler=M.check=1,M.mode=512&z?10:12,G=z=0;break;case 2:for(;G<16;){if(X===0)break e;X--,z+=Z[q++]<<G,G+=8}if(M.flags=z,(255&M.flags)!=8){j.msg="unknown compression method",M.mode=30;break}if(57344&M.flags){j.msg="unknown header flags set",M.mode=30;break}M.head&&(M.head.text=z>>8&1),512&M.flags&&(oe[0]=255&z,oe[1]=z>>>8&255,M.check=d(M.check,oe,2,0)),G=z=0,M.mode=3;case 3:for(;G<32;){if(X===0)break e;X--,z+=Z[q++]<<G,G+=8}M.head&&(M.head.time=z),512&M.flags&&(oe[0]=255&z,oe[1]=z>>>8&255,oe[2]=z>>>16&255,oe[3]=z>>>24&255,M.check=d(M.check,oe,4,0)),G=z=0,M.mode=4;case 4:for(;G<16;){if(X===0)break e;X--,z+=Z[q++]<<G,G+=8}M.head&&(M.head.xflags=255&z,M.head.os=z>>8),512&M.flags&&(oe[0]=255&z,oe[1]=z>>>8&255,M.check=d(M.check,oe,2,0)),G=z=0,M.mode=5;case 5:if(1024&M.flags){for(;G<16;){if(X===0)break e;X--,z+=Z[q++]<<G,G+=8}M.length=z,M.head&&(M.head.extra_len=z),512&M.flags&&(oe[0]=255&z,oe[1]=z>>>8&255,M.check=d(M.check,oe,2,0)),G=z=0}else M.head&&(M.head.extra=null);M.mode=6;case 6:if(1024&M.flags&&(X<(ie=M.length)&&(ie=X),ie&&(M.head&&(L=M.head.extra_len-M.length,M.head.extra||(M.head.extra=new Array(M.head.extra_len)),o.arraySet(M.head.extra,Z,q,ie,L)),512&M.flags&&(M.check=d(M.check,Z,ie,q)),X-=ie,q+=ie,M.length-=ie),M.length))break e;M.length=0,M.mode=7;case 7:if(2048&M.flags){if(X===0)break e;for(ie=0;L=Z[q+ie++],M.head&&L&&M.length<65536&&(M.head.name+=String.fromCharCode(L)),L&&ie<X;);if(512&M.flags&&(M.check=d(M.check,Z,ie,q)),X-=ie,q+=ie,L)break e}else M.head&&(M.head.name=null);M.length=0,M.mode=8;case 8:if(4096&M.flags){if(X===0)break e;for(ie=0;L=Z[q+ie++],M.head&&L&&M.length<65536&&(M.head.comment+=String.fromCharCode(L)),L&&ie<X;);if(512&M.flags&&(M.check=d(M.check,Z,ie,q)),X-=ie,q+=ie,L)break e}else M.head&&(M.head.comment=null);M.mode=9;case 9:if(512&M.flags){for(;G<16;){if(X===0)break e;X--,z+=Z[q++]<<G,G+=8}if(z!==(65535&M.check)){j.msg="header crc mismatch",M.mode=30;break}G=z=0}M.head&&(M.head.hcrc=M.flags>>9&1,M.head.done=!0),j.adler=M.check=0,M.mode=12;break;case 10:for(;G<32;){if(X===0)break e;X--,z+=Z[q++]<<G,G+=8}j.adler=M.check=C(z),G=z=0,M.mode=11;case 11:if(M.havedict===0)return j.next_out=W,j.avail_out=re,j.next_in=q,j.avail_in=X,M.hold=z,M.bits=G,2;j.adler=M.check=1,M.mode=12;case 12:if(B===5||B===6)break e;case 13:if(M.last){z>>>=7&G,G-=7&G,M.mode=27;break}for(;G<3;){if(X===0)break e;X--,z+=Z[q++]<<G,G+=8}switch(M.last=1&z,G-=1,3&(z>>>=1)){case 0:M.mode=14;break;case 1:if(V(M),M.mode=20,B!==6)break;z>>>=2,G-=2;break e;case 2:M.mode=17;break;case 3:j.msg="invalid block type",M.mode=30}z>>>=2,G-=2;break;case 14:for(z>>>=7&G,G-=7&G;G<32;){if(X===0)break e;X--,z+=Z[q++]<<G,G+=8}if((65535&z)!=(z>>>16^65535)){j.msg="invalid stored block lengths",M.mode=30;break}if(M.length=65535&z,G=z=0,M.mode=15,B===6)break e;case 15:M.mode=16;case 16:if(ie=M.length){if(X<ie&&(ie=X),re<ie&&(ie=re),ie===0)break e;o.arraySet(K,Z,q,ie,W),X-=ie,q+=ie,re-=ie,W+=ie,M.length-=ie;break}M.mode=12;break;case 17:for(;G<14;){if(X===0)break e;X--,z+=Z[q++]<<G,G+=8}if(M.nlen=257+(31&z),z>>>=5,G-=5,M.ndist=1+(31&z),z>>>=5,G-=5,M.ncode=4+(15&z),z>>>=4,G-=4,286<M.nlen||30<M.ndist){j.msg="too many length or distance symbols",M.mode=30;break}M.have=0,M.mode=18;case 18:for(;M.have<M.ncode;){for(;G<3;){if(X===0)break e;X--,z+=Z[q++]<<G,G+=8}M.lens[Se[M.have++]]=7&z,z>>>=3,G-=3}for(;M.have<19;)M.lens[Se[M.have++]]=0;if(M.lencode=M.lendyn,M.lenbits=7,ye={bits:M.lenbits},de=m(0,M.lens,0,19,M.lencode,0,M.work,ye),M.lenbits=ye.bits,de){j.msg="invalid code lengths set",M.mode=30;break}M.have=0,M.mode=19;case 19:for(;M.have<M.nlen+M.ndist;){for(;Ee=(J=M.lencode[z&(1<<M.lenbits)-1])>>>16&255,Ue=65535&J,!((he=J>>>24)<=G);){if(X===0)break e;X--,z+=Z[q++]<<G,G+=8}if(Ue<16)z>>>=he,G-=he,M.lens[M.have++]=Ue;else{if(Ue===16){for(ee=he+2;G<ee;){if(X===0)break e;X--,z+=Z[q++]<<G,G+=8}if(z>>>=he,G-=he,M.have===0){j.msg="invalid bit length repeat",M.mode=30;break}L=M.lens[M.have-1],ie=3+(3&z),z>>>=2,G-=2}else if(Ue===17){for(ee=he+3;G<ee;){if(X===0)break e;X--,z+=Z[q++]<<G,G+=8}G-=he,L=0,ie=3+(7&(z>>>=he)),z>>>=3,G-=3}else{for(ee=he+7;G<ee;){if(X===0)break e;X--,z+=Z[q++]<<G,G+=8}G-=he,L=0,ie=11+(127&(z>>>=he)),z>>>=7,G-=7}if(M.have+ie>M.nlen+M.ndist){j.msg="invalid bit length repeat",M.mode=30;break}for(;ie--;)M.lens[M.have++]=L}}if(M.mode===30)break;if(M.lens[256]===0){j.msg="invalid code -- missing end-of-block",M.mode=30;break}if(M.lenbits=9,ye={bits:M.lenbits},de=m(p,M.lens,0,M.nlen,M.lencode,0,M.work,ye),M.lenbits=ye.bits,de){j.msg="invalid literal/lengths set",M.mode=30;break}if(M.distbits=6,M.distcode=M.distdyn,ye={bits:M.distbits},de=m(g,M.lens,M.nlen,M.ndist,M.distcode,0,M.work,ye),M.distbits=ye.bits,de){j.msg="invalid distances set",M.mode=30;break}if(M.mode=20,B===6)break e;case 20:M.mode=21;case 21:if(6<=X&&258<=re){j.next_out=W,j.avail_out=re,j.next_in=q,j.avail_in=X,M.hold=z,M.bits=G,h(j,se),W=j.next_out,K=j.output,re=j.avail_out,q=j.next_in,Z=j.input,X=j.avail_in,z=M.hold,G=M.bits,M.mode===12&&(M.back=-1);break}for(M.back=0;Ee=(J=M.lencode[z&(1<<M.lenbits)-1])>>>16&255,Ue=65535&J,!((he=J>>>24)<=G);){if(X===0)break e;X--,z+=Z[q++]<<G,G+=8}if(Ee&&(240&Ee)==0){for(Be=he,gt=Ee,yt=Ue;Ee=(J=M.lencode[yt+((z&(1<<Be+gt)-1)>>Be)])>>>16&255,Ue=65535&J,!(Be+(he=J>>>24)<=G);){if(X===0)break e;X--,z+=Z[q++]<<G,G+=8}z>>>=Be,G-=Be,M.back+=Be}if(z>>>=he,G-=he,M.back+=he,M.length=Ue,Ee===0){M.mode=26;break}if(32&Ee){M.back=-1,M.mode=12;break}if(64&Ee){j.msg="invalid literal/length code",M.mode=30;break}M.extra=15&Ee,M.mode=22;case 22:if(M.extra){for(ee=M.extra;G<ee;){if(X===0)break e;X--,z+=Z[q++]<<G,G+=8}M.length+=z&(1<<M.extra)-1,z>>>=M.extra,G-=M.extra,M.back+=M.extra}M.was=M.length,M.mode=23;case 23:for(;Ee=(J=M.distcode[z&(1<<M.distbits)-1])>>>16&255,Ue=65535&J,!((he=J>>>24)<=G);){if(X===0)break e;X--,z+=Z[q++]<<G,G+=8}if((240&Ee)==0){for(Be=he,gt=Ee,yt=Ue;Ee=(J=M.distcode[yt+((z&(1<<Be+gt)-1)>>Be)])>>>16&255,Ue=65535&J,!(Be+(he=J>>>24)<=G);){if(X===0)break e;X--,z+=Z[q++]<<G,G+=8}z>>>=Be,G-=Be,M.back+=Be}if(z>>>=he,G-=he,M.back+=he,64&Ee){j.msg="invalid distance code",M.mode=30;break}M.offset=Ue,M.extra=15&Ee,M.mode=24;case 24:if(M.extra){for(ee=M.extra;G<ee;){if(X===0)break e;X--,z+=Z[q++]<<G,G+=8}M.offset+=z&(1<<M.extra)-1,z>>>=M.extra,G-=M.extra,M.back+=M.extra}if(M.offset>M.dmax){j.msg="invalid distance too far back",M.mode=30;break}M.mode=25;case 25:if(re===0)break e;if(ie=se-re,M.offset>ie){if((ie=M.offset-ie)>M.whave&&M.sane){j.msg="invalid distance too far back",M.mode=30;break}ce=ie>M.wnext?(ie-=M.wnext,M.wsize-ie):M.wnext-ie,ie>M.length&&(ie=M.length),we=M.window}else we=K,ce=W-M.offset,ie=M.length;for(re<ie&&(ie=re),re-=ie,M.length-=ie;K[W++]=we[ce++],--ie;);M.length===0&&(M.mode=21);break;case 26:if(re===0)break e;K[W++]=M.length,re--,M.mode=21;break;case 27:if(M.wrap){for(;G<32;){if(X===0)break e;X--,z|=Z[q++]<<G,G+=8}if(se-=re,j.total_out+=se,M.total+=se,se&&(j.adler=M.check=M.flags?d(M.check,K,se,W-se):l(M.check,K,se,W-se)),se=re,(M.flags?z:C(z))!==M.check){j.msg="incorrect data check",M.mode=30;break}G=z=0}M.mode=28;case 28:if(M.wrap&&M.flags){for(;G<32;){if(X===0)break e;X--,z+=Z[q++]<<G,G+=8}if(z!==(4294967295&M.total)){j.msg="incorrect length check",M.mode=30;break}G=z=0}M.mode=29;case 29:de=1;break e;case 30:de=-3;break e;case 31:return-4;default:return b}return j.next_out=W,j.avail_out=re,j.next_in=q,j.avail_in=X,M.hold=z,M.bits=G,(M.wsize||se!==j.avail_out&&M.mode<30&&(M.mode<27||B!==4))&&H(j,j.output,j.next_out,se-j.avail_out)?(M.mode=31,-4):(te-=j.avail_in,se-=j.avail_out,j.total_in+=te,j.total_out+=se,M.total+=se,M.wrap&&se&&(j.adler=M.check=M.flags?d(M.check,K,se,j.next_out-se):l(M.check,K,se,j.next_out-se)),j.data_type=M.bits+(M.last?64:0)+(M.mode===12?128:0)+(M.mode===20||M.mode===15?256:0),(te==0&&se===0||B===4)&&de===v&&(de=-5),de)},i.inflateEnd=function(j){if(!j||!j.state)return b;var B=j.state;return B.window&&(B.window=null),j.state=null,v},i.inflateGetHeader=function(j,B){var M;return j&&j.state?(2&(M=j.state).wrap)==0?b:((M.head=B).done=!1,v):b},i.inflateSetDictionary=function(j,B){var M,Z=B.length;return j&&j.state?(M=j.state).wrap!==0&&M.mode!==11?b:M.mode===11&&l(1,B,Z,0)!==M.check?-3:H(j,B,Z,Z)?(M.mode=31,-4):(M.havedict=1,v):b},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(n,r,i){var o=n("../utils/common"),l=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],d=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],h=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],m=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];r.exports=function(p,g,v,b,E,x,S,C){var T,I,O,U,$,k,R,N,V,H=C.bits,j=0,B=0,M=0,Z=0,K=0,q=0,W=0,X=0,re=0,z=0,G=null,te=0,se=new o.Buf16(16),ie=new o.Buf16(16),ce=null,we=0;for(j=0;j<=15;j++)se[j]=0;for(B=0;B<b;B++)se[g[v+B]]++;for(K=H,Z=15;1<=Z&&se[Z]===0;Z--);if(Z<K&&(K=Z),Z===0)return E[x++]=20971520,E[x++]=20971520,C.bits=1,0;for(M=1;M<Z&&se[M]===0;M++);for(K<M&&(K=M),j=X=1;j<=15;j++)if(X<<=1,(X-=se[j])<0)return-1;if(0<X&&(p===0||Z!==1))return-1;for(ie[1]=0,j=1;j<15;j++)ie[j+1]=ie[j]+se[j];for(B=0;B<b;B++)g[v+B]!==0&&(S[ie[g[v+B]]++]=B);if(k=p===0?(G=ce=S,19):p===1?(G=l,te-=257,ce=d,we-=257,256):(G=h,ce=m,-1),j=M,$=x,W=B=z=0,O=-1,U=(re=1<<(q=K))-1,p===1&&852<re||p===2&&592<re)return 1;for(;;){for(R=j-W,V=S[B]<k?(N=0,S[B]):S[B]>k?(N=ce[we+S[B]],G[te+S[B]]):(N=96,0),T=1<<j-W,M=I=1<<q;E[$+(z>>W)+(I-=T)]=R<<24|N<<16|V|0,I!==0;);for(T=1<<j-1;z&T;)T>>=1;if(T!==0?(z&=T-1,z+=T):z=0,B++,--se[j]==0){if(j===Z)break;j=g[v+S[B]]}if(K<j&&(z&U)!==O){for(W===0&&(W=K),$+=M,X=1<<(q=j-W);q+W<Z&&!((X-=se[q+W])<=0);)q++,X<<=1;if(re+=1<<q,p===1&&852<re||p===2&&592<re)return 1;E[O=z&U]=K<<24|q<<16|$-x|0}}return z!==0&&(E[$+z]=j-W<<24|64<<16|0),C.bits=K,0}},{"../utils/common":41}],51:[function(n,r,i){r.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(n,r,i){var o=n("../utils/common"),l=0,d=1;function h(J){for(var oe=J.length;0<=--oe;)J[oe]=0}var m=0,p=29,g=256,v=g+1+p,b=30,E=19,x=2*v+1,S=15,C=16,T=7,I=256,O=16,U=17,$=18,k=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],R=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],N=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],V=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],H=new Array(2*(v+2));h(H);var j=new Array(2*b);h(j);var B=new Array(512);h(B);var M=new Array(256);h(M);var Z=new Array(p);h(Z);var K,q,W,X=new Array(b);function re(J,oe,Se,xe,ae){this.static_tree=J,this.extra_bits=oe,this.extra_base=Se,this.elems=xe,this.max_length=ae,this.has_stree=J&&J.length}function z(J,oe){this.dyn_tree=J,this.max_code=0,this.stat_desc=oe}function G(J){return J<256?B[J]:B[256+(J>>>7)]}function te(J,oe){J.pending_buf[J.pending++]=255&oe,J.pending_buf[J.pending++]=oe>>>8&255}function se(J,oe,Se){J.bi_valid>C-Se?(J.bi_buf|=oe<<J.bi_valid&65535,te(J,J.bi_buf),J.bi_buf=oe>>C-J.bi_valid,J.bi_valid+=Se-C):(J.bi_buf|=oe<<J.bi_valid&65535,J.bi_valid+=Se)}function ie(J,oe,Se){se(J,Se[2*oe],Se[2*oe+1])}function ce(J,oe){for(var Se=0;Se|=1&J,J>>>=1,Se<<=1,0<--oe;);return Se>>>1}function we(J,oe,Se){var xe,ae,Ae=new Array(S+1),Oe=0;for(xe=1;xe<=S;xe++)Ae[xe]=Oe=Oe+Se[xe-1]<<1;for(ae=0;ae<=oe;ae++){var De=J[2*ae+1];De!==0&&(J[2*ae]=ce(Ae[De]++,De))}}function he(J){var oe;for(oe=0;oe<v;oe++)J.dyn_ltree[2*oe]=0;for(oe=0;oe<b;oe++)J.dyn_dtree[2*oe]=0;for(oe=0;oe<E;oe++)J.bl_tree[2*oe]=0;J.dyn_ltree[2*I]=1,J.opt_len=J.static_len=0,J.last_lit=J.matches=0}function Ee(J){8<J.bi_valid?te(J,J.bi_buf):0<J.bi_valid&&(J.pending_buf[J.pending++]=J.bi_buf),J.bi_buf=0,J.bi_valid=0}function Ue(J,oe,Se,xe){var ae=2*oe,Ae=2*Se;return J[ae]<J[Ae]||J[ae]===J[Ae]&&xe[oe]<=xe[Se]}function Be(J,oe,Se){for(var xe=J.heap[Se],ae=Se<<1;ae<=J.heap_len&&(ae<J.heap_len&&Ue(oe,J.heap[ae+1],J.heap[ae],J.depth)&&ae++,!Ue(oe,xe,J.heap[ae],J.depth));)J.heap[Se]=J.heap[ae],Se=ae,ae<<=1;J.heap[Se]=xe}function gt(J,oe,Se){var xe,ae,Ae,Oe,De=0;if(J.last_lit!==0)for(;xe=J.pending_buf[J.d_buf+2*De]<<8|J.pending_buf[J.d_buf+2*De+1],ae=J.pending_buf[J.l_buf+De],De++,xe===0?ie(J,ae,oe):(ie(J,(Ae=M[ae])+g+1,oe),(Oe=k[Ae])!==0&&se(J,ae-=Z[Ae],Oe),ie(J,Ae=G(--xe),Se),(Oe=R[Ae])!==0&&se(J,xe-=X[Ae],Oe)),De<J.last_lit;);ie(J,I,oe)}function yt(J,oe){var Se,xe,ae,Ae=oe.dyn_tree,Oe=oe.stat_desc.static_tree,De=oe.stat_desc.has_stree,qe=oe.stat_desc.elems,xt=-1;for(J.heap_len=0,J.heap_max=x,Se=0;Se<qe;Se++)Ae[2*Se]!==0?(J.heap[++J.heap_len]=xt=Se,J.depth[Se]=0):Ae[2*Se+1]=0;for(;J.heap_len<2;)Ae[2*(ae=J.heap[++J.heap_len]=xt<2?++xt:0)]=1,J.depth[ae]=0,J.opt_len--,De&&(J.static_len-=Oe[2*ae+1]);for(oe.max_code=xt,Se=J.heap_len>>1;1<=Se;Se--)Be(J,Ae,Se);for(ae=qe;Se=J.heap[1],J.heap[1]=J.heap[J.heap_len--],Be(J,Ae,1),xe=J.heap[1],J.heap[--J.heap_max]=Se,J.heap[--J.heap_max]=xe,Ae[2*ae]=Ae[2*Se]+Ae[2*xe],J.depth[ae]=(J.depth[Se]>=J.depth[xe]?J.depth[Se]:J.depth[xe])+1,Ae[2*Se+1]=Ae[2*xe+1]=ae,J.heap[1]=ae++,Be(J,Ae,1),2<=J.heap_len;);J.heap[--J.heap_max]=J.heap[1],(function(nt,Qn){var fs,er,ms,bt,Jt,Wn,Et=Qn.dyn_tree,La=Qn.max_code,Ti=Qn.stat_desc.static_tree,Lo=Qn.stat_desc.has_stree,Rr=Qn.stat_desc.extra_bits,ps=Qn.stat_desc.extra_base,Lt=Qn.stat_desc.max_length,tr=0;for(bt=0;bt<=S;bt++)nt.bl_count[bt]=0;for(Et[2*nt.heap[nt.heap_max]+1]=0,fs=nt.heap_max+1;fs<x;fs++)Lt<(bt=Et[2*Et[2*(er=nt.heap[fs])+1]+1]+1)&&(bt=Lt,tr++),Et[2*er+1]=bt,La<er||(nt.bl_count[bt]++,Jt=0,ps<=er&&(Jt=Rr[er-ps]),Wn=Et[2*er],nt.opt_len+=Wn*(bt+Jt),Lo&&(nt.static_len+=Wn*(Ti[2*er+1]+Jt)));if(tr!==0){do{for(bt=Lt-1;nt.bl_count[bt]===0;)bt--;nt.bl_count[bt]--,nt.bl_count[bt+1]+=2,nt.bl_count[Lt]--,tr-=2}while(0<tr);for(bt=Lt;bt!==0;bt--)for(er=nt.bl_count[bt];er!==0;)La<(ms=nt.heap[--fs])||(Et[2*ms+1]!==bt&&(nt.opt_len+=(bt-Et[2*ms+1])*Et[2*ms],Et[2*ms+1]=bt),er--)}})(J,oe),we(Ae,xt,J.bl_count)}function L(J,oe,Se){var xe,ae,Ae=-1,Oe=oe[1],De=0,qe=7,xt=4;for(Oe===0&&(qe=138,xt=3),oe[2*(Se+1)+1]=65535,xe=0;xe<=Se;xe++)ae=Oe,Oe=oe[2*(xe+1)+1],++De<qe&&ae===Oe||(De<xt?J.bl_tree[2*ae]+=De:ae!==0?(ae!==Ae&&J.bl_tree[2*ae]++,J.bl_tree[2*O]++):De<=10?J.bl_tree[2*U]++:J.bl_tree[2*$]++,Ae=ae,xt=(De=0)===Oe?(qe=138,3):ae===Oe?(qe=6,3):(qe=7,4))}function de(J,oe,Se){var xe,ae,Ae=-1,Oe=oe[1],De=0,qe=7,xt=4;for(Oe===0&&(qe=138,xt=3),xe=0;xe<=Se;xe++)if(ae=Oe,Oe=oe[2*(xe+1)+1],!(++De<qe&&ae===Oe)){if(De<xt)for(;ie(J,ae,J.bl_tree),--De!=0;);else ae!==0?(ae!==Ae&&(ie(J,ae,J.bl_tree),De--),ie(J,O,J.bl_tree),se(J,De-3,2)):De<=10?(ie(J,U,J.bl_tree),se(J,De-3,3)):(ie(J,$,J.bl_tree),se(J,De-11,7));Ae=ae,xt=(De=0)===Oe?(qe=138,3):ae===Oe?(qe=6,3):(qe=7,4)}}h(X);var ye=!1;function ee(J,oe,Se,xe){se(J,(m<<1)+(xe?1:0),3),(function(ae,Ae,Oe,De){Ee(ae),te(ae,Oe),te(ae,~Oe),o.arraySet(ae.pending_buf,ae.window,Ae,Oe,ae.pending),ae.pending+=Oe})(J,oe,Se)}i._tr_init=function(J){ye||((function(){var oe,Se,xe,ae,Ae,Oe=new Array(S+1);for(ae=xe=0;ae<p-1;ae++)for(Z[ae]=xe,oe=0;oe<1<<k[ae];oe++)M[xe++]=ae;for(M[xe-1]=ae,ae=Ae=0;ae<16;ae++)for(X[ae]=Ae,oe=0;oe<1<<R[ae];oe++)B[Ae++]=ae;for(Ae>>=7;ae<b;ae++)for(X[ae]=Ae<<7,oe=0;oe<1<<R[ae]-7;oe++)B[256+Ae++]=ae;for(Se=0;Se<=S;Se++)Oe[Se]=0;for(oe=0;oe<=143;)H[2*oe+1]=8,oe++,Oe[8]++;for(;oe<=255;)H[2*oe+1]=9,oe++,Oe[9]++;for(;oe<=279;)H[2*oe+1]=7,oe++,Oe[7]++;for(;oe<=287;)H[2*oe+1]=8,oe++,Oe[8]++;for(we(H,v+1,Oe),oe=0;oe<b;oe++)j[2*oe+1]=5,j[2*oe]=ce(oe,5);K=new re(H,k,g+1,v,S),q=new re(j,R,0,b,S),W=new re(new Array(0),N,0,E,T)})(),ye=!0),J.l_desc=new z(J.dyn_ltree,K),J.d_desc=new z(J.dyn_dtree,q),J.bl_desc=new z(J.bl_tree,W),J.bi_buf=0,J.bi_valid=0,he(J)},i._tr_stored_block=ee,i._tr_flush_block=function(J,oe,Se,xe){var ae,Ae,Oe=0;0<J.level?(J.strm.data_type===2&&(J.strm.data_type=(function(De){var qe,xt=4093624447;for(qe=0;qe<=31;qe++,xt>>>=1)if(1&xt&&De.dyn_ltree[2*qe]!==0)return l;if(De.dyn_ltree[18]!==0||De.dyn_ltree[20]!==0||De.dyn_ltree[26]!==0)return d;for(qe=32;qe<g;qe++)if(De.dyn_ltree[2*qe]!==0)return d;return l})(J)),yt(J,J.l_desc),yt(J,J.d_desc),Oe=(function(De){var qe;for(L(De,De.dyn_ltree,De.l_desc.max_code),L(De,De.dyn_dtree,De.d_desc.max_code),yt(De,De.bl_desc),qe=E-1;3<=qe&&De.bl_tree[2*V[qe]+1]===0;qe--);return De.opt_len+=3*(qe+1)+5+5+4,qe})(J),ae=J.opt_len+3+7>>>3,(Ae=J.static_len+3+7>>>3)<=ae&&(ae=Ae)):ae=Ae=Se+5,Se+4<=ae&&oe!==-1?ee(J,oe,Se,xe):J.strategy===4||Ae===ae?(se(J,2+(xe?1:0),3),gt(J,H,j)):(se(J,4+(xe?1:0),3),(function(De,qe,xt,nt){var Qn;for(se(De,qe-257,5),se(De,xt-1,5),se(De,nt-4,4),Qn=0;Qn<nt;Qn++)se(De,De.bl_tree[2*V[Qn]+1],3);de(De,De.dyn_ltree,qe-1),de(De,De.dyn_dtree,xt-1)})(J,J.l_desc.max_code+1,J.d_desc.max_code+1,Oe+1),gt(J,J.dyn_ltree,J.dyn_dtree)),he(J),xe&&Ee(J)},i._tr_tally=function(J,oe,Se){return J.pending_buf[J.d_buf+2*J.last_lit]=oe>>>8&255,J.pending_buf[J.d_buf+2*J.last_lit+1]=255&oe,J.pending_buf[J.l_buf+J.last_lit]=255&Se,J.last_lit++,oe===0?J.dyn_ltree[2*Se]++:(J.matches++,oe--,J.dyn_ltree[2*(M[Se]+g+1)]++,J.dyn_dtree[2*G(oe)]++),J.last_lit===J.lit_bufsize-1},i._tr_align=function(J){se(J,2,3),ie(J,I,H),(function(oe){oe.bi_valid===16?(te(oe,oe.bi_buf),oe.bi_buf=0,oe.bi_valid=0):8<=oe.bi_valid&&(oe.pending_buf[oe.pending++]=255&oe.bi_buf,oe.bi_buf>>=8,oe.bi_valid-=8)})(J)}},{"../utils/common":41}],53:[function(n,r,i){r.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(n,r,i){(function(o){(function(l,d){if(!l.setImmediate){var h,m,p,g,v=1,b={},E=!1,x=l.document,S=Object.getPrototypeOf&&Object.getPrototypeOf(l);S=S&&S.setTimeout?S:l,h={}.toString.call(l.process)==="[object process]"?function(O){process.nextTick(function(){T(O)})}:(function(){if(l.postMessage&&!l.importScripts){var O=!0,U=l.onmessage;return l.onmessage=function(){O=!1},l.postMessage("","*"),l.onmessage=U,O}})()?(g="setImmediate$"+Math.random()+"$",l.addEventListener?l.addEventListener("message",I,!1):l.attachEvent("onmessage",I),function(O){l.postMessage(g+O,"*")}):l.MessageChannel?((p=new MessageChannel).port1.onmessage=function(O){T(O.data)},function(O){p.port2.postMessage(O)}):x&&"onreadystatechange"in x.createElement("script")?(m=x.documentElement,function(O){var U=x.createElement("script");U.onreadystatechange=function(){T(O),U.onreadystatechange=null,m.removeChild(U),U=null},m.appendChild(U)}):function(O){setTimeout(T,0,O)},S.setImmediate=function(O){typeof O!="function"&&(O=new Function(""+O));for(var U=new Array(arguments.length-1),$=0;$<U.length;$++)U[$]=arguments[$+1];var k={callback:O,args:U};return b[v]=k,h(v),v++},S.clearImmediate=C}function C(O){delete b[O]}function T(O){if(E)setTimeout(T,0,O);else{var U=b[O];if(U){E=!0;try{(function($){var k=$.callback,R=$.args;switch(R.length){case 0:k();break;case 1:k(R[0]);break;case 2:k(R[0],R[1]);break;case 3:k(R[0],R[1],R[2]);break;default:k.apply(d,R)}})(U)}finally{C(O),E=!1}}}}function I(O){O.source===l&&typeof O.data=="string"&&O.data.indexOf(g)===0&&T(+O.data.slice(g.length))}})(typeof self>"u"?o===void 0?this:o:self)}).call(this,typeof Mh<"u"?Mh:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(qg)),qg.exports}var rP=nP();const xm=P2(rP);function sP({currentUser:t,budgetId:e}){const[n,r]=D.useState(!1),[i,o]=D.useState(null),[l,d]=D.useState(null);async function h(){if(!t){d("Must be logged in to download budget");return}if(!e){d("No budget selected");return}r(!0),d(null),o({phase:"reading",current:0,total:1,percentComplete:0});try{o({phase:"reading",current:0,total:1,percentComplete:10});const{exists:m,data:p}=await At("budgets",e,`downloading budget ${e}`);if(!m||!p){d(`Budget ${e} not found`);return}const g=await LT(e,"download-budget");let v=null;try{const{exists:j,data:B}=await At("payees",e,`downloading payees for budget ${e}`);j&&B&&(v=B)}catch(j){console.warn(`Could not read payees for budget ${e}:`,j)}o({phase:"processing",current:0,total:g.length+1,percentComplete:20});const b=new xm,E=new Date,x=E.toISOString().split("T")[0],S=`budget_${e}`,{accounts:C,account_groups:T,categories:I,category_groups:O,...U}=p;b.file(`${S}/budget.json`,JSON.stringify(U,null,2)),b.file(`${S}/accounts.json`,JSON.stringify(C||{},null,2)),b.file(`${S}/account_groups.json`,JSON.stringify(T||{},null,2)),b.file(`${S}/categories.json`,JSON.stringify(I||{},null,2)),b.file(`${S}/category_groups.json`,JSON.stringify(O||[],null,2)),v&&b.file(`${S}/payees.json`,JSON.stringify(v,null,2));let $=0;for(const j of g){const B=j.data,M=`${S}/months/month_${B.year}_${String(B.month).padStart(2,"0")}`,Z={};if(B.are_allocations_finalized&&B.category_balances)for(const K of B.category_balances)K.allocated!==void 0&&(Z[K.category_id]=K.allocated);b.file(`${M}/metadata.json`,JSON.stringify({budget_id:B.budget_id,year_month_ordinal:B.year_month_ordinal,year:B.year,month:B.month,total_income:B.total_income,previous_month_income:B.previous_month_income,total_expenses:B.total_expenses,are_allocations_finalized:B.are_allocations_finalized,created_at:B.created_at,updated_at:B.updated_at,...B.are_allocations_finalized&&{allocations:Z},downloaded_at:E.toISOString()},null,2)),b.file(`${M}/income.json`,JSON.stringify(B.income||[],null,2)),b.file(`${M}/expenses.json`,JSON.stringify(B.expenses||[],null,2)),b.file(`${M}/transfers.json`,JSON.stringify(B.transfers||[],null,2)),b.file(`${M}/adjustments.json`,JSON.stringify(B.adjustments||[],null,2)),b.file(`${M}/account_balances.json`,JSON.stringify(B.account_balances||[],null,2)),b.file(`${M}/category_balances.json`,JSON.stringify(B.category_balances||[],null,2)),$++,o({phase:"processing",current:$,total:g.length,percentComplete:20+Math.round($/g.length*60)})}o({phase:"zipping",current:0,total:1,percentComplete:80});const k=await b.generateAsync({type:"blob"});o({phase:"complete",current:1,total:1,percentComplete:100});const N=(p.name||"budget").replace(/[^a-z0-9]/gi,"_").toLowerCase(),V=URL.createObjectURL(k),H=document.createElement("a");H.href=V,H.download=`${x}_${N}_${e}.zip`,document.body.appendChild(H),H.click(),document.body.removeChild(H),URL.revokeObjectURL(V)}catch(m){d(m instanceof Error?m.message:"Unknown error during download")}finally{r(!1),o(null)}}return{isDownloading:n,progress:i,error:l,downloadBudget:h}}async function iP(t){const n=await new xm().loadAsync(t),r=new Set,i=new Set;for(const[o]of Object.entries(n.files)){const l=o.match(/^budget_([^/]+)\//);if(l){const d=l[1];r.add(d),o.match(/^budget_([^/]+)\/months\/month_\d{4}_\d{2}\//)&&i.add(o.split("/months/")[1].split("/")[0])}}return{budgetsFound:r.size,monthsFound:i.size,payeesFound:r.size,budgetsToRestore:Array.from(r)}}async function aP(t,e,n){const i=`${`${e}/months/`}${n}/`,o=`${i}metadata.json`,l=t.files[o];if(!l)return null;const d=await l.async("string"),h=JSON.parse(d),{downloaded_at:m,allocations:p,...g}=h,v=async S=>{const C=`${i}${S}`,T=t.files[C];if(T){const I=await T.async("string");return JSON.parse(I)}return[]},b={budget_id:g.budget_id,year:g.year,month:g.month,year_month_ordinal:g.year_month_ordinal,total_income:0,previous_month_income:0,total_expenses:0,are_allocations_finalized:g.are_allocations_finalized??!1,created_at:g.created_at||new Date().toISOString(),updated_at:new Date().toISOString(),income:await v("income.json"),expenses:await v("expenses.json"),transfers:await v("transfers.json"),adjustments:await v("adjustments.json"),account_balances:[],category_balances:[]},E=Aa(b);let x=_m(E);if(h.are_allocations_finalized&&p!==void 0){const S=new Map;for(const I of x.category_balances)S.set(I.category_id,I);const C=[],T=new Set;for(const I of x.category_balances){const O=p[I.category_id];if(O!==void 0){const U=Me(O);C.push({...I,allocated:U,end_balance:Me(I.start_balance+U+I.spent+I.transfers+I.adjustments)})}else C.push(I);T.add(I.category_id)}for(const[I,O]of Object.entries(p))if(!T.has(I)){const U=Me(O);C.push({category_id:I,start_balance:0,allocated:U,spent:0,transfers:0,adjustments:0,end_balance:U})}x={...x,category_balances:C}}return{budgetId:g.budget_id,year:g.year,month:g.month,data:x}}async function oP(t,e){const n=`budget_${e}`,r=async $=>{const k=t.files[$];if(k){const R=await k.async("string");return JSON.parse(R)}return null},i=`${n}/budget.json`,o=`${n}/accounts.json`,l=`${n}/account_groups.json`,d=`${n}/categories.json`,h=`${n}/category_groups.json`,m=await r(i);if(!m)throw new Error("Missing required file budget.json");const p=await r(o)||{},g=await r(l)||{},v=await r(d)||{},b=await r(h)||[],E=Aa({...m,accounts:p,account_groups:g,categories:v,category_groups:b}),x={budgetId:e,data:E},S=`${n}/payees.json`,C=await r(S);let T=null;if(C){const $={...C,budget_id:e,updated_at:new Date().toISOString()};T={collectionPath:"payees",docId:e,data:Aa($)}}const I=`${n}/months/`,O=new Set;for(const $ of Object.keys(t.files))if($.startsWith(I)&&$.includes("/metadata.json")){const k=$.split("/months/")[1].split("/")[0];O.add(k)}const U=[];for(const $ of O){const k=await aP(t,n,$);k&&U.push(k)}return{budgetUpdate:x,monthUpdates:U,payeeWrite:T}}function lP({currentUser:t}){const[e,n]=D.useState(!1),[r,i]=D.useState(!1),[o,l]=D.useState(null),[d,h]=D.useState(null),[m,p]=D.useState(null),[g,v]=D.useState(null);async function b(x){if(!t){p("Must be logged in to upload budget");return}n(!0),p(null),l(null),v(null);try{const S=await iP(x);l(S)}catch(S){p(S instanceof Error?S.message:"Failed to parse zip file")}finally{n(!1)}}async function E(x){if(!t){p("Must be logged in to upload budget");return}if(!o){p("Must scan file first");return}i(!0),p(null),h({phase:"parsing",current:0,total:1,percentComplete:0});const S=[];let C=0,T=0,I=0;try{h({phase:"parsing",current:0,total:1,percentComplete:10});const U=await new xm().loadAsync(x);h({phase:"validating",current:0,total:1,percentComplete:20}),h({phase:"uploading",current:0,total:o.budgetsToRestore.length,percentComplete:30});const $=[],k=[],R=[];for(let N=0;N<o.budgetsToRestore.length;N++){const V=o.budgetsToRestore[N];try{const{budgetUpdate:H,monthUpdates:j,payeeWrite:B}=await oP(U,V);$.push(H),k.push(...j),B&&R.push(B),h({phase:"uploading",current:N+1,total:o.budgetsToRestore.length,percentComplete:30+Math.round((N+1)/o.budgetsToRestore.length*50)})}catch(H){S.push(`Budget ${V}: ${H instanceof Error?H.message:String(H)}`)}}if(h({phase:"uploading",current:o.budgetsToRestore.length,total:o.budgetsToRestore.length,percentComplete:80}),$.length>0)try{console.log(`[Upload] Writing ${$.length} budget(s)...`),await UT($,"upload-budget"),C=$.length,console.log(`[Upload] Successfully wrote ${C} budget(s)`)}catch(N){const V=`Failed to write budgets: ${N instanceof Error?N.message:String(N)}`;throw console.error(`[Upload] ${V}`,N),S.push(V),N}if(R.length>0)try{console.log(`[Upload] Writing ${R.length} payee doc(s)...`),await dm(R,"upload-budget: writing payees"),I=R.length,console.log(`[Upload] Successfully wrote ${I} payee doc(s)`)}catch(N){const V=`Failed to write payees: ${N instanceof Error?N.message:String(N)}`;throw console.error(`[Upload] ${V}`,N),S.push(V),N}if(k.length>0)try{console.log(`[Upload] Writing ${k.length} month(s) and recalculating...`),await p3(k,"upload-budget"),T=k.length,console.log(`[Upload] Successfully wrote ${T} month(s)`)}catch(N){const V=`Failed to write months: ${N instanceof Error?N.message:String(N)}`;throw console.error(`[Upload] ${V}`,N),S.push(V),N}h({phase:"complete",current:1,total:1,percentComplete:100}),v({success:S.length===0,budgetsRestored:C,monthsRestored:T,payeesRestored:I,errors:S}),console.log("[Upload] Clearing all caches after upload..."),Ia()}catch(O){const U=O instanceof Error?O.message:"Unknown error during upload";console.error("[Upload] Upload failed with error:",O),console.error("[Upload] Error details:",{errorMessage:U,budgetsRestored:C,monthsRestored:T,payeesRestored:I,errorsSoFar:S}),p(U),v({success:!1,budgetsRestored:C,monthsRestored:T,payeesRestored:I,errors:[...S,U]}),console.log("[Upload] Clearing all caches after failed upload (partial writes possible)..."),Ia()}finally{i(!1),h(null)}}return{isScanning:e,isUploading:r,status:o,progress:d,error:m,result:g,scanZipFile:b,uploadBudget:E}}function cP({isActive:t,onDragOver:e,onDragLeave:n,onDrop:r,label:i="Move to end"}){return u.jsxs("div",{onDragOver:e,onDragLeave:n,onDrop:r,style:M4,children:[u.jsx("div",{style:{...O4,opacity:t?1:.3,boxShadow:t?"0 0 8px rgba(100, 108, 255, 0.6)":"none"}}),t&&u.jsx("span",{style:N4,children:i})]})}function Xe(t){return`$${Math.abs(t).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`}function os(t){return t<0?`-$${Math.abs(t).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`:`$${t.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`}function za(t){return t===0?"$0.00":`${t>0?"+":"-"}${Xe(t)}`}function Gt(t){return`${t>=0?"+":"-"}${Xe(t)}`}function Bt(t){return t===0?me.zero:t>0?me.success:me.danger}function Mn(t){return t===0?me.zero:t>0?me.success:me.debt}function mc(t){return t===0?me.zero:t<0?me.error:me.success}function pc(t){return t===0?me.zero:t>0?me.success:me.error}async function HT(t,e){const{exists:n,data:r}=await At("feedback",t,`VALIDATION-READ: ${e}`);if(!n||!r)throw new Error(`Feedback document not found: ${t}`);return{items:r.items||[],user_email:r.user_email,created_at:r.created_at,updated_at:r.updated_at}}async function H0(t){const{docId:e,items:n,description:r}=t;await qn("feedback",e,{items:n,updated_at:new Date().toISOString()},r,{merge:!0})}async function uP(t,e,n,r){const{exists:i}=await At("feedback",t,"checking if user has existing feedback document");i?await qn("feedback",t,{items:Lu(e),user_email:n,updated_at:new Date().toISOString()},r,{merge:!0}):await qn("feedback",t,{items:[e],user_email:n,created_at:new Date().toISOString(),updated_at:new Date().toISOString()},r)}function GT(){const t=Ft(),e=Hn({onMutate:async r=>{const{userId:i,userEmail:o,text:l,feedbackType:d,currentPath:h}=r,m=o||i,p=ke.feedback();await t.cancelQueries({queryKey:p});const g=t.getQueryData(p),v=`feedback_optimistic_${Date.now()}`,b={id:v,text:`${l}

(Submitted from: ${h})`,created_at:new Date().toISOString(),is_done:!1,completed_at:null,sort_order:Date.now(),feedback_type:d,doc_id:m,user_email:o};return g&&t.setQueryData(p,{items:[...g.items,b]}),{previousData:g,optimisticId:v}},mutationFn:async r=>{const{userId:i,userEmail:o,text:l,feedbackType:d,currentPath:h}=r,m=o||i,p={id:`feedback_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,text:`${l}

(Submitted from: ${h})`,created_at:new Date().toISOString(),is_done:!1,completed_at:null,sort_order:Date.now(),feedback_type:d};return await uP(m,p,o,"submitting new feedback"),{feedbackItem:p,docId:m}},onSuccess:(r,i,o)=>{if(!o?.optimisticId)return;const l=t.getQueryData(ke.feedback());l&&t.setQueryData(ke.feedback(),{items:l.items.map(d=>d.id===o.optimisticId?{...r.feedbackItem,doc_id:r.docId,user_email:i.userEmail}:d)})},onError:(r,i,o)=>{o?.previousData&&t.setQueryData(ke.feedback(),o.previousData)}});return{submitFeedback:{mutate:r=>e.mutate(r),mutateAsync:r=>e.mutateAsync(r),isPending:e.isPending,isError:e.isError,error:e.error,reset:e.reset}}}function dP(){const t=Ft(),e=Hn({onMutate:async r=>{const{item:i}=r,o=ke.feedback(),l=!i.is_done,d=l?new Date().toISOString():null;await t.cancelQueries({queryKey:o});const h=t.getQueryData(o);return h&&t.setQueryData(o,{items:h.items.map(m=>m.id===i.id?{...m,is_done:l,completed_at:d}:m)}),{previousData:h}},mutationFn:async r=>{const{item:i}=r,o=!i.is_done,l=o?new Date().toISOString():null,d=await HT(i.doc_id,"toggle feedback");let h=!1;const m=d.items.map(p=>p.id===i.id?(h=!0,{...p,is_done:o,completed_at:l}):p);if(!h)throw console.error("[toggleFeedback] Item not found in document",{searchingFor:i.id,inDocument:i.doc_id,availableIds:d.items.map(p=>p.id)}),new Error(`Feedback item not found in document. Item ID: ${i.id}, Doc ID: ${i.doc_id}`);return await H0({docId:i.doc_id,items:m,description:`marking feedback item as ${o?"done":"not done"}`}),{itemId:i.id,isDone:o,completedAt:l}},onError:(r,i,o)=>{o?.previousData&&t.setQueryData(ke.feedback(),o.previousData)}});return{toggleFeedback:{mutate:r=>e.mutate(r),mutateAsync:r=>e.mutateAsync(r),isPending:e.isPending,isError:e.isError,error:e.error,reset:e.reset}}}function hP(){const t=Ft(),e=Hn({onMutate:async r=>{const{docId:i,items:o}=r,l=ke.feedback();await t.cancelQueries({queryKey:l});const d=t.getQueryData(l),h=new Map;return o.forEach(m=>{h.set(m.id,m.sort_order)}),d&&t.setQueryData(l,{items:d.items.map(m=>m.doc_id===i&&h.has(m.id)?{...m,sort_order:h.get(m.id)}:m)}),{previousData:d}},mutationFn:async r=>{const{docId:i,items:o}=r;return await H0({docId:i,items:o,description:"saving reordered feedback items"}),{docId:i,items:o}},onError:(r,i,o)=>{o?.previousData&&t.setQueryData(ke.feedback(),o.previousData)}});return{updateSortOrder:{mutate:r=>e.mutate(r),mutateAsync:r=>e.mutateAsync(r),isPending:e.isPending,isError:e.isError,error:e.error,reset:e.reset}}}function ls({isOpen:t,onClose:e,title:n,children:r,width:i="28rem"}){if(!t)return null;function o(){e()}return u.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0, 0, 0, 0.6)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1001,padding:"1rem"},onClick:o,children:u.jsxs("div",{style:{background:"#1a1a1a",color:"rgba(255, 255, 255, 0.87)",borderRadius:"12px",padding:"1.5rem",width:i,maxWidth:"calc(100vw - 2rem)",flexShrink:0,boxSizing:"border-box",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.5)"},onClick:l=>l.stopPropagation(),children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[u.jsx("h2",{style:{margin:0,fontSize:"1.25rem"},children:n}),u.jsx("button",{onClick:o,style:{background:"transparent",border:"none",color:"inherit",cursor:"pointer",fontSize:"1.5rem",opacity:.6,lineHeight:1},children:""})]}),r]})})}const fP=2e3,mP={critical_bug:{label:"Critical Bug",color:"#ff4757",bgColor:"rgba(255, 71, 87, 0.15)"},bug:{label:"Bug",color:"#ffa502",bgColor:"rgba(255, 165, 2, 0.15)"},new_feature:{label:"New Feature",color:"#2ed573",bgColor:"rgba(46, 213, 115, 0.15)"},core_feature:{label:"Core Feature",color:"#1e90ff",bgColor:"rgba(30, 144, 255, 0.15)"},qol:{label:"QOL",color:"#a55eea",bgColor:"rgba(165, 94, 234, 0.15)"}};function pP(){const[t,e]=D.useState(!1),[n,r]=D.useState(""),[i,o]=D.useState("bug"),[l,d]=D.useState(!1),h=D.useContext(cd),p=Da().get_current_firebase_user(),g=On(),{submitFeedback:v}=GT();if(D.useEffect(()=>{if(l){const x=setTimeout(()=>d(!1),fP);return()=>clearTimeout(x)}},[l]),g.pathname.includes("/admin/feedback")||!h.is_logged_in)return null;function E(x){x.preventDefault(),!(!n.trim()||!h.username||!p)&&(v.mutate({userId:p.uid,userEmail:h.username,text:n.trim(),feedbackType:i,currentPath:g.pathname}),r(""),o("bug"),e(!1),d(!0))}return u.jsxs(u.Fragment,{children:[l&&u.jsxs("div",{style:{position:"fixed",bottom:"5rem",right:"1.5rem",background:"rgba(46, 213, 115, 0.95)",color:"white",padding:"0.75rem 1rem",borderRadius:"0.5rem",fontSize:"0.9rem",fontWeight:500,boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",zIndex:1001,display:"flex",alignItems:"center",gap:"0.5rem",animation:"fadeInUp 0.2s ease-out"},children:[u.jsx("span",{children:""}),u.jsx("span",{children:"Feedback submitted!"})]}),u.jsx("button",{onClick:()=>{e(!0)},style:{position:"fixed",bottom:"1.5rem",right:"1.5rem",width:"3rem",height:"3rem",borderRadius:"50%",background:me.primary,color:"white",border:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1.25rem",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",transition:"transform 0.15s, box-shadow 0.15s",zIndex:1e3},title:"Send Feedback",onMouseEnter:x=>{x.currentTarget.style.transform="scale(1.1)",x.currentTarget.style.boxShadow="0 6px 16px rgba(0, 0, 0, 0.4)"},onMouseLeave:x=>{x.currentTarget.style.transform="scale(1)",x.currentTarget.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.3)"},children:""}),u.jsx(ls,{isOpen:t,onClose:()=>{e(!1),o("bug")},title:"Send Feedback",children:u.jsxs("form",{onSubmit:E,children:[u.jsx("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"0.75rem",paddingBottom:"1rem",flexWrap:"wrap"},children:["critical_bug","bug","new_feature","core_feature","qol"].map(x=>{const S=mP[x],C=i===x;return u.jsxs("button",{type:"button",onClick:()=>{S.label,o(x)},style:{flex:1,padding:"0.6rem 0.5rem",border:`2px solid ${S.color}`,borderRadius:"0.5rem",background:C?S.bgColor:"transparent",color:C?S.color:"rgba(255,255,255,0.5)",cursor:"pointer",fontWeight:C?600:400,fontSize:"0.8rem",transition:"all 0.15s ease",opacity:C?1:.5,boxShadow:C?`0 0 12px ${S.bgColor}`:"none",position:"relative"},children:[S.label,C&&u.jsx("span",{style:{position:"absolute",bottom:"-14px",left:"10%",right:"10%",height:"3px",background:"white",borderRadius:"2px"}})]},x)})}),u.jsx(q0,{value:n,onChange:x=>r(x.target.value),placeholder:"Share your feedback, bug reports, or feature requests...",minHeight:"8rem",autoFocus:!0,required:!0}),u.jsxs(Pa,{children:[u.jsx(Ve,{type:"button",variant:"secondary",actionName:"Cancel Feedback",onClick:()=>{e(!1),o("bug")},children:"Cancel"}),u.jsx(Ve,{type:"submit",actionName:"Submit Feedback",disabled:!n.trim(),children:"Submit"})]})]})})]})}function $r({children:t,labelStyle:e,...n}){return u.jsxs("label",{style:{display:"flex",alignItems:"flex-start",gap:"0.75rem",flex:1,cursor:"pointer",...e},children:[u.jsx("input",{type:"checkbox",style:{width:"1.25rem",height:"1.25rem",marginTop:"0.1rem",cursor:"pointer",accentColor:me.primary},...n}),t]})}function G0({title:t,count:e,children:n,defaultExpanded:r=!1}){const[i,o]=D.useState(r);return u.jsxs("div",{style:{marginTop:"2rem"},children:[u.jsxs("button",{onClick:()=>o(!i),style:{background:"transparent",border:"none",color:"inherit",cursor:"pointer",display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 0",fontSize:"0.9rem",opacity:.7},children:[u.jsx("span",{style:{transition:"transform 0.2s",transform:i?"rotate(90deg)":"rotate(0deg)"},children:""}),t,e!==void 0&&` (${e})`]}),i&&n]})}const gP=t=>{switch(t){case 2:return 220;case 3:return 320;case 4:return 420;case 5:return 520;case 6:return 620;default:return t*100+20}},yP=t=>t<=4?2:t<=6?3:Math.ceil(t/2);function Df(t){const{tabs:e,activeTab:n,variant:r="primary"}=t,i=e.filter(S=>!S.hidden),o=i.length,l=gP(o),d=yP(o),h=Math.floor(100/d),m=`tab-nav-${o}-${r}`,p=r==="primary",g=r==="secondary",v=r==="segmented",b=S=>{const C="color-mix(in srgb, currentColor 10%, transparent)",T="color-mix(in srgb, currentColor 3%, transparent)";return v?{flex:"1 1 0",padding:"0.75rem 1rem",border:"none",borderRadius:0,background:S?C:T,cursor:"pointer",fontWeight:S?600:400,fontSize:"0.95rem",color:"inherit",opacity:S?1:.55,transition:"all 0.15s",textDecoration:"none",display:"inline-flex",alignItems:"center",justifyContent:"center",gap:"0.25rem",position:"relative",boxSizing:"border-box",outline:"none",borderBottom:S?"2px solid currentColor":"2px solid transparent"}:g?{flex:"none",minWidth:"8.5rem",padding:"0.55rem 1rem 0.65rem",border:"none",borderRadius:"10px 10px 0 0",background:"transparent",cursor:"pointer",fontWeight:600,fontSize:"0.85rem",color:S?"inherit":"color-mix(in srgb, currentColor 55%, transparent)",transition:"color 0.15s",textDecoration:"none",display:"inline-flex",alignItems:"center",justifyContent:"center",gap:"0.25rem",position:"relative",boxSizing:"border-box",outline:"none",marginBottom:S?"-1px":"0"}:{flex:"1 1 0",padding:"0.7rem 0.75rem",border:"none",borderRadius:0,background:"transparent",cursor:"pointer",fontWeight:S?600:400,fontSize:"1rem",letterSpacing:"0.01em",color:"inherit",opacity:S?1:.6,transition:"all 0.15s",textDecoration:"none",display:"inline-flex",alignItems:"center",justifyContent:"center",gap:"0.25rem",position:"relative",boxSizing:"border-box",outline:"none"}},E=(S,C)=>u.jsxs(u.Fragment,{children:[u.jsx("span",{children:S.label}),S.checkmark&&u.jsx("span",{style:{color:me.success,fontWeight:600},children:""}),p&&C&&u.jsx("span",{style:{position:"absolute",bottom:"-1px",left:"10%",right:"10%",height:"3px",background:"white",borderRadius:"2px"}})]}),x=()=>v?`
        .${m} {
          display: flex;
          margin-bottom: 0.75rem;
          border-bottom: 1px solid color-mix(in srgb, currentColor 15%, transparent);
        }
      `:g?`
        .${m} {
          display: flex;
          flex-wrap: nowrap;
          margin-bottom: 1rem;
          border-bottom: 1px solid color-mix(in srgb, currentColor 10%, transparent);
          justify-content: flex-start;
          padding-left: 0.75rem;
          position: relative;
        }
        .${m} > button,
        .${m} > a {
          margin-right: -8px;
          isolation: isolate;
        }
        .${m} > button:last-child,
        .${m} > a:last-child {
          margin-right: 0;
        }
        .${m} > button::before,
        .${m} > a::before {
          content: '';
          position: absolute;
          inset: 0;
          background: var(--tab-bg);
          border-radius: 10px 10px 0 0;
          z-index: -1;
          transform: perspective(50px) rotateX(5deg);
          transform-origin: bottom center;
          transition: background 0.15s;
          box-shadow: -1px 0 0 #242424, 1px 0 0 #242424;
        }
        .${m} > button:nth-child(1),
        .${m} > a:nth-child(1) {
          z-index: 4;
        }
        .${m} > button:nth-child(2),
        .${m} > a:nth-child(2) {
          z-index: 3;
        }
        .${m} > button:nth-child(3),
        .${m} > a:nth-child(3) {
          z-index: 2;
        }
        .${m} > button:nth-child(4),
        .${m} > a:nth-child(4) {
          z-index: 1;
        }
        .${m} > button.tab-active,
        .${m} > a.tab-active {
          z-index: 10;
        }
        .${m} > button.tab-active::before,
        .${m} > a.tab-active::before {
          background: var(--tab-bg-active);
        }
        .${m} > button:not(.tab-active):hover,
        .${m} > a:not(.tab-active):hover {
          color: color-mix(in srgb, currentColor 80%, transparent);
        }
        .${m} > button:not(.tab-active):hover::before,
        .${m} > a:not(.tab-active):hover::before {
          background: var(--tab-bg-hover);
        }
        @media (max-width: 480px) {
          .${m} {
            padding-left: 0;
            padding-right: 0;
          }
          .${m} > button,
          .${m} > a {
            flex: 0 0 27% !important;
            min-width: 27% !important;
            padding: 0.55rem 0.5rem 0.65rem !important;
            font-size: 0.8rem !important;
          }
        }
      `:`
      .${m} {
        display: flex;
        flex-wrap: wrap;
        margin-bottom: 0;
        border-bottom: 1px solid color-mix(in srgb, currentColor 25%, transparent);
      }
      @media (max-width: ${l}px) {
        .${m} > * {
          flex: 1 1 ${h}% !important;
          min-width: ${h}% !important;
        }
      }
    `;return u.jsxs(u.Fragment,{children:[u.jsx("style",{children:`
        ${x()}
        .${m} > button,
        .${m} > a {
          border: none !important;
          border-radius: 0 !important;
          outline: none !important;
        }
        .${m} > button:hover,
        .${m} > button:focus,
        .${m} > a:hover,
        .${m} > a:focus {
          border: none !important;
          border-color: transparent !important;
          ${p?"opacity: 0.85;":""}
          ${v?"background: color-mix(in srgb, currentColor 7%, transparent);":""}
        }
      `}),u.jsx("div",{className:m,children:i.map(S=>{const C=n===S.id;return t.mode==="link"?u.jsx(Cn,{to:`${t.linkPrefix}/${S.id}`,onClick:()=>(`${S.label}`,void 0),style:b(C),className:C?"tab-active":"",children:E(S,C)},S.id):u.jsx("button",{onClick:()=>{`${S.label}`,t.onTabChange(S.id)},style:b(C),className:C?"tab-active":"",children:E(S,C)},S.id)})})]})}function QT({items:t}){const[e,n]=D.useState(!1),r=D.useRef(null),o=On().pathname;D.useEffect(()=>{function d(h){r.current&&!r.current.contains(h.target)&&n(!1)}if(e)return document.addEventListener("mousedown",d),()=>document.removeEventListener("mousedown",d)},[e]),D.useEffect(()=>{function d(h){h.key==="Escape"&&n(!1)}if(e)return document.addEventListener("keydown",d),()=>document.removeEventListener("keydown",d)},[e]);const l=t.filter(d=>d.hidden?!1:d.to?d.to==="/budget"?!(o==="/budget"||/^\/budget\/\d{4}\/\d{1,2}\/\w+$/.test(o)):d.to==="/account"||d.to==="/"?o!==d.to:!o.startsWith(d.to):!0);return u.jsxs("div",{ref:r,style:{position:"relative"},children:[u.jsx("button",{onClick:()=>{n(!e)},style:{display:"flex",alignItems:"center",justifyContent:"center",width:"2.5rem",height:"2.5rem",borderRadius:"8px",background:e?"color-mix(in srgb, currentColor 15%, transparent)":"color-mix(in srgb, currentColor 8%, transparent)",border:"none",cursor:"pointer",fontSize:"1.25rem",color:"inherit",transition:"background 0.15s",lineHeight:1},title:"Menu","aria-expanded":e,"aria-haspopup":"true",children:""}),e&&u.jsx("div",{style:{position:"absolute",top:"100%",right:0,marginTop:"0.5rem",minWidth:"180px",background:"#1a1a2e",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",borderRadius:"8px",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.3)",zIndex:1e3,overflow:"hidden"},children:l.map((d,h)=>{if(d.divider)return u.jsx("div",{style:{height:"1px",background:"color-mix(in srgb, currentColor 15%, transparent)",margin:"0.25rem 0"}},h);const m=u.jsxs(u.Fragment,{children:[d.icon&&u.jsx("span",{style:{width:"1.5rem",textAlign:"center"},children:d.icon}),u.jsx("span",{children:d.label})]}),p={display:"flex",alignItems:"center",gap:"0.75rem",padding:"0.75rem 1rem",fontSize:"0.95rem",color:"inherit",textDecoration:"none",cursor:"pointer",transition:"background 0.15s",background:"transparent",border:"none",width:"100%",textAlign:"left"},g={background:"color-mix(in srgb, currentColor 10%, transparent)"};return d.to?u.jsx(Cn,{to:d.to,style:p,onMouseEnter:v=>Object.assign(v.currentTarget.style,g),onMouseLeave:v=>v.currentTarget.style.background="transparent",onClick:()=>{`${d.label}`,n(!1)},children:m},h):u.jsx("button",{onClick:()=>{`${d.label}`,d.onClick?.(),n(!1)},style:p,onMouseEnter:v=>Object.assign(v.currentTarget.style,g),onMouseLeave:v=>v.currentTarget.style.background="transparent",children:m},h)})})]})}function _P({title:t,showBackArrow:e=!1,hideMenu:n=!1}){const{isAdmin:r}=Ye(),i=On(),l=[...i.pathname==="/budget"||i.pathname.startsWith("/budget/")&&!i.pathname.startsWith("/budget/settings")&&!i.pathname.startsWith("/budget/admin")&&!i.pathname.startsWith("/budget/analytics")&&!i.pathname.startsWith("/budget/my-budgets")?[]:[{label:"Budget",icon:"",to:"/budget"}],{label:"Budget Settings",icon:"",to:"/budget/settings"},{label:"Analytics",icon:"",to:"/budget/analytics"},...r?[{label:"Admin",icon:"",to:"/budget/admin"}]:[],{label:"Switch Budgets",icon:"",to:"/budget/my-budgets"},{divider:!0,label:""},{label:"Exit Budget App",icon:"",to:"/"}];return u.jsxs("nav",{style:{marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%"},children:[u.jsx("div",{style:{flex:"0 0 auto"},children:e?u.jsx(Cn,{to:"/",onClick:()=>void 0,style:{opacity:.6,fontSize:"1.5rem",textDecoration:"none"},title:"Back to Home",children:""}):u.jsx(Cn,{to:"/budget",onClick:()=>void 0,title:"Budget Home",children:u.jsx("img",{src:"/budget-icon.svg",alt:"Budget",style:{width:"1.5rem",height:"1.5rem"}})})}),u.jsx("span",{style:{fontWeight:600,fontSize:"1.1rem",textAlign:"center",flex:"1 1 auto"},children:t}),u.jsx("div",{style:{flex:"0 0 auto"},children:n?u.jsx("div",{style:{width:"1.5rem"}}):u.jsx(QT,{items:l})})]})}function WT({children:t,style:e}){return u.jsx("div",{style:{width:"100%",maxWidth:"var(--content-max-width, 900px)",marginLeft:"auto",marginRight:"auto",...e},children:t})}function qu({message:t,linkText:e,linkTo:n}){return u.jsx("div",{style:{gridColumn:"1 / -1",background:`color-mix(in srgb, ${me.warning} 12%, transparent)`,border:`2px solid ${me.warning}`,borderRadius:"8px",padding:"1rem 1.25rem",margin:"0.75rem 0",animation:"warningPulse 2s ease-in-out infinite"},children:u.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"0.75rem",flexWrap:"wrap"},children:[u.jsx("span",{style:{fontSize:"1.25rem",lineHeight:1.3},children:""}),u.jsxs("div",{style:{flex:1,minWidth:"200px"},children:[u.jsx("p",{style:{margin:0,fontWeight:500,color:me.warning,fontSize:"0.95rem"},children:t}),u.jsxs(Cn,{to:n,style:{display:"inline-flex",alignItems:"center",gap:"0.35rem",marginTop:"0.5rem",color:me.warning,fontWeight:600,fontSize:"0.9rem",textDecoration:"underline",textUnderlineOffset:"3px"},children:[e," "]})]})]})})}const bP={success:{bgColor:"rgba(46, 213, 115, 0.95)",color:"white",icon:""},error:{bgColor:"rgba(255, 71, 87, 0.95)",color:"white",icon:""},warning:{bgColor:"rgba(255, 165, 2, 0.95)",color:"white",icon:""},info:{bgColor:"rgba(30, 144, 255, 0.95)",color:"white",icon:""}};function vP({item:t,onDismiss:e}){const[n,r]=D.useState(!1);if(D.useEffect(()=>{if(t){if(r(!0),t.autoDismissMs&&t.autoDismissMs>0){const o=setTimeout(()=>{r(!1),setTimeout(()=>e(t.id),200)},t.autoDismissMs);return()=>clearTimeout(o)}}else r(!1)},[t,e]),!t||!n)return null;const i=bP[t.type];return u.jsxs("div",{style:{position:"fixed",bottom:"1.5rem",right:"1.5rem",left:"1.5rem",maxWidth:"600px",margin:"0 auto",background:i.bgColor,color:i.color,padding:"0.75rem 1rem",borderRadius:"0.5rem",fontSize:"0.9rem",fontWeight:500,boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",zIndex:1001,display:"flex",alignItems:"center",gap:"0.5rem",animation:n?"fadeInUp 0.2s ease-out":"fadeOut 0.2s ease-out",cursor:"pointer"},onClick:()=>{r(!1),setTimeout(()=>e(t.id),200)},children:[u.jsx("span",{children:i.icon}),u.jsx("span",{style:{flex:1},children:t.message}),u.jsx("span",{style:{fontSize:"1.2rem",lineHeight:1},children:""})]})}class xP{items=[];listeners=new Set;nextId=1;add(e){const n=`banner-${this.nextId++}`,r={...e,id:n};return this.items.push(r),this.notify(),n}remove(e){this.items=this.items.filter(n=>n.id!==e),this.notify()}getCurrent(){return this.items[0]||null}subscribe(e){return this.listeners.add(e),e(this.getCurrent()),()=>{this.listeners.delete(e)}}notify(){const e=this.getCurrent();this.listeners.forEach(n=>n(e))}}const mr=new xP;function wP(t,e){const n={};Object.keys(e).forEach(l=>{n[l]=0});const r=Le.getQueryData(ke.budget(t));if(!r)return n;const i=r.budget.month_map||{},o=Object.keys(i).sort();for(const l of o){const d=parseInt(l.substring(0,4),10),h=parseInt(l.substring(4,6),10),m=ke.month(t,d,h),p=Le.getQueryData(m);if(!p?.month)continue;const g=p.month;for(const v of g.account_balances||[])v.account_id&&!et(v.account_id)&&n[v.account_id]===0&&(n[v.account_id]=v.start_balance??0)}for(const l of o){const d=parseInt(l.substring(0,4),10),h=parseInt(l.substring(4,6),10),m=ke.month(t,d,h),p=Le.getQueryData(m);if(!p?.month)continue;const g=p.month;for(const v of g.income||[])v.account_id&&!et(v.account_id)&&n[v.account_id]!==void 0&&(n[v.account_id]+=v.amount);for(const v of g.expenses||[])v.account_id&&!et(v.account_id)&&n[v.account_id]!==void 0&&(n[v.account_id]+=v.amount);for(const v of g.transfers||[])v.to_account_id&&!et(v.to_account_id)&&n[v.to_account_id]!==void 0&&(n[v.to_account_id]+=v.amount),v.from_account_id&&!et(v.from_account_id)&&n[v.from_account_id]!==void 0&&(n[v.from_account_id]-=v.amount);for(const v of g.adjustments||[])v.account_id&&!et(v.account_id)&&n[v.account_id]!==void 0&&(n[v.account_id]+=v.amount)}for(const l of Object.keys(n))n[l]=Me(n[l]);return n}function KT(t){const e=Le.getQueryData(ke.budget(t));if(!e){console.warn("[recalculateBudgetAccountBalancesFromCache] Budget not in cache");return}const n=wP(t,e.accounts),r={};for(const[o,l]of Object.entries(e.accounts))r[o]={...l,balance:n[o]??l.balance};const i=U0(r,e.categories,e.accountGroups);Le.setQueryData(ke.budget(t),{...e,accounts:r,budget:{...e.budget,accounts:r,total_available:i}})}const SP=300*1e3;function xn(){const{removeChange:t,getChanges:e,clearChanges:n,hasChanges:r,setIsSaving:i,setLastSaveTime:o,setSaveError:l}=fc(),d=D.useRef(null),h=D.useRef(!1),m=D.useCallback(async(E,x,S,C)=>{const T=ke.month(E,x,S),I=Le.getQueryData(T);if(!I?.month)throw new Error(`Month ${x}/${S} not found in cache`);await CT({budgetId:E,month:I.month,description:`${C}: ${x}/${S}`,cascadeRecalculation:!1})},[]),p=D.useCallback(async(E,x)=>{const S=ke.budget(E),C=Le.getQueryData(S);if(!C)throw new Error(`Budget ${E} not found in cache`);await gm({budgetId:E,updates:{name:C.budget.name,user_ids:C.budget.user_ids,accepted_user_ids:C.budget.accepted_user_ids,owner_id:C.budget.owner_id,owner_email:C.budget.owner_email,accounts:C.budget.accounts,account_groups:C.budget.account_groups,categories:C.budget.categories,category_groups:C.budget.category_groups,total_available:C.budget.total_available,is_needs_recalculation:C.budget.is_needs_recalculation,month_map:C.budget.month_map},description:`${x}: budget`})},[]),g=D.useCallback(async(E,x)=>{const S=ke.payees(E),C=Le.getQueryData(S);if(!C)throw new Error(`Payees for budget ${E} not found in cache`);await qn("payees",E,{budget_id:E,payees:C,updated_at:new Date().toISOString()},`${x}: payees`)},[]),v=D.useCallback(async(E="periodic save")=>{if(h.current||!r())return;h.current=!0,i(!0),l(null);const x=e(),S=[];try{const C=[],T=new Set,I=new Set;for(const O of x)O.type==="month"&&O.year!==void 0&&O.month!==void 0?C.push({budgetId:O.budgetId,year:O.year,month:O.month}):O.type==="budget"?T.add(O.budgetId):O.type==="payees"&&I.add(O.budgetId);for(const{budgetId:O,year:U,month:$}of C){const k=ke.month(O,U,$),R=Le.getQueryData(k);if(R?.month){const N=_m(R.month);Le.setQueryData(k,{month:N})}}for(const{budgetId:O,year:U,month:$}of C)try{await m(O,U,$,E)}catch(k){const R=`Failed to save month ${U}/${$}: ${k instanceof Error?k.message:String(k)}`;S.push(R),console.error("[useBackgroundSave]",R,k)}for(const O of T)try{KT(O)}catch(U){console.warn("[useBackgroundSave] Failed to recalculate budget account balances from cache:",U)}for(const O of T)try{await p(O,E)}catch(U){const $=`Failed to save budget: ${U instanceof Error?U.message:String(U)}`;S.push($),console.error("[useBackgroundSave]",$,U)}for(const O of I)try{await g(O,E)}catch(U){const $=`Failed to save payees: ${U instanceof Error?U.message:String(U)}`;S.push($),console.error("[useBackgroundSave]",$,U)}if(S.length===0)n(),o(Date.now()),mr.add({type:"success",message:"All changes saved successfully",autoDismissMs:2e3});else throw new Error(S.join("; "))}catch(C){const T=C instanceof Error?C.message:String(C);throw l(T),mr.add({type:"error",message:`Failed to save changes: ${T}`,autoDismissMs:0}),C}finally{h.current=!1,i(!1)}},[r,e,n,m,p,g,i,o,l]),b=D.useCallback(async(E,x,S,C)=>{try{i(!0),l(null),x==="month"&&S!==void 0&&C!==void 0?(await m(E,S,C,"immediate save (current viewing document)"),t({type:"month",budgetId:E,year:S,month:C}),o(Date.now())):x==="budget"&&(await p(E,"immediate save (current viewing document)"),t({type:"budget",budgetId:E}),o(Date.now()))}catch(T){const I=T instanceof Error?T.message:String(T);throw l(I),mr.add({type:"error",message:`Failed to save current document: ${I}`,autoDismissMs:0}),T}finally{i(!1)}},[m,p,t,i,o,l]);return D.useEffect(()=>(d.current&&clearInterval(d.current),d.current=setInterval(()=>{r()&&v("periodic save (5-minute timer)").catch(x=>{console.error("[useBackgroundSave] Periodic save failed:",x)})},SP),()=>{d.current&&clearInterval(d.current)}),[r,v]),{saveAllChanges:v,saveCurrentDocument:b}}async function EP(t,e,n,r){const i=Le.getQueryData(ke.budget(t));if(!i){console.warn("[mutationHelpers] Budget not in cache, skipping local recalculation");return}const o=i.budget.month_map,l=vt(e,n),d=[];for(const[h]of Object.entries(o))if(h>=l){const m=parseInt(h.substring(0,4),10),p=parseInt(h.substring(4,6),10);d.push({year:m,month:p})}d.sort((h,m)=>h.year!==m.year?h.year-m.year:h.month-m.month);for(const{year:h,month:m}of d)try{await i3(t,h,m,Le),r&&r({type:"month",budgetId:t,year:h,month:m})}catch(p){console.warn(`[mutationHelpers] Failed to recalculate month ${h}/${m} locally:`,p)}}function gr(){const{trackChange:t}=fc();return{updateMonthCacheAndTrack:(r,i,o,l)=>{Le.setQueryData(ke.month(r,i,o),{month:l}),t({type:"month",budgetId:r,year:i,month:o})},recalculateMonthAndCascade:async(r,i,o)=>{const l=ke.month(r,i,o),d=Le.getQueryData(l);if(d?.month){const h=_m(d.month);Le.setQueryData(l,{month:h})}await EP(r,i,o,t);try{KT(r),t({type:"budget",budgetId:r})}catch(h){console.warn("[mutationHelpers] Failed to recalculate budget account balances from cache:",h),t({type:"budget",budgetId:r})}},trackChange:t}}function CP(){const{currentViewingDocument:t}=Ye(),{saveCurrentDocument:e}=xn(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=gr();return{finalizeAllocations:async o=>{const{budgetId:l,year:d,month:h,allocations:m,onProgress:p}=o;p?.({phase:"saving",message:"Saving allocations..."});const g=await Gr(l,d,h);if(!g)throw new Error(`Month not found: ${d}/${h}`);const v=g.category_balances?.map(C=>C.category_id)??[],b=v.length>0?v:Object.keys(m),E=b.length>0?v4(g,b,m):g.category_balances,x={...g,category_balances:E,are_allocations_finalized:!0,updated_at:new Date().toISOString()};n(l,d,h,x),p?.({phase:"recalculating",message:"Recalculating month balances..."});try{await r(l,d,h)}catch(C){console.warn("[useFinalizeAllocations] Failed to recalculate month and cascade:",C)}if(t.type==="month"&&t.year===d&&t.month===h)try{await e(l,"month",d,h)}catch(C){console.warn("[useFinalizeAllocations] Failed to save current document immediately:",C)}return p?.({phase:"complete",message:"Allocations applied!"}),{updatedMonth:x}},isPending:!1,isError:!1,error:null}}function YT(){const{currentViewingDocument:t}=Ye(),{saveCurrentDocument:e}=xn(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=gr();return{deleteAllocations:async o=>{const{budgetId:l,year:d,month:h,onProgress:m}=o;m?.({phase:"saving",message:"Deleting allocations..."});const p=await Gr(l,d,h);if(!p)throw new Error(`Month not found: ${d}/${h}`);const g=p.category_balances.map(E=>({...E,allocated:0,end_balance:E.start_balance-E.spent})),v={...p,category_balances:g,are_allocations_finalized:!1,updated_at:new Date().toISOString()};n(l,d,h,v),m?.({phase:"recalculating",message:"Recalculating month balances..."});try{await r(l,d,h)}catch(E){console.warn("[useDeleteAllocations] Failed to recalculate month and cascade:",E)}if(t.type==="month"&&t.year===d&&t.month===h)try{await e(l,"month",d,h)}catch(E){console.warn("[useDeleteAllocations] Failed to save current document immediately:",E)}return m?.({phase:"complete",message:"Allocations deleted!"}),{updatedMonth:v}},isPending:!1,isError:!1,error:null}}async function wm(t,e,n){const r=e.trim();if(!r||n.includes(r))return null;const i=[...n,r].sort((o,l)=>o.toLowerCase().localeCompare(l.toLowerCase()));return await qn("payees",t,{budget_id:t,payees:i,updated_at:new Date().toISOString()},`adding new payee "${r}" to autocomplete list`),i}function TP(t,e){const n={id:e,amount:t.amount,account_id:t.accountId,date:t.date,created_at:new Date().toISOString()};return t.payee?.trim()&&(n.payee=t.payee.trim()),t.description&&(n.description=t.description),n}function AP(){const t=Ft(),{currentViewingDocument:e}=Ye(),{saveCurrentDocument:n}=xn(),{updateMonthCacheAndTrack:r,recalculateMonthAndCascade:i,trackChange:o}=gr(),l=Hn({onMutate:async h=>{const{budgetId:m,year:p,month:g}=h,v=ke.month(m,p,g);await t.cancelQueries({queryKey:v});const b=t.getQueryData(v),E=`income_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,x=TP(h,E);if(b?.month){const C={...b.month,income:[...b.month.income||[],x],updated_at:new Date().toISOString()};r(m,p,g,C)}try{await i(m,p,g)}catch(C){console.warn("[useAddIncome] Failed to recalculate month and cascade:",C)}if(h.payee?.trim()){const C=t.getQueryData(ke.payees(m))||[],T=await wm(m,h.payee,C);T&&(t.setQueryData(ke.payees(m),T),o({type:"payees",budgetId:m}))}if(e.type==="month"&&e.year===p&&e.month===g)try{await n(m,"month",p,g)}catch(C){console.warn("[useAddIncome] Failed to save current document immediately:",C)}return{previousData:b,incomeId:E,newIncome:x}},mutationFn:async h=>{const{budgetId:m,year:p,month:g}=h,v=ke.month(m,p,g),b=t.getQueryData(v);if(!b?.month)throw new Error("No month data in cache after optimistic update");const E=b.month,x=E.income?.[E.income.length-1];if(!x)throw new Error("Could not find new income in updated month");return{updatedMonth:E,newIncome:x}},onError:(h,m,p)=>{if(p?.previousData){const{budgetId:g,year:v,month:b}=m;t.setQueryData(ke.month(g,v,b),p.previousData)}}});return{addIncome:async(h,m,p,g,v,b,E,x)=>l.mutateAsync({budgetId:h,year:m,month:p,amount:g,accountId:v,date:b,payee:E,description:x}),isPending:l.isPending,isError:l.isError,error:l.error}}function jP(t,e,n,r,i,o){if(!t)return!0;const l=t.payee||void 0,d=i?.trim()||void 0,h=t.description||void 0,m=o||void 0;return e!==t.amount||n!==t.account_id||r!==t.date||d!==l||m!==h}function RP(){const t=Ft(),{currentViewingDocument:e}=Ye(),{saveCurrentDocument:n}=xn(),{updateMonthCacheAndTrack:r,recalculateMonthAndCascade:i,trackChange:o}=gr();return{updateIncome:async(d,h,m,p,g,v,b,E,x)=>{const S=await Gr(d,h,m);if(!S)throw new Error(`Month not found: ${h}/${m}`);const C=(S.income||[]).find($=>$.id===p);if(!jP(C,g,v,b,E,x))return{updatedMonth:S,noOp:!0};const T={id:p,amount:g,account_id:v,date:b,created_at:(S.income||[]).find($=>$.id===p)?.created_at||new Date().toISOString()};E?.trim()&&(T.payee=E.trim()),x&&(T.description=x);const I=(S.income||[]).map($=>$.id===p?T:$),O={...S,income:I,updated_at:new Date().toISOString()};r(d,h,m,O);try{await i(d,h,m)}catch($){console.warn("[useUpdateIncome] Failed to recalculate month and cascade:",$)}if(E?.trim()){const $=t.getQueryData(ke.payees(d))||[],k=await wm(d,E,$);k&&(t.setQueryData(ke.payees(d),k),o({type:"payees",budgetId:d}))}if(e.type==="month"&&e.year===h&&e.month===m)try{await n(d,"month",h,m)}catch($){console.warn("[useUpdateIncome] Failed to save current document immediately:",$)}return{updatedMonth:O}},isPending:!1,isError:!1,error:null}}function IP(){const{currentViewingDocument:t}=Ye(),{saveCurrentDocument:e}=xn(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=gr();return{deleteIncome:async(o,l,d,h)=>{const m=await Gr(o,l,d);if(!m)throw new Error(`Month not found: ${l}/${d}`);const p=(m.income||[]).filter(b=>b.id!==h),g={...m,income:p,updated_at:new Date().toISOString()};n(o,l,d,g);try{await r(o,l,d)}catch(b){console.warn("[useDeleteIncome] Failed to recalculate month and cascade:",b)}if(t.type==="month"&&t.year===l&&t.month===d)try{await e(o,"month",l,d)}catch(b){console.warn("[useDeleteIncome] Failed to save current document immediately:",b)}return{updatedMonth:g}},isPending:!1,isError:!1,error:null}}function kP(t,e){const n={id:e,amount:t.amount,category_id:t.categoryId,account_id:t.accountId,date:t.date,created_at:new Date().toISOString()};return t.payee?.trim()&&(n.payee=t.payee.trim()),t.description&&(n.description=t.description),t.cleared!==void 0&&(n.cleared=t.cleared),n}function DP(){const t=Ft(),{currentViewingDocument:e}=Ye(),{saveCurrentDocument:n}=xn(),{updateMonthCacheAndTrack:r,recalculateMonthAndCascade:i,trackChange:o}=gr(),l=Hn({onMutate:async h=>{const{budgetId:m,year:p,month:g}=h,v=ke.month(m,p,g);await t.cancelQueries({queryKey:v});const b=t.getQueryData(v),E=`expense_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,x=kP(h,E);if(b?.month){const C={...b.month,expenses:[...b.month.expenses||[],x],updated_at:new Date().toISOString()};r(m,p,g,C)}try{await i(m,p,g)}catch(C){console.warn("[useAddExpense] Failed to recalculate month and cascade:",C)}if(h.payee?.trim()){const C=t.getQueryData(ke.payees(m))||[],T=await wm(m,h.payee,C);T&&(t.setQueryData(ke.payees(m),T),o({type:"payees",budgetId:m}))}if(e.type==="month"&&e.year===p&&e.month===g)try{await n(m,"month",p,g)}catch(C){console.warn("[useAddExpense] Failed to save current document immediately:",C)}return{previousData:b,expenseId:E,newExpense:x}},mutationFn:async h=>{const{budgetId:m,year:p,month:g}=h,v=ke.month(m,p,g),b=t.getQueryData(v);if(!b?.month)throw new Error("No month data in cache after optimistic update");const E=b.month,x=E.expenses?.[E.expenses.length-1];if(!x)throw new Error("Could not find new expense in updated month");return{updatedMonth:E,newExpense:x}},onError:(h,m,p)=>{if(p?.previousData){const{budgetId:g,year:v,month:b}=m;t.setQueryData(ke.month(g,v,b),p.previousData)}}});return{addExpense:async(h,m,p,g,v,b,E,x,S,C)=>l.mutateAsync({budgetId:h,year:m,month:p,amount:g,categoryId:v,accountId:b,date:E,payee:x,description:S,cleared:C}),isPending:l.isPending,isError:l.isError,error:l.error}}function MP(t,e,n,r,i,o,l,d){if(!t)return!0;const h=t.payee||void 0,m=o?.trim()||void 0,p=t.description||void 0,g=l||void 0;return e!==t.amount||n!==t.category_id||r!==t.account_id||i!==t.date||m!==h||g!==p||d!==t.cleared}function OP(){const t=Ft(),{currentViewingDocument:e}=Ye(),{saveCurrentDocument:n}=xn(),{updateMonthCacheAndTrack:r,recalculateMonthAndCascade:i}=gr();return{updateExpense:async(l,d,h,m,p,g,v,b,E,x,S)=>{const C=await Gr(l,d,h);if(!C)throw new Error(`Month not found: ${d}/${h}`);const T=(C.expenses||[]).find(k=>k.id===m);if(!MP(T,p,g,v,b,E,x,S))return{updatedMonth:C,noOp:!0};const I={id:m,amount:p,category_id:g,account_id:v,date:b,created_at:C.expenses?.find(k=>k.id===m)?.created_at||new Date().toISOString()};E?.trim()&&(I.payee=E.trim()),x&&(I.description=x),S!==void 0&&(I.cleared=S);const O=(C.expenses||[]).map(k=>k.id===m?I:k),U={...C,expenses:O,updated_at:new Date().toISOString()};r(l,d,h,U);try{await i(l,d,h)}catch(k){console.warn("[useUpdateExpense] Failed to recalculate month and cascade:",k)}if(E?.trim()){const k=t.getQueryData(ke.payees(l))||[],R=await wm(l,E,k);R&&t.setQueryData(ke.payees(l),R)}if(e.type==="month"&&e.year===d&&e.month===h)try{await n(l,"month",d,h)}catch(k){console.warn("[useUpdateExpense] Failed to save current document immediately:",k)}return{updatedMonth:U}},isPending:!1,isError:!1,error:null}}function NP(){const{currentViewingDocument:t}=Ye(),{saveCurrentDocument:e}=xn(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=gr();return{deleteExpense:async(o,l,d,h)=>{const m=await Gr(o,l,d);if(!m)throw new Error(`Month not found: ${l}/${d}`);const p=(m.expenses||[]).filter(b=>b.id!==h),g={...m,expenses:p,updated_at:new Date().toISOString()};n(o,l,d,g);try{await r(o,l,d)}catch(b){console.warn("[useDeleteExpense] Failed to recalculate month and cascade:",b)}if(t.type==="month"&&t.year===l&&t.month===d)try{await e(o,"month",l,d)}catch(b){console.warn("[useDeleteExpense] Failed to save current document immediately:",b)}return{updatedMonth:g}},isPending:!1,isError:!1,error:null}}function PP(t,e){const n={id:e,amount:t.amount,from_account_id:t.fromAccountId,to_account_id:t.toAccountId,from_category_id:t.fromCategoryId,to_category_id:t.toCategoryId,date:t.date,created_at:new Date().toISOString()};return t.description&&(n.description=t.description),t.cleared!==void 0&&(n.cleared=t.cleared),n}function BP(){const t=Ft(),{currentViewingDocument:e}=Ye(),{saveCurrentDocument:n}=xn(),{updateMonthCacheAndTrack:r,recalculateMonthAndCascade:i}=gr(),o=Hn({onMutate:async d=>{const{budgetId:h,year:m,month:p}=d,g=ke.month(h,m,p);await t.cancelQueries({queryKey:g});const v=t.getQueryData(g),b=`transfer_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,E=PP(d,b);if(v?.month){const S={...v.month,transfers:[...v.month.transfers||[],E],updated_at:new Date().toISOString()};r(h,m,p,S)}try{await i(h,m,p)}catch(S){console.warn("[useAddTransfer] Failed to recalculate month and cascade:",S)}if(e.type==="month"&&e.year===m&&e.month===p)try{await n(h,"month",m,p)}catch(S){console.warn("[useAddTransfer] Failed to save current document immediately:",S)}return{previousData:v,transferId:b,newTransfer:E}},mutationFn:async d=>{const{budgetId:h,year:m,month:p}=d,g=ke.month(h,m,p),v=t.getQueryData(g);if(!v?.month)throw new Error("No month data in cache after optimistic update");const b=v.month,E=b.transfers?.[b.transfers.length-1];if(!E)throw new Error("Could not find new transfer in updated month");return{updatedMonth:b,newTransfer:E}},onError:(d,h,m)=>{if(m?.previousData){const{budgetId:p,year:g,month:v}=h;t.setQueryData(ke.month(p,g,v),m.previousData)}}});return{addTransfer:async(d,h,m,p,g,v,b,E,x,S,C)=>o.mutateAsync({budgetId:d,year:h,month:m,amount:p,fromAccountId:g,toAccountId:v,fromCategoryId:b,toCategoryId:E,date:x,description:S,cleared:C}),isPending:o.isPending,isError:o.isError,error:o.error}}function zP(t,e,n,r,i,o,l,d,h){if(!t)return!0;const m=t.description||void 0,p=d||void 0;return e!==t.amount||n!==t.from_account_id||r!==t.to_account_id||i!==t.from_category_id||o!==t.to_category_id||l!==t.date||p!==m||h!==t.cleared}function LP(){const{currentViewingDocument:t}=Ye(),{saveCurrentDocument:e}=xn(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=gr();return{updateTransfer:async(o,l,d,h,m,p,g,v,b,E,x,S)=>{const C=await Gr(o,l,d);if(!C)throw new Error(`Month not found: ${l}/${d}`);const T=(C.transfers||[]).find(k=>k.id===h);if(!zP(T,m,p,g,v,b,E,x,S))return{updatedMonth:C,noOp:!0};const I={id:h,amount:m,from_account_id:p,to_account_id:g,from_category_id:v,to_category_id:b,date:E,created_at:C.transfers?.find(k=>k.id===h)?.created_at||new Date().toISOString()};x&&(I.description=x),S!==void 0&&(I.cleared=S);const O=(C.transfers||[]).map(k=>k.id===h?I:k),U={...C,transfers:O,updated_at:new Date().toISOString()};n(o,l,d,U);try{await r(o,l,d)}catch(k){console.warn("[useUpdateTransfer] Failed to recalculate month and cascade:",k)}if(t.type==="month"&&t.year===l&&t.month===d)try{await e(o,"month",l,d)}catch(k){console.warn("[useUpdateTransfer] Failed to save current document immediately:",k)}return{updatedMonth:U}},isPending:!1,isError:!1,error:null}}function UP(){const{currentViewingDocument:t}=Ye(),{saveCurrentDocument:e}=xn(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=gr();return{deleteTransfer:async(o,l,d,h)=>{const m=await Gr(o,l,d);if(!m)throw new Error(`Month not found: ${l}/${d}`);const p=(m.transfers||[]).filter(b=>b.id!==h),g={...m,transfers:p,updated_at:new Date().toISOString()};n(o,l,d,g);try{await r(o,l,d)}catch(b){console.warn("[useDeleteTransfer] Failed to recalculate month and cascade:",b)}if(t.type==="month"&&t.year===l&&t.month===d)try{await e(o,"month",l,d)}catch(b){console.warn("[useDeleteTransfer] Failed to save current document immediately:",b)}return{updatedMonth:g}},isPending:!1,isError:!1,error:null}}function FP(t,e){const n={id:e,amount:t.amount,account_id:t.accountId,category_id:t.categoryId,date:t.date,created_at:new Date().toISOString()};return t.payee?.trim()&&(n.payee=t.payee.trim()),t.description&&(n.description=t.description),t.cleared!==void 0&&(n.cleared=t.cleared),n}function VP(){const t=Ft(),{currentViewingDocument:e}=Ye(),{saveCurrentDocument:n}=xn(),{updateMonthCacheAndTrack:r,recalculateMonthAndCascade:i}=gr(),o=Hn({onMutate:async d=>{const{budgetId:h,year:m,month:p}=d,g=ke.month(h,m,p);await t.cancelQueries({queryKey:g});const v=t.getQueryData(g),b=`adjustment_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,E=FP(d,b);if(v?.month){const S={...v.month,adjustments:[...v.month.adjustments||[],E],updated_at:new Date().toISOString()};r(h,m,p,S)}try{await i(h,m,p)}catch(S){console.warn("[useAddAdjustment] Failed to recalculate month and cascade:",S)}if(e.type==="month"&&e.year===m&&e.month===p)try{await n(h,"month",m,p)}catch(S){console.warn("[useAddAdjustment] Failed to save current document immediately:",S)}return{previousData:v,adjustmentId:b,newAdjustment:E}},mutationFn:async d=>{const{budgetId:h,year:m,month:p}=d,g=ke.month(h,m,p),v=t.getQueryData(g);if(!v?.month)throw new Error("No month data in cache after optimistic update");const b=v.month,E=b.adjustments?.[b.adjustments.length-1];if(!E)throw new Error("Could not find new adjustment in updated month");return{updatedMonth:b,newAdjustment:E}},onError:(d,h,m)=>{if(m?.previousData){const{budgetId:p,year:g,month:v}=h;t.setQueryData(ke.month(p,g,v),m.previousData)}}});return{addAdjustment:async(d,h,m,p,g,v,b,E,x,S)=>o.mutateAsync({budgetId:d,year:h,month:m,amount:p,accountId:g,categoryId:v,date:b,payee:E,description:x,cleared:S}),isPending:o.isPending,isError:o.isError,error:o.error}}function $P(t,e,n,r,i,o,l,d){if(!t)return!0;const h=t.payee||void 0,m=o?.trim()||void 0,p=t.description||void 0,g=l||void 0;return e!==t.amount||n!==t.account_id||r!==t.category_id||i!==t.date||m!==h||g!==p||d!==t.cleared}function qP(){const{currentViewingDocument:t}=Ye(),{saveCurrentDocument:e}=xn(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=gr();return{updateAdjustment:async(o,l,d,h,m,p,g,v,b,E,x)=>{const S=await Gr(o,l,d);if(!S)throw new Error(`Month not found: ${l}/${d}`);const C=(S.adjustments||[]).find($=>$.id===h);if(!$P(C,m,p,g,v,b,E,x))return{updatedMonth:S,noOp:!0};const T={id:h,amount:m,account_id:p,category_id:g,date:v,created_at:S.adjustments?.find($=>$.id===h)?.created_at||new Date().toISOString()};b?.trim()&&(T.payee=b.trim()),E&&(T.description=E),x!==void 0&&(T.cleared=x);const I=(S.adjustments||[]).map($=>$.id===h?T:$),O={...S,adjustments:I,updated_at:new Date().toISOString()};n(o,l,d,O);try{await r(o,l,d)}catch($){console.warn("[useUpdateAdjustment] Failed to recalculate month and cascade:",$)}if(t.type==="month"&&t.year===l&&t.month===d)try{await e(o,"month",l,d)}catch($){console.warn("[useUpdateAdjustment] Failed to save current document immediately:",$)}return{updatedMonth:O}},isPending:!1,isError:!1,error:null}}function HP(){const{currentViewingDocument:t}=Ye(),{saveCurrentDocument:e}=xn(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=gr();return{deleteAdjustment:async(o,l,d,h)=>{const m=await Gr(o,l,d);if(!m)throw new Error(`Month not found: ${l}/${d}`);const p=(m.adjustments||[]).filter(b=>b.id!==h),g={...m,adjustments:p,updated_at:new Date().toISOString()};n(o,l,d,g);try{await r(o,l,d)}catch(b){console.warn("[useDeleteAdjustment] Failed to recalculate month and cascade:",b)}if(t.type==="month"&&t.year===l&&t.month===d)try{await e(o,"month",l,d)}catch(b){console.warn("[useDeleteAdjustment] Failed to save current document immediately:",b)}return{updatedMonth:g}},isPending:!1,isError:!1,error:null}}const GP={currentUserId:null,selectedBudgetId:null,currentYear:new Date().getFullYear(),currentMonthNumber:new Date().getMonth()+1,lastActiveTab:"categories",lastSettingsTab:"categories",lastAdminTab:"budget",currentViewingDocument:{type:null},setCurrentViewingDocument:()=>{},setSelectedBudgetId:()=>{},setCurrentYear:()=>{},setCurrentMonthNumber:()=>{},setLastActiveTab:()=>{},setLastSettingsTab:()=>{},setLastAdminTab:()=>{},pageTitle:"Budget",setPageTitle:()=>{},isInitialized:!1,needsFirstBudget:!1,initialDataLoadComplete:!1,goToPreviousMonth:()=>{},goToNextMonth:()=>{},pendingInvites:[],hasPendingInvites:!1,accessibleBudgets:[],isAdmin:!1,isTest:!1,loadAccessibleBudgets:async()=>{},switchToBudget:()=>{},checkBudgetInvite:async()=>null,clearCache:()=>{}},XT=D.createContext(GP);function QP({children:t}){const n=Da().get_current_firebase_user(),[r,i]=D.useState(null),[o,l]=D.useState(new Date().getFullYear()),[d,h]=D.useState(new Date().getMonth()+1),[m,p]=D.useState("categories"),[g,v]=D.useState("categories"),[b,E]=D.useState("budget"),[x,S]=D.useState("Budget"),C=D.useCallback(ce=>{S(we=>we===ce?we:ce)},[]),[T,I]=D.useState({type:null}),[O,U]=D.useState(!1),[$,k]=D.useState(!1),R=Y6(n?.uid||null,n?.email||null),N=R.data&&R.data.budget_ids.length===0,V=Z6(n?.uid||null,R.data||null,{enabled:!!n?.uid&&!!R.data&&N}),H=s3(r,{enabled:!!r&&O}),[j,B]=D.useState(!1);D.useEffect(()=>{if(!H.data){B(!1);return}const{budget:ce,payees:we,months:he}=H.data,Ee=Date.now();Le.setQueryData(ke.budget(r),ce,{updatedAt:Ee}),Le.setQueryData(ke.payees(r),we,{updatedAt:Ee});for(const Ue of he)Le.setQueryData(ke.month(r,Ue.year,Ue.month),{month:Ue},{updatedAt:Ee});B(!0)},[H.data,r]),D.useEffect(()=>{r||B(!1)},[r]);const M=R.data?.permission_flags?.is_admin===!0,Z=R.data?.permission_flags?.is_test===!0,K=V.data?.pendingInvites||[],q=V.data?.budgets||[],W=K.length>0;D.useEffect(()=>{if(!n||O||R.isLoading)return;const ce=R.data;if(!(!ce&&!R.isError))if(ce&&ce.budget_ids.length>0)i(ce.budget_ids[0]),k(!1),U(!0);else{if(V.isLoading)return;const we=V.data;k(!(we?.pendingInvites&&we.pendingInvites.length>0)),U(!0)}},[n,O,R.data,R.isLoading,R.isError,V.data,V.isLoading]);const X=D.useCallback(()=>{d===1?(l(ce=>ce-1),h(12)):h(ce=>ce-1)},[d]),re=D.useCallback(()=>{d===12?(l(ce=>ce+1),h(1)):h(ce=>ce+1)},[d]),z=D.useCallback(async ce=>{(ce?.force||!V.data)&&await V.refetch()},[V]),G=D.useCallback(ce=>{i(ce),k(!1)},[]),te=D.useCallback(async ce=>{if(!n)return null;try{const we=await g4(ce,n.uid);return we&&we.isInvited&&!we.hasAccepted?{budgetId:ce,budgetName:we.budgetName,ownerEmail:we.ownerEmail}:null}catch(we){return console.error("[BudgetContext] Error checking budget invite:",we),null}},[n]),se=D.useCallback(()=>{Le.clear()},[]),ie={currentUserId:n?.uid||null,selectedBudgetId:r,currentYear:o,currentMonthNumber:d,lastActiveTab:m,lastSettingsTab:g,lastAdminTab:b,currentViewingDocument:T,setCurrentViewingDocument:I,setSelectedBudgetId:i,setCurrentYear:l,setCurrentMonthNumber:h,setLastActiveTab:p,setLastSettingsTab:v,setLastAdminTab:E,pageTitle:x,setPageTitle:C,isInitialized:O,needsFirstBudget:$,initialDataLoadComplete:j,goToPreviousMonth:X,goToNextMonth:re,pendingInvites:K,hasPendingInvites:W,accessibleBudgets:q,isAdmin:M,isTest:Z,loadAccessibleBudgets:z,switchToBudget:G,checkBudgetInvite:te,clearCache:se};return u.jsx(XT.Provider,{value:ie,children:t})}function Ye(){const t=D.useContext(XT);if(!t)throw new Error("useBudget must be used within a BudgetProvider");return t}const WP=function(){},KP={is_logged_in:!1,is_auth_checked:!1,username:"",set_user_context:WP},cd=D.createContext(KP);function L1({budget:t,isCurrent:e,isAccepting:n,isSwitching:r,isEditing:i,editName:o,isRenaming:l,onAccept:d,onSwitch:h,onStartEdit:m,onCancelEdit:p,onEditNameChange:g,onSaveEdit:v}){const b=e&&t.isOwner;return u.jsx("div",{style:{background:e?"color-mix(in srgb, #646cff 15%, transparent)":"color-mix(in srgb, currentColor 8%, transparent)",border:e?"2px solid color-mix(in srgb, #646cff 50%, transparent)":"1px solid transparent",padding:"1rem",borderRadius:"8px"},children:i?u.jsxs("form",{onSubmit:v,children:[u.jsx("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"0.5rem"},children:u.jsx("input",{type:"text",value:o,onChange:E=>g(E.target.value),placeholder:"Budget name",autoFocus:!0,style:{flex:1,padding:"0.5rem 0.75rem",borderRadius:"6px",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"1rem",fontWeight:600,color:"inherit"}})}),u.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[u.jsx("button",{type:"submit",disabled:l||!o.trim(),style:{background:"#22c55e",color:"white",border:"none",padding:"0.4rem 0.75rem",borderRadius:"6px",cursor:l||!o.trim()?"not-allowed":"pointer",fontWeight:500,opacity:l||!o.trim()?.7:1,fontSize:"0.8rem"},children:l?"Saving...":"Save"}),u.jsx("button",{type:"button",onClick:p,disabled:l,style:{background:"transparent",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)",padding:"0.4rem 0.75rem",borderRadius:"6px",cursor:l?"not-allowed":"pointer",fontWeight:500,opacity:l?.7:.8,fontSize:"0.8rem"},children:"Cancel"})]})]}):u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem",flexWrap:"wrap"},children:[u.jsxs("div",{style:{flex:1,minWidth:"200px"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flexWrap:"wrap",marginBottom:"0.25rem"},children:[u.jsx("span",{style:{fontWeight:600},children:t.name}),t.isOwner&&u.jsx("span",{style:{background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.65rem",textTransform:"uppercase",fontWeight:600},children:"Owner"}),e&&u.jsx("span",{style:{background:"color-mix(in srgb, #22c55e 20%, transparent)",color:"#4ade80",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.65rem",textTransform:"uppercase",fontWeight:600},children:"Active"}),t.isPending&&u.jsx("span",{style:{background:"color-mix(in srgb, #f59e0b 20%, transparent)",color:"#fbbf24",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.65rem",textTransform:"uppercase",fontWeight:600},children:"Pending"}),b&&u.jsx("button",{onClick:m,style:{background:"transparent",border:"none",padding:"0.15rem",cursor:"pointer",opacity:.5,fontSize:"0.8rem",lineHeight:1},title:"Rename budget",children:""})]}),u.jsx("p",{style:{margin:0,fontSize:"0.8rem",opacity:.6},children:t.ownerEmail?`Owner: ${t.ownerEmail}`:`ID: ${t.id}`})]}),u.jsx("div",{style:{display:"flex",gap:"0.5rem"},children:t.isPending?u.jsx("button",{onClick:d,disabled:n,style:{background:"#22c55e",color:"white",border:"none",padding:"0.5rem 1rem",borderRadius:"6px",cursor:n?"not-allowed":"pointer",fontWeight:500,opacity:n?.7:1,fontSize:"0.85rem"},children:n?"Accepting...":"Accept"}):e?null:u.jsx("button",{onClick:h,disabled:r,style:{background:"#646cff",color:"white",border:"none",padding:"0.5rem 1rem",borderRadius:"6px",cursor:r?"not-allowed":"pointer",fontWeight:500,opacity:r?.7:1,fontSize:"0.85rem"},children:r?"Switching...":"Switch"})})]})})}const Mf={critical_bug:{label:"Critical Bug",color:"#ff4757",bgColor:"rgba(255, 71, 87, 0.15)"},bug:{label:"Bug",color:"#ffa502",bgColor:"rgba(255, 165, 2, 0.15)"},new_feature:{label:"New Feature",color:"#2ed573",bgColor:"rgba(46, 213, 115, 0.15)"},core_feature:{label:"Core Feature",color:"#1e90ff",bgColor:"rgba(30, 144, 255, 0.15)"},qol:{label:"QOL",color:"#a55eea",bgColor:"rgba(165, 94, 234, 0.15)"}};function ZT({type:t,onClick:e}){const n=t==="feature"?"new_feature":t,r=n&&n in Mf?n:"bug",i=Mf[r];return u.jsx("button",{type:"button",onClick:e,style:{padding:"0.25rem 0.5rem",borderRadius:"0.25rem",background:i.bgColor,color:i.color,fontSize:"0.7rem",fontWeight:600,textTransform:"uppercase",letterSpacing:"0.025em",flexShrink:0,border:"none",cursor:"pointer",transition:"opacity 0.15s, transform 0.15s"},onMouseEnter:o=>{o.currentTarget.style.opacity="0.8",o.currentTarget.style.transform="scale(1.05)"},onMouseLeave:o=>{o.currentTarget.style.opacity="1",o.currentTarget.style.transform="scale(1)"},title:"Click to change type",children:i.label})}function YP({item:t,isDragging:e,isDragOver:n,onDragStart:r,onDragOver:i,onDragLeave:o,onDragEnd:l,onDrop:d,onToggleDone:h,onTypeClick:m}){return u.jsxs("div",{onDragOver:p=>{p.stopPropagation(),i(p)},onDragLeave:p=>{p.stopPropagation(),o()},onDrop:p=>{p.stopPropagation(),d(p)},style:{position:"relative"},children:[u.jsx("div",{style:{...D4,opacity:n?1:0,boxShadow:n?"0 0 8px rgba(100, 108, 255, 0.6)":"none"}}),u.jsxs("div",{draggable:!0,onDragStart:r,onDragEnd:l,style:{...F0,cursor:"grab",opacity:e?.5:1,flexDirection:"column",alignItems:"stretch",gap:"0.5rem"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[u.jsx("span",{style:{...k4},children:""}),u.jsx("input",{type:"checkbox",checked:t.is_done,onChange:h,style:{width:"1.25rem",height:"1.25rem",cursor:"pointer",accentColor:me.primary,flexShrink:0}}),u.jsx(ZT,{type:t.feedback_type,onClick:m})]}),u.jsxs("div",{style:{marginLeft:"3.25rem"},children:[u.jsx("p",{style:{margin:0,lineHeight:1.5},children:t.text}),u.jsxs("p",{style:{margin:"0.5rem 0 0 0",fontSize:"0.8rem",opacity:.6},children:[t.user_email,"  ",Iy(t.created_at)]})]})]})]})}function XP({item:t,onToggleDone:e,onTypeClick:n}){return u.jsxs("div",{style:{...F0,opacity:.6,flexDirection:"column",alignItems:"stretch",gap:"0.5rem"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[u.jsx("input",{type:"checkbox",checked:t.is_done,onChange:e,style:{width:"1.25rem",height:"1.25rem",cursor:"pointer",accentColor:me.primary,flexShrink:0}}),u.jsx(ZT,{type:t.feedback_type,onClick:n})]}),u.jsxs("div",{style:{marginLeft:"2rem"},children:[u.jsx("p",{style:{margin:0,lineHeight:1.5,textDecoration:"line-through"},children:t.text}),u.jsxs("p",{style:{margin:"0.5rem 0 0 0",fontSize:"0.8rem",opacity:.8},children:[t.user_email,"  Created: ",Iy(t.created_at)]}),t.completed_at&&u.jsxs("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.8rem",color:me.success},children:[" Completed: ",Iy(t.completed_at)]})]})]})}function Vn({noMargin:t}={}){return u.jsx("span",{style:{display:"inline-block",width:"14px",height:"14px",border:"2px solid rgba(255, 255, 255, 0.3)",borderTopColor:"white",borderRadius:"50%",animation:"spin 0.8s linear infinite",marginRight:t?0:"0.5rem",verticalAlign:"middle"}})}function JT(){const{state:t,closeModal:e}=f3();if(!t.isOpen)return null;const n=t.isComplete;return u.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0, 0, 0, 0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1002,padding:"1rem"},onClick:n?e:void 0,children:u.jsxs("div",{style:{background:"#1a1a1a",color:"rgba(255, 255, 255, 0.87)",borderRadius:"16px",padding:"2rem",width:"32rem",maxWidth:"calc(100vw - 2rem)",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.5)"},onClick:r=>r.stopPropagation(),children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1.5rem"},children:[u.jsxs("h2",{style:{margin:0,fontSize:"1.25rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[!t.isComplete&&u.jsx(Vn,{noMargin:!0}),t.migrationName]}),n&&u.jsx("button",{onClick:e,style:{background:"transparent",border:"none",color:"inherit",cursor:"pointer",fontSize:"1.5rem",opacity:.6,lineHeight:1,padding:"0.25rem"},title:"Close",children:""})]}),u.jsxs("div",{style:{fontSize:"1rem",fontWeight:500,marginBottom:"1rem",color:t.error?"#ef4444":t.isComplete?"#22c55e":"inherit"},children:[t.error?" ":t.isComplete?" ":"",t.stage]}),u.jsx("div",{style:{background:"rgba(255, 255, 255, 0.1)",borderRadius:"8px",height:"12px",overflow:"hidden",marginBottom:"1rem"},children:t.progress!==null?u.jsx("div",{style:{background:t.error?"#ef4444":t.isComplete?"#22c55e":"#646cff",height:"100%",width:`${t.progress}%`,transition:"width 0.3s ease-out",borderRadius:"8px"}}):u.jsx("div",{style:{background:t.error?"#ef4444":"#646cff",height:"100%",width:"30%",borderRadius:"8px",animation:"progressIndeterminate 1.5s ease-in-out infinite"}})}),t.currentItem&&u.jsx("div",{style:{fontSize:"0.9rem",opacity:.8,marginBottom:"0.5rem",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:t.currentItem}),t.details&&u.jsx("div",{style:{fontSize:"0.85rem",opacity:.6,marginBottom:t.error?"1rem":0},children:t.details}),t.error&&u.jsx("div",{style:{background:"rgba(239, 68, 68, 0.1)",border:"1px solid rgba(239, 68, 68, 0.3)",borderRadius:"8px",padding:"0.75rem 1rem",fontSize:"0.9rem",color:"#ef4444"},children:t.error}),t.isComplete&&u.jsx("button",{onClick:e,style:{marginTop:"1.5rem",width:"100%",background:t.error?"rgba(239, 68, 68, 0.2)":"#646cff",color:"white",border:"none",padding:"0.75rem 1.5rem",borderRadius:"8px",cursor:"pointer",fontWeight:500,fontSize:"1rem"},children:t.error?"Close":"Done"}),!t.isComplete&&u.jsx("div",{style:{marginTop:"1rem",fontSize:"0.85rem",opacity:.5,textAlign:"center"},children:"Please wait  do not close this window"}),u.jsx("style",{children:`
            @keyframes progressIndeterminate {
              0% { transform: translateX(-100%); }
              100% { transform: translateX(400%); }
            }
          `})]})})}function xo({isOpen:t,onClose:e,onConfirm:n,migrationName:r,isDestructive:i=!1,onDownloadBackup:o,isDownloading:l=!1}){const[d,h]=D.useState(!1),m=D.useCallback(async()=>{o&&(await o(),h(!0))},[o]),p=D.useCallback(()=>{n(d?"downloaded":"already-have")},[d,n]),g=D.useCallback(()=>{n("cancelled"),e()},[n,e]);return u.jsxs(ls,{isOpen:t,onClose:g,title:" Backup Recommended",children:[u.jsx("div",{style:{background:i?"color-mix(in srgb, #ef4444 15%, transparent)":"color-mix(in srgb, #f59e0b 15%, transparent)",border:`1px solid ${i?"color-mix(in srgb, #ef4444 40%, transparent)":"color-mix(in srgb, #f59e0b 40%, transparent)"}`,borderRadius:"8px",padding:"1rem",marginBottom:"1rem"},children:u.jsx("p",{style:{margin:0,color:i?"#fca5a5":"#fcd34d",fontWeight:500,fontSize:"0.95rem"},children:i?" This migration modifies your data. A backup is strongly recommended!":" Before running migrations, we recommend having a recent backup."})}),u.jsxs("p",{style:{margin:"0 0 0.75rem",opacity:.9},children:["You are about to run: ",u.jsx("strong",{children:r})]}),u.jsx("p",{style:{margin:"0 0 1rem",opacity:.8,fontSize:"0.9rem"},children:"Please ensure you have a recent backup of your data. You can download a diagnostic backup that includes all your budget and month data."}),o&&u.jsx("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",padding:"1rem",marginBottom:"1rem"},children:u.jsx(Ve,{variant:"secondary",onClick:m,disabled:l,actionName:"Download Backup Before Migration",style:{width:"100%"},children:l?u.jsxs(u.Fragment,{children:[u.jsx(Vn,{noMargin:!0})," Downloading Backup..."]}):d?" Backup Downloaded":" Download Backup Now"})}),u.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[u.jsx(Ve,{variant:"secondary",actionName:"Cancel Migration",onClick:g,children:"Cancel"}),u.jsx(Ve,{variant:i?"danger":"primary",actionName:`Proceed with ${r}`,onClick:p,disabled:l,children:d?" Proceed with Migration":" I Have a Backup - Proceed"})]})]})}function wo({migrationName:t,isDestructive:e=!1,onDownloadBackup:n}){const[r,i]=D.useState(!1),[o,l]=D.useState(!1),[d,h]=D.useState(null),m=D.useCallback(b=>{h(()=>b),i(!0)},[]),p=D.useCallback(b=>{b!=="cancelled"&&d&&d(),h(null),i(!1)},[d]),g=D.useCallback(()=>{h(null),i(!1)},[]),v=D.useCallback(async()=>{if(n){l(!0);try{await n()}finally{l(!1)}}},[n]);return{promptBeforeAction:m,promptProps:{isOpen:r,onClose:g,onConfirm:p,migrationName:t,isDestructive:e,onDownloadBackup:n?v:void 0,isDownloading:o}}}const ZP={onetime:{borderColor:"color-mix(in srgb, #a855f7 30%, transparent)",iconBg:"color-mix(in srgb, #a855f7 15%, transparent)",headerBg:"color-mix(in srgb, #a855f7 8%, transparent)"},maintenance:{borderColor:"color-mix(in srgb, #3b82f6 30%, transparent)",iconBg:"color-mix(in srgb, #3b82f6 15%, transparent)",headerBg:"color-mix(in srgb, #3b82f6 8%, transparent)"},utility:{borderColor:"color-mix(in srgb, #22c55e 30%, transparent)",iconBg:"color-mix(in srgb, #22c55e 15%, transparent)",headerBg:"color-mix(in srgb, #22c55e 8%, transparent)"}};function Q0({title:t,icon:e,description:n,type:r,children:i,onValidateAll:o,isValidating:l=!1,isAnyRunning:d=!1}){const h=ZP[r],m=l||d,p=()=>{o&&!m&&o()};return u.jsxs("section",{style:{background:"color-mix(in srgb, currentColor 3%, transparent)",border:`1px solid ${h.borderColor}`,borderRadius:"12px",marginBottom:"1.5rem",overflow:"hidden"},children:[u.jsxs("div",{style:{background:h.headerBg,padding:"1.25rem 1.5rem",borderBottom:`2px solid ${h.borderColor}`,display:"flex",justifyContent:"space-between",alignItems:"flex-start",gap:"1rem"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"0.875rem",flex:1},children:[u.jsx("span",{style:{fontSize:"1.75rem",background:h.iconBg,padding:"0.625rem",borderRadius:"10px",lineHeight:1,display:"flex",alignItems:"center",justifyContent:"center",minWidth:"48px",minHeight:"48px"},children:e}),u.jsxs("div",{children:[u.jsx("h3",{style:{margin:"0 0 0.375rem 0",fontSize:"1.25rem",fontWeight:600,letterSpacing:"-0.01em"},children:t}),u.jsx("p",{style:{margin:0,opacity:.75,fontSize:"0.9rem",lineHeight:1.4},children:n})]})]}),o&&u.jsx("button",{onClick:p,disabled:m,style:{background:"color-mix(in srgb, #3b82f6 20%, transparent)",color:"#60a5fa",border:"1px solid color-mix(in srgb, #3b82f6 40%, transparent)",padding:"0.5rem 1rem",borderRadius:"6px",cursor:m?"not-allowed":"pointer",fontWeight:500,fontSize:"0.85rem",opacity:m?.6:1,display:"flex",alignItems:"center",gap:"0.4rem",flexShrink:0},children:l?u.jsxs(u.Fragment,{children:[u.jsx(Vn,{noMargin:!0})," Validating..."]}):" Validate All"})]}),u.jsx("div",{style:{padding:"0.75rem",background:"color-mix(in srgb, currentColor 1%, transparent)"},children:i})]})}const JP={unknown:{color:"#9ca3af",icon:"",text:"Unknown"},clean:{color:"#22c55e",icon:"",text:"Clean"},"needs-action":{color:"#f59e0b",icon:"",text:"Needs Action"},running:{color:"#60a5fa",icon:"",text:"Running"},complete:{color:"#22c55e",icon:"",text:"Complete"},error:{color:"#ef4444",icon:"",text:"Error"}};function W0({name:t,description:e,status:n,statusText:r,onCheck:i,isChecking:o,onRun:l,isRunning:d=!1,actionText:h="Run",disabled:m=!1,itemCount:p,details:g,isDestructive:v=!1}){const[b,E]=D.useState(!1),x=JP[n],S=r||x.text,C=m||d||o,T=()=>{i()},I=()=>{l&&l()},O=()=>{g&&E(!b)};return u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"8px",margin:"0.25rem 0",overflow:"hidden"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"0.75rem 1rem",gap:"1rem"},children:[u.jsx("div",{style:{width:"28px",height:"28px",borderRadius:"50%",background:`color-mix(in srgb, ${x.color} 20%, transparent)`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.85rem",flexShrink:0},children:d||o?u.jsx(Vn,{noMargin:!0}):x.icon}),u.jsxs("div",{style:{flex:1,minWidth:0},children:[u.jsx("div",{style:{fontWeight:500,fontSize:"0.95rem",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:t}),u.jsx("div",{style:{fontSize:"0.8rem",opacity:.6,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:e})]}),u.jsxs("div",{style:{color:x.color,fontSize:"0.8rem",fontWeight:500,display:"flex",alignItems:"center",gap:"0.25rem",flexShrink:0},children:[S,p!==void 0&&p>0&&u.jsx("span",{style:{background:`color-mix(in srgb, ${x.color} 20%, transparent)`,padding:"0.15rem 0.4rem",borderRadius:"4px",fontSize:"0.75rem"},children:p})]}),u.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:[u.jsx("button",{onClick:T,disabled:C,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",padding:"0.35rem 0.6rem",borderRadius:"4px",cursor:C?"not-allowed":"pointer",fontSize:"0.8rem",opacity:C?.5:1,display:"flex",alignItems:"center",gap:"0.25rem"},title:"Check status",children:o?u.jsx(Vn,{noMargin:!0}):""}),l&&n==="needs-action"&&u.jsx("button",{onClick:I,disabled:C,style:{background:v?"#ef4444":"#646cff",color:"white",border:"none",padding:"0.35rem 0.75rem",borderRadius:"4px",cursor:C?"not-allowed":"pointer",fontSize:"0.8rem",fontWeight:500,opacity:C?.6:1,display:"flex",alignItems:"center",gap:"0.25rem"},children:d?u.jsx(Vn,{noMargin:!0}):h}),g&&u.jsx("button",{onClick:O,style:{background:"transparent",color:"inherit",border:"none",padding:"0.35rem",borderRadius:"4px",cursor:"pointer",fontSize:"0.9rem",opacity:.6},title:b?"Collapse details":"Expand details",children:b?"":""})]})]}),b&&g&&u.jsx("div",{style:{borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)",padding:"1rem",background:"color-mix(in srgb, currentColor 2%, transparent)"},children:g})]})}function eB({name:t,description:e,onAction:n,actionText:r,actionIcon:i,isRunning:o=!1,disabled:l=!1,progress:d,error:h,isDestructive:m=!1}){const p=l||o,g=()=>{n()};return u.jsx("div",{style:{background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"8px",margin:"0.25rem 0",padding:"0.75rem 1rem"},children:u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},children:[u.jsxs("div",{style:{flex:1,minWidth:0},children:[u.jsx("div",{style:{fontWeight:500,fontSize:"0.95rem",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:t}),u.jsx("div",{style:{fontSize:"0.8rem",opacity:.6,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:e}),h&&u.jsx("div",{style:{fontSize:"0.8rem",color:"#ef4444",marginTop:"0.25rem"},children:h})]}),d!==void 0&&o&&u.jsxs("div",{style:{width:"100px",flexShrink:0},children:[u.jsx("div",{style:{background:"rgba(255, 255, 255, 0.1)",borderRadius:"4px",height:"6px",overflow:"hidden"},children:u.jsx("div",{style:{background:m?"#ef4444":"#646cff",height:"100%",width:`${d}%`,transition:"width 0.3s"}})}),u.jsxs("div",{style:{fontSize:"0.7rem",opacity:.6,textAlign:"center",marginTop:"0.15rem"},children:[d,"%"]})]}),u.jsx("button",{onClick:g,disabled:p,style:{background:m?"#ef4444":"#646cff",color:"white",border:"none",padding:"0.5rem 1rem",borderRadius:"6px",cursor:p?"not-allowed":"pointer",fontSize:"0.85rem",fontWeight:500,opacity:p?.6:1,display:"flex",alignItems:"center",gap:"0.4rem",flexShrink:0},children:o?u.jsxs(u.Fragment,{children:[u.jsx(Vn,{noMargin:!0})," Running..."]}):u.jsxs(u.Fragment,{children:[i&&u.jsx("span",{children:i}),r]})})]})})}function tB({disabled:t,onDownloadBackup:e,isDownloadingBackup:n}){return u.jsx(u.Fragment,{children:u.jsx(Q0,{title:"One-Time Migrations",icon:"",description:"Migrations that typically only need to be run once. Check status first, then apply if needed.",type:"onetime",isAnyRunning:!1,children:null})})}const eA={unknown:{color:"#9ca3af",icon:""},clean:{color:"#22c55e",icon:""},"needs-action":{color:"#f59e0b",icon:""},running:{color:"#60a5fa",icon:""},complete:{color:"#22c55e",icon:""},error:{color:"#ef4444",icon:""}};function nB({check:t,disabled:e}){const n=eA[t.status],r=e||t.isRunning||t.isChecking;return u.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"0.5rem 0.75rem",gap:"0.75rem",borderRadius:"6px",background:"color-mix(in srgb, currentColor 3%, transparent)",marginBottom:"0.25rem"},children:[u.jsx("div",{style:{width:"20px",height:"20px",borderRadius:"50%",background:`color-mix(in srgb, ${n.color} 20%, transparent)`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.7rem",flexShrink:0},children:t.isRunning||t.isChecking?u.jsx(Vn,{noMargin:!0}):n.icon}),u.jsxs("div",{style:{flex:1,minWidth:0},children:[u.jsxs("div",{style:{fontWeight:500,fontSize:"0.85rem"},children:[t.name,t.issueCount>0&&u.jsxs("span",{style:{marginLeft:"0.5rem",color:n.color,fontSize:"0.75rem"},children:["(",t.issueCount,")"]})]}),u.jsx("div",{style:{fontSize:"0.75rem",opacity:.6},children:t.description}),t.details]}),u.jsxs("div",{style:{display:"flex",gap:"0.35rem",flexShrink:0},children:[u.jsx("button",{onClick:()=>{`${t.name}`,t.onCheck()},disabled:r,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",padding:"0.25rem 0.4rem",borderRadius:"4px",cursor:r?"not-allowed":"pointer",fontSize:"0.7rem",opacity:r?.5:1},title:"Check",children:t.isChecking?u.jsx(Vn,{noMargin:!0}):""}),t.canFix&&t.onFix&&u.jsx("button",{onClick:()=>{`${t.name}`,t.onFix()},disabled:r,style:{background:"#646cff",color:"white",border:"none",padding:"0.25rem 0.5rem",borderRadius:"4px",cursor:r?"not-allowed":"pointer",fontSize:"0.7rem",fontWeight:500,opacity:r?.6:1},children:t.isRunning?u.jsx(Vn,{noMargin:!0}):"Fix"})]})]})}function rB({accountCategoryValidation:t,orphanedIdCleanup:e,expenseToAdjustment:n,adjustmentsToTransfers:r,needsAction:i,totalIssues:o,isScanning:l,isRunning:d,disabled:h,onRunOrphaned:m,onRunExpense:p,onRunTransfers:g}){const[v,b]=D.useState(!1),x=d?"running":t.hasData&&e.hasData&&n.hasData&&r.hasData?i?"needs-action":"clean":"unknown",S=eA[x],C=[{id:"validation",name:"Account/Category Validation",status:t.isScanning?"running":t.hasData?t.hasViolations?"needs-action":"clean":"unknown",issueCount:t.violationCount,description:"Validates all transactions have proper account/category combinations",canFix:!1,onCheck:()=>t.scan(),isChecking:t.isScanning,isRunning:!1,details:t.hasViolations&&t.status&&u.jsxs("div",{style:{fontSize:"0.8rem",opacity:.8},children:[t.status.violations.filter(O=>O.transactionType==="income").length>0&&u.jsxs("span",{children:["Income: ",t.status.violations.filter(O=>O.transactionType==="income").length," "]}),t.status.violations.filter(O=>O.transactionType==="expense").length>0&&u.jsxs("span",{children:["Expenses: ",t.status.violations.filter(O=>O.transactionType==="expense").length," "]}),t.status.violations.filter(O=>O.transactionType==="adjustment").length>0&&u.jsxs("span",{children:["Adjustments: ",t.status.violations.filter(O=>O.transactionType==="adjustment").length," "]}),t.status.violations.filter(O=>O.transactionType==="transfer").length>0&&u.jsxs("span",{children:["Transfers: ",t.status.violations.filter(O=>O.transactionType==="transfer").length]})]})},{id:"orphaned",name:"Orphaned ID Cleanup",status:Hg(e),issueCount:e.totalOrphaned,description:"Finds transactions with deleted/invalid account/category IDs",canFix:e.hasItemsToFix,onCheck:e.scanStatus,onFix:m,isChecking:e.isScanning,isRunning:e.isRunning,details:e.hasItemsToFix&&e.status&&u.jsxs("div",{style:{fontSize:"0.8rem",opacity:.8},children:[e.status.orphanedCategoryIds>0&&u.jsxs("span",{children:["Categories: ",e.status.orphanedCategoryIds," "]}),e.status.orphanedAccountIds>0&&u.jsxs("span",{children:["Accounts: ",e.status.orphanedAccountIds]})]})},{id:"expense",name:"Expense  Adjustment",status:Hg(n,"hasItemsToMigrate"),issueCount:n.totalToMigrate,description:"Moves expenses without account/category to adjustments",canFix:n.hasItemsToMigrate,onCheck:n.scanStatus,onFix:p,isChecking:n.isScanning,isRunning:n.isRunning,details:n.hasItemsToMigrate&&n.status&&u.jsxs("div",{style:{fontSize:"0.8rem",opacity:.8},children:[n.status.expensesToMigrate," expense(s) with No Account or No Category"]})},{id:"transfers",name:"Adjustment  Transfers",status:Hg(r,"hasPairsToConvert"),issueCount:r.totalPairs,description:"Converts opposite adjustment pairs to transfers",canFix:r.hasPairsToConvert,onCheck:r.scanStatus,onFix:g,isChecking:r.isScanning,isRunning:r.isRunning,details:r.hasPairsToConvert&&r.status&&u.jsxs("div",{style:{fontSize:"0.8rem",opacity:.8},children:[r.status.accountTransferPairs>0&&u.jsxs("span",{children:["Account transfers: ",r.status.accountTransferPairs," "]}),r.status.categoryTransferPairs>0&&u.jsxs("span",{children:["Category transfers: ",r.status.categoryTransferPairs]})]})}],T=h||d||l,I=()=>{C.forEach(O=>O.onCheck())};return u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"8px",margin:"0.25rem 0",overflow:"hidden"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"0.75rem 1rem",gap:"1rem"},children:[u.jsx("div",{style:{width:"28px",height:"28px",borderRadius:"50%",background:`color-mix(in srgb, ${S.color} 20%, transparent)`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.85rem",flexShrink:0},children:d||l?u.jsx(Vn,{noMargin:!0}):S.icon}),u.jsxs("div",{style:{flex:1,minWidth:0},children:[u.jsx("div",{style:{fontWeight:500,fontSize:"0.95rem",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:"Transaction Type Audit"}),u.jsx("div",{style:{fontSize:"0.8rem",opacity:.6,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:"Validates account/category assignments and fixes invalid transactions"})]}),u.jsxs("div",{style:{color:S.color,fontSize:"0.8rem",fontWeight:500,display:"flex",alignItems:"center",gap:"0.25rem",flexShrink:0},children:[x==="unknown"?"Unknown":x==="clean"?"Clean":x==="running"?"Running":"Needs Action",o>0&&u.jsx("span",{style:{background:`color-mix(in srgb, ${S.color} 20%, transparent)`,padding:"0.15rem 0.4rem",borderRadius:"4px",fontSize:"0.75rem"},children:o})]}),u.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:[u.jsx("button",{onClick:I,disabled:T,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",padding:"0.35rem 0.6rem",borderRadius:"4px",cursor:T?"not-allowed":"pointer",fontSize:"0.8rem",opacity:T?.5:1,display:"flex",alignItems:"center",gap:"0.25rem"},title:"Check all",children:l?u.jsx(Vn,{noMargin:!0}):""}),u.jsx("button",{onClick:()=>b(!v),style:{background:"transparent",color:"inherit",border:"none",padding:"0.35rem",borderRadius:"4px",cursor:"pointer",fontSize:"0.9rem",opacity:.6},title:v?"Collapse":"Expand",children:v?"":""})]})]}),v&&u.jsx("div",{style:{borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)",padding:"0.5rem",background:"color-mix(in srgb, currentColor 2%, transparent)"},children:C.map(O=>u.jsx(nB,{check:O,disabled:h},O.id))})]})}function Hg(t,e="hasItemsToFix"){return t.isRunning?"running":t.result&&t.result.errors.length===0?"complete":t.isScanning?"running":t.hasData?t[e]?"needs-action":"clean":"unknown"}function sB({status:t,hasData:e,hasIssues:n,totalIssues:r,isChecking:i,isRunning:o,result:l,onCheck:d,onRun:h,disabled:m}){const p=()=>o?"running":e?l&&l.errors.length===0?"complete":l&&l.errors.length>0?"error":n?"needs-action":"clean":"unknown",g=()=>{if(l&&l.errors.length===0){const b=l.accountsFixed+l.categoriesFixed+l.totalAvailableFixed+l.incomeValuesFixed+l.expenseValuesFixed+l.categoryBalancesFixed+l.accountBalancesFixed;return b>0?`Fixed ${b}`:"Complete"}},v=()=>{if(l){const b=l.accountsFixed+l.categoriesFixed+l.totalAvailableFixed+l.incomeValuesFixed+l.expenseValuesFixed+l.categoryBalancesFixed+l.accountBalancesFixed;return u.jsxs("div",{style:{fontSize:"0.85rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem",fontWeight:500},children:l.errors.length>0?" Completed with errors":" Cleanup complete"}),u.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[l.budgetsProcessed>0&&u.jsxs("li",{children:[l.budgetsProcessed," budget(s) updated"]}),l.accountsFixed>0&&u.jsxs("li",{children:[l.accountsFixed," account balance(s) fixed"]}),l.categoriesFixed>0&&u.jsxs("li",{children:[l.categoriesFixed," category value(s) fixed"]}),l.totalAvailableFixed>0&&u.jsxs("li",{children:[l.totalAvailableFixed," total_available value(s) fixed"]}),l.monthsProcessed>0&&u.jsxs("li",{children:[l.monthsProcessed," month(s) updated"]}),l.incomeValuesFixed>0&&u.jsxs("li",{children:[l.incomeValuesFixed," income amount(s) fixed"]}),l.expenseValuesFixed>0&&u.jsxs("li",{children:[l.expenseValuesFixed," expense amount(s) fixed"]}),l.categoryBalancesFixed>0&&u.jsxs("li",{children:[l.categoryBalancesFixed," category balance(s) fixed"]}),l.accountBalancesFixed>0&&u.jsxs("li",{children:[l.accountBalancesFixed," account balance(s) fixed"]}),b===0&&u.jsx("li",{children:"No changes needed"})]}),l.errors.length>0&&u.jsxs("div",{style:{marginTop:"0.5rem",color:"#ef4444"},children:[u.jsxs("div",{children:["Errors (",l.errors.length,"):"]}),u.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1.25rem"},children:[l.errors.slice(0,3).map((E,x)=>u.jsx("li",{children:E},x)),l.errors.length>3&&u.jsxs("li",{children:["...and ",l.errors.length-3," more"]})]})]})]})}return e?n?u.jsxs("div",{style:{fontSize:"0.85rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem",color:"#fbbf24"},children:"Precision issues found:"}),u.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[t.budgetsWithPrecisionIssues>0&&u.jsxs("li",{children:[t.budgetsWithPrecisionIssues," budget(s) with issues:",u.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1rem",opacity:.8},children:[t.accountsWithPrecisionIssues>0&&u.jsxs("li",{children:[t.accountsWithPrecisionIssues," account balance(s)"]}),t.categoriesWithPrecisionIssues>0&&u.jsxs("li",{children:[t.categoriesWithPrecisionIssues," category value(s)"]}),t.totalAvailableWithPrecisionIssues>0&&u.jsxs("li",{children:[t.totalAvailableWithPrecisionIssues," total_available value(s)"]})]})]}),t.monthsWithPrecisionIssues>0&&u.jsxs("li",{children:[t.monthsWithPrecisionIssues," month(s) with issues:",u.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1rem",opacity:.8},children:[t.incomeValuesWithPrecisionIssues>0&&u.jsxs("li",{children:[t.incomeValuesWithPrecisionIssues," income amount(s)"]}),t.expenseValuesWithPrecisionIssues>0&&u.jsxs("li",{children:[t.expenseValuesWithPrecisionIssues," expense amount(s)"]}),t.categoryBalancesWithPrecisionIssues>0&&u.jsxs("li",{children:[t.categoryBalancesWithPrecisionIssues," category balance(s)"]}),t.accountBalancesWithPrecisionIssues>0&&u.jsxs("li",{children:[t.accountBalancesWithPrecisionIssues," account balance(s)"]})]})]})]}),u.jsxs("div",{style:{marginTop:"0.5rem",opacity:.6},children:["Scanned ",t.totalBudgets," budget(s) and ",t.totalMonths," month(s)."]})]}):u.jsxs("div",{style:{fontSize:"0.85rem"},children:[" All currency values have proper precision (2 decimal places).",u.jsxs("div",{style:{marginTop:"0.25rem",opacity:.6},children:["Scanned ",t.totalBudgets," budget(s) and ",t.totalMonths," month(s)."]})]}):u.jsx("div",{style:{fontSize:"0.85rem",opacity:.7},children:"Click check to scan for precision issues."})};return u.jsx(W0,{name:"Currency Precision",description:"Fixes floating-point precision by rounding all values to 2 decimal places",status:p(),statusText:g(),onCheck:d,isChecking:i,onRun:h,isRunning:o,actionText:`Fix ${r}`,disabled:m,itemCount:n?r:void 0,details:v(),isDestructive:!0})}function iB({disabled:t,onDownloadBackup:e,isDownloadingBackup:n,accountCategoryValidation:r,orphanedIdCleanup:i,expenseToAdjustment:o,adjustmentsToTransfers:l,precisionCleanup:d}){const h=r.isScanning||i.isScanning||o.isScanning||l.isScanning||d.isScanning,m=i.isRunning||o.isRunning||l.isRunning||d.isRunning,p=async()=>{await Promise.all([r.scan(),i.scanStatus(),o.scanStatus(),l.scanStatus(),d.scan()])},g=wo({migrationName:"Orphaned ID Cleanup",isDestructive:!0,onDownloadBackup:e}),v=wo({migrationName:"Expense to Adjustment Migration",isDestructive:!0,onDownloadBackup:e}),b=wo({migrationName:"Adjustments to Transfers Migration",isDestructive:!0,onDownloadBackup:e}),E=wo({migrationName:"Currency Precision Cleanup",isDestructive:!0,onDownloadBackup:e}),x=r.hasViolations||i.hasItemsToFix||o.hasItemsToMigrate||l.hasPairsToConvert,S=(r.violationCount||0)+(i.totalOrphaned||0)+(o.totalToMigrate||0)+(l.totalPairs||0);return u.jsxs(u.Fragment,{children:[u.jsxs(Q0,{title:"Maintenance",icon:"",description:"Re-runnable database validation scripts. Validate all to see which need resolution.",type:"maintenance",onValidateAll:p,isValidating:h,isAnyRunning:m,children:[u.jsx(rB,{accountCategoryValidation:r,orphanedIdCleanup:i,expenseToAdjustment:o,adjustmentsToTransfers:l,needsAction:x,totalIssues:S,isScanning:r.isScanning||i.isScanning||o.isScanning||l.isScanning,isRunning:i.isRunning||o.isRunning||l.isRunning,disabled:t,onRunOrphaned:()=>g.promptBeforeAction(i.runMigration),onRunExpense:()=>v.promptBeforeAction(o.runMigration),onRunTransfers:()=>b.promptBeforeAction(l.runMigration)}),u.jsx(sB,{status:d.status,hasData:d.hasData,hasIssues:d.hasIssues,totalIssues:d.totalIssues,isChecking:d.isScanning,isRunning:d.isRunning,result:d.result,onCheck:d.scan,onRun:()=>E.promptBeforeAction(d.runCleanup),disabled:t})]}),u.jsx(xo,{...g.promptProps,isDownloading:n}),u.jsx(xo,{...v.promptProps,isDownloading:n}),u.jsx(xo,{...b.promptProps,isDownloading:n}),u.jsx(xo,{...E.promptProps,isDownloading:n})]})}function aB({isDownloading:t,downloadProgress:e,downloadError:n,onDownload:r,isScanning:i,isUploading:o,uploadStatus:l,uploadProgress:d,uploadError:h,uploadResult:m,onScan:p,onUpload:g,disabled:v}){const b=D.useRef(null),[E,x]=D.useState(null),[S,C]=D.useState(!1),T=async H=>{const j=H.target.files?.[0];j&&(x(j),await p(j))},I=l!==null,O=I&&(l.budgetsFound>0||l.monthsFound>0),U=v||t||i||o,$=m?.success?"#22c55e":O?"#f59e0b":I?"#22c55e":"#9ca3af",k=m?.success?"":o||i||t?"":O?"":I?"":"",R=m?.success?"Uploaded":o?"Uploading":i?"Scanning":t?"Downloading":O?`${l.budgetsFound} budget(s), ${l.monthsFound} month(s) ready`:I?"Nothing to upload":"Select file",N=t?e?.percentComplete:d?.percentComplete,V=n||h;return u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"8px",margin:"0.25rem 0",overflow:"hidden"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"0.75rem 1rem",gap:"1rem"},children:[u.jsx("div",{style:{width:"28px",height:"28px",borderRadius:"50%",background:`color-mix(in srgb, ${$} 20%, transparent)`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.85rem",flexShrink:0},children:o||i||t?u.jsx(Vn,{noMargin:!0}):k}),u.jsxs("div",{style:{flex:1,minWidth:0},children:[u.jsx("div",{style:{fontWeight:500,fontSize:"0.95rem",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:" Budget Backup & Restore"}),u.jsx("div",{style:{fontSize:"0.8rem",opacity:.6,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:"Download selected budget as zip or restore from zip file"})]}),u.jsx("div",{style:{color:$,fontSize:"0.8rem",fontWeight:500,flexShrink:0},children:R}),u.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:[u.jsx("button",{onClick:()=>{r()},disabled:U,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",padding:"0.35rem 0.6rem",borderRadius:"4px",cursor:U?"not-allowed":"pointer",fontSize:"0.8rem",opacity:U?.5:1,display:"flex",alignItems:"center",gap:"0.25rem"},title:"Download all budgets as zip",children:t?u.jsx(Vn,{noMargin:!0}):""}),u.jsx("input",{ref:b,type:"file",accept:".zip",onChange:T,style:{display:"none"}}),u.jsx("button",{onClick:()=>b.current?.click(),disabled:U,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",padding:"0.35rem 0.6rem",borderRadius:"4px",cursor:U?"not-allowed":"pointer",fontSize:"0.8rem",opacity:U?.5:1,display:"flex",alignItems:"center",gap:"0.25rem"},title:"Select zip file to restore",children:i?u.jsx(Vn,{noMargin:!0}):""}),O&&E&&u.jsx("button",{onClick:async()=>{await g(E)},disabled:U,style:{background:"#646cff",color:"white",border:"none",padding:"0.35rem 0.75rem",borderRadius:"4px",cursor:U?"not-allowed":"pointer",fontSize:"0.8rem",fontWeight:500,opacity:U?.6:1,display:"flex",alignItems:"center",gap:"0.25rem"},children:o?u.jsx(Vn,{noMargin:!0}):"Upload"}),(I||m||V)&&u.jsx("button",{onClick:()=>C(!S),style:{background:"transparent",color:"inherit",border:"none",padding:"0.35rem",borderRadius:"4px",cursor:"pointer",fontSize:"0.9rem",opacity:.6},title:S?"Collapse":"Expand",children:S?"":""})]})]}),(t||o)&&N!==void 0&&u.jsxs("div",{style:{padding:"0 1rem 0.5rem 1rem"},children:[u.jsx("div",{style:{width:"100%",height:"4px",background:"color-mix(in srgb, currentColor 10%, transparent)",borderRadius:"2px",overflow:"hidden"},children:u.jsx("div",{style:{width:`${N}%`,height:"100%",background:"#646cff",transition:"width 0.3s ease"}})}),u.jsxs("div",{style:{fontSize:"0.75rem",opacity:.6,marginTop:"0.25rem",textAlign:"center"},children:[t?e?.phase:d?.phase,": ",N,"%"]})]}),S&&(I||m||V)&&u.jsxs("div",{style:{borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)",padding:"1rem",background:"color-mix(in srgb, currentColor 2%, transparent)",fontSize:"0.85rem"},children:[V&&u.jsxs("div",{style:{marginBottom:"0.75rem",color:"#ef4444"},children:[" Error: ",V]}),m&&u.jsx("div",{style:{marginBottom:l?"0.75rem":0,color:m.success?"#22c55e":"#ef4444"},children:m.success?u.jsxs(u.Fragment,{children:[" Restored ",m.budgetsRestored," budget(s), ",m.monthsRestored," month(s), ",m.payeesRestored," payee doc(s)"]}):u.jsxs(u.Fragment,{children:[" Upload failed: ",m.errors.join(", ")]})}),l&&u.jsxs(u.Fragment,{children:[u.jsxs("div",{style:{marginBottom:"0.25rem"},children:[u.jsx("strong",{children:"Found in zip:"})," ",l.budgetsFound," budget(s), ",l.monthsFound," month(s), ",l.payeesFound," payee doc(s)"]}),l.budgetsToRestore.length>0&&u.jsxs("div",{children:[u.jsx("strong",{children:"Budgets to restore:"})," ",l.budgetsToRestore.join(", ")]})]})]})]})}function oB({hasData:t,monthsCount:e,budgetCount:n,isChecking:r,isDeleting:i,deleteResult:o,onCheck:l,onDelete:d,disabled:h}){const[m,p]=D.useState(!1),g=()=>i?"running":t?o&&o.errors.length===0?"complete":e===0?"clean":"needs-action":"unknown",v=()=>o&&o.errors.length===0?`Deleted ${o.deleted}`:e===0?"No months":`${e} months`,b=()=>{p(!0)},E=()=>{p(!1),d()},x=()=>o?u.jsxs("div",{style:{fontSize:"0.85rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem",fontWeight:500},children:o.errors.length>0?" Completed with errors":" Deletion complete"}),u.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[u.jsxs("li",{children:[o.deleted," month(s) deleted"]}),o.budgetsRecalculated>0&&u.jsxs("li",{children:[o.budgetsRecalculated," budget(s) reset"]})]}),o.errors.length>0&&u.jsxs("div",{style:{marginTop:"0.5rem",color:"#ef4444"},children:[u.jsxs("div",{children:["Errors (",o.errors.length,"):"]}),u.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1.25rem"},children:[o.errors.slice(0,3).map((S,C)=>u.jsx("li",{children:S},C)),o.errors.length>3&&u.jsxs("li",{children:["...and ",o.errors.length-3," more"]})]})]})]}):t?e===0?u.jsx("div",{style:{fontSize:"0.85rem"},children:" No month documents found in Firebase."}):u.jsxs("div",{style:{fontSize:"0.85rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem",color:"#ef4444"},children:" DESTRUCTIVE ACTION"}),u.jsxs("div",{children:["Found ",e," month(s) across ",n," budget(s)."]}),u.jsx("div",{style:{marginTop:"0.5rem",opacity:.7},children:"This will permanently delete ALL month documents and reset all budgets."})]}):u.jsx("div",{style:{fontSize:"0.85rem",opacity:.7},children:"Click check to scan for months."});return u.jsxs(u.Fragment,{children:[u.jsx(W0,{name:"Delete ALL Months",description:"DESTRUCTIVE: Deletes all month documents from all budgets",status:g(),statusText:v(),onCheck:l,isChecking:r,onRun:e>0?b:void 0,isRunning:i,actionText:"Delete",disabled:h,itemCount:e>0?e:void 0,details:x(),isDestructive:!0}),u.jsxs(ls,{isOpen:m,onClose:()=>p(!1),title:" Delete All Months?",children:[u.jsx("div",{style:{background:"color-mix(in srgb, #ef4444 15%, transparent)",border:"1px solid color-mix(in srgb, #ef4444 40%, transparent)",borderRadius:"8px",padding:"1rem",marginBottom:"1rem"},children:u.jsx("p",{style:{margin:0,color:"#fca5a5",fontWeight:500,fontSize:"0.95rem"},children:" This is a destructive operation that cannot be undone!"})}),u.jsxs("p",{style:{margin:"0 0 0.75rem",opacity:.9},children:["This will permanently delete ",u.jsxs("strong",{style:{color:"#ef4444"},children:[e," month(s)"]})," across"," ",u.jsxs("strong",{style:{color:"#ef4444"},children:[n," budget(s)"]}),"."]}),u.jsxs("ul",{style:{margin:"0 0 1.5rem",paddingLeft:"1.5rem",opacity:.8,fontSize:"0.9rem"},children:[u.jsx("li",{children:"All account balances  $0"}),u.jsx("li",{children:"All category balances  $0"}),u.jsx("li",{children:"Month history cleared"})]}),u.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[u.jsx(Ve,{variant:"secondary",actionName:"Cancel Delete All Months",onClick:()=>p(!1),children:"Cancel"}),u.jsxs(Ve,{variant:"danger",actionName:"Confirm Delete All Months",onClick:E,children:[" Delete All ",e," Months"]})]})]})]})}function lB({status:t,hasData:e,totalBudgets:n,totalMonths:r,isChecking:i,isDeleting:o,deleteResult:l,onCheck:d,onDelete:h,disabled:m}){const[p,g]=D.useState(!1),v=t?.staleBudgetIds??[],b=v.length>0,E=()=>o?"running":e?l&&l.errors.length===0?"complete":n===0&&!b?"clean":"needs-action":"unknown",x=()=>l&&l.errors.length===0?`Deleted ${l.budgetsDeleted}`:n===0&&!b?"Clean":b?`${v.length} stale ref(s)`:`${n} budget(s)`,S=()=>{g(!0)},C=()=>{g(!1),h()},T=()=>l?u.jsxs("div",{style:{fontSize:"0.85rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem",fontWeight:500},children:l.errors.length>0?" Completed with errors":" Deletion complete"}),u.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[l.budgetsDeleted>0&&u.jsxs("li",{children:[l.budgetsDeleted," budget(s) deleted"]}),l.monthsDeleted>0&&u.jsxs("li",{children:[l.monthsDeleted," month(s) deleted"]}),l.payeesDeleted>0&&u.jsxs("li",{children:[l.payeesDeleted," payee doc(s) deleted"]})]}),l.errors.length>0&&u.jsxs("div",{style:{marginTop:"0.5rem",color:"#ef4444"},children:[u.jsxs("div",{children:["Errors (",l.errors.length,"):"]}),u.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1.25rem"},children:[l.errors.slice(0,3).map((O,U)=>u.jsx("li",{children:O},U)),l.errors.length>3&&u.jsxs("li",{children:["...and ",l.errors.length-3," more"]})]})]})]}):e?n===0&&!b?u.jsx("div",{style:{fontSize:"0.85rem"},children:' No budget found for sample@sample.com  user is in "new user" state.'}):b?u.jsxs("div",{style:{fontSize:"0.85rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem",color:"#f59e0b"},children:" Found stale budget references:"}),u.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[v.slice(0,3).map(O=>u.jsx("li",{style:{opacity:.8},children:O},O)),v.length>3&&u.jsxs("li",{style:{opacity:.6},children:["...and ",v.length-3," more"]})]})]}):u.jsxs("div",{style:{fontSize:"0.85rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem",color:"#f59e0b"},children:" Sample user budget found:"}),u.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[u.jsxs("li",{children:[n," budget(s)"]}),u.jsxs("li",{children:[r," month(s)"]})]}),u.jsx("div",{style:{marginTop:"0.5rem",opacity:.7},children:"Deleting will reset sample@sample.com to a new user state."})]}):u.jsx("div",{style:{fontSize:"0.85rem",opacity:.7},children:"Click check to scan for sample user budget."}),I=n>0||b;return u.jsxs(u.Fragment,{children:[u.jsx(W0,{name:"Delete Sample User Budget",description:"Reset sample@sample.com to new user state",status:E(),statusText:x(),onCheck:d,isChecking:i,onRun:I?S:void 0,isRunning:o,actionText:"Delete",disabled:m,itemCount:I?n||v.length:void 0,details:T(),isDestructive:!0}),u.jsxs(ls,{isOpen:p,onClose:()=>g(!1),title:" Delete Sample User Budget?",children:[u.jsx("div",{style:{background:"color-mix(in srgb, #f59e0b 15%, transparent)",border:"1px solid color-mix(in srgb, #f59e0b 40%, transparent)",borderRadius:"8px",padding:"1rem",marginBottom:"1rem"},children:u.jsx("p",{style:{margin:0,color:"#fcd34d",fontWeight:500,fontSize:"0.95rem"},children:" This will delete all data for sample@sample.com!"})}),n>0&&u.jsxs("p",{style:{margin:"0 0 0.75rem",opacity:.9},children:["This will permanently delete ",u.jsxs("strong",{style:{color:"#f59e0b"},children:[n," budget(s)"]})," and"," ",u.jsxs("strong",{style:{color:"#f59e0b"},children:[r," month(s)"]}),"."]}),b&&u.jsxs("p",{style:{margin:"0 0 0.75rem",opacity:.9},children:["This will remove ",u.jsxs("strong",{style:{color:"#f59e0b"},children:[v.length," stale reference(s)"]})," from the user document."]}),u.jsxs("ul",{style:{margin:"0 0 1.5rem",paddingLeft:"1.5rem",opacity:.8,fontSize:"0.9rem"},children:[u.jsx("li",{children:"Budget document deleted"}),u.jsx("li",{children:"All month documents deleted"}),u.jsx("li",{children:"Payees document deleted"}),u.jsx("li",{children:"User will see onboarding flow"})]}),u.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[u.jsx(Ve,{variant:"secondary",actionName:"Cancel Delete Sample User Budget",onClick:()=>g(!1),children:"Cancel"}),u.jsx(Ve,{variant:"danger",actionName:"Confirm Delete Sample User Budget",onClick:C,children:" Delete Sample User Data"})]})]})]})}function cB({onClearCache:t,disabled:e}){const[n,r]=D.useState(!1),i=()=>{r(!0)},o=()=>{r(!1),t()};return u.jsxs(u.Fragment,{children:[u.jsx(eB,{name:"Clear All Caches",description:"Clear cached data and reload to fetch fresh data from Firestore",onAction:i,actionText:"Clear & Reload",actionIcon:"",disabled:e,isDestructive:!0}),u.jsxs(ls,{isOpen:n,onClose:()=>r(!1),title:"Clear Caches & Reload?",children:[u.jsx("p",{style:{margin:"0 0 1rem 0",opacity:.8},children:"This will clear all cached data and reload the page. The app will fetch fresh data from Firestore for everything."}),u.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[u.jsx(Ve,{variant:"secondary",actionName:"Cancel Clear Caches",onClick:()=>r(!1),children:"Cancel"}),u.jsx(Ve,{variant:"danger",actionName:"Confirm Clear Caches & Reload",onClick:o,children:"Clear & Reload"})]})]})]})}function uB({disabled:t,onDownloadBackup:e,isDownloadingBackup:n,budgetDownloadUpload:r,deleteAllMonths:i,deleteSampleUserBudget:o,onClearCache:l}){const d=r.isDownloading||r.isUploading||i.isDeleting||o.isDeleting,h=wo({migrationName:"Delete All Months",isDestructive:!0,onDownloadBackup:e}),m=wo({migrationName:"Delete Sample User Budget",isDestructive:!0,onDownloadBackup:e}),p=wo({migrationName:"Upload Budget",isDestructive:!0,onDownloadBackup:e});return u.jsxs(u.Fragment,{children:[u.jsxs(Q0,{title:"Utilities",icon:"",description:"Administrative utilities for data management, downloads, and cache control.",type:"utility",isAnyRunning:d,children:[u.jsx(aB,{isDownloading:r.isDownloading,downloadProgress:r.downloadProgress,downloadError:r.downloadError,onDownload:r.downloadBudget,isScanning:r.isScanning,isUploading:r.isUploading,uploadStatus:r.uploadStatus,uploadProgress:r.uploadProgress,uploadError:r.uploadError,uploadResult:r.uploadResult,onScan:r.scanZipFile,onUpload:async g=>{p.promptBeforeAction(()=>{r.uploadBudget(g).catch(v=>console.error("Upload failed:",v))})},disabled:t}),u.jsxs("div",{style:{marginTop:"0.75rem",paddingTop:"0.75rem",borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},children:[u.jsx("div",{style:{fontSize:"0.75rem",opacity:.5,textTransform:"uppercase",letterSpacing:"0.05em",marginBottom:"0.5rem",paddingLeft:"0.5rem"},children:"Destructive Actions"}),u.jsx(oB,{status:i.status,hasData:i.hasData,monthsCount:i.monthsCount,budgetCount:i.budgetCount,isChecking:i.isScanning,isDeleting:i.isDeleting,deleteResult:i.deleteResult,deleteProgress:i.deleteProgress,onCheck:i.scanStatus,onDelete:()=>h.promptBeforeAction(i.deleteAllMonths),disabled:t}),u.jsx(lB,{status:o.status,hasData:o.hasData,totalBudgets:o.totalBudgets,totalMonths:o.totalMonths,isChecking:o.isScanning,isDeleting:o.isDeleting,deleteResult:o.deleteResult,deleteProgress:o.deleteProgress,onCheck:o.scanStatus,onDelete:()=>m.promptBeforeAction(o.deleteSampleUserBudget),disabled:t}),u.jsx(cB,{onClearCache:l,disabled:t})]})]}),u.jsx(xo,{...h.promptProps,isDownloading:n}),u.jsx(xo,{...m.promptProps,isDownloading:n}),u.jsx(xo,{...p.promptProps,isDownloading:n})]})}function K0({message:t="Loading...",spinnerColor:e=me.primary,children:n,spinnerSize:r=4}){return u.jsxs("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(15, 15, 20, 0.95)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",zIndex:9999,gap:"1.5rem",backdropFilter:"blur(4px)"},children:[u.jsx("div",{style:{width:`${r}rem`,height:`${r}rem`,border:"3px solid rgba(255, 255, 255, 0.15)",borderTopColor:e,borderRadius:"50%",animation:"loadingOverlaySpin 0.8s linear infinite"}}),u.jsx("p",{style:{color:"rgba(255, 255, 255, 0.95)",fontSize:"1.2rem",fontWeight:600,letterSpacing:"0.02em",margin:0},children:t}),n,u.jsx("style",{children:`
        @keyframes loadingOverlaySpin {
          to { transform: rotate(360deg); }
        }
      `})]})}function tA({percent:t,gradient:e="linear-gradient(90deg, #646cff, #8b5cf6)",width:n=300}){return u.jsx("div",{style:{width:`${n}px`,height:"8px",background:"rgba(255, 255, 255, 0.1)",borderRadius:"4px",overflow:"hidden"},children:u.jsx("div",{style:{width:`${t}%`,height:"100%",background:e,borderRadius:"4px",transition:"width 0.3s ease-out"}})})}function Of({value:t,label:e,color:n="#646cff"}){return u.jsxs("div",{style:{textAlign:"center"},children:[u.jsx("p",{style:{color:n,fontSize:"1.5rem",fontWeight:700,margin:0},children:t}),u.jsx("p",{style:{color:"rgba(255, 255, 255, 0.6)",fontSize:"0.8rem",margin:"0.25rem 0 0",textTransform:"uppercase",letterSpacing:"0.05em"},children:e})]})}function nA({percent:t}){return u.jsxs("p",{style:{color:"rgba(255, 255, 255, 0.5)",fontSize:"0.9rem",margin:0},children:[t,"% complete"]})}function dB(){return u.jsxs("div",{style:Rf,children:[u.jsx("nav",{style:{marginBottom:"1rem",display:"flex",alignItems:"center"},children:u.jsx(Cn,{to:"/",style:{display:"flex",alignItems:"center"},title:"Tarron Lane Home",children:u.jsx("img",{src:"/t-icon.svg",alt:"Tarron Lane Home",style:{width:"2rem",height:"2rem"}})})}),u.jsx("h1",{children:"Tarron Lane Homepage"}),u.jsx("nav",{children:u.jsxs("ul",{children:[u.jsx("li",{children:u.jsx(Cn,{to:"/sql-test",children:"SQL Test"})}),u.jsx("li",{children:u.jsx(Cn,{to:"/budget",children:"Budget"})}),u.jsx("li",{children:u.jsx(Cn,{to:"/account",children:"Account"})})]})})]})}function hB(){const t=D.useContext(cd),e=Da(),[n,r]=D.useState(!1),i=On(),o=Gu(),l=i.state?.from||"/";D.useEffect(()=>{t.is_logged_in&&l!=="/"&&o(l,{replace:!0})},[t.is_logged_in,l,o]);function d(){r(!0),e.logout_firebase_user().then(function(){Le.clear(),window.location.href="/"})}return u.jsxs("div",{style:Rf,children:[u.jsxs("nav",{style:{marginBottom:"1rem",display:"grid",gridTemplateColumns:"1fr auto 1fr",alignItems:"center"},children:[u.jsx("div",{style:{display:"flex",alignItems:"center"},children:u.jsx(Cn,{to:"/",style:{opacity:.6,fontSize:"1.5rem",textDecoration:"none",padding:"0.25rem 0.5rem"},title:"Back to Home",children:""})}),u.jsxs(Cn,{to:"/",style:{display:"flex",alignItems:"center",gap:"0.5rem",textDecoration:"none",color:"inherit"},title:"Tarron Lane Home",children:[u.jsx("img",{src:"/t-icon.svg",alt:"Tarron Lane",style:{width:"1.5rem",height:"1.5rem"}}),u.jsx("span",{style:{fontWeight:600,fontSize:"1.1rem"},children:"Account"})]}),u.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:u.jsx(QT,{items:[{label:"Budget",icon:"",to:"/budget"},{label:"Account",icon:"",to:"/account"}]})})]}),u.jsx("h1",{children:"Account"}),t.is_logged_in?n?u.jsx("p",{children:"Logging Out..."}):u.jsxs(u.Fragment,{children:[u.jsxs("p",{children:["You are logged in as ",t.username]}),u.jsx("button",{onClick:d,style:{marginTop:"1rem"},children:"Logout"})]}):u.jsx(fB,{})]})}function fB(){const t=Da(),[e,n]=D.useState(""),[r,i]=D.useState(""),[o,l]=D.useState(!1),[d,h]=D.useState(!1),[m,p]=D.useState("");function g(E){n(E.target.value)}function v(E){i(E.target.value)}function b(E){E.preventDefault(),h(!0),p(""),Le.clear(),t.login_firebase_user(e,r).then(function(){}).catch(function(){p("Incorrect login credentials")}).finally(function(){h(!1)})}return u.jsxs("form",{onSubmit:b,children:[u.jsxs("div",{children:[u.jsx("label",{htmlFor:"username",children:"Email: "}),u.jsx("input",{id:"username",type:"email",value:e,onChange:g})]}),u.jsxs("div",{children:[u.jsx("label",{htmlFor:"password",children:"Password: "}),u.jsxs("div",{style:{display:"inline-flex",alignItems:"center",position:"relative"},children:[u.jsx("input",{id:"password",type:o?"text":"password",value:r,onChange:v,style:{paddingRight:"2rem"}}),u.jsx("button",{type:"button",onClick:()=>l(!o),style:{position:"absolute",right:"0.25rem",background:"none",border:"none",cursor:"pointer",padding:"0.25rem",opacity:.6,fontSize:"1rem"},title:o?"Hide password":"Show password",children:o?"":""})]})]}),d?u.jsx("p",{children:"Logging in..."}):u.jsx("button",{children:"Login"}),m&&u.jsx("p",{style:{color:"red"},children:m})]})}const mB={categories:"balances",accounts:"balances",income:"transactions",spend:"transactions",transfers:"transactions",adjustments:"transactions"},pB={balances:"categories",transactions:"income"};function gB({activeTab:t,setActiveTab:e,allocationsFinalized:n}){const r=mB[t],i=D.useMemo(()=>[{id:"balances",label:"Balances"},{id:"transactions",label:"Transactions"}],[]),o=D.useMemo(()=>[{id:"categories",label:"Categories",checkmark:n},{id:"accounts",label:"Accounts"}],[n]),l=D.useMemo(()=>[{id:"income",label:"Income"},{id:"spend",label:"Spend"},{id:"transfers",label:"Transfers"},{id:"adjustments",label:"Adjustments"}],[]),d=m=>{e(pB[m])},h=r==="balances"?o:l;return u.jsxs("div",{children:[u.jsx(Df,{mode:"button",tabs:i,activeTab:r,onTabChange:d,variant:"segmented"}),u.jsx(Df,{mode:"button",tabs:h,activeTab:t,onTabChange:m=>e(m),variant:"secondary"})]})}function yB({isOpen:t,onClose:e,onProceed:n,results:r}){const[i,o]=D.useState("from_current"),l=!r||r.status==="confirming",d=r&&!["confirming","done","error"].includes(r.status),h=l||r?.status==="done"||r?.status==="error";function m(){h&&(e(),o("from_current"))}function p(){n(i)}return u.jsx(ls,{isOpen:t,onClose:m,title:"Recalculate Balances",width:"540px",children:u.jsxs("div",{style:{padding:"0.5rem 0"},children:[l&&u.jsxs(u.Fragment,{children:[u.jsx("p",{style:{margin:"0 0 1rem 0",fontSize:"0.95rem",lineHeight:1.5},children:"Choose what to recalculate:"}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem",marginBottom:"1.5rem"},children:[u.jsx(F1,{selected:i==="from_current",onClick:()=>o("from_current"),title:"From current month forward",description:"Recalculate from this month onward. Use for quick fixes."}),u.jsx(F1,{selected:i==="all_months",onClick:()=>o("all_months"),title:"All months from beginning",description:"Recalculate entire history. Use after migrations or data repairs.",recommended:!0})]}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem",marginBottom:"1.5rem"},children:[u.jsx(Tl,{status:"waiting",label:"Find all months to process"}),u.jsx(Tl,{status:"waiting",label:"Process months"}),u.jsx(Tl,{status:"waiting",label:"Update budget totals"})]}),u.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[u.jsx(Ve,{variant:"secondary",actionName:"Cancel Recalculation",onClick:e,children:"Cancel"}),u.jsx(Ve,{actionName:"Proceed with Recalculation",onClick:p,children:"Proceed"})]})]}),!l&&u.jsxs(u.Fragment,{children:[u.jsx("p",{style:{margin:"0 0 1.5rem 0",fontSize:"0.9rem",opacity:.7},children:"Recalculating category balances and account balances..."}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:[u.jsx(Tl,{status:r?.status==="pending"?"waiting":"complete",label:"Find all months to process",detail:r&&r.status!=="pending"?`Found ${r.monthsFound||0} month${r.monthsFound!==1?"s":""}`:void 0}),u.jsx(Tl,{status:U1(r?.status,["pending","finding_months"],"processing_months"),label:"Process months",detail:r?.status==="processing_months"?`Processing: ${r.currentMonthLabel} (${(r.currentMonthIndex||0)+1}/${r.monthsFound||0})`:r?.monthsProcessed!==void 0?`Processed ${r.monthsProcessed} month${r.monthsProcessed!==1?"s":""}`:void 0}),u.jsx(Tl,{status:r?.status==="error"?"error":U1(r?.status,["pending","finding_months","processing_months"],"updating_budget"),label:"Update budget totals",detail:r?.status==="error"?r.error:void 0,isError:r?.status==="error"})]}),r?.status==="done"&&u.jsxs("div",{style:{marginTop:"1.5rem",padding:"1rem",background:`color-mix(in srgb, ${me.success} 10%, transparent)`,border:`1px solid ${me.success}`,borderRadius:"8px",textAlign:"center"},children:[u.jsx("p",{style:{margin:0,fontWeight:600,color:me.success},children:" Recalculation complete!"}),u.jsxs("p",{style:{margin:"0.5rem 0 0 0",fontSize:"0.9rem",opacity:.8},children:[r.monthsProcessed," month",r.monthsProcessed!==1?"s":""," processed",u.jsx("br",{}),"Total Income: ",Xe(r.totalIncomeRecalculated||0),u.jsx("br",{}),"Total Expenses: ",Xe(r.totalExpensesRecalculated||0)]})]}),(r?.status==="done"||r?.status==="error")&&u.jsx("div",{style:{marginTop:"1.5rem",display:"flex",justifyContent:"center"},children:u.jsx(Ve,{actionName:"Close Recalculation Modal",onClick:e,children:"Done"})}),d&&u.jsx("p",{style:{marginTop:"1.5rem",textAlign:"center",fontSize:"0.85rem",opacity:.6},children:"Please wait, do not close this window..."})]})]})})}function U1(t,e,n){return!t||e.includes(t)?t===n?"active":"waiting":t===n?"active":"complete"}function Tl({status:t,label:e,detail:n,isError:r}){const i=t==="waiting"?"":t==="active"?"":t==="error"?"":"";return u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[u.jsx("span",{style:{fontSize:"1.1rem",width:"1.5rem",textAlign:"center"},children:i}),u.jsxs("div",{style:{flex:1},children:[u.jsx("p",{style:{margin:0,fontWeight:500},children:e}),n&&u.jsx("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.85rem",opacity:r?1:.6,color:r?me.error:"inherit"},children:n})]})]})}function F1({selected:t,onClick:e,title:n,description:r,recommended:i}){return u.jsxs("button",{type:"button",onClick:e,style:{display:"flex",alignItems:"flex-start",gap:"0.75rem",padding:"0.75rem 1rem",background:t?"color-mix(in srgb, #646cff 15%, transparent)":"color-mix(in srgb, currentColor 5%, transparent)",border:t?"2px solid #646cff":"2px solid transparent",borderRadius:"8px",cursor:"pointer",textAlign:"left",width:"100%",transition:"all 0.15s ease"},children:[u.jsx("span",{style:{width:"20px",height:"20px",borderRadius:"50%",border:t?"6px solid #646cff":"2px solid rgba(128,128,128,0.5)",flexShrink:0,marginTop:"2px",background:t?"white":"transparent"}}),u.jsxs("div",{style:{flex:1},children:[u.jsxs("p",{style:{margin:0,fontWeight:600,fontSize:"0.95rem"},children:[n,i&&u.jsx("span",{style:{marginLeft:"0.5rem",padding:"0.15rem 0.5rem",background:me.success,color:"white",borderRadius:"4px",fontSize:"0.7rem",fontWeight:500,verticalAlign:"middle"},children:"RECOMMENDED"})]}),u.jsx("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.85rem",opacity:.7},children:r})]})]})}function Gg(t){return t==="no_category"||t==="NO_CATEGORY"}function _B(t,e){const n={};for(const r of t)Gg(r.from_category_id)||(n[r.from_category_id]=(n[r.from_category_id]||0)-r.amount),Gg(r.to_category_id)||(n[r.to_category_id]=(n[r.to_category_id]||0)+r.amount);for(const r of e)Gg(r.category_id)||(n[r.category_id]=(n[r.category_id]||0)+r.amount);for(const r of Object.keys(n))n[r]=Me(n[r]);return n}async function bB(t,e,n,r,i,o,l){const d=hs(t,e.year,e.month),{exists:h,data:m}=await At("months",d,"recalculate: reading full month data");if(!h||!m)return null;const p=m.income||[],g=m.expenses||[],v=m.transfers||[],b=m.adjustments||[],E=m.are_allocations_finalized||!1,x=Me(p.reduce((R,N)=>R+N.amount,0)),S=Me(g.reduce((R,N)=>R+N.amount,0)),C={};if(m.category_balances)for(const R of m.category_balances)C[R.category_id]={allocated:R.allocated??0};const T=_B(v,b),I=n.map(R=>{const N=Me(i[R]??0);let V=0;E&&C[R]&&(V=Me(C[R].allocated));let H=0;g.length>0&&(H=Me(g.filter(K=>K.category_id===R).reduce((K,q)=>K+q.amount,0)));const j=T[R]??0,B=Me(v.filter(K=>K.from_category_id===R||K.to_category_id===R).reduce((K,q)=>q.from_category_id===R?K-q.amount:q.to_category_id===R?K+q.amount:K,0)),M=Me(b.filter(K=>K.category_id===R).reduce((K,q)=>K+q.amount,0)),Z=Me(N+V+H+j);return{category_id:R,start_balance:N,allocated:V,spent:H,transfers:B,adjustments:M,end_balance:Z}});I.forEach(R=>{i[R.category_id]=R.end_balance});const O=Object.keys(r),U={},$=O.map(R=>{const N=Me(p.filter(q=>q.account_id===R).reduce((q,W)=>q+W.amount,0)),V=Me(g.filter(q=>q.account_id===R).reduce((q,W)=>q+W.amount,0)),H=Me(v.filter(q=>q.from_account_id===R).reduce((q,W)=>q-W.amount,0)),j=Me(v.filter(q=>q.to_account_id===R).reduce((q,W)=>q+W.amount,0)),B=Me(b.filter(q=>q.account_id===R).reduce((q,W)=>q+W.amount,0)),M=Me(N+V+H+j+B);U[R]=M;const Z=Me(o[R]??0),K=Me(H+j);return{account_id:R,start_balance:Z,income:N,expenses:V,transfers:K,adjustments:B,net_change:M,end_balance:Me(Z+M)}});for(const R of $)o[R.account_id]=R.end_balance;return{updatedMonth:{budget_id:t,year_month_ordinal:vt(e.year,e.month),year:e.year,month:e.month,income:p,total_income:x,previous_month_income:l,expenses:g,total_expenses:S,transfers:v,adjustments:b,account_balances:$,category_balances:I,are_allocations_finalized:E,created_at:m.created_at||new Date().toISOString(),updated_at:new Date().toISOString()},totalIncome:x,totalExpenses:S,accountNetChanges:U}}function Y0({isDisabled:t,onCloseMenu:e}){const{selectedBudgetId:n,currentYear:r,currentMonthNumber:i}=Ye(),{categories:o,accounts:l}=An(),{updateAccounts:d}=PT(),{updateCategories:h}=BT(),[m,p]=D.useState(!1),[g,v]=D.useState(!1),[b,E]=D.useState(null);function x(){v(!0),E({status:"confirming"})}async function S(T){if(n){p(!0),E({status:"pending"});try{E({status:"finding_months"});let I;if(T==="all_months")I=(await Dn("months","recalculate: querying all months for full recalculation",[{field:"budget_id",op:"==",value:n}])).docs.map(B=>({year:B.data.year,month:B.data.month})).sort((B,M)=>B.year!==M.year?B.year-M.year:B.month-M.month);else{const j=new Date,B=r||j.getFullYear(),M=i||j.getMonth()+1,{year:Z,month:K}=Xl(B,M);I=await z6(n,Z,K)}const O=Object.keys(o);E({status:"finding_months",monthsFound:I.length}),await new Promise(j=>setTimeout(j,100));const U={},$={};if(T==="from_current"){const j=new Date,B=r||j.getFullYear(),M=i||j.getMonth()+1,{year:Z,month:K}=Xl(B,M),q=hs(n,Z,K),{exists:W,data:X}=await At("months",q,"recalculate: reading previous month for starting balances");if(W&&X?.category_balances)for(const re of X.category_balances)U[re.category_id]=re.end_balance??0;if(W&&X?.account_balances)for(const re of X.account_balances)$[re.account_id]=re.end_balance??0}O.forEach(j=>{U[j]===void 0&&(U[j]=0)}),Object.keys(l).forEach(j=>{$[j]===void 0&&($[j]=0)});let k=0,R=0,N=0;for(let j=0;j<I.length;j++){const B=I[j],M=`${Uu[B.month-1]} ${B.year}`;E({status:"processing_months",monthsFound:I.length,currentMonthIndex:j,currentMonthLabel:M});const Z=await bB(n,B,O,l,U,$,N);Z&&(k+=Z.totalIncome,R+=Z.totalExpenses,N=Z.totalIncome,await CT({budgetId:n,month:Z.updatedMonth,description:"recalculate all months"}),await new Promise(K=>setTimeout(K,50)))}const V={};Object.entries(l).forEach(([j,B])=>{V[j]={...B,balance:$[j]??0}}),await d.mutateAsync({budgetId:n,accounts:V}),E({status:"updating_budget",monthsFound:I.length,monthsProcessed:I.length,totalIncomeRecalculated:k,totalExpensesRecalculated:R});const H={};Object.entries(o).forEach(([j,B])=>{H[j]={...B,balance:U[j]??0}}),await h.mutateAsync({budgetId:n,categories:H});for(const j of I)Le.invalidateQueries({queryKey:ke.month(n,j.year,j.month)});E({status:"done",monthsFound:I.length,monthsProcessed:I.length,totalIncomeRecalculated:k,totalExpensesRecalculated:R})}catch(I){console.error("Recalculate error:",I),E({status:"error",error:I instanceof Error?I.message:"Failed to recalculate"})}finally{p(!1)}}}function C(){v(!1),E(null),e?.()}return u.jsxs(u.Fragment,{children:[u.jsxs("button",{onClick:x,disabled:t||m,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",border:"none",borderRadius:"8px",padding:"0.5rem",cursor:t||m?"not-allowed":"pointer",opacity:t||m?.5:1,fontSize:"1rem",display:"flex",alignItems:"center",justifyContent:"center"},title:"Recalculate balances from this month forward",children:[m?"":""," Recalculate"]}),u.jsx(yB,{isOpen:g,onClose:C,onProceed:S,results:b})]})}function V1({direction:t,isDisabled:e,isLoading:n,disabledReason:r,onNavigate:i}){const[o,l]=D.useState(!1),d=n||e,h=t==="prev"?"":"",m=t==="prev"?"Previous month":"Next month",p=()=>{n||(e?(l(!0),setTimeout(()=>l(!1),2e3)):i())};return u.jsxs("div",{style:{position:"relative"},children:[u.jsx("button",{onClick:p,onMouseEnter:()=>e&&l(!0),onMouseLeave:()=>l(!1),style:{background:"color-mix(in srgb, currentColor 10%, transparent)",border:"none",borderRadius:"8px",padding:"0.75rem 1rem",cursor:d?"not-allowed":"pointer",fontSize:"1.25rem",opacity:d?.5:1,transition:"opacity 0.15s, background 0.15s"},title:e?void 0:m,children:h}),o&&e&&u.jsx("div",{style:{position:"absolute",top:"100%",...t==="prev"?{left:0}:{right:0},marginTop:"0.5rem",padding:"0.5rem 0.75rem",background:me.warning,color:"#000",borderRadius:"6px",fontSize:"0.75rem",fontWeight:500,width:"max-content",maxWidth:"min(300px, 50vw)",textAlign:"center",zIndex:20,boxShadow:"0 2px 8px rgba(0,0,0,0.3)"},children:r})]})}function vB({pickerYear:t,pickerMonth:e,currentYear:n,currentMonthNumber:r,minOrdinal:i,maxOrdinal:o,minAllowed:l,maxAllowed:d,onYearChange:h,onMonthChange:m,onGo:p}){const g=t>l.year,v=t<d.year,b=Number(vt(t,e)),E=b>=i&&b<=o;return u.jsxs("div",{style:{padding:"0.75rem",borderTop:"1px solid color-mix(in srgb, currentColor 15%, transparent)",marginTop:"0.25rem"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.5rem"},children:[u.jsx("button",{onClick:()=>h(t-1),disabled:!g,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",border:"none",borderRadius:"4px",padding:"0.25rem 0.5rem",cursor:g?"pointer":"not-allowed",fontSize:"0.8rem",opacity:g?1:.3},title:g?"Previous year":"Cannot go further back",children:""}),u.jsx("span",{style:{flex:1,textAlign:"center",fontSize:"0.9rem",fontWeight:500},children:t}),u.jsx("button",{onClick:()=>h(t+1),disabled:!v,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",border:"none",borderRadius:"4px",padding:"0.25rem 0.5rem",cursor:v?"pointer":"not-allowed",fontSize:"0.8rem",opacity:v?1:.3},title:v?"Next year":"Cannot go further ahead",children:""})]}),u.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"0.25rem",marginBottom:"0.5rem"},children:Uu.map((x,S)=>{const C=S+1,T=C===e,I=t===n&&C===r,O=Number(vt(t,C)),U=O<i,$=O>o,k=U||$;let R=x;return U?R="Too far in the past":$&&(R="Too far in the future"),u.jsx("button",{onClick:()=>m(C),disabled:k,style:{background:T?me.primary:"color-mix(in srgb, currentColor 8%, transparent)",border:I?`1px solid ${me.primary}`:"1px solid transparent",borderRadius:"4px",padding:"0.35rem 0.25rem",cursor:k?"not-allowed":"pointer",fontSize:"0.7rem",color:T?"#fff":"inherit",opacity:k?.3:1,transition:"background 0.15s"},title:R,children:x.slice(0,3)},C)})}),u.jsxs("button",{onClick:p,disabled:!E,style:{width:"100%",background:E?me.primary:"color-mix(in srgb, currentColor 20%, transparent)",border:"none",borderRadius:"6px",padding:"0.5rem",cursor:E?"pointer":"not-allowed",fontSize:"0.85rem",color:E?"#fff":"inherit",fontWeight:500,opacity:E?1:.5},children:["Go to ",Uu[e-1]," ",t]})]})}function xB({isOpen:t,onClose:e,year:n,month:r,isDeleting:i,onConfirm:o}){return u.jsxs(ls,{isOpen:t,onClose:e,title:" Delete Month?",children:[u.jsx("div",{style:{background:"color-mix(in srgb, #ef4444 15%, transparent)",border:"1px solid color-mix(in srgb, #ef4444 40%, transparent)",borderRadius:"8px",padding:"1rem",marginBottom:"1rem"},children:u.jsxs("p",{style:{margin:0,color:"#fca5a5",fontWeight:500,fontSize:"0.95rem"},children:[" This will permanently delete ",Uu[r-1]," ",n,"!"]})}),u.jsx("p",{style:{margin:"0 0 0.75rem",opacity:.9},children:"This month document and all its data (income, expenses, allocations) will be permanently deleted."}),u.jsx("p",{style:{margin:"0 0 1rem",opacity:.8,fontSize:"0.9rem"},children:"After deletion, you will be navigated to the previous month."}),u.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[u.jsx(Ve,{variant:"secondary",actionName:"Cancel Delete Month",onClick:e,disabled:i,children:"Cancel"}),u.jsx(Ve,{variant:"danger",actionName:"Confirm Delete Month",onClick:o,disabled:i,children:i?"Deleting...":" Delete Month"})]})]})}function wB(){const t=new Date;let e=t.getFullYear(),n=t.getMonth()+1+Af;for(;n>12;)n-=12,e+=1;return{year:e,month:n}}function SB(){const t=new Date;let e=t.getFullYear(),n=t.getMonth()+1-jf;for(;n<1;)n+=12,e-=1;return{year:e,month:n}}function EB(t){return Object.keys(t).sort()[0]}function CB(t){const e=parseInt(t.slice(0,4),10),n=parseInt(t.slice(4,6),10);return{year:e,month:n}}function TB(t){const e=SB(),n=EB(t);if(!n)return e;const r=vt(e.year,e.month);return n<r?CB(n):e}function $1(t,e){return e===1?{year:t-1,month:12}:{year:t,month:e-1}}function AB(t,e){return e===12?{year:t+1,month:1}:{year:t,month:e+1}}function jB({onPreviousMonth:t,onNextMonth:e}){const{isLoading:n}=Gn(),{currentYear:r,currentMonthNumber:i,isAdmin:o,selectedBudgetId:l,setCurrentYear:d,setCurrentMonthNumber:h}=Ye(),{budget:m,monthMap:p}=An(),{month:g}=Ci(l,r,i),v=$1(r,i),b=AB(r,i),E=TB(p),x=wB(),S=Number(vt(E.year,E.month)),C=Number(vt(x.year,x.month)),T=Number(vt(v.year,v.month)),I=Number(vt(b.year,b.month)),O=T<S,U=I>C,[$,k]=D.useState(!1),[R,N]=D.useState(!1),[V,H]=D.useState(r),[j,B]=D.useState(i),[M,Z]=D.useState(!1),[K,q]=D.useState(!1),W=D.useRef(null),X=(()=>{if(!p||Object.keys(p).length===0)return!1;const ie=vt(r,i),ce=Math.max(...Object.keys(p).map(Number));return Number(ie)===ce})(),{trackChange:re}=fc();async function z(){if(l){q(!0);try{const ie=hs(l,r,i);q6(l,r,i,re),await Ry("months",ie,`deleting month ${r}/${i}`),`${r}${i}`,Le.removeQueries({queryKey:ke.month(l,r,i)});const ce=$1(r,i);Z(!1),k(!1),window.location.href=`/budget/${ce.year}/${ce.month}/categories`}catch(ie){console.error("Failed to delete month:",ie),alert(`Failed to delete month: ${ie instanceof Error?ie.message:"Unknown error"}`)}finally{q(!1)}}}D.useEffect(()=>{if(!$)return;function ie(ce){W.current&&!W.current.contains(ce.target)&&(k(!1),N(!1))}return document.addEventListener("mousedown",ie),()=>document.removeEventListener("mousedown",ie)},[$]);function G(){R||(H(r),B(i)),N(!R)}function te(){d(V),h(j),N(!1),k(!1)}async function se(){if(!g||!m)return;const ie=new Date,we=`${ie.toISOString().split("T")[0]}_month_${r}_${String(i).padStart(2,"0")}`,he=new xm,Ee=[{name:`${we}_income.json`,data:g.income||[]},{name:`${we}_expenses.json`,data:g.expenses||[]},{name:`${we}_transfers.json`,data:g.transfers||[]},{name:`${we}_adjustments.json`,data:g.adjustments||[]},{name:`${we}_account_balances.json`,data:g.account_balances||[]},{name:`${we}_category_balances.json`,data:g.category_balances||[]}],Ue={budget_id:m.id,budget_name:m.name,year_month_ordinal:g.year_month_ordinal,year:g.year,month:g.month,total_income:g.total_income,previous_month_income:g.previous_month_income,total_expenses:g.total_expenses,are_allocations_finalized:g.are_allocations_finalized,created_at:g.created_at,updated_at:g.updated_at,downloaded_at:ie.toISOString()};Ee.push({name:`${we}_metadata.json`,data:Ue});for(const L of Ee)he.file(L.name,JSON.stringify(L.data,null,2));const Be=await he.generateAsync({type:"blob"}),gt=URL.createObjectURL(Be),yt=document.createElement("a");yt.href=gt,yt.download=`${we}.zip`,document.body.appendChild(yt),yt.click(),document.body.removeChild(yt),URL.revokeObjectURL(gt),k(!1)}return u.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"1rem",marginBottom:"1.5rem",padding:"1rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"12px"},children:[u.jsx(V1,{direction:"prev",isDisabled:O,isLoading:n,disabledReason:"Cannot create months more than 3 months into the past",onNavigate:t}),u.jsxs("div",{ref:W,style:{textAlign:"center",minWidth:"180px",position:"relative"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"flex-start",justifyContent:"center",gap:"0.25rem"},children:[u.jsxs("h2",{style:{margin:0,fontSize:"1.5rem"},children:[Uu[i-1]," ",r]}),u.jsx("button",{onClick:()=>k(!$),style:{background:"transparent",border:"none",cursor:"pointer",fontSize:"0.5rem",opacity:.4,padding:"0.15rem",borderRadius:"4px",transition:"opacity 0.15s, transform 0.15s",transform:$?"rotate(180deg)":"rotate(0deg)",marginTop:"0.25rem"},title:"Month options",children:""})]}),n&&u.jsxs(u.Fragment,{children:[u.jsx("style",{children:"@keyframes spin { to { transform: rotate(360deg); } }"}),u.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0.4rem",marginTop:"0.35rem"},children:[u.jsx("span",{style:{display:"inline-block",width:"14px",height:"14px",border:"2px solid color-mix(in srgb, currentColor 20%, transparent)",borderTopColor:me.primary,borderRadius:"50%",animation:"spin 0.8s linear infinite"}}),u.jsx("span",{style:{fontSize:"0.8rem",opacity:.6},children:"Loading..."})]})]}),$&&u.jsxs("div",{style:{position:"absolute",top:"100%",left:"50%",transform:"translateX(-50%)",marginTop:"0.5rem",background:"var(--background, #242424)",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",borderRadius:"8px",padding:"0.25rem",zIndex:100,minWidth:"160px",boxShadow:"0 4px 12px rgba(0,0,0,0.3)"},children:[u.jsx(Y0,{isDisabled:n,onCloseMenu:()=>k(!1)}),u.jsx("button",{onClick:G,style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%",background:"transparent",border:"none",borderRadius:"6px",padding:"0.5rem 0.75rem",cursor:"pointer",fontSize:"0.85rem",color:"inherit",textAlign:"left",transition:"background 0.15s"},title:"Jump to a specific month",children:" Go to Month"}),R&&u.jsx(vB,{pickerYear:V,pickerMonth:j,currentYear:r,currentMonthNumber:i,minOrdinal:S,maxOrdinal:C,minAllowed:E,maxAllowed:x,onYearChange:H,onMonthChange:B,onGo:te}),o&&g&&u.jsx("button",{onClick:()=>{se()},style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%",background:"transparent",border:"none",borderRadius:"6px",padding:"0.5rem 0.75rem",cursor:"pointer",fontSize:"0.85rem",color:"inherit",textAlign:"left",transition:"background 0.15s"},title:"Download month document as JSON (for debugging)",children:" Download JSON"}),o&&g&&X&&u.jsx("button",{onClick:()=>Z(!0),style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%",background:"transparent",border:"none",borderRadius:"6px",padding:"0.5rem 0.75rem",cursor:"pointer",fontSize:"0.85rem",color:"#ef4444",textAlign:"left",transition:"background 0.15s"},title:"Delete this month (last month only)",children:" Delete Month"})]})]}),u.jsx(V1,{direction:"next",isDisabled:U,isLoading:n,disabledReason:"Cannot create months more than 3 months into the future",onNavigate:e}),u.jsx(xB,{isOpen:M,onClose:()=>Z(!1),year:r,month:i,isDeleting:K,onConfirm:z})]})}const X0={cursor:"pointer",fontSize:"0.9rem",padding:"0.35rem 0.5rem",borderRadius:"4px"},RB={...X0,background:me.primary,border:"none",color:"white"},IB={...X0,background:"transparent",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)"},kB={...X0,background:"transparent",border:`1px solid ${me.errorBorder}`,color:me.error},q1=t=>({display:"flex",alignItems:"center",justifyContent:"center",width:"2.25rem",height:"100%",minHeight:"2.25rem",background:t?`color-mix(in srgb, ${me.error} 15%, transparent)`:`color-mix(in srgb, ${me.success} 15%, transparent)`,border:`1px solid ${t?me.errorBorder:"rgba(74, 222, 128, 0.4)"}`,borderRadius:"4px 0 0 4px",cursor:"pointer",fontSize:"1rem",fontWeight:600,color:t?me.error:me.success,transition:"all 0.15s ease",flexShrink:0});function Z0({accounts:t,accountGroups:e,categories:n,categoryGroups:r,payees:i,initialData:o,defaultAccountId:l,defaultDate:d,config:h,onSubmit:m,onCancel:p,onDelete:g,extraContent:v}){const{isWide:b}=OT(),{showCategory:E=!1,showCleared:x=!1,showSignToggle:S=!1,accountLabel:C="Account",payeePlaceholder:T="Payee name",descriptionPlaceholder:I="Optional note",submitLabel:O}=h,U=new Date().toISOString().split("T")[0],[$,k]=D.useState(o?.date||d||U),[R,N]=D.useState(o?.payee||""),[V,H]=D.useState(o?.categoryId||(h.showNoCategoryOption?Kt:"")),[j,B]=D.useState(o?.accountId||l||(h.showNoAccountOption?qt:t[0]?t[0][0]:"")),M=o?.amount!==void 0?Math.abs(o.amount):void 0,[Z,K]=D.useState(M?.toString()||""),[q,W]=D.useState(o?.description||""),[X,re]=D.useState(o?.cleared||!1),[z,G]=D.useState(()=>S?o?.amount!==void 0?o.amount<0:!1:!0),[te,se]=D.useState(!1),ie={},ce=[];t.forEach(([xe,ae])=>{ae.account_group_id?(ie[ae.account_group_id]||(ie[ae.account_group_id]=[]),ie[ae.account_group_id].push([xe,ae])):ce.push([xe,ae])});function we(xe){xe.preventDefault();const ae=parseFloat(Z);if(isNaN(ae)||ae<=0||E&&!V||!j||!$)return;if(V===Kt&&j===qt){se(!0);return}se(!1);const De=S&&z?-ae:ae;m({date:$,payee:R.trim()||void 0,categoryId:E?V:void 0,accountId:j,amount:De,description:q.trim()||void 0,cleared:x?X:void 0})}!(V===Kt&&j===qt)&&te&&se(!1);const Be=h.showNoAccountOption?u.jsx(MT,{id:"txn-account",value:j,onChange:B,accounts:t,accountGroups:e,placeholder:ja,required:!0,showNoAccountOption:!0}):u.jsxs($u,{id:"txn-account",value:j,onChange:xe=>B(xe.target.value),required:!0,style:{fontSize:"0.85rem",padding:"0.5rem"},children:[Object.entries(e).map(([xe,ae])=>{const Ae=ie[xe];return Ae?.length?u.jsx("optgroup",{label:ae.name,children:Ae.map(([Oe,De])=>u.jsx("option",{value:Oe,children:De.nickname},Oe))},xe):null}),ce.length>0&&u.jsx("optgroup",{label:"Other",children:ce.map(([xe,ae])=>u.jsx("option",{value:xe,children:ae.nickname},xe))})]}),gt=E&&n&&r?u.jsx(Pt,{label:"Category",htmlFor:"txn-category",children:u.jsx(DT,{id:"txn-category",value:V,onChange:H,categories:n,categoryGroups:r,placeholder:h.showNoCategoryOption?Io:"Search...",required:!0,showNoCategoryOption:h.showNoCategoryOption})}):null,yt=x?u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.25rem",paddingBottom:"0.35rem"},children:[u.jsx("label",{htmlFor:"txn-cleared",style:{fontSize:"0.75rem",opacity:.7,fontWeight:500},children:"Clr"}),u.jsx($r,{id:"txn-cleared",checked:X,onChange:xe=>re(xe.target.checked)})]}):null,L=u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.25rem",paddingBottom:"0.1rem"},children:[u.jsx("span",{style:{fontSize:"0.75rem",opacity:.7,fontWeight:500},children:""}),u.jsxs("div",{style:{display:"flex",gap:"0.25rem"},children:[u.jsx("button",{type:"submit",title:O,style:RB,children:""}),u.jsx("button",{type:"button",onClick:()=>{p()},title:"Cancel",style:IB,children:""}),g&&u.jsx("button",{type:"button",onClick:()=>{g()},title:"Delete",style:kB,children:""})]})]}),de=te?u.jsx("div",{style:{background:`color-mix(in srgb, ${me.error} 15%, transparent)`,border:`1px solid ${me.errorBorder}`,borderRadius:"6px",padding:"0.5rem 0.75rem",fontSize:"0.85rem",color:me.error},children:'Cannot select both "No Category" and "No Account"  at least one must be a real category or account.'}):null,ye=u.jsxs(Pa,{children:[u.jsx(Ve,{type:"submit",actionName:O,children:O}),u.jsx(Ve,{type:"button",variant:"secondary",actionName:"Cancel Transaction Form",onClick:p,children:"Cancel"}),g&&u.jsx(Ve,{type:"button",variant:"danger",actionName:"Delete Transaction",onClick:g,children:" Delete"})]}),ee=E&&n&&r,J={fontSize:"0.85rem",padding:"0.5rem"};if(!b)return u.jsxs(xi,{actionName:O,onSubmit:we,children:[u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:[u.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[u.jsx(Pt,{label:"Date",htmlFor:"txn-date",children:u.jsx(kf,{id:"txn-date",value:$,onChange:xe=>k(xe.target.value),required:!0,autoFocus:!0})}),u.jsx(Pt,{label:S?z?"Amount (Expense)":"Amount (Refund)":"Amount",htmlFor:"txn-amount",children:S?u.jsxs("div",{className:"currency-with-sign",style:{display:"flex",alignItems:"stretch"},children:[u.jsx("button",{type:"button",onClick:()=>G(!z),style:q1(z),title:z?"Click to make this a refund (+)":"Click to make this an expense (-)",children:z?"":"+"}),u.jsx("div",{style:{flex:1},children:u.jsx(vo,{id:"txn-amount",value:Z,onChange:K,placeholder:"$0.00",required:!0,style:{borderTopLeftRadius:0,borderBottomLeftRadius:0,borderLeft:"none",color:z?me.error:me.success}})})]}):u.jsx(vo,{id:"txn-amount",value:Z,onChange:K,placeholder:"$0.00",required:!0})})]}),u.jsx(Pt,{label:"Payee",htmlFor:"txn-payee",children:u.jsx(R1,{id:"txn-payee",value:R,onChange:N,payees:i,placeholder:T})}),gt,u.jsx(Pt,{label:C,htmlFor:"txn-account",children:Be}),u.jsx(Pt,{label:"Description (optional)",htmlFor:"txn-description",children:u.jsx(wi,{id:"txn-description",value:q,onChange:xe=>W(xe.target.value),placeholder:I})}),x&&u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx($r,{id:"txn-cleared-stacked",checked:X,onChange:xe=>re(xe.target.checked)}),u.jsx("label",{htmlFor:"txn-cleared-stacked",style:{fontSize:"0.9rem",cursor:"pointer"},children:"Cleared (appeared in bank account)"})]}),de,v]}),ye]});const oe=S?"8.25rem":"6rem",Se=ee?x?`6rem minmax(8rem, 1fr) minmax(8rem, 1fr) minmax(8rem, 1fr) ${oe} minmax(10rem, 2fr) auto auto`:`6rem minmax(8rem, 1fr) minmax(8rem, 1fr) minmax(8rem, 1fr) ${oe} minmax(10rem, 2fr) auto`:x?`6rem minmax(10rem, 1fr) minmax(10rem, 1fr) ${oe} minmax(12rem, 2fr) auto auto`:`6rem minmax(10rem, 1fr) minmax(10rem, 1fr) ${oe} minmax(12rem, 2fr) auto`;return u.jsxs(xi,{actionName:O,onSubmit:we,children:[u.jsxs("div",{style:{display:"grid",gridTemplateColumns:Se,gap:"1rem",alignItems:"end"},children:[u.jsx(Pt,{label:"Date",htmlFor:"txn-date",children:u.jsx(kf,{id:"txn-date",value:$,onChange:xe=>k(xe.target.value),required:!0,style:J,autoFocus:!0})}),u.jsx(Pt,{label:"Payee",htmlFor:"txn-payee",children:u.jsx(R1,{id:"txn-payee",value:R,onChange:N,payees:i,placeholder:T})}),gt,u.jsx(Pt,{label:C,htmlFor:"txn-account",children:Be}),u.jsx(Pt,{label:S?z?"Amount ()":"Amount (+)":"Amount",htmlFor:"txn-amount",children:S?u.jsxs("div",{className:"currency-with-sign",style:{display:"flex",alignItems:"stretch"},children:[u.jsx("button",{type:"button",onClick:()=>G(!z),style:q1(z),title:z?"Click to make this a refund (+)":"Click to make this an expense (-)",children:z?"":"+"}),u.jsx("div",{style:{flex:1},children:u.jsx(vo,{id:"txn-amount",value:Z,onChange:K,placeholder:"$0.00",required:!0,style:{borderTopLeftRadius:0,borderBottomLeftRadius:0,borderLeft:"none",color:z?me.error:me.success}})})]}):u.jsx(vo,{id:"txn-amount",value:Z,onChange:K,placeholder:"$0.00",required:!0})}),u.jsx(Pt,{label:"Description",htmlFor:"txn-description",children:u.jsx(wi,{id:"txn-description",value:q,onChange:xe=>W(xe.target.value),placeholder:I,style:J})}),yt,L]}),de,v]})}function H1({accounts:t,accountGroups:e,payees:n,initialData:r,defaultAccountId:i,defaultDate:o,onSubmit:l,onCancel:d,onDelete:h,submitLabel:m}){function p(g){l(g.amount,g.accountId,g.date,g.payee,g.description)}return u.jsx(Z0,{accounts:t,accountGroups:e,payees:n,initialData:r?{date:r.date,payee:r.payee,accountId:r.account_id,amount:r.amount,description:r.description}:void 0,defaultAccountId:i,defaultDate:o,config:{showCategory:!1,showCleared:!1,accountLabel:"Deposit To",payeePlaceholder:"e.g., Employer, Client name",descriptionPlaceholder:"e.g., January paycheck",submitLabel:m},onSubmit:p,onCancel:d,onDelete:h})}function DB({income:t,accountName:e,accountGroupName:n,onEdit:r,onDelete:i,isMobile:o,isEvenRow:l}){const d=t.date?new Date(t.date+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"}):"",h=n?`${n} / ${e}`:e,m=l?"transparent":"rgba(255,255,255,0.04)";if(o)return u.jsxs("div",{onClick:r,style:{gridColumn:"1 / -1",display:"grid",gridTemplateColumns:"1fr auto",gap:"0.5rem",padding:"0.75rem 1rem",background:m,cursor:"pointer",transition:"background 0.15s"},children:[u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{style:{fontSize:"0.75rem",opacity:.5,fontFamily:"monospace",minWidth:"3rem"},children:d}),u.jsx("span",{style:{fontWeight:500,fontSize:"0.9rem"},children:t.payee||""})]}),u.jsxs("span",{style:{fontSize:"0.75rem",opacity:.6},children:[" ",h]})]}),u.jsx("div",{style:{display:"flex",alignItems:"center"},children:u.jsxs("span",{style:{fontWeight:600,color:me.success,fontFamily:"monospace"},children:["+",Xe(t.amount)]})})]});const p={padding:"0.6rem 0.5rem",background:m,display:"flex",alignItems:"center",fontSize:"0.9rem"};return u.jsxs("div",{style:{display:"contents"},children:[u.jsx("div",{style:{...p,fontSize:"0.85rem",fontFamily:"monospace"},children:u.jsx("span",{style:{opacity:.6},children:d})}),u.jsx("div",{style:{...p,fontWeight:500,overflow:"hidden"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.payee||""})}),u.jsx("div",{style:{...p,overflow:"hidden"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.85rem",opacity:.7},children:h})}),u.jsxs("div",{style:{...p,justifyContent:"flex-end",fontWeight:600,color:me.success,fontFamily:"monospace"},children:["+",Xe(t.amount)]}),u.jsx("div",{style:{...p,paddingLeft:"0.5rem",overflow:"hidden"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.8rem",opacity:.6},children:t.description||""})}),u.jsxs("div",{style:{...p,justifyContent:"flex-end",gap:"0.25rem"},children:[u.jsx("button",{onClick:r,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:g=>g.currentTarget.style.opacity="1",onMouseLeave:g=>g.currentTarget.style.opacity="0.5",title:"Edit",children:""}),u.jsx("button",{onClick:i,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:g=>g.currentTarget.style.opacity="1",onMouseLeave:g=>g.currentTarget.style.opacity="0.5",title:"Delete",children:""})]})]})}const Al={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderTop:"1px solid rgba(255,255,255,0.1)"};function MB(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n,setCurrentYear:r,setCurrentMonthNumber:i}=Ye(),{accounts:o,accountGroups:l}=An(),{month:d,isLoading:h}=Ci(t,e,n),{addIncome:m}=AP(),{updateIncome:p}=RP(),{deleteIncome:g}=IP(),v=Ei(),[b,E]=D.useState(null),[x,S]=D.useState(!1),[C,T]=D.useState(null),U=P0(t,{enabled:x||C!==null}).data||[];function $(q){const W=q.account_group_id?l[q.account_group_id]:void 0;return W&&W.is_active!==null?W.is_active:q.is_active!==!1}function k(q){const W=q.account_group_id?l[q.account_group_id]:void 0;return W&&W.on_budget!==null?W.on_budget:q.on_budget!==!1}const R=Object.entries(o).filter(([,q])=>$(q)&&k(q)),N=R.filter(([,q])=>q.is_income_account),V=N.length>0?N:R,H=R.find(([,q])=>q.is_income_default),j=H?H[0]:void 0,B=d?.income.reduce((q,W)=>q+W.amount,0)||0;function M(q,W,X,re,z){if(!t)return;E(null),S(!1);const{year:G,month:te}=fm(X);(G!==e||te!==n)&&(r(G),i(te)),m(t,G,te,q,W,X,re,z).catch(se=>{E(se instanceof Error?se.message:"Failed to add income")})}function Z(q,W,X,re,z,G){t&&(E(null),T(null),p(t,e,n,q,W,X,re,z,G).catch(te=>{E(te instanceof Error?te.message:"Failed to update income")}))}function K(q){t&&confirm("Are you sure you want to delete this income entry?")&&(E(null),g(t,e,n,q).catch(W=>{E(W instanceof Error?W.message:"Failed to delete income")}))}return u.jsxs("div",{style:{opacity:h?.5:1,transition:"opacity 0.15s ease-out",pointerEvents:h?"none":"auto"},children:[b&&u.jsx("div",{style:{background:`color-mix(in srgb, ${me.error} 15%, transparent)`,border:`1px solid ${me.error}`,borderRadius:"8px",padding:"0.75rem",marginBottom:"1rem",color:me.error},children:b}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:v?"1fr":"5rem 1.5fr 2fr 7rem 1.5fr 3rem"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"#242424",borderBottom:"1px solid rgba(255,255,255,0.15)",display:v?"block":"grid",gridTemplateColumns:v?void 0:"subgrid"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem"},children:[u.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[u.jsx("span",{style:{fontWeight:600},children:"Income:"}),u.jsx("span",{style:{opacity:.6,fontSize:"0.8rem"},children:"Incoming money that should be factored into income calculations"}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"Total: "}),u.jsx("span",{style:{color:Bt(B),fontWeight:600},children:Xe(B)})]})]}),u.jsx("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:!x&&u.jsx(Ve,{actionName:"Open Add Income Form",onClick:()=>S(!0),disabled:V.length===0,disabledReason:Object.keys(o).length===0?"Create an account first":"Set up an income account first",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:"+ Add Income"})})]}),!v&&u.jsxs(u.Fragment,{children:[u.jsx("div",{style:Al,children:"Date"}),u.jsx("div",{style:Al,children:"Payee"}),u.jsx("div",{style:Al,children:"Account"}),u.jsx("div",{style:{...Al,textAlign:"right"},children:"Amount"}),u.jsx("div",{style:Al,children:"Description"}),u.jsx("div",{style:Al})]})]}),u.jsx("div",{style:{gridColumn:"1 / -1",fontSize:"0.8rem",opacity:.55,fontStyle:"italic",padding:"0.5rem 0"},children:" All income entries on this page count towards the tithing owed calculation."}),V.length===0&&u.jsx(qu,{message:Object.keys(o).length===0?"You need to create at least one account before adding income.":'No accounts are set up for income deposits. Edit an account and enable "Show in income deposit list".',linkText:"Manage accounts",linkTo:"/budget/settings/accounts"}),x&&u.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"1rem"},children:u.jsx(H1,{accounts:V,accountGroups:l,payees:U,defaultAccountId:j,defaultDate:hm(e,n),onSubmit:M,onCancel:()=>S(!1),submitLabel:"Add Income",isMobile:v})}),d?.income.slice().sort((q,W)=>(q.date||"").localeCompare(W.date||"")).map((q,W)=>C===q.id?u.jsx("div",{style:{gridColumn:"1 / -1",padding:"0.5rem"},children:u.jsx(H1,{accounts:V,accountGroups:l,payees:U,initialData:q,onSubmit:(X,re,z,G,te)=>Z(q.id,X,re,z,G,te),onCancel:()=>T(null),onDelete:()=>K(q.id),submitLabel:"Save",isMobile:v})},q.id):u.jsx(DB,{income:q,accountName:et(q.account_id)?ja:o[q.account_id]?.nickname||"Unknown Account",accountGroupName:et(q.account_id)?void 0:o[q.account_id]?.account_group_id?l[o[q.account_id].account_group_id]?.name:void 0,onEdit:()=>{q.payee||`${q.amount}`,T(q.id)},onDelete:()=>K(q.id),isMobile:v,isEvenRow:W%2===0},q.id)),(!d?.income||d.income.length===0)&&!x&&u.jsx("p",{style:{gridColumn:"1 / -1",opacity:.5,fontSize:"0.9rem",textAlign:"center",padding:"1.5rem"},children:"No income recorded for this month"}),u.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]})]})}function G1({accounts:t,accountGroups:e,categories:n,categoryGroups:r,payees:i,initialData:o,defaultAccountId:l,defaultDate:d,onSubmit:h,onCancel:m,onDelete:p,submitLabel:g}){function v(b){h(b.amount,b.categoryId,b.accountId,b.date,b.payee,b.description,b.cleared)}return u.jsx(Z0,{accounts:t,accountGroups:e,categories:n,categoryGroups:r,payees:i,initialData:o?{date:o.date,payee:o.payee,categoryId:o.category_id,accountId:o.account_id,amount:o.amount,description:o.description,cleared:o.cleared}:void 0,defaultAccountId:l,defaultDate:d,config:{showCategory:!0,showCleared:!0,showNoCategoryOption:!1,showNoAccountOption:!1,showSignToggle:!0,accountLabel:"Pay From",payeePlaceholder:"e.g., Grocery Store",descriptionPlaceholder:"e.g., Weekly groceries",submitLabel:g},onSubmit:v,onCancel:m,onDelete:p})}function OB({expense:t,categoryName:e,accountName:n,accountGroupName:r,onEdit:i,onDelete:o,isMobile:l,isEvenRow:d}){const h=t.date?new Date(t.date+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"}):"",m=r?`${r} / ${n}`:n,p=d?"transparent":"rgba(255,255,255,0.04)";if(l)return u.jsxs("div",{onClick:i,style:{gridColumn:"1 / -1",display:"grid",gridTemplateColumns:"1fr auto",gap:"0.5rem",padding:"0.75rem 1rem",background:p,cursor:"pointer",transition:"background 0.15s"},children:[u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{style:{fontSize:"0.75rem",opacity:.5,fontFamily:"monospace",minWidth:"3rem"},children:h}),u.jsx("span",{style:{fontWeight:500,fontSize:"0.9rem"},children:t.payee||""}),t.cleared&&u.jsx("span",{style:{fontSize:"0.7rem",color:me.success},title:"Cleared",children:""})]}),u.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap"},children:[u.jsx("span",{style:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px"},children:e}),u.jsxs("span",{style:{fontSize:"0.75rem",opacity:.6},children:[" ",m]})]})]}),u.jsx("div",{style:{display:"flex",alignItems:"center"},children:u.jsx("span",{style:{fontWeight:600,color:Bt(t.amount),fontFamily:"monospace"},children:Gt(t.amount)})})]});const g={padding:"0.6rem 0.5rem",background:p,display:"flex",alignItems:"center",fontSize:"0.9rem"};return u.jsxs("div",{style:{display:"contents"},children:[u.jsx("div",{style:{...g,fontSize:"0.85rem",fontFamily:"monospace"},children:u.jsx("span",{style:{opacity:.6},children:h})}),u.jsx("div",{style:{...g,fontWeight:500,overflow:"hidden"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.payee||""})}),u.jsx("div",{style:{...g,justifyContent:"center"},children:u.jsx("span",{style:{fontSize:"0.8rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e})}),u.jsx("div",{style:{...g,overflow:"hidden"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.85rem",opacity:.7},children:m})}),u.jsx("div",{style:{...g,justifyContent:"flex-end",fontWeight:600,color:Bt(t.amount),fontFamily:"monospace"},children:Gt(t.amount)}),u.jsx("div",{style:{...g,paddingLeft:"0.5rem",overflow:"hidden"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.8rem",opacity:.6},children:t.description||""})}),u.jsx("div",{style:{...g,justifyContent:"center",color:t.cleared?me.success:"inherit",opacity:t.cleared?1:.3,fontSize:"1rem"},children:t.cleared?"":""}),u.jsxs("div",{style:{...g,justifyContent:"flex-end",gap:"0.25rem"},children:[u.jsx("button",{onClick:i,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:v=>v.currentTarget.style.opacity="1",onMouseLeave:v=>v.currentTarget.style.opacity="0.5",title:"Edit",children:""}),u.jsx("button",{onClick:o,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:v=>v.currentTarget.style.opacity="1",onMouseLeave:v=>v.currentTarget.style.opacity="0.5",title:"Delete",children:""})]})]})}const ia={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderTop:"1px solid rgba(255,255,255,0.1)"};function NB(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n,setCurrentYear:r,setCurrentMonthNumber:i}=Ye(),{accounts:o,accountGroups:l,categories:d,categoryGroups:h}=An(),{month:m,isLoading:p}=Ci(t,e,n),{addExpense:g}=DP(),{updateExpense:v}=OP(),{deleteExpense:b}=NP(),E=Ei(),[x,S]=D.useState(null),[C,T]=D.useState(!1),[I,O]=D.useState(null),k=P0(t,{enabled:C||I!==null}).data||[];function R(X){const re=X.account_group_id?l[X.account_group_id]:void 0;return re&&re.is_active!==null?re.is_active:X.is_active!==!1}function N(X){const re=X.account_group_id?l[X.account_group_id]:void 0;return re&&re.on_budget!==null?re.on_budget:X.on_budget!==!1}const V=Object.entries(o).filter(([,X])=>R(X)&&N(X)),H=V.filter(([,X])=>X.is_outgo_account),j=H.length>0?H:V,B=V.find(([,X])=>X.is_outgo_default),M=B?B[0]:void 0,Z=m?.expenses?.reduce((X,re)=>X+re.amount,0)||0;function K(X,re,z,G,te,se,ie){if(!t)return;S(null),T(!1);const{year:ce,month:we}=fm(G);(ce!==e||we!==n)&&(r(ce),i(we)),g(t,ce,we,X,re,z,G,te,se,ie).catch(he=>{S(he instanceof Error?he.message:"Failed to add expense")})}function q(X,re,z,G,te,se,ie,ce){t&&(S(null),O(null),v(t,e,n,X,re,z,G,te,se,ie,ce).catch(we=>{S(we instanceof Error?we.message:"Failed to update expense")}))}function W(X){t&&confirm("Are you sure you want to delete this expense?")&&(S(null),b(t,e,n,X).catch(re=>{S(re instanceof Error?re.message:"Failed to delete expense")}))}return u.jsxs("div",{style:{opacity:p?.5:1,transition:"opacity 0.15s ease-out",pointerEvents:p?"none":"auto"},children:[x&&u.jsx("div",{style:{background:`color-mix(in srgb, ${me.error} 15%, transparent)`,border:`1px solid ${me.error}`,borderRadius:"8px",padding:"0.75rem",marginBottom:"1rem",color:me.error},children:x}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:E?"1fr":"5rem 1.5fr 7rem 1fr 6rem 1fr 3rem 4rem"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"#242424",borderBottom:"1px solid rgba(255,255,255,0.15)",display:E?"block":"grid",gridTemplateColumns:E?void 0:"subgrid"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem"},children:[u.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[u.jsx("span",{style:{fontWeight:600},children:"Expenses:"}),u.jsx("span",{style:{opacity:.6,fontSize:"0.8rem"},children:"Transactions that should be factored into spend calculations"}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"Total: "}),u.jsx("span",{style:{color:Bt(Z),fontWeight:600},children:Gt(Z)})]})]}),u.jsx("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:!C&&u.jsx(Ve,{actionName:"Open Add Expense Form",onClick:()=>T(!0),disabled:j.length===0||Object.keys(d).length===0,disabledReason:j.length===0&&Object.keys(d).length===0?"Create accounts and categories first":j.length===0?"Create an expense account first":"Create a category first",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:"+ Add Expense"})})]}),!E&&u.jsxs(u.Fragment,{children:[u.jsx("div",{style:ia,children:"Date"}),u.jsx("div",{style:ia,children:"Payee"}),u.jsx("div",{style:{...ia,textAlign:"center"},children:"Category"}),u.jsx("div",{style:ia,children:"Account"}),u.jsx("div",{style:{...ia,textAlign:"right"},children:"Amount"}),u.jsx("div",{style:ia,children:"Description"}),u.jsx("div",{style:{...ia,textAlign:"center"},children:"Clr"}),u.jsx("div",{style:ia})]})]}),j.length===0&&u.jsx(qu,{message:Object.keys(o).length===0?"You need to create at least one account before adding expenses.":'No accounts are set up for expenses. Edit an account and enable "Show in expense list".',linkText:"Manage accounts",linkTo:"/budget/settings/accounts"}),Object.keys(d).length===0&&u.jsx(qu,{message:"You need to create at least one category before adding expenses.",linkText:"Create categories",linkTo:"/budget/settings/categories"}),C&&u.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"1rem"},children:u.jsx(G1,{accounts:j,accountGroups:l,categories:d,categoryGroups:h,payees:k,defaultAccountId:M,defaultDate:hm(e,n),onSubmit:K,onCancel:()=>T(!1),submitLabel:"Add Expense",isMobile:E})}),m?.expenses?.slice().sort((X,re)=>(X.date||"").localeCompare(re.date||"")).map((X,re)=>I===X.id?u.jsx("div",{style:{gridColumn:"1 / -1",padding:"0.5rem"},children:u.jsx(G1,{accounts:j,accountGroups:l,categories:d,categoryGroups:h,payees:k,initialData:X,onSubmit:(z,G,te,se,ie,ce,we)=>q(X.id,z,G,te,se,ie,ce,we),onCancel:()=>O(null),onDelete:()=>W(X.id),submitLabel:"Save",isMobile:E})},X.id):u.jsx(OB,{expense:X,categoryName:at(X.category_id)?Io:d[X.category_id]?.name||"Unknown Category",accountName:et(X.account_id)?ja:o[X.account_id]?.nickname||"Unknown Account",accountGroupName:et(X.account_id)?void 0:o[X.account_id]?.account_group_id?l[o[X.account_id].account_group_id]?.name:void 0,onEdit:()=>{X.payee||`${X.amount}`,O(X.id)},onDelete:()=>W(X.id),isMobile:E,isEvenRow:re%2===0},X.id)),(!m?.expenses||m.expenses.length===0)&&!C&&u.jsx("p",{style:{gridColumn:"1 / -1",opacity:.5,fontSize:"0.9rem",textAlign:"center",padding:"1.5rem"},children:"No expenses recorded for this month"}),u.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]})]})}const PB={background:me.primary,border:"none",cursor:"pointer",fontSize:"0.9rem",padding:"0.35rem 0.5rem",borderRadius:"4px",color:"white"},BB={background:"transparent",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)",cursor:"pointer",fontSize:"0.9rem",padding:"0.35rem 0.5rem",borderRadius:"4px"},zB={background:"transparent",border:`1px solid ${me.errorBorder}`,color:me.error,cursor:"pointer",fontSize:"0.9rem",padding:"0.35rem 0.5rem",borderRadius:"4px"};function Q1({accounts:t,accountGroups:e,categories:n,categoryGroups:r,initialData:i,defaultDate:o,onSubmit:l,onCancel:d,onDelete:h,submitLabel:m}){const{isWide:p}=OT(),g=new Date().toISOString().split("T")[0],[v,b]=D.useState(i?.date||o||g),[E,x]=D.useState(i?.amount?.toString()||""),[S,C]=D.useState(i?.from_account_id||qt),[T,I]=D.useState(i?.to_account_id||qt),[O,U]=D.useState(i?.from_category_id||Kt),[$,k]=D.useState(i?.to_category_id||Kt),[R,N]=D.useState(i?.description||""),[V,H]=D.useState(i?.cleared||!1),[j,B]=D.useState(null),M=O===Kt,Z=$===Kt,K=S===qt,q=T===qt;function W(){return M&&Z&&(K&&q)?'A transfer must move between real categories or real accounts  not all "No" options.':K!==q?'Both accounts must be real accounts, or both must be "No Account". Cannot transfer from a real account to nothing.':M!==Z?'Both categories must be real categories, or both must be "No Category". Cannot transfer from a real category to nothing.':null}W()===null&&j!==null&&B(null);function re(he){he.preventDefault();const Ee=parseFloat(E);if(isNaN(Ee)||Ee<=0||!S||!T||!O||!$||!v)return;const Ue=W();if(Ue){B(Ue);return}B(null),l(Ee,S,T,O,$,v,R.trim()||void 0,V)}const z=j?u.jsx("div",{style:{background:`color-mix(in srgb, ${me.error} 15%, transparent)`,border:`1px solid ${me.errorBorder}`,borderRadius:"6px",padding:"0.5rem 0.75rem",fontSize:"0.85rem",color:me.error,marginTop:"0.5rem"},children:j}):null,G=(he,Ee,Ue,Be)=>u.jsx(Pt,{label:Be,htmlFor:he,children:u.jsx(MT,{id:he,value:Ee,onChange:Ue,accounts:t,accountGroups:e,placeholder:ja,required:!0,showNoAccountOption:!0})}),te=(he,Ee,Ue,Be)=>u.jsx(Pt,{label:Be,htmlFor:he,children:u.jsx(DT,{id:he,value:Ee,onChange:Ue,categories:n,categoryGroups:r,placeholder:Io,required:!0,showNoCategoryOption:!0})}),se=u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.25rem",paddingBottom:"0.35rem"},children:[u.jsx("label",{htmlFor:"transfer-cleared",style:{fontSize:"0.75rem",opacity:.7,fontWeight:500},children:"Clr"}),u.jsx($r,{id:"transfer-cleared",checked:V,onChange:he=>H(he.target.checked)})]}),ie=u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.25rem",paddingBottom:"0.1rem"},children:[u.jsx("span",{style:{fontSize:"0.75rem",opacity:.7,fontWeight:500},children:""}),u.jsxs("div",{style:{display:"flex",gap:"0.25rem"},children:[u.jsx("button",{type:"submit",title:m,style:PB,children:""}),u.jsx("button",{type:"button",onClick:()=>{d()},title:"Cancel",style:BB,children:""}),h&&u.jsx("button",{type:"button",onClick:()=>{h()},title:"Delete",style:zB,children:""})]})]}),ce=u.jsxs(Pa,{children:[u.jsx(Ve,{type:"submit",actionName:m,children:m}),u.jsx(Ve,{type:"button",variant:"secondary",actionName:"Cancel Transfer Form",onClick:d,children:"Cancel"}),h&&u.jsx(Ve,{type:"button",variant:"danger",actionName:"Delete Transfer",onClick:h,children:" Delete"})]}),we={fontSize:"0.85rem",padding:"0.5rem"};return p?u.jsx(xi,{actionName:m,onSubmit:re,children:u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[u.jsxs("div",{style:{display:"grid",gridTemplateColumns:"5.5rem 5.5rem 1fr 1fr 1.5fr",gap:"0.75rem",alignItems:"end"},children:[u.jsx(Pt,{label:"Date",htmlFor:"transfer-date",children:u.jsx(kf,{id:"transfer-date",value:v,onChange:he=>b(he.target.value),required:!0,style:we,autoFocus:!0})}),u.jsx(Pt,{label:"Amount",htmlFor:"transfer-amount",children:u.jsx(vo,{id:"transfer-amount",value:E,onChange:x,placeholder:"$0.00",required:!0})}),te("from-category",O,U,"From Category"),G("from-account",S,C,"From Account"),u.jsx(Pt,{label:"Description",htmlFor:"transfer-description",children:u.jsx(wi,{id:"transfer-description",value:R,onChange:he=>N(he.target.value),placeholder:"e.g., Transfer",style:we})})]}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:"5.5rem 5.5rem 1fr 1fr 1.5fr",gap:"0.75rem",alignItems:"end"},children:[u.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1.2rem",opacity:.5,paddingBottom:"0.5rem"},children:""}),u.jsx("div",{}),te("to-category",$,k,"To Category"),G("to-account",T,I,"To Account"),u.jsxs("div",{style:{display:"flex",gap:"0.75rem",alignItems:"end",paddingBottom:"0.25rem"},children:[se,ie]})]}),z]})}):u.jsxs(xi,{actionName:m,onSubmit:re,children:[u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:[u.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[u.jsx(Pt,{label:"Date",htmlFor:"transfer-date",children:u.jsx(kf,{id:"transfer-date",value:v,onChange:he=>b(he.target.value),required:!0,autoFocus:!0})}),u.jsx(Pt,{label:"Amount",htmlFor:"transfer-amount",children:u.jsx(vo,{id:"transfer-amount",value:E,onChange:x,placeholder:"$0.00",required:!0})})]}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem",background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1rem",borderRadius:"8px"},children:[u.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"0.75rem",alignItems:"end"},children:[te("from-category",O,U,"From Cat."),G("from-account",S,C,"From Acct.")]}),u.jsx("div",{style:{display:"flex",justifyContent:"center",fontSize:"1.5rem",opacity:.5},children:""}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"0.75rem",alignItems:"end"},children:[te("to-category",$,k,"To Cat."),G("to-account",T,I,"To Acct.")]})]}),u.jsx(Pt,{label:"Description (optional)",htmlFor:"transfer-description",children:u.jsx(wi,{id:"transfer-description",value:R,onChange:he=>N(he.target.value),placeholder:"e.g., Transfer to savings"})}),u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx($r,{id:"transfer-cleared-stacked",checked:V,onChange:he=>H(he.target.checked)}),u.jsx("label",{htmlFor:"transfer-cleared-stacked",style:{fontSize:"0.9rem",cursor:"pointer"},children:"Cleared (appeared in bank account)"})]}),z]}),ce]})}function LB({transfer:t,fromCategoryName:e,toCategoryName:n,fromAccountName:r,toAccountName:i,fromAccountGroupName:o,toAccountGroupName:l,isFromCategoryNo:d,isToCategoryNo:h,isFromAccountNo:m,isToAccountNo:p,onEdit:g,onDelete:v,isMobile:b,isEvenRow:E}){const x=t.date?new Date(t.date+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"}):"",S=E?"transparent":"rgba(255,255,255,0.04)";if(b)return u.jsxs("div",{onClick:g,style:{gridColumn:"1 / -1",display:"flex",flexDirection:"column",gap:"0.5rem",padding:"0.75rem 1rem",background:S,cursor:"pointer",transition:"background 0.15s"},children:[u.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{style:{fontSize:"0.75rem",opacity:.5,fontFamily:"monospace",minWidth:"3rem"},children:x}),u.jsx("span",{style:{fontWeight:600,opacity:.8,fontFamily:"monospace"},children:Xe(t.amount)}),t.cleared&&u.jsx("span",{style:{fontSize:"0.7rem",color:me.success},title:"Cleared",children:""})]})}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto 1fr",gap:"0.5rem",alignItems:"center"},children:[u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[u.jsx("span",{style:d?{fontSize:"0.7rem",opacity:.4}:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px",display:"inline-block",width:"fit-content"},children:e}),m?u.jsx("span",{style:{fontSize:"0.75rem",opacity:.4},children:r}):u.jsxs("div",{style:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px",display:"inline-flex",flexDirection:"column",gap:"0.1rem",width:"fit-content"},children:[o&&u.jsx("span",{style:{fontSize:"0.65rem",opacity:.6},children:o}),u.jsx("span",{children:r})]})]}),u.jsx("span",{style:{opacity:.5},children:""}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[u.jsx("span",{style:h?{fontSize:"0.7rem",opacity:.4}:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px",display:"inline-block",width:"fit-content"},children:n}),p?u.jsx("span",{style:{fontSize:"0.75rem",opacity:.4},children:i}):u.jsxs("div",{style:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px",display:"inline-flex",flexDirection:"column",gap:"0.1rem",width:"fit-content"},children:[l&&u.jsx("span",{style:{fontSize:"0.65rem",opacity:.6},children:l}),u.jsx("span",{children:i})]})]})]}),t.description&&u.jsx("div",{style:{fontSize:"0.75rem",opacity:.6},children:t.description})]});const C={padding:"0.6rem 0.5rem",background:S,display:"flex",alignItems:"center",fontSize:"0.9rem"};return u.jsxs("div",{style:{display:"contents"},children:[u.jsx("div",{style:{...C,fontSize:"0.85rem",fontFamily:"monospace"},children:u.jsx("span",{style:{opacity:.6},children:x})}),u.jsx("div",{style:{...C,justifyContent:"flex-end",fontWeight:600,opacity:.8,fontFamily:"monospace"},children:Xe(t.amount)}),u.jsx("div",{style:{...C,justifyContent:"center"},children:u.jsx("span",{style:d?{fontSize:"0.8rem",opacity:.4}:{fontSize:"0.8rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e})}),u.jsx("div",{style:{...C,overflow:"hidden"},children:m?u.jsx("span",{style:{opacity:.4,fontSize:"0.85rem"},children:r}):u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.1rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden"},children:[o&&u.jsx("span",{style:{fontSize:"0.7rem",opacity:.6,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:o}),u.jsx("span",{style:{fontSize:"0.8rem",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:r})]})}),u.jsx("div",{style:{...C,justifyContent:"center",fontSize:"1rem"},children:u.jsx("span",{style:{opacity:.5},children:""})}),u.jsx("div",{style:{...C,justifyContent:"center"},children:u.jsx("span",{style:h?{fontSize:"0.8rem",opacity:.4}:{fontSize:"0.8rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:n})}),u.jsx("div",{style:{...C,overflow:"hidden"},children:p?u.jsx("span",{style:{opacity:.4,fontSize:"0.85rem"},children:i}):u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.1rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden"},children:[l&&u.jsx("span",{style:{fontSize:"0.7rem",opacity:.6,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:l}),u.jsx("span",{style:{fontSize:"0.8rem",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:i})]})}),u.jsx("div",{style:{...C,paddingLeft:"0.5rem",overflow:"hidden"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.8rem",opacity:.6},children:t.description||""})}),u.jsx("div",{style:{...C,justifyContent:"center",color:t.cleared?me.success:"inherit",opacity:t.cleared?1:.3,fontSize:"1rem"},children:t.cleared?"":""}),u.jsxs("div",{style:{...C,justifyContent:"flex-end",gap:"0.25rem"},children:[u.jsx("button",{onClick:g,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:T=>T.currentTarget.style.opacity="1",onMouseLeave:T=>T.currentTarget.style.opacity="0.5",title:"Edit",children:""}),u.jsx("button",{onClick:v,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:T=>T.currentTarget.style.opacity="1",onMouseLeave:T=>T.currentTarget.style.opacity="0.5",title:"Delete",children:""})]})]})}const Ns={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderTop:"1px solid rgba(255,255,255,0.1)"};function UB(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n,setCurrentYear:r,setCurrentMonthNumber:i}=Ye(),{accounts:o,accountGroups:l,categories:d,categoryGroups:h}=An(),{month:m,isLoading:p}=Ci(t,e,n),{addTransfer:g}=BP(),{updateTransfer:v}=LP(),{deleteTransfer:b}=UP(),E=Ei(),[x,S]=D.useState(null),[C,T]=D.useState(!1),[I,O]=D.useState(null);function U(j){const B=j.account_group_id?l[j.account_group_id]:void 0;return B&&B.is_active!==null?B.is_active:j.is_active!==!1}function $(j){const B=j.account_group_id?l[j.account_group_id]:void 0;return B&&B.on_budget!==null?B.on_budget:j.on_budget!==!1}const k=Object.entries(o).filter(([,j])=>U(j)&&$(j));function R(j,B,M,Z,K,q,W,X){if(!t)return;S(null),T(!1);const{year:re,month:z}=fm(q);(re!==e||z!==n)&&(r(re),i(z)),g(t,re,z,j,B,M,Z,K,q,W,X).catch(G=>{S(G instanceof Error?G.message:"Failed to add transfer")})}function N(j,B,M,Z,K,q,W,X,re){t&&(S(null),O(null),v(t,e,n,j,B,M,Z,K,q,W,X,re).catch(z=>{S(z instanceof Error?z.message:"Failed to update transfer")}))}function V(j){t&&confirm("Are you sure you want to delete this transfer?")&&(S(null),b(t,e,n,j).catch(B=>{S(B instanceof Error?B.message:"Failed to delete transfer")}))}const H=k.length>=1&&Object.keys(d).length>=1;return u.jsxs("div",{style:{opacity:p?.5:1,transition:"opacity 0.15s ease-out",pointerEvents:p?"none":"auto"},children:[x&&u.jsx("div",{style:{background:`color-mix(in srgb, ${me.error} 15%, transparent)`,border:`1px solid ${me.error}`,borderRadius:"8px",padding:"0.75rem",marginBottom:"1rem",color:me.error},children:x}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:E?"1fr":"5rem 6rem 1fr 1fr 2rem 1fr 1fr 1fr 3rem 4rem"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"#242424",borderBottom:"1px solid rgba(255,255,255,0.15)",display:E?"block":"grid",gridTemplateColumns:E?void 0:"subgrid"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem"},children:[u.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[u.jsx("span",{style:{fontWeight:600},children:"Transfers:"}),u.jsx("span",{style:{opacity:.6,fontSize:"0.8rem"},children:"Moving money between accounts and categories within the budget"})]}),u.jsx("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:!C&&u.jsx(Ve,{actionName:"Open Add Transfer Form",onClick:()=>T(!0),disabled:!H,disabledReason:k.length===0&&Object.keys(d).length===0?"Create accounts and categories first":k.length===0?"Create an account first":"Create a category first",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:"+ Add Transfer"})})]}),!E&&u.jsxs(u.Fragment,{children:[u.jsx("div",{style:Ns,children:"Date"}),u.jsx("div",{style:{...Ns,textAlign:"right"},children:"Amount"}),u.jsx("div",{style:{...Ns,textAlign:"center"},children:"From Cat"}),u.jsx("div",{style:Ns,children:"From Acct"}),u.jsx("div",{style:Ns}),u.jsx("div",{style:{...Ns,textAlign:"center"},children:"To Cat"}),u.jsx("div",{style:Ns,children:"To Acct"}),u.jsx("div",{style:Ns,children:"Description"}),u.jsx("div",{style:{...Ns,textAlign:"center"},children:"Clr"}),u.jsx("div",{style:Ns})]})]}),!H&&u.jsx(qu,{message:"You need at least one account and one category before adding transfers.",linkText:"Manage accounts",linkTo:"/budget/settings/accounts"}),C&&u.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"1rem"},children:u.jsx(Q1,{accounts:k,accountGroups:l,categories:d,categoryGroups:h,defaultDate:hm(e,n),onSubmit:R,onCancel:()=>T(!1),submitLabel:"Add Transfer"})}),m?.transfers?.slice().sort((j,B)=>(j.date||"").localeCompare(B.date||"")).map((j,B)=>I===j.id?u.jsx("div",{style:{gridColumn:"1 / -1",padding:"0.5rem"},children:u.jsx(Q1,{accounts:k,accountGroups:l,categories:d,categoryGroups:h,initialData:j,onSubmit:(M,Z,K,q,W,X,re,z)=>N(j.id,M,Z,K,q,W,X,re,z),onCancel:()=>O(null),onDelete:()=>V(j.id),submitLabel:"Save"})},j.id):u.jsx(LB,{transfer:j,fromCategoryName:at(j.from_category_id)?Io:d[j.from_category_id]?.name||"Unknown",toCategoryName:at(j.to_category_id)?Io:d[j.to_category_id]?.name||"Unknown",fromAccountName:et(j.from_account_id)?ja:o[j.from_account_id]?.nickname||"Unknown",toAccountName:et(j.to_account_id)?ja:o[j.to_account_id]?.nickname||"Unknown",fromAccountGroupName:et(j.from_account_id)?void 0:o[j.from_account_id]?.account_group_id?l[o[j.from_account_id].account_group_id]?.name:void 0,toAccountGroupName:et(j.to_account_id)?void 0:o[j.to_account_id]?.account_group_id?l[o[j.to_account_id].account_group_id]?.name:void 0,isFromCategoryNo:at(j.from_category_id),isToCategoryNo:at(j.to_category_id),isFromAccountNo:et(j.from_account_id),isToAccountNo:et(j.to_account_id),onEdit:()=>{j.description||`${j.amount}`,O(j.id)},onDelete:()=>V(j.id),isMobile:E,isEvenRow:B%2===0},j.id)),(!m?.transfers||m.transfers.length===0)&&!C&&u.jsx("p",{style:{gridColumn:"1 / -1",opacity:.5,fontSize:"0.9rem",textAlign:"center",padding:"1.5rem"},children:"No transfers recorded for this month"}),u.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]})]})}function W1({accounts:t,accountGroups:e,categories:n,categoryGroups:r,payees:i,initialData:o,defaultAccountId:l,defaultDate:d,onSubmit:h,onCancel:m,onDelete:p,submitLabel:g}){function v(b){h(b.amount,b.accountId,b.categoryId,b.date,b.payee,b.description,b.cleared)}return u.jsx(Z0,{accounts:t,accountGroups:e,categories:n,categoryGroups:r,payees:i,initialData:o?{date:o.date,payee:o.payee,categoryId:o.category_id,accountId:o.account_id,amount:o.amount,description:o.description,cleared:o.cleared}:void 0,defaultAccountId:l,defaultDate:d,config:{showCategory:!0,showCleared:!0,showNoCategoryOption:!0,showNoAccountOption:!0,showSignToggle:!0,accountLabel:"Account",payeePlaceholder:"e.g., Bank, Interest source",descriptionPlaceholder:"e.g., Starting balance, Correction",submitLabel:g},onSubmit:v,onCancel:m,onDelete:p})}function FB({adjustment:t,categoryName:e,accountName:n,accountGroupName:r,onEdit:i,onDelete:o,isMobile:l,isEvenRow:d}){const h=t.date?new Date(t.date+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"}):"",m=r?`${r} / ${n}`:n,p=d?"transparent":"rgba(255,255,255,0.04)";if(l)return u.jsxs("div",{onClick:i,style:{gridColumn:"1 / -1",display:"flex",flexDirection:"column",gap:"0.25rem",padding:"0.75rem 1rem",background:p,cursor:"pointer",transition:"background 0.15s"},children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{style:{fontSize:"0.75rem",opacity:.5,fontFamily:"monospace"},children:h}),t.cleared&&u.jsx("span",{style:{fontSize:"0.7rem",color:me.success},title:"Cleared",children:""})]}),u.jsx("span",{style:{fontWeight:600,color:Bt(t.amount),fontFamily:"monospace"},children:Gt(t.amount)})]}),u.jsx("div",{style:{fontWeight:500,fontSize:"0.9rem"},children:t.description||"Adjustment"}),u.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap",alignItems:"center"},children:[u.jsx("span",{style:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px"},children:e}),u.jsx("span",{style:{fontSize:"0.75rem",opacity:.6},children:m})]})]});const g={padding:"0.6rem 0.5rem",background:p,display:"flex",alignItems:"center",fontSize:"0.9rem"};return u.jsxs("div",{style:{display:"contents"},children:[u.jsx("div",{style:{...g,fontSize:"0.85rem",fontFamily:"monospace"},children:u.jsx("span",{style:{opacity:.6},children:h})}),u.jsx("div",{style:{...g,justifyContent:"center"},children:u.jsx("span",{style:{fontSize:"0.8rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e})}),u.jsx("div",{style:{...g,overflow:"hidden"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.85rem",opacity:.7},children:m})}),u.jsx("div",{style:{...g,justifyContent:"flex-end",fontWeight:600,color:Bt(t.amount),fontFamily:"monospace"},children:Gt(t.amount)}),u.jsx("div",{style:{...g,paddingLeft:"0.5rem",overflow:"hidden"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.8rem",opacity:.6},children:t.description||""})}),u.jsx("div",{style:{...g,justifyContent:"center",color:t.cleared?me.success:"inherit",opacity:t.cleared?1:.3,fontSize:"1rem"},children:t.cleared?"":""}),u.jsxs("div",{style:{...g,justifyContent:"flex-end",gap:"0.25rem"},children:[u.jsx("button",{onClick:i,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:v=>v.currentTarget.style.opacity="1",onMouseLeave:v=>v.currentTarget.style.opacity="0.5",title:"Edit",children:""}),u.jsx("button",{onClick:o,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:v=>v.currentTarget.style.opacity="1",onMouseLeave:v=>v.currentTarget.style.opacity="0.5",title:"Delete",children:""})]})]})}const po={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderTop:"1px solid rgba(255,255,255,0.1)"};function VB(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n,setCurrentYear:r,setCurrentMonthNumber:i}=Ye(),{accounts:o,accountGroups:l,categories:d,categoryGroups:h}=An(),{month:m,isLoading:p}=Ci(t,e,n),{addAdjustment:g}=VP(),{updateAdjustment:v}=qP(),{deleteAdjustment:b}=HP(),E=Ei(),[x,S]=D.useState(null),[C,T]=D.useState(!1),[I,O]=D.useState(null),k=P0(t,{enabled:C||I!==null}).data||[];function R(M){const Z=M.account_group_id?l[M.account_group_id]:void 0;return Z&&Z.is_active!==null?Z.is_active:M.is_active!==!1}function N(M){const Z=M.account_group_id?l[M.account_group_id]:void 0;return Z&&Z.on_budget!==null?Z.on_budget:M.on_budget!==!1}const V=Object.entries(o).filter(([,M])=>R(M)&&N(M));function H(M,Z,K,q,W,X,re){if(!t)return;S(null),T(!1);const{year:z,month:G}=fm(q);(z!==e||G!==n)&&(r(z),i(G)),g(t,z,G,M,Z,K,q,W,X,re).catch(te=>{S(te instanceof Error?te.message:"Failed to add adjustment")})}function j(M,Z,K,q,W,X,re,z){t&&(S(null),O(null),v(t,e,n,M,Z,K,q,W,X,re,z).catch(G=>{S(G instanceof Error?G.message:"Failed to update adjustment")}))}function B(M){t&&confirm("Are you sure you want to delete this adjustment?")&&(S(null),b(t,e,n,M).catch(Z=>{S(Z instanceof Error?Z.message:"Failed to delete adjustment")}))}return u.jsxs("div",{style:{opacity:p?.5:1,transition:"opacity 0.15s ease-out",pointerEvents:p?"none":"auto"},children:[x&&u.jsx("div",{style:{background:`color-mix(in srgb, ${me.error} 15%, transparent)`,border:`1px solid ${me.error}`,borderRadius:"8px",padding:"0.75rem",marginBottom:"1rem",color:me.error},children:x}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:E?"1fr":"5rem 1fr 1fr 6rem 1.5fr 3rem 4rem"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"#242424",borderBottom:"1px solid rgba(255,255,255,0.15)",display:E?"block":"grid",gridTemplateColumns:E?void 0:"subgrid"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem"},children:[u.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[u.jsx("span",{style:{fontWeight:600},children:"Adjustments:"}),u.jsx("span",{style:{opacity:.6,fontSize:"0.8rem"},children:"Incoming or outgoing transactions that should bypass income and spend calculations"})]}),u.jsx("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:!C&&u.jsx(Ve,{actionName:"Open Add Adjustment Form",onClick:()=>T(!0),disabled:Object.keys(d).length===0&&V.length===0,disabledReason:"Create an account or category first",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:"+ Add Adjustment"})})]}),!E&&u.jsxs(u.Fragment,{children:[u.jsx("div",{style:po,children:"Date"}),u.jsx("div",{style:{...po,textAlign:"center"},children:"Category"}),u.jsx("div",{style:po,children:"Account"}),u.jsx("div",{style:{...po,textAlign:"right"},children:"Amount"}),u.jsx("div",{style:po,children:"Description"}),u.jsx("div",{style:{...po,textAlign:"center"},children:"Clr"}),u.jsx("div",{style:po})]})]}),V.length===0&&Object.keys(d).length===0&&u.jsx(qu,{message:"You need to create at least one account or category before adding adjustments.",linkText:"Manage accounts",linkTo:"/budget/settings/accounts"}),C&&u.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"1rem"},children:u.jsx(W1,{accounts:V,accountGroups:l,categories:d,categoryGroups:h,payees:k,defaultDate:hm(e,n),onSubmit:H,onCancel:()=>T(!1),submitLabel:"Add Adjustment"})}),m?.adjustments?.slice().sort((M,Z)=>(M.date||"").localeCompare(Z.date||"")).map((M,Z)=>I===M.id?u.jsx("div",{style:{gridColumn:"1 / -1",padding:"0.5rem"},children:u.jsx(W1,{accounts:V,accountGroups:l,categories:d,categoryGroups:h,payees:k,initialData:M,onSubmit:(K,q,W,X,re,z,G)=>j(M.id,K,q,W,X,re,z,G),onCancel:()=>O(null),onDelete:()=>B(M.id),submitLabel:"Save"})},M.id):u.jsx(FB,{adjustment:M,categoryName:at(M.category_id)?Io:d[M.category_id]?.name||"Unknown Category",accountName:et(M.account_id)?ja:o[M.account_id]?.nickname||"Unknown Account",accountGroupName:et(M.account_id)?void 0:o[M.account_id]?.account_group_id?l[o[M.account_id].account_group_id]?.name:void 0,onEdit:()=>{M.description||`${M.amount}`,O(M.id)},onDelete:()=>B(M.id),isMobile:E,isEvenRow:Z%2===0},M.id)),(!m?.adjustments||m.adjustments.length===0)&&!C&&u.jsx("p",{style:{gridColumn:"1 / -1",opacity:.5,fontSize:"0.9rem",textAlign:"center",padding:"1.5rem"},children:"No adjustments recorded for this month"}),u.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]})]})}function $B({isOpen:t,onClose:e,onDeleted:n}){const{addLoadingHold:r,removeLoadingHold:i}=Gn(),{selectedBudgetId:o,currentYear:l,currentMonthNumber:d}=Ye(),{deleteAllocations:h}=YT(),[m,p]=D.useState(null),g=async()=>{if(o){p(null),r("allocations-delete","Deleting allocations...");try{await h({budgetId:o,year:l,month:d}),e(),n?.()}catch(v){p(v instanceof Error?v.message:"Failed to delete allocations")}finally{i("allocations-delete")}}};return u.jsxs(ls,{isOpen:t,onClose:e,title:"Delete Allocations",children:[m&&u.jsx(mm,{message:m,onDismiss:()=>p(null)}),u.jsx("p",{style:{margin:"0 0 1.5rem 0"},children:"Are you sure you want to delete all allocations for this month? This will remove all allocated amounts and reset the month to unfinalized."}),u.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[u.jsx(Ve,{actionName:"Cancel Delete Allocations",variant:"secondary",onClick:e,children:"Cancel"}),u.jsx(Ve,{actionName:"Confirm Delete Allocations",variant:"danger",onClick:g,children:"Delete Allocations"})]})]})}function rA({isDraftMode:t,isEditingAppliedAllocations:e,availableNow:n,currentMonthIncome:r,balanceTotals:i,draftChangeAmount:o,availableAfterApply:l,currentDraftTotal:d}){const h=t&&d!==void 0?d:i.allocated;return u.jsxs(u.Fragment,{children:[u.jsx("span",{style:{fontWeight:600,marginRight:"0.25rem"},children:t||e?"Allocations Worksheet:":"Month Summary:"}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:t?"Avail: ":"Inc: "}),t?u.jsx("span",{style:{color:Bt(n),fontWeight:600},children:Xe(n)}):u.jsxs("span",{style:{color:me.success,fontWeight:600},children:["+",Xe(r)]})]}),u.jsxs("span",{children:[t&&u.jsx("span",{style:{opacity:.6},children:" "}),u.jsx("span",{style:{opacity:.6},children:t?"Draft: ":"Alloc: "}),u.jsxs("span",{style:{color:pc(t?h:i.allocated),fontWeight:600,...t?as:{}},children:[t?"":"+",Xe(t?h:i.allocated)]}),e&&o!==0&&u.jsxs("span",{style:{fontSize:"0.85em",color:o>0?me.warning:me.success,marginLeft:"0.25rem"},children:["(",Gt(o),")"]})]}),!t&&u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"Spent: "}),u.jsx("span",{style:{color:mc(i.spent),fontWeight:600},children:za(i.spent)})]}),u.jsxs("span",{children:[t&&u.jsx("span",{style:{opacity:.6},children:"= "}),u.jsx("span",{style:{opacity:.6},children:t?"Remaining: ":"Net: "}),t?u.jsx("span",{style:{color:Bt(l),fontWeight:600,...as},children:Xe(l)}):u.jsx("span",{style:{color:Bt(i.allocated+i.spent),fontWeight:600},children:Xe(i.allocated+i.spent)})]})]})}function qB({totals:t}){return u.jsxs(u.Fragment,{children:[u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"Start: "}),u.jsx("span",{style:{color:Bt(t.start),fontWeight:600},children:Xe(t.start)})]}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"Inc: "}),u.jsxs("span",{style:{color:me.success,fontWeight:600},children:["+",Xe(t.income)]})]}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"Exp: "}),u.jsx("span",{style:{color:mc(t.expenses),fontWeight:600},children:za(t.expenses)})]}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"End: "}),u.jsx("span",{style:{color:Bt(t.end),fontWeight:600},children:Xe(t.end)})]})]})}function J0({isDraftMode:t,isEditingAppliedAllocations:e,allocationsFinalized:n,onSave:r,onApply:i,onEdit:o,onCancel:l,onDelete:d}){return u.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:[t&&!e&&u.jsxs(u.Fragment,{children:[u.jsx(Ve,{actionName:"Save Draft Allocations",onClick:r,variant:"secondary",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:" Save"}),u.jsx(Ve,{actionName:"Apply Allocations",onClick:i,variant:"secondary",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:" Apply"})]}),!t&&n&&u.jsx(Ve,{actionName:"Edit Allocations",onClick:o,variant:"secondary",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:" Edit Allocations"}),e&&u.jsxs(u.Fragment,{children:[u.jsx(Ve,{actionName:"Apply Allocations",onClick:i,variant:"secondary",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:" Apply"}),u.jsx(Ve,{actionName:"Cancel Edit Allocations",onClick:l,variant:"secondary",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:""}),u.jsx(Ve,{actionName:"Open Delete Allocations Modal",onClick:d,variant:"secondary",style:{fontSize:"0.8rem",padding:"0.4em 0.8em",color:me.error},children:""})]})]})}function K1(t){return t===0?me.zero:t>0?me.success:me.error}function HB({category:t,balance:e,localAllocation:n,previousMonthIncome:r,isDraftMode:i,onAllocationChange:o,projectedAllTime:l}){const d=t.default_monthly_type==="percentage"&&t.default_monthly_amount!==void 0&&t.default_monthly_amount>0,h=d?t.default_monthly_amount/100*r:0,m=d?h.toFixed(2):n,p=i&&!d,g=i?l:t.balance??0,v=t.balance??0,b=v<0,E=b?Math.abs(v):0,x=d?h:parseFloat(n)||0,S=b?Math.min(x,E):0,C=b?Math.max(0,x-E):0,T=b&&x>0&&C>0;return u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",padding:"0.75rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem"},children:u.jsx("span",{style:{fontWeight:500},children:t.name})}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr 1fr 1fr",gap:"0.25rem",fontSize:"0.75rem"},children:[u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:"Start"}),u.jsx("span",{style:{color:Mn(e.start_balance)},children:os(e.start_balance)})]}),u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:"Alloc"}),p?u.jsxs(u.Fragment,{children:[u.jsx("input",{type:"text",inputMode:"decimal",value:m?`$${m}`:"",onChange:I=>{const O=I.target.value.replace(/[^\d.]/g,"");o(O)},placeholder:"$0",style:{width:"100%",maxWidth:"80px",padding:"0.25rem 0.35rem",borderRadius:"4px",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",background:"color-mix(in srgb, currentColor 8%, transparent)",fontSize:"0.8rem",color:"inherit",boxSizing:"border-box"}}),b&&x>0&&u.jsxs("div",{style:{fontSize:"0.65rem",marginTop:"0.15rem",lineHeight:1.3},children:[u.jsxs("span",{style:{color:me.debt,display:"block"},children:[Xe(S),"  debt"]}),T&&u.jsxs("span",{style:{color:me.success,display:"block"},children:[Xe(C),"  balance"]})]})]}):u.jsx("span",{style:{color:pc(e.allocated)},children:Gt(e.allocated)})]}),u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:"Spent"}),u.jsx("span",{style:{color:mc(e.spent)},children:za(e.spent)})]}),u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:"End"}),u.jsx("span",{style:{color:Mn(e.end_balance),...i&&!d?as:{}},children:os(e.end_balance)})]}),u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:i?"Proj. All-Time":"All-Time"}),u.jsx("span",{style:{color:Mn(g),...i&&!d?as:{}},children:os(g)})]})]}),(e.transfers!==0||e.adjustments!==0)&&u.jsxs("div",{style:{marginTop:"0.5rem",paddingTop:"0.5rem",borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)",display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",fontSize:"0.7rem",opacity:.7},children:[e.transfers!==0&&u.jsxs("span",{style:{color:K1(e.transfers)},children:[Gt(e.transfers)," transfers"]}),e.adjustments!==0&&u.jsxs("span",{style:{color:K1(e.adjustments)},children:[Gt(e.adjustments)," adjust"]})]}),i&&d&&u.jsx("div",{style:{marginTop:"0.5rem"},children:u.jsxs("span",{style:{fontSize:"0.8rem"},children:[u.jsxs("span",{style:{opacity:.6},children:[Xe(r),"  "]}),u.jsxs("span",{style:{color:me.success},children:[t.default_monthly_amount,"%"]}),u.jsx("span",{style:{opacity:.6},children:" = "}),u.jsx("span",{style:{color:me.success},children:Xe(h)})]})})]})}function Nf(t){return t===0?me.zero:t>0?me.success:me.error}function Y1({name:t,categories:e,groupTotals:n,getCategoryBalance:r,localAllocations:i,savedAllocations:o,previousMonthIncome:l,isDraftMode:d,onAllocationChange:h,isMobile:m,isUngrouped:p,getAllocationAmount:g}){const v={paddingTop:"0.6rem",paddingBottom:"0.6rem",paddingLeft:"0.5rem",paddingRight:"0.5rem",marginTop:"1.25rem",borderTop:"1px solid rgba(255,255,255,0.2)",borderBottom:Ra,background:"rgba(255,255,255,0.04)",display:"flex",alignItems:"center",fontSize:"0.9rem",fontWeight:600},b=n.allocated+n.spent+n.transfers+n.adjustments,E=e.reduce((x,[S,C])=>{const T=C.balance??0;if(d){const I=g(S,C),O=o[S]??0,U=I-O;return x+T+U}return x+T},0);return u.jsxs("div",{style:{display:"contents"},children:[!m&&u.jsxs(u.Fragment,{children:[u.jsxs("div",{style:{...v,paddingLeft:"0.5rem",opacity:p?.7:1},children:[u.jsx("span",{children:t}),u.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",e.length,")"]})]}),u.jsx("div",{style:{...v,justifyContent:"flex-end",color:Mn(n.start)},children:an.showGroupTotals}),u.jsx("div",{style:{...v,justifyContent:d?"center":"flex-end",color:pc(n.allocated)},children:an.showGroupTotals}),u.jsx("div",{style:{...v,justifyContent:"flex-end",color:mc(n.spent)},children:an.showGroupTotals}),u.jsx("div",{style:{...v,justifyContent:"flex-end",color:Nf(n.transfers)},children:an.showGroupTotals}),u.jsx("div",{style:{...v,justifyContent:"flex-end",color:Nf(n.adjustments)},children:an.showGroupTotals}),u.jsx("div",{style:{...v,justifyContent:"flex-end",color:Mn(b)},children:an.showGroupTotals}),u.jsx("div",{style:{...v,justifyContent:"flex-end",color:Mn(n.end),paddingRight:"1rem",borderRight:"2px solid rgba(128, 128, 128, 0.4)"},children:an.showGroupTotals}),u.jsx("div",{style:{...v,justifyContent:"flex-end",color:Mn(E)},children:an.showGroupTotals})]}),!d&&m&&u.jsxs("div",{style:{gridColumn:"1 / -1",paddingTop:"0.6rem",paddingBottom:"0.6rem",paddingLeft:"0.5rem",paddingRight:"0.5rem",marginTop:"1.25rem",borderTop:"1px solid rgba(255,255,255,0.2)",borderBottom:Ra,background:"rgba(255,255,255,0.04)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[u.jsxs("span",{style:{fontWeight:600,opacity:p?.7:1},children:[t,u.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",e.length,")"]})]}),an.showGroupTotals]}),e.map(([x,S],C)=>{const T=r(x);if(!T)return null;const I=S.balance??0;let O=I;if(d){const U=g(x,S),$=o[x]??0,k=U-$;O=I+k}return m?u.jsx("div",{style:{gridColumn:"1 / -1"},children:u.jsx(HB,{category:S,balance:T,localAllocation:i[x]||"",previousMonthIncome:l,isDraftMode:d,onAllocationChange:U=>h(x,U),projectedAllTime:O})},x):u.jsx(GB,{category:S,balance:T,localAllocation:i[x]||"",previousMonthIncome:l,isDraftMode:d,onAllocationChange:U=>h(x,U),allTimeBalance:O,isEvenRow:C%2===0},x)})]})}function GB({category:t,balance:e,localAllocation:n,previousMonthIncome:r,isDraftMode:i,onAllocationChange:o,allTimeBalance:l,isEvenRow:d}){const h=t.default_monthly_type==="percentage"&&t.default_monthly_amount!==void 0&&t.default_monthly_amount>0,m=h?t.default_monthly_amount/100*r:0,p=h?m.toFixed(2):n,g=t.balance??0,v=g<0,b=v?Math.abs(g):0,E=h?m:parseFloat(n)||0,x=v?Math.min(E,b):0,S=v?Math.max(0,E-b):0,C=v&&E>0&&S>0,T=d?"transparent":"rgba(255,255,255,0.04)",I={paddingTop:"0.6rem",paddingBottom:"0.6rem",paddingLeft:"0.5rem",paddingRight:"0.5rem",background:T,display:"flex",alignItems:"center",fontSize:"0.9rem",minHeight:"2.4rem",boxSizing:"border-box"},O=e.allocated+e.spent+e.transfers+e.adjustments;return u.jsxs("div",{style:{display:"contents"},children:[u.jsx("div",{style:{paddingTop:"0.6rem",paddingBottom:"0.6rem",paddingRight:"0.5rem",paddingLeft:"1.5rem",background:T,display:"flex",alignItems:"center",fontSize:"0.9rem",fontWeight:500,overflow:"hidden",borderLeft:"2px solid rgba(255,255,255,0.1)",minHeight:"2.4rem",boxSizing:"border-box"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.name})}),u.jsx("div",{style:{...I,justifyContent:"flex-end",color:Mn(e.start_balance)},children:os(e.start_balance)}),i?u.jsx("div",{style:{...I,justifyContent:"center",flexDirection:"column",gap:"0.1rem",paddingTop:"0.35rem",paddingBottom:"0.35rem"},children:h?u.jsxs("span",{style:{fontSize:"0.85rem"},children:[u.jsxs("span",{style:{color:me.success},children:[t.default_monthly_amount,"%"]}),u.jsx("span",{style:{opacity:.5},children:" = "}),u.jsx("span",{style:{color:me.success},children:Xe(m)})]}):u.jsxs(u.Fragment,{children:[u.jsx("input",{type:"text",inputMode:"decimal",value:p?`$${p}`:"",onChange:U=>{const $=U.target.value.replace(/[^\d.]/g,"");o($)},placeholder:"$0.00",style:{width:"100px",padding:"0.2rem 0.5rem",borderRadius:"4px",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"0.9rem",lineHeight:1,color:"inherit",boxSizing:"border-box"}}),v&&E>0&&u.jsxs("div",{style:{fontSize:"0.6rem",whiteSpace:"nowrap",textAlign:"center",lineHeight:1.3,display:"flex",flexDirection:"column",alignItems:"center"},children:[u.jsxs("span",{style:{color:me.debt},children:[Xe(x),"  debt"]}),C&&u.jsxs("span",{style:{color:me.success},children:[Xe(S),"  bal"]})]})]})}):(()=>{const U=e.start_balance<0,$=U?Math.abs(e.start_balance):0,k=U?Math.min(e.allocated,$):0,R=U?Math.max(0,e.allocated-$):0,N=U&&e.allocated>0;return u.jsxs("div",{style:{...I,justifyContent:"flex-end",flexDirection:"column",alignItems:"flex-end",gap:"0.1rem",color:pc(e.allocated)},children:[u.jsxs("span",{children:["+",Xe(e.allocated)]}),N&&u.jsxs("div",{style:{fontSize:"0.6rem",whiteSpace:"nowrap",textAlign:"right",lineHeight:1.3,display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[u.jsxs("span",{style:{color:me.debt},children:[Xe(k),"  debt"]}),R>0&&u.jsxs("span",{style:{color:me.success},children:[Xe(R),"  bal"]})]})]})})(),u.jsx("div",{style:{...I,justifyContent:"flex-end",color:mc(e.spent)},children:za(e.spent)}),u.jsx("div",{style:{...I,justifyContent:"flex-end",color:Nf(e.transfers)},children:Gt(e.transfers)}),u.jsx("div",{style:{...I,justifyContent:"flex-end",color:Nf(e.adjustments)},children:Gt(e.adjustments)}),u.jsx("div",{style:{...I,justifyContent:"flex-end",color:Mn(O),...i&&!h?as:{}},children:Gt(O)}),u.jsx("div",{style:{...I,justifyContent:"flex-end",fontWeight:600,color:Mn(e.end_balance),paddingRight:"1rem",borderRight:"2px solid rgba(128, 128, 128, 0.4)",...i&&!h?as:{}},children:os(e.end_balance)}),u.jsx("div",{style:{...I,justifyContent:"flex-end",color:Mn(l),...i&&!h?as:{}},children:os(l)})]})}function QB(t,e){const{includeHidden:n=!1}={},r=Object.entries(t).filter(([,i])=>n||!i.is_hidden).reduce((i,[o,l])=>{const d=l.category_group_id||"ungrouped";return i[d]||(i[d]=[]),i[d].push([o,l]),i},{});return Object.keys(r).forEach(i=>{r[i].sort((o,l)=>o[1].sort_order-l[1].sort_order)}),r}function WB(t,e,n,r,i){const o={};t?.category_balances&&t.category_balances.forEach(d=>{o[d.category_id]=d});const l={};return Object.entries(e).forEach(([d,h])=>{const m=o[d],p=m?.start_balance??0,g=m?.spent??0;let v=0;n?v=i(d,h):r&&m&&(v=m.allocated);let b=0;t?.transfers&&t.transfers.forEach(x=>{x.to_category_id===d&&(b+=x.amount),x.from_category_id===d&&(b-=x.amount)});let E=0;t?.adjustments&&(E=t.adjustments.filter(x=>x.category_id===d).reduce((x,S)=>x+S.amount,0)),l[d]={category_id:d,start_balance:p,allocated:v,spent:g,transfers:b,adjustments:E,end_balance:p+v+g+b+E}}),l}function KB(t,e){const n={};t?.account_balances&&t.account_balances.forEach(i=>{n[i.account_id]=i});const r={};return Object.entries(e).forEach(([i,o])=>{const d=n[i]?.start_balance??o.balance;let h=0;t?.income&&(h=t.income.filter(b=>b.account_id===i).reduce((b,E)=>b+E.amount,0));let m=0;t?.expenses&&(m=t.expenses.filter(b=>b.account_id===i).reduce((b,E)=>b+E.amount,0));let p=0;t?.transfers&&t.transfers.forEach(b=>{b.to_account_id===i&&(p+=b.amount),b.from_account_id===i&&(p-=b.amount)});let g=0;t?.adjustments&&(g=t.adjustments.filter(b=>b.account_id===i).reduce((b,E)=>b+E.amount,0));const v=h+m+p+g;r[i]={account_id:i,start_balance:d,income:h,expenses:m,transfers:p,adjustments:g,net_change:v,end_balance:d+v}}),r}function YB(t){return Object.values(t).reduce((e,n)=>({start:e.start+n.start_balance,income:e.income+n.income,expenses:e.expenses+n.expenses,transfers:e.transfers+n.transfers,adjustments:e.adjustments+n.adjustments,netChange:e.netChange+n.net_change,end:e.end+n.end_balance}),{start:0,income:0,expenses:0,transfers:0,adjustments:0,netChange:0,end:0})}function XB(t){return Object.values(t).reduce((e,n)=>({start:e.start+n.start_balance,allocated:e.allocated+n.allocated,spent:e.spent+n.spent,transfers:e.transfers+n.transfers,adjustments:e.adjustments+n.adjustments,end:e.end+n.end_balance}),{start:0,allocated:0,spent:0,transfers:0,adjustments:0,end:0})}function X1(t){return t===0?me.zero:t>0?me.success:me.error}function ZB({isDraftMode:t,allocationsFinalized:e,balanceTotals:n,grandAllTime:r,onSave:i,onApply:o,onEdit:l,onCancel:d,onDelete:h}){const m={paddingTop:"0.6rem",paddingBottom:"0.6rem",paddingLeft:"0.5rem",paddingRight:"0.5rem",borderTop:"2px solid rgba(255,255,255,0.3)",borderBottom:"2px solid rgba(255,255,255,0.3)",fontWeight:600,display:"flex",alignItems:"center",fontSize:"0.9rem"},p=n.allocated+n.spent+n.transfers+n.adjustments;return u.jsxs(u.Fragment,{children:[u.jsxs("div",{style:{...m,gap:"0.75rem"},children:["Grand Totals",!t&&u.jsx(J0,{isDraftMode:!1,isEditingAppliedAllocations:!1,allocationsFinalized:e,onSave:i,onApply:o,onEdit:l,onCancel:d,onDelete:h})]}),u.jsx("div",{style:{...m,justifyContent:"flex-end",color:Mn(n.start)},children:os(n.start)}),u.jsxs("div",{style:{...m,justifyContent:t?"center":"flex-end",color:pc(n.allocated),...t?as:{}},children:["+",Xe(n.allocated)]}),u.jsx("div",{style:{...m,justifyContent:"flex-end",color:mc(n.spent)},children:za(n.spent)}),u.jsx("div",{style:{...m,justifyContent:"flex-end",color:X1(n.transfers)},children:Gt(n.transfers)}),u.jsx("div",{style:{...m,justifyContent:"flex-end",color:X1(n.adjustments)},children:Gt(n.adjustments)}),u.jsx("div",{style:{...m,justifyContent:"flex-end",color:Mn(p),...t?as:{}},children:Gt(p)}),u.jsx("div",{style:{...m,justifyContent:"flex-end",color:Mn(n.end),paddingRight:"1rem",borderRight:"2px solid rgba(128, 128, 128, 0.4)",...t?as:{}},children:os(n.end)}),u.jsx("div",{style:{...m,justifyContent:"flex-end",color:Mn(r),...t?as:{}},children:os(r)})]})}function JB({allocationsFinalized:t,availableNow:e,currentMonthIncome:n,balanceTotals:r,draftChangeAmount:i,availableAfterApply:o,currentDraftTotal:l,onSave:d,onApply:h,onEdit:m,onCancel:p,onDelete:g}){return u.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem",borderTop:"2px solid rgba(255,255,255,0.3)",borderBottom:"2px solid rgba(255,255,255,0.3)"},children:[u.jsx("span",{style:{fontWeight:600},children:"Grand Totals:"}),u.jsx(rA,{isDraftMode:!1,isEditingAppliedAllocations:!1,availableNow:e,currentMonthIncome:n,balanceTotals:r,draftChangeAmount:i,availableAfterApply:o,currentDraftTotal:l}),u.jsx(J0,{isDraftMode:!1,isEditingAppliedAllocations:!1,allocationsFinalized:t,onSave:d,onApply:h,onEdit:m,onCancel:p,onDelete:g})]})}const ui={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderBottom:"2px solid rgba(255,255,255,0.2)"};function ez(t){if(!t)return"";switch(t.phase){case"reading-budget":return"Reading budget data...";case"fetching-months":return"Fetching months...";case"recalculating":return t.currentMonth?`Recalculating ${t.currentMonth}...`:"Recalculating...";case"saving":return"Saving results...";case"complete":return"Recalculation complete!";default:return"Recalculating balances..."}}function tz(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n}=Ye(),{categories:r,categoryGroups:i,monthMap:o}=An(),{month:l}=Ci(t,e,n),d=Ei(),[h,m]=D.useState(null);od({budgetId:t,year:e,month:n,monthMap:o,requireMonthLoaded:!0,currentMonth:l,onProgress:G=>m(G),logPrefix:"[MonthCategories]"});const[p,g]=D.useState(!1),{localAllocations:v,isEditingAppliedAllocations:b,error:E,availableNow:x,currentDraftTotal:S,draftChangeAmount:C,availableAfterApply:T,previousMonthIncome:I,currentMonthIncome:O,allocationsFinalized:U,getAllocationAmount:$,handleAllocationChange:k,resetAllocationsToSaved:R,handleSaveAllocations:N,handleFinalizeAllocations:V,setIsEditingAppliedAllocations:H,setError:j}=Y4(),B=[...i].sort((G,te)=>G.sort_order-te.sort_order),M=D.useMemo(()=>QB(r),[r]),Z=!U||b,K=D.useMemo(()=>WB(l,r,Z,U,$),[l,r,Z,U,$]),q=G=>K[G],W=D.useMemo(()=>XB(K),[K]),X=D.useMemo(()=>{const G={};if(l?.category_balances)for(const te of l.category_balances)G[te.category_id]=te.allocated;return G},[l]),re=D.useMemo(()=>Object.entries(r).reduce((G,[te,se])=>{const ie=se.balance??0;if(Z){const ce=$(te,se),we=X[te]??0,he=ce-we;return G+ie+he}return G+ie},0),[r,Z,$,X]),z={onSave:N,onApply:V,onEdit:()=>H(!0),onCancel:R,onDelete:()=>g(!0)};return u.jsxs(u.Fragment,{children:[h&&u.jsxs(K0,{message:ez(h),spinnerColor:"#22c55e",children:[u.jsx(tA,{percent:h.percentComplete,gradient:"linear-gradient(90deg, #22c55e, #10b981)"}),u.jsxs("div",{style:{display:"flex",gap:"2rem",justifyContent:"center",flexWrap:"wrap"},children:[(h.totalMonthsToFetch??0)>0&&u.jsx(Of,{value:`${h.monthsFetched||0}/${h.totalMonthsToFetch}`,label:"Months Loaded",color:h.phase==="fetching-months"?"#22c55e":"#6b7280"}),(h.totalMonths??0)>0&&u.jsx(Of,{value:`${h.monthsProcessed}/${h.totalMonths}`,label:"Months Recalculated",color:h.phase==="recalculating"?"#22c55e":"#6b7280"})]}),u.jsx(nA,{percent:h.percentComplete})]}),E&&u.jsx(mm,{message:E,onDismiss:()=>j(null)}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:d?"1fr":Z?"2fr 1fr 200px 1fr 1fr 1fr 1fr 1fr 120px":"2fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 120px"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"#242424",display:d?"block":"grid",gridTemplateColumns:d?void 0:"subgrid"},children:[Z&&u.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexDirection:d?"column":"row",flexWrap:"wrap",alignItems:d?"stretch":"center",gap:d?"0.5rem":"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:d?"0.5rem":"0.25rem"},children:[u.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:d?void 0:1,alignItems:"center"},children:u.jsx(rA,{isDraftMode:Z,isEditingAppliedAllocations:b,availableNow:x,currentMonthIncome:O,balanceTotals:W,draftChangeAmount:C,availableAfterApply:T,currentDraftTotal:S})}),u.jsx(J0,{isDraftMode:Z,isEditingAppliedAllocations:b,allocationsFinalized:U,...z})]}),!d&&u.jsxs(u.Fragment,{children:[u.jsx("div",{style:ui,children:"Category"}),u.jsx("div",{style:{...ui,textAlign:"right"},children:"Start"}),u.jsx("div",{style:{...ui,textAlign:Z?"center":"right"},children:"Allocated"}),u.jsx("div",{style:{...ui,textAlign:"right"},children:"Spent"}),u.jsx("div",{style:{...ui,textAlign:"right"},children:"Transfers"}),u.jsx("div",{style:{...ui,textAlign:"right"},children:"Adjust"}),u.jsx("div",{style:{...ui,textAlign:"right"},children:"Net Change"}),u.jsx("div",{style:{...ui,textAlign:"right",paddingRight:"1rem",borderRight:"2px solid rgba(128, 128, 128, 0.4)"},children:"End"}),u.jsx("div",{style:{...ui,textAlign:"right"},children:"All-Time"})]}),!d&&u.jsx(ZB,{isDraftMode:Z,allocationsFinalized:U,balanceTotals:W,grandAllTime:re,...z}),!Z&&d&&u.jsx(JB,{allocationsFinalized:U,availableNow:x,currentMonthIncome:O,balanceTotals:W,draftChangeAmount:C,availableAfterApply:T,currentDraftTotal:S,...z})]}),Object.keys(r).length===0&&u.jsxs("p",{style:{gridColumn:"1 / -1",opacity:.6,textAlign:"center",padding:"2rem"},children:["No categories yet. ",u.jsx(Cn,{to:"/budget/settings/categories",style:{opacity:1},children:"Create categories "})]}),B.map(G=>{const te=M[G.id]||[];if(te.length===0)return null;const se=te.reduce((ie,[ce])=>{const we=q(ce);return we?{start:ie.start+we.start_balance,allocated:ie.allocated+we.allocated,spent:ie.spent+we.spent,transfers:ie.transfers+we.transfers,adjustments:ie.adjustments+we.adjustments,end:ie.end+we.end_balance}:ie},{start:0,allocated:0,spent:0,transfers:0,adjustments:0,end:0});return u.jsx(Y1,{name:G.name,categories:te,groupTotals:se,getCategoryBalance:q,localAllocations:v,savedAllocations:X,previousMonthIncome:I,isDraftMode:Z,onAllocationChange:k,isMobile:d,getAllocationAmount:$},G.id)}),M[ln]?.length>0&&(()=>{const G=M[ln],te=G.reduce((se,[ie])=>{const ce=q(ie);return ce?{start:se.start+ce.start_balance,allocated:se.allocated+ce.allocated,spent:se.spent+ce.spent,transfers:se.transfers+ce.transfers,adjustments:se.adjustments+ce.adjustments,end:se.end+ce.end_balance}:se},{start:0,allocated:0,spent:0,transfers:0,adjustments:0,end:0});return u.jsx(Y1,{name:"Uncategorized",categories:G,groupTotals:te,getCategoryBalance:q,localAllocations:v,savedAllocations:X,previousMonthIncome:I,isDraftMode:Z,onAllocationChange:k,isMobile:d,isUngrouped:!0,getAllocationAmount:$},ln)})(),u.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]}),u.jsx($B,{isOpen:p,onClose:()=>g(!1),onDeleted:()=>H(!1)})]})}function sA(t){return t===0?me.zero:t>0?me.success:me.error}function iA(t){return t===0?me.zero:t<0?me.error:me.success}function Ul(t){return t===0?me.zero:t>0?me.success:me.error}function Z1({name:t,accounts:e,groupTotals:n,accountBalances:r,isMobile:i,isUngrouped:o}){const l={padding:"0.6rem 0.5rem",marginTop:"1.25rem",borderTop:"1px solid rgba(255,255,255,0.2)",borderBottom:Ra,background:"rgba(255,255,255,0.04)",display:"flex",alignItems:"center",fontSize:"0.9rem",fontWeight:600};return u.jsxs("div",{style:{display:"contents"},children:[!i&&u.jsxs(u.Fragment,{children:[u.jsxs("div",{style:{...l,opacity:o?.7:1},children:[u.jsx("span",{children:t}),u.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",e.length,")"]})]}),u.jsx("div",{style:{...l,justifyContent:"flex-end",color:Bt(n.start)},children:an.showGroupTotals}),u.jsx("div",{style:{...l,justifyContent:"flex-end",color:sA(n.income)},children:an.showGroupTotals}),u.jsx("div",{style:{...l,justifyContent:"flex-end",color:iA(n.expenses)},children:an.showGroupTotals}),u.jsx("div",{style:{...l,justifyContent:"flex-end",color:Ul(n.transfers)},children:an.showGroupTotals}),u.jsx("div",{style:{...l,justifyContent:"flex-end",color:Ul(n.adjustments)},children:an.showGroupTotals}),u.jsx("div",{style:{...l,justifyContent:"flex-end",color:Ul(n.netChange)},children:an.showGroupTotals}),u.jsx("div",{style:{...l,justifyContent:"flex-end",color:Bt(n.end)},children:an.showGroupTotals})]}),i&&u.jsxs("div",{style:{gridColumn:"1 / -1",padding:"0.6rem 0.5rem",marginTop:"1.25rem",borderTop:"1px solid rgba(255,255,255,0.2)",borderBottom:Ra,background:"rgba(255,255,255,0.04)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[u.jsxs("span",{style:{fontWeight:600,opacity:o?.7:1},children:[t,u.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",e.length,")"]})]}),an.showGroupTotals]}),e.map(([d,h],m)=>{const p=r[d];return p?i?u.jsx("div",{style:{gridColumn:"1 / -1"},children:u.jsx(rz,{account:h,balance:p})},d):u.jsx(nz,{account:h,balance:p,isEvenRow:m%2===0},d):null})]})}function nz({account:t,balance:e,isEvenRow:n}){const i={padding:"0.5rem 0.5rem",background:n?"transparent":"rgba(255,255,255,0.04)",display:"flex",alignItems:"center",fontSize:"0.9rem"};return u.jsxs("div",{style:{display:"contents"},children:[u.jsx("div",{style:{...i,fontWeight:500,overflow:"hidden",paddingLeft:"1.5rem",borderLeft:"2px solid rgba(255,255,255,0.1)"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.nickname})}),u.jsx("div",{style:{...i,justifyContent:"flex-end",color:Bt(e.start_balance)},children:Xe(e.start_balance)}),u.jsxs("div",{style:{...i,justifyContent:"flex-end",color:sA(e.income)},children:["+",Xe(e.income)]}),u.jsx("div",{style:{...i,justifyContent:"flex-end",color:iA(e.expenses)},children:za(e.expenses)}),u.jsx("div",{style:{...i,justifyContent:"flex-end",color:Ul(e.transfers)},children:Gt(e.transfers)}),u.jsx("div",{style:{...i,justifyContent:"flex-end",color:Ul(e.adjustments)},children:Gt(e.adjustments)}),u.jsx("div",{style:{...i,justifyContent:"flex-end",color:Ul(e.net_change)},children:Gt(e.net_change)}),u.jsx("div",{style:{...i,justifyContent:"flex-end",fontWeight:600,color:Bt(e.end_balance)},children:Xe(e.end_balance)})]})}function rz({account:t,balance:e}){return u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",padding:"0.75rem",marginBottom:"0.25rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem"},children:u.jsx("span",{style:{fontWeight:500},children:t.nickname})}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"0.25rem",fontSize:"0.75rem"},children:[u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:"Start"}),u.jsx("span",{children:Xe(e.start_balance)})]}),u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:"Net Change"}),u.jsx("span",{style:{color:Bt(e.net_change)},children:Gt(e.net_change)})]}),u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:"End"}),u.jsx("span",{style:{color:Bt(e.end_balance)},children:Xe(e.end_balance)})]})]}),(e.income!==0||e.expenses!==0||e.transfers!==0||e.adjustments!==0)&&u.jsxs("div",{style:{marginTop:"0.5rem",paddingTop:"0.5rem",borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)",display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",fontSize:"0.7rem",opacity:.7},children:[e.income!==0&&u.jsxs("span",{children:[Gt(e.income)," income"]}),e.expenses!==0&&u.jsxs("span",{children:[za(e.expenses)," expenses"]}),e.transfers!==0&&u.jsxs("span",{children:[Gt(e.transfers)," transfers"]}),e.adjustments!==0&&u.jsxs("span",{children:[Gt(e.adjustments)," adjust"]})]})]})}const aa={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderBottom:"2px solid rgba(255,255,255,0.2)"};function sz(t){return t===0?me.zero:t>0?me.success:me.error}function iz(t){return t===0?me.zero:t<0?me.error:me.success}function Qg(t){return t===0?me.zero:t>0?me.success:me.error}function az(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n}=Ye(),{accounts:r,accountGroups:i,monthMap:o}=An(),{month:l}=Ci(t,e,n),d=Ei(),[h,m]=D.useState(null);od({budgetId:t,year:e,month:n,monthMap:o,requireMonthLoaded:!0,currentMonth:l,onProgress:T=>m(T),logPrefix:"[MonthAccounts]"});const p=D.useMemo(()=>Object.entries(i).map(([T,I])=>({id:T,...I})).sort((T,I)=>T.sort_order-I.sort_order),[i]),g=D.useMemo(()=>{const T={};return Object.entries(r).filter(([,I])=>!I.is_hidden).forEach(([I,O])=>{const U=O.account_group_id||Xt;T[U]||(T[U]=[]),T[U].push([I,O])}),Object.keys(T).forEach(I=>{T[I].sort((O,U)=>O[1].sort_order-U[1].sort_order)}),T},[r]),v=D.useMemo(()=>KB(l,r),[l,r]),b=D.useMemo(()=>YB(v),[v]),E=b.income+b.expenses,S={...{padding:"0.6rem 0.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem"},borderTop:"2px solid rgba(255,255,255,0.3)",borderBottom:"2px solid rgba(255,255,255,0.3)",fontWeight:600},C=()=>{if(!h)return"";switch(h.phase){case"reading-budget":return"Reading budget data...";case"fetching-months":return"Fetching months...";case"recalculating":return h.currentMonth?`Recalculating ${h.currentMonth}...`:"Recalculating...";case"saving":return"Saving results...";case"complete":return"Recalculation complete!";default:return"Recalculating balances..."}};return u.jsxs(u.Fragment,{children:[h&&u.jsxs(K0,{message:C(),spinnerColor:"#22c55e",children:[u.jsx(tA,{percent:h.percentComplete,gradient:"linear-gradient(90deg, #22c55e, #10b981)"}),u.jsxs("div",{style:{display:"flex",gap:"2rem",justifyContent:"center",flexWrap:"wrap"},children:[(h.totalMonthsToFetch??0)>0&&u.jsx(Of,{value:`${h.monthsFetched||0}/${h.totalMonthsToFetch}`,label:"Months Loaded",color:h.phase==="fetching-months"?"#22c55e":"#6b7280"}),(h.totalMonths??0)>0&&u.jsx(Of,{value:`${h.monthsProcessed}/${h.totalMonths}`,label:"Months Recalculated",color:h.phase==="recalculating"?"#22c55e":"#6b7280"})]}),u.jsx(nA,{percent:h.percentComplete})]}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:d?"1fr":"2fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"#242424",display:d?"block":"grid",gridTemplateColumns:d?void 0:"subgrid"},children:[!d&&u.jsxs(u.Fragment,{children:[u.jsx("div",{style:aa,children:"Account"}),u.jsx("div",{style:{...aa,textAlign:"right"},children:"Start"}),u.jsx("div",{style:{...aa,textAlign:"right"},children:"Income"}),u.jsx("div",{style:{...aa,textAlign:"right"},children:"Expenses"}),u.jsx("div",{style:{...aa,textAlign:"right"},children:"Transfers"}),u.jsx("div",{style:{...aa,textAlign:"right"},children:"Adjust"}),u.jsx("div",{style:{...aa,textAlign:"right"},children:"Net Change"}),u.jsx("div",{style:{...aa,textAlign:"right"},children:"End"})]}),d?u.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem",borderTop:"2px solid rgba(255,255,255,0.3)",borderBottom:"2px solid rgba(255,255,255,0.3)"},children:[u.jsx("span",{style:{fontWeight:600},children:"Grand Totals:"}),u.jsx(qB,{totals:b})]}):u.jsxs(u.Fragment,{children:[u.jsx("div",{style:{...S},children:"Grand Totals"}),u.jsx("div",{style:{...S,justifyContent:"flex-end",color:Bt(b.start)},children:Xe(b.start)}),u.jsxs("div",{style:{...S,justifyContent:"flex-end",color:sz(b.income)},children:["+",Xe(b.income)]}),u.jsx("div",{style:{...S,justifyContent:"flex-end",color:iz(b.expenses)},children:za(b.expenses)}),u.jsx("div",{style:{...S,justifyContent:"flex-end",color:Qg(b.transfers)},children:Gt(b.transfers)}),u.jsx("div",{style:{...S,justifyContent:"flex-end",color:Qg(b.adjustments)},children:Gt(b.adjustments)}),u.jsx("div",{style:{...S,justifyContent:"flex-end",color:Qg(E)},children:Gt(E)}),u.jsx("div",{style:{...S,justifyContent:"flex-end",color:Bt(b.end)},children:Xe(b.end)})]})]}),Object.keys(r).length===0&&u.jsxs("p",{style:{gridColumn:"1 / -1",opacity:.6,textAlign:"center",padding:"2rem"},children:["No accounts yet."," ",u.jsx(Cn,{to:"/budget/settings/accounts",style:{opacity:1},children:"Add accounts "})]}),p.map(T=>{const I=g[T.id]||[];if(I.length===0)return null;const O=I.reduce((U,[$])=>{const k=v[$];return k?{start:U.start+k.start_balance,income:U.income+k.income,expenses:U.expenses+k.expenses,transfers:U.transfers+k.transfers,adjustments:U.adjustments+k.adjustments,netChange:U.netChange+k.net_change,end:U.end+k.end_balance}:U},{start:0,income:0,expenses:0,transfers:0,adjustments:0,netChange:0,end:0});return u.jsx(Z1,{name:T.name,accounts:I,groupTotals:O,accountBalances:v,isMobile:d},T.id)}),g[Xt]?.length>0&&(()=>{const T=g[Xt],I=T.reduce((O,[U])=>{const $=v[U];return $?{start:O.start+$.start_balance,income:O.income+$.income,expenses:O.expenses+$.expenses,transfers:O.transfers+$.transfers,adjustments:O.adjustments+$.adjustments,netChange:O.netChange+$.net_change,end:O.end+$.end_balance}:O},{start:0,income:0,expenses:0,transfers:0,adjustments:0,netChange:0,end:0});return u.jsx(Z1,{name:"Ungrouped",accounts:T,groupTotals:I,accountBalances:v,isMobile:d,isUngrouped:!0},Xt)})(),u.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]})]})}const oz=["income","categories","accounts","spend","transfers","adjustments"];function J1(t){const e=t.year?parseInt(t.year,10):null,n=t.month?parseInt(t.month,10):null,r=t.tab&&oz.includes(t.tab)?t.tab:null;return{year:e&&!isNaN(e)&&e>=2e3&&e<=2100?e:null,month:n&&!isNaN(n)&&n>=1&&n<=12?n:null,tab:r}}function lz(){const t=new Date;return{year:t.getFullYear(),month:t.getMonth()+1}}function eS(){const t=k5(),e=Gu(),[n,r]=AS(),{addLoadingHold:i,removeLoadingHold:o}=Gn(),{selectedBudgetId:l,setSelectedBudgetId:d,currentYear:h,currentMonthNumber:m,lastActiveTab:p,setCurrentYear:g,setCurrentMonthNumber:v,setLastActiveTab:b,setPageTitle:E,goToPreviousMonth:x,goToNextMonth:S,hasPendingInvites:C,needsFirstBudget:T,initialDataLoadComplete:I}=Ye(),{budget:O,isLoading:U,monthMap:$}=An(),k=!U,[R,N]=D.useState(!1);D.useEffect(()=>(!k||!I?i("budget-data","Loading budget data..."):o("budget-data"),()=>o("budget-data")),[k,I,i,o]);const V=D.useRef(!1),H=n.get("error"),[j,B]=D.useState(H);D.useEffect(()=>{H&&(n.delete("error"),r(n,{replace:!0}))},[H,n,r]);const[M,Z]=D.useState(()=>{const{tab:te}=J1(t);return te??p}),K=te=>{Z(te),b(te)};D.useEffect(()=>{if(V.current)return;const{year:te,month:se}=J1(t);te&&g(te),se&&v(se),V.current=!0},[t,g,v]),D.useEffect(()=>{if(!V.current)return;const te=`/budget/${h}/${m}/${M}`,se=`/budget/${t.year}/${t.month}/${t.tab}`;te!==se&&e(te,{replace:!0})},[h,m,M,e,t]);const{month:q,error:W,isLoading:X}=Ci(k?l:null,h,m);D.useEffect(()=>{if(!W||R)return;const te=W.message||"";if(te.includes("Budget")&&te.includes("does not exist")){queueMicrotask(()=>{d(null),e("/budget/my-budgets?context=budget-not-found",{replace:!0})});return}(te.includes("months in the past")||te.includes("Refusing to create month"))&&queueMicrotask(()=>{i("month-redirect","Redirecting to current month..."),N(!0);const{year:se,month:ie}=lz();B(`Cannot create month ${h}/${m} - it's too far in the past. Redirected to current month.`),g(se),v(ie)})},[W,R,h,m,g,v,i,d,e]),D.useEffect(()=>{R&&q&&!X&&queueMicrotask(()=>{N(!1),o("month-redirect")})},[R,q,X,o]),D.useLayoutEffect(()=>{E(O?.name||"Budget")},[O?.name,E]);const{setCurrentViewingDocument:re}=Ye();if(D.useEffect(()=>(O&&h&&m&&re({type:"month",year:h,month:m}),()=>{re({type:null})}),[O,h,m,re]),D.useEffect(()=>{if(k&&!R){if(!O&&!l){e("/budget/my-budgets",{replace:!0});return}if(!O&&C){e("/budget/my-budgets",{replace:!0});return}if(T){e("/budget/my-budgets",{replace:!0});return}}},[k,R,O,l,C,T,e]),d3(l,h,m),od({budgetId:l,year:h,month:m,monthMap:$,additionalCondition:k&&!!O,logPrefix:"[Budget]"}),!k||!I||R||!O)return null;function z(){B(null),x()}function G(){B(null),S()}return u.jsxs(u.Fragment,{children:[j&&u.jsx(mm,{message:j,onDismiss:()=>B(null)}),u.jsx(jB,{onPreviousMonth:z,onNextMonth:G}),u.jsx(gB,{activeTab:M,setActiveTab:K,allocationsFinalized:q?.are_allocations_finalized}),M==="income"&&u.jsx(MB,{},`${h}-${m}`),M==="categories"&&u.jsx(tz,{},`${h}-${m}`),M==="accounts"&&u.jsx(az,{},`${h}-${m}`),M==="spend"&&u.jsx(NB,{},`${h}-${m}`),M==="transfers"&&u.jsx(UB,{},`${h}-${m}`),M==="adjustments"&&u.jsx(VB,{},`${h}-${m}`)]})}function cz(){const{setPageTitle:t}=Ye();return D.useLayoutEffect(()=>{t("Analytics")},[t]),u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"50vh",textAlign:"center",gap:"1.5rem"},children:[u.jsx("div",{style:{fontSize:"4rem",opacity:.8},children:""}),u.jsx("h1",{style:{margin:0,fontSize:"2rem",fontWeight:600},children:"Analytics"}),u.jsx("p",{style:{margin:0,fontSize:"1.25rem",opacity:.6,maxWidth:"400px"},children:"Coming Soon"}),u.jsx("p",{style:{margin:0,fontSize:"0.95rem",opacity:.5,maxWidth:"500px",lineHeight:1.6},children:"Track spending trends, category breakdowns, and insights about your budget over time."}),u.jsx(Cn,{to:"/budget",style:{marginTop:"1rem",padding:"0.75rem 1.5rem",background:me.primary,color:"white",borderRadius:"8px",textDecoration:"none",fontWeight:500,transition:"opacity 0.15s"},children:"Back to Budget"})]})}function uz(){const t=Ft();return{createBudget:Hn({mutationFn:async({name:n,userId:r,userEmail:i})=>{const o=`budget_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,l=new Date().toISOString(),d={name:n.trim()||"My Budget",user_ids:[r],accepted_user_ids:[r],owner_id:r,owner_email:i,accounts:{},account_groups:{[Xt]:{name:"Ungrouped",sort_order:0,expected_balance:"positive",on_budget:null,is_active:null}},categories:{},category_groups:[{id:ln,name:"Uncategorized",sort_order:0}],total_available:0,is_needs_recalculation:!1,month_map:{},created_at:l,updated_at:l};return await qn("budgets",o,d,"creating new budget document"),await qn("users",r,{uid:r,email:i,budget_ids:Lu(o),updated_at:l},"adding new budget to user's budget list",{merge:!0}),{budgetId:o,budget:{id:o,...d}}},onSuccess:(n,{userId:r})=>{t.invalidateQueries({queryKey:ke.user(r)}),t.invalidateQueries({queryKey:ke.accessibleBudgets(r)})}})}}function dz(){const t=Ft();return{acceptInvite:Hn({mutationFn:async({budgetId:n,userId:r})=>{const i=new Date().toISOString(),{exists:o,data:l}=await At("budgets",n,"validating user was invited to this budget");if(!o||!l)throw new Error("Budget not found");if(!l.user_ids?.includes(r))throw new Error("You have not been invited to this budget");if(l.accepted_user_ids?.includes(r))throw new Error("You have already accepted this invite");return await qn("users",r,{uid:r,budget_ids:Lu(n),updated_at:i},"adding accepted budget to user's budget list",{merge:!0}),await qn("budgets",n,{accepted_user_ids:Lu(r),updated_at:i},"marking user as accepted in budget's accepted_user_ids",{merge:!0}),{budgetId:n}},onSuccess:(n,{userId:r})=>{t.invalidateQueries({queryKey:ke.user(r)}),t.invalidateQueries({queryKey:ke.accessibleBudgets(r)}),t.invalidateQueries({queryKey:ke.budget(n.budgetId)})}})}}function hz(){const t=Ft(),e=Hn({onMutate:async r=>{const{budgetId:i,userId:o}=r,l=ke.budget(i);await t.cancelQueries({queryKey:l});const d=t.getQueryData(l);return d&&t.setQueryData(l,{...d,budget:{...d.budget,user_ids:[...d.budget.user_ids,o]}}),{previousData:d}},mutationFn:async r=>{const{budgetId:i,userId:o}=r,{exists:l,data:d}=await At("budgets",i,"validating user is not already invited");if(!l||!d)throw new Error("Budget not found");if(d.user_ids?.includes(o))throw new Error("User is already invited");return await gm({budgetId:i,updates:{user_ids:Lu(o)},description:"adding user to budget's invited users list"}),{budgetId:i}},onError:(r,i,o)=>{o?.previousData&&t.setQueryData(ke.budget(i.budgetId),o.previousData)}});return{inviteUser:{mutate:r=>e.mutate(r),mutateAsync:r=>e.mutateAsync(r),isPending:e.isPending,isError:e.isError,error:e.error,reset:e.reset}}}function fz(){const t=Ft(),e=Hn({onMutate:async r=>{const{budgetId:i,userId:o}=r,l=ke.budget(i);await t.cancelQueries({queryKey:l});const d=t.getQueryData(l);return d&&t.setQueryData(l,{...d,budget:{...d.budget,user_ids:d.budget.user_ids.filter(h=>h!==o),accepted_user_ids:d.budget.accepted_user_ids.filter(h=>h!==o)}}),{previousData:d}},mutationFn:async r=>{const{budgetId:i,userId:o}=r;return await gm({budgetId:i,updates:{user_ids:C1(o),accepted_user_ids:C1(o)},description:"removing user from budget's access lists"}),{budgetId:i}},onError:(r,i,o)=>{o?.previousData&&t.setQueryData(ke.budget(i.budgetId),o.previousData)}});return{revokeUser:{mutate:r=>e.mutate(r),mutateAsync:r=>e.mutateAsync(r),isPending:e.isPending,isError:e.isError,error:e.error,reset:e.reset}}}function mz({message:t,onDismiss:e}){return u.jsxs("div",{style:{background:"rgba(220, 38, 38, 0.1)",border:"1px solid rgba(220, 38, 38, 0.3)",color:"#f87171",padding:"0.75rem 1rem",borderRadius:"8px",marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[u.jsx("span",{children:t}),u.jsx("button",{onClick:e,style:{background:"transparent",border:"none",color:"#f87171",cursor:"pointer",fontSize:"1.2rem",padding:"0 0.25rem",lineHeight:1},children:""})]})}function pz({message:t,onDismiss:e}){return u.jsxs("div",{style:{background:"rgba(34, 197, 94, 0.1)",border:"1px solid rgba(34, 197, 94, 0.3)",color:"#4ade80",padding:"0.75rem 1rem",borderRadius:"8px",marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[u.jsx("span",{children:t}),u.jsx("button",{onClick:e,style:{background:"transparent",border:"none",color:"#4ade80",cursor:"pointer",fontSize:"1.2rem",padding:"0 0.25rem",lineHeight:1},children:""})]})}function gz({budgetIdInput:t,setBudgetIdInput:e,isCheckingManual:n,manualInvite:r,isAccepting:i,onCheckInvite:o,onAcceptInvite:l,onCancel:d}){return u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px"},children:[u.jsxs("h3",{style:{margin:"0 0 0.75rem 0",fontSize:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{children:""})," Join Budget by ID"]}),u.jsx("p",{style:{margin:"0 0 1rem 0",fontSize:"0.9rem",opacity:.7},children:"If someone shared a budget ID with you, enter it below to accept the invitation:"}),r?u.jsxs("div",{style:{background:"color-mix(in srgb, #22c55e 10%, transparent)",border:"1px solid color-mix(in srgb, #22c55e 30%, transparent)",padding:"1rem",borderRadius:"8px"},children:[u.jsx("p",{style:{margin:"0 0 0.75rem 0",fontWeight:500},children:" You've been invited to join:"}),u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 8%, transparent)",padding:"0.75rem 1rem",borderRadius:"6px",marginBottom:"1rem"},children:[u.jsx("p",{style:{margin:"0 0 0.25rem 0",fontWeight:600,fontSize:"1.1rem"},children:r.budgetName}),r.ownerEmail&&u.jsxs("p",{style:{margin:0,fontSize:"0.9rem",opacity:.7},children:["Owner: ",r.ownerEmail]})]}),u.jsxs("div",{style:{display:"flex",gap:"0.75rem"},children:[u.jsx("button",{onClick:l,disabled:i===r.budgetId,style:{background:"#22c55e",color:"white",border:"none",padding:"0.6rem 1.25rem",borderRadius:"6px",cursor:i===r.budgetId?"not-allowed":"pointer",fontWeight:500,opacity:i===r.budgetId?.7:1},children:i===r.budgetId?"Accepting...":"Accept Invitation"}),u.jsx("button",{onClick:d,disabled:i===r.budgetId,style:{background:"transparent",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)",padding:"0.6rem 1.25rem",borderRadius:"6px",cursor:i===r.budgetId?"not-allowed":"pointer",fontWeight:500,opacity:i===r.budgetId?.7:.8},children:"Cancel"})]})]}):u.jsxs("form",{onSubmit:o,style:{display:"flex",gap:"0.75rem"},children:[u.jsx("input",{type:"text",value:t,onChange:h=>e(h.target.value),placeholder:"Enter Budget ID",style:{flex:1,padding:"0.6rem 0.8rem",borderRadius:"6px",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"0.95rem",color:"inherit"}}),u.jsx("button",{type:"submit",disabled:n||!t.trim(),style:{background:"#646cff",color:"white",border:"none",padding:"0.6rem 1.25rem",borderRadius:"6px",cursor:n||!t.trim()?"not-allowed":"pointer",fontWeight:500,opacity:n||!t.trim()?.7:1,whiteSpace:"nowrap"},children:n?"Checking...":"Check Invite"})]})]})}function yz({currentUserId:t}){return u.jsxs("div",{style:{marginTop:"1.5rem",padding:"1rem",background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"6px",fontSize:"0.85rem",opacity:.7},children:[u.jsx("p",{style:{margin:"0 0 0.5rem 0"},children:" Share your User ID with budget owners so they can invite you:"}),u.jsx("code",{style:{display:"block",padding:"0.5rem 0.75rem",background:"color-mix(in srgb, currentColor 8%, transparent)",borderRadius:"4px",fontSize:"0.8rem",wordBreak:"break-all"},children:t})]})}function _z(){const{addLoadingHold:t,removeLoadingHold:e}=Gn(),{selectedBudgetId:n,currentUserId:r,accessibleBudgets:i,loadAccessibleBudgets:o,switchToBudget:l,checkBudgetInvite:d,isInitialized:h,setPageTitle:m,needsFirstBudget:p}=Ye(),{requireUserEmail:g}=Da(),v=D.useRef(!1),[b,E]=AS(),x=b.get("context");D.useEffect(()=>{x&&(b.delete("context"),E(b,{replace:!0}))},[x,b,E]);const S=x==="budget-not-found",C=p&&i.length===0;D.useLayoutEffect(()=>{m("My Budgets")},[m]),D.useEffect(()=>{h&&!v.current&&(v.current=!0,o())},[h,o]);const{budget:T,isLoading:I}=An(),{renameBudget:O}=Q4(),{acceptInvite:U}=dz(),{createBudget:$}=uz(),[k,R]=D.useState(null),[N,V]=D.useState(null),[H,j]=D.useState(null),[B,M]=D.useState(null),[Z,K]=D.useState(null),[q,W]=D.useState(""),[X,re]=D.useState(!1),[z,G]=D.useState(""),[te,se]=D.useState(!1),[ie,ce]=D.useState(null),[we,he]=D.useState(""),[Ee,Ue]=D.useState(!1);async function Be(ae){if(ae!==T?.id){R(ae),j(null),M(null);try{await l(ae),M("Switched to budget successfully!"),await o({force:!0})}catch(Ae){j(Ae instanceof Error?Ae.message:"Failed to switch budget")}finally{R(null)}}}async function gt(ae){if(r){V(ae),j(null),M(null);try{await U.mutateAsync({budgetId:ae,userId:r}),M("Invitation accepted! You now have access to this budget."),await o({force:!0})}catch(Ae){j(Ae instanceof Error?Ae.message:"Failed to accept invitation")}finally{V(null)}}}async function yt(ae){if(ae.preventDefault(),!!z.trim()){se(!0),j(null),ce(null);try{const Ae=await d(z.trim());Ae?ce(Ae):j("No pending invitation found for this budget ID. Make sure you've been invited by the budget owner.")}catch(Ae){j(Ae instanceof Error?Ae.message:"Failed to check invitation")}finally{se(!1)}}}async function L(){if(!(!ie||!r)){ie.budgetName,V(ie.budgetId),j(null);try{await U.mutateAsync({budgetId:ie.budgetId,userId:r}),M(`Successfully joined "${ie.budgetName}"!`),ce(null),G(""),await o({force:!0})}catch(ae){j(ae instanceof Error?ae.message:"Failed to accept invitation")}finally{V(null)}}}function de(ae,Ae){W(Ae),K(ae)}async function ye(ae){if(ae.preventDefault(),!(!q.trim()||!Z||!n)){q.trim(),re(!0),j(null),M(null);try{await O.mutateAsync({budgetId:n,newName:q.trim()}),M("Budget renamed successfully!"),K(null),await o({force:!0})}catch(Ae){j(Ae instanceof Error?Ae.message:"Failed to rename budget")}finally{re(!1)}}}async function ee(ae){if(ae.preventDefault(),!!r){we.trim(),Ue(!0),j(null),M(null);try{const Ae=await $.mutateAsync({name:we.trim()||"My Budget",userId:r,userEmail:g()});await l(Ae.budgetId),M("Budget created successfully!"),he(""),await o({force:!0})}catch(Ae){j(Ae instanceof Error?Ae.message:"Failed to create budget")}finally{Ue(!1)}}}const J=i.filter(ae=>!ae.isPending),oe=i.filter(ae=>ae.isPending);if(D.useEffect(()=>(I||!h?t("my-budgets","Loading your budgets..."):e("my-budgets"),()=>e("my-budgets")),[I,h,t,e]),I||!h)return null;let Se="My Budgets",xe="Switch between budgets, accept invitations, or create a new budget.";return S?(Se="Budget Not Found",xe="Your selected budget could not be found. It may have been deleted. Select another budget or create a new one."):C&&(Se="Welcome!",xe="Get started by creating your first budget or accepting an invitation."),u.jsxs("div",{children:[u.jsx("h1",{children:Se}),u.jsx("p",{style:{opacity:.7,marginBottom:"1.5rem"},children:xe}),H&&u.jsx(mz,{message:H,onDismiss:()=>j(null)}),B&&u.jsx(pz,{message:B,onDismiss:()=>M(null)}),oe.length>0&&u.jsxs("div",{style:{background:"color-mix(in srgb, #f59e0b 10%, transparent)",border:"1px solid color-mix(in srgb, #f59e0b 30%, transparent)",padding:"1.25rem",borderRadius:"8px",marginBottom:"1.5rem"},children:[u.jsxs("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{children:""})," Pending Invitations (",oe.length,")"]}),u.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:oe.map(ae=>u.jsx(L1,{budget:ae,isCurrent:!1,isAccepting:N===ae.id,isSwitching:!1,isEditing:!1,editName:"",isRenaming:!1,onAccept:()=>gt(ae.id),onSwitch:()=>{},onStartEdit:()=>{},onCancelEdit:()=>{},onEditNameChange:()=>{},onSaveEdit:()=>{}},ae.id))})]}),J.length>0&&u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px",marginBottom:"1.5rem"},children:[u.jsxs("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{children:""})," Your Budgets (",J.length,")"]}),u.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:J.map(ae=>u.jsx(L1,{budget:ae,isCurrent:ae.id===n,isAccepting:!1,isSwitching:k===ae.id,isEditing:Z===ae.id,editName:Z===ae.id?q:"",isRenaming:X,onAccept:()=>{},onSwitch:()=>Be(ae.id),onStartEdit:()=>de(ae.id,ae.name),onCancelEdit:()=>{K(null),W("")},onEditNameChange:W,onSaveEdit:ye},ae.id))})]}),u.jsxs("div",{style:{background:"color-mix(in srgb, #646cff 8%, transparent)",border:"1px solid color-mix(in srgb, #646cff 25%, transparent)",padding:"1.5rem",borderRadius:"8px",marginBottom:"1.5rem"},children:[u.jsxs("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{children:""})," Create New Budget"]}),u.jsxs("form",{onSubmit:ee,children:[u.jsxs("div",{style:{marginBottom:"1rem"},children:[u.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.9rem",opacity:.8},children:"Budget Name"}),u.jsx("input",{type:"text",value:we,onChange:ae=>he(ae.target.value),placeholder:"My Budget",style:{width:"100%",padding:"0.6rem 0.8rem",borderRadius:"6px",border:"1px solid color-mix(in srgb, currentColor 25%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"0.95rem",color:"inherit",boxSizing:"border-box"}}),u.jsx("p",{style:{margin:"0.5rem 0 0 0",fontSize:"0.8rem",opacity:.5},children:"You can always rename this later"})]}),u.jsx("button",{type:"submit",disabled:Ee,style:{background:me.primary,color:"white",border:"none",padding:"0.6rem 1.5rem",borderRadius:"6px",cursor:Ee?"not-allowed":"pointer",fontWeight:500,opacity:Ee?.7:1,fontSize:"0.9rem"},children:Ee?"Creating...":"Create Budget"})]})]}),u.jsx(gz,{budgetIdInput:z,setBudgetIdInput:G,isCheckingManual:te,manualInvite:ie,isAccepting:N,onCheckInvite:yt,onAcceptInvite:L,onCancel:()=>{ce(null),G("")}}),r&&u.jsx(yz,{currentUserId:r})]})}const bz=["accounts","categories","users"];function vz(){const{addLoadingHold:t,removeLoadingHold:e}=Gn(),{lastSettingsTab:n,setLastSettingsTab:r,setPageTitle:i,selectedBudgetId:o,setCurrentViewingDocument:l}=Ye();D.useLayoutEffect(()=>{i("Budget Settings")},[i]),D.useEffect(()=>(o&&l({type:"budget"}),()=>{l({type:null})}),[o,l]);const{isOwner:d,isLoading:h}=An();D.useEffect(()=>(h?t("settings","Loading settings..."):e("settings"),()=>e("settings")),[h,t,e]);const m=On(),p=m.pathname==="/budget/settings",g=D.useMemo(()=>{const S=m.pathname;return S.includes("/settings/accounts")?"accounts":S.includes("/settings/categories")?"categories":S.includes("/settings/users")?"users":"categories"},[m.pathname]),v=g==="users";D.useEffect(()=>{p||r(g)},[g,p,r]);function b(){return!bz.includes(n)||n==="users"&&!d?"categories":n}const E=D.useMemo(()=>[{id:"accounts",label:"Accounts",icon:""},{id:"categories",label:"Categories",icon:""},{id:"users",label:"Users",icon:"",hidden:!d}],[d]);return h?null:!d&&v?u.jsxs("div",{children:[u.jsx("h1",{children:"Access Denied"}),u.jsx("p",{style:{opacity:.7},children:"Only the budget owner can access this section."}),u.jsx("p",{style:{marginTop:"1rem"},children:u.jsx(Cn,{to:"/budget/settings/categories",children:"Go to Categories "})})]}):u.jsxs("div",{children:[u.jsx(Df,{mode:"link",linkPrefix:"/budget/settings",tabs:E,activeTab:p?b():g}),p?u.jsx(Bf,{to:`/budget/settings/${b()}`,replace:!0}):u.jsx(WT,{children:u.jsx(zf,{})})]})}function e_({initialData:t,onSubmit:e,onCancel:n,submitLabel:r,accountGroups:i,showGroupSelector:o=!1,showIncomeSettings:l=!1,hasExistingIncomeDefault:d=!1,hasExistingOutgoDefault:h=!1,currentGroupId:m,onDelete:p}){const[g,v]=D.useState(t||{nickname:"",account_group_id:null,is_income_account:!1,is_income_default:!1,is_outgo_account:!1,is_outgo_default:!1,on_budget:!0,is_active:!0,is_hidden:!1}),b=g.account_group_id||m,E=b?i.find(O=>O.id===b):null,x=E?.is_active!==null,S=E?.on_budget!==null;function C(O){O.preventDefault(),g.nickname.trim()&&e(g)}function T(O){v({...g,is_income_account:O,is_income_default:O?g.is_income_default:!1})}function I(O){v({...g,is_outgo_account:O,is_outgo_default:O?g.is_outgo_default:!1})}return u.jsxs(xi,{actionName:r==="Create Account"?"Create Account":"Update Account",onSubmit:C,children:[u.jsx(Pt,{label:"Account Nickname",htmlFor:"account-nickname",children:u.jsx(wi,{id:"account-nickname",type:"text",value:g.nickname,onChange:O=>v({...g,nickname:O.target.value}),placeholder:"e.g., Main Checking, Savings",required:!0,autoFocus:!0})}),o&&u.jsx(Pt,{label:"Account Type",htmlFor:"account-group",children:u.jsxs($u,{id:"account-group",value:g.account_group_id||Xt,onChange:O=>v({...g,account_group_id:O.target.value===Xt?null:O.target.value}),children:[u.jsx("option",{value:Xt,children:"Ungrouped"}),i.map(O=>u.jsx("option",{value:O.id,children:O.name},O.id))]})}),l&&u.jsxs("div",{style:{padding:"0.75rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",display:"flex",flexDirection:"column",gap:"0.75rem"},children:[u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[u.jsx("p",{style:{margin:0,fontSize:"0.85rem",opacity:.7},children:"Account Status"}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[u.jsx($r,{id:"is-active",checked:x?E.is_active:g.is_active!==!1,onChange:O=>v({...g,is_active:O.target.checked}),disabled:x,children:u.jsx("span",{style:{opacity:x?.5:1},children:"Active account"})}),x&&u.jsxs("p",{style:{margin:0,fontSize:"0.7rem",opacity:.6,marginLeft:"2rem",color:me.warning},children:['Set by account type "',E.name,'"']})]}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[u.jsx($r,{id:"on-budget",checked:S?E.on_budget:g.on_budget!==!1,onChange:O=>v({...g,on_budget:O.target.checked}),disabled:S,children:u.jsx("span",{style:{opacity:S?.5:1},children:"On budget (affects budget totals)"})}),S&&u.jsxs("p",{style:{margin:0,fontSize:"0.7rem",opacity:.6,marginLeft:"2rem",color:me.warning},children:['Set by account type "',E.name,'"']})]}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[u.jsx($r,{id:"is-hidden",checked:g.is_hidden||!1,onChange:O=>v({...g,is_hidden:O.target.checked}),children:"Hidden account"}),u.jsx("p",{style:{margin:0,fontSize:"0.7rem",opacity:.6,marginLeft:"2rem"},children:"Hidden accounts don't appear in dropdowns or balance displays. Use for historical accounts that aren't actively used."})]})]}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[u.jsx("p",{style:{margin:0,fontSize:"0.85rem",opacity:.7},children:"Income Settings"}),u.jsx($r,{id:"is-income-account",checked:g.is_income_account||!1,onChange:O=>T(O.target.checked),children:"Show in income deposit list"}),g.is_income_account&&u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem",marginLeft:"2rem"},children:[u.jsx($r,{id:"is-income-default",checked:g.is_income_default||!1,onChange:O=>v({...g,is_income_default:O.target.checked}),disabled:d&&!t?.is_income_default,children:"Default account for new income"}),d&&!t?.is_income_default&&u.jsx("p",{style:{margin:0,fontSize:"0.75rem",opacity:.5},children:"Another account is already set as default"})]})]}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[u.jsx("p",{style:{margin:0,fontSize:"0.85rem",opacity:.7},children:"Expense Settings"}),u.jsx($r,{id:"is-outgo-account",checked:g.is_outgo_account||!1,onChange:O=>I(O.target.checked),children:"Show in expense account list"}),g.is_outgo_account&&u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem",marginLeft:"2rem"},children:[u.jsx($r,{id:"is-outgo-default",checked:g.is_outgo_default||!1,onChange:O=>v({...g,is_outgo_default:O.target.checked}),disabled:h&&!t?.is_outgo_default,children:"Default account for new expenses"}),h&&!t?.is_outgo_default&&u.jsx("p",{style:{margin:0,fontSize:"0.75rem",opacity:.5},children:"Another account is already set as default"})]})]})]}),u.jsxs(Pa,{children:[u.jsx(Ve,{type:"submit",actionName:r,children:r}),u.jsx(Ve,{type:"button",variant:"secondary",actionName:"Cancel Account Form",onClick:n,children:"Cancel"}),p&&u.jsx(Ve,{type:"button",variant:"secondary",actionName:"Delete Account",onClick:O=>{O.preventDefault(),p()},style:{color:"#ff6b6b",borderColor:"#ff6b6b"},children:" Delete"})]})]})}function tS({label:t,value:e,onChange:n,trueLabel:r,falseLabel:i,undefinedLabel:o}){function l(){n(e===void 0?!0:e===!0?!1:void 0)}const d=e===!0?r:e===!1?i:o,h=e===!0?me.success:e===!1?me.warning:"inherit",m=e===!0?"":e===!1?"":"";return u.jsxs("button",{type:"button",onClick:l,style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 0.75rem",background:e!==void 0?`color-mix(in srgb, ${h} 15%, transparent)`:"color-mix(in srgb, currentColor 8%, transparent)",border:e!==void 0?`1px solid color-mix(in srgb, ${h} 40%, transparent)`:"1px solid color-mix(in srgb, currentColor 20%, transparent)",borderRadius:"6px",cursor:"pointer",fontSize:"0.85rem",color:"inherit",textAlign:"left",width:"100%"},children:[u.jsx("span",{style:{width:"1.25rem",height:"1.25rem",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"4px",background:e!==void 0?h:"color-mix(in srgb, currentColor 20%, transparent)",color:e!==void 0?"white":"inherit",fontWeight:600,fontSize:"0.75rem"},children:m}),u.jsxs("span",{style:{flex:1},children:[u.jsxs("span",{style:{opacity:.7},children:[t,":"]})," ",u.jsx("span",{style:{fontWeight:500,color:h},children:d})]}),u.jsx("span",{style:{fontSize:"0.7rem",opacity:.5},children:"click to cycle"})]})}function nS({initialData:t,onSubmit:e,onCancel:n,submitLabel:r}){const[i,o]=D.useState(t||{name:"",expected_balance:"positive"});function l(d){d.preventDefault(),i.name.trim()&&e(i)}return u.jsxs(xi,{actionName:r==="Create Account Type"?"Create Account Type":"Update Account Type",onSubmit:l,children:[u.jsx(Pt,{label:"Account Type Name",htmlFor:"group-name",children:u.jsx(wi,{id:"group-name",type:"text",value:i.name,onChange:d=>o({...i,name:d.target.value}),placeholder:"e.g., Checking, Savings, Credit Cards, Investments",required:!0,autoFocus:!0})}),u.jsx(Pt,{label:"Expected Balance",htmlFor:"expected-balance",children:u.jsxs($u,{id:"expected-balance",value:i.expected_balance,onChange:d=>o({...i,expected_balance:d.target.value}),children:[u.jsx("option",{value:"positive",children:"Normally Positive (e.g., Checking, Savings)"}),u.jsx("option",{value:"negative",children:"Normally Negative (e.g., Credit Cards, Loans)"}),u.jsx("option",{value:"any",children:"Either (no warnings)"})]})}),u.jsxs("div",{style:{padding:"0.75rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",display:"flex",flexDirection:"column",gap:"0.5rem"},children:[u.jsxs("p",{style:{margin:0,fontSize:"0.85rem",opacity:.7},children:["Group-Level Overrides ",u.jsx("span",{style:{fontSize:"0.75rem",opacity:.6},children:"(applies to all accounts in this type)"})]}),u.jsx(tS,{label:"Active status",value:i.is_active,onChange:d=>o({...i,is_active:d}),trueLabel:"All active",falseLabel:"All inactive",undefinedLabel:"Per account"}),u.jsx(tS,{label:"Budget status",value:i.on_budget,onChange:d=>o({...i,on_budget:d}),trueLabel:"All on budget",falseLabel:"All off budget",undefinedLabel:"Per account"})]}),u.jsxs(Pa,{children:[u.jsx(Ve,{type:"submit",actionName:r,children:r}),u.jsx(Ve,{type:"button",variant:"secondary",actionName:"Cancel Account Type Form",onClick:n,children:"Cancel"})]})]})}function jl({icon:t,label:e,variant:n,title:r}){const o={success:{background:`color-mix(in srgb, ${me.success} 20%, transparent)`,border:`1px solid color-mix(in srgb, ${me.success} 40%, transparent)`,color:me.success,opacity:1},warning:{background:`color-mix(in srgb, ${me.warning} 15%, transparent)`,border:`1px solid color-mix(in srgb, ${me.warning} 35%, transparent)`,color:me.warning,opacity:1},muted:{background:"color-mix(in srgb, currentColor 12%, transparent)",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",color:"inherit",opacity:.7},income:{background:`color-mix(in srgb, ${me.success} 10%, transparent)`,border:`1px solid color-mix(in srgb, ${me.success} 25%, transparent)`,color:me.success,opacity:.7},expense:{background:`color-mix(in srgb, ${me.warning} 10%, transparent)`,border:`1px solid color-mix(in srgb, ${me.warning} 25%, transparent)`,color:me.warning,opacity:.7}}[n];return u.jsxs("span",{title:r||e,style:{display:"inline-flex",alignItems:"center",gap:"0.25rem",background:o.background,border:o.border,padding:"0.15rem 0.4rem",borderRadius:"4px",fontSize:"0.7rem",fontWeight:500,textTransform:"uppercase",letterSpacing:"0.3px",color:o.color,opacity:o.opacity,whiteSpace:"nowrap"},children:[u.jsx("span",{style:{fontSize:"0.75rem"},children:t}),e]})}function rS({account:t,accountGroups:e}){const n=[],r=t.account_group_id?e.find(l=>l.id===t.account_group_id):null,i=r&&r.is_active!==null?r.is_active:t.is_active!==!1,o=r&&r.on_budget!==null?r.on_budget:t.on_budget!==!1;if(!i){const l=r&&r.is_active!==null;n.push(u.jsx(jl,{icon:"",label:l?"Inactive (type)":"Inactive",variant:"warning",title:l?`Set by "${r.name}" account type`:"Account is inactive/archived"},"inactive"))}if(!o){const l=r&&r.on_budget!==null;n.push(u.jsx(jl,{icon:"",label:l?"Off Budget (type)":"Off Budget",variant:"warning",title:l?`Set by "${r.name}" account type`:"Tracking only - not included in budget"},"off-budget"))}return t.is_income_default?n.push(u.jsx(jl,{icon:"",label:"Income Default",variant:"success",title:"Default income deposit account"},"income-default")):t.is_income_account&&n.push(u.jsx(jl,{icon:"",label:"Income",variant:"income",title:"Income deposit account"},"income")),t.is_outgo_default?n.push(u.jsx(jl,{icon:"",label:"Expense Default",variant:"warning",title:"Default expense account"},"outgo-default")):t.is_outgo_account&&n.push(u.jsx(jl,{icon:"",label:"Expense",variant:"expense",title:"Expense account"},"outgo")),n.length===0?null:u.jsx(u.Fragment,{children:n})}function xz({account:t,accountIndex:e,allGroups:n,allAccounts:r,onEdit:i,onDelete:o,onMoveUp:l,onMoveDown:d,canMoveUp:h,canMoveDown:m,editingAccountId:p,setEditingAccountId:g,onUpdateAccount:v,isMobile:b}){if(p===t.id)return u.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"0.5rem"},children:u.jsx(e_,{initialData:{nickname:t.nickname,account_group_id:t.account_group_id,is_income_account:t.is_income_account,is_income_default:t.is_income_default,is_outgo_account:t.is_outgo_account,is_outgo_default:t.is_outgo_default,on_budget:t.on_budget,is_active:t.is_active},onSubmit:C=>{v(t.id,C),g(null)},onCancel:()=>g(null),onDelete:()=>{t.nickname,o(t.id),g(null)},submitLabel:"Save",accountGroups:n,showGroupSelector:!0,showIncomeSettings:!0,currentGroupId:t.account_group_id,hasExistingIncomeDefault:Object.entries(r).some(([C,T])=>T.is_income_default&&C!==t.id),hasExistingOutgoDefault:Object.entries(r).some(([C,T])=>T.is_outgo_default&&C!==t.id)})});if(b)return u.jsx("div",{style:{gridColumn:"1 / -1"},children:u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",padding:"0.75rem",marginBottom:"0.25rem"},children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"},children:[u.jsx("span",{style:{fontWeight:500},children:t.nickname}),u.jsx("span",{style:{color:Bt(t.balance),fontWeight:600},children:Xe(t.balance)})]}),u.jsx("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap",marginBottom:"0.5rem"},children:u.jsx(rS,{account:t,accountGroups:n})}),u.jsxs("div",{style:{display:"flex",gap:"0.5rem",justifyContent:"flex-end"},children:[u.jsx("button",{onClick:C=>{C.stopPropagation(),t.nickname,i(t.id)},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Edit",children:""}),u.jsx("button",{onClick:C=>{C.stopPropagation(),l()},disabled:!h,style:{background:"transparent",border:"none",cursor:h?"pointer":"default",opacity:h?.6:.2,fontSize:"0.9rem",padding:"0.25rem"},title:"Move up",children:""}),u.jsx("button",{onClick:C=>{C.stopPropagation(),d()},disabled:!m,style:{background:"transparent",border:"none",cursor:m?"pointer":"default",opacity:m?.6:.2,fontSize:"0.9rem",padding:"0.25rem"},title:"Move down",children:""})]})]})});const S={padding:"0.5rem",background:e%2===0?"transparent":"rgba(255,255,255,0.04)",display:"flex",alignItems:"center",fontSize:"0.9rem"};return u.jsxs("div",{style:{display:"contents"},children:[u.jsx("div",{style:{...S,fontWeight:500,overflow:"hidden",paddingLeft:"1.5rem",borderLeft:"2px solid rgba(255,255,255,0.1)"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.nickname})}),u.jsx("div",{style:{...S,justifyContent:"flex-end",color:Bt(t.balance),fontWeight:600},children:Xe(t.balance)}),u.jsx("div",{style:{...S,gap:"0.25rem",flexWrap:"wrap"},children:u.jsx(rS,{account:t,accountGroups:n})}),u.jsxs("div",{style:{...S,justifyContent:"flex-end",gap:"0.25rem"},children:[u.jsx("button",{onClick:C=>{C.stopPropagation(),t.nickname,i(t.id)},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Edit",children:""}),u.jsx("button",{onClick:C=>{C.stopPropagation(),l()},disabled:!h,style:{background:"transparent",border:"none",cursor:h?"pointer":"default",opacity:h?.6:.2,fontSize:"0.9rem",padding:"0.25rem"},title:"Move up",children:""}),u.jsx("button",{onClick:C=>{C.stopPropagation(),d()},disabled:!m,style:{background:"transparent",border:"none",cursor:m?"pointer":"default",opacity:m?.6:.2,fontSize:"0.9rem",padding:"0.25rem"},title:"Move down",children:""})]})]})}function sS({group:t,accounts:e,allGroups:n,allAccounts:r,editingAccountId:i,createForGroupId:o,setEditingAccountId:l,setCreateForGroupId:d,onUpdateAccount:h,onDeleteAccount:m,onMoveAccount:p,onCreateAccount:g,isMobile:v,isUngrouped:b,canMoveGroupUp:E,canMoveGroupDown:x,onEditGroup:S,onDeleteGroup:C,onMoveGroupUp:T,onMoveGroupDown:I}){const O=[...e].sort((k,R)=>k.sort_order-R.sort_order),U=O.reduce((k,R)=>k+R.balance,0),$={padding:"0.6rem 0.5rem",marginTop:"1.25rem",borderTop:"1px solid rgba(255,255,255,0.2)",borderBottom:Ra,background:"rgba(255,255,255,0.04)",display:"flex",alignItems:"center",fontSize:"0.9rem",fontWeight:600};return u.jsxs("div",{style:{display:"contents"},children:[!v&&u.jsxs(u.Fragment,{children:[u.jsxs("div",{style:{...$,opacity:b?.7:1,justifyContent:"space-between"},children:[u.jsxs("span",{children:[u.jsx("span",{children:t.name}),u.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",O.length,")"]})]}),u.jsx("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center",flexShrink:0},children:!b&&u.jsxs(u.Fragment,{children:[u.jsx(Ve,{variant:"small",actionName:`Open Add Account Form (${t.name})`,onClick:()=>d(t.id),disabled:o!==null,children:"+ Account"}),u.jsx("button",{onClick:()=>{t.name,S()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Edit account type",children:""}),u.jsx("button",{onClick:()=>{t.name,C()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Delete account type",children:""}),u.jsxs("div",{style:If,children:[u.jsx("button",{onClick:T,disabled:!E,style:{...ha,opacity:E?.6:.2,cursor:E?"pointer":"default"},title:"Move up","aria-label":"Move up",children:""}),u.jsx("button",{onClick:I,disabled:!x,style:{...ha,opacity:x?.6:.2,cursor:x?"pointer":"default"},title:"Move down","aria-label":"Move down",children:""})]})]})})]}),u.jsx("div",{style:{...$,justifyContent:"flex-end",color:Bt(U)},children:an.showGroupTotals}),u.jsx("div",{style:$}),u.jsx("div",{style:$})]}),v&&u.jsxs("div",{style:{gridColumn:"1 / -1",padding:"0.6rem 0.5rem",marginTop:"1.25rem",borderTop:"1px solid rgba(255,255,255,0.2)",borderBottom:Ra,background:"rgba(255,255,255,0.04)"},children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"},children:[u.jsxs("span",{style:{fontWeight:600,opacity:b?.7:1},children:[t.name,u.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",O.length,")"]})]}),an.showGroupTotals]}),!b&&u.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center",flexWrap:"wrap"},children:[u.jsx(Ve,{variant:"small",actionName:`Open Add Account Form (${t.name})`,onClick:()=>d(t.id),disabled:o!==null,children:"+ Account"}),u.jsx("button",{onClick:()=>{t.name,S()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Edit account type",children:""}),u.jsx("button",{onClick:()=>{t.name,C()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Delete account type",children:""}),u.jsxs("div",{style:If,children:[u.jsx("button",{onClick:T,disabled:!E,style:{...ha,opacity:E?.6:.2,cursor:E?"pointer":"default"},title:"Move up","aria-label":"Move up",children:""}),u.jsx("button",{onClick:I,disabled:!x,style:{...ha,opacity:x?.6:.2,cursor:x?"pointer":"default"},title:"Move down","aria-label":"Move down",children:""})]})]})]}),O.map((k,R)=>u.jsx(xz,{account:k,accountIndex:R,totalAccounts:O.length,allGroups:n,allAccounts:r,onEdit:l,onDelete:m,onMoveUp:()=>p(k.id,"up"),onMoveDown:()=>p(k.id,"down"),canMoveUp:R>0,canMoveDown:R<O.length-1,editingAccountId:i,setEditingAccountId:l,onUpdateAccount:h,isMobile:v},k.id)),o===t.id&&u.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"0.5rem"},children:u.jsx(e_,{initialData:{nickname:"",account_group_id:t.id},onSubmit:k=>g(k,t.id),onCancel:()=>d(null),submitLabel:"Create",accountGroups:n,showIncomeSettings:!0,currentGroupId:t.id})})]})}function wz(){const{selectedBudgetId:t}=Ye(),{monthMap:e,isLoading:n}=An(),{accounts:r,accountsByGroup:i,hiddenAccounts:o,sortedGroups:l,currentBudget:d,error:h,setError:m,handleCreateAccount:p,handleUpdateAccount:g,handleDeleteAccount:v,handleMoveAccount:b,handleCreateGroup:E,handleUpdateGroup:x,handleDeleteGroup:S,handleMoveGroup:C}=K4(),T=Ei(),{addLoadingHold:I,removeLoadingHold:O}=Gn();D.useEffect(()=>(n||!d?I("accounts","Loading accounts..."):O("accounts"),()=>O("accounts")),[n,d,I,O]),od({budgetId:t,monthMap:e,checkAnyMonth:!0,additionalCondition:!n&&!!d,logPrefix:"[Settings/Accounts]"});const[U,$]=D.useState(null),[k,R]=D.useState(null),[N,V]=D.useState(null),[H,j]=D.useState(!1),B=D.useMemo(()=>{const W=Object.values(r),X=W.reduce((G,te)=>G+(te.balance??0),0);let re=0,z=0;for(const G of W){const te=l.find(ie=>ie.id===G.account_group_id);G.on_budget===!0||G.on_budget===void 0&&te?.on_budget!==!1?re+=G.balance??0:z+=G.balance??0}return{count:W.length,groupCount:l.filter(G=>G.id!==Xt).length,totalBalance:X,onBudgetTotal:re,offBudgetTotal:z}},[r,l]),M=D.useMemo(()=>l.filter(W=>W.id!==Xt),[l]),Z=D.useMemo(()=>({id:Xt,name:"Ungrouped",sort_order:M.length,expected_balance:"any",on_budget:null,is_active:null}),[M.length]),K=i[Xt]||[],q={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderBottom:"2px solid rgba(255,255,255,0.2)"};return D.useEffect(()=>{h&&(console.error("[Settings/Accounts] Error:",h),mr.add({type:"error",message:"Failed to update accounts. See console for details.",autoDismissMs:0}),m(null))},[h,m]),n?null:d?u.jsxs("div",{children:[u.jsx("div",{style:{position:"sticky",top:0,zIndex:50,backgroundColor:"#242424",marginLeft:"calc(-1 * var(--page-padding, 2rem))",marginRight:"calc(-1 * var(--page-padding, 2rem))",paddingLeft:"var(--page-padding, 2rem)",paddingRight:"var(--page-padding, 2rem)",paddingTop:"0.5rem",paddingBottom:"0.5rem",borderBottom:"1px solid rgba(255,255,255,0.15)"},children:u.jsxs("div",{style:{display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem"},children:[u.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[u.jsx("span",{style:{fontWeight:600},children:"Accounts:"}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"On-Budget: "}),u.jsx("span",{style:{color:Bt(B.onBudgetTotal),fontWeight:600},children:Xe(B.onBudgetTotal)})]}),B.offBudgetTotal!==0&&u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"Off-Budget: "}),u.jsx("span",{style:{fontWeight:600,opacity:.7},children:Xe(B.offBudgetTotal)})]}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"Total: "}),u.jsx("span",{style:{color:Bt(B.totalBalance),fontWeight:600},children:Xe(B.totalBalance)})]}),u.jsx("span",{style:{opacity:.5,fontSize:"0.8rem"},children:"Use  buttons to reorder accounts."})]}),u.jsx("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:u.jsx(Y0,{})})]})}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:T?"1fr":"2fr 1fr 1.5fr 1fr",marginTop:"1rem",marginBottom:"1.5rem"},children:[u.jsx("div",{style:{gridColumn:"1 / -1",position:"sticky",top:"3.5rem",zIndex:49,backgroundColor:"#242424",display:T?"block":"grid",gridTemplateColumns:T?void 0:"subgrid"},children:!T&&u.jsxs(u.Fragment,{children:[u.jsx("div",{style:q,children:"Account"}),u.jsx("div",{style:{...q,textAlign:"right"},children:"Balance"}),u.jsx("div",{style:q,children:"Flags"}),u.jsx("div",{style:{...q,textAlign:"right"},children:"Actions"})]})}),Object.keys(r).length===0&&M.length===0&&u.jsx("p",{style:{gridColumn:"1 / -1",opacity:.7,textAlign:"center",padding:"2rem"},children:"No accounts yet. Create an account type first, then add accounts!"}),M.map((W,X)=>{const re=i[W.id]||[];return re.length===0&&N!==W.id&&k!==W.id?null:N===W.id?u.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"1rem"},children:u.jsx(nS,{initialData:{name:W.name,expected_balance:W.expected_balance||"positive",on_budget:W.on_budget??void 0,is_active:W.is_active??void 0},onSubmit:z=>{x(W.id,z),V(null)},onCancel:()=>V(null),submitLabel:"Save"})},W.id):u.jsx(sS,{group:W,accounts:re,allGroups:M,allAccounts:r,editingAccountId:U,createForGroupId:k,setEditingAccountId:$,setCreateForGroupId:R,onUpdateAccount:(z,G)=>{g(z,G),$(null)},onDeleteAccount:v,onMoveAccount:b,onCreateAccount:p,isMobile:T,canMoveGroupUp:X>0,canMoveGroupDown:X<M.length-1,onEditGroup:()=>V(W.id),onDeleteGroup:()=>S(W.id),onMoveGroupUp:()=>C(W.id,"up"),onMoveGroupDown:()=>C(W.id,"down")},W.id)}),(K.length>0||k==="ungrouped")&&u.jsx(sS,{group:Z,accounts:K,allGroups:M,allAccounts:r,editingAccountId:U,createForGroupId:k,setEditingAccountId:$,setCreateForGroupId:R,onUpdateAccount:(W,X)=>{g(W,X),$(null)},onDeleteAccount:v,onMoveAccount:b,onCreateAccount:p,isMobile:T,isUngrouped:!0,canMoveGroupUp:!1,canMoveGroupDown:!1,onEditGroup:()=>{},onDeleteGroup:()=>{},onMoveGroupUp:()=>{},onMoveGroupDown:()=>{}}),u.jsx("div",{style:{gridColumn:"1 / -1",height:"1rem"}})]}),o.length>0&&u.jsx("div",{style:{marginBottom:"2rem"},children:u.jsxs(G0,{title:"Hidden Accounts",count:o.length,children:[u.jsxs("div",{style:{padding:"0.75rem",marginBottom:"1rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",fontSize:"0.85rem"},children:[u.jsxs("p",{style:{margin:"0 0 0.5rem 0",opacity:.8},children:[u.jsx("strong",{children:" Hidden accounts"})," are excluded from dropdowns and balance displays. They're useful for historical accounts (like closed bank accounts or old 401Ks) that you want to keep for record-keeping but don't need in everyday use."]}),u.jsx("p",{style:{margin:0,opacity:.6},children:'To unhide an account, click it to edit and uncheck "Hidden account".'})]}),u.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:o.map(W=>U===W.id?u.jsx(e_,{initialData:{nickname:W.nickname,account_group_id:W.account_group_id,is_income_account:W.is_income_account,is_income_default:W.is_income_default,is_outgo_account:W.is_outgo_account,is_outgo_default:W.is_outgo_default,on_budget:W.on_budget,is_active:W.is_active,is_hidden:W.is_hidden},onSubmit:X=>{g(W.id,X),$(null)},onCancel:()=>$(null),submitLabel:"Save",accountGroups:M,showGroupSelector:!0,showIncomeSettings:!0,currentGroupId:W.account_group_id,hasExistingIncomeDefault:Object.entries(r).some(([X,re])=>re.is_income_default&&X!==W.id),hasExistingOutgoDefault:Object.entries(r).some(([X,re])=>re.is_outgo_default&&X!==W.id)},W.id):u.jsxs("div",{onClick:()=>$(W.id),style:{padding:"0.75rem 1rem",background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"8px",cursor:"pointer",display:"flex",justifyContent:"space-between",alignItems:"center",opacity:.7},children:[u.jsx("span",{children:W.nickname}),u.jsx("span",{style:{color:Bt(W.balance),fontWeight:500},children:Xe(W.balance)})]},W.id))})]})}),H?u.jsx(nS,{onSubmit:W=>{E(W),j(!1)},onCancel:()=>j(!1),submitLabel:"Create Account Type"}):u.jsx(Ve,{variant:"primary-large",actionName:"Open Add Account Type Form",onClick:()=>j(!0),children:"+ Add Account Type"})]}):u.jsx("p",{children:"No budget found. Please log in."})}function t_({initialData:t,onSubmit:e,onCancel:n,submitLabel:r,categoryGroups:i=[],showGroupSelector:o=!1,onDelete:l}){const[d,h]=D.useState(t||{name:"",category_group_id:null,is_hidden:!1}),[m,p]=D.useState(t?.default_monthly_amount?.toString()||""),[g,v]=D.useState(t?.default_monthly_type||"fixed"),[b,E]=D.useState(!1);function x(S){if(S.preventDefault(),!d.name.trim())return;E(!0);const C=parseFloat(m),T=!isNaN(C)&&C>0;e({...d,description:d.description?.trim()||void 0,default_monthly_amount:T?C:void 0,default_monthly_type:T?g:void 0})}return u.jsxs(xi,{actionName:r==="Create"?"Create Category":"Update Category",onSubmit:x,children:[u.jsx(Pt,{label:"Category Name",htmlFor:"category-name",children:u.jsx(wi,{id:"category-name",type:"text",value:d.name,onChange:S=>h({...d,name:S.target.value}),placeholder:"e.g., Groceries, Rent, Gas",required:!0,autoFocus:!0})}),u.jsx(Pt,{label:"Description (optional)",htmlFor:"category-description",children:u.jsx(q0,{id:"category-description",value:d.description||"",onChange:S=>h({...d,description:S.target.value}),placeholder:"What is this category used for?",minHeight:"3rem"})}),o&&u.jsx(Pt,{label:"Category Group",htmlFor:"category-group",children:u.jsxs($u,{id:"category-group",value:d.category_group_id||ln,onChange:S=>h({...d,category_group_id:S.target.value===ln?null:S.target.value}),children:[u.jsx("option",{value:ln,children:"Uncategorized"}),i.map(S=>u.jsx("option",{value:S.id,children:S.name},S.id))]})}),u.jsxs(Pt,{label:"Default Monthly Allocation (optional)",htmlFor:"default-amount",children:[u.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center"},children:[u.jsxs($u,{id:"default-type",value:g,onChange:S=>v(S.target.value),style:{width:"auto",flex:"0 0 auto"},children:[u.jsx("option",{value:"fixed",children:"Fixed $"}),u.jsx("option",{value:"percentage",children:"% of Prev Income"})]}),g==="fixed"?u.jsx(vo,{id:"default-amount",value:m,onChange:p,placeholder:"$0.00"}):u.jsx(wi,{id:"default-amount",type:"number",value:m,onChange:S=>p(S.target.value),placeholder:"0",min:"0",max:"100",step:"0.1",style:{width:"80px"}}),g==="percentage"&&u.jsx("span",{style:{opacity:.6},children:"%"})]}),u.jsx("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.75rem",opacity:.6},children:g==="fixed"?"Suggested fixed amount to allocate each month":"Percentage of previous month's total income"})]}),o&&u.jsxs("div",{style:{padding:"0.75rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px"},children:[u.jsx($r,{id:"is-hidden",checked:d.is_hidden||!1,onChange:S=>h({...d,is_hidden:S.target.checked}),children:"Hidden category"}),u.jsx("p",{style:{margin:"0.25rem 0 0 2rem",fontSize:"0.7rem",opacity:.6},children:"Hidden categories don't appear in dropdowns or balance displays. Use for historical categories that aren't actively used."})]}),u.jsxs(Pa,{children:[u.jsx(Ve,{type:"submit",actionName:r==="Create"?"Create Category":"Save Category",isLoading:b,children:r}),u.jsx(Ve,{type:"button",variant:"secondary",actionName:"Cancel Category Form",onClick:n,children:"Cancel"}),l&&u.jsx(Ve,{type:"button",variant:"secondary",actionName:"Delete Category",onClick:S=>{S.preventDefault(),l()},style:{color:"#ff6b6b",borderColor:"#ff6b6b"},children:" Delete"})]})]})}function iS({initialData:t,onSubmit:e,onCancel:n,submitLabel:r}){const[i,o]=D.useState(t||{name:""}),[l,d]=D.useState(!1);function h(m){m.preventDefault(),i.name.trim()&&(d(!0),e(i))}return u.jsxs(xi,{actionName:r==="Create Group"?"Create Category Group":"Update Category Group",onSubmit:h,children:[u.jsx(Pt,{label:"Group Name",htmlFor:"group-name",children:u.jsx(wi,{id:"group-name",type:"text",value:i.name,onChange:m=>o({...i,name:m.target.value}),placeholder:"e.g., Housing, Transportation, Food",required:!0,autoFocus:!0})}),u.jsxs(Pa,{children:[u.jsx(Ve,{type:"submit",actionName:r==="Create Group"?"Create Category Group":"Save Category Group",isLoading:l,children:r}),u.jsx(Ve,{type:"button",variant:"secondary",actionName:"Cancel Category Group Form",onClick:n,children:"Cancel"})]})]})}function Sz({category:t,catId:e,categoryIndex:n,categoryGroups:r,categoryBalances:i,loadingBalances:o,onEdit:l,onDelete:d,onMoveUp:h,onMoveDown:m,canMoveUp:p,canMoveDown:g,editingCategoryId:v,setEditingCategoryId:b,onUpdateCategory:E,isMobile:x}){const S=i[e]||{current:0};if(v===e)return u.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"0.5rem"},children:u.jsx(t_,{initialData:{name:t.name,description:t.description,category_group_id:t.category_group_id,default_monthly_amount:t.default_monthly_amount,default_monthly_type:t.default_monthly_type,is_hidden:t.is_hidden},onSubmit:O=>{E(e,O),b(null)},onCancel:()=>b(null),onDelete:()=>{t.name,d(e),b(null)},submitLabel:"Save",categoryGroups:r,showGroupSelector:!0})});if(x)return u.jsx("div",{style:{gridColumn:"1 / -1"},children:u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",padding:"0.75rem",marginBottom:"0.25rem"},children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"},children:[u.jsx("span",{style:{fontWeight:500},children:t.name}),u.jsx("span",{style:{color:Mn(S.current),fontWeight:600},children:o?"...":os(S.current)})]}),t.description&&u.jsx("p",{style:{fontSize:"0.8rem",opacity:.6,margin:"0 0 0.5rem 0"},children:t.description}),t.default_monthly_amount!==void 0&&t.default_monthly_amount>0&&u.jsxs("div",{style:{fontSize:"0.75rem",opacity:.8,marginBottom:"0.5rem"},children:["Default: ",t.default_monthly_type==="percentage"?u.jsxs(u.Fragment,{children:[u.jsxs("span",{style:{color:me.success,fontWeight:500},children:[t.default_monthly_amount,"%"]})," of prev income"]}):u.jsxs(u.Fragment,{children:[u.jsx("span",{style:{color:me.success,fontWeight:500},children:t.default_monthly_amount}),"/mo"]})]}),u.jsxs("div",{style:{display:"flex",gap:"0.5rem",justifyContent:"flex-end"},children:[u.jsx("button",{onClick:O=>{O.stopPropagation(),t.name,l(e)},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Edit",children:""}),u.jsx("button",{onClick:O=>{O.stopPropagation(),h()},disabled:!p,style:{background:"transparent",border:"none",cursor:p?"pointer":"default",opacity:p?.6:.2,fontSize:"0.9rem",padding:"0.25rem"},title:"Move up",children:""}),u.jsx("button",{onClick:O=>{O.stopPropagation(),m()},disabled:!g,style:{background:"transparent",border:"none",cursor:g?"pointer":"default",opacity:g?.6:.2,fontSize:"0.9rem",padding:"0.25rem"},title:"Move down",children:""})]})]})});const I={padding:"0.5rem",background:n%2===0?"transparent":"rgba(255,255,255,0.04)",display:"flex",alignItems:"center",fontSize:"0.9rem"};return u.jsxs("div",{style:{display:"contents"},children:[u.jsxs("div",{style:{...I,fontWeight:500,overflow:"hidden",paddingLeft:"1.5rem",borderLeft:"2px solid rgba(255,255,255,0.1)"},children:[u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.name}),t.default_monthly_amount!==void 0&&t.default_monthly_amount>0&&u.jsx("span",{style:{marginLeft:"0.5rem",fontSize:"0.7rem",opacity:.7,background:"color-mix(in srgb, currentColor 10%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px",whiteSpace:"nowrap"},children:t.default_monthly_type==="percentage"?`${t.default_monthly_amount}%`:`${t.default_monthly_amount}/mo`})]}),u.jsx("div",{style:{...I,justifyContent:"flex-end",color:Mn(S.current),fontWeight:600},children:o?"...":os(S.current)}),u.jsx("div",{style:{...I,opacity:.7,fontSize:"0.85rem"},children:t.description?u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.description}):u.jsx("span",{style:{opacity:.4,fontStyle:"italic"},children:""})}),u.jsxs("div",{style:{...I,justifyContent:"flex-end",gap:"0.25rem"},children:[u.jsx("button",{onClick:O=>{O.stopPropagation(),t.name,l(e)},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Edit",children:""}),u.jsx("button",{onClick:O=>{O.stopPropagation(),h()},disabled:!p,style:{background:"transparent",border:"none",cursor:p?"pointer":"default",opacity:p?.6:.2,fontSize:"0.9rem",padding:"0.25rem"},title:"Move up",children:""}),u.jsx("button",{onClick:O=>{O.stopPropagation(),m()},disabled:!g,style:{background:"transparent",border:"none",cursor:g?"pointer":"default",opacity:g?.6:.2,fontSize:"0.9rem",padding:"0.25rem"},title:"Move down",children:""})]})]})}function aS({group:t,categories:e,categoryGroups:n,categoryBalances:r,loadingBalances:i,editingCategoryId:o,createForGroupId:l,setEditingCategoryId:d,setCreateForGroupId:h,handleUpdateCategory:m,handleDeleteCategory:p,handleMoveCategory:g,handleCreateCategory:v,isMobile:b,isUngrouped:E,canMoveGroupUp:x,canMoveGroupDown:S,onEditGroup:C,onDeleteGroup:T,onMoveGroupUp:I,onMoveGroupDown:O}){const U=[...e].sort((R,N)=>R[1].sort_order-N[1].sort_order),$=U.reduce((R,[N])=>{const V=r[N];return R+(V?.current||0)},0),k={padding:"0.6rem 0.5rem",marginTop:"1.25rem",borderTop:"1px solid rgba(255,255,255,0.2)",borderBottom:Ra,background:"rgba(255,255,255,0.04)",display:"flex",alignItems:"center",fontSize:"0.9rem",fontWeight:600};return u.jsxs("div",{style:{display:"contents"},children:[!b&&u.jsxs(u.Fragment,{children:[u.jsxs("div",{style:{...k,opacity:E?.7:1,justifyContent:"space-between"},children:[u.jsxs("span",{children:[u.jsx("span",{children:t.name}),u.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",U.length,")"]})]}),u.jsx("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center",flexShrink:0},children:!E&&u.jsxs(u.Fragment,{children:[u.jsx(Ve,{variant:"small",actionName:`Open Add Category Form (${t.name})`,onClick:()=>h(t.id),disabled:l!==null,children:"+ Category"}),u.jsx("button",{onClick:()=>{t.name,C()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Edit group",children:""}),u.jsx("button",{onClick:()=>{t.name,T()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Delete group",children:""}),u.jsxs("div",{style:If,children:[u.jsx("button",{onClick:I,disabled:!x,style:{...ha,opacity:x?.6:.2,cursor:x?"pointer":"default"},title:"Move group up","aria-label":"Move group up",children:""}),u.jsx("button",{onClick:O,disabled:!S,style:{...ha,opacity:S?.6:.2,cursor:S?"pointer":"default"},title:"Move group down","aria-label":"Move group down",children:""})]})]})})]}),u.jsx("div",{style:{...k,justifyContent:"flex-end",color:Mn($)},children:an.showGroupTotals}),u.jsx("div",{style:k}),u.jsx("div",{style:k})]}),b&&u.jsxs("div",{style:{gridColumn:"1 / -1",padding:"0.6rem 0.5rem",marginTop:"1.25rem",borderTop:"1px solid rgba(255,255,255,0.2)",borderBottom:Ra,background:"rgba(255,255,255,0.04)"},children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"},children:[u.jsxs("span",{style:{fontWeight:600,opacity:E?.7:1},children:[t.name,u.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",U.length,")"]})]}),an.showGroupTotals]}),!E&&u.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center",flexWrap:"wrap"},children:[u.jsx(Ve,{variant:"small",actionName:`Open Add Category Form (${t.name})`,onClick:()=>h(t.id),disabled:l!==null,children:"+ Category"}),u.jsx("button",{onClick:()=>{t.name,C()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Edit group",children:""}),u.jsx("button",{onClick:()=>{t.name,T()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Delete group",children:""}),u.jsxs("div",{style:If,children:[u.jsx("button",{onClick:I,disabled:!x,style:{...ha,opacity:x?.6:.2,cursor:x?"pointer":"default"},title:"Move group up","aria-label":"Move group up",children:""}),u.jsx("button",{onClick:O,disabled:!S,style:{...ha,opacity:S?.6:.2,cursor:S?"pointer":"default"},title:"Move group down","aria-label":"Move group down",children:""})]})]})]}),U.map(([R,N],V)=>u.jsx(Sz,{category:N,catId:R,categoryIndex:V,totalCategories:U.length,categoryGroups:n,categoryBalances:r,loadingBalances:i,onEdit:d,onDelete:p,onMoveUp:()=>g(R,"up"),onMoveDown:()=>g(R,"down"),canMoveUp:V>0,canMoveDown:V<U.length-1,editingCategoryId:o,setEditingCategoryId:d,onUpdateCategory:m,isMobile:b},R)),l===t.id&&u.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"0.5rem"},children:u.jsx(t_,{initialData:{name:"",category_group_id:t.id},onSubmit:R=>v(R,t.id),onCancel:()=>h(null),submitLabel:"Create",categoryGroups:n})})]})}function Ez(){const{selectedBudgetId:t}=Ye(),{monthMap:e,isLoading:n}=An(),{currentBudget:r,categories:i,categoryGroups:o,categoriesByGroup:l,hiddenCategories:d,sortedGroups:h,categoryBalances:m,isLoading:p,loadingBalances:g,error:v,setError:b,getOnBudgetTotal:E,handleCreateCategory:x,handleUpdateCategory:S,handleDeleteCategory:C,handleMoveCategory:T,handleCreateGroup:I,handleUpdateGroup:O,handleDeleteGroup:U,handleMoveGroup:$}=J4();od({budgetId:t,monthMap:e,checkAnyMonth:!0,additionalCondition:!n&&!p&&!!r,logPrefix:"[Settings/Categories]"});const k=Ei(),{addLoadingHold:R,removeLoadingHold:N}=Gn();D.useEffect(()=>(n||p||!r?R("categories","Loading categories..."):N("categories"),()=>N("categories")),[n,p,r,R,N]);const[V,H]=D.useState(null),[j,B]=D.useState(null),[M,Z]=D.useState(null),[K,q]=D.useState(!1),W=D.useMemo(()=>h.filter(ce=>ce.id!==ln),[h]),X=D.useMemo(()=>({id:ln,name:"Uncategorized",sort_order:W.length}),[W.length]),re=(l[ln]||[]).sort((ce,we)=>ce[1].sort_order-we[1].sort_order);if(D.useEffect(()=>{v&&(console.error("[Settings/Categories] Error:",v),mr.add({type:"error",message:"Failed to update categories. See console for details.",autoDismissMs:0}),b(null))},[v,b]),n||p)return null;if(!r)return u.jsx("p",{children:"No budget found. Please log in."});const z=Object.values(m).reduce((ce,we)=>ce+we.current,0),G=Object.values(m).reduce((ce,we)=>ce+we.total,0),te=E()-z,se=Math.abs(G-z)>.01,ie={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderBottom:"2px solid rgba(255,255,255,0.2)"};return u.jsxs("div",{children:[u.jsx("div",{style:{position:"sticky",top:0,zIndex:50,backgroundColor:"#242424",marginLeft:"calc(-1 * var(--page-padding, 2rem))",marginRight:"calc(-1 * var(--page-padding, 2rem))",paddingLeft:"var(--page-padding, 2rem)",paddingRight:"var(--page-padding, 2rem)",paddingTop:"0.5rem",paddingBottom:"0.5rem",borderBottom:"1px solid rgba(255,255,255,0.15)"},children:u.jsxs("div",{style:{display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem"},children:[u.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[u.jsx("span",{style:{fontWeight:600},children:"Categories:"}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"On-Budget: "}),u.jsx("span",{style:{color:Bt(E()),fontWeight:600},children:Xe(E())})]}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"Allocated: "}),u.jsx("span",{style:{color:pc(z),fontWeight:600},children:g?"...":Xe(z)}),se&&u.jsxs("span",{style:{opacity:.5,fontSize:"0.8rem"},children:[" (",Xe(G)," total)"]})]}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"Available: "}),u.jsx("span",{style:{color:Bt(te),fontWeight:600},children:g?"...":Xe(te)})]}),u.jsx("span",{style:{opacity:.6},children:"Use  buttons to reorder categories."})]}),u.jsx("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:u.jsx(Y0,{})})]})}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:k?"1fr":"2fr 1fr 2fr 1fr",marginTop:"1rem",marginBottom:"1.5rem"},children:[u.jsx("div",{style:{gridColumn:"1 / -1",position:"sticky",top:"3.5rem",zIndex:49,backgroundColor:"#242424",display:k?"block":"grid",gridTemplateColumns:k?void 0:"subgrid"},children:!k&&u.jsxs(u.Fragment,{children:[u.jsx("div",{style:ie,children:"Category"}),u.jsx("div",{style:{...ie,textAlign:"right"},children:"Balance"}),u.jsx("div",{style:ie,children:"Description"}),u.jsx("div",{style:{...ie,textAlign:"right"},children:"Actions"})]})}),Object.keys(i).length===0&&o.length===0&&u.jsx("p",{style:{gridColumn:"1 / -1",opacity:.7,textAlign:"center",padding:"2rem"},children:"No categories yet. Create a group first, then add categories!"}),W.map((ce,we)=>{const he=(l[ce.id]||[]).sort((Ee,Ue)=>Ee[1].sort_order-Ue[1].sort_order);return he.length===0&&M!==ce.id&&j!==ce.id?null:M===ce.id?u.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"1rem"},children:u.jsx(iS,{initialData:{name:ce.name},onSubmit:Ee=>{O(ce.id,Ee),Z(null)},onCancel:()=>Z(null),submitLabel:"Save"})},ce.id):u.jsx(aS,{group:ce,categories:he,categoryGroups:o,categoryBalances:m,loadingBalances:g,editingCategoryId:V,createForGroupId:j,setEditingCategoryId:H,setCreateForGroupId:B,handleUpdateCategory:S,handleDeleteCategory:C,handleMoveCategory:T,handleCreateCategory:x,isMobile:k,canMoveGroupUp:we>0,canMoveGroupDown:we<W.length-1,onEditGroup:()=>Z(ce.id),onDeleteGroup:()=>U(ce.id),onMoveGroupUp:()=>$(ce.id,"up"),onMoveGroupDown:()=>$(ce.id,"down")},ce.id)}),(re.length>0||j==="ungrouped")&&u.jsx(aS,{group:X,categories:re,categoryGroups:o,categoryBalances:m,loadingBalances:g,editingCategoryId:V,createForGroupId:j,setEditingCategoryId:H,setCreateForGroupId:B,handleUpdateCategory:S,handleDeleteCategory:C,handleMoveCategory:T,handleCreateCategory:x,isMobile:k,isUngrouped:!0,canMoveGroupUp:!1,canMoveGroupDown:!1,onEditGroup:()=>{},onDeleteGroup:()=>{},onMoveGroupUp:()=>{},onMoveGroupDown:()=>{}}),u.jsx("div",{style:{gridColumn:"1 / -1",height:"1rem"}})]}),d.length>0&&u.jsx("div",{style:{marginBottom:"2rem"},children:u.jsxs(G0,{title:"Hidden Categories",count:d.length,children:[u.jsxs("div",{style:{padding:"0.75rem",marginBottom:"1rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",fontSize:"0.85rem"},children:[u.jsxs("p",{style:{margin:"0 0 0.5rem 0",opacity:.8},children:[u.jsx("strong",{children:" Hidden categories"})," are excluded from dropdowns and balance displays. They're useful for historical categories that you want to keep for record-keeping but don't need in everyday use."]}),u.jsx("p",{style:{margin:0,opacity:.6},children:'To unhide a category, click it to edit and uncheck "Hidden category".'})]}),u.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:d.map(([ce,we])=>V===ce?u.jsx(t_,{initialData:{name:we.name,description:we.description,category_group_id:we.category_group_id,default_monthly_amount:we.default_monthly_amount,default_monthly_type:we.default_monthly_type,is_hidden:we.is_hidden},onSubmit:he=>{S(ce,he),H(null)},onCancel:()=>H(null),submitLabel:"Save",categoryGroups:o,showGroupSelector:!0},ce):u.jsxs("div",{onClick:()=>H(ce),style:{padding:"0.75rem 1rem",background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"8px",cursor:"pointer",display:"flex",justifyContent:"space-between",alignItems:"center",opacity:.7},children:[u.jsx("span",{children:we.name}),u.jsx("span",{style:{color:Bt(we.balance),fontWeight:500},children:Xe(we.balance)})]},ce))})]})}),K?u.jsx(iS,{onSubmit:ce=>{I(ce),q(!1)},onCancel:()=>q(!1),submitLabel:"Create Group"}):u.jsx(Ve,{variant:"primary-large",actionName:"Open Add Category Group Form",onClick:()=>q(!0),children:"+ Add Category Group"})]})}function Cz(){const{selectedBudgetId:t,currentUserId:e}=Ye(),{addLoadingHold:n,removeLoadingHold:r}=Gn(),{budget:i,budgetUserIds:o,acceptedUserIds:l,isLoading:d}=An();D.useEffect(()=>(d||!i?n("users","Loading users..."):r("users"),()=>r("users")),[d,i,n,r]);const{inviteUser:h}=hz(),{revokeUser:m}=fz(),[p,g]=D.useState(""),[v,b]=D.useState(!1),[E,x]=D.useState(null),[S,C]=D.useState(null);if(d)return null;if(!i)return u.jsx("p",{children:"No budget found."});async function T($){if($.preventDefault(),!(!p.trim()||!i||!t)){b(!0),x(null),C(null);try{await h.mutateAsync({budgetId:t,userId:p.trim()}),g(""),C("Invite sent! The user can now accept the invitation from their account.")}catch(k){x(k instanceof Error?k.message:"Failed to invite user")}finally{b(!1)}}}async function I($){if(!i||!t)return;if($===i.owner_id){x("Cannot revoke the budget owner");return}if($===e){x("Cannot revoke yourself from the budget");return}const k=l.includes($);if(confirm(k?"Are you sure you want to revoke this user's access? They will lose access to this budget.":"Are you sure you want to cancel this invitation?")){x(null),C(null);try{await m.mutateAsync({budgetId:t,userId:$}),C(k?"User access revoked.":"Invitation cancelled.")}catch(N){x(N instanceof Error?N.message:"Failed to revoke user")}}}const O=o.filter($=>l.includes($)),U=o.filter($=>!l.includes($));return u.jsxs("div",{children:[u.jsx("h2",{style:{marginTop:0},children:"Budget Users"}),u.jsx("p",{style:{opacity:.7,marginBottom:"1.5rem"},children:"Invite users to access this budget. They must accept the invitation before they can access it."}),E&&u.jsxs("div",{style:{background:"rgba(220, 38, 38, 0.1)",border:"1px solid rgba(220, 38, 38, 0.3)",color:"#f87171",padding:"0.75rem 1rem",borderRadius:"8px",marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[u.jsx("span",{children:E}),u.jsx("button",{onClick:()=>x(null),style:{background:"transparent",border:"none",color:"#f87171",cursor:"pointer",fontSize:"1.2rem",padding:"0 0.25rem",lineHeight:1},children:""})]}),S&&u.jsxs("div",{style:{background:"rgba(34, 197, 94, 0.1)",border:"1px solid rgba(34, 197, 94, 0.3)",color:"#4ade80",padding:"0.75rem 1rem",borderRadius:"8px",marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[u.jsx("span",{children:S}),u.jsx("button",{onClick:()=>C(null),style:{background:"transparent",border:"none",color:"#4ade80",cursor:"pointer",fontSize:"1.2rem",padding:"0 0.25rem",lineHeight:1},children:""})]}),u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px",marginBottom:"1.5rem"},children:[u.jsxs("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem"},children:["Active Users (",O.length,")"]}),O.length===0?u.jsx("p",{style:{opacity:.6,margin:0},children:"No users have accepted invitations yet."}):u.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:O.map($=>{const k=$===i.owner_id,R=$===e;return u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 8%, transparent)",padding:"0.75rem 1rem",borderRadius:"6px",display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem"},children:[u.jsx("div",{style:{flex:1,minWidth:0},children:u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flexWrap:"wrap"},children:[u.jsx("code",{style:{fontSize:"0.85rem",background:"color-mix(in srgb, currentColor 10%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",wordBreak:"break-all"},children:$}),k&&u.jsx("span",{style:{background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.7rem",textTransform:"uppercase",fontWeight:600},children:"Owner"}),R&&u.jsx("span",{style:{background:"color-mix(in srgb, #22c55e 20%, transparent)",color:"#4ade80",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.7rem",textTransform:"uppercase",fontWeight:600},children:"You"})]})}),!k&&!R&&u.jsx("button",{onClick:()=>I($),style:{background:"transparent",border:"1px solid rgba(220, 38, 38, 0.4)",color:"#f87171",padding:"0.4rem 0.75rem",borderRadius:"6px",cursor:"pointer",fontSize:"0.8rem",whiteSpace:"nowrap"},children:"Revoke Access"})]},$)})})]}),U.length>0&&u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px",marginBottom:"1.5rem"},children:[u.jsxs("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem"},children:["Pending Invitations (",U.length,")"]}),u.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:U.map($=>u.jsxs("div",{style:{background:"color-mix(in srgb, #f59e0b 10%, transparent)",border:"1px solid color-mix(in srgb, #f59e0b 30%, transparent)",padding:"0.75rem 1rem",borderRadius:"6px",display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem"},children:[u.jsx("div",{style:{flex:1,minWidth:0},children:u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flexWrap:"wrap"},children:[u.jsx("code",{style:{fontSize:"0.85rem",background:"color-mix(in srgb, currentColor 10%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",wordBreak:"break-all"},children:$}),u.jsx("span",{style:{background:"color-mix(in srgb, #f59e0b 20%, transparent)",color:"#fbbf24",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.7rem",textTransform:"uppercase",fontWeight:600},children:"Pending"})]})}),u.jsx("button",{onClick:()=>I($),style:{background:"transparent",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)",color:"inherit",padding:"0.4rem 0.75rem",borderRadius:"6px",cursor:"pointer",fontSize:"0.8rem",whiteSpace:"nowrap",opacity:.8},children:"Cancel Invite"})]},$))})]}),u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px"},children:[u.jsx("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem"},children:"Invite User"}),u.jsxs("form",{onSubmit:T,style:{display:"flex",gap:"0.75rem"},children:[u.jsx("input",{type:"text",value:p,onChange:$=>g($.target.value),placeholder:"Enter Firebase User ID",style:{flex:1,padding:"0.6rem 0.8rem",borderRadius:"6px",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"0.95rem",color:"inherit"}}),u.jsx("button",{type:"submit",disabled:v||!p.trim(),style:{background:"#646cff",color:"white",border:"none",padding:"0.6rem 1.25rem",borderRadius:"6px",cursor:v||!p.trim()?"not-allowed":"pointer",fontWeight:500,opacity:v||!p.trim()?.7:1,whiteSpace:"nowrap"},children:v?"Inviting...":"Send Invite"})]}),u.jsx("p",{style:{margin:"1rem 0 0 0",fontSize:"0.85rem",opacity:.6},children:" The invited user will need to accept the invitation from their Account page using this budget's ID:"}),u.jsx("code",{style:{display:"block",marginTop:"0.5rem",padding:"0.5rem 0.75rem",background:"color-mix(in srgb, currentColor 10%, transparent)",borderRadius:"6px",fontSize:"0.85rem",wordBreak:"break-all"},children:i.id})]})]})}const Tz=["budget","feedback","migration","tests"];function Az(){const{isAdmin:t,isTest:e,lastAdminTab:n,setLastAdminTab:r,setPageTitle:i}=Ye();D.useLayoutEffect(()=>{i("Budget Admin")},[i]);const o=On(),l=o.pathname==="/budget/admin",d=D.useMemo(()=>{const g=o.pathname;return g.includes("/admin/budget")?"budget":g.includes("/admin/feedback")?"feedback":g.includes("/admin/migration")?"migration":g.includes("/admin/tests")?"tests":"budget"},[o.pathname]),h=d==="tests";D.useEffect(()=>{l||r(d)},[d,l,r]);function m(){return!Tz.includes(n)||n==="tests"&&!e?"budget":n}const p=D.useMemo(()=>[{id:"budget",label:"Budget",icon:""},{id:"feedback",label:"Feedback",icon:""},{id:"migration",label:"Migration",icon:""},{id:"tests",label:"Tests",icon:"",hidden:!e}],[e]);return t?!e&&h?u.jsxs("div",{children:[u.jsx("h1",{children:"Access Denied"}),u.jsx("p",{style:{opacity:.7},children:"Only test users can access this section."}),u.jsx("p",{style:{marginTop:"1rem"},children:u.jsx(Cn,{to:"/budget/admin/budget",children:"Go to Admin "})})]}):u.jsxs("div",{children:[u.jsx(Df,{mode:"link",linkPrefix:"/budget/admin",tabs:p,activeTab:d}),l?u.jsx(Bf,{to:`/budget/admin/${m()}`,replace:!0}):u.jsx(zf,{})]}):u.jsxs("div",{children:[u.jsx("h1",{children:"Access Denied"}),u.jsx("p",{style:{opacity:.7},children:"Only administrators can access this section."}),u.jsx("p",{style:{marginTop:"1rem"},children:u.jsx(Cn,{to:"/budget",children:"Go to Budget "})})]})}function jz(){const{addLoadingHold:t,removeLoadingHold:e}=Gn(),{isAdmin:n}=Ye(),{budget:r,accounts:i,accountGroups:o,categories:l,categoryGroups:d,isOwner:h,isLoading:m}=An();return D.useEffect(()=>(m?t("settings-budget","Loading budget info..."):e("settings-budget"),()=>e("settings-budget")),[m,t,e]),m?null:r?u.jsxs("div",{children:[u.jsx("h2",{style:{marginTop:0},children:"Budget Summary"}),u.jsx("p",{style:{opacity:.7,marginBottom:"1.5rem"},children:"Information about the currently selected budget."}),u.jsx("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px",marginBottom:"1.5rem"},children:u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem",fontSize:"0.95rem"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{children:""}),u.jsx("span",{style:{opacity:.7,minWidth:"80px"},children:"Name:"}),u.jsx("strong",{children:r.name})]}),u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{children:""}),u.jsx("span",{style:{opacity:.7,minWidth:"80px"},children:"ID:"}),u.jsx("code",{style:{background:"color-mix(in srgb, currentColor 10%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",fontSize:"0.85rem"},children:r.id})]}),u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{children:""}),u.jsx("span",{style:{opacity:.7,minWidth:"80px"},children:"Owner:"}),u.jsx("strong",{children:r.owner_email||r.owner_id})]}),u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{children:""}),u.jsx("span",{style:{opacity:.7,minWidth:"80px"},children:"Users:"}),u.jsxs("span",{children:[r.user_ids.length," user",r.user_ids.length!==1?"s":"",u.jsxs("span",{style:{opacity:.7},children:["  ",h?"You are the owner":"Shared with you"]})]})]})]})}),n&&u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px"},children:[u.jsx("h3",{style:{margin:"0 0 0.75rem 0",fontSize:"1rem"},children:"Admin Tools"}),u.jsx("button",{onClick:()=>{const p={...r,accounts:i,account_groups:o,categories:l,category_groups:d,_meta:{downloaded_at:new Date().toISOString()}},g=new Blob([JSON.stringify(p,null,2)],{type:"application/json"}),v=URL.createObjectURL(g),b=document.createElement("a");b.href=v,b.download=`budget_${r.id}.json`,document.body.appendChild(b),b.click(),document.body.removeChild(b),URL.revokeObjectURL(v)},style:{display:"inline-flex",alignItems:"center",gap:"0.5rem",background:"color-mix(in srgb, currentColor 10%, transparent)",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",borderRadius:"6px",padding:"0.5rem 0.75rem",cursor:"pointer",fontSize:"0.85rem",color:"inherit",transition:"background 0.15s"},title:"Download budget document as JSON (for debugging)",children:" Download Budget JSON"})]})]}):u.jsx("p",{style:{opacity:.7},children:"No budget selected."})}function oS({selectedType:t,onSelect:e}){return u.jsx("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"0.75rem",paddingBottom:"1rem",flexWrap:"wrap"},children:["critical_bug","bug","new_feature","core_feature","qol"].map(n=>{const r=Mf[n],i=t==="feature"?"new_feature":t,o=i===n||!i&&n==="bug";return u.jsxs("button",{type:"button",onClick:()=>{r.label,e(n)},style:{flex:1,padding:"0.6rem 0.75rem",border:`2px solid ${r.color}`,borderRadius:"0.5rem",background:o?r.bgColor:"transparent",color:o?r.color:"rgba(255,255,255,0.5)",cursor:"pointer",fontWeight:o?600:400,fontSize:"0.85rem",transition:"all 0.15s ease",opacity:o?1:.5,boxShadow:o?`0 0 12px ${r.bgColor}`:"none",position:"relative"},children:[r.label,o&&u.jsx("span",{style:{position:"absolute",bottom:"-14px",left:"10%",right:"10%",height:"3px",background:"white",borderRadius:"2px"}})]},n)})})}function Rz(){const[t,e]=D.useState(null),[n,r]=D.useState(null),[i,o]=D.useState(!1),[l,d]=D.useState(""),[h,m]=D.useState("bug"),[p,g]=D.useState(null),[v,b]=D.useState(!1),[E,x]=D.useState(null),S=D.useContext(cd),T=Da().get_current_firebase_user(),I=Ft(),O=t4(),{submitFeedback:U}=GT(),{toggleFeedback:$}=dP(),{updateSortOrder:k}=hP(),R=O.data?.items||[],N=Ei(),{addLoadingHold:V,removeLoadingHold:H}=Gn();D.useEffect(()=>(O.isLoading?V("settings-feedback","Loading feedback..."):H("settings-feedback"),()=>H("settings-feedback")),[O.isLoading,V,H]);function j(he){he.preventDefault(),!(!l.trim()||!S.username||!T)&&(U.mutate({userId:T.uid,userEmail:S.username,text:l.trim(),feedbackType:h,currentPath:"/settings/feedback"}),d(""),m("bug"),o(!1))}function B(he){he.is_done?M(he):g(he)}async function M(he){try{await $.mutateAsync({item:he})}catch(Ee){console.error("[Feedback] Error updating feedback:",Ee),mr.add({type:"error",message:"Failed to update feedback",autoDismissMs:5e3})}}function Z(){p&&(M(p),g(null))}async function K(){b(!1);const he="mark-all-feedback-complete";V(he,`Marking ${X.length} item${X.length!==1?"s":""} as complete...`);try{const Ee=new Date().toISOString(),Ue=new Set(X.map(de=>de.id)),Be=new Map;for(const de of X)Be.has(de.doc_id)||Be.set(de.doc_id,[]),Be.get(de.doc_id).push(de);const gt=[];for(const[de,ye]of Be){const ee=(async()=>{const oe=(await HT(de,"mark all feedback complete")).items.map(Se=>Ue.has(Se.id)?{...Se,is_done:!0,completed_at:Ee}:Se);await H0({docId:de,items:oe,description:`marking ${ye.length} feedback item${ye.length!==1?"s":""} as complete`})})();gt.push(ee)}await Promise.all(gt);const yt=ke.feedback(),L=I.getQueryData(yt);L&&I.setQueryData(yt,{items:L.items.map(de=>Ue.has(de.id)?{...de,is_done:!0,completed_at:Ee}:de)}),await I.invalidateQueries({queryKey:yt}),mr.add({type:"success",message:`Marked ${X.length} item${X.length!==1?"s":""} as complete`,autoDismissMs:3e3})}catch(Ee){console.error("[Feedback] Error marking all as complete:",Ee),mr.add({type:"error",message:"Failed to mark all items as complete",autoDismissMs:5e3}),await I.invalidateQueries({queryKey:ke.feedback()})}finally{H(he)}}function q(){K()}async function W(he){if(E){try{const Ue=R.filter(Be=>Be.doc_id===E.doc_id).map(Be=>({id:Be.id,text:Be.text,created_at:Be.created_at,is_done:Be.is_done,completed_at:Be.completed_at,sort_order:Be.sort_order,feedback_type:Be.id===E.id?he:Be.feedback_type}));await k.mutateAsync({docId:E.doc_id,items:Ue})}catch(Ee){console.error("[Feedback] Error updating feedback type:",Ee),mr.add({type:"error",message:"Failed to update feedback type",autoDismissMs:5e3})}x(null)}}const X=R.filter(he=>!he.is_done).sort((he,Ee)=>he.sort_order-Ee.sort_order),re=R.filter(he=>he.is_done).sort((he,Ee)=>new Date(Ee.completed_at||0).getTime()-new Date(he.completed_at||0).getTime());function z(he,Ee){e(Ee),he.dataTransfer.effectAllowed="move"}function G(he,Ee){he.preventDefault(),Ee!==t&&r(Ee)}function te(){r(null)}function se(){e(null),r(null)}async function ie(he,Ee){if(he.preventDefault(),!t||t===Ee){se();return}const Ue=X.findIndex(de=>de.id===t),Be=[...X],[gt]=Be.splice(Ue,1);if(Ee==="__end__")Be.push(gt);else{const de=Be.findIndex(ye=>ye.id===Ee);Be.splice(de,0,gt)}const yt=Be.map((de,ye)=>({...de,sort_order:ye}));se();const L=new Map;for(const de of yt)L.has(de.doc_id)||L.set(de.doc_id,[]),L.get(de.doc_id).push({id:de.id,text:de.text,created_at:de.created_at,is_done:de.is_done,completed_at:de.completed_at,sort_order:de.sort_order,feedback_type:de.feedback_type});for(const de of re)L.has(de.doc_id)||L.set(de.doc_id,[]),L.get(de.doc_id).push({id:de.id,text:de.text,created_at:de.created_at,is_done:de.is_done,completed_at:de.completed_at,sort_order:de.sort_order,feedback_type:de.feedback_type});try{for(const[de,ye]of L)await k.mutateAsync({docId:de,items:ye})}catch(de){console.error("[Feedback] Error saving order:",de),mr.add({type:"error",message:"Failed to save order",autoDismissMs:5e3})}}function ce(){const he=we(X),Ee=new Blob([he],{type:"text/markdown"}),Ue=URL.createObjectURL(Ee),Be=document.createElement("a");Be.href=Ue,Be.download=`feedback-${new Date().toISOString().split("T")[0]}.md`,document.body.appendChild(Be),Be.click(),document.body.removeChild(Be),URL.revokeObjectURL(Ue)}function we(he){let Ee=`# Feedback Export

`;return Ee+=`Generated: ${new Date().toISOString()}

`,he.length>0&&(Ee+=`## Pending

`,he.forEach((Ue,Be)=>{const gt=Ue.feedback_type?Mf[Ue.feedback_type]?.label||Ue.feedback_type:"Unknown";Ee+=`### ${Be+1}. [${gt}] ${Ue.text.split(`
`)[0].substring(0,60)}${Ue.text.split(`
`)[0].length>60?"...":""}

`,Ee+=`- **Type:** ${gt}
`,Ee+=`- **Created:** ${Ue.created_at}
`,Ee+=`- **User:** ${Ue.user_email||Ue.doc_id}
`,Ee+=`- **ID:** ${Ue.id}

`,Ee+=`${Ue.text}

`,Ee+=`---

`})),Ee}return O.isLoading?null:u.jsxs("div",{children:[u.jsxs("div",{style:{display:"flex",flexDirection:N?"column":"row",justifyContent:"space-between",alignItems:N?"stretch":"flex-start",gap:N?"0.75rem":"1rem",marginTop:"1.5rem",marginBottom:"0.5rem"},children:[u.jsxs("div",{children:[u.jsx("h2",{style:{marginTop:0},children:"Feedback"}),u.jsx("p",{style:{...AT,fontSize:"0.9rem"},children:"View and manage user feedback. Drag to reorder pending items."})]}),u.jsxs("div",{style:{display:"flex",gap:"0.75rem",flexDirection:N?"column":"row"},children:[u.jsx(Ve,{variant:"secondary",actionName:"Download Feedback as Markdown",onClick:ce,disabled:X.length===0,style:N?{width:"100%"}:void 0,children:"Download Markdown"}),u.jsx(Ve,{variant:"secondary",actionName:"Mark All Complete",onClick:()=>b(!0),disabled:X.length===0,style:N?{width:"100%"}:void 0,children:"Mark All Complete"})]})]}),u.jsxs("div",{style:j1,children:[X.length===0&&!i&&u.jsx("p",{style:{opacity:.7},children:"No pending feedback."}),X.map(he=>u.jsx(YP,{item:he,isDragging:t===he.id,isDragOver:n===he.id,onDragStart:Ee=>z(Ee,he.id),onDragOver:Ee=>G(Ee,he.id),onDragLeave:te,onDragEnd:se,onDrop:Ee=>ie(Ee,he.id),onToggleDone:()=>B(he),onTypeClick:()=>x(he)},he.id)),t&&X.length>0&&u.jsx(cP,{isActive:n==="__end__",onDragOver:he=>G(he,"__end__"),onDragLeave:te,onDrop:he=>ie(he,"__end__")})]}),i?u.jsxs(xi,{actionName:"Add Feedback",onSubmit:j,children:[u.jsx(oS,{selectedType:h,onSelect:m}),u.jsx(q0,{value:l,onChange:he=>d(he.target.value),placeholder:"Enter your feedback, bug report, or feature request...",autoFocus:!0,required:!0}),u.jsxs(Pa,{children:[u.jsx(Ve,{type:"submit",actionName:"Add Feedback",disabled:!l.trim(),children:"Add Feedback"}),u.jsx(Ve,{type:"button",variant:"secondary",actionName:"Cancel Add Feedback",onClick:()=>{o(!1),d(""),m("bug")},children:"Cancel"})]})]}):u.jsx(Ve,{variant:"primary-large",actionName:"Open Add Feedback Form",onClick:()=>o(!0),children:"+ Add Feedback"}),re.length>0&&u.jsx(G0,{title:"Completed",count:re.length,children:u.jsx("div",{style:{...j1,marginTop:"0.5rem"},children:re.map(he=>u.jsx(XP,{item:he,onToggleDone:()=>B(he),onTypeClick:()=>x(he)},he.id))})}),u.jsxs(ls,{isOpen:p!==null,onClose:()=>g(null),title:"Mark as Complete",children:[u.jsx("p",{style:{margin:"0 0 1.5rem 0"},children:"Are you sure you want to mark this feedback item as complete?"}),p&&u.jsxs("p",{style:{margin:"0 0 1.5rem 0",padding:"0.75rem",background:"rgba(255,255,255,0.05)",borderRadius:"0.5rem",fontSize:"0.9rem"},children:['"',p.text,'"']}),u.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[u.jsx(Ve,{variant:"secondary",actionName:"Cancel Mark Complete",onClick:()=>g(null),children:"Cancel"}),u.jsx(Ve,{variant:"primary",actionName:"Confirm Mark Complete",onClick:Z,children:"Mark Complete"})]})]}),u.jsxs(ls,{isOpen:v,onClose:()=>b(!1),title:"Mark All as Complete",children:[u.jsxs("p",{style:{margin:"0 0 1.5rem 0"},children:["Are you sure you want to mark all ",X.length," pending feedback item",X.length!==1?"s":""," as complete?"]}),u.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[u.jsx(Ve,{variant:"secondary",actionName:"Cancel Mark All Complete",onClick:()=>b(!1),children:"Cancel"}),u.jsx(Ve,{variant:"primary",actionName:"Confirm Mark All Complete",onClick:q,children:"Mark All Complete"})]})]}),u.jsxs(ls,{isOpen:E!==null,onClose:()=>x(null),title:"Change Feedback Type",children:[u.jsx("p",{style:{margin:"0 0 1rem 0",fontSize:"0.9rem",opacity:.8},children:"Select a new type for this feedback:"}),u.jsx(oS,{selectedType:E?.feedback_type||"bug",onSelect:W}),u.jsx(Ve,{variant:"secondary",actionName:"Cancel Change Feedback Type",onClick:()=>x(null),style:{width:"100%"},children:"Cancel"})]})]})}function Iz(){Le.clear(),window.location.reload()}function kz(){const e=Da().get_current_firebase_user(),{selectedBudgetId:n}=Ye(),r=tP({currentUser:e}),i=P3({currentUser:e}),o=D3({currentUser:e}),l=V3({currentUser:e}),d=S3({currentUser:e}),h=sP({currentUser:e,budgetId:n}),m=lP({currentUser:e}),p=y3({currentUser:e}),g=_3({currentUser:e}),v=r.isScanning||i.isScanning||o.isScanning||l.isScanning||d.isScanning||p.isScanning||g.isScanning,b=i.isRunning||o.isRunning||l.isRunning||d.isRunning||p.isDeleting||g.isDeleting||h.isDownloading||m.isUploading,E=async()=>{await Promise.all([r.scan(),i.scanStatus(),o.scanStatus(),l.scanStatus(),d.scan(),p.scanStatus(),g.scanStatus()])};return u.jsxs("div",{children:[u.jsx("style",{children:"@keyframes spin { to { transform: rotate(360deg); } }"}),u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"},children:[u.jsx("h2",{style:{margin:0},children:"Data Migrations"}),u.jsxs("button",{onClick:E,disabled:v||b,style:{background:"#646cff",color:"white",border:"none",padding:"0.5rem 1rem",borderRadius:"6px",cursor:v||b?"not-allowed":"pointer",fontWeight:500,opacity:v||b?.7:1,display:"flex",alignItems:"center",gap:"0.4rem",minWidth:"130px",minHeight:"36px"},children:[u.jsx("span",{style:{width:"18px",height:"18px",display:"inline-flex",justifyContent:"center",alignItems:"center",flexShrink:0},children:v?u.jsx(Vn,{noMargin:!0}):""}),"Refresh All"]})]}),u.jsx("p",{style:{opacity:.7,marginBottom:"1.5rem"},children:'Run migrations to validate and fix your database. Click "Refresh All" to scan Firestore directly.'}),u.jsx(tB,{disabled:!e,onDownloadBackup:h.downloadBudget,isDownloadingBackup:h.isDownloading}),u.jsx(iB,{disabled:!e,onDownloadBackup:h.downloadBudget,isDownloadingBackup:h.isDownloading,accountCategoryValidation:{status:r.status,hasData:!!r.status,hasViolations:r.hasViolations,violationCount:r.violationCount,isScanning:r.isScanning,report:r.report,scan:r.scan},orphanedIdCleanup:{status:i.status,hasData:!!i.status,hasItemsToFix:i.hasItemsToFix,totalOrphaned:i.status?i.status.orphanedCategoryIds+i.status.orphanedAccountIds:0,isScanning:i.isScanning,isRunning:i.isRunning,result:i.result,scanStatus:i.scanStatus,runMigration:i.runMigration},expenseToAdjustment:{status:o.status,hasData:!!o.status,hasItemsToMigrate:o.hasItemsToMigrate,totalToMigrate:o.status?.expensesToMigrate??0,isScanning:o.isScanning,isRunning:o.isRunning,result:o.result,scanStatus:o.scanStatus,runMigration:o.runMigration},adjustmentsToTransfers:{status:l.status,hasData:!!l.status,hasPairsToConvert:l.hasPairsToConvert,totalPairs:l.status?.pairsFound??0,isScanning:l.isScanning,isRunning:l.isRunning,result:l.result,scanStatus:l.scanStatus,runMigration:l.runMigration},precisionCleanup:{status:d.status,hasData:d.hasData,hasIssues:d.hasIssues,totalIssues:d.totalIssues,isScanning:d.isScanning,isRunning:d.isRunning,result:d.result,scan:d.scan,runCleanup:d.runCleanup}}),u.jsx(uB,{disabled:!e,onDownloadBackup:h.downloadBudget,isDownloadingBackup:h.isDownloading,budgetDownloadUpload:{isDownloading:h.isDownloading,downloadProgress:h.progress,downloadError:h.error,downloadBudget:h.downloadBudget,isScanning:m.isScanning,isUploading:m.isUploading,uploadStatus:m.status,uploadProgress:m.progress,uploadError:m.error,uploadResult:m.result,scanZipFile:m.scanZipFile,uploadBudget:m.uploadBudget},deleteAllMonths:{status:p.status,hasData:!!p.status,monthsCount:p.status?.monthsCount??0,budgetCount:p.status?.budgetCount??0,isScanning:p.isScanning,isDeleting:p.isDeleting,deleteResult:p.deleteResult,deleteProgress:p.deleteProgress,scanStatus:p.scanStatus,deleteAllMonths:p.deleteAllMonths},deleteSampleUserBudget:{status:g.status,hasData:!!g.status,totalBudgets:g.status?.totalBudgets??0,totalMonths:g.status?.totalMonths??0,isScanning:g.isScanning,isDeleting:g.isDeleting,deleteResult:g.deleteResult,deleteProgress:g.deleteProgress,scanStatus:g.scanStatus,deleteSampleUserBudget:g.deleteSampleUserBudget},onClearCache:Iz}),u.jsx("div",{style:{background:"color-mix(in srgb, currentColor 3%, transparent)",padding:"1rem",borderRadius:"8px",fontSize:"0.85rem"},children:u.jsxs("p",{style:{margin:0,opacity:.7},children:[u.jsx("strong",{children:"Note:"})," These migrations will process ",u.jsx("strong",{children:"all budgets and months"})," in the system, not just the ones you own or are invited to."]})}),u.jsx(JT,{})]})}function Rl({name:t,description:e,expectedBehavior:n,result:r,onRun:i,disabled:o,expectedToSucceed:l}){const d=r?.status==="passed"?me.success:r?.status==="failed"?me.danger:r?.status==="running"?me.warning:"inherit";return u.jsxs("div",{style:{...F0,display:"flex",flexDirection:"column",gap:"0.5rem"},children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",gap:"1rem"},children:[u.jsxs("div",{style:{flex:1},children:[u.jsx("h4",{style:{margin:0,fontSize:"0.95rem"},children:t}),u.jsx("p",{style:{margin:"0.25rem 0 0",opacity:.7,fontSize:"0.85rem"},children:e}),u.jsxs("p",{style:{margin:"0.25rem 0 0",fontSize:"0.8rem",color:l?me.success:me.warning},children:["Expected: ",n]})]}),u.jsx(Ve,{onClick:i,disabled:o,variant:"secondary",style:{flexShrink:0},children:r?.status==="running"?"":"Run"})]}),r&&r.status!=="pending"&&u.jsx("div",{style:{padding:"0.5rem 0.75rem",borderRadius:"6px",background:`color-mix(in srgb, ${d} 15%, transparent)`,border:`1px solid color-mix(in srgb, ${d} 30%, transparent)`,fontSize:"0.85rem",color:d},children:r.message})]})}function Dz({totalCount:t,passedCount:e,failedCount:n}){return u.jsxs("div",{style:{display:"flex",gap:"1rem",padding:"0.75rem 1rem",borderRadius:"8px",background:"color-mix(in srgb, currentColor 5%, transparent)",marginBottom:"1rem"},children:[u.jsxs("span",{children:["Total: ",u.jsx("strong",{children:t})]}),u.jsxs("span",{style:{color:me.success},children:["Passed: ",u.jsx("strong",{children:e})]}),u.jsxs("span",{style:{color:me.danger},children:["Failed: ",u.jsx("strong",{children:n})]})]})}const lS=[{name:"Read unauthorized budget",expectedToFail:!0},{name:"Read another user's document",expectedToFail:!0},{name:"Read unauthorized budget month",expectedToFail:!0},{name:"Toggle is_admin in own permission_flags",expectedToFail:!0},{name:"Toggle is_test in own permission_flags",expectedToFail:!0},{name:"Read own user document",expectedToFail:!1}];function Mz(){const{currentUserId:t}=Ye(),[e,n]=D.useState([]),[r,i]=D.useState(!1);function o(b,E){n(x=>x.map(S=>S.name===b?{...S,...E}:S))}async function l(b,E,x){o(b,{status:"running",message:"Running..."});try{const S=await E();x?o(b,{status:"failed",message:` ${S}`}):o(b,{status:"passed",message:` ${S}`})}catch(S){const C=S instanceof Error?S.message:"Unknown error";x?o(b,{status:"passed",message:` Blocked as expected: ${C}`}):o(b,{status:"failed",message:` ${C}`})}}async function d(){i(!0),n(lS.map(b=>({...b,status:"pending",message:""})));for(const b of lS)await h(b.name);i(!1)}async function h(b){switch(b){case"Read unauthorized budget":await l(b,async()=>(await At("budgets","unauthorized_budget_test_12345","security test: attempting unauthorized budget read"),"Was able to read budget (unexpected)"),!0);break;case"Read another user's document":await l(b,async()=>(await At("users","another_user_test_12345","security test: attempting unauthorized user read"),"Was able to read user document (unexpected)"),!0);break;case"Read unauthorized budget month":await l(b,async()=>(await At("months","unauthorized_budget_test_12345_2024_01","security test: attempting unauthorized month read"),"Was able to read month document for unauthorized budget (unexpected)"),!0);break;case"Toggle is_admin in own permission_flags":await l(b,async()=>{if(!t)throw new Error("Not authenticated");const{data:E}=await At("users",t,"security test: reading own user to get current is_admin value"),x=E?.permission_flags?.is_admin??!1;return await Tf("users",t,{"permission_flags.is_admin":!x},"security test: attempting to toggle is_admin (should fail)"),`Was able to change is_admin from ${x} to ${!x} (SECURITY ISSUE!)`},!0);break;case"Toggle is_test in own permission_flags":await l(b,async()=>{if(!t)throw new Error("Not authenticated");const{data:E}=await At("users",t,"security test: reading own user to get current is_test value"),x=E?.permission_flags?.is_test??!1;return await Tf("users",t,{"permission_flags.is_test":!x},"security test: attempting to toggle is_test (should fail)"),`Was able to change is_test from ${x} to ${!x} (SECURITY ISSUE!)`},!0);break;case"Read own user document":await l(b,async()=>{if(!t)throw new Error("Not authenticated");const{exists:E}=await At("users",t,"security test: reading own user document (should succeed)");if(E)return"Successfully read own document";throw new Error("Document does not exist")},!1);break}}async function m(b){e.find(x=>x.name===b)||n(x=>[...x,{name:b,status:"pending",message:"",expectedToFail:!0}]),i(!0),await h(b),i(!1)}const p=e.filter(b=>b.status==="passed").length,g=e.filter(b=>b.status==="failed").length,v=e.length;return u.jsxs("div",{children:[u.jsx("p",{style:AT,children:'Run security tests to verify Firestore rules are working correctly. Tests that are expected to fail (blocked by security rules) should show as "passed".'}),u.jsx("div",{style:{marginBottom:"1.5rem"},children:u.jsx(Ve,{onClick:d,disabled:r,variant:"primary",children:r?"Running Tests...":"Run All Tests"})}),e.length>0&&u.jsx(Dz,{totalCount:v,passedCount:p,failedCount:g}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:[u.jsx("h3",{style:{margin:"0.5rem 0"},children:"Individual Tests"}),u.jsx(Rl,{name:"Read unauthorized budget",description:"Try to read a budget the user doesn't have access to",expectedBehavior:"Should be blocked by Firestore rules",result:e.find(b=>b.name==="Read unauthorized budget"),onRun:()=>m("Read unauthorized budget"),disabled:r}),u.jsx(Rl,{name:"Read another user's document",description:"Try to read another user's profile document",expectedBehavior:"Should be blocked by Firestore rules",result:e.find(b=>b.name==="Read another user's document"),onRun:()=>m("Read another user's document"),disabled:r}),u.jsx(Rl,{name:"Read unauthorized budget month",description:"Try to read a month document for a budget you don't have access to",expectedBehavior:"Should be blocked - months inherit budget access",result:e.find(b=>b.name==="Read unauthorized budget month"),onRun:()=>m("Read unauthorized budget month"),disabled:r}),u.jsx(Rl,{name:"Toggle is_admin in own permission_flags",description:"Try to change your admin privileges (toggles current value)",expectedBehavior:"Should be blocked - permission_flags is protected",result:e.find(b=>b.name==="Toggle is_admin in own permission_flags"),onRun:()=>m("Toggle is_admin in own permission_flags"),disabled:r}),u.jsx(Rl,{name:"Toggle is_test in own permission_flags",description:"Try to change your test privileges (toggles current value)",expectedBehavior:"Should be blocked - permission_flags is protected",result:e.find(b=>b.name==="Toggle is_test in own permission_flags"),onRun:()=>m("Toggle is_test in own permission_flags"),disabled:r}),u.jsx(Rl,{name:"Read own user document",description:"Read your own user profile document",expectedBehavior:"Should succeed - users can read their own data",result:e.find(b=>b.name==="Read own user document"),onRun:()=>m("Read own user document"),disabled:r,expectedToSucceed:!0})]}),g>0&&u.jsxs(mm,{style:{marginTop:"1.5rem"},children:[" ",g," test(s) failed! This may indicate a security vulnerability in your Firestore rules."]})]})}function Oz({children:t}){const{addLoadingHold:e,removeLoadingHold:n}=Gn(),r=D.useContext(cd),i=On();return D.useEffect(()=>(r.is_auth_checked?n("protected-route"):e("protected-route","Checking authentication..."),()=>n("protected-route")),[r.is_auth_checked,e,n]),r.is_auth_checked?r.is_logged_in?t?u.jsx(u.Fragment,{children:t}):u.jsx(zf,{}):u.jsx(Bf,{to:"/account",state:{from:i.pathname},replace:!0}):null}function Nz(){const{addLoadingHold:t,removeLoadingHold:e}=Gn(),{isInitialized:n,pageTitle:r}=Ye(),{isLoading:i,error:o}=An();return D.useEffect(()=>{n?e("budget-init"):t("budget-init",i?"Fetching data from server...":"Loading budget...")},[n,i,t,e]),D.useEffect(()=>()=>e("budget-init"),[e]),o?(console.error("[BudgetLayout] Error:",o),u.jsx("div",{style:Rf,children:u.jsxs("p",{style:{color:"#ef4444"},children:["Error: ",o.message]})})):u.jsx("div",{style:{...Rf,paddingBottom:"5rem"},children:u.jsxs(WT,{children:[u.jsx(_P,{title:r}),n&&u.jsx(zf,{})]})})}const Pz={is_logged_in:!1,is_auth_checked:!1,username:"",set_user_context:()=>{}};function Bz(){const{isLoading:t,loadingMessage:e}=Gn();return t?u.jsx(K0,{message:e}):null}function zz(){const[t,e]=D.useState(null);return D.useEffect(()=>mr.subscribe(e),[]),t?u.jsx(vP,{item:t,onDismiss:n=>mr.remove(n)}):null}function Lz(){const{selectedBudgetId:t,isInitialized:e}=Ye(),n=Ft(),r=t?["initialDataLoad",t]:null,i=r?n.getQueryState(r)?.status==="success":!1;return xn(),o3(),u3(t,i&&e),u.jsxs(u.Fragment,{children:[u.jsxs(G5,{children:[u.jsx(Sn,{path:"/",element:u.jsx(dB,{})}),u.jsx(Sn,{path:"/account",element:u.jsx(hB,{})}),u.jsx(Sn,{path:"/budget",element:u.jsx(Oz,{}),children:u.jsxs(Sn,{element:u.jsx(Nz,{}),children:[u.jsx(Sn,{index:!0,element:u.jsx(eS,{})}),u.jsx(Sn,{path:":year/:month/:tab/:view?",element:u.jsx(eS,{})}),u.jsx(Sn,{path:"analytics",element:u.jsx(cz,{})}),u.jsx(Sn,{path:"my-budgets",element:u.jsx(_z,{})}),u.jsxs(Sn,{path:"settings",element:u.jsx(vz,{}),children:[u.jsx(Sn,{index:!0,element:u.jsx(Bf,{to:"categories",replace:!0})}),u.jsx(Sn,{path:"accounts",element:u.jsx(wz,{})}),u.jsx(Sn,{path:"categories",element:u.jsx(Ez,{})}),u.jsx(Sn,{path:"users",element:u.jsx(Cz,{})})]}),u.jsxs(Sn,{path:"admin",element:u.jsx(Az,{}),children:[u.jsx(Sn,{path:"budget",element:u.jsx(jz,{})}),u.jsx(Sn,{path:"feedback",element:u.jsx(Rz,{})}),u.jsx(Sn,{path:"migration",element:u.jsx(kz,{})}),u.jsx(Sn,{path:"tests",element:u.jsx(Mz,{})})]})]})})]}),u.jsx(pP,{}),u.jsx(JT,{}),u.jsx(zz,{})]})}function Uz(){const[t,e]=D.useState(Pz),n=Da(),r=D.useRef(!1),{addLoadingHold:i,removeLoadingHold:o}=Gn();return D.useEffect(function(){r.current||(r.current=!0,n.set_user_listener(l=>{e({is_logged_in:l!=null,is_auth_checked:!0,username:l?.email??"",set_user_context:e})}))},[n]),D.useEffect(()=>{t.is_auth_checked?o("auth"):i("auth","Authenticating...")},[t.is_auth_checked,i,o]),t.is_auth_checked?u.jsx(cd.Provider,{value:t,children:u.jsx(dM,{children:u.jsx(QP,{children:u.jsx(q4,{children:u.jsx(h3,{children:u.jsx(yj,{children:u.jsx(Lz,{})})})})})})}):null}function Fz(){return u.jsxs(cR,{children:[u.jsx(Bz,{}),u.jsx(Uz,{})]})}G2.createRoot(document.getElementById("root")).render(u.jsx(D.StrictMode,{children:u.jsx(Fz,{})}));
