(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const u of o.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&r(u)}).observe(document,{childList:!0,subtree:!0});function n(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(a){if(a.ep)return;a.ep=!0;const o=n(a);fetch(a.href,o)}})();var gg={exports:{}},cu={};var cx;function Lj(){if(cx)return cu;cx=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function n(r,a,o){var u=null;if(o!==void 0&&(u=""+o),a.key!==void 0&&(u=""+a.key),"key"in a){o={};for(var h in a)h!=="key"&&(o[h]=a[h])}else o=a;return a=o.ref,{$$typeof:t,type:r,key:u,ref:a!==void 0?a:null,props:o}}return cu.Fragment=e,cu.jsx=n,cu.jsxs=n,cu}var ux;function zj(){return ux||(ux=1,gg.exports=Lj()),gg.exports}var c=zj(),yg={exports:{}},He={};var dx;function Uj(){if(dx)return He;dx=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),o=Symbol.for("react.consumer"),u=Symbol.for("react.context"),h=Symbol.for("react.forward_ref"),f=Symbol.for("react.suspense"),m=Symbol.for("react.memo"),g=Symbol.for("react.lazy"),_=Symbol.for("react.activity"),v=Symbol.iterator;function S(U){return U===null||typeof U!="object"?null:(U=v&&U[v]||U["@@iterator"],typeof U=="function"?U:null)}var x={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},E=Object.assign,C={};function I(U,H,ne){this.props=U,this.context=H,this.refs=C,this.updater=ne||x}I.prototype.isReactComponent={},I.prototype.setState=function(U,H){if(typeof U!="object"&&typeof U!="function"&&U!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,U,H,"setState")},I.prototype.forceUpdate=function(U){this.updater.enqueueForceUpdate(this,U,"forceUpdate")};function j(){}j.prototype=I.prototype;function M(U,H,ne){this.props=U,this.context=H,this.refs=C,this.updater=ne||x}var Q=M.prototype=new j;Q.constructor=M,E(Q,I.prototype),Q.isPureReactComponent=!0;var q=Array.isArray;function G(){}var D={H:null,A:null,T:null,S:null},A=Object.prototype.hasOwnProperty;function N(U,H,ne){var se=ne.ref;return{$$typeof:t,type:U,key:H,ref:se!==void 0?se:null,props:ne}}function L(U,H){return N(U.type,H,U.props)}function P(U){return typeof U=="object"&&U!==null&&U.$$typeof===t}function B(U){var H={"=":"=0",":":"=2"};return"$"+U.replace(/[=:]/g,function(ne){return H[ne]})}var O=/\/+/g;function K(U,H){return typeof U=="object"&&U!==null&&U.key!=null?B(""+U.key):H.toString(36)}function Y(U){switch(U.status){case"fulfilled":return U.value;case"rejected":throw U.reason;default:switch(typeof U.status=="string"?U.then(G,G):(U.status="pending",U.then(function(H){U.status==="pending"&&(U.status="fulfilled",U.value=H)},function(H){U.status==="pending"&&(U.status="rejected",U.reason=H)})),U.status){case"fulfilled":return U.value;case"rejected":throw U.reason}}throw U}function z(U,H,ne,se,Z){var le=typeof U;(le==="undefined"||le==="boolean")&&(U=null);var pe=!1;if(U===null)pe=!0;else switch(le){case"bigint":case"string":case"number":pe=!0;break;case"object":switch(U.$$typeof){case t:case e:pe=!0;break;case g:return pe=U._init,z(pe(U._payload),H,ne,se,Z)}}if(pe)return Z=Z(U),pe=se===""?"."+K(U,0):se,q(Z)?(ne="",pe!=null&&(ne=pe.replace(O,"$&/")+"/"),z(Z,H,ne,"",function(J){return J})):Z!=null&&(P(Z)&&(Z=L(Z,ne+(Z.key==null||U&&U.key===Z.key?"":(""+Z.key).replace(O,"$&/")+"/")+pe)),H.push(Z)),1;pe=0;var Ee=se===""?".":se+":";if(q(U))for(var ge=0;ge<U.length;ge++)se=U[ge],le=Ee+K(se,ge),pe+=z(se,H,ne,le,Z);else if(ge=S(U),typeof ge=="function")for(U=ge.call(U),ge=0;!(se=U.next()).done;)se=se.value,le=Ee+K(se,ge++),pe+=z(se,H,ne,le,Z);else if(le==="object"){if(typeof U.then=="function")return z(Y(U),H,ne,se,Z);throw H=String(U),Error("Objects are not valid as a React child (found: "+(H==="[object Object]"?"object with keys {"+Object.keys(U).join(", ")+"}":H)+"). If you meant to render a collection of children, use an array instead.")}return pe}function V(U,H,ne){if(U==null)return U;var se=[],Z=0;return z(U,se,"","",function(le){return H.call(ne,le,Z++)}),se}function W(U){if(U._status===-1){var H=U._result;H=H(),H.then(function(ne){(U._status===0||U._status===-1)&&(U._status=1,U._result=ne)},function(ne){(U._status===0||U._status===-1)&&(U._status=2,U._result=ne)}),U._status===-1&&(U._status=0,U._result=H)}if(U._status===1)return U._result.default;throw U._result}var ee=typeof reportError=="function"?reportError:function(U){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var H=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof U=="object"&&U!==null&&typeof U.message=="string"?String(U.message):String(U),error:U});if(!window.dispatchEvent(H))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",U);return}console.error(U)},ie={map:V,forEach:function(U,H,ne){V(U,function(){H.apply(this,arguments)},ne)},count:function(U){var H=0;return V(U,function(){H++}),H},toArray:function(U){return V(U,function(H){return H})||[]},only:function(U){if(!P(U))throw Error("React.Children.only expected to receive a single React element child.");return U}};return He.Activity=_,He.Children=ie,He.Component=I,He.Fragment=n,He.Profiler=a,He.PureComponent=M,He.StrictMode=r,He.Suspense=f,He.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=D,He.__COMPILER_RUNTIME={__proto__:null,c:function(U){return D.H.useMemoCache(U)}},He.cache=function(U){return function(){return U.apply(null,arguments)}},He.cacheSignal=function(){return null},He.cloneElement=function(U,H,ne){if(U==null)throw Error("The argument must be a React element, but you passed "+U+".");var se=E({},U.props),Z=U.key;if(H!=null)for(le in H.key!==void 0&&(Z=""+H.key),H)!A.call(H,le)||le==="key"||le==="__self"||le==="__source"||le==="ref"&&H.ref===void 0||(se[le]=H[le]);var le=arguments.length-2;if(le===1)se.children=ne;else if(1<le){for(var pe=Array(le),Ee=0;Ee<le;Ee++)pe[Ee]=arguments[Ee+2];se.children=pe}return N(U.type,Z,se)},He.createContext=function(U){return U={$$typeof:u,_currentValue:U,_currentValue2:U,_threadCount:0,Provider:null,Consumer:null},U.Provider=U,U.Consumer={$$typeof:o,_context:U},U},He.createElement=function(U,H,ne){var se,Z={},le=null;if(H!=null)for(se in H.key!==void 0&&(le=""+H.key),H)A.call(H,se)&&se!=="key"&&se!=="__self"&&se!=="__source"&&(Z[se]=H[se]);var pe=arguments.length-2;if(pe===1)Z.children=ne;else if(1<pe){for(var Ee=Array(pe),ge=0;ge<pe;ge++)Ee[ge]=arguments[ge+2];Z.children=Ee}if(U&&U.defaultProps)for(se in pe=U.defaultProps,pe)Z[se]===void 0&&(Z[se]=pe[se]);return N(U,le,Z)},He.createRef=function(){return{current:null}},He.forwardRef=function(U){return{$$typeof:h,render:U}},He.isValidElement=P,He.lazy=function(U){return{$$typeof:g,_payload:{_status:-1,_result:U},_init:W}},He.memo=function(U,H){return{$$typeof:m,type:U,compare:H===void 0?null:H}},He.startTransition=function(U){var H=D.T,ne={};D.T=ne;try{var se=U(),Z=D.S;Z!==null&&Z(ne,se),typeof se=="object"&&se!==null&&typeof se.then=="function"&&se.then(G,ee)}catch(le){ee(le)}finally{H!==null&&ne.types!==null&&(H.types=ne.types),D.T=H}},He.unstable_useCacheRefresh=function(){return D.H.useCacheRefresh()},He.use=function(U){return D.H.use(U)},He.useActionState=function(U,H,ne){return D.H.useActionState(U,H,ne)},He.useCallback=function(U,H){return D.H.useCallback(U,H)},He.useContext=function(U){return D.H.useContext(U)},He.useDebugValue=function(){},He.useDeferredValue=function(U,H){return D.H.useDeferredValue(U,H)},He.useEffect=function(U,H){return D.H.useEffect(U,H)},He.useEffectEvent=function(U){return D.H.useEffectEvent(U)},He.useId=function(){return D.H.useId()},He.useImperativeHandle=function(U,H,ne){return D.H.useImperativeHandle(U,H,ne)},He.useInsertionEffect=function(U,H){return D.H.useInsertionEffect(U,H)},He.useLayoutEffect=function(U,H){return D.H.useLayoutEffect(U,H)},He.useMemo=function(U,H){return D.H.useMemo(U,H)},He.useOptimistic=function(U,H){return D.H.useOptimistic(U,H)},He.useReducer=function(U,H,ne){return D.H.useReducer(U,H,ne)},He.useRef=function(U){return D.H.useRef(U)},He.useState=function(U){return D.H.useState(U)},He.useSyncExternalStore=function(U,H,ne){return D.H.useSyncExternalStore(U,H,ne)},He.useTransition=function(){return D.H.useTransition()},He.version="19.2.3",He}var hx;function jy(){return hx||(hx=1,yg.exports=Uj()),yg.exports}var T=jy(),_g={exports:{}},uu={},bg={exports:{}},vg={};var fx;function Fj(){return fx||(fx=1,(function(t){function e(z,V){var W=z.length;z.push(V);e:for(;0<W;){var ee=W-1>>>1,ie=z[ee];if(0<a(ie,V))z[ee]=V,z[W]=ie,W=ee;else break e}}function n(z){return z.length===0?null:z[0]}function r(z){if(z.length===0)return null;var V=z[0],W=z.pop();if(W!==V){z[0]=W;e:for(var ee=0,ie=z.length,U=ie>>>1;ee<U;){var H=2*(ee+1)-1,ne=z[H],se=H+1,Z=z[se];if(0>a(ne,W))se<ie&&0>a(Z,ne)?(z[ee]=Z,z[se]=W,ee=se):(z[ee]=ne,z[H]=W,ee=H);else if(se<ie&&0>a(Z,W))z[ee]=Z,z[se]=W,ee=se;else break e}}return V}function a(z,V){var W=z.sortIndex-V.sortIndex;return W!==0?W:z.id-V.id}if(t.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var o=performance;t.unstable_now=function(){return o.now()}}else{var u=Date,h=u.now();t.unstable_now=function(){return u.now()-h}}var f=[],m=[],g=1,_=null,v=3,S=!1,x=!1,E=!1,C=!1,I=typeof setTimeout=="function"?setTimeout:null,j=typeof clearTimeout=="function"?clearTimeout:null,M=typeof setImmediate<"u"?setImmediate:null;function Q(z){for(var V=n(m);V!==null;){if(V.callback===null)r(m);else if(V.startTime<=z)r(m),V.sortIndex=V.expirationTime,e(f,V);else break;V=n(m)}}function q(z){if(E=!1,Q(z),!x)if(n(f)!==null)x=!0,G||(G=!0,B());else{var V=n(m);V!==null&&Y(q,V.startTime-z)}}var G=!1,D=-1,A=5,N=-1;function L(){return C?!0:!(t.unstable_now()-N<A)}function P(){if(C=!1,G){var z=t.unstable_now();N=z;var V=!0;try{e:{x=!1,E&&(E=!1,j(D),D=-1),S=!0;var W=v;try{t:{for(Q(z),_=n(f);_!==null&&!(_.expirationTime>z&&L());){var ee=_.callback;if(typeof ee=="function"){_.callback=null,v=_.priorityLevel;var ie=ee(_.expirationTime<=z);if(z=t.unstable_now(),typeof ie=="function"){_.callback=ie,Q(z),V=!0;break t}_===n(f)&&r(f),Q(z)}else r(f);_=n(f)}if(_!==null)V=!0;else{var U=n(m);U!==null&&Y(q,U.startTime-z),V=!1}}break e}finally{_=null,v=W,S=!1}V=void 0}}finally{V?B():G=!1}}}var B;if(typeof M=="function")B=function(){M(P)};else if(typeof MessageChannel<"u"){var O=new MessageChannel,K=O.port2;O.port1.onmessage=P,B=function(){K.postMessage(null)}}else B=function(){I(P,0)};function Y(z,V){D=I(function(){z(t.unstable_now())},V)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(z){z.callback=null},t.unstable_forceFrameRate=function(z){0>z||125<z?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):A=0<z?Math.floor(1e3/z):5},t.unstable_getCurrentPriorityLevel=function(){return v},t.unstable_next=function(z){switch(v){case 1:case 2:case 3:var V=3;break;default:V=v}var W=v;v=V;try{return z()}finally{v=W}},t.unstable_requestPaint=function(){C=!0},t.unstable_runWithPriority=function(z,V){switch(z){case 1:case 2:case 3:case 4:case 5:break;default:z=3}var W=v;v=z;try{return V()}finally{v=W}},t.unstable_scheduleCallback=function(z,V,W){var ee=t.unstable_now();switch(typeof W=="object"&&W!==null?(W=W.delay,W=typeof W=="number"&&0<W?ee+W:ee):W=ee,z){case 1:var ie=-1;break;case 2:ie=250;break;case 5:ie=1073741823;break;case 4:ie=1e4;break;default:ie=5e3}return ie=W+ie,z={id:g++,callback:V,priorityLevel:z,startTime:W,expirationTime:ie,sortIndex:-1},W>ee?(z.sortIndex=W,e(m,z),n(f)===null&&z===n(m)&&(E?(j(D),D=-1):E=!0,Y(q,W-ee))):(z.sortIndex=ie,e(f,z),x||S||(x=!0,G||(G=!0,B()))),z},t.unstable_shouldYield=L,t.unstable_wrapCallback=function(z){var V=v;return function(){var W=v;v=V;try{return z.apply(this,arguments)}finally{v=W}}}})(vg)),vg}var mx;function Vj(){return mx||(mx=1,bg.exports=Fj()),bg.exports}var xg={exports:{}},On={};var px;function $j(){if(px)return On;px=1;var t=jy();function e(f){var m="https://react.dev/errors/"+f;if(1<arguments.length){m+="?args[]="+encodeURIComponent(arguments[1]);for(var g=2;g<arguments.length;g++)m+="&args[]="+encodeURIComponent(arguments[g])}return"Minified React error #"+f+"; visit "+m+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function n(){}var r={d:{f:n,r:function(){throw Error(e(522))},D:n,C:n,L:n,m:n,X:n,S:n,M:n},p:0,findDOMNode:null},a=Symbol.for("react.portal");function o(f,m,g){var _=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:a,key:_==null?null:""+_,children:f,containerInfo:m,implementation:g}}var u=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function h(f,m){if(f==="font")return"";if(typeof m=="string")return m==="use-credentials"?m:""}return On.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=r,On.createPortal=function(f,m){var g=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!m||m.nodeType!==1&&m.nodeType!==9&&m.nodeType!==11)throw Error(e(299));return o(f,m,null,g)},On.flushSync=function(f){var m=u.T,g=r.p;try{if(u.T=null,r.p=2,f)return f()}finally{u.T=m,r.p=g,r.d.f()}},On.preconnect=function(f,m){typeof f=="string"&&(m?(m=m.crossOrigin,m=typeof m=="string"?m==="use-credentials"?m:"":void 0):m=null,r.d.C(f,m))},On.prefetchDNS=function(f){typeof f=="string"&&r.d.D(f)},On.preinit=function(f,m){if(typeof f=="string"&&m&&typeof m.as=="string"){var g=m.as,_=h(g,m.crossOrigin),v=typeof m.integrity=="string"?m.integrity:void 0,S=typeof m.fetchPriority=="string"?m.fetchPriority:void 0;g==="style"?r.d.S(f,typeof m.precedence=="string"?m.precedence:void 0,{crossOrigin:_,integrity:v,fetchPriority:S}):g==="script"&&r.d.X(f,{crossOrigin:_,integrity:v,fetchPriority:S,nonce:typeof m.nonce=="string"?m.nonce:void 0})}},On.preinitModule=function(f,m){if(typeof f=="string")if(typeof m=="object"&&m!==null){if(m.as==null||m.as==="script"){var g=h(m.as,m.crossOrigin);r.d.M(f,{crossOrigin:g,integrity:typeof m.integrity=="string"?m.integrity:void 0,nonce:typeof m.nonce=="string"?m.nonce:void 0})}}else m==null&&r.d.M(f)},On.preload=function(f,m){if(typeof f=="string"&&typeof m=="object"&&m!==null&&typeof m.as=="string"){var g=m.as,_=h(g,m.crossOrigin);r.d.L(f,g,{crossOrigin:_,integrity:typeof m.integrity=="string"?m.integrity:void 0,nonce:typeof m.nonce=="string"?m.nonce:void 0,type:typeof m.type=="string"?m.type:void 0,fetchPriority:typeof m.fetchPriority=="string"?m.fetchPriority:void 0,referrerPolicy:typeof m.referrerPolicy=="string"?m.referrerPolicy:void 0,imageSrcSet:typeof m.imageSrcSet=="string"?m.imageSrcSet:void 0,imageSizes:typeof m.imageSizes=="string"?m.imageSizes:void 0,media:typeof m.media=="string"?m.media:void 0})}},On.preloadModule=function(f,m){if(typeof f=="string")if(m){var g=h(m.as,m.crossOrigin);r.d.m(f,{as:typeof m.as=="string"&&m.as!=="script"?m.as:void 0,crossOrigin:g,integrity:typeof m.integrity=="string"?m.integrity:void 0})}else r.d.m(f)},On.requestFormReset=function(f){r.d.r(f)},On.unstable_batchedUpdates=function(f,m){return f(m)},On.useFormState=function(f,m,g){return u.H.useFormState(f,m,g)},On.useFormStatus=function(){return u.H.useHostTransitionStatus()},On.version="19.2.3",On}var gx;function qj(){if(gx)return xg.exports;gx=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),xg.exports=$j(),xg.exports}var yx;function Hj(){if(yx)return uu;yx=1;var t=Vj(),e=jy(),n=qj();function r(s){var i="https://react.dev/errors/"+s;if(1<arguments.length){i+="?args[]="+encodeURIComponent(arguments[1]);for(var l=2;l<arguments.length;l++)i+="&args[]="+encodeURIComponent(arguments[l])}return"Minified React error #"+s+"; visit "+i+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function a(s){return!(!s||s.nodeType!==1&&s.nodeType!==9&&s.nodeType!==11)}function o(s){var i=s,l=s;if(s.alternate)for(;i.return;)i=i.return;else{s=i;do i=s,(i.flags&4098)!==0&&(l=i.return),s=i.return;while(s)}return i.tag===3?l:null}function u(s){if(s.tag===13){var i=s.memoizedState;if(i===null&&(s=s.alternate,s!==null&&(i=s.memoizedState)),i!==null)return i.dehydrated}return null}function h(s){if(s.tag===31){var i=s.memoizedState;if(i===null&&(s=s.alternate,s!==null&&(i=s.memoizedState)),i!==null)return i.dehydrated}return null}function f(s){if(o(s)!==s)throw Error(r(188))}function m(s){var i=s.alternate;if(!i){if(i=o(s),i===null)throw Error(r(188));return i!==s?null:s}for(var l=s,d=i;;){var y=l.return;if(y===null)break;var b=y.alternate;if(b===null){if(d=y.return,d!==null){l=d;continue}break}if(y.child===b.child){for(b=y.child;b;){if(b===l)return f(y),s;if(b===d)return f(y),i;b=b.sibling}throw Error(r(188))}if(l.return!==d.return)l=y,d=b;else{for(var R=!1,F=y.child;F;){if(F===l){R=!0,l=y,d=b;break}if(F===d){R=!0,d=y,l=b;break}F=F.sibling}if(!R){for(F=b.child;F;){if(F===l){R=!0,l=b,d=y;break}if(F===d){R=!0,d=b,l=y;break}F=F.sibling}if(!R)throw Error(r(189))}}if(l.alternate!==d)throw Error(r(190))}if(l.tag!==3)throw Error(r(188));return l.stateNode.current===l?s:i}function g(s){var i=s.tag;if(i===5||i===26||i===27||i===6)return s;for(s=s.child;s!==null;){if(i=g(s),i!==null)return i;s=s.sibling}return null}var _=Object.assign,v=Symbol.for("react.element"),S=Symbol.for("react.transitional.element"),x=Symbol.for("react.portal"),E=Symbol.for("react.fragment"),C=Symbol.for("react.strict_mode"),I=Symbol.for("react.profiler"),j=Symbol.for("react.consumer"),M=Symbol.for("react.context"),Q=Symbol.for("react.forward_ref"),q=Symbol.for("react.suspense"),G=Symbol.for("react.suspense_list"),D=Symbol.for("react.memo"),A=Symbol.for("react.lazy"),N=Symbol.for("react.activity"),L=Symbol.for("react.memo_cache_sentinel"),P=Symbol.iterator;function B(s){return s===null||typeof s!="object"?null:(s=P&&s[P]||s["@@iterator"],typeof s=="function"?s:null)}var O=Symbol.for("react.client.reference");function K(s){if(s==null)return null;if(typeof s=="function")return s.$$typeof===O?null:s.displayName||s.name||null;if(typeof s=="string")return s;switch(s){case E:return"Fragment";case I:return"Profiler";case C:return"StrictMode";case q:return"Suspense";case G:return"SuspenseList";case N:return"Activity"}if(typeof s=="object")switch(s.$$typeof){case x:return"Portal";case M:return s.displayName||"Context";case j:return(s._context.displayName||"Context")+".Consumer";case Q:var i=s.render;return s=s.displayName,s||(s=i.displayName||i.name||"",s=s!==""?"ForwardRef("+s+")":"ForwardRef"),s;case D:return i=s.displayName||null,i!==null?i:K(s.type)||"Memo";case A:i=s._payload,s=s._init;try{return K(s(i))}catch{}}return null}var Y=Array.isArray,z=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,V=n.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,W={pending:!1,data:null,method:null,action:null},ee=[],ie=-1;function U(s){return{current:s}}function H(s){0>ie||(s.current=ee[ie],ee[ie]=null,ie--)}function ne(s,i){ie++,ee[ie]=s.current,s.current=i}var se=U(null),Z=U(null),le=U(null),pe=U(null);function Ee(s,i){switch(ne(le,i),ne(Z,s),ne(se,null),i.nodeType){case 9:case 11:s=(s=i.documentElement)&&(s=s.namespaceURI)?Mv(s):0;break;default:if(s=i.tagName,i=i.namespaceURI)i=Mv(i),s=kv(i,s);else switch(s){case"svg":s=1;break;case"math":s=2;break;default:s=0}}H(se),ne(se,s)}function ge(){H(se),H(Z),H(le)}function J(s){s.memoizedState!==null&&ne(pe,s);var i=se.current,l=kv(i,s.type);i!==l&&(ne(Z,s),ne(se,l))}function Se(s){Z.current===s&&(H(se),H(Z)),pe.current===s&&(H(pe),iu._currentValue=W)}var Ae,ct;function Me(s){if(Ae===void 0)try{throw Error()}catch(l){var i=l.stack.trim().match(/\n( *(at )?)/);Ae=i&&i[1]||"",ct=-1<l.stack.indexOf(`
    at`)?" (<anonymous>)":-1<l.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Ae+s+ct}var Oe=!1;function ot(s,i){if(!s||Oe)return"";Oe=!0;var l=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var d={DetermineComponentFrameRoot:function(){try{if(i){var be=function(){throw Error()};if(Object.defineProperty(be.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(be,[])}catch(fe){var de=fe}Reflect.construct(s,[],be)}else{try{be.call()}catch(fe){de=fe}s.call(be.prototype)}}else{try{throw Error()}catch(fe){de=fe}(be=s())&&typeof be.catch=="function"&&be.catch(function(){})}}catch(fe){if(fe&&de&&typeof fe.stack=="string")return[fe.stack,de.stack]}return[null,null]}};d.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var y=Object.getOwnPropertyDescriptor(d.DetermineComponentFrameRoot,"name");y&&y.configurable&&Object.defineProperty(d.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var b=d.DetermineComponentFrameRoot(),R=b[0],F=b[1];if(R&&F){var X=R.split(`
`),ue=F.split(`
`);for(y=d=0;d<X.length&&!X[d].includes("DetermineComponentFrameRoot");)d++;for(;y<ue.length&&!ue[y].includes("DetermineComponentFrameRoot");)y++;if(d===X.length||y===ue.length)for(d=X.length-1,y=ue.length-1;1<=d&&0<=y&&X[d]!==ue[y];)y--;for(;1<=d&&0<=y;d--,y--)if(X[d]!==ue[y]){if(d!==1||y!==1)do if(d--,y--,0>y||X[d]!==ue[y]){var me=`
`+X[d].replace(" at new "," at ");return s.displayName&&me.includes("<anonymous>")&&(me=me.replace("<anonymous>",s.displayName)),me}while(1<=d&&0<=y);break}}}finally{Oe=!1,Error.prepareStackTrace=l}return(l=s?s.displayName||s.name:"")?Me(l):""}function Sn(s,i){switch(s.tag){case 26:case 27:case 5:return Me(s.type);case 16:return Me("Lazy");case 13:return s.child!==i&&i!==null?Me("Suspense Fallback"):Me("Suspense");case 19:return Me("SuspenseList");case 0:case 15:return ot(s.type,!1);case 11:return ot(s.type.render,!1);case 1:return ot(s.type,!0);case 31:return Me("Activity");default:return""}}function Qn(s){try{var i="",l=null;do i+=Sn(s,l),l=s,s=s.return;while(s);return i}catch(d){return`
Error generating stack: `+d.message+`
`+d.stack}}var mt=Object.prototype.hasOwnProperty,Dt=t.unstable_scheduleCallback,je=t.unstable_cancelCallback,Ye=t.unstable_shouldYield,bi=t.unstable_requestPaint,dn=t.unstable_now,zr=t.unstable_getCurrentPriorityLevel,lc=t.unstable_ImmediatePriority,cc=t.unstable_UserBlockingPriority,vi=t.unstable_NormalPriority,bm=t.unstable_LowPriority,od=t.unstable_IdlePriority,ld=t.log,cd=t.unstable_setDisableYieldValue,Ur=null,wn=null;function Sr(s){if(typeof ld=="function"&&cd(s),wn&&typeof wn.setStrictMode=="function")try{wn.setStrictMode(Ur,s)}catch{}}var Ht=Math.clz32?Math.clz32:dd,ud=Math.log,jo=Math.LN2;function dd(s){return s>>>=0,s===0?32:31-(ud(s)/jo|0)|0}var as=256,Ra=262144,Xt=4194304;function os(s){var i=s&42;if(i!==0)return i;switch(s&-s){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return s&261888;case 262144:case 524288:case 1048576:case 2097152:return s&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return s&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return s}}function ls(s,i,l){var d=s.pendingLanes;if(d===0)return 0;var y=0,b=s.suspendedLanes,R=s.pingedLanes;s=s.warmLanes;var F=d&134217727;return F!==0?(d=F&~b,d!==0?y=os(d):(R&=F,R!==0?y=os(R):l||(l=F&~s,l!==0&&(y=os(l))))):(F=d&~b,F!==0?y=os(F):R!==0?y=os(R):l||(l=d&~s,l!==0&&(y=os(l)))),y===0?0:i!==0&&i!==y&&(i&b)===0&&(b=y&-y,l=i&-i,b>=l||b===32&&(l&4194048)!==0)?i:y}function Fr(s,i){return(s.pendingLanes&~(s.suspendedLanes&~s.pingedLanes)&i)===0}function vm(s,i){switch(s){case 1:case 2:case 4:case 8:case 64:return i+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function hd(){var s=Xt;return Xt<<=1,(Xt&62914560)===0&&(Xt=4194304),s}function cs(s){for(var i=[],l=0;31>l;l++)i.push(s);return i}function Da(s,i){s.pendingLanes|=i,i!==268435456&&(s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0)}function xm(s,i,l,d,y,b){var R=s.pendingLanes;s.pendingLanes=l,s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0,s.expiredLanes&=l,s.entangledLanes&=l,s.errorRecoveryDisabledLanes&=l,s.shellSuspendCounter=0;var F=s.entanglements,X=s.expirationTimes,ue=s.hiddenUpdates;for(l=R&~l;0<l;){var me=31-Ht(l),be=1<<me;F[me]=0,X[me]=-1;var de=ue[me];if(de!==null)for(ue[me]=null,me=0;me<de.length;me++){var fe=de[me];fe!==null&&(fe.lane&=-536870913)}l&=~be}d!==0&&Ia(s,d,0),b!==0&&y===0&&s.tag!==0&&(s.suspendedLanes|=b&~(R&~i))}function Ia(s,i,l){s.pendingLanes|=i,s.suspendedLanes&=~i;var d=31-Ht(i);s.entangledLanes|=i,s.entanglements[d]=s.entanglements[d]|1073741824|l&261930}function uc(s,i){var l=s.entangledLanes|=i;for(s=s.entanglements;l;){var d=31-Ht(l),y=1<<d;y&i|s[d]&i&&(s[d]|=i),l&=~y}}function dc(s,i){var l=i&-i;return l=(l&42)!==0?1:Ma(l),(l&(s.suspendedLanes|i))!==0?0:l}function Ma(s){switch(s){case 2:s=1;break;case 8:s=4;break;case 32:s=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:s=128;break;case 268435456:s=134217728;break;default:s=0}return s}function Us(s){return s&=-s,2<s?8<s?(s&134217727)!==0?32:268435456:8:2}function fd(){var s=V.p;return s!==0?s:(s=window.event,s===void 0?32:nx(s.type))}function Vr(s,i){var l=V.p;try{return V.p=s,i()}finally{V.p=l}}var $r=Math.random().toString(36).slice(2),Jt="__reactFiber$"+$r,_n="__reactProps$"+$r,us="__reactContainer$"+$r,Ro="__reactEvents$"+$r,Sm="__reactListeners$"+$r,md="__reactHandles$"+$r,pd="__reactResources$"+$r,ds="__reactMarker$"+$r;function Do(s){delete s[Jt],delete s[_n],delete s[Ro],delete s[Sm],delete s[md]}function hs(s){var i=s[Jt];if(i)return i;for(var l=s.parentNode;l;){if(i=l[us]||l[Jt]){if(l=i.alternate,i.child!==null||l!==null&&l.child!==null)for(s=Uv(s);s!==null;){if(l=s[Jt])return l;s=Uv(s)}return i}s=l,l=s.parentNode}return null}function wr(s){if(s=s[Jt]||s[us]){var i=s.tag;if(i===5||i===6||i===13||i===31||i===26||i===27||i===3)return s}return null}function ar(s){var i=s.tag;if(i===5||i===26||i===27||i===6)return s.stateNode;throw Error(r(33))}function fs(s){var i=s[pd];return i||(i=s[pd]={hoistableStyles:new Map,hoistableScripts:new Map}),i}function Zt(s){s[ds]=!0}var hc=new Set,fc={};function ms(s,i){ps(s,i),ps(s+"Capture",i)}function ps(s,i){for(fc[s]=i,s=0;s<i.length;s++)hc.add(i[s])}var mc=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),pc={},gc={};function gd(s){return mt.call(gc,s)?!0:mt.call(pc,s)?!1:mc.test(s)?gc[s]=!0:(pc[s]=!0,!1)}function Io(s,i,l){if(gd(i))if(l===null)s.removeAttribute(i);else{switch(typeof l){case"undefined":case"function":case"symbol":s.removeAttribute(i);return;case"boolean":var d=i.toLowerCase().slice(0,5);if(d!=="data-"&&d!=="aria-"){s.removeAttribute(i);return}}s.setAttribute(i,""+l)}}function or(s,i,l){if(l===null)s.removeAttribute(i);else{switch(typeof l){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(i);return}s.setAttribute(i,""+l)}}function en(s,i,l,d){if(d===null)s.removeAttribute(l);else{switch(typeof d){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(l);return}s.setAttributeNS(i,l,""+d)}}function bn(s){switch(typeof s){case"bigint":case"boolean":case"number":case"string":case"undefined":return s;case"object":return s;default:return""}}function xi(s){var i=s.type;return(s=s.nodeName)&&s.toLowerCase()==="input"&&(i==="checkbox"||i==="radio")}function yc(s,i,l){var d=Object.getOwnPropertyDescriptor(s.constructor.prototype,i);if(!s.hasOwnProperty(i)&&typeof d<"u"&&typeof d.get=="function"&&typeof d.set=="function"){var y=d.get,b=d.set;return Object.defineProperty(s,i,{configurable:!0,get:function(){return y.call(this)},set:function(R){l=""+R,b.call(this,R)}}),Object.defineProperty(s,i,{enumerable:d.enumerable}),{getValue:function(){return l},setValue:function(R){l=""+R},stopTracking:function(){s._valueTracker=null,delete s[i]}}}}function _t(s){if(!s._valueTracker){var i=xi(s)?"checked":"value";s._valueTracker=yc(s,i,""+s[i])}}function ka(s){if(!s)return!1;var i=s._valueTracker;if(!i)return!0;var l=i.getValue(),d="";return s&&(d=xi(s)?s.checked?"true":"false":s.value),s=d,s!==l?(i.setValue(s),!0):!1}function gs(s){if(s=s||(typeof document<"u"?document:void 0),typeof s>"u")return null;try{return s.activeElement||s.body}catch{return s.body}}var Oa=/[\n"\\]/g;function Wn(s){return s.replace(Oa,function(i){return"\\"+i.charCodeAt(0).toString(16)+" "})}function Mo(s,i,l,d,y,b,R,F){s.name="",R!=null&&typeof R!="function"&&typeof R!="symbol"&&typeof R!="boolean"?s.type=R:s.removeAttribute("type"),i!=null?R==="number"?(i===0&&s.value===""||s.value!=i)&&(s.value=""+bn(i)):s.value!==""+bn(i)&&(s.value=""+bn(i)):R!=="submit"&&R!=="reset"||s.removeAttribute("value"),i!=null?_c(s,R,bn(i)):l!=null?_c(s,R,bn(l)):d!=null&&s.removeAttribute("value"),y==null&&b!=null&&(s.defaultChecked=!!b),y!=null&&(s.checked=y&&typeof y!="function"&&typeof y!="symbol"),F!=null&&typeof F!="function"&&typeof F!="symbol"&&typeof F!="boolean"?s.name=""+bn(F):s.removeAttribute("name")}function yd(s,i,l,d,y,b,R,F){if(b!=null&&typeof b!="function"&&typeof b!="symbol"&&typeof b!="boolean"&&(s.type=b),i!=null||l!=null){if(!(b!=="submit"&&b!=="reset"||i!=null)){_t(s);return}l=l!=null?""+bn(l):"",i=i!=null?""+bn(i):l,F||i===s.value||(s.value=i),s.defaultValue=i}d=d??y,d=typeof d!="function"&&typeof d!="symbol"&&!!d,s.checked=F?s.checked:!!d,s.defaultChecked=!!d,R!=null&&typeof R!="function"&&typeof R!="symbol"&&typeof R!="boolean"&&(s.name=R),_t(s)}function _c(s,i,l){i==="number"&&gs(s.ownerDocument)===s||s.defaultValue===""+l||(s.defaultValue=""+l)}function Si(s,i,l,d){if(s=s.options,i){i={};for(var y=0;y<l.length;y++)i["$"+l[y]]=!0;for(l=0;l<s.length;l++)y=i.hasOwnProperty("$"+s[l].value),s[l].selected!==y&&(s[l].selected=y),y&&d&&(s[l].defaultSelected=!0)}else{for(l=""+bn(l),i=null,y=0;y<s.length;y++){if(s[y].value===l){s[y].selected=!0,d&&(s[y].defaultSelected=!0);return}i!==null||s[y].disabled||(i=s[y])}i!==null&&(i.selected=!0)}}function _d(s,i,l){if(i!=null&&(i=""+bn(i),i!==s.value&&(s.value=i),l==null)){s.defaultValue!==i&&(s.defaultValue=i);return}s.defaultValue=l!=null?""+bn(l):""}function wi(s,i,l,d){if(i==null){if(d!=null){if(l!=null)throw Error(r(92));if(Y(d)){if(1<d.length)throw Error(r(93));d=d[0]}l=d}l==null&&(l=""),i=l}l=bn(i),s.defaultValue=l,d=s.textContent,d===l&&d!==""&&d!==null&&(s.value=d),_t(s)}function Kn(s,i){if(i){var l=s.firstChild;if(l&&l===s.lastChild&&l.nodeType===3){l.nodeValue=i;return}}s.textContent=i}var bd=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function bc(s,i,l){var d=i.indexOf("--")===0;l==null||typeof l=="boolean"||l===""?d?s.setProperty(i,""):i==="float"?s.cssFloat="":s[i]="":d?s.setProperty(i,l):typeof l!="number"||l===0||bd.has(i)?i==="float"?s.cssFloat=l:s[i]=(""+l).trim():s[i]=l+"px"}function vc(s,i,l){if(i!=null&&typeof i!="object")throw Error(r(62));if(s=s.style,l!=null){for(var d in l)!l.hasOwnProperty(d)||i!=null&&i.hasOwnProperty(d)||(d.indexOf("--")===0?s.setProperty(d,""):d==="float"?s.cssFloat="":s[d]="");for(var y in i)d=i[y],i.hasOwnProperty(y)&&l[y]!==d&&bc(s,y,d)}else for(var b in i)i.hasOwnProperty(b)&&bc(s,b,i[b])}function ko(s){if(s.indexOf("-")===-1)return!1;switch(s){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var vd=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Ei=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Oo(s){return Ei.test(""+s)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":s}function qr(){}var xc=null;function Er(s){return s=s.target||s.srcElement||window,s.correspondingUseElement&&(s=s.correspondingUseElement),s.nodeType===3?s.parentNode:s}var Ci=null,ys=null;function Na(s){var i=wr(s);if(i&&(s=i.stateNode)){var l=s[_n]||null;e:switch(s=i.stateNode,i.type){case"input":if(Mo(s,l.value,l.defaultValue,l.defaultValue,l.checked,l.defaultChecked,l.type,l.name),i=l.name,l.type==="radio"&&i!=null){for(l=s;l.parentNode;)l=l.parentNode;for(l=l.querySelectorAll('input[name="'+Wn(""+i)+'"][type="radio"]'),i=0;i<l.length;i++){var d=l[i];if(d!==s&&d.form===s.form){var y=d[_n]||null;if(!y)throw Error(r(90));Mo(d,y.value,y.defaultValue,y.defaultValue,y.checked,y.defaultChecked,y.type,y.name)}}for(i=0;i<l.length;i++)d=l[i],d.form===s.form&&ka(d)}break e;case"textarea":_d(s,l.value,l.defaultValue);break e;case"select":i=l.value,i!=null&&Si(s,!!l.multiple,i,!1)}}}var No=!1;function Ti(s,i,l){if(No)return s(i,l);No=!0;try{var d=s(i);return d}finally{if(No=!1,(Ci!==null||ys!==null)&&(fh(),Ci&&(i=Ci,s=ys,ys=Ci=null,Na(i),s)))for(i=0;i<s.length;i++)Na(s[i])}}function Hr(s,i){var l=s.stateNode;if(l===null)return null;var d=l[_n]||null;if(d===null)return null;l=d[i];e:switch(i){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(d=!d.disabled)||(s=s.type,d=!(s==="button"||s==="input"||s==="select"||s==="textarea")),s=!d;break e;default:s=!1}if(s)return null;if(l&&typeof l!="function")throw Error(r(231,i,typeof l));return l}var Cr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Pa=!1;if(Cr)try{var xt={};Object.defineProperty(xt,"passive",{get:function(){Pa=!0}}),window.addEventListener("test",xt,xt),window.removeEventListener("test",xt,xt)}catch{Pa=!1}var _s=null,Sc=null,Ba=null;function wc(){if(Ba)return Ba;var s,i=Sc,l=i.length,d,y="value"in _s?_s.value:_s.textContent,b=y.length;for(s=0;s<l&&i[s]===y[s];s++);var R=l-s;for(d=1;d<=R&&i[l-d]===y[b-d];d++);return Ba=y.slice(s,1<d?1-d:void 0)}function La(s){var i=s.keyCode;return"charCode"in s?(s=s.charCode,s===0&&i===13&&(s=13)):s=i,s===10&&(s=13),32<=s||s===13?s:0}function Fs(){return!0}function Gr(){return!1}function En(s){function i(l,d,y,b,R){this._reactName=l,this._targetInst=y,this.type=d,this.nativeEvent=b,this.target=R,this.currentTarget=null;for(var F in s)s.hasOwnProperty(F)&&(l=s[F],this[F]=l?l(b):b[F]);return this.isDefaultPrevented=(b.defaultPrevented!=null?b.defaultPrevented:b.returnValue===!1)?Fs:Gr,this.isPropagationStopped=Gr,this}return _(i.prototype,{preventDefault:function(){this.defaultPrevented=!0;var l=this.nativeEvent;l&&(l.preventDefault?l.preventDefault():typeof l.returnValue!="unknown"&&(l.returnValue=!1),this.isDefaultPrevented=Fs)},stopPropagation:function(){var l=this.nativeEvent;l&&(l.stopPropagation?l.stopPropagation():typeof l.cancelBubble!="unknown"&&(l.cancelBubble=!0),this.isPropagationStopped=Fs)},persist:function(){},isPersistent:Fs}),i}var Vs={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(s){return s.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},bs=En(Vs),Ai=_({},Vs,{view:0,detail:0}),Ec=En(Ai),ji,Po,vs,Bo=_({},Ai,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Ri,button:0,buttons:0,relatedTarget:function(s){return s.relatedTarget===void 0?s.fromElement===s.srcElement?s.toElement:s.fromElement:s.relatedTarget},movementX:function(s){return"movementX"in s?s.movementX:(s!==vs&&(vs&&s.type==="mousemove"?(ji=s.screenX-vs.screenX,Po=s.screenY-vs.screenY):Po=ji=0,vs=s),ji)},movementY:function(s){return"movementY"in s?s.movementY:Po}}),Cc=En(Bo),za=_({},Bo,{dataTransfer:0}),xd=En(za),Sd=_({},Ai,{relatedTarget:0}),Ua=En(Sd),Tc=_({},Vs,{animationName:0,elapsedTime:0,pseudoElement:0}),wd=En(Tc),Lo=_({},Vs,{clipboardData:function(s){return"clipboardData"in s?s.clipboardData:window.clipboardData}}),Ed=En(Lo),Cd=_({},Vs,{data:0}),xs=En(Cd),Td={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Ad={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},jd={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Rd(s){var i=this.nativeEvent;return i.getModifierState?i.getModifierState(s):(s=jd[s])?!!i[s]:!1}function Ri(){return Rd}var Fn=_({},Ai,{key:function(s){if(s.key){var i=Td[s.key]||s.key;if(i!=="Unidentified")return i}return s.type==="keypress"?(s=La(s),s===13?"Enter":String.fromCharCode(s)):s.type==="keydown"||s.type==="keyup"?Ad[s.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Ri,charCode:function(s){return s.type==="keypress"?La(s):0},keyCode:function(s){return s.type==="keydown"||s.type==="keyup"?s.keyCode:0},which:function(s){return s.type==="keypress"?La(s):s.type==="keydown"||s.type==="keyup"?s.keyCode:0}}),Dd=En(Fn),Id=_({},Bo,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),$s=En(Id),p=_({},Ai,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Ri}),w=En(p),k=_({},Vs,{propertyName:0,elapsedTime:0,pseudoElement:0}),$=En(k),oe=_({},Bo,{deltaX:function(s){return"deltaX"in s?s.deltaX:"wheelDeltaX"in s?-s.wheelDeltaX:0},deltaY:function(s){return"deltaY"in s?s.deltaY:"wheelDeltaY"in s?-s.wheelDeltaY:"wheelDelta"in s?-s.wheelDelta:0},deltaZ:0,deltaMode:0}),he=En(oe),Ce=_({},Vs,{newState:0,oldState:0}),We=En(Ce),Gt=[9,13,27,32],pt=Cr&&"CompositionEvent"in window,Nt=null;Cr&&"documentMode"in document&&(Nt=document.documentMode);var Tr=Cr&&"TextEvent"in window&&!Nt,Ss=Cr&&(!pt||Nt&&8<Nt&&11>=Nt),Qr=" ",Wr=!1;function Fa(s,i){switch(s){case"keyup":return Gt.indexOf(i.keyCode)!==-1;case"keydown":return i.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function zo(s){return s=s.detail,typeof s=="object"&&"data"in s?s.data:null}var Uo=!1;function lA(s,i){switch(s){case"compositionend":return zo(i);case"keypress":return i.which!==32?null:(Wr=!0,Qr);case"textInput":return s=i.data,s===Qr&&Wr?null:s;default:return null}}function cA(s,i){if(Uo)return s==="compositionend"||!pt&&Fa(s,i)?(s=wc(),Ba=Sc=_s=null,Uo=!1,s):null;switch(s){case"paste":return null;case"keypress":if(!(i.ctrlKey||i.altKey||i.metaKey)||i.ctrlKey&&i.altKey){if(i.char&&1<i.char.length)return i.char;if(i.which)return String.fromCharCode(i.which)}return null;case"compositionend":return Ss&&i.locale!=="ko"?null:i.data;default:return null}}var uA={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function $0(s){var i=s&&s.nodeName&&s.nodeName.toLowerCase();return i==="input"?!!uA[s.type]:i==="textarea"}function q0(s,i,l,d){Ci?ys?ys.push(d):ys=[d]:Ci=d,i=vh(i,"onChange"),0<i.length&&(l=new bs("onChange","change",null,l,d),s.push({event:l,listeners:i}))}var Ac=null,jc=null;function dA(s){Tv(s,0)}function Md(s){var i=ar(s);if(ka(i))return s}function H0(s,i){if(s==="change")return i}var G0=!1;if(Cr){var wm;if(Cr){var Em="oninput"in document;if(!Em){var Q0=document.createElement("div");Q0.setAttribute("oninput","return;"),Em=typeof Q0.oninput=="function"}wm=Em}else wm=!1;G0=wm&&(!document.documentMode||9<document.documentMode)}function W0(){Ac&&(Ac.detachEvent("onpropertychange",K0),jc=Ac=null)}function K0(s){if(s.propertyName==="value"&&Md(jc)){var i=[];q0(i,jc,s,Er(s)),Ti(dA,i)}}function hA(s,i,l){s==="focusin"?(W0(),Ac=i,jc=l,Ac.attachEvent("onpropertychange",K0)):s==="focusout"&&W0()}function fA(s){if(s==="selectionchange"||s==="keyup"||s==="keydown")return Md(jc)}function mA(s,i){if(s==="click")return Md(i)}function pA(s,i){if(s==="input"||s==="change")return Md(i)}function gA(s,i){return s===i&&(s!==0||1/s===1/i)||s!==s&&i!==i}var lr=typeof Object.is=="function"?Object.is:gA;function Rc(s,i){if(lr(s,i))return!0;if(typeof s!="object"||s===null||typeof i!="object"||i===null)return!1;var l=Object.keys(s),d=Object.keys(i);if(l.length!==d.length)return!1;for(d=0;d<l.length;d++){var y=l[d];if(!mt.call(i,y)||!lr(s[y],i[y]))return!1}return!0}function Y0(s){for(;s&&s.firstChild;)s=s.firstChild;return s}function X0(s,i){var l=Y0(s);s=0;for(var d;l;){if(l.nodeType===3){if(d=s+l.textContent.length,s<=i&&d>=i)return{node:l,offset:i-s};s=d}e:{for(;l;){if(l.nextSibling){l=l.nextSibling;break e}l=l.parentNode}l=void 0}l=Y0(l)}}function J0(s,i){return s&&i?s===i?!0:s&&s.nodeType===3?!1:i&&i.nodeType===3?J0(s,i.parentNode):"contains"in s?s.contains(i):s.compareDocumentPosition?!!(s.compareDocumentPosition(i)&16):!1:!1}function Z0(s){s=s!=null&&s.ownerDocument!=null&&s.ownerDocument.defaultView!=null?s.ownerDocument.defaultView:window;for(var i=gs(s.document);i instanceof s.HTMLIFrameElement;){try{var l=typeof i.contentWindow.location.href=="string"}catch{l=!1}if(l)s=i.contentWindow;else break;i=gs(s.document)}return i}function Cm(s){var i=s&&s.nodeName&&s.nodeName.toLowerCase();return i&&(i==="input"&&(s.type==="text"||s.type==="search"||s.type==="tel"||s.type==="url"||s.type==="password")||i==="textarea"||s.contentEditable==="true")}var yA=Cr&&"documentMode"in document&&11>=document.documentMode,Fo=null,Tm=null,Dc=null,Am=!1;function e_(s,i,l){var d=l.window===l?l.document:l.nodeType===9?l:l.ownerDocument;Am||Fo==null||Fo!==gs(d)||(d=Fo,"selectionStart"in d&&Cm(d)?d={start:d.selectionStart,end:d.selectionEnd}:(d=(d.ownerDocument&&d.ownerDocument.defaultView||window).getSelection(),d={anchorNode:d.anchorNode,anchorOffset:d.anchorOffset,focusNode:d.focusNode,focusOffset:d.focusOffset}),Dc&&Rc(Dc,d)||(Dc=d,d=vh(Tm,"onSelect"),0<d.length&&(i=new bs("onSelect","select",null,i,l),s.push({event:i,listeners:d}),i.target=Fo)))}function Va(s,i){var l={};return l[s.toLowerCase()]=i.toLowerCase(),l["Webkit"+s]="webkit"+i,l["Moz"+s]="moz"+i,l}var Vo={animationend:Va("Animation","AnimationEnd"),animationiteration:Va("Animation","AnimationIteration"),animationstart:Va("Animation","AnimationStart"),transitionrun:Va("Transition","TransitionRun"),transitionstart:Va("Transition","TransitionStart"),transitioncancel:Va("Transition","TransitionCancel"),transitionend:Va("Transition","TransitionEnd")},jm={},t_={};Cr&&(t_=document.createElement("div").style,"AnimationEvent"in window||(delete Vo.animationend.animation,delete Vo.animationiteration.animation,delete Vo.animationstart.animation),"TransitionEvent"in window||delete Vo.transitionend.transition);function $a(s){if(jm[s])return jm[s];if(!Vo[s])return s;var i=Vo[s],l;for(l in i)if(i.hasOwnProperty(l)&&l in t_)return jm[s]=i[l];return s}var n_=$a("animationend"),r_=$a("animationiteration"),s_=$a("animationstart"),_A=$a("transitionrun"),bA=$a("transitionstart"),vA=$a("transitioncancel"),i_=$a("transitionend"),a_=new Map,Rm="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Rm.push("scrollEnd");function Kr(s,i){a_.set(s,i),ms(i,[s])}var kd=typeof reportError=="function"?reportError:function(s){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var i=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof s=="object"&&s!==null&&typeof s.message=="string"?String(s.message):String(s),error:s});if(!window.dispatchEvent(i))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",s);return}console.error(s)},Ar=[],$o=0,Dm=0;function Od(){for(var s=$o,i=Dm=$o=0;i<s;){var l=Ar[i];Ar[i++]=null;var d=Ar[i];Ar[i++]=null;var y=Ar[i];Ar[i++]=null;var b=Ar[i];if(Ar[i++]=null,d!==null&&y!==null){var R=d.pending;R===null?y.next=y:(y.next=R.next,R.next=y),d.pending=y}b!==0&&o_(l,y,b)}}function Nd(s,i,l,d){Ar[$o++]=s,Ar[$o++]=i,Ar[$o++]=l,Ar[$o++]=d,Dm|=d,s.lanes|=d,s=s.alternate,s!==null&&(s.lanes|=d)}function Im(s,i,l,d){return Nd(s,i,l,d),Pd(s)}function qa(s,i){return Nd(s,null,null,i),Pd(s)}function o_(s,i,l){s.lanes|=l;var d=s.alternate;d!==null&&(d.lanes|=l);for(var y=!1,b=s.return;b!==null;)b.childLanes|=l,d=b.alternate,d!==null&&(d.childLanes|=l),b.tag===22&&(s=b.stateNode,s===null||s._visibility&1||(y=!0)),s=b,b=b.return;return s.tag===3?(b=s.stateNode,y&&i!==null&&(y=31-Ht(l),s=b.hiddenUpdates,d=s[y],d===null?s[y]=[i]:d.push(i),i.lane=l|536870912),b):null}function Pd(s){if(50<Jc)throw Jc=0,Up=null,Error(r(185));for(var i=s.return;i!==null;)s=i,i=s.return;return s.tag===3?s.stateNode:null}var qo={};function xA(s,i,l,d){this.tag=s,this.key=l,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=i,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=d,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function cr(s,i,l,d){return new xA(s,i,l,d)}function Mm(s){return s=s.prototype,!(!s||!s.isReactComponent)}function qs(s,i){var l=s.alternate;return l===null?(l=cr(s.tag,i,s.key,s.mode),l.elementType=s.elementType,l.type=s.type,l.stateNode=s.stateNode,l.alternate=s,s.alternate=l):(l.pendingProps=i,l.type=s.type,l.flags=0,l.subtreeFlags=0,l.deletions=null),l.flags=s.flags&65011712,l.childLanes=s.childLanes,l.lanes=s.lanes,l.child=s.child,l.memoizedProps=s.memoizedProps,l.memoizedState=s.memoizedState,l.updateQueue=s.updateQueue,i=s.dependencies,l.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext},l.sibling=s.sibling,l.index=s.index,l.ref=s.ref,l.refCleanup=s.refCleanup,l}function l_(s,i){s.flags&=65011714;var l=s.alternate;return l===null?(s.childLanes=0,s.lanes=i,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=l.childLanes,s.lanes=l.lanes,s.child=l.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=l.memoizedProps,s.memoizedState=l.memoizedState,s.updateQueue=l.updateQueue,s.type=l.type,i=l.dependencies,s.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext}),s}function Bd(s,i,l,d,y,b){var R=0;if(d=s,typeof s=="function")Mm(s)&&(R=1);else if(typeof s=="string")R=Tj(s,l,se.current)?26:s==="html"||s==="head"||s==="body"?27:5;else e:switch(s){case N:return s=cr(31,l,i,y),s.elementType=N,s.lanes=b,s;case E:return Ha(l.children,y,b,i);case C:R=8,y|=24;break;case I:return s=cr(12,l,i,y|2),s.elementType=I,s.lanes=b,s;case q:return s=cr(13,l,i,y),s.elementType=q,s.lanes=b,s;case G:return s=cr(19,l,i,y),s.elementType=G,s.lanes=b,s;default:if(typeof s=="object"&&s!==null)switch(s.$$typeof){case M:R=10;break e;case j:R=9;break e;case Q:R=11;break e;case D:R=14;break e;case A:R=16,d=null;break e}R=29,l=Error(r(130,s===null?"null":typeof s,"")),d=null}return i=cr(R,l,i,y),i.elementType=s,i.type=d,i.lanes=b,i}function Ha(s,i,l,d){return s=cr(7,s,d,i),s.lanes=l,s}function km(s,i,l){return s=cr(6,s,null,i),s.lanes=l,s}function c_(s){var i=cr(18,null,null,0);return i.stateNode=s,i}function Om(s,i,l){return i=cr(4,s.children!==null?s.children:[],s.key,i),i.lanes=l,i.stateNode={containerInfo:s.containerInfo,pendingChildren:null,implementation:s.implementation},i}var u_=new WeakMap;function jr(s,i){if(typeof s=="object"&&s!==null){var l=u_.get(s);return l!==void 0?l:(i={value:s,source:i,stack:Qn(i)},u_.set(s,i),i)}return{value:s,source:i,stack:Qn(i)}}var Ho=[],Go=0,Ld=null,Ic=0,Rr=[],Dr=0,Di=null,ws=1,Es="";function Hs(s,i){Ho[Go++]=Ic,Ho[Go++]=Ld,Ld=s,Ic=i}function d_(s,i,l){Rr[Dr++]=ws,Rr[Dr++]=Es,Rr[Dr++]=Di,Di=s;var d=ws;s=Es;var y=32-Ht(d)-1;d&=~(1<<y),l+=1;var b=32-Ht(i)+y;if(30<b){var R=y-y%5;b=(d&(1<<R)-1).toString(32),d>>=R,y-=R,ws=1<<32-Ht(i)+y|l<<y|d,Es=b+s}else ws=1<<b|l<<y|d,Es=s}function Nm(s){s.return!==null&&(Hs(s,1),d_(s,1,0))}function Pm(s){for(;s===Ld;)Ld=Ho[--Go],Ho[Go]=null,Ic=Ho[--Go],Ho[Go]=null;for(;s===Di;)Di=Rr[--Dr],Rr[Dr]=null,Es=Rr[--Dr],Rr[Dr]=null,ws=Rr[--Dr],Rr[Dr]=null}function h_(s,i){Rr[Dr++]=ws,Rr[Dr++]=Es,Rr[Dr++]=Di,ws=i.id,Es=i.overflow,Di=s}var Cn=null,It=null,at=!1,Ii=null,Ir=!1,Bm=Error(r(519));function Mi(s){var i=Error(r(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Mc(jr(i,s)),Bm}function f_(s){var i=s.stateNode,l=s.type,d=s.memoizedProps;switch(i[Jt]=s,i[_n]=d,l){case"dialog":Ze("cancel",i),Ze("close",i);break;case"iframe":case"object":case"embed":Ze("load",i);break;case"video":case"audio":for(l=0;l<eu.length;l++)Ze(eu[l],i);break;case"source":Ze("error",i);break;case"img":case"image":case"link":Ze("error",i),Ze("load",i);break;case"details":Ze("toggle",i);break;case"input":Ze("invalid",i),yd(i,d.value,d.defaultValue,d.checked,d.defaultChecked,d.type,d.name,!0);break;case"select":Ze("invalid",i);break;case"textarea":Ze("invalid",i),wi(i,d.value,d.defaultValue,d.children)}l=d.children,typeof l!="string"&&typeof l!="number"&&typeof l!="bigint"||i.textContent===""+l||d.suppressHydrationWarning===!0||Dv(i.textContent,l)?(d.popover!=null&&(Ze("beforetoggle",i),Ze("toggle",i)),d.onScroll!=null&&Ze("scroll",i),d.onScrollEnd!=null&&Ze("scrollend",i),d.onClick!=null&&(i.onclick=qr),i=!0):i=!1,i||Mi(s,!0)}function m_(s){for(Cn=s.return;Cn;)switch(Cn.tag){case 5:case 31:case 13:Ir=!1;return;case 27:case 3:Ir=!0;return;default:Cn=Cn.return}}function Qo(s){if(s!==Cn)return!1;if(!at)return m_(s),at=!0,!1;var i=s.tag,l;if((l=i!==3&&i!==27)&&((l=i===5)&&(l=s.type,l=!(l!=="form"&&l!=="button")||tg(s.type,s.memoizedProps)),l=!l),l&&It&&Mi(s),m_(s),i===13){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(r(317));It=zv(s)}else if(i===31){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(r(317));It=zv(s)}else i===27?(i=It,Gi(s.type)?(s=ag,ag=null,It=s):It=i):It=Cn?kr(s.stateNode.nextSibling):null;return!0}function Ga(){It=Cn=null,at=!1}function Lm(){var s=Ii;return s!==null&&(Zn===null?Zn=s:Zn.push.apply(Zn,s),Ii=null),s}function Mc(s){Ii===null?Ii=[s]:Ii.push(s)}var zm=U(null),Qa=null,Gs=null;function ki(s,i,l){ne(zm,i._currentValue),i._currentValue=l}function Qs(s){s._currentValue=zm.current,H(zm)}function Um(s,i,l){for(;s!==null;){var d=s.alternate;if((s.childLanes&i)!==i?(s.childLanes|=i,d!==null&&(d.childLanes|=i)):d!==null&&(d.childLanes&i)!==i&&(d.childLanes|=i),s===l)break;s=s.return}}function Fm(s,i,l,d){var y=s.child;for(y!==null&&(y.return=s);y!==null;){var b=y.dependencies;if(b!==null){var R=y.child;b=b.firstContext;e:for(;b!==null;){var F=b;b=y;for(var X=0;X<i.length;X++)if(F.context===i[X]){b.lanes|=l,F=b.alternate,F!==null&&(F.lanes|=l),Um(b.return,l,s),d||(R=null);break e}b=F.next}}else if(y.tag===18){if(R=y.return,R===null)throw Error(r(341));R.lanes|=l,b=R.alternate,b!==null&&(b.lanes|=l),Um(R,l,s),R=null}else R=y.child;if(R!==null)R.return=y;else for(R=y;R!==null;){if(R===s){R=null;break}if(y=R.sibling,y!==null){y.return=R.return,R=y;break}R=R.return}y=R}}function Wo(s,i,l,d){s=null;for(var y=i,b=!1;y!==null;){if(!b){if((y.flags&524288)!==0)b=!0;else if((y.flags&262144)!==0)break}if(y.tag===10){var R=y.alternate;if(R===null)throw Error(r(387));if(R=R.memoizedProps,R!==null){var F=y.type;lr(y.pendingProps.value,R.value)||(s!==null?s.push(F):s=[F])}}else if(y===pe.current){if(R=y.alternate,R===null)throw Error(r(387));R.memoizedState.memoizedState!==y.memoizedState.memoizedState&&(s!==null?s.push(iu):s=[iu])}y=y.return}s!==null&&Fm(i,s,l,d),i.flags|=262144}function zd(s){for(s=s.firstContext;s!==null;){if(!lr(s.context._currentValue,s.memoizedValue))return!0;s=s.next}return!1}function Wa(s){Qa=s,Gs=null,s=s.dependencies,s!==null&&(s.firstContext=null)}function Tn(s){return p_(Qa,s)}function Ud(s,i){return Qa===null&&Wa(s),p_(s,i)}function p_(s,i){var l=i._currentValue;if(i={context:i,memoizedValue:l,next:null},Gs===null){if(s===null)throw Error(r(308));Gs=i,s.dependencies={lanes:0,firstContext:i},s.flags|=524288}else Gs=Gs.next=i;return l}var SA=typeof AbortController<"u"?AbortController:function(){var s=[],i=this.signal={aborted:!1,addEventListener:function(l,d){s.push(d)}};this.abort=function(){i.aborted=!0,s.forEach(function(l){return l()})}},wA=t.unstable_scheduleCallback,EA=t.unstable_NormalPriority,tn={$$typeof:M,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Vm(){return{controller:new SA,data:new Map,refCount:0}}function kc(s){s.refCount--,s.refCount===0&&wA(EA,function(){s.controller.abort()})}var Oc=null,$m=0,Ko=0,Yo=null;function CA(s,i){if(Oc===null){var l=Oc=[];$m=0,Ko=Gp(),Yo={status:"pending",value:void 0,then:function(d){l.push(d)}}}return $m++,i.then(g_,g_),i}function g_(){if(--$m===0&&Oc!==null){Yo!==null&&(Yo.status="fulfilled");var s=Oc;Oc=null,Ko=0,Yo=null;for(var i=0;i<s.length;i++)(0,s[i])()}}function TA(s,i){var l=[],d={status:"pending",value:null,reason:null,then:function(y){l.push(y)}};return s.then(function(){d.status="fulfilled",d.value=i;for(var y=0;y<l.length;y++)(0,l[y])(i)},function(y){for(d.status="rejected",d.reason=y,y=0;y<l.length;y++)(0,l[y])(void 0)}),d}var y_=z.S;z.S=function(s,i){ev=dn(),typeof i=="object"&&i!==null&&typeof i.then=="function"&&CA(s,i),y_!==null&&y_(s,i)};var Ka=U(null);function qm(){var s=Ka.current;return s!==null?s:Tt.pooledCache}function Fd(s,i){i===null?ne(Ka,Ka.current):ne(Ka,i.pool)}function __(){var s=qm();return s===null?null:{parent:tn._currentValue,pool:s}}var Xo=Error(r(460)),Hm=Error(r(474)),Vd=Error(r(542)),$d={then:function(){}};function b_(s){return s=s.status,s==="fulfilled"||s==="rejected"}function v_(s,i,l){switch(l=s[l],l===void 0?s.push(i):l!==i&&(i.then(qr,qr),i=l),i.status){case"fulfilled":return i.value;case"rejected":throw s=i.reason,S_(s),s;default:if(typeof i.status=="string")i.then(qr,qr);else{if(s=Tt,s!==null&&100<s.shellSuspendCounter)throw Error(r(482));s=i,s.status="pending",s.then(function(d){if(i.status==="pending"){var y=i;y.status="fulfilled",y.value=d}},function(d){if(i.status==="pending"){var y=i;y.status="rejected",y.reason=d}})}switch(i.status){case"fulfilled":return i.value;case"rejected":throw s=i.reason,S_(s),s}throw Xa=i,Xo}}function Ya(s){try{var i=s._init;return i(s._payload)}catch(l){throw l!==null&&typeof l=="object"&&typeof l.then=="function"?(Xa=l,Xo):l}}var Xa=null;function x_(){if(Xa===null)throw Error(r(459));var s=Xa;return Xa=null,s}function S_(s){if(s===Xo||s===Vd)throw Error(r(483))}var Jo=null,Nc=0;function qd(s){var i=Nc;return Nc+=1,Jo===null&&(Jo=[]),v_(Jo,s,i)}function Pc(s,i){i=i.props.ref,s.ref=i!==void 0?i:null}function Hd(s,i){throw i.$$typeof===v?Error(r(525)):(s=Object.prototype.toString.call(i),Error(r(31,s==="[object Object]"?"object with keys {"+Object.keys(i).join(", ")+"}":s)))}function w_(s){function i(re,te){if(s){var ce=re.deletions;ce===null?(re.deletions=[te],re.flags|=16):ce.push(te)}}function l(re,te){if(!s)return null;for(;te!==null;)i(re,te),te=te.sibling;return null}function d(re){for(var te=new Map;re!==null;)re.key!==null?te.set(re.key,re):te.set(re.index,re),re=re.sibling;return te}function y(re,te){return re=qs(re,te),re.index=0,re.sibling=null,re}function b(re,te,ce){return re.index=ce,s?(ce=re.alternate,ce!==null?(ce=ce.index,ce<te?(re.flags|=67108866,te):ce):(re.flags|=67108866,te)):(re.flags|=1048576,te)}function R(re){return s&&re.alternate===null&&(re.flags|=67108866),re}function F(re,te,ce,ye){return te===null||te.tag!==6?(te=km(ce,re.mode,ye),te.return=re,te):(te=y(te,ce),te.return=re,te)}function X(re,te,ce,ye){var Ne=ce.type;return Ne===E?me(re,te,ce.props.children,ye,ce.key):te!==null&&(te.elementType===Ne||typeof Ne=="object"&&Ne!==null&&Ne.$$typeof===A&&Ya(Ne)===te.type)?(te=y(te,ce.props),Pc(te,ce),te.return=re,te):(te=Bd(ce.type,ce.key,ce.props,null,re.mode,ye),Pc(te,ce),te.return=re,te)}function ue(re,te,ce,ye){return te===null||te.tag!==4||te.stateNode.containerInfo!==ce.containerInfo||te.stateNode.implementation!==ce.implementation?(te=Om(ce,re.mode,ye),te.return=re,te):(te=y(te,ce.children||[]),te.return=re,te)}function me(re,te,ce,ye,Ne){return te===null||te.tag!==7?(te=Ha(ce,re.mode,ye,Ne),te.return=re,te):(te=y(te,ce),te.return=re,te)}function be(re,te,ce){if(typeof te=="string"&&te!==""||typeof te=="number"||typeof te=="bigint")return te=km(""+te,re.mode,ce),te.return=re,te;if(typeof te=="object"&&te!==null){switch(te.$$typeof){case S:return ce=Bd(te.type,te.key,te.props,null,re.mode,ce),Pc(ce,te),ce.return=re,ce;case x:return te=Om(te,re.mode,ce),te.return=re,te;case A:return te=Ya(te),be(re,te,ce)}if(Y(te)||B(te))return te=Ha(te,re.mode,ce,null),te.return=re,te;if(typeof te.then=="function")return be(re,qd(te),ce);if(te.$$typeof===M)return be(re,Ud(re,te),ce);Hd(re,te)}return null}function de(re,te,ce,ye){var Ne=te!==null?te.key:null;if(typeof ce=="string"&&ce!==""||typeof ce=="number"||typeof ce=="bigint")return Ne!==null?null:F(re,te,""+ce,ye);if(typeof ce=="object"&&ce!==null){switch(ce.$$typeof){case S:return ce.key===Ne?X(re,te,ce,ye):null;case x:return ce.key===Ne?ue(re,te,ce,ye):null;case A:return ce=Ya(ce),de(re,te,ce,ye)}if(Y(ce)||B(ce))return Ne!==null?null:me(re,te,ce,ye,null);if(typeof ce.then=="function")return de(re,te,qd(ce),ye);if(ce.$$typeof===M)return de(re,te,Ud(re,ce),ye);Hd(re,ce)}return null}function fe(re,te,ce,ye,Ne){if(typeof ye=="string"&&ye!==""||typeof ye=="number"||typeof ye=="bigint")return re=re.get(ce)||null,F(te,re,""+ye,Ne);if(typeof ye=="object"&&ye!==null){switch(ye.$$typeof){case S:return re=re.get(ye.key===null?ce:ye.key)||null,X(te,re,ye,Ne);case x:return re=re.get(ye.key===null?ce:ye.key)||null,ue(te,re,ye,Ne);case A:return ye=Ya(ye),fe(re,te,ce,ye,Ne)}if(Y(ye)||B(ye))return re=re.get(ce)||null,me(te,re,ye,Ne,null);if(typeof ye.then=="function")return fe(re,te,ce,qd(ye),Ne);if(ye.$$typeof===M)return fe(re,te,ce,Ud(te,ye),Ne);Hd(te,ye)}return null}function Ie(re,te,ce,ye){for(var Ne=null,dt=null,ke=te,Xe=te=0,nt=null;ke!==null&&Xe<ce.length;Xe++){ke.index>Xe?(nt=ke,ke=null):nt=ke.sibling;var ht=de(re,ke,ce[Xe],ye);if(ht===null){ke===null&&(ke=nt);break}s&&ke&&ht.alternate===null&&i(re,ke),te=b(ht,te,Xe),dt===null?Ne=ht:dt.sibling=ht,dt=ht,ke=nt}if(Xe===ce.length)return l(re,ke),at&&Hs(re,Xe),Ne;if(ke===null){for(;Xe<ce.length;Xe++)ke=be(re,ce[Xe],ye),ke!==null&&(te=b(ke,te,Xe),dt===null?Ne=ke:dt.sibling=ke,dt=ke);return at&&Hs(re,Xe),Ne}for(ke=d(ke);Xe<ce.length;Xe++)nt=fe(ke,re,Xe,ce[Xe],ye),nt!==null&&(s&&nt.alternate!==null&&ke.delete(nt.key===null?Xe:nt.key),te=b(nt,te,Xe),dt===null?Ne=nt:dt.sibling=nt,dt=nt);return s&&ke.forEach(function(Xi){return i(re,Xi)}),at&&Hs(re,Xe),Ne}function ze(re,te,ce,ye){if(ce==null)throw Error(r(151));for(var Ne=null,dt=null,ke=te,Xe=te=0,nt=null,ht=ce.next();ke!==null&&!ht.done;Xe++,ht=ce.next()){ke.index>Xe?(nt=ke,ke=null):nt=ke.sibling;var Xi=de(re,ke,ht.value,ye);if(Xi===null){ke===null&&(ke=nt);break}s&&ke&&Xi.alternate===null&&i(re,ke),te=b(Xi,te,Xe),dt===null?Ne=Xi:dt.sibling=Xi,dt=Xi,ke=nt}if(ht.done)return l(re,ke),at&&Hs(re,Xe),Ne;if(ke===null){for(;!ht.done;Xe++,ht=ce.next())ht=be(re,ht.value,ye),ht!==null&&(te=b(ht,te,Xe),dt===null?Ne=ht:dt.sibling=ht,dt=ht);return at&&Hs(re,Xe),Ne}for(ke=d(ke);!ht.done;Xe++,ht=ce.next())ht=fe(ke,re,Xe,ht.value,ye),ht!==null&&(s&&ht.alternate!==null&&ke.delete(ht.key===null?Xe:ht.key),te=b(ht,te,Xe),dt===null?Ne=ht:dt.sibling=ht,dt=ht);return s&&ke.forEach(function(Bj){return i(re,Bj)}),at&&Hs(re,Xe),Ne}function Et(re,te,ce,ye){if(typeof ce=="object"&&ce!==null&&ce.type===E&&ce.key===null&&(ce=ce.props.children),typeof ce=="object"&&ce!==null){switch(ce.$$typeof){case S:e:{for(var Ne=ce.key;te!==null;){if(te.key===Ne){if(Ne=ce.type,Ne===E){if(te.tag===7){l(re,te.sibling),ye=y(te,ce.props.children),ye.return=re,re=ye;break e}}else if(te.elementType===Ne||typeof Ne=="object"&&Ne!==null&&Ne.$$typeof===A&&Ya(Ne)===te.type){l(re,te.sibling),ye=y(te,ce.props),Pc(ye,ce),ye.return=re,re=ye;break e}l(re,te);break}else i(re,te);te=te.sibling}ce.type===E?(ye=Ha(ce.props.children,re.mode,ye,ce.key),ye.return=re,re=ye):(ye=Bd(ce.type,ce.key,ce.props,null,re.mode,ye),Pc(ye,ce),ye.return=re,re=ye)}return R(re);case x:e:{for(Ne=ce.key;te!==null;){if(te.key===Ne)if(te.tag===4&&te.stateNode.containerInfo===ce.containerInfo&&te.stateNode.implementation===ce.implementation){l(re,te.sibling),ye=y(te,ce.children||[]),ye.return=re,re=ye;break e}else{l(re,te);break}else i(re,te);te=te.sibling}ye=Om(ce,re.mode,ye),ye.return=re,re=ye}return R(re);case A:return ce=Ya(ce),Et(re,te,ce,ye)}if(Y(ce))return Ie(re,te,ce,ye);if(B(ce)){if(Ne=B(ce),typeof Ne!="function")throw Error(r(150));return ce=Ne.call(ce),ze(re,te,ce,ye)}if(typeof ce.then=="function")return Et(re,te,qd(ce),ye);if(ce.$$typeof===M)return Et(re,te,Ud(re,ce),ye);Hd(re,ce)}return typeof ce=="string"&&ce!==""||typeof ce=="number"||typeof ce=="bigint"?(ce=""+ce,te!==null&&te.tag===6?(l(re,te.sibling),ye=y(te,ce),ye.return=re,re=ye):(l(re,te),ye=km(ce,re.mode,ye),ye.return=re,re=ye),R(re)):l(re,te)}return function(re,te,ce,ye){try{Nc=0;var Ne=Et(re,te,ce,ye);return Jo=null,Ne}catch(ke){if(ke===Xo||ke===Vd)throw ke;var dt=cr(29,ke,null,re.mode);return dt.lanes=ye,dt.return=re,dt}}}var Ja=w_(!0),E_=w_(!1),Oi=!1;function Gm(s){s.updateQueue={baseState:s.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Qm(s,i){s=s.updateQueue,i.updateQueue===s&&(i.updateQueue={baseState:s.baseState,firstBaseUpdate:s.firstBaseUpdate,lastBaseUpdate:s.lastBaseUpdate,shared:s.shared,callbacks:null})}function Ni(s){return{lane:s,tag:0,payload:null,callback:null,next:null}}function Pi(s,i,l){var d=s.updateQueue;if(d===null)return null;if(d=d.shared,(gt&2)!==0){var y=d.pending;return y===null?i.next=i:(i.next=y.next,y.next=i),d.pending=i,i=Pd(s),o_(s,null,l),i}return Nd(s,d,i,l),Pd(s)}function Bc(s,i,l){if(i=i.updateQueue,i!==null&&(i=i.shared,(l&4194048)!==0)){var d=i.lanes;d&=s.pendingLanes,l|=d,i.lanes=l,uc(s,l)}}function Wm(s,i){var l=s.updateQueue,d=s.alternate;if(d!==null&&(d=d.updateQueue,l===d)){var y=null,b=null;if(l=l.firstBaseUpdate,l!==null){do{var R={lane:l.lane,tag:l.tag,payload:l.payload,callback:null,next:null};b===null?y=b=R:b=b.next=R,l=l.next}while(l!==null);b===null?y=b=i:b=b.next=i}else y=b=i;l={baseState:d.baseState,firstBaseUpdate:y,lastBaseUpdate:b,shared:d.shared,callbacks:d.callbacks},s.updateQueue=l;return}s=l.lastBaseUpdate,s===null?l.firstBaseUpdate=i:s.next=i,l.lastBaseUpdate=i}var Km=!1;function Lc(){if(Km){var s=Yo;if(s!==null)throw s}}function zc(s,i,l,d){Km=!1;var y=s.updateQueue;Oi=!1;var b=y.firstBaseUpdate,R=y.lastBaseUpdate,F=y.shared.pending;if(F!==null){y.shared.pending=null;var X=F,ue=X.next;X.next=null,R===null?b=ue:R.next=ue,R=X;var me=s.alternate;me!==null&&(me=me.updateQueue,F=me.lastBaseUpdate,F!==R&&(F===null?me.firstBaseUpdate=ue:F.next=ue,me.lastBaseUpdate=X))}if(b!==null){var be=y.baseState;R=0,me=ue=X=null,F=b;do{var de=F.lane&-536870913,fe=de!==F.lane;if(fe?(tt&de)===de:(d&de)===de){de!==0&&de===Ko&&(Km=!0),me!==null&&(me=me.next={lane:0,tag:F.tag,payload:F.payload,callback:null,next:null});e:{var Ie=s,ze=F;de=i;var Et=l;switch(ze.tag){case 1:if(Ie=ze.payload,typeof Ie=="function"){be=Ie.call(Et,be,de);break e}be=Ie;break e;case 3:Ie.flags=Ie.flags&-65537|128;case 0:if(Ie=ze.payload,de=typeof Ie=="function"?Ie.call(Et,be,de):Ie,de==null)break e;be=_({},be,de);break e;case 2:Oi=!0}}de=F.callback,de!==null&&(s.flags|=64,fe&&(s.flags|=8192),fe=y.callbacks,fe===null?y.callbacks=[de]:fe.push(de))}else fe={lane:de,tag:F.tag,payload:F.payload,callback:F.callback,next:null},me===null?(ue=me=fe,X=be):me=me.next=fe,R|=de;if(F=F.next,F===null){if(F=y.shared.pending,F===null)break;fe=F,F=fe.next,fe.next=null,y.lastBaseUpdate=fe,y.shared.pending=null}}while(!0);me===null&&(X=be),y.baseState=X,y.firstBaseUpdate=ue,y.lastBaseUpdate=me,b===null&&(y.shared.lanes=0),Fi|=R,s.lanes=R,s.memoizedState=be}}function C_(s,i){if(typeof s!="function")throw Error(r(191,s));s.call(i)}function T_(s,i){var l=s.callbacks;if(l!==null)for(s.callbacks=null,s=0;s<l.length;s++)C_(l[s],i)}var Zo=U(null),Gd=U(0);function A_(s,i){s=ni,ne(Gd,s),ne(Zo,i),ni=s|i.baseLanes}function Ym(){ne(Gd,ni),ne(Zo,Zo.current)}function Xm(){ni=Gd.current,H(Zo),H(Gd)}var ur=U(null),Mr=null;function Bi(s){var i=s.alternate;ne(Qt,Qt.current&1),ne(ur,s),Mr===null&&(i===null||Zo.current!==null||i.memoizedState!==null)&&(Mr=s)}function Jm(s){ne(Qt,Qt.current),ne(ur,s),Mr===null&&(Mr=s)}function j_(s){s.tag===22?(ne(Qt,Qt.current),ne(ur,s),Mr===null&&(Mr=s)):Li()}function Li(){ne(Qt,Qt.current),ne(ur,ur.current)}function dr(s){H(ur),Mr===s&&(Mr=null),H(Qt)}var Qt=U(0);function Qd(s){for(var i=s;i!==null;){if(i.tag===13){var l=i.memoizedState;if(l!==null&&(l=l.dehydrated,l===null||sg(l)||ig(l)))return i}else if(i.tag===19&&(i.memoizedProps.revealOrder==="forwards"||i.memoizedProps.revealOrder==="backwards"||i.memoizedProps.revealOrder==="unstable_legacy-backwards"||i.memoizedProps.revealOrder==="together")){if((i.flags&128)!==0)return i}else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===s)break;for(;i.sibling===null;){if(i.return===null||i.return===s)return null;i=i.return}i.sibling.return=i.return,i=i.sibling}return null}var Ws=0,Ke=null,St=null,nn=null,Wd=!1,el=!1,Za=!1,Kd=0,Uc=0,tl=null,AA=0;function $t(){throw Error(r(321))}function Zm(s,i){if(i===null)return!1;for(var l=0;l<i.length&&l<s.length;l++)if(!lr(s[l],i[l]))return!1;return!0}function ep(s,i,l,d,y,b){return Ws=b,Ke=i,i.memoizedState=null,i.updateQueue=null,i.lanes=0,z.H=s===null||s.memoizedState===null?db:pp,Za=!1,b=l(d,y),Za=!1,el&&(b=D_(i,l,d,y)),R_(s),b}function R_(s){z.H=$c;var i=St!==null&&St.next!==null;if(Ws=0,nn=St=Ke=null,Wd=!1,Uc=0,tl=null,i)throw Error(r(300));s===null||rn||(s=s.dependencies,s!==null&&zd(s)&&(rn=!0))}function D_(s,i,l,d){Ke=s;var y=0;do{if(el&&(tl=null),Uc=0,el=!1,25<=y)throw Error(r(301));if(y+=1,nn=St=null,s.updateQueue!=null){var b=s.updateQueue;b.lastEffect=null,b.events=null,b.stores=null,b.memoCache!=null&&(b.memoCache.index=0)}z.H=hb,b=i(l,d)}while(el);return b}function jA(){var s=z.H,i=s.useState()[0];return i=typeof i.then=="function"?Fc(i):i,s=s.useState()[0],(St!==null?St.memoizedState:null)!==s&&(Ke.flags|=1024),i}function tp(){var s=Kd!==0;return Kd=0,s}function np(s,i,l){i.updateQueue=s.updateQueue,i.flags&=-2053,s.lanes&=~l}function rp(s){if(Wd){for(s=s.memoizedState;s!==null;){var i=s.queue;i!==null&&(i.pending=null),s=s.next}Wd=!1}Ws=0,nn=St=Ke=null,el=!1,Uc=Kd=0,tl=null}function Vn(){var s={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return nn===null?Ke.memoizedState=nn=s:nn=nn.next=s,nn}function Wt(){if(St===null){var s=Ke.alternate;s=s!==null?s.memoizedState:null}else s=St.next;var i=nn===null?Ke.memoizedState:nn.next;if(i!==null)nn=i,St=s;else{if(s===null)throw Ke.alternate===null?Error(r(467)):Error(r(310));St=s,s={memoizedState:St.memoizedState,baseState:St.baseState,baseQueue:St.baseQueue,queue:St.queue,next:null},nn===null?Ke.memoizedState=nn=s:nn=nn.next=s}return nn}function Yd(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Fc(s){var i=Uc;return Uc+=1,tl===null&&(tl=[]),s=v_(tl,s,i),i=Ke,(nn===null?i.memoizedState:nn.next)===null&&(i=i.alternate,z.H=i===null||i.memoizedState===null?db:pp),s}function Xd(s){if(s!==null&&typeof s=="object"){if(typeof s.then=="function")return Fc(s);if(s.$$typeof===M)return Tn(s)}throw Error(r(438,String(s)))}function sp(s){var i=null,l=Ke.updateQueue;if(l!==null&&(i=l.memoCache),i==null){var d=Ke.alternate;d!==null&&(d=d.updateQueue,d!==null&&(d=d.memoCache,d!=null&&(i={data:d.data.map(function(y){return y.slice()}),index:0})))}if(i==null&&(i={data:[],index:0}),l===null&&(l=Yd(),Ke.updateQueue=l),l.memoCache=i,l=i.data[i.index],l===void 0)for(l=i.data[i.index]=Array(s),d=0;d<s;d++)l[d]=L;return i.index++,l}function Ks(s,i){return typeof i=="function"?i(s):i}function Jd(s){var i=Wt();return ip(i,St,s)}function ip(s,i,l){var d=s.queue;if(d===null)throw Error(r(311));d.lastRenderedReducer=l;var y=s.baseQueue,b=d.pending;if(b!==null){if(y!==null){var R=y.next;y.next=b.next,b.next=R}i.baseQueue=y=b,d.pending=null}if(b=s.baseState,y===null)s.memoizedState=b;else{i=y.next;var F=R=null,X=null,ue=i,me=!1;do{var be=ue.lane&-536870913;if(be!==ue.lane?(tt&be)===be:(Ws&be)===be){var de=ue.revertLane;if(de===0)X!==null&&(X=X.next={lane:0,revertLane:0,gesture:null,action:ue.action,hasEagerState:ue.hasEagerState,eagerState:ue.eagerState,next:null}),be===Ko&&(me=!0);else if((Ws&de)===de){ue=ue.next,de===Ko&&(me=!0);continue}else be={lane:0,revertLane:ue.revertLane,gesture:null,action:ue.action,hasEagerState:ue.hasEagerState,eagerState:ue.eagerState,next:null},X===null?(F=X=be,R=b):X=X.next=be,Ke.lanes|=de,Fi|=de;be=ue.action,Za&&l(b,be),b=ue.hasEagerState?ue.eagerState:l(b,be)}else de={lane:be,revertLane:ue.revertLane,gesture:ue.gesture,action:ue.action,hasEagerState:ue.hasEagerState,eagerState:ue.eagerState,next:null},X===null?(F=X=de,R=b):X=X.next=de,Ke.lanes|=be,Fi|=be;ue=ue.next}while(ue!==null&&ue!==i);if(X===null?R=b:X.next=F,!lr(b,s.memoizedState)&&(rn=!0,me&&(l=Yo,l!==null)))throw l;s.memoizedState=b,s.baseState=R,s.baseQueue=X,d.lastRenderedState=b}return y===null&&(d.lanes=0),[s.memoizedState,d.dispatch]}function ap(s){var i=Wt(),l=i.queue;if(l===null)throw Error(r(311));l.lastRenderedReducer=s;var d=l.dispatch,y=l.pending,b=i.memoizedState;if(y!==null){l.pending=null;var R=y=y.next;do b=s(b,R.action),R=R.next;while(R!==y);lr(b,i.memoizedState)||(rn=!0),i.memoizedState=b,i.baseQueue===null&&(i.baseState=b),l.lastRenderedState=b}return[b,d]}function I_(s,i,l){var d=Ke,y=Wt(),b=at;if(b){if(l===void 0)throw Error(r(407));l=l()}else l=i();var R=!lr((St||y).memoizedState,l);if(R&&(y.memoizedState=l,rn=!0),y=y.queue,cp(O_.bind(null,d,y,s),[s]),y.getSnapshot!==i||R||nn!==null&&nn.memoizedState.tag&1){if(d.flags|=2048,nl(9,{destroy:void 0},k_.bind(null,d,y,l,i),null),Tt===null)throw Error(r(349));b||(Ws&127)!==0||M_(d,i,l)}return l}function M_(s,i,l){s.flags|=16384,s={getSnapshot:i,value:l},i=Ke.updateQueue,i===null?(i=Yd(),Ke.updateQueue=i,i.stores=[s]):(l=i.stores,l===null?i.stores=[s]:l.push(s))}function k_(s,i,l,d){i.value=l,i.getSnapshot=d,N_(i)&&P_(s)}function O_(s,i,l){return l(function(){N_(i)&&P_(s)})}function N_(s){var i=s.getSnapshot;s=s.value;try{var l=i();return!lr(s,l)}catch{return!0}}function P_(s){var i=qa(s,2);i!==null&&er(i,s,2)}function op(s){var i=Vn();if(typeof s=="function"){var l=s;if(s=l(),Za){Sr(!0);try{l()}finally{Sr(!1)}}}return i.memoizedState=i.baseState=s,i.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ks,lastRenderedState:s},i}function B_(s,i,l,d){return s.baseState=l,ip(s,St,typeof d=="function"?d:Ks)}function RA(s,i,l,d,y){if(th(s))throw Error(r(485));if(s=i.action,s!==null){var b={payload:y,action:s,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(R){b.listeners.push(R)}};z.T!==null?l(!0):b.isTransition=!1,d(b),l=i.pending,l===null?(b.next=i.pending=b,L_(i,b)):(b.next=l.next,i.pending=l.next=b)}}function L_(s,i){var l=i.action,d=i.payload,y=s.state;if(i.isTransition){var b=z.T,R={};z.T=R;try{var F=l(y,d),X=z.S;X!==null&&X(R,F),z_(s,i,F)}catch(ue){lp(s,i,ue)}finally{b!==null&&R.types!==null&&(b.types=R.types),z.T=b}}else try{b=l(y,d),z_(s,i,b)}catch(ue){lp(s,i,ue)}}function z_(s,i,l){l!==null&&typeof l=="object"&&typeof l.then=="function"?l.then(function(d){U_(s,i,d)},function(d){return lp(s,i,d)}):U_(s,i,l)}function U_(s,i,l){i.status="fulfilled",i.value=l,F_(i),s.state=l,i=s.pending,i!==null&&(l=i.next,l===i?s.pending=null:(l=l.next,i.next=l,L_(s,l)))}function lp(s,i,l){var d=s.pending;if(s.pending=null,d!==null){d=d.next;do i.status="rejected",i.reason=l,F_(i),i=i.next;while(i!==d)}s.action=null}function F_(s){s=s.listeners;for(var i=0;i<s.length;i++)(0,s[i])()}function V_(s,i){return i}function $_(s,i){if(at){var l=Tt.formState;if(l!==null){e:{var d=Ke;if(at){if(It){t:{for(var y=It,b=Ir;y.nodeType!==8;){if(!b){y=null;break t}if(y=kr(y.nextSibling),y===null){y=null;break t}}b=y.data,y=b==="F!"||b==="F"?y:null}if(y){It=kr(y.nextSibling),d=y.data==="F!";break e}}Mi(d)}d=!1}d&&(i=l[0])}}return l=Vn(),l.memoizedState=l.baseState=i,d={pending:null,lanes:0,dispatch:null,lastRenderedReducer:V_,lastRenderedState:i},l.queue=d,l=lb.bind(null,Ke,d),d.dispatch=l,d=op(!1),b=mp.bind(null,Ke,!1,d.queue),d=Vn(),y={state:i,dispatch:null,action:s,pending:null},d.queue=y,l=RA.bind(null,Ke,y,b,l),y.dispatch=l,d.memoizedState=s,[i,l,!1]}function q_(s){var i=Wt();return H_(i,St,s)}function H_(s,i,l){if(i=ip(s,i,V_)[0],s=Jd(Ks)[0],typeof i=="object"&&i!==null&&typeof i.then=="function")try{var d=Fc(i)}catch(R){throw R===Xo?Vd:R}else d=i;i=Wt();var y=i.queue,b=y.dispatch;return l!==i.memoizedState&&(Ke.flags|=2048,nl(9,{destroy:void 0},DA.bind(null,y,l),null)),[d,b,s]}function DA(s,i){s.action=i}function G_(s){var i=Wt(),l=St;if(l!==null)return H_(i,l,s);Wt(),i=i.memoizedState,l=Wt();var d=l.queue.dispatch;return l.memoizedState=s,[i,d,!1]}function nl(s,i,l,d){return s={tag:s,create:l,deps:d,inst:i,next:null},i=Ke.updateQueue,i===null&&(i=Yd(),Ke.updateQueue=i),l=i.lastEffect,l===null?i.lastEffect=s.next=s:(d=l.next,l.next=s,s.next=d,i.lastEffect=s),s}function Q_(){return Wt().memoizedState}function Zd(s,i,l,d){var y=Vn();Ke.flags|=s,y.memoizedState=nl(1|i,{destroy:void 0},l,d===void 0?null:d)}function eh(s,i,l,d){var y=Wt();d=d===void 0?null:d;var b=y.memoizedState.inst;St!==null&&d!==null&&Zm(d,St.memoizedState.deps)?y.memoizedState=nl(i,b,l,d):(Ke.flags|=s,y.memoizedState=nl(1|i,b,l,d))}function W_(s,i){Zd(8390656,8,s,i)}function cp(s,i){eh(2048,8,s,i)}function IA(s){Ke.flags|=4;var i=Ke.updateQueue;if(i===null)i=Yd(),Ke.updateQueue=i,i.events=[s];else{var l=i.events;l===null?i.events=[s]:l.push(s)}}function K_(s){var i=Wt().memoizedState;return IA({ref:i,nextImpl:s}),function(){if((gt&2)!==0)throw Error(r(440));return i.impl.apply(void 0,arguments)}}function Y_(s,i){return eh(4,2,s,i)}function X_(s,i){return eh(4,4,s,i)}function J_(s,i){if(typeof i=="function"){s=s();var l=i(s);return function(){typeof l=="function"?l():i(null)}}if(i!=null)return s=s(),i.current=s,function(){i.current=null}}function Z_(s,i,l){l=l!=null?l.concat([s]):null,eh(4,4,J_.bind(null,i,s),l)}function up(){}function eb(s,i){var l=Wt();i=i===void 0?null:i;var d=l.memoizedState;return i!==null&&Zm(i,d[1])?d[0]:(l.memoizedState=[s,i],s)}function tb(s,i){var l=Wt();i=i===void 0?null:i;var d=l.memoizedState;if(i!==null&&Zm(i,d[1]))return d[0];if(d=s(),Za){Sr(!0);try{s()}finally{Sr(!1)}}return l.memoizedState=[d,i],d}function dp(s,i,l){return l===void 0||(Ws&1073741824)!==0&&(tt&261930)===0?s.memoizedState=i:(s.memoizedState=l,s=nv(),Ke.lanes|=s,Fi|=s,l)}function nb(s,i,l,d){return lr(l,i)?l:Zo.current!==null?(s=dp(s,l,d),lr(s,i)||(rn=!0),s):(Ws&42)===0||(Ws&1073741824)!==0&&(tt&261930)===0?(rn=!0,s.memoizedState=l):(s=nv(),Ke.lanes|=s,Fi|=s,i)}function rb(s,i,l,d,y){var b=V.p;V.p=b!==0&&8>b?b:8;var R=z.T,F={};z.T=F,mp(s,!1,i,l);try{var X=y(),ue=z.S;if(ue!==null&&ue(F,X),X!==null&&typeof X=="object"&&typeof X.then=="function"){var me=TA(X,d);Vc(s,i,me,mr(s))}else Vc(s,i,d,mr(s))}catch(be){Vc(s,i,{then:function(){},status:"rejected",reason:be},mr())}finally{V.p=b,R!==null&&F.types!==null&&(R.types=F.types),z.T=R}}function MA(){}function hp(s,i,l,d){if(s.tag!==5)throw Error(r(476));var y=sb(s).queue;rb(s,y,i,W,l===null?MA:function(){return ib(s),l(d)})}function sb(s){var i=s.memoizedState;if(i!==null)return i;i={memoizedState:W,baseState:W,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ks,lastRenderedState:W},next:null};var l={};return i.next={memoizedState:l,baseState:l,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ks,lastRenderedState:l},next:null},s.memoizedState=i,s=s.alternate,s!==null&&(s.memoizedState=i),i}function ib(s){var i=sb(s);i.next===null&&(i=s.alternate.memoizedState),Vc(s,i.next.queue,{},mr())}function fp(){return Tn(iu)}function ab(){return Wt().memoizedState}function ob(){return Wt().memoizedState}function kA(s){for(var i=s.return;i!==null;){switch(i.tag){case 24:case 3:var l=mr();s=Ni(l);var d=Pi(i,s,l);d!==null&&(er(d,i,l),Bc(d,i,l)),i={cache:Vm()},s.payload=i;return}i=i.return}}function OA(s,i,l){var d=mr();l={lane:d,revertLane:0,gesture:null,action:l,hasEagerState:!1,eagerState:null,next:null},th(s)?cb(i,l):(l=Im(s,i,l,d),l!==null&&(er(l,s,d),ub(l,i,d)))}function lb(s,i,l){var d=mr();Vc(s,i,l,d)}function Vc(s,i,l,d){var y={lane:d,revertLane:0,gesture:null,action:l,hasEagerState:!1,eagerState:null,next:null};if(th(s))cb(i,y);else{var b=s.alternate;if(s.lanes===0&&(b===null||b.lanes===0)&&(b=i.lastRenderedReducer,b!==null))try{var R=i.lastRenderedState,F=b(R,l);if(y.hasEagerState=!0,y.eagerState=F,lr(F,R))return Nd(s,i,y,0),Tt===null&&Od(),!1}catch{}if(l=Im(s,i,y,d),l!==null)return er(l,s,d),ub(l,i,d),!0}return!1}function mp(s,i,l,d){if(d={lane:2,revertLane:Gp(),gesture:null,action:d,hasEagerState:!1,eagerState:null,next:null},th(s)){if(i)throw Error(r(479))}else i=Im(s,l,d,2),i!==null&&er(i,s,2)}function th(s){var i=s.alternate;return s===Ke||i!==null&&i===Ke}function cb(s,i){el=Wd=!0;var l=s.pending;l===null?i.next=i:(i.next=l.next,l.next=i),s.pending=i}function ub(s,i,l){if((l&4194048)!==0){var d=i.lanes;d&=s.pendingLanes,l|=d,i.lanes=l,uc(s,l)}}var $c={readContext:Tn,use:Xd,useCallback:$t,useContext:$t,useEffect:$t,useImperativeHandle:$t,useLayoutEffect:$t,useInsertionEffect:$t,useMemo:$t,useReducer:$t,useRef:$t,useState:$t,useDebugValue:$t,useDeferredValue:$t,useTransition:$t,useSyncExternalStore:$t,useId:$t,useHostTransitionStatus:$t,useFormState:$t,useActionState:$t,useOptimistic:$t,useMemoCache:$t,useCacheRefresh:$t};$c.useEffectEvent=$t;var db={readContext:Tn,use:Xd,useCallback:function(s,i){return Vn().memoizedState=[s,i===void 0?null:i],s},useContext:Tn,useEffect:W_,useImperativeHandle:function(s,i,l){l=l!=null?l.concat([s]):null,Zd(4194308,4,J_.bind(null,i,s),l)},useLayoutEffect:function(s,i){return Zd(4194308,4,s,i)},useInsertionEffect:function(s,i){Zd(4,2,s,i)},useMemo:function(s,i){var l=Vn();i=i===void 0?null:i;var d=s();if(Za){Sr(!0);try{s()}finally{Sr(!1)}}return l.memoizedState=[d,i],d},useReducer:function(s,i,l){var d=Vn();if(l!==void 0){var y=l(i);if(Za){Sr(!0);try{l(i)}finally{Sr(!1)}}}else y=i;return d.memoizedState=d.baseState=y,s={pending:null,lanes:0,dispatch:null,lastRenderedReducer:s,lastRenderedState:y},d.queue=s,s=s.dispatch=OA.bind(null,Ke,s),[d.memoizedState,s]},useRef:function(s){var i=Vn();return s={current:s},i.memoizedState=s},useState:function(s){s=op(s);var i=s.queue,l=lb.bind(null,Ke,i);return i.dispatch=l,[s.memoizedState,l]},useDebugValue:up,useDeferredValue:function(s,i){var l=Vn();return dp(l,s,i)},useTransition:function(){var s=op(!1);return s=rb.bind(null,Ke,s.queue,!0,!1),Vn().memoizedState=s,[!1,s]},useSyncExternalStore:function(s,i,l){var d=Ke,y=Vn();if(at){if(l===void 0)throw Error(r(407));l=l()}else{if(l=i(),Tt===null)throw Error(r(349));(tt&127)!==0||M_(d,i,l)}y.memoizedState=l;var b={value:l,getSnapshot:i};return y.queue=b,W_(O_.bind(null,d,b,s),[s]),d.flags|=2048,nl(9,{destroy:void 0},k_.bind(null,d,b,l,i),null),l},useId:function(){var s=Vn(),i=Tt.identifierPrefix;if(at){var l=Es,d=ws;l=(d&~(1<<32-Ht(d)-1)).toString(32)+l,i="_"+i+"R_"+l,l=Kd++,0<l&&(i+="H"+l.toString(32)),i+="_"}else l=AA++,i="_"+i+"r_"+l.toString(32)+"_";return s.memoizedState=i},useHostTransitionStatus:fp,useFormState:$_,useActionState:$_,useOptimistic:function(s){var i=Vn();i.memoizedState=i.baseState=s;var l={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return i.queue=l,i=mp.bind(null,Ke,!0,l),l.dispatch=i,[s,i]},useMemoCache:sp,useCacheRefresh:function(){return Vn().memoizedState=kA.bind(null,Ke)},useEffectEvent:function(s){var i=Vn(),l={impl:s};return i.memoizedState=l,function(){if((gt&2)!==0)throw Error(r(440));return l.impl.apply(void 0,arguments)}}},pp={readContext:Tn,use:Xd,useCallback:eb,useContext:Tn,useEffect:cp,useImperativeHandle:Z_,useInsertionEffect:Y_,useLayoutEffect:X_,useMemo:tb,useReducer:Jd,useRef:Q_,useState:function(){return Jd(Ks)},useDebugValue:up,useDeferredValue:function(s,i){var l=Wt();return nb(l,St.memoizedState,s,i)},useTransition:function(){var s=Jd(Ks)[0],i=Wt().memoizedState;return[typeof s=="boolean"?s:Fc(s),i]},useSyncExternalStore:I_,useId:ab,useHostTransitionStatus:fp,useFormState:q_,useActionState:q_,useOptimistic:function(s,i){var l=Wt();return B_(l,St,s,i)},useMemoCache:sp,useCacheRefresh:ob};pp.useEffectEvent=K_;var hb={readContext:Tn,use:Xd,useCallback:eb,useContext:Tn,useEffect:cp,useImperativeHandle:Z_,useInsertionEffect:Y_,useLayoutEffect:X_,useMemo:tb,useReducer:ap,useRef:Q_,useState:function(){return ap(Ks)},useDebugValue:up,useDeferredValue:function(s,i){var l=Wt();return St===null?dp(l,s,i):nb(l,St.memoizedState,s,i)},useTransition:function(){var s=ap(Ks)[0],i=Wt().memoizedState;return[typeof s=="boolean"?s:Fc(s),i]},useSyncExternalStore:I_,useId:ab,useHostTransitionStatus:fp,useFormState:G_,useActionState:G_,useOptimistic:function(s,i){var l=Wt();return St!==null?B_(l,St,s,i):(l.baseState=s,[s,l.queue.dispatch])},useMemoCache:sp,useCacheRefresh:ob};hb.useEffectEvent=K_;function gp(s,i,l,d){i=s.memoizedState,l=l(d,i),l=l==null?i:_({},i,l),s.memoizedState=l,s.lanes===0&&(s.updateQueue.baseState=l)}var yp={enqueueSetState:function(s,i,l){s=s._reactInternals;var d=mr(),y=Ni(d);y.payload=i,l!=null&&(y.callback=l),i=Pi(s,y,d),i!==null&&(er(i,s,d),Bc(i,s,d))},enqueueReplaceState:function(s,i,l){s=s._reactInternals;var d=mr(),y=Ni(d);y.tag=1,y.payload=i,l!=null&&(y.callback=l),i=Pi(s,y,d),i!==null&&(er(i,s,d),Bc(i,s,d))},enqueueForceUpdate:function(s,i){s=s._reactInternals;var l=mr(),d=Ni(l);d.tag=2,i!=null&&(d.callback=i),i=Pi(s,d,l),i!==null&&(er(i,s,l),Bc(i,s,l))}};function fb(s,i,l,d,y,b,R){return s=s.stateNode,typeof s.shouldComponentUpdate=="function"?s.shouldComponentUpdate(d,b,R):i.prototype&&i.prototype.isPureReactComponent?!Rc(l,d)||!Rc(y,b):!0}function mb(s,i,l,d){s=i.state,typeof i.componentWillReceiveProps=="function"&&i.componentWillReceiveProps(l,d),typeof i.UNSAFE_componentWillReceiveProps=="function"&&i.UNSAFE_componentWillReceiveProps(l,d),i.state!==s&&yp.enqueueReplaceState(i,i.state,null)}function eo(s,i){var l=i;if("ref"in i){l={};for(var d in i)d!=="ref"&&(l[d]=i[d])}if(s=s.defaultProps){l===i&&(l=_({},l));for(var y in s)l[y]===void 0&&(l[y]=s[y])}return l}function pb(s){kd(s)}function gb(s){console.error(s)}function yb(s){kd(s)}function nh(s,i){try{var l=s.onUncaughtError;l(i.value,{componentStack:i.stack})}catch(d){setTimeout(function(){throw d})}}function _b(s,i,l){try{var d=s.onCaughtError;d(l.value,{componentStack:l.stack,errorBoundary:i.tag===1?i.stateNode:null})}catch(y){setTimeout(function(){throw y})}}function _p(s,i,l){return l=Ni(l),l.tag=3,l.payload={element:null},l.callback=function(){nh(s,i)},l}function bb(s){return s=Ni(s),s.tag=3,s}function vb(s,i,l,d){var y=l.type.getDerivedStateFromError;if(typeof y=="function"){var b=d.value;s.payload=function(){return y(b)},s.callback=function(){_b(i,l,d)}}var R=l.stateNode;R!==null&&typeof R.componentDidCatch=="function"&&(s.callback=function(){_b(i,l,d),typeof y!="function"&&(Vi===null?Vi=new Set([this]):Vi.add(this));var F=d.stack;this.componentDidCatch(d.value,{componentStack:F!==null?F:""})})}function NA(s,i,l,d,y){if(l.flags|=32768,d!==null&&typeof d=="object"&&typeof d.then=="function"){if(i=l.alternate,i!==null&&Wo(i,l,y,!0),l=ur.current,l!==null){switch(l.tag){case 31:case 13:return Mr===null?mh():l.alternate===null&&qt===0&&(qt=3),l.flags&=-257,l.flags|=65536,l.lanes=y,d===$d?l.flags|=16384:(i=l.updateQueue,i===null?l.updateQueue=new Set([d]):i.add(d),$p(s,d,y)),!1;case 22:return l.flags|=65536,d===$d?l.flags|=16384:(i=l.updateQueue,i===null?(i={transitions:null,markerInstances:null,retryQueue:new Set([d])},l.updateQueue=i):(l=i.retryQueue,l===null?i.retryQueue=new Set([d]):l.add(d)),$p(s,d,y)),!1}throw Error(r(435,l.tag))}return $p(s,d,y),mh(),!1}if(at)return i=ur.current,i!==null?((i.flags&65536)===0&&(i.flags|=256),i.flags|=65536,i.lanes=y,d!==Bm&&(s=Error(r(422),{cause:d}),Mc(jr(s,l)))):(d!==Bm&&(i=Error(r(423),{cause:d}),Mc(jr(i,l))),s=s.current.alternate,s.flags|=65536,y&=-y,s.lanes|=y,d=jr(d,l),y=_p(s.stateNode,d,y),Wm(s,y),qt!==4&&(qt=2)),!1;var b=Error(r(520),{cause:d});if(b=jr(b,l),Xc===null?Xc=[b]:Xc.push(b),qt!==4&&(qt=2),i===null)return!0;d=jr(d,l),l=i;do{switch(l.tag){case 3:return l.flags|=65536,s=y&-y,l.lanes|=s,s=_p(l.stateNode,d,s),Wm(l,s),!1;case 1:if(i=l.type,b=l.stateNode,(l.flags&128)===0&&(typeof i.getDerivedStateFromError=="function"||b!==null&&typeof b.componentDidCatch=="function"&&(Vi===null||!Vi.has(b))))return l.flags|=65536,y&=-y,l.lanes|=y,y=bb(y),vb(y,s,l,d),Wm(l,y),!1}l=l.return}while(l!==null);return!1}var bp=Error(r(461)),rn=!1;function An(s,i,l,d){i.child=s===null?E_(i,null,l,d):Ja(i,s.child,l,d)}function xb(s,i,l,d,y){l=l.render;var b=i.ref;if("ref"in d){var R={};for(var F in d)F!=="ref"&&(R[F]=d[F])}else R=d;return Wa(i),d=ep(s,i,l,R,b,y),F=tp(),s!==null&&!rn?(np(s,i,y),Ys(s,i,y)):(at&&F&&Nm(i),i.flags|=1,An(s,i,d,y),i.child)}function Sb(s,i,l,d,y){if(s===null){var b=l.type;return typeof b=="function"&&!Mm(b)&&b.defaultProps===void 0&&l.compare===null?(i.tag=15,i.type=b,wb(s,i,b,d,y)):(s=Bd(l.type,null,d,i,i.mode,y),s.ref=i.ref,s.return=i,i.child=s)}if(b=s.child,!Ap(s,y)){var R=b.memoizedProps;if(l=l.compare,l=l!==null?l:Rc,l(R,d)&&s.ref===i.ref)return Ys(s,i,y)}return i.flags|=1,s=qs(b,d),s.ref=i.ref,s.return=i,i.child=s}function wb(s,i,l,d,y){if(s!==null){var b=s.memoizedProps;if(Rc(b,d)&&s.ref===i.ref)if(rn=!1,i.pendingProps=d=b,Ap(s,y))(s.flags&131072)!==0&&(rn=!0);else return i.lanes=s.lanes,Ys(s,i,y)}return vp(s,i,l,d,y)}function Eb(s,i,l,d){var y=d.children,b=s!==null?s.memoizedState:null;if(s===null&&i.stateNode===null&&(i.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),d.mode==="hidden"){if((i.flags&128)!==0){if(b=b!==null?b.baseLanes|l:l,s!==null){for(d=i.child=s.child,y=0;d!==null;)y=y|d.lanes|d.childLanes,d=d.sibling;d=y&~b}else d=0,i.child=null;return Cb(s,i,b,l,d)}if((l&536870912)!==0)i.memoizedState={baseLanes:0,cachePool:null},s!==null&&Fd(i,b!==null?b.cachePool:null),b!==null?A_(i,b):Ym(),j_(i);else return d=i.lanes=536870912,Cb(s,i,b!==null?b.baseLanes|l:l,l,d)}else b!==null?(Fd(i,b.cachePool),A_(i,b),Li(),i.memoizedState=null):(s!==null&&Fd(i,null),Ym(),Li());return An(s,i,y,l),i.child}function qc(s,i){return s!==null&&s.tag===22||i.stateNode!==null||(i.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),i.sibling}function Cb(s,i,l,d,y){var b=qm();return b=b===null?null:{parent:tn._currentValue,pool:b},i.memoizedState={baseLanes:l,cachePool:b},s!==null&&Fd(i,null),Ym(),j_(i),s!==null&&Wo(s,i,d,!0),i.childLanes=y,null}function rh(s,i){return i=ih({mode:i.mode,children:i.children},s.mode),i.ref=s.ref,s.child=i,i.return=s,i}function Tb(s,i,l){return Ja(i,s.child,null,l),s=rh(i,i.pendingProps),s.flags|=2,dr(i),i.memoizedState=null,s}function PA(s,i,l){var d=i.pendingProps,y=(i.flags&128)!==0;if(i.flags&=-129,s===null){if(at){if(d.mode==="hidden")return s=rh(i,d),i.lanes=536870912,qc(null,s);if(Jm(i),(s=It)?(s=Lv(s,Ir),s=s!==null&&s.data==="&"?s:null,s!==null&&(i.memoizedState={dehydrated:s,treeContext:Di!==null?{id:ws,overflow:Es}:null,retryLane:536870912,hydrationErrors:null},l=c_(s),l.return=i,i.child=l,Cn=i,It=null)):s=null,s===null)throw Mi(i);return i.lanes=536870912,null}return rh(i,d)}var b=s.memoizedState;if(b!==null){var R=b.dehydrated;if(Jm(i),y)if(i.flags&256)i.flags&=-257,i=Tb(s,i,l);else if(i.memoizedState!==null)i.child=s.child,i.flags|=128,i=null;else throw Error(r(558));else if(rn||Wo(s,i,l,!1),y=(l&s.childLanes)!==0,rn||y){if(d=Tt,d!==null&&(R=dc(d,l),R!==0&&R!==b.retryLane))throw b.retryLane=R,qa(s,R),er(d,s,R),bp;mh(),i=Tb(s,i,l)}else s=b.treeContext,It=kr(R.nextSibling),Cn=i,at=!0,Ii=null,Ir=!1,s!==null&&h_(i,s),i=rh(i,d),i.flags|=4096;return i}return s=qs(s.child,{mode:d.mode,children:d.children}),s.ref=i.ref,i.child=s,s.return=i,s}function sh(s,i){var l=i.ref;if(l===null)s!==null&&s.ref!==null&&(i.flags|=4194816);else{if(typeof l!="function"&&typeof l!="object")throw Error(r(284));(s===null||s.ref!==l)&&(i.flags|=4194816)}}function vp(s,i,l,d,y){return Wa(i),l=ep(s,i,l,d,void 0,y),d=tp(),s!==null&&!rn?(np(s,i,y),Ys(s,i,y)):(at&&d&&Nm(i),i.flags|=1,An(s,i,l,y),i.child)}function Ab(s,i,l,d,y,b){return Wa(i),i.updateQueue=null,l=D_(i,d,l,y),R_(s),d=tp(),s!==null&&!rn?(np(s,i,b),Ys(s,i,b)):(at&&d&&Nm(i),i.flags|=1,An(s,i,l,b),i.child)}function jb(s,i,l,d,y){if(Wa(i),i.stateNode===null){var b=qo,R=l.contextType;typeof R=="object"&&R!==null&&(b=Tn(R)),b=new l(d,b),i.memoizedState=b.state!==null&&b.state!==void 0?b.state:null,b.updater=yp,i.stateNode=b,b._reactInternals=i,b=i.stateNode,b.props=d,b.state=i.memoizedState,b.refs={},Gm(i),R=l.contextType,b.context=typeof R=="object"&&R!==null?Tn(R):qo,b.state=i.memoizedState,R=l.getDerivedStateFromProps,typeof R=="function"&&(gp(i,l,R,d),b.state=i.memoizedState),typeof l.getDerivedStateFromProps=="function"||typeof b.getSnapshotBeforeUpdate=="function"||typeof b.UNSAFE_componentWillMount!="function"&&typeof b.componentWillMount!="function"||(R=b.state,typeof b.componentWillMount=="function"&&b.componentWillMount(),typeof b.UNSAFE_componentWillMount=="function"&&b.UNSAFE_componentWillMount(),R!==b.state&&yp.enqueueReplaceState(b,b.state,null),zc(i,d,b,y),Lc(),b.state=i.memoizedState),typeof b.componentDidMount=="function"&&(i.flags|=4194308),d=!0}else if(s===null){b=i.stateNode;var F=i.memoizedProps,X=eo(l,F);b.props=X;var ue=b.context,me=l.contextType;R=qo,typeof me=="object"&&me!==null&&(R=Tn(me));var be=l.getDerivedStateFromProps;me=typeof be=="function"||typeof b.getSnapshotBeforeUpdate=="function",F=i.pendingProps!==F,me||typeof b.UNSAFE_componentWillReceiveProps!="function"&&typeof b.componentWillReceiveProps!="function"||(F||ue!==R)&&mb(i,b,d,R),Oi=!1;var de=i.memoizedState;b.state=de,zc(i,d,b,y),Lc(),ue=i.memoizedState,F||de!==ue||Oi?(typeof be=="function"&&(gp(i,l,be,d),ue=i.memoizedState),(X=Oi||fb(i,l,X,d,de,ue,R))?(me||typeof b.UNSAFE_componentWillMount!="function"&&typeof b.componentWillMount!="function"||(typeof b.componentWillMount=="function"&&b.componentWillMount(),typeof b.UNSAFE_componentWillMount=="function"&&b.UNSAFE_componentWillMount()),typeof b.componentDidMount=="function"&&(i.flags|=4194308)):(typeof b.componentDidMount=="function"&&(i.flags|=4194308),i.memoizedProps=d,i.memoizedState=ue),b.props=d,b.state=ue,b.context=R,d=X):(typeof b.componentDidMount=="function"&&(i.flags|=4194308),d=!1)}else{b=i.stateNode,Qm(s,i),R=i.memoizedProps,me=eo(l,R),b.props=me,be=i.pendingProps,de=b.context,ue=l.contextType,X=qo,typeof ue=="object"&&ue!==null&&(X=Tn(ue)),F=l.getDerivedStateFromProps,(ue=typeof F=="function"||typeof b.getSnapshotBeforeUpdate=="function")||typeof b.UNSAFE_componentWillReceiveProps!="function"&&typeof b.componentWillReceiveProps!="function"||(R!==be||de!==X)&&mb(i,b,d,X),Oi=!1,de=i.memoizedState,b.state=de,zc(i,d,b,y),Lc();var fe=i.memoizedState;R!==be||de!==fe||Oi||s!==null&&s.dependencies!==null&&zd(s.dependencies)?(typeof F=="function"&&(gp(i,l,F,d),fe=i.memoizedState),(me=Oi||fb(i,l,me,d,de,fe,X)||s!==null&&s.dependencies!==null&&zd(s.dependencies))?(ue||typeof b.UNSAFE_componentWillUpdate!="function"&&typeof b.componentWillUpdate!="function"||(typeof b.componentWillUpdate=="function"&&b.componentWillUpdate(d,fe,X),typeof b.UNSAFE_componentWillUpdate=="function"&&b.UNSAFE_componentWillUpdate(d,fe,X)),typeof b.componentDidUpdate=="function"&&(i.flags|=4),typeof b.getSnapshotBeforeUpdate=="function"&&(i.flags|=1024)):(typeof b.componentDidUpdate!="function"||R===s.memoizedProps&&de===s.memoizedState||(i.flags|=4),typeof b.getSnapshotBeforeUpdate!="function"||R===s.memoizedProps&&de===s.memoizedState||(i.flags|=1024),i.memoizedProps=d,i.memoizedState=fe),b.props=d,b.state=fe,b.context=X,d=me):(typeof b.componentDidUpdate!="function"||R===s.memoizedProps&&de===s.memoizedState||(i.flags|=4),typeof b.getSnapshotBeforeUpdate!="function"||R===s.memoizedProps&&de===s.memoizedState||(i.flags|=1024),d=!1)}return b=d,sh(s,i),d=(i.flags&128)!==0,b||d?(b=i.stateNode,l=d&&typeof l.getDerivedStateFromError!="function"?null:b.render(),i.flags|=1,s!==null&&d?(i.child=Ja(i,s.child,null,y),i.child=Ja(i,null,l,y)):An(s,i,l,y),i.memoizedState=b.state,s=i.child):s=Ys(s,i,y),s}function Rb(s,i,l,d){return Ga(),i.flags|=256,An(s,i,l,d),i.child}var xp={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Sp(s){return{baseLanes:s,cachePool:__()}}function wp(s,i,l){return s=s!==null?s.childLanes&~l:0,i&&(s|=fr),s}function Db(s,i,l){var d=i.pendingProps,y=!1,b=(i.flags&128)!==0,R;if((R=b)||(R=s!==null&&s.memoizedState===null?!1:(Qt.current&2)!==0),R&&(y=!0,i.flags&=-129),R=(i.flags&32)!==0,i.flags&=-33,s===null){if(at){if(y?Bi(i):Li(),(s=It)?(s=Lv(s,Ir),s=s!==null&&s.data!=="&"?s:null,s!==null&&(i.memoizedState={dehydrated:s,treeContext:Di!==null?{id:ws,overflow:Es}:null,retryLane:536870912,hydrationErrors:null},l=c_(s),l.return=i,i.child=l,Cn=i,It=null)):s=null,s===null)throw Mi(i);return ig(s)?i.lanes=32:i.lanes=536870912,null}var F=d.children;return d=d.fallback,y?(Li(),y=i.mode,F=ih({mode:"hidden",children:F},y),d=Ha(d,y,l,null),F.return=i,d.return=i,F.sibling=d,i.child=F,d=i.child,d.memoizedState=Sp(l),d.childLanes=wp(s,R,l),i.memoizedState=xp,qc(null,d)):(Bi(i),Ep(i,F))}var X=s.memoizedState;if(X!==null&&(F=X.dehydrated,F!==null)){if(b)i.flags&256?(Bi(i),i.flags&=-257,i=Cp(s,i,l)):i.memoizedState!==null?(Li(),i.child=s.child,i.flags|=128,i=null):(Li(),F=d.fallback,y=i.mode,d=ih({mode:"visible",children:d.children},y),F=Ha(F,y,l,null),F.flags|=2,d.return=i,F.return=i,d.sibling=F,i.child=d,Ja(i,s.child,null,l),d=i.child,d.memoizedState=Sp(l),d.childLanes=wp(s,R,l),i.memoizedState=xp,i=qc(null,d));else if(Bi(i),ig(F)){if(R=F.nextSibling&&F.nextSibling.dataset,R)var ue=R.dgst;R=ue,d=Error(r(419)),d.stack="",d.digest=R,Mc({value:d,source:null,stack:null}),i=Cp(s,i,l)}else if(rn||Wo(s,i,l,!1),R=(l&s.childLanes)!==0,rn||R){if(R=Tt,R!==null&&(d=dc(R,l),d!==0&&d!==X.retryLane))throw X.retryLane=d,qa(s,d),er(R,s,d),bp;sg(F)||mh(),i=Cp(s,i,l)}else sg(F)?(i.flags|=192,i.child=s.child,i=null):(s=X.treeContext,It=kr(F.nextSibling),Cn=i,at=!0,Ii=null,Ir=!1,s!==null&&h_(i,s),i=Ep(i,d.children),i.flags|=4096);return i}return y?(Li(),F=d.fallback,y=i.mode,X=s.child,ue=X.sibling,d=qs(X,{mode:"hidden",children:d.children}),d.subtreeFlags=X.subtreeFlags&65011712,ue!==null?F=qs(ue,F):(F=Ha(F,y,l,null),F.flags|=2),F.return=i,d.return=i,d.sibling=F,i.child=d,qc(null,d),d=i.child,F=s.child.memoizedState,F===null?F=Sp(l):(y=F.cachePool,y!==null?(X=tn._currentValue,y=y.parent!==X?{parent:X,pool:X}:y):y=__(),F={baseLanes:F.baseLanes|l,cachePool:y}),d.memoizedState=F,d.childLanes=wp(s,R,l),i.memoizedState=xp,qc(s.child,d)):(Bi(i),l=s.child,s=l.sibling,l=qs(l,{mode:"visible",children:d.children}),l.return=i,l.sibling=null,s!==null&&(R=i.deletions,R===null?(i.deletions=[s],i.flags|=16):R.push(s)),i.child=l,i.memoizedState=null,l)}function Ep(s,i){return i=ih({mode:"visible",children:i},s.mode),i.return=s,s.child=i}function ih(s,i){return s=cr(22,s,null,i),s.lanes=0,s}function Cp(s,i,l){return Ja(i,s.child,null,l),s=Ep(i,i.pendingProps.children),s.flags|=2,i.memoizedState=null,s}function Ib(s,i,l){s.lanes|=i;var d=s.alternate;d!==null&&(d.lanes|=i),Um(s.return,i,l)}function Tp(s,i,l,d,y,b){var R=s.memoizedState;R===null?s.memoizedState={isBackwards:i,rendering:null,renderingStartTime:0,last:d,tail:l,tailMode:y,treeForkCount:b}:(R.isBackwards=i,R.rendering=null,R.renderingStartTime=0,R.last=d,R.tail=l,R.tailMode=y,R.treeForkCount=b)}function Mb(s,i,l){var d=i.pendingProps,y=d.revealOrder,b=d.tail;d=d.children;var R=Qt.current,F=(R&2)!==0;if(F?(R=R&1|2,i.flags|=128):R&=1,ne(Qt,R),An(s,i,d,l),d=at?Ic:0,!F&&s!==null&&(s.flags&128)!==0)e:for(s=i.child;s!==null;){if(s.tag===13)s.memoizedState!==null&&Ib(s,l,i);else if(s.tag===19)Ib(s,l,i);else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===i)break e;for(;s.sibling===null;){if(s.return===null||s.return===i)break e;s=s.return}s.sibling.return=s.return,s=s.sibling}switch(y){case"forwards":for(l=i.child,y=null;l!==null;)s=l.alternate,s!==null&&Qd(s)===null&&(y=l),l=l.sibling;l=y,l===null?(y=i.child,i.child=null):(y=l.sibling,l.sibling=null),Tp(i,!1,y,l,b,d);break;case"backwards":case"unstable_legacy-backwards":for(l=null,y=i.child,i.child=null;y!==null;){if(s=y.alternate,s!==null&&Qd(s)===null){i.child=y;break}s=y.sibling,y.sibling=l,l=y,y=s}Tp(i,!0,l,null,b,d);break;case"together":Tp(i,!1,null,null,void 0,d);break;default:i.memoizedState=null}return i.child}function Ys(s,i,l){if(s!==null&&(i.dependencies=s.dependencies),Fi|=i.lanes,(l&i.childLanes)===0)if(s!==null){if(Wo(s,i,l,!1),(l&i.childLanes)===0)return null}else return null;if(s!==null&&i.child!==s.child)throw Error(r(153));if(i.child!==null){for(s=i.child,l=qs(s,s.pendingProps),i.child=l,l.return=i;s.sibling!==null;)s=s.sibling,l=l.sibling=qs(s,s.pendingProps),l.return=i;l.sibling=null}return i.child}function Ap(s,i){return(s.lanes&i)!==0?!0:(s=s.dependencies,!!(s!==null&&zd(s)))}function BA(s,i,l){switch(i.tag){case 3:Ee(i,i.stateNode.containerInfo),ki(i,tn,s.memoizedState.cache),Ga();break;case 27:case 5:J(i);break;case 4:Ee(i,i.stateNode.containerInfo);break;case 10:ki(i,i.type,i.memoizedProps.value);break;case 31:if(i.memoizedState!==null)return i.flags|=128,Jm(i),null;break;case 13:var d=i.memoizedState;if(d!==null)return d.dehydrated!==null?(Bi(i),i.flags|=128,null):(l&i.child.childLanes)!==0?Db(s,i,l):(Bi(i),s=Ys(s,i,l),s!==null?s.sibling:null);Bi(i);break;case 19:var y=(s.flags&128)!==0;if(d=(l&i.childLanes)!==0,d||(Wo(s,i,l,!1),d=(l&i.childLanes)!==0),y){if(d)return Mb(s,i,l);i.flags|=128}if(y=i.memoizedState,y!==null&&(y.rendering=null,y.tail=null,y.lastEffect=null),ne(Qt,Qt.current),d)break;return null;case 22:return i.lanes=0,Eb(s,i,l,i.pendingProps);case 24:ki(i,tn,s.memoizedState.cache)}return Ys(s,i,l)}function kb(s,i,l){if(s!==null)if(s.memoizedProps!==i.pendingProps)rn=!0;else{if(!Ap(s,l)&&(i.flags&128)===0)return rn=!1,BA(s,i,l);rn=(s.flags&131072)!==0}else rn=!1,at&&(i.flags&1048576)!==0&&d_(i,Ic,i.index);switch(i.lanes=0,i.tag){case 16:e:{var d=i.pendingProps;if(s=Ya(i.elementType),i.type=s,typeof s=="function")Mm(s)?(d=eo(s,d),i.tag=1,i=jb(null,i,s,d,l)):(i.tag=0,i=vp(null,i,s,d,l));else{if(s!=null){var y=s.$$typeof;if(y===Q){i.tag=11,i=xb(null,i,s,d,l);break e}else if(y===D){i.tag=14,i=Sb(null,i,s,d,l);break e}}throw i=K(s)||s,Error(r(306,i,""))}}return i;case 0:return vp(s,i,i.type,i.pendingProps,l);case 1:return d=i.type,y=eo(d,i.pendingProps),jb(s,i,d,y,l);case 3:e:{if(Ee(i,i.stateNode.containerInfo),s===null)throw Error(r(387));d=i.pendingProps;var b=i.memoizedState;y=b.element,Qm(s,i),zc(i,d,null,l);var R=i.memoizedState;if(d=R.cache,ki(i,tn,d),d!==b.cache&&Fm(i,[tn],l,!0),Lc(),d=R.element,b.isDehydrated)if(b={element:d,isDehydrated:!1,cache:R.cache},i.updateQueue.baseState=b,i.memoizedState=b,i.flags&256){i=Rb(s,i,d,l);break e}else if(d!==y){y=jr(Error(r(424)),i),Mc(y),i=Rb(s,i,d,l);break e}else for(s=i.stateNode.containerInfo,s.nodeType===9?s=s.body:s=s.nodeName==="HTML"?s.ownerDocument.body:s,It=kr(s.firstChild),Cn=i,at=!0,Ii=null,Ir=!0,l=E_(i,null,d,l),i.child=l;l;)l.flags=l.flags&-3|4096,l=l.sibling;else{if(Ga(),d===y){i=Ys(s,i,l);break e}An(s,i,d,l)}i=i.child}return i;case 26:return sh(s,i),s===null?(l=qv(i.type,null,i.pendingProps,null))?i.memoizedState=l:at||(l=i.type,s=i.pendingProps,d=xh(le.current).createElement(l),d[Jt]=i,d[_n]=s,jn(d,l,s),Zt(d),i.stateNode=d):i.memoizedState=qv(i.type,s.memoizedProps,i.pendingProps,s.memoizedState),null;case 27:return J(i),s===null&&at&&(d=i.stateNode=Fv(i.type,i.pendingProps,le.current),Cn=i,Ir=!0,y=It,Gi(i.type)?(ag=y,It=kr(d.firstChild)):It=y),An(s,i,i.pendingProps.children,l),sh(s,i),s===null&&(i.flags|=4194304),i.child;case 5:return s===null&&at&&((y=d=It)&&(d=fj(d,i.type,i.pendingProps,Ir),d!==null?(i.stateNode=d,Cn=i,It=kr(d.firstChild),Ir=!1,y=!0):y=!1),y||Mi(i)),J(i),y=i.type,b=i.pendingProps,R=s!==null?s.memoizedProps:null,d=b.children,tg(y,b)?d=null:R!==null&&tg(y,R)&&(i.flags|=32),i.memoizedState!==null&&(y=ep(s,i,jA,null,null,l),iu._currentValue=y),sh(s,i),An(s,i,d,l),i.child;case 6:return s===null&&at&&((s=l=It)&&(l=mj(l,i.pendingProps,Ir),l!==null?(i.stateNode=l,Cn=i,It=null,s=!0):s=!1),s||Mi(i)),null;case 13:return Db(s,i,l);case 4:return Ee(i,i.stateNode.containerInfo),d=i.pendingProps,s===null?i.child=Ja(i,null,d,l):An(s,i,d,l),i.child;case 11:return xb(s,i,i.type,i.pendingProps,l);case 7:return An(s,i,i.pendingProps,l),i.child;case 8:return An(s,i,i.pendingProps.children,l),i.child;case 12:return An(s,i,i.pendingProps.children,l),i.child;case 10:return d=i.pendingProps,ki(i,i.type,d.value),An(s,i,d.children,l),i.child;case 9:return y=i.type._context,d=i.pendingProps.children,Wa(i),y=Tn(y),d=d(y),i.flags|=1,An(s,i,d,l),i.child;case 14:return Sb(s,i,i.type,i.pendingProps,l);case 15:return wb(s,i,i.type,i.pendingProps,l);case 19:return Mb(s,i,l);case 31:return PA(s,i,l);case 22:return Eb(s,i,l,i.pendingProps);case 24:return Wa(i),d=Tn(tn),s===null?(y=qm(),y===null&&(y=Tt,b=Vm(),y.pooledCache=b,b.refCount++,b!==null&&(y.pooledCacheLanes|=l),y=b),i.memoizedState={parent:d,cache:y},Gm(i),ki(i,tn,y)):((s.lanes&l)!==0&&(Qm(s,i),zc(i,null,null,l),Lc()),y=s.memoizedState,b=i.memoizedState,y.parent!==d?(y={parent:d,cache:d},i.memoizedState=y,i.lanes===0&&(i.memoizedState=i.updateQueue.baseState=y),ki(i,tn,d)):(d=b.cache,ki(i,tn,d),d!==y.cache&&Fm(i,[tn],l,!0))),An(s,i,i.pendingProps.children,l),i.child;case 29:throw i.pendingProps}throw Error(r(156,i.tag))}function Xs(s){s.flags|=4}function jp(s,i,l,d,y){if((i=(s.mode&32)!==0)&&(i=!1),i){if(s.flags|=16777216,(y&335544128)===y)if(s.stateNode.complete)s.flags|=8192;else if(av())s.flags|=8192;else throw Xa=$d,Hm}else s.flags&=-16777217}function Ob(s,i){if(i.type!=="stylesheet"||(i.state.loading&4)!==0)s.flags&=-16777217;else if(s.flags|=16777216,!Kv(i))if(av())s.flags|=8192;else throw Xa=$d,Hm}function ah(s,i){i!==null&&(s.flags|=4),s.flags&16384&&(i=s.tag!==22?hd():536870912,s.lanes|=i,al|=i)}function Hc(s,i){if(!at)switch(s.tailMode){case"hidden":i=s.tail;for(var l=null;i!==null;)i.alternate!==null&&(l=i),i=i.sibling;l===null?s.tail=null:l.sibling=null;break;case"collapsed":l=s.tail;for(var d=null;l!==null;)l.alternate!==null&&(d=l),l=l.sibling;d===null?i||s.tail===null?s.tail=null:s.tail.sibling=null:d.sibling=null}}function Mt(s){var i=s.alternate!==null&&s.alternate.child===s.child,l=0,d=0;if(i)for(var y=s.child;y!==null;)l|=y.lanes|y.childLanes,d|=y.subtreeFlags&65011712,d|=y.flags&65011712,y.return=s,y=y.sibling;else for(y=s.child;y!==null;)l|=y.lanes|y.childLanes,d|=y.subtreeFlags,d|=y.flags,y.return=s,y=y.sibling;return s.subtreeFlags|=d,s.childLanes=l,i}function LA(s,i,l){var d=i.pendingProps;switch(Pm(i),i.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Mt(i),null;case 1:return Mt(i),null;case 3:return l=i.stateNode,d=null,s!==null&&(d=s.memoizedState.cache),i.memoizedState.cache!==d&&(i.flags|=2048),Qs(tn),ge(),l.pendingContext&&(l.context=l.pendingContext,l.pendingContext=null),(s===null||s.child===null)&&(Qo(i)?Xs(i):s===null||s.memoizedState.isDehydrated&&(i.flags&256)===0||(i.flags|=1024,Lm())),Mt(i),null;case 26:var y=i.type,b=i.memoizedState;return s===null?(Xs(i),b!==null?(Mt(i),Ob(i,b)):(Mt(i),jp(i,y,null,d,l))):b?b!==s.memoizedState?(Xs(i),Mt(i),Ob(i,b)):(Mt(i),i.flags&=-16777217):(s=s.memoizedProps,s!==d&&Xs(i),Mt(i),jp(i,y,s,d,l)),null;case 27:if(Se(i),l=le.current,y=i.type,s!==null&&i.stateNode!=null)s.memoizedProps!==d&&Xs(i);else{if(!d){if(i.stateNode===null)throw Error(r(166));return Mt(i),null}s=se.current,Qo(i)?f_(i):(s=Fv(y,d,l),i.stateNode=s,Xs(i))}return Mt(i),null;case 5:if(Se(i),y=i.type,s!==null&&i.stateNode!=null)s.memoizedProps!==d&&Xs(i);else{if(!d){if(i.stateNode===null)throw Error(r(166));return Mt(i),null}if(b=se.current,Qo(i))f_(i);else{var R=xh(le.current);switch(b){case 1:b=R.createElementNS("http://www.w3.org/2000/svg",y);break;case 2:b=R.createElementNS("http://www.w3.org/1998/Math/MathML",y);break;default:switch(y){case"svg":b=R.createElementNS("http://www.w3.org/2000/svg",y);break;case"math":b=R.createElementNS("http://www.w3.org/1998/Math/MathML",y);break;case"script":b=R.createElement("div"),b.innerHTML="<script><\/script>",b=b.removeChild(b.firstChild);break;case"select":b=typeof d.is=="string"?R.createElement("select",{is:d.is}):R.createElement("select"),d.multiple?b.multiple=!0:d.size&&(b.size=d.size);break;default:b=typeof d.is=="string"?R.createElement(y,{is:d.is}):R.createElement(y)}}b[Jt]=i,b[_n]=d;e:for(R=i.child;R!==null;){if(R.tag===5||R.tag===6)b.appendChild(R.stateNode);else if(R.tag!==4&&R.tag!==27&&R.child!==null){R.child.return=R,R=R.child;continue}if(R===i)break e;for(;R.sibling===null;){if(R.return===null||R.return===i)break e;R=R.return}R.sibling.return=R.return,R=R.sibling}i.stateNode=b;e:switch(jn(b,y,d),y){case"button":case"input":case"select":case"textarea":d=!!d.autoFocus;break e;case"img":d=!0;break e;default:d=!1}d&&Xs(i)}}return Mt(i),jp(i,i.type,s===null?null:s.memoizedProps,i.pendingProps,l),null;case 6:if(s&&i.stateNode!=null)s.memoizedProps!==d&&Xs(i);else{if(typeof d!="string"&&i.stateNode===null)throw Error(r(166));if(s=le.current,Qo(i)){if(s=i.stateNode,l=i.memoizedProps,d=null,y=Cn,y!==null)switch(y.tag){case 27:case 5:d=y.memoizedProps}s[Jt]=i,s=!!(s.nodeValue===l||d!==null&&d.suppressHydrationWarning===!0||Dv(s.nodeValue,l)),s||Mi(i,!0)}else s=xh(s).createTextNode(d),s[Jt]=i,i.stateNode=s}return Mt(i),null;case 31:if(l=i.memoizedState,s===null||s.memoizedState!==null){if(d=Qo(i),l!==null){if(s===null){if(!d)throw Error(r(318));if(s=i.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(r(557));s[Jt]=i}else Ga(),(i.flags&128)===0&&(i.memoizedState=null),i.flags|=4;Mt(i),s=!1}else l=Lm(),s!==null&&s.memoizedState!==null&&(s.memoizedState.hydrationErrors=l),s=!0;if(!s)return i.flags&256?(dr(i),i):(dr(i),null);if((i.flags&128)!==0)throw Error(r(558))}return Mt(i),null;case 13:if(d=i.memoizedState,s===null||s.memoizedState!==null&&s.memoizedState.dehydrated!==null){if(y=Qo(i),d!==null&&d.dehydrated!==null){if(s===null){if(!y)throw Error(r(318));if(y=i.memoizedState,y=y!==null?y.dehydrated:null,!y)throw Error(r(317));y[Jt]=i}else Ga(),(i.flags&128)===0&&(i.memoizedState=null),i.flags|=4;Mt(i),y=!1}else y=Lm(),s!==null&&s.memoizedState!==null&&(s.memoizedState.hydrationErrors=y),y=!0;if(!y)return i.flags&256?(dr(i),i):(dr(i),null)}return dr(i),(i.flags&128)!==0?(i.lanes=l,i):(l=d!==null,s=s!==null&&s.memoizedState!==null,l&&(d=i.child,y=null,d.alternate!==null&&d.alternate.memoizedState!==null&&d.alternate.memoizedState.cachePool!==null&&(y=d.alternate.memoizedState.cachePool.pool),b=null,d.memoizedState!==null&&d.memoizedState.cachePool!==null&&(b=d.memoizedState.cachePool.pool),b!==y&&(d.flags|=2048)),l!==s&&l&&(i.child.flags|=8192),ah(i,i.updateQueue),Mt(i),null);case 4:return ge(),s===null&&Yp(i.stateNode.containerInfo),Mt(i),null;case 10:return Qs(i.type),Mt(i),null;case 19:if(H(Qt),d=i.memoizedState,d===null)return Mt(i),null;if(y=(i.flags&128)!==0,b=d.rendering,b===null)if(y)Hc(d,!1);else{if(qt!==0||s!==null&&(s.flags&128)!==0)for(s=i.child;s!==null;){if(b=Qd(s),b!==null){for(i.flags|=128,Hc(d,!1),s=b.updateQueue,i.updateQueue=s,ah(i,s),i.subtreeFlags=0,s=l,l=i.child;l!==null;)l_(l,s),l=l.sibling;return ne(Qt,Qt.current&1|2),at&&Hs(i,d.treeForkCount),i.child}s=s.sibling}d.tail!==null&&dn()>dh&&(i.flags|=128,y=!0,Hc(d,!1),i.lanes=4194304)}else{if(!y)if(s=Qd(b),s!==null){if(i.flags|=128,y=!0,s=s.updateQueue,i.updateQueue=s,ah(i,s),Hc(d,!0),d.tail===null&&d.tailMode==="hidden"&&!b.alternate&&!at)return Mt(i),null}else 2*dn()-d.renderingStartTime>dh&&l!==536870912&&(i.flags|=128,y=!0,Hc(d,!1),i.lanes=4194304);d.isBackwards?(b.sibling=i.child,i.child=b):(s=d.last,s!==null?s.sibling=b:i.child=b,d.last=b)}return d.tail!==null?(s=d.tail,d.rendering=s,d.tail=s.sibling,d.renderingStartTime=dn(),s.sibling=null,l=Qt.current,ne(Qt,y?l&1|2:l&1),at&&Hs(i,d.treeForkCount),s):(Mt(i),null);case 22:case 23:return dr(i),Xm(),d=i.memoizedState!==null,s!==null?s.memoizedState!==null!==d&&(i.flags|=8192):d&&(i.flags|=8192),d?(l&536870912)!==0&&(i.flags&128)===0&&(Mt(i),i.subtreeFlags&6&&(i.flags|=8192)):Mt(i),l=i.updateQueue,l!==null&&ah(i,l.retryQueue),l=null,s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(l=s.memoizedState.cachePool.pool),d=null,i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(d=i.memoizedState.cachePool.pool),d!==l&&(i.flags|=2048),s!==null&&H(Ka),null;case 24:return l=null,s!==null&&(l=s.memoizedState.cache),i.memoizedState.cache!==l&&(i.flags|=2048),Qs(tn),Mt(i),null;case 25:return null;case 30:return null}throw Error(r(156,i.tag))}function zA(s,i){switch(Pm(i),i.tag){case 1:return s=i.flags,s&65536?(i.flags=s&-65537|128,i):null;case 3:return Qs(tn),ge(),s=i.flags,(s&65536)!==0&&(s&128)===0?(i.flags=s&-65537|128,i):null;case 26:case 27:case 5:return Se(i),null;case 31:if(i.memoizedState!==null){if(dr(i),i.alternate===null)throw Error(r(340));Ga()}return s=i.flags,s&65536?(i.flags=s&-65537|128,i):null;case 13:if(dr(i),s=i.memoizedState,s!==null&&s.dehydrated!==null){if(i.alternate===null)throw Error(r(340));Ga()}return s=i.flags,s&65536?(i.flags=s&-65537|128,i):null;case 19:return H(Qt),null;case 4:return ge(),null;case 10:return Qs(i.type),null;case 22:case 23:return dr(i),Xm(),s!==null&&H(Ka),s=i.flags,s&65536?(i.flags=s&-65537|128,i):null;case 24:return Qs(tn),null;case 25:return null;default:return null}}function Nb(s,i){switch(Pm(i),i.tag){case 3:Qs(tn),ge();break;case 26:case 27:case 5:Se(i);break;case 4:ge();break;case 31:i.memoizedState!==null&&dr(i);break;case 13:dr(i);break;case 19:H(Qt);break;case 10:Qs(i.type);break;case 22:case 23:dr(i),Xm(),s!==null&&H(Ka);break;case 24:Qs(tn)}}function Gc(s,i){try{var l=i.updateQueue,d=l!==null?l.lastEffect:null;if(d!==null){var y=d.next;l=y;do{if((l.tag&s)===s){d=void 0;var b=l.create,R=l.inst;d=b(),R.destroy=d}l=l.next}while(l!==y)}}catch(F){vt(i,i.return,F)}}function zi(s,i,l){try{var d=i.updateQueue,y=d!==null?d.lastEffect:null;if(y!==null){var b=y.next;d=b;do{if((d.tag&s)===s){var R=d.inst,F=R.destroy;if(F!==void 0){R.destroy=void 0,y=i;var X=l,ue=F;try{ue()}catch(me){vt(y,X,me)}}}d=d.next}while(d!==b)}}catch(me){vt(i,i.return,me)}}function Pb(s){var i=s.updateQueue;if(i!==null){var l=s.stateNode;try{T_(i,l)}catch(d){vt(s,s.return,d)}}}function Bb(s,i,l){l.props=eo(s.type,s.memoizedProps),l.state=s.memoizedState;try{l.componentWillUnmount()}catch(d){vt(s,i,d)}}function Qc(s,i){try{var l=s.ref;if(l!==null){switch(s.tag){case 26:case 27:case 5:var d=s.stateNode;break;case 30:d=s.stateNode;break;default:d=s.stateNode}typeof l=="function"?s.refCleanup=l(d):l.current=d}}catch(y){vt(s,i,y)}}function Cs(s,i){var l=s.ref,d=s.refCleanup;if(l!==null)if(typeof d=="function")try{d()}catch(y){vt(s,i,y)}finally{s.refCleanup=null,s=s.alternate,s!=null&&(s.refCleanup=null)}else if(typeof l=="function")try{l(null)}catch(y){vt(s,i,y)}else l.current=null}function Lb(s){var i=s.type,l=s.memoizedProps,d=s.stateNode;try{e:switch(i){case"button":case"input":case"select":case"textarea":l.autoFocus&&d.focus();break e;case"img":l.src?d.src=l.src:l.srcSet&&(d.srcset=l.srcSet)}}catch(y){vt(s,s.return,y)}}function Rp(s,i,l){try{var d=s.stateNode;oj(d,s.type,l,i),d[_n]=i}catch(y){vt(s,s.return,y)}}function zb(s){return s.tag===5||s.tag===3||s.tag===26||s.tag===27&&Gi(s.type)||s.tag===4}function Dp(s){e:for(;;){for(;s.sibling===null;){if(s.return===null||zb(s.return))return null;s=s.return}for(s.sibling.return=s.return,s=s.sibling;s.tag!==5&&s.tag!==6&&s.tag!==18;){if(s.tag===27&&Gi(s.type)||s.flags&2||s.child===null||s.tag===4)continue e;s.child.return=s,s=s.child}if(!(s.flags&2))return s.stateNode}}function Ip(s,i,l){var d=s.tag;if(d===5||d===6)s=s.stateNode,i?(l.nodeType===9?l.body:l.nodeName==="HTML"?l.ownerDocument.body:l).insertBefore(s,i):(i=l.nodeType===9?l.body:l.nodeName==="HTML"?l.ownerDocument.body:l,i.appendChild(s),l=l._reactRootContainer,l!=null||i.onclick!==null||(i.onclick=qr));else if(d!==4&&(d===27&&Gi(s.type)&&(l=s.stateNode,i=null),s=s.child,s!==null))for(Ip(s,i,l),s=s.sibling;s!==null;)Ip(s,i,l),s=s.sibling}function oh(s,i,l){var d=s.tag;if(d===5||d===6)s=s.stateNode,i?l.insertBefore(s,i):l.appendChild(s);else if(d!==4&&(d===27&&Gi(s.type)&&(l=s.stateNode),s=s.child,s!==null))for(oh(s,i,l),s=s.sibling;s!==null;)oh(s,i,l),s=s.sibling}function Ub(s){var i=s.stateNode,l=s.memoizedProps;try{for(var d=s.type,y=i.attributes;y.length;)i.removeAttributeNode(y[0]);jn(i,d,l),i[Jt]=s,i[_n]=l}catch(b){vt(s,s.return,b)}}var Js=!1,sn=!1,Mp=!1,Fb=typeof WeakSet=="function"?WeakSet:Set,vn=null;function UA(s,i){if(s=s.containerInfo,Zp=jh,s=Z0(s),Cm(s)){if("selectionStart"in s)var l={start:s.selectionStart,end:s.selectionEnd};else e:{l=(l=s.ownerDocument)&&l.defaultView||window;var d=l.getSelection&&l.getSelection();if(d&&d.rangeCount!==0){l=d.anchorNode;var y=d.anchorOffset,b=d.focusNode;d=d.focusOffset;try{l.nodeType,b.nodeType}catch{l=null;break e}var R=0,F=-1,X=-1,ue=0,me=0,be=s,de=null;t:for(;;){for(var fe;be!==l||y!==0&&be.nodeType!==3||(F=R+y),be!==b||d!==0&&be.nodeType!==3||(X=R+d),be.nodeType===3&&(R+=be.nodeValue.length),(fe=be.firstChild)!==null;)de=be,be=fe;for(;;){if(be===s)break t;if(de===l&&++ue===y&&(F=R),de===b&&++me===d&&(X=R),(fe=be.nextSibling)!==null)break;be=de,de=be.parentNode}be=fe}l=F===-1||X===-1?null:{start:F,end:X}}else l=null}l=l||{start:0,end:0}}else l=null;for(eg={focusedElem:s,selectionRange:l},jh=!1,vn=i;vn!==null;)if(i=vn,s=i.child,(i.subtreeFlags&1028)!==0&&s!==null)s.return=i,vn=s;else for(;vn!==null;){switch(i=vn,b=i.alternate,s=i.flags,i.tag){case 0:if((s&4)!==0&&(s=i.updateQueue,s=s!==null?s.events:null,s!==null))for(l=0;l<s.length;l++)y=s[l],y.ref.impl=y.nextImpl;break;case 11:case 15:break;case 1:if((s&1024)!==0&&b!==null){s=void 0,l=i,y=b.memoizedProps,b=b.memoizedState,d=l.stateNode;try{var Ie=eo(l.type,y);s=d.getSnapshotBeforeUpdate(Ie,b),d.__reactInternalSnapshotBeforeUpdate=s}catch(ze){vt(l,l.return,ze)}}break;case 3:if((s&1024)!==0){if(s=i.stateNode.containerInfo,l=s.nodeType,l===9)rg(s);else if(l===1)switch(s.nodeName){case"HEAD":case"HTML":case"BODY":rg(s);break;default:s.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((s&1024)!==0)throw Error(r(163))}if(s=i.sibling,s!==null){s.return=i.return,vn=s;break}vn=i.return}}function Vb(s,i,l){var d=l.flags;switch(l.tag){case 0:case 11:case 15:ei(s,l),d&4&&Gc(5,l);break;case 1:if(ei(s,l),d&4)if(s=l.stateNode,i===null)try{s.componentDidMount()}catch(R){vt(l,l.return,R)}else{var y=eo(l.type,i.memoizedProps);i=i.memoizedState;try{s.componentDidUpdate(y,i,s.__reactInternalSnapshotBeforeUpdate)}catch(R){vt(l,l.return,R)}}d&64&&Pb(l),d&512&&Qc(l,l.return);break;case 3:if(ei(s,l),d&64&&(s=l.updateQueue,s!==null)){if(i=null,l.child!==null)switch(l.child.tag){case 27:case 5:i=l.child.stateNode;break;case 1:i=l.child.stateNode}try{T_(s,i)}catch(R){vt(l,l.return,R)}}break;case 27:i===null&&d&4&&Ub(l);case 26:case 5:ei(s,l),i===null&&d&4&&Lb(l),d&512&&Qc(l,l.return);break;case 12:ei(s,l);break;case 31:ei(s,l),d&4&&Hb(s,l);break;case 13:ei(s,l),d&4&&Gb(s,l),d&64&&(s=l.memoizedState,s!==null&&(s=s.dehydrated,s!==null&&(l=KA.bind(null,l),pj(s,l))));break;case 22:if(d=l.memoizedState!==null||Js,!d){i=i!==null&&i.memoizedState!==null||sn,y=Js;var b=sn;Js=d,(sn=i)&&!b?ti(s,l,(l.subtreeFlags&8772)!==0):ei(s,l),Js=y,sn=b}break;case 30:break;default:ei(s,l)}}function $b(s){var i=s.alternate;i!==null&&(s.alternate=null,$b(i)),s.child=null,s.deletions=null,s.sibling=null,s.tag===5&&(i=s.stateNode,i!==null&&Do(i)),s.stateNode=null,s.return=null,s.dependencies=null,s.memoizedProps=null,s.memoizedState=null,s.pendingProps=null,s.stateNode=null,s.updateQueue=null}var Pt=null,Yn=!1;function Zs(s,i,l){for(l=l.child;l!==null;)qb(s,i,l),l=l.sibling}function qb(s,i,l){if(wn&&typeof wn.onCommitFiberUnmount=="function")try{wn.onCommitFiberUnmount(Ur,l)}catch{}switch(l.tag){case 26:sn||Cs(l,i),Zs(s,i,l),l.memoizedState?l.memoizedState.count--:l.stateNode&&(l=l.stateNode,l.parentNode.removeChild(l));break;case 27:sn||Cs(l,i);var d=Pt,y=Yn;Gi(l.type)&&(Pt=l.stateNode,Yn=!1),Zs(s,i,l),nu(l.stateNode),Pt=d,Yn=y;break;case 5:sn||Cs(l,i);case 6:if(d=Pt,y=Yn,Pt=null,Zs(s,i,l),Pt=d,Yn=y,Pt!==null)if(Yn)try{(Pt.nodeType===9?Pt.body:Pt.nodeName==="HTML"?Pt.ownerDocument.body:Pt).removeChild(l.stateNode)}catch(b){vt(l,i,b)}else try{Pt.removeChild(l.stateNode)}catch(b){vt(l,i,b)}break;case 18:Pt!==null&&(Yn?(s=Pt,Pv(s.nodeType===9?s.body:s.nodeName==="HTML"?s.ownerDocument.body:s,l.stateNode),ml(s)):Pv(Pt,l.stateNode));break;case 4:d=Pt,y=Yn,Pt=l.stateNode.containerInfo,Yn=!0,Zs(s,i,l),Pt=d,Yn=y;break;case 0:case 11:case 14:case 15:zi(2,l,i),sn||zi(4,l,i),Zs(s,i,l);break;case 1:sn||(Cs(l,i),d=l.stateNode,typeof d.componentWillUnmount=="function"&&Bb(l,i,d)),Zs(s,i,l);break;case 21:Zs(s,i,l);break;case 22:sn=(d=sn)||l.memoizedState!==null,Zs(s,i,l),sn=d;break;default:Zs(s,i,l)}}function Hb(s,i){if(i.memoizedState===null&&(s=i.alternate,s!==null&&(s=s.memoizedState,s!==null))){s=s.dehydrated;try{ml(s)}catch(l){vt(i,i.return,l)}}}function Gb(s,i){if(i.memoizedState===null&&(s=i.alternate,s!==null&&(s=s.memoizedState,s!==null&&(s=s.dehydrated,s!==null))))try{ml(s)}catch(l){vt(i,i.return,l)}}function FA(s){switch(s.tag){case 31:case 13:case 19:var i=s.stateNode;return i===null&&(i=s.stateNode=new Fb),i;case 22:return s=s.stateNode,i=s._retryCache,i===null&&(i=s._retryCache=new Fb),i;default:throw Error(r(435,s.tag))}}function lh(s,i){var l=FA(s);i.forEach(function(d){if(!l.has(d)){l.add(d);var y=YA.bind(null,s,d);d.then(y,y)}})}function Xn(s,i){var l=i.deletions;if(l!==null)for(var d=0;d<l.length;d++){var y=l[d],b=s,R=i,F=R;e:for(;F!==null;){switch(F.tag){case 27:if(Gi(F.type)){Pt=F.stateNode,Yn=!1;break e}break;case 5:Pt=F.stateNode,Yn=!1;break e;case 3:case 4:Pt=F.stateNode.containerInfo,Yn=!0;break e}F=F.return}if(Pt===null)throw Error(r(160));qb(b,R,y),Pt=null,Yn=!1,b=y.alternate,b!==null&&(b.return=null),y.return=null}if(i.subtreeFlags&13886)for(i=i.child;i!==null;)Qb(i,s),i=i.sibling}var Yr=null;function Qb(s,i){var l=s.alternate,d=s.flags;switch(s.tag){case 0:case 11:case 14:case 15:Xn(i,s),Jn(s),d&4&&(zi(3,s,s.return),Gc(3,s),zi(5,s,s.return));break;case 1:Xn(i,s),Jn(s),d&512&&(sn||l===null||Cs(l,l.return)),d&64&&Js&&(s=s.updateQueue,s!==null&&(d=s.callbacks,d!==null&&(l=s.shared.hiddenCallbacks,s.shared.hiddenCallbacks=l===null?d:l.concat(d))));break;case 26:var y=Yr;if(Xn(i,s),Jn(s),d&512&&(sn||l===null||Cs(l,l.return)),d&4){var b=l!==null?l.memoizedState:null;if(d=s.memoizedState,l===null)if(d===null)if(s.stateNode===null){e:{d=s.type,l=s.memoizedProps,y=y.ownerDocument||y;t:switch(d){case"title":b=y.getElementsByTagName("title")[0],(!b||b[ds]||b[Jt]||b.namespaceURI==="http://www.w3.org/2000/svg"||b.hasAttribute("itemprop"))&&(b=y.createElement(d),y.head.insertBefore(b,y.querySelector("head > title"))),jn(b,d,l),b[Jt]=s,Zt(b),d=b;break e;case"link":var R=Qv("link","href",y).get(d+(l.href||""));if(R){for(var F=0;F<R.length;F++)if(b=R[F],b.getAttribute("href")===(l.href==null||l.href===""?null:l.href)&&b.getAttribute("rel")===(l.rel==null?null:l.rel)&&b.getAttribute("title")===(l.title==null?null:l.title)&&b.getAttribute("crossorigin")===(l.crossOrigin==null?null:l.crossOrigin)){R.splice(F,1);break t}}b=y.createElement(d),jn(b,d,l),y.head.appendChild(b);break;case"meta":if(R=Qv("meta","content",y).get(d+(l.content||""))){for(F=0;F<R.length;F++)if(b=R[F],b.getAttribute("content")===(l.content==null?null:""+l.content)&&b.getAttribute("name")===(l.name==null?null:l.name)&&b.getAttribute("property")===(l.property==null?null:l.property)&&b.getAttribute("http-equiv")===(l.httpEquiv==null?null:l.httpEquiv)&&b.getAttribute("charset")===(l.charSet==null?null:l.charSet)){R.splice(F,1);break t}}b=y.createElement(d),jn(b,d,l),y.head.appendChild(b);break;default:throw Error(r(468,d))}b[Jt]=s,Zt(b),d=b}s.stateNode=d}else Wv(y,s.type,s.stateNode);else s.stateNode=Gv(y,d,s.memoizedProps);else b!==d?(b===null?l.stateNode!==null&&(l=l.stateNode,l.parentNode.removeChild(l)):b.count--,d===null?Wv(y,s.type,s.stateNode):Gv(y,d,s.memoizedProps)):d===null&&s.stateNode!==null&&Rp(s,s.memoizedProps,l.memoizedProps)}break;case 27:Xn(i,s),Jn(s),d&512&&(sn||l===null||Cs(l,l.return)),l!==null&&d&4&&Rp(s,s.memoizedProps,l.memoizedProps);break;case 5:if(Xn(i,s),Jn(s),d&512&&(sn||l===null||Cs(l,l.return)),s.flags&32){y=s.stateNode;try{Kn(y,"")}catch(Ie){vt(s,s.return,Ie)}}d&4&&s.stateNode!=null&&(y=s.memoizedProps,Rp(s,y,l!==null?l.memoizedProps:y)),d&1024&&(Mp=!0);break;case 6:if(Xn(i,s),Jn(s),d&4){if(s.stateNode===null)throw Error(r(162));d=s.memoizedProps,l=s.stateNode;try{l.nodeValue=d}catch(Ie){vt(s,s.return,Ie)}}break;case 3:if(Eh=null,y=Yr,Yr=Sh(i.containerInfo),Xn(i,s),Yr=y,Jn(s),d&4&&l!==null&&l.memoizedState.isDehydrated)try{ml(i.containerInfo)}catch(Ie){vt(s,s.return,Ie)}Mp&&(Mp=!1,Wb(s));break;case 4:d=Yr,Yr=Sh(s.stateNode.containerInfo),Xn(i,s),Jn(s),Yr=d;break;case 12:Xn(i,s),Jn(s);break;case 31:Xn(i,s),Jn(s),d&4&&(d=s.updateQueue,d!==null&&(s.updateQueue=null,lh(s,d)));break;case 13:Xn(i,s),Jn(s),s.child.flags&8192&&s.memoizedState!==null!=(l!==null&&l.memoizedState!==null)&&(uh=dn()),d&4&&(d=s.updateQueue,d!==null&&(s.updateQueue=null,lh(s,d)));break;case 22:y=s.memoizedState!==null;var X=l!==null&&l.memoizedState!==null,ue=Js,me=sn;if(Js=ue||y,sn=me||X,Xn(i,s),sn=me,Js=ue,Jn(s),d&8192)e:for(i=s.stateNode,i._visibility=y?i._visibility&-2:i._visibility|1,y&&(l===null||X||Js||sn||to(s)),l=null,i=s;;){if(i.tag===5||i.tag===26){if(l===null){X=l=i;try{if(b=X.stateNode,y)R=b.style,typeof R.setProperty=="function"?R.setProperty("display","none","important"):R.display="none";else{F=X.stateNode;var be=X.memoizedProps.style,de=be!=null&&be.hasOwnProperty("display")?be.display:null;F.style.display=de==null||typeof de=="boolean"?"":(""+de).trim()}}catch(Ie){vt(X,X.return,Ie)}}}else if(i.tag===6){if(l===null){X=i;try{X.stateNode.nodeValue=y?"":X.memoizedProps}catch(Ie){vt(X,X.return,Ie)}}}else if(i.tag===18){if(l===null){X=i;try{var fe=X.stateNode;y?Bv(fe,!0):Bv(X.stateNode,!1)}catch(Ie){vt(X,X.return,Ie)}}}else if((i.tag!==22&&i.tag!==23||i.memoizedState===null||i===s)&&i.child!==null){i.child.return=i,i=i.child;continue}if(i===s)break e;for(;i.sibling===null;){if(i.return===null||i.return===s)break e;l===i&&(l=null),i=i.return}l===i&&(l=null),i.sibling.return=i.return,i=i.sibling}d&4&&(d=s.updateQueue,d!==null&&(l=d.retryQueue,l!==null&&(d.retryQueue=null,lh(s,l))));break;case 19:Xn(i,s),Jn(s),d&4&&(d=s.updateQueue,d!==null&&(s.updateQueue=null,lh(s,d)));break;case 30:break;case 21:break;default:Xn(i,s),Jn(s)}}function Jn(s){var i=s.flags;if(i&2){try{for(var l,d=s.return;d!==null;){if(zb(d)){l=d;break}d=d.return}if(l==null)throw Error(r(160));switch(l.tag){case 27:var y=l.stateNode,b=Dp(s);oh(s,b,y);break;case 5:var R=l.stateNode;l.flags&32&&(Kn(R,""),l.flags&=-33);var F=Dp(s);oh(s,F,R);break;case 3:case 4:var X=l.stateNode.containerInfo,ue=Dp(s);Ip(s,ue,X);break;default:throw Error(r(161))}}catch(me){vt(s,s.return,me)}s.flags&=-3}i&4096&&(s.flags&=-4097)}function Wb(s){if(s.subtreeFlags&1024)for(s=s.child;s!==null;){var i=s;Wb(i),i.tag===5&&i.flags&1024&&i.stateNode.reset(),s=s.sibling}}function ei(s,i){if(i.subtreeFlags&8772)for(i=i.child;i!==null;)Vb(s,i.alternate,i),i=i.sibling}function to(s){for(s=s.child;s!==null;){var i=s;switch(i.tag){case 0:case 11:case 14:case 15:zi(4,i,i.return),to(i);break;case 1:Cs(i,i.return);var l=i.stateNode;typeof l.componentWillUnmount=="function"&&Bb(i,i.return,l),to(i);break;case 27:nu(i.stateNode);case 26:case 5:Cs(i,i.return),to(i);break;case 22:i.memoizedState===null&&to(i);break;case 30:to(i);break;default:to(i)}s=s.sibling}}function ti(s,i,l){for(l=l&&(i.subtreeFlags&8772)!==0,i=i.child;i!==null;){var d=i.alternate,y=s,b=i,R=b.flags;switch(b.tag){case 0:case 11:case 15:ti(y,b,l),Gc(4,b);break;case 1:if(ti(y,b,l),d=b,y=d.stateNode,typeof y.componentDidMount=="function")try{y.componentDidMount()}catch(ue){vt(d,d.return,ue)}if(d=b,y=d.updateQueue,y!==null){var F=d.stateNode;try{var X=y.shared.hiddenCallbacks;if(X!==null)for(y.shared.hiddenCallbacks=null,y=0;y<X.length;y++)C_(X[y],F)}catch(ue){vt(d,d.return,ue)}}l&&R&64&&Pb(b),Qc(b,b.return);break;case 27:Ub(b);case 26:case 5:ti(y,b,l),l&&d===null&&R&4&&Lb(b),Qc(b,b.return);break;case 12:ti(y,b,l);break;case 31:ti(y,b,l),l&&R&4&&Hb(y,b);break;case 13:ti(y,b,l),l&&R&4&&Gb(y,b);break;case 22:b.memoizedState===null&&ti(y,b,l),Qc(b,b.return);break;case 30:break;default:ti(y,b,l)}i=i.sibling}}function kp(s,i){var l=null;s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(l=s.memoizedState.cachePool.pool),s=null,i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(s=i.memoizedState.cachePool.pool),s!==l&&(s!=null&&s.refCount++,l!=null&&kc(l))}function Op(s,i){s=null,i.alternate!==null&&(s=i.alternate.memoizedState.cache),i=i.memoizedState.cache,i!==s&&(i.refCount++,s!=null&&kc(s))}function Xr(s,i,l,d){if(i.subtreeFlags&10256)for(i=i.child;i!==null;)Kb(s,i,l,d),i=i.sibling}function Kb(s,i,l,d){var y=i.flags;switch(i.tag){case 0:case 11:case 15:Xr(s,i,l,d),y&2048&&Gc(9,i);break;case 1:Xr(s,i,l,d);break;case 3:Xr(s,i,l,d),y&2048&&(s=null,i.alternate!==null&&(s=i.alternate.memoizedState.cache),i=i.memoizedState.cache,i!==s&&(i.refCount++,s!=null&&kc(s)));break;case 12:if(y&2048){Xr(s,i,l,d),s=i.stateNode;try{var b=i.memoizedProps,R=b.id,F=b.onPostCommit;typeof F=="function"&&F(R,i.alternate===null?"mount":"update",s.passiveEffectDuration,-0)}catch(X){vt(i,i.return,X)}}else Xr(s,i,l,d);break;case 31:Xr(s,i,l,d);break;case 13:Xr(s,i,l,d);break;case 23:break;case 22:b=i.stateNode,R=i.alternate,i.memoizedState!==null?b._visibility&2?Xr(s,i,l,d):Wc(s,i):b._visibility&2?Xr(s,i,l,d):(b._visibility|=2,rl(s,i,l,d,(i.subtreeFlags&10256)!==0||!1)),y&2048&&kp(R,i);break;case 24:Xr(s,i,l,d),y&2048&&Op(i.alternate,i);break;default:Xr(s,i,l,d)}}function rl(s,i,l,d,y){for(y=y&&((i.subtreeFlags&10256)!==0||!1),i=i.child;i!==null;){var b=s,R=i,F=l,X=d,ue=R.flags;switch(R.tag){case 0:case 11:case 15:rl(b,R,F,X,y),Gc(8,R);break;case 23:break;case 22:var me=R.stateNode;R.memoizedState!==null?me._visibility&2?rl(b,R,F,X,y):Wc(b,R):(me._visibility|=2,rl(b,R,F,X,y)),y&&ue&2048&&kp(R.alternate,R);break;case 24:rl(b,R,F,X,y),y&&ue&2048&&Op(R.alternate,R);break;default:rl(b,R,F,X,y)}i=i.sibling}}function Wc(s,i){if(i.subtreeFlags&10256)for(i=i.child;i!==null;){var l=s,d=i,y=d.flags;switch(d.tag){case 22:Wc(l,d),y&2048&&kp(d.alternate,d);break;case 24:Wc(l,d),y&2048&&Op(d.alternate,d);break;default:Wc(l,d)}i=i.sibling}}var Kc=8192;function sl(s,i,l){if(s.subtreeFlags&Kc)for(s=s.child;s!==null;)Yb(s,i,l),s=s.sibling}function Yb(s,i,l){switch(s.tag){case 26:sl(s,i,l),s.flags&Kc&&s.memoizedState!==null&&Aj(l,Yr,s.memoizedState,s.memoizedProps);break;case 5:sl(s,i,l);break;case 3:case 4:var d=Yr;Yr=Sh(s.stateNode.containerInfo),sl(s,i,l),Yr=d;break;case 22:s.memoizedState===null&&(d=s.alternate,d!==null&&d.memoizedState!==null?(d=Kc,Kc=16777216,sl(s,i,l),Kc=d):sl(s,i,l));break;default:sl(s,i,l)}}function Xb(s){var i=s.alternate;if(i!==null&&(s=i.child,s!==null)){i.child=null;do i=s.sibling,s.sibling=null,s=i;while(s!==null)}}function Yc(s){var i=s.deletions;if((s.flags&16)!==0){if(i!==null)for(var l=0;l<i.length;l++){var d=i[l];vn=d,Zb(d,s)}Xb(s)}if(s.subtreeFlags&10256)for(s=s.child;s!==null;)Jb(s),s=s.sibling}function Jb(s){switch(s.tag){case 0:case 11:case 15:Yc(s),s.flags&2048&&zi(9,s,s.return);break;case 3:Yc(s);break;case 12:Yc(s);break;case 22:var i=s.stateNode;s.memoizedState!==null&&i._visibility&2&&(s.return===null||s.return.tag!==13)?(i._visibility&=-3,ch(s)):Yc(s);break;default:Yc(s)}}function ch(s){var i=s.deletions;if((s.flags&16)!==0){if(i!==null)for(var l=0;l<i.length;l++){var d=i[l];vn=d,Zb(d,s)}Xb(s)}for(s=s.child;s!==null;){switch(i=s,i.tag){case 0:case 11:case 15:zi(8,i,i.return),ch(i);break;case 22:l=i.stateNode,l._visibility&2&&(l._visibility&=-3,ch(i));break;default:ch(i)}s=s.sibling}}function Zb(s,i){for(;vn!==null;){var l=vn;switch(l.tag){case 0:case 11:case 15:zi(8,l,i);break;case 23:case 22:if(l.memoizedState!==null&&l.memoizedState.cachePool!==null){var d=l.memoizedState.cachePool.pool;d!=null&&d.refCount++}break;case 24:kc(l.memoizedState.cache)}if(d=l.child,d!==null)d.return=l,vn=d;else e:for(l=s;vn!==null;){d=vn;var y=d.sibling,b=d.return;if($b(d),d===l){vn=null;break e}if(y!==null){y.return=b,vn=y;break e}vn=b}}}var VA={getCacheForType:function(s){var i=Tn(tn),l=i.data.get(s);return l===void 0&&(l=s(),i.data.set(s,l)),l},cacheSignal:function(){return Tn(tn).controller.signal}},$A=typeof WeakMap=="function"?WeakMap:Map,gt=0,Tt=null,Je=null,tt=0,bt=0,hr=null,Ui=!1,il=!1,Np=!1,ni=0,qt=0,Fi=0,no=0,Pp=0,fr=0,al=0,Xc=null,Zn=null,Bp=!1,uh=0,ev=0,dh=1/0,hh=null,Vi=null,hn=0,$i=null,ol=null,ri=0,Lp=0,zp=null,tv=null,Jc=0,Up=null;function mr(){return(gt&2)!==0&&tt!==0?tt&-tt:z.T!==null?Gp():fd()}function nv(){if(fr===0)if((tt&536870912)===0||at){var s=Ra;Ra<<=1,(Ra&3932160)===0&&(Ra=262144),fr=s}else fr=536870912;return s=ur.current,s!==null&&(s.flags|=32),fr}function er(s,i,l){(s===Tt&&(bt===2||bt===9)||s.cancelPendingCommit!==null)&&(ll(s,0),qi(s,tt,fr,!1)),Da(s,l),((gt&2)===0||s!==Tt)&&(s===Tt&&((gt&2)===0&&(no|=l),qt===4&&qi(s,tt,fr,!1)),Ts(s))}function rv(s,i,l){if((gt&6)!==0)throw Error(r(327));var d=!l&&(i&127)===0&&(i&s.expiredLanes)===0||Fr(s,i),y=d?GA(s,i):Vp(s,i,!0),b=d;do{if(y===0){il&&!d&&qi(s,i,0,!1);break}else{if(l=s.current.alternate,b&&!qA(l)){y=Vp(s,i,!1),b=!1;continue}if(y===2){if(b=i,s.errorRecoveryDisabledLanes&b)var R=0;else R=s.pendingLanes&-536870913,R=R!==0?R:R&536870912?536870912:0;if(R!==0){i=R;e:{var F=s;y=Xc;var X=F.current.memoizedState.isDehydrated;if(X&&(ll(F,R).flags|=256),R=Vp(F,R,!1),R!==2){if(Np&&!X){F.errorRecoveryDisabledLanes|=b,no|=b,y=4;break e}b=Zn,Zn=y,b!==null&&(Zn===null?Zn=b:Zn.push.apply(Zn,b))}y=R}if(b=!1,y!==2)continue}}if(y===1){ll(s,0),qi(s,i,0,!0);break}e:{switch(d=s,b=y,b){case 0:case 1:throw Error(r(345));case 4:if((i&4194048)!==i)break;case 6:qi(d,i,fr,!Ui);break e;case 2:Zn=null;break;case 3:case 5:break;default:throw Error(r(329))}if((i&62914560)===i&&(y=uh+300-dn(),10<y)){if(qi(d,i,fr,!Ui),ls(d,0,!0)!==0)break e;ri=i,d.timeoutHandle=Ov(sv.bind(null,d,l,Zn,hh,Bp,i,fr,no,al,Ui,b,"Throttled",-0,0),y);break e}sv(d,l,Zn,hh,Bp,i,fr,no,al,Ui,b,null,-0,0)}}break}while(!0);Ts(s)}function sv(s,i,l,d,y,b,R,F,X,ue,me,be,de,fe){if(s.timeoutHandle=-1,be=i.subtreeFlags,be&8192||(be&16785408)===16785408){be={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:qr},Yb(i,b,be);var Ie=(b&62914560)===b?uh-dn():(b&4194048)===b?ev-dn():0;if(Ie=jj(be,Ie),Ie!==null){ri=b,s.cancelPendingCommit=Ie(hv.bind(null,s,i,b,l,d,y,R,F,X,me,be,null,de,fe)),qi(s,b,R,!ue);return}}hv(s,i,b,l,d,y,R,F,X)}function qA(s){for(var i=s;;){var l=i.tag;if((l===0||l===11||l===15)&&i.flags&16384&&(l=i.updateQueue,l!==null&&(l=l.stores,l!==null)))for(var d=0;d<l.length;d++){var y=l[d],b=y.getSnapshot;y=y.value;try{if(!lr(b(),y))return!1}catch{return!1}}if(l=i.child,i.subtreeFlags&16384&&l!==null)l.return=i,i=l;else{if(i===s)break;for(;i.sibling===null;){if(i.return===null||i.return===s)return!0;i=i.return}i.sibling.return=i.return,i=i.sibling}}return!0}function qi(s,i,l,d){i&=~Pp,i&=~no,s.suspendedLanes|=i,s.pingedLanes&=~i,d&&(s.warmLanes|=i),d=s.expirationTimes;for(var y=i;0<y;){var b=31-Ht(y),R=1<<b;d[b]=-1,y&=~R}l!==0&&Ia(s,l,i)}function fh(){return(gt&6)===0?(Zc(0),!1):!0}function Fp(){if(Je!==null){if(bt===0)var s=Je.return;else s=Je,Gs=Qa=null,rp(s),Jo=null,Nc=0,s=Je;for(;s!==null;)Nb(s.alternate,s),s=s.return;Je=null}}function ll(s,i){var l=s.timeoutHandle;l!==-1&&(s.timeoutHandle=-1,uj(l)),l=s.cancelPendingCommit,l!==null&&(s.cancelPendingCommit=null,l()),ri=0,Fp(),Tt=s,Je=l=qs(s.current,null),tt=i,bt=0,hr=null,Ui=!1,il=Fr(s,i),Np=!1,al=fr=Pp=no=Fi=qt=0,Zn=Xc=null,Bp=!1,(i&8)!==0&&(i|=i&32);var d=s.entangledLanes;if(d!==0)for(s=s.entanglements,d&=i;0<d;){var y=31-Ht(d),b=1<<y;i|=s[y],d&=~b}return ni=i,Od(),l}function iv(s,i){Ke=null,z.H=$c,i===Xo||i===Vd?(i=x_(),bt=3):i===Hm?(i=x_(),bt=4):bt=i===bp?8:i!==null&&typeof i=="object"&&typeof i.then=="function"?6:1,hr=i,Je===null&&(qt=1,nh(s,jr(i,s.current)))}function av(){var s=ur.current;return s===null?!0:(tt&4194048)===tt?Mr===null:(tt&62914560)===tt||(tt&536870912)!==0?s===Mr:!1}function ov(){var s=z.H;return z.H=$c,s===null?$c:s}function lv(){var s=z.A;return z.A=VA,s}function mh(){qt=4,Ui||(tt&4194048)!==tt&&ur.current!==null||(il=!0),(Fi&134217727)===0&&(no&134217727)===0||Tt===null||qi(Tt,tt,fr,!1)}function Vp(s,i,l){var d=gt;gt|=2;var y=ov(),b=lv();(Tt!==s||tt!==i)&&(hh=null,ll(s,i)),i=!1;var R=qt;e:do try{if(bt!==0&&Je!==null){var F=Je,X=hr;switch(bt){case 8:Fp(),R=6;break e;case 3:case 2:case 9:case 6:ur.current===null&&(i=!0);var ue=bt;if(bt=0,hr=null,cl(s,F,X,ue),l&&il){R=0;break e}break;default:ue=bt,bt=0,hr=null,cl(s,F,X,ue)}}HA(),R=qt;break}catch(me){iv(s,me)}while(!0);return i&&s.shellSuspendCounter++,Gs=Qa=null,gt=d,z.H=y,z.A=b,Je===null&&(Tt=null,tt=0,Od()),R}function HA(){for(;Je!==null;)cv(Je)}function GA(s,i){var l=gt;gt|=2;var d=ov(),y=lv();Tt!==s||tt!==i?(hh=null,dh=dn()+500,ll(s,i)):il=Fr(s,i);e:do try{if(bt!==0&&Je!==null){i=Je;var b=hr;t:switch(bt){case 1:bt=0,hr=null,cl(s,i,b,1);break;case 2:case 9:if(b_(b)){bt=0,hr=null,uv(i);break}i=function(){bt!==2&&bt!==9||Tt!==s||(bt=7),Ts(s)},b.then(i,i);break e;case 3:bt=7;break e;case 4:bt=5;break e;case 7:b_(b)?(bt=0,hr=null,uv(i)):(bt=0,hr=null,cl(s,i,b,7));break;case 5:var R=null;switch(Je.tag){case 26:R=Je.memoizedState;case 5:case 27:var F=Je;if(R?Kv(R):F.stateNode.complete){bt=0,hr=null;var X=F.sibling;if(X!==null)Je=X;else{var ue=F.return;ue!==null?(Je=ue,ph(ue)):Je=null}break t}}bt=0,hr=null,cl(s,i,b,5);break;case 6:bt=0,hr=null,cl(s,i,b,6);break;case 8:Fp(),qt=6;break e;default:throw Error(r(462))}}QA();break}catch(me){iv(s,me)}while(!0);return Gs=Qa=null,z.H=d,z.A=y,gt=l,Je!==null?0:(Tt=null,tt=0,Od(),qt)}function QA(){for(;Je!==null&&!Ye();)cv(Je)}function cv(s){var i=kb(s.alternate,s,ni);s.memoizedProps=s.pendingProps,i===null?ph(s):Je=i}function uv(s){var i=s,l=i.alternate;switch(i.tag){case 15:case 0:i=Ab(l,i,i.pendingProps,i.type,void 0,tt);break;case 11:i=Ab(l,i,i.pendingProps,i.type.render,i.ref,tt);break;case 5:rp(i);default:Nb(l,i),i=Je=l_(i,ni),i=kb(l,i,ni)}s.memoizedProps=s.pendingProps,i===null?ph(s):Je=i}function cl(s,i,l,d){Gs=Qa=null,rp(i),Jo=null,Nc=0;var y=i.return;try{if(NA(s,y,i,l,tt)){qt=1,nh(s,jr(l,s.current)),Je=null;return}}catch(b){if(y!==null)throw Je=y,b;qt=1,nh(s,jr(l,s.current)),Je=null;return}i.flags&32768?(at||d===1?s=!0:il||(tt&536870912)!==0?s=!1:(Ui=s=!0,(d===2||d===9||d===3||d===6)&&(d=ur.current,d!==null&&d.tag===13&&(d.flags|=16384))),dv(i,s)):ph(i)}function ph(s){var i=s;do{if((i.flags&32768)!==0){dv(i,Ui);return}s=i.return;var l=LA(i.alternate,i,ni);if(l!==null){Je=l;return}if(i=i.sibling,i!==null){Je=i;return}Je=i=s}while(i!==null);qt===0&&(qt=5)}function dv(s,i){do{var l=zA(s.alternate,s);if(l!==null){l.flags&=32767,Je=l;return}if(l=s.return,l!==null&&(l.flags|=32768,l.subtreeFlags=0,l.deletions=null),!i&&(s=s.sibling,s!==null)){Je=s;return}Je=s=l}while(s!==null);qt=6,Je=null}function hv(s,i,l,d,y,b,R,F,X){s.cancelPendingCommit=null;do gh();while(hn!==0);if((gt&6)!==0)throw Error(r(327));if(i!==null){if(i===s.current)throw Error(r(177));if(b=i.lanes|i.childLanes,b|=Dm,xm(s,l,b,R,F,X),s===Tt&&(Je=Tt=null,tt=0),ol=i,$i=s,ri=l,Lp=b,zp=y,tv=d,(i.subtreeFlags&10256)!==0||(i.flags&10256)!==0?(s.callbackNode=null,s.callbackPriority=0,XA(vi,function(){return yv(),null})):(s.callbackNode=null,s.callbackPriority=0),d=(i.flags&13878)!==0,(i.subtreeFlags&13878)!==0||d){d=z.T,z.T=null,y=V.p,V.p=2,R=gt,gt|=4;try{UA(s,i,l)}finally{gt=R,V.p=y,z.T=d}}hn=1,fv(),mv(),pv()}}function fv(){if(hn===1){hn=0;var s=$i,i=ol,l=(i.flags&13878)!==0;if((i.subtreeFlags&13878)!==0||l){l=z.T,z.T=null;var d=V.p;V.p=2;var y=gt;gt|=4;try{Qb(i,s);var b=eg,R=Z0(s.containerInfo),F=b.focusedElem,X=b.selectionRange;if(R!==F&&F&&F.ownerDocument&&J0(F.ownerDocument.documentElement,F)){if(X!==null&&Cm(F)){var ue=X.start,me=X.end;if(me===void 0&&(me=ue),"selectionStart"in F)F.selectionStart=ue,F.selectionEnd=Math.min(me,F.value.length);else{var be=F.ownerDocument||document,de=be&&be.defaultView||window;if(de.getSelection){var fe=de.getSelection(),Ie=F.textContent.length,ze=Math.min(X.start,Ie),Et=X.end===void 0?ze:Math.min(X.end,Ie);!fe.extend&&ze>Et&&(R=Et,Et=ze,ze=R);var re=X0(F,ze),te=X0(F,Et);if(re&&te&&(fe.rangeCount!==1||fe.anchorNode!==re.node||fe.anchorOffset!==re.offset||fe.focusNode!==te.node||fe.focusOffset!==te.offset)){var ce=be.createRange();ce.setStart(re.node,re.offset),fe.removeAllRanges(),ze>Et?(fe.addRange(ce),fe.extend(te.node,te.offset)):(ce.setEnd(te.node,te.offset),fe.addRange(ce))}}}}for(be=[],fe=F;fe=fe.parentNode;)fe.nodeType===1&&be.push({element:fe,left:fe.scrollLeft,top:fe.scrollTop});for(typeof F.focus=="function"&&F.focus(),F=0;F<be.length;F++){var ye=be[F];ye.element.scrollLeft=ye.left,ye.element.scrollTop=ye.top}}jh=!!Zp,eg=Zp=null}finally{gt=y,V.p=d,z.T=l}}s.current=i,hn=2}}function mv(){if(hn===2){hn=0;var s=$i,i=ol,l=(i.flags&8772)!==0;if((i.subtreeFlags&8772)!==0||l){l=z.T,z.T=null;var d=V.p;V.p=2;var y=gt;gt|=4;try{Vb(s,i.alternate,i)}finally{gt=y,V.p=d,z.T=l}}hn=3}}function pv(){if(hn===4||hn===3){hn=0,bi();var s=$i,i=ol,l=ri,d=tv;(i.subtreeFlags&10256)!==0||(i.flags&10256)!==0?hn=5:(hn=0,ol=$i=null,gv(s,s.pendingLanes));var y=s.pendingLanes;if(y===0&&(Vi=null),Us(l),i=i.stateNode,wn&&typeof wn.onCommitFiberRoot=="function")try{wn.onCommitFiberRoot(Ur,i,void 0,(i.current.flags&128)===128)}catch{}if(d!==null){i=z.T,y=V.p,V.p=2,z.T=null;try{for(var b=s.onRecoverableError,R=0;R<d.length;R++){var F=d[R];b(F.value,{componentStack:F.stack})}}finally{z.T=i,V.p=y}}(ri&3)!==0&&gh(),Ts(s),y=s.pendingLanes,(l&261930)!==0&&(y&42)!==0?s===Up?Jc++:(Jc=0,Up=s):Jc=0,Zc(0)}}function gv(s,i){(s.pooledCacheLanes&=i)===0&&(i=s.pooledCache,i!=null&&(s.pooledCache=null,kc(i)))}function gh(){return fv(),mv(),pv(),yv()}function yv(){if(hn!==5)return!1;var s=$i,i=Lp;Lp=0;var l=Us(ri),d=z.T,y=V.p;try{V.p=32>l?32:l,z.T=null,l=zp,zp=null;var b=$i,R=ri;if(hn=0,ol=$i=null,ri=0,(gt&6)!==0)throw Error(r(331));var F=gt;if(gt|=4,Jb(b.current),Kb(b,b.current,R,l),gt=F,Zc(0,!1),wn&&typeof wn.onPostCommitFiberRoot=="function")try{wn.onPostCommitFiberRoot(Ur,b)}catch{}return!0}finally{V.p=y,z.T=d,gv(s,i)}}function _v(s,i,l){i=jr(l,i),i=_p(s.stateNode,i,2),s=Pi(s,i,2),s!==null&&(Da(s,2),Ts(s))}function vt(s,i,l){if(s.tag===3)_v(s,s,l);else for(;i!==null;){if(i.tag===3){_v(i,s,l);break}else if(i.tag===1){var d=i.stateNode;if(typeof i.type.getDerivedStateFromError=="function"||typeof d.componentDidCatch=="function"&&(Vi===null||!Vi.has(d))){s=jr(l,s),l=bb(2),d=Pi(i,l,2),d!==null&&(vb(l,d,i,s),Da(d,2),Ts(d));break}}i=i.return}}function $p(s,i,l){var d=s.pingCache;if(d===null){d=s.pingCache=new $A;var y=new Set;d.set(i,y)}else y=d.get(i),y===void 0&&(y=new Set,d.set(i,y));y.has(l)||(Np=!0,y.add(l),s=WA.bind(null,s,i,l),i.then(s,s))}function WA(s,i,l){var d=s.pingCache;d!==null&&d.delete(i),s.pingedLanes|=s.suspendedLanes&l,s.warmLanes&=~l,Tt===s&&(tt&l)===l&&(qt===4||qt===3&&(tt&62914560)===tt&&300>dn()-uh?(gt&2)===0&&ll(s,0):Pp|=l,al===tt&&(al=0)),Ts(s)}function bv(s,i){i===0&&(i=hd()),s=qa(s,i),s!==null&&(Da(s,i),Ts(s))}function KA(s){var i=s.memoizedState,l=0;i!==null&&(l=i.retryLane),bv(s,l)}function YA(s,i){var l=0;switch(s.tag){case 31:case 13:var d=s.stateNode,y=s.memoizedState;y!==null&&(l=y.retryLane);break;case 19:d=s.stateNode;break;case 22:d=s.stateNode._retryCache;break;default:throw Error(r(314))}d!==null&&d.delete(i),bv(s,l)}function XA(s,i){return Dt(s,i)}var yh=null,ul=null,qp=!1,_h=!1,Hp=!1,Hi=0;function Ts(s){s!==ul&&s.next===null&&(ul===null?yh=ul=s:ul=ul.next=s),_h=!0,qp||(qp=!0,ZA())}function Zc(s,i){if(!Hp&&_h){Hp=!0;do for(var l=!1,d=yh;d!==null;){if(s!==0){var y=d.pendingLanes;if(y===0)var b=0;else{var R=d.suspendedLanes,F=d.pingedLanes;b=(1<<31-Ht(42|s)+1)-1,b&=y&~(R&~F),b=b&201326741?b&201326741|1:b?b|2:0}b!==0&&(l=!0,wv(d,b))}else b=tt,b=ls(d,d===Tt?b:0,d.cancelPendingCommit!==null||d.timeoutHandle!==-1),(b&3)===0||Fr(d,b)||(l=!0,wv(d,b));d=d.next}while(l);Hp=!1}}function JA(){vv()}function vv(){_h=qp=!1;var s=0;Hi!==0&&cj()&&(s=Hi);for(var i=dn(),l=null,d=yh;d!==null;){var y=d.next,b=xv(d,i);b===0?(d.next=null,l===null?yh=y:l.next=y,y===null&&(ul=l)):(l=d,(s!==0||(b&3)!==0)&&(_h=!0)),d=y}hn!==0&&hn!==5||Zc(s),Hi!==0&&(Hi=0)}function xv(s,i){for(var l=s.suspendedLanes,d=s.pingedLanes,y=s.expirationTimes,b=s.pendingLanes&-62914561;0<b;){var R=31-Ht(b),F=1<<R,X=y[R];X===-1?((F&l)===0||(F&d)!==0)&&(y[R]=vm(F,i)):X<=i&&(s.expiredLanes|=F),b&=~F}if(i=Tt,l=tt,l=ls(s,s===i?l:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),d=s.callbackNode,l===0||s===i&&(bt===2||bt===9)||s.cancelPendingCommit!==null)return d!==null&&d!==null&&je(d),s.callbackNode=null,s.callbackPriority=0;if((l&3)===0||Fr(s,l)){if(i=l&-l,i===s.callbackPriority)return i;switch(d!==null&&je(d),Us(l)){case 2:case 8:l=cc;break;case 32:l=vi;break;case 268435456:l=od;break;default:l=vi}return d=Sv.bind(null,s),l=Dt(l,d),s.callbackPriority=i,s.callbackNode=l,i}return d!==null&&d!==null&&je(d),s.callbackPriority=2,s.callbackNode=null,2}function Sv(s,i){if(hn!==0&&hn!==5)return s.callbackNode=null,s.callbackPriority=0,null;var l=s.callbackNode;if(gh()&&s.callbackNode!==l)return null;var d=tt;return d=ls(s,s===Tt?d:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),d===0?null:(rv(s,d,i),xv(s,dn()),s.callbackNode!=null&&s.callbackNode===l?Sv.bind(null,s):null)}function wv(s,i){if(gh())return null;rv(s,i,!0)}function ZA(){dj(function(){(gt&6)!==0?Dt(lc,JA):vv()})}function Gp(){if(Hi===0){var s=Ko;s===0&&(s=as,as<<=1,(as&261888)===0&&(as=256)),Hi=s}return Hi}function Ev(s){return s==null||typeof s=="symbol"||typeof s=="boolean"?null:typeof s=="function"?s:Oo(""+s)}function Cv(s,i){var l=i.ownerDocument.createElement("input");return l.name=i.name,l.value=i.value,s.id&&l.setAttribute("form",s.id),i.parentNode.insertBefore(l,i),s=new FormData(s),l.parentNode.removeChild(l),s}function ej(s,i,l,d,y){if(i==="submit"&&l&&l.stateNode===y){var b=Ev((y[_n]||null).action),R=d.submitter;R&&(i=(i=R[_n]||null)?Ev(i.formAction):R.getAttribute("formAction"),i!==null&&(b=i,R=null));var F=new bs("action","action",null,d,y);s.push({event:F,listeners:[{instance:null,listener:function(){if(d.defaultPrevented){if(Hi!==0){var X=R?Cv(y,R):new FormData(y);hp(l,{pending:!0,data:X,method:y.method,action:b},null,X)}}else typeof b=="function"&&(F.preventDefault(),X=R?Cv(y,R):new FormData(y),hp(l,{pending:!0,data:X,method:y.method,action:b},b,X))},currentTarget:y}]})}}for(var Qp=0;Qp<Rm.length;Qp++){var Wp=Rm[Qp],tj=Wp.toLowerCase(),nj=Wp[0].toUpperCase()+Wp.slice(1);Kr(tj,"on"+nj)}Kr(n_,"onAnimationEnd"),Kr(r_,"onAnimationIteration"),Kr(s_,"onAnimationStart"),Kr("dblclick","onDoubleClick"),Kr("focusin","onFocus"),Kr("focusout","onBlur"),Kr(_A,"onTransitionRun"),Kr(bA,"onTransitionStart"),Kr(vA,"onTransitionCancel"),Kr(i_,"onTransitionEnd"),ps("onMouseEnter",["mouseout","mouseover"]),ps("onMouseLeave",["mouseout","mouseover"]),ps("onPointerEnter",["pointerout","pointerover"]),ps("onPointerLeave",["pointerout","pointerover"]),ms("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),ms("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),ms("onBeforeInput",["compositionend","keypress","textInput","paste"]),ms("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),ms("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),ms("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var eu="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),rj=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(eu));function Tv(s,i){i=(i&4)!==0;for(var l=0;l<s.length;l++){var d=s[l],y=d.event;d=d.listeners;e:{var b=void 0;if(i)for(var R=d.length-1;0<=R;R--){var F=d[R],X=F.instance,ue=F.currentTarget;if(F=F.listener,X!==b&&y.isPropagationStopped())break e;b=F,y.currentTarget=ue;try{b(y)}catch(me){kd(me)}y.currentTarget=null,b=X}else for(R=0;R<d.length;R++){if(F=d[R],X=F.instance,ue=F.currentTarget,F=F.listener,X!==b&&y.isPropagationStopped())break e;b=F,y.currentTarget=ue;try{b(y)}catch(me){kd(me)}y.currentTarget=null,b=X}}}}function Ze(s,i){var l=i[Ro];l===void 0&&(l=i[Ro]=new Set);var d=s+"__bubble";l.has(d)||(Av(i,s,2,!1),l.add(d))}function Kp(s,i,l){var d=0;i&&(d|=4),Av(l,s,d,i)}var bh="_reactListening"+Math.random().toString(36).slice(2);function Yp(s){if(!s[bh]){s[bh]=!0,hc.forEach(function(l){l!=="selectionchange"&&(rj.has(l)||Kp(l,!1,s),Kp(l,!0,s))});var i=s.nodeType===9?s:s.ownerDocument;i===null||i[bh]||(i[bh]=!0,Kp("selectionchange",!1,i))}}function Av(s,i,l,d){switch(nx(i)){case 2:var y=Ij;break;case 8:y=Mj;break;default:y=dg}l=y.bind(null,i,l,s),y=void 0,!Pa||i!=="touchstart"&&i!=="touchmove"&&i!=="wheel"||(y=!0),d?y!==void 0?s.addEventListener(i,l,{capture:!0,passive:y}):s.addEventListener(i,l,!0):y!==void 0?s.addEventListener(i,l,{passive:y}):s.addEventListener(i,l,!1)}function Xp(s,i,l,d,y){var b=d;if((i&1)===0&&(i&2)===0&&d!==null)e:for(;;){if(d===null)return;var R=d.tag;if(R===3||R===4){var F=d.stateNode.containerInfo;if(F===y)break;if(R===4)for(R=d.return;R!==null;){var X=R.tag;if((X===3||X===4)&&R.stateNode.containerInfo===y)return;R=R.return}for(;F!==null;){if(R=hs(F),R===null)return;if(X=R.tag,X===5||X===6||X===26||X===27){d=b=R;continue e}F=F.parentNode}}d=d.return}Ti(function(){var ue=b,me=Er(l),be=[];e:{var de=a_.get(s);if(de!==void 0){var fe=bs,Ie=s;switch(s){case"keypress":if(La(l)===0)break e;case"keydown":case"keyup":fe=Dd;break;case"focusin":Ie="focus",fe=Ua;break;case"focusout":Ie="blur",fe=Ua;break;case"beforeblur":case"afterblur":fe=Ua;break;case"click":if(l.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":fe=Cc;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":fe=xd;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":fe=w;break;case n_:case r_:case s_:fe=wd;break;case i_:fe=$;break;case"scroll":case"scrollend":fe=Ec;break;case"wheel":fe=he;break;case"copy":case"cut":case"paste":fe=Ed;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":fe=$s;break;case"toggle":case"beforetoggle":fe=We}var ze=(i&4)!==0,Et=!ze&&(s==="scroll"||s==="scrollend"),re=ze?de!==null?de+"Capture":null:de;ze=[];for(var te=ue,ce;te!==null;){var ye=te;if(ce=ye.stateNode,ye=ye.tag,ye!==5&&ye!==26&&ye!==27||ce===null||re===null||(ye=Hr(te,re),ye!=null&&ze.push(tu(te,ye,ce))),Et)break;te=te.return}0<ze.length&&(de=new fe(de,Ie,null,l,me),be.push({event:de,listeners:ze}))}}if((i&7)===0){e:{if(de=s==="mouseover"||s==="pointerover",fe=s==="mouseout"||s==="pointerout",de&&l!==xc&&(Ie=l.relatedTarget||l.fromElement)&&(hs(Ie)||Ie[us]))break e;if((fe||de)&&(de=me.window===me?me:(de=me.ownerDocument)?de.defaultView||de.parentWindow:window,fe?(Ie=l.relatedTarget||l.toElement,fe=ue,Ie=Ie?hs(Ie):null,Ie!==null&&(Et=o(Ie),ze=Ie.tag,Ie!==Et||ze!==5&&ze!==27&&ze!==6)&&(Ie=null)):(fe=null,Ie=ue),fe!==Ie)){if(ze=Cc,ye="onMouseLeave",re="onMouseEnter",te="mouse",(s==="pointerout"||s==="pointerover")&&(ze=$s,ye="onPointerLeave",re="onPointerEnter",te="pointer"),Et=fe==null?de:ar(fe),ce=Ie==null?de:ar(Ie),de=new ze(ye,te+"leave",fe,l,me),de.target=Et,de.relatedTarget=ce,ye=null,hs(me)===ue&&(ze=new ze(re,te+"enter",Ie,l,me),ze.target=ce,ze.relatedTarget=Et,ye=ze),Et=ye,fe&&Ie)t:{for(ze=sj,re=fe,te=Ie,ce=0,ye=re;ye;ye=ze(ye))ce++;ye=0;for(var Ne=te;Ne;Ne=ze(Ne))ye++;for(;0<ce-ye;)re=ze(re),ce--;for(;0<ye-ce;)te=ze(te),ye--;for(;ce--;){if(re===te||te!==null&&re===te.alternate){ze=re;break t}re=ze(re),te=ze(te)}ze=null}else ze=null;fe!==null&&jv(be,de,fe,ze,!1),Ie!==null&&Et!==null&&jv(be,Et,Ie,ze,!0)}}e:{if(de=ue?ar(ue):window,fe=de.nodeName&&de.nodeName.toLowerCase(),fe==="select"||fe==="input"&&de.type==="file")var dt=H0;else if($0(de))if(G0)dt=pA;else{dt=fA;var ke=hA}else fe=de.nodeName,!fe||fe.toLowerCase()!=="input"||de.type!=="checkbox"&&de.type!=="radio"?ue&&ko(ue.elementType)&&(dt=H0):dt=mA;if(dt&&(dt=dt(s,ue))){q0(be,dt,l,me);break e}ke&&ke(s,de,ue),s==="focusout"&&ue&&de.type==="number"&&ue.memoizedProps.value!=null&&_c(de,"number",de.value)}switch(ke=ue?ar(ue):window,s){case"focusin":($0(ke)||ke.contentEditable==="true")&&(Fo=ke,Tm=ue,Dc=null);break;case"focusout":Dc=Tm=Fo=null;break;case"mousedown":Am=!0;break;case"contextmenu":case"mouseup":case"dragend":Am=!1,e_(be,l,me);break;case"selectionchange":if(yA)break;case"keydown":case"keyup":e_(be,l,me)}var Xe;if(pt)e:{switch(s){case"compositionstart":var nt="onCompositionStart";break e;case"compositionend":nt="onCompositionEnd";break e;case"compositionupdate":nt="onCompositionUpdate";break e}nt=void 0}else Uo?Fa(s,l)&&(nt="onCompositionEnd"):s==="keydown"&&l.keyCode===229&&(nt="onCompositionStart");nt&&(Ss&&l.locale!=="ko"&&(Uo||nt!=="onCompositionStart"?nt==="onCompositionEnd"&&Uo&&(Xe=wc()):(_s=me,Sc="value"in _s?_s.value:_s.textContent,Uo=!0)),ke=vh(ue,nt),0<ke.length&&(nt=new xs(nt,s,null,l,me),be.push({event:nt,listeners:ke}),Xe?nt.data=Xe:(Xe=zo(l),Xe!==null&&(nt.data=Xe)))),(Xe=Tr?lA(s,l):cA(s,l))&&(nt=vh(ue,"onBeforeInput"),0<nt.length&&(ke=new xs("onBeforeInput","beforeinput",null,l,me),be.push({event:ke,listeners:nt}),ke.data=Xe)),ej(be,s,ue,l,me)}Tv(be,i)})}function tu(s,i,l){return{instance:s,listener:i,currentTarget:l}}function vh(s,i){for(var l=i+"Capture",d=[];s!==null;){var y=s,b=y.stateNode;if(y=y.tag,y!==5&&y!==26&&y!==27||b===null||(y=Hr(s,l),y!=null&&d.unshift(tu(s,y,b)),y=Hr(s,i),y!=null&&d.push(tu(s,y,b))),s.tag===3)return d;s=s.return}return[]}function sj(s){if(s===null)return null;do s=s.return;while(s&&s.tag!==5&&s.tag!==27);return s||null}function jv(s,i,l,d,y){for(var b=i._reactName,R=[];l!==null&&l!==d;){var F=l,X=F.alternate,ue=F.stateNode;if(F=F.tag,X!==null&&X===d)break;F!==5&&F!==26&&F!==27||ue===null||(X=ue,y?(ue=Hr(l,b),ue!=null&&R.unshift(tu(l,ue,X))):y||(ue=Hr(l,b),ue!=null&&R.push(tu(l,ue,X)))),l=l.return}R.length!==0&&s.push({event:i,listeners:R})}var ij=/\r\n?/g,aj=/\u0000|\uFFFD/g;function Rv(s){return(typeof s=="string"?s:""+s).replace(ij,`
`).replace(aj,"")}function Dv(s,i){return i=Rv(i),Rv(s)===i}function wt(s,i,l,d,y,b){switch(l){case"children":typeof d=="string"?i==="body"||i==="textarea"&&d===""||Kn(s,d):(typeof d=="number"||typeof d=="bigint")&&i!=="body"&&Kn(s,""+d);break;case"className":or(s,"class",d);break;case"tabIndex":or(s,"tabindex",d);break;case"dir":case"role":case"viewBox":case"width":case"height":or(s,l,d);break;case"style":vc(s,d,b);break;case"data":if(i!=="object"){or(s,"data",d);break}case"src":case"href":if(d===""&&(i!=="a"||l!=="href")){s.removeAttribute(l);break}if(d==null||typeof d=="function"||typeof d=="symbol"||typeof d=="boolean"){s.removeAttribute(l);break}d=Oo(""+d),s.setAttribute(l,d);break;case"action":case"formAction":if(typeof d=="function"){s.setAttribute(l,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof b=="function"&&(l==="formAction"?(i!=="input"&&wt(s,i,"name",y.name,y,null),wt(s,i,"formEncType",y.formEncType,y,null),wt(s,i,"formMethod",y.formMethod,y,null),wt(s,i,"formTarget",y.formTarget,y,null)):(wt(s,i,"encType",y.encType,y,null),wt(s,i,"method",y.method,y,null),wt(s,i,"target",y.target,y,null)));if(d==null||typeof d=="symbol"||typeof d=="boolean"){s.removeAttribute(l);break}d=Oo(""+d),s.setAttribute(l,d);break;case"onClick":d!=null&&(s.onclick=qr);break;case"onScroll":d!=null&&Ze("scroll",s);break;case"onScrollEnd":d!=null&&Ze("scrollend",s);break;case"dangerouslySetInnerHTML":if(d!=null){if(typeof d!="object"||!("__html"in d))throw Error(r(61));if(l=d.__html,l!=null){if(y.children!=null)throw Error(r(60));s.innerHTML=l}}break;case"multiple":s.multiple=d&&typeof d!="function"&&typeof d!="symbol";break;case"muted":s.muted=d&&typeof d!="function"&&typeof d!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(d==null||typeof d=="function"||typeof d=="boolean"||typeof d=="symbol"){s.removeAttribute("xlink:href");break}l=Oo(""+d),s.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",l);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":d!=null&&typeof d!="function"&&typeof d!="symbol"?s.setAttribute(l,""+d):s.removeAttribute(l);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":d&&typeof d!="function"&&typeof d!="symbol"?s.setAttribute(l,""):s.removeAttribute(l);break;case"capture":case"download":d===!0?s.setAttribute(l,""):d!==!1&&d!=null&&typeof d!="function"&&typeof d!="symbol"?s.setAttribute(l,d):s.removeAttribute(l);break;case"cols":case"rows":case"size":case"span":d!=null&&typeof d!="function"&&typeof d!="symbol"&&!isNaN(d)&&1<=d?s.setAttribute(l,d):s.removeAttribute(l);break;case"rowSpan":case"start":d==null||typeof d=="function"||typeof d=="symbol"||isNaN(d)?s.removeAttribute(l):s.setAttribute(l,d);break;case"popover":Ze("beforetoggle",s),Ze("toggle",s),Io(s,"popover",d);break;case"xlinkActuate":en(s,"http://www.w3.org/1999/xlink","xlink:actuate",d);break;case"xlinkArcrole":en(s,"http://www.w3.org/1999/xlink","xlink:arcrole",d);break;case"xlinkRole":en(s,"http://www.w3.org/1999/xlink","xlink:role",d);break;case"xlinkShow":en(s,"http://www.w3.org/1999/xlink","xlink:show",d);break;case"xlinkTitle":en(s,"http://www.w3.org/1999/xlink","xlink:title",d);break;case"xlinkType":en(s,"http://www.w3.org/1999/xlink","xlink:type",d);break;case"xmlBase":en(s,"http://www.w3.org/XML/1998/namespace","xml:base",d);break;case"xmlLang":en(s,"http://www.w3.org/XML/1998/namespace","xml:lang",d);break;case"xmlSpace":en(s,"http://www.w3.org/XML/1998/namespace","xml:space",d);break;case"is":Io(s,"is",d);break;case"innerText":case"textContent":break;default:(!(2<l.length)||l[0]!=="o"&&l[0]!=="O"||l[1]!=="n"&&l[1]!=="N")&&(l=vd.get(l)||l,Io(s,l,d))}}function Jp(s,i,l,d,y,b){switch(l){case"style":vc(s,d,b);break;case"dangerouslySetInnerHTML":if(d!=null){if(typeof d!="object"||!("__html"in d))throw Error(r(61));if(l=d.__html,l!=null){if(y.children!=null)throw Error(r(60));s.innerHTML=l}}break;case"children":typeof d=="string"?Kn(s,d):(typeof d=="number"||typeof d=="bigint")&&Kn(s,""+d);break;case"onScroll":d!=null&&Ze("scroll",s);break;case"onScrollEnd":d!=null&&Ze("scrollend",s);break;case"onClick":d!=null&&(s.onclick=qr);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!fc.hasOwnProperty(l))e:{if(l[0]==="o"&&l[1]==="n"&&(y=l.endsWith("Capture"),i=l.slice(2,y?l.length-7:void 0),b=s[_n]||null,b=b!=null?b[l]:null,typeof b=="function"&&s.removeEventListener(i,b,y),typeof d=="function")){typeof b!="function"&&b!==null&&(l in s?s[l]=null:s.hasAttribute(l)&&s.removeAttribute(l)),s.addEventListener(i,d,y);break e}l in s?s[l]=d:d===!0?s.setAttribute(l,""):Io(s,l,d)}}}function jn(s,i,l){switch(i){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Ze("error",s),Ze("load",s);var d=!1,y=!1,b;for(b in l)if(l.hasOwnProperty(b)){var R=l[b];if(R!=null)switch(b){case"src":d=!0;break;case"srcSet":y=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(r(137,i));default:wt(s,i,b,R,l,null)}}y&&wt(s,i,"srcSet",l.srcSet,l,null),d&&wt(s,i,"src",l.src,l,null);return;case"input":Ze("invalid",s);var F=b=R=y=null,X=null,ue=null;for(d in l)if(l.hasOwnProperty(d)){var me=l[d];if(me!=null)switch(d){case"name":y=me;break;case"type":R=me;break;case"checked":X=me;break;case"defaultChecked":ue=me;break;case"value":b=me;break;case"defaultValue":F=me;break;case"children":case"dangerouslySetInnerHTML":if(me!=null)throw Error(r(137,i));break;default:wt(s,i,d,me,l,null)}}yd(s,b,F,X,ue,R,y,!1);return;case"select":Ze("invalid",s),d=R=b=null;for(y in l)if(l.hasOwnProperty(y)&&(F=l[y],F!=null))switch(y){case"value":b=F;break;case"defaultValue":R=F;break;case"multiple":d=F;default:wt(s,i,y,F,l,null)}i=b,l=R,s.multiple=!!d,i!=null?Si(s,!!d,i,!1):l!=null&&Si(s,!!d,l,!0);return;case"textarea":Ze("invalid",s),b=y=d=null;for(R in l)if(l.hasOwnProperty(R)&&(F=l[R],F!=null))switch(R){case"value":d=F;break;case"defaultValue":y=F;break;case"children":b=F;break;case"dangerouslySetInnerHTML":if(F!=null)throw Error(r(91));break;default:wt(s,i,R,F,l,null)}wi(s,d,y,b);return;case"option":for(X in l)l.hasOwnProperty(X)&&(d=l[X],d!=null)&&(X==="selected"?s.selected=d&&typeof d!="function"&&typeof d!="symbol":wt(s,i,X,d,l,null));return;case"dialog":Ze("beforetoggle",s),Ze("toggle",s),Ze("cancel",s),Ze("close",s);break;case"iframe":case"object":Ze("load",s);break;case"video":case"audio":for(d=0;d<eu.length;d++)Ze(eu[d],s);break;case"image":Ze("error",s),Ze("load",s);break;case"details":Ze("toggle",s);break;case"embed":case"source":case"link":Ze("error",s),Ze("load",s);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(ue in l)if(l.hasOwnProperty(ue)&&(d=l[ue],d!=null))switch(ue){case"children":case"dangerouslySetInnerHTML":throw Error(r(137,i));default:wt(s,i,ue,d,l,null)}return;default:if(ko(i)){for(me in l)l.hasOwnProperty(me)&&(d=l[me],d!==void 0&&Jp(s,i,me,d,l,void 0));return}}for(F in l)l.hasOwnProperty(F)&&(d=l[F],d!=null&&wt(s,i,F,d,l,null))}function oj(s,i,l,d){switch(i){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var y=null,b=null,R=null,F=null,X=null,ue=null,me=null;for(fe in l){var be=l[fe];if(l.hasOwnProperty(fe)&&be!=null)switch(fe){case"checked":break;case"value":break;case"defaultValue":X=be;default:d.hasOwnProperty(fe)||wt(s,i,fe,null,d,be)}}for(var de in d){var fe=d[de];if(be=l[de],d.hasOwnProperty(de)&&(fe!=null||be!=null))switch(de){case"type":b=fe;break;case"name":y=fe;break;case"checked":ue=fe;break;case"defaultChecked":me=fe;break;case"value":R=fe;break;case"defaultValue":F=fe;break;case"children":case"dangerouslySetInnerHTML":if(fe!=null)throw Error(r(137,i));break;default:fe!==be&&wt(s,i,de,fe,d,be)}}Mo(s,R,F,X,ue,me,b,y);return;case"select":fe=R=F=de=null;for(b in l)if(X=l[b],l.hasOwnProperty(b)&&X!=null)switch(b){case"value":break;case"multiple":fe=X;default:d.hasOwnProperty(b)||wt(s,i,b,null,d,X)}for(y in d)if(b=d[y],X=l[y],d.hasOwnProperty(y)&&(b!=null||X!=null))switch(y){case"value":de=b;break;case"defaultValue":F=b;break;case"multiple":R=b;default:b!==X&&wt(s,i,y,b,d,X)}i=F,l=R,d=fe,de!=null?Si(s,!!l,de,!1):!!d!=!!l&&(i!=null?Si(s,!!l,i,!0):Si(s,!!l,l?[]:"",!1));return;case"textarea":fe=de=null;for(F in l)if(y=l[F],l.hasOwnProperty(F)&&y!=null&&!d.hasOwnProperty(F))switch(F){case"value":break;case"children":break;default:wt(s,i,F,null,d,y)}for(R in d)if(y=d[R],b=l[R],d.hasOwnProperty(R)&&(y!=null||b!=null))switch(R){case"value":de=y;break;case"defaultValue":fe=y;break;case"children":break;case"dangerouslySetInnerHTML":if(y!=null)throw Error(r(91));break;default:y!==b&&wt(s,i,R,y,d,b)}_d(s,de,fe);return;case"option":for(var Ie in l)de=l[Ie],l.hasOwnProperty(Ie)&&de!=null&&!d.hasOwnProperty(Ie)&&(Ie==="selected"?s.selected=!1:wt(s,i,Ie,null,d,de));for(X in d)de=d[X],fe=l[X],d.hasOwnProperty(X)&&de!==fe&&(de!=null||fe!=null)&&(X==="selected"?s.selected=de&&typeof de!="function"&&typeof de!="symbol":wt(s,i,X,de,d,fe));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var ze in l)de=l[ze],l.hasOwnProperty(ze)&&de!=null&&!d.hasOwnProperty(ze)&&wt(s,i,ze,null,d,de);for(ue in d)if(de=d[ue],fe=l[ue],d.hasOwnProperty(ue)&&de!==fe&&(de!=null||fe!=null))switch(ue){case"children":case"dangerouslySetInnerHTML":if(de!=null)throw Error(r(137,i));break;default:wt(s,i,ue,de,d,fe)}return;default:if(ko(i)){for(var Et in l)de=l[Et],l.hasOwnProperty(Et)&&de!==void 0&&!d.hasOwnProperty(Et)&&Jp(s,i,Et,void 0,d,de);for(me in d)de=d[me],fe=l[me],!d.hasOwnProperty(me)||de===fe||de===void 0&&fe===void 0||Jp(s,i,me,de,d,fe);return}}for(var re in l)de=l[re],l.hasOwnProperty(re)&&de!=null&&!d.hasOwnProperty(re)&&wt(s,i,re,null,d,de);for(be in d)de=d[be],fe=l[be],!d.hasOwnProperty(be)||de===fe||de==null&&fe==null||wt(s,i,be,de,d,fe)}function Iv(s){switch(s){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function lj(){if(typeof performance.getEntriesByType=="function"){for(var s=0,i=0,l=performance.getEntriesByType("resource"),d=0;d<l.length;d++){var y=l[d],b=y.transferSize,R=y.initiatorType,F=y.duration;if(b&&F&&Iv(R)){for(R=0,F=y.responseEnd,d+=1;d<l.length;d++){var X=l[d],ue=X.startTime;if(ue>F)break;var me=X.transferSize,be=X.initiatorType;me&&Iv(be)&&(X=X.responseEnd,R+=me*(X<F?1:(F-ue)/(X-ue)))}if(--d,i+=8*(b+R)/(y.duration/1e3),s++,10<s)break}}if(0<s)return i/s/1e6}return navigator.connection&&(s=navigator.connection.downlink,typeof s=="number")?s:5}var Zp=null,eg=null;function xh(s){return s.nodeType===9?s:s.ownerDocument}function Mv(s){switch(s){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function kv(s,i){if(s===0)switch(i){case"svg":return 1;case"math":return 2;default:return 0}return s===1&&i==="foreignObject"?0:s}function tg(s,i){return s==="textarea"||s==="noscript"||typeof i.children=="string"||typeof i.children=="number"||typeof i.children=="bigint"||typeof i.dangerouslySetInnerHTML=="object"&&i.dangerouslySetInnerHTML!==null&&i.dangerouslySetInnerHTML.__html!=null}var ng=null;function cj(){var s=window.event;return s&&s.type==="popstate"?s===ng?!1:(ng=s,!0):(ng=null,!1)}var Ov=typeof setTimeout=="function"?setTimeout:void 0,uj=typeof clearTimeout=="function"?clearTimeout:void 0,Nv=typeof Promise=="function"?Promise:void 0,dj=typeof queueMicrotask=="function"?queueMicrotask:typeof Nv<"u"?function(s){return Nv.resolve(null).then(s).catch(hj)}:Ov;function hj(s){setTimeout(function(){throw s})}function Gi(s){return s==="head"}function Pv(s,i){var l=i,d=0;do{var y=l.nextSibling;if(s.removeChild(l),y&&y.nodeType===8)if(l=y.data,l==="/$"||l==="/&"){if(d===0){s.removeChild(y),ml(i);return}d--}else if(l==="$"||l==="$?"||l==="$~"||l==="$!"||l==="&")d++;else if(l==="html")nu(s.ownerDocument.documentElement);else if(l==="head"){l=s.ownerDocument.head,nu(l);for(var b=l.firstChild;b;){var R=b.nextSibling,F=b.nodeName;b[ds]||F==="SCRIPT"||F==="STYLE"||F==="LINK"&&b.rel.toLowerCase()==="stylesheet"||l.removeChild(b),b=R}}else l==="body"&&nu(s.ownerDocument.body);l=y}while(l);ml(i)}function Bv(s,i){var l=s;s=0;do{var d=l.nextSibling;if(l.nodeType===1?i?(l._stashedDisplay=l.style.display,l.style.display="none"):(l.style.display=l._stashedDisplay||"",l.getAttribute("style")===""&&l.removeAttribute("style")):l.nodeType===3&&(i?(l._stashedText=l.nodeValue,l.nodeValue=""):l.nodeValue=l._stashedText||""),d&&d.nodeType===8)if(l=d.data,l==="/$"){if(s===0)break;s--}else l!=="$"&&l!=="$?"&&l!=="$~"&&l!=="$!"||s++;l=d}while(l)}function rg(s){var i=s.firstChild;for(i&&i.nodeType===10&&(i=i.nextSibling);i;){var l=i;switch(i=i.nextSibling,l.nodeName){case"HTML":case"HEAD":case"BODY":rg(l),Do(l);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(l.rel.toLowerCase()==="stylesheet")continue}s.removeChild(l)}}function fj(s,i,l,d){for(;s.nodeType===1;){var y=l;if(s.nodeName.toLowerCase()!==i.toLowerCase()){if(!d&&(s.nodeName!=="INPUT"||s.type!=="hidden"))break}else if(d){if(!s[ds])switch(i){case"meta":if(!s.hasAttribute("itemprop"))break;return s;case"link":if(b=s.getAttribute("rel"),b==="stylesheet"&&s.hasAttribute("data-precedence"))break;if(b!==y.rel||s.getAttribute("href")!==(y.href==null||y.href===""?null:y.href)||s.getAttribute("crossorigin")!==(y.crossOrigin==null?null:y.crossOrigin)||s.getAttribute("title")!==(y.title==null?null:y.title))break;return s;case"style":if(s.hasAttribute("data-precedence"))break;return s;case"script":if(b=s.getAttribute("src"),(b!==(y.src==null?null:y.src)||s.getAttribute("type")!==(y.type==null?null:y.type)||s.getAttribute("crossorigin")!==(y.crossOrigin==null?null:y.crossOrigin))&&b&&s.hasAttribute("async")&&!s.hasAttribute("itemprop"))break;return s;default:return s}}else if(i==="input"&&s.type==="hidden"){var b=y.name==null?null:""+y.name;if(y.type==="hidden"&&s.getAttribute("name")===b)return s}else return s;if(s=kr(s.nextSibling),s===null)break}return null}function mj(s,i,l){if(i==="")return null;for(;s.nodeType!==3;)if((s.nodeType!==1||s.nodeName!=="INPUT"||s.type!=="hidden")&&!l||(s=kr(s.nextSibling),s===null))return null;return s}function Lv(s,i){for(;s.nodeType!==8;)if((s.nodeType!==1||s.nodeName!=="INPUT"||s.type!=="hidden")&&!i||(s=kr(s.nextSibling),s===null))return null;return s}function sg(s){return s.data==="$?"||s.data==="$~"}function ig(s){return s.data==="$!"||s.data==="$?"&&s.ownerDocument.readyState!=="loading"}function pj(s,i){var l=s.ownerDocument;if(s.data==="$~")s._reactRetry=i;else if(s.data!=="$?"||l.readyState!=="loading")i();else{var d=function(){i(),l.removeEventListener("DOMContentLoaded",d)};l.addEventListener("DOMContentLoaded",d),s._reactRetry=d}}function kr(s){for(;s!=null;s=s.nextSibling){var i=s.nodeType;if(i===1||i===3)break;if(i===8){if(i=s.data,i==="$"||i==="$!"||i==="$?"||i==="$~"||i==="&"||i==="F!"||i==="F")break;if(i==="/$"||i==="/&")return null}}return s}var ag=null;function zv(s){s=s.nextSibling;for(var i=0;s;){if(s.nodeType===8){var l=s.data;if(l==="/$"||l==="/&"){if(i===0)return kr(s.nextSibling);i--}else l!=="$"&&l!=="$!"&&l!=="$?"&&l!=="$~"&&l!=="&"||i++}s=s.nextSibling}return null}function Uv(s){s=s.previousSibling;for(var i=0;s;){if(s.nodeType===8){var l=s.data;if(l==="$"||l==="$!"||l==="$?"||l==="$~"||l==="&"){if(i===0)return s;i--}else l!=="/$"&&l!=="/&"||i++}s=s.previousSibling}return null}function Fv(s,i,l){switch(i=xh(l),s){case"html":if(s=i.documentElement,!s)throw Error(r(452));return s;case"head":if(s=i.head,!s)throw Error(r(453));return s;case"body":if(s=i.body,!s)throw Error(r(454));return s;default:throw Error(r(451))}}function nu(s){for(var i=s.attributes;i.length;)s.removeAttributeNode(i[0]);Do(s)}var Or=new Map,Vv=new Set;function Sh(s){return typeof s.getRootNode=="function"?s.getRootNode():s.nodeType===9?s:s.ownerDocument}var si=V.d;V.d={f:gj,r:yj,D:_j,C:bj,L:vj,m:xj,X:wj,S:Sj,M:Ej};function gj(){var s=si.f(),i=fh();return s||i}function yj(s){var i=wr(s);i!==null&&i.tag===5&&i.type==="form"?ib(i):si.r(s)}var dl=typeof document>"u"?null:document;function $v(s,i,l){var d=dl;if(d&&typeof i=="string"&&i){var y=Wn(i);y='link[rel="'+s+'"][href="'+y+'"]',typeof l=="string"&&(y+='[crossorigin="'+l+'"]'),Vv.has(y)||(Vv.add(y),s={rel:s,crossOrigin:l,href:i},d.querySelector(y)===null&&(i=d.createElement("link"),jn(i,"link",s),Zt(i),d.head.appendChild(i)))}}function _j(s){si.D(s),$v("dns-prefetch",s,null)}function bj(s,i){si.C(s,i),$v("preconnect",s,i)}function vj(s,i,l){si.L(s,i,l);var d=dl;if(d&&s&&i){var y='link[rel="preload"][as="'+Wn(i)+'"]';i==="image"&&l&&l.imageSrcSet?(y+='[imagesrcset="'+Wn(l.imageSrcSet)+'"]',typeof l.imageSizes=="string"&&(y+='[imagesizes="'+Wn(l.imageSizes)+'"]')):y+='[href="'+Wn(s)+'"]';var b=y;switch(i){case"style":b=hl(s);break;case"script":b=fl(s)}Or.has(b)||(s=_({rel:"preload",href:i==="image"&&l&&l.imageSrcSet?void 0:s,as:i},l),Or.set(b,s),d.querySelector(y)!==null||i==="style"&&d.querySelector(ru(b))||i==="script"&&d.querySelector(su(b))||(i=d.createElement("link"),jn(i,"link",s),Zt(i),d.head.appendChild(i)))}}function xj(s,i){si.m(s,i);var l=dl;if(l&&s){var d=i&&typeof i.as=="string"?i.as:"script",y='link[rel="modulepreload"][as="'+Wn(d)+'"][href="'+Wn(s)+'"]',b=y;switch(d){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":b=fl(s)}if(!Or.has(b)&&(s=_({rel:"modulepreload",href:s},i),Or.set(b,s),l.querySelector(y)===null)){switch(d){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(l.querySelector(su(b)))return}d=l.createElement("link"),jn(d,"link",s),Zt(d),l.head.appendChild(d)}}}function Sj(s,i,l){si.S(s,i,l);var d=dl;if(d&&s){var y=fs(d).hoistableStyles,b=hl(s);i=i||"default";var R=y.get(b);if(!R){var F={loading:0,preload:null};if(R=d.querySelector(ru(b)))F.loading=5;else{s=_({rel:"stylesheet",href:s,"data-precedence":i},l),(l=Or.get(b))&&og(s,l);var X=R=d.createElement("link");Zt(X),jn(X,"link",s),X._p=new Promise(function(ue,me){X.onload=ue,X.onerror=me}),X.addEventListener("load",function(){F.loading|=1}),X.addEventListener("error",function(){F.loading|=2}),F.loading|=4,wh(R,i,d)}R={type:"stylesheet",instance:R,count:1,state:F},y.set(b,R)}}}function wj(s,i){si.X(s,i);var l=dl;if(l&&s){var d=fs(l).hoistableScripts,y=fl(s),b=d.get(y);b||(b=l.querySelector(su(y)),b||(s=_({src:s,async:!0},i),(i=Or.get(y))&&lg(s,i),b=l.createElement("script"),Zt(b),jn(b,"link",s),l.head.appendChild(b)),b={type:"script",instance:b,count:1,state:null},d.set(y,b))}}function Ej(s,i){si.M(s,i);var l=dl;if(l&&s){var d=fs(l).hoistableScripts,y=fl(s),b=d.get(y);b||(b=l.querySelector(su(y)),b||(s=_({src:s,async:!0,type:"module"},i),(i=Or.get(y))&&lg(s,i),b=l.createElement("script"),Zt(b),jn(b,"link",s),l.head.appendChild(b)),b={type:"script",instance:b,count:1,state:null},d.set(y,b))}}function qv(s,i,l,d){var y=(y=le.current)?Sh(y):null;if(!y)throw Error(r(446));switch(s){case"meta":case"title":return null;case"style":return typeof l.precedence=="string"&&typeof l.href=="string"?(i=hl(l.href),l=fs(y).hoistableStyles,d=l.get(i),d||(d={type:"style",instance:null,count:0,state:null},l.set(i,d)),d):{type:"void",instance:null,count:0,state:null};case"link":if(l.rel==="stylesheet"&&typeof l.href=="string"&&typeof l.precedence=="string"){s=hl(l.href);var b=fs(y).hoistableStyles,R=b.get(s);if(R||(y=y.ownerDocument||y,R={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},b.set(s,R),(b=y.querySelector(ru(s)))&&!b._p&&(R.instance=b,R.state.loading=5),Or.has(s)||(l={rel:"preload",as:"style",href:l.href,crossOrigin:l.crossOrigin,integrity:l.integrity,media:l.media,hrefLang:l.hrefLang,referrerPolicy:l.referrerPolicy},Or.set(s,l),b||Cj(y,s,l,R.state))),i&&d===null)throw Error(r(528,""));return R}if(i&&d!==null)throw Error(r(529,""));return null;case"script":return i=l.async,l=l.src,typeof l=="string"&&i&&typeof i!="function"&&typeof i!="symbol"?(i=fl(l),l=fs(y).hoistableScripts,d=l.get(i),d||(d={type:"script",instance:null,count:0,state:null},l.set(i,d)),d):{type:"void",instance:null,count:0,state:null};default:throw Error(r(444,s))}}function hl(s){return'href="'+Wn(s)+'"'}function ru(s){return'link[rel="stylesheet"]['+s+"]"}function Hv(s){return _({},s,{"data-precedence":s.precedence,precedence:null})}function Cj(s,i,l,d){s.querySelector('link[rel="preload"][as="style"]['+i+"]")?d.loading=1:(i=s.createElement("link"),d.preload=i,i.addEventListener("load",function(){return d.loading|=1}),i.addEventListener("error",function(){return d.loading|=2}),jn(i,"link",l),Zt(i),s.head.appendChild(i))}function fl(s){return'[src="'+Wn(s)+'"]'}function su(s){return"script[async]"+s}function Gv(s,i,l){if(i.count++,i.instance===null)switch(i.type){case"style":var d=s.querySelector('style[data-href~="'+Wn(l.href)+'"]');if(d)return i.instance=d,Zt(d),d;var y=_({},l,{"data-href":l.href,"data-precedence":l.precedence,href:null,precedence:null});return d=(s.ownerDocument||s).createElement("style"),Zt(d),jn(d,"style",y),wh(d,l.precedence,s),i.instance=d;case"stylesheet":y=hl(l.href);var b=s.querySelector(ru(y));if(b)return i.state.loading|=4,i.instance=b,Zt(b),b;d=Hv(l),(y=Or.get(y))&&og(d,y),b=(s.ownerDocument||s).createElement("link"),Zt(b);var R=b;return R._p=new Promise(function(F,X){R.onload=F,R.onerror=X}),jn(b,"link",d),i.state.loading|=4,wh(b,l.precedence,s),i.instance=b;case"script":return b=fl(l.src),(y=s.querySelector(su(b)))?(i.instance=y,Zt(y),y):(d=l,(y=Or.get(b))&&(d=_({},l),lg(d,y)),s=s.ownerDocument||s,y=s.createElement("script"),Zt(y),jn(y,"link",d),s.head.appendChild(y),i.instance=y);case"void":return null;default:throw Error(r(443,i.type))}else i.type==="stylesheet"&&(i.state.loading&4)===0&&(d=i.instance,i.state.loading|=4,wh(d,l.precedence,s));return i.instance}function wh(s,i,l){for(var d=l.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),y=d.length?d[d.length-1]:null,b=y,R=0;R<d.length;R++){var F=d[R];if(F.dataset.precedence===i)b=F;else if(b!==y)break}b?b.parentNode.insertBefore(s,b.nextSibling):(i=l.nodeType===9?l.head:l,i.insertBefore(s,i.firstChild))}function og(s,i){s.crossOrigin==null&&(s.crossOrigin=i.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=i.referrerPolicy),s.title==null&&(s.title=i.title)}function lg(s,i){s.crossOrigin==null&&(s.crossOrigin=i.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=i.referrerPolicy),s.integrity==null&&(s.integrity=i.integrity)}var Eh=null;function Qv(s,i,l){if(Eh===null){var d=new Map,y=Eh=new Map;y.set(l,d)}else y=Eh,d=y.get(l),d||(d=new Map,y.set(l,d));if(d.has(s))return d;for(d.set(s,null),l=l.getElementsByTagName(s),y=0;y<l.length;y++){var b=l[y];if(!(b[ds]||b[Jt]||s==="link"&&b.getAttribute("rel")==="stylesheet")&&b.namespaceURI!=="http://www.w3.org/2000/svg"){var R=b.getAttribute(i)||"";R=s+R;var F=d.get(R);F?F.push(b):d.set(R,[b])}}return d}function Wv(s,i,l){s=s.ownerDocument||s,s.head.insertBefore(l,i==="title"?s.querySelector("head > title"):null)}function Tj(s,i,l){if(l===1||i.itemProp!=null)return!1;switch(s){case"meta":case"title":return!0;case"style":if(typeof i.precedence!="string"||typeof i.href!="string"||i.href==="")break;return!0;case"link":if(typeof i.rel!="string"||typeof i.href!="string"||i.href===""||i.onLoad||i.onError)break;return i.rel==="stylesheet"?(s=i.disabled,typeof i.precedence=="string"&&s==null):!0;case"script":if(i.async&&typeof i.async!="function"&&typeof i.async!="symbol"&&!i.onLoad&&!i.onError&&i.src&&typeof i.src=="string")return!0}return!1}function Kv(s){return!(s.type==="stylesheet"&&(s.state.loading&3)===0)}function Aj(s,i,l,d){if(l.type==="stylesheet"&&(typeof d.media!="string"||matchMedia(d.media).matches!==!1)&&(l.state.loading&4)===0){if(l.instance===null){var y=hl(d.href),b=i.querySelector(ru(y));if(b){i=b._p,i!==null&&typeof i=="object"&&typeof i.then=="function"&&(s.count++,s=Ch.bind(s),i.then(s,s)),l.state.loading|=4,l.instance=b,Zt(b);return}b=i.ownerDocument||i,d=Hv(d),(y=Or.get(y))&&og(d,y),b=b.createElement("link"),Zt(b);var R=b;R._p=new Promise(function(F,X){R.onload=F,R.onerror=X}),jn(b,"link",d),l.instance=b}s.stylesheets===null&&(s.stylesheets=new Map),s.stylesheets.set(l,i),(i=l.state.preload)&&(l.state.loading&3)===0&&(s.count++,l=Ch.bind(s),i.addEventListener("load",l),i.addEventListener("error",l))}}var cg=0;function jj(s,i){return s.stylesheets&&s.count===0&&Ah(s,s.stylesheets),0<s.count||0<s.imgCount?function(l){var d=setTimeout(function(){if(s.stylesheets&&Ah(s,s.stylesheets),s.unsuspend){var b=s.unsuspend;s.unsuspend=null,b()}},6e4+i);0<s.imgBytes&&cg===0&&(cg=62500*lj());var y=setTimeout(function(){if(s.waitingForImages=!1,s.count===0&&(s.stylesheets&&Ah(s,s.stylesheets),s.unsuspend)){var b=s.unsuspend;s.unsuspend=null,b()}},(s.imgBytes>cg?50:800)+i);return s.unsuspend=l,function(){s.unsuspend=null,clearTimeout(d),clearTimeout(y)}}:null}function Ch(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)Ah(this,this.stylesheets);else if(this.unsuspend){var s=this.unsuspend;this.unsuspend=null,s()}}}var Th=null;function Ah(s,i){s.stylesheets=null,s.unsuspend!==null&&(s.count++,Th=new Map,i.forEach(Rj,s),Th=null,Ch.call(s))}function Rj(s,i){if(!(i.state.loading&4)){var l=Th.get(s);if(l)var d=l.get(null);else{l=new Map,Th.set(s,l);for(var y=s.querySelectorAll("link[data-precedence],style[data-precedence]"),b=0;b<y.length;b++){var R=y[b];(R.nodeName==="LINK"||R.getAttribute("media")!=="not all")&&(l.set(R.dataset.precedence,R),d=R)}d&&l.set(null,d)}y=i.instance,R=y.getAttribute("data-precedence"),b=l.get(R)||d,b===d&&l.set(null,y),l.set(R,y),this.count++,d=Ch.bind(this),y.addEventListener("load",d),y.addEventListener("error",d),b?b.parentNode.insertBefore(y,b.nextSibling):(s=s.nodeType===9?s.head:s,s.insertBefore(y,s.firstChild)),i.state.loading|=4}}var iu={$$typeof:M,Provider:null,Consumer:null,_currentValue:W,_currentValue2:W,_threadCount:0};function Dj(s,i,l,d,y,b,R,F,X){this.tag=1,this.containerInfo=s,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=cs(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=cs(0),this.hiddenUpdates=cs(null),this.identifierPrefix=d,this.onUncaughtError=y,this.onCaughtError=b,this.onRecoverableError=R,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=X,this.incompleteTransitions=new Map}function Yv(s,i,l,d,y,b,R,F,X,ue,me,be){return s=new Dj(s,i,l,R,X,ue,me,be,F),i=1,b===!0&&(i|=24),b=cr(3,null,null,i),s.current=b,b.stateNode=s,i=Vm(),i.refCount++,s.pooledCache=i,i.refCount++,b.memoizedState={element:d,isDehydrated:l,cache:i},Gm(b),s}function Xv(s){return s?(s=qo,s):qo}function Jv(s,i,l,d,y,b){y=Xv(y),d.context===null?d.context=y:d.pendingContext=y,d=Ni(i),d.payload={element:l},b=b===void 0?null:b,b!==null&&(d.callback=b),l=Pi(s,d,i),l!==null&&(er(l,s,i),Bc(l,s,i))}function Zv(s,i){if(s=s.memoizedState,s!==null&&s.dehydrated!==null){var l=s.retryLane;s.retryLane=l!==0&&l<i?l:i}}function ug(s,i){Zv(s,i),(s=s.alternate)&&Zv(s,i)}function ex(s){if(s.tag===13||s.tag===31){var i=qa(s,67108864);i!==null&&er(i,s,67108864),ug(s,67108864)}}function tx(s){if(s.tag===13||s.tag===31){var i=mr();i=Ma(i);var l=qa(s,i);l!==null&&er(l,s,i),ug(s,i)}}var jh=!0;function Ij(s,i,l,d){var y=z.T;z.T=null;var b=V.p;try{V.p=2,dg(s,i,l,d)}finally{V.p=b,z.T=y}}function Mj(s,i,l,d){var y=z.T;z.T=null;var b=V.p;try{V.p=8,dg(s,i,l,d)}finally{V.p=b,z.T=y}}function dg(s,i,l,d){if(jh){var y=hg(d);if(y===null)Xp(s,i,d,Rh,l),rx(s,d);else if(Oj(y,s,i,l,d))d.stopPropagation();else if(rx(s,d),i&4&&-1<kj.indexOf(s)){for(;y!==null;){var b=wr(y);if(b!==null)switch(b.tag){case 3:if(b=b.stateNode,b.current.memoizedState.isDehydrated){var R=os(b.pendingLanes);if(R!==0){var F=b;for(F.pendingLanes|=2,F.entangledLanes|=2;R;){var X=1<<31-Ht(R);F.entanglements[1]|=X,R&=~X}Ts(b),(gt&6)===0&&(dh=dn()+500,Zc(0))}}break;case 31:case 13:F=qa(b,2),F!==null&&er(F,b,2),fh(),ug(b,2)}if(b=hg(d),b===null&&Xp(s,i,d,Rh,l),b===y)break;y=b}y!==null&&d.stopPropagation()}else Xp(s,i,d,null,l)}}function hg(s){return s=Er(s),fg(s)}var Rh=null;function fg(s){if(Rh=null,s=hs(s),s!==null){var i=o(s);if(i===null)s=null;else{var l=i.tag;if(l===13){if(s=u(i),s!==null)return s;s=null}else if(l===31){if(s=h(i),s!==null)return s;s=null}else if(l===3){if(i.stateNode.current.memoizedState.isDehydrated)return i.tag===3?i.stateNode.containerInfo:null;s=null}else i!==s&&(s=null)}}return Rh=s,null}function nx(s){switch(s){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(zr()){case lc:return 2;case cc:return 8;case vi:case bm:return 32;case od:return 268435456;default:return 32}default:return 32}}var mg=!1,Qi=null,Wi=null,Ki=null,au=new Map,ou=new Map,Yi=[],kj="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function rx(s,i){switch(s){case"focusin":case"focusout":Qi=null;break;case"dragenter":case"dragleave":Wi=null;break;case"mouseover":case"mouseout":Ki=null;break;case"pointerover":case"pointerout":au.delete(i.pointerId);break;case"gotpointercapture":case"lostpointercapture":ou.delete(i.pointerId)}}function lu(s,i,l,d,y,b){return s===null||s.nativeEvent!==b?(s={blockedOn:i,domEventName:l,eventSystemFlags:d,nativeEvent:b,targetContainers:[y]},i!==null&&(i=wr(i),i!==null&&ex(i)),s):(s.eventSystemFlags|=d,i=s.targetContainers,y!==null&&i.indexOf(y)===-1&&i.push(y),s)}function Oj(s,i,l,d,y){switch(i){case"focusin":return Qi=lu(Qi,s,i,l,d,y),!0;case"dragenter":return Wi=lu(Wi,s,i,l,d,y),!0;case"mouseover":return Ki=lu(Ki,s,i,l,d,y),!0;case"pointerover":var b=y.pointerId;return au.set(b,lu(au.get(b)||null,s,i,l,d,y)),!0;case"gotpointercapture":return b=y.pointerId,ou.set(b,lu(ou.get(b)||null,s,i,l,d,y)),!0}return!1}function sx(s){var i=hs(s.target);if(i!==null){var l=o(i);if(l!==null){if(i=l.tag,i===13){if(i=u(l),i!==null){s.blockedOn=i,Vr(s.priority,function(){tx(l)});return}}else if(i===31){if(i=h(l),i!==null){s.blockedOn=i,Vr(s.priority,function(){tx(l)});return}}else if(i===3&&l.stateNode.current.memoizedState.isDehydrated){s.blockedOn=l.tag===3?l.stateNode.containerInfo:null;return}}}s.blockedOn=null}function Dh(s){if(s.blockedOn!==null)return!1;for(var i=s.targetContainers;0<i.length;){var l=hg(s.nativeEvent);if(l===null){l=s.nativeEvent;var d=new l.constructor(l.type,l);xc=d,l.target.dispatchEvent(d),xc=null}else return i=wr(l),i!==null&&ex(i),s.blockedOn=l,!1;i.shift()}return!0}function ix(s,i,l){Dh(s)&&l.delete(i)}function Nj(){mg=!1,Qi!==null&&Dh(Qi)&&(Qi=null),Wi!==null&&Dh(Wi)&&(Wi=null),Ki!==null&&Dh(Ki)&&(Ki=null),au.forEach(ix),ou.forEach(ix)}function Ih(s,i){s.blockedOn===i&&(s.blockedOn=null,mg||(mg=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,Nj)))}var Mh=null;function ax(s){Mh!==s&&(Mh=s,t.unstable_scheduleCallback(t.unstable_NormalPriority,function(){Mh===s&&(Mh=null);for(var i=0;i<s.length;i+=3){var l=s[i],d=s[i+1],y=s[i+2];if(typeof d!="function"){if(fg(d||l)===null)continue;break}var b=wr(l);b!==null&&(s.splice(i,3),i-=3,hp(b,{pending:!0,data:y,method:l.method,action:d},d,y))}}))}function ml(s){function i(X){return Ih(X,s)}Qi!==null&&Ih(Qi,s),Wi!==null&&Ih(Wi,s),Ki!==null&&Ih(Ki,s),au.forEach(i),ou.forEach(i);for(var l=0;l<Yi.length;l++){var d=Yi[l];d.blockedOn===s&&(d.blockedOn=null)}for(;0<Yi.length&&(l=Yi[0],l.blockedOn===null);)sx(l),l.blockedOn===null&&Yi.shift();if(l=(s.ownerDocument||s).$$reactFormReplay,l!=null)for(d=0;d<l.length;d+=3){var y=l[d],b=l[d+1],R=y[_n]||null;if(typeof b=="function")R||ax(l);else if(R){var F=null;if(b&&b.hasAttribute("formAction")){if(y=b,R=b[_n]||null)F=R.formAction;else if(fg(y)!==null)continue}else F=R.action;typeof F=="function"?l[d+1]=F:(l.splice(d,3),d-=3),ax(l)}}}function ox(){function s(b){b.canIntercept&&b.info==="react-transition"&&b.intercept({handler:function(){return new Promise(function(R){return y=R})},focusReset:"manual",scroll:"manual"})}function i(){y!==null&&(y(),y=null),d||setTimeout(l,20)}function l(){if(!d&&!navigation.transition){var b=navigation.currentEntry;b&&b.url!=null&&navigation.navigate(b.url,{state:b.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var d=!1,y=null;return navigation.addEventListener("navigate",s),navigation.addEventListener("navigatesuccess",i),navigation.addEventListener("navigateerror",i),setTimeout(l,100),function(){d=!0,navigation.removeEventListener("navigate",s),navigation.removeEventListener("navigatesuccess",i),navigation.removeEventListener("navigateerror",i),y!==null&&(y(),y=null)}}}function pg(s){this._internalRoot=s}kh.prototype.render=pg.prototype.render=function(s){var i=this._internalRoot;if(i===null)throw Error(r(409));var l=i.current,d=mr();Jv(l,d,s,i,null,null)},kh.prototype.unmount=pg.prototype.unmount=function(){var s=this._internalRoot;if(s!==null){this._internalRoot=null;var i=s.containerInfo;Jv(s.current,2,null,s,null,null),fh(),i[us]=null}};function kh(s){this._internalRoot=s}kh.prototype.unstable_scheduleHydration=function(s){if(s){var i=fd();s={blockedOn:null,target:s,priority:i};for(var l=0;l<Yi.length&&i!==0&&i<Yi[l].priority;l++);Yi.splice(l,0,s),l===0&&sx(s)}};var lx=e.version;if(lx!=="19.2.3")throw Error(r(527,lx,"19.2.3"));V.findDOMNode=function(s){var i=s._reactInternals;if(i===void 0)throw typeof s.render=="function"?Error(r(188)):(s=Object.keys(s).join(","),Error(r(268,s)));return s=m(i),s=s!==null?g(s):null,s=s===null?null:s.stateNode,s};var Pj={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:z,reconcilerVersion:"19.2.3"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Oh=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Oh.isDisabled&&Oh.supportsFiber)try{Ur=Oh.inject(Pj),wn=Oh}catch{}}return uu.createRoot=function(s,i){if(!a(s))throw Error(r(299));var l=!1,d="",y=pb,b=gb,R=yb;return i!=null&&(i.unstable_strictMode===!0&&(l=!0),i.identifierPrefix!==void 0&&(d=i.identifierPrefix),i.onUncaughtError!==void 0&&(y=i.onUncaughtError),i.onCaughtError!==void 0&&(b=i.onCaughtError),i.onRecoverableError!==void 0&&(R=i.onRecoverableError)),i=Yv(s,1,!1,null,null,l,d,null,y,b,R,ox),s[us]=i.current,Yp(s),new pg(i)},uu.hydrateRoot=function(s,i,l){if(!a(s))throw Error(r(299));var d=!1,y="",b=pb,R=gb,F=yb,X=null;return l!=null&&(l.unstable_strictMode===!0&&(d=!0),l.identifierPrefix!==void 0&&(y=l.identifierPrefix),l.onUncaughtError!==void 0&&(b=l.onUncaughtError),l.onCaughtError!==void 0&&(R=l.onCaughtError),l.onRecoverableError!==void 0&&(F=l.onRecoverableError),l.formState!==void 0&&(X=l.formState)),i=Yv(s,1,!0,i,l??null,d,y,X,b,R,F,ox),i.context=Xv(null),l=i.current,d=mr(),d=Ma(d),y=Ni(d),y.callback=null,Pi(l,y,d),l=d,i.current.lanes=l,Da(i,l),Ts(i),s[us]=i.current,Yp(s),new kh(i)},uu.version="19.2.3",uu}var _x;function Gj(){if(_x)return _g.exports;_x=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),_g.exports=Hj(),_g.exports}var Qj=Gj();var bx="popstate";function Wj(t={}){function e(r,a){let{pathname:o,search:u,hash:h}=r.location;return $g("",{pathname:o,search:u,hash:h},a.state&&a.state.usr||null,a.state&&a.state.key||"default")}function n(r,a){return typeof a=="string"?a:Eu(a)}return Yj(e,n,null,t)}function Lt(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function gr(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function Kj(){return Math.random().toString(36).substring(2,10)}function vx(t,e){return{usr:t.state,key:t.key,idx:e}}function $g(t,e,n=null,r){return{pathname:typeof t=="string"?t:t.pathname,search:"",hash:"",...typeof e=="string"?Vl(e):e,state:n,key:e&&e.key||r||Kj()}}function Eu({pathname:t="/",search:e="",hash:n=""}){return e&&e!=="?"&&(t+=e.charAt(0)==="?"?e:"?"+e),n&&n!=="#"&&(t+=n.charAt(0)==="#"?n:"#"+n),t}function Vl(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substring(n),t=t.substring(0,n));let r=t.indexOf("?");r>=0&&(e.search=t.substring(r),t=t.substring(0,r)),t&&(e.pathname=t)}return e}function Yj(t,e,n,r={}){let{window:a=document.defaultView,v5Compat:o=!1}=r,u=a.history,h="POP",f=null,m=g();m==null&&(m=0,u.replaceState({...u.state,idx:m},""));function g(){return(u.state||{idx:null}).idx}function _(){h="POP";let C=g(),I=C==null?null:C-m;m=C,f&&f({action:h,location:E.location,delta:I})}function v(C,I){h="PUSH";let j=$g(E.location,C,I);m=g()+1;let M=vx(j,m),Q=E.createHref(j);try{u.pushState(M,"",Q)}catch(q){if(q instanceof DOMException&&q.name==="DataCloneError")throw q;a.location.assign(Q)}o&&f&&f({action:h,location:E.location,delta:1})}function S(C,I){h="REPLACE";let j=$g(E.location,C,I);m=g();let M=vx(j,m),Q=E.createHref(j);u.replaceState(M,"",Q),o&&f&&f({action:h,location:E.location,delta:0})}function x(C){return Xj(C)}let E={get action(){return h},get location(){return t(a,u)},listen(C){if(f)throw new Error("A history only accepts one active listener");return a.addEventListener(bx,_),f=C,()=>{a.removeEventListener(bx,_),f=null}},createHref(C){return e(a,C)},createURL:x,encodeLocation(C){let I=x(C);return{pathname:I.pathname,search:I.search,hash:I.hash}},push:v,replace:S,go(C){return u.go(C)}};return E}function Xj(t,e=!1){let n="http://localhost";typeof window<"u"&&(n=window.location.origin!=="null"?window.location.origin:window.location.href),Lt(n,"No window.location.(origin|href) available to create URL");let r=typeof t=="string"?t:Eu(t);return r=r.replace(/ $/,"%20"),!e&&r.startsWith("//")&&(r=n+r),new URL(r,n)}function Gw(t,e,n="/"){return Jj(t,e,n,!1)}function Jj(t,e,n,r){let a=typeof e=="string"?Vl(e):e,o=ui(a.pathname||"/",n);if(o==null)return null;let u=Qw(t);Zj(u);let h=null;for(let f=0;h==null&&f<u.length;++f){let m=uR(o);h=lR(u[f],m,r)}return h}function Qw(t,e=[],n=[],r="",a=!1){let o=(u,h,f=a,m)=>{let g={relativePath:m===void 0?u.path||"":m,caseSensitive:u.caseSensitive===!0,childrenIndex:h,route:u};if(g.relativePath.startsWith("/")){if(!g.relativePath.startsWith(r)&&f)return;Lt(g.relativePath.startsWith(r),`Absolute route path "${g.relativePath}" nested under path "${r}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),g.relativePath=g.relativePath.slice(r.length)}let _=li([r,g.relativePath]),v=n.concat(g);u.children&&u.children.length>0&&(Lt(u.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${_}".`),Qw(u.children,e,v,_,f)),!(u.path==null&&!u.index)&&e.push({path:_,score:aR(_,u.index),routesMeta:v})};return t.forEach((u,h)=>{if(u.path===""||!u.path?.includes("?"))o(u,h);else for(let f of Ww(u.path))o(u,h,!0,f)}),e}function Ww(t){let e=t.split("/");if(e.length===0)return[];let[n,...r]=e,a=n.endsWith("?"),o=n.replace(/\?$/,"");if(r.length===0)return a?[o,""]:[o];let u=Ww(r.join("/")),h=[];return h.push(...u.map(f=>f===""?o:[o,f].join("/"))),a&&h.push(...u),h.map(f=>t.startsWith("/")&&f===""?"/":f)}function Zj(t){t.sort((e,n)=>e.score!==n.score?n.score-e.score:oR(e.routesMeta.map(r=>r.childrenIndex),n.routesMeta.map(r=>r.childrenIndex)))}var eR=/^:[\w-]+$/,tR=3,nR=2,rR=1,sR=10,iR=-2,xx=t=>t==="*";function aR(t,e){let n=t.split("/"),r=n.length;return n.some(xx)&&(r+=iR),e&&(r+=nR),n.filter(a=>!xx(a)).reduce((a,o)=>a+(eR.test(o)?tR:o===""?rR:sR),r)}function oR(t,e){return t.length===e.length&&t.slice(0,-1).every((r,a)=>r===e[a])?t[t.length-1]-e[e.length-1]:0}function lR(t,e,n=!1){let{routesMeta:r}=t,a={},o="/",u=[];for(let h=0;h<r.length;++h){let f=r[h],m=h===r.length-1,g=o==="/"?e:e.slice(o.length)||"/",_=af({path:f.relativePath,caseSensitive:f.caseSensitive,end:m},g),v=f.route;if(!_&&m&&n&&!r[r.length-1].route.index&&(_=af({path:f.relativePath,caseSensitive:f.caseSensitive,end:!1},g)),!_)return null;Object.assign(a,_.params),u.push({params:a,pathname:li([o,_.pathname]),pathnameBase:mR(li([o,_.pathnameBase])),route:v}),_.pathnameBase!=="/"&&(o=li([o,_.pathnameBase]))}return u}function af(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,r]=cR(t.path,t.caseSensitive,t.end),a=e.match(n);if(!a)return null;let o=a[0],u=o.replace(/(.)\/+$/,"$1"),h=a.slice(1);return{params:r.reduce((m,{paramName:g,isOptional:_},v)=>{if(g==="*"){let x=h[v]||"";u=o.slice(0,o.length-x.length).replace(/(.)\/+$/,"$1")}const S=h[v];return _&&!S?m[g]=void 0:m[g]=(S||"").replace(/%2F/g,"/"),m},{}),pathname:o,pathnameBase:u,pattern:t}}function cR(t,e=!1,n=!0){gr(t==="*"||!t.endsWith("*")||t.endsWith("/*"),`Route path "${t}" will be treated as if it were "${t.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${t.replace(/\*$/,"/*")}".`);let r=[],a="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(u,h,f)=>(r.push({paramName:h,isOptional:f!=null}),f?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return t.endsWith("*")?(r.push({paramName:"*"}),a+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?a+="\\/*$":t!==""&&t!=="/"&&(a+="(?:(?=\\/|$))"),[new RegExp(a,e?void 0:"i"),r]}function uR(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return gr(!1,`The URL path "${t}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),t}}function ui(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,r=t.charAt(n);return r&&r!=="/"?null:t.slice(n)||"/"}var Kw=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,dR=t=>Kw.test(t);function hR(t,e="/"){let{pathname:n,search:r="",hash:a=""}=typeof t=="string"?Vl(t):t,o;if(n)if(dR(n))o=n;else{if(n.includes("//")){let u=n;n=n.replace(/\/\/+/g,"/"),gr(!1,`Pathnames cannot have embedded double slashes - normalizing ${u} -> ${n}`)}n.startsWith("/")?o=Sx(n.substring(1),"/"):o=Sx(n,e)}else o=e;return{pathname:o,search:pR(r),hash:gR(a)}}function Sx(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(a=>{a===".."?n.length>1&&n.pop():a!=="."&&n.push(a)}),n.length>1?n.join("/"):"/"}function Sg(t,e,n,r){return`Cannot include a '${t}' character in a manually specified \`to.${e}\` field [${JSON.stringify(r)}].  Please separate it out to the \`to.${n}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function fR(t){return t.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function Ry(t){let e=fR(t);return e.map((n,r)=>r===e.length-1?n.pathname:n.pathnameBase)}function Dy(t,e,n,r=!1){let a;typeof t=="string"?a=Vl(t):(a={...t},Lt(!a.pathname||!a.pathname.includes("?"),Sg("?","pathname","search",a)),Lt(!a.pathname||!a.pathname.includes("#"),Sg("#","pathname","hash",a)),Lt(!a.search||!a.search.includes("#"),Sg("#","search","hash",a)));let o=t===""||a.pathname==="",u=o?"/":a.pathname,h;if(u==null)h=n;else{let _=e.length-1;if(!r&&u.startsWith("..")){let v=u.split("/");for(;v[0]==="..";)v.shift(),_-=1;a.pathname=v.join("/")}h=_>=0?e[_]:"/"}let f=hR(a,h),m=u&&u!=="/"&&u.endsWith("/"),g=(o||u===".")&&n.endsWith("/");return!f.pathname.endsWith("/")&&(m||g)&&(f.pathname+="/"),f}var li=t=>t.join("/").replace(/\/\/+/g,"/"),mR=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),pR=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,gR=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t,yR=class{constructor(t,e,n,r=!1){this.status=t,this.statusText=e||"",this.internal=r,n instanceof Error?(this.data=n.toString(),this.error=n):this.data=n}};function _R(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}function bR(t){return t.map(e=>e.route.path).filter(Boolean).join("/").replace(/\/\/*/g,"/")||"/"}var Yw=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function Xw(t,e){let n=t;if(typeof n!="string"||!Kw.test(n))return{absoluteURL:void 0,isExternal:!1,to:n};let r=n,a=!1;if(Yw)try{let o=new URL(window.location.href),u=n.startsWith("//")?new URL(o.protocol+n):new URL(n),h=ui(u.pathname,e);u.origin===o.origin&&h!=null?n=h+u.search+u.hash:a=!0}catch{gr(!1,`<Link to="${n}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}return{absoluteURL:r,isExternal:a,to:n}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var Jw=["POST","PUT","PATCH","DELETE"];new Set(Jw);var vR=["GET",...Jw];new Set(vR);var $l=T.createContext(null);$l.displayName="DataRouter";var Bf=T.createContext(null);Bf.displayName="DataRouterState";var xR=T.createContext(!1),Zw=T.createContext({isTransitioning:!1});Zw.displayName="ViewTransition";var SR=T.createContext(new Map);SR.displayName="Fetchers";var wR=T.createContext(null);wR.displayName="Await";var br=T.createContext(null);br.displayName="Navigation";var Uu=T.createContext(null);Uu.displayName="Location";var Lr=T.createContext({outlet:null,matches:[],isDataRoute:!1});Lr.displayName="Route";var Iy=T.createContext(null);Iy.displayName="RouteError";var eE="REACT_ROUTER_ERROR",ER="REDIRECT",CR="ROUTE_ERROR_RESPONSE";function TR(t){if(t.startsWith(`${eE}:${ER}:{`))try{let e=JSON.parse(t.slice(28));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.location=="string"&&typeof e.reloadDocument=="boolean"&&typeof e.replace=="boolean")return e}catch{}}function AR(t){if(t.startsWith(`${eE}:${CR}:{`))try{let e=JSON.parse(t.slice(40));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string")return new yR(e.status,e.statusText,e.data)}catch{}}function jR(t,{relative:e}={}){Lt(ql(),"useHref() may be used only in the context of a <Router> component.");let{basename:n,navigator:r}=T.useContext(br),{hash:a,pathname:o,search:u}=Vu(t,{relative:e}),h=o;return n!=="/"&&(h=o==="/"?n:li([n,o])),r.createHref({pathname:h,search:u,hash:a})}function ql(){return T.useContext(Uu)!=null}function zn(){return Lt(ql(),"useLocation() may be used only in the context of a <Router> component."),T.useContext(Uu).location}var tE="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function nE(t){T.useContext(br).static||T.useLayoutEffect(t)}function Fu(){let{isDataRoute:t}=T.useContext(Lr);return t?qR():RR()}function RR(){Lt(ql(),"useNavigate() may be used only in the context of a <Router> component.");let t=T.useContext($l),{basename:e,navigator:n}=T.useContext(br),{matches:r}=T.useContext(Lr),{pathname:a}=zn(),o=JSON.stringify(Ry(r)),u=T.useRef(!1);return nE(()=>{u.current=!0}),T.useCallback((f,m={})=>{if(gr(u.current,tE),!u.current)return;if(typeof f=="number"){n.go(f);return}let g=Dy(f,JSON.parse(o),a,m.relative==="path");t==null&&e!=="/"&&(g.pathname=g.pathname==="/"?e:li([e,g.pathname])),(m.replace?n.replace:n.push)(g,m.state,m)},[e,n,o,a,t])}var DR=T.createContext(null);function IR(t){let e=T.useContext(Lr).outlet;return T.useMemo(()=>e&&T.createElement(DR.Provider,{value:t},e),[e,t])}function MR(){let{matches:t}=T.useContext(Lr),e=t[t.length-1];return e?e.params:{}}function Vu(t,{relative:e}={}){let{matches:n}=T.useContext(Lr),{pathname:r}=zn(),a=JSON.stringify(Ry(n));return T.useMemo(()=>Dy(t,JSON.parse(a),r,e==="path"),[t,a,r,e])}function kR(t,e){return rE(t,e)}function rE(t,e,n,r,a){Lt(ql(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:o}=T.useContext(br),{matches:u}=T.useContext(Lr),h=u[u.length-1],f=h?h.params:{},m=h?h.pathname:"/",g=h?h.pathnameBase:"/",_=h&&h.route;{let j=_&&_.path||"";iE(m,!_||j.endsWith("*")||j.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${m}" (under <Route path="${j}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${j}"> to <Route path="${j==="/"?"*":`${j}/*`}">.`)}let v=zn(),S;if(e){let j=typeof e=="string"?Vl(e):e;Lt(g==="/"||j.pathname?.startsWith(g),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${g}" but pathname "${j.pathname}" was given in the \`location\` prop.`),S=j}else S=v;let x=S.pathname||"/",E=x;if(g!=="/"){let j=g.replace(/^\//,"").split("/");E="/"+x.replace(/^\//,"").split("/").slice(j.length).join("/")}let C=Gw(t,{pathname:E});gr(_||C!=null,`No routes matched location "${S.pathname}${S.search}${S.hash}" `),gr(C==null||C[C.length-1].route.element!==void 0||C[C.length-1].route.Component!==void 0||C[C.length-1].route.lazy!==void 0,`Matched leaf route at location "${S.pathname}${S.search}${S.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let I=LR(C&&C.map(j=>Object.assign({},j,{params:Object.assign({},f,j.params),pathname:li([g,o.encodeLocation?o.encodeLocation(j.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:j.pathname]),pathnameBase:j.pathnameBase==="/"?g:li([g,o.encodeLocation?o.encodeLocation(j.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:j.pathnameBase])})),u,n,r,a);return e&&I?T.createElement(Uu.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...S},navigationType:"POP"}},I):I}function OR(){let t=$R(),e=_R(t)?`${t.status} ${t.statusText}`:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,r="rgba(200,200,200, 0.5)",a={padding:"0.5rem",backgroundColor:r},o={padding:"2px 4px",backgroundColor:r},u=null;return console.error("Error handled by React Router default ErrorBoundary:",t),u=T.createElement(T.Fragment,null,T.createElement("p",null," Hey developer "),T.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",T.createElement("code",{style:o},"ErrorBoundary")," or"," ",T.createElement("code",{style:o},"errorElement")," prop on your route.")),T.createElement(T.Fragment,null,T.createElement("h2",null,"Unexpected Application Error!"),T.createElement("h3",{style:{fontStyle:"italic"}},e),n?T.createElement("pre",{style:a},n):null,u)}var NR=T.createElement(OR,null),sE=class extends T.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,e){return e.location!==t.location||e.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:e.error,location:e.location,revalidation:t.revalidation||e.revalidation}}componentDidCatch(t,e){this.props.onError?this.props.onError(t,e):console.error("React Router caught the following error during render",t)}render(){let t=this.state.error;if(this.context&&typeof t=="object"&&t&&"digest"in t&&typeof t.digest=="string"){const n=AR(t.digest);n&&(t=n)}let e=t!==void 0?T.createElement(Lr.Provider,{value:this.props.routeContext},T.createElement(Iy.Provider,{value:t,children:this.props.component})):this.props.children;return this.context?T.createElement(PR,{error:t},e):e}};sE.contextType=xR;var wg=new WeakMap;function PR({children:t,error:e}){let{basename:n}=T.useContext(br);if(typeof e=="object"&&e&&"digest"in e&&typeof e.digest=="string"){let r=TR(e.digest);if(r){let a=wg.get(e);if(a)throw a;let o=Xw(r.location,n);if(Yw&&!wg.get(e))if(o.isExternal||r.reloadDocument)window.location.href=o.absoluteURL||o.to;else{const u=Promise.resolve().then(()=>window.__reactRouterDataRouter.navigate(o.to,{replace:r.replace}));throw wg.set(e,u),u}return T.createElement("meta",{httpEquiv:"refresh",content:`0;url=${o.absoluteURL||o.to}`})}}return t}function BR({routeContext:t,match:e,children:n}){let r=T.useContext($l);return r&&r.static&&r.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=e.route.id),T.createElement(Lr.Provider,{value:t},n)}function LR(t,e=[],n=null,r=null,a=null){if(t==null){if(!n)return null;if(n.errors)t=n.matches;else if(e.length===0&&!n.initialized&&n.matches.length>0)t=n.matches;else return null}let o=t,u=n?.errors;if(u!=null){let g=o.findIndex(_=>_.route.id&&u?.[_.route.id]!==void 0);Lt(g>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(u).join(",")}`),o=o.slice(0,Math.min(o.length,g+1))}let h=!1,f=-1;if(n)for(let g=0;g<o.length;g++){let _=o[g];if((_.route.HydrateFallback||_.route.hydrateFallbackElement)&&(f=g),_.route.id){let{loaderData:v,errors:S}=n,x=_.route.loader&&!v.hasOwnProperty(_.route.id)&&(!S||S[_.route.id]===void 0);if(_.route.lazy||x){h=!0,f>=0?o=o.slice(0,f+1):o=[o[0]];break}}}let m=n&&r?(g,_)=>{r(g,{location:n.location,params:n.matches?.[0]?.params??{},unstable_pattern:bR(n.matches),errorInfo:_})}:void 0;return o.reduceRight((g,_,v)=>{let S,x=!1,E=null,C=null;n&&(S=u&&_.route.id?u[_.route.id]:void 0,E=_.route.errorElement||NR,h&&(f<0&&v===0?(iE("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),x=!0,C=null):f===v&&(x=!0,C=_.route.hydrateFallbackElement||null)));let I=e.concat(o.slice(0,v+1)),j=()=>{let M;return S?M=E:x?M=C:_.route.Component?M=T.createElement(_.route.Component,null):_.route.element?M=_.route.element:M=g,T.createElement(BR,{match:_,routeContext:{outlet:g,matches:I,isDataRoute:n!=null},children:M})};return n&&(_.route.ErrorBoundary||_.route.errorElement||v===0)?T.createElement(sE,{location:n.location,revalidation:n.revalidation,component:E,error:S,children:j(),routeContext:{outlet:null,matches:I,isDataRoute:!0},onError:m}):j()},null)}function My(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function zR(t){let e=T.useContext($l);return Lt(e,My(t)),e}function UR(t){let e=T.useContext(Bf);return Lt(e,My(t)),e}function FR(t){let e=T.useContext(Lr);return Lt(e,My(t)),e}function ky(t){let e=FR(t),n=e.matches[e.matches.length-1];return Lt(n.route.id,`${t} can only be used on routes that contain a unique "id"`),n.route.id}function VR(){return ky("useRouteId")}function $R(){let t=T.useContext(Iy),e=UR("useRouteError"),n=ky("useRouteError");return t!==void 0?t:e.errors?.[n]}function qR(){let{router:t}=zR("useNavigate"),e=ky("useNavigate"),n=T.useRef(!1);return nE(()=>{n.current=!0}),T.useCallback(async(a,o={})=>{gr(n.current,tE),n.current&&(typeof a=="number"?await t.navigate(a):await t.navigate(a,{fromRouteId:e,...o}))},[t,e])}var wx={};function iE(t,e,n){!e&&!wx[t]&&(wx[t]=!0,gr(!1,n))}T.memo(HR);function HR({routes:t,future:e,state:n,onError:r}){return rE(t,void 0,n,r,e)}function Lf({to:t,replace:e,state:n,relative:r}){Lt(ql(),"<Navigate> may be used only in the context of a <Router> component.");let{static:a}=T.useContext(br);gr(!a,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:o}=T.useContext(Lr),{pathname:u}=zn(),h=Fu(),f=Dy(t,Ry(o),u,r==="path"),m=JSON.stringify(f);return T.useEffect(()=>{h(JSON.parse(m),{replace:e,state:n,relative:r})},[h,m,r,e,n]),null}function zf(t){return IR(t.context)}function fn(t){Lt(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function GR({basename:t="/",children:e=null,location:n,navigationType:r="POP",navigator:a,static:o=!1,unstable_useTransitions:u}){Lt(!ql(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let h=t.replace(/^\/*/,"/"),f=T.useMemo(()=>({basename:h,navigator:a,static:o,unstable_useTransitions:u,future:{}}),[h,a,o,u]);typeof n=="string"&&(n=Vl(n));let{pathname:m="/",search:g="",hash:_="",state:v=null,key:S="default"}=n,x=T.useMemo(()=>{let E=ui(m,h);return E==null?null:{location:{pathname:E,search:g,hash:_,state:v,key:S},navigationType:r}},[h,m,g,_,v,S,r]);return gr(x!=null,`<Router basename="${h}"> is not able to match the URL "${m}${g}${_}" because it does not start with the basename, so the <Router> won't render anything.`),x==null?null:T.createElement(br.Provider,{value:f},T.createElement(Uu.Provider,{children:e,value:x}))}function QR({children:t,location:e}){return kR(qg(t),e)}function qg(t,e=[]){let n=[];return T.Children.forEach(t,(r,a)=>{if(!T.isValidElement(r))return;let o=[...e,a];if(r.type===T.Fragment){n.push.apply(n,qg(r.props.children,o));return}Lt(r.type===fn,`[${typeof r.type=="string"?r.type:r.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),Lt(!r.props.index||!r.props.children,"An index route cannot have child routes.");let u={id:r.props.id||o.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,middleware:r.props.middleware,loader:r.props.loader,action:r.props.action,hydrateFallbackElement:r.props.hydrateFallbackElement,HydrateFallback:r.props.HydrateFallback,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.hasErrorBoundary===!0||r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(u.children=qg(r.props.children,o)),n.push(u)}),n}var Hh="get",Gh="application/x-www-form-urlencoded";function Uf(t){return typeof HTMLElement<"u"&&t instanceof HTMLElement}function WR(t){return Uf(t)&&t.tagName.toLowerCase()==="button"}function KR(t){return Uf(t)&&t.tagName.toLowerCase()==="form"}function YR(t){return Uf(t)&&t.tagName.toLowerCase()==="input"}function XR(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function JR(t,e){return t.button===0&&(!e||e==="_self")&&!XR(t)}function Hg(t=""){return new URLSearchParams(typeof t=="string"||Array.isArray(t)||t instanceof URLSearchParams?t:Object.keys(t).reduce((e,n)=>{let r=t[n];return e.concat(Array.isArray(r)?r.map(a=>[n,a]):[[n,r]])},[]))}function ZR(t,e){let n=Hg(t);return e&&e.forEach((r,a)=>{n.has(a)||e.getAll(a).forEach(o=>{n.append(a,o)})}),n}var Nh=null;function e5(){if(Nh===null)try{new FormData(document.createElement("form"),0),Nh=!1}catch{Nh=!0}return Nh}var t5=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function Eg(t){return t!=null&&!t5.has(t)?(gr(!1,`"${t}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${Gh}"`),null):t}function n5(t,e){let n,r,a,o,u;if(KR(t)){let h=t.getAttribute("action");r=h?ui(h,e):null,n=t.getAttribute("method")||Hh,a=Eg(t.getAttribute("enctype"))||Gh,o=new FormData(t)}else if(WR(t)||YR(t)&&(t.type==="submit"||t.type==="image")){let h=t.form;if(h==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let f=t.getAttribute("formaction")||h.getAttribute("action");if(r=f?ui(f,e):null,n=t.getAttribute("formmethod")||h.getAttribute("method")||Hh,a=Eg(t.getAttribute("formenctype"))||Eg(h.getAttribute("enctype"))||Gh,o=new FormData(h,t),!e5()){let{name:m,type:g,value:_}=t;if(g==="image"){let v=m?`${m}.`:"";o.append(`${v}x`,"0"),o.append(`${v}y`,"0")}else m&&o.append(m,_)}}else{if(Uf(t))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');n=Hh,r=null,a=Gh,u=t}return o&&a==="text/plain"&&(u=o,o=void 0),{action:r,method:n.toLowerCase(),encType:a,formData:o,body:u}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function Oy(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function r5(t,e,n){let r=typeof t=="string"?new URL(t,typeof window>"u"?"server://singlefetch/":window.location.origin):t;return r.pathname==="/"?r.pathname=`_root.${n}`:e&&ui(r.pathname,e)==="/"?r.pathname=`${e.replace(/\/$/,"")}/_root.${n}`:r.pathname=`${r.pathname.replace(/\/$/,"")}.${n}`,r}async function s5(t,e){if(t.id in e)return e[t.id];try{let n=await import(t.module);return e[t.id]=n,n}catch(n){return console.error(`Error loading route module \`${t.module}\`, reloading page...`),console.error(n),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function i5(t){return t==null?!1:t.href==null?t.rel==="preload"&&typeof t.imageSrcSet=="string"&&typeof t.imageSizes=="string":typeof t.rel=="string"&&typeof t.href=="string"}async function a5(t,e,n){let r=await Promise.all(t.map(async a=>{let o=e.routes[a.route.id];if(o){let u=await s5(o,n);return u.links?u.links():[]}return[]}));return u5(r.flat(1).filter(i5).filter(a=>a.rel==="stylesheet"||a.rel==="preload").map(a=>a.rel==="stylesheet"?{...a,rel:"prefetch",as:"style"}:{...a,rel:"prefetch"}))}function Ex(t,e,n,r,a,o){let u=(f,m)=>n[m]?f.route.id!==n[m].route.id:!0,h=(f,m)=>n[m].pathname!==f.pathname||n[m].route.path?.endsWith("*")&&n[m].params["*"]!==f.params["*"];return o==="assets"?e.filter((f,m)=>u(f,m)||h(f,m)):o==="data"?e.filter((f,m)=>{let g=r.routes[f.route.id];if(!g||!g.hasLoader)return!1;if(u(f,m)||h(f,m))return!0;if(f.route.shouldRevalidate){let _=f.route.shouldRevalidate({currentUrl:new URL(a.pathname+a.search+a.hash,window.origin),currentParams:n[0]?.params||{},nextUrl:new URL(t,window.origin),nextParams:f.params,defaultShouldRevalidate:!0});if(typeof _=="boolean")return _}return!0}):[]}function o5(t,e,{includeHydrateFallback:n}={}){return l5(t.map(r=>{let a=e.routes[r.route.id];if(!a)return[];let o=[a.module];return a.clientActionModule&&(o=o.concat(a.clientActionModule)),a.clientLoaderModule&&(o=o.concat(a.clientLoaderModule)),n&&a.hydrateFallbackModule&&(o=o.concat(a.hydrateFallbackModule)),a.imports&&(o=o.concat(a.imports)),o}).flat(1))}function l5(t){return[...new Set(t)]}function c5(t){let e={},n=Object.keys(t).sort();for(let r of n)e[r]=t[r];return e}function u5(t,e){let n=new Set;return new Set(e),t.reduce((r,a)=>{let o=JSON.stringify(c5(a));return n.has(o)||(n.add(o),r.push({key:o,link:a})),r},[])}function aE(){let t=T.useContext($l);return Oy(t,"You must render this element inside a <DataRouterContext.Provider> element"),t}function d5(){let t=T.useContext(Bf);return Oy(t,"You must render this element inside a <DataRouterStateContext.Provider> element"),t}var Ny=T.createContext(void 0);Ny.displayName="FrameworkContext";function oE(){let t=T.useContext(Ny);return Oy(t,"You must render this element inside a <HydratedRouter> element"),t}function h5(t,e){let n=T.useContext(Ny),[r,a]=T.useState(!1),[o,u]=T.useState(!1),{onFocus:h,onBlur:f,onMouseEnter:m,onMouseLeave:g,onTouchStart:_}=e,v=T.useRef(null);T.useEffect(()=>{if(t==="render"&&u(!0),t==="viewport"){let E=I=>{I.forEach(j=>{u(j.isIntersecting)})},C=new IntersectionObserver(E,{threshold:.5});return v.current&&C.observe(v.current),()=>{C.disconnect()}}},[t]),T.useEffect(()=>{if(r){let E=setTimeout(()=>{u(!0)},100);return()=>{clearTimeout(E)}}},[r]);let S=()=>{a(!0)},x=()=>{a(!1),u(!1)};return n?t!=="intent"?[o,v,{}]:[o,v,{onFocus:du(h,S),onBlur:du(f,x),onMouseEnter:du(m,S),onMouseLeave:du(g,x),onTouchStart:du(_,S)}]:[!1,v,{}]}function du(t,e){return n=>{t&&t(n),n.defaultPrevented||e(n)}}function f5({page:t,...e}){let{router:n}=aE(),r=T.useMemo(()=>Gw(n.routes,t,n.basename),[n.routes,t,n.basename]);return r?T.createElement(p5,{page:t,matches:r,...e}):null}function m5(t){let{manifest:e,routeModules:n}=oE(),[r,a]=T.useState([]);return T.useEffect(()=>{let o=!1;return a5(t,e,n).then(u=>{o||a(u)}),()=>{o=!0}},[t,e,n]),r}function p5({page:t,matches:e,...n}){let r=zn(),{manifest:a,routeModules:o}=oE(),{basename:u}=aE(),{loaderData:h,matches:f}=d5(),m=T.useMemo(()=>Ex(t,e,f,a,r,"data"),[t,e,f,a,r]),g=T.useMemo(()=>Ex(t,e,f,a,r,"assets"),[t,e,f,a,r]),_=T.useMemo(()=>{if(t===r.pathname+r.search+r.hash)return[];let x=new Set,E=!1;if(e.forEach(I=>{let j=a.routes[I.route.id];!j||!j.hasLoader||(!m.some(M=>M.route.id===I.route.id)&&I.route.id in h&&o[I.route.id]?.shouldRevalidate||j.hasClientLoader?E=!0:x.add(I.route.id))}),x.size===0)return[];let C=r5(t,u,"data");return E&&x.size>0&&C.searchParams.set("_routes",e.filter(I=>x.has(I.route.id)).map(I=>I.route.id).join(",")),[C.pathname+C.search]},[u,h,r,a,m,e,t,o]),v=T.useMemo(()=>o5(g,a),[g,a]),S=m5(g);return T.createElement(T.Fragment,null,_.map(x=>T.createElement("link",{key:x,rel:"prefetch",as:"fetch",href:x,...n})),v.map(x=>T.createElement("link",{key:x,rel:"modulepreload",href:x,...n})),S.map(({key:x,link:E})=>T.createElement("link",{key:x,nonce:n.nonce,...E})))}function g5(...t){return e=>{t.forEach(n=>{typeof n=="function"?n(e):n!=null&&(n.current=e)})}}var y5=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{y5&&(window.__reactRouterVersion="7.11.0")}catch{}function _5({basename:t,children:e,unstable_useTransitions:n,window:r}){let a=T.useRef();a.current==null&&(a.current=Wj({window:r,v5Compat:!0}));let o=a.current,[u,h]=T.useState({action:o.action,location:o.location}),f=T.useCallback(m=>{n===!1?h(m):T.startTransition(()=>h(m))},[n]);return T.useLayoutEffect(()=>o.listen(f),[o,f]),T.createElement(GR,{basename:t,children:e,location:u.location,navigationType:u.action,navigator:o,unstable_useTransitions:n})}var lE=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Ft=T.forwardRef(function({onClick:e,discover:n="render",prefetch:r="none",relative:a,reloadDocument:o,replace:u,state:h,target:f,to:m,preventScrollReset:g,viewTransition:_,unstable_defaultShouldRevalidate:v,...S},x){let{basename:E,unstable_useTransitions:C}=T.useContext(br),I=typeof m=="string"&&lE.test(m),j=Xw(m,E);m=j.to;let M=jR(m,{relative:a}),[Q,q,G]=h5(r,S),D=S5(m,{replace:u,state:h,target:f,preventScrollReset:g,relative:a,viewTransition:_,unstable_defaultShouldRevalidate:v,unstable_useTransitions:C});function A(L){e&&e(L),L.defaultPrevented||D(L)}let N=T.createElement("a",{...S,...G,href:j.absoluteURL||M,onClick:j.isExternal||o?e:A,ref:g5(x,q),target:f,"data-discover":!I&&n==="render"?"true":void 0});return Q&&!I?T.createElement(T.Fragment,null,N,T.createElement(f5,{page:M})):N});Ft.displayName="Link";var b5=T.forwardRef(function({"aria-current":e="page",caseSensitive:n=!1,className:r="",end:a=!1,style:o,to:u,viewTransition:h,children:f,...m},g){let _=Vu(u,{relative:m.relative}),v=zn(),S=T.useContext(Bf),{navigator:x,basename:E}=T.useContext(br),C=S!=null&&A5(_)&&h===!0,I=x.encodeLocation?x.encodeLocation(_).pathname:_.pathname,j=v.pathname,M=S&&S.navigation&&S.navigation.location?S.navigation.location.pathname:null;n||(j=j.toLowerCase(),M=M?M.toLowerCase():null,I=I.toLowerCase()),M&&E&&(M=ui(M,E)||M);const Q=I!=="/"&&I.endsWith("/")?I.length-1:I.length;let q=j===I||!a&&j.startsWith(I)&&j.charAt(Q)==="/",G=M!=null&&(M===I||!a&&M.startsWith(I)&&M.charAt(I.length)==="/"),D={isActive:q,isPending:G,isTransitioning:C},A=q?e:void 0,N;typeof r=="function"?N=r(D):N=[r,q?"active":null,G?"pending":null,C?"transitioning":null].filter(Boolean).join(" ");let L=typeof o=="function"?o(D):o;return T.createElement(Ft,{...m,"aria-current":A,className:N,ref:g,style:L,to:u,viewTransition:h},typeof f=="function"?f(D):f)});b5.displayName="NavLink";var v5=T.forwardRef(({discover:t="render",fetcherKey:e,navigate:n,reloadDocument:r,replace:a,state:o,method:u=Hh,action:h,onSubmit:f,relative:m,preventScrollReset:g,viewTransition:_,unstable_defaultShouldRevalidate:v,...S},x)=>{let{unstable_useTransitions:E}=T.useContext(br),C=C5(),I=T5(h,{relative:m}),j=u.toLowerCase()==="get"?"get":"post",M=typeof h=="string"&&lE.test(h),Q=q=>{if(f&&f(q),q.defaultPrevented)return;q.preventDefault();let G=q.nativeEvent.submitter,D=G?.getAttribute("formmethod")||u,A=()=>C(G||q.currentTarget,{fetcherKey:e,method:D,navigate:n,replace:a,state:o,relative:m,preventScrollReset:g,viewTransition:_,unstable_defaultShouldRevalidate:v});E&&n!==!1?T.startTransition(()=>A()):A()};return T.createElement("form",{ref:x,method:j,action:I,onSubmit:r?f:Q,...S,"data-discover":!M&&t==="render"?"true":void 0})});v5.displayName="Form";function x5(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function cE(t){let e=T.useContext($l);return Lt(e,x5(t)),e}function S5(t,{target:e,replace:n,state:r,preventScrollReset:a,relative:o,viewTransition:u,unstable_defaultShouldRevalidate:h,unstable_useTransitions:f}={}){let m=Fu(),g=zn(),_=Vu(t,{relative:o});return T.useCallback(v=>{if(JR(v,e)){v.preventDefault();let S=n!==void 0?n:Eu(g)===Eu(_),x=()=>m(t,{replace:S,state:r,preventScrollReset:a,relative:o,viewTransition:u,unstable_defaultShouldRevalidate:h});f?T.startTransition(()=>x()):x()}},[g,m,_,n,r,e,t,a,o,u,h,f])}function uE(t){gr(typeof URLSearchParams<"u","You cannot use the `useSearchParams` hook in a browser that does not support the URLSearchParams API. If you need to support Internet Explorer 11, we recommend you load a polyfill such as https://github.com/ungap/url-search-params.");let e=T.useRef(Hg(t)),n=T.useRef(!1),r=zn(),a=T.useMemo(()=>ZR(r.search,n.current?null:e.current),[r.search]),o=Fu(),u=T.useCallback((h,f)=>{const m=Hg(typeof h=="function"?h(new URLSearchParams(a)):h);n.current=!0,o("?"+m,f)},[o,a]);return[a,u]}var w5=0,E5=()=>`__${String(++w5)}__`;function C5(){let{router:t}=cE("useSubmit"),{basename:e}=T.useContext(br),n=VR(),r=t.fetch,a=t.navigate;return T.useCallback(async(o,u={})=>{let{action:h,method:f,encType:m,formData:g,body:_}=n5(o,e);if(u.navigate===!1){let v=u.fetcherKey||E5();await r(v,n,u.action||h,{unstable_defaultShouldRevalidate:u.unstable_defaultShouldRevalidate,preventScrollReset:u.preventScrollReset,formData:g,body:_,formMethod:u.method||f,formEncType:u.encType||m,flushSync:u.flushSync})}else await a(u.action||h,{unstable_defaultShouldRevalidate:u.unstable_defaultShouldRevalidate,preventScrollReset:u.preventScrollReset,formData:g,body:_,formMethod:u.method||f,formEncType:u.encType||m,replace:u.replace,state:u.state,fromRouteId:n,flushSync:u.flushSync,viewTransition:u.viewTransition})},[r,a,e,n])}function T5(t,{relative:e}={}){let{basename:n}=T.useContext(br),r=T.useContext(Lr);Lt(r,"useFormAction must be used inside a RouteContext");let[a]=r.matches.slice(-1),o={...Vu(t||".",{relative:e})},u=zn();if(t==null){o.search=u.search;let h=new URLSearchParams(o.search),f=h.getAll("index");if(f.some(g=>g==="")){h.delete("index"),f.filter(_=>_).forEach(_=>h.append("index",_));let g=h.toString();o.search=g?`?${g}`:""}}return(!t||t===".")&&a.route.index&&(o.search=o.search?o.search.replace(/^\?/,"?index&"):"?index"),n!=="/"&&(o.pathname=o.pathname==="/"?n:li([n,o.pathname])),Eu(o)}function A5(t,{relative:e}={}){let n=T.useContext(Zw);Lt(n!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:r}=cE("useViewTransitionState"),a=Vu(t,{relative:e});if(!n.isTransitioning)return!1;let o=ui(n.currentLocation.pathname,r)||n.currentLocation.pathname,u=ui(n.nextLocation.pathname,r)||n.nextLocation.pathname;return af(a.pathname,u)!=null||af(a.pathname,o)!=null}const j5={isLoading:!1,loadingMessage:"Loading...",addLoadingHold:()=>{},removeLoadingHold:()=>{}},dE=T.createContext(j5);function R5({children:t}){const[e,n]=T.useState(new Map),r=T.useCallback((f,m)=>{n(g=>new Map(g).set(f,m))},[]),a=T.useCallback(f=>{n(m=>{const g=new Map(m);return g.delete(f),g})},[]),o=e.size>0,u=e.size>0&&Array.from(e.values()).pop()||"Loading...",h={isLoading:o,loadingMessage:u,addLoadingHold:r,removeLoadingHold:a};return c.jsx(dE.Provider,{value:h,children:t})}function ir(){const t=T.useContext(dE);if(!t)throw new Error("useApp must be used within an AppProvider");return t}const D5=()=>{};var Cx={};const hE=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let a=t.charCodeAt(r);a<128?e[n++]=a:a<2048?(e[n++]=a>>6|192,e[n++]=a&63|128):(a&64512)===55296&&r+1<t.length&&(t.charCodeAt(r+1)&64512)===56320?(a=65536+((a&1023)<<10)+(t.charCodeAt(++r)&1023),e[n++]=a>>18|240,e[n++]=a>>12&63|128,e[n++]=a>>6&63|128,e[n++]=a&63|128):(e[n++]=a>>12|224,e[n++]=a>>6&63|128,e[n++]=a&63|128)}return e},I5=function(t){const e=[];let n=0,r=0;for(;n<t.length;){const a=t[n++];if(a<128)e[r++]=String.fromCharCode(a);else if(a>191&&a<224){const o=t[n++];e[r++]=String.fromCharCode((a&31)<<6|o&63)}else if(a>239&&a<365){const o=t[n++],u=t[n++],h=t[n++],f=((a&7)<<18|(o&63)<<12|(u&63)<<6|h&63)-65536;e[r++]=String.fromCharCode(55296+(f>>10)),e[r++]=String.fromCharCode(56320+(f&1023))}else{const o=t[n++],u=t[n++];e[r++]=String.fromCharCode((a&15)<<12|(o&63)<<6|u&63)}}return e.join("")},fE={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let a=0;a<t.length;a+=3){const o=t[a],u=a+1<t.length,h=u?t[a+1]:0,f=a+2<t.length,m=f?t[a+2]:0,g=o>>2,_=(o&3)<<4|h>>4;let v=(h&15)<<2|m>>6,S=m&63;f||(S=64,u||(v=64)),r.push(n[g],n[_],n[v],n[S])}return r.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(hE(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):I5(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let a=0;a<t.length;){const o=n[t.charAt(a++)],h=a<t.length?n[t.charAt(a)]:0;++a;const m=a<t.length?n[t.charAt(a)]:64;++a;const _=a<t.length?n[t.charAt(a)]:64;if(++a,o==null||h==null||m==null||_==null)throw new M5;const v=o<<2|h>>4;if(r.push(v),m!==64){const S=h<<4&240|m>>2;if(r.push(S),_!==64){const x=m<<6&192|_;r.push(x)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class M5 extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const k5=function(t){const e=hE(t);return fE.encodeByteArray(e,!0)},of=function(t){return k5(t).replace(/\./g,"")},mE=function(t){try{return fE.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function O5(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const N5=()=>O5().__FIREBASE_DEFAULTS__,P5=()=>{if(typeof process>"u"||typeof Cx>"u")return;const t=Cx.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},B5=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&mE(t[1]);return e&&JSON.parse(e)},Ff=()=>{try{return D5()||N5()||P5()||B5()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},pE=t=>Ff()?.emulatorHosts?.[t],L5=t=>{const e=pE(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(n+1),10);return e[0]==="["?[e.substring(1,n-1),r]:[e.substring(0,n),r]},gE=()=>Ff()?.config,yE=t=>Ff()?.[`_${t}`];class z5{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,r)=>{n?this.reject(n):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,r))}}}function Hl(t){try{return(t.startsWith("http://")||t.startsWith("https://")?new URL(t).hostname:t).endsWith(".cloudworkstations.dev")}catch{return!1}}async function _E(t){return(await fetch(t,{credentials:"include"})).ok}function U5(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n={alg:"none",type:"JWT"},r=e||"demo-project",a=t.iat||0,o=t.sub||t.user_id;if(!o)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const u={iss:`https://securetoken.google.com/${r}`,aud:r,iat:a,exp:a+3600,auth_time:a,sub:o,user_id:o,firebase:{sign_in_provider:"custom",identities:{}},...t};return[of(JSON.stringify(n)),of(JSON.stringify(u)),""].join(".")}const _u={};function F5(){const t={prod:[],emulator:[]};for(const e of Object.keys(_u))_u[e]?t.emulator.push(e):t.prod.push(e);return t}function V5(t){let e=document.getElementById(t),n=!1;return e||(e=document.createElement("div"),e.setAttribute("id",t),n=!0),{created:n,element:e}}let Tx=!1;function bE(t,e){if(typeof window>"u"||typeof document>"u"||!Hl(window.location.host)||_u[t]===e||_u[t]||Tx)return;_u[t]=e;function n(v){return`__firebase__banner__${v}`}const r="__firebase__banner",o=F5().prod.length>0;function u(){const v=document.getElementById(r);v&&v.remove()}function h(v){v.style.display="flex",v.style.background="#7faaf0",v.style.position="fixed",v.style.bottom="5px",v.style.left="5px",v.style.padding=".5em",v.style.borderRadius="5px",v.style.alignItems="center"}function f(v,S){v.setAttribute("width","24"),v.setAttribute("id",S),v.setAttribute("height","24"),v.setAttribute("viewBox","0 0 24 24"),v.setAttribute("fill","none"),v.style.marginLeft="-6px"}function m(){const v=document.createElement("span");return v.style.cursor="pointer",v.style.marginLeft="16px",v.style.fontSize="24px",v.innerHTML=" &times;",v.onclick=()=>{Tx=!0,u()},v}function g(v,S){v.setAttribute("id",S),v.innerText="Learn more",v.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",v.setAttribute("target","__blank"),v.style.paddingLeft="5px",v.style.textDecoration="underline"}function _(){const v=V5(r),S=n("text"),x=document.getElementById(S)||document.createElement("span"),E=n("learnmore"),C=document.getElementById(E)||document.createElement("a"),I=n("preprendIcon"),j=document.getElementById(I)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(v.created){const M=v.element;h(M),g(C,E);const Q=m();f(j,I),M.append(j,x,C,Q),document.body.appendChild(M)}o?(x.innerText="Preview backend disconnected.",j.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(j.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,x.innerText="Preview backend running in this workspace."),x.setAttribute("id",S)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",_):_()}function Ln(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function $5(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Ln())}function q5(){const t=Ff()?.forceEnvironment;if(t==="node")return!0;if(t==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function H5(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function G5(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function Q5(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function W5(){const t=Ln();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function K5(){return!q5()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Y5(){try{return typeof indexedDB=="object"}catch{return!1}}function X5(){return new Promise((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",a=self.indexedDB.open(r);a.onsuccess=()=>{a.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},a.onupgradeneeded=()=>{n=!1},a.onerror=()=>{e(a.error?.message||"")}}catch(n){e(n)}})}const J5="FirebaseError";class yi extends Error{constructor(e,n,r){super(n),this.code=e,this.customData=r,this.name=J5,Object.setPrototypeOf(this,yi.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,$u.prototype.create)}}class $u{constructor(e,n,r){this.service=e,this.serviceName=n,this.errors=r}create(e,...n){const r=n[0]||{},a=`${this.service}/${e}`,o=this.errors[e],u=o?Z5(o,r):"Error",h=`${this.serviceName}: ${u} (${a}).`;return new yi(a,h,r)}}function Z5(t,e){return t.replace(eD,(n,r)=>{const a=e[r];return a!=null?String(a):`<${r}?>`})}const eD=/\{\$([^}]+)}/g;function tD(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function fa(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const a of n){if(!r.includes(a))return!1;const o=t[a],u=e[a];if(Ax(o)&&Ax(u)){if(!fa(o,u))return!1}else if(o!==u)return!1}for(const a of r)if(!n.includes(a))return!1;return!0}function Ax(t){return t!==null&&typeof t=="object"}function qu(t){const e=[];for(const[n,r]of Object.entries(t))Array.isArray(r)?r.forEach(a=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(a))}):e.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function hu(t){const e={};return t.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[a,o]=r.split("=");e[decodeURIComponent(a)]=decodeURIComponent(o)}}),e}function fu(t){const e=t.indexOf("?");if(!e)return"";const n=t.indexOf("#",e);return t.substring(e,n>0?n:void 0)}function nD(t,e){const n=new rD(t,e);return n.subscribe.bind(n)}class rD{constructor(e,n){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(n=>{n.next(e)})}error(e){this.forEachObserver(n=>{n.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,n,r){let a;if(e===void 0&&n===void 0&&r===void 0)throw new Error("Missing Observer.");sD(e,["next","error","complete"])?a=e:a={next:e,error:n,complete:r},a.next===void 0&&(a.next=Cg),a.error===void 0&&(a.error=Cg),a.complete===void 0&&(a.complete=Cg);const o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?a.error(this.finalError):a.complete()}catch{}}),this.observers.push(a),o}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let n=0;n<this.observers.length;n++)this.sendOne(n,e)}sendOne(e,n){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{n(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function sD(t,e){if(typeof t!="object"||t===null)return!1;for(const n of e)if(n in t&&typeof t[n]=="function")return!0;return!1}function Cg(){}function un(t){return t&&t._delegate?t._delegate:t}class fo{constructor(e,n,r){this.name=e,this.instanceFactory=n,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const ao="[DEFAULT]";class iD{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){const r=new z5;if(this.instancesDeferred.set(n,r),this.isInitialized(n)||this.shouldAutoInitialize())try{const a=this.getOrInitializeService({instanceIdentifier:n});a&&r.resolve(a)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){const n=this.normalizeInstanceIdentifier(e?.identifier),r=e?.optional??!1;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(a){if(r)return null;throw a}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(oD(e))try{this.getOrInitializeService({instanceIdentifier:ao})}catch{}for(const[n,r]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(n);try{const o=this.getOrInitializeService({instanceIdentifier:a});r.resolve(o)}catch{}}}}clearInstance(e=ao){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=ao){return this.instances.has(e)}getOptions(e=ao){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:n={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const a=this.getOrInitializeService({instanceIdentifier:r,options:n});for(const[o,u]of this.instancesDeferred.entries()){const h=this.normalizeInstanceIdentifier(o);r===h&&u.resolve(a)}return a}onInit(e,n){const r=this.normalizeInstanceIdentifier(n),a=this.onInitCallbacks.get(r)??new Set;a.add(e),this.onInitCallbacks.set(r,a);const o=this.instances.get(r);return o&&e(o,r),()=>{a.delete(e)}}invokeOnInitCallbacks(e,n){const r=this.onInitCallbacks.get(n);if(r)for(const a of r)try{a(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:aD(e),options:n}),this.instances.set(e,r),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=ao){return this.component?this.component.multipleInstances?e:ao:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function aD(t){return t===ao?void 0:t}function oD(t){return t.instantiationMode==="EAGER"}class lD{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const n=new iD(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}}var rt;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(rt||(rt={}));const cD={debug:rt.DEBUG,verbose:rt.VERBOSE,info:rt.INFO,warn:rt.WARN,error:rt.ERROR,silent:rt.SILENT},uD=rt.INFO,dD={[rt.DEBUG]:"log",[rt.VERBOSE]:"log",[rt.INFO]:"info",[rt.WARN]:"warn",[rt.ERROR]:"error"},hD=(t,e,...n)=>{if(e<t.logLevel)return;const r=new Date().toISOString(),a=dD[e];if(a)console[a](`[${r}]  ${t.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Py{constructor(e){this.name=e,this._logLevel=uD,this._logHandler=hD,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in rt))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?cD[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,rt.DEBUG,...e),this._logHandler(this,rt.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,rt.VERBOSE,...e),this._logHandler(this,rt.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,rt.INFO,...e),this._logHandler(this,rt.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,rt.WARN,...e),this._logHandler(this,rt.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,rt.ERROR,...e),this._logHandler(this,rt.ERROR,...e)}}const fD=(t,e)=>e.some(n=>t instanceof n);let jx,Rx;function mD(){return jx||(jx=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function pD(){return Rx||(Rx=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const vE=new WeakMap,Gg=new WeakMap,xE=new WeakMap,Tg=new WeakMap,By=new WeakMap;function gD(t){const e=new Promise((n,r)=>{const a=()=>{t.removeEventListener("success",o),t.removeEventListener("error",u)},o=()=>{n(aa(t.result)),a()},u=()=>{r(t.error),a()};t.addEventListener("success",o),t.addEventListener("error",u)});return e.then(n=>{n instanceof IDBCursor&&vE.set(n,t)}).catch(()=>{}),By.set(e,t),e}function yD(t){if(Gg.has(t))return;const e=new Promise((n,r)=>{const a=()=>{t.removeEventListener("complete",o),t.removeEventListener("error",u),t.removeEventListener("abort",u)},o=()=>{n(),a()},u=()=>{r(t.error||new DOMException("AbortError","AbortError")),a()};t.addEventListener("complete",o),t.addEventListener("error",u),t.addEventListener("abort",u)});Gg.set(t,e)}let Qg={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return Gg.get(t);if(e==="objectStoreNames")return t.objectStoreNames||xE.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return aa(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function _D(t){Qg=t(Qg)}function bD(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const r=t.call(Ag(this),e,...n);return xE.set(r,e.sort?e.sort():[e]),aa(r)}:pD().includes(t)?function(...e){return t.apply(Ag(this),e),aa(vE.get(this))}:function(...e){return aa(t.apply(Ag(this),e))}}function vD(t){return typeof t=="function"?bD(t):(t instanceof IDBTransaction&&yD(t),fD(t,mD())?new Proxy(t,Qg):t)}function aa(t){if(t instanceof IDBRequest)return gD(t);if(Tg.has(t))return Tg.get(t);const e=vD(t);return e!==t&&(Tg.set(t,e),By.set(e,t)),e}const Ag=t=>By.get(t);function xD(t,e,{blocked:n,upgrade:r,blocking:a,terminated:o}={}){const u=indexedDB.open(t,e),h=aa(u);return r&&u.addEventListener("upgradeneeded",f=>{r(aa(u.result),f.oldVersion,f.newVersion,aa(u.transaction),f)}),n&&u.addEventListener("blocked",f=>n(f.oldVersion,f.newVersion,f)),h.then(f=>{o&&f.addEventListener("close",()=>o()),a&&f.addEventListener("versionchange",m=>a(m.oldVersion,m.newVersion,m))}).catch(()=>{}),h}const SD=["get","getKey","getAll","getAllKeys","count"],wD=["put","add","delete","clear"],jg=new Map;function Dx(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(jg.get(e))return jg.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,a=wD.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(a||SD.includes(n)))return;const o=async function(u,...h){const f=this.transaction(u,a?"readwrite":"readonly");let m=f.store;return r&&(m=m.index(h.shift())),(await Promise.all([m[n](...h),a&&f.done]))[0]};return jg.set(e,o),o}_D(t=>({...t,get:(e,n,r)=>Dx(e,n)||t.get(e,n,r),has:(e,n)=>!!Dx(e,n)||t.has(e,n)}));class ED{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(CD(n)){const r=n.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(n=>n).join(" ")}}function CD(t){return t.getComponent()?.type==="VERSION"}const Wg="@firebase/app",Ix="0.14.6";const di=new Py("@firebase/app"),TD="@firebase/app-compat",AD="@firebase/analytics-compat",jD="@firebase/analytics",RD="@firebase/app-check-compat",DD="@firebase/app-check",ID="@firebase/auth",MD="@firebase/auth-compat",kD="@firebase/database",OD="@firebase/data-connect",ND="@firebase/database-compat",PD="@firebase/functions",BD="@firebase/functions-compat",LD="@firebase/installations",zD="@firebase/installations-compat",UD="@firebase/messaging",FD="@firebase/messaging-compat",VD="@firebase/performance",$D="@firebase/performance-compat",qD="@firebase/remote-config",HD="@firebase/remote-config-compat",GD="@firebase/storage",QD="@firebase/storage-compat",WD="@firebase/firestore",KD="@firebase/ai",YD="@firebase/firestore-compat",XD="firebase",JD="12.6.0";const Kg="[DEFAULT]",ZD={[Wg]:"fire-core",[TD]:"fire-core-compat",[jD]:"fire-analytics",[AD]:"fire-analytics-compat",[DD]:"fire-app-check",[RD]:"fire-app-check-compat",[ID]:"fire-auth",[MD]:"fire-auth-compat",[kD]:"fire-rtdb",[OD]:"fire-data-connect",[ND]:"fire-rtdb-compat",[PD]:"fire-fn",[BD]:"fire-fn-compat",[LD]:"fire-iid",[zD]:"fire-iid-compat",[UD]:"fire-fcm",[FD]:"fire-fcm-compat",[VD]:"fire-perf",[$D]:"fire-perf-compat",[qD]:"fire-rc",[HD]:"fire-rc-compat",[GD]:"fire-gcs",[QD]:"fire-gcs-compat",[WD]:"fire-fst",[YD]:"fire-fst-compat",[KD]:"fire-vertex","fire-js":"fire-js",[XD]:"fire-js-all"};const lf=new Map,eI=new Map,Yg=new Map;function Mx(t,e){try{t.container.addComponent(e)}catch(n){di.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function Dl(t){const e=t.name;if(Yg.has(e))return di.debug(`There were multiple attempts to register component ${e}.`),!1;Yg.set(e,t);for(const n of lf.values())Mx(n,t);for(const n of eI.values())Mx(n,t);return!0}function Ly(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function Jr(t){return t==null?!1:t.settings!==void 0}const tI={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},oa=new $u("app","Firebase",tI);class nI{constructor(e,n,r){this._isDeleted=!1,this._options={...e},this._config={...n},this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new fo("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw oa.create("app-deleted",{appName:this._name})}}const Gl=JD;function SE(t,e={}){let n=t;typeof e!="object"&&(e={name:e});const r={name:Kg,automaticDataCollectionEnabled:!0,...e},a=r.name;if(typeof a!="string"||!a)throw oa.create("bad-app-name",{appName:String(a)});if(n||(n=gE()),!n)throw oa.create("no-options");const o=lf.get(a);if(o){if(fa(n,o.options)&&fa(r,o.config))return o;throw oa.create("duplicate-app",{appName:a})}const u=new lD(a);for(const f of Yg.values())u.addComponent(f);const h=new nI(n,r,u);return lf.set(a,h),h}function wE(t=Kg){const e=lf.get(t);if(!e&&t===Kg&&gE())return SE();if(!e)throw oa.create("no-app",{appName:t});return e}function la(t,e,n){let r=ZD[t]??t;n&&(r+=`-${n}`);const a=r.match(/\s|\//),o=e.match(/\s|\//);if(a||o){const u=[`Unable to register library "${r}" with version "${e}":`];a&&u.push(`library name "${r}" contains illegal characters (whitespace or "/")`),a&&o&&u.push("and"),o&&u.push(`version name "${e}" contains illegal characters (whitespace or "/")`),di.warn(u.join(" "));return}Dl(new fo(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}const rI="firebase-heartbeat-database",sI=1,Cu="firebase-heartbeat-store";let Rg=null;function EE(){return Rg||(Rg=xD(rI,sI,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(Cu)}catch(n){console.warn(n)}}}}).catch(t=>{throw oa.create("idb-open",{originalErrorMessage:t.message})})),Rg}async function iI(t){try{const n=(await EE()).transaction(Cu),r=await n.objectStore(Cu).get(CE(t));return await n.done,r}catch(e){if(e instanceof yi)di.warn(e.message);else{const n=oa.create("idb-get",{originalErrorMessage:e?.message});di.warn(n.message)}}}async function kx(t,e){try{const r=(await EE()).transaction(Cu,"readwrite");await r.objectStore(Cu).put(e,CE(t)),await r.done}catch(n){if(n instanceof yi)di.warn(n.message);else{const r=oa.create("idb-set",{originalErrorMessage:n?.message});di.warn(r.message)}}}function CE(t){return`${t.name}!${t.options.appId}`}const aI=1024,oI=30;class lI{constructor(e){this.container=e,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new uI(n),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){try{const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=Ox();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(a=>a.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:n}),this._heartbeatsCache.heartbeats.length>oI){const a=dI(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(a,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){di.warn(e)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const e=Ox(),{heartbeatsToSend:n,unsentEntries:r}=cI(this._heartbeatsCache.heartbeats),a=of(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),a}catch(e){return di.warn(e),""}}}function Ox(){return new Date().toISOString().substring(0,10)}function cI(t,e=aI){const n=[];let r=t.slice();for(const a of t){const o=n.find(u=>u.agent===a.agent);if(o){if(o.dates.push(a.date),Nx(n)>e){o.dates.pop();break}}else if(n.push({agent:a.agent,dates:[a.date]}),Nx(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}class uI{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Y5()?X5().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const n=await iI(this.app);return n?.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return kx(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return kx(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function Nx(t){return of(JSON.stringify({version:2,heartbeats:t})).length}function dI(t){if(t.length===0)return-1;let e=0,n=t[0].date;for(let r=1;r<t.length;r++)t[r].date<n&&(n=t[r].date,e=r);return e}function hI(t){Dl(new fo("platform-logger",e=>new ED(e),"PRIVATE")),Dl(new fo("heartbeat",e=>new lI(e),"PRIVATE")),la(Wg,Ix,t),la(Wg,Ix,"esm2020"),la("fire-js","")}hI("");function TE(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const fI=TE,AE=new $u("auth","Firebase",TE());const cf=new Py("@firebase/auth");function mI(t,...e){cf.logLevel<=rt.WARN&&cf.warn(`Auth (${Gl}): ${t}`,...e)}function Qh(t,...e){cf.logLevel<=rt.ERROR&&cf.error(`Auth (${Gl}): ${t}`,...e)}function ns(t,...e){throw zy(t,...e)}function Ds(t,...e){return zy(t,...e)}function jE(t,e,n){const r={...fI(),[e]:n};return new $u("auth","Firebase",r).create(e,{appName:t.name})}function ca(t){return jE(t,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function zy(t,...e){if(typeof t!="string"){const n=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=t.name),t._errorFactory.create(n,...r)}return AE.create(t,...e)}function Ue(t,e,...n){if(!t)throw zy(e,...n)}function ii(t){const e="INTERNAL ASSERTION FAILED: "+t;throw Qh(e),new Error(e)}function hi(t,e){t||ii(e)}function Xg(){return typeof self<"u"&&self.location?.href||""}function pI(){return Px()==="http:"||Px()==="https:"}function Px(){return typeof self<"u"&&self.location?.protocol||null}function gI(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(pI()||G5()||"connection"in navigator)?navigator.onLine:!0}function yI(){if(typeof navigator>"u")return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}class Hu{constructor(e,n){this.shortDelay=e,this.longDelay=n,hi(n>e,"Short delay should be less than long delay!"),this.isMobile=$5()||Q5()}get(){return gI()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function Uy(t,e){hi(t.emulator,"Emulator should always be set here");const{url:n}=t.emulator;return e?`${n}${e.startsWith("/")?e.slice(1):e}`:n}class RE{static initialize(e,n,r){this.fetchImpl=e,n&&(this.headersImpl=n),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;ii("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;ii("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;ii("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const _I={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};const bI=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],vI=new Hu(3e4,6e4);function xo(t,e){return t.tenantId&&!e.tenantId?{...e,tenantId:t.tenantId}:e}async function Sa(t,e,n,r,a={}){return DE(t,a,async()=>{let o={},u={};r&&(e==="GET"?u=r:o={body:JSON.stringify(r)});const h=qu({key:t.config.apiKey,...u}).slice(1),f=await t._getAdditionalHeaders();f["Content-Type"]="application/json",t.languageCode&&(f["X-Firebase-Locale"]=t.languageCode);const m={method:e,headers:f,...o};return H5()||(m.referrerPolicy="no-referrer"),t.emulatorConfig&&Hl(t.emulatorConfig.host)&&(m.credentials="include"),RE.fetch()(await IE(t,t.config.apiHost,n,h),m)})}async function DE(t,e,n){t._canInitEmulator=!1;const r={..._I,...e};try{const a=new SI(t),o=await Promise.race([n(),a.promise]);a.clearNetworkTimeout();const u=await o.json();if("needConfirmation"in u)throw Ph(t,"account-exists-with-different-credential",u);if(o.ok&&!("errorMessage"in u))return u;{const h=o.ok?u.errorMessage:u.error.message,[f,m]=h.split(" : ");if(f==="FEDERATED_USER_ID_ALREADY_LINKED")throw Ph(t,"credential-already-in-use",u);if(f==="EMAIL_EXISTS")throw Ph(t,"email-already-in-use",u);if(f==="USER_DISABLED")throw Ph(t,"user-disabled",u);const g=r[f]||f.toLowerCase().replace(/[_\s]+/g,"-");if(m)throw jE(t,g,m);ns(t,g)}}catch(a){if(a instanceof yi)throw a;ns(t,"network-request-failed",{message:String(a)})}}async function Vf(t,e,n,r,a={}){const o=await Sa(t,e,n,r,a);return"mfaPendingCredential"in o&&ns(t,"multi-factor-auth-required",{_serverResponse:o}),o}async function IE(t,e,n,r){const a=`${e}${n}?${r}`,o=t,u=o.config.emulator?Uy(t.config,a):`${t.config.apiScheme}://${a}`;return bI.includes(n)&&(await o._persistenceManagerAvailable,o._getPersistenceType()==="COOKIE")?o._getPersistence()._getFinalTarget(u).toString():u}function xI(t){switch(t){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class SI{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((n,r)=>{this.timer=setTimeout(()=>r(Ds(this.auth,"network-request-failed")),vI.get())})}}function Ph(t,e,n){const r={appName:t.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const a=Ds(t,e,r);return a.customData._tokenResponse=n,a}function Bx(t){return t!==void 0&&t.enterprise!==void 0}class wI{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const n of this.recaptchaEnforcementState)if(n.provider&&n.provider===e)return xI(n.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function EI(t,e){return Sa(t,"GET","/v2/recaptchaConfig",xo(t,e))}async function CI(t,e){return Sa(t,"POST","/v1/accounts:delete",e)}async function uf(t,e){return Sa(t,"POST","/v1/accounts:lookup",e)}function bu(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function TI(t,e=!1){const n=un(t),r=await n.getIdToken(e),a=Fy(r);Ue(a&&a.exp&&a.auth_time&&a.iat,n.auth,"internal-error");const o=typeof a.firebase=="object"?a.firebase:void 0,u=o?.sign_in_provider;return{claims:a,token:r,authTime:bu(Dg(a.auth_time)),issuedAtTime:bu(Dg(a.iat)),expirationTime:bu(Dg(a.exp)),signInProvider:u||null,signInSecondFactor:o?.sign_in_second_factor||null}}function Dg(t){return Number(t)*1e3}function Fy(t){const[e,n,r]=t.split(".");if(e===void 0||n===void 0||r===void 0)return Qh("JWT malformed, contained fewer than 3 sections"),null;try{const a=mE(n);return a?JSON.parse(a):(Qh("Failed to decode base64 JWT payload"),null)}catch(a){return Qh("Caught error parsing JWT payload as JSON",a?.toString()),null}}function Lx(t){const e=Fy(t);return Ue(e,"internal-error"),Ue(typeof e.exp<"u","internal-error"),Ue(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}async function Tu(t,e,n=!1){if(n)return e;try{return await e}catch(r){throw r instanceof yi&&AI(r)&&t.auth.currentUser===t&&await t.auth.signOut(),r}}function AI({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}class jI{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const n=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),n}else{this.errorBackoff=3e4;const r=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;const n=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},n)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class Jg{constructor(e,n){this.createdAt=e,this.lastLoginAt=n,this._initializeTime()}_initializeTime(){this.lastSignInTime=bu(this.lastLoginAt),this.creationTime=bu(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function df(t){const e=t.auth,n=await t.getIdToken(),r=await Tu(t,uf(e,{idToken:n}));Ue(r?.users.length,e,"internal-error");const a=r.users[0];t._notifyReloadListener(a);const o=a.providerUserInfo?.length?ME(a.providerUserInfo):[],u=DI(t.providerData,o),h=t.isAnonymous,f=!(t.email&&a.passwordHash)&&!u?.length,m=h?f:!1,g={uid:a.localId,displayName:a.displayName||null,photoURL:a.photoUrl||null,email:a.email||null,emailVerified:a.emailVerified||!1,phoneNumber:a.phoneNumber||null,tenantId:a.tenantId||null,providerData:u,metadata:new Jg(a.createdAt,a.lastLoginAt),isAnonymous:m};Object.assign(t,g)}async function RI(t){const e=un(t);await df(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function DI(t,e){return[...t.filter(r=>!e.some(a=>a.providerId===r.providerId)),...e]}function ME(t){return t.map(({providerId:e,...n})=>({providerId:e,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}))}async function II(t,e){const n=await DE(t,{},async()=>{const r=qu({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:a,apiKey:o}=t.config,u=await IE(t,a,"/v1/token",`key=${o}`),h=await t._getAdditionalHeaders();h["Content-Type"]="application/x-www-form-urlencoded";const f={method:"POST",headers:h,body:r};return t.emulatorConfig&&Hl(t.emulatorConfig.host)&&(f.credentials="include"),RE.fetch()(u,f)});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}async function MI(t,e){return Sa(t,"POST","/v2/accounts:revokeToken",xo(t,e))}class Cl{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Ue(e.idToken,"internal-error"),Ue(typeof e.idToken<"u","internal-error"),Ue(typeof e.refreshToken<"u","internal-error");const n="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):Lx(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,n)}updateFromIdToken(e){Ue(e.length!==0,"internal-error");const n=Lx(e);this.updateTokensAndExpiration(e,null,n)}async getToken(e,n=!1){return!n&&this.accessToken&&!this.isExpired?this.accessToken:(Ue(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,n){const{accessToken:r,refreshToken:a,expiresIn:o}=await II(e,n);this.updateTokensAndExpiration(r,a,Number(o))}updateTokensAndExpiration(e,n,r){this.refreshToken=n||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,n){const{refreshToken:r,accessToken:a,expirationTime:o}=n,u=new Cl;return r&&(Ue(typeof r=="string","internal-error",{appName:e}),u.refreshToken=r),a&&(Ue(typeof a=="string","internal-error",{appName:e}),u.accessToken=a),o&&(Ue(typeof o=="number","internal-error",{appName:e}),u.expirationTime=o),u}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Cl,this.toJSON())}_performRefresh(){return ii("not implemented")}}function Ji(t,e){Ue(typeof t=="string"||typeof t>"u","internal-error",{appName:e})}class Zr{constructor({uid:e,auth:n,stsTokenManager:r,...a}){this.providerId="firebase",this.proactiveRefresh=new jI(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=a.displayName||null,this.email=a.email||null,this.emailVerified=a.emailVerified||!1,this.phoneNumber=a.phoneNumber||null,this.photoURL=a.photoURL||null,this.isAnonymous=a.isAnonymous||!1,this.tenantId=a.tenantId||null,this.providerData=a.providerData?[...a.providerData]:[],this.metadata=new Jg(a.createdAt||void 0,a.lastLoginAt||void 0)}async getIdToken(e){const n=await Tu(this,this.stsTokenManager.getToken(this.auth,e));return Ue(n,this.auth,"internal-error"),this.accessToken!==n&&(this.accessToken=n,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),n}getIdTokenResult(e){return TI(this,e)}reload(){return RI(this)}_assign(e){this!==e&&(Ue(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(n=>({...n})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const n=new Zr({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return n.metadata._copy(this.metadata),n}_onReload(e){Ue(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,n=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),n&&await df(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Jr(this.auth.app))return Promise.reject(ca(this.auth));const e=await this.getIdToken();return await Tu(this,CI(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,n){const r=n.displayName??void 0,a=n.email??void 0,o=n.phoneNumber??void 0,u=n.photoURL??void 0,h=n.tenantId??void 0,f=n._redirectEventId??void 0,m=n.createdAt??void 0,g=n.lastLoginAt??void 0,{uid:_,emailVerified:v,isAnonymous:S,providerData:x,stsTokenManager:E}=n;Ue(_&&E,e,"internal-error");const C=Cl.fromJSON(this.name,E);Ue(typeof _=="string",e,"internal-error"),Ji(r,e.name),Ji(a,e.name),Ue(typeof v=="boolean",e,"internal-error"),Ue(typeof S=="boolean",e,"internal-error"),Ji(o,e.name),Ji(u,e.name),Ji(h,e.name),Ji(f,e.name),Ji(m,e.name),Ji(g,e.name);const I=new Zr({uid:_,auth:e,email:a,emailVerified:v,displayName:r,isAnonymous:S,photoURL:u,phoneNumber:o,tenantId:h,stsTokenManager:C,createdAt:m,lastLoginAt:g});return x&&Array.isArray(x)&&(I.providerData=x.map(j=>({...j}))),f&&(I._redirectEventId=f),I}static async _fromIdTokenResponse(e,n,r=!1){const a=new Cl;a.updateFromServerResponse(n);const o=new Zr({uid:n.localId,auth:e,stsTokenManager:a,isAnonymous:r});return await df(o),o}static async _fromGetAccountInfoResponse(e,n,r){const a=n.users[0];Ue(a.localId!==void 0,"internal-error");const o=a.providerUserInfo!==void 0?ME(a.providerUserInfo):[],u=!(a.email&&a.passwordHash)&&!o?.length,h=new Cl;h.updateFromIdToken(r);const f=new Zr({uid:a.localId,auth:e,stsTokenManager:h,isAnonymous:u}),m={uid:a.localId,displayName:a.displayName||null,photoURL:a.photoUrl||null,email:a.email||null,emailVerified:a.emailVerified||!1,phoneNumber:a.phoneNumber||null,tenantId:a.tenantId||null,providerData:o,metadata:new Jg(a.createdAt,a.lastLoginAt),isAnonymous:!(a.email&&a.passwordHash)&&!o?.length};return Object.assign(f,m),f}}const zx=new Map;function ai(t){hi(t instanceof Function,"Expected a class definition");let e=zx.get(t);return e?(hi(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,zx.set(t,e),e)}class kE{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,n){this.storage[e]=n}async _get(e){const n=this.storage[e];return n===void 0?null:n}async _remove(e){delete this.storage[e]}_addListener(e,n){}_removeListener(e,n){}}kE.type="NONE";const Ux=kE;function Wh(t,e,n){return`firebase:${t}:${e}:${n}`}class Tl{constructor(e,n,r){this.persistence=e,this.auth=n,this.userKey=r;const{config:a,name:o}=this.auth;this.fullUserKey=Wh(this.userKey,a.apiKey,o),this.fullPersistenceKey=Wh("persistence",a.apiKey,o),this.boundEventHandler=n._onStorageEvent.bind(n),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const n=await uf(this.auth,{idToken:e}).catch(()=>{});return n?Zr._fromGetAccountInfoResponse(this.auth,n,e):null}return Zr._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const n=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,n)return this.setCurrentUser(n)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,n,r="authUser"){if(!n.length)return new Tl(ai(Ux),e,r);const a=(await Promise.all(n.map(async m=>{if(await m._isAvailable())return m}))).filter(m=>m);let o=a[0]||ai(Ux);const u=Wh(r,e.config.apiKey,e.name);let h=null;for(const m of n)try{const g=await m._get(u);if(g){let _;if(typeof g=="string"){const v=await uf(e,{idToken:g}).catch(()=>{});if(!v)break;_=await Zr._fromGetAccountInfoResponse(e,v,g)}else _=Zr._fromJSON(e,g);m!==o&&(h=_),o=m;break}}catch{}const f=a.filter(m=>m._shouldAllowMigration);return!o._shouldAllowMigration||!f.length?new Tl(o,e,r):(o=f[0],h&&await o._set(u,h.toJSON()),await Promise.all(n.map(async m=>{if(m!==o)try{await m._remove(u)}catch{}})),new Tl(o,e,r))}}function Fx(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(BE(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(OE(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(zE(e))return"Blackberry";if(UE(e))return"Webos";if(NE(e))return"Safari";if((e.includes("chrome/")||PE(e))&&!e.includes("edge/"))return"Chrome";if(LE(e))return"Android";{const n=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=t.match(n);if(r?.length===2)return r[1]}return"Other"}function OE(t=Ln()){return/firefox\//i.test(t)}function NE(t=Ln()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function PE(t=Ln()){return/crios\//i.test(t)}function BE(t=Ln()){return/iemobile/i.test(t)}function LE(t=Ln()){return/android/i.test(t)}function zE(t=Ln()){return/blackberry/i.test(t)}function UE(t=Ln()){return/webos/i.test(t)}function Vy(t=Ln()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function kI(t=Ln()){return Vy(t)&&!!window.navigator?.standalone}function OI(){return W5()&&document.documentMode===10}function FE(t=Ln()){return Vy(t)||LE(t)||UE(t)||zE(t)||/windows phone/i.test(t)||BE(t)}function VE(t,e=[]){let n;switch(t){case"Browser":n=Fx(Ln());break;case"Worker":n=`${Fx(Ln())}-${t}`;break;default:n=t}const r=e.length?e.join(","):"FirebaseCore-web";return`${n}/JsCore/${Gl}/${r}`}class NI{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,n){const r=o=>new Promise((u,h)=>{try{const f=e(o);u(f)}catch(f){h(f)}});r.onAbort=n,this.queue.push(r);const a=this.queue.length-1;return()=>{this.queue[a]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const n=[];try{for(const r of this.queue)await r(e),r.onAbort&&n.push(r.onAbort)}catch(r){n.reverse();for(const a of n)try{a()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r?.message})}}}async function PI(t,e={}){return Sa(t,"GET","/v2/passwordPolicy",xo(t,e))}const BI=6;class LI{constructor(e){const n=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=n.minPasswordLength??BI,n.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=n.maxPasswordLength),n.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=n.containsLowercaseCharacter),n.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=n.containsUppercaseCharacter),n.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=n.containsNumericCharacter),n.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=n.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const n={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,n),this.validatePasswordCharacterOptions(e,n),n.isValid&&(n.isValid=n.meetsMinPasswordLength??!0),n.isValid&&(n.isValid=n.meetsMaxPasswordLength??!0),n.isValid&&(n.isValid=n.containsLowercaseLetter??!0),n.isValid&&(n.isValid=n.containsUppercaseLetter??!0),n.isValid&&(n.isValid=n.containsNumericCharacter??!0),n.isValid&&(n.isValid=n.containsNonAlphanumericCharacter??!0),n}validatePasswordLengthOptions(e,n){const r=this.customStrengthOptions.minPasswordLength,a=this.customStrengthOptions.maxPasswordLength;r&&(n.meetsMinPasswordLength=e.length>=r),a&&(n.meetsMaxPasswordLength=e.length<=a)}validatePasswordCharacterOptions(e,n){this.updatePasswordCharacterOptionsStatuses(n,!1,!1,!1,!1);let r;for(let a=0;a<e.length;a++)r=e.charAt(a),this.updatePasswordCharacterOptionsStatuses(n,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,n,r,a,o){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=n)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=a)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=o))}}class zI{constructor(e,n,r,a){this.app=e,this.heartbeatServiceProvider=n,this.appCheckServiceProvider=r,this.config=a,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Vx(this),this.idTokenSubscription=new Vx(this),this.beforeStateQueue=new NI(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=AE,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=a.sdkClientVersion,this._persistenceManagerAvailable=new Promise(o=>this._resolvePersistenceManagerAvailable=o)}_initializeWithPersistence(e,n){return n&&(this._popupRedirectResolver=ai(n)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await Tl.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(n),this.lastNotifiedUid=this.currentUser?.uid||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const n=await uf(this,{idToken:e}),r=await Zr._fromGetAccountInfoResponse(this,n,e);await this.directlySetCurrentUser(r)}catch(n){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",n),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(Jr(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(u=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(u,u))}):this.directlySetCurrentUser(null)}const n=await this.assertedPersistence.getCurrentUser();let r=n,a=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=this.redirectUser?._redirectEventId,u=r?._redirectEventId,h=await this.tryRedirectSignIn(e);(!o||o===u)&&h?.user&&(r=h.user,a=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(a)try{await this.beforeStateQueue.runMiddleware(r)}catch(o){r=n,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return Ue(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let n=null;try{n=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return n}async reloadAndSetCurrentUserOrClear(e){try{await df(e)}catch(n){if(n?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=yI()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Jr(this.app))return Promise.reject(ca(this));const n=e?un(e):null;return n&&Ue(n.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(n&&n._clone(this))}async _updateCurrentUser(e,n=!1){if(!this._deleted)return e&&Ue(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),n||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Jr(this.app)?Promise.reject(ca(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Jr(this.app)?Promise.reject(ca(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(ai(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const n=this._getPasswordPolicyInternal();return n.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):n.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await PI(this),n=new LI(e);this.tenantId===null?this._projectPasswordPolicy=n:this._tenantPasswordPolicies[this.tenantId]=n}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new $u("auth","Firebase",e())}onAuthStateChanged(e,n,r){return this.registerStateListener(this.authStateSubscription,e,n,r)}beforeAuthStateChanged(e,n){return this.beforeStateQueue.pushCallback(e,n)}onIdTokenChanged(e,n,r){return this.registerStateListener(this.idTokenSubscription,e,n,r)}authStateReady(){return new Promise((e,n)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},n)}})}async revokeAccessToken(e){if(this.currentUser){const n=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:n};this.tenantId!=null&&(r.tenantId=this.tenantId),await MI(this,r)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,n){const r=await this.getOrInitRedirectPersistenceManager(n);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const n=e&&ai(e)||this._popupRedirectResolver;Ue(n,this,"argument-error"),this.redirectPersistenceManager=await Tl.create(this,[ai(n._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,n,r,a){if(this._deleted)return()=>{};const o=typeof n=="function"?n:n.next.bind(n);let u=!1;const h=this._isInitialized?Promise.resolve():this._initializationPromise;if(Ue(h,this,"internal-error"),h.then(()=>{u||o(this.currentUser)}),typeof n=="function"){const f=e.addObserver(n,r,a);return()=>{u=!0,f()}}else{const f=e.addObserver(n);return()=>{u=!0,f()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Ue(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=VE(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const n=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();n&&(e["X-Firebase-Client"]=n);const r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){if(Jr(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&mI(`Error while retrieving App Check token: ${e.error}`),e?.token}}function Ql(t){return un(t)}class Vx{constructor(e){this.auth=e,this.observer=null,this.addObserver=nD(n=>this.observer=n)}get next(){return Ue(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let $f={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function UI(t){$f=t}function $E(t){return $f.loadJS(t)}function FI(){return $f.recaptchaEnterpriseScript}function VI(){return $f.gapiScript}function $I(t){return`__${t}${Math.floor(Math.random()*1e6)}`}class qI{constructor(){this.enterprise=new HI}ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}class HI{ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}const GI="recaptcha-enterprise",qE="NO_RECAPTCHA";class QI{constructor(e){this.type=GI,this.auth=Ql(e)}async verify(e="verify",n=!1){async function r(o){if(!n){if(o.tenantId==null&&o._agentRecaptchaConfig!=null)return o._agentRecaptchaConfig.siteKey;if(o.tenantId!=null&&o._tenantRecaptchaConfigs[o.tenantId]!==void 0)return o._tenantRecaptchaConfigs[o.tenantId].siteKey}return new Promise(async(u,h)=>{EI(o,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(f=>{if(f.recaptchaKey===void 0)h(new Error("recaptcha Enterprise site key undefined"));else{const m=new wI(f);return o.tenantId==null?o._agentRecaptchaConfig=m:o._tenantRecaptchaConfigs[o.tenantId]=m,u(m.siteKey)}}).catch(f=>{h(f)})})}function a(o,u,h){const f=window.grecaptcha;Bx(f)?f.enterprise.ready(()=>{f.enterprise.execute(o,{action:e}).then(m=>{u(m)}).catch(()=>{u(qE)})}):h(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new qI().execute("siteKey",{action:"verify"}):new Promise((o,u)=>{r(this.auth).then(h=>{if(!n&&Bx(window.grecaptcha))a(h,o,u);else{if(typeof window>"u"){u(new Error("RecaptchaVerifier is only supported in browser"));return}let f=FI();f.length!==0&&(f+=h),$E(f).then(()=>{a(h,o,u)}).catch(m=>{u(m)})}}).catch(h=>{u(h)})})}}async function $x(t,e,n,r=!1,a=!1){const o=new QI(t);let u;if(a)u=qE;else try{u=await o.verify(n)}catch{u=await o.verify(n,!0)}const h={...e};if(n==="mfaSmsEnrollment"||n==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in h){const f=h.phoneEnrollmentInfo.phoneNumber,m=h.phoneEnrollmentInfo.recaptchaToken;Object.assign(h,{phoneEnrollmentInfo:{phoneNumber:f,recaptchaToken:m,captchaResponse:u,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in h){const f=h.phoneSignInInfo.recaptchaToken;Object.assign(h,{phoneSignInInfo:{recaptchaToken:f,captchaResponse:u,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return h}return r?Object.assign(h,{captchaResp:u}):Object.assign(h,{captchaResponse:u}),Object.assign(h,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(h,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),h}async function qx(t,e,n,r,a){if(t._getRecaptchaConfig()?.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const o=await $x(t,e,n,n==="getOobCode");return r(t,o)}else return r(t,e).catch(async o=>{if(o.code==="auth/missing-recaptcha-token"){console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const u=await $x(t,e,n,n==="getOobCode");return r(t,u)}else return Promise.reject(o)})}function WI(t,e){const n=Ly(t,"auth");if(n.isInitialized()){const a=n.getImmediate(),o=n.getOptions();if(fa(o,e??{}))return a;ns(a,"already-initialized")}return n.initialize({options:e})}function KI(t,e){const n=e?.persistence||[],r=(Array.isArray(n)?n:[n]).map(ai);e?.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(r,e?.popupRedirectResolver)}function YI(t,e,n){const r=Ql(t);Ue(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const a=!1,o=HE(e),{host:u,port:h}=XI(e),f=h===null?"":`:${h}`,m={url:`${o}//${u}${f}/`},g=Object.freeze({host:u,port:h,protocol:o.replace(":",""),options:Object.freeze({disableWarnings:a})});if(!r._canInitEmulator){Ue(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),Ue(fa(m,r.config.emulator)&&fa(g,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=m,r.emulatorConfig=g,r.settings.appVerificationDisabledForTesting=!0,Hl(u)?(_E(`${o}//${u}${f}`),bE("Auth",!0)):JI()}function HE(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function XI(t){const e=HE(t),n=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",a=/^(\[[^\]]+\])(:|$)/.exec(r);if(a){const o=a[1];return{host:o,port:Hx(r.substr(o.length+1))}}else{const[o,u]=r.split(":");return{host:o,port:Hx(u)}}}function Hx(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}function JI(){function t(){const e=document.createElement("p"),n=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",n.position="fixed",n.width="100%",n.backgroundColor="#ffffff",n.border=".1em solid #000000",n.color="#b50000",n.bottom="0px",n.left="0px",n.margin="0px",n.zIndex="10000",n.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",t):t())}class $y{constructor(e,n){this.providerId=e,this.signInMethod=n}toJSON(){return ii("not implemented")}_getIdTokenResponse(e){return ii("not implemented")}_linkToIdToken(e,n){return ii("not implemented")}_getReauthenticationResolver(e){return ii("not implemented")}}async function ZI(t,e){return Sa(t,"POST","/v1/accounts:signUp",e)}async function eM(t,e){return Vf(t,"POST","/v1/accounts:signInWithPassword",xo(t,e))}async function tM(t,e){return Vf(t,"POST","/v1/accounts:signInWithEmailLink",xo(t,e))}async function nM(t,e){return Vf(t,"POST","/v1/accounts:signInWithEmailLink",xo(t,e))}class Au extends $y{constructor(e,n,r,a=null){super("password",r),this._email=e,this._password=n,this._tenantId=a}static _fromEmailAndPassword(e,n){return new Au(e,n,"password")}static _fromEmailAndCode(e,n,r=null){return new Au(e,n,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e;if(n?.email&&n?.password){if(n.signInMethod==="password")return this._fromEmailAndPassword(n.email,n.password);if(n.signInMethod==="emailLink")return this._fromEmailAndCode(n.email,n.password,n.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const n={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return qx(e,n,"signInWithPassword",eM);case"emailLink":return tM(e,{email:this._email,oobCode:this._password});default:ns(e,"internal-error")}}async _linkToIdToken(e,n){switch(this.signInMethod){case"password":const r={idToken:n,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return qx(e,r,"signUpPassword",ZI);case"emailLink":return nM(e,{idToken:n,email:this._email,oobCode:this._password});default:ns(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function Al(t,e){return Vf(t,"POST","/v1/accounts:signInWithIdp",xo(t,e))}const rM="http://localhost";class mo extends $y{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const n=new mo(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(n.idToken=e.idToken),e.accessToken&&(n.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(n.nonce=e.nonce),e.pendingToken&&(n.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(n.accessToken=e.oauthToken,n.secret=e.oauthTokenSecret):ns("argument-error"),n}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:a,...o}=n;if(!r||!a)return null;const u=new mo(r,a);return u.idToken=o.idToken||void 0,u.accessToken=o.accessToken||void 0,u.secret=o.secret,u.nonce=o.nonce,u.pendingToken=o.pendingToken||null,u}_getIdTokenResponse(e){const n=this.buildRequest();return Al(e,n)}_linkToIdToken(e,n){const r=this.buildRequest();return r.idToken=n,Al(e,r)}_getReauthenticationResolver(e){const n=this.buildRequest();return n.autoCreate=!1,Al(e,n)}buildRequest(){const e={requestUri:rM,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const n={};this.idToken&&(n.id_token=this.idToken),this.accessToken&&(n.access_token=this.accessToken),this.secret&&(n.oauth_token_secret=this.secret),n.providerId=this.providerId,this.nonce&&!this.pendingToken&&(n.nonce=this.nonce),e.postBody=qu(n)}return e}}function sM(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function iM(t){const e=hu(fu(t)).link,n=e?hu(fu(e)).deep_link_id:null,r=hu(fu(t)).deep_link_id;return(r?hu(fu(r)).link:null)||r||n||e||t}class qy{constructor(e){const n=hu(fu(e)),r=n.apiKey??null,a=n.oobCode??null,o=sM(n.mode??null);Ue(r&&a&&o,"argument-error"),this.apiKey=r,this.operation=o,this.code=a,this.continueUrl=n.continueUrl??null,this.languageCode=n.lang??null,this.tenantId=n.tenantId??null}static parseLink(e){const n=iM(e);try{return new qy(n)}catch{return null}}}class Wl{constructor(){this.providerId=Wl.PROVIDER_ID}static credential(e,n){return Au._fromEmailAndPassword(e,n)}static credentialWithLink(e,n){const r=qy.parseLink(n);return Ue(r,"argument-error"),Au._fromEmailAndCode(e,r.code,r.tenantId)}}Wl.PROVIDER_ID="password";Wl.EMAIL_PASSWORD_SIGN_IN_METHOD="password";Wl.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class GE{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class Gu extends GE{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class ea extends Gu{constructor(){super("facebook.com")}static credential(e){return mo._fromParams({providerId:ea.PROVIDER_ID,signInMethod:ea.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return ea.credentialFromTaggedObject(e)}static credentialFromError(e){return ea.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return ea.credential(e.oauthAccessToken)}catch{return null}}}ea.FACEBOOK_SIGN_IN_METHOD="facebook.com";ea.PROVIDER_ID="facebook.com";class ta extends Gu{constructor(){super("google.com"),this.addScope("profile")}static credential(e,n){return mo._fromParams({providerId:ta.PROVIDER_ID,signInMethod:ta.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:n})}static credentialFromResult(e){return ta.credentialFromTaggedObject(e)}static credentialFromError(e){return ta.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:n,oauthAccessToken:r}=e;if(!n&&!r)return null;try{return ta.credential(n,r)}catch{return null}}}ta.GOOGLE_SIGN_IN_METHOD="google.com";ta.PROVIDER_ID="google.com";class na extends Gu{constructor(){super("github.com")}static credential(e){return mo._fromParams({providerId:na.PROVIDER_ID,signInMethod:na.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return na.credentialFromTaggedObject(e)}static credentialFromError(e){return na.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return na.credential(e.oauthAccessToken)}catch{return null}}}na.GITHUB_SIGN_IN_METHOD="github.com";na.PROVIDER_ID="github.com";class ra extends Gu{constructor(){super("twitter.com")}static credential(e,n){return mo._fromParams({providerId:ra.PROVIDER_ID,signInMethod:ra.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:n})}static credentialFromResult(e){return ra.credentialFromTaggedObject(e)}static credentialFromError(e){return ra.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:n,oauthTokenSecret:r}=e;if(!n||!r)return null;try{return ra.credential(n,r)}catch{return null}}}ra.TWITTER_SIGN_IN_METHOD="twitter.com";ra.PROVIDER_ID="twitter.com";class Il{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,n,r,a=!1){const o=await Zr._fromIdTokenResponse(e,r,a),u=Gx(r);return new Il({user:o,providerId:u,_tokenResponse:r,operationType:n})}static async _forOperation(e,n,r){await e._updateTokensIfNecessary(r,!0);const a=Gx(r);return new Il({user:e,providerId:a,_tokenResponse:r,operationType:n})}}function Gx(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}class hf extends yi{constructor(e,n,r,a){super(n.code,n.message),this.operationType=r,this.user=a,Object.setPrototypeOf(this,hf.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:n.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,n,r,a){return new hf(e,n,r,a)}}function QE(t,e,n,r){return(e==="reauthenticate"?n._getReauthenticationResolver(t):n._getIdTokenResponse(t)).catch(o=>{throw o.code==="auth/multi-factor-auth-required"?hf._fromErrorAndOperation(t,o,e,r):o})}async function aM(t,e,n=!1){const r=await Tu(t,e._linkToIdToken(t.auth,await t.getIdToken()),n);return Il._forOperation(t,"link",r)}async function oM(t,e,n=!1){const{auth:r}=t;if(Jr(r.app))return Promise.reject(ca(r));const a="reauthenticate";try{const o=await Tu(t,QE(r,a,e,t),n);Ue(o.idToken,r,"internal-error");const u=Fy(o.idToken);Ue(u,r,"internal-error");const{sub:h}=u;return Ue(t.uid===h,r,"user-mismatch"),Il._forOperation(t,a,o)}catch(o){throw o?.code==="auth/user-not-found"&&ns(r,"user-mismatch"),o}}async function WE(t,e,n=!1){if(Jr(t.app))return Promise.reject(ca(t));const r="signIn",a=await QE(t,r,e),o=await Il._fromIdTokenResponse(t,r,a);return n||await t._updateCurrentUser(o.user),o}async function lM(t,e){return WE(Ql(t),e)}async function cM(t){const e=Ql(t);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}function uM(t,e,n){return Jr(t.app)?Promise.reject(ca(t)):lM(un(t),Wl.credential(e,n)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&cM(t),r})}function dM(t,e,n,r){return un(t).onIdTokenChanged(e,n,r)}function hM(t,e,n){return un(t).beforeAuthStateChanged(e,n)}function fM(t,e,n,r){return un(t).onAuthStateChanged(e,n,r)}function mM(t){return un(t).signOut()}const ff="__sak";class KE{constructor(e,n){this.storageRetriever=e,this.type=n}_isAvailable(){try{return this.storage?(this.storage.setItem(ff,"1"),this.storage.removeItem(ff),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,n){return this.storage.setItem(e,JSON.stringify(n)),Promise.resolve()}_get(e){const n=this.storage.getItem(e);return Promise.resolve(n?JSON.parse(n):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}const pM=1e3,gM=10;class YE extends KE{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,n)=>this.onStorageEvent(e,n),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=FE(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const n of Object.keys(this.listeners)){const r=this.storage.getItem(n),a=this.localCache[n];r!==a&&e(n,a,r)}}onStorageEvent(e,n=!1){if(!e.key){this.forAllChangedKeys((u,h,f)=>{this.notifyListeners(u,f)});return}const r=e.key;n?this.detachListener():this.stopPolling();const a=()=>{const u=this.storage.getItem(r);!n&&this.localCache[r]===u||this.notifyListeners(r,u)},o=this.storage.getItem(r);OI()&&o!==e.newValue&&e.newValue!==e.oldValue?setTimeout(a,gM):a()}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const a of Array.from(r))a(n&&JSON.parse(n))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,n,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:n,newValue:r}),!0)})},pM)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,n){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,n){await super._set(e,n),this.localCache[e]=JSON.stringify(n)}async _get(e){const n=await super._get(e);return this.localCache[e]=JSON.stringify(n),n}async _remove(e){await super._remove(e),delete this.localCache[e]}}YE.type="LOCAL";const yM=YE;class XE extends KE{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,n){}_removeListener(e,n){}}XE.type="SESSION";const JE=XE;function _M(t){return Promise.all(t.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(n){return{fulfilled:!1,reason:n}}}))}class qf{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const n=this.receivers.find(a=>a.isListeningto(e));if(n)return n;const r=new qf(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const n=e,{eventId:r,eventType:a,data:o}=n.data,u=this.handlersMap[a];if(!u?.size)return;n.ports[0].postMessage({status:"ack",eventId:r,eventType:a});const h=Array.from(u).map(async m=>m(n.origin,o)),f=await _M(h);n.ports[0].postMessage({status:"done",eventId:r,eventType:a,response:f})}_subscribe(e,n){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(n)}_unsubscribe(e,n){this.handlersMap[e]&&n&&this.handlersMap[e].delete(n),(!n||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}qf.receivers=[];function Hy(t="",e=10){let n="";for(let r=0;r<e;r++)n+=Math.floor(Math.random()*10);return t+n}class bM{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,n,r=50){const a=typeof MessageChannel<"u"?new MessageChannel:null;if(!a)throw new Error("connection_unavailable");let o,u;return new Promise((h,f)=>{const m=Hy("",20);a.port1.start();const g=setTimeout(()=>{f(new Error("unsupported_event"))},r);u={messageChannel:a,onMessage(_){const v=_;if(v.data.eventId===m)switch(v.data.status){case"ack":clearTimeout(g),o=setTimeout(()=>{f(new Error("timeout"))},3e3);break;case"done":clearTimeout(o),h(v.data.response);break;default:clearTimeout(g),clearTimeout(o),f(new Error("invalid_response"));break}}},this.handlers.add(u),a.port1.addEventListener("message",u.onMessage),this.target.postMessage({eventType:e,eventId:m,data:n},[a.port2])}).finally(()=>{u&&this.removeMessageHandler(u)})}}function Is(){return window}function vM(t){Is().location.href=t}function ZE(){return typeof Is().WorkerGlobalScope<"u"&&typeof Is().importScripts=="function"}async function xM(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function SM(){return navigator?.serviceWorker?.controller||null}function wM(){return ZE()?self:null}const e1="firebaseLocalStorageDb",EM=1,mf="firebaseLocalStorage",t1="fbase_key";class Qu{constructor(e){this.request=e}toPromise(){return new Promise((e,n)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{n(this.request.error)})})}}function Hf(t,e){return t.transaction([mf],e?"readwrite":"readonly").objectStore(mf)}function CM(){const t=indexedDB.deleteDatabase(e1);return new Qu(t).toPromise()}function Zg(){const t=indexedDB.open(e1,EM);return new Promise((e,n)=>{t.addEventListener("error",()=>{n(t.error)}),t.addEventListener("upgradeneeded",()=>{const r=t.result;try{r.createObjectStore(mf,{keyPath:t1})}catch(a){n(a)}}),t.addEventListener("success",async()=>{const r=t.result;r.objectStoreNames.contains(mf)?e(r):(r.close(),await CM(),e(await Zg()))})})}async function Qx(t,e,n){const r=Hf(t,!0).put({[t1]:e,value:n});return new Qu(r).toPromise()}async function TM(t,e){const n=Hf(t,!1).get(e),r=await new Qu(n).toPromise();return r===void 0?null:r.value}function Wx(t,e){const n=Hf(t,!0).delete(e);return new Qu(n).toPromise()}const AM=800,jM=3;class n1{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Zg(),this.db)}async _withRetries(e){let n=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(n++>jM)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return ZE()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=qf._getInstance(wM()),this.receiver._subscribe("keyChanged",async(e,n)=>({keyProcessed:(await this._poll()).includes(n.key)})),this.receiver._subscribe("ping",async(e,n)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await xM(),!this.activeServiceWorker)return;this.sender=new bM(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||SM()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Zg();return await Qx(e,ff,"1"),await Wx(e,ff),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,n){return this._withPendingWrite(async()=>(await this._withRetries(r=>Qx(r,e,n)),this.localCache[e]=n,this.notifyServiceWorker(e)))}async _get(e){const n=await this._withRetries(r=>TM(r,e));return this.localCache[e]=n,n}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(n=>Wx(n,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(a=>{const o=Hf(a,!1).getAll();return new Qu(o).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const n=[],r=new Set;if(e.length!==0)for(const{fbase_key:a,value:o}of e)r.add(a),JSON.stringify(this.localCache[a])!==JSON.stringify(o)&&(this.notifyListeners(a,o),n.push(a));for(const a of Object.keys(this.localCache))this.localCache[a]&&!r.has(a)&&(this.notifyListeners(a,null),n.push(a));return n}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const a of Array.from(r))a(n)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),AM)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,n){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}n1.type="LOCAL";const RM=n1;new Hu(3e4,6e4);function DM(t,e){return e?ai(e):(Ue(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}class Gy extends $y{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Al(e,this._buildIdpRequest())}_linkToIdToken(e,n){return Al(e,this._buildIdpRequest(n))}_getReauthenticationResolver(e){return Al(e,this._buildIdpRequest())}_buildIdpRequest(e){const n={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(n.idToken=e),n}}function IM(t){return WE(t.auth,new Gy(t),t.bypassAuthState)}function MM(t){const{auth:e,user:n}=t;return Ue(n,e,"internal-error"),oM(n,new Gy(t),t.bypassAuthState)}async function kM(t){const{auth:e,user:n}=t;return Ue(n,e,"internal-error"),aM(n,new Gy(t),t.bypassAuthState)}class r1{constructor(e,n,r,a,o=!1){this.auth=e,this.resolver=r,this.user=a,this.bypassAuthState=o,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(n)?n:[n]}execute(){return new Promise(async(e,n)=>{this.pendingPromise={resolve:e,reject:n};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:n,sessionId:r,postBody:a,tenantId:o,error:u,type:h}=e;if(u){this.reject(u);return}const f={auth:this.auth,requestUri:n,sessionId:r,tenantId:o||void 0,postBody:a||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(h)(f))}catch(m){this.reject(m)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return IM;case"linkViaPopup":case"linkViaRedirect":return kM;case"reauthViaPopup":case"reauthViaRedirect":return MM;default:ns(this.auth,"internal-error")}}resolve(e){hi(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){hi(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const OM=new Hu(2e3,1e4);class El extends r1{constructor(e,n,r,a,o){super(e,n,a,o),this.provider=r,this.authWindow=null,this.pollId=null,El.currentPopupAction&&El.currentPopupAction.cancel(),El.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Ue(e,this.auth,"internal-error"),e}async onExecution(){hi(this.filter.length===1,"Popup operations only handle one event");const e=Hy();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(n=>{this.reject(n)}),this.resolver._isIframeWebStorageSupported(this.auth,n=>{n||this.reject(Ds(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(Ds(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,El.currentPopupAction=null}pollUserCancellation(){const e=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Ds(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,OM.get())};e()}}El.currentPopupAction=null;const NM="pendingRedirect",Kh=new Map;class PM extends r1{constructor(e,n,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],n,void 0,r),this.eventId=null}async execute(){let e=Kh.get(this.auth._key());if(!e){try{const r=await BM(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(n){e=()=>Promise.reject(n)}Kh.set(this.auth._key(),e)}return this.bypassAuthState||Kh.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const n=await this.auth._redirectUserForId(e.eventId);if(n)return this.user=n,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function BM(t,e){const n=UM(e),r=zM(t);if(!await r._isAvailable())return!1;const a=await r._get(n)==="true";return await r._remove(n),a}function LM(t,e){Kh.set(t._key(),e)}function zM(t){return ai(t._redirectPersistence)}function UM(t){return Wh(NM,t.config.apiKey,t.name)}async function FM(t,e,n=!1){if(Jr(t.app))return Promise.reject(ca(t));const r=Ql(t),a=DM(r,e),u=await new PM(r,a,n).execute();return u&&!n&&(delete u.user._redirectEventId,await r._persistUserIfCurrent(u.user),await r._setRedirectUser(null,e)),u}const VM=600*1e3;class $M{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let n=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(n=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!qM(e)||(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=e,n=!0)),n}sendToConsumer(e,n){if(e.error&&!s1(e)){const r=e.error.code?.split("auth/")[1]||"internal-error";n.onError(Ds(this.auth,r))}else n.onAuthEvent(e)}isEventForConsumer(e,n){const r=n.eventId===null||!!e.eventId&&e.eventId===n.eventId;return n.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=VM&&this.cachedEventUids.clear(),this.cachedEventUids.has(Kx(e))}saveEventToCache(e){this.cachedEventUids.add(Kx(e)),this.lastProcessedEventTime=Date.now()}}function Kx(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(e=>e).join("-")}function s1({type:t,error:e}){return t==="unknown"&&e?.code==="auth/no-auth-event"}function qM(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return s1(t);default:return!1}}async function HM(t,e={}){return Sa(t,"GET","/v1/projects",e)}const GM=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,QM=/^https?/;async function WM(t){if(t.config.emulator)return;const{authorizedDomains:e}=await HM(t);for(const n of e)try{if(KM(n))return}catch{}ns(t,"unauthorized-domain")}function KM(t){const e=Xg(),{protocol:n,hostname:r}=new URL(e);if(t.startsWith("chrome-extension://")){const u=new URL(t);return u.hostname===""&&r===""?n==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):n==="chrome-extension:"&&u.hostname===r}if(!QM.test(n))return!1;if(GM.test(t))return r===t;const a=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+a+"|"+a+")$","i").test(r)}const YM=new Hu(3e4,6e4);function Yx(){const t=Is().___jsl;if(t?.H){for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let n=0;n<t.CP.length;n++)t.CP[n]=null}}function XM(t){return new Promise((e,n)=>{function r(){Yx(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{Yx(),n(Ds(t,"network-request-failed"))},timeout:YM.get()})}if(Is().gapi?.iframes?.Iframe)e(gapi.iframes.getContext());else if(Is().gapi?.load)r();else{const a=$I("iframefcb");return Is()[a]=()=>{gapi.load?r():n(Ds(t,"network-request-failed"))},$E(`${VI()}?onload=${a}`).catch(o=>n(o))}}).catch(e=>{throw Yh=null,e})}let Yh=null;function JM(t){return Yh=Yh||XM(t),Yh}const ZM=new Hu(5e3,15e3),e2="__/auth/iframe",t2="emulator/auth/iframe",n2={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},r2=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function s2(t){const e=t.config;Ue(e.authDomain,t,"auth-domain-config-required");const n=e.emulator?Uy(e,t2):`https://${t.config.authDomain}/${e2}`,r={apiKey:e.apiKey,appName:t.name,v:Gl},a=r2.get(t.config.apiHost);a&&(r.eid=a);const o=t._getFrameworks();return o.length&&(r.fw=o.join(",")),`${n}?${qu(r).slice(1)}`}async function i2(t){const e=await JM(t),n=Is().gapi;return Ue(n,t,"internal-error"),e.open({where:document.body,url:s2(t),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:n2,dontclear:!0},r=>new Promise(async(a,o)=>{await r.restyle({setHideOnLeave:!1});const u=Ds(t,"network-request-failed"),h=Is().setTimeout(()=>{o(u)},ZM.get());function f(){Is().clearTimeout(h),a(r)}r.ping(f).then(f,()=>{o(u)})}))}const a2={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},o2=500,l2=600,c2="_blank",u2="http://localhost";class Xx{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function d2(t,e,n,r=o2,a=l2){const o=Math.max((window.screen.availHeight-a)/2,0).toString(),u=Math.max((window.screen.availWidth-r)/2,0).toString();let h="";const f={...a2,width:r.toString(),height:a.toString(),top:o,left:u},m=Ln().toLowerCase();n&&(h=PE(m)?c2:n),OE(m)&&(e=e||u2,f.scrollbars="yes");const g=Object.entries(f).reduce((v,[S,x])=>`${v}${S}=${x},`,"");if(kI(m)&&h!=="_self")return h2(e||"",h),new Xx(null);const _=window.open(e||"",h,g);Ue(_,t,"popup-blocked");try{_.focus()}catch{}return new Xx(_)}function h2(t,e){const n=document.createElement("a");n.href=t,n.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}const f2="__/auth/handler",m2="emulator/auth/handler",p2=encodeURIComponent("fac");async function Jx(t,e,n,r,a,o){Ue(t.config.authDomain,t,"auth-domain-config-required"),Ue(t.config.apiKey,t,"invalid-api-key");const u={apiKey:t.config.apiKey,appName:t.name,authType:n,redirectUrl:r,v:Gl,eventId:a};if(e instanceof GE){e.setDefaultLanguage(t.languageCode),u.providerId=e.providerId||"",tD(e.getCustomParameters())||(u.customParameters=JSON.stringify(e.getCustomParameters()));for(const[g,_]of Object.entries({}))u[g]=_}if(e instanceof Gu){const g=e.getScopes().filter(_=>_!=="");g.length>0&&(u.scopes=g.join(","))}t.tenantId&&(u.tid=t.tenantId);const h=u;for(const g of Object.keys(h))h[g]===void 0&&delete h[g];const f=await t._getAppCheckToken(),m=f?`#${p2}=${encodeURIComponent(f)}`:"";return`${g2(t)}?${qu(h).slice(1)}${m}`}function g2({config:t}){return t.emulator?Uy(t,m2):`https://${t.authDomain}/${f2}`}const Ig="webStorageSupport";class y2{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=JE,this._completeRedirectFn=FM,this._overrideRedirectResult=LM}async _openPopup(e,n,r,a){hi(this.eventManagers[e._key()]?.manager,"_initialize() not called before _openPopup()");const o=await Jx(e,n,r,Xg(),a);return d2(e,o,Hy())}async _openRedirect(e,n,r,a){await this._originValidation(e);const o=await Jx(e,n,r,Xg(),a);return vM(o),new Promise(()=>{})}_initialize(e){const n=e._key();if(this.eventManagers[n]){const{manager:a,promise:o}=this.eventManagers[n];return a?Promise.resolve(a):(hi(o,"If manager is not set, promise should be"),o)}const r=this.initAndGetManager(e);return this.eventManagers[n]={promise:r},r.catch(()=>{delete this.eventManagers[n]}),r}async initAndGetManager(e){const n=await i2(e),r=new $M(e);return n.register("authEvent",a=>(Ue(a?.authEvent,e,"invalid-auth-event"),{status:r.onEvent(a.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=n,r}_isIframeWebStorageSupported(e,n){this.iframes[e._key()].send(Ig,{type:Ig},a=>{const o=a?.[0]?.[Ig];o!==void 0&&n(!!o),ns(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const n=e._key();return this.originValidationPromises[n]||(this.originValidationPromises[n]=WM(e)),this.originValidationPromises[n]}get _shouldInitProactively(){return FE()||NE()||Vy()}}const _2=y2;var Zx="@firebase/auth",eS="1.12.0";class b2{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const n=this.auth.onIdTokenChanged(r=>{e(r?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,n),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const n=this.internalListeners.get(e);n&&(this.internalListeners.delete(e),n(),this.updateProactiveRefresh())}assertAuthConfigured(){Ue(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function v2(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function x2(t){Dl(new fo("auth",(e,{options:n})=>{const r=e.getProvider("app").getImmediate(),a=e.getProvider("heartbeat"),o=e.getProvider("app-check-internal"),{apiKey:u,authDomain:h}=r.options;Ue(u&&!u.includes(":"),"invalid-api-key",{appName:r.name});const f={apiKey:u,authDomain:h,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:VE(t)},m=new zI(r,a,o,f);return KI(m,n),m},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,n,r)=>{e.getProvider("auth-internal").initialize()})),Dl(new fo("auth-internal",e=>{const n=Ql(e.getProvider("auth").getImmediate());return(r=>new b2(r))(n)},"PRIVATE").setInstantiationMode("EXPLICIT")),la(Zx,eS,v2(t)),la(Zx,eS,"esm2020")}const S2=300,w2=yE("authIdTokenMaxAge")||S2;let tS=null;const E2=t=>async e=>{const n=e&&await e.getIdTokenResult(),r=n&&(new Date().getTime()-Date.parse(n.issuedAtTime))/1e3;if(r&&r>w2)return;const a=n?.token;tS!==a&&(tS=a,await fetch(t,{method:a?"POST":"DELETE",headers:a?{Authorization:`Bearer ${a}`}:{}}))};function C2(t=wE()){const e=Ly(t,"auth");if(e.isInitialized())return e.getImmediate();const n=WI(t,{popupRedirectResolver:_2,persistence:[RM,yM,JE]}),r=yE("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const o=new URL(r,location.origin);if(location.origin===o.origin){const u=E2(o.toString());hM(n,u,()=>u(n.currentUser)),dM(n,h=>u(h))}}const a=pE("auth");return a&&YI(n,`http://${a}`),n}function T2(){return document.getElementsByTagName("head")?.[0]??document}UI({loadJS(t){return new Promise((e,n)=>{const r=document.createElement("script");r.setAttribute("src",t),r.onload=e,r.onerror=a=>{const o=Ds("internal-error");o.customData=a,n(o)},r.type="text/javascript",r.charset="UTF-8",T2().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});x2("Browser");var A2="firebase",j2="12.7.0";la(A2,j2,"app");const R2={apiKey:"AIzaSyCfvR8bEeW2CXdD31Ec34doRNThnbryXJo",authDomain:"budget-tkl.firebaseapp.com",projectId:"budget-tkl",storageBucket:"budget-tkl.firebasestorage.app",messagingSenderId:"631248313026",appId:"1:631248313026:web:36574d789a42b2d102f95b"},i1=SE(R2);function wa(){const t=C2(i1);async function e(){return!1}async function n(f,m){return uM(t,f,m)}function r(){return mM(t)}function a(f){fM(t,m=>{f(m)})}function o(){return t.currentUser}function u(){const f=t.currentUser;if(!f)throw new Error("Not authenticated");if(!f.email)throw new Error("Email is required but not available for this account");return f.email}return{set_user_listener:a,delete_firebase_user:e,login_firebase_user:n,logout_firebase_user:r,get_current_firebase_user:o,requireUserEmail:u}}var Kl=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(t){return this.listeners.add(t),this.onSubscribe(),()=>{this.listeners.delete(t),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},D2={setTimeout:(t,e)=>setTimeout(t,e),clearTimeout:t=>clearTimeout(t),setInterval:(t,e)=>setInterval(t,e),clearInterval:t=>clearInterval(t)},I2=class{#e=D2;#t=!1;setTimeoutProvider(t){this.#e=t}setTimeout(t,e){return this.#e.setTimeout(t,e)}clearTimeout(t){this.#e.clearTimeout(t)}setInterval(t,e){return this.#e.setInterval(t,e)}clearInterval(t){this.#e.clearInterval(t)}},oi=new I2;function M2(t){setTimeout(t,0)}var po=typeof window>"u"||"Deno"in globalThis;function mn(){}function k2(t,e){return typeof t=="function"?t(e):t}function ey(t){return typeof t=="number"&&t>=0&&t!==1/0}function a1(t,e){return Math.max(t+(e||0)-Date.now(),0)}function ua(t,e){return typeof t=="function"?t(e):t}function Nr(t,e){return typeof t=="function"?t(e):t}function nS(t,e){const{type:n="all",exact:r,fetchStatus:a,predicate:o,queryKey:u,stale:h}=t;if(u){if(r){if(e.queryHash!==Qy(u,e.options))return!1}else if(!ju(e.queryKey,u))return!1}if(n!=="all"){const f=e.isActive();if(n==="active"&&!f||n==="inactive"&&f)return!1}return!(typeof h=="boolean"&&e.isStale()!==h||a&&a!==e.state.fetchStatus||o&&!o(e))}function rS(t,e){const{exact:n,status:r,predicate:a,mutationKey:o}=t;if(o){if(!e.options.mutationKey)return!1;if(n){if(go(e.options.mutationKey)!==go(o))return!1}else if(!ju(e.options.mutationKey,o))return!1}return!(r&&e.state.status!==r||a&&!a(e))}function Qy(t,e){return(e?.queryKeyHashFn||go)(t)}function go(t){return JSON.stringify(t,(e,n)=>ty(n)?Object.keys(n).sort().reduce((r,a)=>(r[a]=n[a],r),{}):n)}function ju(t,e){return t===e?!0:typeof t!=typeof e?!1:t&&e&&typeof t=="object"&&typeof e=="object"?Object.keys(e).every(n=>ju(t[n],e[n])):!1}var O2=Object.prototype.hasOwnProperty;function o1(t,e){if(t===e)return t;const n=sS(t)&&sS(e);if(!n&&!(ty(t)&&ty(e)))return e;const a=(n?t:Object.keys(t)).length,o=n?e:Object.keys(e),u=o.length,h=n?new Array(u):{};let f=0;for(let m=0;m<u;m++){const g=n?m:o[m],_=t[g],v=e[g];if(_===v){h[g]=_,(n?m<a:O2.call(t,g))&&f++;continue}if(_===null||v===null||typeof _!="object"||typeof v!="object"){h[g]=v;continue}const S=o1(_,v);h[g]=S,S===_&&f++}return a===u&&f===a?t:h}function pf(t,e){if(!e||Object.keys(t).length!==Object.keys(e).length)return!1;for(const n in t)if(t[n]!==e[n])return!1;return!0}function sS(t){return Array.isArray(t)&&t.length===Object.keys(t).length}function ty(t){if(!iS(t))return!1;const e=t.constructor;if(e===void 0)return!0;const n=e.prototype;return!(!iS(n)||!n.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(t)!==Object.prototype)}function iS(t){return Object.prototype.toString.call(t)==="[object Object]"}function N2(t){return new Promise(e=>{oi.setTimeout(e,t)})}function ny(t,e,n){return typeof n.structuralSharing=="function"?n.structuralSharing(t,e):n.structuralSharing!==!1?o1(t,e):e}function P2(t,e,n=0){const r=[...t,e];return n&&r.length>n?r.slice(1):r}function B2(t,e,n=0){const r=[e,...t];return n&&r.length>n?r.slice(0,-1):r}var Wy=Symbol();function l1(t,e){return!t.queryFn&&e?.initialPromise?()=>e.initialPromise:!t.queryFn||t.queryFn===Wy?()=>Promise.reject(new Error(`Missing queryFn: '${t.queryHash}'`)):t.queryFn}function c1(t,e){return typeof t=="function"?t(...e):!!t}var L2=class extends Kl{#e;#t;#n;constructor(){super(),this.#n=t=>{if(!po&&window.addEventListener){const e=()=>t();return window.addEventListener("visibilitychange",e,!1),()=>{window.removeEventListener("visibilitychange",e)}}}}onSubscribe(){this.#t||this.setEventListener(this.#n)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(t){this.#n=t,this.#t?.(),this.#t=t(e=>{typeof e=="boolean"?this.setFocused(e):this.onFocus()})}setFocused(t){this.#e!==t&&(this.#e=t,this.onFocus())}onFocus(){const t=this.isFocused();this.listeners.forEach(e=>{e(t)})}isFocused(){return typeof this.#e=="boolean"?this.#e:globalThis.document?.visibilityState!=="hidden"}},Ky=new L2;function ry(){let t,e;const n=new Promise((a,o)=>{t=a,e=o});n.status="pending",n.catch(()=>{});function r(a){Object.assign(n,a),delete n.resolve,delete n.reject}return n.resolve=a=>{r({status:"fulfilled",value:a}),t(a)},n.reject=a=>{r({status:"rejected",reason:a}),e(a)},n}function z2(t){let e;if(t.then(n=>(e=n,n),mn)?.catch(mn),e!==void 0)return{data:e}}function u1(t){return t}function U2(t){return{mutationKey:t.options.mutationKey,state:t.state,...t.options.scope&&{scope:t.options.scope},...t.meta&&{meta:t.meta}}}function F2(t,e,n){const r=()=>{const a=t.promise?.then(e).catch(o=>n(o)?Promise.reject(new Error("redacted")):Promise.reject(o));return a?.catch(mn),a};return{dehydratedAt:Date.now(),state:{...t.state,...t.state.data!==void 0&&{data:e(t.state.data)}},queryKey:t.queryKey,queryHash:t.queryHash,...t.state.status==="pending"&&{promise:r()},...t.meta&&{meta:t.meta}}}function V2(t){return t.state.isPaused}function $2(t){return t.state.status==="success"}function q2(t){return!0}function H2(t,e={}){const n=e.shouldDehydrateMutation??t.getDefaultOptions().dehydrate?.shouldDehydrateMutation??V2,r=t.getMutationCache().getAll().flatMap(f=>n(f)?[U2(f)]:[]),a=e.shouldDehydrateQuery??t.getDefaultOptions().dehydrate?.shouldDehydrateQuery??$2,o=e.shouldRedactErrors??t.getDefaultOptions().dehydrate?.shouldRedactErrors??q2,u=e.serializeData??t.getDefaultOptions().dehydrate?.serializeData??u1,h=t.getQueryCache().getAll().flatMap(f=>a(f)?[F2(f,u,o)]:[]);return{mutations:r,queries:h}}function G2(t,e,n){if(typeof e!="object"||e===null)return;const r=t.getMutationCache(),a=t.getQueryCache(),o=n?.defaultOptions?.deserializeData??t.getDefaultOptions().hydrate?.deserializeData??u1,u=e.mutations||[],h=e.queries||[];u.forEach(({state:f,...m})=>{r.build(t,{...t.getDefaultOptions().hydrate?.mutations,...n?.defaultOptions?.mutations,...m},f)}),h.forEach(({queryKey:f,state:m,queryHash:g,meta:_,promise:v,dehydratedAt:S})=>{const x=v?z2(v):void 0,E=m.data===void 0?x?.data:m.data,C=E===void 0?E:o(E);let I=a.get(g);const j=I?.state.status==="pending",M=I?.state.fetchStatus==="fetching";if(I){const Q=x&&S!==void 0&&S>I.state.dataUpdatedAt;if(m.dataUpdatedAt>I.state.dataUpdatedAt||Q){const{fetchStatus:q,...G}=m;I.setState({...G,data:C})}}else I=a.build(t,{...t.getDefaultOptions().hydrate?.queries,...n?.defaultOptions?.queries,queryKey:f,queryHash:g,meta:_},{...m,data:C,fetchStatus:"idle",status:C!==void 0?"success":m.status});v&&!j&&!M&&(S===void 0||S>I.state.dataUpdatedAt)&&I.fetch(void 0,{initialPromise:Promise.resolve(v).then(o)}).catch(mn)})}var Q2=M2;function W2(){let t=[],e=0,n=h=>{h()},r=h=>{h()},a=Q2;const o=h=>{e?t.push(h):a(()=>{n(h)})},u=()=>{const h=t;t=[],h.length&&a(()=>{r(()=>{h.forEach(f=>{n(f)})})})};return{batch:h=>{let f;e++;try{f=h()}finally{e--,e||u()}return f},batchCalls:h=>(...f)=>{o(()=>{h(...f)})},schedule:o,setNotifyFunction:h=>{n=h},setBatchNotifyFunction:h=>{r=h},setScheduler:h=>{a=h}}}var pn=W2(),K2=class extends Kl{#e=!0;#t;#n;constructor(){super(),this.#n=t=>{if(!po&&window.addEventListener){const e=()=>t(!0),n=()=>t(!1);return window.addEventListener("online",e,!1),window.addEventListener("offline",n,!1),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",n)}}}}onSubscribe(){this.#t||this.setEventListener(this.#n)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(t){this.#n=t,this.#t?.(),this.#t=t(this.setOnline.bind(this))}setOnline(t){this.#e!==t&&(this.#e=t,this.listeners.forEach(n=>{n(t)}))}isOnline(){return this.#e}},gf=new K2;function Y2(t){return Math.min(1e3*2**t,3e4)}function d1(t){return(t??"online")==="online"?gf.isOnline():!0}var sy=class extends Error{constructor(t){super("CancelledError"),this.revert=t?.revert,this.silent=t?.silent}};function h1(t){let e=!1,n=0,r;const a=ry(),o=()=>a.status!=="pending",u=E=>{if(!o()){const C=new sy(E);v(C),t.onCancel?.(C)}},h=()=>{e=!0},f=()=>{e=!1},m=()=>Ky.isFocused()&&(t.networkMode==="always"||gf.isOnline())&&t.canRun(),g=()=>d1(t.networkMode)&&t.canRun(),_=E=>{o()||(r?.(),a.resolve(E))},v=E=>{o()||(r?.(),a.reject(E))},S=()=>new Promise(E=>{r=C=>{(o()||m())&&E(C)},t.onPause?.()}).then(()=>{r=void 0,o()||t.onContinue?.()}),x=()=>{if(o())return;let E;const C=n===0?t.initialPromise:void 0;try{E=C??t.fn()}catch(I){E=Promise.reject(I)}Promise.resolve(E).then(_).catch(I=>{if(o())return;const j=t.retry??(po?0:3),M=t.retryDelay??Y2,Q=typeof M=="function"?M(n,I):M,q=j===!0||typeof j=="number"&&n<j||typeof j=="function"&&j(n,I);if(e||!q){v(I);return}n++,t.onFail?.(n,I),N2(Q).then(()=>m()?void 0:S()).then(()=>{e?v(I):x()})})};return{promise:a,status:()=>a.status,cancel:u,continue:()=>(r?.(),a),cancelRetry:h,continueRetry:f,canStart:g,start:()=>(g()?x():S().then(x),a)}}var f1=class{#e;destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),ey(this.gcTime)&&(this.#e=oi.setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(t){this.gcTime=Math.max(this.gcTime||0,t??(po?1/0:300*1e3))}clearGcTimeout(){this.#e&&(oi.clearTimeout(this.#e),this.#e=void 0)}},X2=class extends f1{#e;#t;#n;#s;#r;#a;#o;constructor(e){super(),this.#o=!1,this.#a=e.defaultOptions,this.setOptions(e.options),this.observers=[],this.#s=e.client,this.#n=this.#s.getQueryCache(),this.queryKey=e.queryKey,this.queryHash=e.queryHash,this.#e=oS(this.options),this.state=e.state??this.#e,this.scheduleGc()}get meta(){return this.options.meta}get promise(){return this.#r?.promise}setOptions(e){if(this.options={...this.#a,...e},this.updateGcTime(this.options.gcTime),this.state&&this.state.data===void 0){const n=oS(this.options);n.data!==void 0&&(this.setState(aS(n.data,n.dataUpdatedAt)),this.#e=n)}}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&this.#n.remove(this)}setData(e,n){const r=ny(this.state.data,e,this.options);return this.#i({data:r,type:"success",dataUpdatedAt:n?.updatedAt,manual:n?.manual}),r}setState(e,n){this.#i({type:"setState",state:e,setStateOptions:n})}cancel(e){const n=this.#r?.promise;return this.#r?.cancel(e),n?n.then(mn).catch(mn):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(this.#e)}isActive(){return this.observers.some(e=>Nr(e.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===Wy||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(e=>ua(e.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(e=>e.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(e=0){return this.state.data===void 0?!0:e==="static"?!1:this.state.isInvalidated?!0:!a1(this.state.dataUpdatedAt,e)}onFocus(){this.observers.find(n=>n.shouldFetchOnWindowFocus())?.refetch({cancelRefetch:!1}),this.#r?.continue()}onOnline(){this.observers.find(n=>n.shouldFetchOnReconnect())?.refetch({cancelRefetch:!1}),this.#r?.continue()}addObserver(e){this.observers.includes(e)||(this.observers.push(e),this.clearGcTimeout(),this.#n.notify({type:"observerAdded",query:this,observer:e}))}removeObserver(e){this.observers.includes(e)&&(this.observers=this.observers.filter(n=>n!==e),this.observers.length||(this.#r&&(this.#o?this.#r.cancel({revert:!0}):this.#r.cancelRetry()),this.scheduleGc()),this.#n.notify({type:"observerRemoved",query:this,observer:e}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||this.#i({type:"invalidate"})}async fetch(e,n){if(this.state.fetchStatus!=="idle"&&this.#r?.status()!=="rejected"){if(this.state.data!==void 0&&n?.cancelRefetch)this.cancel({silent:!0});else if(this.#r)return this.#r.continueRetry(),this.#r.promise}if(e&&this.setOptions(e),!this.options.queryFn){const f=this.observers.find(m=>m.options.queryFn);f&&this.setOptions(f.options)}const r=new AbortController,a=f=>{Object.defineProperty(f,"signal",{enumerable:!0,get:()=>(this.#o=!0,r.signal)})},o=()=>{const f=l1(this.options,n),g=(()=>{const _={client:this.#s,queryKey:this.queryKey,meta:this.meta};return a(_),_})();return this.#o=!1,this.options.persister?this.options.persister(f,g,this):f(g)},h=(()=>{const f={fetchOptions:n,options:this.options,queryKey:this.queryKey,client:this.#s,state:this.state,fetchFn:o};return a(f),f})();this.options.behavior?.onFetch(h,this),this.#t=this.state,(this.state.fetchStatus==="idle"||this.state.fetchMeta!==h.fetchOptions?.meta)&&this.#i({type:"fetch",meta:h.fetchOptions?.meta}),this.#r=h1({initialPromise:n?.initialPromise,fn:h.fetchFn,onCancel:f=>{f instanceof sy&&f.revert&&this.setState({...this.#t,fetchStatus:"idle"}),r.abort()},onFail:(f,m)=>{this.#i({type:"failed",failureCount:f,error:m})},onPause:()=>{this.#i({type:"pause"})},onContinue:()=>{this.#i({type:"continue"})},retry:h.options.retry,retryDelay:h.options.retryDelay,networkMode:h.options.networkMode,canRun:()=>!0});try{const f=await this.#r.start();if(f===void 0)throw new Error(`${this.queryHash} data is undefined`);return this.setData(f),this.#n.config.onSuccess?.(f,this),this.#n.config.onSettled?.(f,this.state.error,this),f}catch(f){if(f instanceof sy){if(f.silent)return this.#r.promise;if(f.revert){if(this.state.data===void 0)throw f;return this.state.data}}throw this.#i({type:"error",error:f}),this.#n.config.onError?.(f,this),this.#n.config.onSettled?.(this.state.data,f,this),f}finally{this.scheduleGc()}}#i(e){const n=r=>{switch(e.type){case"failed":return{...r,fetchFailureCount:e.failureCount,fetchFailureReason:e.error};case"pause":return{...r,fetchStatus:"paused"};case"continue":return{...r,fetchStatus:"fetching"};case"fetch":return{...r,...m1(r.data,this.options),fetchMeta:e.meta??null};case"success":const a={...r,...aS(e.data,e.dataUpdatedAt),dataUpdateCount:r.dataUpdateCount+1,...!e.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return this.#t=e.manual?a:void 0,a;case"error":const o=e.error;return{...r,error:o,errorUpdateCount:r.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:r.fetchFailureCount+1,fetchFailureReason:o,fetchStatus:"idle",status:"error"};case"invalidate":return{...r,isInvalidated:!0};case"setState":return{...r,...e.state}}};this.state=n(this.state),pn.batch(()=>{this.observers.forEach(r=>{r.onQueryUpdate()}),this.#n.notify({query:this,type:"updated",action:e})})}};function m1(t,e){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:d1(e.networkMode)?"fetching":"paused",...t===void 0&&{error:null,status:"pending"}}}function aS(t,e){return{data:t,dataUpdatedAt:e??Date.now(),error:null,isInvalidated:!1,status:"success"}}function oS(t){const e=typeof t.initialData=="function"?t.initialData():t.initialData,n=e!==void 0,r=n?typeof t.initialDataUpdatedAt=="function"?t.initialDataUpdatedAt():t.initialDataUpdatedAt:0;return{data:e,dataUpdateCount:0,dataUpdatedAt:n?r??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:n?"success":"pending",fetchStatus:"idle"}}var J2=class extends Kl{constructor(t,e){super(),this.options=e,this.#e=t,this.#i=null,this.#o=ry(),this.bindMethods(),this.setOptions(e)}#e;#t=void 0;#n=void 0;#s=void 0;#r;#a;#o;#i;#p;#h;#f;#c;#u;#l;#m=new Set;bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(this.#t.addObserver(this),lS(this.#t,this.options)?this.#d():this.updateResult(),this.#b())}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return iy(this.#t,this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return iy(this.#t,this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,this.#v(),this.#x(),this.#t.removeObserver(this)}setOptions(t){const e=this.options,n=this.#t;if(this.options=this.#e.defaultQueryOptions(t),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof Nr(this.options.enabled,this.#t)!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");this.#S(),this.#t.setOptions(this.options),e._defaulted&&!pf(this.options,e)&&this.#e.getQueryCache().notify({type:"observerOptionsUpdated",query:this.#t,observer:this});const r=this.hasListeners();r&&cS(this.#t,n,this.options,e)&&this.#d(),this.updateResult(),r&&(this.#t!==n||Nr(this.options.enabled,this.#t)!==Nr(e.enabled,this.#t)||ua(this.options.staleTime,this.#t)!==ua(e.staleTime,this.#t))&&this.#g();const a=this.#y();r&&(this.#t!==n||Nr(this.options.enabled,this.#t)!==Nr(e.enabled,this.#t)||a!==this.#l)&&this.#_(a)}getOptimisticResult(t){const e=this.#e.getQueryCache().build(this.#e,t),n=this.createResult(e,t);return ek(this,n)&&(this.#s=n,this.#a=this.options,this.#r=this.#t.state),n}getCurrentResult(){return this.#s}trackResult(t,e){return new Proxy(t,{get:(n,r)=>(this.trackProp(r),e?.(r),r==="promise"&&(this.trackProp("data"),!this.options.experimental_prefetchInRender&&this.#o.status==="pending"&&this.#o.reject(new Error("experimental_prefetchInRender feature flag is not enabled"))),Reflect.get(n,r))})}trackProp(t){this.#m.add(t)}getCurrentQuery(){return this.#t}refetch({...t}={}){return this.fetch({...t})}fetchOptimistic(t){const e=this.#e.defaultQueryOptions(t),n=this.#e.getQueryCache().build(this.#e,e);return n.fetch().then(()=>this.createResult(n,e))}fetch(t){return this.#d({...t,cancelRefetch:t.cancelRefetch??!0}).then(()=>(this.updateResult(),this.#s))}#d(t){this.#S();let e=this.#t.fetch(this.options,t);return t?.throwOnError||(e=e.catch(mn)),e}#g(){this.#v();const t=ua(this.options.staleTime,this.#t);if(po||this.#s.isStale||!ey(t))return;const n=a1(this.#s.dataUpdatedAt,t)+1;this.#c=oi.setTimeout(()=>{this.#s.isStale||this.updateResult()},n)}#y(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(this.#t):this.options.refetchInterval)??!1}#_(t){this.#x(),this.#l=t,!(po||Nr(this.options.enabled,this.#t)===!1||!ey(this.#l)||this.#l===0)&&(this.#u=oi.setInterval(()=>{(this.options.refetchIntervalInBackground||Ky.isFocused())&&this.#d()},this.#l))}#b(){this.#g(),this.#_(this.#y())}#v(){this.#c&&(oi.clearTimeout(this.#c),this.#c=void 0)}#x(){this.#u&&(oi.clearInterval(this.#u),this.#u=void 0)}createResult(t,e){const n=this.#t,r=this.options,a=this.#s,o=this.#r,u=this.#a,f=t!==n?t.state:this.#n,{state:m}=t;let g={...m},_=!1,v;if(e._optimisticResults){const A=this.hasListeners(),N=!A&&lS(t,e),L=A&&cS(t,n,e,r);(N||L)&&(g={...g,...m1(m.data,t.options)}),e._optimisticResults==="isRestoring"&&(g.fetchStatus="idle")}let{error:S,errorUpdatedAt:x,status:E}=g;v=g.data;let C=!1;if(e.placeholderData!==void 0&&v===void 0&&E==="pending"){let A;a?.isPlaceholderData&&e.placeholderData===u?.placeholderData?(A=a.data,C=!0):A=typeof e.placeholderData=="function"?e.placeholderData(this.#f?.state.data,this.#f):e.placeholderData,A!==void 0&&(E="success",v=ny(a?.data,A,e),_=!0)}if(e.select&&v!==void 0&&!C)if(a&&v===o?.data&&e.select===this.#p)v=this.#h;else try{this.#p=e.select,v=e.select(v),v=ny(a?.data,v,e),this.#h=v,this.#i=null}catch(A){this.#i=A}this.#i&&(S=this.#i,v=this.#h,x=Date.now(),E="error");const I=g.fetchStatus==="fetching",j=E==="pending",M=E==="error",Q=j&&I,q=v!==void 0,D={status:E,fetchStatus:g.fetchStatus,isPending:j,isSuccess:E==="success",isError:M,isInitialLoading:Q,isLoading:Q,data:v,dataUpdatedAt:g.dataUpdatedAt,error:S,errorUpdatedAt:x,failureCount:g.fetchFailureCount,failureReason:g.fetchFailureReason,errorUpdateCount:g.errorUpdateCount,isFetched:g.dataUpdateCount>0||g.errorUpdateCount>0,isFetchedAfterMount:g.dataUpdateCount>f.dataUpdateCount||g.errorUpdateCount>f.errorUpdateCount,isFetching:I,isRefetching:I&&!j,isLoadingError:M&&!q,isPaused:g.fetchStatus==="paused",isPlaceholderData:_,isRefetchError:M&&q,isStale:Yy(t,e),refetch:this.refetch,promise:this.#o,isEnabled:Nr(e.enabled,t)!==!1};if(this.options.experimental_prefetchInRender){const A=P=>{D.status==="error"?P.reject(D.error):D.data!==void 0&&P.resolve(D.data)},N=()=>{const P=this.#o=D.promise=ry();A(P)},L=this.#o;switch(L.status){case"pending":t.queryHash===n.queryHash&&A(L);break;case"fulfilled":(D.status==="error"||D.data!==L.value)&&N();break;case"rejected":(D.status!=="error"||D.error!==L.reason)&&N();break}}return D}updateResult(){const t=this.#s,e=this.createResult(this.#t,this.options);if(this.#r=this.#t.state,this.#a=this.options,this.#r.data!==void 0&&(this.#f=this.#t),pf(e,t))return;this.#s=e;const n=()=>{if(!t)return!0;const{notifyOnChangeProps:r}=this.options,a=typeof r=="function"?r():r;if(a==="all"||!a&&!this.#m.size)return!0;const o=new Set(a??this.#m);return this.options.throwOnError&&o.add("error"),Object.keys(this.#s).some(u=>{const h=u;return this.#s[h]!==t[h]&&o.has(h)})};this.#w({listeners:n()})}#S(){const t=this.#e.getQueryCache().build(this.#e,this.options);if(t===this.#t)return;const e=this.#t;this.#t=t,this.#n=t.state,this.hasListeners()&&(e?.removeObserver(this),t.addObserver(this))}onQueryUpdate(){this.updateResult(),this.hasListeners()&&this.#b()}#w(t){pn.batch(()=>{t.listeners&&this.listeners.forEach(e=>{e(this.#s)}),this.#e.getQueryCache().notify({query:this.#t,type:"observerResultsUpdated"})})}};function Z2(t,e){return Nr(e.enabled,t)!==!1&&t.state.data===void 0&&!(t.state.status==="error"&&e.retryOnMount===!1)}function lS(t,e){return Z2(t,e)||t.state.data!==void 0&&iy(t,e,e.refetchOnMount)}function iy(t,e,n){if(Nr(e.enabled,t)!==!1&&ua(e.staleTime,t)!=="static"){const r=typeof n=="function"?n(t):n;return r==="always"||r!==!1&&Yy(t,e)}return!1}function cS(t,e,n,r){return(t!==e||Nr(r.enabled,t)===!1)&&(!n.suspense||t.state.status!=="error")&&Yy(t,n)}function Yy(t,e){return Nr(e.enabled,t)!==!1&&t.isStaleByTime(ua(e.staleTime,t))}function ek(t,e){return!pf(t.getCurrentResult(),e)}function uS(t){return{onFetch:(e,n)=>{const r=e.options,a=e.fetchOptions?.meta?.fetchMore?.direction,o=e.state.data?.pages||[],u=e.state.data?.pageParams||[];let h={pages:[],pageParams:[]},f=0;const m=async()=>{let g=!1;const _=x=>{Object.defineProperty(x,"signal",{enumerable:!0,get:()=>(e.signal.aborted?g=!0:e.signal.addEventListener("abort",()=>{g=!0}),e.signal)})},v=l1(e.options,e.fetchOptions),S=async(x,E,C)=>{if(g)return Promise.reject();if(E==null&&x.pages.length)return Promise.resolve(x);const j=(()=>{const G={client:e.client,queryKey:e.queryKey,pageParam:E,direction:C?"backward":"forward",meta:e.options.meta};return _(G),G})(),M=await v(j),{maxPages:Q}=e.options,q=C?B2:P2;return{pages:q(x.pages,M,Q),pageParams:q(x.pageParams,E,Q)}};if(a&&o.length){const x=a==="backward",E=x?tk:dS,C={pages:o,pageParams:u},I=E(r,C);h=await S(C,I,x)}else{const x=t??o.length;do{const E=f===0?u[0]??r.initialPageParam:dS(r,h);if(f>0&&E==null)break;h=await S(h,E),f++}while(f<x)}return h};e.options.persister?e.fetchFn=()=>e.options.persister?.(m,{client:e.client,queryKey:e.queryKey,meta:e.options.meta,signal:e.signal},n):e.fetchFn=m}}}function dS(t,{pages:e,pageParams:n}){const r=e.length-1;return e.length>0?t.getNextPageParam(e[r],e,n[r],n):void 0}function tk(t,{pages:e,pageParams:n}){return e.length>0?t.getPreviousPageParam?.(e[0],e,n[0],n):void 0}var nk=class extends f1{#e;#t;#n;#s;constructor(e){super(),this.#e=e.client,this.mutationId=e.mutationId,this.#n=e.mutationCache,this.#t=[],this.state=e.state||p1(),this.setOptions(e.options),this.scheduleGc()}setOptions(e){this.options=e,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(e){this.#t.includes(e)||(this.#t.push(e),this.clearGcTimeout(),this.#n.notify({type:"observerAdded",mutation:this,observer:e}))}removeObserver(e){this.#t=this.#t.filter(n=>n!==e),this.scheduleGc(),this.#n.notify({type:"observerRemoved",mutation:this,observer:e})}optionalRemove(){this.#t.length||(this.state.status==="pending"?this.scheduleGc():this.#n.remove(this))}continue(){return this.#s?.continue()??this.execute(this.state.variables)}async execute(e){const n=()=>{this.#r({type:"continue"})},r={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};this.#s=h1({fn:()=>this.options.mutationFn?this.options.mutationFn(e,r):Promise.reject(new Error("No mutationFn found")),onFail:(u,h)=>{this.#r({type:"failed",failureCount:u,error:h})},onPause:()=>{this.#r({type:"pause"})},onContinue:n,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>this.#n.canRun(this)});const a=this.state.status==="pending",o=!this.#s.canStart();try{if(a)n();else{this.#r({type:"pending",variables:e,isPaused:o}),await this.#n.config.onMutate?.(e,this,r);const h=await this.options.onMutate?.(e,r);h!==this.state.context&&this.#r({type:"pending",context:h,variables:e,isPaused:o})}const u=await this.#s.start();return await this.#n.config.onSuccess?.(u,e,this.state.context,this,r),await this.options.onSuccess?.(u,e,this.state.context,r),await this.#n.config.onSettled?.(u,null,this.state.variables,this.state.context,this,r),await this.options.onSettled?.(u,null,e,this.state.context,r),this.#r({type:"success",data:u}),u}catch(u){try{throw await this.#n.config.onError?.(u,e,this.state.context,this,r),await this.options.onError?.(u,e,this.state.context,r),await this.#n.config.onSettled?.(void 0,u,this.state.variables,this.state.context,this,r),await this.options.onSettled?.(void 0,u,e,this.state.context,r),u}finally{this.#r({type:"error",error:u})}}finally{this.#n.runNext(this)}}#r(e){const n=r=>{switch(e.type){case"failed":return{...r,failureCount:e.failureCount,failureReason:e.error};case"pause":return{...r,isPaused:!0};case"continue":return{...r,isPaused:!1};case"pending":return{...r,context:e.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:e.isPaused,status:"pending",variables:e.variables,submittedAt:Date.now()};case"success":return{...r,data:e.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...r,data:void 0,error:e.error,failureCount:r.failureCount+1,failureReason:e.error,isPaused:!1,status:"error"}}};this.state=n(this.state),pn.batch(()=>{this.#t.forEach(r=>{r.onMutationUpdate(e)}),this.#n.notify({mutation:this,type:"updated",action:e})})}};function p1(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var rk=class extends Kl{constructor(t={}){super(),this.config=t,this.#e=new Set,this.#t=new Map,this.#n=0}#e;#t;#n;build(t,e,n){const r=new nk({client:t,mutationCache:this,mutationId:++this.#n,options:t.defaultMutationOptions(e),state:n});return this.add(r),r}add(t){this.#e.add(t);const e=Bh(t);if(typeof e=="string"){const n=this.#t.get(e);n?n.push(t):this.#t.set(e,[t])}this.notify({type:"added",mutation:t})}remove(t){if(this.#e.delete(t)){const e=Bh(t);if(typeof e=="string"){const n=this.#t.get(e);if(n)if(n.length>1){const r=n.indexOf(t);r!==-1&&n.splice(r,1)}else n[0]===t&&this.#t.delete(e)}}this.notify({type:"removed",mutation:t})}canRun(t){const e=Bh(t);if(typeof e=="string"){const r=this.#t.get(e)?.find(a=>a.state.status==="pending");return!r||r===t}else return!0}runNext(t){const e=Bh(t);return typeof e=="string"?this.#t.get(e)?.find(r=>r!==t&&r.state.isPaused)?.continue()??Promise.resolve():Promise.resolve()}clear(){pn.batch(()=>{this.#e.forEach(t=>{this.notify({type:"removed",mutation:t})}),this.#e.clear(),this.#t.clear()})}getAll(){return Array.from(this.#e)}find(t){const e={exact:!0,...t};return this.getAll().find(n=>rS(e,n))}findAll(t={}){return this.getAll().filter(e=>rS(t,e))}notify(t){pn.batch(()=>{this.listeners.forEach(e=>{e(t)})})}resumePausedMutations(){const t=this.getAll().filter(e=>e.state.isPaused);return pn.batch(()=>Promise.all(t.map(e=>e.continue().catch(mn))))}};function Bh(t){return t.options.scope?.id}var sk=class extends Kl{#e;#t=void 0;#n;#s;constructor(e,n){super(),this.#e=e,this.setOptions(n),this.bindMethods(),this.#r()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){const n=this.options;this.options=this.#e.defaultMutationOptions(e),pf(this.options,n)||this.#e.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#n,observer:this}),n?.mutationKey&&this.options.mutationKey&&go(n.mutationKey)!==go(this.options.mutationKey)?this.reset():this.#n?.state.status==="pending"&&this.#n.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#n?.removeObserver(this)}onMutationUpdate(e){this.#r(),this.#a(e)}getCurrentResult(){return this.#t}reset(){this.#n?.removeObserver(this),this.#n=void 0,this.#r(),this.#a()}mutate(e,n){return this.#s=n,this.#n?.removeObserver(this),this.#n=this.#e.getMutationCache().build(this.#e,this.options),this.#n.addObserver(this),this.#n.execute(e)}#r(){const e=this.#n?.state??p1();this.#t={...e,isPending:e.status==="pending",isSuccess:e.status==="success",isError:e.status==="error",isIdle:e.status==="idle",mutate:this.mutate,reset:this.reset}}#a(e){pn.batch(()=>{if(this.#s&&this.hasListeners()){const n=this.#t.variables,r=this.#t.context,a={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};e?.type==="success"?(this.#s.onSuccess?.(e.data,n,r,a),this.#s.onSettled?.(e.data,null,n,r,a)):e?.type==="error"&&(this.#s.onError?.(e.error,n,r,a),this.#s.onSettled?.(void 0,e.error,n,r,a))}this.listeners.forEach(n=>{n(this.#t)})})}},ik=class extends Kl{constructor(t={}){super(),this.config=t,this.#e=new Map}#e;build(t,e,n){const r=e.queryKey,a=e.queryHash??Qy(r,e);let o=this.get(a);return o||(o=new X2({client:t,queryKey:r,queryHash:a,options:t.defaultQueryOptions(e),state:n,defaultOptions:t.getQueryDefaults(r)}),this.add(o)),o}add(t){this.#e.has(t.queryHash)||(this.#e.set(t.queryHash,t),this.notify({type:"added",query:t}))}remove(t){const e=this.#e.get(t.queryHash);e&&(t.destroy(),e===t&&this.#e.delete(t.queryHash),this.notify({type:"removed",query:t}))}clear(){pn.batch(()=>{this.getAll().forEach(t=>{this.remove(t)})})}get(t){return this.#e.get(t)}getAll(){return[...this.#e.values()]}find(t){const e={exact:!0,...t};return this.getAll().find(n=>nS(e,n))}findAll(t={}){const e=this.getAll();return Object.keys(t).length>0?e.filter(n=>nS(t,n)):e}notify(t){pn.batch(()=>{this.listeners.forEach(e=>{e(t)})})}onFocus(){pn.batch(()=>{this.getAll().forEach(t=>{t.onFocus()})})}onOnline(){pn.batch(()=>{this.getAll().forEach(t=>{t.onOnline()})})}},ak=class{#e;#t;#n;#s;#r;#a;#o;#i;constructor(t={}){this.#e=t.queryCache||new ik,this.#t=t.mutationCache||new rk,this.#n=t.defaultOptions||{},this.#s=new Map,this.#r=new Map,this.#a=0}mount(){this.#a++,this.#a===1&&(this.#o=Ky.subscribe(async t=>{t&&(await this.resumePausedMutations(),this.#e.onFocus())}),this.#i=gf.subscribe(async t=>{t&&(await this.resumePausedMutations(),this.#e.onOnline())}))}unmount(){this.#a--,this.#a===0&&(this.#o?.(),this.#o=void 0,this.#i?.(),this.#i=void 0)}isFetching(t){return this.#e.findAll({...t,fetchStatus:"fetching"}).length}isMutating(t){return this.#t.findAll({...t,status:"pending"}).length}getQueryData(t){const e=this.defaultQueryOptions({queryKey:t});return this.#e.get(e.queryHash)?.state.data}ensureQueryData(t){const e=this.defaultQueryOptions(t),n=this.#e.build(this,e),r=n.state.data;return r===void 0?this.fetchQuery(t):(t.revalidateIfStale&&n.isStaleByTime(ua(e.staleTime,n))&&this.prefetchQuery(e),Promise.resolve(r))}getQueriesData(t){return this.#e.findAll(t).map(({queryKey:e,state:n})=>{const r=n.data;return[e,r]})}setQueryData(t,e,n){const r=this.defaultQueryOptions({queryKey:t}),o=this.#e.get(r.queryHash)?.state.data,u=k2(e,o);if(u!==void 0)return this.#e.build(this,r).setData(u,{...n,manual:!0})}setQueriesData(t,e,n){return pn.batch(()=>this.#e.findAll(t).map(({queryKey:r})=>[r,this.setQueryData(r,e,n)]))}getQueryState(t){const e=this.defaultQueryOptions({queryKey:t});return this.#e.get(e.queryHash)?.state}removeQueries(t){const e=this.#e;pn.batch(()=>{e.findAll(t).forEach(n=>{e.remove(n)})})}resetQueries(t,e){const n=this.#e;return pn.batch(()=>(n.findAll(t).forEach(r=>{r.reset()}),this.refetchQueries({type:"active",...t},e)))}cancelQueries(t,e={}){const n={revert:!0,...e},r=pn.batch(()=>this.#e.findAll(t).map(a=>a.cancel(n)));return Promise.all(r).then(mn).catch(mn)}invalidateQueries(t,e={}){return pn.batch(()=>(this.#e.findAll(t).forEach(n=>{n.invalidate()}),t?.refetchType==="none"?Promise.resolve():this.refetchQueries({...t,type:t?.refetchType??t?.type??"active"},e)))}refetchQueries(t,e={}){const n={...e,cancelRefetch:e.cancelRefetch??!0},r=pn.batch(()=>this.#e.findAll(t).filter(a=>!a.isDisabled()&&!a.isStatic()).map(a=>{let o=a.fetch(void 0,n);return n.throwOnError||(o=o.catch(mn)),a.state.fetchStatus==="paused"?Promise.resolve():o}));return Promise.all(r).then(mn)}fetchQuery(t){const e=this.defaultQueryOptions(t);e.retry===void 0&&(e.retry=!1);const n=this.#e.build(this,e);return n.isStaleByTime(ua(e.staleTime,n))?n.fetch(e):Promise.resolve(n.state.data)}prefetchQuery(t){return this.fetchQuery(t).then(mn).catch(mn)}fetchInfiniteQuery(t){return t.behavior=uS(t.pages),this.fetchQuery(t)}prefetchInfiniteQuery(t){return this.fetchInfiniteQuery(t).then(mn).catch(mn)}ensureInfiniteQueryData(t){return t.behavior=uS(t.pages),this.ensureQueryData(t)}resumePausedMutations(){return gf.isOnline()?this.#t.resumePausedMutations():Promise.resolve()}getQueryCache(){return this.#e}getMutationCache(){return this.#t}getDefaultOptions(){return this.#n}setDefaultOptions(t){this.#n=t}setQueryDefaults(t,e){this.#s.set(go(t),{queryKey:t,defaultOptions:e})}getQueryDefaults(t){const e=[...this.#s.values()],n={};return e.forEach(r=>{ju(t,r.queryKey)&&Object.assign(n,r.defaultOptions)}),n}setMutationDefaults(t,e){this.#r.set(go(t),{mutationKey:t,defaultOptions:e})}getMutationDefaults(t){const e=[...this.#r.values()],n={};return e.forEach(r=>{ju(t,r.mutationKey)&&Object.assign(n,r.defaultOptions)}),n}defaultQueryOptions(t){if(t._defaulted)return t;const e={...this.#n.queries,...this.getQueryDefaults(t.queryKey),...t,_defaulted:!0};return e.queryHash||(e.queryHash=Qy(e.queryKey,e)),e.refetchOnReconnect===void 0&&(e.refetchOnReconnect=e.networkMode!=="always"),e.throwOnError===void 0&&(e.throwOnError=!!e.suspense),!e.networkMode&&e.persister&&(e.networkMode="offlineFirst"),e.queryFn===Wy&&(e.enabled=!1),e}defaultMutationOptions(t){return t?._defaulted?t:{...this.#n.mutations,...t?.mutationKey&&this.getMutationDefaults(t.mutationKey),...t,_defaulted:!0}}clear(){this.#e.clear(),this.#t.clear()}},g1=T.createContext(void 0),yn=t=>{const e=T.useContext(g1);if(!e)throw new Error("No QueryClient set, use QueryClientProvider to set one");return e},y1=({client:t,children:e})=>(T.useEffect(()=>(t.mount(),()=>{t.unmount()}),[t]),c.jsx(g1.Provider,{value:t,children:e})),_1=T.createContext(!1),ok=()=>T.useContext(_1),lk=_1.Provider;function ck(){let t=!1;return{clearReset:()=>{t=!1},reset:()=>{t=!0},isReset:()=>t}}var uk=T.createContext(ck()),dk=()=>T.useContext(uk),hk=(t,e)=>{(t.suspense||t.throwOnError||t.experimental_prefetchInRender)&&(e.isReset()||(t.retryOnMount=!1))},fk=t=>{T.useEffect(()=>{t.clearReset()},[t])},mk=({result:t,errorResetBoundary:e,throwOnError:n,query:r,suspense:a})=>t.isError&&!e.isReset()&&!t.isFetching&&r&&(a&&t.data===void 0||c1(n,[t.error,r])),pk=t=>{if(t.suspense){const n=a=>a==="static"?a:Math.max(a??1e3,1e3),r=t.staleTime;t.staleTime=typeof r=="function"?(...a)=>n(r(...a)):n(r),typeof t.gcTime=="number"&&(t.gcTime=Math.max(t.gcTime,1e3))}},gk=(t,e)=>t.isLoading&&t.isFetching&&!e,yk=(t,e)=>t?.suspense&&e.isPending,hS=(t,e,n)=>e.fetchOptimistic(t).catch(()=>{n.clearReset()});function _k(t,e,n){const r=ok(),a=dk(),o=yn(),u=o.defaultQueryOptions(t);o.getDefaultOptions().queries?._experimental_beforeQuery?.(u),u._optimisticResults=r?"isRestoring":"optimistic",pk(u),hk(u,a),fk(a);const h=!o.getQueryCache().get(u.queryHash),[f]=T.useState(()=>new e(o,u)),m=f.getOptimisticResult(u),g=!r&&t.subscribed!==!1;if(T.useSyncExternalStore(T.useCallback(_=>{const v=g?f.subscribe(pn.batchCalls(_)):mn;return f.updateResult(),v},[f,g]),()=>f.getCurrentResult(),()=>f.getCurrentResult()),T.useEffect(()=>{f.setOptions(u)},[u,f]),yk(u,m))throw hS(u,f,a);if(mk({result:m,errorResetBoundary:a,throwOnError:u.throwOnError,query:o.getQueryCache().get(u.queryHash),suspense:u.suspense}))throw m.error;return o.getDefaultOptions().queries?._experimental_afterQuery?.(u,m),u.experimental_prefetchInRender&&!po&&gk(m,r)&&(h?hS(u,f,a):o.getQueryCache().get(u.queryHash)?.promise)?.catch(mn).finally(()=>{f.updateResult()}),u.notifyOnChangeProps?m:f.trackResult(m)}function Yl(t,e){return _k(t,J2)}function vr(t,e){const n=yn(),[r]=T.useState(()=>new sk(n,t));T.useEffect(()=>{r.setOptions(t)},[r,t]);const a=T.useSyncExternalStore(T.useCallback(u=>r.subscribe(pn.batchCalls(u)),[r]),()=>r.getCurrentResult(),()=>r.getCurrentResult()),o=T.useCallback((u,h)=>{r.mutate(u,h).catch(mn)},[r]);if(a.error&&c1(r.options.throwOnError,[a.error]))throw a.error;return{...a,mutate:o,mutateAsync:a.mutate}}function ay(){}function bk(t,{interval:e=1e3,onError:n=ay}={}){if(typeof t!="function")throw new Error("argument is not function.");let r=0,a=null,o=!1,u=!1;return async(...h)=>{if(a=h,!u){for(u=!0;o;)await new Promise(f=>oi.setTimeout(f,e));for(;Date.now()<r;)await new Promise(f=>oi.setTimeout(f,r-Date.now()));u=!1,o=!0;try{await t(...a)}catch(f){try{n(f)}catch{}}r=Date.now()+e,o=!1}}}var vk=({storage:t,key:e="REACT_QUERY_OFFLINE_CACHE",throttleTime:n=1e3,serialize:r=JSON.stringify,deserialize:a=JSON.parse,retry:o})=>{if(t){const u=async h=>{try{const f=await r(h);await t.setItem(e,f);return}catch(f){return f}};return{persistClient:bk(async h=>{let f=h,m=await u(f),g=0;for(;m&&f;)g++,f=await o?.({persistedClient:f,error:m,errorCount:g}),f&&(m=await u(f))},{interval:n}),restoreClient:async()=>{const h=await t.getItem(e);if(h)return await a(h)},removeClient:()=>t.removeItem(e)}}return{persistClient:ay,restoreClient:()=>Promise.resolve(void 0),removeClient:ay}};const b1=300*1e3,xk=1800*1e3,Ve=new ak({defaultOptions:{queries:{staleTime:b1,gcTime:xk,refetchOnWindowFocus:!1,refetchOnReconnect:!0,retry:1,refetchOnMount:!0},mutations:{retry:1}}});Ve.getQueryCache().subscribe(t=>{const e=t?.query;if(e&&t.type==="updated"){const{state:n}=e;n.status==="error"&&n.error&&console.error("[RQ] Query FAILED:",e.queryKey,n.error)}});const Sk=vk({storage:typeof window<"u"?{getItem:t=>Promise.resolve(localStorage.getItem(t)),setItem:(t,e)=>Promise.resolve(localStorage.setItem(t,e)),removeItem:t=>Promise.resolve(localStorage.removeItem(t))}:void 0,key:"BUDGET_APP_QUERY_CACHE"}),xe={user:t=>["user",t],budget:t=>["budget",t],month:(t,e,n)=>["month",t,e,n],payees:t=>["payees",t],accessibleBudgets:t=>["accessibleBudgets",t],feedback:()=>["feedback"]};var wk=["added","removed","updated"];function fS(t){return wk.includes(t)}async function Ek({queryClient:t,persister:e,maxAge:n=1e3*60*60*24,buster:r="",hydrateOptions:a}){try{const o=await e.restoreClient();if(o)if(o.timestamp){const u=Date.now()-o.timestamp>n,h=o.buster!==r;if(u||h)return e.removeClient();G2(t,o.clientState,a)}else return e.removeClient()}catch(o){throw await e.removeClient(),o}}async function mS({queryClient:t,persister:e,buster:n="",dehydrateOptions:r}){const a={buster:n,timestamp:Date.now(),clientState:H2(t,r)};await e.persistClient(a)}function Ck(t){const e=t.queryClient.getQueryCache().subscribe(r=>{fS(r.type)&&mS(t)}),n=t.queryClient.getMutationCache().subscribe(r=>{fS(r.type)&&mS(t)});return()=>{e(),n()}}var Tk=({children:t,persistOptions:e,onSuccess:n,onError:r,...a})=>{const[o,u]=T.useState(!0),h=T.useRef({persistOptions:e,onSuccess:n,onError:r}),f=T.useRef(!1);return T.useEffect(()=>{h.current={persistOptions:e,onSuccess:n,onError:r}}),T.useEffect(()=>{const m={...h.current.persistOptions,queryClient:a.client};return f.current||(f.current=!0,Ek(m).then(()=>h.current.onSuccess?.()).catch(()=>h.current.onError?.()).finally(()=>{u(!1)})),o?void 0:Ck(m)},[a.client,o]),c.jsx(y1,{...a,children:c.jsx(lk,{value:o,children:t})})};function Ak(){return typeof window>"u"?!1:new URLSearchParams(window.location.search).get("cacheBust")==="1"}function jk(){if(typeof window>"u")return;const t=new URL(window.location.href);t.searchParams.has("cacheBust")&&(t.searchParams.delete("cacheBust"),window.history.replaceState({},"",t.toString()))}function Rk({children:t}){const[e]=T.useState(()=>Ak());return T.useEffect(()=>{e&&jk()},[e]),e?c.jsx(y1,{client:Ve,children:t}):c.jsx(Tk,{client:Ve,persistOptions:{persister:Sk,maxAge:300*1e3,buster:"v3"},children:t})}var pS=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var da,v1;(function(){var t;function e(D,A){function N(){}N.prototype=A.prototype,D.F=A.prototype,D.prototype=new N,D.prototype.constructor=D,D.D=function(L,P,B){for(var O=Array(arguments.length-2),K=2;K<arguments.length;K++)O[K-2]=arguments[K];return A.prototype[P].apply(L,O)}}function n(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(r,n),r.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function a(D,A,N){N||(N=0);const L=Array(16);if(typeof A=="string")for(var P=0;P<16;++P)L[P]=A.charCodeAt(N++)|A.charCodeAt(N++)<<8|A.charCodeAt(N++)<<16|A.charCodeAt(N++)<<24;else for(P=0;P<16;++P)L[P]=A[N++]|A[N++]<<8|A[N++]<<16|A[N++]<<24;A=D.g[0],N=D.g[1],P=D.g[2];let B=D.g[3],O;O=A+(B^N&(P^B))+L[0]+3614090360&4294967295,A=N+(O<<7&4294967295|O>>>25),O=B+(P^A&(N^P))+L[1]+3905402710&4294967295,B=A+(O<<12&4294967295|O>>>20),O=P+(N^B&(A^N))+L[2]+606105819&4294967295,P=B+(O<<17&4294967295|O>>>15),O=N+(A^P&(B^A))+L[3]+3250441966&4294967295,N=P+(O<<22&4294967295|O>>>10),O=A+(B^N&(P^B))+L[4]+4118548399&4294967295,A=N+(O<<7&4294967295|O>>>25),O=B+(P^A&(N^P))+L[5]+1200080426&4294967295,B=A+(O<<12&4294967295|O>>>20),O=P+(N^B&(A^N))+L[6]+2821735955&4294967295,P=B+(O<<17&4294967295|O>>>15),O=N+(A^P&(B^A))+L[7]+4249261313&4294967295,N=P+(O<<22&4294967295|O>>>10),O=A+(B^N&(P^B))+L[8]+1770035416&4294967295,A=N+(O<<7&4294967295|O>>>25),O=B+(P^A&(N^P))+L[9]+2336552879&4294967295,B=A+(O<<12&4294967295|O>>>20),O=P+(N^B&(A^N))+L[10]+4294925233&4294967295,P=B+(O<<17&4294967295|O>>>15),O=N+(A^P&(B^A))+L[11]+2304563134&4294967295,N=P+(O<<22&4294967295|O>>>10),O=A+(B^N&(P^B))+L[12]+1804603682&4294967295,A=N+(O<<7&4294967295|O>>>25),O=B+(P^A&(N^P))+L[13]+4254626195&4294967295,B=A+(O<<12&4294967295|O>>>20),O=P+(N^B&(A^N))+L[14]+2792965006&4294967295,P=B+(O<<17&4294967295|O>>>15),O=N+(A^P&(B^A))+L[15]+1236535329&4294967295,N=P+(O<<22&4294967295|O>>>10),O=A+(P^B&(N^P))+L[1]+4129170786&4294967295,A=N+(O<<5&4294967295|O>>>27),O=B+(N^P&(A^N))+L[6]+3225465664&4294967295,B=A+(O<<9&4294967295|O>>>23),O=P+(A^N&(B^A))+L[11]+643717713&4294967295,P=B+(O<<14&4294967295|O>>>18),O=N+(B^A&(P^B))+L[0]+3921069994&4294967295,N=P+(O<<20&4294967295|O>>>12),O=A+(P^B&(N^P))+L[5]+3593408605&4294967295,A=N+(O<<5&4294967295|O>>>27),O=B+(N^P&(A^N))+L[10]+38016083&4294967295,B=A+(O<<9&4294967295|O>>>23),O=P+(A^N&(B^A))+L[15]+3634488961&4294967295,P=B+(O<<14&4294967295|O>>>18),O=N+(B^A&(P^B))+L[4]+3889429448&4294967295,N=P+(O<<20&4294967295|O>>>12),O=A+(P^B&(N^P))+L[9]+568446438&4294967295,A=N+(O<<5&4294967295|O>>>27),O=B+(N^P&(A^N))+L[14]+3275163606&4294967295,B=A+(O<<9&4294967295|O>>>23),O=P+(A^N&(B^A))+L[3]+4107603335&4294967295,P=B+(O<<14&4294967295|O>>>18),O=N+(B^A&(P^B))+L[8]+1163531501&4294967295,N=P+(O<<20&4294967295|O>>>12),O=A+(P^B&(N^P))+L[13]+2850285829&4294967295,A=N+(O<<5&4294967295|O>>>27),O=B+(N^P&(A^N))+L[2]+4243563512&4294967295,B=A+(O<<9&4294967295|O>>>23),O=P+(A^N&(B^A))+L[7]+1735328473&4294967295,P=B+(O<<14&4294967295|O>>>18),O=N+(B^A&(P^B))+L[12]+2368359562&4294967295,N=P+(O<<20&4294967295|O>>>12),O=A+(N^P^B)+L[5]+4294588738&4294967295,A=N+(O<<4&4294967295|O>>>28),O=B+(A^N^P)+L[8]+2272392833&4294967295,B=A+(O<<11&4294967295|O>>>21),O=P+(B^A^N)+L[11]+1839030562&4294967295,P=B+(O<<16&4294967295|O>>>16),O=N+(P^B^A)+L[14]+4259657740&4294967295,N=P+(O<<23&4294967295|O>>>9),O=A+(N^P^B)+L[1]+2763975236&4294967295,A=N+(O<<4&4294967295|O>>>28),O=B+(A^N^P)+L[4]+1272893353&4294967295,B=A+(O<<11&4294967295|O>>>21),O=P+(B^A^N)+L[7]+4139469664&4294967295,P=B+(O<<16&4294967295|O>>>16),O=N+(P^B^A)+L[10]+3200236656&4294967295,N=P+(O<<23&4294967295|O>>>9),O=A+(N^P^B)+L[13]+681279174&4294967295,A=N+(O<<4&4294967295|O>>>28),O=B+(A^N^P)+L[0]+3936430074&4294967295,B=A+(O<<11&4294967295|O>>>21),O=P+(B^A^N)+L[3]+3572445317&4294967295,P=B+(O<<16&4294967295|O>>>16),O=N+(P^B^A)+L[6]+76029189&4294967295,N=P+(O<<23&4294967295|O>>>9),O=A+(N^P^B)+L[9]+3654602809&4294967295,A=N+(O<<4&4294967295|O>>>28),O=B+(A^N^P)+L[12]+3873151461&4294967295,B=A+(O<<11&4294967295|O>>>21),O=P+(B^A^N)+L[15]+530742520&4294967295,P=B+(O<<16&4294967295|O>>>16),O=N+(P^B^A)+L[2]+3299628645&4294967295,N=P+(O<<23&4294967295|O>>>9),O=A+(P^(N|~B))+L[0]+4096336452&4294967295,A=N+(O<<6&4294967295|O>>>26),O=B+(N^(A|~P))+L[7]+1126891415&4294967295,B=A+(O<<10&4294967295|O>>>22),O=P+(A^(B|~N))+L[14]+2878612391&4294967295,P=B+(O<<15&4294967295|O>>>17),O=N+(B^(P|~A))+L[5]+4237533241&4294967295,N=P+(O<<21&4294967295|O>>>11),O=A+(P^(N|~B))+L[12]+1700485571&4294967295,A=N+(O<<6&4294967295|O>>>26),O=B+(N^(A|~P))+L[3]+2399980690&4294967295,B=A+(O<<10&4294967295|O>>>22),O=P+(A^(B|~N))+L[10]+4293915773&4294967295,P=B+(O<<15&4294967295|O>>>17),O=N+(B^(P|~A))+L[1]+2240044497&4294967295,N=P+(O<<21&4294967295|O>>>11),O=A+(P^(N|~B))+L[8]+1873313359&4294967295,A=N+(O<<6&4294967295|O>>>26),O=B+(N^(A|~P))+L[15]+4264355552&4294967295,B=A+(O<<10&4294967295|O>>>22),O=P+(A^(B|~N))+L[6]+2734768916&4294967295,P=B+(O<<15&4294967295|O>>>17),O=N+(B^(P|~A))+L[13]+1309151649&4294967295,N=P+(O<<21&4294967295|O>>>11),O=A+(P^(N|~B))+L[4]+4149444226&4294967295,A=N+(O<<6&4294967295|O>>>26),O=B+(N^(A|~P))+L[11]+3174756917&4294967295,B=A+(O<<10&4294967295|O>>>22),O=P+(A^(B|~N))+L[2]+718787259&4294967295,P=B+(O<<15&4294967295|O>>>17),O=N+(B^(P|~A))+L[9]+3951481745&4294967295,D.g[0]=D.g[0]+A&4294967295,D.g[1]=D.g[1]+(P+(O<<21&4294967295|O>>>11))&4294967295,D.g[2]=D.g[2]+P&4294967295,D.g[3]=D.g[3]+B&4294967295}r.prototype.v=function(D,A){A===void 0&&(A=D.length);const N=A-this.blockSize,L=this.C;let P=this.h,B=0;for(;B<A;){if(P==0)for(;B<=N;)a(this,D,B),B+=this.blockSize;if(typeof D=="string"){for(;B<A;)if(L[P++]=D.charCodeAt(B++),P==this.blockSize){a(this,L),P=0;break}}else for(;B<A;)if(L[P++]=D[B++],P==this.blockSize){a(this,L),P=0;break}}this.h=P,this.o+=A},r.prototype.A=function(){var D=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);D[0]=128;for(var A=1;A<D.length-8;++A)D[A]=0;A=this.o*8;for(var N=D.length-8;N<D.length;++N)D[N]=A&255,A/=256;for(this.v(D),D=Array(16),A=0,N=0;N<4;++N)for(let L=0;L<32;L+=8)D[A++]=this.g[N]>>>L&255;return D};function o(D,A){var N=h;return Object.prototype.hasOwnProperty.call(N,D)?N[D]:N[D]=A(D)}function u(D,A){this.h=A;const N=[];let L=!0;for(let P=D.length-1;P>=0;P--){const B=D[P]|0;L&&B==A||(N[P]=B,L=!1)}this.g=N}var h={};function f(D){return-128<=D&&D<128?o(D,function(A){return new u([A|0],A<0?-1:0)}):new u([D|0],D<0?-1:0)}function m(D){if(isNaN(D)||!isFinite(D))return _;if(D<0)return C(m(-D));const A=[];let N=1;for(let L=0;D>=N;L++)A[L]=D/N|0,N*=4294967296;return new u(A,0)}function g(D,A){if(D.length==0)throw Error("number format error: empty string");if(A=A||10,A<2||36<A)throw Error("radix out of range: "+A);if(D.charAt(0)=="-")return C(g(D.substring(1),A));if(D.indexOf("-")>=0)throw Error('number format error: interior "-" character');const N=m(Math.pow(A,8));let L=_;for(let B=0;B<D.length;B+=8){var P=Math.min(8,D.length-B);const O=parseInt(D.substring(B,B+P),A);P<8?(P=m(Math.pow(A,P)),L=L.j(P).add(m(O))):(L=L.j(N),L=L.add(m(O)))}return L}var _=f(0),v=f(1),S=f(16777216);t=u.prototype,t.m=function(){if(E(this))return-C(this).m();let D=0,A=1;for(let N=0;N<this.g.length;N++){const L=this.i(N);D+=(L>=0?L:4294967296+L)*A,A*=4294967296}return D},t.toString=function(D){if(D=D||10,D<2||36<D)throw Error("radix out of range: "+D);if(x(this))return"0";if(E(this))return"-"+C(this).toString(D);const A=m(Math.pow(D,6));var N=this;let L="";for(;;){const P=Q(N,A).g;N=I(N,P.j(A));let B=((N.g.length>0?N.g[0]:N.h)>>>0).toString(D);if(N=P,x(N))return B+L;for(;B.length<6;)B="0"+B;L=B+L}},t.i=function(D){return D<0?0:D<this.g.length?this.g[D]:this.h};function x(D){if(D.h!=0)return!1;for(let A=0;A<D.g.length;A++)if(D.g[A]!=0)return!1;return!0}function E(D){return D.h==-1}t.l=function(D){return D=I(this,D),E(D)?-1:x(D)?0:1};function C(D){const A=D.g.length,N=[];for(let L=0;L<A;L++)N[L]=~D.g[L];return new u(N,~D.h).add(v)}t.abs=function(){return E(this)?C(this):this},t.add=function(D){const A=Math.max(this.g.length,D.g.length),N=[];let L=0;for(let P=0;P<=A;P++){let B=L+(this.i(P)&65535)+(D.i(P)&65535),O=(B>>>16)+(this.i(P)>>>16)+(D.i(P)>>>16);L=O>>>16,B&=65535,O&=65535,N[P]=O<<16|B}return new u(N,N[N.length-1]&-2147483648?-1:0)};function I(D,A){return D.add(C(A))}t.j=function(D){if(x(this)||x(D))return _;if(E(this))return E(D)?C(this).j(C(D)):C(C(this).j(D));if(E(D))return C(this.j(C(D)));if(this.l(S)<0&&D.l(S)<0)return m(this.m()*D.m());const A=this.g.length+D.g.length,N=[];for(var L=0;L<2*A;L++)N[L]=0;for(L=0;L<this.g.length;L++)for(let P=0;P<D.g.length;P++){const B=this.i(L)>>>16,O=this.i(L)&65535,K=D.i(P)>>>16,Y=D.i(P)&65535;N[2*L+2*P]+=O*Y,j(N,2*L+2*P),N[2*L+2*P+1]+=B*Y,j(N,2*L+2*P+1),N[2*L+2*P+1]+=O*K,j(N,2*L+2*P+1),N[2*L+2*P+2]+=B*K,j(N,2*L+2*P+2)}for(D=0;D<A;D++)N[D]=N[2*D+1]<<16|N[2*D];for(D=A;D<2*A;D++)N[D]=0;return new u(N,0)};function j(D,A){for(;(D[A]&65535)!=D[A];)D[A+1]+=D[A]>>>16,D[A]&=65535,A++}function M(D,A){this.g=D,this.h=A}function Q(D,A){if(x(A))throw Error("division by zero");if(x(D))return new M(_,_);if(E(D))return A=Q(C(D),A),new M(C(A.g),C(A.h));if(E(A))return A=Q(D,C(A)),new M(C(A.g),A.h);if(D.g.length>30){if(E(D)||E(A))throw Error("slowDivide_ only works with positive integers.");for(var N=v,L=A;L.l(D)<=0;)N=q(N),L=q(L);var P=G(N,1),B=G(L,1);for(L=G(L,2),N=G(N,2);!x(L);){var O=B.add(L);O.l(D)<=0&&(P=P.add(N),B=O),L=G(L,1),N=G(N,1)}return A=I(D,P.j(A)),new M(P,A)}for(P=_;D.l(A)>=0;){for(N=Math.max(1,Math.floor(D.m()/A.m())),L=Math.ceil(Math.log(N)/Math.LN2),L=L<=48?1:Math.pow(2,L-48),B=m(N),O=B.j(A);E(O)||O.l(D)>0;)N-=L,B=m(N),O=B.j(A);x(B)&&(B=v),P=P.add(B),D=I(D,O)}return new M(P,D)}t.B=function(D){return Q(this,D).h},t.and=function(D){const A=Math.max(this.g.length,D.g.length),N=[];for(let L=0;L<A;L++)N[L]=this.i(L)&D.i(L);return new u(N,this.h&D.h)},t.or=function(D){const A=Math.max(this.g.length,D.g.length),N=[];for(let L=0;L<A;L++)N[L]=this.i(L)|D.i(L);return new u(N,this.h|D.h)},t.xor=function(D){const A=Math.max(this.g.length,D.g.length),N=[];for(let L=0;L<A;L++)N[L]=this.i(L)^D.i(L);return new u(N,this.h^D.h)};function q(D){const A=D.g.length+1,N=[];for(let L=0;L<A;L++)N[L]=D.i(L)<<1|D.i(L-1)>>>31;return new u(N,D.h)}function G(D,A){const N=A>>5;A%=32;const L=D.g.length-N,P=[];for(let B=0;B<L;B++)P[B]=A>0?D.i(B+N)>>>A|D.i(B+N+1)<<32-A:D.i(B+N);return new u(P,D.h)}r.prototype.digest=r.prototype.A,r.prototype.reset=r.prototype.u,r.prototype.update=r.prototype.v,v1=r,u.prototype.add=u.prototype.add,u.prototype.multiply=u.prototype.j,u.prototype.modulo=u.prototype.B,u.prototype.compare=u.prototype.l,u.prototype.toNumber=u.prototype.m,u.prototype.toString=u.prototype.toString,u.prototype.getBits=u.prototype.i,u.fromNumber=m,u.fromString=g,da=u}).apply(typeof pS<"u"?pS:typeof self<"u"?self:typeof window<"u"?window:{});var Lh=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var x1,mu,S1,Xh,oy,w1,E1,C1;(function(){var t,e=Object.defineProperty;function n(p){p=[typeof globalThis=="object"&&globalThis,p,typeof window=="object"&&window,typeof self=="object"&&self,typeof Lh=="object"&&Lh];for(var w=0;w<p.length;++w){var k=p[w];if(k&&k.Math==Math)return k}throw Error("Cannot find global object")}var r=n(this);function a(p,w){if(w)e:{var k=r;p=p.split(".");for(var $=0;$<p.length-1;$++){var oe=p[$];if(!(oe in k))break e;k=k[oe]}p=p[p.length-1],$=k[p],w=w($),w!=$&&w!=null&&e(k,p,{configurable:!0,writable:!0,value:w})}}a("Symbol.dispose",function(p){return p||Symbol("Symbol.dispose")}),a("Array.prototype.values",function(p){return p||function(){return this[Symbol.iterator]()}}),a("Object.entries",function(p){return p||function(w){var k=[],$;for($ in w)Object.prototype.hasOwnProperty.call(w,$)&&k.push([$,w[$]]);return k}});var o=o||{},u=this||self;function h(p){var w=typeof p;return w=="object"&&p!=null||w=="function"}function f(p,w,k){return p.call.apply(p.bind,arguments)}function m(p,w,k){return m=f,m.apply(null,arguments)}function g(p,w){var k=Array.prototype.slice.call(arguments,1);return function(){var $=k.slice();return $.push.apply($,arguments),p.apply(this,$)}}function _(p,w){function k(){}k.prototype=w.prototype,p.Z=w.prototype,p.prototype=new k,p.prototype.constructor=p,p.Ob=function($,oe,he){for(var Ce=Array(arguments.length-2),We=2;We<arguments.length;We++)Ce[We-2]=arguments[We];return w.prototype[oe].apply($,Ce)}}var v=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?p=>p&&AsyncContext.Snapshot.wrap(p):p=>p;function S(p){const w=p.length;if(w>0){const k=Array(w);for(let $=0;$<w;$++)k[$]=p[$];return k}return[]}function x(p,w){for(let $=1;$<arguments.length;$++){const oe=arguments[$];var k=typeof oe;if(k=k!="object"?k:oe?Array.isArray(oe)?"array":k:"null",k=="array"||k=="object"&&typeof oe.length=="number"){k=p.length||0;const he=oe.length||0;p.length=k+he;for(let Ce=0;Ce<he;Ce++)p[k+Ce]=oe[Ce]}else p.push(oe)}}class E{constructor(w,k){this.i=w,this.j=k,this.h=0,this.g=null}get(){let w;return this.h>0?(this.h--,w=this.g,this.g=w.next,w.next=null):w=this.i(),w}}function C(p){u.setTimeout(()=>{throw p},0)}function I(){var p=D;let w=null;return p.g&&(w=p.g,p.g=p.g.next,p.g||(p.h=null),w.next=null),w}class j{constructor(){this.h=this.g=null}add(w,k){const $=M.get();$.set(w,k),this.h?this.h.next=$:this.g=$,this.h=$}}var M=new E(()=>new Q,p=>p.reset());class Q{constructor(){this.next=this.g=this.h=null}set(w,k){this.h=w,this.g=k,this.next=null}reset(){this.next=this.g=this.h=null}}let q,G=!1,D=new j,A=()=>{const p=Promise.resolve(void 0);q=()=>{p.then(N)}};function N(){for(var p;p=I();){try{p.h.call(p.g)}catch(k){C(k)}var w=M;w.j(p),w.h<100&&(w.h++,p.next=w.g,w.g=p)}G=!1}function L(){this.u=this.u,this.C=this.C}L.prototype.u=!1,L.prototype.dispose=function(){this.u||(this.u=!0,this.N())},L.prototype[Symbol.dispose]=function(){this.dispose()},L.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function P(p,w){this.type=p,this.g=this.target=w,this.defaultPrevented=!1}P.prototype.h=function(){this.defaultPrevented=!0};var B=(function(){if(!u.addEventListener||!Object.defineProperty)return!1;var p=!1,w=Object.defineProperty({},"passive",{get:function(){p=!0}});try{const k=()=>{};u.addEventListener("test",k,w),u.removeEventListener("test",k,w)}catch{}return p})();function O(p){return/^[\s\xa0]*$/.test(p)}function K(p,w){P.call(this,p?p.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,p&&this.init(p,w)}_(K,P),K.prototype.init=function(p,w){const k=this.type=p.type,$=p.changedTouches&&p.changedTouches.length?p.changedTouches[0]:null;this.target=p.target||p.srcElement,this.g=w,w=p.relatedTarget,w||(k=="mouseover"?w=p.fromElement:k=="mouseout"&&(w=p.toElement)),this.relatedTarget=w,$?(this.clientX=$.clientX!==void 0?$.clientX:$.pageX,this.clientY=$.clientY!==void 0?$.clientY:$.pageY,this.screenX=$.screenX||0,this.screenY=$.screenY||0):(this.clientX=p.clientX!==void 0?p.clientX:p.pageX,this.clientY=p.clientY!==void 0?p.clientY:p.pageY,this.screenX=p.screenX||0,this.screenY=p.screenY||0),this.button=p.button,this.key=p.key||"",this.ctrlKey=p.ctrlKey,this.altKey=p.altKey,this.shiftKey=p.shiftKey,this.metaKey=p.metaKey,this.pointerId=p.pointerId||0,this.pointerType=p.pointerType,this.state=p.state,this.i=p,p.defaultPrevented&&K.Z.h.call(this)},K.prototype.h=function(){K.Z.h.call(this);const p=this.i;p.preventDefault?p.preventDefault():p.returnValue=!1};var Y="closure_listenable_"+(Math.random()*1e6|0),z=0;function V(p,w,k,$,oe){this.listener=p,this.proxy=null,this.src=w,this.type=k,this.capture=!!$,this.ha=oe,this.key=++z,this.da=this.fa=!1}function W(p){p.da=!0,p.listener=null,p.proxy=null,p.src=null,p.ha=null}function ee(p,w,k){for(const $ in p)w.call(k,p[$],$,p)}function ie(p,w){for(const k in p)w.call(void 0,p[k],k,p)}function U(p){const w={};for(const k in p)w[k]=p[k];return w}const H="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ne(p,w){let k,$;for(let oe=1;oe<arguments.length;oe++){$=arguments[oe];for(k in $)p[k]=$[k];for(let he=0;he<H.length;he++)k=H[he],Object.prototype.hasOwnProperty.call($,k)&&(p[k]=$[k])}}function se(p){this.src=p,this.g={},this.h=0}se.prototype.add=function(p,w,k,$,oe){const he=p.toString();p=this.g[he],p||(p=this.g[he]=[],this.h++);const Ce=le(p,w,$,oe);return Ce>-1?(w=p[Ce],k||(w.fa=!1)):(w=new V(w,this.src,he,!!$,oe),w.fa=k,p.push(w)),w};function Z(p,w){const k=w.type;if(k in p.g){var $=p.g[k],oe=Array.prototype.indexOf.call($,w,void 0),he;(he=oe>=0)&&Array.prototype.splice.call($,oe,1),he&&(W(w),p.g[k].length==0&&(delete p.g[k],p.h--))}}function le(p,w,k,$){for(let oe=0;oe<p.length;++oe){const he=p[oe];if(!he.da&&he.listener==w&&he.capture==!!k&&he.ha==$)return oe}return-1}var pe="closure_lm_"+(Math.random()*1e6|0),Ee={};function ge(p,w,k,$,oe){if(Array.isArray(w)){for(let he=0;he<w.length;he++)ge(p,w[he],k,$,oe);return null}return k=Qn(k),p&&p[Y]?p.J(w,k,h($)?!!$.capture:!1,oe):J(p,w,k,!1,$,oe)}function J(p,w,k,$,oe,he){if(!w)throw Error("Invalid event type");const Ce=h(oe)?!!oe.capture:!!oe;let We=ot(p);if(We||(p[pe]=We=new se(p)),k=We.add(w,k,$,Ce,he),k.proxy)return k;if($=Se(),k.proxy=$,$.src=p,$.listener=k,p.addEventListener)B||(oe=Ce),oe===void 0&&(oe=!1),p.addEventListener(w.toString(),$,oe);else if(p.attachEvent)p.attachEvent(Me(w.toString()),$);else if(p.addListener&&p.removeListener)p.addListener($);else throw Error("addEventListener and attachEvent are unavailable.");return k}function Se(){function p(k){return w.call(p.src,p.listener,k)}const w=Oe;return p}function Ae(p,w,k,$,oe){if(Array.isArray(w))for(var he=0;he<w.length;he++)Ae(p,w[he],k,$,oe);else $=h($)?!!$.capture:!!$,k=Qn(k),p&&p[Y]?(p=p.i,he=String(w).toString(),he in p.g&&(w=p.g[he],k=le(w,k,$,oe),k>-1&&(W(w[k]),Array.prototype.splice.call(w,k,1),w.length==0&&(delete p.g[he],p.h--)))):p&&(p=ot(p))&&(w=p.g[w.toString()],p=-1,w&&(p=le(w,k,$,oe)),(k=p>-1?w[p]:null)&&ct(k))}function ct(p){if(typeof p!="number"&&p&&!p.da){var w=p.src;if(w&&w[Y])Z(w.i,p);else{var k=p.type,$=p.proxy;w.removeEventListener?w.removeEventListener(k,$,p.capture):w.detachEvent?w.detachEvent(Me(k),$):w.addListener&&w.removeListener&&w.removeListener($),(k=ot(w))?(Z(k,p),k.h==0&&(k.src=null,w[pe]=null)):W(p)}}}function Me(p){return p in Ee?Ee[p]:Ee[p]="on"+p}function Oe(p,w){if(p.da)p=!0;else{w=new K(w,this);const k=p.listener,$=p.ha||p.src;p.fa&&ct(p),p=k.call($,w)}return p}function ot(p){return p=p[pe],p instanceof se?p:null}var Sn="__closure_events_fn_"+(Math.random()*1e9>>>0);function Qn(p){return typeof p=="function"?p:(p[Sn]||(p[Sn]=function(w){return p.handleEvent(w)}),p[Sn])}function mt(){L.call(this),this.i=new se(this),this.M=this,this.G=null}_(mt,L),mt.prototype[Y]=!0,mt.prototype.removeEventListener=function(p,w,k,$){Ae(this,p,w,k,$)};function Dt(p,w){var k,$=p.G;if($)for(k=[];$;$=$.G)k.push($);if(p=p.M,$=w.type||w,typeof w=="string")w=new P(w,p);else if(w instanceof P)w.target=w.target||p;else{var oe=w;w=new P($,p),ne(w,oe)}oe=!0;let he,Ce;if(k)for(Ce=k.length-1;Ce>=0;Ce--)he=w.g=k[Ce],oe=je(he,$,!0,w)&&oe;if(he=w.g=p,oe=je(he,$,!0,w)&&oe,oe=je(he,$,!1,w)&&oe,k)for(Ce=0;Ce<k.length;Ce++)he=w.g=k[Ce],oe=je(he,$,!1,w)&&oe}mt.prototype.N=function(){if(mt.Z.N.call(this),this.i){var p=this.i;for(const w in p.g){const k=p.g[w];for(let $=0;$<k.length;$++)W(k[$]);delete p.g[w],p.h--}}this.G=null},mt.prototype.J=function(p,w,k,$){return this.i.add(String(p),w,!1,k,$)},mt.prototype.K=function(p,w,k,$){return this.i.add(String(p),w,!0,k,$)};function je(p,w,k,$){if(w=p.i.g[String(w)],!w)return!0;w=w.concat();let oe=!0;for(let he=0;he<w.length;++he){const Ce=w[he];if(Ce&&!Ce.da&&Ce.capture==k){const We=Ce.listener,Gt=Ce.ha||Ce.src;Ce.fa&&Z(p.i,Ce),oe=We.call(Gt,$)!==!1&&oe}}return oe&&!$.defaultPrevented}function Ye(p,w){if(typeof p!="function")if(p&&typeof p.handleEvent=="function")p=m(p.handleEvent,p);else throw Error("Invalid listener argument");return Number(w)>2147483647?-1:u.setTimeout(p,w||0)}function bi(p){p.g=Ye(()=>{p.g=null,p.i&&(p.i=!1,bi(p))},p.l);const w=p.h;p.h=null,p.m.apply(null,w)}class dn extends L{constructor(w,k){super(),this.m=w,this.l=k,this.h=null,this.i=!1,this.g=null}j(w){this.h=arguments,this.g?this.i=!0:bi(this)}N(){super.N(),this.g&&(u.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function zr(p){L.call(this),this.h=p,this.g={}}_(zr,L);var lc=[];function cc(p){ee(p.g,function(w,k){this.g.hasOwnProperty(k)&&ct(w)},p),p.g={}}zr.prototype.N=function(){zr.Z.N.call(this),cc(this)},zr.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var vi=u.JSON.stringify,bm=u.JSON.parse,od=class{stringify(p){return u.JSON.stringify(p,void 0)}parse(p){return u.JSON.parse(p,void 0)}};function ld(){}function cd(){}var Ur={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function wn(){P.call(this,"d")}_(wn,P);function Sr(){P.call(this,"c")}_(Sr,P);var Ht={},ud=null;function jo(){return ud=ud||new mt}Ht.Ia="serverreachability";function dd(p){P.call(this,Ht.Ia,p)}_(dd,P);function as(p){const w=jo();Dt(w,new dd(w))}Ht.STAT_EVENT="statevent";function Ra(p,w){P.call(this,Ht.STAT_EVENT,p),this.stat=w}_(Ra,P);function Xt(p){const w=jo();Dt(w,new Ra(w,p))}Ht.Ja="timingevent";function os(p,w){P.call(this,Ht.Ja,p),this.size=w}_(os,P);function ls(p,w){if(typeof p!="function")throw Error("Fn must not be null and must be a function");return u.setTimeout(function(){p()},w)}function Fr(){this.g=!0}Fr.prototype.ua=function(){this.g=!1};function vm(p,w,k,$,oe,he){p.info(function(){if(p.g)if(he){var Ce="",We=he.split("&");for(let pt=0;pt<We.length;pt++){var Gt=We[pt].split("=");if(Gt.length>1){const Nt=Gt[0];Gt=Gt[1];const Tr=Nt.split("_");Ce=Tr.length>=2&&Tr[1]=="type"?Ce+(Nt+"="+Gt+"&"):Ce+(Nt+"=redacted&")}}}else Ce=null;else Ce=he;return"XMLHTTP REQ ("+$+") [attempt "+oe+"]: "+w+`
`+k+`
`+Ce})}function hd(p,w,k,$,oe,he,Ce){p.info(function(){return"XMLHTTP RESP ("+$+") [ attempt "+oe+"]: "+w+`
`+k+`
`+he+" "+Ce})}function cs(p,w,k,$){p.info(function(){return"XMLHTTP TEXT ("+w+"): "+xm(p,k)+($?" "+$:"")})}function Da(p,w){p.info(function(){return"TIMEOUT: "+w})}Fr.prototype.info=function(){};function xm(p,w){if(!p.g)return w;if(!w)return null;try{const he=JSON.parse(w);if(he){for(p=0;p<he.length;p++)if(Array.isArray(he[p])){var k=he[p];if(!(k.length<2)){var $=k[1];if(Array.isArray($)&&!($.length<1)){var oe=$[0];if(oe!="noop"&&oe!="stop"&&oe!="close")for(let Ce=1;Ce<$.length;Ce++)$[Ce]=""}}}}return vi(he)}catch{return w}}var Ia={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},uc={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},dc;function Ma(){}_(Ma,ld),Ma.prototype.g=function(){return new XMLHttpRequest},dc=new Ma;function Us(p){return encodeURIComponent(String(p))}function fd(p){var w=1;p=p.split(":");const k=[];for(;w>0&&p.length;)k.push(p.shift()),w--;return p.length&&k.push(p.join(":")),k}function Vr(p,w,k,$){this.j=p,this.i=w,this.l=k,this.S=$||1,this.V=new zr(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new $r}function $r(){this.i=null,this.g="",this.h=!1}var Jt={},_n={};function us(p,w,k){p.M=1,p.A=ka(en(w)),p.u=k,p.R=!0,Ro(p,null)}function Ro(p,w){p.F=Date.now(),ds(p),p.B=en(p.A);var k=p.B,$=p.S;Array.isArray($)||($=[String($)]),ko(k.i,"t",$),p.C=0,k=p.j.L,p.h=new $r,p.g=jd(p.j,k?w:null,!p.u),p.P>0&&(p.O=new dn(m(p.Y,p,p.g),p.P)),w=p.V,k=p.g,$=p.ba;var oe="readystatechange";Array.isArray(oe)||(oe&&(lc[0]=oe.toString()),oe=lc);for(let he=0;he<oe.length;he++){const Ce=ge(k,oe[he],$||w.handleEvent,!1,w.h||w);if(!Ce)break;w.g[Ce.key]=Ce}w=p.J?U(p.J):{},p.u?(p.v||(p.v="POST"),w["Content-Type"]="application/x-www-form-urlencoded",p.g.ea(p.B,p.v,p.u,w)):(p.v="GET",p.g.ea(p.B,p.v,null,w)),as(),vm(p.i,p.v,p.B,p.l,p.S,p.u)}Vr.prototype.ba=function(p){p=p.target;const w=this.O;w&&Gr(p)==3?w.j():this.Y(p)},Vr.prototype.Y=function(p){try{if(p==this.g)e:{const We=Gr(this.g),Gt=this.g.ya(),pt=this.g.ca();if(!(We<3)&&(We!=3||this.g&&(this.h.h||this.g.la()||En(this.g)))){this.K||We!=4||Gt==7||(Gt==8||pt<=0?as(3):as(2)),hs(this);var w=this.g.ca();this.X=w;var k=Sm(this);if(this.o=w==200,hd(this.i,this.v,this.B,this.l,this.S,We,w),this.o){if(this.U&&!this.L){t:{if(this.g){var $,oe=this.g;if(($=oe.g?oe.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!O($)){var he=$;break t}}he=null}if(p=he)cs(this.i,this.l,p,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,fs(this,p);else{this.o=!1,this.m=3,Xt(12),ar(this),wr(this);break e}}if(this.R){p=!0;let Nt;for(;!this.K&&this.C<k.length;)if(Nt=pd(this,k),Nt==_n){We==4&&(this.m=4,Xt(14),p=!1),cs(this.i,this.l,null,"[Incomplete Response]");break}else if(Nt==Jt){this.m=4,Xt(15),cs(this.i,this.l,k,"[Invalid Chunk]"),p=!1;break}else cs(this.i,this.l,Nt,null),fs(this,Nt);if(md(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),We!=4||k.length!=0||this.h.h||(this.m=1,Xt(16),p=!1),this.o=this.o&&p,!p)cs(this.i,this.l,k,"[Invalid Chunked Response]"),ar(this),wr(this);else if(k.length>0&&!this.W){this.W=!0;var Ce=this.j;Ce.g==this&&Ce.aa&&!Ce.P&&(Ce.j.info("Great, no buffering proxy detected. Bytes received: "+k.length),Tc(Ce),Ce.P=!0,Xt(11))}}else cs(this.i,this.l,k,null),fs(this,k);We==4&&ar(this),this.o&&!this.K&&(We==4?Ed(this.j,this):(this.o=!1,ds(this)))}else Vs(this.g),w==400&&k.indexOf("Unknown SID")>0?(this.m=3,Xt(12)):(this.m=0,Xt(13)),ar(this),wr(this)}}}catch{}};function Sm(p){if(!md(p))return p.g.la();const w=En(p.g);if(w==="")return"";let k="";const $=w.length,oe=Gr(p.g)==4;if(!p.h.i){if(typeof TextDecoder>"u")return ar(p),wr(p),"";p.h.i=new u.TextDecoder}for(let he=0;he<$;he++)p.h.h=!0,k+=p.h.i.decode(w[he],{stream:!(oe&&he==$-1)});return w.length=0,p.h.g+=k,p.C=0,p.h.g}function md(p){return p.g?p.v=="GET"&&p.M!=2&&p.j.Aa:!1}function pd(p,w){var k=p.C,$=w.indexOf(`
`,k);return $==-1?_n:(k=Number(w.substring(k,$)),isNaN(k)?Jt:($+=1,$+k>w.length?_n:(w=w.slice($,$+k),p.C=$+k,w)))}Vr.prototype.cancel=function(){this.K=!0,ar(this)};function ds(p){p.T=Date.now()+p.H,Do(p,p.H)}function Do(p,w){if(p.D!=null)throw Error("WatchDog timer not null");p.D=ls(m(p.aa,p),w)}function hs(p){p.D&&(u.clearTimeout(p.D),p.D=null)}Vr.prototype.aa=function(){this.D=null;const p=Date.now();p-this.T>=0?(Da(this.i,this.B),this.M!=2&&(as(),Xt(17)),ar(this),this.m=2,wr(this)):Do(this,this.T-p)};function wr(p){p.j.I==0||p.K||Ed(p.j,p)}function ar(p){hs(p);var w=p.O;w&&typeof w.dispose=="function"&&w.dispose(),p.O=null,cc(p.V),p.g&&(w=p.g,p.g=null,w.abort(),w.dispose())}function fs(p,w){try{var k=p.j;if(k.I!=0&&(k.g==p||ps(k.h,p))){if(!p.L&&ps(k.h,p)&&k.I==3){try{var $=k.Ba.g.parse(w)}catch{$=null}if(Array.isArray($)&&$.length==3){var oe=$;if(oe[0]==0){e:if(!k.v){if(k.g)if(k.g.F+3e3<p.F)Lo(k),ji(k);else break e;Ua(k),Xt(18)}}else k.xa=oe[1],0<k.xa-k.K&&oe[2]<37500&&k.F&&k.A==0&&!k.C&&(k.C=ls(m(k.Va,k),6e3));ms(k.h)<=1&&k.ta&&(k.ta=void 0)}else xs(k,11)}else if((p.L||k.g==p)&&Lo(k),!O(w))for(oe=k.Ba.g.parse(w),w=0;w<oe.length;w++){let pt=oe[w];const Nt=pt[0];if(!(Nt<=k.K))if(k.K=Nt,pt=pt[1],k.I==2)if(pt[0]=="c"){k.M=pt[1],k.ba=pt[2];const Tr=pt[3];Tr!=null&&(k.ka=Tr,k.j.info("VER="+k.ka));const Ss=pt[4];Ss!=null&&(k.za=Ss,k.j.info("SVER="+k.za));const Qr=pt[5];Qr!=null&&typeof Qr=="number"&&Qr>0&&($=1.5*Qr,k.O=$,k.j.info("backChannelRequestTimeoutMs_="+$)),$=k;const Wr=p.g;if(Wr){const Fa=Wr.g?Wr.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Fa){var he=$.h;he.g||Fa.indexOf("spdy")==-1&&Fa.indexOf("quic")==-1&&Fa.indexOf("h2")==-1||(he.j=he.l,he.g=new Set,he.h&&(mc(he,he.h),he.h=null))}if($.G){const zo=Wr.g?Wr.g.getResponseHeader("X-HTTP-Session-Id"):null;zo&&($.wa=zo,_t($.J,$.G,zo))}}k.I=3,k.l&&k.l.ra(),k.aa&&(k.T=Date.now()-p.F,k.j.info("Handshake RTT: "+k.T+"ms")),$=k;var Ce=p;if($.na=Ad($,$.L?$.ba:null,$.W),Ce.L){pc($.h,Ce);var We=Ce,Gt=$.O;Gt&&(We.H=Gt),We.D&&(hs(We),ds(We)),$.g=Ce}else Sd($);k.i.length>0&&vs(k)}else pt[0]!="stop"&&pt[0]!="close"||xs(k,7);else k.I==3&&(pt[0]=="stop"||pt[0]=="close"?pt[0]=="stop"?xs(k,7):Ec(k):pt[0]!="noop"&&k.l&&k.l.qa(pt),k.A=0)}}as(4)}catch{}}var Zt=class{constructor(p,w){this.g=p,this.map=w}};function hc(p){this.l=p||10,u.PerformanceNavigationTiming?(p=u.performance.getEntriesByType("navigation"),p=p.length>0&&(p[0].nextHopProtocol=="hq"||p[0].nextHopProtocol=="h2")):p=!!(u.chrome&&u.chrome.loadTimes&&u.chrome.loadTimes()&&u.chrome.loadTimes().wasFetchedViaSpdy),this.j=p?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function fc(p){return p.h?!0:p.g?p.g.size>=p.j:!1}function ms(p){return p.h?1:p.g?p.g.size:0}function ps(p,w){return p.h?p.h==w:p.g?p.g.has(w):!1}function mc(p,w){p.g?p.g.add(w):p.h=w}function pc(p,w){p.h&&p.h==w?p.h=null:p.g&&p.g.has(w)&&p.g.delete(w)}hc.prototype.cancel=function(){if(this.i=gc(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const p of this.g.values())p.cancel();this.g.clear()}};function gc(p){if(p.h!=null)return p.i.concat(p.h.G);if(p.g!=null&&p.g.size!==0){let w=p.i;for(const k of p.g.values())w=w.concat(k.G);return w}return S(p.i)}var gd=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Io(p,w){if(p){p=p.split("&");for(let k=0;k<p.length;k++){const $=p[k].indexOf("=");let oe,he=null;$>=0?(oe=p[k].substring(0,$),he=p[k].substring($+1)):oe=p[k],w(oe,he?decodeURIComponent(he.replace(/\+/g," ")):"")}}}function or(p){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let w;p instanceof or?(this.l=p.l,bn(this,p.j),this.o=p.o,this.g=p.g,xi(this,p.u),this.h=p.h,yc(this,vd(p.i)),this.m=p.m):p&&(w=String(p).match(gd))?(this.l=!1,bn(this,w[1]||"",!0),this.o=gs(w[2]||""),this.g=gs(w[3]||"",!0),xi(this,w[4]),this.h=gs(w[5]||"",!0),yc(this,w[6]||"",!0),this.m=gs(w[7]||"")):(this.l=!1,this.i=new wi(null,this.l))}or.prototype.toString=function(){const p=[];var w=this.j;w&&p.push(Oa(w,Mo,!0),":");var k=this.g;return(k||w=="file")&&(p.push("//"),(w=this.o)&&p.push(Oa(w,Mo,!0),"@"),p.push(Us(k).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),k=this.u,k!=null&&p.push(":",String(k))),(k=this.h)&&(this.g&&k.charAt(0)!="/"&&p.push("/"),p.push(Oa(k,k.charAt(0)=="/"?_c:yd,!0))),(k=this.i.toString())&&p.push("?",k),(k=this.m)&&p.push("#",Oa(k,_d)),p.join("")},or.prototype.resolve=function(p){const w=en(this);let k=!!p.j;k?bn(w,p.j):k=!!p.o,k?w.o=p.o:k=!!p.g,k?w.g=p.g:k=p.u!=null;var $=p.h;if(k)xi(w,p.u);else if(k=!!p.h){if($.charAt(0)!="/")if(this.g&&!this.h)$="/"+$;else{var oe=w.h.lastIndexOf("/");oe!=-1&&($=w.h.slice(0,oe+1)+$)}if(oe=$,oe==".."||oe==".")$="";else if(oe.indexOf("./")!=-1||oe.indexOf("/.")!=-1){$=oe.lastIndexOf("/",0)==0,oe=oe.split("/");const he=[];for(let Ce=0;Ce<oe.length;){const We=oe[Ce++];We=="."?$&&Ce==oe.length&&he.push(""):We==".."?((he.length>1||he.length==1&&he[0]!="")&&he.pop(),$&&Ce==oe.length&&he.push("")):(he.push(We),$=!0)}$=he.join("/")}else $=oe}return k?w.h=$:k=p.i.toString()!=="",k?yc(w,vd(p.i)):k=!!p.m,k&&(w.m=p.m),w};function en(p){return new or(p)}function bn(p,w,k){p.j=k?gs(w,!0):w,p.j&&(p.j=p.j.replace(/:$/,""))}function xi(p,w){if(w){if(w=Number(w),isNaN(w)||w<0)throw Error("Bad port number "+w);p.u=w}else p.u=null}function yc(p,w,k){w instanceof wi?(p.i=w,Oo(p.i,p.l)):(k||(w=Oa(w,Si)),p.i=new wi(w,p.l))}function _t(p,w,k){p.i.set(w,k)}function ka(p){return _t(p,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),p}function gs(p,w){return p?w?decodeURI(p.replace(/%25/g,"%2525")):decodeURIComponent(p):""}function Oa(p,w,k){return typeof p=="string"?(p=encodeURI(p).replace(w,Wn),k&&(p=p.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),p):null}function Wn(p){return p=p.charCodeAt(0),"%"+(p>>4&15).toString(16)+(p&15).toString(16)}var Mo=/[#\/\?@]/g,yd=/[#\?:]/g,_c=/[#\?]/g,Si=/[#\?@]/g,_d=/#/g;function wi(p,w){this.h=this.g=null,this.i=p||null,this.j=!!w}function Kn(p){p.g||(p.g=new Map,p.h=0,p.i&&Io(p.i,function(w,k){p.add(decodeURIComponent(w.replace(/\+/g," ")),k)}))}t=wi.prototype,t.add=function(p,w){Kn(this),this.i=null,p=Ei(this,p);let k=this.g.get(p);return k||this.g.set(p,k=[]),k.push(w),this.h+=1,this};function bd(p,w){Kn(p),w=Ei(p,w),p.g.has(w)&&(p.i=null,p.h-=p.g.get(w).length,p.g.delete(w))}function bc(p,w){return Kn(p),w=Ei(p,w),p.g.has(w)}t.forEach=function(p,w){Kn(this),this.g.forEach(function(k,$){k.forEach(function(oe){p.call(w,oe,$,this)},this)},this)};function vc(p,w){Kn(p);let k=[];if(typeof w=="string")bc(p,w)&&(k=k.concat(p.g.get(Ei(p,w))));else for(p=Array.from(p.g.values()),w=0;w<p.length;w++)k=k.concat(p[w]);return k}t.set=function(p,w){return Kn(this),this.i=null,p=Ei(this,p),bc(this,p)&&(this.h-=this.g.get(p).length),this.g.set(p,[w]),this.h+=1,this},t.get=function(p,w){return p?(p=vc(this,p),p.length>0?String(p[0]):w):w};function ko(p,w,k){bd(p,w),k.length>0&&(p.i=null,p.g.set(Ei(p,w),S(k)),p.h+=k.length)}t.toString=function(){if(this.i)return this.i;if(!this.g)return"";const p=[],w=Array.from(this.g.keys());for(let $=0;$<w.length;$++){var k=w[$];const oe=Us(k);k=vc(this,k);for(let he=0;he<k.length;he++){let Ce=oe;k[he]!==""&&(Ce+="="+Us(k[he])),p.push(Ce)}}return this.i=p.join("&")};function vd(p){const w=new wi;return w.i=p.i,p.g&&(w.g=new Map(p.g),w.h=p.h),w}function Ei(p,w){return w=String(w),p.j&&(w=w.toLowerCase()),w}function Oo(p,w){w&&!p.j&&(Kn(p),p.i=null,p.g.forEach(function(k,$){const oe=$.toLowerCase();$!=oe&&(bd(this,$),ko(this,oe,k))},p)),p.j=w}function qr(p,w){const k=new Fr;if(u.Image){const $=new Image;$.onload=g(Er,k,"TestLoadImage: loaded",!0,w,$),$.onerror=g(Er,k,"TestLoadImage: error",!1,w,$),$.onabort=g(Er,k,"TestLoadImage: abort",!1,w,$),$.ontimeout=g(Er,k,"TestLoadImage: timeout",!1,w,$),u.setTimeout(function(){$.ontimeout&&$.ontimeout()},1e4),$.src=p}else w(!1)}function xc(p,w){const k=new Fr,$=new AbortController,oe=setTimeout(()=>{$.abort(),Er(k,"TestPingServer: timeout",!1,w)},1e4);fetch(p,{signal:$.signal}).then(he=>{clearTimeout(oe),he.ok?Er(k,"TestPingServer: ok",!0,w):Er(k,"TestPingServer: server error",!1,w)}).catch(()=>{clearTimeout(oe),Er(k,"TestPingServer: error",!1,w)})}function Er(p,w,k,$,oe){try{oe&&(oe.onload=null,oe.onerror=null,oe.onabort=null,oe.ontimeout=null),$(k)}catch{}}function Ci(){this.g=new od}function ys(p){this.i=p.Sb||null,this.h=p.ab||!1}_(ys,ld),ys.prototype.g=function(){return new Na(this.i,this.h)};function Na(p,w){mt.call(this),this.H=p,this.o=w,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}_(Na,mt),t=Na.prototype,t.open=function(p,w){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=p,this.D=w,this.readyState=1,Hr(this)},t.send=function(p){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const w={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};p&&(w.body=p),(this.H||u).fetch(new Request(this.D,w)).then(this.Pa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,Ti(this)),this.readyState=0},t.Pa=function(p){if(this.g&&(this.l=p,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=p.headers,this.readyState=2,Hr(this)),this.g&&(this.readyState=3,Hr(this),this.g)))if(this.responseType==="arraybuffer")p.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof u.ReadableStream<"u"&&"body"in p){if(this.j=p.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;No(this)}else p.text().then(this.Oa.bind(this),this.ga.bind(this))};function No(p){p.j.read().then(p.Ma.bind(p)).catch(p.ga.bind(p))}t.Ma=function(p){if(this.g){if(this.o&&p.value)this.response.push(p.value);else if(!this.o){var w=p.value?p.value:new Uint8Array(0);(w=this.B.decode(w,{stream:!p.done}))&&(this.response=this.responseText+=w)}p.done?Ti(this):Hr(this),this.readyState==3&&No(this)}},t.Oa=function(p){this.g&&(this.response=this.responseText=p,Ti(this))},t.Na=function(p){this.g&&(this.response=p,Ti(this))},t.ga=function(){this.g&&Ti(this)};function Ti(p){p.readyState=4,p.l=null,p.j=null,p.B=null,Hr(p)}t.setRequestHeader=function(p,w){this.A.append(p,w)},t.getResponseHeader=function(p){return this.h&&this.h.get(p.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";const p=[],w=this.h.entries();for(var k=w.next();!k.done;)k=k.value,p.push(k[0]+": "+k[1]),k=w.next();return p.join(`\r
`)};function Hr(p){p.onreadystatechange&&p.onreadystatechange.call(p)}Object.defineProperty(Na.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(p){this.m=p?"include":"same-origin"}});function Cr(p){let w="";return ee(p,function(k,$){w+=$,w+=":",w+=k,w+=`\r
`}),w}function Pa(p,w,k){e:{for($ in k){var $=!1;break e}$=!0}$||(k=Cr(k),typeof p=="string"?k!=null&&Us(k):_t(p,w,k))}function xt(p){mt.call(this),this.headers=new Map,this.L=p||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}_(xt,mt);var _s=/^https?$/i,Sc=["POST","PUT"];t=xt.prototype,t.Fa=function(p){this.H=p},t.ea=function(p,w,k,$){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+p);w=w?w.toUpperCase():"GET",this.D=p,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():dc.g(),this.g.onreadystatechange=v(m(this.Ca,this));try{this.B=!0,this.g.open(w,String(p),!0),this.B=!1}catch(he){Ba(this,he);return}if(p=k||"",k=new Map(this.headers),$)if(Object.getPrototypeOf($)===Object.prototype)for(var oe in $)k.set(oe,$[oe]);else if(typeof $.keys=="function"&&typeof $.get=="function")for(const he of $.keys())k.set(he,$.get(he));else throw Error("Unknown input type for opt_headers: "+String($));$=Array.from(k.keys()).find(he=>he.toLowerCase()=="content-type"),oe=u.FormData&&p instanceof u.FormData,!(Array.prototype.indexOf.call(Sc,w,void 0)>=0)||$||oe||k.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[he,Ce]of k)this.g.setRequestHeader(he,Ce);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(p),this.v=!1}catch(he){Ba(this,he)}};function Ba(p,w){p.h=!1,p.g&&(p.j=!0,p.g.abort(),p.j=!1),p.l=w,p.o=5,wc(p),Fs(p)}function wc(p){p.A||(p.A=!0,Dt(p,"complete"),Dt(p,"error"))}t.abort=function(p){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=p||7,Dt(this,"complete"),Dt(this,"abort"),Fs(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Fs(this,!0)),xt.Z.N.call(this)},t.Ca=function(){this.u||(this.B||this.v||this.j?La(this):this.Xa())},t.Xa=function(){La(this)};function La(p){if(p.h&&typeof o<"u"){if(p.v&&Gr(p)==4)setTimeout(p.Ca.bind(p),0);else if(Dt(p,"readystatechange"),Gr(p)==4){p.h=!1;try{const he=p.ca();e:switch(he){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var w=!0;break e;default:w=!1}var k;if(!(k=w)){var $;if($=he===0){let Ce=String(p.D).match(gd)[1]||null;!Ce&&u.self&&u.self.location&&(Ce=u.self.location.protocol.slice(0,-1)),$=!_s.test(Ce?Ce.toLowerCase():"")}k=$}if(k)Dt(p,"complete"),Dt(p,"success");else{p.o=6;try{var oe=Gr(p)>2?p.g.statusText:""}catch{oe=""}p.l=oe+" ["+p.ca()+"]",wc(p)}}finally{Fs(p)}}}}function Fs(p,w){if(p.g){p.m&&(clearTimeout(p.m),p.m=null);const k=p.g;p.g=null,w||Dt(p,"ready");try{k.onreadystatechange=null}catch{}}}t.isActive=function(){return!!this.g};function Gr(p){return p.g?p.g.readyState:0}t.ca=function(){try{return Gr(this)>2?this.g.status:-1}catch{return-1}},t.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},t.La=function(p){if(this.g){var w=this.g.responseText;return p&&w.indexOf(p)==0&&(w=w.substring(p.length)),bm(w)}};function En(p){try{if(!p.g)return null;if("response"in p.g)return p.g.response;switch(p.F){case"":case"text":return p.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in p.g)return p.g.mozResponseArrayBuffer}return null}catch{return null}}function Vs(p){const w={};p=(p.g&&Gr(p)>=2&&p.g.getAllResponseHeaders()||"").split(`\r
`);for(let $=0;$<p.length;$++){if(O(p[$]))continue;var k=fd(p[$]);const oe=k[0];if(k=k[1],typeof k!="string")continue;k=k.trim();const he=w[oe]||[];w[oe]=he,he.push(k)}ie(w,function($){return $.join(", ")})}t.ya=function(){return this.o},t.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function bs(p,w,k){return k&&k.internalChannelParams&&k.internalChannelParams[p]||w}function Ai(p){this.za=0,this.i=[],this.j=new Fr,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=bs("failFast",!1,p),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=bs("baseRetryDelayMs",5e3,p),this.Za=bs("retryDelaySeedMs",1e4,p),this.Ta=bs("forwardChannelMaxRetries",2,p),this.va=bs("forwardChannelRequestTimeoutMs",2e4,p),this.ma=p&&p.xmlHttpFactory||void 0,this.Ua=p&&p.Rb||void 0,this.Aa=p&&p.useFetchStreams||!1,this.O=void 0,this.L=p&&p.supportsCrossDomainXhr||!1,this.M="",this.h=new hc(p&&p.concurrentRequestLimit),this.Ba=new Ci,this.S=p&&p.fastHandshake||!1,this.R=p&&p.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=p&&p.Pb||!1,p&&p.ua&&this.j.ua(),p&&p.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&p&&p.detectBufferingProxy||!1,this.ia=void 0,p&&p.longPollingTimeout&&p.longPollingTimeout>0&&(this.ia=p.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}t=Ai.prototype,t.ka=8,t.I=1,t.connect=function(p,w,k,$){Xt(0),this.W=p,this.H=w||{},k&&$!==void 0&&(this.H.OSID=k,this.H.OAID=$),this.F=this.X,this.J=Ad(this,null,this.W),vs(this)};function Ec(p){if(Po(p),p.I==3){var w=p.V++,k=en(p.J);if(_t(k,"SID",p.M),_t(k,"RID",w),_t(k,"TYPE","terminate"),za(p,k),w=new Vr(p,p.j,w),w.M=2,w.A=ka(en(k)),k=!1,u.navigator&&u.navigator.sendBeacon)try{k=u.navigator.sendBeacon(w.A.toString(),"")}catch{}!k&&u.Image&&(new Image().src=w.A,k=!0),k||(w.g=jd(w.j,null),w.g.ea(w.A)),w.F=Date.now(),ds(w)}Td(p)}function ji(p){p.g&&(Tc(p),p.g.cancel(),p.g=null)}function Po(p){ji(p),p.v&&(u.clearTimeout(p.v),p.v=null),Lo(p),p.h.cancel(),p.m&&(typeof p.m=="number"&&u.clearTimeout(p.m),p.m=null)}function vs(p){if(!fc(p.h)&&!p.m){p.m=!0;var w=p.Ea;q||A(),G||(q(),G=!0),D.add(w,p),p.D=0}}function Bo(p,w){return ms(p.h)>=p.h.j-(p.m?1:0)?!1:p.m?(p.i=w.G.concat(p.i),!0):p.I==1||p.I==2||p.D>=(p.Sa?0:p.Ta)?!1:(p.m=ls(m(p.Ea,p,w),Cd(p,p.D)),p.D++,!0)}t.Ea=function(p){if(this.m)if(this.m=null,this.I==1){if(!p){this.V=Math.floor(Math.random()*1e5),p=this.V++;const oe=new Vr(this,this.j,p);let he=this.o;if(this.U&&(he?(he=U(he),ne(he,this.U)):he=this.U),this.u!==null||this.R||(oe.J=he,he=null),this.S)e:{for(var w=0,k=0;k<this.i.length;k++){t:{var $=this.i[k];if("__data__"in $.map&&($=$.map.__data__,typeof $=="string")){$=$.length;break t}$=void 0}if($===void 0)break;if(w+=$,w>4096){w=k;break e}if(w===4096||k===this.i.length-1){w=k+1;break e}}w=1e3}else w=1e3;w=xd(this,oe,w),k=en(this.J),_t(k,"RID",p),_t(k,"CVER",22),this.G&&_t(k,"X-HTTP-Session-Id",this.G),za(this,k),he&&(this.R?w="headers="+Us(Cr(he))+"&"+w:this.u&&Pa(k,this.u,he)),mc(this.h,oe),this.Ra&&_t(k,"TYPE","init"),this.S?(_t(k,"$req",w),_t(k,"SID","null"),oe.U=!0,us(oe,k,null)):us(oe,k,w),this.I=2}}else this.I==3&&(p?Cc(this,p):this.i.length==0||fc(this.h)||Cc(this))};function Cc(p,w){var k;w?k=w.l:k=p.V++;const $=en(p.J);_t($,"SID",p.M),_t($,"RID",k),_t($,"AID",p.K),za(p,$),p.u&&p.o&&Pa($,p.u,p.o),k=new Vr(p,p.j,k,p.D+1),p.u===null&&(k.J=p.o),w&&(p.i=w.G.concat(p.i)),w=xd(p,k,1e3),k.H=Math.round(p.va*.5)+Math.round(p.va*.5*Math.random()),mc(p.h,k),us(k,$,w)}function za(p,w){p.H&&ee(p.H,function(k,$){_t(w,$,k)}),p.l&&ee({},function(k,$){_t(w,$,k)})}function xd(p,w,k){k=Math.min(p.i.length,k);const $=p.l?m(p.l.Ka,p.l,p):null;e:{var oe=p.i;let We=-1;for(;;){const Gt=["count="+k];We==-1?k>0?(We=oe[0].g,Gt.push("ofs="+We)):We=0:Gt.push("ofs="+We);let pt=!0;for(let Nt=0;Nt<k;Nt++){var he=oe[Nt].g;const Tr=oe[Nt].map;if(he-=We,he<0)We=Math.max(0,oe[Nt].g-100),pt=!1;else try{he="req"+he+"_"||"";try{var Ce=Tr instanceof Map?Tr:Object.entries(Tr);for(const[Ss,Qr]of Ce){let Wr=Qr;h(Qr)&&(Wr=vi(Qr)),Gt.push(he+Ss+"="+encodeURIComponent(Wr))}}catch(Ss){throw Gt.push(he+"type="+encodeURIComponent("_badmap")),Ss}}catch{$&&$(Tr)}}if(pt){Ce=Gt.join("&");break e}}Ce=void 0}return p=p.i.splice(0,k),w.G=p,Ce}function Sd(p){if(!p.g&&!p.v){p.Y=1;var w=p.Da;q||A(),G||(q(),G=!0),D.add(w,p),p.A=0}}function Ua(p){return p.g||p.v||p.A>=3?!1:(p.Y++,p.v=ls(m(p.Da,p),Cd(p,p.A)),p.A++,!0)}t.Da=function(){if(this.v=null,wd(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var p=4*this.T;this.j.info("BP detection timer enabled: "+p),this.B=ls(m(this.Wa,this),p)}},t.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,Xt(10),ji(this),wd(this))};function Tc(p){p.B!=null&&(u.clearTimeout(p.B),p.B=null)}function wd(p){p.g=new Vr(p,p.j,"rpc",p.Y),p.u===null&&(p.g.J=p.o),p.g.P=0;var w=en(p.na);_t(w,"RID","rpc"),_t(w,"SID",p.M),_t(w,"AID",p.K),_t(w,"CI",p.F?"0":"1"),!p.F&&p.ia&&_t(w,"TO",p.ia),_t(w,"TYPE","xmlhttp"),za(p,w),p.u&&p.o&&Pa(w,p.u,p.o),p.O&&(p.g.H=p.O);var k=p.g;p=p.ba,k.M=1,k.A=ka(en(w)),k.u=null,k.R=!0,Ro(k,p)}t.Va=function(){this.C!=null&&(this.C=null,ji(this),Ua(this),Xt(19))};function Lo(p){p.C!=null&&(u.clearTimeout(p.C),p.C=null)}function Ed(p,w){var k=null;if(p.g==w){Lo(p),Tc(p),p.g=null;var $=2}else if(ps(p.h,w))k=w.G,pc(p.h,w),$=1;else return;if(p.I!=0){if(w.o)if($==1){k=w.u?w.u.length:0,w=Date.now()-w.F;var oe=p.D;$=jo(),Dt($,new os($,k)),vs(p)}else Sd(p);else if(oe=w.m,oe==3||oe==0&&w.X>0||!($==1&&Bo(p,w)||$==2&&Ua(p)))switch(k&&k.length>0&&(w=p.h,w.i=w.i.concat(k)),oe){case 1:xs(p,5);break;case 4:xs(p,10);break;case 3:xs(p,6);break;default:xs(p,2)}}}function Cd(p,w){let k=p.Qa+Math.floor(Math.random()*p.Za);return p.isActive()||(k*=2),k*w}function xs(p,w){if(p.j.info("Error code "+w),w==2){var k=m(p.bb,p),$=p.Ua;const oe=!$;$=new or($||"//www.google.com/images/cleardot.gif"),u.location&&u.location.protocol=="http"||bn($,"https"),ka($),oe?qr($.toString(),k):xc($.toString(),k)}else Xt(2);p.I=0,p.l&&p.l.pa(w),Td(p),Po(p)}t.bb=function(p){p?(this.j.info("Successfully pinged google.com"),Xt(2)):(this.j.info("Failed to ping google.com"),Xt(1))};function Td(p){if(p.I=0,p.ja=[],p.l){const w=gc(p.h);(w.length!=0||p.i.length!=0)&&(x(p.ja,w),x(p.ja,p.i),p.h.i.length=0,S(p.i),p.i.length=0),p.l.oa()}}function Ad(p,w,k){var $=k instanceof or?en(k):new or(k);if($.g!="")w&&($.g=w+"."+$.g),xi($,$.u);else{var oe=u.location;$=oe.protocol,w=w?w+"."+oe.hostname:oe.hostname,oe=+oe.port;const he=new or(null);$&&bn(he,$),w&&(he.g=w),oe&&xi(he,oe),k&&(he.h=k),$=he}return k=p.G,w=p.wa,k&&w&&_t($,k,w),_t($,"VER",p.ka),za(p,$),$}function jd(p,w,k){if(w&&!p.L)throw Error("Can't create secondary domain capable XhrIo object.");return w=p.Aa&&!p.ma?new xt(new ys({ab:k})):new xt(p.ma),w.Fa(p.L),w}t.isActive=function(){return!!this.l&&this.l.isActive(this)};function Rd(){}t=Rd.prototype,t.ra=function(){},t.qa=function(){},t.pa=function(){},t.oa=function(){},t.isActive=function(){return!0},t.Ka=function(){};function Ri(){}Ri.prototype.g=function(p,w){return new Fn(p,w)};function Fn(p,w){mt.call(this),this.g=new Ai(w),this.l=p,this.h=w&&w.messageUrlParams||null,p=w&&w.messageHeaders||null,w&&w.clientProtocolHeaderRequired&&(p?p["X-Client-Protocol"]="webchannel":p={"X-Client-Protocol":"webchannel"}),this.g.o=p,p=w&&w.initMessageHeaders||null,w&&w.messageContentType&&(p?p["X-WebChannel-Content-Type"]=w.messageContentType:p={"X-WebChannel-Content-Type":w.messageContentType}),w&&w.sa&&(p?p["X-WebChannel-Client-Profile"]=w.sa:p={"X-WebChannel-Client-Profile":w.sa}),this.g.U=p,(p=w&&w.Qb)&&!O(p)&&(this.g.u=p),this.A=w&&w.supportsCrossDomainXhr||!1,this.v=w&&w.sendRawJson||!1,(w=w&&w.httpSessionIdParam)&&!O(w)&&(this.g.G=w,p=this.h,p!==null&&w in p&&(p=this.h,w in p&&delete p[w])),this.j=new $s(this)}_(Fn,mt),Fn.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},Fn.prototype.close=function(){Ec(this.g)},Fn.prototype.o=function(p){var w=this.g;if(typeof p=="string"){var k={};k.__data__=p,p=k}else this.v&&(k={},k.__data__=vi(p),p=k);w.i.push(new Zt(w.Ya++,p)),w.I==3&&vs(w)},Fn.prototype.N=function(){this.g.l=null,delete this.j,Ec(this.g),delete this.g,Fn.Z.N.call(this)};function Dd(p){wn.call(this),p.__headers__&&(this.headers=p.__headers__,this.statusCode=p.__status__,delete p.__headers__,delete p.__status__);var w=p.__sm__;if(w){e:{for(const k in w){p=k;break e}p=void 0}(this.i=p)&&(p=this.i,w=w!==null&&p in w?w[p]:void 0),this.data=w}else this.data=p}_(Dd,wn);function Id(){Sr.call(this),this.status=1}_(Id,Sr);function $s(p){this.g=p}_($s,Rd),$s.prototype.ra=function(){Dt(this.g,"a")},$s.prototype.qa=function(p){Dt(this.g,new Dd(p))},$s.prototype.pa=function(p){Dt(this.g,new Id)},$s.prototype.oa=function(){Dt(this.g,"b")},Ri.prototype.createWebChannel=Ri.prototype.g,Fn.prototype.send=Fn.prototype.o,Fn.prototype.open=Fn.prototype.m,Fn.prototype.close=Fn.prototype.close,C1=function(){return new Ri},E1=function(){return jo()},w1=Ht,oy={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},Ia.NO_ERROR=0,Ia.TIMEOUT=8,Ia.HTTP_ERROR=6,Xh=Ia,uc.COMPLETE="complete",S1=uc,cd.EventType=Ur,Ur.OPEN="a",Ur.CLOSE="b",Ur.ERROR="c",Ur.MESSAGE="d",mt.prototype.listen=mt.prototype.J,mu=cd,xt.prototype.listenOnce=xt.prototype.K,xt.prototype.getLastError=xt.prototype.Ha,xt.prototype.getLastErrorCode=xt.prototype.ya,xt.prototype.getStatus=xt.prototype.ca,xt.prototype.getResponseJson=xt.prototype.La,xt.prototype.getResponseText=xt.prototype.la,xt.prototype.send=xt.prototype.ea,xt.prototype.setWithCredentials=xt.prototype.Fa,x1=xt}).apply(typeof Lh<"u"?Lh:typeof self<"u"?self:typeof window<"u"?window:{});const gS="@firebase/firestore",yS="4.9.3";class Pn{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Pn.UNAUTHENTICATED=new Pn(null),Pn.GOOGLE_CREDENTIALS=new Pn("google-credentials-uid"),Pn.FIRST_PARTY=new Pn("first-party-uid"),Pn.MOCK_USER=new Pn("mock-user");let Xl="12.7.0";const yo=new Py("@firebase/firestore");function vl(){return yo.logLevel}function Re(t,...e){if(yo.logLevel<=rt.DEBUG){const n=e.map(Xy);yo.debug(`Firestore (${Xl}): ${t}`,...n)}}function fi(t,...e){if(yo.logLevel<=rt.ERROR){const n=e.map(Xy);yo.error(`Firestore (${Xl}): ${t}`,...n)}}function Ml(t,...e){if(yo.logLevel<=rt.WARN){const n=e.map(Xy);yo.warn(`Firestore (${Xl}): ${t}`,...n)}}function Xy(t){if(typeof t=="string")return t;try{return(function(n){return JSON.stringify(n)})(t)}catch{return t}}function Fe(t,e,n){let r="Unexpected state";typeof e=="string"?r=e:n=e,T1(t,r,n)}function T1(t,e,n){let r=`FIRESTORE (${Xl}) INTERNAL ASSERTION FAILED: ${e} (ID: ${t.toString(16)})`;if(n!==void 0)try{r+=" CONTEXT: "+JSON.stringify(n)}catch{r+=" CONTEXT: "+n}throw fi(r),new Error(r)}function yt(t,e,n,r){let a="Unexpected state";typeof n=="string"?a=n:r=n,t||T1(e,a,r)}function Ge(t,e){return t}const _e={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Te extends yi{constructor(e,n){super(e,n),this.code=e,this.message=n,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class ci{constructor(){this.promise=new Promise(((e,n)=>{this.resolve=e,this.reject=n}))}}class A1{constructor(e,n){this.user=n,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Dk{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,n){e.enqueueRetryable((()=>n(Pn.UNAUTHENTICATED)))}shutdown(){}}class Ik{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,n){this.changeListener=n,e.enqueueRetryable((()=>n(this.token.user)))}shutdown(){this.changeListener=null}}class Mk{constructor(e){this.t=e,this.currentUser=Pn.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,n){yt(this.o===void 0,42304);let r=this.i;const a=f=>this.i!==r?(r=this.i,n(f)):Promise.resolve();let o=new ci;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new ci,e.enqueueRetryable((()=>a(this.currentUser)))};const u=()=>{const f=o;e.enqueueRetryable((async()=>{await f.promise,await a(this.currentUser)}))},h=f=>{Re("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=f,this.o&&(this.auth.addAuthTokenListener(this.o),u())};this.t.onInit((f=>h(f))),setTimeout((()=>{if(!this.auth){const f=this.t.getImmediate({optional:!0});f?h(f):(Re("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new ci)}}),0),u()}getToken(){const e=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then((r=>this.i!==e?(Re("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(yt(typeof r.accessToken=="string",31837,{l:r}),new A1(r.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return yt(e===null||typeof e=="string",2055,{h:e}),new Pn(e)}}class kk{constructor(e,n,r){this.P=e,this.T=n,this.I=r,this.type="FirstParty",this.user=Pn.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class Ok{constructor(e,n,r){this.P=e,this.T=n,this.I=r}getToken(){return Promise.resolve(new kk(this.P,this.T,this.I))}start(e,n){e.enqueueRetryable((()=>n(Pn.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class _S{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Nk{constructor(e,n){this.V=n,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Jr(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,n){yt(this.o===void 0,3512);const r=o=>{o.error!=null&&Re("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${o.error.message}`);const u=o.token!==this.m;return this.m=o.token,Re("FirebaseAppCheckTokenProvider",`Received ${u?"new":"existing"} token.`),u?n(o.token):Promise.resolve()};this.o=o=>{e.enqueueRetryable((()=>r(o)))};const a=o=>{Re("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=o,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((o=>a(o))),setTimeout((()=>{if(!this.appCheck){const o=this.V.getImmediate({optional:!0});o?a(o):Re("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new _S(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((n=>n?(yt(typeof n.token=="string",44558,{tokenResult:n}),this.m=n.token,new _S(n.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function Pk(t){const e=typeof self<"u"&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(n);else for(let r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}class Jy{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const a=Pk(40);for(let o=0;o<a.length;++o)r.length<20&&a[o]<n&&(r+=e.charAt(a[o]%62))}return r}}function st(t,e){return t<e?-1:t>e?1:0}function ly(t,e){const n=Math.min(t.length,e.length);for(let r=0;r<n;r++){const a=t.charAt(r),o=e.charAt(r);if(a!==o)return Mg(a)===Mg(o)?st(a,o):Mg(a)?1:-1}return st(t.length,e.length)}const Bk=55296,Lk=57343;function Mg(t){const e=t.charCodeAt(0);return e>=Bk&&e<=Lk}function kl(t,e,n){return t.length===e.length&&t.every(((r,a)=>n(r,e[a])))}const bS="__name__";class js{constructor(e,n,r){n===void 0?n=0:n>e.length&&Fe(637,{offset:n,range:e.length}),r===void 0?r=e.length-n:r>e.length-n&&Fe(1746,{length:r,range:e.length-n}),this.segments=e,this.offset=n,this.len=r}get length(){return this.len}isEqual(e){return js.comparator(this,e)===0}child(e){const n=this.segments.slice(this.offset,this.limit());return e instanceof js?e.forEach((r=>{n.push(r)})):n.push(e),this.construct(n)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}forEach(e){for(let n=this.offset,r=this.limit();n<r;n++)e(this.segments[n])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,n){const r=Math.min(e.length,n.length);for(let a=0;a<r;a++){const o=js.compareSegments(e.get(a),n.get(a));if(o!==0)return o}return st(e.length,n.length)}static compareSegments(e,n){const r=js.isNumericId(e),a=js.isNumericId(n);return r&&!a?-1:!r&&a?1:r&&a?js.extractNumericId(e).compare(js.extractNumericId(n)):ly(e,n)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return da.fromString(e.substring(4,e.length-2))}}class Rt extends js{construct(e,n,r){return new Rt(e,n,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const n=[];for(const r of e){if(r.indexOf("//")>=0)throw new Te(_e.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);n.push(...r.split("/").filter((a=>a.length>0)))}return new Rt(n)}static emptyPath(){return new Rt([])}}const zk=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Dn extends js{construct(e,n,r){return new Dn(e,n,r)}static isValidIdentifier(e){return zk.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Dn.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===bS}static keyField(){return new Dn([bS])}static fromServerFormat(e){const n=[];let r="",a=0;const o=()=>{if(r.length===0)throw new Te(_e.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);n.push(r),r=""};let u=!1;for(;a<e.length;){const h=e[a];if(h==="\\"){if(a+1===e.length)throw new Te(_e.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const f=e[a+1];if(f!=="\\"&&f!=="."&&f!=="`")throw new Te(_e.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=f,a+=2}else h==="`"?(u=!u,a++):h!=="."||u?(r+=h,a++):(o(),a++)}if(o(),u)throw new Te(_e.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Dn(n)}static emptyPath(){return new Dn([])}}class Pe{constructor(e){this.path=e}static fromPath(e){return new Pe(Rt.fromString(e))}static fromName(e){return new Pe(Rt.fromString(e).popFirst(5))}static empty(){return new Pe(Rt.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Rt.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,n){return Rt.comparator(e.path,n.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Pe(new Rt(e.slice()))}}function j1(t,e,n){if(!n)throw new Te(_e.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function Uk(t,e,n,r){if(e===!0&&r===!0)throw new Te(_e.INVALID_ARGUMENT,`${t} and ${n} cannot be used together.`)}function vS(t){if(!Pe.isDocumentKey(t))throw new Te(_e.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function xS(t){if(Pe.isDocumentKey(t))throw new Te(_e.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function R1(t){return typeof t=="object"&&t!==null&&(Object.getPrototypeOf(t)===Object.prototype||Object.getPrototypeOf(t)===null)}function Gf(t){if(t===void 0)return"undefined";if(t===null)return"null";if(typeof t=="string")return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if(typeof t=="number"||typeof t=="boolean")return""+t;if(typeof t=="object"){if(t instanceof Array)return"an array";{const e=(function(r){return r.constructor?r.constructor.name:null})(t);return e?`a custom ${e} object`:"an object"}}return typeof t=="function"?"a function":Fe(12329,{type:typeof t})}function rs(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new Te(_e.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=Gf(t);throw new Te(_e.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}function cn(t,e){const n={typeString:t};return e&&(n.value=e),n}function Wu(t,e){if(!R1(t))throw new Te(_e.INVALID_ARGUMENT,"JSON must be an object");let n;for(const r in e)if(e[r]){const a=e[r].typeString,o="value"in e[r]?{value:e[r].value}:void 0;if(!(r in t)){n=`JSON missing required field: '${r}'`;break}const u=t[r];if(a&&typeof u!==a){n=`JSON field '${r}' must be a ${a}.`;break}if(o!==void 0&&u!==o.value){n=`Expected '${r}' field to equal '${o.value}'`;break}}if(n)throw new Te(_e.INVALID_ARGUMENT,n);return!0}const SS=-62135596800,wS=1e6;class kt{static now(){return kt.fromMillis(Date.now())}static fromDate(e){return kt.fromMillis(e.getTime())}static fromMillis(e){const n=Math.floor(e/1e3),r=Math.floor((e-1e3*n)*wS);return new kt(n,r)}constructor(e,n){if(this.seconds=e,this.nanoseconds=n,n<0)throw new Te(_e.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new Te(_e.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(e<SS)throw new Te(_e.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Te(_e.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/wS}_compareTo(e){return this.seconds===e.seconds?st(this.nanoseconds,e.nanoseconds):st(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:kt._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(Wu(e,kt._jsonSchema))return new kt(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-SS;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}kt._jsonSchemaVersion="firestore/timestamp/1.0",kt._jsonSchema={type:cn("string",kt._jsonSchemaVersion),seconds:cn("number"),nanoseconds:cn("number")};class qe{static fromTimestamp(e){return new qe(e)}static min(){return new qe(new kt(0,0))}static max(){return new qe(new kt(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const Ru=-1;function Fk(t,e){const n=t.toTimestamp().seconds,r=t.toTimestamp().nanoseconds+1,a=qe.fromTimestamp(r===1e9?new kt(n+1,0):new kt(n,r));return new ma(a,Pe.empty(),e)}function Vk(t){return new ma(t.readTime,t.key,Ru)}class ma{constructor(e,n,r){this.readTime=e,this.documentKey=n,this.largestBatchId=r}static min(){return new ma(qe.min(),Pe.empty(),Ru)}static max(){return new ma(qe.max(),Pe.empty(),Ru)}}function $k(t,e){let n=t.readTime.compareTo(e.readTime);return n!==0?n:(n=Pe.comparator(t.documentKey,e.documentKey),n!==0?n:st(t.largestBatchId,e.largestBatchId))}const qk="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Hk{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function Jl(t){if(t.code!==_e.FAILED_PRECONDITION||t.message!==qk)throw t;Re("LocalStore","Unexpectedly lost primary lease")}class ve{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((n=>{this.isDone=!0,this.result=n,this.nextCallback&&this.nextCallback(n)}),(n=>{this.isDone=!0,this.error=n,this.catchCallback&&this.catchCallback(n)}))}catch(e){return this.next(void 0,e)}next(e,n){return this.callbackAttached&&Fe(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new ve(((r,a)=>{this.nextCallback=o=>{this.wrapSuccess(e,o).next(r,a)},this.catchCallback=o=>{this.wrapFailure(n,o).next(r,a)}}))}toPromise(){return new Promise(((e,n)=>{this.next(e,n)}))}wrapUserFunction(e){try{const n=e();return n instanceof ve?n:ve.resolve(n)}catch(n){return ve.reject(n)}}wrapSuccess(e,n){return e?this.wrapUserFunction((()=>e(n))):ve.resolve(n)}wrapFailure(e,n){return e?this.wrapUserFunction((()=>e(n))):ve.reject(n)}static resolve(e){return new ve(((n,r)=>{n(e)}))}static reject(e){return new ve(((n,r)=>{r(e)}))}static waitFor(e){return new ve(((n,r)=>{let a=0,o=0,u=!1;e.forEach((h=>{++a,h.next((()=>{++o,u&&o===a&&n()}),(f=>r(f)))})),u=!0,o===a&&n()}))}static or(e){let n=ve.resolve(!1);for(const r of e)n=n.next((a=>a?ve.resolve(a):r()));return n}static forEach(e,n){const r=[];return e.forEach(((a,o)=>{r.push(n.call(this,a,o))})),this.waitFor(r)}static mapArray(e,n){return new ve(((r,a)=>{const o=e.length,u=new Array(o);let h=0;for(let f=0;f<o;f++){const m=f;n(e[m]).next((g=>{u[m]=g,++h,h===o&&r(u)}),(g=>a(g)))}}))}static doWhile(e,n){return new ve(((r,a)=>{const o=()=>{e()===!0?n().next((()=>{o()}),a):r()};o()}))}}function Gk(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}function Zl(t){return t.name==="IndexedDbTransactionError"}class Qf{constructor(e,n){this.previousValue=e,n&&(n.sequenceNumberHandler=r=>this.ae(r),this.ue=r=>n.writeSequenceNumber(r))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}Qf.ce=-1;const Zy=-1;function Wf(t){return t==null}function yf(t){return t===0&&1/t==-1/0}function Qk(t){return typeof t=="number"&&Number.isInteger(t)&&!yf(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}const D1="";function Wk(t){let e="";for(let n=0;n<t.length;n++)e.length>0&&(e=ES(e)),e=Kk(t.get(n),e);return ES(e)}function Kk(t,e){let n=e;const r=t.length;for(let a=0;a<r;a++){const o=t.charAt(a);switch(o){case"\0":n+="";break;case D1:n+="";break;default:n+=o}}return n}function ES(t){return t+D1+""}function CS(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Ea(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function I1(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}class Vt{constructor(e,n){this.comparator=e,this.root=n||Rn.EMPTY}insert(e,n){return new Vt(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,Rn.BLACK,null,null))}remove(e){return new Vt(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Rn.BLACK,null,null))}get(e){let n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(r===0)return n.value;r<0?n=n.left:r>0&&(n=n.right)}return null}indexOf(e){let n=0,r=this.root;for(;!r.isEmpty();){const a=this.comparator(e,r.key);if(a===0)return n+r.left.size;a<0?r=r.left:(n+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((n,r)=>(e(n,r),!1)))}toString(){const e=[];return this.inorderTraversal(((n,r)=>(e.push(`${n}:${r}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new zh(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new zh(this.root,e,this.comparator,!1)}getReverseIterator(){return new zh(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new zh(this.root,e,this.comparator,!0)}}class zh{constructor(e,n,r,a){this.isReverse=a,this.nodeStack=[];let o=1;for(;!e.isEmpty();)if(o=n?r(e.key,n):1,n&&a&&(o*=-1),o<0)e=this.isReverse?e.left:e.right;else{if(o===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const n={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return n}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Rn{constructor(e,n,r,a,o){this.key=e,this.value=n,this.color=r??Rn.RED,this.left=a??Rn.EMPTY,this.right=o??Rn.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,n,r,a,o){return new Rn(e??this.key,n??this.value,r??this.color,a??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,r){let a=this;const o=r(e,a.key);return a=o<0?a.copy(null,null,null,a.left.insert(e,n,r),null):o===0?a.copy(null,n,null,null,null):a.copy(null,null,null,null,a.right.insert(e,n,r)),a.fixUp()}removeMin(){if(this.left.isEmpty())return Rn.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,n){let r,a=this;if(n(e,a.key)<0)a.left.isEmpty()||a.left.isRed()||a.left.left.isRed()||(a=a.moveRedLeft()),a=a.copy(null,null,null,a.left.remove(e,n),null);else{if(a.left.isRed()&&(a=a.rotateRight()),a.right.isEmpty()||a.right.isRed()||a.right.left.isRed()||(a=a.moveRedRight()),n(e,a.key)===0){if(a.right.isEmpty())return Rn.EMPTY;r=a.right.min(),a=a.copy(r.key,r.value,null,null,a.right.removeMin())}a=a.copy(null,null,null,null,a.right.remove(e,n))}return a.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Rn.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Rn.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Fe(43730,{key:this.key,value:this.value});if(this.right.isRed())throw Fe(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw Fe(27949);return e+(this.isRed()?0:1)}}Rn.EMPTY=null,Rn.RED=!0,Rn.BLACK=!1;Rn.EMPTY=new class{constructor(){this.size=0}get key(){throw Fe(57766)}get value(){throw Fe(16141)}get color(){throw Fe(16727)}get left(){throw Fe(29726)}get right(){throw Fe(36894)}copy(e,n,r,a,o){return this}insert(e,n,r){return new Rn(e,n)}remove(e,n){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class gn{constructor(e){this.comparator=e,this.data=new Vt(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((n,r)=>(e(n),!1)))}forEachInRange(e,n){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const a=r.getNext();if(this.comparator(a.key,e[1])>=0)return;n(a.key)}}forEachWhile(e,n){let r;for(r=n!==void 0?this.data.getIteratorFrom(n):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const n=this.data.getIteratorFrom(e);return n.hasNext()?n.getNext().key:null}getIterator(){return new TS(this.data.getIterator())}getIteratorFrom(e){return new TS(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let n=this;return n.size<e.size&&(n=e,e=this),e.forEach((r=>{n=n.add(r)})),n}isEqual(e){if(!(e instanceof gn)||this.size!==e.size)return!1;const n=this.data.getIterator(),r=e.data.getIterator();for(;n.hasNext();){const a=n.getNext().key,o=r.getNext().key;if(this.comparator(a,o)!==0)return!1}return!0}toArray(){const e=[];return this.forEach((n=>{e.push(n)})),e}toString(){const e=[];return this.forEach((n=>e.push(n))),"SortedSet("+e.toString()+")"}copy(e){const n=new gn(this.comparator);return n.data=e,n}}class TS{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class pr{constructor(e){this.fields=e,e.sort(Dn.comparator)}static empty(){return new pr([])}unionWith(e){let n=new gn(Dn.comparator);for(const r of this.fields)n=n.add(r);for(const r of e)n=n.add(r);return new pr(n.toArray())}covers(e){for(const n of this.fields)if(n.isPrefixOf(e))return!0;return!1}isEqual(e){return kl(this.fields,e.fields,((n,r)=>n.isEqual(r)))}}class M1 extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Mn{constructor(e){this.binaryString=e}static fromBase64String(e){const n=(function(a){try{return atob(a)}catch(o){throw typeof DOMException<"u"&&o instanceof DOMException?new M1("Invalid base64 string: "+o):o}})(e);return new Mn(n)}static fromUint8Array(e){const n=(function(a){let o="";for(let u=0;u<a.length;++u)o+=String.fromCharCode(a[u]);return o})(e);return new Mn(n)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(n){return btoa(n)})(this.binaryString)}toUint8Array(){return(function(n){const r=new Uint8Array(n.length);for(let a=0;a<n.length;a++)r[a]=n.charCodeAt(a);return r})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return st(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Mn.EMPTY_BYTE_STRING=new Mn("");const Yk=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function pa(t){if(yt(!!t,39018),typeof t=="string"){let e=0;const n=Yk.exec(t);if(yt(!!n,46558,{timestamp:t}),n[1]){let a=n[1];a=(a+"000000000").substr(0,9),e=Number(a)}const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:Kt(t.seconds),nanos:Kt(t.nanos)}}function Kt(t){return typeof t=="number"?t:typeof t=="string"?Number(t):0}function ga(t){return typeof t=="string"?Mn.fromBase64String(t):Mn.fromUint8Array(t)}const k1="server_timestamp",O1="__type__",N1="__previous_value__",P1="__local_write_time__";function e0(t){return(t?.mapValue?.fields||{})[O1]?.stringValue===k1}function Kf(t){const e=t.mapValue.fields[N1];return e0(e)?Kf(e):e}function Du(t){const e=pa(t.mapValue.fields[P1].timestampValue);return new kt(e.seconds,e.nanos)}class Xk{constructor(e,n,r,a,o,u,h,f,m,g){this.databaseId=e,this.appId=n,this.persistenceKey=r,this.host=a,this.ssl=o,this.forceLongPolling=u,this.autoDetectLongPolling=h,this.longPollingOptions=f,this.useFetchStreams=m,this.isUsingEmulator=g}}const _f="(default)";class Iu{constructor(e,n){this.projectId=e,this.database=n||_f}static empty(){return new Iu("","")}get isDefaultDatabase(){return this.database===_f}isEqual(e){return e instanceof Iu&&e.projectId===this.projectId&&e.database===this.database}}const B1="__type__",Jk="__max__",Uh={mapValue:{}},L1="__vector__",bf="value";function ya(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?e0(t)?4:eO(t)?9007199254740991:Zk(t)?10:11:Fe(28295,{value:t})}function Ps(t,e){if(t===e)return!0;const n=ya(t);if(n!==ya(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Du(t).isEqual(Du(e));case 3:return(function(a,o){if(typeof a.timestampValue=="string"&&typeof o.timestampValue=="string"&&a.timestampValue.length===o.timestampValue.length)return a.timestampValue===o.timestampValue;const u=pa(a.timestampValue),h=pa(o.timestampValue);return u.seconds===h.seconds&&u.nanos===h.nanos})(t,e);case 5:return t.stringValue===e.stringValue;case 6:return(function(a,o){return ga(a.bytesValue).isEqual(ga(o.bytesValue))})(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return(function(a,o){return Kt(a.geoPointValue.latitude)===Kt(o.geoPointValue.latitude)&&Kt(a.geoPointValue.longitude)===Kt(o.geoPointValue.longitude)})(t,e);case 2:return(function(a,o){if("integerValue"in a&&"integerValue"in o)return Kt(a.integerValue)===Kt(o.integerValue);if("doubleValue"in a&&"doubleValue"in o){const u=Kt(a.doubleValue),h=Kt(o.doubleValue);return u===h?yf(u)===yf(h):isNaN(u)&&isNaN(h)}return!1})(t,e);case 9:return kl(t.arrayValue.values||[],e.arrayValue.values||[],Ps);case 10:case 11:return(function(a,o){const u=a.mapValue.fields||{},h=o.mapValue.fields||{};if(CS(u)!==CS(h))return!1;for(const f in u)if(u.hasOwnProperty(f)&&(h[f]===void 0||!Ps(u[f],h[f])))return!1;return!0})(t,e);default:return Fe(52216,{left:t})}}function Mu(t,e){return(t.values||[]).find((n=>Ps(n,e)))!==void 0}function Ol(t,e){if(t===e)return 0;const n=ya(t),r=ya(e);if(n!==r)return st(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return st(t.booleanValue,e.booleanValue);case 2:return(function(o,u){const h=Kt(o.integerValue||o.doubleValue),f=Kt(u.integerValue||u.doubleValue);return h<f?-1:h>f?1:h===f?0:isNaN(h)?isNaN(f)?0:-1:1})(t,e);case 3:return AS(t.timestampValue,e.timestampValue);case 4:return AS(Du(t),Du(e));case 5:return ly(t.stringValue,e.stringValue);case 6:return(function(o,u){const h=ga(o),f=ga(u);return h.compareTo(f)})(t.bytesValue,e.bytesValue);case 7:return(function(o,u){const h=o.split("/"),f=u.split("/");for(let m=0;m<h.length&&m<f.length;m++){const g=st(h[m],f[m]);if(g!==0)return g}return st(h.length,f.length)})(t.referenceValue,e.referenceValue);case 8:return(function(o,u){const h=st(Kt(o.latitude),Kt(u.latitude));return h!==0?h:st(Kt(o.longitude),Kt(u.longitude))})(t.geoPointValue,e.geoPointValue);case 9:return jS(t.arrayValue,e.arrayValue);case 10:return(function(o,u){const h=o.fields||{},f=u.fields||{},m=h[bf]?.arrayValue,g=f[bf]?.arrayValue,_=st(m?.values?.length||0,g?.values?.length||0);return _!==0?_:jS(m,g)})(t.mapValue,e.mapValue);case 11:return(function(o,u){if(o===Uh.mapValue&&u===Uh.mapValue)return 0;if(o===Uh.mapValue)return 1;if(u===Uh.mapValue)return-1;const h=o.fields||{},f=Object.keys(h),m=u.fields||{},g=Object.keys(m);f.sort(),g.sort();for(let _=0;_<f.length&&_<g.length;++_){const v=ly(f[_],g[_]);if(v!==0)return v;const S=Ol(h[f[_]],m[g[_]]);if(S!==0)return S}return st(f.length,g.length)})(t.mapValue,e.mapValue);default:throw Fe(23264,{he:n})}}function AS(t,e){if(typeof t=="string"&&typeof e=="string"&&t.length===e.length)return st(t,e);const n=pa(t),r=pa(e),a=st(n.seconds,r.seconds);return a!==0?a:st(n.nanos,r.nanos)}function jS(t,e){const n=t.values||[],r=e.values||[];for(let a=0;a<n.length&&a<r.length;++a){const o=Ol(n[a],r[a]);if(o)return o}return st(n.length,r.length)}function Nl(t){return cy(t)}function cy(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?(function(n){const r=pa(n);return`time(${r.seconds},${r.nanos})`})(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?(function(n){return ga(n).toBase64()})(t.bytesValue):"referenceValue"in t?(function(n){return Pe.fromName(n).toString()})(t.referenceValue):"geoPointValue"in t?(function(n){return`geo(${n.latitude},${n.longitude})`})(t.geoPointValue):"arrayValue"in t?(function(n){let r="[",a=!0;for(const o of n.values||[])a?a=!1:r+=",",r+=cy(o);return r+"]"})(t.arrayValue):"mapValue"in t?(function(n){const r=Object.keys(n.fields||{}).sort();let a="{",o=!0;for(const u of r)o?o=!1:a+=",",a+=`${u}:${cy(n.fields[u])}`;return a+"}"})(t.mapValue):Fe(61005,{value:t})}function Jh(t){switch(ya(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=Kf(t);return e?16+Jh(e):16;case 5:return 2*t.stringValue.length;case 6:return ga(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return(function(r){return(r.values||[]).reduce(((a,o)=>a+Jh(o)),0)})(t.arrayValue);case 10:case 11:return(function(r){let a=0;return Ea(r.fields,((o,u)=>{a+=o.length+Jh(u)})),a})(t.mapValue);default:throw Fe(13486,{value:t})}}function RS(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function uy(t){return!!t&&"integerValue"in t}function t0(t){return!!t&&"arrayValue"in t}function DS(t){return!!t&&"nullValue"in t}function IS(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Zh(t){return!!t&&"mapValue"in t}function Zk(t){return(t?.mapValue?.fields||{})[B1]?.stringValue===L1}function vu(t){if(t.geoPointValue)return{geoPointValue:{...t.geoPointValue}};if(t.timestampValue&&typeof t.timestampValue=="object")return{timestampValue:{...t.timestampValue}};if(t.mapValue){const e={mapValue:{fields:{}}};return Ea(t.mapValue.fields,((n,r)=>e.mapValue.fields[n]=vu(r))),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=vu(t.arrayValue.values[n]);return e}return{...t}}function eO(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue===Jk}class nr{constructor(e){this.value=e}static empty(){return new nr({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let n=this.value;for(let r=0;r<e.length-1;++r)if(n=(n.mapValue.fields||{})[e.get(r)],!Zh(n))return null;return n=(n.mapValue.fields||{})[e.lastSegment()],n||null}}set(e,n){this.getFieldsMap(e.popLast())[e.lastSegment()]=vu(n)}setAll(e){let n=Dn.emptyPath(),r={},a=[];e.forEach(((u,h)=>{if(!n.isImmediateParentOf(h)){const f=this.getFieldsMap(n);this.applyChanges(f,r,a),r={},a=[],n=h.popLast()}u?r[h.lastSegment()]=vu(u):a.push(h.lastSegment())}));const o=this.getFieldsMap(n);this.applyChanges(o,r,a)}delete(e){const n=this.field(e.popLast());Zh(n)&&n.mapValue.fields&&delete n.mapValue.fields[e.lastSegment()]}isEqual(e){return Ps(this.value,e.value)}getFieldsMap(e){let n=this.value;n.mapValue.fields||(n.mapValue={fields:{}});for(let r=0;r<e.length;++r){let a=n.mapValue.fields[e.get(r)];Zh(a)&&a.mapValue.fields||(a={mapValue:{fields:{}}},n.mapValue.fields[e.get(r)]=a),n=a}return n.mapValue.fields}applyChanges(e,n,r){Ea(n,((a,o)=>e[a]=o));for(const a of r)delete e[a]}clone(){return new nr(vu(this.value))}}function z1(t){const e=[];return Ea(t.fields,((n,r)=>{const a=new Dn([n]);if(Zh(r)){const o=z1(r.mapValue).fields;if(o.length===0)e.push(a);else for(const u of o)e.push(a.child(u))}else e.push(a)})),new pr(e)}class Bn{constructor(e,n,r,a,o,u,h){this.key=e,this.documentType=n,this.version=r,this.readTime=a,this.createTime=o,this.data=u,this.documentState=h}static newInvalidDocument(e){return new Bn(e,0,qe.min(),qe.min(),qe.min(),nr.empty(),0)}static newFoundDocument(e,n,r,a){return new Bn(e,1,n,qe.min(),r,a,0)}static newNoDocument(e,n){return new Bn(e,2,n,qe.min(),qe.min(),nr.empty(),0)}static newUnknownDocument(e,n){return new Bn(e,3,n,qe.min(),qe.min(),nr.empty(),2)}convertToFoundDocument(e,n){return!this.createTime.isEqual(qe.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=n,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=nr.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=nr.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=qe.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Bn&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Bn(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class vf{constructor(e,n){this.position=e,this.inclusive=n}}function MS(t,e,n){let r=0;for(let a=0;a<t.position.length;a++){const o=e[a],u=t.position[a];if(o.field.isKeyField()?r=Pe.comparator(Pe.fromName(u.referenceValue),n.key):r=Ol(u,n.data.field(o.field)),o.dir==="desc"&&(r*=-1),r!==0)break}return r}function kS(t,e){if(t===null)return e===null;if(e===null||t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!Ps(t.position[n],e.position[n]))return!1;return!0}class xf{constructor(e,n="asc"){this.field=e,this.dir=n}}function tO(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}class U1{}class ln extends U1{constructor(e,n,r){super(),this.field=e,this.op=n,this.value=r}static create(e,n,r){return e.isKeyField()?n==="in"||n==="not-in"?this.createKeyFieldInFilter(e,n,r):new rO(e,n,r):n==="array-contains"?new aO(e,r):n==="in"?new oO(e,r):n==="not-in"?new lO(e,r):n==="array-contains-any"?new cO(e,r):new ln(e,n,r)}static createKeyFieldInFilter(e,n,r){return n==="in"?new sO(e,r):new iO(e,r)}matches(e){const n=e.data.field(this.field);return this.op==="!="?n!==null&&n.nullValue===void 0&&this.matchesComparison(Ol(n,this.value)):n!==null&&ya(this.value)===ya(n)&&this.matchesComparison(Ol(n,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Fe(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class ss extends U1{constructor(e,n){super(),this.filters=e,this.op=n,this.Pe=null}static create(e,n){return new ss(e,n)}matches(e){return F1(this)?this.filters.find((n=>!n.matches(e)))===void 0:this.filters.find((n=>n.matches(e)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((e,n)=>e.concat(n.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function F1(t){return t.op==="and"}function V1(t){return nO(t)&&F1(t)}function nO(t){for(const e of t.filters)if(e instanceof ss)return!1;return!0}function dy(t){if(t instanceof ln)return t.field.canonicalString()+t.op.toString()+Nl(t.value);if(V1(t))return t.filters.map((e=>dy(e))).join(",");{const e=t.filters.map((n=>dy(n))).join(",");return`${t.op}(${e})`}}function $1(t,e){return t instanceof ln?(function(r,a){return a instanceof ln&&r.op===a.op&&r.field.isEqual(a.field)&&Ps(r.value,a.value)})(t,e):t instanceof ss?(function(r,a){return a instanceof ss&&r.op===a.op&&r.filters.length===a.filters.length?r.filters.reduce(((o,u,h)=>o&&$1(u,a.filters[h])),!0):!1})(t,e):void Fe(19439)}function q1(t){return t instanceof ln?(function(n){return`${n.field.canonicalString()} ${n.op} ${Nl(n.value)}`})(t):t instanceof ss?(function(n){return n.op.toString()+" {"+n.getFilters().map(q1).join(" ,")+"}"})(t):"Filter"}class rO extends ln{constructor(e,n,r){super(e,n,r),this.key=Pe.fromName(r.referenceValue)}matches(e){const n=Pe.comparator(e.key,this.key);return this.matchesComparison(n)}}class sO extends ln{constructor(e,n){super(e,"in",n),this.keys=H1("in",n)}matches(e){return this.keys.some((n=>n.isEqual(e.key)))}}class iO extends ln{constructor(e,n){super(e,"not-in",n),this.keys=H1("not-in",n)}matches(e){return!this.keys.some((n=>n.isEqual(e.key)))}}function H1(t,e){return(e.arrayValue?.values||[]).map((n=>Pe.fromName(n.referenceValue)))}class aO extends ln{constructor(e,n){super(e,"array-contains",n)}matches(e){const n=e.data.field(this.field);return t0(n)&&Mu(n.arrayValue,this.value)}}class oO extends ln{constructor(e,n){super(e,"in",n)}matches(e){const n=e.data.field(this.field);return n!==null&&Mu(this.value.arrayValue,n)}}class lO extends ln{constructor(e,n){super(e,"not-in",n)}matches(e){if(Mu(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const n=e.data.field(this.field);return n!==null&&n.nullValue===void 0&&!Mu(this.value.arrayValue,n)}}class cO extends ln{constructor(e,n){super(e,"array-contains-any",n)}matches(e){const n=e.data.field(this.field);return!(!t0(n)||!n.arrayValue.values)&&n.arrayValue.values.some((r=>Mu(this.value.arrayValue,r)))}}class uO{constructor(e,n=null,r=[],a=[],o=null,u=null,h=null){this.path=e,this.collectionGroup=n,this.orderBy=r,this.filters=a,this.limit=o,this.startAt=u,this.endAt=h,this.Te=null}}function OS(t,e=null,n=[],r=[],a=null,o=null,u=null){return new uO(t,e,n,r,a,o,u)}function n0(t){const e=Ge(t);if(e.Te===null){let n=e.path.canonicalString();e.collectionGroup!==null&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map((r=>dy(r))).join(","),n+="|ob:",n+=e.orderBy.map((r=>(function(o){return o.field.canonicalString()+o.dir})(r))).join(","),Wf(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map((r=>Nl(r))).join(",")),e.endAt&&(n+="|ub:",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map((r=>Nl(r))).join(",")),e.Te=n}return e.Te}function r0(t,e){if(t.limit!==e.limit||t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!tO(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!$1(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!kS(t.startAt,e.startAt)&&kS(t.endAt,e.endAt)}function hy(t){return Pe.isDocumentKey(t.path)&&t.collectionGroup===null&&t.filters.length===0}class Ku{constructor(e,n=null,r=[],a=[],o=null,u="F",h=null,f=null){this.path=e,this.collectionGroup=n,this.explicitOrderBy=r,this.filters=a,this.limit=o,this.limitType=u,this.startAt=h,this.endAt=f,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function dO(t,e,n,r,a,o,u,h){return new Ku(t,e,n,r,a,o,u,h)}function s0(t){return new Ku(t)}function NS(t){return t.filters.length===0&&t.limit===null&&t.startAt==null&&t.endAt==null&&(t.explicitOrderBy.length===0||t.explicitOrderBy.length===1&&t.explicitOrderBy[0].field.isKeyField())}function G1(t){return t.collectionGroup!==null}function xu(t){const e=Ge(t);if(e.Ie===null){e.Ie=[];const n=new Set;for(const o of e.explicitOrderBy)e.Ie.push(o),n.add(o.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(u){let h=new gn(Dn.comparator);return u.filters.forEach((f=>{f.getFlattenedFilters().forEach((m=>{m.isInequality()&&(h=h.add(m.field))}))})),h})(e).forEach((o=>{n.has(o.canonicalString())||o.isKeyField()||e.Ie.push(new xf(o,r))})),n.has(Dn.keyField().canonicalString())||e.Ie.push(new xf(Dn.keyField(),r))}return e.Ie}function Ms(t){const e=Ge(t);return e.Ee||(e.Ee=hO(e,xu(t))),e.Ee}function hO(t,e){if(t.limitType==="F")return OS(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map((a=>{const o=a.dir==="desc"?"asc":"desc";return new xf(a.field,o)}));const n=t.endAt?new vf(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new vf(t.startAt.position,t.startAt.inclusive):null;return OS(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}}function fy(t,e){const n=t.filters.concat([e]);return new Ku(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}function my(t,e,n){return new Ku(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Yf(t,e){return r0(Ms(t),Ms(e))&&t.limitType===e.limitType}function Q1(t){return`${n0(Ms(t))}|lt:${t.limitType}`}function xl(t){return`Query(target=${(function(n){let r=n.path.canonicalString();return n.collectionGroup!==null&&(r+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(r+=`, filters: [${n.filters.map((a=>q1(a))).join(", ")}]`),Wf(n.limit)||(r+=", limit: "+n.limit),n.orderBy.length>0&&(r+=`, orderBy: [${n.orderBy.map((a=>(function(u){return`${u.field.canonicalString()} (${u.dir})`})(a))).join(", ")}]`),n.startAt&&(r+=", startAt: ",r+=n.startAt.inclusive?"b:":"a:",r+=n.startAt.position.map((a=>Nl(a))).join(",")),n.endAt&&(r+=", endAt: ",r+=n.endAt.inclusive?"a:":"b:",r+=n.endAt.position.map((a=>Nl(a))).join(",")),`Target(${r})`})(Ms(t))}; limitType=${t.limitType})`}function Xf(t,e){return e.isFoundDocument()&&(function(r,a){const o=a.key.path;return r.collectionGroup!==null?a.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(o):Pe.isDocumentKey(r.path)?r.path.isEqual(o):r.path.isImmediateParentOf(o)})(t,e)&&(function(r,a){for(const o of xu(r))if(!o.field.isKeyField()&&a.data.field(o.field)===null)return!1;return!0})(t,e)&&(function(r,a){for(const o of r.filters)if(!o.matches(a))return!1;return!0})(t,e)&&(function(r,a){return!(r.startAt&&!(function(u,h,f){const m=MS(u,h,f);return u.inclusive?m<=0:m<0})(r.startAt,xu(r),a)||r.endAt&&!(function(u,h,f){const m=MS(u,h,f);return u.inclusive?m>=0:m>0})(r.endAt,xu(r),a))})(t,e)}function fO(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function W1(t){return(e,n)=>{let r=!1;for(const a of xu(t)){const o=mO(a,e,n);if(o!==0)return o;r=r||a.field.isKeyField()}return 0}}function mO(t,e,n){const r=t.field.isKeyField()?Pe.comparator(e.key,n.key):(function(o,u,h){const f=u.data.field(o),m=h.data.field(o);return f!==null&&m!==null?Ol(f,m):Fe(42886)})(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return Fe(19790,{direction:t.dir})}}class So{constructor(e,n){this.mapKeyFn=e,this.equalsFn=n,this.inner={},this.innerSize=0}get(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r!==void 0){for(const[a,o]of r)if(this.equalsFn(a,e))return o}}has(e){return this.get(e)!==void 0}set(e,n){const r=this.mapKeyFn(e),a=this.inner[r];if(a===void 0)return this.inner[r]=[[e,n]],void this.innerSize++;for(let o=0;o<a.length;o++)if(this.equalsFn(a[o][0],e))return void(a[o]=[e,n]);a.push([e,n]),this.innerSize++}delete(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r===void 0)return!1;for(let a=0;a<r.length;a++)if(this.equalsFn(r[a][0],e))return r.length===1?delete this.inner[n]:r.splice(a,1),this.innerSize--,!0;return!1}forEach(e){Ea(this.inner,((n,r)=>{for(const[a,o]of r)e(a,o)}))}isEmpty(){return I1(this.inner)}size(){return this.innerSize}}const pO=new Vt(Pe.comparator);function mi(){return pO}const K1=new Vt(Pe.comparator);function pu(...t){let e=K1;for(const n of t)e=e.insert(n.key,n);return e}function Y1(t){let e=K1;return t.forEach(((n,r)=>e=e.insert(n,r.overlayedDocument))),e}function lo(){return Su()}function X1(){return Su()}function Su(){return new So((t=>t.toString()),((t,e)=>t.isEqual(e)))}const gO=new Vt(Pe.comparator),yO=new gn(Pe.comparator);function it(...t){let e=yO;for(const n of t)e=e.add(n);return e}const _O=new gn(st);function bO(){return _O}function i0(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:yf(e)?"-0":e}}function J1(t){return{integerValue:""+t}}function vO(t,e){return Qk(e)?J1(e):i0(t,e)}class Jf{constructor(){this._=void 0}}function xO(t,e,n){return t instanceof Sf?(function(a,o){const u={fields:{[O1]:{stringValue:k1},[P1]:{timestampValue:{seconds:a.seconds,nanos:a.nanoseconds}}}};return o&&e0(o)&&(o=Kf(o)),o&&(u.fields[N1]=o),{mapValue:u}})(n,e):t instanceof Pl?eC(t,e):t instanceof ku?tC(t,e):(function(a,o){const u=Z1(a,o),h=PS(u)+PS(a.Ae);return uy(u)&&uy(a.Ae)?J1(h):i0(a.serializer,h)})(t,e)}function SO(t,e,n){return t instanceof Pl?eC(t,e):t instanceof ku?tC(t,e):n}function Z1(t,e){return t instanceof wf?(function(r){return uy(r)||(function(o){return!!o&&"doubleValue"in o})(r)})(e)?e:{integerValue:0}:null}class Sf extends Jf{}class Pl extends Jf{constructor(e){super(),this.elements=e}}function eC(t,e){const n=nC(e);for(const r of t.elements)n.some((a=>Ps(a,r)))||n.push(r);return{arrayValue:{values:n}}}class ku extends Jf{constructor(e){super(),this.elements=e}}function tC(t,e){let n=nC(e);for(const r of t.elements)n=n.filter((a=>!Ps(a,r)));return{arrayValue:{values:n}}}class wf extends Jf{constructor(e,n){super(),this.serializer=e,this.Ae=n}}function PS(t){return Kt(t.integerValue||t.doubleValue)}function nC(t){return t0(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}class wO{constructor(e,n){this.field=e,this.transform=n}}function EO(t,e){return t.field.isEqual(e.field)&&(function(r,a){return r instanceof Pl&&a instanceof Pl||r instanceof ku&&a instanceof ku?kl(r.elements,a.elements,Ps):r instanceof wf&&a instanceof wf?Ps(r.Ae,a.Ae):r instanceof Sf&&a instanceof Sf})(t.transform,e.transform)}class CO{constructor(e,n){this.version=e,this.transformResults=n}}class rr{constructor(e,n){this.updateTime=e,this.exists=n}static none(){return new rr}static exists(e){return new rr(void 0,e)}static updateTime(e){return new rr(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function ef(t,e){return t.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(t.updateTime):t.exists===void 0||t.exists===e.isFoundDocument()}class Zf{}function rC(t,e){if(!t.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return t.isNoDocument()?new em(t.key,rr.none()):new Yu(t.key,t.data,rr.none());{const n=t.data,r=nr.empty();let a=new gn(Dn.comparator);for(let o of e.fields)if(!a.has(o)){let u=n.field(o);u===null&&o.length>1&&(o=o.popLast(),u=n.field(o)),u===null?r.delete(o):r.set(o,u),a=a.add(o)}return new Ca(t.key,r,new pr(a.toArray()),rr.none())}}function TO(t,e,n){t instanceof Yu?(function(a,o,u){const h=a.value.clone(),f=LS(a.fieldTransforms,o,u.transformResults);h.setAll(f),o.convertToFoundDocument(u.version,h).setHasCommittedMutations()})(t,e,n):t instanceof Ca?(function(a,o,u){if(!ef(a.precondition,o))return void o.convertToUnknownDocument(u.version);const h=LS(a.fieldTransforms,o,u.transformResults),f=o.data;f.setAll(sC(a)),f.setAll(h),o.convertToFoundDocument(u.version,f).setHasCommittedMutations()})(t,e,n):(function(a,o,u){o.convertToNoDocument(u.version).setHasCommittedMutations()})(0,e,n)}function wu(t,e,n,r){return t instanceof Yu?(function(o,u,h,f){if(!ef(o.precondition,u))return h;const m=o.value.clone(),g=zS(o.fieldTransforms,f,u);return m.setAll(g),u.convertToFoundDocument(u.version,m).setHasLocalMutations(),null})(t,e,n,r):t instanceof Ca?(function(o,u,h,f){if(!ef(o.precondition,u))return h;const m=zS(o.fieldTransforms,f,u),g=u.data;return g.setAll(sC(o)),g.setAll(m),u.convertToFoundDocument(u.version,g).setHasLocalMutations(),h===null?null:h.unionWith(o.fieldMask.fields).unionWith(o.fieldTransforms.map((_=>_.field)))})(t,e,n,r):(function(o,u,h){return ef(o.precondition,u)?(u.convertToNoDocument(u.version).setHasLocalMutations(),null):h})(t,e,n)}function AO(t,e){let n=null;for(const r of t.fieldTransforms){const a=e.data.field(r.field),o=Z1(r.transform,a||null);o!=null&&(n===null&&(n=nr.empty()),n.set(r.field,o))}return n||null}function BS(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!(function(r,a){return r===void 0&&a===void 0||!(!r||!a)&&kl(r,a,((o,u)=>EO(o,u)))})(t.fieldTransforms,e.fieldTransforms)&&(t.type===0?t.value.isEqual(e.value):t.type!==1||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class Yu extends Zf{constructor(e,n,r,a=[]){super(),this.key=e,this.value=n,this.precondition=r,this.fieldTransforms=a,this.type=0}getFieldMask(){return null}}class Ca extends Zf{constructor(e,n,r,a,o=[]){super(),this.key=e,this.data=n,this.fieldMask=r,this.precondition=a,this.fieldTransforms=o,this.type=1}getFieldMask(){return this.fieldMask}}function sC(t){const e=new Map;return t.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const r=t.data.field(n);e.set(n,r)}})),e}function LS(t,e,n){const r=new Map;yt(t.length===n.length,32656,{Re:n.length,Ve:t.length});for(let a=0;a<n.length;a++){const o=t[a],u=o.transform,h=e.data.field(o.field);r.set(o.field,SO(u,h,n[a]))}return r}function zS(t,e,n){const r=new Map;for(const a of t){const o=a.transform,u=n.data.field(a.field);r.set(a.field,xO(o,u,e))}return r}class em extends Zf{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class jO extends Zf{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class RO{constructor(e,n,r,a){this.batchId=e,this.localWriteTime=n,this.baseMutations=r,this.mutations=a}applyToRemoteDocument(e,n){const r=n.mutationResults;for(let a=0;a<this.mutations.length;a++){const o=this.mutations[a];o.key.isEqual(e.key)&&TO(o,e,r[a])}}applyToLocalView(e,n){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(n=wu(r,e,n,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(n=wu(r,e,n,this.localWriteTime));return n}applyToLocalDocumentSet(e,n){const r=X1();return this.mutations.forEach((a=>{const o=e.get(a.key),u=o.overlayedDocument;let h=this.applyToLocalView(u,o.mutatedFields);h=n.has(a.key)?null:h;const f=rC(u,h);f!==null&&r.set(a.key,f),u.isValidDocument()||u.convertToNoDocument(qe.min())})),r}keys(){return this.mutations.reduce(((e,n)=>e.add(n.key)),it())}isEqual(e){return this.batchId===e.batchId&&kl(this.mutations,e.mutations,((n,r)=>BS(n,r)))&&kl(this.baseMutations,e.baseMutations,((n,r)=>BS(n,r)))}}class a0{constructor(e,n,r,a){this.batch=e,this.commitVersion=n,this.mutationResults=r,this.docVersions=a}static from(e,n,r){yt(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let a=(function(){return gO})();const o=e.mutations;for(let u=0;u<o.length;u++)a=a.insert(o[u].key,r[u].version);return new a0(e,n,r,a)}}class DO{constructor(e,n){this.largestBatchId=e,this.mutation=n}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class IO{constructor(e,n){this.count=e,this.unchangedNames=n}}var an,lt;function MO(t){switch(t){case _e.OK:return Fe(64938);case _e.CANCELLED:case _e.UNKNOWN:case _e.DEADLINE_EXCEEDED:case _e.RESOURCE_EXHAUSTED:case _e.INTERNAL:case _e.UNAVAILABLE:case _e.UNAUTHENTICATED:return!1;case _e.INVALID_ARGUMENT:case _e.NOT_FOUND:case _e.ALREADY_EXISTS:case _e.PERMISSION_DENIED:case _e.FAILED_PRECONDITION:case _e.ABORTED:case _e.OUT_OF_RANGE:case _e.UNIMPLEMENTED:case _e.DATA_LOSS:return!0;default:return Fe(15467,{code:t})}}function iC(t){if(t===void 0)return fi("GRPC error has no .code"),_e.UNKNOWN;switch(t){case an.OK:return _e.OK;case an.CANCELLED:return _e.CANCELLED;case an.UNKNOWN:return _e.UNKNOWN;case an.DEADLINE_EXCEEDED:return _e.DEADLINE_EXCEEDED;case an.RESOURCE_EXHAUSTED:return _e.RESOURCE_EXHAUSTED;case an.INTERNAL:return _e.INTERNAL;case an.UNAVAILABLE:return _e.UNAVAILABLE;case an.UNAUTHENTICATED:return _e.UNAUTHENTICATED;case an.INVALID_ARGUMENT:return _e.INVALID_ARGUMENT;case an.NOT_FOUND:return _e.NOT_FOUND;case an.ALREADY_EXISTS:return _e.ALREADY_EXISTS;case an.PERMISSION_DENIED:return _e.PERMISSION_DENIED;case an.FAILED_PRECONDITION:return _e.FAILED_PRECONDITION;case an.ABORTED:return _e.ABORTED;case an.OUT_OF_RANGE:return _e.OUT_OF_RANGE;case an.UNIMPLEMENTED:return _e.UNIMPLEMENTED;case an.DATA_LOSS:return _e.DATA_LOSS;default:return Fe(39323,{code:t})}}(lt=an||(an={}))[lt.OK=0]="OK",lt[lt.CANCELLED=1]="CANCELLED",lt[lt.UNKNOWN=2]="UNKNOWN",lt[lt.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",lt[lt.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",lt[lt.NOT_FOUND=5]="NOT_FOUND",lt[lt.ALREADY_EXISTS=6]="ALREADY_EXISTS",lt[lt.PERMISSION_DENIED=7]="PERMISSION_DENIED",lt[lt.UNAUTHENTICATED=16]="UNAUTHENTICATED",lt[lt.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",lt[lt.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",lt[lt.ABORTED=10]="ABORTED",lt[lt.OUT_OF_RANGE=11]="OUT_OF_RANGE",lt[lt.UNIMPLEMENTED=12]="UNIMPLEMENTED",lt[lt.INTERNAL=13]="INTERNAL",lt[lt.UNAVAILABLE=14]="UNAVAILABLE",lt[lt.DATA_LOSS=15]="DATA_LOSS";function kO(){return new TextEncoder}const OO=new da([4294967295,4294967295],0);function US(t){const e=kO().encode(t),n=new v1;return n.update(e),new Uint8Array(n.digest())}function FS(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),r=e.getUint32(4,!0),a=e.getUint32(8,!0),o=e.getUint32(12,!0);return[new da([n,r],0),new da([a,o],0)]}class o0{constructor(e,n,r){if(this.bitmap=e,this.padding=n,this.hashCount=r,n<0||n>=8)throw new gu(`Invalid padding: ${n}`);if(r<0)throw new gu(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new gu(`Invalid hash count: ${r}`);if(e.length===0&&n!==0)throw new gu(`Invalid padding when bitmap length is 0: ${n}`);this.ge=8*e.length-n,this.pe=da.fromNumber(this.ge)}ye(e,n,r){let a=e.add(n.multiply(da.fromNumber(r)));return a.compare(OO)===1&&(a=new da([a.getBits(0),a.getBits(1)],0)),a.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const n=US(e),[r,a]=FS(n);for(let o=0;o<this.hashCount;o++){const u=this.ye(r,a,o);if(!this.we(u))return!1}return!0}static create(e,n,r){const a=e%8==0?0:8-e%8,o=new Uint8Array(Math.ceil(e/8)),u=new o0(o,a,n);return r.forEach((h=>u.insert(h))),u}insert(e){if(this.ge===0)return;const n=US(e),[r,a]=FS(n);for(let o=0;o<this.hashCount;o++){const u=this.ye(r,a,o);this.Se(u)}}Se(e){const n=Math.floor(e/8),r=e%8;this.bitmap[n]|=1<<r}}class gu extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class tm{constructor(e,n,r,a,o){this.snapshotVersion=e,this.targetChanges=n,this.targetMismatches=r,this.documentUpdates=a,this.resolvedLimboDocuments=o}static createSynthesizedRemoteEventForCurrentChange(e,n,r){const a=new Map;return a.set(e,Xu.createSynthesizedTargetChangeForCurrentChange(e,n,r)),new tm(qe.min(),a,new Vt(st),mi(),it())}}class Xu{constructor(e,n,r,a,o){this.resumeToken=e,this.current=n,this.addedDocuments=r,this.modifiedDocuments=a,this.removedDocuments=o}static createSynthesizedTargetChangeForCurrentChange(e,n,r){return new Xu(r,n,it(),it(),it())}}class tf{constructor(e,n,r,a){this.be=e,this.removedTargetIds=n,this.key=r,this.De=a}}class aC{constructor(e,n){this.targetId=e,this.Ce=n}}class oC{constructor(e,n,r=Mn.EMPTY_BYTE_STRING,a=null){this.state=e,this.targetIds=n,this.resumeToken=r,this.cause=a}}class VS{constructor(){this.ve=0,this.Fe=$S(),this.Me=Mn.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=it(),n=it(),r=it();return this.Fe.forEach(((a,o)=>{switch(o){case 0:e=e.add(a);break;case 2:n=n.add(a);break;case 1:r=r.add(a);break;default:Fe(38017,{changeType:o})}})),new Xu(this.Me,this.xe,e,n,r)}qe(){this.Oe=!1,this.Fe=$S()}Qe(e,n){this.Oe=!0,this.Fe=this.Fe.insert(e,n)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,yt(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class NO{constructor(e){this.Ge=e,this.ze=new Map,this.je=mi(),this.Je=Fh(),this.He=Fh(),this.Ye=new Vt(st)}Ze(e){for(const n of e.be)e.De&&e.De.isFoundDocument()?this.Xe(n,e.De):this.et(n,e.key,e.De);for(const n of e.removedTargetIds)this.et(n,e.key,e.De)}tt(e){this.forEachTarget(e,(n=>{const r=this.nt(n);switch(e.state){case 0:this.rt(n)&&r.Le(e.resumeToken);break;case 1:r.Ke(),r.Ne||r.qe(),r.Le(e.resumeToken);break;case 2:r.Ke(),r.Ne||this.removeTarget(n);break;case 3:this.rt(n)&&(r.We(),r.Le(e.resumeToken));break;case 4:this.rt(n)&&(this.it(n),r.Le(e.resumeToken));break;default:Fe(56790,{state:e.state})}}))}forEachTarget(e,n){e.targetIds.length>0?e.targetIds.forEach(n):this.ze.forEach(((r,a)=>{this.rt(a)&&n(a)}))}st(e){const n=e.targetId,r=e.Ce.count,a=this.ot(n);if(a){const o=a.target;if(hy(o))if(r===0){const u=new Pe(o.path);this.et(n,u,Bn.newNoDocument(u,qe.min()))}else yt(r===1,20013,{expectedCount:r});else{const u=this._t(n);if(u!==r){const h=this.ut(e),f=h?this.ct(h,e,u):1;if(f!==0){this.it(n);const m=f===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(n,m)}}}}}ut(e){const n=e.Ce.unchangedNames;if(!n||!n.bits)return null;const{bits:{bitmap:r="",padding:a=0},hashCount:o=0}=n;let u,h;try{u=ga(r).toUint8Array()}catch(f){if(f instanceof M1)return Ml("Decoding the base64 bloom filter in existence filter failed ("+f.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw f}try{h=new o0(u,a,o)}catch(f){return Ml(f instanceof gu?"BloomFilter error: ":"Applying bloom filter failed: ",f),null}return h.ge===0?null:h}ct(e,n,r){return n.Ce.count===r-this.Pt(e,n.targetId)?0:2}Pt(e,n){const r=this.Ge.getRemoteKeysForTarget(n);let a=0;return r.forEach((o=>{const u=this.Ge.ht(),h=`projects/${u.projectId}/databases/${u.database}/documents/${o.path.canonicalString()}`;e.mightContain(h)||(this.et(n,o,null),a++)})),a}Tt(e){const n=new Map;this.ze.forEach(((o,u)=>{const h=this.ot(u);if(h){if(o.current&&hy(h.target)){const f=new Pe(h.target.path);this.It(f).has(u)||this.Et(u,f)||this.et(u,f,Bn.newNoDocument(f,e))}o.Be&&(n.set(u,o.ke()),o.qe())}}));let r=it();this.He.forEach(((o,u)=>{let h=!0;u.forEachWhile((f=>{const m=this.ot(f);return!m||m.purpose==="TargetPurposeLimboResolution"||(h=!1,!1)})),h&&(r=r.add(o))})),this.je.forEach(((o,u)=>u.setReadTime(e)));const a=new tm(e,n,this.Ye,this.je,r);return this.je=mi(),this.Je=Fh(),this.He=Fh(),this.Ye=new Vt(st),a}Xe(e,n){if(!this.rt(e))return;const r=this.Et(e,n.key)?2:0;this.nt(e).Qe(n.key,r),this.je=this.je.insert(n.key,n),this.Je=this.Je.insert(n.key,this.It(n.key).add(e)),this.He=this.He.insert(n.key,this.dt(n.key).add(e))}et(e,n,r){if(!this.rt(e))return;const a=this.nt(e);this.Et(e,n)?a.Qe(n,1):a.$e(n),this.He=this.He.insert(n,this.dt(n).delete(e)),this.He=this.He.insert(n,this.dt(n).add(e)),r&&(this.je=this.je.insert(n,r))}removeTarget(e){this.ze.delete(e)}_t(e){const n=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+n.addedDocuments.size-n.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let n=this.ze.get(e);return n||(n=new VS,this.ze.set(e,n)),n}dt(e){let n=this.He.get(e);return n||(n=new gn(st),this.He=this.He.insert(e,n)),n}It(e){let n=this.Je.get(e);return n||(n=new gn(st),this.Je=this.Je.insert(e,n)),n}rt(e){const n=this.ot(e)!==null;return n||Re("WatchChangeAggregator","Detected inactive target",e),n}ot(e){const n=this.ze.get(e);return n&&n.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new VS),this.Ge.getRemoteKeysForTarget(e).forEach((n=>{this.et(e,n,null)}))}Et(e,n){return this.Ge.getRemoteKeysForTarget(e).has(n)}}function Fh(){return new Vt(Pe.comparator)}function $S(){return new Vt(Pe.comparator)}const PO={asc:"ASCENDING",desc:"DESCENDING"},BO={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},LO={and:"AND",or:"OR"};class zO{constructor(e,n){this.databaseId=e,this.useProto3Json=n}}function py(t,e){return t.useProto3Json||Wf(e)?e:{value:e}}function Ef(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function lC(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function UO(t,e){return Ef(t,e.toTimestamp())}function ks(t){return yt(!!t,49232),qe.fromTimestamp((function(n){const r=pa(n);return new kt(r.seconds,r.nanos)})(t))}function l0(t,e){return gy(t,e).canonicalString()}function gy(t,e){const n=(function(a){return new Rt(["projects",a.projectId,"databases",a.database])})(t).child("documents");return e===void 0?n:n.child(e)}function cC(t){const e=Rt.fromString(t);return yt(mC(e),10190,{key:e.toString()}),e}function yy(t,e){return l0(t.databaseId,e.path)}function kg(t,e){const n=cC(e);if(n.get(1)!==t.databaseId.projectId)throw new Te(_e.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new Te(_e.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new Pe(dC(n))}function uC(t,e){return l0(t.databaseId,e)}function FO(t){const e=cC(t);return e.length===4?Rt.emptyPath():dC(e)}function _y(t){return new Rt(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function dC(t){return yt(t.length>4&&t.get(4)==="documents",29091,{key:t.toString()}),t.popFirst(5)}function qS(t,e,n){return{name:yy(t,e),fields:n.value.mapValue.fields}}function VO(t,e){let n;if("targetChange"in e){e.targetChange;const r=(function(m){return m==="NO_CHANGE"?0:m==="ADD"?1:m==="REMOVE"?2:m==="CURRENT"?3:m==="RESET"?4:Fe(39313,{state:m})})(e.targetChange.targetChangeType||"NO_CHANGE"),a=e.targetChange.targetIds||[],o=(function(m,g){return m.useProto3Json?(yt(g===void 0||typeof g=="string",58123),Mn.fromBase64String(g||"")):(yt(g===void 0||g instanceof Buffer||g instanceof Uint8Array,16193),Mn.fromUint8Array(g||new Uint8Array))})(t,e.targetChange.resumeToken),u=e.targetChange.cause,h=u&&(function(m){const g=m.code===void 0?_e.UNKNOWN:iC(m.code);return new Te(g,m.message||"")})(u);n=new oC(r,a,o,h||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const a=kg(t,r.document.name),o=ks(r.document.updateTime),u=r.document.createTime?ks(r.document.createTime):qe.min(),h=new nr({mapValue:{fields:r.document.fields}}),f=Bn.newFoundDocument(a,o,u,h),m=r.targetIds||[],g=r.removedTargetIds||[];n=new tf(m,g,f.key,f)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const a=kg(t,r.document),o=r.readTime?ks(r.readTime):qe.min(),u=Bn.newNoDocument(a,o),h=r.removedTargetIds||[];n=new tf([],h,u.key,u)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const a=kg(t,r.document),o=r.removedTargetIds||[];n=new tf([],o,a,null)}else{if(!("filter"in e))return Fe(11601,{Rt:e});{e.filter;const r=e.filter;r.targetId;const{count:a=0,unchangedNames:o}=r,u=new IO(a,o),h=r.targetId;n=new aC(h,u)}}return n}function $O(t,e){let n;if(e instanceof Yu)n={update:qS(t,e.key,e.value)};else if(e instanceof em)n={delete:yy(t,e.key)};else if(e instanceof Ca)n={update:qS(t,e.key,e.data),updateMask:JO(e.fieldMask)};else{if(!(e instanceof jO))return Fe(16599,{Vt:e.type});n={verify:yy(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map((r=>(function(o,u){const h=u.transform;if(h instanceof Sf)return{fieldPath:u.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(h instanceof Pl)return{fieldPath:u.field.canonicalString(),appendMissingElements:{values:h.elements}};if(h instanceof ku)return{fieldPath:u.field.canonicalString(),removeAllFromArray:{values:h.elements}};if(h instanceof wf)return{fieldPath:u.field.canonicalString(),increment:h.Ae};throw Fe(20930,{transform:u.transform})})(0,r)))),e.precondition.isNone||(n.currentDocument=(function(a,o){return o.updateTime!==void 0?{updateTime:UO(a,o.updateTime)}:o.exists!==void 0?{exists:o.exists}:Fe(27497)})(t,e.precondition)),n}function qO(t,e){return t&&t.length>0?(yt(e!==void 0,14353),t.map((n=>(function(a,o){let u=a.updateTime?ks(a.updateTime):ks(o);return u.isEqual(qe.min())&&(u=ks(o)),new CO(u,a.transformResults||[])})(n,e)))):[]}function HO(t,e){return{documents:[uC(t,e.path)]}}function GO(t,e){const n={structuredQuery:{}},r=e.path;let a;e.collectionGroup!==null?(a=r,n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(a=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=uC(t,a);const o=(function(m){if(m.length!==0)return fC(ss.create(m,"and"))})(e.filters);o&&(n.structuredQuery.where=o);const u=(function(m){if(m.length!==0)return m.map((g=>(function(v){return{field:Sl(v.field),direction:KO(v.dir)}})(g)))})(e.orderBy);u&&(n.structuredQuery.orderBy=u);const h=py(t,e.limit);return h!==null&&(n.structuredQuery.limit=h),e.startAt&&(n.structuredQuery.startAt=(function(m){return{before:m.inclusive,values:m.position}})(e.startAt)),e.endAt&&(n.structuredQuery.endAt=(function(m){return{before:!m.inclusive,values:m.position}})(e.endAt)),{ft:n,parent:a}}function QO(t){let e=FO(t.parent);const n=t.structuredQuery,r=n.from?n.from.length:0;let a=null;if(r>0){yt(r===1,65062);const g=n.from[0];g.allDescendants?a=g.collectionId:e=e.child(g.collectionId)}let o=[];n.where&&(o=(function(_){const v=hC(_);return v instanceof ss&&V1(v)?v.getFilters():[v]})(n.where));let u=[];n.orderBy&&(u=(function(_){return _.map((v=>(function(x){return new xf(wl(x.field),(function(C){switch(C){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(x.direction))})(v)))})(n.orderBy));let h=null;n.limit&&(h=(function(_){let v;return v=typeof _=="object"?_.value:_,Wf(v)?null:v})(n.limit));let f=null;n.startAt&&(f=(function(_){const v=!!_.before,S=_.values||[];return new vf(S,v)})(n.startAt));let m=null;return n.endAt&&(m=(function(_){const v=!_.before,S=_.values||[];return new vf(S,v)})(n.endAt)),dO(e,a,u,o,h,"F",f,m)}function WO(t,e){const n=(function(a){switch(a){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Fe(28987,{purpose:a})}})(e.purpose);return n==null?null:{"goog-listen-tags":n}}function hC(t){return t.unaryFilter!==void 0?(function(n){switch(n.unaryFilter.op){case"IS_NAN":const r=wl(n.unaryFilter.field);return ln.create(r,"==",{doubleValue:NaN});case"IS_NULL":const a=wl(n.unaryFilter.field);return ln.create(a,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const o=wl(n.unaryFilter.field);return ln.create(o,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const u=wl(n.unaryFilter.field);return ln.create(u,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return Fe(61313);default:return Fe(60726)}})(t):t.fieldFilter!==void 0?(function(n){return ln.create(wl(n.fieldFilter.field),(function(a){switch(a){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return Fe(58110);default:return Fe(50506)}})(n.fieldFilter.op),n.fieldFilter.value)})(t):t.compositeFilter!==void 0?(function(n){return ss.create(n.compositeFilter.filters.map((r=>hC(r))),(function(a){switch(a){case"AND":return"and";case"OR":return"or";default:return Fe(1026)}})(n.compositeFilter.op))})(t):Fe(30097,{filter:t})}function KO(t){return PO[t]}function YO(t){return BO[t]}function XO(t){return LO[t]}function Sl(t){return{fieldPath:t.canonicalString()}}function wl(t){return Dn.fromServerFormat(t.fieldPath)}function fC(t){return t instanceof ln?(function(n){if(n.op==="=="){if(IS(n.value))return{unaryFilter:{field:Sl(n.field),op:"IS_NAN"}};if(DS(n.value))return{unaryFilter:{field:Sl(n.field),op:"IS_NULL"}}}else if(n.op==="!="){if(IS(n.value))return{unaryFilter:{field:Sl(n.field),op:"IS_NOT_NAN"}};if(DS(n.value))return{unaryFilter:{field:Sl(n.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Sl(n.field),op:YO(n.op),value:n.value}}})(t):t instanceof ss?(function(n){const r=n.getFilters().map((a=>fC(a)));return r.length===1?r[0]:{compositeFilter:{op:XO(n.op),filters:r}}})(t):Fe(54877,{filter:t})}function JO(t){const e=[];return t.fields.forEach((n=>e.push(n.canonicalString()))),{fieldPaths:e}}function mC(t){return t.length>=4&&t.get(0)==="projects"&&t.get(2)==="databases"}class sa{constructor(e,n,r,a,o=qe.min(),u=qe.min(),h=Mn.EMPTY_BYTE_STRING,f=null){this.target=e,this.targetId=n,this.purpose=r,this.sequenceNumber=a,this.snapshotVersion=o,this.lastLimboFreeSnapshotVersion=u,this.resumeToken=h,this.expectedCount=f}withSequenceNumber(e){return new sa(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,n){return new sa(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new sa(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new sa(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class ZO{constructor(e){this.yt=e}}function eN(t){const e=QO({parent:t.parent,structuredQuery:t.structuredQuery});return t.limitType==="LAST"?my(e,e.limit,"L"):e}class tN{constructor(){this.Cn=new nN}addToCollectionParentIndex(e,n){return this.Cn.add(n),ve.resolve()}getCollectionParents(e,n){return ve.resolve(this.Cn.getEntries(n))}addFieldIndex(e,n){return ve.resolve()}deleteFieldIndex(e,n){return ve.resolve()}deleteAllFieldIndexes(e){return ve.resolve()}createTargetIndexes(e,n){return ve.resolve()}getDocumentsMatchingTarget(e,n){return ve.resolve(null)}getIndexType(e,n){return ve.resolve(0)}getFieldIndexes(e,n){return ve.resolve([])}getNextCollectionGroupToUpdate(e){return ve.resolve(null)}getMinOffset(e,n){return ve.resolve(ma.min())}getMinOffsetFromCollectionGroup(e,n){return ve.resolve(ma.min())}updateCollectionGroup(e,n,r){return ve.resolve()}updateIndexEntries(e,n){return ve.resolve()}}class nN{constructor(){this.index={}}add(e){const n=e.lastSegment(),r=e.popLast(),a=this.index[n]||new gn(Rt.comparator),o=!a.has(r);return this.index[n]=a.add(r),o}has(e){const n=e.lastSegment(),r=e.popLast(),a=this.index[n];return a&&a.has(r)}getEntries(e){return(this.index[e]||new gn(Rt.comparator)).toArray()}}const HS={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},pC=41943040;class tr{static withCacheSize(e){return new tr(e,tr.DEFAULT_COLLECTION_PERCENTILE,tr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,n,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=n,this.maximumSequenceNumbersToCollect=r}}tr.DEFAULT_COLLECTION_PERCENTILE=10,tr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,tr.DEFAULT=new tr(pC,tr.DEFAULT_COLLECTION_PERCENTILE,tr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),tr.DISABLED=new tr(-1,0,0);class Bl{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new Bl(0)}static cr(){return new Bl(-1)}}const GS="LruGarbageCollector",rN=1048576;function QS([t,e],[n,r]){const a=st(t,n);return a===0?st(e,r):a}class sN{constructor(e){this.Ir=e,this.buffer=new gn(QS),this.Er=0}dr(){return++this.Er}Ar(e){const n=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(n);else{const r=this.buffer.last();QS(n,r)<0&&(this.buffer=this.buffer.delete(r).add(n))}}get maxValue(){return this.buffer.last()[0]}}class iN{constructor(e,n,r){this.garbageCollector=e,this.asyncQueue=n,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){Re(GS,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(n){Zl(n)?Re(GS,"Ignoring IndexedDB error during garbage collection: ",n):await Jl(n)}await this.Vr(3e5)}))}}class aN{constructor(e,n){this.mr=e,this.params=n}calculateTargetCount(e,n){return this.mr.gr(e).next((r=>Math.floor(n/100*r)))}nthSequenceNumber(e,n){if(n===0)return ve.resolve(Qf.ce);const r=new sN(n);return this.mr.forEachTarget(e,(a=>r.Ar(a.sequenceNumber))).next((()=>this.mr.pr(e,(a=>r.Ar(a))))).next((()=>r.maxValue))}removeTargets(e,n,r){return this.mr.removeTargets(e,n,r)}removeOrphanedDocuments(e,n){return this.mr.removeOrphanedDocuments(e,n)}collect(e,n){return this.params.cacheSizeCollectionThreshold===-1?(Re("LruGarbageCollector","Garbage collection skipped; disabled"),ve.resolve(HS)):this.getCacheSize(e).next((r=>r<this.params.cacheSizeCollectionThreshold?(Re("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),HS):this.yr(e,n)))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,n){let r,a,o,u,h,f,m;const g=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((_=>(_>this.params.maximumSequenceNumbersToCollect?(Re("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${_}`),a=this.params.maximumSequenceNumbersToCollect):a=_,u=Date.now(),this.nthSequenceNumber(e,a)))).next((_=>(r=_,h=Date.now(),this.removeTargets(e,r,n)))).next((_=>(o=_,f=Date.now(),this.removeOrphanedDocuments(e,r)))).next((_=>(m=Date.now(),vl()<=rt.DEBUG&&Re("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${u-g}ms
	Determined least recently used ${a} in `+(h-u)+`ms
	Removed ${o} targets in `+(f-h)+`ms
	Removed ${_} documents in `+(m-f)+`ms
Total Duration: ${m-g}ms`),ve.resolve({didRun:!0,sequenceNumbersCollected:a,targetsRemoved:o,documentsRemoved:_}))))}}function oN(t,e){return new aN(t,e)}class lN{constructor(){this.changes=new So((e=>e.toString()),((e,n)=>e.isEqual(n))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,n){this.assertNotApplied(),this.changes.set(e,Bn.newInvalidDocument(e).setReadTime(n))}getEntry(e,n){this.assertNotApplied();const r=this.changes.get(n);return r!==void 0?ve.resolve(r):this.getFromCache(e,n)}getEntries(e,n){return this.getAllFromCache(e,n)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class cN{constructor(e,n){this.overlayedDocument=e,this.mutatedFields=n}}class uN{constructor(e,n,r,a){this.remoteDocumentCache=e,this.mutationQueue=n,this.documentOverlayCache=r,this.indexManager=a}getDocument(e,n){let r=null;return this.documentOverlayCache.getOverlay(e,n).next((a=>(r=a,this.remoteDocumentCache.getEntry(e,n)))).next((a=>(r!==null&&wu(r.mutation,a,pr.empty(),kt.now()),a)))}getDocuments(e,n){return this.remoteDocumentCache.getEntries(e,n).next((r=>this.getLocalViewOfDocuments(e,r,it()).next((()=>r))))}getLocalViewOfDocuments(e,n,r=it()){const a=lo();return this.populateOverlays(e,a,n).next((()=>this.computeViews(e,n,a,r).next((o=>{let u=pu();return o.forEach(((h,f)=>{u=u.insert(h,f.overlayedDocument)})),u}))))}getOverlayedDocuments(e,n){const r=lo();return this.populateOverlays(e,r,n).next((()=>this.computeViews(e,n,r,it())))}populateOverlays(e,n,r){const a=[];return r.forEach((o=>{n.has(o)||a.push(o)})),this.documentOverlayCache.getOverlays(e,a).next((o=>{o.forEach(((u,h)=>{n.set(u,h)}))}))}computeViews(e,n,r,a){let o=mi();const u=Su(),h=(function(){return Su()})();return n.forEach(((f,m)=>{const g=r.get(m.key);a.has(m.key)&&(g===void 0||g.mutation instanceof Ca)?o=o.insert(m.key,m):g!==void 0?(u.set(m.key,g.mutation.getFieldMask()),wu(g.mutation,m,g.mutation.getFieldMask(),kt.now())):u.set(m.key,pr.empty())})),this.recalculateAndSaveOverlays(e,o).next((f=>(f.forEach(((m,g)=>u.set(m,g))),n.forEach(((m,g)=>h.set(m,new cN(g,u.get(m)??null)))),h)))}recalculateAndSaveOverlays(e,n){const r=Su();let a=new Vt(((u,h)=>u-h)),o=it();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,n).next((u=>{for(const h of u)h.keys().forEach((f=>{const m=n.get(f);if(m===null)return;let g=r.get(f)||pr.empty();g=h.applyToLocalView(m,g),r.set(f,g);const _=(a.get(h.batchId)||it()).add(f);a=a.insert(h.batchId,_)}))})).next((()=>{const u=[],h=a.getReverseIterator();for(;h.hasNext();){const f=h.getNext(),m=f.key,g=f.value,_=X1();g.forEach((v=>{if(!o.has(v)){const S=rC(n.get(v),r.get(v));S!==null&&_.set(v,S),o=o.add(v)}})),u.push(this.documentOverlayCache.saveOverlays(e,m,_))}return ve.waitFor(u)})).next((()=>r))}recalculateAndSaveOverlaysForDocumentKeys(e,n){return this.remoteDocumentCache.getEntries(e,n).next((r=>this.recalculateAndSaveOverlays(e,r)))}getDocumentsMatchingQuery(e,n,r,a){return(function(u){return Pe.isDocumentKey(u.path)&&u.collectionGroup===null&&u.filters.length===0})(n)?this.getDocumentsMatchingDocumentQuery(e,n.path):G1(n)?this.getDocumentsMatchingCollectionGroupQuery(e,n,r,a):this.getDocumentsMatchingCollectionQuery(e,n,r,a)}getNextDocuments(e,n,r,a){return this.remoteDocumentCache.getAllFromCollectionGroup(e,n,r,a).next((o=>{const u=a-o.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,n,r.largestBatchId,a-o.size):ve.resolve(lo());let h=Ru,f=o;return u.next((m=>ve.forEach(m,((g,_)=>(h<_.largestBatchId&&(h=_.largestBatchId),o.get(g)?ve.resolve():this.remoteDocumentCache.getEntry(e,g).next((v=>{f=f.insert(g,v)}))))).next((()=>this.populateOverlays(e,m,o))).next((()=>this.computeViews(e,f,m,it()))).next((g=>({batchId:h,changes:Y1(g)})))))}))}getDocumentsMatchingDocumentQuery(e,n){return this.getDocument(e,new Pe(n)).next((r=>{let a=pu();return r.isFoundDocument()&&(a=a.insert(r.key,r)),a}))}getDocumentsMatchingCollectionGroupQuery(e,n,r,a){const o=n.collectionGroup;let u=pu();return this.indexManager.getCollectionParents(e,o).next((h=>ve.forEach(h,(f=>{const m=(function(_,v){return new Ku(v,null,_.explicitOrderBy.slice(),_.filters.slice(),_.limit,_.limitType,_.startAt,_.endAt)})(n,f.child(o));return this.getDocumentsMatchingCollectionQuery(e,m,r,a).next((g=>{g.forEach(((_,v)=>{u=u.insert(_,v)}))}))})).next((()=>u))))}getDocumentsMatchingCollectionQuery(e,n,r,a){let o;return this.documentOverlayCache.getOverlaysForCollection(e,n.path,r.largestBatchId).next((u=>(o=u,this.remoteDocumentCache.getDocumentsMatchingQuery(e,n,r,o,a)))).next((u=>{o.forEach(((f,m)=>{const g=m.getKey();u.get(g)===null&&(u=u.insert(g,Bn.newInvalidDocument(g)))}));let h=pu();return u.forEach(((f,m)=>{const g=o.get(f);g!==void 0&&wu(g.mutation,m,pr.empty(),kt.now()),Xf(n,m)&&(h=h.insert(f,m))})),h}))}}class dN{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,n){return ve.resolve(this.Lr.get(n))}saveBundleMetadata(e,n){return this.Lr.set(n.id,(function(a){return{id:a.id,version:a.version,createTime:ks(a.createTime)}})(n)),ve.resolve()}getNamedQuery(e,n){return ve.resolve(this.kr.get(n))}saveNamedQuery(e,n){return this.kr.set(n.name,(function(a){return{name:a.name,query:eN(a.bundledQuery),readTime:ks(a.readTime)}})(n)),ve.resolve()}}class hN{constructor(){this.overlays=new Vt(Pe.comparator),this.qr=new Map}getOverlay(e,n){return ve.resolve(this.overlays.get(n))}getOverlays(e,n){const r=lo();return ve.forEach(n,(a=>this.getOverlay(e,a).next((o=>{o!==null&&r.set(a,o)})))).next((()=>r))}saveOverlays(e,n,r){return r.forEach(((a,o)=>{this.St(e,n,o)})),ve.resolve()}removeOverlaysForBatchId(e,n,r){const a=this.qr.get(r);return a!==void 0&&(a.forEach((o=>this.overlays=this.overlays.remove(o))),this.qr.delete(r)),ve.resolve()}getOverlaysForCollection(e,n,r){const a=lo(),o=n.length+1,u=new Pe(n.child("")),h=this.overlays.getIteratorFrom(u);for(;h.hasNext();){const f=h.getNext().value,m=f.getKey();if(!n.isPrefixOf(m.path))break;m.path.length===o&&f.largestBatchId>r&&a.set(f.getKey(),f)}return ve.resolve(a)}getOverlaysForCollectionGroup(e,n,r,a){let o=new Vt(((m,g)=>m-g));const u=this.overlays.getIterator();for(;u.hasNext();){const m=u.getNext().value;if(m.getKey().getCollectionGroup()===n&&m.largestBatchId>r){let g=o.get(m.largestBatchId);g===null&&(g=lo(),o=o.insert(m.largestBatchId,g)),g.set(m.getKey(),m)}}const h=lo(),f=o.getIterator();for(;f.hasNext()&&(f.getNext().value.forEach(((m,g)=>h.set(m,g))),!(h.size()>=a)););return ve.resolve(h)}St(e,n,r){const a=this.overlays.get(r.key);if(a!==null){const u=this.qr.get(a.largestBatchId).delete(r.key);this.qr.set(a.largestBatchId,u)}this.overlays=this.overlays.insert(r.key,new DO(n,r));let o=this.qr.get(n);o===void 0&&(o=it(),this.qr.set(n,o)),this.qr.set(n,o.add(r.key))}}class fN{constructor(){this.sessionToken=Mn.EMPTY_BYTE_STRING}getSessionToken(e){return ve.resolve(this.sessionToken)}setSessionToken(e,n){return this.sessionToken=n,ve.resolve()}}class c0{constructor(){this.Qr=new gn(xn.$r),this.Ur=new gn(xn.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,n){const r=new xn(e,n);this.Qr=this.Qr.add(r),this.Ur=this.Ur.add(r)}Wr(e,n){e.forEach((r=>this.addReference(r,n)))}removeReference(e,n){this.Gr(new xn(e,n))}zr(e,n){e.forEach((r=>this.removeReference(r,n)))}jr(e){const n=new Pe(new Rt([])),r=new xn(n,e),a=new xn(n,e+1),o=[];return this.Ur.forEachInRange([r,a],(u=>{this.Gr(u),o.push(u.key)})),o}Jr(){this.Qr.forEach((e=>this.Gr(e)))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const n=new Pe(new Rt([])),r=new xn(n,e),a=new xn(n,e+1);let o=it();return this.Ur.forEachInRange([r,a],(u=>{o=o.add(u.key)})),o}containsKey(e){const n=new xn(e,0),r=this.Qr.firstAfterOrEqual(n);return r!==null&&e.isEqual(r.key)}}class xn{constructor(e,n){this.key=e,this.Yr=n}static $r(e,n){return Pe.comparator(e.key,n.key)||st(e.Yr,n.Yr)}static Kr(e,n){return st(e.Yr,n.Yr)||Pe.comparator(e.key,n.key)}}class mN{constructor(e,n){this.indexManager=e,this.referenceDelegate=n,this.mutationQueue=[],this.tr=1,this.Zr=new gn(xn.$r)}checkEmpty(e){return ve.resolve(this.mutationQueue.length===0)}addMutationBatch(e,n,r,a){const o=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const u=new RO(o,n,r,a);this.mutationQueue.push(u);for(const h of a)this.Zr=this.Zr.add(new xn(h.key,o)),this.indexManager.addToCollectionParentIndex(e,h.key.path.popLast());return ve.resolve(u)}lookupMutationBatch(e,n){return ve.resolve(this.Xr(n))}getNextMutationBatchAfterBatchId(e,n){const r=n+1,a=this.ei(r),o=a<0?0:a;return ve.resolve(this.mutationQueue.length>o?this.mutationQueue[o]:null)}getHighestUnacknowledgedBatchId(){return ve.resolve(this.mutationQueue.length===0?Zy:this.tr-1)}getAllMutationBatches(e){return ve.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,n){const r=new xn(n,0),a=new xn(n,Number.POSITIVE_INFINITY),o=[];return this.Zr.forEachInRange([r,a],(u=>{const h=this.Xr(u.Yr);o.push(h)})),ve.resolve(o)}getAllMutationBatchesAffectingDocumentKeys(e,n){let r=new gn(st);return n.forEach((a=>{const o=new xn(a,0),u=new xn(a,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([o,u],(h=>{r=r.add(h.Yr)}))})),ve.resolve(this.ti(r))}getAllMutationBatchesAffectingQuery(e,n){const r=n.path,a=r.length+1;let o=r;Pe.isDocumentKey(o)||(o=o.child(""));const u=new xn(new Pe(o),0);let h=new gn(st);return this.Zr.forEachWhile((f=>{const m=f.key.path;return!!r.isPrefixOf(m)&&(m.length===a&&(h=h.add(f.Yr)),!0)}),u),ve.resolve(this.ti(h))}ti(e){const n=[];return e.forEach((r=>{const a=this.Xr(r);a!==null&&n.push(a)})),n}removeMutationBatch(e,n){yt(this.ni(n.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Zr;return ve.forEach(n.mutations,(a=>{const o=new xn(a.key,n.batchId);return r=r.delete(o),this.referenceDelegate.markPotentiallyOrphaned(e,a.key)})).next((()=>{this.Zr=r}))}ir(e){}containsKey(e,n){const r=new xn(n,0),a=this.Zr.firstAfterOrEqual(r);return ve.resolve(n.isEqual(a&&a.key))}performConsistencyCheck(e){return this.mutationQueue.length,ve.resolve()}ni(e,n){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const n=this.ei(e);return n<0||n>=this.mutationQueue.length?null:this.mutationQueue[n]}}class pN{constructor(e){this.ri=e,this.docs=(function(){return new Vt(Pe.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,n){const r=n.key,a=this.docs.get(r),o=a?a.size:0,u=this.ri(n);return this.docs=this.docs.insert(r,{document:n.mutableCopy(),size:u}),this.size+=u-o,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const n=this.docs.get(e);n&&(this.docs=this.docs.remove(e),this.size-=n.size)}getEntry(e,n){const r=this.docs.get(n);return ve.resolve(r?r.document.mutableCopy():Bn.newInvalidDocument(n))}getEntries(e,n){let r=mi();return n.forEach((a=>{const o=this.docs.get(a);r=r.insert(a,o?o.document.mutableCopy():Bn.newInvalidDocument(a))})),ve.resolve(r)}getDocumentsMatchingQuery(e,n,r,a){let o=mi();const u=n.path,h=new Pe(u.child("__id-9223372036854775808__")),f=this.docs.getIteratorFrom(h);for(;f.hasNext();){const{key:m,value:{document:g}}=f.getNext();if(!u.isPrefixOf(m.path))break;m.path.length>u.length+1||$k(Vk(g),r)<=0||(a.has(g.key)||Xf(n,g))&&(o=o.insert(g.key,g.mutableCopy()))}return ve.resolve(o)}getAllFromCollectionGroup(e,n,r,a){Fe(9500)}ii(e,n){return ve.forEach(this.docs,(r=>n(r)))}newChangeBuffer(e){return new gN(this)}getSize(e){return ve.resolve(this.size)}}class gN extends lN{constructor(e){super(),this.Nr=e}applyChanges(e){const n=[];return this.changes.forEach(((r,a)=>{a.isValidDocument()?n.push(this.Nr.addEntry(e,a)):this.Nr.removeEntry(r)})),ve.waitFor(n)}getFromCache(e,n){return this.Nr.getEntry(e,n)}getAllFromCache(e,n){return this.Nr.getEntries(e,n)}}class yN{constructor(e){this.persistence=e,this.si=new So((n=>n0(n)),r0),this.lastRemoteSnapshotVersion=qe.min(),this.highestTargetId=0,this.oi=0,this._i=new c0,this.targetCount=0,this.ai=Bl.ur()}forEachTarget(e,n){return this.si.forEach(((r,a)=>n(a))),ve.resolve()}getLastRemoteSnapshotVersion(e){return ve.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return ve.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),ve.resolve(this.highestTargetId)}setTargetsMetadata(e,n,r){return r&&(this.lastRemoteSnapshotVersion=r),n>this.oi&&(this.oi=n),ve.resolve()}Pr(e){this.si.set(e.target,e);const n=e.targetId;n>this.highestTargetId&&(this.ai=new Bl(n),this.highestTargetId=n),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,n){return this.Pr(n),this.targetCount+=1,ve.resolve()}updateTargetData(e,n){return this.Pr(n),ve.resolve()}removeTargetData(e,n){return this.si.delete(n.target),this._i.jr(n.targetId),this.targetCount-=1,ve.resolve()}removeTargets(e,n,r){let a=0;const o=[];return this.si.forEach(((u,h)=>{h.sequenceNumber<=n&&r.get(h.targetId)===null&&(this.si.delete(u),o.push(this.removeMatchingKeysForTargetId(e,h.targetId)),a++)})),ve.waitFor(o).next((()=>a))}getTargetCount(e){return ve.resolve(this.targetCount)}getTargetData(e,n){const r=this.si.get(n)||null;return ve.resolve(r)}addMatchingKeys(e,n,r){return this._i.Wr(n,r),ve.resolve()}removeMatchingKeys(e,n,r){this._i.zr(n,r);const a=this.persistence.referenceDelegate,o=[];return a&&n.forEach((u=>{o.push(a.markPotentiallyOrphaned(e,u))})),ve.waitFor(o)}removeMatchingKeysForTargetId(e,n){return this._i.jr(n),ve.resolve()}getMatchingKeysForTargetId(e,n){const r=this._i.Hr(n);return ve.resolve(r)}containsKey(e,n){return ve.resolve(this._i.containsKey(n))}}class gC{constructor(e,n){this.ui={},this.overlays={},this.ci=new Qf(0),this.li=!1,this.li=!0,this.hi=new fN,this.referenceDelegate=e(this),this.Pi=new yN(this),this.indexManager=new tN,this.remoteDocumentCache=(function(a){return new pN(a)})((r=>this.referenceDelegate.Ti(r))),this.serializer=new ZO(n),this.Ii=new dN(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let n=this.overlays[e.toKey()];return n||(n=new hN,this.overlays[e.toKey()]=n),n}getMutationQueue(e,n){let r=this.ui[e.toKey()];return r||(r=new mN(n,this.referenceDelegate),this.ui[e.toKey()]=r),r}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,n,r){Re("MemoryPersistence","Starting transaction:",e);const a=new _N(this.ci.next());return this.referenceDelegate.Ei(),r(a).next((o=>this.referenceDelegate.di(a).next((()=>o)))).toPromise().then((o=>(a.raiseOnCommittedEvent(),o)))}Ai(e,n){return ve.or(Object.values(this.ui).map((r=>()=>r.containsKey(e,n))))}}class _N extends Hk{constructor(e){super(),this.currentSequenceNumber=e}}class u0{constructor(e){this.persistence=e,this.Ri=new c0,this.Vi=null}static mi(e){return new u0(e)}get fi(){if(this.Vi)return this.Vi;throw Fe(60996)}addReference(e,n,r){return this.Ri.addReference(r,n),this.fi.delete(r.toString()),ve.resolve()}removeReference(e,n,r){return this.Ri.removeReference(r,n),this.fi.add(r.toString()),ve.resolve()}markPotentiallyOrphaned(e,n){return this.fi.add(n.toString()),ve.resolve()}removeTarget(e,n){this.Ri.jr(n.targetId).forEach((a=>this.fi.add(a.toString())));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,n.targetId).next((a=>{a.forEach((o=>this.fi.add(o.toString())))})).next((()=>r.removeTargetData(e,n)))}Ei(){this.Vi=new Set}di(e){const n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return ve.forEach(this.fi,(r=>{const a=Pe.fromPath(r);return this.gi(e,a).next((o=>{o||n.removeEntry(a,qe.min())}))})).next((()=>(this.Vi=null,n.apply(e))))}updateLimboDocument(e,n){return this.gi(e,n).next((r=>{r?this.fi.delete(n.toString()):this.fi.add(n.toString())}))}Ti(e){return 0}gi(e,n){return ve.or([()=>ve.resolve(this.Ri.containsKey(n)),()=>this.persistence.getTargetCache().containsKey(e,n),()=>this.persistence.Ai(e,n)])}}class Cf{constructor(e,n){this.persistence=e,this.pi=new So((r=>Wk(r.path)),((r,a)=>r.isEqual(a))),this.garbageCollector=oN(this,n)}static mi(e,n){return new Cf(e,n)}Ei(){}di(e){return ve.resolve()}forEachTarget(e,n){return this.persistence.getTargetCache().forEachTarget(e,n)}gr(e){const n=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next((r=>n.next((a=>r+a))))}wr(e){let n=0;return this.pr(e,(r=>{n++})).next((()=>n))}pr(e,n){return ve.forEach(this.pi,((r,a)=>this.br(e,r,a).next((o=>o?ve.resolve():n(a)))))}removeTargets(e,n,r){return this.persistence.getTargetCache().removeTargets(e,n,r)}removeOrphanedDocuments(e,n){let r=0;const a=this.persistence.getRemoteDocumentCache(),o=a.newChangeBuffer();return a.ii(e,(u=>this.br(e,u,n).next((h=>{h||(r++,o.removeEntry(u,qe.min()))})))).next((()=>o.apply(e))).next((()=>r))}markPotentiallyOrphaned(e,n){return this.pi.set(n,e.currentSequenceNumber),ve.resolve()}removeTarget(e,n){const r=n.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,n,r){return this.pi.set(r,e.currentSequenceNumber),ve.resolve()}removeReference(e,n,r){return this.pi.set(r,e.currentSequenceNumber),ve.resolve()}updateLimboDocument(e,n){return this.pi.set(n,e.currentSequenceNumber),ve.resolve()}Ti(e){let n=e.key.toString().length;return e.isFoundDocument()&&(n+=Jh(e.data.value)),n}br(e,n,r){return ve.or([()=>this.persistence.Ai(e,n),()=>this.persistence.getTargetCache().containsKey(e,n),()=>{const a=this.pi.get(n);return ve.resolve(a!==void 0&&a>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class d0{constructor(e,n,r,a){this.targetId=e,this.fromCache=n,this.Es=r,this.ds=a}static As(e,n){let r=it(),a=it();for(const o of n.docChanges)switch(o.type){case 0:r=r.add(o.doc.key);break;case 1:a=a.add(o.doc.key)}return new d0(e,n.fromCache,r,a)}}class bN{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class vN{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(function(){return K5()?8:Gk(Ln())>0?6:4})()}initialize(e,n){this.ps=e,this.indexManager=n,this.Rs=!0}getDocumentsMatchingQuery(e,n,r,a){const o={result:null};return this.ys(e,n).next((u=>{o.result=u})).next((()=>{if(!o.result)return this.ws(e,n,a,r).next((u=>{o.result=u}))})).next((()=>{if(o.result)return;const u=new bN;return this.Ss(e,n,u).next((h=>{if(o.result=h,this.Vs)return this.bs(e,n,u,h.size)}))})).next((()=>o.result))}bs(e,n,r,a){return r.documentReadCount<this.fs?(vl()<=rt.DEBUG&&Re("QueryEngine","SDK will not create cache indexes for query:",xl(n),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),ve.resolve()):(vl()<=rt.DEBUG&&Re("QueryEngine","Query:",xl(n),"scans",r.documentReadCount,"local documents and returns",a,"documents as results."),r.documentReadCount>this.gs*a?(vl()<=rt.DEBUG&&Re("QueryEngine","The SDK decides to create cache indexes for query:",xl(n),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Ms(n))):ve.resolve())}ys(e,n){if(NS(n))return ve.resolve(null);let r=Ms(n);return this.indexManager.getIndexType(e,r).next((a=>a===0?null:(n.limit!==null&&a===1&&(n=my(n,null,"F"),r=Ms(n)),this.indexManager.getDocumentsMatchingTarget(e,r).next((o=>{const u=it(...o);return this.ps.getDocuments(e,u).next((h=>this.indexManager.getMinOffset(e,r).next((f=>{const m=this.Ds(n,h);return this.Cs(n,m,u,f.readTime)?this.ys(e,my(n,null,"F")):this.vs(e,m,n,f)}))))})))))}ws(e,n,r,a){return NS(n)||a.isEqual(qe.min())?ve.resolve(null):this.ps.getDocuments(e,r).next((o=>{const u=this.Ds(n,o);return this.Cs(n,u,r,a)?ve.resolve(null):(vl()<=rt.DEBUG&&Re("QueryEngine","Re-using previous result from %s to execute query: %s",a.toString(),xl(n)),this.vs(e,u,n,Fk(a,Ru)).next((h=>h)))}))}Ds(e,n){let r=new gn(W1(e));return n.forEach(((a,o)=>{Xf(e,o)&&(r=r.add(o))})),r}Cs(e,n,r,a){if(e.limit===null)return!1;if(r.size!==n.size)return!0;const o=e.limitType==="F"?n.last():n.first();return!!o&&(o.hasPendingWrites||o.version.compareTo(a)>0)}Ss(e,n,r){return vl()<=rt.DEBUG&&Re("QueryEngine","Using full collection scan to execute query:",xl(n)),this.ps.getDocumentsMatchingQuery(e,n,ma.min(),r)}vs(e,n,r,a){return this.ps.getDocumentsMatchingQuery(e,r,a).next((o=>(n.forEach((u=>{o=o.insert(u.key,u)})),o)))}}const h0="LocalStore",xN=3e8;class SN{constructor(e,n,r,a){this.persistence=e,this.Fs=n,this.serializer=a,this.Ms=new Vt(st),this.xs=new So((o=>n0(o)),r0),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(r)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new uN(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(n=>e.collect(n,this.Ms)))}}function wN(t,e,n,r){return new SN(t,e,n,r)}async function yC(t,e){const n=Ge(t);return await n.persistence.runTransaction("Handle user change","readonly",(r=>{let a;return n.mutationQueue.getAllMutationBatches(r).next((o=>(a=o,n.Bs(e),n.mutationQueue.getAllMutationBatches(r)))).next((o=>{const u=[],h=[];let f=it();for(const m of a){u.push(m.batchId);for(const g of m.mutations)f=f.add(g.key)}for(const m of o){h.push(m.batchId);for(const g of m.mutations)f=f.add(g.key)}return n.localDocuments.getDocuments(r,f).next((m=>({Ls:m,removedBatchIds:u,addedBatchIds:h})))}))}))}function EN(t,e){const n=Ge(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(r=>{const a=e.batch.keys(),o=n.Ns.newChangeBuffer({trackRemovals:!0});return(function(h,f,m,g){const _=m.batch,v=_.keys();let S=ve.resolve();return v.forEach((x=>{S=S.next((()=>g.getEntry(f,x))).next((E=>{const C=m.docVersions.get(x);yt(C!==null,48541),E.version.compareTo(C)<0&&(_.applyToRemoteDocument(E,m),E.isValidDocument()&&(E.setReadTime(m.commitVersion),g.addEntry(E)))}))})),S.next((()=>h.mutationQueue.removeMutationBatch(f,_)))})(n,r,e,o).next((()=>o.apply(r))).next((()=>n.mutationQueue.performConsistencyCheck(r))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(r,a,e.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,(function(h){let f=it();for(let m=0;m<h.mutationResults.length;++m)h.mutationResults[m].transformResults.length>0&&(f=f.add(h.batch.mutations[m].key));return f})(e)))).next((()=>n.localDocuments.getDocuments(r,a)))}))}function _C(t){const e=Ge(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(n=>e.Pi.getLastRemoteSnapshotVersion(n)))}function CN(t,e){const n=Ge(t),r=e.snapshotVersion;let a=n.Ms;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(o=>{const u=n.Ns.newChangeBuffer({trackRemovals:!0});a=n.Ms;const h=[];e.targetChanges.forEach(((g,_)=>{const v=a.get(_);if(!v)return;h.push(n.Pi.removeMatchingKeys(o,g.removedDocuments,_).next((()=>n.Pi.addMatchingKeys(o,g.addedDocuments,_))));let S=v.withSequenceNumber(o.currentSequenceNumber);e.targetMismatches.get(_)!==null?S=S.withResumeToken(Mn.EMPTY_BYTE_STRING,qe.min()).withLastLimboFreeSnapshotVersion(qe.min()):g.resumeToken.approximateByteSize()>0&&(S=S.withResumeToken(g.resumeToken,r)),a=a.insert(_,S),(function(E,C,I){return E.resumeToken.approximateByteSize()===0||C.snapshotVersion.toMicroseconds()-E.snapshotVersion.toMicroseconds()>=xN?!0:I.addedDocuments.size+I.modifiedDocuments.size+I.removedDocuments.size>0})(v,S,g)&&h.push(n.Pi.updateTargetData(o,S))}));let f=mi(),m=it();if(e.documentUpdates.forEach((g=>{e.resolvedLimboDocuments.has(g)&&h.push(n.persistence.referenceDelegate.updateLimboDocument(o,g))})),h.push(TN(o,u,e.documentUpdates).next((g=>{f=g.ks,m=g.qs}))),!r.isEqual(qe.min())){const g=n.Pi.getLastRemoteSnapshotVersion(o).next((_=>n.Pi.setTargetsMetadata(o,o.currentSequenceNumber,r)));h.push(g)}return ve.waitFor(h).next((()=>u.apply(o))).next((()=>n.localDocuments.getLocalViewOfDocuments(o,f,m))).next((()=>f))})).then((o=>(n.Ms=a,o)))}function TN(t,e,n){let r=it(),a=it();return n.forEach((o=>r=r.add(o))),e.getEntries(t,r).next((o=>{let u=mi();return n.forEach(((h,f)=>{const m=o.get(h);f.isFoundDocument()!==m.isFoundDocument()&&(a=a.add(h)),f.isNoDocument()&&f.version.isEqual(qe.min())?(e.removeEntry(h,f.readTime),u=u.insert(h,f)):!m.isValidDocument()||f.version.compareTo(m.version)>0||f.version.compareTo(m.version)===0&&m.hasPendingWrites?(e.addEntry(f),u=u.insert(h,f)):Re(h0,"Ignoring outdated watch update for ",h,". Current version:",m.version," Watch version:",f.version)})),{ks:u,qs:a}}))}function AN(t,e){const n=Ge(t);return n.persistence.runTransaction("Get next mutation batch","readonly",(r=>(e===void 0&&(e=Zy),n.mutationQueue.getNextMutationBatchAfterBatchId(r,e))))}function jN(t,e){const n=Ge(t);return n.persistence.runTransaction("Allocate target","readwrite",(r=>{let a;return n.Pi.getTargetData(r,e).next((o=>o?(a=o,ve.resolve(a)):n.Pi.allocateTargetId(r).next((u=>(a=new sa(e,u,"TargetPurposeListen",r.currentSequenceNumber),n.Pi.addTargetData(r,a).next((()=>a)))))))})).then((r=>{const a=n.Ms.get(r.targetId);return(a===null||r.snapshotVersion.compareTo(a.snapshotVersion)>0)&&(n.Ms=n.Ms.insert(r.targetId,r),n.xs.set(e,r.targetId)),r}))}async function by(t,e,n){const r=Ge(t),a=r.Ms.get(e),o=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",o,(u=>r.persistence.referenceDelegate.removeTarget(u,a)))}catch(u){if(!Zl(u))throw u;Re(h0,`Failed to update sequence numbers for target ${e}: ${u}`)}r.Ms=r.Ms.remove(e),r.xs.delete(a.target)}function WS(t,e,n){const r=Ge(t);let a=qe.min(),o=it();return r.persistence.runTransaction("Execute query","readwrite",(u=>(function(f,m,g){const _=Ge(f),v=_.xs.get(g);return v!==void 0?ve.resolve(_.Ms.get(v)):_.Pi.getTargetData(m,g)})(r,u,Ms(e)).next((h=>{if(h)return a=h.lastLimboFreeSnapshotVersion,r.Pi.getMatchingKeysForTargetId(u,h.targetId).next((f=>{o=f}))})).next((()=>r.Fs.getDocumentsMatchingQuery(u,e,n?a:qe.min(),n?o:it()))).next((h=>(RN(r,fO(e),h),{documents:h,Qs:o})))))}function RN(t,e,n){let r=t.Os.get(e)||qe.min();n.forEach(((a,o)=>{o.readTime.compareTo(r)>0&&(r=o.readTime)})),t.Os.set(e,r)}class KS{constructor(){this.activeTargetIds=bO()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class DN{constructor(){this.Mo=new KS,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,n,r){}addLocalQueryTarget(e,n=!0){return n&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,n,r){this.xo[e]=n}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new KS,Promise.resolve()}handleUserChange(e,n,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class IN{Oo(e){}shutdown(){}}const YS="ConnectivityMonitor";class XS{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){Re(YS,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){Re(YS,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}let Vh=null;function vy(){return Vh===null?Vh=(function(){return 268435456+Math.round(2147483648*Math.random())})():Vh++,"0x"+Vh.toString(16)}const Og="RestConnection",MN={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class kN{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const n=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),a=encodeURIComponent(this.databaseId.database);this.Uo=n+"://"+e.host,this.Ko=`projects/${r}/databases/${a}`,this.Wo=this.databaseId.database===_f?`project_id=${r}`:`project_id=${r}&database_id=${a}`}Go(e,n,r,a,o){const u=vy(),h=this.zo(e,n.toUriEncodedString());Re(Og,`Sending RPC '${e}' ${u}:`,h,r);const f={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(f,a,o);const{host:m}=new URL(h),g=Hl(m);return this.Jo(e,h,f,r,g).then((_=>(Re(Og,`Received RPC '${e}' ${u}: `,_),_)),(_=>{throw Ml(Og,`RPC '${e}' ${u} failed with error: `,_,"url: ",h,"request:",r),_}))}Ho(e,n,r,a,o,u){return this.Go(e,n,r,a,o)}jo(e,n,r){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+Xl})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach(((a,o)=>e[o]=a)),r&&r.headers.forEach(((a,o)=>e[o]=a))}zo(e,n){const r=MN[e];return`${this.Uo}/v1/${n}:${r}`}terminate(){}}class ON{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}const Nn="WebChannelConnection";class NN extends kN{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,n,r,a,o){const u=vy();return new Promise(((h,f)=>{const m=new x1;m.setWithCredentials(!0),m.listenOnce(S1.COMPLETE,(()=>{try{switch(m.getLastErrorCode()){case Xh.NO_ERROR:const _=m.getResponseJson();Re(Nn,`XHR for RPC '${e}' ${u} received:`,JSON.stringify(_)),h(_);break;case Xh.TIMEOUT:Re(Nn,`RPC '${e}' ${u} timed out`),f(new Te(_e.DEADLINE_EXCEEDED,"Request time out"));break;case Xh.HTTP_ERROR:const v=m.getStatus();if(Re(Nn,`RPC '${e}' ${u} failed with status:`,v,"response text:",m.getResponseText()),v>0){let S=m.getResponseJson();Array.isArray(S)&&(S=S[0]);const x=S?.error;if(x&&x.status&&x.message){const E=(function(I){const j=I.toLowerCase().replace(/_/g,"-");return Object.values(_e).indexOf(j)>=0?j:_e.UNKNOWN})(x.status);f(new Te(E,x.message))}else f(new Te(_e.UNKNOWN,"Server responded with status "+m.getStatus()))}else f(new Te(_e.UNAVAILABLE,"Connection failed."));break;default:Fe(9055,{l_:e,streamId:u,h_:m.getLastErrorCode(),P_:m.getLastError()})}}finally{Re(Nn,`RPC '${e}' ${u} completed.`)}}));const g=JSON.stringify(a);Re(Nn,`RPC '${e}' ${u} sending request:`,a),m.send(n,"POST",g,r,15)}))}T_(e,n,r){const a=vy(),o=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],u=C1(),h=E1(),f={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},m=this.longPollingOptions.timeoutSeconds;m!==void 0&&(f.longPollingTimeout=Math.round(1e3*m)),this.useFetchStreams&&(f.useFetchStreams=!0),this.jo(f.initMessageHeaders,n,r),f.encodeInitMessageHeaders=!0;const g=o.join("");Re(Nn,`Creating RPC '${e}' stream ${a}: ${g}`,f);const _=u.createWebChannel(g,f);this.I_(_);let v=!1,S=!1;const x=new ON({Yo:C=>{S?Re(Nn,`Not sending because RPC '${e}' stream ${a} is closed:`,C):(v||(Re(Nn,`Opening RPC '${e}' stream ${a} transport.`),_.open(),v=!0),Re(Nn,`RPC '${e}' stream ${a} sending:`,C),_.send(C))},Zo:()=>_.close()}),E=(C,I,j)=>{C.listen(I,(M=>{try{j(M)}catch(Q){setTimeout((()=>{throw Q}),0)}}))};return E(_,mu.EventType.OPEN,(()=>{S||(Re(Nn,`RPC '${e}' stream ${a} transport opened.`),x.o_())})),E(_,mu.EventType.CLOSE,(()=>{S||(S=!0,Re(Nn,`RPC '${e}' stream ${a} transport closed`),x.a_(),this.E_(_))})),E(_,mu.EventType.ERROR,(C=>{S||(S=!0,Ml(Nn,`RPC '${e}' stream ${a} transport errored. Name:`,C.name,"Message:",C.message),x.a_(new Te(_e.UNAVAILABLE,"The operation could not be completed")))})),E(_,mu.EventType.MESSAGE,(C=>{if(!S){const I=C.data[0];yt(!!I,16349);const j=I,M=j?.error||j[0]?.error;if(M){Re(Nn,`RPC '${e}' stream ${a} received error:`,M);const Q=M.status;let q=(function(A){const N=an[A];if(N!==void 0)return iC(N)})(Q),G=M.message;q===void 0&&(q=_e.INTERNAL,G="Unknown error status: "+Q+" with message "+M.message),S=!0,x.a_(new Te(q,G)),_.close()}else Re(Nn,`RPC '${e}' stream ${a} received:`,I),x.u_(I)}})),E(h,w1.STAT_EVENT,(C=>{C.stat===oy.PROXY?Re(Nn,`RPC '${e}' stream ${a} detected buffering proxy`):C.stat===oy.NOPROXY&&Re(Nn,`RPC '${e}' stream ${a} detected no buffering proxy`)})),setTimeout((()=>{x.__()}),0),x}terminate(){this.c_.forEach((e=>e.close())),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter((n=>n===e))}}function Ng(){return typeof document<"u"?document:null}function nm(t){return new zO(t,!0)}class bC{constructor(e,n,r=1e3,a=1.5,o=6e4){this.Mi=e,this.timerId=n,this.d_=r,this.A_=a,this.R_=o,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const n=Math.floor(this.V_+this.y_()),r=Math.max(0,Date.now()-this.f_),a=Math.max(0,n-r);a>0&&Re("ExponentialBackoff",`Backing off for ${a} ms (base delay: ${this.V_} ms, delay with jitter: ${n} ms, last attempt: ${r} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,a,(()=>(this.f_=Date.now(),e()))),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}const JS="PersistentStream";class vC{constructor(e,n,r,a,o,u,h,f){this.Mi=e,this.S_=r,this.b_=a,this.connection=o,this.authCredentialsProvider=u,this.appCheckCredentialsProvider=h,this.listener=f,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new bC(e,n)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,(()=>this.k_())))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,n){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():n&&n.code===_e.RESOURCE_EXHAUSTED?(fi(n.toString()),fi("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):n&&n.code===_e.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(n)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),n=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([r,a])=>{this.D_===n&&this.G_(r,a)}),(r=>{e((()=>{const a=new Te(_e.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(a)}))}))}G_(e,n){const r=this.W_(this.D_);this.stream=this.j_(e,n),this.stream.Xo((()=>{r((()=>this.listener.Xo()))})),this.stream.t_((()=>{r((()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.t_())))})),this.stream.r_((a=>{r((()=>this.z_(a)))})),this.stream.onMessage((a=>{r((()=>++this.F_==1?this.J_(a):this.onNext(a)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(e){return Re(JS,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return n=>{this.Mi.enqueueAndForget((()=>this.D_===e?n():(Re(JS,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class PN extends vC{constructor(e,n,r,a,o,u){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",n,r,a,u),this.serializer=o}j_(e,n){return this.connection.T_("Listen",e,n)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const n=VO(this.serializer,e),r=(function(o){if(!("targetChange"in o))return qe.min();const u=o.targetChange;return u.targetIds&&u.targetIds.length?qe.min():u.readTime?ks(u.readTime):qe.min()})(e);return this.listener.H_(n,r)}Y_(e){const n={};n.database=_y(this.serializer),n.addTarget=(function(o,u){let h;const f=u.target;if(h=hy(f)?{documents:HO(o,f)}:{query:GO(o,f).ft},h.targetId=u.targetId,u.resumeToken.approximateByteSize()>0){h.resumeToken=lC(o,u.resumeToken);const m=py(o,u.expectedCount);m!==null&&(h.expectedCount=m)}else if(u.snapshotVersion.compareTo(qe.min())>0){h.readTime=Ef(o,u.snapshotVersion.toTimestamp());const m=py(o,u.expectedCount);m!==null&&(h.expectedCount=m)}return h})(this.serializer,e);const r=WO(this.serializer,e);r&&(n.labels=r),this.q_(n)}Z_(e){const n={};n.database=_y(this.serializer),n.removeTarget=e,this.q_(n)}}class BN extends vC{constructor(e,n,r,a,o,u){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",n,r,a,u),this.serializer=o}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,n){return this.connection.T_("Write",e,n)}J_(e){return yt(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,yt(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){yt(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const n=qO(e.writeResults,e.commitTime),r=ks(e.commitTime);return this.listener.na(r,n)}ra(){const e={};e.database=_y(this.serializer),this.q_(e)}ea(e){const n={streamToken:this.lastStreamToken,writes:e.map((r=>$O(this.serializer,r)))};this.q_(n)}}class LN{}class zN extends LN{constructor(e,n,r,a){super(),this.authCredentials=e,this.appCheckCredentials=n,this.connection=r,this.serializer=a,this.ia=!1}sa(){if(this.ia)throw new Te(_e.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,n,r,a){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([o,u])=>this.connection.Go(e,gy(n,r),a,o,u))).catch((o=>{throw o.name==="FirebaseError"?(o.code===_e.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new Te(_e.UNKNOWN,o.toString())}))}Ho(e,n,r,a,o){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([u,h])=>this.connection.Ho(e,gy(n,r),a,u,h,o))).catch((u=>{throw u.name==="FirebaseError"?(u.code===_e.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),u):new Te(_e.UNKNOWN,u.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}class UN{constructor(e,n){this.asyncQueue=e,this.onlineStateHandler=n,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const n=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(fi(n),this.aa=!1):Re("OnlineStateTracker",n)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}const _o="RemoteStore";class FN{constructor(e,n,r,a,o){this.localStore=e,this.datastore=n,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=o,this.Aa.Oo((u=>{r.enqueueAndForget((async()=>{wo(this)&&(Re(_o,"Restarting streams for network reachability change."),await(async function(f){const m=Ge(f);m.Ea.add(4),await Ju(m),m.Ra.set("Unknown"),m.Ea.delete(4),await rm(m)})(this))}))})),this.Ra=new UN(r,a)}}async function rm(t){if(wo(t))for(const e of t.da)await e(!0)}async function Ju(t){for(const e of t.da)await e(!1)}function xC(t,e){const n=Ge(t);n.Ia.has(e.targetId)||(n.Ia.set(e.targetId,e),g0(n)?p0(n):ec(n).O_()&&m0(n,e))}function f0(t,e){const n=Ge(t),r=ec(n);n.Ia.delete(e),r.O_()&&SC(n,e),n.Ia.size===0&&(r.O_()?r.L_():wo(n)&&n.Ra.set("Unknown"))}function m0(t,e){if(t.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(qe.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}ec(t).Y_(e)}function SC(t,e){t.Va.Ue(e),ec(t).Z_(e)}function p0(t){t.Va=new NO({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),At:e=>t.Ia.get(e)||null,ht:()=>t.datastore.serializer.databaseId}),ec(t).start(),t.Ra.ua()}function g0(t){return wo(t)&&!ec(t).x_()&&t.Ia.size>0}function wo(t){return Ge(t).Ea.size===0}function wC(t){t.Va=void 0}async function VN(t){t.Ra.set("Online")}async function $N(t){t.Ia.forEach(((e,n)=>{m0(t,e)}))}async function qN(t,e){wC(t),g0(t)?(t.Ra.ha(e),p0(t)):t.Ra.set("Unknown")}async function HN(t,e,n){if(t.Ra.set("Online"),e instanceof oC&&e.state===2&&e.cause)try{await(async function(a,o){const u=o.cause;for(const h of o.targetIds)a.Ia.has(h)&&(await a.remoteSyncer.rejectListen(h,u),a.Ia.delete(h),a.Va.removeTarget(h))})(t,e)}catch(r){Re(_o,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await Tf(t,r)}else if(e instanceof tf?t.Va.Ze(e):e instanceof aC?t.Va.st(e):t.Va.tt(e),!n.isEqual(qe.min()))try{const r=await _C(t.localStore);n.compareTo(r)>=0&&await(function(o,u){const h=o.Va.Tt(u);return h.targetChanges.forEach(((f,m)=>{if(f.resumeToken.approximateByteSize()>0){const g=o.Ia.get(m);g&&o.Ia.set(m,g.withResumeToken(f.resumeToken,u))}})),h.targetMismatches.forEach(((f,m)=>{const g=o.Ia.get(f);if(!g)return;o.Ia.set(f,g.withResumeToken(Mn.EMPTY_BYTE_STRING,g.snapshotVersion)),SC(o,f);const _=new sa(g.target,f,m,g.sequenceNumber);m0(o,_)})),o.remoteSyncer.applyRemoteEvent(h)})(t,n)}catch(r){Re(_o,"Failed to raise snapshot:",r),await Tf(t,r)}}async function Tf(t,e,n){if(!Zl(e))throw e;t.Ea.add(1),await Ju(t),t.Ra.set("Offline"),n||(n=()=>_C(t.localStore)),t.asyncQueue.enqueueRetryable((async()=>{Re(_o,"Retrying IndexedDB access"),await n(),t.Ea.delete(1),await rm(t)}))}function EC(t,e){return e().catch((n=>Tf(t,n,e)))}async function sm(t){const e=Ge(t),n=_a(e);let r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:Zy;for(;GN(e);)try{const a=await AN(e.localStore,r);if(a===null){e.Ta.length===0&&n.L_();break}r=a.batchId,QN(e,a)}catch(a){await Tf(e,a)}CC(e)&&TC(e)}function GN(t){return wo(t)&&t.Ta.length<10}function QN(t,e){t.Ta.push(e);const n=_a(t);n.O_()&&n.X_&&n.ea(e.mutations)}function CC(t){return wo(t)&&!_a(t).x_()&&t.Ta.length>0}function TC(t){_a(t).start()}async function WN(t){_a(t).ra()}async function KN(t){const e=_a(t);for(const n of t.Ta)e.ea(n.mutations)}async function YN(t,e,n){const r=t.Ta.shift(),a=a0.from(r,e,n);await EC(t,(()=>t.remoteSyncer.applySuccessfulWrite(a))),await sm(t)}async function XN(t,e){e&&_a(t).X_&&await(async function(r,a){if((function(u){return MO(u)&&u!==_e.ABORTED})(a.code)){const o=r.Ta.shift();_a(r).B_(),await EC(r,(()=>r.remoteSyncer.rejectFailedWrite(o.batchId,a))),await sm(r)}})(t,e),CC(t)&&TC(t)}async function ZS(t,e){const n=Ge(t);n.asyncQueue.verifyOperationInProgress(),Re(_o,"RemoteStore received new credentials");const r=wo(n);n.Ea.add(3),await Ju(n),r&&n.Ra.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.Ea.delete(3),await rm(n)}async function JN(t,e){const n=Ge(t);e?(n.Ea.delete(2),await rm(n)):e||(n.Ea.add(2),await Ju(n),n.Ra.set("Unknown"))}function ec(t){return t.ma||(t.ma=(function(n,r,a){const o=Ge(n);return o.sa(),new PN(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,a)})(t.datastore,t.asyncQueue,{Xo:VN.bind(null,t),t_:$N.bind(null,t),r_:qN.bind(null,t),H_:HN.bind(null,t)}),t.da.push((async e=>{e?(t.ma.B_(),g0(t)?p0(t):t.Ra.set("Unknown")):(await t.ma.stop(),wC(t))}))),t.ma}function _a(t){return t.fa||(t.fa=(function(n,r,a){const o=Ge(n);return o.sa(),new BN(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,a)})(t.datastore,t.asyncQueue,{Xo:()=>Promise.resolve(),t_:WN.bind(null,t),r_:XN.bind(null,t),ta:KN.bind(null,t),na:YN.bind(null,t)}),t.da.push((async e=>{e?(t.fa.B_(),await sm(t)):(await t.fa.stop(),t.Ta.length>0&&(Re(_o,`Stopping write stream with ${t.Ta.length} pending writes`),t.Ta=[]))}))),t.fa}class y0{constructor(e,n,r,a,o){this.asyncQueue=e,this.timerId=n,this.targetTimeMs=r,this.op=a,this.removalCallback=o,this.deferred=new ci,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((u=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,n,r,a,o){const u=Date.now()+r,h=new y0(e,n,u,a,o);return h.start(r),h}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Te(_e.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function _0(t,e){if(fi("AsyncQueue",`${e}: ${t}`),Zl(t))return new Te(_e.UNAVAILABLE,`${e}: ${t}`);throw t}class jl{static emptySet(e){return new jl(e.comparator)}constructor(e){this.comparator=e?(n,r)=>e(n,r)||Pe.comparator(n.key,r.key):(n,r)=>Pe.comparator(n.key,r.key),this.keyedMap=pu(),this.sortedSet=new Vt(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const n=this.keyedMap.get(e);return n?this.sortedSet.indexOf(n):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((n,r)=>(e(n),!1)))}add(e){const n=this.delete(e.key);return n.copy(n.keyedMap.insert(e.key,e),n.sortedSet.insert(e,null))}delete(e){const n=this.get(e);return n?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(n)):this}isEqual(e){if(!(e instanceof jl)||this.size!==e.size)return!1;const n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;n.hasNext();){const a=n.getNext().key,o=r.getNext().key;if(!a.isEqual(o))return!1}return!0}toString(){const e=[];return this.forEach((n=>{e.push(n.toString())})),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,n){const r=new jl;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r}}class ew{constructor(){this.ga=new Vt(Pe.comparator)}track(e){const n=e.doc.key,r=this.ga.get(n);r?e.type!==0&&r.type===3?this.ga=this.ga.insert(n,e):e.type===3&&r.type!==1?this.ga=this.ga.insert(n,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.ga=this.ga.insert(n,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.ga=this.ga.insert(n,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.ga=this.ga.remove(n):e.type===1&&r.type===2?this.ga=this.ga.insert(n,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.ga=this.ga.insert(n,{type:2,doc:e.doc}):Fe(63341,{Rt:e,pa:r}):this.ga=this.ga.insert(n,e)}ya(){const e=[];return this.ga.inorderTraversal(((n,r)=>{e.push(r)})),e}}class Ll{constructor(e,n,r,a,o,u,h,f,m){this.query=e,this.docs=n,this.oldDocs=r,this.docChanges=a,this.mutatedKeys=o,this.fromCache=u,this.syncStateChanged=h,this.excludesMetadataChanges=f,this.hasCachedResults=m}static fromInitialDocuments(e,n,r,a,o){const u=[];return n.forEach((h=>{u.push({type:0,doc:h})})),new Ll(e,n,jl.emptySet(n),u,r,a,!0,!1,o)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Yf(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const n=this.docChanges,r=e.docChanges;if(n.length!==r.length)return!1;for(let a=0;a<n.length;a++)if(n[a].type!==r[a].type||!n[a].doc.isEqual(r[a].doc))return!1;return!0}}class ZN{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some((e=>e.Da()))}}class eP{constructor(){this.queries=tw(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(n,r){const a=Ge(n),o=a.queries;a.queries=tw(),o.forEach(((u,h)=>{for(const f of h.Sa)f.onError(r)}))})(this,new Te(_e.ABORTED,"Firestore shutting down"))}}function tw(){return new So((t=>Q1(t)),Yf)}async function AC(t,e){const n=Ge(t);let r=3;const a=e.query;let o=n.queries.get(a);o?!o.ba()&&e.Da()&&(r=2):(o=new ZN,r=e.Da()?0:1);try{switch(r){case 0:o.wa=await n.onListen(a,!0);break;case 1:o.wa=await n.onListen(a,!1);break;case 2:await n.onFirstRemoteStoreListen(a)}}catch(u){const h=_0(u,`Initialization of query '${xl(e.query)}' failed`);return void e.onError(h)}n.queries.set(a,o),o.Sa.push(e),e.va(n.onlineState),o.wa&&e.Fa(o.wa)&&b0(n)}async function jC(t,e){const n=Ge(t),r=e.query;let a=3;const o=n.queries.get(r);if(o){const u=o.Sa.indexOf(e);u>=0&&(o.Sa.splice(u,1),o.Sa.length===0?a=e.Da()?0:1:!o.ba()&&e.Da()&&(a=2))}switch(a){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}}function tP(t,e){const n=Ge(t);let r=!1;for(const a of e){const o=a.query,u=n.queries.get(o);if(u){for(const h of u.Sa)h.Fa(a)&&(r=!0);u.wa=a}}r&&b0(n)}function nP(t,e,n){const r=Ge(t),a=r.queries.get(e);if(a)for(const o of a.Sa)o.onError(n);r.queries.delete(e)}function b0(t){t.Ca.forEach((e=>{e.next()}))}var xy,nw;(nw=xy||(xy={})).Ma="default",nw.Cache="cache";class RC{constructor(e,n,r){this.query=e,this.xa=n,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){const r=[];for(const a of e.docChanges)a.type!==3&&r.push(a);e=new Ll(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let n=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),n=!0):this.La(e,this.onlineState)&&(this.ka(e),n=!0),this.Na=e,n}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let n=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),n=!0),n}La(e,n){if(!e.fromCache||!this.Da())return!0;const r=n!=="Offline";return(!this.options.qa||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||n==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const n=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!n)&&this.options.includeMetadataChanges===!0}ka(e){e=Ll.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==xy.Cache}}class DC{constructor(e){this.key=e}}class IC{constructor(e){this.key=e}}class rP{constructor(e,n){this.query=e,this.Ya=n,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=it(),this.mutatedKeys=it(),this.eu=W1(e),this.tu=new jl(this.eu)}get nu(){return this.Ya}ru(e,n){const r=n?n.iu:new ew,a=n?n.tu:this.tu;let o=n?n.mutatedKeys:this.mutatedKeys,u=a,h=!1;const f=this.query.limitType==="F"&&a.size===this.query.limit?a.last():null,m=this.query.limitType==="L"&&a.size===this.query.limit?a.first():null;if(e.inorderTraversal(((g,_)=>{const v=a.get(g),S=Xf(this.query,_)?_:null,x=!!v&&this.mutatedKeys.has(v.key),E=!!S&&(S.hasLocalMutations||this.mutatedKeys.has(S.key)&&S.hasCommittedMutations);let C=!1;v&&S?v.data.isEqual(S.data)?x!==E&&(r.track({type:3,doc:S}),C=!0):this.su(v,S)||(r.track({type:2,doc:S}),C=!0,(f&&this.eu(S,f)>0||m&&this.eu(S,m)<0)&&(h=!0)):!v&&S?(r.track({type:0,doc:S}),C=!0):v&&!S&&(r.track({type:1,doc:v}),C=!0,(f||m)&&(h=!0)),C&&(S?(u=u.add(S),o=E?o.add(g):o.delete(g)):(u=u.delete(g),o=o.delete(g)))})),this.query.limit!==null)for(;u.size>this.query.limit;){const g=this.query.limitType==="F"?u.last():u.first();u=u.delete(g.key),o=o.delete(g.key),r.track({type:1,doc:g})}return{tu:u,iu:r,Cs:h,mutatedKeys:o}}su(e,n){return e.hasLocalMutations&&n.hasCommittedMutations&&!n.hasLocalMutations}applyChanges(e,n,r,a){const o=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const u=e.iu.ya();u.sort(((g,_)=>(function(S,x){const E=C=>{switch(C){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Fe(20277,{Rt:C})}};return E(S)-E(x)})(g.type,_.type)||this.eu(g.doc,_.doc))),this.ou(r),a=a??!1;const h=n&&!a?this._u():[],f=this.Xa.size===0&&this.current&&!a?1:0,m=f!==this.Za;return this.Za=f,u.length!==0||m?{snapshot:new Ll(this.query,e.tu,o,u,e.mutatedKeys,f===0,m,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:h}:{au:h}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new ew,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach((n=>this.Ya=this.Ya.add(n))),e.modifiedDocuments.forEach((n=>{})),e.removedDocuments.forEach((n=>this.Ya=this.Ya.delete(n))),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=it(),this.tu.forEach((r=>{this.uu(r.key)&&(this.Xa=this.Xa.add(r.key))}));const n=[];return e.forEach((r=>{this.Xa.has(r)||n.push(new IC(r))})),this.Xa.forEach((r=>{e.has(r)||n.push(new DC(r))})),n}cu(e){this.Ya=e.Qs,this.Xa=it();const n=this.ru(e.documents);return this.applyChanges(n,!0)}lu(){return Ll.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const v0="SyncEngine";class sP{constructor(e,n,r){this.query=e,this.targetId=n,this.view=r}}class iP{constructor(e){this.key=e,this.hu=!1}}class aP{constructor(e,n,r,a,o,u){this.localStore=e,this.remoteStore=n,this.eventManager=r,this.sharedClientState=a,this.currentUser=o,this.maxConcurrentLimboResolutions=u,this.Pu={},this.Tu=new So((h=>Q1(h)),Yf),this.Iu=new Map,this.Eu=new Set,this.du=new Vt(Pe.comparator),this.Au=new Map,this.Ru=new c0,this.Vu={},this.mu=new Map,this.fu=Bl.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function oP(t,e,n=!0){const r=BC(t);let a;const o=r.Tu.get(e);return o?(r.sharedClientState.addLocalQueryTarget(o.targetId),a=o.view.lu()):a=await MC(r,e,n,!0),a}async function lP(t,e){const n=BC(t);await MC(n,e,!0,!1)}async function MC(t,e,n,r){const a=await jN(t.localStore,Ms(e)),o=a.targetId,u=t.sharedClientState.addLocalQueryTarget(o,n);let h;return r&&(h=await cP(t,e,o,u==="current",a.resumeToken)),t.isPrimaryClient&&n&&xC(t.remoteStore,a),h}async function cP(t,e,n,r,a){t.pu=(_,v,S)=>(async function(E,C,I,j){let M=C.view.ru(I);M.Cs&&(M=await WS(E.localStore,C.query,!1).then((({documents:D})=>C.view.ru(D,M))));const Q=j&&j.targetChanges.get(C.targetId),q=j&&j.targetMismatches.get(C.targetId)!=null,G=C.view.applyChanges(M,E.isPrimaryClient,Q,q);return sw(E,C.targetId,G.au),G.snapshot})(t,_,v,S);const o=await WS(t.localStore,e,!0),u=new rP(e,o.Qs),h=u.ru(o.documents),f=Xu.createSynthesizedTargetChangeForCurrentChange(n,r&&t.onlineState!=="Offline",a),m=u.applyChanges(h,t.isPrimaryClient,f);sw(t,n,m.au);const g=new sP(e,n,u);return t.Tu.set(e,g),t.Iu.has(n)?t.Iu.get(n).push(e):t.Iu.set(n,[e]),m.snapshot}async function uP(t,e,n){const r=Ge(t),a=r.Tu.get(e),o=r.Iu.get(a.targetId);if(o.length>1)return r.Iu.set(a.targetId,o.filter((u=>!Yf(u,e)))),void r.Tu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(a.targetId),r.sharedClientState.isActiveQueryTarget(a.targetId)||await by(r.localStore,a.targetId,!1).then((()=>{r.sharedClientState.clearQueryState(a.targetId),n&&f0(r.remoteStore,a.targetId),Sy(r,a.targetId)})).catch(Jl)):(Sy(r,a.targetId),await by(r.localStore,a.targetId,!0))}async function dP(t,e){const n=Ge(t),r=n.Tu.get(e),a=n.Iu.get(r.targetId);n.isPrimaryClient&&a.length===1&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),f0(n.remoteStore,r.targetId))}async function hP(t,e,n){const r=bP(t);try{const a=await(function(u,h){const f=Ge(u),m=kt.now(),g=h.reduce(((S,x)=>S.add(x.key)),it());let _,v;return f.persistence.runTransaction("Locally write mutations","readwrite",(S=>{let x=mi(),E=it();return f.Ns.getEntries(S,g).next((C=>{x=C,x.forEach(((I,j)=>{j.isValidDocument()||(E=E.add(I))}))})).next((()=>f.localDocuments.getOverlayedDocuments(S,x))).next((C=>{_=C;const I=[];for(const j of h){const M=AO(j,_.get(j.key).overlayedDocument);M!=null&&I.push(new Ca(j.key,M,z1(M.value.mapValue),rr.exists(!0)))}return f.mutationQueue.addMutationBatch(S,m,I,h)})).next((C=>{v=C;const I=C.applyToLocalDocumentSet(_,E);return f.documentOverlayCache.saveOverlays(S,C.batchId,I)}))})).then((()=>({batchId:v.batchId,changes:Y1(_)})))})(r.localStore,e);r.sharedClientState.addPendingMutation(a.batchId),(function(u,h,f){let m=u.Vu[u.currentUser.toKey()];m||(m=new Vt(st)),m=m.insert(h,f),u.Vu[u.currentUser.toKey()]=m})(r,a.batchId,n),await Zu(r,a.changes),await sm(r.remoteStore)}catch(a){const o=_0(a,"Failed to persist write");n.reject(o)}}async function kC(t,e){const n=Ge(t);try{const r=await CN(n.localStore,e);e.targetChanges.forEach(((a,o)=>{const u=n.Au.get(o);u&&(yt(a.addedDocuments.size+a.modifiedDocuments.size+a.removedDocuments.size<=1,22616),a.addedDocuments.size>0?u.hu=!0:a.modifiedDocuments.size>0?yt(u.hu,14607):a.removedDocuments.size>0&&(yt(u.hu,42227),u.hu=!1))})),await Zu(n,r,e)}catch(r){await Jl(r)}}function rw(t,e,n){const r=Ge(t);if(r.isPrimaryClient&&n===0||!r.isPrimaryClient&&n===1){const a=[];r.Tu.forEach(((o,u)=>{const h=u.view.va(e);h.snapshot&&a.push(h.snapshot)})),(function(u,h){const f=Ge(u);f.onlineState=h;let m=!1;f.queries.forEach(((g,_)=>{for(const v of _.Sa)v.va(h)&&(m=!0)})),m&&b0(f)})(r.eventManager,e),a.length&&r.Pu.H_(a),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function fP(t,e,n){const r=Ge(t);r.sharedClientState.updateQueryState(e,"rejected",n);const a=r.Au.get(e),o=a&&a.key;if(o){let u=new Vt(Pe.comparator);u=u.insert(o,Bn.newNoDocument(o,qe.min()));const h=it().add(o),f=new tm(qe.min(),new Map,new Vt(st),u,h);await kC(r,f),r.du=r.du.remove(o),r.Au.delete(e),x0(r)}else await by(r.localStore,e,!1).then((()=>Sy(r,e,n))).catch(Jl)}async function mP(t,e){const n=Ge(t),r=e.batch.batchId;try{const a=await EN(n.localStore,e);NC(n,r,null),OC(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await Zu(n,a)}catch(a){await Jl(a)}}async function pP(t,e,n){const r=Ge(t);try{const a=await(function(u,h){const f=Ge(u);return f.persistence.runTransaction("Reject batch","readwrite-primary",(m=>{let g;return f.mutationQueue.lookupMutationBatch(m,h).next((_=>(yt(_!==null,37113),g=_.keys(),f.mutationQueue.removeMutationBatch(m,_)))).next((()=>f.mutationQueue.performConsistencyCheck(m))).next((()=>f.documentOverlayCache.removeOverlaysForBatchId(m,g,h))).next((()=>f.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(m,g))).next((()=>f.localDocuments.getDocuments(m,g)))}))})(r.localStore,e);NC(r,e,n),OC(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),await Zu(r,a)}catch(a){await Jl(a)}}function OC(t,e){(t.mu.get(e)||[]).forEach((n=>{n.resolve()})),t.mu.delete(e)}function NC(t,e,n){const r=Ge(t);let a=r.Vu[r.currentUser.toKey()];if(a){const o=a.get(e);o&&(n?o.reject(n):o.resolve(),a=a.remove(e)),r.Vu[r.currentUser.toKey()]=a}}function Sy(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.Iu.get(e))t.Tu.delete(r),n&&t.Pu.yu(r,n);t.Iu.delete(e),t.isPrimaryClient&&t.Ru.jr(e).forEach((r=>{t.Ru.containsKey(r)||PC(t,r)}))}function PC(t,e){t.Eu.delete(e.path.canonicalString());const n=t.du.get(e);n!==null&&(f0(t.remoteStore,n),t.du=t.du.remove(e),t.Au.delete(n),x0(t))}function sw(t,e,n){for(const r of n)r instanceof DC?(t.Ru.addReference(r.key,e),gP(t,r)):r instanceof IC?(Re(v0,"Document no longer in limbo: "+r.key),t.Ru.removeReference(r.key,e),t.Ru.containsKey(r.key)||PC(t,r.key)):Fe(19791,{wu:r})}function gP(t,e){const n=e.key,r=n.path.canonicalString();t.du.get(n)||t.Eu.has(r)||(Re(v0,"New document in limbo: "+n),t.Eu.add(r),x0(t))}function x0(t){for(;t.Eu.size>0&&t.du.size<t.maxConcurrentLimboResolutions;){const e=t.Eu.values().next().value;t.Eu.delete(e);const n=new Pe(Rt.fromString(e)),r=t.fu.next();t.Au.set(r,new iP(n)),t.du=t.du.insert(n,r),xC(t.remoteStore,new sa(Ms(s0(n.path)),r,"TargetPurposeLimboResolution",Qf.ce))}}async function Zu(t,e,n){const r=Ge(t),a=[],o=[],u=[];r.Tu.isEmpty()||(r.Tu.forEach(((h,f)=>{u.push(r.pu(f,e,n).then((m=>{if((m||n)&&r.isPrimaryClient){const g=m?!m.fromCache:n?.targetChanges.get(f.targetId)?.current;r.sharedClientState.updateQueryState(f.targetId,g?"current":"not-current")}if(m){a.push(m);const g=d0.As(f.targetId,m);o.push(g)}})))})),await Promise.all(u),r.Pu.H_(a),await(async function(f,m){const g=Ge(f);try{await g.persistence.runTransaction("notifyLocalViewChanges","readwrite",(_=>ve.forEach(m,(v=>ve.forEach(v.Es,(S=>g.persistence.referenceDelegate.addReference(_,v.targetId,S))).next((()=>ve.forEach(v.ds,(S=>g.persistence.referenceDelegate.removeReference(_,v.targetId,S)))))))))}catch(_){if(!Zl(_))throw _;Re(h0,"Failed to update sequence numbers: "+_)}for(const _ of m){const v=_.targetId;if(!_.fromCache){const S=g.Ms.get(v),x=S.snapshotVersion,E=S.withLastLimboFreeSnapshotVersion(x);g.Ms=g.Ms.insert(v,E)}}})(r.localStore,o))}async function yP(t,e){const n=Ge(t);if(!n.currentUser.isEqual(e)){Re(v0,"User change. New user:",e.toKey());const r=await yC(n.localStore,e);n.currentUser=e,(function(o,u){o.mu.forEach((h=>{h.forEach((f=>{f.reject(new Te(_e.CANCELLED,u))}))})),o.mu.clear()})(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await Zu(n,r.Ls)}}function _P(t,e){const n=Ge(t),r=n.Au.get(e);if(r&&r.hu)return it().add(r.key);{let a=it();const o=n.Iu.get(e);if(!o)return a;for(const u of o){const h=n.Tu.get(u);a=a.unionWith(h.view.nu)}return a}}function BC(t){const e=Ge(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=kC.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=_P.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=fP.bind(null,e),e.Pu.H_=tP.bind(null,e.eventManager),e.Pu.yu=nP.bind(null,e.eventManager),e}function bP(t){const e=Ge(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=mP.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=pP.bind(null,e),e}class Af{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=nm(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,n){return null}Mu(e,n){return null}vu(e){return wN(this.persistence,new vN,e.initialUser,this.serializer)}Cu(e){return new gC(u0.mi,this.serializer)}Du(e){return new DN}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Af.provider={build:()=>new Af};class vP extends Af{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,n){yt(this.persistence.referenceDelegate instanceof Cf,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new iN(r,e.asyncQueue,n)}Cu(e){const n=this.cacheSizeBytes!==void 0?tr.withCacheSize(this.cacheSizeBytes):tr.DEFAULT;return new gC((r=>Cf.mi(r,n)),this.serializer)}}class wy{async initialize(e,n){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>rw(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=yP.bind(null,this.syncEngine),await JN(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new eP})()}createDatastore(e){const n=nm(e.databaseInfo.databaseId),r=(function(o){return new NN(o)})(e.databaseInfo);return(function(o,u,h,f){return new zN(o,u,h,f)})(e.authCredentials,e.appCheckCredentials,r,n)}createRemoteStore(e){return(function(r,a,o,u,h){return new FN(r,a,o,u,h)})(this.localStore,this.datastore,e.asyncQueue,(n=>rw(this.syncEngine,n,0)),(function(){return XS.v()?new XS:new IN})())}createSyncEngine(e,n){return(function(a,o,u,h,f,m,g){const _=new aP(a,o,u,h,f,m);return g&&(_.gu=!0),_})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,n)}async terminate(){await(async function(n){const r=Ge(n);Re(_o,"RemoteStore shutting down."),r.Ea.add(5),await Ju(r),r.Aa.shutdown(),r.Ra.set("Unknown")})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}wy.provider={build:()=>new wy};class LC{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):fi("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,n){setTimeout((()=>{this.muted||e(n)}),0)}}const ba="FirestoreClient";class xP{constructor(e,n,r,a,o){this.authCredentials=e,this.appCheckCredentials=n,this.asyncQueue=r,this.databaseInfo=a,this.user=Pn.UNAUTHENTICATED,this.clientId=Jy.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=o,this.authCredentials.start(r,(async u=>{Re(ba,"Received user=",u.uid),await this.authCredentialListener(u),this.user=u})),this.appCheckCredentials.start(r,(u=>(Re(ba,"Received new app check token=",u),this.appCheckCredentialListener(u,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new ci;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){const r=_0(n,"Failed to shutdown persistence");e.reject(r)}})),e.promise}}async function Pg(t,e){t.asyncQueue.verifyOperationInProgress(),Re(ba,"Initializing OfflineComponentProvider");const n=t.configuration;await e.initialize(n);let r=n.initialUser;t.setCredentialChangeListener((async a=>{r.isEqual(a)||(await yC(e.localStore,a),r=a)})),e.persistence.setDatabaseDeletedListener((()=>t.terminate())),t._offlineComponents=e}async function iw(t,e){t.asyncQueue.verifyOperationInProgress();const n=await SP(t);Re(ba,"Initializing OnlineComponentProvider"),await e.initialize(n,t.configuration),t.setCredentialChangeListener((r=>ZS(e.remoteStore,r))),t.setAppCheckTokenChangeListener(((r,a)=>ZS(e.remoteStore,a))),t._onlineComponents=e}async function SP(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){Re(ba,"Using user provided OfflineComponentProvider");try{await Pg(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!(function(a){return a.name==="FirebaseError"?a.code===_e.FAILED_PRECONDITION||a.code===_e.UNIMPLEMENTED:!(typeof DOMException<"u"&&a instanceof DOMException)||a.code===22||a.code===20||a.code===11})(n))throw n;Ml("Error using user provided cache. Falling back to memory cache: "+n),await Pg(t,new Af)}}else Re(ba,"Using default OfflineComponentProvider"),await Pg(t,new vP(void 0));return t._offlineComponents}async function zC(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(Re(ba,"Using user provided OnlineComponentProvider"),await iw(t,t._uninitializedComponentsProvider._online)):(Re(ba,"Using default OnlineComponentProvider"),await iw(t,new wy))),t._onlineComponents}function wP(t){return zC(t).then((e=>e.syncEngine))}async function UC(t){const e=await zC(t),n=e.eventManager;return n.onListen=oP.bind(null,e.syncEngine),n.onUnlisten=uP.bind(null,e.syncEngine),n.onFirstRemoteStoreListen=lP.bind(null,e.syncEngine),n.onLastRemoteStoreUnlisten=dP.bind(null,e.syncEngine),n}function EP(t,e,n={}){const r=new ci;return t.asyncQueue.enqueueAndForget((async()=>(function(o,u,h,f,m){const g=new LC({next:v=>{g.Nu(),u.enqueueAndForget((()=>jC(o,_)));const S=v.docs.has(h);!S&&v.fromCache?m.reject(new Te(_e.UNAVAILABLE,"Failed to get document because the client is offline.")):S&&v.fromCache&&f&&f.source==="server"?m.reject(new Te(_e.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):m.resolve(v)},error:v=>m.reject(v)}),_=new RC(s0(h.path),g,{includeMetadataChanges:!0,qa:!0});return AC(o,_)})(await UC(t),t.asyncQueue,e,n,r))),r.promise}function CP(t,e,n={}){const r=new ci;return t.asyncQueue.enqueueAndForget((async()=>(function(o,u,h,f,m){const g=new LC({next:v=>{g.Nu(),u.enqueueAndForget((()=>jC(o,_))),v.fromCache&&f.source==="server"?m.reject(new Te(_e.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):m.resolve(v)},error:v=>m.reject(v)}),_=new RC(h,g,{includeMetadataChanges:!0,qa:!0});return AC(o,_)})(await UC(t),t.asyncQueue,e,n,r))),r.promise}function FC(t){const e={};return t.timeoutSeconds!==void 0&&(e.timeoutSeconds=t.timeoutSeconds),e}const aw=new Map;const VC="firestore.googleapis.com",ow=!0;class lw{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new Te(_e.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=VC,this.ssl=ow}else this.host=e.host,this.ssl=e.ssl??ow;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=pC;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<rN)throw new Te(_e.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}Uk("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=FC(e.experimentalLongPollingOptions??{}),(function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new Te(_e.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new Te(_e.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new Te(_e.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(r,a){return r.timeoutSeconds===a.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class im{constructor(e,n,r,a){this._authCredentials=e,this._appCheckCredentials=n,this._databaseId=r,this._app=a,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new lw({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Te(_e.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new Te(_e.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new lw(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(r){if(!r)return new Dk;switch(r.type){case"firstParty":return new Ok(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new Te(_e.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(n){const r=aw.get(n);r&&(Re("ComponentProvider","Removing Datastore"),aw.delete(n),r.terminate())})(this),Promise.resolve()}}function TP(t,e,n,r={}){t=rs(t,im);const a=Hl(e),o=t._getSettings(),u={...o,emulatorOptions:t._getEmulatorOptions()},h=`${e}:${n}`;a&&(_E(`https://${h}`),bE("Firestore",!0)),o.host!==VC&&o.host!==h&&Ml("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const f={...o,host:h,ssl:a,emulatorOptions:r};if(!fa(f,u)&&(t._setSettings(f),r.mockUserToken)){let m,g;if(typeof r.mockUserToken=="string")m=r.mockUserToken,g=Pn.MOCK_USER;else{m=U5(r.mockUserToken,t._app?.options.projectId);const _=r.mockUserToken.sub||r.mockUserToken.user_id;if(!_)throw new Te(_e.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");g=new Pn(_)}t._authCredentials=new Ik(new A1(m,g))}}class tc{constructor(e,n,r){this.converter=n,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new tc(this.firestore,e,this._query)}}class Yt{constructor(e,n,r){this.converter=n,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new ha(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Yt(this.firestore,e,this._key)}toJSON(){return{type:Yt._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,n,r){if(Wu(n,Yt._jsonSchema))return new Yt(e,r||null,new Pe(Rt.fromString(n.referencePath)))}}Yt._jsonSchemaVersion="firestore/documentReference/1.0",Yt._jsonSchema={type:cn("string",Yt._jsonSchemaVersion),referencePath:cn("string")};class ha extends tc{constructor(e,n,r){super(e,n,s0(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Yt(this.firestore,null,new Pe(e))}withConverter(e){return new ha(this.firestore,e,this._path)}}function AP(t,e,...n){if(t=un(t),j1("collection","path",e),t instanceof im){const r=Rt.fromString(e,...n);return xS(r),new ha(t,null,r)}{if(!(t instanceof Yt||t instanceof ha))throw new Te(_e.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(Rt.fromString(e,...n));return xS(r),new ha(t.firestore,null,r)}}function nc(t,e,...n){if(t=un(t),arguments.length===1&&(e=Jy.newId()),j1("doc","path",e),t instanceof im){const r=Rt.fromString(e,...n);return vS(r),new Yt(t,null,new Pe(r))}{if(!(t instanceof Yt||t instanceof ha))throw new Te(_e.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(Rt.fromString(e,...n));return vS(r),new Yt(t.firestore,t instanceof ha?t.converter:null,new Pe(r))}}const cw="AsyncQueue";class uw{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new bC(this,"async_queue_retry"),this._c=()=>{const r=Ng();r&&Re(cw,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=e;const n=Ng();n&&typeof n.addEventListener=="function"&&n.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const n=Ng();n&&typeof n.removeEventListener=="function"&&n.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise((()=>{}));const n=new ci;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(e().then(n.resolve,n.reject),n.promise))).then((()=>n.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Xu.push(e),this.lc())))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!Zl(e))throw e;Re(cw,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_((()=>this.lc()))}}cc(e){const n=this.ac.then((()=>(this.rc=!0,e().catch((r=>{throw this.nc=r,this.rc=!1,fi("INTERNAL UNHANDLED ERROR: ",dw(r)),r})).then((r=>(this.rc=!1,r))))));return this.ac=n,n}enqueueAfterDelay(e,n,r){this.uc(),this.oc.indexOf(e)>-1&&(n=0);const a=y0.createAndSchedule(this,e,n,r,(o=>this.hc(o)));return this.tc.push(a),a}uc(){this.nc&&Fe(47125,{Pc:dw(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const n of this.tc)if(n.timerId===e)return!0;return!1}Ec(e){return this.Tc().then((()=>{this.tc.sort(((n,r)=>n.targetTimeMs-r.targetTimeMs));for(const n of this.tc)if(n.skipDelay(),e!=="all"&&n.timerId===e)break;return this.Tc()}))}dc(e){this.oc.push(e)}hc(e){const n=this.tc.indexOf(e);this.tc.splice(n,1)}}function dw(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+`
`+t.stack),e}class Eo extends im{constructor(e,n,r,a){super(e,n,r,a),this.type="firestore",this._queue=new uw,this._persistenceKey=a?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new uw(e),this._firestoreClient=void 0,await e}}}function jP(t,e){const n=typeof t=="object"?t:wE(),r=typeof t=="string"?t:_f,a=Ly(n,"firestore").getImmediate({identifier:r});if(!a._initialized){const o=L5("firestore");o&&TP(a,...o)}return a}function am(t){if(t._terminated)throw new Te(_e.FAILED_PRECONDITION,"The client has already been terminated.");return t._firestoreClient||RP(t),t._firestoreClient}function RP(t){const e=t._freezeSettings(),n=(function(a,o,u,h){return new Xk(a,o,u,h.host,h.ssl,h.experimentalForceLongPolling,h.experimentalAutoDetectLongPolling,FC(h.experimentalLongPollingOptions),h.useFetchStreams,h.isUsingEmulator)})(t._databaseId,t._app?.options.appId||"",t._persistenceKey,e);t._componentsProvider||e.localCache?._offlineComponentProvider&&e.localCache?._onlineComponentProvider&&(t._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),t._firestoreClient=new xP(t._authCredentials,t._appCheckCredentials,t._queue,n,t._componentsProvider&&(function(a){const o=a?._online.build();return{_offline:a?._offline.build(o),_online:o}})(t._componentsProvider))}class Br{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Br(Mn.fromBase64String(e))}catch(n){throw new Te(_e.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+n)}}static fromUint8Array(e){return new Br(Mn.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:Br._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(Wu(e,Br._jsonSchema))return Br.fromBase64String(e.bytes)}}Br._jsonSchemaVersion="firestore/bytes/1.0",Br._jsonSchema={type:cn("string",Br._jsonSchemaVersion),bytes:cn("string")};class ed{constructor(...e){for(let n=0;n<e.length;++n)if(e[n].length===0)throw new Te(_e.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Dn(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class om{constructor(e){this._methodName=e}}class Os{constructor(e,n){if(!isFinite(e)||e<-90||e>90)throw new Te(_e.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(n)||n<-180||n>180)throw new Te(_e.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=e,this._long=n}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return st(this._lat,e._lat)||st(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Os._jsonSchemaVersion}}static fromJSON(e){if(Wu(e,Os._jsonSchema))return new Os(e.latitude,e.longitude)}}Os._jsonSchemaVersion="firestore/geoPoint/1.0",Os._jsonSchema={type:cn("string",Os._jsonSchemaVersion),latitude:cn("number"),longitude:cn("number")};class Ns{constructor(e){this._values=(e||[]).map((n=>n))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(r,a){if(r.length!==a.length)return!1;for(let o=0;o<r.length;++o)if(r[o]!==a[o])return!1;return!0})(this._values,e._values)}toJSON(){return{type:Ns._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(Wu(e,Ns._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every((n=>typeof n=="number")))return new Ns(e.vectorValues);throw new Te(_e.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Ns._jsonSchemaVersion="firestore/vectorValue/1.0",Ns._jsonSchema={type:cn("string",Ns._jsonSchemaVersion),vectorValues:cn("object")};const DP=/^__.*__$/;class IP{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return this.fieldMask!==null?new Ca(e,this.data,this.fieldMask,n,this.fieldTransforms):new Yu(e,this.data,n,this.fieldTransforms)}}class $C{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return new Ca(e,this.data,this.fieldMask,n,this.fieldTransforms)}}function qC(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Fe(40011,{Ac:t})}}class lm{constructor(e,n,r,a,o,u){this.settings=e,this.databaseId=n,this.serializer=r,this.ignoreUndefinedProperties=a,o===void 0&&this.Rc(),this.fieldTransforms=o||[],this.fieldMask=u||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new lm({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){const n=this.path?.child(e),r=this.Vc({path:n,fc:!1});return r.gc(e),r}yc(e){const n=this.path?.child(e),r=this.Vc({path:n,fc:!1});return r.Rc(),r}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return jf(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find((n=>e.isPrefixOf(n)))!==void 0||this.fieldTransforms.find((n=>e.isPrefixOf(n.field)))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(qC(this.Ac)&&DP.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class MP{constructor(e,n,r){this.databaseId=e,this.ignoreUndefinedProperties=n,this.serializer=r||nm(e)}Cc(e,n,r,a=!1){return new lm({Ac:e,methodName:n,Dc:r,path:Dn.emptyPath(),fc:!1,bc:a},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function cm(t){const e=t._freezeSettings(),n=nm(t._databaseId);return new MP(t._databaseId,!!e.ignoreUndefinedProperties,n)}function HC(t,e,n,r,a,o={}){const u=t.Cc(o.merge||o.mergeFields?2:0,e,n,a);w0("Data must be an object, but it was:",u,r);const h=WC(r,u);let f,m;if(o.merge)f=new pr(u.fieldMask),m=u.fieldTransforms;else if(o.mergeFields){const g=[];for(const _ of o.mergeFields){const v=Ey(e,_,n);if(!u.contains(v))throw new Te(_e.INVALID_ARGUMENT,`Field '${v}' is specified in your field mask but missing from your input data.`);YC(g,v)||g.push(v)}f=new pr(g),m=u.fieldTransforms.filter((_=>f.covers(_.field)))}else f=null,m=u.fieldTransforms;return new IP(new nr(h),f,m)}class td extends om{_toFieldTransform(e){if(e.Ac!==2)throw e.Ac===1?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof td}}function kP(t,e,n){return new lm({Ac:3,Dc:e.settings.Dc,methodName:t._methodName,fc:n},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class S0 extends om{constructor(e,n){super(e),this.vc=n}_toFieldTransform(e){const n=kP(this,e,!0),r=this.vc.map((o=>rc(o,n))),a=new Pl(r);return new wO(e.path,a)}isEqual(e){return e instanceof S0&&fa(this.vc,e.vc)}}function GC(t,e,n,r){const a=t.Cc(1,e,n);w0("Data must be an object, but it was:",a,r);const o=[],u=nr.empty();Ea(r,((f,m)=>{const g=E0(e,f,n);m=un(m);const _=a.yc(g);if(m instanceof td)o.push(g);else{const v=rc(m,_);v!=null&&(o.push(g),u.set(g,v))}}));const h=new pr(o);return new $C(u,h,a.fieldTransforms)}function QC(t,e,n,r,a,o){const u=t.Cc(1,e,n),h=[Ey(e,r,n)],f=[a];if(o.length%2!=0)throw new Te(_e.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let v=0;v<o.length;v+=2)h.push(Ey(e,o[v])),f.push(o[v+1]);const m=[],g=nr.empty();for(let v=h.length-1;v>=0;--v)if(!YC(m,h[v])){const S=h[v];let x=f[v];x=un(x);const E=u.yc(S);if(x instanceof td)m.push(S);else{const C=rc(x,E);C!=null&&(m.push(S),g.set(S,C))}}const _=new pr(m);return new $C(g,_,u.fieldTransforms)}function OP(t,e,n,r=!1){return rc(n,t.Cc(r?4:3,e))}function rc(t,e){if(KC(t=un(t)))return w0("Unsupported field value:",e,t),WC(t,e);if(t instanceof om)return(function(r,a){if(!qC(a.Ac))throw a.Sc(`${r._methodName}() can only be used with update() and set()`);if(!a.path)throw a.Sc(`${r._methodName}() is not currently supported inside arrays`);const o=r._toFieldTransform(a);o&&a.fieldTransforms.push(o)})(t,e),null;if(t===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return(function(r,a){const o=[];let u=0;for(const h of r){let f=rc(h,a.wc(u));f==null&&(f={nullValue:"NULL_VALUE"}),o.push(f),u++}return{arrayValue:{values:o}}})(t,e)}return(function(r,a){if((r=un(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return vO(a.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const o=kt.fromDate(r);return{timestampValue:Ef(a.serializer,o)}}if(r instanceof kt){const o=new kt(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Ef(a.serializer,o)}}if(r instanceof Os)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Br)return{bytesValue:lC(a.serializer,r._byteString)};if(r instanceof Yt){const o=a.databaseId,u=r.firestore._databaseId;if(!u.isEqual(o))throw a.Sc(`Document reference is for database ${u.projectId}/${u.database} but should be for database ${o.projectId}/${o.database}`);return{referenceValue:l0(r.firestore._databaseId||a.databaseId,r._key.path)}}if(r instanceof Ns)return(function(u,h){return{mapValue:{fields:{[B1]:{stringValue:L1},[bf]:{arrayValue:{values:u.toArray().map((m=>{if(typeof m!="number")throw h.Sc("VectorValues must only contain numeric values.");return i0(h.serializer,m)}))}}}}}})(r,a);throw a.Sc(`Unsupported field value: ${Gf(r)}`)})(t,e)}function WC(t,e){const n={};return I1(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Ea(t,((r,a)=>{const o=rc(a,e.mc(r));o!=null&&(n[r]=o)})),{mapValue:{fields:n}}}function KC(t){return!(typeof t!="object"||t===null||t instanceof Array||t instanceof Date||t instanceof kt||t instanceof Os||t instanceof Br||t instanceof Yt||t instanceof om||t instanceof Ns)}function w0(t,e,n){if(!KC(n)||!R1(n)){const r=Gf(n);throw r==="an object"?e.Sc(t+" a custom object"):e.Sc(t+" "+r)}}function Ey(t,e,n){if((e=un(e))instanceof ed)return e._internalPath;if(typeof e=="string")return E0(t,e);throw jf("Field path arguments must be of type string or ",t,!1,void 0,n)}const NP=new RegExp("[~\\*/\\[\\]]");function E0(t,e,n){if(e.search(NP)>=0)throw jf(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new ed(...e.split("."))._internalPath}catch{throw jf(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function jf(t,e,n,r,a){const o=r&&!r.isEmpty(),u=a!==void 0;let h=`Function ${e}() called with invalid data`;n&&(h+=" (via `toFirestore()`)"),h+=". ";let f="";return(o||u)&&(f+=" (found",o&&(f+=` in field ${r}`),u&&(f+=` in document ${a}`),f+=")"),new Te(_e.INVALID_ARGUMENT,h+t+f)}function YC(t,e){return t.some((n=>n.isEqual(e)))}class XC{constructor(e,n,r,a,o){this._firestore=e,this._userDataWriter=n,this._key=r,this._document=a,this._converter=o}get id(){return this._key.path.lastSegment()}get ref(){return new Yt(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new PP(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const n=this._document.data.field(C0("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n)}}}class PP extends XC{data(){return super.data()}}function C0(t,e){return typeof e=="string"?E0(t,e):e instanceof ed?e._internalPath:e._delegate._internalPath}function BP(t){if(t.limitType==="L"&&t.explicitOrderBy.length===0)throw new Te(_e.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class T0{}class LP extends T0{}function zP(t,e,...n){let r=[];e instanceof T0&&r.push(e),r=r.concat(n),(function(o){const u=o.filter((f=>f instanceof A0)).length,h=o.filter((f=>f instanceof um)).length;if(u>1||u>0&&h>0)throw new Te(_e.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")})(r);for(const a of r)t=a._apply(t);return t}class um extends LP{constructor(e,n,r){super(),this._field=e,this._op=n,this._value=r,this.type="where"}static _create(e,n,r){return new um(e,n,r)}_apply(e){const n=this._parse(e);return JC(e._query,n),new tc(e.firestore,e.converter,fy(e._query,n))}_parse(e){const n=cm(e.firestore);return(function(o,u,h,f,m,g,_){let v;if(m.isKeyField()){if(g==="array-contains"||g==="array-contains-any")throw new Te(_e.INVALID_ARGUMENT,`Invalid Query. You can't perform '${g}' queries on documentId().`);if(g==="in"||g==="not-in"){fw(_,g);const x=[];for(const E of _)x.push(hw(f,o,E));v={arrayValue:{values:x}}}else v=hw(f,o,_)}else g!=="in"&&g!=="not-in"&&g!=="array-contains-any"||fw(_,g),v=OP(h,u,_,g==="in"||g==="not-in");return ln.create(m,g,v)})(e._query,"where",n,e.firestore._databaseId,this._field,this._op,this._value)}}function UP(t,e,n){const r=e,a=C0("where",t);return um._create(a,r,n)}class A0 extends T0{constructor(e,n){super(),this.type=e,this._queryConstraints=n}static _create(e,n){return new A0(e,n)}_parse(e){const n=this._queryConstraints.map((r=>r._parse(e))).filter((r=>r.getFilters().length>0));return n.length===1?n[0]:ss.create(n,this._getOperator())}_apply(e){const n=this._parse(e);return n.getFilters().length===0?e:((function(a,o){let u=a;const h=o.getFlattenedFilters();for(const f of h)JC(u,f),u=fy(u,f)})(e._query,n),new tc(e.firestore,e.converter,fy(e._query,n)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function hw(t,e,n){if(typeof(n=un(n))=="string"){if(n==="")throw new Te(_e.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!G1(e)&&n.indexOf("/")!==-1)throw new Te(_e.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=e.path.child(Rt.fromString(n));if(!Pe.isDocumentKey(r))throw new Te(_e.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return RS(t,new Pe(r))}if(n instanceof Yt)return RS(t,n._key);throw new Te(_e.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Gf(n)}.`)}function fw(t,e){if(!Array.isArray(t)||t.length===0)throw new Te(_e.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function JC(t,e){const n=(function(a,o){for(const u of a)for(const h of u.getFlattenedFilters())if(o.indexOf(h.op)>=0)return h.op;return null})(t.filters,(function(a){switch(a){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(e.op));if(n!==null)throw n===e.op?new Te(_e.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new Te(_e.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}class FP{convertValue(e,n="none"){switch(ya(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Kt(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,n);case 5:return e.stringValue;case 6:return this.convertBytes(ga(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,n);case 11:return this.convertObject(e.mapValue,n);case 10:return this.convertVectorValue(e.mapValue);default:throw Fe(62114,{value:e})}}convertObject(e,n){return this.convertObjectMap(e.fields,n)}convertObjectMap(e,n="none"){const r={};return Ea(e,((a,o)=>{r[a]=this.convertValue(o,n)})),r}convertVectorValue(e){const n=e.fields?.[bf].arrayValue?.values?.map((r=>Kt(r.doubleValue)));return new Ns(n)}convertGeoPoint(e){return new Os(Kt(e.latitude),Kt(e.longitude))}convertArray(e,n){return(e.values||[]).map((r=>this.convertValue(r,n)))}convertServerTimestamp(e,n){switch(n){case"previous":const r=Kf(e);return r==null?null:this.convertValue(r,n);case"estimate":return this.convertTimestamp(Du(e));default:return null}}convertTimestamp(e){const n=pa(e);return new kt(n.seconds,n.nanos)}convertDocumentKey(e,n){const r=Rt.fromString(e);yt(mC(r),9688,{name:e});const a=new Iu(r.get(1),r.get(3)),o=new Pe(r.popFirst(5));return a.isEqual(n)||fi(`Document ${o} contains a document reference within a different database (${a.projectId}/${a.database}) which is not supported. It will be treated as a reference in the current database (${n.projectId}/${n.database}) instead.`),o}}function ZC(t,e,n){let r;return r=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,r}class yu{constructor(e,n){this.hasPendingWrites=e,this.fromCache=n}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class uo extends XC{constructor(e,n,r,a,o,u){super(e,n,r,a,u),this._firestore=e,this._firestoreImpl=e,this.metadata=o}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const n=new nf(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(n,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,n={}){if(this._document){const r=this._document.data.field(C0("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,n.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new Te(_e.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,n={};return n.type=uo._jsonSchemaVersion,n.bundle="",n.bundleSource="DocumentSnapshot",n.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?n:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),n.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),n)}}uo._jsonSchemaVersion="firestore/documentSnapshot/1.0",uo._jsonSchema={type:cn("string",uo._jsonSchemaVersion),bundleSource:cn("string","DocumentSnapshot"),bundleName:cn("string"),bundle:cn("string")};class nf extends uo{data(e={}){return super.data(e)}}class Rl{constructor(e,n,r,a){this._firestore=e,this._userDataWriter=n,this._snapshot=a,this.metadata=new yu(a.hasPendingWrites,a.fromCache),this.query=r}get docs(){const e=[];return this.forEach((n=>e.push(n))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,n){this._snapshot.docs.forEach((r=>{e.call(n,new nf(this._firestore,this._userDataWriter,r.key,r,new yu(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const n=!!e.includeMetadataChanges;if(n&&this._snapshot.excludesMetadataChanges)throw new Te(_e.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===n||(this._cachedChanges=(function(a,o){if(a._snapshot.oldDocs.isEmpty()){let u=0;return a._snapshot.docChanges.map((h=>{const f=new nf(a._firestore,a._userDataWriter,h.doc.key,h.doc,new yu(a._snapshot.mutatedKeys.has(h.doc.key),a._snapshot.fromCache),a.query.converter);return h.doc,{type:"added",doc:f,oldIndex:-1,newIndex:u++}}))}{let u=a._snapshot.oldDocs;return a._snapshot.docChanges.filter((h=>o||h.type!==3)).map((h=>{const f=new nf(a._firestore,a._userDataWriter,h.doc.key,h.doc,new yu(a._snapshot.mutatedKeys.has(h.doc.key),a._snapshot.fromCache),a.query.converter);let m=-1,g=-1;return h.type!==0&&(m=u.indexOf(h.doc.key),u=u.delete(h.doc.key)),h.type!==1&&(u=u.add(h.doc),g=u.indexOf(h.doc.key)),{type:VP(h.type),doc:f,oldIndex:m,newIndex:g}}))}})(this,n),this._cachedChangesIncludeMetadataChanges=n),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new Te(_e.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=Rl._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=Jy.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const n=[],r=[],a=[];return this.docs.forEach((o=>{o._document!==null&&(n.push(o._document),r.push(this._userDataWriter.convertObjectMap(o._document.data.value.mapValue.fields,"previous")),a.push(o.ref.path))})),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function VP(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Fe(61501,{type:t})}}function $P(t){t=rs(t,Yt);const e=rs(t.firestore,Eo);return EP(am(e),t._key).then((n=>WP(e,t,n)))}Rl._jsonSchemaVersion="firestore/querySnapshot/1.0",Rl._jsonSchema={type:cn("string",Rl._jsonSchemaVersion),bundleSource:cn("string","QuerySnapshot"),bundleName:cn("string"),bundle:cn("string")};class eT extends FP{constructor(e){super(),this.firestore=e}convertBytes(e){return new Br(e)}convertReference(e){const n=this.convertDocumentKey(e,this.firestore._databaseId);return new Yt(this.firestore,null,n)}}function qP(t){t=rs(t,tc);const e=rs(t.firestore,Eo),n=am(e),r=new eT(e);return BP(t._query),CP(n,t._query).then((a=>new Rl(e,r,t,a)))}function HP(t,e,n){t=rs(t,Yt);const r=rs(t.firestore,Eo),a=ZC(t.converter,e,n);return dm(r,[HC(cm(r),"setDoc",t._key,a,t.converter!==null,n).toMutation(t._key,rr.none())])}function GP(t,e,n,...r){t=rs(t,Yt);const a=rs(t.firestore,Eo),o=cm(a);let u;return u=typeof(e=un(e))=="string"||e instanceof ed?QC(o,"updateDoc",t._key,e,n,r):GC(o,"updateDoc",t._key,e),dm(a,[u.toMutation(t._key,rr.exists(!0))])}function QP(t){return dm(rs(t.firestore,Eo),[new em(t._key,rr.none())])}function dm(t,e){return(function(r,a){const o=new ci;return r.asyncQueue.enqueueAndForget((async()=>hP(await wP(r),a,o))),o.promise})(am(t),e)}function WP(t,e,n){const r=n.docs.get(e._key),a=new eT(t);return new uo(t,a,e._key,r,new yu(n.hasPendingWrites,n.fromCache),e.converter)}class KP{constructor(e,n){this._firestore=e,this._commitHandler=n,this._mutations=[],this._committed=!1,this._dataReader=cm(e)}set(e,n,r){this._verifyNotCommitted();const a=Bg(e,this._firestore),o=ZC(a.converter,n,r),u=HC(this._dataReader,"WriteBatch.set",a._key,o,a.converter!==null,r);return this._mutations.push(u.toMutation(a._key,rr.none())),this}update(e,n,r,...a){this._verifyNotCommitted();const o=Bg(e,this._firestore);let u;return u=typeof(n=un(n))=="string"||n instanceof ed?QC(this._dataReader,"WriteBatch.update",o._key,n,r,a):GC(this._dataReader,"WriteBatch.update",o._key,n),this._mutations.push(u.toMutation(o._key,rr.exists(!0))),this}delete(e){this._verifyNotCommitted();const n=Bg(e,this._firestore);return this._mutations=this._mutations.concat(new em(n._key,rr.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new Te(_e.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Bg(t,e){if((t=un(t)).firestore!==e)throw new Te(_e.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}function mw(){return new td("deleteField")}function YP(...t){return new S0("arrayUnion",t)}function tT(t){return am(t=rs(t,Eo)),new KP(t,(e=>dm(t,e)))}(function(e,n=!0){(function(a){Xl=a})(Gl),Dl(new fo("firestore",((r,{instanceIdentifier:a,options:o})=>{const u=r.getProvider("app").getImmediate(),h=new Eo(new Mk(r.getProvider("auth-internal")),new Nk(u,r.getProvider("app-check-internal")),(function(m,g){if(!Object.prototype.hasOwnProperty.apply(m.options,["projectId"]))throw new Te(_e.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Iu(m.options.projectId,g)})(u,a),u);return o={useFetchStreams:n,...o},h._setSettings(o),h}),"PUBLIC").setMultipleInstances(!0)),la(gS,yS,e),la(gS,yS,"esm2020")})();function Co(){return jP(i1)}const $n={showGroupTotals:!1};function To(t,e,n,r=1,a,o){let u=e;if(e.startsWith("budgets/"))u="budgets";else if(e.startsWith("months/")){const g=e.replace("months/","").split("_");if(g.length>=2){const _=g[g.length-1];u=`months/${g[g.length-2]}/${_}`}}console.log(`[Firebase] ${t}(${r}): ${u}${a===!1?" [NOT FOUND]":""}`)}async function Qe(t,e,n){const r=nc(Co(),t,e),a=`${t}/${e}`,o=await $P(r),u=o.exists(),h=u?o.data():null;return To("READ",a,n,1,u),{exists:u,data:h,ref:r}}async function Ot(t,e,n){const r=Co(),a=AP(r,t);let o;if(n&&n.length>0){const m=n.map(g=>UP(g.field,g.op,g.value));o=zP(a,...m)}else o=a;const u=await qP(o),h=u.docs.map(m=>({id:m.id,data:m.data()}));let f=t;if(n&&n.length>0){const m=n.map(g=>`${g.field} ${g.op} ${JSON.stringify(g.value)}`).join(", ");f+=` WHERE ${m}`}return To("QUERY",f,e,u.docs.length,void 0),{docs:h}}async function ft(t,e,n,r,a){const o=nc(Co(),t,e),u=`${t}/${e}`;return To("WRITE",u,r,1,void 0),HP(o,n,a??{})}async function hm(t,e){const r=Co();for(let a=0;a<t.length;a+=500){const o=t.slice(a,a+500),u=tT(r);for(const{collectionPath:h,docId:f,data:m}of o){const g=nc(r,h,f);u.set(g,m)}To("BATCH_WRITE",`${o.length} docs`,e,o.length,void 0),await u.commit()}}async function zl(t,e,n,r){const a=nc(Co(),t,e),o=`${t}/${e}`;return To("UPDATE",o,r,1,void 0),GP(a,n)}async function Ou(t,e,n){const r=nc(Co(),t,e),a=`${t}/${e}`;return To("DELETE",a),QP(r)}async function nT(t,e,n){const a=Co();for(let o=0;o<t.length;o+=500){const u=t.slice(o,o+500),h=tT(a);for(const{collectionPath:f,docId:m}of u){const g=nc(a,f,m);h.delete(g)}To("BATCH_DELETE",`${u.length} docs`,e,u.length),await h.commit(),n?.(o+u.length)}}function XP(t={}){const e={};return Object.entries(t).forEach(([n,r])=>{e[n]={nickname:r.nickname??"",description:r.description??"",balance:r.balance??0,account_group_id:r.account_group_id??null,sort_order:r.sort_order??0,is_income_account:r.is_income_account??!1,is_income_default:r.is_income_default??!1,is_outgo_account:r.is_outgo_account??!1,is_outgo_default:r.is_outgo_default??!1,on_budget:r.on_budget??!0,is_active:r.is_active??!0}}),e}function JP(t={}){const e={};return Object.entries(t).forEach(([n,r])=>{e[n]={name:r.name,sort_order:r.sort_order??0,expected_balance:r.expected_balance??"positive",on_budget:r.on_budget,is_active:r.is_active}}),e}function ZP(t={}){const e={};return Object.entries(t).forEach(([n,r])=>{e[n]={name:r.name,description:r.description,category_group_id:r.category_group_id??null,sort_order:r.sort_order??0,default_monthly_amount:r.default_monthly_amount,default_monthly_type:r.default_monthly_type,balance:r.balance??0}}),e}function e4(t=[]){const e=t.map(n=>({id:n.id,name:n.name,sort_order:n.sort_order??0}));return e.sort((n,r)=>n.sort_order-r.sort_order),e}function t4(t={}){const e={};return Object.entries(t).forEach(([n,r])=>{e[n]={needs_recalculation:r?.needs_recalculation??!1}}),e}async function n4(t){const{exists:e,data:n}=await Qe("budgets",t,"loading budget data (cache miss or stale)");if(!e||!n)throw new Error(`Budget ${t} not found`);const r=XP(n.accounts),a=JP(n.account_groups),o=ZP(n.categories),u=e4(n.category_groups),h=n.total_available??0,f=t4(n.month_map),m=n.is_needs_recalculation??!1;return{budget:{id:t,name:n.name,user_ids:n.user_ids||[],accepted_user_ids:n.accepted_user_ids||[],owner_id:n.owner_id||n.user_ids?.[0]||"",owner_email:n.owner_email||"",accounts:r,account_groups:a,categories:o,category_groups:u,total_available:h,is_needs_recalculation:m,month_map:f},accounts:r,accountGroups:a,categories:o,categoryGroups:u,isNeedsRecalculation:m,monthMap:f}}function rT(t,e){return Yl({queryKey:t?xe.budget(t):["budget","none"],queryFn:()=>n4(t),enabled:!!t&&e?.enabled!==!1})}function yr(t,e,n){const r=n.toString().padStart(2,"0");return`${t}_${e}_${r}`}function Rf(t,e){return e===1?{year:t-1,month:12}:{year:t,month:e-1}}function r4(t,e){return e===12?{year:t+1,month:1}:{year:t,month:e+1}}function At(t,e){return`${t}${e.toString().padStart(2,"0")}`}function Cy(t){return new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit"})}function we(t){return Math.round((t+Number.EPSILON)*100)/100}function ut(t){if(t==null||isNaN(t))return!1;const e=t*100;return Math.abs(e-Math.round(e))>1e-9}function s4(t,e,n,r){return{budget_id:e,year_month_ordinal:t.year_month_ordinal??At(n,r),year:t.year??n,month:t.month??r,income:t.income||[],total_income:t.total_income??0,previous_month_income:t.previous_month_income??0,expenses:t.expenses||[],total_expenses:t.total_expenses??0,transfers:t.transfers||[],adjustments:t.adjustments||[],account_balances:t.account_balances||[],category_balances:t.category_balances||[],are_allocations_finalized:t.are_allocations_finalized??!1,created_at:t.created_at,updated_at:t.updated_at}}async function i4(t,e,n,r){const a=yr(t,e,n);return(await Ve.fetchQuery({queryKey:xe.month(t,e,n),queryFn:async()=>{const{exists:u,data:h}=await Qe("months",a,r?.description??`reading month ${e}/${n}`);return!u||!h?null:{month:s4(h,t,e,n)}},staleTime:b1}))?.month??null}function a4(t,e,n,r){return{budget_id:e,year_month_ordinal:t.year_month_ordinal??At(n,r),year:t.year??n,month:t.month??r,income:t.income||[],total_income:t.total_income??0,previous_month_income:t.previous_month_income??0,expenses:t.expenses||[],total_expenses:t.total_expenses??0,transfers:t.transfers||[],adjustments:t.adjustments||[],account_balances:t.account_balances||[],category_balances:t.category_balances||[],are_allocations_finalized:t.are_allocations_finalized??!1,created_at:t.created_at,updated_at:t.updated_at}}async function Un(t,e,n,r){const a=yr(t,e,n),o=r?`PRE-EDIT-READ: ${r}`:"PRE-EDIT-READ",{exists:u,data:h}=await Qe("months",a,o);if(!u||!h)throw new Error(`Month data not found for ${e}/${n}`);return a4(h,t,e,n)}async function o4(t,e,n){const r=At(e,n);return(await Ot("months","getFutureMonths: querying months after specified month",[{field:"budget_id",op:"==",value:t},{field:"year_month_ordinal",op:">",value:r}])).docs.map(u=>({id:u.id,...u.data})).sort((u,h)=>u.year!==h.year?u.year-h.year:u.month-h.month)}function l4(t){const e={},n={};return t.category_balances&&t.category_balances.forEach(r=>{e[r.category_id]=r.end_balance}),t.account_balances&&t.account_balances.forEach(r=>{n[r.account_id]=r.end_balance}),{categoryEndBalances:e,accountEndBalances:n}}const oo={mobile:640,tablet:768,wide:1200},c4=oo.mobile,bo=["January","February","March","April","May","June","July","August","September","October","November","December"],Nu=3,Df=3;function u4(){const t=new Date,e=t.getFullYear(),n=t.getMonth()+1,r=[];for(let a=Df;a>0;a--){let o=e,u=n-a;for(;u<1;)u+=12,o-=1;r.push(At(o,u))}r.push(At(e,n));for(let a=1;a<=Nu;a++){let o=e,u=n+a;for(;u>12;)u-=12,o+=1;r.push(At(o,u))}return r}function d4(t,e){const n=xe.budget(t),r=Ve.getQueryData(n);if(!r?.monthMap)return!1;for(const[a,o]of Object.entries(r.monthMap))if(a>=e&&!o.needs_recalculation)return!1;return!0}function h4(t,e,n){const r=xe.budget(t),a=Ve.getQueryData(r);a&&Ve.setQueryData(r,{...a,isNeedsRecalculation:!0,monthMap:n,budget:{...a.budget,is_needs_recalculation:!0,month_map:n}})}function f4(t,e){const n=xe.budget(t),r=Ve.getQueryData(n);r&&Ve.setQueryData(n,{...r,monthMap:e,budget:{...r.budget,month_map:e}})}async function sT(t,e,n,r){const{bypassDateLimit:a=!1}=r??{},o=new Date,u=o.getFullYear(),h=o.getMonth()+1,f=(e-u)*12+(n-h);if(!a&&f>Nu){const A=`[createMonth] Refusing to create month ${e}/${n} - it's ${f} months in the future (max allowed: ${Nu}). This likely indicates a bug in month navigation.`;throw console.error(A),new Error(A)}if(!a&&f<-Df){const A=`[createMonth] Refusing to create month ${e}/${n} - it's ${Math.abs(f)} months in the past (max allowed: ${Df}). Existing months can still be viewed, but new months cannot be created this far back.`;throw console.error(A),new Error(A)}const{exists:m,data:g}=await Qe("budgets",t,"validating budget exists before creating month");if(!m||!g){Ve.removeQueries({queryKey:xe.budget(t)}),localStorage.removeItem("BUDGET_APP_QUERY_CACHE");const A=`[createMonth] Budget ${t} does not exist. It may have been deleted. Please refresh the page.`;throw console.error(A),new Error(A)}const _=o.toISOString(),v=yr(t,e,n);let S=0,x={},E={};if(n>1||e>new Date().getFullYear()-10){const{year:A,month:N}=Rf(e,n),L=yr(t,A,N);try{const{exists:P,data:B}=await Qe("months",L,"fetching previous month to create start balances for new month");if(P&&B){const O={budget_id:t,year_month_ordinal:B.year_month_ordinal??At(A,N),year:B.year??A,month:B.month??N,income:B.income||[],total_income:B.total_income??0,previous_month_income:B.previous_month_income??0,expenses:B.expenses||[],total_expenses:B.total_expenses??0,transfers:B.transfers||[],adjustments:B.adjustments||[],account_balances:B.account_balances||[],category_balances:B.category_balances||[],are_allocations_finalized:B.are_allocations_finalized??!1,created_at:B.created_at,updated_at:B.updated_at};S=O.total_income;const{categoryEndBalances:K,accountEndBalances:Y}=l4(O);x=K,E=Y}}catch(P){if(P instanceof Error&&P.message.includes("Missing or insufficient permissions"))console.warn(`[createMonth] Permission error reading previous month ${A}/${N}, starting with zero balances`);else throw P}}const C=Object.entries(x).map(([A,N])=>({category_id:A,start_balance:N,allocated:0,spent:0,end_balance:N})),I=Object.entries(E).map(([A,N])=>({account_id:A,start_balance:N,income:0,expenses:0,net_change:0,end_balance:N})),j={budget_id:t,year_month_ordinal:At(e,n),year:e,month:n,income:[],total_income:0,previous_month_income:S,expenses:[],total_expenses:0,transfers:[],adjustments:[],account_balances:I,category_balances:C,are_allocations_finalized:!1,created_at:_,updated_at:_},M={budget_id:t,year_month_ordinal:At(e,n),year:e,month:n,income:[],total_income:0,previous_month_income:S,expenses:[],total_expenses:0,transfers:[],adjustments:[],account_balances:I,category_balances:C,are_allocations_finalized:!1,created_at:_,updated_at:_};await ft("months",v,M,"creating new month document (first time viewing this month)"),Ve.setQueryData(xe.month(t,e,n),{month:j});const Q=At(e,n),G={...g.month_map||{},[Q]:{needs_recalculation:!1}},D=G;return f4(t,D),await zl("budgets",t,{month_map:D,updated_at:_},`adding month ${e}/${n} to budget month_map`),j}function m4(t,e,n,r){return{budget_id:e,year_month_ordinal:t.year_month_ordinal??At(n,r),year:t.year??n,month:t.month??r,income:t.income||[],total_income:t.total_income??0,previous_month_income:t.previous_month_income??0,expenses:t.expenses||[],total_expenses:t.total_expenses??0,transfers:t.transfers||[],adjustments:t.adjustments||[],account_balances:t.account_balances||[],category_balances:t.category_balances||[],are_allocations_finalized:t.are_allocations_finalized??!1,created_at:t.created_at,updated_at:t.updated_at}}async function p4(t,e,n){const r=yr(t,e,n);try{const{exists:a,data:o}=await Qe("months",r,`loading month ${e}/${n}`);return!a||!o?null:m4(o,t,e,n)}catch(a){if(a instanceof Error&&a.message.includes("Missing or insufficient permissions"))return console.warn(`[readMonthDirect] Permission error reading month ${e}/${n}, treating as not found`),null;throw a}}async function g4(t,e,n){const r=await p4(t,e,n);return r||sT(t,e,n)}function y4(t,e,n,r){const a=!!t&&r?.enabled!==!1;return Yl({queryKey:t?xe.month(t,e,n):["month","none"],queryFn:async()=>({month:await g4(t,e,n)}),enabled:a})}async function _4(t){const{exists:e,data:n}=await Qe("payees",t,"loading payees for autocomplete (cache miss or stale)");return e&&n?n.payees||[]:[]}function iT(t,e){return Yl({queryKey:t?xe.payees(t):["payees","none"],queryFn:()=>_4(t),enabled:!!t&&e?.enabled!==!1})}async function b4(t,e){const{exists:n,data:r}=await Qe("users",t,"loading user profile (cache miss or stale)");if(n&&r)return r;const a={uid:t,email:e,budget_ids:[],created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return await ft("users",t,a,"creating new user document (first login)"),a}function v4(t,e,n){return Yl({queryKey:t?xe.user(t):["user","none"],queryFn:()=>b4(t,e),enabled:!!t&&n?.enabled!==!1})}async function x4(t,e){const n=await Ot("budgets","loading budgets user has access to (cache miss or stale)",[{field:"user_ids",op:"array-contains",value:t}]),r=[],a=[];for(const o of n.docs){const u=o.data;u.accepted_user_ids?.includes(t)||e?.budget_ids?.includes(o.id)?r.push({id:o.id,name:u.name||"Unnamed Budget",ownerEmail:u.owner_email||null,isOwner:u.owner_id===t,isPending:!1}):a.push({budgetId:o.id,budgetName:u.name||"Unnamed Budget",ownerEmail:u.owner_email||null})}return{budgets:r,pendingInvites:a}}function S4(t,e,n){return Yl({queryKey:t?xe.accessibleBudgets(t):["accessibleBudgets","none"],queryFn:async()=>t?x4(t,e):{budgets:[],pendingInvites:[]},enabled:!!t&&n?.enabled!==!1,staleTime:60*1e3})}function w4(t){if(Array.isArray(t))return t;if(t&&typeof t=="object"&&!Array.isArray(t)){const e=t;if(e._methodName==="arrayUnion"&&Array.isArray(e.vc))return console.warn("[fetchFeedback] Found corrupted arrayUnion in feedback document - extracting items from vc"),e.vc}return[]}async function E4(){const t=await Ot("feedback","admin loading all feedback (cache miss or stale)"),e=[];for(const n of t.docs){const r=w4(n.data.items),a=n.data.user_email||n.id;r.forEach(o=>{e.push({...o,doc_id:n.id,user_email:a})})}return{items:e}}function C4(t){return Yl({queryKey:xe.feedback(),queryFn:E4,enabled:t?.enabled!==!1})}const Ut="__NO_CATEGORY__",va="No Category";function et(t){return t===Ut}const Bt="__NO_ACCOUNT__",Bs="No Account";function Be(t){return t===Bt}const j0={categoryEndBalances:{},accountEndBalances:{},totalIncome:0};function R0(t,e){const n=T4(t),r=A4(t.category_balances,e.categoryEndBalances,n),a=j4(t,e.accountEndBalances);return{...t,previous_month_income:e.totalIncome,category_balances:r,account_balances:a,updated_at:new Date().toISOString()}}function T4(t){const e={};for(const n of t.transfers||[])et(n.from_category_id)||(e[n.from_category_id]=(e[n.from_category_id]||0)-n.amount),et(n.to_category_id)||(e[n.to_category_id]=(e[n.to_category_id]||0)+n.amount);for(const n of t.adjustments||[])et(n.category_id)||(e[n.category_id]=(e[n.category_id]||0)+n.amount);for(const n of Object.keys(e))e[n]=we(e[n]);return e}function A4(t,e,n){const r=new Map;for(const u of t)et(u.category_id)||r.set(u.category_id,u);const a=new Set;for(const u of t)et(u.category_id)||a.add(u.category_id);for(const u of Object.keys(e))et(u)||a.add(u);for(const u of Object.keys(n))et(u)||a.add(u);const o=[];for(const u of a){const h=r.get(u),f=we(e[u]??0),m=we(h?.allocated??0),g=we(h?.spent??0),_=we(n[u]??0);o.push({category_id:u,start_balance:f,allocated:m,spent:g,end_balance:we(f+m+g+_)})}return o}function j4(t,e){const n=new Set;for(const a of t.income||[])Be(a.account_id)||n.add(a.account_id);for(const a of t.expenses||[])Be(a.account_id)||n.add(a.account_id);for(const a of t.transfers||[])Be(a.from_account_id)||n.add(a.from_account_id),Be(a.to_account_id)||n.add(a.to_account_id);for(const a of t.adjustments||[])Be(a.account_id)||n.add(a.account_id);for(const a of Object.keys(e))Be(a)||n.add(a);for(const a of t.account_balances||[])Be(a.account_id)||n.add(a.account_id);const r=[];for(const a of n){const o=we(e[a]??0),u=we((t.income||[]).filter(v=>v.account_id===a).reduce((v,S)=>v+S.amount,0)),h=we((t.expenses||[]).filter(v=>v.account_id===a).reduce((v,S)=>v+S.amount,0)),f=we((t.transfers||[]).filter(v=>v.from_account_id===a).reduce((v,S)=>v-S.amount,0)),m=we((t.transfers||[]).filter(v=>v.to_account_id===a).reduce((v,S)=>v+S.amount,0)),g=we((t.adjustments||[]).filter(v=>v.account_id===a).reduce((v,S)=>v+S.amount,0)),_=we(u+h+f+m+g);r.push({account_id:a,start_balance:o,income:u,expenses:h,net_change:_,end_balance:we(o+_)})}return r}function If(t){const e={},n={};for(const r of t.category_balances||[])et(r.category_id)||(e[r.category_id]=we(r.end_balance));for(const r of t.account_balances||[])Be(r.account_id)||(n[r.account_id]=we(r.end_balance));return{categoryEndBalances:e,accountEndBalances:n,totalIncome:we(t.total_income)}}const R4=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function D4(t){return{year:parseInt(t.slice(0,4),10),month:parseInt(t.slice(4,6),10)}}function aT(t={}){const e={};return Object.entries(t).forEach(([n,r])=>{e[n]={needs_recalculation:r?.needs_recalculation??!1}}),e}function I4(t){return Object.entries(t).filter(([,e])=>e.needs_recalculation).map(([e])=>e).sort()}function M4(t){return Object.keys(t).sort()}async function k4(t,e){const{year:n,month:r}=D4(e),a=yr(t,n,r),{exists:o,data:u}=await Qe("months",a,`[recalc] fetching month ${n}/${r}`);return!o||!u?null:{id:a,budget_id:t,year_month_ordinal:u.year_month_ordinal??At(n,r),year:u.year??n,month:u.month??r,income:u.income||[],total_income:u.total_income??0,previous_month_income:u.previous_month_income??0,expenses:u.expenses||[],total_expenses:u.total_expenses??0,transfers:u.transfers||[],adjustments:u.adjustments||[],account_balances:u.account_balances||[],category_balances:u.category_balances||[],are_allocations_finalized:u.are_allocations_finalized??!1,created_at:u.created_at,updated_at:u.updated_at}}async function O4(t,e,n){n?.(0,e.length);const r=await Promise.all(e.map(a=>k4(t,a)));return n?.(e.length,e.length),r.filter(a=>a!==null)}function D0(t){const e={};for(const n of Object.keys(t))e[n]={needs_recalculation:!1};return e}function oT(t,e,n){const r=Object.entries(t).reduce((o,[,u])=>{const h=u.account_group_id?n[u.account_group_id]:void 0,f=h?.on_budget!==void 0?h.on_budget:u.on_budget!==!1,m=h?.is_active!==void 0?h.is_active:u.is_active!==!1;return f&&m?o+(u.balance??0):o},0),a=Object.values(e).reduce((o,u)=>{const h=u.balance??0;return o+(h>0?h:0)},0);return we(r-a)}async function lT(t,e,n,r){const{exists:a,data:o}=await Qe("budgets",t,"[recalc] reading budget for balance update");if(!a||!o)return;const u={...o.accounts};for(const[g,_]of Object.entries(e))u[g]&&(u[g]={...u[g],balance:we(_)});const h={...o.categories};for(const[g,_]of Object.entries(n))h[g]&&(h[g]={...h[g],balance:we(_)});const f=D0(r),m=oT(u,h,o.account_groups||{});await ft("budgets",t,{...o,accounts:u,categories:h,total_available:m,is_needs_recalculation:!1,month_map:f,updated_at:new Date().toISOString()},"[recalc] saving balances and clearing flags"),P4(t,u,h,m,f)}function N4(t,e){const n=Ve.getQueryData(xe.budget(t));n&&Ve.setQueryData(xe.budget(t),{...n,isNeedsRecalculation:!1,monthMap:e,budget:{...n.budget,is_needs_recalculation:!1,month_map:e}})}function P4(t,e,n,r,a){const o=Ve.getQueryData(xe.budget(t));if(o){const u={};for(const[f,m]of Object.entries(o.accounts)){const g=e[f];u[f]=g?{...m,balance:g.balance??m.balance}:m}const h={};for(const[f,m]of Object.entries(o.categories)){const g=n[f];h[f]=g?{...m,balance:g.balance??m.balance}:m}Ve.setQueryData(xe.budget(t),{...o,accounts:u,categories:h,isNeedsRecalculation:!1,monthMap:a,budget:{...o.budget,accounts:e,categories:n,total_available:r,is_needs_recalculation:!1,month_map:a}})}}async function pw(t,e){const{exists:n,data:r}=await Qe("budgets",t,"[recalc] reading budget to clear flags");if(!n||!r)return;const a=D0(e);await ft("budgets",t,{...r,total_available:oT(r.accounts||{},r.categories||{},r.account_groups||{}),is_needs_recalculation:!1,month_map:a,updated_at:new Date().toISOString()},"[recalc] clearing flags"),N4(t,a)}const Lg=new Map;async function fm(t,e={}){const n=Lg.get(t);if(n)return n;const r=B4(t,e);Lg.set(t,r);try{return await r}finally{Lg.delete(t)}}async function B4(t,e={}){const{onProgress:n}=e;n?.({phase:"reading-budget",monthsProcessed:0,totalMonths:0,percentComplete:5});const{exists:r,data:a}=await Qe("budgets",t,"[recalc] reading budget for month_map");if(!r||!a)return n?.({phase:"complete",monthsProcessed:0,totalMonths:0,percentComplete:100}),{monthsRecalculated:0,budgetUpdated:!1};const o=aT(a.month_map),u=I4(o);if(u.length===0&&!a.is_needs_recalculation)return n?.({phase:"complete",monthsProcessed:0,totalMonths:0,percentComplete:100}),{monthsRecalculated:0,budgetUpdated:!1};const h=M4(o),f=u.length>0?u[0]:null;if(!f)return await pw(t,o),n?.({phase:"complete",monthsProcessed:0,totalMonths:0,percentComplete:100}),{monthsRecalculated:0,budgetUpdated:!0};const m=h.indexOf(f),g=m>0,_=g?h.slice(m-1):h.slice(m),v=g?_.length-1:_.length;n?.({phase:"fetching-months",monthsFetched:0,totalMonthsToFetch:_.length,monthsProcessed:0,totalMonths:v,percentComplete:10});const S=await O4(t,_,(D,A)=>{n?.({phase:"fetching-months",monthsFetched:D,totalMonthsToFetch:A,monthsProcessed:0,totalMonths:v,percentComplete:D===0?10:30})});if(S.length===0)return await pw(t,o),n?.({phase:"complete",monthsProcessed:0,totalMonths:0,percentComplete:100}),{monthsRecalculated:0,budgetUpdated:!0};const x=g?1:0,E=S.length-1,C=E-x+1;let I=j0;g&&S.length>0&&(I=If(S[0]));const j=[];let M=0;for(let D=x;D<=E;D++){const A=S[D],N=`${R4[A.month-1]} ${A.year}`;n?.({phase:"recalculating",currentMonth:N,monthsProcessed:M,totalMonths:C,percentComplete:Math.round(30+M/C*40)});const L=R0(A,I);j.push(L),I=If(L),M++}n?.({phase:"saving",monthsProcessed:M,totalMonths:C,percentComplete:75});const Q=j.map(D=>({collectionPath:"months",docId:yr(t,D.year,D.month),data:D}));await hm(Q,`[recalc] batch write ${j.length} months`);for(const D of j)Ve.setQueryData(xe.month(t,D.year,D.month),{month:D});n?.({phase:"saving",monthsProcessed:M,totalMonths:C,percentComplete:92});const q=I.accountEndBalances,G=I.categoryEndBalances;return await lT(t,q,G,o),n?.({phase:"complete",monthsProcessed:M,totalMonths:C,percentComplete:100}),{monthsRecalculated:M,budgetUpdated:!0,finalAccountBalances:q}}async function L4(t,e,n){const r=At(e,n);if(d4(t,r))return{markedCount:0,budgetUpdated:!1};const{exists:a,data:o}=await Qe("budgets",t,"reading budget for month_map update");if(!a||!o)return console.warn(`[markMonthsNeedRecalculation] Budget ${t} not found`),{markedCount:0,budgetUpdated:!1};const h={...o.month_map||{}},f=u4();for(const v of f)h[v]||(h[v]={needs_recalculation:!1});let m=0;for(const v of f)v>=r&&(h[v]?.needs_recalculation||(h[v]={needs_recalculation:!0},m++));const g=o.is_needs_recalculation===!0;if(m===0&&g)return{markedCount:0,budgetUpdated:!1};const _=h;return h4(t,r,_),await zl("budgets",t,{is_needs_recalculation:!0,month_map:_,updated_at:new Date().toISOString()},`marking budget and ${m} future months as needing recalculation`),{markedCount:m,budgetUpdated:!0}}async function z4(t,e){return Ve.fetchQuery({queryKey:["budgetInvite",t,e],queryFn:async()=>{const{exists:n,data:r}=await Qe("budgets",t,"checking if user has pending invite for budget");return!n||!r?null:{isInvited:r.user_ids?.includes(e)??!1,hasAccepted:r.accepted_user_ids?.includes(e)??!1,budgetName:r.name||"Unnamed Budget",ownerEmail:r.owner_email||null}},staleTime:60*1e3})}async function Ty(t,e,n){const r=await i4(t,e,n,{description:`fetching month for balance calculation (walking ${e}/${n})`});return r?{year:r.year,month:r.month,category_balances:r.category_balances,are_allocations_finalized:r.are_allocations_finalized,expenses:r.expenses}:null}async function U4(t,e,n,r){const a={};e.forEach(v=>{a[v]=0});const o=await Ty(t,n,r);if(o?.category_balances){for(const v of o.category_balances)e.includes(v.category_id)&&(a[v.category_id]=v.end_balance);return a}const u={};e.forEach(v=>{u[v]=0});const h=[];o&&h.push(o);let f=n,m=r,g=!1;const _=120;for(let v=0;v<_&&!g;v++){const S=Rf(f,m);f=S.year,m=S.month;const x=await Ty(t,f,m);if(!x)g=!0;else if(x.category_balances){g=!0;for(const E of x.category_balances)e.includes(E.category_id)&&(u[E.category_id]=E.end_balance)}else h.push(x)}h.reverse(),Object.assign(a,u);for(const v of h){if(v.are_allocations_finalized&&v.category_balances)for(const S of v.category_balances)e.includes(S.category_id)&&(a[S.category_id]=(a[S.category_id]||0)+S.allocated);if(v.expenses)for(const S of v.expenses)e.includes(S.category_id)&&(a[S.category_id]=(a[S.category_id]||0)-S.amount)}return a}async function F4(t,e,n,r,a){const o={...n};let u=r,h=a;const f=24;for(let m=0;m<f;m++){const g=r4(u,h);u=g.year,h=g.month;const _=await Ty(t,u,h);if(!_)break;if(_.are_allocations_finalized&&_.category_balances)for(const v of _.category_balances)e.includes(v.category_id)&&(o[v.category_id]=(o[v.category_id]||0)+v.allocated);if(_.expenses)for(const v of _.expenses)e.includes(v.category_id)&&(o[v.category_id]=(o[v.category_id]||0)-v.amount)}return o}async function gw(t,e,n,r){const a=await U4(t,e,n,r),o=await F4(t,e,a,n,r);return{current:a,total:o}}async function cT(t,e,n){const r=yr(t,e.year,e.month);await ft("months",r,e,`writeMonthData: ${n}`)}async function uT(t,e,n){await L4(t,e,n)}async function V4(t){const{budgetId:e,month:n,description:r,cascadeRecalculation:a=!0}=t;await cT(e,n,r||`${n.year}/${n.month}`),Ve.setQueryData(xe.month(e,n.year,n.month),{month:n}),a&&await uT(e,n.year,n.month)}function Hn(){const t=yn();return{writeData:vr({mutationFn:async({budgetId:n,month:r,description:a,cascadeRecalculation:o=!0})=>(await cT(n,r,a||`${r.year}/${r.month}`),{budgetId:n,year:r.year,month:r.month,cascadeRecalculation:o}),onMutate:async({budgetId:n,month:r})=>{const a=xe.month(n,r.year,r.month);await t.cancelQueries({queryKey:a});const o=t.getQueryData(a);return t.setQueryData(a,{month:r}),{oldMonthQueryData:o,monthKey:a}},onSuccess:async({budgetId:n,year:r,month:a,cascadeRecalculation:o})=>{o&&await uT(n,r,a)},onError:(n,r,a)=>{a?.oldMonthQueryData&&t.setQueryData(a.monthKey,a.oldMonthQueryData)}})}}function $4(t,e,n,r){const a={};t.category_balances&&t.category_balances.forEach(u=>{a[u.category_id]=u});const o=t.expenses??[];return e.map(u=>{const h=a[u],f=we(h?.start_balance??0),m=we(n[u]??0),g=we(o.filter(_=>_.category_id===u).reduce((_,v)=>_+v.amount,0));return{category_id:u,start_balance:f,allocated:m,spent:g,end_balance:we(f+m+g)}})}function q4(){const{writeData:t}=Hn();return{saveDraftAllocations:async(n,r,a,o)=>{const u=await Un(n,r,a,"save draft allocations"),h=u.category_balances.map(m=>({...m,allocated:o[m.category_id]??m.allocated})),f={...u,category_balances:h,updated_at:new Date().toISOString()};return await t.mutateAsync({budgetId:n,month:f,cascadeRecalculation:!1}),{updatedMonth:f}},isPending:t.isPending,isError:t.isError,error:t.error}}function H4(){const{writeData:t}=Hn();return{finalizeAllocations:async n=>{const{budgetId:r,year:a,month:o,allocations:u,onProgress:h}=n;h?.({phase:"saving",message:"Saving allocations..."});const f=await Un(r,a,o,"finalize allocations"),m=f.category_balances?.map(S=>S.category_id)??[],g=m.length>0?m:Object.keys(u),_=g.length>0?$4(f,g,u):f.category_balances,v={...f,category_balances:_,are_allocations_finalized:!0,updated_at:new Date().toISOString()};return await t.mutateAsync({budgetId:r,month:v,description:"finalize allocations"}),h?.({phase:"recalculating",message:"Recalculating month balances..."}),await fm(r,{triggeringMonthOrdinal:`${a}${String(o).padStart(2,"0")}`,onProgress:S=>{let x="Recalculating balances...";S.phase==="fetching-months"?x=`Loading month data (${S.monthsFetched}/${S.totalMonthsToFetch})...`:S.phase==="recalculating"&&S.currentMonth?x=`Recalculating ${S.currentMonth}...`:S.phase==="saving"&&(x="Saving recalculated balances..."),h?.({phase:"recalculating",message:x,recalcProgress:S})}}),await Ve.refetchQueries({queryKey:xe.month(r,a,o)}),await Ve.refetchQueries({queryKey:xe.budget(r)}),h?.({phase:"complete",message:"Allocations applied!"}),{updatedMonth:v}},isPending:t.isPending,isError:t.isError,error:t.error}}function dT(){const{writeData:t}=Hn();return{deleteAllocations:async n=>{const{budgetId:r,year:a,month:o,onProgress:u}=n;u?.({phase:"saving",message:"Deleting allocations..."});const h=await Un(r,a,o,"delete allocations"),f=h.category_balances.map(g=>({...g,allocated:0,end_balance:g.start_balance-g.spent})),m={...h,category_balances:f,are_allocations_finalized:!1,updated_at:new Date().toISOString()};return await t.mutateAsync({budgetId:r,month:m,description:"delete allocations"}),u?.({phase:"recalculating",message:"Recalculating month balances..."}),await fm(r,{triggeringMonthOrdinal:`${a}${String(o).padStart(2,"0")}`,onProgress:g=>{let _="Recalculating balances...";g.phase==="fetching-months"?_=`Loading month data (${g.monthsFetched}/${g.totalMonthsToFetch})...`:g.phase==="recalculating"&&g.currentMonth?_=`Recalculating ${g.currentMonth}...`:g.phase==="saving"&&(_="Saving recalculated balances..."),u?.({phase:"recalculating",message:_,recalcProgress:g})}}),await Ve.refetchQueries({queryKey:xe.month(r,a,o)}),await Ve.refetchQueries({queryKey:xe.budget(r)}),u?.({phase:"complete",message:"Allocations deleted!"}),{updatedMonth:m}},isPending:t.isPending,isError:t.isError,error:t.error}}async function mm(t,e,n){const r=e.trim();if(!r||n.includes(r))return null;const a=[...n,r].sort((o,u)=>o.toLowerCase().localeCompare(u.toLowerCase()));return await ft("payees",t,{budget_id:t,payees:a,updated_at:new Date().toISOString()},`adding new payee "${r}" to autocomplete list`),a}function Gn(t){const e=t.income||[],n=t.expenses||[],r=we(e.reduce((h,f)=>h+f.amount,0)),a=we(n.reduce((h,f)=>h+f.amount,0)),o=G4(t),u=Q4(t);return{...t,total_income:r,total_expenses:a,account_balances:o,category_balances:u}}function G4(t){const e=t.income||[],n=t.expenses||[],r=t.transfers||[],a=t.adjustments||[],o=t.account_balances||[],u=new Map;for(const m of o)Be(m.account_id)||u.set(m.account_id,m);const h=new Set;for(const m of e)Be(m.account_id)||h.add(m.account_id);for(const m of n)Be(m.account_id)||h.add(m.account_id);for(const m of r)Be(m.from_account_id)||h.add(m.from_account_id),Be(m.to_account_id)||h.add(m.to_account_id);for(const m of a)Be(m.account_id)||h.add(m.account_id);for(const m of o)Be(m.account_id)||h.add(m.account_id);const f=[];for(const m of h){const g=u.get(m),_=we(g?.start_balance??0),v=we(e.filter(j=>j.account_id===m).reduce((j,M)=>j+M.amount,0)),S=we(n.filter(j=>j.account_id===m).reduce((j,M)=>j+M.amount,0)),x=we(r.filter(j=>j.from_account_id===m).reduce((j,M)=>j-M.amount,0)),E=we(r.filter(j=>j.to_account_id===m).reduce((j,M)=>j+M.amount,0)),C=we(a.filter(j=>j.account_id===m).reduce((j,M)=>j+M.amount,0)),I=we(v+S+x+E+C);f.push({account_id:m,start_balance:_,income:v,expenses:S,net_change:I,end_balance:we(_+I)})}return f}function Q4(t){const e=t.expenses||[],n=t.transfers||[],r=t.adjustments||[],a=t.category_balances||[],o=new Map;for(const g of a)et(g.category_id)||o.set(g.category_id,g);const u=new Map;for(const g of e){if(et(g.category_id))continue;const _=u.get(g.category_id)||0;u.set(g.category_id,_+g.amount)}const h=new Map;for(const g of n){if(!et(g.from_category_id)){const _=h.get(g.from_category_id)||0;h.set(g.from_category_id,_-g.amount)}if(!et(g.to_category_id)){const _=h.get(g.to_category_id)||0;h.set(g.to_category_id,_+g.amount)}}for(const g of r)if(!et(g.category_id)){const _=h.get(g.category_id)||0;h.set(g.category_id,_+g.amount)}const f=new Set;for(const g of a)et(g.category_id)||f.add(g.category_id);for(const g of e)et(g.category_id)||f.add(g.category_id);for(const g of n)et(g.from_category_id)||f.add(g.from_category_id),et(g.to_category_id)||f.add(g.to_category_id);for(const g of r)et(g.category_id)||f.add(g.category_id);const m=[];for(const g of f){const _=o.get(g),v=we(u.get(g)??0),S=we(h.get(g)??0);if(_){const x=we(_.start_balance),E=we(_.allocated);m.push({..._,start_balance:x,allocated:E,spent:v,end_balance:we(x+E+v+S)})}else m.push({category_id:g,start_balance:0,allocated:0,spent:v,end_balance:we(v+S)})}return m}function W4(t,e){let n=0;for(const{accountId:r,delta:a}of e){const o=t.accounts[r];if(!o)continue;const u=o.account_group_id?t.accountGroups[o.account_group_id]:void 0,h=u?.on_budget!==void 0?u.on_budget:o.on_budget!==!1,f=u?.is_active!==void 0?u.is_active:o.is_active!==!1;h&&f&&(n+=a)}return n}async function qn(t,e){if(e.length===0)return;const n=e.filter(h=>h.delta!==0);if(n.length===0)return;const r=Ve.getQueryData(xe.budget(t));if(!r)return;const a=W4(r,n),o={...r.accounts};for(const{accountId:h,delta:f}of n)o[h]&&(o[h]={...o[h],balance:o[h].balance+f});const u=r.budget?{...r.budget,total_available:r.budget.total_available+a}:r.budget;Ve.setQueryData(xe.budget(t),{...r,accounts:o,budget:u})}function K4(){const t=yn(),{writeData:e}=Hn();return{addIncome:async(r,a,o,u,h,f,m,g)=>{const _=await Un(r,a,o,"add income"),v={id:`income_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,amount:u,account_id:h,date:f,created_at:new Date().toISOString()};m?.trim()&&(v.payee=m.trim()),g&&(v.description=g);const S=[..._.income||[],v],x=Gn({..._,income:S,updated_at:new Date().toISOString()});if(await e.mutateAsync({budgetId:r,month:x,description:"add income"}),await qn(r,[{accountId:h,delta:u}]),m?.trim()){const E=t.getQueryData(xe.payees(r))||[],C=await mm(r,m,E);C&&t.setQueryData(xe.payees(r),C)}return{updatedMonth:x,newIncome:v}},isPending:e.isPending,isError:e.isError,error:e.error}}function Y4(t,e,n,r,a,o){if(!t)return!0;const u=t.payee||void 0,h=a?.trim()||void 0,f=t.description||void 0,m=o||void 0;return e!==t.amount||n!==t.account_id||r!==t.date||h!==u||m!==f}function X4(){const t=yn(),{writeData:e}=Hn();return{updateIncome:async(r,a,o,u,h,f,m,g,_)=>{const v=await Un(r,a,o,"update income"),S=(v.income||[]).find(M=>M.id===u);if(!Y4(S,h,f,m,g,_))return{updatedMonth:v,noOp:!0};const x=S?.amount??0,E=S?.account_id??f,C={id:u,amount:h,account_id:f,date:m,created_at:(v.income||[]).find(M=>M.id===u)?.created_at||new Date().toISOString()};g?.trim()&&(C.payee=g.trim()),_&&(C.description=_);const I=(v.income||[]).map(M=>M.id===u?C:M),j=Gn({...v,income:I,updated_at:new Date().toISOString()});if(await e.mutateAsync({budgetId:r,month:j,description:"update income"}),E===f?await qn(r,[{accountId:f,delta:h-x}]):await qn(r,[{accountId:E,delta:-x},{accountId:f,delta:h}]),g?.trim()){const M=t.getQueryData(xe.payees(r))||[],Q=await mm(r,g,M);Q&&t.setQueryData(xe.payees(r),Q)}return{updatedMonth:j}},isPending:e.isPending,isError:e.isError,error:e.error}}function J4(){const{writeData:t}=Hn();return{deleteIncome:async(n,r,a,o)=>{const u=await Un(n,r,a,"delete income"),h=(u.income||[]).find(v=>v.id===o),f=h?.amount??0,m=h?.account_id,g=(u.income||[]).filter(v=>v.id!==o),_=Gn({...u,income:g,updated_at:new Date().toISOString()});return await t.mutateAsync({budgetId:n,month:_,description:"delete income"}),m&&f>0&&await qn(n,[{accountId:m,delta:-f}]),{updatedMonth:_}},isPending:t.isPending,isError:t.isError,error:t.error}}function Z4(){const t=yn(),{writeData:e}=Hn();return{addExpense:async(r,a,o,u,h,f,m,g,_,v)=>{const S=await Un(r,a,o,"add expense"),x={id:`expense_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,amount:u,category_id:h,account_id:f,date:m,created_at:new Date().toISOString()};g?.trim()&&(x.payee=g.trim()),_&&(x.description=_),v!==void 0&&(x.cleared=v);const E=[...S.expenses||[],x],C=Gn({...S,expenses:E,updated_at:new Date().toISOString()});if(await e.mutateAsync({budgetId:r,month:C,description:"add expense"}),await qn(r,[{accountId:f,delta:u}]),g?.trim()){const I=t.getQueryData(xe.payees(r))||[],j=await mm(r,g,I);j&&t.setQueryData(xe.payees(r),j)}return{updatedMonth:C,newExpense:x}},isPending:e.isPending,isError:e.isError,error:e.error}}function eB(t,e,n,r,a,o,u,h){if(!t)return!0;const f=t.payee||void 0,m=o?.trim()||void 0,g=t.description||void 0,_=u||void 0;return e!==t.amount||n!==t.category_id||r!==t.account_id||a!==t.date||m!==f||_!==g||h!==t.cleared}function tB(){const t=yn(),{writeData:e}=Hn();return{updateExpense:async(r,a,o,u,h,f,m,g,_,v,S)=>{const x=await Un(r,a,o,"update expense"),E=(x.expenses||[]).find(q=>q.id===u);if(!eB(E,h,f,m,g,_,v,S))return{updatedMonth:x,noOp:!0};const C=E?.amount??0,I=E?.account_id??m,j={id:u,amount:h,category_id:f,account_id:m,date:g,created_at:x.expenses?.find(q=>q.id===u)?.created_at||new Date().toISOString()};_?.trim()&&(j.payee=_.trim()),v&&(j.description=v),S!==void 0&&(j.cleared=S);const M=(x.expenses||[]).map(q=>q.id===u?j:q),Q=Gn({...x,expenses:M,updated_at:new Date().toISOString()});if(await e.mutateAsync({budgetId:r,month:Q,description:"update expense"}),I===m?await qn(r,[{accountId:m,delta:h-C}]):await qn(r,[{accountId:I,delta:-C},{accountId:m,delta:h}]),_?.trim()){const q=t.getQueryData(xe.payees(r))||[],G=await mm(r,_,q);G&&t.setQueryData(xe.payees(r),G)}return{updatedMonth:Q}},isPending:e.isPending,isError:e.isError,error:e.error}}function nB(){const{writeData:t}=Hn();return{deleteExpense:async(n,r,a,o)=>{const u=await Un(n,r,a,"delete expense"),h=(u.expenses||[]).find(v=>v.id===o),f=h?.amount??0,m=h?.account_id,g=(u.expenses||[]).filter(v=>v.id!==o),_=Gn({...u,expenses:g,updated_at:new Date().toISOString()});return await t.mutateAsync({budgetId:n,month:_,description:"delete expense"}),m&&f!==0&&await qn(n,[{accountId:m,delta:-f}]),{updatedMonth:_}},isPending:t.isPending,isError:t.isError,error:t.error}}function rB(){const{writeData:t}=Hn();return{addTransfer:async(n,r,a,o,u,h,f,m,g,_,v)=>{const S=await Un(n,r,a,"add transfer"),x={id:`transfer_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,amount:o,from_account_id:u,to_account_id:h,from_category_id:f,to_category_id:m,date:g,created_at:new Date().toISOString()};_&&(x.description=_),v!==void 0&&(x.cleared=v);const E=[...S.transfers||[],x],C=Gn({...S,transfers:E,updated_at:new Date().toISOString()});await t.mutateAsync({budgetId:n,month:C,description:"add transfer"});const I=[];return Be(u)||I.push({accountId:u,delta:-o}),Be(h)||I.push({accountId:h,delta:o}),I.length>0&&await qn(n,I),{updatedMonth:C,newTransfer:x}},isPending:t.isPending,isError:t.isError,error:t.error}}function sB(t,e,n,r,a,o,u,h,f){if(!t)return!0;const m=t.description||void 0,g=h||void 0;return e!==t.amount||n!==t.from_account_id||r!==t.to_account_id||a!==t.from_category_id||o!==t.to_category_id||u!==t.date||g!==m||f!==t.cleared}function iB(){const{writeData:t}=Hn();return{updateTransfer:async(n,r,a,o,u,h,f,m,g,_,v,S)=>{const x=await Un(n,r,a,"update transfer"),E=(x.transfers||[]).find(D=>D.id===o);if(!sB(E,u,h,f,m,g,_,v,S))return{updatedMonth:x,noOp:!0};const C=E?.amount??0,I=E?.from_account_id??h,j=E?.to_account_id??f,M={id:o,amount:u,from_account_id:h,to_account_id:f,from_category_id:m,to_category_id:g,date:_,created_at:x.transfers?.find(D=>D.id===o)?.created_at||new Date().toISOString()};v&&(M.description=v),S!==void 0&&(M.cleared=S);const Q=(x.transfers||[]).map(D=>D.id===o?M:D),q=Gn({...x,transfers:Q,updated_at:new Date().toISOString()});await t.mutateAsync({budgetId:n,month:q,description:"update transfer"});const G=[];return Be(I)||G.push({accountId:I,delta:C}),Be(j)||G.push({accountId:j,delta:-C}),Be(h)||G.push({accountId:h,delta:-u}),Be(f)||G.push({accountId:f,delta:u}),G.length>0&&await qn(n,G),{updatedMonth:q}},isPending:t.isPending,isError:t.isError,error:t.error}}function aB(){const{writeData:t}=Hn();return{deleteTransfer:async(n,r,a,o)=>{const u=await Un(n,r,a,"delete transfer"),h=(u.transfers||[]).find(x=>x.id===o),f=h?.amount??0,m=h?.from_account_id,g=h?.to_account_id,_=(u.transfers||[]).filter(x=>x.id!==o),v=Gn({...u,transfers:_,updated_at:new Date().toISOString()});await t.mutateAsync({budgetId:n,month:v,description:"delete transfer"});const S=[];return m&&!Be(m)&&f!==0&&S.push({accountId:m,delta:f}),g&&!Be(g)&&f!==0&&S.push({accountId:g,delta:-f}),S.length>0&&await qn(n,S),{updatedMonth:v}},isPending:t.isPending,isError:t.isError,error:t.error}}function oB(){const{writeData:t}=Hn();return{addAdjustment:async(n,r,a,o,u,h,f,m,g)=>{const _=await Un(n,r,a,"add adjustment"),v={id:`adjustment_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,amount:o,account_id:u,category_id:h,date:f,created_at:new Date().toISOString()};m&&(v.description=m),g!==void 0&&(v.cleared=g);const S=[..._.adjustments||[],v],x=Gn({..._,adjustments:S,updated_at:new Date().toISOString()});return await t.mutateAsync({budgetId:n,month:x,description:"add adjustment"}),Be(u)||await qn(n,[{accountId:u,delta:o}]),{updatedMonth:x,newAdjustment:v}},isPending:t.isPending,isError:t.isError,error:t.error}}function lB(t,e,n,r,a,o,u){if(!t)return!0;const h=t.description||void 0,f=o||void 0;return e!==t.amount||n!==t.account_id||r!==t.category_id||a!==t.date||f!==h||u!==t.cleared}function cB(){const{writeData:t}=Hn();return{updateAdjustment:async(n,r,a,o,u,h,f,m,g,_)=>{const v=await Un(n,r,a,"update adjustment"),S=(v.adjustments||[]).find(M=>M.id===o);if(!lB(S,u,h,f,m,g,_))return{updatedMonth:v,noOp:!0};const x=S?.amount??0,E=S?.account_id??h,C={id:o,amount:u,account_id:h,category_id:f,date:m,created_at:v.adjustments?.find(M=>M.id===o)?.created_at||new Date().toISOString()};g&&(C.description=g),_!==void 0&&(C.cleared=_);const I=(v.adjustments||[]).map(M=>M.id===o?C:M),j=Gn({...v,adjustments:I,updated_at:new Date().toISOString()});if(await t.mutateAsync({budgetId:n,month:j,description:"update adjustment"}),!Be(E)&&E===h)await qn(n,[{accountId:h,delta:u-x}]);else{const M=[];Be(E)||M.push({accountId:E,delta:-x}),Be(h)||M.push({accountId:h,delta:u}),M.length>0&&await qn(n,M)}return{updatedMonth:j}},isPending:t.isPending,isError:t.isError,error:t.error}}function uB(){const{writeData:t}=Hn();return{deleteAdjustment:async(n,r,a,o)=>{const u=await Un(n,r,a,"delete adjustment"),h=(u.adjustments||[]).find(v=>v.id===o),f=h?.amount??0,m=h?.account_id,g=(u.adjustments||[]).filter(v=>v.id!==o),_=Gn({...u,adjustments:g,updated_at:new Date().toISOString()});return await t.mutateAsync({budgetId:n,month:_,description:"delete adjustment"}),m&&!Be(m)&&f!==0&&await qn(n,[{accountId:m,delta:-f}]),{updatedMonth:_}},isPending:t.isPending,isError:t.isError,error:t.error}}const dB={currentUserId:null,selectedBudgetId:null,currentYear:new Date().getFullYear(),currentMonthNumber:new Date().getMonth()+1,lastActiveTab:"categories",lastSettingsTab:"categories",lastAdminTab:"budget",setSelectedBudgetId:()=>{},setCurrentYear:()=>{},setCurrentMonthNumber:()=>{},setLastActiveTab:()=>{},setLastSettingsTab:()=>{},setLastAdminTab:()=>{},pageTitle:"Budget",setPageTitle:()=>{},isInitialized:!1,needsFirstBudget:!1,goToPreviousMonth:()=>{},goToNextMonth:()=>{},pendingInvites:[],hasPendingInvites:!1,accessibleBudgets:[],isAdmin:!1,isTest:!1,loadAccessibleBudgets:async()=>{},switchToBudget:()=>{},checkBudgetInvite:async()=>null,clearCache:()=>{}},hT=T.createContext(dB);function hB({children:t}){const n=wa().get_current_firebase_user(),[r,a]=T.useState(null),[o,u]=T.useState(new Date().getFullYear()),[h,f]=T.useState(new Date().getMonth()+1),[m,g]=T.useState("categories"),[_,v]=T.useState("categories"),[S,x]=T.useState("budget"),[E,C]=T.useState("Budget"),I=T.useCallback(U=>{C(H=>H===U?H:U)},[]),[j,M]=T.useState(!1),[Q,q]=T.useState(!1),G=v4(n?.uid||null,n?.email||null),D=G.data&&G.data.budget_ids.length===0,A=S4(n?.uid||null,G.data||null,{enabled:!!n?.uid&&!!G.data&&D}),N=G.data?.permission_flags?.is_admin===!0,L=G.data?.permission_flags?.is_test===!0,P=A.data?.pendingInvites||[],B=A.data?.budgets||[],O=P.length>0;T.useEffect(()=>{if(!n||j||G.isLoading)return;const U=G.data;if(!(!U&&!G.isError))if(U&&U.budget_ids.length>0)a(U.budget_ids[0]),q(!1),M(!0);else{if(A.isLoading)return;const H=A.data;H?.pendingInvites&&H.pendingInvites.length>0?q(!1):q(!0),M(!0)}},[n,j,G.data,G.isLoading,G.isError,A.data,A.isLoading]);const K=T.useCallback(()=>{h===1?(u(U=>U-1),f(12)):f(U=>U-1)},[h]),Y=T.useCallback(()=>{h===12?(u(U=>U+1),f(1)):f(U=>U+1)},[h]),z=T.useCallback(async U=>{(U?.force||!A.data)&&await A.refetch()},[A]),V=T.useCallback(U=>{a(U),q(!1)},[]),W=T.useCallback(async U=>{if(!n)return null;try{const H=await z4(U,n.uid);return H&&H.isInvited&&!H.hasAccepted?{budgetId:U,budgetName:H.budgetName,ownerEmail:H.ownerEmail}:null}catch(H){return console.error("[BudgetContext] Error checking budget invite:",H),null}},[n]),ee=T.useCallback(()=>{localStorage.removeItem("BUDGET_APP_QUERY_CACHE")},[]),ie={currentUserId:n?.uid||null,selectedBudgetId:r,currentYear:o,currentMonthNumber:h,lastActiveTab:m,lastSettingsTab:_,lastAdminTab:S,setSelectedBudgetId:a,setCurrentYear:u,setCurrentMonthNumber:f,setLastActiveTab:g,setLastSettingsTab:v,setLastAdminTab:x,pageTitle:E,setPageTitle:I,isInitialized:j,needsFirstBudget:Q,goToPreviousMonth:K,goToNextMonth:Y,pendingInvites:P,hasPendingInvites:O,accessibleBudgets:B,isAdmin:N,isTest:L,loadAccessibleBudgets:z,switchToBudget:V,checkBudgetInvite:W,clearCache:ee};return c.jsx(hT.Provider,{value:ie,children:t})}function zt(){const t=T.useContext(hT);if(!t)throw new Error("useBudget must be used within a BudgetProvider");return t}const fB=function(){},mB={is_logged_in:!1,is_auth_checked:!1,username:"",set_user_context:fB},nd=T.createContext(mB);function zs(t=c4){const[e,n]=T.useState(()=>typeof window>"u"?!1:window.innerWidth<t);return T.useEffect(()=>{const r=window.matchMedia(`(max-width: ${t-1}px)`);function a(u){n(u.matches)}a(r),r.addEventListener("change",a);function o(){n(window.innerWidth<t)}return window.addEventListener("resize",o),()=>{r.removeEventListener("change",a),window.removeEventListener("resize",o)}},[t]),e}function fT(){const[t,e]=T.useState(()=>typeof window>"u"?1200:window.innerWidth);return T.useEffect(()=>{function n(){e(window.innerWidth)}return window.addEventListener("resize",n),n(),()=>window.removeEventListener("resize",n)},[]),{width:t,isWide:t>=oo.wide,isMedium:t>=oo.tablet&&t<oo.wide,isNarrowMedium:t>=oo.mobile&&t<oo.tablet,isMobile:t<oo.mobile}}function pB(){const t=yn();return{updateAccounts:vr({mutationFn:async({budgetId:n,accounts:r})=>{const{exists:a,data:o}=await Qe("budgets",n,"PRE-EDIT-READ");if(!a||!o)throw new Error("Budget not found");return await ft("budgets",n,{...o,accounts:r},"saving updated accounts (user edited account settings)"),r},onMutate:async({budgetId:n,accounts:r})=>{await t.cancelQueries({queryKey:xe.budget(n)});const a=t.getQueryData(xe.budget(n));return a&&t.setQueryData(xe.budget(n),{...a,accounts:r}),{previousData:a}},onSuccess:(n,{budgetId:r})=>{const a=t.getQueryData(xe.budget(r));a&&t.setQueryData(xe.budget(r),{...a,accounts:n})},onError:(n,{budgetId:r},a)=>{a?.previousData&&t.setQueryData(xe.budget(r),a.previousData)}})}}function gB(t){const e={};return Object.entries(t).forEach(([n,r])=>{e[n]={name:r.name,sort_order:r.sort_order},r.expected_balance!==void 0&&(e[n].expected_balance=r.expected_balance),r.on_budget!==void 0&&(e[n].on_budget=r.on_budget),r.is_active!==void 0&&(e[n].is_active=r.is_active)}),e}function yB(){const t=yn();return{updateAccountGroups:vr({mutationFn:async({budgetId:n,accountGroups:r})=>{const{exists:a,data:o}=await Qe("budgets",n,"PRE-EDIT-READ");if(!a||!o)throw new Error("Budget not found");const u=gB(r);return await ft("budgets",n,{...o,account_groups:u},"saving updated account groups (user edited group settings)"),r},onMutate:async({budgetId:n,accountGroups:r})=>{await t.cancelQueries({queryKey:xe.budget(n)});const a=t.getQueryData(xe.budget(n));return a&&t.setQueryData(xe.budget(n),{...a,accountGroups:r}),{previousData:a}},onSuccess:(n,{budgetId:r})=>{const a=t.getQueryData(xe.budget(r));a&&t.setQueryData(xe.budget(r),{...a,accountGroups:n})},onError:(n,{budgetId:r},a)=>{a?.previousData&&t.setQueryData(xe.budget(r),a.previousData)}})}}function _B(t){const e={};return Object.entries(t).forEach(([n,r])=>{e[n]={name:r.name,category_group_id:r.category_group_id??null,sort_order:r.sort_order,balance:r.balance??0},r.description!==void 0&&(e[n].description=r.description),r.default_monthly_amount!==void 0&&(e[n].default_monthly_amount=r.default_monthly_amount),r.default_monthly_type!==void 0&&(e[n].default_monthly_type=r.default_monthly_type),r.is_hidden!==void 0&&(e[n].is_hidden=r.is_hidden)}),e}function bB(){const t=yn();return{updateCategories:vr({mutationFn:async({budgetId:n,categories:r})=>{const{exists:a,data:o}=await Qe("budgets",n,"PRE-EDIT-READ");if(!a||!o)throw new Error("Budget not found");const u=_B(r);return await ft("budgets",n,{...o,categories:u},"saving updated categories (user edited category settings)"),r},onMutate:async({budgetId:n,categories:r})=>{await t.cancelQueries({queryKey:xe.budget(n)});const a=t.getQueryData(xe.budget(n));return a&&t.setQueryData(xe.budget(n),{...a,categories:r}),{previousData:a}},onSuccess:(n,{budgetId:r})=>{const a=t.getQueryData(xe.budget(r));a&&t.setQueryData(xe.budget(r),{...a,categories:n})},onError:(n,{budgetId:r},a)=>{a?.previousData&&t.setQueryData(xe.budget(r),a.previousData)}})}}function vB(){const t=yn();return{updateCategoryGroups:vr({mutationFn:async({budgetId:n,categoryGroups:r})=>{const{exists:a,data:o}=await Qe("budgets",n,"PRE-EDIT-READ");if(!a||!o)throw new Error("Budget not found");return await ft("budgets",n,{...o,category_groups:r},"saving updated category groups (user edited group settings)"),r},onMutate:async({budgetId:n,categoryGroups:r})=>{await t.cancelQueries({queryKey:xe.budget(n)});const a=t.getQueryData(xe.budget(n));return a&&t.setQueryData(xe.budget(n),{...a,categoryGroups:r}),{previousData:a}},onSuccess:(n,{budgetId:r})=>{const a=t.getQueryData(xe.budget(r));a&&t.setQueryData(xe.budget(r),{...a,categoryGroups:n})},onError:(n,{budgetId:r},a)=>{a?.previousData&&t.setQueryData(xe.budget(r),a.previousData)}})}}function xB(){const t=yn();return{renameBudget:vr({mutationFn:async({budgetId:n,newName:r})=>{const{exists:a,data:o}=await Qe("budgets",n,"PRE-EDIT-READ");if(!a||!o)throw new Error("Budget not found");return await ft("budgets",n,{...o,name:r.trim()},`renaming budget to "${r.trim()}"`),r.trim()},onMutate:async({budgetId:n,newName:r})=>{await t.cancelQueries({queryKey:xe.budget(n)});const a=t.getQueryData(xe.budget(n));return a&&t.setQueryData(xe.budget(n),{...a,budget:{...a.budget,name:r.trim()}}),{previousData:a}},onSuccess:(n,{budgetId:r})=>{const a=t.getQueryData(xe.budget(r));a&&t.setQueryData(xe.budget(r),{...a,budget:{...a.budget,name:n}})},onError:(n,{budgetId:r},a)=>{a?.previousData&&t.setQueryData(xe.budget(r),a.previousData)}})}}function SB(){const t=yn();return{createBudget:vr({mutationFn:async({name:n,userId:r,userEmail:a})=>{const o=`budget_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,u=new Date().toISOString(),h={name:n.trim()||"My Budget",user_ids:[r],accepted_user_ids:[r],owner_id:r,owner_email:a,accounts:{},account_groups:{},categories:{},category_groups:[],total_available:0,is_needs_recalculation:!1,month_map:{},created_at:u,updated_at:u};await ft("budgets",o,h,"creating new budget document");const{exists:f,data:m}=await Qe("users",r,"reading user document to add new budget to their list");return f&&m?await ft("users",r,{...m,budget_ids:[o,...m.budget_ids],updated_at:u},"adding new budget to user's budget list"):await ft("users",r,{uid:r,email:a,budget_ids:[o],created_at:u,updated_at:u},"creating new user document with first budget"),{budgetId:o,budget:{id:o,...h}}},onSuccess:(n,{userId:r})=>{t.invalidateQueries({queryKey:xe.user(r)}),t.invalidateQueries({queryKey:xe.accessibleBudgets(r)})}})}}function wB(){const t=yn();return{acceptInvite:vr({mutationFn:async({budgetId:n,userId:r})=>{const a=new Date().toISOString(),{exists:o,data:u}=await Qe("budgets",n,"verifying user was invited to this budget");if(!o||!u)throw new Error("Budget not found");if(!u.user_ids?.includes(r))throw new Error("You have not been invited to this budget");const{data:h}=await Qe("users",r,"PRE-EDIT-READ");if(h?.budget_ids?.includes(n))throw new Error("You have already accepted this invite");return await ft("users",r,{...h||{uid:r,email:null},budget_ids:[n,...h?.budget_ids||[]],updated_at:a},"adding accepted budget to user's budget list"),await ft("budgets",n,{...u,accepted_user_ids:[...u.accepted_user_ids||[],r]},"marking user as accepted in budget's accepted_user_ids"),{budgetId:n}},onSuccess:(n,{userId:r})=>{t.invalidateQueries({queryKey:xe.user(r)}),t.invalidateQueries({queryKey:xe.accessibleBudgets(r)}),t.invalidateQueries({queryKey:xe.budget(n.budgetId)})}})}}function EB(){const t=yn();return{inviteUser:vr({mutationFn:async({budgetId:n,userId:r})=>{const{exists:a,data:o}=await Qe("budgets",n,"PRE-EDIT-READ");if(!a||!o)throw new Error("Budget not found");if(o.user_ids?.includes(r))throw new Error("User is already invited");return await ft("budgets",n,{...o,user_ids:[...o.user_ids||[],r]},"adding user to budget's invited users list"),{budgetId:n}},onMutate:async({budgetId:n,userId:r})=>{await t.cancelQueries({queryKey:xe.budget(n)});const a=t.getQueryData(xe.budget(n));return a&&t.setQueryData(xe.budget(n),{...a,budget:{...a.budget,user_ids:[...a.budget.user_ids,r]}}),{previousData:a}},onSuccess:(n,{budgetId:r})=>{const a=t.getQueryData(xe.budget(r));a&&t.setQueryData(xe.budget(r),a)},onError:(n,{budgetId:r},a)=>{a?.previousData&&t.setQueryData(xe.budget(r),a.previousData)}})}}function CB(){const t=yn();return{revokeUser:vr({mutationFn:async({budgetId:n,userId:r})=>{const{exists:a,data:o}=await Qe("budgets",n,"PRE-EDIT-READ");if(!a||!o)throw new Error("Budget not found");return await ft("budgets",n,{...o,user_ids:(o.user_ids||[]).filter(u=>u!==r),accepted_user_ids:(o.accepted_user_ids||[]).filter(u=>u!==r)},"removing user from budget's access lists"),{budgetId:n}},onMutate:async({budgetId:n,userId:r})=>{await t.cancelQueries({queryKey:xe.budget(n)});const a=t.getQueryData(xe.budget(n));return a&&t.setQueryData(xe.budget(n),{...a,budget:{...a.budget,user_ids:a.budget.user_ids.filter(o=>o!==r),accepted_user_ids:a.budget.accepted_user_ids.filter(o=>o!==r)}}),{previousData:a}},onSuccess:(n,{budgetId:r})=>{const a=t.getQueryData(xe.budget(r));a&&t.setQueryData(xe.budget(r),a)},onError:(n,{budgetId:r},a)=>{a?.previousData&&t.setQueryData(xe.budget(r),a.previousData)}})}}function kn(){const{selectedBudgetId:t,currentUserId:e}=zt(),{requireUserEmail:n}=wa(),r=rT(t),{updateAccounts:a}=pB(),{updateAccountGroups:o}=yB(),{updateCategories:u}=bB(),{updateCategoryGroups:h}=vB(),{renameBudget:f}=xB(),{createBudget:m}=SB(),{acceptInvite:g}=wB(),{inviteUser:_}=EB(),{revokeUser:v}=CB(),S=r.data,x=S?.budget||null,E=T.useMemo(()=>S?.accounts||{},[S?.accounts]),C=T.useMemo(()=>S?.accountGroups||{},[S?.accountGroups]),I=T.useMemo(()=>S?.categories||{},[S?.categories]),j=T.useMemo(()=>S?.categoryGroups||[],[S?.categoryGroups]),M=x?.owner_id===e,Q=T.useMemo(()=>x?.user_ids||[],[x?.user_ids]),q=T.useMemo(()=>x?.accepted_user_ids||[],[x?.accepted_user_ids]),G=x?.total_available??0,D=T.useMemo(()=>S?.monthMap||{},[S?.monthMap]),A=T.useCallback(async Z=>{if(!t)throw new Error("No budget selected");await a.mutateAsync({budgetId:t,accounts:Z})},[t,a]),N=T.useCallback(async Z=>{if(!t)throw new Error("No budget selected");await o.mutateAsync({budgetId:t,accountGroups:Z})},[t,o]),L=T.useCallback(async Z=>{if(!t)throw new Error("No budget selected");await u.mutateAsync({budgetId:t,categories:Z})},[t,u]),P=T.useCallback(async Z=>{if(!t)throw new Error("No budget selected");await h.mutateAsync({budgetId:t,categoryGroups:Z})},[t,h]),B=T.useCallback(async(Z,le)=>{if(!t)throw new Error("No budget selected");await Promise.all([a.mutateAsync({budgetId:t,accounts:Z}),o.mutateAsync({budgetId:t,accountGroups:le})])},[t,a,o]),O=T.useCallback(async(Z,le)=>{if(!t)throw new Error("No budget selected");await Promise.all([u.mutateAsync({budgetId:t,categories:Z}),h.mutateAsync({budgetId:t,categoryGroups:le})])},[t,u,h]),K=T.useCallback(async Z=>{if(!t)throw new Error("No budget selected");await f.mutateAsync({budgetId:t,newName:Z})},[t,f]),Y=T.useCallback(async Z=>{if(!e)throw new Error("Not authenticated");return await m.mutateAsync({name:Z.trim()||"My Budget",userId:e,userEmail:n()})},[e,n,m]),z=T.useCallback(async Z=>{if(!t)throw new Error("No budget selected");await _.mutateAsync({budgetId:t,userId:Z})},[t,_]),V=T.useCallback(async Z=>{if(!t)throw new Error("No budget selected");await v.mutateAsync({budgetId:t,userId:Z})},[t,v]),W=T.useCallback(async Z=>{if(!e)throw new Error("Not authenticated");await g.mutateAsync({budgetId:Z,userId:e})},[e,g]),ee=T.useCallback(Z=>{if(!t)return;const le=Ve.getQueryData(xe.budget(t));le&&Ve.setQueryData(xe.budget(t),{...le,accounts:Z})},[t]),ie=T.useCallback(Z=>{if(!t)return;const le=Ve.getQueryData(xe.budget(t));le&&Ve.setQueryData(xe.budget(t),{...le,accountGroups:Z})},[t]),U=T.useCallback(Z=>{if(!t)return;const le=Ve.getQueryData(xe.budget(t));le&&Ve.setQueryData(xe.budget(t),{...le,categories:Z})},[t]),H=T.useCallback(Z=>{if(!t)return;const le=Ve.getQueryData(xe.budget(t));le&&Ve.setQueryData(xe.budget(t),{...le,categoryGroups:Z})},[t]),ne=T.useCallback(async()=>{t&&await Ve.invalidateQueries({queryKey:xe.budget(t)})},[t]),se=T.useCallback(()=>Object.entries(E).filter(([,Z])=>{const le=Z.account_group_id?C[Z.account_group_id]:void 0,pe=le?.on_budget!==void 0?le.on_budget:Z.on_budget!==!1,Ee=le?.is_active!==void 0?le.is_active:Z.is_active!==!1;return pe&&Ee}).reduce((Z,[,le])=>Z+le.balance,0),[E,C]);return{isLoading:r.isLoading,isFetching:r.isFetching,error:r.error,budget:x,accounts:E,accountGroups:C,categories:I,categoryGroups:j,isOwner:M,budgetUserIds:Q,acceptedUserIds:q,totalAvailable:G,monthMap:D,saveAccounts:A,saveAccountGroups:N,saveCategories:L,saveCategoryGroups:P,saveAccountsAndGroups:B,saveCategoriesAndGroups:O,renameBudget:K,createBudget:Y,inviteUser:z,revokeUser:V,acceptInvite:W,setAccountsOptimistic:ee,setAccountGroupsOptimistic:ie,setCategoriesOptimistic:U,setCategoryGroupsOptimistic:H,refreshBudget:ne,getOnBudgetTotal:se}}function _i(t,e,n){const{addLoadingHold:r,removeLoadingHold:a}=ir(),o=y4(t,e,n,{enabled:!!t});T.useEffect(()=>(o.isLoading?r("month-query","Loading month data..."):a("month-query"),()=>a("month-query")),[o.isLoading,r,a]);const{addIncome:u}=K4(),{updateIncome:h}=X4(),{deleteIncome:f}=J4(),{addExpense:m}=Z4(),{updateExpense:g}=tB(),{deleteExpense:_}=nB(),{addTransfer:v}=rB(),{updateTransfer:S}=iB(),{deleteTransfer:x}=aB(),{addAdjustment:E}=oB(),{updateAdjustment:C}=cB(),{deleteAdjustment:I}=uB(),j=o.data?.month||null,M=j?.income||[],Q=j?.expenses||[],q=j?.transfers||[],G=j?.adjustments||[],D=j?.category_balances||[],A=j?.total_income||0,N=j?.total_expenses||0,L=j?.are_allocations_finalized||!1,P=j?.previous_month_income??0,B=T.useCallback(async(Z,le,pe,Ee,ge)=>{if(!t)throw new Error("No budget selected");const[J,Se]=pe.split("-").map(Number);await u(t,J,Se,Z,le,pe,Ee,ge)},[t,u]),O=T.useCallback(async(Z,le,pe,Ee,ge,J)=>{if(!t)throw new Error("No budget selected");await h(t,e,n,Z,le,pe,Ee,ge,J)},[t,e,n,h]),K=T.useCallback(async Z=>{if(!t)throw new Error("No budget selected");await f(t,e,n,Z)},[t,e,n,f]),Y=T.useCallback(async(Z,le,pe,Ee,ge,J,Se)=>{if(!t)throw new Error("No budget selected");const[Ae,ct]=Ee.split("-").map(Number);await m(t,Ae,ct,Z,le,pe,Ee,ge,J,Se)},[t,m]),z=T.useCallback(async(Z,le,pe,Ee,ge,J,Se,Ae)=>{if(!t)throw new Error("No budget selected");await g(t,e,n,Z,le,pe,Ee,ge,J,Se,Ae)},[t,e,n,g]),V=T.useCallback(async Z=>{if(!t)throw new Error("No budget selected");await _(t,e,n,Z)},[t,e,n,_]),W=T.useCallback(async(Z,le,pe,Ee,ge,J,Se,Ae)=>{if(!t)throw new Error("No budget selected");const[ct,Me]=J.split("-").map(Number);await v(t,ct,Me,Z,le,pe,Ee,ge,J,Se,Ae)},[t,v]),ee=T.useCallback(async(Z,le,pe,Ee,ge,J,Se,Ae,ct)=>{if(!t)throw new Error("No budget selected");await S(t,e,n,Z,le,pe,Ee,ge,J,Se,Ae,ct)},[t,e,n,S]),ie=T.useCallback(async Z=>{if(!t)throw new Error("No budget selected");await x(t,e,n,Z)},[t,e,n,x]),U=T.useCallback(async(Z,le,pe,Ee,ge,J)=>{if(!t)throw new Error("No budget selected");const[Se,Ae]=Ee.split("-").map(Number);await E(t,Se,Ae,Z,le,pe,Ee,ge,J)},[t,E]),H=T.useCallback(async(Z,le,pe,Ee,ge,J,Se)=>{if(!t)throw new Error("No budget selected");await C(t,e,n,Z,le,pe,Ee,ge,J,Se)},[t,e,n,C]),ne=T.useCallback(async Z=>{if(!t)throw new Error("No budget selected");await I(t,e,n,Z)},[t,e,n,I]),se=T.useCallback(async()=>{t&&await Ve.invalidateQueries({queryKey:xe.month(t,e,n)})},[t,e,n]);return{isLoading:o.isLoading,isFetching:o.isFetching,error:o.error,month:j,income:M,expenses:Q,transfers:q,adjustments:G,categoryBalances:D,totalIncome:A,totalExpenses:N,areAllocationsFinalized:L,previousMonthIncome:P,addIncome:B,updateIncome:O,deleteIncome:K,addExpense:Y,updateExpense:z,deleteExpense:V,addTransfer:W,updateTransfer:ee,deleteTransfer:ie,addAdjustment:U,updateAdjustment:H,deleteAdjustment:ne,refreshMonth:se}}function TB({currentBudget:t,accounts:e,accountGroups:n,setAccountsOptimistic:r,setAccountGroupsOptimistic:a,saveAccounts:o,saveAccountGroups:u,setError:h}){const f=T.useCallback(async(g,_,v)=>{const S=e[g];if(!S)return;const x=v==="ungrouped"?null:v,E=Object.entries(e).filter(([,j])=>(j.account_group_id||"ungrouped")===v),C={};Object.entries(e).forEach(([j,M])=>{j!==g&&(C[j]={...M})});let I;if(_==="__group_end__"||E.length===0||!E.find(([j])=>j===_))I=(E.length>0?Math.max(...E.filter(([M])=>M!==g).map(([,M])=>M.sort_order)):-1)+1;else{const j=E.find(([M])=>M===_);if(j){const[,M]=j;I=M.sort_order,Object.entries(C).forEach(([Q,q])=>{(q.account_group_id||"ungrouped")===v&&q.sort_order>=I&&(C[Q]={...q,sort_order:q.sort_order+1})})}else I=0}if(C[g]={...S,account_group_id:x,sort_order:I},r(C),!!t)try{await o(C)}catch(j){h(j instanceof Error?j.message:"Failed to save changes")}},[t,e,r,o,h]),m=T.useCallback(async(g,_)=>{if(g===_)return;const v=Object.entries(n).sort(([,I],[,j])=>I.sort_order-j.sort_order),S=v.findIndex(([I])=>I===g),x=[...v],[E]=x.splice(S,1);if(_==="__end__")x.push(E);else{const I=x.findIndex(([j])=>j===_);x.splice(I,0,E)}const C={};if(x.forEach(([I,j],M)=>{C[I]={...j,sort_order:M}}),a(C),!!t)try{await u(C)}catch(I){h(I instanceof Error?I.message:"Failed to save new order")}},[t,n,a,u,h]);return{reorderAccountsInGroup:f,reorderGroups:m}}function AB(){const{budget:t,accounts:e,accountGroups:n,saveAccounts:r,saveAccountGroups:a,saveAccountsAndGroups:o,setAccountsOptimistic:u,setAccountGroupsOptimistic:h}=kn(),[f,m]=T.useState(null),g=T.useMemo(()=>Object.entries(e).filter(([,D])=>!D.is_hidden).reduce((D,[A,N])=>{const L=N.account_group_id||"ungrouped";return D[L]||(D[L]=[]),D[L].push({...N,id:A}),D},{}),[e]),_=T.useMemo(()=>Object.entries(e).filter(([,D])=>D.is_hidden).map(([D,A])=>({...A,id:D})).sort((D,A)=>D.sort_order-A.sort_order),[e]),v=T.useMemo(()=>Object.entries(n).sort(([,D],[,A])=>D.sort_order-A.sort_order).map(([D,A])=>({...A,id:D})),[n]),S=T.useCallback((D,A)=>{if(!t)return;const N=Object.values(e).filter(K=>A==="ungrouped"?!K.account_group_id:K.account_group_id===A),L=N.length>0?Math.max(...N.map(K=>K.sort_order)):-1,P=`account_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,B={nickname:D.nickname,description:"",balance:0,account_group_id:A==="ungrouped"?null:A,sort_order:L+1,is_income_account:D.is_income_account??!1,is_income_default:D.is_income_default??!1,is_outgo_account:D.is_outgo_account??!1,is_outgo_default:D.is_outgo_default??!1,on_budget:D.on_budget!==!1,is_active:D.is_active!==!1,is_hidden:D.is_hidden??!1},O={...e};D.is_income_default&&Object.keys(O).forEach(K=>{O[K]={...O[K],is_income_default:!1}}),D.is_outgo_default&&Object.keys(O).forEach(K=>{O[K]={...O[K],is_outgo_default:!1}}),O[P]=B,u(O),r(O).catch(K=>m(K instanceof Error?K.message:"Failed to create account."))},[t,e,u,r]),x=T.useCallback((D,A)=>{if(!t)return;const N=e[D];if(!N)return;const L=N.account_group_id||"ungrouped",P=A.account_group_id;let B=N.sort_order;if(L!==(P||"ungrouped")){const K=Object.values(e).filter(Y=>(Y.account_group_id||"ungrouped")===(P||"ungrouped"));B=K.length>0?Math.max(...K.map(Y=>Y.sort_order))+1:0}const O={};Object.entries(e).forEach(([K,Y])=>{K===D?O[K]={...Y,nickname:A.nickname,account_group_id:P,sort_order:B,is_income_account:A.is_income_account??!1,is_income_default:A.is_income_default??!1,is_outgo_account:A.is_outgo_account??!1,is_outgo_default:A.is_outgo_default??!1,on_budget:A.on_budget!==!1,is_active:A.is_active!==!1,is_hidden:A.is_hidden??!1}:(O[K]={...Y},A.is_income_default&&!N.is_income_default&&(O[K].is_income_default=!1),A.is_outgo_default&&!N.is_outgo_default&&(O[K].is_outgo_default=!1))}),u(O),r(O).catch(K=>m(K instanceof Error?K.message:"Failed to save account."))},[t,e,u,r]),E=T.useCallback(D=>{if(!confirm("Are you sure you want to delete this account?")||!t)return;const{[D]:A,...N}=e;u(N),r(N).catch(L=>m(L instanceof Error?L.message:"Failed to delete account."))},[t,e,u,r]),C=T.useCallback(async(D,A)=>{const N=e[D];if(!N)return;const L=N.account_group_id||"ungrouped",P=Object.entries(e).filter(([,V])=>(V.account_group_id||"ungrouped")===L).sort(([,V],[,W])=>V.sort_order-W.sort_order),B=P.findIndex(([V])=>V===D),O=A==="up"?B-1:B+1;if(O<0||O>=P.length)return;const[K,Y]=P[O],z={};if(Object.entries(e).forEach(([V,W])=>{V===D?z[V]={...W,sort_order:Y.sort_order}:V===K?z[V]={...W,sort_order:N.sort_order}:z[V]={...W}}),u(z),!!t)try{await r(z)}catch(V){u(e),m(V instanceof Error?V.message:"Failed to move account")}},[t,e,u,r]),I=T.useCallback(D=>{if(!t)return;const A=Object.values(n).map(O=>O.sort_order),N=A.length>0?Math.max(...A):-1,L=`account_group_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,P={name:D.name,sort_order:N+1,expected_balance:D.expected_balance,on_budget:D.on_budget,is_active:D.is_active},B={...n,[L]:P};h(B),a(B).catch(O=>m(O instanceof Error?O.message:"Failed to create account type."))},[t,n,h,a]),j=T.useCallback((D,A)=>{if(!t)return;const N={...n,[D]:{...n[D],name:A.name,expected_balance:A.expected_balance,on_budget:A.on_budget,is_active:A.is_active}};h(N),a(N).catch(L=>m(L instanceof Error?L.message:"Failed to update account type."))},[t,n,h,a]),M=T.useCallback(D=>{if(!confirm("Are you sure you want to delete this account type? Accounts in this type will move to Ungrouped.")||!t)return;const A={};Object.entries(e).forEach(([P,B])=>{A[P]=B.account_group_id===D?{...B,account_group_id:null}:B});const{[D]:N,...L}=n;u(A),h(L),o(A,L).catch(P=>m(P instanceof Error?P.message:"Failed to delete account type."))},[t,e,n,u,h,o]),Q=T.useCallback(async(D,A)=>{const N=Object.entries(n).sort(([,K],[,Y])=>K.sort_order-Y.sort_order),L=N.findIndex(([K])=>K===D),P=A==="up"?L-1:L+1;if(P<0||P>=N.length)return;const[B]=N.splice(L,1);N.splice(P,0,B);const O={};if(N.forEach(([K,Y],z)=>{O[K]={...Y,sort_order:z}}),h(O),!!t)try{await a(O)}catch(K){h(n),m(K instanceof Error?K.message:"Failed to move account type")}},[t,n,h,a]),{reorderAccountsInGroup:q,reorderGroups:G}=TB({currentBudget:t,accounts:e,accountGroups:n,setAccountsOptimistic:u,setAccountGroupsOptimistic:h,saveAccounts:r,saveAccountGroups:a,setError:m});return{accounts:e,accountGroups:n,accountsByGroup:g,hiddenAccounts:_,sortedGroups:v,currentBudget:t,error:f,setError:m,handleCreateAccount:S,handleUpdateAccount:x,handleDeleteAccount:E,handleMoveAccount:C,handleCreateGroup:I,handleUpdateGroup:j,handleDeleteGroup:M,handleMoveGroup:Q,reorderAccountsInGroup:q,reorderGroups:G}}function yw(t,e){if(!t)return{};const n={};return Object.entries(e).forEach(([r,a])=>{if(a.default_monthly_type==="percentage")return;const o=t.category_balances?.find(u=>u.category_id===r);o&&o.allocated>0?n[r]=o.allocated.toString():a.default_monthly_amount!==void 0&&a.default_monthly_amount>0?n[r]=a.default_monthly_amount.toString():n[r]=""}),n}function jB(){const{addLoadingHold:t,removeLoadingHold:e}=ir(),{selectedBudgetId:n,currentYear:r,currentMonthNumber:a}=zt(),{categories:o,getOnBudgetTotal:u,totalAvailable:h}=kn(),{month:f,isLoading:m,previousMonthIncome:g,areAllocationsFinalized:_}=_i(n,r,a),v=T.useMemo(()=>f?.income?f.income.reduce((U,H)=>U+H.amount,0):0,[f]),{saveDraftAllocations:S}=q4(),{finalizeAllocations:x}=H4(),{deleteAllocations:E}=dT(),C=T.useMemo(()=>yw(f,o),[f,o]),[I,j]=T.useState(C),[M,Q]=T.useState(!1),[q,G]=T.useState(null),D=T.useRef(null);T.useMemo(()=>Object.values(o).reduce((U,H)=>U+(H.balance??0),0),[o]),T.useEffect(()=>{if(!f)return;const U=`${f.year}-${f.month}`;D.current!==U&&(Q(!1),j(yw(f,o)),D.current=U)},[f,o]);const A=T.useCallback((U,H)=>{if(H.default_monthly_type==="percentage"&&H.default_monthly_amount!==void 0)return we(H.default_monthly_amount/100*g);const ne=I[U],se=parseFloat(ne||"0");return isNaN(se)?0:we(se)},[I,g]),N=T.useMemo(()=>Object.entries(o).reduce((U,[H,ne])=>{const se=A(H,ne),Z=ne.balance??0;if(Z<0){const le=Math.abs(Z),pe=Math.max(0,se-le);return U+pe}return U+se},0),[o,A]),L=u(),P=_?(f?.category_balances||[]).reduce((U,H)=>{const ne=o[H.category_id]?.balance??0,se=H.allocated,Z=ne-se;if(Z<0){const le=Math.abs(Z);return U+Math.max(0,se-le)}return U+se},0):0,B=M?h+P:h,O=T.useMemo(()=>M?B-N:B-N+P,[B,N,P,M]),K=T.useCallback((U,H)=>{j(ne=>({...ne,[U]:H}))},[]),Y=T.useCallback(()=>{if(!f)return;const U={};Object.entries(o).forEach(([H,ne])=>{if(ne.default_monthly_type==="percentage")return;const se=f.category_balances?.find(Z=>Z.category_id===H);se&&se.allocated>0?U[H]=se.allocated.toString():ne.default_monthly_amount!==void 0&&ne.default_monthly_amount>0?U[H]=ne.default_monthly_amount.toString():U[H]=""}),j(U),Q(!1)},[f,o]),z=T.useCallback(()=>{const U={};return Object.entries(o).forEach(([H,ne])=>{const se=A(H,ne);se>0&&(U[H]=se)}),U},[o,A]),V=T.useCallback(async()=>{if(n){G(null),t("allocations-save","Saving allocations...");try{await S(n,r,a,z()),Q(!1)}catch(U){G(U instanceof Error?U.message:"Failed to save allocations")}finally{e("allocations-save")}}},[n,r,a,S,z,t,e]),W=T.useCallback(async()=>{if(n){G(null),t("allocations-finalize","Applying allocations...");try{await x({budgetId:n,year:r,month:a,allocations:z(),onProgress:U=>{t("allocations-finalize",U.message)}}),Q(!1)}catch(U){G(U instanceof Error?U.message:"Failed to finalize allocations")}finally{e("allocations-finalize")}}},[n,r,a,x,z,t,e]),ee=T.useCallback(async()=>{if(n){G(null),t("allocations-delete","Deleting allocations...");try{await E({budgetId:n,year:r,month:a,onProgress:H=>{t("allocations-delete",H.message)}});const U={};Object.entries(o).forEach(([H,ne])=>{ne.default_monthly_type!=="percentage"&&(ne.default_monthly_amount!==void 0&&ne.default_monthly_amount>0?U[H]=ne.default_monthly_amount.toString():U[H]="")}),j(U),Q(!1)}catch(U){G(U instanceof Error?U.message:"Failed to delete allocations")}finally{e("allocations-delete")}}},[n,r,a,E,o,t,e]),ie=N-P;return{localAllocations:I,isEditingAppliedAllocations:M,error:q,monthLoading:m,onBudgetTotal:L,availableNow:B,currentDraftTotal:N,draftChangeAmount:ie,availableAfterApply:O,previousMonthIncome:g,currentMonthIncome:v,allocationsFinalized:_,getAllocationAmount:A,handleAllocationChange:K,resetAllocationsToSaved:Y,handleSaveAllocations:V,handleFinalizeAllocations:W,handleDeleteAllocations:ee,setIsEditingAppliedAllocations:Q,setError:G}}function RB({budgetId:t,categories:e,currentYear:n,currentMonth:r,updateCategoriesWithBalances:a}){const o=T.useMemo(()=>{const v={};return Object.entries(e).forEach(([S,x])=>{v[S]={current:x.balance??0,total:x.balance??0}}),v},[e]),[u,h]=T.useState(!1),[f,m]=T.useState(null),g=T.useCallback(async()=>{if(!t||Object.keys(e).length===0)return null;const v=Object.keys(e),{total:S}=await gw(t,v,n,r),x={};Object.entries(e).forEach(([C,I])=>{const j=I.balance,M=S[C]??0;Math.abs(j-M)>.01&&(x[C]={stored:j,calculated:M})});const E=Object.keys(x).length>0?x:null;return m(E),E},[t,e,n,r]),_=T.useCallback(async()=>{if(!(!t||Object.keys(e).length===0)){h(!0);try{const v=Object.keys(e),{total:S}=await gw(t,v,n,r),x={};Object.entries(e).forEach(([E,C])=>{x[E]={...C,balance:S[E]??0}}),await a(x),m(null)}finally{h(!1)}}},[t,e,a,n,r]);return{categoryBalances:o,loadingBalances:u,categoryBalanceMismatch:f,checkCategoryBalanceMismatch:g,recalculateAndSaveCategoryBalances:_}}function DB({categories:t,categoryGroups:e,currentBudget:n,setCategoriesOptimistic:r,setCategoryGroupsOptimistic:a,saveCategories:o,saveCategoryGroups:u,setError:h}){const[f,m]=T.useState(null),[g,_]=T.useState(null),[v,S]=T.useState(null),[x,E]=T.useState(null);function C(L,P){m("category"),_(P),L.dataTransfer.effectAllowed="move"}function I(L,P,B){L.preventDefault(),f==="category"&&(P!==g&&S(P),E(B))}function j(L,P){L.preventDefault(),f==="category"?(E(P),S(null)):f==="group"&&P!==g&&S(P)}function M(){S(null)}function Q(){E(null)}function q(){m(null),_(null),S(null),E(null)}async function G(L,P,B){if(L.preventDefault(),L.stopPropagation(),!g||f!=="category"){q();return}const O=t[g];if(!O)return;const K=B==="ungrouped"?null:B,Y=Object.entries(t).filter(([,W])=>(W.category_group_id||"ungrouped")===B),z={};Object.entries(t).forEach(([W,ee])=>{W!==g&&(z[W]=ee)});let V;if(P==="__group_end__"||Y.length===0||!Y.find(([W])=>W===P))V=(Y.length>0?Math.max(...Y.filter(([ee])=>ee!==g).map(([,ee])=>ee.sort_order)):-1)+1;else{const W=Y.find(([ee])=>ee===P);W?(V=W[1].sort_order,Object.entries(z).forEach(([ee,ie])=>{(ie.category_group_id||"ungrouped")===B&&ie.sort_order>=V&&(z[ee]={...ie,sort_order:ie.sort_order+1})})):V=0}if(z[g]={...O,category_group_id:K,sort_order:V},r(z),q(),!!n)try{await o(z)}catch(W){h(W instanceof Error?W.message:"Failed to save changes")}}async function D(L,P){L.preventDefault(),f==="category"?await G(L,"__group_end__",P):f==="group"&&await N(L,P)}function A(L,P){L.stopPropagation(),m("group"),_(P),L.dataTransfer.effectAllowed="move"}async function N(L,P){if(L.preventDefault(),!g||f!=="group"||g===P){q();return}const B=e.findIndex(z=>z.id===g),O=[...e],[K]=O.splice(B,1);if(P==="__end__")O.push(K);else{const z=O.findIndex(V=>V.id===P);O.splice(z,0,K)}const Y=O.map((z,V)=>({...z,sort_order:V}));if(a(Y),q(),!!n)try{await u(Y)}catch(z){h(z instanceof Error?z.message:"Failed to save new order")}}return{dragType:f,draggedId:g,dragOverId:v,dragOverGroupId:x,setDragOverId:S,setDragOverGroupId:E,handleCategoryDragStart:C,handleCategoryDragOver:I,handleDragOverGroup:j,handleDragLeave:M,handleDragLeaveGroup:Q,handleDragEnd:q,handleCategoryDrop:G,handleDropOnGroup:D,handleGroupDragStart:A,handleGroupDrop:N}}function IB(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n}=zt(),{budget:r,categories:a,categoryGroups:o,isLoading:u,saveCategories:h,saveCategoryGroups:f,saveCategoriesAndGroups:m,setCategoriesOptimistic:g,setCategoryGroupsOptimistic:_,getOnBudgetTotal:v}=kn(),[S,x]=T.useState(null),{categoryBalances:E,loadingBalances:C,categoryBalanceMismatch:I,checkCategoryBalanceMismatch:j,recalculateAndSaveCategoryBalances:M}=RB({budgetId:t,categories:a,currentYear:e,currentMonth:n,updateCategoriesWithBalances:h}),Q=DB({categories:a,categoryGroups:o,currentBudget:r,setCategoriesOptimistic:g,setCategoryGroupsOptimistic:_,saveCategories:h,saveCategoryGroups:f,setError:x});async function q(z,V){if(!r)return;const W=V==="ungrouped"?null:V,ee=Object.values(a).filter(se=>V==="ungrouped"?!se.category_group_id:se.category_group_id===V),ie=ee.length>0?Math.max(...ee.map(se=>se.sort_order)):-1,U=`category_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,H={name:z.name,description:z.description??"",category_group_id:W,sort_order:ie+1,default_monthly_amount:z.default_monthly_amount??0,default_monthly_type:z.default_monthly_type??"fixed",balance:0,is_hidden:z.is_hidden??!1},ne={...a,[U]:H};g(ne);try{await h(ne)}catch(se){g(a),x(se instanceof Error?se.message:"Failed to create category")}}async function G(z,V){if(r)try{const W=a[z];if(!W)return;const ee=W.category_group_id||"ungrouped",ie=V.category_group_id;let U=W.sort_order;if(ee!==(ie||"ungrouped")){const ne=Object.values(a).filter(se=>(se.category_group_id||"ungrouped")===(ie||"ungrouped")).filter((se,Z,le)=>a[z]!==le[Z]);U=ne.length>0?Math.max(...ne.map(se=>se.sort_order))+1:0}const H={...a,[z]:{...W,name:V.name,description:V.description??"",category_group_id:ie,sort_order:U,default_monthly_amount:V.default_monthly_amount??0,default_monthly_type:V.default_monthly_type??"fixed",is_hidden:V.is_hidden??!1}};g(H),await h(H)}catch(W){x(W instanceof Error?W.message:"Failed to update category")}}async function D(z){if(confirm("Are you sure you want to delete this category?")&&r)try{const{[z]:V,...W}=a;g(W),await h(W)}catch(V){x(V instanceof Error?V.message:"Failed to delete category")}}async function A(z,V){const W=a[z];if(!W)return;const ee=W.category_group_id||"ungrouped",ie=Object.entries(a).filter(([,le])=>(le.category_group_id||"ungrouped")===ee).sort((le,pe)=>le[1].sort_order-pe[1].sort_order),U=ie.findIndex(([le])=>le===z),H=V==="up"?U-1:U+1;if(H<0||H>=ie.length)return;const[ne,se]=ie[H],Z={};if(Object.entries(a).forEach(([le,pe])=>{le===z?Z[le]={...pe,sort_order:se.sort_order}:le===ne?Z[le]={...pe,sort_order:W.sort_order}:Z[le]=pe}),g(Z),!!r)try{await h(Z)}catch(le){g(a),x(le instanceof Error?le.message:"Failed to move category")}}async function N(z){if(r)try{const V=o.length>0?Math.max(...o.map(ie=>ie.sort_order)):-1,W={id:`category_group_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,name:z.name,sort_order:V+1},ee=[...o,W];_(ee),await f(ee)}catch(V){x(V instanceof Error?V.message:"Failed to create group")}}async function L(z,V){if(r)try{const W=o.map(ee=>ee.id===z?{...ee,name:V.name}:ee);_(W),await f(W)}catch(W){x(W instanceof Error?W.message:"Failed to update group")}}async function P(z){if(confirm("Are you sure you want to delete this group? Categories in this group will move to Uncategorized.")&&r)try{const V={};Object.entries(a).forEach(([ee,ie])=>{V[ee]=ie.category_group_id===z?{...ie,category_group_id:null}:ie});const W=o.filter(ee=>ee.id!==z);g(V),_(W),await m(V,W)}catch(V){x(V instanceof Error?V.message:"Failed to delete group")}}async function B(z,V){const W=[...o].sort((ne,se)=>ne.sort_order-se.sort_order),ee=W.findIndex(ne=>ne.id===z),ie=V==="up"?ee-1:ee+1;if(ie<0||ie>=W.length)return;const[U]=W.splice(ee,1);W.splice(ie,0,U);const H=W.map((ne,se)=>({...ne,sort_order:se}));if(_(H),!!r)try{await f(H)}catch(ne){_(o),x(ne instanceof Error?ne.message:"Failed to move group")}}const O=Object.entries(a).filter(([,z])=>!z.is_hidden).reduce((z,[V,W])=>{const ee=W.category_group_id||"ungrouped";return z[ee]||(z[ee]=[]),z[ee].push([V,W]),z},{}),K=Object.entries(a).filter(([,z])=>z.is_hidden).map(([z,V])=>[z,V]).sort((z,V)=>z[1].sort_order-V[1].sort_order),Y=[...o].sort((z,V)=>z.sort_order-V.sort_order);return{currentBudget:r,categories:a,categoryGroups:o,categoriesByGroup:O,hiddenCategories:K,sortedGroups:Y,categoryBalances:E,isLoading:u,loadingBalances:C,error:S,setError:x,getOnBudgetTotal:v,categoryBalanceMismatch:I,checkCategoryBalanceMismatch:j,recalculateAndSaveCategoryBalances:M,handleCreateCategory:q,handleUpdateCategory:G,handleDeleteCategory:D,handleMoveCategory:A,handleCreateGroup:N,handleUpdateGroup:L,handleDeleteGroup:P,handleMoveGroup:B,dragType:Q.dragType,draggedId:Q.draggedId,dragOverId:Q.dragOverId,dragOverGroupId:Q.dragOverGroupId,setDragOverId:Q.setDragOverId,setDragOverGroupId:Q.setDragOverGroupId,handleCategoryDragStart:Q.handleCategoryDragStart,handleCategoryDragOver:Q.handleCategoryDragOver,handleDragOverGroup:Q.handleDragOverGroup,handleDragLeave:Q.handleDragLeave,handleDragLeaveGroup:Q.handleDragLeaveGroup,handleDragEnd:Q.handleDragEnd,handleCategoryDrop:Q.handleCategoryDrop,handleDropOnGroup:Q.handleDropOnGroup,handleGroupDragStart:Q.handleGroupDragStart,handleGroupDrop:Q.handleGroupDrop}}function vo(){Ve.removeQueries({queryKey:["budget"]}),Ve.removeQueries({queryKey:["month"]}),Ve.removeQueries({queryKey:["accessibleBudgets"]}),Ve.removeQueries({queryKey:["payees"]}),Ve.removeQueries({queryKey:["user"]});try{localStorage.removeItem("BUDGET_APP_QUERY_CACHE")}catch{}console.log("[Migration] All caches cleared")}async function sc(t){try{const e=await t();return vo(),e}catch(e){throw vo(),e}}const mT=T.createContext(null),_w={isOpen:!1,migrationName:"",stage:"",progress:null,currentItem:null,details:null,isComplete:!1,error:null};function MB({children:t}){const[e,n]=T.useState(_w),r=T.useCallback(()=>({setStage:h=>{n(f=>({...f,stage:h}))},setProgress:h=>{n(f=>({...f,progress:h}))},setCurrentItem:h=>{n(f=>({...f,currentItem:h}))},setDetails:h=>{n(f=>({...f,details:h}))},updateItemProgress:(h,f,m)=>{const g=f>0?Math.round(h/f*100):0;n(_=>({..._,progress:g,currentItem:m||`Item ${h} of ${f}`,details:`${h} / ${f} complete`}))}}),[]),a=T.useCallback(async(h,f)=>{n({isOpen:!0,migrationName:h,stage:"Starting migration...",progress:null,currentItem:null,details:null,isComplete:!1,error:null});const m=r();try{const g=await f(m);return vo(),n(_=>({..._,isComplete:!0,stage:"Migration complete",progress:100,details:g.errors.length>0?`Completed with ${g.errors.length} error(s)`:"All operations successful"})),g}catch(g){vo();const _=g instanceof Error?g.message:"Unknown error occurred";throw n(v=>({...v,isComplete:!0,error:_,stage:"Migration failed",progress:null})),g}},[r]),o=T.useCallback(()=>{n(h=>h.isComplete?_w:(console.warn("[MigrationProgress] Cannot close modal while migration is running"),h))},[]),u={state:e,runMigrationWithProgress:a,closeModal:o};return c.jsx(mT.Provider,{value:u,children:t})}function I0(){const t=T.useContext(mT);if(!t)throw new Error("useMigrationProgress must be used within MigrationProgressProvider");return t}async function kB(t){return(await Ot("budgets",`${t}: batch reading all budgets`)).docs.map(n=>({id:n.id,data:n.data}))}async function OB(t,e){return(await Ot("months",`${e}: batch reading months for budget ${t}`,[{field:"budget_id",op:"==",value:t}])).docs.map(a=>({id:a.id,data:a.data,budgetId:a.data.budget_id,year:a.data.year,month:a.data.month})).sort((a,o)=>a.year!==o.year?a.year-o.year:a.month-o.month)}async function xr(t){const e=await kB(t),n=await Ot("months",`${t}: batch reading all months`),r=new Map;for(const a of n.docs){const o=a.data.budget_id,u={id:a.id,data:a.data,budgetId:o,year:a.data.year,month:a.data.month};r.has(o)||r.set(o,[]),r.get(o).push(u)}for(const a of r.values())a.sort((o,u)=>o.year!==u.year?o.year-u.year:o.month-u.month);return{budgets:e,monthsByBudget:r}}async function rd(t,e){if(t.length===0)return;const n=t.map(r=>({collectionPath:"months",docId:yr(r.budgetId,r.year,r.month),data:{...r.data,updated_at:new Date().toISOString()}}));await hm(n,`${e}: batch writing ${t.length} months`)}async function pT(t,e){if(t.length===0)return;const n=t.map(r=>({collectionPath:"budgets",docId:r.budgetId,data:{...r.data,updated_at:new Date().toISOString()}}));await hm(n,`${e}: batch writing ${t.length} budgets`)}async function gT(t,e,n){if(e.length===0)return;let r=j0;const a=[];for(const g of e){const _=R0(g,r);a.push(_),r=If(_)}const o=a.map(g=>({budgetId:t,year:g.year,month:g.month,data:g}));await rd(o,n);const u=r.accountEndBalances,h=r.categoryEndBalances,{exists:f,data:m}=await Qe("budgets",t,`${n}: reading budget for final update`);if(f&&m){const g=aT(m.month_map||{}),_=D0(g);await lT(t,u,h,_)}}async function yT(t,e){if(t.length===0)return;const n=new Map;for(const r of t)n.has(r.budgetId)||n.set(r.budgetId,[]),n.get(r.budgetId).push(r);for(const[r,a]of n){a.sort((h,f)=>h.year!==f.year?h.year-f.year:h.month-f.month),await rd(a,e);const u=(await OB(r,e)).map(h=>h.data);await gT(r,u,e)}}function _T(t){return t.nickname===void 0||t.description===void 0||t.balance===void 0||t.sort_order===void 0||t.is_income_account===void 0||t.is_income_default===void 0||t.is_outgo_account===void 0||t.is_outgo_default===void 0||t.on_budget===void 0||t.is_active===void 0}function bT(t){return t.name===void 0||t.description===void 0||t.sort_order===void 0||t.default_monthly_amount===void 0||t.default_monthly_type===void 0||t.balance===void 0}function vT(t){return t.name===void 0||t.sort_order===void 0}function xT(t){return t.budget_id===void 0||t.year_month_ordinal===void 0||t.year===void 0||t.month===void 0||!Array.isArray(t.income)||t.total_income===void 0||t.previous_month_income===void 0||!Array.isArray(t.expenses)||t.total_expenses===void 0||!Array.isArray(t.account_balances)||!Array.isArray(t.category_balances)||t.are_allocations_finalized===void 0||t.created_at===void 0||t.updated_at===void 0}function ST(){const t=new Date,e=t.getFullYear();let r=t.getMonth()+1+Nu,a=e;for(;r>12;)r-=12,a+=1;return{year:a,month:r}}function wT(t,e,n){return t>n.year||t===n.year&&e>n.month}async function NB(){const t=await Ot("budgets","database cleanup: scanning all budgets");let e=0,n=0,r=0,a=0,o=0,u=0,h=0,f=0,m=0;const g=new Set;for(const j of t.docs){const M=j.data;if(Array.isArray(M.accounts)||Array.isArray(M.categories)||Array.isArray(M.account_groups)){e++;continue}g.add(j.id),M.month_map===void 0&&f++,M.earliest_month!==void 0&&m++;const Q=M.accounts;if(Q&&typeof Q=="object"){let D=!1;for(const A of Object.values(Q))_T(A)&&(o++,D=!0);D&&n++}const q=M.categories;if(q&&typeof q=="object"){let D=!1;for(const A of Object.values(q))bT(A)&&(u++,D=!0);D&&r++}const G=M.account_groups;if(G&&typeof G=="object"){let D=!1;for(const A of Object.values(G))vT(A)&&(h++,D=!0);D&&a++}}const _=await Ot("months","database cleanup: scanning all months"),v=ST(),S=[];let x=0,E=0;for(const j of _.docs){const M=j.data,Q=M.year,q=M.month;Q&&q&&wT(Q,q,v)&&S.push({docId:j.id,budgetId:M.budget_id,year:Q,month:q}),xT(M)&&x++,M.is_needs_recalculation!==void 0&&E++}S.sort((j,M)=>j.year!==M.year?j.year-M.year:j.month-M.month);const C=await Ot("data_mappings","database cleanup: scanning all data mappings");let I=0;for(const j of C.docs)j.data.budget_id===void 0&&I++;return{totalBudgets:t.docs.length,budgetsWithArrays:e,budgetsWithMissingAccountDefaults:n,budgetsWithMissingCategoryDefaults:r,budgetsWithMissingGroupDefaults:a,accountsNeedingDefaults:o,categoriesNeedingDefaults:u,groupsNeedingDefaults:h,budgetsNeedingMonthMapUpdate:f,budgetsWithDeprecatedEarliestMonth:m,totalMonths:_.docs.length,futureMonthsToDelete:S,monthsWithSchemaIssues:x,monthsWithOldRecalcField:E,totalDataMappings:C.docs.length,dataMappingsMissingBudgetId:I}}function bw(t){return{nickname:t.nickname??"",description:t.description??"",balance:t.balance??0,account_group_id:t.account_group_id??null,sort_order:t.sort_order??0,is_income_account:t.is_income_account??!1,is_income_default:t.is_income_default??!1,is_outgo_account:t.is_outgo_account??!1,is_outgo_default:t.is_outgo_default??!1,on_budget:t.on_budget??!0,is_active:t.is_active??!0,is_hidden:t.is_hidden??!1}}function vw(t){return{name:t.name??"",description:t.description??"",category_group_id:t.category_group_id??null,sort_order:t.sort_order??0,default_monthly_amount:t.default_monthly_amount??0,default_monthly_type:t.default_monthly_type??"fixed",balance:t.balance??0,is_hidden:t.is_hidden??!1}}function xw(t){return{name:t.name??"",sort_order:t.sort_order??0,...t.expected_balance!==void 0&&{expected_balance:t.expected_balance},...t.on_budget!==void 0&&{on_budget:t.on_budget},...t.is_active!==void 0&&{is_active:t.is_active}}}function PB(t,e){const n=e.match(/_(\d{4})(\d{2})$/),r=n?parseInt(n[1]):new Date().getFullYear(),a=n?parseInt(n[2]):new Date().getMonth()+1,o=`${r}${String(a).padStart(2,"0")}`;return{budget_id:t.budget_id??"",year_month_ordinal:t.year_month_ordinal??o,year:t.year??r,month:t.month??a,income:Array.isArray(t.income)?t.income:[],total_income:t.total_income??0,previous_month_income:t.previous_month_income??0,expenses:Array.isArray(t.expenses)?t.expenses:[],total_expenses:t.total_expenses??0,transfers:Array.isArray(t.transfers)?t.transfers:[],adjustments:Array.isArray(t.adjustments)?t.adjustments:[],account_balances:Array.isArray(t.account_balances)?t.account_balances:[],category_balances:Array.isArray(t.category_balances)?t.category_balances:[],are_allocations_finalized:t.are_allocations_finalized??!1,created_at:t.created_at??new Date().toISOString(),updated_at:t.updated_at??new Date().toISOString()}}async function BB(t){const e={},n=await Ot("months",`database cleanup: querying all months for budget ${t}`,[{field:"budget_id",op:"==",value:t}]);for(const r of n.docs){const a=r.data;if(a.year&&a.month){const o=At(a.year,a.month);e[o]={needs_recalculation:!1}}}return e}async function LB(){const t=[];let e=0,n=0,r=0,a=0,o=0,u=0,h=0,f=0,m=0,g=0;const _=await Ot("budgets","database cleanup: reading all budgets to fix");for(const C of _.docs)try{const{exists:I,data:j}=await Qe("budgets",C.id,"database cleanup: reading budget for update");if(!I||!j)continue;let M=!1;const Q={...j};if(Array.isArray(j.accounts)){const q=j.accounts,G={};for(const D of q){const A=D.id||`account_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;G[A]=bw(D),n++}Q.accounts=G,M=!0,o++}if(Array.isArray(j.categories)){const q=j.categories,G={};for(const D of q){const A=D.id||`category_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;G[A]=vw(D),r++}Q.categories=G,M=!0,o++}if(Array.isArray(j.account_groups)){const q=j.account_groups,G={};for(const D of q){const A=D.id||`group_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;G[A]=xw(D),a++}Q.account_groups=G,M=!0,o++}if(!Array.isArray(j.accounts)&&j.accounts&&typeof j.accounts=="object"){const q=j.accounts,G={};for(const[D,A]of Object.entries(q))_T(A)?(G[D]=bw(A),n++,M=!0):G[D]=A;M&&(Q.accounts=G)}if(!Array.isArray(j.categories)&&j.categories&&typeof j.categories=="object"){const q=j.categories,G={};let D=!1;for(const[A,N]of Object.entries(q))bT(N)?(G[A]=vw(N),r++,D=!0):G[A]=N;D&&(Q.categories=G,M=!0)}if(!Array.isArray(j.account_groups)&&j.account_groups&&typeof j.account_groups=="object"){const q=j.account_groups,G={};let D=!1;for(const[A,N]of Object.entries(q))vT(N)?(G[A]=xw(N),a++,D=!0):G[A]=N;D&&(Q.account_groups=G,M=!0)}if(j.month_map===void 0){const q=await BB(C.id);Q.month_map=q,M=!0,u++}delete Q.category_balances,delete Q.allocations,delete Q.allocations_finalized,delete Q.is_needs_recalculation,delete Q.earliest_month,M&&(await ft("budgets",C.id,Q,"database cleanup: saving fixed budget"),e++),j.earliest_month!==void 0&&(await zl("budgets",C.id,{earliest_month:mw(),updated_at:new Date().toISOString()},`database cleanup: removing deprecated earliest_month from budget ${C.id}`),h++)}catch(I){t.push(`Budget ${C.id}: ${I instanceof Error?I.message:"Unknown error"}`)}const v=await Ot("months","database cleanup: reading all months"),S=ST();for(const C of v.docs)try{const I=C.data,j=I.year,M=I.month;if(j&&M&&wT(j,M,S)){await Ou("months",C.id,`database cleanup: deleting future month ${j}-${M}`),f++;continue}if(xT(I)){const Q=PB(I,C.id);await ft("months",C.id,Q,"database cleanup: saving fixed month"),m++}I.is_needs_recalculation!==void 0&&(await zl("months",C.id,{is_needs_recalculation:mw(),updated_at:new Date().toISOString()},`database cleanup: removing is_needs_recalculation from month ${j}/${M}`),g++)}catch(I){t.push(`Month ${C.id}: ${I instanceof Error?I.message:"Unknown error"}`)}let x=0;const E=await Ot("data_mappings","database cleanup: reading all data mappings");for(const C of E.docs)try{const I=C.data;if(I.budget_id!==void 0)continue;const j=C.id,M=j.lastIndexOf("_import_data_map");if(M===-1){t.push(`Data mapping ${j}: Cannot extract budget_id from document ID (unexpected format)`);continue}const Q=j.substring(0,M),{exists:q}=await Qe("budgets",Q,`database cleanup: verifying budget exists for data mapping ${j}`);if(!q){t.push(`Data mapping ${j}: Referenced budget ${Q} does not exist`);continue}await ft("data_mappings",j,{...I,budget_id:Q},`database cleanup: adding budget_id to data mapping ${j}`),x++}catch(I){t.push(`Data mapping ${C.id}: ${I instanceof Error?I.message:"Unknown error"}`)}return{budgetsProcessed:e,accountsFixed:n,categoriesFixed:r,groupsFixed:a,arraysConverted:o,monthMapsUpdated:u,deprecatedFieldsRemoved:h,futureMonthsDeleted:f,monthsFixed:m,oldRecalcFieldsRemoved:g,dataMappingsFixed:x,errors:t}}function zB({currentUser:t,onComplete:e}){const[n,r]=T.useState(!1),[a,o]=T.useState(!1),[u,h]=T.useState(null),[f,m]=T.useState(null);async function g(){if(t){r(!0);try{const x=await NB();h(x)}catch(x){console.error("Failed to scan database:",x)}finally{r(!1)}}}async function _(){if(t){o(!0),m(null);try{const x=await sc(()=>LB());m(x),e?.()}catch(x){m({budgetsProcessed:0,accountsFixed:0,categoriesFixed:0,groupsFixed:0,arraysConverted:0,monthMapsUpdated:0,deprecatedFieldsRemoved:0,futureMonthsDeleted:0,monthsFixed:0,oldRecalcFieldsRemoved:0,dataMappingsFixed:0,errors:[x instanceof Error?x.message:"Unknown error"]})}finally{o(!1)}}}const v=u!==null&&(u.budgetsWithArrays>0||u.accountsNeedingDefaults>0||u.categoriesNeedingDefaults>0||u.groupsNeedingDefaults>0||u.budgetsNeedingMonthMapUpdate>0||u.budgetsWithDeprecatedEarliestMonth>0||u.futureMonthsToDelete.length>0||u.monthsWithSchemaIssues>0||u.monthsWithOldRecalcField>0||u.dataMappingsMissingBudgetId>0),S=u!==null?u.budgetsWithArrays+u.accountsNeedingDefaults+u.categoriesNeedingDefaults+u.groupsNeedingDefaults+u.budgetsNeedingMonthMapUpdate+u.budgetsWithDeprecatedEarliestMonth+u.futureMonthsToDelete.length+u.monthsWithSchemaIssues+u.monthsWithOldRecalcField+u.dataMappingsMissingBudgetId:0;return{status:u,isScanning:n,scanStatus:g,hasIssues:v,totalIssues:S,isRunning:a,result:f,runCleanup:_}}function zg(t){return t.includes("@")?!1:!!(/_[a-z0-9]+_(com|org|net|edu|io|co|uk|gov|mil|biz|info)$/i.test(t)&&(t.match(/_/g)||[]).length>=2||/_[a-z0-9]+\.(com|org|net|edu|io|co|uk|gov|mil|biz|info)$/i.test(t)&&(t.match(/_/g)||[]).length>=1)}function UB(t){let e=t;const n=/^(.+)_(gmail|yahoo|hotmail|outlook|icloud|aol|proton|protonmail)\.(.+)$/i,r=e.match(n);return r?`${r[1]}@${r[2]}.${r[3]}`:(e=e.replace(/_com$/,".com").replace(/_net$/,".net").replace(/_org$/,".org").replace(/_edu$/,".edu").replace(/_io$/,".io"),e=e.replace(/_gmail_/,"@gmail.").replace(/_yahoo_/,"@yahoo.").replace(/_hotmail_/,"@hotmail.").replace(/_outlook_/,"@outlook.").replace(/_icloud_/,"@icloud."),e)}function rf(t){if(t===null||typeof t!="object"||Array.isArray(t))return!1;const e=t;return e._methodName==="arrayUnion"&&Array.isArray(e.vc)}function ET(t){return t.vc||[]}function Sw(t){return Array.isArray(t.items)?t.items:rf(t.items)?ET(t.items):[]}function FB({currentUser:t}){const[e,n]=T.useState(!1),[r,a]=T.useState(!1),[o,u]=T.useState(null),[h,f]=T.useState(null);async function m(){if(!t)return;n(!0);const _={documentsFound:0,sanitizedDocuments:[],corruptedDocuments:[],isHealthy:!0};try{const v=await Ot("feedback","feedback migration: scanning for issues");_.documentsFound=v.docs.length;for(const S of v.docs)zg(S.id)&&_.sanitizedDocuments.push(S.id),rf(S.data.items)&&_.corruptedDocuments.push(S.id);_.isHealthy=_.sanitizedDocuments.length===0&&_.corruptedDocuments.length===0,u(_)}catch(v){console.error("Failed to scan feedback:",v)}finally{n(!1)}}async function g(){if(t){a(!0);try{const _=await sc(async()=>{const v={documentsFound:0,sanitizedDocuments:[],corruptedDocuments:[],mergedItems:0,deletedDocuments:0,fixedDocuments:0,errors:[]},S=await Ot("feedback","feedback migration: listing all documents");v.documentsFound=S.docs.length;for(const x of S.docs){const E=zg(x.id);if(rf(x.data.items)&&!E){v.corruptedDocuments.push(x.id);const I=ET(x.data.items);try{await ft("feedback",x.id,{items:I,user_email:x.data.user_email||x.id,created_at:x.data.created_at||new Date().toISOString(),updated_at:new Date().toISOString()},`feedback migration: fixing corrupted arrayUnion in ${x.id}`),v.fixedDocuments++}catch(j){v.errors.push(`Failed to fix ${x.id}: ${j instanceof Error?j.message:"Unknown error"}`)}}}for(const x of S.docs)if(zg(x.id)){v.sanitizedDocuments.push(x.id);const E=x.id,C=UB(E),I=Sw(x.data),{exists:j,data:M}=await Qe("feedback",C,`feedback migration: checking if ${C} exists`);if(j&&M){const Q=Sw(M),q=new Set(Q.map(D=>D.id)),G=I.filter(D=>!q.has(D.id));if(G.length>0||rf(M.items)){const D=[...Q,...G];await ft("feedback",C,{...M,items:D,updated_at:new Date().toISOString()},`feedback migration: merging ${G.length} items from ${E}`),v.mergedItems+=G.length}}else I.length>0&&(await ft("feedback",C,{items:I,user_email:C,created_at:x.data.created_at||new Date().toISOString(),updated_at:new Date().toISOString()},`feedback migration: creating ${C} from ${E}`),v.mergedItems+=I.length);try{await Ou("feedback",E,`feedback migration: deleting sanitized document ${E}`),v.deletedDocuments++}catch(Q){v.errors.push(`Failed to delete ${E}: ${Q instanceof Error?Q.message:"Unknown error"}`)}}return v});f(_)}catch(_){f({documentsFound:0,sanitizedDocuments:[],corruptedDocuments:[],mergedItems:0,deletedDocuments:0,fixedDocuments:0,errors:[_ instanceof Error?_.message:"Migration failed"]})}finally{a(!1)}}}return{status:o,isScanning:e,scanStatus:m,isMigratingFeedback:r,feedbackMigrationResult:h,migrateFeedbackDocuments:g}}async function VB(t){const{exists:e,data:n}=await Qe("budgets",t,`[delete all months] reading budget ${t} for reset`);if(!e||!n)return;const r={...n.accounts};for(const o of Object.keys(r))r[o]&&typeof r[o]=="object"&&(r[o]={...r[o],balance:0});const a={...n.categories};for(const o of Object.keys(a))a[o]&&typeof a[o]=="object"&&(a[o]={...a[o],balance:0});await ft("budgets",t,{...n,accounts:r,categories:a,month_map:{},total_available:0,is_needs_recalculation:!1,updated_at:new Date().toISOString()},`[delete all months] resetting budget ${t} balances to zero`)}function $B({currentUser:t,onComplete:e}){const[n,r]=T.useState(!1),[a,o]=T.useState(!1),[u,h]=T.useState(null),[f,m]=T.useState(null),[g,_]=T.useState(null);async function v(){if(t){r(!0);try{const x=await Ot("months","delete all months: scanning for all months"),E=[],C=new Set;for(const I of x.docs){const{budget_id:j,year:M,month:Q}=I.data;C.add(j),E.push({docId:I.id,budgetId:j,year:M,month:Q})}E.sort((I,j)=>I.budgetId!==j.budgetId?I.budgetId.localeCompare(j.budgetId):I.year!==j.year?I.year-j.year:I.month-j.month),h({monthsToDelete:E,monthsCount:E.length,budgetCount:C.size})}catch{}finally{r(!1)}}}async function S(){if(!t||!u||u.monthsToDelete.length===0)return;o(!0),m(null);const x=u.monthsToDelete.length,E=new Set,C=[];for(const q of u.monthsToDelete)E.add(q.budgetId);_({phase:"deleting",deleted:0,total:x,currentMonth:null,budgetsRecalculated:0,totalBudgets:u.budgetCount,percentComplete:0});const I=u.monthsToDelete.map(q=>({collectionPath:"months",docId:q.docId}));let j=0;try{await nT(I,"delete all months: batch deleting all month documents",q=>{j=q,_({phase:"deleting",deleted:q,total:x,currentMonth:`Batch ${Math.ceil(q/500)} of ${Math.ceil(x/500)}`,budgetsRecalculated:0,totalBudgets:u.budgetCount,percentComplete:Math.round(q/x*70)})}),j=x}catch(q){C.push(`Batch delete failed: ${q instanceof Error?q.message:"Unknown error"}`)}const M=Array.from(E);let Q=0;for(const q of M){_({phase:"resetting-budgets",deleted:j,total:x,currentMonth:`Budget ${Q+1}/${M.length}`,budgetsRecalculated:Q,totalBudgets:M.length,percentComplete:70+Math.round(Q/M.length*25)});try{await VB(q),Q++}catch{Q++}}_({phase:"clearing-cache",deleted:j,total:x,currentMonth:null,budgetsRecalculated:Q,totalBudgets:M.length,percentComplete:95}),vo(),_({phase:"complete",deleted:j,total:x,currentMonth:null,budgetsRecalculated:Q,totalBudgets:M.length,percentComplete:100}),m({deleted:j,errors:C,budgetsRecalculated:Q}),o(!1),_(null),C.length===0&&(h({monthsToDelete:[],monthsCount:0,budgetCount:0}),e?.())}return{status:u,isScanning:n,scanStatus:v,isDeleting:a,deleteResult:f,deleteProgress:g,deleteAllMonths:S}}const Ug="sample@sample.com",ro="budget_1767746876726_xuj7nzl4l";function qB({currentUser:t,onComplete:e}){const[n,r]=T.useState(!1),[a,o]=T.useState(!1),[u,h]=T.useState(null),[f,m]=T.useState(null),[g,_]=T.useState(null);async function v(){if(t){r(!0);try{let E=(await Ot("budgets","delete sample user budget: scanning for sample user budgets",[{field:"owner_email",op:"==",value:Ug}])).docs;if(E.length===0){console.log("delete sample user budget: no budgets found by owner_email, checking fallback budget ID");const q=await Qe("budgets",ro,"delete sample user budget: checking fallback budget ID");q.exists&&q.data&&(console.log("delete sample user budget: found fallback budget",ro),E=[{id:ro,data:q.data}])}const C=[];let I=0,j=!1;for(const q of E){const G=q.id,D=q.data.name,N=(await Ot("months",`delete sample user budget: counting months for budget ${G}`,[{field:"budget_id",op:"==",value:G}])).docs.length;I+=N,C.push({budgetId:G,budgetName:D,monthCount:N}),(await Ot("payees",`delete sample user budget: checking payees for budget ${G}`,[{field:"budget_id",op:"==",value:G}])).docs.length>0&&(j=!0)}const M=[],Q=await Ot("users","delete sample user budget: finding sample user document",[{field:"email",op:"==",value:Ug}]);Q.docs.length>0&&Q.docs[0].data.budget_ids?.includes(ro)&&(C.some(A=>A.budgetId===ro)||(console.log("delete sample user budget: found stale budget reference in sample user document",ro),M.push(ro))),h({budgets:C,totalBudgets:C.length,totalMonths:I,hasPayees:j,staleBudgetIds:M})}catch(x){console.error("Error scanning for sample user budgets:",x)}finally{r(!1)}}}async function S(){if(!t||!u||u.budgets.length===0&&u.staleBudgetIds.length===0)return;o(!0),m(null);const x=[];let E=0,C=0,I=0;const j=u.totalMonths,M=u.totalBudgets;_({phase:"deleting-months",monthsDeleted:0,totalMonths:j,budgetsDeleted:0,totalBudgets:M,percentComplete:0});for(const q of u.budgets)try{const D=(await Ot("months",`delete sample user budget: fetching month IDs for budget ${q.budgetId}`)).docs.filter(A=>A.data.budget_id===q.budgetId).map(A=>({collectionPath:"months",docId:A.id}));D.length>0&&(await nT(D,`delete sample user budget: deleting ${D.length} months for budget ${q.budgetId}`,A=>{E=A,_({phase:"deleting-months",monthsDeleted:E,totalMonths:j,budgetsDeleted:C,totalBudgets:M,percentComplete:Math.round(E/Math.max(j,1)*60)})}),E=D.length)}catch(G){x.push(`Failed to delete months for budget ${q.budgetId}: ${G instanceof Error?G.message:"Unknown error"}`)}_({phase:"deleting-payees",monthsDeleted:E,totalMonths:j,budgetsDeleted:C,totalBudgets:M,percentComplete:60});for(const q of u.budgets)try{await Ou("payees",q.budgetId,`delete sample user budget: deleting payees for budget ${q.budgetId}`),I++}catch{}_({phase:"deleting-budgets",monthsDeleted:E,totalMonths:j,budgetsDeleted:C,totalBudgets:M,percentComplete:70});for(const q of u.budgets)try{await Ou("budgets",q.budgetId,`delete sample user budget: deleting budget ${q.budgetId}`),C++,_({phase:"deleting-budgets",monthsDeleted:E,totalMonths:j,budgetsDeleted:C,totalBudgets:M,percentComplete:70+Math.round(C/M*10)})}catch(G){x.push(`Failed to delete budget ${q.budgetId}: ${G instanceof Error?G.message:"Unknown error"}`)}_({phase:"updating-user",monthsDeleted:E,totalMonths:j,budgetsDeleted:C,totalBudgets:M,percentComplete:80});const Q=[...u.budgets.map(q=>q.budgetId),...u.staleBudgetIds];try{const q=await Ot("users","delete sample user budget: finding sample user document to remove budget references",[{field:"email",op:"==",value:Ug}]);if(q.docs.length>0){const G=q.docs[0],D=G.id,A=G.data,N=(A.budget_ids||[]).filter(L=>!Q.includes(L));await ft("users",D,{...A,budget_ids:N,updated_at:new Date().toISOString()},"delete sample user budget: removing deleted budget IDs from sample user document"),console.log(`delete sample user budget: removed ${Q.length} budget IDs from sample user document`)}else console.log("delete sample user budget: no sample user document found, skipping user update")}catch(q){x.push(`Failed to update sample user document: ${q instanceof Error?q.message:"Unknown error"}`)}_({phase:"clearing-cache",monthsDeleted:E,totalMonths:j,budgetsDeleted:C,totalBudgets:M,percentComplete:95}),vo(),_({phase:"complete",monthsDeleted:E,totalMonths:j,budgetsDeleted:C,totalBudgets:M,percentComplete:100}),m({budgetsDeleted:C,monthsDeleted:E,payeesDeleted:I,errors:x}),o(!1),_(null),x.length===0&&(h({budgets:[],totalBudgets:0,totalMonths:0,hasPayees:!1,staleBudgetIds:[]}),e?.())}return{status:u,isScanning:n,scanStatus:v,isDeleting:a,deleteResult:f,deleteProgress:g,deleteSampleUserBudget:S}}function ww(t){if(!t)return 0;let e=0;for(const n of t)ut(n.start_balance??0)&&e++,ut(n.end_balance??0)&&e++,ut(n.allocated??0)&&e++,ut(n.spent??0)&&e++,ut(n.income??0)&&e++,ut(n.expenses??0)&&e++,ut(n.net_change??0)&&e++;return e}function Ew(t){if(!t)return 0;let e=0;for(const n of t)ut(n.amount??0)&&e++;return e}async function Cw(){const t=await Ot("budgets","precision cleanup: scanning all budgets");let e=0,n=0,r=0,a=0;for(const _ of t.docs){const v=_.data;let S=!1;ut(v.total_available??0)&&(a++,S=!0);const x=v.accounts;if(x&&typeof x=="object")for(const C of Object.values(x))ut(C.balance??0)&&(n++,S=!0);const E=v.categories;if(E&&typeof E=="object")for(const C of Object.values(E))ut(C.balance??0)&&(r++,S=!0),ut(C.default_monthly_amount??0)&&(r++,S=!0);S&&e++}const o=await Ot("months","precision cleanup: scanning all months");let u=0,h=0,f=0,m=0,g=0;for(const _ of o.docs){const v=_.data;let S=!1;(ut(v.total_income??0)||ut(v.total_expenses??0)||ut(v.previous_month_income??0))&&(S=!0);const x=Ew(v.income);x>0&&(h+=x,S=!0);const E=Ew(v.expenses);E>0&&(f+=E,S=!0);const C=ww(v.category_balances);C>0&&(m+=C,S=!0);const I=ww(v.account_balances);I>0&&(g+=I,S=!0),S&&u++}return{totalBudgets:t.docs.length,budgetsWithPrecisionIssues:e,accountsWithPrecisionIssues:n,categoriesWithPrecisionIssues:r,totalAvailableWithPrecisionIssues:a,totalMonths:o.docs.length,monthsWithPrecisionIssues:u,incomeValuesWithPrecisionIssues:h,expenseValuesWithPrecisionIssues:f,categoryBalancesWithPrecisionIssues:m,accountBalancesWithPrecisionIssues:g}}function Tw(t){const e={...t};return e.start_balance!==void 0&&(e.start_balance=we(e.start_balance)),e.end_balance!==void 0&&(e.end_balance=we(e.end_balance)),e.allocated!==void 0&&(e.allocated=we(e.allocated)),e.spent!==void 0&&(e.spent=we(e.spent)),e.income!==void 0&&(e.income=we(e.income)),e.expenses!==void 0&&(e.expenses=we(e.expenses)),e.net_change!==void 0&&(e.net_change=we(e.net_change)),e}function HB(t,e){let n=!1;ut(t.total_available??0)&&(t.total_available=we(t.total_available??0),e.totalAvailableFixed++,n=!0);const r=t.accounts;if(r&&typeof r=="object")for(const[o,u]of Object.entries(r)){const h=u;ut(h.balance??0)&&(r[o].balance=we(h.balance??0),e.accountsFixed++,n=!0)}const a=t.categories;if(a&&typeof a=="object")for(const[o,u]of Object.entries(a)){const h=u;ut(h.balance??0)&&(a[o].balance=we(h.balance??0),e.categoriesFixed++,n=!0),ut(h.default_monthly_amount??0)&&(a[o].default_monthly_amount=we(h.default_monthly_amount??0),e.categoriesFixed++,n=!0)}return{fixed:n,data:t}}function GB(t,e){let n=!1;if(ut(t.total_income??0)&&(t.total_income=we(t.total_income??0),n=!0),ut(t.total_expenses??0)&&(t.total_expenses=we(t.total_expenses??0),n=!0),ut(t.previous_month_income??0)&&(t.previous_month_income=we(t.previous_month_income??0),n=!0),t.income&&Array.isArray(t.income)){const r=[];for(const a of t.income)ut(a.amount??0)?(r.push({...a,amount:we(a.amount??0)}),e.incomeValuesFixed++,n=!0):r.push(a);t.income=r}if(t.expenses&&Array.isArray(t.expenses)){const r=[];for(const a of t.expenses)ut(a.amount??0)?(r.push({...a,amount:we(a.amount??0)}),e.expenseValuesFixed++,n=!0):r.push(a);t.expenses=r}if(t.category_balances&&Array.isArray(t.category_balances)){const r=[];for(const a of t.category_balances)ut(a.start_balance??0)||ut(a.end_balance??0)||ut(a.allocated??0)||ut(a.spent??0)?(r.push(Tw(a)),e.categoryBalancesFixed++,n=!0):r.push(a);t.category_balances=r}if(t.account_balances&&Array.isArray(t.account_balances)){const r=[];for(const a of t.account_balances)ut(a.start_balance??0)||ut(a.end_balance??0)||ut(a.income??0)||ut(a.expenses??0)||ut(a.net_change??0)?(r.push(Tw(a)),e.accountBalancesFixed++,n=!0):r.push(a);t.account_balances=r}return{fixed:n,data:t}}function QB(t,e,n){const r={...t.data},{fixed:a,data:o}=HB(r,n),u=a?{budgetId:t.id,data:o}:null;a&&n.budgetsProcessed++;const h=[];let f=!1;for(const m of e){const g={...m.data},{fixed:_,data:v}=GB(g,n);_&&(n.monthsProcessed++,f=!0),h.push(v)}return{budgetUpdate:u,fixedMonths:h,hasMonthFixes:f}}async function WB(){const t={budgetsProcessed:0,accountsFixed:0,categoriesFixed:0,totalAvailableFixed:0,monthsProcessed:0,incomeValuesFixed:0,expenseValuesFixed:0,categoryBalancesFixed:0,accountBalancesFixed:0,errors:[]},{budgets:e,monthsByBudget:n}=await xr("precision cleanup"),r=[],a=[];for(const o of e)try{const u=n.get(o.id)||[],{budgetUpdate:h,fixedMonths:f,hasMonthFixes:m}=QB(o,u,t);h&&r.push(h),(m||f.length>0)&&a.push({budgetId:o.id,months:f})}catch(u){t.errors.push(`Budget ${o.id}: ${u instanceof Error?u.message:String(u)}`)}if(r.length>0)try{await pT(r,"precision cleanup")}catch(o){t.errors.push(`Budget batch write: ${o instanceof Error?o.message:String(o)}`)}for(const{budgetId:o,months:u}of a)try{await gT(o,u,"precision cleanup")}catch(h){t.errors.push(`Budget ${o} recalc: ${h instanceof Error?h.message:String(h)}`)}return t}function KB({currentUser:t,onComplete:e}){const[n,r]=T.useState(null),[a,o]=T.useState(!1),[u,h]=T.useState(!1),[f,m]=T.useState(null),[g,_]=T.useState(null),v=n?n.accountsWithPrecisionIssues+n.categoriesWithPrecisionIssues+n.totalAvailableWithPrecisionIssues+n.incomeValuesWithPrecisionIssues+n.expenseValuesWithPrecisionIssues+n.categoryBalancesWithPrecisionIssues+n.accountBalancesWithPrecisionIssues:0,S=v>0,x=T.useCallback(async()=>{if(t){o(!0),_(null);try{const C=await Cw();r(C),m(null)}catch(C){_(C instanceof Error?C.message:"Failed to scan for precision issues")}finally{o(!1)}}},[t]),E=T.useCallback(async()=>{if(!(!t||!S)){h(!0),_(null);try{const C=await sc(()=>WB());m(C);const I=await Cw();r(I),e?.()}catch(C){_(C instanceof Error?C.message:"Failed to run precision cleanup")}finally{h(!1)}}},[t,S,e]);return T.useEffect(()=>{t&&!n&&!a&&x()},[t,n,a,x]),{status:n,isScanning:a,isRunning:u,result:f,error:g,totalIssues:v,hasIssues:S,hasData:n!==null,scan:x,runCleanup:E}}const YB=["unknown","Unknown","UNKNOWN","","null","undefined","N/A","n/a"],XB=["unknown","Unknown","UNKNOWN","","null","undefined","N/A","n/a"];function pm(t){return!t||Be(t)?!0:YB.includes(t)}function gm(t){return!t||et(t)?!0:XB.includes(t)}function CT(t){return pm(t.account_id)||gm(t.category_id)}function JB(t){return{id:t.id.replace("expense_","adjustment_"),amount:t.amount,account_id:pm(t.account_id)?Bt:t.account_id,category_id:gm(t.category_id)?Ut:t.category_id,date:t.date,description:t.description||t.payee,cleared:t.cleared,created_at:t.created_at}}function ZB(t){const e=t.data,n=e.expenses||[],r=e.adjustments||[],a=[],o=[];let u=0,h=0;for(const m of n)CT(m)?(pm(m.account_id)&&!Be(m.account_id)&&u++,gm(m.category_id)&&!et(m.category_id)&&h++,o.push(JB(m))):a.push(m);return o.length===0?{needsUpdate:!1,updatedMonth:null,stats:{expensesMigrated:0,invalidAccountsFixed:0,invalidCategoriesFixed:0}}:{needsUpdate:!0,updatedMonth:Gn({...e,expenses:a,adjustments:[...r,...o],transfers:e.transfers||[],updated_at:new Date().toISOString()}),stats:{expensesMigrated:o.length,invalidAccountsFixed:u,invalidCategoriesFixed:h}}}async function eL(){const{budgets:t,monthsByBudget:e}=await xr("expense-to-adjustment-scan");let n=0,r=0,a=0,o=0;for(const u of t){const h=e.get(u.id)||[];n+=h.length;for(const f of h){const g=f.data.expenses||[];for(const _ of g)CT(_)&&(r++,pm(_.account_id)&&!Be(_.account_id)&&a++,gm(_.category_id)&&!et(_.category_id)&&o++)}}return{totalBudgets:t.length,totalMonths:n,expensesToMigrate:r,invalidAccountsToFix:a,invalidCategoriesToFix:o}}async function tL(){const{budgets:t,monthsByBudget:e}=await xr("expense-to-adjustment-migration"),n=[];let r=0,a=0,o=0;const u=[];for(const h of t){const f=e.get(h.id)||[];for(const m of f)try{const{needsUpdate:g,updatedMonth:_,stats:v}=ZB(m);g&&_&&(n.push({budgetId:h.id,year:m.year,month:m.month,data:_}),r+=v.expensesMigrated,a+=v.invalidAccountsFixed,o+=v.invalidCategoriesFixed)}catch(g){u.push(`Month ${m.year}/${m.month} in budget ${h.id}: ${g instanceof Error?g.message:String(g)}`)}}return n.length>0&&await rd(n,"expense-to-adjustment-migration"),{budgetsProcessed:t.length,monthsProcessed:n.length,expensesMigrated:r,invalidAccountsFixed:a,invalidCategoriesFixed:o,errors:u}}function nL({currentUser:t,onComplete:e}){const[n,r]=T.useState(!1),[a,o]=T.useState(!1),[u,h]=T.useState(null),[f,m]=T.useState(null);async function g(){if(t){r(!0);try{const S=await eL();h(S)}catch(S){console.error("Failed to scan for expense to adjustment migration:",S)}finally{r(!1)}}}async function _(){if(t){o(!0),m(null);try{const S=await sc(()=>tL());m(S),e?.()}catch(S){m({budgetsProcessed:0,monthsProcessed:0,expensesMigrated:0,invalidAccountsFixed:0,invalidCategoriesFixed:0,errors:[S instanceof Error?S.message:"Unknown error"]})}finally{o(!1)}}}const v=u!==null&&u.expensesToMigrate>0;return{status:u,isScanning:n,scanStatus:g,hasItemsToMigrate:v,isRunning:a,result:f,runMigration:_}}function TT(t){const e=new Set,n=new Set,r=t.categories;if(r)for(const o of Object.keys(r))e.add(o);const a=t.accounts;if(a)for(const o of Object.keys(a))n.add(o);return{categoryIds:e,accountIds:n}}function ia(t,e){return!t||et(t)?!1:!e.has(t)}function Rs(t,e){return!t||Be(t)?!1:!e.has(t)}function rL(t,e){const n=t.data;let r=0,a=0,o=0,u=0,h=0,f=0,m=!1;const g=(n.expenses||[]).map(E=>{const C={...E};let I=!1;return ia(E.category_id,e.categoryIds)&&(C.category_id=Ut,r++,I=!0),Rs(E.account_id,e.accountIds)&&(C.account_id=Bt,a++,I=!0),I&&(o++,m=!0),C}),_=(n.income||[]).map(E=>{const C={...E};let I=!1;return Rs(E.account_id,e.accountIds)&&(C.account_id=Bt,a++,I=!0),I&&(u++,m=!0),C}),v=(n.transfers||[]).map(E=>{const C={...E};let I=!1;return ia(E.from_category_id,e.categoryIds)&&(C.from_category_id=Ut,r++,I=!0),ia(E.to_category_id,e.categoryIds)&&(C.to_category_id=Ut,r++,I=!0),Rs(E.from_account_id,e.accountIds)&&(C.from_account_id=Bt,a++,I=!0),Rs(E.to_account_id,e.accountIds)&&(C.to_account_id=Bt,a++,I=!0),I&&(h++,m=!0),C}),S=(n.adjustments||[]).map(E=>{const C={...E};let I=!1;return ia(E.category_id,e.categoryIds)&&(C.category_id=Ut,r++,I=!0),Rs(E.account_id,e.accountIds)&&(C.account_id=Bt,a++,I=!0),I&&(f++,m=!0),C});return m?{needsUpdate:!0,updatedMonth:{...n,expenses:g,income:_,transfers:v,adjustments:S,updated_at:new Date().toISOString()},stats:{categoryIdsFixed:r,accountIdsFixed:a,affectedExpenses:o,affectedIncome:u,affectedTransfers:h,affectedAdjustments:f}}:{needsUpdate:!1,updatedMonth:null,stats:{categoryIdsFixed:0,accountIdsFixed:0,affectedExpenses:0,affectedIncome:0,affectedTransfers:0,affectedAdjustments:0}}}async function sL(){const{budgets:t,monthsByBudget:e}=await xr("orphaned-id-scan");let n=0,r=0,a=0,o=0,u=0,h=0,f=0;for(const m of t){const g=TT(m.data),_=e.get(m.id)||[];n+=_.length;for(const v of _){const S=v.data;for(const x of S.expenses||[]){let E=!1;ia(x.category_id,g.categoryIds)&&(r++,E=!0),Rs(x.account_id,g.accountIds)&&(a++,E=!0),E&&o++}for(const x of S.income||[])Rs(x.account_id,g.accountIds)&&(a++,u++);for(const x of S.transfers||[]){let E=!1;ia(x.from_category_id,g.categoryIds)&&(r++,E=!0),ia(x.to_category_id,g.categoryIds)&&(r++,E=!0),Rs(x.from_account_id,g.accountIds)&&(a++,E=!0),Rs(x.to_account_id,g.accountIds)&&(a++,E=!0),E&&h++}for(const x of S.adjustments||[]){let E=!1;ia(x.category_id,g.categoryIds)&&(r++,E=!0),Rs(x.account_id,g.accountIds)&&(a++,E=!0),E&&f++}}}return{totalBudgets:t.length,totalMonths:n,orphanedCategoryIds:r,orphanedAccountIds:a,affectedExpenses:o,affectedIncome:u,affectedTransfers:h,affectedAdjustments:f}}async function iL(){const{budgets:t,monthsByBudget:e}=await xr("orphaned-id-cleanup"),n=[];let r=0,a=0;const o=[];for(const u of t){const h=TT(u.data),f=e.get(u.id)||[];for(const m of f)try{const{needsUpdate:g,updatedMonth:_,stats:v}=rL(m,h);g&&_&&(n.push({budgetId:u.id,year:m.year,month:m.month,data:_}),r+=v.categoryIdsFixed,a+=v.accountIdsFixed)}catch(g){o.push(`Month ${m.year}/${m.month} in budget ${u.id}: ${g instanceof Error?g.message:String(g)}`)}}return n.length>0&&await rd(n,"orphaned-id-cleanup"),{budgetsProcessed:t.length,monthsProcessed:n.length,categoryIdsFixed:r,accountIdsFixed:a,errors:o}}function aL({currentUser:t,onComplete:e}){const[n,r]=T.useState(!1),[a,o]=T.useState(!1),[u,h]=T.useState(null),[f,m]=T.useState(null);async function g(){if(t){r(!0);try{const S=await sL();h(S)}catch(S){console.error("Failed to scan for orphaned IDs:",S)}finally{r(!1)}}}async function _(){if(t){o(!0),m(null);try{const S=await sc(()=>iL());m(S),e?.()}catch(S){m({budgetsProcessed:0,monthsProcessed:0,categoryIdsFixed:0,accountIdsFixed:0,errors:[S instanceof Error?S.message:"Unknown error"]})}finally{o(!1)}}}const v=u!==null&&(u.orphanedCategoryIds>0||u.orphanedAccountIds>0);return{status:u,isScanning:n,scanStatus:g,hasItemsToFix:v,isRunning:a,result:f,runMigration:_}}function oL(t,e){if(t.date!==e.date||Math.abs(t.amount+e.amount)>.001)return null;const n=t.amount<0?t:e,r=t.amount<0?e:t,a=et(t.category_id)&&et(e.category_id),o=!Be(t.account_id)&&!Be(e.account_id),u=t.account_id!==e.account_id;if(a&&o&&u)return{negative:n,positive:r,type:"account"};const h=Be(t.account_id)&&Be(e.account_id),f=!et(t.category_id)&&!et(e.category_id),m=t.category_id!==e.category_id;return h&&f&&m?{negative:n,positive:r,type:"category"}:null}function AT(t){const e=[],n=new Set;for(let r=0;r<t.length;r++)if(!n.has(t[r].id))for(let a=r+1;a<t.length;a++){if(n.has(t[a].id))continue;const o=oL(t[r],t[a]);if(o){e.push(o),n.add(t[r].id),n.add(t[a].id);break}}return e}function lL(t){const{negative:e,positive:n,type:r}=t;return r==="account"?{id:`transfer_from_adj_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,amount:Math.abs(e.amount),from_account_id:e.account_id,to_account_id:n.account_id,from_category_id:Ut,to_category_id:Ut,date:e.date,description:e.description||n.description||"Transfer",cleared:e.cleared&&n.cleared,created_at:new Date().toISOString()}:{id:`transfer_from_adj_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,amount:Math.abs(e.amount),from_account_id:Bt,to_account_id:Bt,from_category_id:e.category_id,to_category_id:n.category_id,date:e.date,description:e.description||n.description||"Transfer",cleared:e.cleared&&n.cleared,created_at:new Date().toISOString()}}function cL(t){const e=t.data,n=e.adjustments||[],r=e.transfers||[],a=AT(n);if(a.length===0)return{needsUpdate:!1,updatedMonth:null,stats:{pairsConverted:0,adjustmentsRemoved:0}};const o=a.map(lL),u=new Set;for(const m of a)u.add(m.negative.id),u.add(m.positive.id);const h=n.filter(m=>!u.has(m.id));return{needsUpdate:!0,updatedMonth:{...e,adjustments:h,transfers:[...r,...o],updated_at:new Date().toISOString()},stats:{pairsConverted:a.length,adjustmentsRemoved:u.size}}}async function uL(){const{budgets:t,monthsByBudget:e}=await xr("adjustments-to-transfers-scan");let n=0,r=0,a=0,o=0;for(const u of t){const h=e.get(u.id)||[];n+=h.length;for(const f of h){const g=f.data.adjustments||[],_=AT(g);r+=_.length;for(const v of _)v.type==="account"?a++:o++}}return{totalBudgets:t.length,totalMonths:n,pairsFound:r,accountTransferPairs:a,categoryTransferPairs:o}}async function dL(){const{budgets:t,monthsByBudget:e}=await xr("adjustments-to-transfers-migration"),n=[];let r=0,a=0;const o=[];for(const u of t){const h=e.get(u.id)||[];for(const f of h)try{const{needsUpdate:m,updatedMonth:g,stats:_}=cL(f);m&&g&&(n.push({budgetId:u.id,year:f.year,month:f.month,data:g}),r+=_.pairsConverted,a+=_.adjustmentsRemoved)}catch(m){o.push(`Month ${f.year}/${f.month} in budget ${u.id}: ${m instanceof Error?m.message:String(m)}`)}}return n.length>0&&await rd(n,"adjustments-to-transfers-migration"),{budgetsProcessed:t.length,monthsProcessed:n.length,transfersCreated:r,adjustmentsRemoved:a,errors:o}}function hL({currentUser:t,onComplete:e}){const[n,r]=T.useState(!1),[a,o]=T.useState(!1),[u,h]=T.useState(null),[f,m]=T.useState(null);async function g(){if(t){r(!0);try{const S=await uL();h(S)}catch(S){console.error("Failed to scan for adjustment pairs:",S)}finally{r(!1)}}}async function _(){if(t){o(!0),m(null);try{const S=await sc(()=>dL());m(S),e?.()}catch(S){m({budgetsProcessed:0,monthsProcessed:0,transfersCreated:0,adjustmentsRemoved:0,errors:[S instanceof Error?S.message:"Unknown error"]})}finally{o(!1)}}}const v=u!==null&&u.pairsFound>0;return{status:u,isScanning:n,scanStatus:g,hasPairsToConvert:v,isRunning:a,result:f,runMigration:_}}function jT(t){const e=[];let n="",r=!1;for(let a=0;a<t.length;a++){const o=t[a];o==='"'?r=!r:o===","&&!r?(e.push(n.trim()),n=""):n+=o}return e.push(n.trim()),e}function RT(t){if(!t)return 0;let e=t.replace(/[$\s]/g,"");const n=e.startsWith("(")||e.startsWith("-");e=e.replace(/[()]/g,"").replace("-",""),e=e.replace(/,/g,"");const r=parseFloat(e);return isNaN(r)?0:n?-r:r}function DT(t){if(!t)return null;const e=t.split("/");if(e.length!==3)return null;const n=parseInt(e[0],10),r=parseInt(e[1],10),a=parseInt(e[2],10);return isNaN(n)||isNaN(r)||isNaN(a)||n<1||n>12||r<1||r>31?null:{year:a,month:n,day:r}}function fL(t){const e=t.toLowerCase().trim();return e==="income"?"income":e==="spend"?"spend":e==="allocation"||e==="allocations"?"allocation":null}function IT(t){if(!t)return!1;const e=t.toLowerCase().trim();return e==="true"||e==="1"||e==="yes"}function mL(t){const e=t.split(`
`).filter(r=>r.trim()),n=[];for(const r of e){const a=jT(r);if(a.length<6)continue;const[o,u,h,f,m,g,_,v]=a;if(o.toLowerCase()==="type")continue;const S=fL(o);if(!S)continue;const x=DT(u);if(!x)continue;const E=RT(g),C=IT(v||"");n.push({recordType:S,date:u,year:x.year,month:x.month,day:x.day,payee:h,category:f,account:m,amount:E,description:_||"",cleared:C,rawLine:r})}return n}function MT(t,e,n){const r=e.toString().padStart(2,"0"),a=n.toString().padStart(2,"0");return`${t}-${r}-${a}`}function pL(t,e){return e.toLowerCase()==="income"?"income":t.toLowerCase()==="budget allocation"?"allocation":"spend"}function kT(t){const e=t.split(`
`).filter(r=>r.trim()),n=[];for(const r of e){const a=jT(r);if(a.length<5)continue;const[o,u,h,f,m,g,_]=a;if(o.toLowerCase()==="cash flow"||o.toLowerCase()==="date")continue;const v=DT(o);if(!v)continue;const S=pL(u,h),x=RT(m),E=IT(_||"");n.push({recordType:S,date:o,year:v.year,month:v.month,day:v.day,payee:u,category:h,account:f,amount:x,description:g||"",cleared:E,rawLine:r})}return n}function gL(t){return!t.account_id||t.account_id.trim()===""?"Missing account_id (empty or undefined)":null}function yL(t){const e=[];return(!t.account_id||t.account_id.trim()==="")&&e.push("missing account_id"),(!t.category_id||t.category_id.trim()==="")&&e.push("missing category_id"),e.length>0?e.join(", "):null}function _L(t){const e=Be(t.account_id)||!t.account_id||t.account_id.trim()==="",n=et(t.category_id)||!t.category_id||t.category_id.trim()==="";return e&&n?"Both account_id and category_id are missing/NO_* (must have at least one real ID)":null}function bL(t){const e=[];if((!t.from_account_id||t.from_account_id.trim()==="")&&e.push("missing from_account_id"),(!t.to_account_id||t.to_account_id.trim()==="")&&e.push("missing to_account_id"),(!t.from_category_id||t.from_category_id.trim()==="")&&e.push("missing from_category_id"),(!t.to_category_id||t.to_category_id.trim()==="")&&e.push("missing to_category_id"),e.length>0)return e.join(", ");const n=t.from_account_id===t.to_account_id,r=t.from_category_id===t.to_category_id;if(n&&r)return"Transfer has same from/to on both account and category (nothing would transfer)";const a=Be(t.from_account_id),o=Be(t.to_account_id),u=et(t.from_category_id),h=et(t.to_category_id);return a&&o&&u&&h?"All from/to account and category IDs are NO_* (must involve at least one real entity)":a&&o&&r?"Both accounts are NO_ACCOUNT and categories are the same (nothing transfers)":u&&h&&n?"Both categories are NO_CATEGORY and accounts are the same (nothing transfers)":null}function $h(t,e,n,r,a){return t.filter(o=>{const[u,h,f]=e.split("-").map(Number);return o.year!==u||o.month!==h||o.day!==f||Math.abs(Math.abs(o.amount)-Math.abs(n))>.01?!1:(r&&o.payee&&o.payee.toLowerCase()===r.toLowerCase()||a&&o.description&&o.description.toLowerCase().includes(a.toLowerCase()),!0)})}async function vL(t){const e=[];let n=0,r=0,a=0,o=0;const u=t?kT(t):[],{budgets:h,monthsByBudget:f}=await xr("account-category-validation");for(const m of h){const g=f.get(m.id)||[];for(const _ of g){const v=_.data,S=`${v.year}-${String(v.month).padStart(2,"0")}`,x=v.income||[];n+=x.length;for(const j of x){const M=gL(j);M&&e.push({budgetId:m.id,monthKey:S,transactionType:"income",transactionId:j.id,violation:M,transactionDetails:{date:j.date,amount:j.amount,payee:j.payee,description:j.description,accountId:j.account_id},potentialSeedMatches:$h(u,j.date,j.amount,j.payee,j.description)})}const E=v.expenses||[];r+=E.length;for(const j of E){const M=yL(j);M&&e.push({budgetId:m.id,monthKey:S,transactionType:"expense",transactionId:j.id,violation:M,transactionDetails:{date:j.date,amount:j.amount,payee:j.payee,description:j.description,accountId:j.account_id,categoryId:j.category_id},potentialSeedMatches:$h(u,j.date,j.amount,j.payee,j.description)})}const C=v.adjustments||[];a+=C.length;for(const j of C){const M=_L(j);M&&e.push({budgetId:m.id,monthKey:S,transactionType:"adjustment",transactionId:j.id,violation:M,transactionDetails:{date:j.date,amount:j.amount,description:j.description,accountId:j.account_id,categoryId:j.category_id},potentialSeedMatches:$h(u,j.date,j.amount,void 0,j.description)})}const I=v.transfers||[];o+=I.length;for(const j of I){const M=bL(j);M&&e.push({budgetId:m.id,monthKey:S,transactionType:"transfer",transactionId:j.id,violation:M,transactionDetails:{date:j.date,amount:j.amount,description:j.description,fromAccountId:j.from_account_id,toAccountId:j.to_account_id,fromCategoryId:j.from_category_id,toCategoryId:j.to_category_id},potentialSeedMatches:$h(u,j.date,j.amount,void 0,j.description)})}}}return e.sort((m,g)=>{const _=m.monthKey.localeCompare(g.monthKey);return _!==0?_:m.transactionType.localeCompare(g.transactionType)}),{totalBudgets:h.length,totalMonths:Array.from(f.values()).reduce((m,g)=>m+g.length,0),totalIncome:n,totalExpenses:r,totalAdjustments:a,totalTransfers:o,violations:e,scannedAt:new Date().toISOString()}}function xL(t){const e=[];if(e.push("=".repeat(80),"ACCOUNT/CATEGORY VALIDATION REPORT",`Scanned at: ${t.scannedAt}`,"=".repeat(80),"","SUMMARY:"),e.push(`  Budgets scanned: ${t.totalBudgets}`,`  Months scanned: ${t.totalMonths}`,`  Income transactions: ${t.totalIncome}`,`  Expense transactions: ${t.totalExpenses}`,`  Adjustment transactions: ${t.totalAdjustments}`,`  Transfer transactions: ${t.totalTransfers}`,`  VIOLATIONS FOUND: ${t.violations.length}`,""),t.violations.length===0)return e.push(" No violations found!"),e.join(`
`);const n=new Map;for(const r of t.violations)n.has(r.transactionType)||n.set(r.transactionType,[]),n.get(r.transactionType).push(r);e.push("-".repeat(80),"VIOLATIONS BY TYPE:","-".repeat(80));for(const[r,a]of n){e.push("",`## ${r.toUpperCase()} (${a.length} violations)`,"");for(const o of a){if(e.push(`  [${o.monthKey}] ID: ${o.transactionId}`,`    Violation: ${o.violation}`,`    Date: ${o.transactionDetails.date}`,`    Amount: ${o.transactionDetails.amount}`),o.transactionDetails.payee&&e.push(`    Payee: ${o.transactionDetails.payee}`),o.transactionDetails.description&&e.push(`    Description: ${o.transactionDetails.description}`),o.transactionDetails.accountId!==void 0&&e.push(`    Account ID: ${o.transactionDetails.accountId||"(empty)"}`),o.transactionDetails.categoryId!==void 0&&e.push(`    Category ID: ${o.transactionDetails.categoryId||"(empty)"}`),o.transactionDetails.fromAccountId!==void 0&&e.push(`    From Account: ${o.transactionDetails.fromAccountId||"(empty)"}`,`    To Account: ${o.transactionDetails.toAccountId||"(empty)"}`,`    From Category: ${o.transactionDetails.fromCategoryId||"(empty)"}`,`    To Category: ${o.transactionDetails.toCategoryId||"(empty)"}`),o.potentialSeedMatches.length>0){e.push(`    POTENTIAL SEED MATCHES (${o.potentialSeedMatches.length}):`);for(const u of o.potentialSeedMatches.slice(0,5))e.push(`      - Line: ${u.rawLine}`,`        Type: ${u.recordType}, Date: ${u.date}, Payee: ${u.payee}`,`        Category: ${u.category}, Account: ${u.account}`);o.potentialSeedMatches.length>5&&e.push(`      ... and ${o.potentialSeedMatches.length-5} more matches`)}else e.push("    No seed matches found");e.push("")}}return e.join(`
`)}function SL({currentUser:t}){const[e,n]=T.useState(!1),[r,a]=T.useState(null),[o,u]=T.useState(null);async function h(f){if(t){n(!0),a(null),u(null);try{const m=await vL(f);a(m),u(xL(m))}catch(m){console.error("Failed to scan transactions:",m),u(`Error scanning: ${m instanceof Error?m.message:"Unknown error"}`)}finally{n(!1)}}}return{isScanning:e,status:r,report:o,scan:h,hasViolations:r!==null&&r.violations.length>0,violationCount:r?.violations.length??0}}const wL=[{id:"adjustment_import_1767473622525_qzkq34i7r",amount:14877.86,date:"2020-08-23",description:"Starting Balance on app switchover",targetAccount:"Alerus 401K Eide Bailly",targetCategory:null},{id:"adjustment_import_1767473622530_nj6pnwlb2",amount:-2e3,date:"2022-03-01",description:"Transfer",targetAccount:null,targetCategory:"House"}];async function EL(){const{budgets:t,monthsByBudget:e}=await xr("hidden-field-migration-scan");let n=0,r=0,a=0,o=0;const u=[];for(const h of t){const f=h.data,m=f.accounts;if(m&&typeof m=="object")for(const v of Object.values(m))v.is_hidden===void 0&&n++;const g=f.categories;if(g&&typeof g=="object")for(const v of Object.values(g))v.is_hidden===void 0&&r++;const _=e.get(h.id)||[];o+=_.length;for(const v of _){const S=v.data,x=`${S.year}-${String(S.month).padStart(2,"0")}`;for(const E of S.adjustments||[]){const C=Be(E.account_id)||!E.account_id,I=et(E.category_id)||!E.category_id;C&&I&&(a++,u.push({monthKey:x,id:E.id,description:E.description||"",amount:E.amount,accountId:E.account_id,categoryId:E.category_id}))}}}return{totalBudgets:t.length,totalMonths:o,accountsNeedingField:n,categoriesNeedingField:r,adjustmentsToFix:a,adjustmentDetails:u}}async function CL(t){const e={budgetsProcessed:0,accountsUpdated:0,categoriesUpdated:0,hiddenAccountsCreated:0,hiddenCategoriesCreated:0,adjustmentsFixed:0,errors:[]};t.setStage("Reading all budgets and months..."),t.setProgress(null);const{budgets:n,monthsByBudget:r}=await xr("hidden-field-migration");t.setDetails(`Found ${n.length} budget(s) to process`);const a=[],o=[];t.setStage("Processing budgets...");for(let u=0;u<n.length;u++){const h=n[u];t.updateItemProgress(u+1,n.length,`Budget: ${h.data.name||h.id}`);try{const f={...h.data};let m=!1;const g={...f.accounts||{}},_={...f.categories||{}};for(const[I,j]of Object.entries(g))j.is_hidden===void 0&&(g[I]={...j,is_hidden:!1},e.accountsUpdated++,m=!0);for(const[I,j]of Object.entries(_))j.is_hidden===void 0&&(_[I]={...j,is_hidden:!1},e.categoriesUpdated++,m=!0);let v=null;const S="Alerus 401K Eide Bailly";for(const[I,j]of Object.entries(g))if(j.nickname?.toLowerCase()===S.toLowerCase()){v=I;break}if(v)g[v].is_hidden||(g[v]={...g[v],is_hidden:!0},m=!0);else{v=`account_hidden_${Date.now()}_alerus`;const I=Math.max(0,...Object.values(g).map(j=>j.sort_order||0));g[v]={nickname:S,description:"Historical 401K account (hidden)",balance:0,account_group_id:null,sort_order:I+1,is_income_account:!1,is_income_default:!1,is_outgo_account:!1,is_outgo_default:!1,on_budget:!1,is_active:!0,is_hidden:!0},e.hiddenAccountsCreated++,m=!0}let x=null;const E="House";for(const[I,j]of Object.entries(_))if(j.name?.toLowerCase()===E.toLowerCase()){x=I;break}if(x)_[x].is_hidden||(_[x]={..._[x],is_hidden:!0},m=!0);else{x=`category_hidden_${Date.now()}_house`;const I=Math.max(0,...Object.values(_).map(j=>j.sort_order||0));_[x]={name:E,description:"Historical house-related transactions (hidden)",category_group_id:null,sort_order:I+1,default_monthly_amount:0,default_monthly_type:"fixed",balance:0,is_hidden:!0},e.hiddenCategoriesCreated++,m=!0}const C=r.get(h.id)||[];for(const I of C){const j=I.data;let M=!1;const Q=(j.adjustments||[]).map(q=>{const G=Be(q.account_id)||!q.account_id,D=et(q.category_id)||!q.category_id;if(G&&D){const A=wL.find(N=>N.id===q.id||Math.abs(N.amount-q.amount)<.01&&N.date===q.date&&N.description.toLowerCase()===(q.description||"").toLowerCase());if(A){const N={...q};return A.targetAccount&&(N.account_id=v),A.targetCategory&&(N.category_id=x),e.adjustmentsFixed++,M=!0,N}}return q});M&&o.push({budgetId:h.id,year:j.year,month:j.month,data:{...j,adjustments:Q}})}m&&(a.push({budgetId:h.id,data:{...f,accounts:g,categories:_,updated_at:new Date().toISOString()}}),e.budgetsProcessed++)}catch(f){e.errors.push(`Budget ${h.id}: ${f instanceof Error?f.message:String(f)}`)}}return a.length>0&&(t.setStage("Writing budget updates..."),t.setProgress(null),t.setCurrentItem(`${a.length} budget(s) to update`),await pT(a,"hidden-field-migration")),o.length>0&&(t.setStage("Writing month updates and recalculating..."),t.setCurrentItem(`${o.length} month(s) to update`),await yT(o,"hidden-field-migration")),t.setStage("Migration complete"),t.setProgress(100),e}function TL({currentUser:t}){const[e,n]=T.useState(!1),[r,a]=T.useState(!1),[o,u]=T.useState(null),[h,f]=T.useState(null),{runMigrationWithProgress:m}=I0();async function g(){if(t){n(!0);try{const x=await EL();u(x)}catch(x){console.error("Failed to scan hidden field status:",x)}finally{n(!1)}}}async function _(){if(t){a(!0),f(null);try{const x=await m("Hidden Field Migration",E=>CL(E));f(x)}catch(x){f({budgetsProcessed:0,accountsUpdated:0,categoriesUpdated:0,hiddenAccountsCreated:0,hiddenCategoriesCreated:0,adjustmentsFixed:0,errors:[x instanceof Error?x.message:"Unknown error"]})}finally{a(!1)}}}const v=o!==null&&(o.accountsNeedingField>0||o.categoriesNeedingField>0||o.adjustmentsToFix>0),S=o!==null?o.accountsNeedingField+o.categoriesNeedingField+o.adjustmentsToFix:0;return{isScanning:e,isRunning:r,status:o,result:h,scanStatus:g,runMigration:_,needsMigration:v,totalItemsToFix:S}}function sf(t){return t==="no_category"||t==="NO_CATEGORY"}function AL(t,e){const n={};for(const r of t)r.from_category_id&&!sf(r.from_category_id)&&(n[r.from_category_id]=(n[r.from_category_id]||0)-r.amount),r.to_category_id&&!sf(r.to_category_id)&&(n[r.to_category_id]=(n[r.to_category_id]||0)+r.amount);for(const r of e)r.category_id&&!sf(r.category_id)&&(n[r.category_id]=(n[r.category_id]||0)+r.amount);return n}function jL(t,e,n){const r=Object.keys(e).filter(v=>!sf(v)),a=Object.keys(n),o={},u={};r.forEach(v=>{o[v]=0}),a.forEach(v=>{u[v]=0});const h={};r.forEach(v=>{h[v]=[]});const f=[],m=[];for(const v of t){const S=v.data,x=`${v.year}-${String(v.month).padStart(2,"0")}`,E=S.income||[],C=S.expenses||[],I=S.transfers||[],j=S.adjustments||[],M=S.category_balances||[],Q=S.account_balances||[],q=S.are_allocations_finalized===!0,G={};for(const O of M)G[O.category_id]=O;const D=AL(I,j);for(const O of r){const K=we(o[O]||0);let Y=0;q&&G[O]&&(Y=we(G[O].allocated||0));const z=we(C.filter(ie=>ie.category_id===O).reduce((ie,U)=>ie+U.amount,0)),V=we(D[O]||0),W=we(K+Y+z+V),ee=we(G[O]?.end_balance??0);h[O].push({month:x,startBalance:K,allocated:Y,spent:z,adjustment:V,calculatedEnd:W,storedEnd:ee,endDiscrepancy:we(W-ee)}),o[O]=ee}for(const O of a){const K=we(E.filter(ee=>ee.account_id===O).reduce((ee,ie)=>ee+ie.amount,0)),Y=we(C.filter(ee=>ee.account_id===O).reduce((ee,ie)=>ee+ie.amount,0)),z=we(I.filter(ee=>ee.to_account_id===O).reduce((ee,ie)=>ee+ie.amount,0)),V=we(I.filter(ee=>ee.from_account_id===O).reduce((ee,ie)=>ee+ie.amount,0)),W=we(j.filter(ee=>ee.account_id===O).reduce((ee,ie)=>ee+ie.amount,0));u[O]+=K+Y+z-V+W}const A=we(E.reduce((O,K)=>O+K.amount,0)),N=we(C.reduce((O,K)=>O+K.amount,0)),L=we(M.reduce((O,K)=>O+(K.allocated||0),0)),P=we(I.reduce((O,K)=>O+K.amount,0)),B=we(j.reduce((O,K)=>O+K.amount,0));f.push({year:v.year,month:v.month,monthKey:x,totalIncome:A,totalExpenses:N,totalAllocated:L,totalTransfers:P,totalAdjustments:B,allocationsFinalized:q,expenseCount:C.length,incomeCount:E.length,transferCount:I.length,adjustmentCount:j.length}),m.push({year:v.year,month:v.month,income:E,expenses:C,transfers:I,adjustments:j,categoryBalances:M,accountBalances:Q,areAllocationsFinalized:q})}const g=r.map(v=>{const S=we(e[v]?.balance??0),x=we(o[v]);return{categoryId:v,categoryName:e[v]?.name||"Unknown",storedAllTimeBalance:S,calculatedAllTimeBalance:x,discrepancy:we(x-S),monthBreakdown:h[v]}}),_=a.map(v=>{const S=we(n[v]?.balance??0),x=we(u[v]);return{accountId:v,accountName:n[v]?.name||"Unknown",storedBalance:S,calculatedBalance:x,discrepancy:we(x-S)}});return{categoryBalances:g,accountBalances:_,monthSummaries:f,rawMonthData:m}}function RL({currentUser:t}){const[e,n]=T.useState(!1),[r,a]=T.useState(null),[o,u]=T.useState(null);async function h(){if(!t){u("Must be logged in to download diagnostics");return}n(!0),u(null),a({phase:"reading",current:0,total:1,percentComplete:0});try{a({phase:"reading",current:0,total:1,percentComplete:10});const{budgets:f,monthsByBudget:m}=await xr("diagnostic-download");a({phase:"analyzing",current:0,total:f.length,percentComplete:30});const g=[];let _=0,v=0,S=0,x=0;for(let M=0;M<f.length;M++){const Q=f[M],q=m.get(Q.id)||[];_+=q.length;const G=Q.data,D=G.categories||{},A=G.accounts||{};v+=Object.keys(D).length,S+=Object.keys(A).length;const{categoryBalances:N,accountBalances:L,monthSummaries:P,rawMonthData:B}=jL(q,D,A),O=N.filter(V=>Math.abs(V.discrepancy)>.01).length,K=L.filter(V=>Math.abs(V.discrepancy)>.01).length,Y=we(N.reduce((V,W)=>V+W.discrepancy,0)),z=we(L.reduce((V,W)=>V+W.discrepancy,0));(O>0||K>0)&&x++,g.push({budgetId:Q.id,budgetName:G.name||"Unknown Budget",totalAvailable:G.total_available??0,categoryBalances:N,accountBalances:L,monthSummaries:P,rawMonthData:B,discrepancySummary:{totalCategoryDiscrepancy:Y,totalAccountDiscrepancy:z,categoriesWithDiscrepancies:O,accountsWithDiscrepancies:K}}),a({phase:"analyzing",current:M+1,total:f.length,percentComplete:30+Math.round((M+1)/f.length*60)})}const E={timestamp:new Date().toISOString(),budgets:g,globalSummary:{totalBudgets:f.length,totalMonths:_,totalCategories:v,totalAccounts:S,budgetsWithDiscrepancies:x}};a({phase:"complete",current:1,total:1,percentComplete:100});const C=new Blob([JSON.stringify(E,null,2)],{type:"application/json"}),I=URL.createObjectURL(C),j=document.createElement("a");j.href=I,j.download=`budget-diagnostic-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(j),j.click(),document.body.removeChild(j),URL.revokeObjectURL(I)}catch(f){u(f instanceof Error?f.message:"Unknown error during download")}finally{n(!1),a(null)}}return{isDownloading:e,progress:r,error:o,downloadDiagnostics:h}}async function DL(t){const e=JSON.parse(t),{budgets:n,monthsByBudget:r}=await xr("restore-diagnostic-scan"),a={diagnosticTimestamp:e.timestamp,budgetsInFile:e.budgets.length,monthsToRestore:0,transfersToRestore:0,adjustmentsToRestore:0,monthDetails:[]};for(const o of e.budgets){if(!n.find(f=>f.id===o.budgetId))continue;const h=r.get(o.budgetId)||[];for(const f of o.rawMonthData){const m=f.transfers||[],g=f.adjustments||[];if(m.length===0&&g.length===0)continue;const v=h.find(I=>I.year===f.year&&I.month===f.month)?.data,S=(v?.transfers||[]).length,x=(v?.adjustments||[]).length,E=m.length>S,C=g.length>x;(E||C)&&(a.monthsToRestore++,a.transfersToRestore+=Math.max(0,m.length-S),a.adjustmentsToRestore+=Math.max(0,g.length-x),a.monthDetails.push({budgetId:o.budgetId,year:f.year,month:f.month,currentTransfers:S,diagnosticTransfers:m.length,currentAdjustments:x,diagnosticAdjustments:g.length}))}}return a}async function IL(t,e){const n={success:!1,monthsUpdated:0,transfersRestored:0,adjustmentsRestored:0,errors:[]};try{e.setStage("Parsing diagnostic file..."),e.setProgress(null);const r=JSON.parse(t);e.setDetails(`Loaded diagnostic from ${r.timestamp}`),e.setStage("Reading current database state...");const{budgets:a,monthsByBudget:o}=await xr("restore-diagnostic-run");e.setDetails(`Found ${a.length} budget(s)`);const u=[];e.setStage("Preparing updates...");for(const h of r.budgets){if(!a.find(g=>g.id===h.budgetId)){n.errors.push(`Budget ${h.budgetId} not found in database`);continue}const m=o.get(h.budgetId)||[];for(const g of h.rawMonthData){const _=g.transfers||[],v=g.adjustments||[];if(_.length===0&&v.length===0)continue;const S=m.find(M=>M.year===g.year&&M.month===g.month);if(!S)continue;const x=S.data,E=x.transfers||[],C=x.adjustments||[],I=_.length>E.length,j=v.length>C.length;if(I||j){const M={budget_id:h.budgetId,year_month_ordinal:x.year_month_ordinal,year:g.year,month:g.month,income:x.income||[],total_income:x.total_income??0,previous_month_income:x.previous_month_income??0,expenses:x.expenses||[],total_expenses:x.total_expenses??0,transfers:I?_:E,adjustments:j?v:C,account_balances:x.account_balances||[],category_balances:x.category_balances||[],are_allocations_finalized:x.are_allocations_finalized??!1,created_at:x.created_at,updated_at:new Date().toISOString()};u.push({budgetId:h.budgetId,year:g.year,month:g.month,data:M}),I&&(n.transfersRestored+=_.length-E.length),j&&(n.adjustmentsRestored+=v.length-C.length)}}}if(u.length===0)return e.setStage("No updates needed"),e.setDetails("Database already matches diagnostic file"),n.success=!0,n;e.setStage("Writing updates and recalculating..."),e.setDetails(`Updating ${u.length} month(s)`),await yT(u,"restore-from-diagnostic"),n.monthsUpdated=u.length,n.success=!0,e.setStage("Complete!"),e.setDetails(`Restored ${n.transfersRestored} transfers and ${n.adjustmentsRestored} adjustments`)}catch(r){n.errors.push(r instanceof Error?r.message:String(r))}return n}function ML(){const[t,e]=T.useState(null),[n,r]=T.useState(null),[a,o]=T.useState(!1),[u,h]=T.useState(!1),[f,m]=T.useState(null),{runMigrationWithProgress:g}=I0();return{status:t,result:n,isScanning:a,isRunning:u,scan:async S=>{o(!0),r(null),m(S);try{const x=await DL(S);e(x)}catch(x){throw e(null),x}finally{o(!1)}},run:async()=>{if(f){h(!0);try{const S=await g("Restore from Diagnostic",x=>IL(f,x));r(S)}catch(S){r({success:!1,monthsUpdated:0,transfersRestored:0,adjustmentsRestored:0,errors:[S instanceof Error?S.message:"Unknown error"]})}finally{h(!1)}}}}}const Mf=["n/a","na","none","-",""];function OT(t,e,n){const r=t.toLowerCase();for(const[a,o]of Object.entries(e))if((n?o.nickname:o.name).toLowerCase()===r)return a;return null}function NT(t,e,n){if(Mf.includes(t.toLowerCase().trim()))return Ut;const r=n.get(t);return r?r.newId:OT(t,e,!1)}function PT(t,e,n){if(Mf.includes(t.toLowerCase().trim()))return Bt;const r=n.get(t);return r?r.newId:OT(t,e,!0)}function kL(t,e,n,r){const a=[];let o=0,u=0;const h=e.income.length,f=[];for(const g of t){const _=PT(g.account,n,r);if(!_){a.push(`Unknown account "${g.account}" for income on ${g.date}`),u++;continue}const v={id:`income_import_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,amount:g.amount,account_id:_,date:MT(g.year,g.month,g.day),payee:g.payee,description:g.description,cleared:g.cleared,created_at:new Date().toISOString()};f.push(v),o++}return{monthData:Gn({...e,income:f,updated_at:new Date().toISOString()}),imported:o,skipped:u,errors:a,cleared:h}}function OL(t,e,n,r,a,o){const u=[];let h=0,f=0;const m=e.expenses.length,g=[];for(const v of t){const S=NT(v.category,n,a);if(!S){u.push(`Unknown category "${v.category}" for expense on ${v.date}`),f++;continue}const x=PT(v.account,r,o);if(!x){u.push(`Unknown account "${v.account}" for expense on ${v.date}`),f++;continue}const E={id:`expense_import_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,amount:v.amount,category_id:S,account_id:x,date:MT(v.year,v.month,v.day),payee:v.payee,description:v.description,cleared:v.cleared,created_at:new Date().toISOString()};g.push(E),h++}return{monthData:Gn({...e,expenses:g,updated_at:new Date().toISOString()}),imported:h,skipped:f,errors:u,cleared:m}}function NL(t,e,n,r){const a=[];let o=0,u=0;const h=e.category_balances.filter(g=>g.allocated>0).length,f=new Map;for(const g of t){const _=NT(g.category,n,r);if(!_){a.push(`Unknown category "${g.category}" for allocation on ${g.date}`),u++;continue}const v=f.get(_)||0;f.set(_,v+g.amount),o++}const m=e.category_balances.map(g=>{const _=f.get(g.category_id);return _!==void 0?{...g,allocated:_,end_balance:g.start_balance+_-g.spent}:{...g,allocated:0,end_balance:g.start_balance-g.spent}});for(const[g,_]of f)m.find(v=>v.category_id===g)||m.push({category_id:g,start_balance:0,allocated:_,spent:0,end_balance:_});return{monthData:{...e,category_balances:m,are_allocations_finalized:!0,updated_at:new Date().toISOString()},imported:o,skipped:u,errors:a,cleared:h}}function PL(t,e,n,r,a){const o=new Set(Object.values(e).map(m=>m.name.toLowerCase())),u=new Set(Object.values(n).map(m=>m.nickname.toLowerCase())),h=new Set,f=new Set;for(const m of t){if(m.recordType==="spend"||m.recordType==="allocation"){const g=m.category.toLowerCase().trim(),_=o.has(g),v=r.has(m.category),S=Mf.includes(g);!_&&!v&&!S&&m.category&&h.add(m.category)}if(m.recordType==="spend"||m.recordType==="income"){const g=m.account.toLowerCase().trim(),_=u.has(g),v=a.has(m.account),S=Mf.includes(g);!_&&!v&&!S&&m.account&&f.add(m.account)}}return{unmappedCategories:Array.from(h).sort(),unmappedAccounts:Array.from(f).sort()}}const Aw=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function BL(t,e,n){const r=Object.entries(t).reduce((o,[,u])=>{const h=u.account_group_id?n[u.account_group_id]:void 0,f=h?.on_budget!==void 0?h.on_budget:u.on_budget!==!1,m=h?.is_active!==void 0?h.is_active:u.is_active!==!1;return f&&m?o+(u.balance??0):o},0),a=Object.values(e).reduce((o,u)=>{const h=u.balance??0;return o+(h>0?h:0)},0);return r-a}async function LL(t,e,n){const{exists:r,data:a}=await Qe("budgets",t,"[seed import] reading budget for final update");if(!r||!a)throw new Error(`Budget ${t} not found`);const o={...a.accounts};for(const[_,v]of Object.entries(e.accountEndBalances))o[_]&&(o[_]={...o[_],balance:v});const u={...a.categories};for(const[_,v]of Object.entries(e.categoryEndBalances))u[_]&&(u[_]={...u[_],balance:v});const f={...a.month_map||{}};for(const{info:_}of n)f[_.ordinal]={needs_recalculation:!1};const m=BL(o,u,a.account_groups||{});await ft("budgets",t,{...a,accounts:o,categories:u,total_available:m,is_needs_recalculation:!1,month_map:f,updated_at:new Date().toISOString()},"[seed import] saving final balances");const g=Ve.getQueryData(xe.budget(t));if(g){const _={};for(const[S,x]of Object.entries(g.accounts)){const E=o[S];_[S]=E?{...x,balance:E.balance??x.balance}:x}const v={};for(const[S,x]of Object.entries(g.categories)){const E=u[S];v[S]=E?{...x,balance:E.balance??x.balance}:x}Ve.setQueryData(xe.budget(t),{...g,accounts:_,categories:v,isNeedsRecalculation:!1,monthMap:f,budget:{...g.budget,accounts:o,categories:u,total_available:m,is_needs_recalculation:!1,month_map:f}})}}async function zL(t,e,n,r,a,o,u){const h=[];let f=0,m=0,g=0,_=0,v=0,S=0;const x=[],E=new Map;for(const L of e){const P=`${L.year}-${L.month}`;E.has(P)||E.set(P,[]),E.get(P).push(L)}for(const[L,P]of E){const[B,O]=L.split("-"),K=parseInt(B,10),Y=parseInt(O,10);x.push({key:L,year:K,month:Y,ordinal:At(K,Y),name:`${Aw[Y-1]} ${K}`,rows:P})}if(x.sort((L,P)=>L.ordinal.localeCompare(P.ordinal)),x.length>0){const L=new Set(x.map(Y=>Y.ordinal)),P=x[0],B=x[x.length-1];let O=P.year,K=P.month;for(;O<B.year||O===B.year&&K<=B.month;){const Y=At(O,K);L.has(Y)||x.push({key:`${O}-${K}`,year:O,month:K,ordinal:Y,name:`${Aw[K-1]} ${O}`,rows:[]}),K++,K>12&&(K=1,O++)}x.sort((Y,z)=>Y.ordinal.localeCompare(z.ordinal))}const C=x.filter(L=>L.rows.length===0).length,I=x.length;u({phase:"reading-months",currentMonth:null,monthsProcessed:0,totalMonths:I,recordsImported:0,totalRecords:e.length,monthsCreated:0,monthsToCreate:0,gapMonths:C,percentComplete:5,incomeImported:0,spendImported:0,allocationsImported:0});const j=await Promise.all(x.map(async L=>{try{const P=await Un(t,L.year,L.month,"seed import combined");return{info:L,data:P,needsCreation:!1}}catch{return{info:L,data:null,needsCreation:!0}}})),M=new Map(j.map(L=>[L.info.ordinal,L])),Q=x.map(L=>M.get(L.ordinal)),q=Q.filter(L=>L.needsCreation).length;if(q>0){u({phase:"creating-months",currentMonth:null,monthsProcessed:0,totalMonths:I,recordsImported:0,totalRecords:e.length,monthsCreated:0,monthsToCreate:q,gapMonths:C,percentComplete:15,incomeImported:0,spendImported:0,allocationsImported:0});for(const L of Q)if(L.needsCreation)try{L.data=await sT(t,L.info.year,L.info.month,{bypassDateLimit:!0}),g++,u({phase:"creating-months",currentMonth:L.info.name,monthsProcessed:0,totalMonths:I,recordsImported:0,totalRecords:e.length,monthsCreated:g,monthsToCreate:q,gapMonths:C,percentComplete:15+Math.round(g/q*10),incomeImported:0,spendImported:0,allocationsImported:0})}catch(P){L.error=`Failed to create month ${L.info.month}/${L.info.year}: ${P instanceof Error?P.message:"Unknown error"}`,h.push(L.error),m+=L.info.rows.length}}u({phase:"processing-months",currentMonth:null,monthsProcessed:0,totalMonths:I,recordsImported:0,totalRecords:e.length,monthsCreated:g,monthsToCreate:q,gapMonths:C,percentComplete:30,incomeImported:0,spendImported:0,allocationsImported:0});const G=[];let D=0,A=j0;for(const L of Q){if(!L.data||L.error){D++;continue}let P=L.data;const B=L.info.rows,O=B.filter(z=>z.recordType==="income"),K=B.filter(z=>z.recordType==="spend"),Y=B.filter(z=>z.recordType==="allocation");if(O.length>0){const z=kL(O,P,r,o);P=z.monthData,f+=z.imported,_+=z.imported,m+=z.skipped,h.push(...z.errors)}if(K.length>0){const z=OL(K,P,n,r,a,o);P=z.monthData,f+=z.imported,v+=z.imported,m+=z.skipped,h.push(...z.errors)}if(Y.length>0){const z=NL(Y,P,n,a);P=z.monthData,f+=z.imported,S+=z.imported,m+=z.skipped,h.push(...z.errors)}P=R0(P,A),A=If(P),G.push({info:L.info,data:P}),D++,u({phase:"processing-months",currentMonth:L.info.name,monthsProcessed:D,totalMonths:I,recordsImported:f,totalRecords:e.length,monthsCreated:g,monthsToCreate:q,gapMonths:C,percentComplete:30+Math.round(D/I*30),incomeImported:_,spendImported:v,allocationsImported:S})}u({phase:"saving-months",currentMonth:null,monthsProcessed:G.length,totalMonths:G.length,recordsImported:f,totalRecords:e.length,monthsCreated:g,monthsToCreate:q,gapMonths:C,percentComplete:65,incomeImported:_,spendImported:v,allocationsImported:S});const N=G.map(({info:L,data:P})=>({collectionPath:"months",docId:yr(t,L.year,L.month),data:P}));try{await hm(N,`seed import combined (${G.length} months)`)}catch(L){h.push(`Error batch saving months: ${L instanceof Error?L.message:"Unknown error"}`)}u({phase:"updating-budget",currentMonth:null,monthsProcessed:G.length,totalMonths:G.length,recordsImported:f,totalRecords:e.length,monthsCreated:g,monthsToCreate:q,gapMonths:C,percentComplete:85,incomeImported:_,spendImported:v,allocationsImported:S});try{await LL(t,A,G)}catch(L){h.push(`Error updating budget: ${L instanceof Error?L.message:"Unknown error"}`)}return{success:h.length===0,imported:f,skipped:m,errors:h}}function UL(t){const e=t.split(`
`)[0]?.toLowerCase().trim()||"";return e.startsWith("cash flow")||e.startsWith("date,")?"raw_cash_flow":(e.startsWith("type,")||e.startsWith("income,")||e.startsWith("spend,")||e.startsWith("allocation,"),"combined")}async function FL(t){if(!t)return{categoryMappings:new Map,accountMappings:new Map};try{const{exists:e,data:n}=await Qe("data_mappings",`${t}_import_data_map`,"loading existing import mappings");if(!e||!n)return{categoryMappings:new Map,accountMappings:new Map};const r=new Map,a=new Map;if(n.category_mappings)for(const[o,u]of Object.entries(n.category_mappings))r.set(o,{oldName:o,newId:u.id,newName:u.name});if(n.account_mappings)for(const[o,u]of Object.entries(n.account_mappings))a.set(o,{oldName:o,newId:u.id,newName:u.name});return{categoryMappings:r,accountMappings:a}}catch(e){return console.error("[useSeedImport] Failed to load existing mappings:",e),{categoryMappings:new Map,accountMappings:new Map}}}async function VL(t,e,n){if(!t)return;const r={},a={};for(const[u,h]of e)r[u]={id:h.newId,name:h.newName};for(const[u,h]of n)a[u]={id:h.newId,name:h.newName};const o={budget_id:t,category_mappings:r,account_mappings:a,last_updated:new Date().toISOString()};await ft("data_mappings",`${t}_import_data_map`,o,"saving import mappings")}function $L(t){const[e,n]=T.useState("idle"),[r,a]=T.useState(null),[o,u]=T.useState([]),[h,f]=T.useState([]),[m,g]=T.useState([]),[_,v]=T.useState([]),[S,x]=T.useState(new Map),[E,C]=T.useState(new Map),[I,j]=T.useState(null),[M,Q]=T.useState(null),q=e==="parsing",G=e==="importing",D=o.length>0||h.length>0,A=T.useCallback(async(O,K,Y)=>{n("parsing"),j(null);try{const z=await O.text(),W=UL(z)==="raw_cash_flow"?kT(z):mL(z);if(W.length===0){n("error"),a(null);return}a(W);const ee=new Set,ie=new Set,U=["n/a","na","none","-",""];for(const Me of W){if((Me.recordType==="spend"||Me.recordType==="allocation")&&Me.category){const Oe=Me.category.toLowerCase().trim();U.includes(Oe)||ee.add(Me.category)}if((Me.recordType==="spend"||Me.recordType==="income")&&Me.account){const Oe=Me.account.toLowerCase().trim();U.includes(Oe)||ie.add(Me.account)}}const H=Array.from(ee).sort(),ne=Array.from(ie).sort(),{categoryMappings:se,accountMappings:Z}=await FL(t),le=new Map;for(const[Me,Oe]of Object.entries(K))le.set(Oe.name.toLowerCase(),{id:Me,name:Oe.name});const pe=new Map;for(const[Me,Oe]of Object.entries(Y))pe.set(Oe.nickname.toLowerCase(),{id:Me,name:Oe.nickname});const Ee=[],ge=[];for(const Me of H)if(se.has(Me)){const Oe=le.get(Me.toLowerCase()),ot=se.get(Me);(!Oe||Oe.id!==ot.newId)&&Ee.push(Me)}for(const Me of ne)if(Z.has(Me)){const Oe=pe.get(Me.toLowerCase()),ot=Z.get(Me);(!Oe||Oe.id!==ot.newId)&&ge.push(Me)}g(Ee),v(ge);const J=new Map(se);for(const Me of H)if(!J.has(Me)){const Oe=le.get(Me.toLowerCase());Oe&&J.set(Me,{oldName:Me,newId:Oe.id,newName:Oe.name})}const Se=new Map(Z);for(const Me of ne)if(!Se.has(Me)){const Oe=pe.get(Me.toLowerCase());Oe&&Se.set(Me,{oldName:Me,newId:Oe.id,newName:Oe.name})}x(J),C(Se);const{unmappedCategories:Ae,unmappedAccounts:ct}=PL(W,K,Y,J,Se);u(Ae),f(ct),Ae.length>0||ct.length>0?n("mapping"):n("ready")}catch(z){console.error("[useSeedImport] Parse error:",z),n("error"),a(null)}},[t]),N=T.useCallback((O,K,Y)=>{x(z=>{const V=new Map(z);return V.set(O,{oldName:O,newId:K,newName:Y}),V}),u(z=>{const V=z.filter(W=>W===O?!1:!S.has(W));return V.length===0&&h.length===0&&n("ready"),V})},[S,h.length]),L=T.useCallback((O,K,Y)=>{C(z=>{const V=new Map(z);return V.set(O,{oldName:O,newId:K,newName:Y}),V}),f(z=>{const V=z.filter(W=>W===O?!1:!E.has(W));return V.length===0&&o.length===0&&n("ready"),V})},[E,o.length]),P=T.useCallback(async(O,K)=>{if(!t||!r)return;n("importing"),Q({phase:"saving-mappings",currentMonth:null,monthsProcessed:0,totalMonths:0,recordsImported:0,totalRecords:r.length,monthsCreated:0,monthsToCreate:0,gapMonths:0,percentComplete:0,incomeImported:0,spendImported:0,allocationsImported:0}),await VL(t,S,E);const Y=await zL(t,r,O,K,S,E,z=>Q(z));vo(),Q(z=>z?{...z,phase:"complete",percentComplete:100}:null),j(Y),n(Y.success?"complete":"error")},[t,r,S,E]),B=T.useCallback(()=>{n("idle"),a(null),u([]),f([]),g([]),v([]),j(null),Q(null)},[]);return{status:e,parsedData:r,unmappedCategories:o,unmappedAccounts:h,customMappedCategories:m,customMappedAccounts:_,categoryMappings:S,accountMappings:E,importResult:I,importProgress:M,parseFile:A,setCategoryMapping:N,setAccountMapping:L,runImport:P,reset:B,isParsing:q,isImporting:G,hasUnmappedEntities:D}}function jw({budget:t,isCurrent:e,isAccepting:n,isSwitching:r,isEditing:a,editName:o,isRenaming:u,onAccept:h,onSwitch:f,onStartEdit:m,onCancelEdit:g,onEditNameChange:_,onSaveEdit:v}){const S=e&&t.isOwner;return c.jsx("div",{style:{background:e?"color-mix(in srgb, #646cff 15%, transparent)":"color-mix(in srgb, currentColor 8%, transparent)",border:e?"2px solid color-mix(in srgb, #646cff 50%, transparent)":"1px solid transparent",padding:"1rem",borderRadius:"8px"},children:a?c.jsxs("form",{onSubmit:v,children:[c.jsx("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"0.5rem"},children:c.jsx("input",{type:"text",value:o,onChange:x=>_(x.target.value),placeholder:"Budget name",autoFocus:!0,style:{flex:1,padding:"0.5rem 0.75rem",borderRadius:"6px",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"1rem",fontWeight:600,color:"inherit"}})}),c.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[c.jsx("button",{type:"submit",disabled:u||!o.trim(),style:{background:"#22c55e",color:"white",border:"none",padding:"0.4rem 0.75rem",borderRadius:"6px",cursor:u||!o.trim()?"not-allowed":"pointer",fontWeight:500,opacity:u||!o.trim()?.7:1,fontSize:"0.8rem"},children:u?"Saving...":"Save"}),c.jsx("button",{type:"button",onClick:g,disabled:u,style:{background:"transparent",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)",padding:"0.4rem 0.75rem",borderRadius:"6px",cursor:u?"not-allowed":"pointer",fontWeight:500,opacity:u?.7:.8,fontSize:"0.8rem"},children:"Cancel"})]})]}):c.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem",flexWrap:"wrap"},children:[c.jsxs("div",{style:{flex:1,minWidth:"200px"},children:[c.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flexWrap:"wrap",marginBottom:"0.25rem"},children:[c.jsx("span",{style:{fontWeight:600},children:t.name}),t.isOwner&&c.jsx("span",{style:{background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.65rem",textTransform:"uppercase",fontWeight:600},children:"Owner"}),e&&c.jsx("span",{style:{background:"color-mix(in srgb, #22c55e 20%, transparent)",color:"#4ade80",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.65rem",textTransform:"uppercase",fontWeight:600},children:"Active"}),t.isPending&&c.jsx("span",{style:{background:"color-mix(in srgb, #f59e0b 20%, transparent)",color:"#fbbf24",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.65rem",textTransform:"uppercase",fontWeight:600},children:"Pending"}),S&&c.jsx("button",{onClick:m,style:{background:"transparent",border:"none",padding:"0.15rem",cursor:"pointer",opacity:.5,fontSize:"0.8rem",lineHeight:1},title:"Rename budget",children:""})]}),c.jsx("p",{style:{margin:0,fontSize:"0.8rem",opacity:.6},children:t.ownerEmail?`Owner: ${t.ownerEmail}`:`ID: ${t.id}`})]}),c.jsx("div",{style:{display:"flex",gap:"0.5rem"},children:t.isPending?c.jsx("button",{onClick:h,disabled:n,style:{background:"#22c55e",color:"white",border:"none",padding:"0.5rem 1rem",borderRadius:"6px",cursor:n?"not-allowed":"pointer",fontWeight:500,opacity:n?.7:1,fontSize:"0.85rem"},children:n?"Accepting...":"Accept"}):e?null:c.jsx("button",{onClick:f,disabled:r,style:{background:"#646cff",color:"white",border:"none",padding:"0.5rem 1rem",borderRadius:"6px",cursor:r?"not-allowed":"pointer",fontWeight:500,opacity:r?.7:1,fontSize:"0.85rem"},children:r?"Switching...":"Switch"})})]})})}const ae={primary:"#646cff",error:"#f87171",errorBg:"rgba(220, 38, 38, 0.1)",errorBorder:"rgba(220, 38, 38, 0.3)",success:"#4ade80",danger:"#f87171",warning:"#facc15",debt:"#fb923c",zero:"rgba(255, 255, 255, 0.4)"},es={textDecoration:"underline",textDecorationStyle:"dotted",textUnderlineOffset:"3px"},kf="1px solid color-mix(in srgb, currentColor 20%, transparent)",Of={maxWidth:"var(--page-max-width, 85rem)",margin:"0 auto",padding:"var(--page-padding, 2rem)"},sd={background:"color-mix(in srgb, currentColor 8%, transparent)",padding:"1rem 1.25rem",borderRadius:"8px",display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem"},qL={...sd,padding:"0.6rem 0.875rem",gap:"0.5rem"},HL={background:"color-mix(in srgb, currentColor 8%, transparent)",padding:"1.25rem",borderRadius:"8px",display:"flex",flexDirection:"column",gap:"1rem"},GL={display:"flex",flexDirection:"column",gap:"0.5rem"},QL={fontSize:"0.9rem",fontWeight:500},Ta={padding:"0.6rem 0.8rem",borderRadius:"6px",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"1rem",color:"inherit",width:"100%",boxSizing:"border-box"},WL={...Ta,cursor:"pointer"},M0={padding:"0.6rem 1.25rem",borderRadius:"6px",cursor:"pointer",fontWeight:500,fontSize:"0.9rem",transition:"opacity 0.15s"},BT={...M0,background:ae.primary,color:"white",border:"none"},KL={...BT,padding:"0.75rem 1.5rem",borderRadius:"8px"},YL={...M0,background:"transparent",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)"},XL={...M0,background:"transparent",border:`1px solid ${ae.errorBorder}`,color:ae.error},JL={background:"transparent",border:"1px solid color-mix(in srgb, currentColor 25%, transparent)",padding:"0.35rem 0.75rem",borderRadius:"6px",cursor:"pointer",fontSize:"0.8rem",opacity:.8,transition:"opacity 0.15s"},ZL={display:"flex",gap:"0.5rem"},e6={display:"flex",gap:"0.25rem"},LT={background:"transparent",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",padding:"0.35rem",borderRadius:"6px",cursor:"pointer",fontSize:"0.9rem",lineHeight:1,display:"flex",alignItems:"center",justifyContent:"center",minWidth:"2rem",minHeight:"2rem",transition:"opacity 0.15s, border-color 0.15s"},t6={...LT,borderColor:ae.errorBorder,color:ae.error},Ul={background:"transparent",border:"1px solid color-mix(in srgb, currentColor 15%, transparent)",padding:"0.25rem 0.35rem",borderRadius:"4px",cursor:"pointer",fontSize:"0.75rem",lineHeight:1,display:"flex",alignItems:"center",justifyContent:"center",opacity:.6,transition:"opacity 0.15s, background 0.15s"},k0={display:"flex",flexDirection:"column",gap:"2px"},n6={display:"flex",gap:"0.75rem",marginTop:"0.5rem"},zT={opacity:.4,cursor:"grab"},UT={position:"absolute",top:"-4px",left:0,right:0,height:"3px",background:ae.primary,borderRadius:"2px",transition:"opacity 0.15s"},r6={position:"relative",height:"2rem",marginTop:"-0.25rem"},s6={position:"absolute",top:"50%",left:0,right:0,height:"3px",background:ae.primary,borderRadius:"2px",transition:"opacity 0.15s"},i6={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"0.75rem",opacity:.7,background:"var(--background, #1a1a1a)",padding:"0 0.5rem",whiteSpace:"nowrap"},a6={background:ae.errorBg,border:`1px solid ${ae.errorBorder}`,color:ae.error,padding:"0.75rem 1rem",borderRadius:"8px",marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem"},o6={background:"transparent",border:"none",color:ae.error,cursor:"pointer",fontSize:"1.2rem",padding:"0 0.25rem",lineHeight:1},FT={opacity:.7,marginBottom:"1.5rem"},ym={margin:0,fontSize:"0.85rem",textTransform:"uppercase",letterSpacing:"0.5px",opacity:.6},O0={fontWeight:500,fontSize:"1.1rem"},Fl={display:"flex",flexDirection:"column",gap:"0.5rem",marginBottom:"1.5rem"},Ay={critical_bug:{label:"Critical Bug",color:"#ff4757",bgColor:"rgba(255, 71, 87, 0.15)"},bug:{label:"Bug",color:"#ffa502",bgColor:"rgba(255, 165, 2, 0.15)"},new_feature:{label:"New Feature",color:"#2ed573",bgColor:"rgba(46, 213, 115, 0.15)"},core_feature:{label:"Core Feature",color:"#1e90ff",bgColor:"rgba(30, 144, 255, 0.15)"},qol:{label:"QOL",color:"#a55eea",bgColor:"rgba(165, 94, 234, 0.15)"}};function VT({type:t,onClick:e}){const n=t==="feature"?"new_feature":t,r=n&&n in Ay?n:"bug",a=Ay[r];return c.jsx("button",{type:"button",onClick:e,style:{padding:"0.25rem 0.5rem",borderRadius:"0.25rem",background:a.bgColor,color:a.color,fontSize:"0.7rem",fontWeight:600,textTransform:"uppercase",letterSpacing:"0.025em",flexShrink:0,border:"none",cursor:"pointer",transition:"opacity 0.15s, transform 0.15s"},onMouseEnter:o=>{o.currentTarget.style.opacity="0.8",o.currentTarget.style.transform="scale(1.05)"},onMouseLeave:o=>{o.currentTarget.style.opacity="1",o.currentTarget.style.transform="scale(1)"},title:"Click to change type",children:a.label})}function l6({item:t,isDragging:e,isDragOver:n,onDragStart:r,onDragOver:a,onDragLeave:o,onDragEnd:u,onDrop:h,onToggleDone:f,onTypeClick:m}){return c.jsxs("div",{onDragOver:g=>{g.stopPropagation(),a(g)},onDragLeave:g=>{g.stopPropagation(),o()},onDrop:g=>{g.stopPropagation(),h(g)},style:{position:"relative"},children:[c.jsx("div",{style:{...UT,opacity:n?1:0,boxShadow:n?"0 0 8px rgba(100, 108, 255, 0.6)":"none"}}),c.jsxs("div",{draggable:!0,onDragStart:r,onDragEnd:u,style:{...sd,cursor:"grab",opacity:e?.5:1,flexDirection:"column",alignItems:"stretch",gap:"0.5rem"},children:[c.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[c.jsx("span",{style:{...zT},children:""}),c.jsx("input",{type:"checkbox",checked:t.is_done,onChange:f,style:{width:"1.25rem",height:"1.25rem",cursor:"pointer",accentColor:ae.primary,flexShrink:0}}),c.jsx(VT,{type:t.feedback_type,onClick:m})]}),c.jsxs("div",{style:{marginLeft:"3.25rem"},children:[c.jsx("p",{style:{margin:0,lineHeight:1.5},children:t.text}),c.jsxs("p",{style:{margin:"0.5rem 0 0 0",fontSize:"0.8rem",opacity:.6},children:[t.user_email,"  ",Cy(t.created_at)]})]})]})]})}function c6({item:t,onToggleDone:e,onTypeClick:n}){return c.jsxs("div",{style:{...sd,opacity:.6,flexDirection:"column",alignItems:"stretch",gap:"0.5rem"},children:[c.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[c.jsx("input",{type:"checkbox",checked:t.is_done,onChange:e,style:{width:"1.25rem",height:"1.25rem",cursor:"pointer",accentColor:ae.primary,flexShrink:0}}),c.jsx(VT,{type:t.feedback_type,onClick:n})]}),c.jsxs("div",{style:{marginLeft:"2rem"},children:[c.jsx("p",{style:{margin:0,lineHeight:1.5,textDecoration:"line-through"},children:t.text}),c.jsxs("p",{style:{margin:"0.5rem 0 0 0",fontSize:"0.8rem",opacity:.8},children:[t.user_email,"  Created: ",Cy(t.created_at)]}),t.completed_at&&c.jsxs("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.8rem",color:ae.success},children:[" Completed: ",Cy(t.completed_at)]})]})]})}function xa({noMargin:t}={}){return c.jsx("span",{style:{display:"inline-block",width:"14px",height:"14px",border:"2px solid rgba(255, 255, 255, 0.3)",borderTopColor:"white",borderRadius:"50%",animation:"spin 0.8s linear infinite",marginRight:t?0:"0.5rem",verticalAlign:"middle"}})}function is({title:t,description:e,status:n,statusText:r,onRefresh:a,isRefreshing:o,isBusy:u=!1,children:h,cardName:f}){const g=(()=>{switch(n){case"unknown":return{color:"#9ca3af",text:r??"Unknown"};case"clean":case"complete":return{color:"#22c55e",text:r??" Clean"};case"needs-action":return{color:"#f59e0b",text:r??"Action Needed"}}})(),_=o||u;return c.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"12px",padding:"1.5rem",marginBottom:"1rem"},children:[c.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"0.75rem"},children:[c.jsxs("div",{style:{flex:1},children:[c.jsx("h3",{style:{margin:"0 0 0.5rem 0"},children:t}),c.jsx("p",{style:{margin:0,opacity:.7,fontSize:"0.9rem"},children:e})]}),c.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",flexShrink:0},children:[n!=="unknown"&&c.jsx("span",{style:{color:g.color,fontWeight:600,fontSize:"0.9rem"},children:g.text}),c.jsxs("button",{onClick:()=>{a()},disabled:_,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",padding:"0.35rem 0.65rem",borderRadius:"6px",cursor:_?"not-allowed":"pointer",fontWeight:500,fontSize:"0.85rem",opacity:_?.6:1,display:"flex",alignItems:"center",gap:"0.3rem"},title:"Refresh status",children:[o?c.jsx(xa,{noMargin:!0}):""," Refresh"]})]})]}),h]})}const u6={unknown:{bg:"rgba(100, 100, 100, 0.1)",border:"rgba(100, 100, 100, 0.3)",color:"#9ca3af"},clean:{bg:"rgba(34, 197, 94, 0.1)",border:"rgba(34, 197, 94, 0.3)",color:"#4ade80"},warning:{bg:"rgba(245, 158, 11, 0.1)",border:"rgba(245, 158, 11, 0.3)",color:"#fbbf24"},running:{bg:"rgba(200, 200, 200, 0.1)",border:"rgba(200, 200, 200, 0.3)",color:"rgba(255, 255, 255, 0.7)"},success:{bg:"rgba(34, 197, 94, 0.1)",border:"rgba(34, 197, 94, 0.3)",color:"#4ade80"}};function Le({type:t,children:e}){const n=u6[t];return c.jsx("div",{style:{background:n.bg,border:`1px solid ${n.border}`,color:n.color,padding:"0.75rem 1rem",borderRadius:"8px",display:"flex",alignItems:"center"},children:e})}function sr({onClick:t,disabled:e,isBusy:n,busyText:r,children:a,actionName:o}){const u=e||n;return c.jsx("button",{onClick:()=>{t()},disabled:u,style:{marginTop:"1rem",background:"#646cff",color:"white",border:"none",padding:"0.75rem 1.5rem",borderRadius:"8px",cursor:u?"not-allowed":"pointer",fontWeight:500,opacity:u?.7:1,display:"flex",alignItems:"center",gap:"0.4rem"},children:n?c.jsxs(c.Fragment,{children:[c.jsx(xa,{noMargin:!0})," ",r??"Running..."]}):a})}function d6({hasData:t,status:e,hasIssues:n,totalIssues:r,isRunning:a,result:o,onRunCleanup:u,onRefresh:h,isRefreshing:f,disabled:m}){const g=()=>t?o&&o.errors.length===0&&(o.accountsFixed>0||o.categoriesFixed>0||o.groupsFixed>0||o.monthMapsUpdated>0||o.deprecatedFieldsRemoved>0||o.futureMonthsDeleted>0||o.monthsFixed>0||o.oldRecalcFieldsRemoved>0||o.dataMappingsFixed>0)?"complete":n?"needs-action":"clean":"unknown",_=o?o.accountsFixed+o.categoriesFixed+o.groupsFixed+o.monthMapsUpdated+o.deprecatedFieldsRemoved+o.futureMonthsDeleted+o.monthsFixed+o.oldRecalcFieldsRemoved+o.dataMappingsFixed:0;return c.jsx(is,{title:" Database Cleanup",description:"Validates and fixes all budget, month, and data mapping documents to match the expected schema. Converts legacy formats, adds missing default values, removes invalid future months, and ensures data mappings have required security fields.",status:g(),onRefresh:h,isRefreshing:f,isBusy:a,children:a?c.jsx(Le,{type:"running",children:"Running database cleanup..."}):o?c.jsx(Le,{type:o.errors.length>0?"warning":"success",children:c.jsxs("div",{children:[o.errors.length>0?"":""," Cleanup complete",c.jsxs("ul",{style:{margin:"0.5rem 0 0 0",paddingLeft:"1.5rem",fontSize:"0.9rem"},children:[o.budgetsProcessed>0&&c.jsxs("li",{children:[o.budgetsProcessed," budget",o.budgetsProcessed!==1?"s":""," updated"]}),o.arraysConverted>0&&c.jsxs("li",{children:[o.arraysConverted," array",o.arraysConverted!==1?"s":""," converted to maps"]}),o.accountsFixed>0&&c.jsxs("li",{children:[o.accountsFixed," account",o.accountsFixed!==1?"s":""," fixed"]}),o.categoriesFixed>0&&c.jsxs("li",{children:[o.categoriesFixed," categor",o.categoriesFixed!==1?"ies":"y"," fixed"]}),o.groupsFixed>0&&c.jsxs("li",{children:[o.groupsFixed," group",o.groupsFixed!==1?"s":""," fixed"]}),o.monthMapsUpdated>0&&c.jsxs("li",{children:[o.monthMapsUpdated," budget",o.monthMapsUpdated!==1?"s":""," got month_map updated"]}),o.deprecatedFieldsRemoved>0&&c.jsxs("li",{children:[o.deprecatedFieldsRemoved," budget",o.deprecatedFieldsRemoved!==1?"s":""," had deprecated fields removed"]}),o.futureMonthsDeleted>0&&c.jsxs("li",{children:[o.futureMonthsDeleted," future month",o.futureMonthsDeleted!==1?"s":""," deleted"]}),o.monthsFixed>0&&c.jsxs("li",{children:[o.monthsFixed," month",o.monthsFixed!==1?"s":""," schema fixed"]}),o.oldRecalcFieldsRemoved>0&&c.jsxs("li",{children:[o.oldRecalcFieldsRemoved," month",o.oldRecalcFieldsRemoved!==1?"s":""," had old recalc field removed"]}),o.dataMappingsFixed>0&&c.jsxs("li",{children:[o.dataMappingsFixed," data mapping",o.dataMappingsFixed!==1?"s":""," had budget_id added"]}),_===0&&c.jsx("li",{children:"No changes needed"})]}),o.errors.length>0&&c.jsxs(c.Fragment,{children:[c.jsx("p",{style:{margin:"0.75rem 0 0.25rem 0",fontWeight:500,color:"#ef4444"},children:"Errors:"}),c.jsxs("ul",{style:{margin:0,paddingLeft:"1.5rem",fontSize:"0.85rem",color:"#ef4444"},children:[o.errors.slice(0,5).map((v,S)=>c.jsx("li",{children:v},S)),o.errors.length>5&&c.jsxs("li",{style:{opacity:.7},children:["...and ",o.errors.length-5," more errors"]})]})]})]})}):t?n?c.jsxs(c.Fragment,{children:[c.jsx(Le,{type:"warning",children:c.jsxs("div",{children:[c.jsxs("div",{style:{marginBottom:"0.5rem"},children:[" Found ",r," issue",r!==1?"s":""," to fix:"]}),c.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem",fontSize:"0.9rem"},children:[e.budgetsWithArrays>0&&c.jsxs("li",{children:[e.budgetsWithArrays," budget",e.budgetsWithArrays!==1?"s":""," using legacy array format"]}),e.accountsNeedingDefaults>0&&c.jsxs("li",{children:[e.accountsNeedingDefaults," account",e.accountsNeedingDefaults!==1?"s":""," missing default values"]}),e.categoriesNeedingDefaults>0&&c.jsxs("li",{children:[e.categoriesNeedingDefaults," categor",e.categoriesNeedingDefaults!==1?"ies":"y"," missing default values"]}),e.groupsNeedingDefaults>0&&c.jsxs("li",{children:[e.groupsNeedingDefaults," account group",e.groupsNeedingDefaults!==1?"s":""," missing default values"]}),e.budgetsNeedingMonthMapUpdate>0&&c.jsxs("li",{children:[e.budgetsNeedingMonthMapUpdate," budget",e.budgetsNeedingMonthMapUpdate!==1?"s":""," missing month_map"]}),e.budgetsWithDeprecatedEarliestMonth>0&&c.jsxs("li",{children:[e.budgetsWithDeprecatedEarliestMonth," budget",e.budgetsWithDeprecatedEarliestMonth!==1?"s":""," with deprecated earliest_month field to remove"]}),e.futureMonthsToDelete.length>0&&c.jsxs("li",{children:[e.futureMonthsToDelete.length," future month",e.futureMonthsToDelete.length!==1?"s":""," to delete",c.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1rem",fontSize:"0.85rem",opacity:.8},children:[e.futureMonthsToDelete.slice(0,3).map(v=>c.jsxs("li",{children:[bo[v.month-1]," ",v.year]},v.docId)),e.futureMonthsToDelete.length>3&&c.jsxs("li",{style:{opacity:.7},children:["...and ",e.futureMonthsToDelete.length-3," more"]})]})]}),e.monthsWithSchemaIssues>0&&c.jsxs("li",{children:[e.monthsWithSchemaIssues," month",e.monthsWithSchemaIssues!==1?"s":""," with schema issues"]}),e.monthsWithOldRecalcField>0&&c.jsxs("li",{children:[e.monthsWithOldRecalcField," month",e.monthsWithOldRecalcField!==1?"s":""," with deprecated is_needs_recalculation field"]}),e.dataMappingsMissingBudgetId>0&&c.jsxs("li",{children:[e.dataMappingsMissingBudgetId," data mapping",e.dataMappingsMissingBudgetId!==1?"s":""," missing budget_id (security fix)"]})]}),c.jsxs("p",{style:{margin:"0.75rem 0 0 0",fontSize:"0.85rem",opacity:.7},children:["Scanned ",e.totalBudgets," budgets, ",e.totalMonths," months, and ",e.totalDataMappings," data mappings."]})]})}),c.jsxs(sr,{onClick:u,disabled:m,isBusy:a,busyText:"Running...",actionName:"Run Database Cleanup",children:[" Fix ",r," Issue",r!==1?"s":""]})]}):c.jsx(Le,{type:"clean",children:c.jsxs("div",{children:[" Database is clean",c.jsxs("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.85rem",opacity:.7},children:["All ",e.totalBudgets," budgets, ",e.totalMonths," months, and ",e.totalDataMappings," data mappings match expected schema."]})]})}):c.jsx(Le,{type:"unknown",children:" Status unknown  click Refresh to scan the database"})})}function h6({hasData:t,status:e,isMigrating:n,onMigrate:r,onRefresh:a,isRefreshing:o,disabled:u,migrationResult:h}){const f=e&&(e.sanitizedDocuments.length>0||e.corruptedDocuments.length>0),m=h&&(h.deletedDocuments>0||h.fixedDocuments>0),g=()=>t?m?"complete":f?"needs-action":"clean":"unknown";return c.jsx(is,{title:" Consolidate Feedback Documents",description:"Fixes corrupted feedback data and merges documents with sanitized IDs into proper email format.",status:g(),onRefresh:a,isRefreshing:o,isBusy:n,children:n?c.jsx(Le,{type:"running",children:"Migrating feedback documents..."}):t?m?c.jsx(Le,{type:"success",children:c.jsxs("div",{children:[" Migration complete:",c.jsxs("ul",{style:{margin:"0.5rem 0 0 0",paddingLeft:"1.25rem",fontSize:"0.9rem"},children:[h.fixedDocuments>0&&c.jsxs("li",{children:["Fixed ",h.fixedDocuments," corrupted document(s)"]}),h.deletedDocuments>0&&c.jsxs("li",{children:["Merged & deleted ",h.deletedDocuments," sanitized document(s)"]}),h.mergedItems>0&&c.jsxs("li",{children:["Merged ",h.mergedItems," feedback item(s)"]})]}),h.errors.length>0&&c.jsxs(c.Fragment,{children:[c.jsx("div",{style:{marginTop:"0.5rem"},children:" Errors:"}),c.jsx("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1.25rem",fontSize:"0.9rem"},children:h.errors.map((_,v)=>c.jsx("li",{children:_},v))})]})]})}):f?c.jsxs(c.Fragment,{children:[c.jsx(Le,{type:"warning",children:c.jsxs("div",{children:[e?.corruptedDocuments&&e.corruptedDocuments.length>0&&c.jsxs(c.Fragment,{children:[c.jsxs("div",{style:{marginBottom:"0.5rem"},children:[" Found ",e.corruptedDocuments.length," corrupted document(s):"]}),c.jsx("ul",{style:{margin:"0 0 0.75rem 0",paddingLeft:"1.25rem",fontSize:"0.9rem"},children:e.corruptedDocuments.map(_=>c.jsxs("li",{children:[_," ",c.jsx("span",{style:{opacity:.6},children:"(broken arrayUnion)"})]},_))})]}),e?.sanitizedDocuments&&e.sanitizedDocuments.length>0&&c.jsxs(c.Fragment,{children:[c.jsxs("div",{style:{marginBottom:"0.5rem"},children:[" Found ",e.sanitizedDocuments.length," sanitized document(s) to merge:"]}),c.jsx("ul",{style:{margin:0,paddingLeft:"1.25rem",fontSize:"0.9rem"},children:e.sanitizedDocuments.map(_=>c.jsx("li",{children:_},_))})]})]})}),c.jsx(sr,{onClick:r,disabled:u,isBusy:n,busyText:"Migrating...",actionName:"Run Feedback Migration",children:"Run Migration"})]}):c.jsxs(Le,{type:"clean",children:[" No issues found. All feedback documents are healthy.",c.jsxs("span",{style:{display:"block",fontSize:"0.85rem",opacity:.7,marginTop:"0.25rem"},children:["Found ",e?.documentsFound??0," document(s) total."]})]}):c.jsx(Le,{type:"unknown",children:" Status unknown  click Refresh to scan for issues"})})}function ic({message:t="Loading...",spinnerColor:e=ae.primary,children:n,spinnerSize:r=4}){return c.jsxs("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(15, 15, 20, 0.95)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",zIndex:9999,gap:"1.5rem",backdropFilter:"blur(4px)"},children:[c.jsx("div",{style:{width:`${r}rem`,height:`${r}rem`,border:"3px solid rgba(255, 255, 255, 0.15)",borderTopColor:e,borderRadius:"50%",animation:"loadingOverlaySpin 0.8s linear infinite"}}),c.jsx("p",{style:{color:"rgba(255, 255, 255, 0.95)",fontSize:"1.2rem",fontWeight:600,letterSpacing:"0.02em",margin:0},children:t}),n,c.jsx("style",{children:`
        @keyframes loadingOverlaySpin {
          to { transform: rotate(360deg); }
        }
      `})]})}function id({percent:t,gradient:e="linear-gradient(90deg, #646cff, #8b5cf6)",width:n=300}){return c.jsx("div",{style:{width:`${n}px`,height:"8px",background:"rgba(255, 255, 255, 0.1)",borderRadius:"4px",overflow:"hidden"},children:c.jsx("div",{style:{width:`${t}%`,height:"100%",background:e,borderRadius:"4px",transition:"width 0.3s ease-out"}})})}function on({value:t,label:e,color:n="#646cff"}){return c.jsxs("div",{style:{textAlign:"center"},children:[c.jsx("p",{style:{color:n,fontSize:"1.5rem",fontWeight:700,margin:0},children:t}),c.jsx("p",{style:{color:"rgba(255, 255, 255, 0.6)",fontSize:"0.8rem",margin:"0.25rem 0 0",textTransform:"uppercase",letterSpacing:"0.05em"},children:e})]})}function ho({children:t,columns:e=3}){return c.jsx("div",{style:{display:"grid",gridTemplateColumns:`repeat(${e}, 1fr)`,gap:"2rem",textAlign:"center"},children:t})}function ad({percent:t}){return c.jsxs("p",{style:{color:"rgba(255, 255, 255, 0.5)",fontSize:"0.9rem",margin:0},children:[t,"% complete"]})}function Ao({message:t,children:e,onDismiss:n,style:r}){return c.jsxs("div",{style:{...a6,...r},children:[c.jsx("span",{children:e??t}),n&&c.jsx("button",{onClick:n,style:o6,children:""})]})}const f6={primary:BT,"primary-large":KL,secondary:YL,danger:XL,small:JL};function De({variant:t="primary",isLoading:e,loadingText:n="Saving...",children:r,disabled:a,style:o,actionName:u,onClick:h,...f}){const m=f6[t],g=a||e;function _(v){h?.(v)}return c.jsx("button",{disabled:g,style:{...m,cursor:g?"not-allowed":"pointer",opacity:g?.7:1,...o},onClick:_,...f,children:e?n:r})}function $T(t,e){const n=t.toLowerCase(),r=e.toLowerCase();if(r.includes(n)){const h=r.indexOf(n);return{match:!0,score:h===0||/\s/.test(r[h-1])?100:90}}let a=0,o=0,u=0;for(let h=0;h<r.length&&a<n.length;h++)r[h]===n[a]?(a++,u++,o+=u*2):u=0;return a===n.length?{match:!0,score:o}:{match:!1,score:0}}function qT(t){return[...t].sort((e,n)=>!e.groupId&&n.groupId?1:e.groupId&&!n.groupId?-1:!e.groupId&&!n.groupId?e.sortOrder-n.sortOrder:e.groupSortOrder!==n.groupSortOrder?e.groupSortOrder-n.groupSortOrder:e.sortOrder-n.sortOrder)}function HT(t){const e=qT(t),n=[];let r="__initial__";return e.forEach(a=>{a.groupId!==r&&(r=a.groupId,n.push({groupId:a.groupId,groupName:a.groupName,groupSortOrder:a.groupSortOrder,items:[]})),n[n.length-1].items.push(a)}),n}function GT(t,e,n){return e.trim()?t.map(a=>{const o=n(a);let u=0,h=!1;for(const f of o){const m=$T(e,f);m.match&&(h=!0,u=Math.max(u,m.score))}return{item:a,score:u,hasMatch:h}}).filter(({hasMatch:a})=>a).sort((a,o)=>o.score!==a.score?o.score-a.score:!a.item.groupId&&o.item.groupId?1:a.item.groupId&&!o.item.groupId?-1:a.item.groupSortOrder!==o.item.groupSortOrder?a.item.groupSortOrder-o.item.groupSortOrder:a.item.sortOrder-o.item.sortOrder).map(({item:a})=>a):qT(t)}const N0={position:"absolute",top:"100%",left:0,right:0,marginTop:"4px",background:"var(--background, #1a1a1a)",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",borderRadius:"6px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",zIndex:1e3},Pu={padding:"0.6rem 0.8rem",cursor:"pointer",transition:"background 0.1s"};function Rw({id:t,value:e,onChange:n,payees:r,placeholder:a="Enter payee name"}){const[o,u]=T.useState(!1),[h,f]=T.useState(-1),m=T.useRef(null),g=T.useRef(null),_=e.trim()?r.map(x=>({payee:x,...$T(e,x)})).filter(x=>x.match).sort((x,E)=>E.score-x.score).slice(0,8).map(x=>x.payee):[];T.useEffect(()=>{function x(E){m.current&&!m.current.contains(E.target)&&u(!1)}return document.addEventListener("mousedown",x),()=>document.removeEventListener("mousedown",x)},[]);function v(x){!o||_.length===0||(x.key==="ArrowDown"?(x.preventDefault(),f(E=>Math.min(E+1,_.length-1))):x.key==="ArrowUp"?(x.preventDefault(),f(E=>Math.max(E-1,-1))):x.key==="Enter"&&h>=0?(x.preventDefault(),n(_[h]),u(!1),f(-1)):x.key==="Escape"&&(u(!1),f(-1)))}function S(x){n(x),u(!1),f(-1),g.current?.focus()}return c.jsxs("div",{ref:m,style:{position:"relative"},children:[c.jsx("input",{ref:g,id:t,type:"text",value:e,onChange:x=>{n(x.target.value),u(!0),f(-1)},onFocus:()=>u(!0),onKeyDown:v,placeholder:a,autoComplete:"off",style:Ta}),o&&_.length>0&&c.jsx("div",{style:{...N0,maxHeight:"200px",overflowY:"auto"},children:_.map((x,E)=>c.jsx("div",{onClick:()=>S(x),style:{...Pu,background:E===h?`color-mix(in srgb, ${ae.primary} 20%, transparent)`:"transparent",borderBottom:E<_.length-1?"1px solid color-mix(in srgb, currentColor 10%, transparent)":"none"},onMouseEnter:()=>f(E),children:x},x))})]})}function QT({id:t,value:e,onChange:n,categories:r,categoryGroups:a,placeholder:o="Search categories...",required:u,showNoCategoryOption:h=!1,showHiddenCategories:f=!1}){const m=Object.fromEntries(a.map(V=>[V.id,V.name])),g=Object.fromEntries(a.map(V=>[V.id,V.sort_order])),_=f?r:Object.fromEntries(Object.entries(r).filter(([,V])=>!V.is_hidden)),v=Object.entries(_).map(([V,W])=>({id:V,name:W.name,groupId:W.category_group_id,groupName:W.category_group_id&&m[W.category_group_id]||null,sortOrder:W.sort_order,groupSortOrder:W.category_group_id?g[W.category_group_id]??999:999})),S=e===Ut,x=S?null:e?r[e]:null,E=S?"":x?.name||"",[C,I]=T.useState(E),[j,M]=T.useState(!1),[Q,q]=T.useState(-1),G=T.useRef(null),D=T.useRef(null);T.useEffect(()=>{if(e===Ut)I("");else{const V=e?r[e]:null;I(V?.name||"")}},[e,r]);const A=GT(v,C,V=>[V.name,V.groupName||""].filter(Boolean)),N=HT(A);T.useEffect(()=>{function V(W){if(G.current&&!G.current.contains(W.target))if(M(!1),e===Ut)I("");else{const ee=e?r[e]:null;I(ee?.name||"")}}return document.addEventListener("mousedown",V),()=>document.removeEventListener("mousedown",V)},[e,r]);function L(V){if(V.key==="ArrowDown")V.preventDefault(),j?q(W=>Math.min(W+1,A.length-1)):(M(!0),q(0));else if(V.key==="ArrowUp")V.preventDefault(),q(W=>Math.max(W-1,0));else if(V.key==="Enter")V.preventDefault(),j&&Q>=0&&A[Q]&&P(A[Q]);else if(V.key==="Escape")if(M(!1),q(-1),e===Ut)I("");else{const W=e?r[e]:null;I(W?.name||"")}else if(V.key==="Tab"&&j&&A.length>0){const W=Q>=0?Q:0;P(A[W])}}function P(V){n(V.id),I(V.id===Ut?"":V.name),M(!1),q(-1),D.current?.focus()}function B(){n(Ut),I(""),M(!1),q(-1)}function O(V){const W=V.target.value;I(W),M(!0),q(-1),W!==E&&n("")}function K(){M(!0),A.length>0&&q(0)}let Y=-1;const z=()=>++Y;return c.jsxs("div",{ref:G,style:{position:"relative"},children:[c.jsx("input",{ref:D,id:t,type:"text",value:C,onChange:O,onFocus:K,onKeyDown:L,placeholder:o,autoComplete:"off",required:u,style:{...Ta,borderColor:u&&!e?ae.error:void 0}}),j&&c.jsxs("div",{style:{...N0,maxHeight:"250px",overflowY:"auto"},children:[h&&c.jsx("div",{onClick:B,onMouseEnter:()=>q(-1),style:{...Pu,opacity:.7,fontStyle:"italic",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)",background:Q===-1?`color-mix(in srgb, ${ae.primary} 20%, transparent)`:"transparent"},children:va}),N.map((V,W)=>c.jsxs("div",{children:[V.groupName&&c.jsx("div",{style:{padding:"0.4rem 0.8rem",fontSize:"0.75rem",textTransform:"uppercase",letterSpacing:"0.5px",opacity:.6,background:"color-mix(in srgb, currentColor 5%, transparent)",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},children:V.groupName}),V.items.map(ee=>{const ie=z();return c.jsx("div",{onClick:()=>P(ee),style:{...Pu,paddingLeft:V.groupName?"1.2rem":"0.8rem",background:ie===Q?`color-mix(in srgb, ${ae.primary} 20%, transparent)`:"transparent",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},onMouseEnter:()=>q(ie),children:ee.name},ee.id)})]},`group-${W}`)),A.length===0&&C.trim()&&!h&&c.jsx("div",{style:{padding:"0.6rem 0.8rem",opacity:.6,fontStyle:"italic"},children:"No matching categories"})]})]})}function WT({id:t,value:e,onChange:n,accounts:r,accountGroups:a,placeholder:o="Search accounts...",required:u,showNoAccountOption:h=!1,showHiddenAccounts:f=!1}){const g=(f?r:r.filter(([,Y])=>!Y.is_hidden)).map(([Y,z])=>({id:Y,name:z.nickname,groupId:z.account_group_id,groupName:z.account_group_id&&a[z.account_group_id]?.name||null,sortOrder:z.sort_order,groupSortOrder:z.account_group_id?a[z.account_group_id]?.sort_order??999:999})),_=e===Bt,v=_?null:r.find(([Y])=>Y===e)?.[1],S=_?"":v?.nickname||"",[x,E]=T.useState(S),[C,I]=T.useState(!1),[j,M]=T.useState(-1),Q=T.useRef(null),q=T.useRef(null);T.useEffect(()=>{if(e===Bt)E("");else{const Y=r.find(([z])=>z===e)?.[1];E(Y?.nickname||"")}},[e,r]);const G=GT(g,x,Y=>[Y.name,Y.groupName||""].filter(Boolean)),D=HT(G);T.useEffect(()=>{function Y(z){if(Q.current&&!Q.current.contains(z.target))if(I(!1),e===Bt)E("");else{const V=r.find(([W])=>W===e)?.[1];E(V?.nickname||"")}}return document.addEventListener("mousedown",Y),()=>document.removeEventListener("mousedown",Y)},[e,r]);function A(Y){if(Y.key==="ArrowDown")Y.preventDefault(),C?M(z=>Math.min(z+1,G.length-1)):(I(!0),M(0));else if(Y.key==="ArrowUp")Y.preventDefault(),M(z=>Math.max(z-1,0));else if(Y.key==="Enter")Y.preventDefault(),C&&j>=0&&G[j]&&N(G[j]);else if(Y.key==="Escape")if(I(!1),M(-1),e===Bt)E("");else{const z=r.find(([V])=>V===e)?.[1];E(z?.nickname||"")}else if(Y.key==="Tab"&&C&&G.length>0){const z=j>=0?j:0;N(G[z])}}function N(Y){n(Y.id),E(Y.id===Bt?"":Y.name),I(!1),M(-1),q.current?.focus()}function L(){n(Bt),E(""),I(!1),M(-1)}function P(Y){const z=Y.target.value;E(z),I(!0),M(-1),z!==S&&n("")}function B(){I(!0),G.length>0&&M(0)}let O=-1;const K=()=>++O;return c.jsxs("div",{ref:Q,style:{position:"relative"},children:[c.jsx("input",{ref:q,id:t,type:"text",value:x,onChange:P,onFocus:B,onKeyDown:A,placeholder:o,autoComplete:"off",required:u,style:{...Ta,borderColor:u&&!e?ae.error:void 0}}),C&&c.jsxs("div",{style:{...N0,maxHeight:"250px",overflowY:"auto"},children:[h&&c.jsx("div",{onClick:L,onMouseEnter:()=>M(-1),style:{...Pu,opacity:.7,fontStyle:"italic",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)",background:j===-1?`color-mix(in srgb, ${ae.primary} 20%, transparent)`:"transparent"},children:Bs}),D.map((Y,z)=>c.jsxs("div",{children:[Y.groupName&&c.jsx("div",{style:{padding:"0.4rem 0.8rem",fontSize:"0.75rem",textTransform:"uppercase",letterSpacing:"0.5px",opacity:.6,background:"color-mix(in srgb, currentColor 5%, transparent)",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},children:Y.groupName}),Y.items.map(V=>{const W=K();return c.jsx("div",{onClick:()=>N(V),style:{...Pu,paddingLeft:Y.groupName?"1.2rem":"0.8rem",background:W===j?`color-mix(in srgb, ${ae.primary} 20%, transparent)`:"transparent",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},onMouseEnter:()=>M(W),children:V.name},V.id)})]},`group-${z}`)),G.length===0&&x.trim()&&!h&&c.jsx("div",{style:{padding:"0.6rem 0.8rem",opacity:.6,fontStyle:"italic"},children:"No matching accounts"})]})]})}function pi({children:t,onSubmit:e,actionName:n}){function r(a){e(a)}return c.jsx("form",{onSubmit:r,style:HL,children:t})}function Ct({label:t,htmlFor:e,children:n,hint:r,style:a}){return c.jsxs("div",{style:{...GL,...a},children:[c.jsx("label",{htmlFor:e,style:QL,children:t}),n,r&&c.jsx("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.85rem",opacity:.6},children:r})]})}function gi(t){return c.jsx("input",{style:Ta,...t})}function m6(t){if(!t)return"";try{return new Date(t+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"})}catch{return t}}function Nf({value:t,onChange:e,style:n,...r}){const a=T.useRef(null),o=m6(t);function u(){a.current?.showPicker?.()}return c.jsxs("div",{style:{position:"relative"},children:[c.jsx("input",{ref:a,type:"date",value:t||"",onChange:e,style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",opacity:0,pointerEvents:"none"},...r}),c.jsx("div",{onClick:u,style:{...Ta,cursor:"pointer",display:"flex",alignItems:"center",fontSize:"0.85rem",fontFamily:"monospace",color:t?"inherit":"color-mix(in srgb, currentColor 50%, transparent)",...n},children:o||"Select date"})]})}function Bu({children:t,...e}){return c.jsx("select",{style:WL,...e,children:t})}function P0({minHeight:t="6rem",style:e,...n}){return c.jsx("textarea",{style:{...Ta,width:"100%",minHeight:t,resize:"vertical",fontFamily:"inherit",boxSizing:"border-box",...e},...n})}function Aa({children:t}){return c.jsx("div",{style:n6,children:t})}function Fg(t){const n=t.replace(/[^\d.]/g,"").split("."),r=n[0]||"",a=n[1],o=r.replace(/\B(?=(\d{3})+(?!\d))/g,",");return a!==void 0?`$${o}.${a.slice(0,2)}`:o?`$${o}`:""}function p6(t){return t.replace(/[$,]/g,"")}function co({id:t,value:e,onChange:n,placeholder:r="$0.00",required:a,autoFocus:o,style:u}){const[h,f]=T.useState(()=>Fg(e)),m=T.useRef(null);T.useEffect(()=>{const _=Fg(e);p6(h)!==e&&f(_)},[e]);function g(_){const v=_.target.value;if(!v||v==="$"){f(""),n("");return}const x=v.replace(/[^\d.]/g,"").split(".");let E=x[0];x.length>1&&(E+="."+x.slice(1).join("").slice(0,2));const C=Fg(E);f(C),n(E)}return c.jsx("input",{ref:m,id:t,type:"text",inputMode:"decimal",value:h,onChange:g,placeholder:r,required:a,autoFocus:o,style:{...Ta,...u}})}function _m({children:t,isDragging:e,isDragOver:n,onDragStart:r,onDragOver:a,onDragLeave:o,onDragEnd:u,onDrop:h,onEdit:f,onDelete:m,onMoveUp:g,onMoveDown:_,canMoveUp:v=!0,canMoveDown:S=!0,itemName:x}){const E=zs(),C=g||_;return c.jsxs("div",{onDragOver:I=>{I.stopPropagation(),a(I)},onDragLeave:I=>{I.stopPropagation(),o()},onDrop:I=>{I.stopPropagation(),h(I)},style:{position:"relative"},children:[c.jsx("div",{style:{...UT,opacity:n?1:0,boxShadow:n?"0 0 8px rgba(100, 108, 255, 0.6)":"none"}}),c.jsxs("div",{style:{...E?qL:sd,opacity:e?.5:1},children:[c.jsxs("div",{style:{flex:1,display:"flex",alignItems:"center",gap:E?"0.5rem":"0.75rem",minWidth:0},children:[c.jsx("span",{draggable:!0,onDragStart:I=>{r(I)},onDragEnd:()=>{u()},style:{...zT,fontSize:E?"0.9rem":void 0,cursor:"grab",padding:"0.25rem",margin:"-0.25rem",borderRadius:"4px",userSelect:"none"},title:"Drag to reorder",children:""}),c.jsx("div",{style:{flex:1,minWidth:0,overflow:"hidden",textOverflow:"ellipsis"},children:t})]}),c.jsxs("div",{style:E?e6:ZL,children:[E?c.jsxs(c.Fragment,{children:[c.jsx("button",{onClick:()=>{f()},style:LT,title:"Edit","aria-label":"Edit",children:""}),c.jsx("button",{onClick:()=>{m()},style:t6,title:"Delete","aria-label":"Delete",children:""})]}):c.jsxs(c.Fragment,{children:[c.jsx(De,{variant:"secondary",actionName:`Edit ${x||"Item"}`,onClick:f,children:"Edit"}),c.jsx(De,{variant:"danger",actionName:`Delete ${x||"Item"}`,onClick:m,children:"Delete"})]}),C&&c.jsxs("div",{style:k0,children:[c.jsx("button",{onClick:I=>{I.stopPropagation(),g?.()},disabled:!v,style:{...Ul,opacity:v?.6:.2,cursor:v?"pointer":"default"},title:"Move up","aria-label":"Move up",children:""}),c.jsx("button",{onClick:I=>{I.stopPropagation(),_?.()},disabled:!S,style:{...Ul,opacity:S?.6:.2,cursor:S?"pointer":"default"},title:"Move down","aria-label":"Move down",children:""})]})]})]})]})}function B0({isActive:t,onDragOver:e,onDragLeave:n,onDrop:r,label:a="Move to end"}){return c.jsxs("div",{onDragOver:e,onDragLeave:n,onDrop:r,style:r6,children:[c.jsx("div",{style:{...s6,opacity:t?1:.3,boxShadow:t?"0 0 8px rgba(100, 108, 255, 0.6)":"none"}}),t&&c.jsx("span",{style:i6,children:a})]})}function $e(t){return`$${Math.abs(t).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`}function ts(t){return t<0?`-$${Math.abs(t).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`:`$${t.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`}function ja(t){return t===0?"$0.00":`${t>0?"+":"-"}${$e(t)}`}function _r(t){return`${t>=0?"+":"-"}${$e(t)}`}function jt(t){return t===0?ae.zero:t>0?ae.success:ae.danger}function In(t){return t===0?ae.zero:t>0?ae.success:ae.debt}function ac(t){return t===0?ae.zero:t<0?ae.error:ae.success}function oc(t){return t===0?ae.zero:t>0?ae.success:ae.error}function KT(){const t=yn();return{submitFeedback:vr({mutationFn:async({userId:n,userEmail:r,text:a,feedbackType:o,currentPath:u})=>{const h=r||n,f={id:`feedback_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,text:`${a}

(Submitted from: ${u})`,created_at:new Date().toISOString(),is_done:!1,completed_at:null,sort_order:Date.now(),feedback_type:o},{exists:m}=await Qe("feedback",h,"checking if user has existing feedback document");return m?await ft("feedback",h,{items:YP(f),user_email:r,updated_at:new Date().toISOString()},"adding new feedback item to existing document",{merge:!0}):await ft("feedback",h,{items:[f],user_email:r,created_at:new Date().toISOString(),updated_at:new Date().toISOString()},"creating new feedback document for user"),{feedbackItem:f,docId:h}},onMutate:async({userId:n,userEmail:r,text:a,feedbackType:o,currentPath:u})=>{await t.cancelQueries({queryKey:xe.feedback()});const h=t.getQueryData(xe.feedback());if(!h)return{previousData:void 0,optimisticItemId:void 0};const f=r||n,m={id:`feedback_optimistic_${Date.now()}`,text:`${a}

(Submitted from: ${u})`,created_at:new Date().toISOString(),is_done:!1,completed_at:null,sort_order:Date.now(),feedback_type:o,doc_id:f,user_email:r};return t.setQueryData(xe.feedback(),g=>({items:[...g?.items||[],m]})),{previousData:h,optimisticItemId:m.id}},onSuccess:(n,r,a)=>{a?.optimisticItemId&&t.setQueryData(xe.feedback(),o=>o&&{items:o.items.map(u=>u.id===a.optimisticItemId?{...n.feedbackItem,doc_id:n.docId,user_email:r.userEmail}:u)})},onError:(n,r,a)=>{a?.previousData&&t.setQueryData(xe.feedback(),a.previousData)}})}}function g6(){const t=yn();return{toggleFeedback:vr({mutationFn:async({item:n})=>{const{exists:r,data:a}=await Qe("feedback",n.doc_id,"PRE-EDIT-READ");if(!r||!a)throw new Error(`Feedback document not found: ${n.doc_id}`);const o=!n.is_done,u=o?new Date().toISOString():null,h=a.items||[];let f=!1;const m=h.map(g=>g.id===n.id?(f=!0,{...g,is_done:o,completed_at:u}):g);if(!f)throw console.error("[toggleFeedback] Item not found in document",{searchingFor:n.id,inDocument:n.doc_id,availableIds:h.map(g=>g.id)}),new Error(`Feedback item not found in document. Item ID: ${n.id}, Doc ID: ${n.doc_id}`);return await ft("feedback",n.doc_id,{...a,items:m,updated_at:new Date().toISOString()},`marking feedback item as ${o?"done":"not done"}`),{itemId:n.id,isDone:o,completedAt:u}},onMutate:async({item:n})=>{await t.cancelQueries({queryKey:xe.feedback()});const r=t.getQueryData(xe.feedback()),a=!n.is_done,o=a?new Date().toISOString():null;return t.setQueryData(xe.feedback(),u=>u&&{items:u.items.map(h=>h.id===n.id?{...h,is_done:a,completed_at:o}:h)}),{previousData:r}},onError:(n,r,a)=>{a?.previousData&&t.setQueryData(xe.feedback(),a.previousData)}})}}function y6(){const t=yn();return{updateSortOrder:vr({mutationFn:async({docId:n,items:r})=>{const{exists:a,data:o}=await Qe("feedback",n,"PRE-EDIT-READ");if(!a||!o)throw new Error("Feedback document not found");return await ft("feedback",n,{...o,items:r,updated_at:new Date().toISOString()},"saving reordered feedback items"),{docId:n,items:r}},onMutate:async({docId:n,items:r})=>{await t.cancelQueries({queryKey:xe.feedback()});const a=t.getQueryData(xe.feedback());return t.setQueryData(xe.feedback(),o=>{if(!o)return o;const u=new Map;return r.forEach(h=>{u.set(h.id,h.sort_order)}),{items:o.items.map(h=>h.doc_id===n&&u.has(h.id)?{...h,sort_order:u.get(h.id)}:h)}}),{previousData:a}},onError:(n,r,a)=>{a?.previousData&&t.setQueryData(xe.feedback(),a.previousData)}})}}function Ls({isOpen:t,onClose:e,title:n,children:r,width:a="28rem"}){if(!t)return null;function o(){e()}return c.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0, 0, 0, 0.6)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1001,padding:"1rem"},onClick:o,children:c.jsxs("div",{style:{background:"#1a1a1a",color:"rgba(255, 255, 255, 0.87)",borderRadius:"12px",padding:"1.5rem",width:a,maxWidth:"calc(100vw - 2rem)",flexShrink:0,boxSizing:"border-box",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.5)"},onClick:u=>u.stopPropagation(),children:[c.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[c.jsx("h2",{style:{margin:0,fontSize:"1.25rem"},children:n}),c.jsx("button",{onClick:o,style:{background:"transparent",border:"none",color:"inherit",cursor:"pointer",fontSize:"1.5rem",opacity:.6,lineHeight:1},children:""})]}),r]})})}const _6=2e3,b6={critical_bug:{label:"Critical Bug",color:"#ff4757",bgColor:"rgba(255, 71, 87, 0.15)"},bug:{label:"Bug",color:"#ffa502",bgColor:"rgba(255, 165, 2, 0.15)"},new_feature:{label:"New Feature",color:"#2ed573",bgColor:"rgba(46, 213, 115, 0.15)"},core_feature:{label:"Core Feature",color:"#1e90ff",bgColor:"rgba(30, 144, 255, 0.15)"},qol:{label:"QOL",color:"#a55eea",bgColor:"rgba(165, 94, 234, 0.15)"}};function v6(){const[t,e]=T.useState(!1),[n,r]=T.useState(""),[a,o]=T.useState("bug"),[u,h]=T.useState(!1),f=T.useContext(nd),g=wa().get_current_firebase_user(),_=zn(),{submitFeedback:v}=KT();if(T.useEffect(()=>{if(u){const E=setTimeout(()=>h(!1),_6);return()=>clearTimeout(E)}},[u]),_.pathname.includes("/admin/feedback")||!f.is_logged_in)return null;function x(E){E.preventDefault(),!(!n.trim()||!f.username||!g)&&(v.mutate({userId:g.uid,userEmail:f.username,text:n.trim(),feedbackType:a,currentPath:_.pathname}),r(""),o("bug"),e(!1),h(!0))}return c.jsxs(c.Fragment,{children:[u&&c.jsxs("div",{style:{position:"fixed",bottom:"5rem",right:"1.5rem",background:"rgba(46, 213, 115, 0.95)",color:"white",padding:"0.75rem 1rem",borderRadius:"0.5rem",fontSize:"0.9rem",fontWeight:500,boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",zIndex:1001,display:"flex",alignItems:"center",gap:"0.5rem",animation:"fadeInUp 0.2s ease-out"},children:[c.jsx("span",{children:""}),c.jsx("span",{children:"Feedback submitted!"})]}),c.jsx("button",{onClick:()=>{e(!0)},style:{position:"fixed",bottom:"1.5rem",right:"1.5rem",width:"3rem",height:"3rem",borderRadius:"50%",background:ae.primary,color:"white",border:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1.25rem",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",transition:"transform 0.15s, box-shadow 0.15s",zIndex:1e3},title:"Send Feedback",onMouseEnter:E=>{E.currentTarget.style.transform="scale(1.1)",E.currentTarget.style.boxShadow="0 6px 16px rgba(0, 0, 0, 0.4)"},onMouseLeave:E=>{E.currentTarget.style.transform="scale(1)",E.currentTarget.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.3)"},children:""}),c.jsx(Ls,{isOpen:t,onClose:()=>{e(!1),o("bug")},title:"Send Feedback",children:c.jsxs("form",{onSubmit:x,children:[c.jsx("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"0.75rem",paddingBottom:"1rem",flexWrap:"wrap"},children:["critical_bug","bug","new_feature","core_feature","qol"].map(E=>{const C=b6[E],I=a===E;return c.jsxs("button",{type:"button",onClick:()=>{C.label,o(E)},style:{flex:1,padding:"0.6rem 0.5rem",border:`2px solid ${C.color}`,borderRadius:"0.5rem",background:I?C.bgColor:"transparent",color:I?C.color:"rgba(255,255,255,0.5)",cursor:"pointer",fontWeight:I?600:400,fontSize:"0.8rem",transition:"all 0.15s ease",opacity:I?1:.5,boxShadow:I?`0 0 12px ${C.bgColor}`:"none",position:"relative"},children:[C.label,I&&c.jsx("span",{style:{position:"absolute",bottom:"-14px",left:"10%",right:"10%",height:"3px",background:"white",borderRadius:"2px"}})]},E)})}),c.jsx(P0,{value:n,onChange:E=>r(E.target.value),placeholder:"Share your feedback, bug reports, or feature requests...",minHeight:"8rem",autoFocus:!0,required:!0}),c.jsxs(Aa,{children:[c.jsx(De,{type:"button",variant:"secondary",actionName:"Cancel Feedback",onClick:()=>{e(!1),o("bug")},children:"Cancel"}),c.jsx(De,{type:"submit",actionName:"Submit Feedback",disabled:!n.trim(),children:"Submit"})]})]})})]})}const x6=1500;function S6(){console.info("[CacheInvalidate] Starting full cache invalidation..."),Ve.cancelQueries(),Ve.clear(),console.info("[CacheInvalidate] Cleared in-memory cache");try{localStorage.removeItem("BUDGET_APP_QUERY_CACHE"),console.info("[CacheInvalidate] Cleared localStorage cache")}catch(e){console.warn("[CacheInvalidate] Failed to clear localStorage:",e)}const t=new URL(window.location.href);t.searchParams.set("cacheBust","1"),console.info("[CacheInvalidate] Reloading with cache bust..."),window.location.href=t.toString()}function w6(){const[t,e]=T.useState(!1),{isAdmin:n}=zt();if(T.useEffect(()=>{if(t){const a=setTimeout(()=>e(!1),x6);return()=>clearTimeout(a)}},[t]),!n)return null;function r(){e(!0),S6()}return c.jsxs(c.Fragment,{children:[t&&c.jsxs("div",{style:{position:"fixed",bottom:"5rem",right:"5.5rem",background:"rgba(100, 108, 255, 0.95)",color:"white",padding:"0.75rem 1rem",borderRadius:"0.5rem",fontSize:"0.9rem",fontWeight:500,boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",zIndex:1001,display:"flex",alignItems:"center",gap:"0.5rem",animation:"fadeInUp 0.2s ease-out"},children:[c.jsx("span",{children:""}),c.jsx("span",{children:"Cache cleared & refetching..."})]}),c.jsx("button",{onClick:r,style:{position:"fixed",bottom:"1.5rem",right:"5.25rem",width:"3rem",height:"3rem",borderRadius:"50%",background:"#4a4a4a",color:"white",border:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1.5rem",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",transition:"transform 0.15s, box-shadow 0.15s",zIndex:1e3},title:"Clear Cache & Reload",onMouseEnter:a=>{a.currentTarget.style.transform="scale(1.1)",a.currentTarget.style.boxShadow="0 6px 16px rgba(0, 0, 0, 0.4)"},onMouseLeave:a=>{a.currentTarget.style.transform="scale(1)",a.currentTarget.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.3)"},children:""})]})}function Pr({children:t,labelStyle:e,...n}){return c.jsxs("label",{style:{display:"flex",alignItems:"flex-start",gap:"0.75rem",flex:1,cursor:"pointer",...e},children:[c.jsx("input",{type:"checkbox",style:{width:"1.25rem",height:"1.25rem",marginTop:"0.1rem",cursor:"pointer",accentColor:ae.primary},...n}),t]})}function L0({title:t,count:e,children:n,defaultExpanded:r=!1}){const[a,o]=T.useState(r);return c.jsxs("div",{style:{marginTop:"2rem"},children:[c.jsxs("button",{onClick:()=>o(!a),style:{background:"transparent",border:"none",color:"inherit",cursor:"pointer",display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 0",fontSize:"0.9rem",opacity:.7},children:[c.jsx("span",{style:{transition:"transform 0.2s",transform:a?"rotate(90deg)":"rotate(0deg)"},children:""}),t,e!==void 0&&` (${e})`]}),a&&n]})}const E6=t=>{switch(t){case 2:return 220;case 3:return 320;case 4:return 420;case 5:return 520;case 6:return 620;default:return t*100+20}},C6=t=>t<=4?2:t<=6?3:Math.ceil(t/2);function Pf(t){const{tabs:e,activeTab:n,variant:r="primary"}=t,a=e.filter(C=>!C.hidden),o=a.length,u=E6(o),h=C6(o),f=Math.floor(100/h),m=`tab-nav-${o}-${r}`,g=r==="primary",_=r==="secondary",v=r==="segmented",S=C=>{const I="color-mix(in srgb, currentColor 10%, transparent)",j="color-mix(in srgb, currentColor 3%, transparent)";return v?{flex:"1 1 0",padding:"0.75rem 1rem",border:"none",borderRadius:0,background:C?I:j,cursor:"pointer",fontWeight:C?600:400,fontSize:"0.95rem",color:"inherit",opacity:C?1:.55,transition:"all 0.15s",textDecoration:"none",display:"inline-flex",alignItems:"center",justifyContent:"center",gap:"0.25rem",position:"relative",boxSizing:"border-box",outline:"none",borderBottom:C?"2px solid currentColor":"2px solid transparent"}:_?{flex:"none",minWidth:"8.5rem",padding:"0.55rem 1rem 0.65rem",border:"none",borderRadius:"10px 10px 0 0",background:"transparent",cursor:"pointer",fontWeight:600,fontSize:"0.85rem",color:C?"inherit":"color-mix(in srgb, currentColor 55%, transparent)",transition:"color 0.15s",textDecoration:"none",display:"inline-flex",alignItems:"center",justifyContent:"center",gap:"0.25rem",position:"relative",boxSizing:"border-box",outline:"none",marginBottom:C?"-1px":"0"}:{flex:"1 1 0",padding:"0.7rem 0.75rem",border:"none",borderRadius:0,background:"transparent",cursor:"pointer",fontWeight:C?600:400,fontSize:"1rem",letterSpacing:"0.01em",color:"inherit",opacity:C?1:.6,transition:"all 0.15s",textDecoration:"none",display:"inline-flex",alignItems:"center",justifyContent:"center",gap:"0.25rem",position:"relative",boxSizing:"border-box",outline:"none"}},x=(C,I)=>c.jsxs(c.Fragment,{children:[c.jsx("span",{children:C.label}),C.checkmark&&c.jsx("span",{style:{color:ae.success,fontWeight:600},children:""}),g&&I&&c.jsx("span",{style:{position:"absolute",bottom:"-1px",left:"10%",right:"10%",height:"3px",background:"white",borderRadius:"2px"}})]}),E=()=>v?`
        .${m} {
          display: flex;
          margin-bottom: 0.75rem;
          border-bottom: 1px solid color-mix(in srgb, currentColor 15%, transparent);
        }
      `:_?`
        .${m} {
          display: flex;
          flex-wrap: nowrap;
          margin-bottom: 1rem;
          border-bottom: 1px solid color-mix(in srgb, currentColor 10%, transparent);
          justify-content: flex-start;
          padding-left: 0.75rem;
          position: relative;
        }
        .${m} > button,
        .${m} > a {
          margin-right: -8px;
          isolation: isolate;
        }
        .${m} > button:last-child,
        .${m} > a:last-child {
          margin-right: 0;
        }
        .${m} > button::before,
        .${m} > a::before {
          content: '';
          position: absolute;
          inset: 0;
          background: var(--tab-bg);
          border-radius: 10px 10px 0 0;
          z-index: -1;
          transform: perspective(50px) rotateX(5deg);
          transform-origin: bottom center;
          transition: background 0.15s;
          box-shadow: -1px 0 0 #242424, 1px 0 0 #242424;
        }
        .${m} > button:nth-child(1),
        .${m} > a:nth-child(1) {
          z-index: 4;
        }
        .${m} > button:nth-child(2),
        .${m} > a:nth-child(2) {
          z-index: 3;
        }
        .${m} > button:nth-child(3),
        .${m} > a:nth-child(3) {
          z-index: 2;
        }
        .${m} > button:nth-child(4),
        .${m} > a:nth-child(4) {
          z-index: 1;
        }
        .${m} > button.tab-active,
        .${m} > a.tab-active {
          z-index: 10;
        }
        .${m} > button.tab-active::before,
        .${m} > a.tab-active::before {
          background: var(--tab-bg-active);
        }
        .${m} > button:not(.tab-active):hover,
        .${m} > a:not(.tab-active):hover {
          color: color-mix(in srgb, currentColor 80%, transparent);
        }
        .${m} > button:not(.tab-active):hover::before,
        .${m} > a:not(.tab-active):hover::before {
          background: var(--tab-bg-hover);
        }
        @media (max-width: 480px) {
          .${m} {
            padding-left: 0;
            padding-right: 0;
          }
          .${m} > button,
          .${m} > a {
            flex: 0 0 27% !important;
            min-width: 27% !important;
            padding: 0.55rem 0.5rem 0.65rem !important;
            font-size: 0.8rem !important;
          }
        }
      `:`
      .${m} {
        display: flex;
        flex-wrap: wrap;
        margin-bottom: 0;
        border-bottom: 1px solid color-mix(in srgb, currentColor 25%, transparent);
      }
      @media (max-width: ${u}px) {
        .${m} > * {
          flex: 1 1 ${f}% !important;
          min-width: ${f}% !important;
        }
      }
    `;return c.jsxs(c.Fragment,{children:[c.jsx("style",{children:`
        ${E()}
        .${m} > button,
        .${m} > a {
          border: none !important;
          border-radius: 0 !important;
          outline: none !important;
        }
        .${m} > button:hover,
        .${m} > button:focus,
        .${m} > a:hover,
        .${m} > a:focus {
          border: none !important;
          border-color: transparent !important;
          ${g?"opacity: 0.85;":""}
          ${v?"background: color-mix(in srgb, currentColor 7%, transparent);":""}
        }
      `}),c.jsx("div",{className:m,children:a.map(C=>{const I=n===C.id;return t.mode==="link"?c.jsx(Ft,{to:`${t.linkPrefix}/${C.id}`,onClick:()=>(`${C.label}`,void 0),style:S(I),className:I?"tab-active":"",children:x(C,I)},C.id):c.jsx("button",{onClick:()=>{`${C.label}`,t.onTabChange(C.id)},style:S(I),className:I?"tab-active":"",children:x(C,I)},C.id)})})]})}function YT({items:t}){const[e,n]=T.useState(!1),r=T.useRef(null),o=zn().pathname;T.useEffect(()=>{function h(f){r.current&&!r.current.contains(f.target)&&n(!1)}if(e)return document.addEventListener("mousedown",h),()=>document.removeEventListener("mousedown",h)},[e]),T.useEffect(()=>{function h(f){f.key==="Escape"&&n(!1)}if(e)return document.addEventListener("keydown",h),()=>document.removeEventListener("keydown",h)},[e]);const u=t.filter(h=>h.hidden?!1:h.to?h.to==="/budget"?!(o==="/budget"||/^\/budget\/\d{4}\/\d{1,2}\/\w+$/.test(o)):h.to==="/account"||h.to==="/"?o!==h.to:!o.startsWith(h.to):!0);return c.jsxs("div",{ref:r,style:{position:"relative"},children:[c.jsx("button",{onClick:()=>{n(!e)},style:{display:"flex",alignItems:"center",justifyContent:"center",width:"2.5rem",height:"2.5rem",borderRadius:"8px",background:e?"color-mix(in srgb, currentColor 15%, transparent)":"color-mix(in srgb, currentColor 8%, transparent)",border:"none",cursor:"pointer",fontSize:"1.25rem",color:"inherit",transition:"background 0.15s",lineHeight:1},title:"Menu","aria-expanded":e,"aria-haspopup":"true",children:""}),e&&c.jsx("div",{style:{position:"absolute",top:"100%",right:0,marginTop:"0.5rem",minWidth:"180px",background:"#1a1a2e",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",borderRadius:"8px",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.3)",zIndex:1e3,overflow:"hidden"},children:u.map((h,f)=>{if(h.divider)return c.jsx("div",{style:{height:"1px",background:"color-mix(in srgb, currentColor 15%, transparent)",margin:"0.25rem 0"}},f);const m=c.jsxs(c.Fragment,{children:[h.icon&&c.jsx("span",{style:{width:"1.5rem",textAlign:"center"},children:h.icon}),c.jsx("span",{children:h.label})]}),g={display:"flex",alignItems:"center",gap:"0.75rem",padding:"0.75rem 1rem",fontSize:"0.95rem",color:"inherit",textDecoration:"none",cursor:"pointer",transition:"background 0.15s",background:"transparent",border:"none",width:"100%",textAlign:"left"},_={background:"color-mix(in srgb, currentColor 10%, transparent)"};return h.to?c.jsx(Ft,{to:h.to,style:g,onMouseEnter:v=>Object.assign(v.currentTarget.style,_),onMouseLeave:v=>v.currentTarget.style.background="transparent",onClick:()=>{`${h.label}`,n(!1)},children:m},f):c.jsx("button",{onClick:()=>{`${h.label}`,h.onClick?.(),n(!1)},style:g,onMouseEnter:v=>Object.assign(v.currentTarget.style,_),onMouseLeave:v=>v.currentTarget.style.background="transparent",children:m},f)})})]})}function T6({title:t,showBackArrow:e=!1,hideMenu:n=!1}){const{isAdmin:r}=zt(),a=zn(),u=[...a.pathname==="/budget"||a.pathname.startsWith("/budget/")&&!a.pathname.startsWith("/budget/settings")&&!a.pathname.startsWith("/budget/admin")&&!a.pathname.startsWith("/budget/analytics")&&!a.pathname.startsWith("/budget/my-budgets")?[]:[{label:"Budget",icon:"",to:"/budget"}],{label:"Budget Settings",icon:"",to:"/budget/settings"},{label:"Analytics",icon:"",to:"/budget/analytics"},...r?[{label:"Admin",icon:"",to:"/budget/admin"}]:[],{label:"Switch Budgets",icon:"",to:"/budget/my-budgets"},{divider:!0,label:""},{label:"Exit Budget App",icon:"",to:"/"}];return c.jsxs("nav",{style:{marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%"},children:[c.jsx("div",{style:{flex:"0 0 auto"},children:e?c.jsx(Ft,{to:"/",onClick:()=>void 0,style:{opacity:.6,fontSize:"1.5rem",textDecoration:"none"},title:"Back to Home",children:""}):c.jsx(Ft,{to:"/budget",onClick:()=>void 0,title:"Budget Home",children:c.jsx("img",{src:"/budget-icon.svg",alt:"Budget",style:{width:"1.5rem",height:"1.5rem"}})})}),c.jsx("span",{style:{fontWeight:600,fontSize:"1.1rem",textAlign:"center",flex:"1 1 auto"},children:t}),c.jsx("div",{style:{flex:"0 0 auto"},children:n?c.jsx("div",{style:{width:"1.5rem"}}):c.jsx(YT,{items:u})})]})}function XT({children:t,style:e}){return c.jsx("div",{style:{width:"100%",maxWidth:"var(--content-max-width, 900px)",marginLeft:"auto",marginRight:"auto",...e},children:t})}function A6({hasData:t,monthsCount:e,budgetCount:n,monthsToDelete:r,isDeleting:a,onDelete:o,onRefresh:u,isRefreshing:h,disabled:f,deleteResult:m,deleteProgress:g}){const[_,v]=T.useState(!1),S=()=>{v(!0)},x=()=>{v(!1),o()},E=()=>t?m&&m.deleted>0&&m.errors.length===0?"complete":e===0?"clean":"needs-action":"unknown",C=r.reduce((I,j)=>{const M=j.budgetId;return I[M]||(I[M]=[]),I[M].push(j),I},{});return c.jsxs(is,{title:" Delete ALL Months",description:"DESTRUCTIVE: Deletes ALL month documents from Firebase for ALL budgets. This will reset all income, expenses, and allocations. Use with extreme caution!",status:E(),onRefresh:u,isRefreshing:h,isBusy:a,children:[a?c.jsx(Le,{type:"running",children:"Deleting all months..."}):m?c.jsx(Le,{type:m.errors.length>0?"warning":"success",children:c.jsxs("div",{children:[m.errors.length>0?"":""," Deleted ",m.deleted," month",m.deleted!==1?"s":"",m.budgetsRecalculated>0&&c.jsxs("span",{children:[", reset ",m.budgetsRecalculated," budget",m.budgetsRecalculated!==1?"s":""]}),c.jsx("span",{style:{opacity:.8},children:", cache cleared"}),m.errors.length>0&&c.jsx("ul",{style:{margin:"0.5rem 0 0 0",paddingLeft:"1.5rem",fontSize:"0.85rem"},children:m.errors.map((I,j)=>c.jsx("li",{children:I},j))})]})}):t?e>0?c.jsxs(c.Fragment,{children:[c.jsx(Le,{type:"warning",children:c.jsxs("div",{children:[c.jsxs("div",{style:{marginBottom:"0.5rem"},children:[" Found ",c.jsx("strong",{children:e})," month",e!==1?"s":""," across ",c.jsx("strong",{children:n})," budget",n!==1?"s":"",":"]}),c.jsxs("div",{style:{maxHeight:"200px",overflowY:"auto"},children:[Object.entries(C).slice(0,5).map(([I,j])=>c.jsxs("div",{style:{marginBottom:"0.5rem"},children:[c.jsxs("div",{style:{fontWeight:500,fontSize:"0.85rem"},children:["Budget: ",I.slice(0,12),"..."]}),c.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1.25rem",fontSize:"0.85rem"},children:[j.slice(0,3).map(M=>c.jsxs("li",{children:[bo[M.month-1]," ",M.year]},M.docId)),j.length>3&&c.jsxs("li",{style:{opacity:.7},children:["...and ",j.length-3," more"]})]})]},I)),Object.keys(C).length>5&&c.jsxs("div",{style:{opacity:.7,fontSize:"0.85rem",marginTop:"0.5rem"},children:["...and ",Object.keys(C).length-5," more budgets"]})]})]})}),c.jsxs(sr,{onClick:S,disabled:f,isBusy:a,busyText:"Deleting...",actionName:"Delete All Months",children:[" Delete ALL ",e," Month",e!==1?"s":""]}),c.jsx("p",{style:{fontSize:"0.8rem",color:"#ef4444",marginTop:"0.5rem",fontWeight:500},children:" This action cannot be undone!"})]}):c.jsx(Le,{type:"clean",children:" No month documents found in Firebase."}):c.jsx(Le,{type:"unknown",children:" Status unknown  click Refresh to scan for months"}),c.jsxs(Ls,{isOpen:_,onClose:()=>v(!1),title:" Delete All Months?",children:[c.jsx("div",{style:{background:"color-mix(in srgb, #ef4444 15%, transparent)",border:"1px solid color-mix(in srgb, #ef4444 40%, transparent)",borderRadius:"8px",padding:"1rem",marginBottom:"1rem"},children:c.jsx("p",{style:{margin:0,color:"#fca5a5",fontWeight:500,fontSize:"0.95rem"},children:" This is a destructive operation that cannot be undone!"})}),c.jsxs("p",{style:{margin:"0 0 0.75rem",opacity:.9},children:["This will permanently delete ",c.jsxs("strong",{style:{color:"#ef4444"},children:[e," month",e!==1?"s":""]})," across"," ",c.jsxs("strong",{style:{color:"#ef4444"},children:[n," budget",n!==1?"s":""]}),"."]}),c.jsx("p",{style:{margin:"0 0 1rem",opacity:.8,fontSize:"0.9rem"},children:"After deletion, all affected budgets will be reset:"}),c.jsxs("ul",{style:{margin:"0 0 1.5rem",paddingLeft:"1.5rem",opacity:.8,fontSize:"0.9rem"},children:[c.jsx("li",{children:"All account balances  $0"}),c.jsx("li",{children:"All category balances  $0"}),c.jsx("li",{children:"Month history cleared"}),c.jsx("li",{children:"Cache cleared automatically"})]}),c.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[c.jsx(De,{variant:"secondary",actionName:"Cancel Delete All Months",onClick:()=>v(!1),children:"Cancel"}),c.jsxs(De,{variant:"danger",actionName:"Confirm Delete All Months",onClick:x,children:[" Delete All ",e," Months"]})]})]}),a&&g&&c.jsx(j6,{progress:g})]})}function j6({progress:t}){const e=()=>{switch(t.phase){case"deleting":return t.currentMonth?`Deleting ${t.currentMonth}...`:"Deleting months...";case"resetting-budgets":return t.currentMonth?`Resetting ${t.currentMonth}...`:"Resetting budgets...";case"clearing-cache":return"Clearing cache...";case"complete":return"Complete!";default:return"Processing..."}},n=()=>t.phase==="resetting-budgets"||t.phase==="clearing-cache"?"linear-gradient(90deg, #22c55e, #10b981)":"linear-gradient(90deg, #ef4444, #dc2626)",r=()=>t.phase==="resetting-budgets"||t.phase==="clearing-cache"?"#22c55e":"#ef4444";return c.jsxs(ic,{message:e(),spinnerColor:r(),children:[c.jsx(id,{percent:t.percentComplete,gradient:n()}),t.phase==="deleting"&&c.jsxs(ho,{columns:2,children:[c.jsx(on,{value:`${t.deleted}/${t.total}`,label:"Months Deleted",color:"#ef4444"}),c.jsx(on,{value:t.total-t.deleted,label:"Remaining",color:"rgba(255, 255, 255, 0.6)"})]}),t.phase==="resetting-budgets"&&c.jsxs(ho,{columns:2,children:[c.jsx(on,{value:t.deleted,label:"Months Deleted",color:"#ef4444"}),c.jsx(on,{value:`${t.budgetsRecalculated}/${t.totalBudgets}`,label:"Budgets Reset",color:"#22c55e"})]}),(t.phase==="clearing-cache"||t.phase==="complete")&&c.jsxs(ho,{columns:2,children:[c.jsx(on,{value:t.deleted,label:"Months Deleted",color:"#ef4444"}),c.jsx(on,{value:t.budgetsRecalculated,label:"Budgets Reset",color:"#22c55e"})]}),c.jsx(ad,{percent:t.percentComplete})]})}function R6({hasData:t,status:e,isDeleting:n,onDelete:r,onRefresh:a,isRefreshing:o,disabled:u,deleteResult:h,deleteProgress:f}){const[m,g]=T.useState(!1),_=()=>{g(!0)},v=()=>{g(!1),r()},S=()=>t?h&&(h.budgetsDeleted>0||e?.staleBudgetIds.length===0)&&h.errors.length===0?"complete":!e||e.totalBudgets===0&&e.staleBudgetIds.length===0?"clean":"needs-action":"unknown",x=e?.totalBudgets??0,E=e?.totalMonths??0,C=e?.budgets??[],I=e?.staleBudgetIds??[];return c.jsxs(is,{title:" Delete Sample User Budget",description:"Deletes the budget for sample@sample.com user (budget document, all months, and payees). This resets the sample user to a brand new state for testing the new user flow.",status:S(),onRefresh:a,isRefreshing:o,isBusy:n,children:[n?c.jsx(Le,{type:"running",children:"Deleting sample user budget..."}):h?c.jsx(Le,{type:h.errors.length>0?"warning":"success",children:c.jsxs("div",{children:[h.errors.length>0?"":""," Deleted ",h.budgetsDeleted," budget",h.budgetsDeleted!==1?"s":"",h.monthsDeleted>0&&c.jsxs("span",{children:[", ",h.monthsDeleted," month",h.monthsDeleted!==1?"s":""]}),h.payeesDeleted>0&&c.jsxs("span",{children:[", ",h.payeesDeleted," payee doc",h.payeesDeleted!==1?"s":""]}),c.jsx("span",{style:{opacity:.8},children:", cache cleared"}),h.errors.length>0&&c.jsx("ul",{style:{margin:"0.5rem 0 0 0",paddingLeft:"1.5rem",fontSize:"0.85rem"},children:h.errors.map((j,M)=>c.jsx("li",{children:j},M))})]})}):t?x>0?c.jsxs(c.Fragment,{children:[c.jsx(Le,{type:"warning",children:c.jsxs("div",{children:[c.jsxs("div",{style:{marginBottom:"0.5rem"},children:[" Found ",c.jsx("strong",{children:x})," budget",x!==1?"s":""," with"," ",c.jsx("strong",{children:E})," month",E!==1?"s":""," for sample@sample.com:"]}),c.jsx("div",{style:{maxHeight:"200px",overflowY:"auto"},children:C.map(j=>c.jsxs("div",{style:{marginBottom:"0.5rem"},children:[c.jsxs("div",{style:{fontWeight:500,fontSize:"0.85rem"},children:['"',j.budgetName,'" (',j.monthCount," month",j.monthCount!==1?"s":"",")"]}),c.jsxs("div",{style:{fontSize:"0.75rem",opacity:.7},children:["ID: ",j.budgetId.slice(0,20),"..."]})]},j.budgetId))})]})}),c.jsx(sr,{onClick:_,disabled:u,isBusy:n,busyText:"Deleting...",actionName:"Delete Sample User Budget",children:" Delete Sample User Data"}),c.jsx("p",{style:{fontSize:"0.8rem",color:"#f59e0b",marginTop:"0.5rem",fontWeight:500},children:" This resets sample@sample.com to a new user state"})]}):I.length>0?c.jsxs(c.Fragment,{children:[c.jsx(Le,{type:"warning",children:c.jsxs("div",{children:[c.jsxs("div",{style:{marginBottom:"0.5rem"},children:[" Found ",c.jsx("strong",{children:I.length})," stale budget reference",I.length!==1?"s":""," in user document:"]}),c.jsx("div",{style:{maxHeight:"200px",overflowY:"auto"},children:I.map(j=>c.jsxs("div",{style:{marginBottom:"0.5rem"},children:[c.jsx("div",{style:{fontSize:"0.85rem",opacity:.9},children:"Budget document no longer exists but ID is still in user's budget_ids"}),c.jsxs("div",{style:{fontSize:"0.75rem",opacity:.7},children:["ID: ",j]})]},j))})]})}),c.jsx(sr,{onClick:_,disabled:u,isBusy:n,busyText:"Cleaning up...",actionName:"Clean Stale Budget Reference",children:" Remove Stale Reference"}),c.jsx("p",{style:{fontSize:"0.8rem",color:"#f59e0b",marginTop:"0.5rem",fontWeight:500},children:" This will remove the orphaned budget ID from the user document"})]}):c.jsx(Le,{type:"clean",children:' No budget found for sample@sample.com  user is already in "new user" state.'}):c.jsx(Le,{type:"unknown",children:" Status unknown  click Refresh to scan for sample user budget"}),c.jsxs(Ls,{isOpen:m,onClose:()=>g(!1),title:" Delete Sample User Budget?",children:[c.jsx("div",{style:{background:"color-mix(in srgb, #f59e0b 15%, transparent)",border:"1px solid color-mix(in srgb, #f59e0b 40%, transparent)",borderRadius:"8px",padding:"1rem",marginBottom:"1rem"},children:c.jsx("p",{style:{margin:0,color:"#fcd34d",fontWeight:500,fontSize:"0.95rem"},children:" This will delete all data for sample@sample.com!"})}),c.jsxs("p",{style:{margin:"0 0 0.75rem",opacity:.9},children:["This will permanently delete ",c.jsxs("strong",{style:{color:"#f59e0b"},children:[x," budget",x!==1?"s":""]})," and"," ",c.jsxs("strong",{style:{color:"#f59e0b"},children:[E," month",E!==1?"s":""]}),"."]}),c.jsx("p",{style:{margin:"0 0 1rem",opacity:.8,fontSize:"0.9rem"},children:"After deletion, sample@sample.com will be treated as a brand new user:"}),c.jsxs("ul",{style:{margin:"0 0 1.5rem",paddingLeft:"1.5rem",opacity:.8,fontSize:"0.9rem"},children:[c.jsx("li",{children:"Budget document deleted"}),c.jsx("li",{children:"All month documents deleted"}),c.jsx("li",{children:"Payees document deleted"}),c.jsx("li",{children:"User will see onboarding flow"})]}),c.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[c.jsx(De,{variant:"secondary",actionName:"Cancel Delete Sample User Budget",onClick:()=>g(!1),children:"Cancel"}),c.jsx(De,{variant:"danger",actionName:"Confirm Delete Sample User Budget",onClick:v,children:" Delete Sample User Data"})]})]}),n&&f&&c.jsx(D6,{progress:f})]})}function D6({progress:t}){const e=()=>{switch(t.phase){case"deleting-months":return"Deleting months...";case"deleting-payees":return"Deleting payees...";case"deleting-budgets":return"Deleting budgets...";case"updating-user":return"Updating user document...";case"clearing-cache":return"Clearing cache...";case"complete":return"Complete!";default:return"Processing..."}},n=()=>t.phase==="updating-user"||t.phase==="clearing-cache"||t.phase==="complete"?"linear-gradient(90deg, #22c55e, #10b981)":"linear-gradient(90deg, #f59e0b, #d97706)",r=()=>t.phase==="updating-user"||t.phase==="clearing-cache"||t.phase==="complete"?"#22c55e":"#f59e0b";return c.jsxs(ic,{message:e(),spinnerColor:r(),children:[c.jsx(id,{percent:t.percentComplete,gradient:n()}),c.jsxs(ho,{columns:2,children:[c.jsx(on,{value:`${t.monthsDeleted}/${t.totalMonths}`,label:"Months Deleted",color:"#f59e0b"}),c.jsx(on,{value:`${t.budgetsDeleted}/${t.totalBudgets}`,label:"Budgets Deleted",color:"#f59e0b"})]}),c.jsx(ad,{percent:t.percentComplete})]})}function I6({result:t}){return c.jsx("div",{style:{marginTop:"1rem"},children:c.jsx(Le,{type:t.errors.length>0?"warning":"success",children:c.jsxs("div",{children:[t.errors.length>0?"":""," Import ",t.success?"complete":"finished with errors",c.jsxs("ul",{style:{margin:"0.5rem 0 0 0",paddingLeft:"1.5rem",fontSize:"0.9rem"},children:[c.jsxs("li",{children:[t.imported," records imported"]}),t.skipped>0&&c.jsxs("li",{children:[t.skipped," records skipped"]})]}),t.errors.length>0&&c.jsxs(c.Fragment,{children:[c.jsx("p",{style:{margin:"0.75rem 0 0.25rem 0",fontWeight:500,color:"#ef4444"},children:"Errors:"}),c.jsxs("ul",{style:{margin:0,paddingLeft:"1.5rem",fontSize:"0.85rem",color:"#ef4444"},children:[t.errors.slice(0,5).map((e,n)=>c.jsx("li",{children:e},n)),t.errors.length>5&&c.jsxs("li",{style:{opacity:.7},children:["...and ",t.errors.length-5," more errors"]})]})]})]})})})}function M6({recordCount:t,recordTypeCounts:e,monthRange:n,onCancel:r,onConfirm:a}){const o=()=>n?n.isSingleMonth?n.start:`${n.start} to ${n.end}`:"";return c.jsxs("div",{children:[c.jsxs("div",{style:{background:"color-mix(in srgb, #ef4444 15%, transparent)",border:"1px solid color-mix(in srgb, #ef4444 40%, transparent)",borderRadius:"8px",padding:"1rem",marginBottom:"1rem"},children:[c.jsx("p",{style:{margin:0,color:"#fca5a5",fontWeight:500,fontSize:"0.95rem"},children:" Warning: Destructive Operation"}),c.jsxs("p",{style:{margin:"0.5rem 0 0",color:"rgba(255, 255, 255, 0.8)",fontSize:"0.9rem"},children:["This will ",c.jsx("strong",{children:"REPLACE"})," all existing income, expenses, and allocations in"," ",c.jsx("strong",{style:{color:"#fbbf24"},children:n?.count===1?"1 month":`${n?.count} months`})," ","(",o(),")."]})]}),c.jsxs("p",{style:{margin:"0 0 0.5rem",opacity:.8},children:["You are about to import ",c.jsx("strong",{children:t.toLocaleString()})," records:"]}),c.jsxs("ul",{style:{margin:"0 0 1rem",paddingLeft:"1.5rem",fontSize:"0.9rem",opacity:.9},children:[e.income>0&&c.jsxs("li",{children:[e.income.toLocaleString()," income transactions"]}),e.spend>0&&c.jsxs("li",{children:[e.spend.toLocaleString()," expense transactions"]}),e.allocations>0&&c.jsxs("li",{children:[e.allocations.toLocaleString()," budget allocations"]})]}),c.jsxs("p",{style:{margin:"0 0 1.5rem",opacity:.8},children:["Any existing data of these types in the affected months will be ",c.jsx("strong",{style:{color:"#fca5a5"},children:"deleted and replaced"}),". This cannot be undone."]}),c.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[c.jsx(De,{variant:"secondary",actionName:"Cancel Seed Import",onClick:r,children:"Cancel"}),c.jsx(De,{variant:"danger",actionName:"Confirm Seed Import",onClick:a,children:"Replace & Import"})]})]})}function k6({progress:t}){const e=()=>{switch(t.phase){case"saving-mappings":return"Saving mappings...";case"reading-months":return`Reading ${t.totalMonths} months (parallel)...`;case"creating-months":return t.currentMonth?`Creating ${t.currentMonth}...`:`Creating ${t.monthsToCreate} new months...`;case"processing-months":return t.currentMonth?`Processing & recalculating ${t.currentMonth}...`:`Processing ${t.totalRecords.toLocaleString()} records...`;case"saving-months":return`Saving ${t.totalMonths} months (batch)...`;case"updating-budget":return"Updating budget balances...";case"complete":return"Import complete!";default:return"Importing..."}},n=t.phase==="creating-months"&&t.monthsToCreate>0,r=t.phase==="processing-months"||t.phase==="saving-months"||t.phase==="updating-budget"||t.phase==="complete";return c.jsxs(ic,{message:e(),spinnerColor:"#646cff",children:[c.jsx(id,{percent:t.percentComplete,gradient:"linear-gradient(90deg, #646cff, #8b5cf6)"}),n&&c.jsxs(ho,{columns:2,children:[c.jsx(on,{value:`${t.monthsCreated}/${t.monthsToCreate}`,label:"Months Created",color:"#f59e0b"}),c.jsx(on,{value:t.totalMonths,label:"Total Months",color:"#646cff"})]}),!n&&c.jsxs(ho,{columns:t.gapMonths>0?3:2,children:[c.jsx(on,{value:t.totalMonths,label:"Months",color:"#646cff"}),t.monthsCreated>0&&c.jsx(on,{value:t.monthsCreated,label:"New",color:"#f59e0b"}),t.gapMonths>0&&c.jsx(on,{value:t.gapMonths,label:"Gap Filled",color:"#8b5cf6"})]}),r&&c.jsxs(ho,{columns:3,children:[c.jsx(on,{value:t.incomeImported,label:"Income",color:"#22c55e"}),c.jsx(on,{value:t.spendImported,label:"Expenses",color:"#ef4444"}),c.jsx(on,{value:t.allocationsImported,label:"Allocations",color:"#3b82f6"})]}),c.jsx(ad,{percent:t.percentComplete})]})}function O6(t,e){return t.account_group_id&&e[t.account_group_id]?e[t.account_group_id].name:"Ungrouped"}function qh({oldName:t,currentMapping:e,options:n,onMap:r,placeholder:a,isAutoMapped:o}){const u=h=>{const f=h.target.value,m=n.find(g=>g.id===f);if(m){const g=m.rawName??m.name;r(f,g)}};return c.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",marginBottom:"0.5rem",padding:"0.5rem",background:o?"color-mix(in srgb, #22c55e 8%, transparent)":"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"6px",borderLeft:o?"3px solid #22c55e":"none"},children:[c.jsxs("span",{style:{flex:"0 0 40%",fontSize:"0.85rem",fontWeight:500,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",display:"flex",alignItems:"center",gap:"0.35rem"},title:t,children:['"',t,'"',o&&c.jsx("span",{style:{fontSize:"0.7rem",opacity:.6},children:"(auto)"})]}),c.jsx("span",{style:{opacity:.5},children:""}),c.jsxs("select",{value:e?.newId??"",onChange:u,style:{flex:1,padding:"0.4rem",borderRadius:"4px",border:e?"1px solid #22c55e":"1px solid color-mix(in srgb, currentColor 30%, transparent)",background:e?"color-mix(in srgb, #22c55e 10%, transparent)":"color-mix(in srgb, currentColor 10%, transparent)",color:"inherit",fontSize:"0.85rem"},children:[c.jsx("option",{value:"",children:a}),n.map(h=>c.jsx("option",{value:h.id,children:h.name},h.id))]})]})}function N6({unmappedCategories:t,unmappedAccounts:e,customMappedCategories:n,customMappedAccounts:r,categoryMappings:a,accountMappings:o,categories:u,accounts:h,accountGroups:f,onCategoryMap:m,onAccountMap:g}){const _=T.useMemo(()=>{const x=Object.entries(u).sort((E,C)=>E[1].name.localeCompare(C[1].name));return[[Ut,{name:va,category_group_id:null,sort_order:-1}],...x]},[u]),v=T.useMemo(()=>{const x=Object.entries(h).sort((E,C)=>E[1].nickname.localeCompare(C[1].nickname)).map(([E,C])=>({id:E,acc:C,displayName:`${C.nickname} (${O6(C,f)})`}));return[{id:Bt,acc:{nickname:Bs},displayName:Bs},...x]},[h,f]),S=t.length>0||e.length>0;return c.jsxs("div",{style:{background:"color-mix(in srgb, #f59e0b 10%, transparent)",border:"1px solid color-mix(in srgb, #f59e0b 30%, transparent)",borderRadius:"8px",padding:"1rem",marginBottom:"1rem"},children:[c.jsx("h4",{style:{margin:"0 0 0.75rem 0",fontSize:"0.95rem"},children:" Entity Mappings"}),c.jsxs("p",{style:{margin:"0 0 1rem 0",fontSize:"0.85rem",opacity:.8},children:[S?"Map unknown entities to existing categories/accounts.":"Review saved mappings (names that don't exactly match existing entities)."," ","These mappings will be saved for future imports."]}),t.length>0&&c.jsxs("div",{style:{marginBottom:"1rem"},children:[c.jsxs("h5",{style:{margin:"0 0 0.5rem 0",fontSize:"0.9rem",color:"#ef4444"},children:[" Unmapped Categories (",t.length,")"]}),t.map(x=>c.jsx(qh,{oldName:x,currentMapping:a.get(x),options:_.map(([E,C])=>({id:E,name:C.name})),onMap:(E,C)=>m(x,E,C),placeholder:"Select a category..."},`cat-unmapped-${x}`))]}),n.length>0&&c.jsxs("div",{style:{marginBottom:"1rem"},children:[c.jsxs("h5",{style:{margin:"0 0 0.5rem 0",fontSize:"0.9rem",color:"#60a5fa"},children:[" Saved Category Mappings (",n.length,")"]}),n.map(x=>c.jsx(qh,{oldName:x,currentMapping:a.get(x),options:_.map(([E,C])=>({id:E,name:C.name})),onMap:(E,C)=>m(x,E,C),placeholder:"Select a category...",isAutoMapped:!0},`cat-custom-${x}`))]}),e.length>0&&c.jsxs("div",{style:{marginBottom:"1rem"},children:[c.jsxs("h5",{style:{margin:"0 0 0.5rem 0",fontSize:"0.9rem",color:"#ef4444"},children:[" Unmapped Accounts (",e.length,")"]}),e.map(x=>c.jsx(qh,{oldName:x,currentMapping:o.get(x),options:v.map(({id:E,acc:C,displayName:I})=>({id:E,name:I,rawName:C.nickname})),onMap:(E,C)=>g(x,E,C),placeholder:"Select an account..."},`acc-unmapped-${x}`))]}),r.length>0&&c.jsxs("div",{children:[c.jsxs("h5",{style:{margin:"0 0 0.5rem 0",fontSize:"0.9rem",color:"#60a5fa"},children:[" Saved Account Mappings (",r.length,")"]}),r.map(x=>c.jsx(qh,{oldName:x,currentMapping:o.get(x),options:v.map(({id:E,acc:C,displayName:I})=>({id:E,name:I,rawName:C.nickname})),onMap:(E,C)=>g(x,E,C),placeholder:"Select an account...",isAutoMapped:!0},`acc-custom-${x}`))]})]})}function P6({disabled:t}){const{selectedBudgetId:e}=zt(),{data:n}=rT(e),r=T.useRef(null),[a,o]=T.useState(null),[u,h]=T.useState(!1),{status:f,parsedData:m,unmappedCategories:g,unmappedAccounts:_,customMappedCategories:v,customMappedAccounts:S,categoryMappings:x,accountMappings:E,importResult:C,importProgress:I,parseFile:j,setCategoryMapping:M,setAccountMapping:Q,runImport:q,reset:G,isParsing:D,isImporting:A,hasUnmappedEntities:N}=$L(e),L=v.length>0||S.length>0,P=T.useMemo(()=>n?.budget?.categories??{},[n?.budget?.categories]),B=T.useMemo(()=>n?.budget?.accounts??{},[n?.budget?.accounts]),O=T.useMemo(()=>n?.budget?.account_groups??{},[n?.budget?.account_groups]),K=T.useCallback(H=>{const ne=H.target.files?.[0];ne&&(o(ne),j(ne,P,B))},[j,P,B]),Y=T.useCallback(()=>{!e||!m||h(!0)},[e,m]),z=T.useCallback(async()=>{h(!1),!(!e||!m)&&await q(P,B)},[e,m,q,P,B]),V=T.useCallback(()=>{o(null),G(),r.current&&(r.current.value="")},[G]),W=T.useMemo(()=>C&&C.errors.length===0?"complete":f==="ready"||f==="mapping"?"needs-action":"unknown",[f,C]),ee=T.useMemo(()=>C&&C.errors.length===0?" Import Complete":f==="ready"?"Ready to Import":f==="mapping"?"Mapping Required":"Select a File",[f,C]),{monthRange:ie,recordTypeCounts:U}=T.useMemo(()=>{if(!m||m.length===0)return{monthRange:null,recordTypeCounts:{income:0,spend:0,allocations:0}};const H=new Set;let ne=1/0,se=-1/0,Z=12,le=1;const pe={income:0,spend:0,allocations:0};for(const Se of m)H.add(`${Se.year}-${Se.month}`),(Se.year<ne||Se.year===ne&&Se.month<Z)&&(ne=Se.year,Z=Se.month),(Se.year>se||Se.year===se&&Se.month>le)&&(se=Se.year,le=Se.month),Se.recordType==="income"?pe.income++:Se.recordType==="spend"?pe.spend++:Se.recordType==="allocation"&&pe.allocations++;const Ee=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],ge=`${Ee[Z-1]} ${ne}`,J=`${Ee[le-1]} ${se}`;return{monthRange:{start:ge,end:J,count:H.size,isSingleMonth:H.size===1},recordTypeCounts:pe}},[m]);return c.jsxs(is,{title:" Seed Data Import",description:"Import historical data from a combined CSV file. The file should have a 'type' column (income, spend, or allocation) as the first column. Unknown categories and accounts will be mapped to existing ones.",status:W,statusText:ee,onRefresh:V,isRefreshing:!1,isBusy:D||A,cardName:"Seed Import",children:[A&&I&&c.jsx(k6,{progress:I}),c.jsxs("div",{style:{marginBottom:"1rem"},children:[c.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:500,fontSize:"0.9rem"},children:"CSV File"}),c.jsx("input",{ref:r,type:"file",accept:".csv",onChange:K,disabled:t||D||A,style:{display:"block",width:"100%",padding:"0.5rem",borderRadius:"6px",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",color:"inherit",cursor:t||D||A?"not-allowed":"pointer"}}),a&&c.jsxs("p",{style:{margin:"0.5rem 0 0",fontSize:"0.85rem",opacity:.7},children:["Selected: ",a.name]})]}),D&&c.jsxs(Le,{type:"running",children:[c.jsx(xa,{})," Parsing CSV file..."]}),m&&m.length>0&&!D&&c.jsx("div",{style:{marginBottom:"1rem"},children:c.jsx(Le,{type:N?"warning":"clean",children:c.jsxs("div",{children:[N?"":""," Parsed ",m.length," rows",c.jsxs("ul",{style:{margin:"0.5rem 0 0",paddingLeft:"1.5rem",fontSize:"0.85rem"},children:[U.income>0&&c.jsxs("li",{children:[U.income," income"]}),U.spend>0&&c.jsxs("li",{children:[U.spend," spend"]}),U.allocations>0&&c.jsxs("li",{children:[U.allocations," allocations"]})]}),N&&c.jsx("span",{style:{display:"block",fontSize:"0.85rem",marginTop:"0.25rem"},children:"Some categories or accounts need to be mapped"})]})})}),(N||L)&&!D&&c.jsx(N6,{unmappedCategories:g,unmappedAccounts:_,customMappedCategories:v,customMappedAccounts:S,categoryMappings:x,accountMappings:E,categories:P,accounts:B,accountGroups:O,onCategoryMap:M,onAccountMap:Q}),f==="ready"&&!D&&c.jsxs(sr,{onClick:Y,disabled:t||!e,isBusy:A,busyText:"Importing...",actionName:"Run Seed Import",children:[" Import ",m?.length??0," Records"]}),C&&c.jsx(I6,{result:C}),c.jsx(Ls,{isOpen:u,onClose:()=>h(!1),title:" Confirm Import",children:c.jsx(M6,{recordCount:m?.length??0,recordTypeCounts:U,monthRange:ie,onCancel:()=>h(!1),onConfirm:z})})]})}function B6({hasData:t,status:e,hasIssues:n,totalIssues:r,isRunning:a,result:o,onRunCleanup:u,onRefresh:h,isRefreshing:f,disabled:m}){const g=()=>t?o&&o.errors.length===0&&(o.budgetsProcessed>0||o.monthsProcessed>0)?"complete":n?"needs-action":"clean":"unknown",_=o?o.accountsFixed+o.categoriesFixed+o.totalAvailableFixed+o.incomeValuesFixed+o.expenseValuesFixed+o.categoryBalancesFixed+o.accountBalancesFixed:0;return c.jsx(is,{title:" Currency Precision Cleanup",description:"Fixes floating-point precision issues by rounding all currency values to exactly 2 decimal places. Processes all months in batches, recalculates budget balances, and clears all caches. This prevents display issues like '$0.00' showing as orange (slightly negative) or totals not summing correctly.",status:g(),onRefresh:h,isRefreshing:f,isBusy:a,children:a?c.jsx(Le,{type:"running",children:"Running precision cleanup..."}):o?c.jsx(Le,{type:o.errors.length>0?"warning":"success",children:c.jsxs("div",{children:[o.errors.length>0?"":""," Cleanup complete",c.jsxs("ul",{style:{margin:"0.5rem 0 0 0",paddingLeft:"1.5rem",fontSize:"0.9rem"},children:[o.budgetsProcessed>0&&c.jsxs("li",{children:[o.budgetsProcessed," budget",o.budgetsProcessed!==1?"s":""," updated"]}),o.accountsFixed>0&&c.jsxs("li",{children:[o.accountsFixed," account balance",o.accountsFixed!==1?"s":""," fixed"]}),o.categoriesFixed>0&&c.jsxs("li",{children:[o.categoriesFixed," category value",o.categoriesFixed!==1?"s":""," fixed"]}),o.totalAvailableFixed>0&&c.jsxs("li",{children:[o.totalAvailableFixed," total_available value",o.totalAvailableFixed!==1?"s":""," fixed"]}),o.monthsProcessed>0&&c.jsxs("li",{children:[o.monthsProcessed," month",o.monthsProcessed!==1?"s":""," updated"]}),o.incomeValuesFixed>0&&c.jsxs("li",{children:[o.incomeValuesFixed," income amount",o.incomeValuesFixed!==1?"s":""," fixed"]}),o.expenseValuesFixed>0&&c.jsxs("li",{children:[o.expenseValuesFixed," expense amount",o.expenseValuesFixed!==1?"s":""," fixed"]}),o.categoryBalancesFixed>0&&c.jsxs("li",{children:[o.categoryBalancesFixed," category balance",o.categoryBalancesFixed!==1?"s":""," fixed"]}),o.accountBalancesFixed>0&&c.jsxs("li",{children:[o.accountBalancesFixed," account balance",o.accountBalancesFixed!==1?"s":""," fixed"]}),_===0&&c.jsx("li",{children:"No changes needed"})]}),o.errors.length>0?c.jsxs(c.Fragment,{children:[c.jsx("p",{style:{margin:"0.75rem 0 0.25rem 0",fontWeight:500,color:"#ef4444"},children:"Errors:"}),c.jsxs("ul",{style:{margin:0,paddingLeft:"1.5rem",fontSize:"0.85rem",color:"#ef4444"},children:[o.errors.slice(0,5).map((v,S)=>c.jsx("li",{children:v},S)),o.errors.length>5&&c.jsxs("li",{style:{opacity:.7},children:["...and ",o.errors.length-5," more errors"]})]})]}):c.jsx("p",{style:{margin:"0.75rem 0 0 0",fontSize:"0.85rem",opacity:.7},children:" All budgets recalculated and cache cleared."})]})}):t?n?c.jsxs(c.Fragment,{children:[c.jsx(Le,{type:"warning",children:c.jsxs("div",{children:[c.jsxs("div",{style:{marginBottom:"0.5rem"},children:[" Found ",r," precision issue",r!==1?"s":""," to fix:"]}),c.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem",fontSize:"0.9rem"},children:[e.budgetsWithPrecisionIssues>0&&c.jsxs("li",{children:[e.budgetsWithPrecisionIssues," budget",e.budgetsWithPrecisionIssues!==1?"s":""," with precision issues",c.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1rem",fontSize:"0.85rem",opacity:.8},children:[e.accountsWithPrecisionIssues>0&&c.jsxs("li",{children:[e.accountsWithPrecisionIssues," account balance",e.accountsWithPrecisionIssues!==1?"s":""]}),e.categoriesWithPrecisionIssues>0&&c.jsxs("li",{children:[e.categoriesWithPrecisionIssues," category value",e.categoriesWithPrecisionIssues!==1?"s":""]}),e.totalAvailableWithPrecisionIssues>0&&c.jsxs("li",{children:[e.totalAvailableWithPrecisionIssues," total_available value",e.totalAvailableWithPrecisionIssues!==1?"s":""]})]})]}),e.monthsWithPrecisionIssues>0&&c.jsxs("li",{children:[e.monthsWithPrecisionIssues," month",e.monthsWithPrecisionIssues!==1?"s":""," with precision issues",c.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1rem",fontSize:"0.85rem",opacity:.8},children:[e.incomeValuesWithPrecisionIssues>0&&c.jsxs("li",{children:[e.incomeValuesWithPrecisionIssues," income amount",e.incomeValuesWithPrecisionIssues!==1?"s":""]}),e.expenseValuesWithPrecisionIssues>0&&c.jsxs("li",{children:[e.expenseValuesWithPrecisionIssues," expense amount",e.expenseValuesWithPrecisionIssues!==1?"s":""]}),e.categoryBalancesWithPrecisionIssues>0&&c.jsxs("li",{children:[e.categoryBalancesWithPrecisionIssues," category balance value",e.categoryBalancesWithPrecisionIssues!==1?"s":""]}),e.accountBalancesWithPrecisionIssues>0&&c.jsxs("li",{children:[e.accountBalancesWithPrecisionIssues," account balance value",e.accountBalancesWithPrecisionIssues!==1?"s":""]})]})]})]}),c.jsxs("p",{style:{margin:"0.75rem 0 0 0",fontSize:"0.85rem",opacity:.7},children:["Scanned ",e.totalBudgets," budgets and ",e.totalMonths," months."]})]})}),c.jsxs(sr,{onClick:u,disabled:m,isBusy:a,busyText:"Running...",actionName:"Run Precision Cleanup",children:[" Fix ",r," Issue",r!==1?"s":""]})]}):c.jsx(Le,{type:"clean",children:c.jsxs("div",{children:[" All currency values have proper precision",c.jsxs("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.85rem",opacity:.7},children:["All ",e.totalBudgets," budgets and ",e.totalMonths," months have values rounded to 2 decimal places."]})]})}):c.jsx(Le,{type:"unknown",children:" Status unknown  click Refresh to scan the database"})})}function L6({hasData:t,status:e,hasItemsToMigrate:n,isRunning:r,result:a,onRunMigration:o,onRefresh:u,isRefreshing:h,disabled:f}){const m=()=>t?a&&a.errors.length===0&&a.expensesMigrated>0?"complete":n?"needs-action":"clean":"unknown";return c.jsx(is,{title:" Expense to Adjustment Migration",description:"Migrates expense entries with 'No Account' or 'No Category' to the new Adjustments tab. Also fixes invalid account/category IDs like 'unknown' by converting them to proper no-account/no-category values. After this migration, the Spend tab will require both a real account AND category.",status:m(),onRefresh:u,isRefreshing:h,isBusy:r,children:r?c.jsx(Le,{type:"running",children:"Running expense to adjustment migration..."}):a?c.jsx(Le,{type:a.errors.length>0?"warning":"success",children:c.jsxs("div",{children:[a.errors.length>0?"":""," Migration complete",c.jsxs("ul",{style:{margin:"0.5rem 0 0 0",paddingLeft:"1.5rem",fontSize:"0.9rem"},children:[a.budgetsProcessed>0&&c.jsxs("li",{children:[a.budgetsProcessed," budget",a.budgetsProcessed!==1?"s":""," scanned"]}),a.monthsProcessed>0&&c.jsxs("li",{children:[a.monthsProcessed," month",a.monthsProcessed!==1?"s":""," updated"]}),a.expensesMigrated>0&&c.jsxs("li",{children:[a.expensesMigrated," expense",a.expensesMigrated!==1?"s":""," migrated to adjustments"]}),a.invalidAccountsFixed>0&&c.jsxs("li",{children:[a.invalidAccountsFixed," invalid account ID",a.invalidAccountsFixed!==1?"s":""," fixed"]}),a.invalidCategoriesFixed>0&&c.jsxs("li",{children:[a.invalidCategoriesFixed," invalid category ID",a.invalidCategoriesFixed!==1?"s":""," fixed"]}),a.expensesMigrated===0&&c.jsx("li",{children:"No changes needed"})]}),a.errors.length>0?c.jsxs(c.Fragment,{children:[c.jsx("p",{style:{margin:"0.75rem 0 0.25rem 0",fontWeight:500,color:"#ef4444"},children:"Errors:"}),c.jsxs("ul",{style:{margin:0,paddingLeft:"1.5rem",fontSize:"0.85rem",color:"#ef4444"},children:[a.errors.slice(0,5).map((g,_)=>c.jsx("li",{children:g},_)),a.errors.length>5&&c.jsxs("li",{style:{opacity:.7},children:["...and ",a.errors.length-5," more errors"]})]})]}):c.jsx("p",{style:{margin:"0.75rem 0 0 0",fontSize:"0.85rem",opacity:.7},children:' All data migrated successfully. Run "Database Cleanup" to recalculate balances.'})]})}):t?n?c.jsxs(c.Fragment,{children:[c.jsx(Le,{type:"warning",children:c.jsxs("div",{children:[c.jsxs("div",{style:{marginBottom:"0.5rem"},children:[" Found ",e.expensesToMigrate," expense",e.expensesToMigrate!==1?"s":""," to migrate:"]}),c.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem",fontSize:"0.9rem"},children:[c.jsxs("li",{children:[e.expensesToMigrate," expense",e.expensesToMigrate!==1?"s":""," with No Account or No Category"]}),e.invalidAccountsToFix>0&&c.jsxs("li",{children:[e.invalidAccountsToFix," invalid account ID",e.invalidAccountsToFix!==1?"s":"",' (e.g., "unknown")']}),e.invalidCategoriesToFix>0&&c.jsxs("li",{children:[e.invalidCategoriesToFix," invalid category ID",e.invalidCategoriesToFix!==1?"s":"",' (e.g., "unknown")']})]}),c.jsxs("p",{style:{margin:"0.75rem 0 0 0",fontSize:"0.85rem",opacity:.7},children:["Scanned ",e.totalBudgets," budget",e.totalBudgets!==1?"s":""," and ",e.totalMonths," month",e.totalMonths!==1?"s":"","."]})]})}),c.jsxs(sr,{onClick:o,disabled:f,isBusy:r,busyText:"Migrating...",actionName:"Run Expense to Adjustment Migration",children:[" Migrate ",e.expensesToMigrate," Expense",e.expensesToMigrate!==1?"s":""]})]}):c.jsx(Le,{type:"clean",children:c.jsxs("div",{children:[" No expenses need migration",c.jsxs("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.85rem",opacity:.7},children:["All ",e.totalMonths," month",e.totalMonths!==1?"s":""," across ",e.totalBudgets," budget",e.totalBudgets!==1?"s":""," have valid expense data."]})]})}):c.jsx(Le,{type:"unknown",children:" Status unknown  click Refresh to scan the database"})})}function z6({hasData:t,status:e,hasItemsToFix:n,isRunning:r,result:a,onRunMigration:o,onRefresh:u,isRefreshing:h,disabled:f}){const m=()=>t?a&&a.errors.length===0&&(a.categoryIdsFixed>0||a.accountIdsFixed>0)?"complete":n?"needs-action":"clean":"unknown",g=e?e.orphanedCategoryIds+e.orphanedAccountIds:0,_=a?a.categoryIdsFixed+a.accountIdsFixed:0;return c.jsx(is,{title:" Orphaned ID Cleanup",description:"Finds transactions referencing deleted or non-existent categories/accounts and converts them to 'No Category' / 'No Account'. Run this BEFORE the Expense to Adjustment migration.",status:m(),onRefresh:u,isRefreshing:h,isBusy:r,children:r?c.jsx(Le,{type:"running",children:"Running orphaned ID cleanup..."}):a?c.jsx(Le,{type:a.errors.length>0?"warning":"success",children:c.jsxs("div",{children:[a.errors.length>0?"":""," Cleanup complete",c.jsxs("ul",{style:{margin:"0.5rem 0 0 0",paddingLeft:"1.5rem",fontSize:"0.9rem"},children:[a.budgetsProcessed>0&&c.jsxs("li",{children:[a.budgetsProcessed," budget",a.budgetsProcessed!==1?"s":""," scanned"]}),a.monthsProcessed>0&&c.jsxs("li",{children:[a.monthsProcessed," month",a.monthsProcessed!==1?"s":""," updated"]}),a.categoryIdsFixed>0&&c.jsxs("li",{children:[a.categoryIdsFixed," orphaned category ID",a.categoryIdsFixed!==1?"s":"","  No Category"]}),a.accountIdsFixed>0&&c.jsxs("li",{children:[a.accountIdsFixed," orphaned account ID",a.accountIdsFixed!==1?"s":"","  No Account"]}),_===0&&c.jsx("li",{children:"No changes needed"})]}),a.errors.length>0?c.jsxs(c.Fragment,{children:[c.jsx("p",{style:{margin:"0.75rem 0 0.25rem 0",fontWeight:500,color:"#ef4444"},children:"Errors:"}),c.jsxs("ul",{style:{margin:0,paddingLeft:"1.5rem",fontSize:"0.85rem",color:"#ef4444"},children:[a.errors.slice(0,5).map((v,S)=>c.jsx("li",{children:v},S)),a.errors.length>5&&c.jsxs("li",{style:{opacity:.7},children:["...and ",a.errors.length-5," more errors"]})]})]}):c.jsx("p",{style:{margin:"0.75rem 0 0 0",fontSize:"0.85rem",opacity:.7},children:' Now run "Expense to Adjustment Migration" to move these to the Adjustments tab.'})]})}):t?n?c.jsxs(c.Fragment,{children:[c.jsx(Le,{type:"warning",children:c.jsxs("div",{children:[c.jsxs("div",{style:{marginBottom:"0.5rem"},children:[" Found ",g," orphaned ID",g!==1?"s":""," to fix:"]}),c.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem",fontSize:"0.9rem"},children:[e.orphanedCategoryIds>0&&c.jsxs("li",{children:[e.orphanedCategoryIds," orphaned category ID",e.orphanedCategoryIds!==1?"s":""]}),e.orphanedAccountIds>0&&c.jsxs("li",{children:[e.orphanedAccountIds," orphaned account ID",e.orphanedAccountIds!==1?"s":""]})]}),c.jsxs("p",{style:{margin:"0.5rem 0 0 0",fontSize:"0.85rem",opacity:.7},children:["Affected transactions: ",e.affectedExpenses," expense",e.affectedExpenses!==1?"s":"",", ",e.affectedIncome," income, ",e.affectedTransfers," transfer",e.affectedTransfers!==1?"s":"",", ",e.affectedAdjustments," adjustment",e.affectedAdjustments!==1?"s":""]}),c.jsxs("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.85rem",opacity:.7},children:["Scanned ",e.totalBudgets," budget",e.totalBudgets!==1?"s":""," and ",e.totalMonths," month",e.totalMonths!==1?"s":"","."]})]})}),c.jsxs(sr,{onClick:o,disabled:f,isBusy:r,busyText:"Cleaning up...",actionName:"Run Orphaned ID Cleanup",children:[" Fix ",g," Orphaned ID",g!==1?"s":""]})]}):c.jsx(Le,{type:"clean",children:c.jsxs("div",{children:[" No orphaned IDs found",c.jsxs("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.85rem",opacity:.7},children:["All ",e.totalMonths," month",e.totalMonths!==1?"s":""," across ",e.totalBudgets," budget",e.totalBudgets!==1?"s":""," have valid category/account references."]})]})}):c.jsx(Le,{type:"unknown",children:" Status unknown  click Refresh to scan the database"})})}function U6({hasData:t,status:e,hasPairsToConvert:n,isRunning:r,result:a,onRunMigration:o,onRefresh:u,isRefreshing:h,disabled:f}){const m=()=>t?a&&a.errors.length===0&&a.transfersCreated>0?"complete":n?"needs-action":"clean":"unknown";return c.jsx(is,{title:" Adjustments to Transfers",description:"Finds pairs of adjustments with exact opposite amounts on the same date and converts them to transfers. Only converts valid pairs: account-to-account (both No Category) or category-to-category (both No Account).",status:m(),onRefresh:u,isRefreshing:h,isBusy:r,children:r?c.jsx(Le,{type:"running",children:"Converting adjustment pairs to transfers..."}):a?c.jsx(Le,{type:a.errors.length>0?"warning":"success",children:c.jsxs("div",{children:[a.errors.length>0?"":""," Migration complete",c.jsxs("ul",{style:{margin:"0.5rem 0 0 0",paddingLeft:"1.5rem",fontSize:"0.9rem"},children:[a.budgetsProcessed>0&&c.jsxs("li",{children:[a.budgetsProcessed," budget",a.budgetsProcessed!==1?"s":""," scanned"]}),a.monthsProcessed>0&&c.jsxs("li",{children:[a.monthsProcessed," month",a.monthsProcessed!==1?"s":""," updated"]}),a.transfersCreated>0&&c.jsxs("li",{children:[a.transfersCreated," transfer",a.transfersCreated!==1?"s":""," created"]}),a.adjustmentsRemoved>0&&c.jsxs("li",{children:[a.adjustmentsRemoved," adjustment",a.adjustmentsRemoved!==1?"s":""," removed"]}),a.transfersCreated===0&&c.jsx("li",{children:"No changes needed"})]}),a.errors.length>0?c.jsxs(c.Fragment,{children:[c.jsx("p",{style:{margin:"0.75rem 0 0.25rem 0",fontWeight:500,color:"#ef4444"},children:"Errors:"}),c.jsxs("ul",{style:{margin:0,paddingLeft:"1.5rem",fontSize:"0.85rem",color:"#ef4444"},children:[a.errors.slice(0,5).map((g,_)=>c.jsx("li",{children:g},_)),a.errors.length>5&&c.jsxs("li",{style:{opacity:.7},children:["...and ",a.errors.length-5," more errors"]})]})]}):c.jsx("p",{style:{margin:"0.75rem 0 0 0",fontSize:"0.85rem",opacity:.7},children:" Adjustment pairs converted to transfers successfully."})]})}):t?n?c.jsxs(c.Fragment,{children:[c.jsx(Le,{type:"warning",children:c.jsxs("div",{children:[c.jsxs("div",{style:{marginBottom:"0.5rem"},children:[" Found ",e.pairsFound," adjustment pair",e.pairsFound!==1?"s":""," to convert:"]}),c.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem",fontSize:"0.9rem"},children:[e.accountTransferPairs>0&&c.jsxs("li",{children:[e.accountTransferPairs," account-to-account transfer",e.accountTransferPairs!==1?"s":""]}),e.categoryTransferPairs>0&&c.jsxs("li",{children:[e.categoryTransferPairs," category-to-category transfer",e.categoryTransferPairs!==1?"s":""]})]}),c.jsxs("p",{style:{margin:"0.75rem 0 0 0",fontSize:"0.85rem",opacity:.7},children:["Scanned ",e.totalBudgets," budget",e.totalBudgets!==1?"s":""," and ",e.totalMonths," month",e.totalMonths!==1?"s":"","."]})]})}),c.jsxs(sr,{onClick:o,disabled:f,isBusy:r,busyText:"Converting...",actionName:"Run Adjustments to Transfers Migration",children:[" Convert ",e.pairsFound," Pair",e.pairsFound!==1?"s":""," to Transfer",e.pairsFound!==1?"s":""]})]}):c.jsx(Le,{type:"clean",children:c.jsxs("div",{children:[" No adjustment pairs found to convert",c.jsxs("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.85rem",opacity:.7},children:["All ",e.totalMonths," month",e.totalMonths!==1?"s":""," across ",e.totalBudgets," budget",e.totalBudgets!==1?"s":""," checked."]})]})}):c.jsx(Le,{type:"unknown",children:" Status unknown  click Refresh to scan the database"})})}function F6({hasData:t,status:e,report:n,hasViolations:r,violationCount:a,isScanning:o,onScan:u,disabled:h}){const[f,m]=T.useState(!1),[g,_]=T.useState(null),[v,S]=T.useState(!1),x=T.useRef(null),E=()=>t?r?"needs-action":"clean":"unknown",C=M=>{const Q=M.target.files?.[0];if(!Q)return;const q=new FileReader;q.onload=G=>{_(G.target?.result)},q.readAsText(Q)},I=()=>{u(f&&g?g:void 0)},j=()=>{n&&navigator.clipboard.writeText(n)};return c.jsxs(is,{title:" Account/Category Validation",description:"Scans all transactions for invalid account/category combinations. Can compare against seed CSV to identify source rows.",status:E(),onRefresh:I,isRefreshing:o,isBusy:o,children:[c.jsxs("div",{style:{marginBottom:"0.75rem",padding:"0.75rem",background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"6px"},children:[c.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",cursor:"pointer",marginBottom:"0.5rem"},children:[c.jsx("input",{type:"checkbox",checked:f,onChange:M=>m(M.target.checked)}),c.jsx("span",{style:{fontSize:"0.9rem"},children:"Compare against seed CSV (optional)"})]}),f&&c.jsxs("div",{style:{marginTop:"0.5rem"},children:[c.jsx("input",{ref:x,type:"file",accept:".csv",onChange:C,style:{fontSize:"0.85rem"}}),g&&c.jsxs("div",{style:{marginTop:"0.25rem",fontSize:"0.8rem",opacity:.7},children:[" Seed file loaded (",g.split(`
`).length," lines)"]})]})]}),o?c.jsx(Le,{type:"running",children:"Scanning transactions..."}):t?r?c.jsxs(c.Fragment,{children:[c.jsx(Le,{type:"warning",children:c.jsxs("div",{children:[c.jsxs("div",{style:{marginBottom:"0.5rem"},children:[" Found ",a," transaction",a!==1?"s":""," with invalid account/category configuration"]}),e&&c.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem",fontSize:"0.9rem"},children:[e.violations.filter(M=>M.transactionType==="income").length>0&&c.jsxs("li",{children:[e.violations.filter(M=>M.transactionType==="income").length," income transaction",e.violations.filter(M=>M.transactionType==="income").length!==1?"s":""]}),e.violations.filter(M=>M.transactionType==="expense").length>0&&c.jsxs("li",{children:[e.violations.filter(M=>M.transactionType==="expense").length," expense transaction",e.violations.filter(M=>M.transactionType==="expense").length!==1?"s":""]}),e.violations.filter(M=>M.transactionType==="adjustment").length>0&&c.jsxs("li",{children:[e.violations.filter(M=>M.transactionType==="adjustment").length," adjustment transaction",e.violations.filter(M=>M.transactionType==="adjustment").length!==1?"s":""]}),e.violations.filter(M=>M.transactionType==="transfer").length>0&&c.jsxs("li",{children:[e.violations.filter(M=>M.transactionType==="transfer").length," transfer transaction",e.violations.filter(M=>M.transactionType==="transfer").length!==1?"s":""]})]}),c.jsxs("p",{style:{margin:"0.5rem 0 0 0",fontSize:"0.85rem",opacity:.7},children:["Scanned ",e?.totalMonths," month",e?.totalMonths!==1?"s":""," (",e?.totalIncome," income, ",e?.totalExpenses," expenses, ",e?.totalAdjustments," adjustments, ",e?.totalTransfers," transfers)"]})]})}),c.jsxs("div",{style:{marginTop:"0.5rem"},children:[c.jsxs("button",{onClick:()=>S(!v),style:{background:"none",border:"none",color:"#646cff",cursor:"pointer",fontSize:"0.9rem",textDecoration:"underline"},children:[v?"Hide":"Show"," Detailed Report"]}),n&&c.jsx("button",{onClick:j,style:{background:"none",border:"none",color:"#646cff",cursor:"pointer",fontSize:"0.9rem",textDecoration:"underline",marginLeft:"1rem"},children:" Copy Report"})]}),v&&n&&c.jsx("pre",{style:{marginTop:"0.5rem",padding:"1rem",background:"#1a1a2e",color:"#eee",borderRadius:"6px",fontSize:"0.75rem",overflow:"auto",maxHeight:"400px",whiteSpace:"pre-wrap",wordBreak:"break-word"},children:n}),c.jsx(sr,{onClick:I,disabled:h||f&&!g,isBusy:o,busyText:"Scanning...",actionName:"Re-scan Transaction Validation",children:" Re-scan Transactions"})]}):c.jsxs(c.Fragment,{children:[c.jsx(Le,{type:"clean",children:c.jsxs("div",{children:[" All transactions have valid account/category configurations",c.jsxs("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.85rem",opacity:.7},children:["Scanned ",e?.totalMonths," month",e?.totalMonths!==1?"s":""," (",e?.totalIncome," income, ",e?.totalExpenses," expenses, ",e?.totalAdjustments," adjustments, ",e?.totalTransfers," transfers)"]})]})}),c.jsx(sr,{onClick:I,disabled:h||f&&!g,isBusy:o,busyText:"Scanning...",actionName:"Re-scan Transaction Validation",children:" Re-scan Transactions"})]}):c.jsxs(c.Fragment,{children:[c.jsx(Le,{type:"unknown",children:" Click Scan to check all transactions for validation issues"}),c.jsx(sr,{onClick:I,disabled:h||f&&!g,isBusy:o,busyText:"Scanning...",actionName:"Scan Transaction Validation",children:" Scan All Transactions"})]})]})}function V6({hasData:t,status:e,needsMigration:n,totalItemsToFix:r,isRunning:a,result:o,onRunMigration:u,onRefresh:h,isRefreshing:f,disabled:m}){const g=()=>t?o&&o.errors.length===0?"complete":n?"needs-action":"clean":"unknown",_=o?o.accountsUpdated+o.categoriesUpdated+o.hiddenAccountsCreated+o.hiddenCategoriesCreated+o.adjustmentsFixed:0;return c.jsx(is,{title:" Hidden Field Migration",description:"Adds is_hidden field to accounts/categories, creates hidden account 'Alerus 401K Eide Bailly' and category 'House', and fixes adjustment transactions missing both account and category.",status:g(),onRefresh:h,isRefreshing:f,isBusy:a,children:a?c.jsx(Le,{type:"running",children:"Running hidden field migration..."}):o?c.jsx(Le,{type:o.errors.length>0?"warning":"success",children:c.jsxs("div",{children:[o.errors.length>0?"":""," Migration complete",c.jsxs("ul",{style:{margin:"0.5rem 0 0 0",paddingLeft:"1.5rem",fontSize:"0.9rem"},children:[o.budgetsProcessed>0&&c.jsxs("li",{children:[o.budgetsProcessed," budget",o.budgetsProcessed!==1?"s":""," updated"]}),o.accountsUpdated>0&&c.jsxs("li",{children:[o.accountsUpdated," account",o.accountsUpdated!==1?"s":""," got is_hidden field"]}),o.categoriesUpdated>0&&c.jsxs("li",{children:[o.categoriesUpdated," categor",o.categoriesUpdated!==1?"ies":"y"," got is_hidden field"]}),o.hiddenAccountsCreated>0&&c.jsxs("li",{children:[o.hiddenAccountsCreated," hidden account",o.hiddenAccountsCreated!==1?"s":""," created"]}),o.hiddenCategoriesCreated>0&&c.jsxs("li",{children:[o.hiddenCategoriesCreated," hidden categor",o.hiddenCategoriesCreated!==1?"ies":"y"," created"]}),o.adjustmentsFixed>0&&c.jsxs("li",{children:[o.adjustmentsFixed," adjustment",o.adjustmentsFixed!==1?"s":""," fixed"]}),_===0&&c.jsx("li",{children:"No changes needed"})]}),o.errors.length>0&&c.jsxs(c.Fragment,{children:[c.jsx("p",{style:{margin:"0.75rem 0 0.25rem 0",fontWeight:500,color:"#ef4444"},children:"Errors:"}),c.jsxs("ul",{style:{margin:0,paddingLeft:"1.5rem",fontSize:"0.85rem",color:"#ef4444"},children:[o.errors.slice(0,5).map((v,S)=>c.jsx("li",{children:v},S)),o.errors.length>5&&c.jsxs("li",{style:{opacity:.7},children:["...and ",o.errors.length-5," more errors"]})]})]})]})}):t?n?c.jsxs(c.Fragment,{children:[c.jsx(Le,{type:"warning",children:c.jsxs("div",{children:[c.jsxs("div",{style:{marginBottom:"0.5rem"},children:[" Found ",r," item",r!==1?"s":""," to migrate:"]}),c.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem",fontSize:"0.9rem"},children:[e.accountsNeedingField>0&&c.jsxs("li",{children:[e.accountsNeedingField," account",e.accountsNeedingField!==1?"s":""," need is_hidden field"]}),e.categoriesNeedingField>0&&c.jsxs("li",{children:[e.categoriesNeedingField," categor",e.categoriesNeedingField!==1?"ies":"y"," need is_hidden field"]}),e.adjustmentsToFix>0&&c.jsxs("li",{children:[e.adjustmentsToFix," adjustment",e.adjustmentsToFix!==1?"s":""," with missing account/category"]})]}),e.adjustmentDetails.length>0&&c.jsxs("div",{style:{marginTop:"0.5rem",fontSize:"0.85rem",opacity:.8},children:[c.jsx("p",{style:{margin:"0 0 0.25rem 0",fontWeight:500},children:"Adjustments to fix:"}),c.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[e.adjustmentDetails.slice(0,3).map((v,S)=>c.jsxs("li",{children:["[",v.monthKey,"] $",v.amount.toFixed(2)," - ",v.description||"(no description)"]},S)),e.adjustmentDetails.length>3&&c.jsxs("li",{style:{opacity:.7},children:["...and ",e.adjustmentDetails.length-3," more"]})]})]}),c.jsxs("p",{style:{margin:"0.5rem 0 0 0",fontSize:"0.85rem",opacity:.7},children:["Scanned ",e.totalBudgets," budget",e.totalBudgets!==1?"s":""," and ",e.totalMonths," month",e.totalMonths!==1?"s":"","."]})]})}),c.jsxs(sr,{onClick:u,disabled:m,isBusy:a,busyText:"Migrating...",actionName:"Run Hidden Field Migration",children:[" Run Migration (",r," item",r!==1?"s":"",")"]})]}):c.jsx(Le,{type:"clean",children:c.jsxs("div",{children:[" All accounts and categories have is_hidden field",c.jsx("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.85rem",opacity:.7},children:"No adjustment transactions with missing account/category found."})]})}):c.jsx(Le,{type:"unknown",children:" Status unknown  click Refresh to scan the database"})})}function $6({status:t,result:e,isScanning:n,isRunning:r,onScan:a,onRun:o,disabled:u}){const h=T.useRef(null),f=async m=>{const g=m.target.files?.[0];if(!g)return;const _=await g.text();await a(_),h.current&&(h.current.value="")};return c.jsx("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",padding:"1rem",marginBottom:"1rem",border:`1px solid color-mix(in srgb, ${t?.monthsToRestore?"#ffc107":"#6c757d"} 30%, transparent)`},children:c.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",gap:"1rem"},children:[c.jsxs("div",{style:{flex:1},children:[c.jsx("h3",{style:{margin:"0 0 0.25rem 0",fontSize:"1rem",color:t?.monthsToRestore?"#ffc107":"#6c757d"},children:" Restore from Diagnostic"}),c.jsx("p",{style:{margin:0,fontSize:"0.85rem",opacity:.7},children:"Restore lost transfers and adjustments from a diagnostic JSON file. Use this to recover data that was accidentally deleted."}),t&&c.jsxs("div",{style:{marginTop:"0.75rem",fontSize:"0.85rem"},children:[c.jsxs("p",{style:{margin:0},children:[c.jsx("strong",{children:"Diagnostic from:"})," ",new Date(t.diagnosticTimestamp).toLocaleString()]}),c.jsxs("p",{style:{margin:"0.25rem 0 0 0"},children:[c.jsx("strong",{children:"Months to restore:"})," ",t.monthsToRestore,t.monthsToRestore>0&&c.jsxs("span",{style:{opacity:.7},children:[" ","(",t.transfersToRestore," transfers, ",t.adjustmentsToRestore," adjustments)"]})]}),t.monthDetails.length>0&&c.jsxs("details",{style:{marginTop:"0.5rem"},children:[c.jsx("summary",{style:{cursor:"pointer",opacity:.8},children:"Show affected months"}),c.jsx("ul",{style:{margin:"0.5rem 0 0 1rem",padding:0,listStyle:"disc"},children:t.monthDetails.map((m,g)=>c.jsxs("li",{style:{marginBottom:"0.25rem"},children:[m.year,"-",String(m.month).padStart(2,"0"),": ",m.currentTransfers,"",m.diagnosticTransfers," transfers, ",m.currentAdjustments,"",m.diagnosticAdjustments," adjustments"]},g))})]})]}),e&&c.jsx("div",{style:{marginTop:"0.75rem",fontSize:"0.85rem",color:e.success?"#28a745":"#dc3545"},children:e.success?c.jsxs("p",{style:{margin:0},children:[" Restored ",e.monthsUpdated," month(s): ",e.transfersRestored," transfers, ",e.adjustmentsRestored," adjustments"]}):c.jsxs("p",{style:{margin:0},children:[" Restore failed: ",e.errors.join(", ")]})})]}),c.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem",flexShrink:0},children:[c.jsx("input",{ref:h,type:"file",accept:".json",onChange:f,style:{display:"none"}}),c.jsx(De,{variant:"secondary",actionName:"Select Diagnostic File",onClick:()=>h.current?.click(),disabled:u||n||r,children:n?c.jsxs(c.Fragment,{children:[c.jsx(xa,{noMargin:!0})," Scanning..."]}):" Select File"}),t&&t.monthsToRestore>0&&c.jsx(De,{variant:"primary",actionName:"Run Restore from Diagnostic",onClick:o,disabled:u||r,children:r?c.jsxs(c.Fragment,{children:[c.jsx(xa,{noMargin:!0})," Restoring..."]}):" Restore Data"})]})]})})}function q6(){const{state:t,closeModal:e}=I0();if(!t.isOpen)return null;const n=t.isComplete;return c.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0, 0, 0, 0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1002,padding:"1rem"},onClick:n?e:void 0,children:c.jsxs("div",{style:{background:"#1a1a1a",color:"rgba(255, 255, 255, 0.87)",borderRadius:"16px",padding:"2rem",width:"32rem",maxWidth:"calc(100vw - 2rem)",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.5)"},onClick:r=>r.stopPropagation(),children:[c.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1.5rem"},children:[c.jsxs("h2",{style:{margin:0,fontSize:"1.25rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[!t.isComplete&&c.jsx(xa,{noMargin:!0}),t.migrationName]}),n&&c.jsx("button",{onClick:e,style:{background:"transparent",border:"none",color:"inherit",cursor:"pointer",fontSize:"1.5rem",opacity:.6,lineHeight:1,padding:"0.25rem"},title:"Close",children:""})]}),c.jsxs("div",{style:{fontSize:"1rem",fontWeight:500,marginBottom:"1rem",color:t.error?"#ef4444":t.isComplete?"#22c55e":"inherit"},children:[t.error?" ":t.isComplete?" ":"",t.stage]}),c.jsx("div",{style:{background:"rgba(255, 255, 255, 0.1)",borderRadius:"8px",height:"12px",overflow:"hidden",marginBottom:"1rem"},children:t.progress!==null?c.jsx("div",{style:{background:t.error?"#ef4444":t.isComplete?"#22c55e":"#646cff",height:"100%",width:`${t.progress}%`,transition:"width 0.3s ease-out",borderRadius:"8px"}}):c.jsx("div",{style:{background:t.error?"#ef4444":"#646cff",height:"100%",width:"30%",borderRadius:"8px",animation:"progressIndeterminate 1.5s ease-in-out infinite"}})}),t.currentItem&&c.jsx("div",{style:{fontSize:"0.9rem",opacity:.8,marginBottom:"0.5rem",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:t.currentItem}),t.details&&c.jsx("div",{style:{fontSize:"0.85rem",opacity:.6,marginBottom:t.error?"1rem":0},children:t.details}),t.error&&c.jsx("div",{style:{background:"rgba(239, 68, 68, 0.1)",border:"1px solid rgba(239, 68, 68, 0.3)",borderRadius:"8px",padding:"0.75rem 1rem",fontSize:"0.9rem",color:"#ef4444"},children:t.error}),t.isComplete&&c.jsx("button",{onClick:e,style:{marginTop:"1.5rem",width:"100%",background:t.error?"rgba(239, 68, 68, 0.2)":"#646cff",color:"white",border:"none",padding:"0.75rem 1.5rem",borderRadius:"8px",cursor:"pointer",fontWeight:500,fontSize:"1rem"},children:t.error?"Close":"Done"}),!t.isComplete&&c.jsx("div",{style:{marginTop:"1rem",fontSize:"0.85rem",opacity:.5,textAlign:"center"},children:"Please wait  do not close this window"}),c.jsx("style",{children:`
            @keyframes progressIndeterminate {
              0% { transform: translateX(-100%); }
              100% { transform: translateX(400%); }
            }
          `})]})})}function H6(){return c.jsxs("div",{style:Of,children:[c.jsx("nav",{style:{marginBottom:"1rem",display:"flex",alignItems:"center"},children:c.jsx(Ft,{to:"/",style:{display:"flex",alignItems:"center"},title:"Tarron Lane Home",children:c.jsx("img",{src:"/t-icon.svg",alt:"Tarron Lane Home",style:{width:"2rem",height:"2rem"}})})}),c.jsx("h1",{children:"Tarron Lane Homepage"}),c.jsx("nav",{children:c.jsxs("ul",{children:[c.jsx("li",{children:c.jsx(Ft,{to:"/sql-test",children:"SQL Test"})}),c.jsx("li",{children:c.jsx(Ft,{to:"/budget",children:"Budget"})}),c.jsx("li",{children:c.jsx(Ft,{to:"/account",children:"Account"})})]})})]})}function G6(){const t=T.useContext(nd),e=wa(),[n,r]=T.useState(!1),a=zn(),o=Fu(),u=a.state?.from||"/";T.useEffect(()=>{t.is_logged_in&&u!=="/"&&o(u,{replace:!0})},[t.is_logged_in,u,o]);function h(){r(!0),e.logout_firebase_user().then(function(){r(!1)})}return c.jsxs("div",{style:Of,children:[c.jsxs("nav",{style:{marginBottom:"1rem",display:"grid",gridTemplateColumns:"1fr auto 1fr",alignItems:"center"},children:[c.jsx("div",{style:{display:"flex",alignItems:"center"},children:c.jsx(Ft,{to:"/",style:{opacity:.6,fontSize:"1.5rem",textDecoration:"none",padding:"0.25rem 0.5rem"},title:"Back to Home",children:""})}),c.jsxs(Ft,{to:"/",style:{display:"flex",alignItems:"center",gap:"0.5rem",textDecoration:"none",color:"inherit"},title:"Tarron Lane Home",children:[c.jsx("img",{src:"/t-icon.svg",alt:"Tarron Lane",style:{width:"1.5rem",height:"1.5rem"}}),c.jsx("span",{style:{fontWeight:600,fontSize:"1.1rem"},children:"Account"})]}),c.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:c.jsx(YT,{items:[{label:"Budget",icon:"",to:"/budget"},{label:"Account",icon:"",to:"/account"}]})})]}),c.jsx("h1",{children:"Account"}),t.is_logged_in?n?c.jsx("p",{children:"Logging Out..."}):c.jsxs(c.Fragment,{children:[c.jsxs("p",{children:["You are logged in as ",t.username]}),c.jsx("button",{onClick:h,style:{marginTop:"1rem"},children:"Logout"})]}):c.jsx(Q6,{})]})}function Q6(){const t=wa(),[e,n]=T.useState(""),[r,a]=T.useState(""),[o,u]=T.useState(!1),[h,f]=T.useState("");function m(v){n(v.target.value)}function g(v){a(v.target.value)}function _(v){v.preventDefault(),u(!0),f(""),t.login_firebase_user(e,r).then(function(){}).catch(function(){f("Incorrect login credentials")}).finally(function(){u(!1)})}return c.jsxs("form",{onSubmit:_,children:[c.jsxs("div",{children:[c.jsx("label",{htmlFor:"username",children:"Email: "}),c.jsx("input",{id:"username",type:"email",value:e,onChange:m})]}),c.jsxs("div",{children:[c.jsx("label",{htmlFor:"password",children:"Password: "}),c.jsx("input",{id:"password",type:"password",value:r,onChange:g})]}),o?c.jsx("p",{children:"Logging in..."}):c.jsx("button",{children:"Login"}),h&&c.jsx("p",{style:{color:"red"},children:h})]})}const W6={categories:"balances",accounts:"balances",income:"transactions",spend:"transactions",transfers:"transactions",adjustments:"transactions"},K6={balances:"categories",transactions:"income"};function Y6({activeTab:t,setActiveTab:e,allocationsFinalized:n}){const r=W6[t],a=T.useMemo(()=>[{id:"balances",label:"Balances"},{id:"transactions",label:"Transactions"}],[]),o=T.useMemo(()=>[{id:"categories",label:"Categories",checkmark:n},{id:"accounts",label:"Accounts"}],[n]),u=T.useMemo(()=>[{id:"income",label:"Income"},{id:"spend",label:"Spend"},{id:"transfers",label:"Transfers"},{id:"adjustments",label:"Adjustments"}],[]),h=m=>{e(K6[m])},f=r==="balances"?o:u;return c.jsxs("div",{children:[c.jsx(Pf,{mode:"button",tabs:a,activeTab:r,onTabChange:h,variant:"segmented"}),c.jsx(Pf,{mode:"button",tabs:f,activeTab:t,onTabChange:m=>e(m),variant:"secondary"})]})}function X6({isOpen:t,onClose:e,onProceed:n,results:r}){const[a,o]=T.useState("from_current"),u=!r||r.status==="confirming",h=r&&!["confirming","done","error"].includes(r.status),f=u||r?.status==="done"||r?.status==="error";function m(){f&&(e(),o("from_current"))}function g(){n(a)}return c.jsx(Ls,{isOpen:t,onClose:m,title:"Recalculate Balances",width:"540px",children:c.jsxs("div",{style:{padding:"0.5rem 0"},children:[u&&c.jsxs(c.Fragment,{children:[c.jsx("p",{style:{margin:"0 0 1rem 0",fontSize:"0.95rem",lineHeight:1.5},children:"Choose what to recalculate:"}),c.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem",marginBottom:"1.5rem"},children:[c.jsx(Iw,{selected:a==="from_current",onClick:()=>o("from_current"),title:"From current month forward",description:"Recalculate from this month onward. Use for quick fixes."}),c.jsx(Iw,{selected:a==="all_months",onClick:()=>o("all_months"),title:"All months from beginning",description:"Recalculate entire history. Use after migrations or data repairs.",recommended:!0})]}),c.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem",marginBottom:"1.5rem"},children:[c.jsx(pl,{status:"waiting",label:"Find all months to process"}),c.jsx(pl,{status:"waiting",label:"Process months"}),c.jsx(pl,{status:"waiting",label:"Update budget totals"})]}),c.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[c.jsx(De,{variant:"secondary",actionName:"Cancel Recalculation",onClick:e,children:"Cancel"}),c.jsx(De,{actionName:"Proceed with Recalculation",onClick:g,children:"Proceed"})]})]}),!u&&c.jsxs(c.Fragment,{children:[c.jsx("p",{style:{margin:"0 0 1.5rem 0",fontSize:"0.9rem",opacity:.7},children:"Recalculating category balances and account balances..."}),c.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:[c.jsx(pl,{status:r?.status==="pending"?"waiting":"complete",label:"Find all months to process",detail:r&&r.status!=="pending"?`Found ${r.monthsFound||0} month${r.monthsFound!==1?"s":""}`:void 0}),c.jsx(pl,{status:Dw(r?.status,["pending","finding_months"],"processing_months"),label:"Process months",detail:r?.status==="processing_months"?`Processing: ${r.currentMonthLabel} (${(r.currentMonthIndex||0)+1}/${r.monthsFound||0})`:r?.monthsProcessed!==void 0?`Processed ${r.monthsProcessed} month${r.monthsProcessed!==1?"s":""}`:void 0}),c.jsx(pl,{status:r?.status==="error"?"error":Dw(r?.status,["pending","finding_months","processing_months"],"updating_budget"),label:"Update budget totals",detail:r?.status==="error"?r.error:void 0,isError:r?.status==="error"})]}),r?.status==="done"&&c.jsxs("div",{style:{marginTop:"1.5rem",padding:"1rem",background:`color-mix(in srgb, ${ae.success} 10%, transparent)`,border:`1px solid ${ae.success}`,borderRadius:"8px",textAlign:"center"},children:[c.jsx("p",{style:{margin:0,fontWeight:600,color:ae.success},children:" Recalculation complete!"}),c.jsxs("p",{style:{margin:"0.5rem 0 0 0",fontSize:"0.9rem",opacity:.8},children:[r.monthsProcessed," month",r.monthsProcessed!==1?"s":""," processed",c.jsx("br",{}),"Total Income: ",$e(r.totalIncomeRecalculated||0),c.jsx("br",{}),"Total Expenses: ",$e(r.totalExpensesRecalculated||0)]})]}),(r?.status==="done"||r?.status==="error")&&c.jsx("div",{style:{marginTop:"1.5rem",display:"flex",justifyContent:"center"},children:c.jsx(De,{actionName:"Close Recalculation Modal",onClick:e,children:"Done"})}),h&&c.jsx("p",{style:{marginTop:"1.5rem",textAlign:"center",fontSize:"0.85rem",opacity:.6},children:"Please wait, do not close this window..."})]})]})})}function Dw(t,e,n){return!t||e.includes(t)?t===n?"active":"waiting":t===n?"active":"complete"}function pl({status:t,label:e,detail:n,isError:r}){const a=t==="waiting"?"":t==="active"?"":t==="error"?"":"";return c.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[c.jsx("span",{style:{fontSize:"1.1rem",width:"1.5rem",textAlign:"center"},children:a}),c.jsxs("div",{style:{flex:1},children:[c.jsx("p",{style:{margin:0,fontWeight:500},children:e}),n&&c.jsx("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.85rem",opacity:r?1:.6,color:r?ae.error:"inherit"},children:n})]})]})}function Iw({selected:t,onClick:e,title:n,description:r,recommended:a}){return c.jsxs("button",{type:"button",onClick:e,style:{display:"flex",alignItems:"flex-start",gap:"0.75rem",padding:"0.75rem 1rem",background:t?"color-mix(in srgb, #646cff 15%, transparent)":"color-mix(in srgb, currentColor 5%, transparent)",border:t?"2px solid #646cff":"2px solid transparent",borderRadius:"8px",cursor:"pointer",textAlign:"left",width:"100%",transition:"all 0.15s ease"},children:[c.jsx("span",{style:{width:"20px",height:"20px",borderRadius:"50%",border:t?"6px solid #646cff":"2px solid rgba(128,128,128,0.5)",flexShrink:0,marginTop:"2px",background:t?"white":"transparent"}}),c.jsxs("div",{style:{flex:1},children:[c.jsxs("p",{style:{margin:0,fontWeight:600,fontSize:"0.95rem"},children:[n,a&&c.jsx("span",{style:{marginLeft:"0.5rem",padding:"0.15rem 0.5rem",background:ae.success,color:"white",borderRadius:"4px",fontSize:"0.7rem",fontWeight:500,verticalAlign:"middle"},children:"RECOMMENDED"})]}),c.jsx("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.85rem",opacity:.7},children:r})]})]})}function Vg(t){return t==="no_category"||t==="NO_CATEGORY"}function J6(t,e){const n={};for(const r of t)Vg(r.from_category_id)||(n[r.from_category_id]=(n[r.from_category_id]||0)-r.amount),Vg(r.to_category_id)||(n[r.to_category_id]=(n[r.to_category_id]||0)+r.amount);for(const r of e)Vg(r.category_id)||(n[r.category_id]=(n[r.category_id]||0)+r.amount);for(const r of Object.keys(n))n[r]=we(n[r]);return n}async function Z6(t,e,n,r,a,o,u){const h=yr(t,e.year,e.month),{exists:f,data:m}=await Qe("months",h,"recalculate: reading full month data");if(!f||!m)return null;const g=m.income||[],_=m.expenses||[],v=m.transfers||[],S=m.adjustments||[],x=m.are_allocations_finalized||!1,E=we(g.reduce((A,N)=>A+N.amount,0)),C=we(_.reduce((A,N)=>A+N.amount,0)),I={};if(m.category_balances)for(const A of m.category_balances)I[A.category_id]={allocated:A.allocated??0};const j=J6(v,S),M=n.map(A=>{const N=we(a[A]??0);let L=0;x&&I[A]&&(L=we(I[A].allocated));let P=0;_.length>0&&(P=we(_.filter(K=>K.category_id===A).reduce((K,Y)=>K+Y.amount,0)));const B=j[A]??0,O=we(N+L+P+B);return{category_id:A,start_balance:N,allocated:L,spent:P,end_balance:O}});M.forEach(A=>{a[A.category_id]=A.end_balance});const Q=Object.keys(r),q={},G=Q.map(A=>{const N=we(g.filter(z=>z.account_id===A).reduce((z,V)=>z+V.amount,0)),L=we(_.filter(z=>z.account_id===A).reduce((z,V)=>z+V.amount,0)),P=we(v.filter(z=>z.from_account_id===A).reduce((z,V)=>z-V.amount,0)),B=we(v.filter(z=>z.to_account_id===A).reduce((z,V)=>z+V.amount,0)),O=we(S.filter(z=>z.account_id===A).reduce((z,V)=>z+V.amount,0)),K=we(N+L+P+B+O);q[A]=K;const Y=we(o[A]??0);return{account_id:A,start_balance:Y,income:N,expenses:L,net_change:K,end_balance:we(Y+K)}});for(const A of G)o[A.account_id]=A.end_balance;return{updatedMonth:{budget_id:t,year_month_ordinal:At(e.year,e.month),year:e.year,month:e.month,income:g,total_income:E,previous_month_income:u,expenses:_,total_expenses:C,transfers:v,adjustments:S,account_balances:G,category_balances:M,are_allocations_finalized:x,created_at:m.created_at||new Date().toISOString(),updated_at:new Date().toISOString()},totalIncome:E,totalExpenses:C,accountNetChanges:q}}function z0({isDisabled:t,onCloseMenu:e}){const{selectedBudgetId:n,currentYear:r,currentMonthNumber:a}=zt(),{categories:o,accounts:u,saveCategories:h,saveAccounts:f}=kn(),[m,g]=T.useState(!1),[_,v]=T.useState(!1),[S,x]=T.useState(null);function E(){v(!0),x({status:"confirming"})}async function C(j){if(n){g(!0),x({status:"pending"});try{x({status:"finding_months"});let M;if(j==="all_months")M=(await Ot("months","recalculate: querying all months for full recalculation",[{field:"budget_id",op:"==",value:n}])).docs.map(O=>({year:O.data.year,month:O.data.month})).sort((O,K)=>O.year!==K.year?O.year-K.year:O.month-K.month);else{const B=new Date,O=r||B.getFullYear(),K=a||B.getMonth()+1,{year:Y,month:z}=Rf(O,K);M=await o4(n,Y,z)}const Q=Object.keys(o);x({status:"finding_months",monthsFound:M.length}),await new Promise(B=>setTimeout(B,100));const q={},G={};if(j==="from_current"){const B=new Date,O=r||B.getFullYear(),K=a||B.getMonth()+1,{year:Y,month:z}=Rf(O,K),V=yr(n,Y,z),{exists:W,data:ee}=await Qe("months",V,"recalculate: reading previous month for starting balances");if(W&&ee?.category_balances)for(const ie of ee.category_balances)q[ie.category_id]=ie.end_balance??0;if(W&&ee?.account_balances)for(const ie of ee.account_balances)G[ie.account_id]=ie.end_balance??0}Q.forEach(B=>{q[B]===void 0&&(q[B]=0)}),Object.keys(u).forEach(B=>{G[B]===void 0&&(G[B]=0)});let D=0,A=0,N=0;for(let B=0;B<M.length;B++){const O=M[B],K=`${bo[O.month-1]} ${O.year}`;x({status:"processing_months",monthsFound:M.length,currentMonthIndex:B,currentMonthLabel:K});const Y=await Z6(n,O,Q,u,q,G,N);Y&&(D+=Y.totalIncome,A+=Y.totalExpenses,N=Y.totalIncome,await V4({budgetId:n,month:Y.updatedMonth,description:"recalculate all months"}),await new Promise(z=>setTimeout(z,50)))}const L={};Object.entries(u).forEach(([B,O])=>{L[B]={...O,balance:G[B]??0}}),await f(L),x({status:"updating_budget",monthsFound:M.length,monthsProcessed:M.length,totalIncomeRecalculated:D,totalExpensesRecalculated:A});const P={};Object.entries(o).forEach(([B,O])=>{P[B]={...O,balance:q[B]??0}}),await h(P);for(const B of M)Ve.invalidateQueries({queryKey:xe.month(n,B.year,B.month)});x({status:"done",monthsFound:M.length,monthsProcessed:M.length,totalIncomeRecalculated:D,totalExpensesRecalculated:A})}catch(M){console.error("Recalculate error:",M),x({status:"error",error:M instanceof Error?M.message:"Failed to recalculate"})}finally{g(!1)}}}function I(){v(!1),x(null),e?.()}return c.jsxs(c.Fragment,{children:[c.jsxs("button",{onClick:E,disabled:t||m,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",border:"none",borderRadius:"8px",padding:"0.5rem",cursor:t||m?"not-allowed":"pointer",opacity:t||m?.5:1,fontSize:"1rem",display:"flex",alignItems:"center",justifyContent:"center"},title:"Recalculate balances from this month forward",children:[m?"":""," Recalculate"]}),c.jsx(X6,{isOpen:_,onClose:I,onProceed:C,results:S})]})}function Mw({direction:t,isDisabled:e,isLoading:n,disabledReason:r,onNavigate:a}){const[o,u]=T.useState(!1),h=n||e,f=t==="prev"?"":"",m=t==="prev"?"Previous month":"Next month",g=()=>{n||(e?(u(!0),setTimeout(()=>u(!1),2e3)):a())};return c.jsxs("div",{style:{position:"relative"},children:[c.jsx("button",{onClick:g,onMouseEnter:()=>e&&u(!0),onMouseLeave:()=>u(!1),style:{background:"color-mix(in srgb, currentColor 10%, transparent)",border:"none",borderRadius:"8px",padding:"0.75rem 1rem",cursor:h?"not-allowed":"pointer",fontSize:"1.25rem",opacity:h?.5:1,transition:"opacity 0.15s, background 0.15s"},title:e?void 0:m,children:f}),o&&e&&c.jsx("div",{style:{position:"absolute",top:"100%",...t==="prev"?{left:0}:{right:0},marginTop:"0.5rem",padding:"0.5rem 0.75rem",background:ae.warning,color:"#000",borderRadius:"6px",fontSize:"0.75rem",fontWeight:500,width:"max-content",maxWidth:"min(300px, 50vw)",textAlign:"center",zIndex:20,boxShadow:"0 2px 8px rgba(0,0,0,0.3)"},children:r})]})}function ez({pickerYear:t,pickerMonth:e,currentYear:n,currentMonthNumber:r,minOrdinal:a,maxOrdinal:o,minAllowed:u,maxAllowed:h,onYearChange:f,onMonthChange:m,onGo:g}){const _=t>u.year,v=t<h.year,S=Number(At(t,e)),x=S>=a&&S<=o;return c.jsxs("div",{style:{padding:"0.75rem",borderTop:"1px solid color-mix(in srgb, currentColor 15%, transparent)",marginTop:"0.25rem"},children:[c.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.5rem"},children:[c.jsx("button",{onClick:()=>f(t-1),disabled:!_,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",border:"none",borderRadius:"4px",padding:"0.25rem 0.5rem",cursor:_?"pointer":"not-allowed",fontSize:"0.8rem",opacity:_?1:.3},title:_?"Previous year":"Cannot go further back",children:""}),c.jsx("span",{style:{flex:1,textAlign:"center",fontSize:"0.9rem",fontWeight:500},children:t}),c.jsx("button",{onClick:()=>f(t+1),disabled:!v,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",border:"none",borderRadius:"4px",padding:"0.25rem 0.5rem",cursor:v?"pointer":"not-allowed",fontSize:"0.8rem",opacity:v?1:.3},title:v?"Next year":"Cannot go further ahead",children:""})]}),c.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"0.25rem",marginBottom:"0.5rem"},children:bo.map((E,C)=>{const I=C+1,j=I===e,M=t===n&&I===r,Q=Number(At(t,I)),q=Q<a,G=Q>o,D=q||G;let A=E;return q?A="Too far in the past":G&&(A="Too far in the future"),c.jsx("button",{onClick:()=>m(I),disabled:D,style:{background:j?ae.primary:"color-mix(in srgb, currentColor 8%, transparent)",border:M?`1px solid ${ae.primary}`:"1px solid transparent",borderRadius:"4px",padding:"0.35rem 0.25rem",cursor:D?"not-allowed":"pointer",fontSize:"0.7rem",color:j?"#fff":"inherit",opacity:D?.3:1,transition:"background 0.15s"},title:A,children:E.slice(0,3)},I)})}),c.jsxs("button",{onClick:g,disabled:!x,style:{width:"100%",background:x?ae.primary:"color-mix(in srgb, currentColor 20%, transparent)",border:"none",borderRadius:"6px",padding:"0.5rem",cursor:x?"pointer":"not-allowed",fontSize:"0.85rem",color:x?"#fff":"inherit",fontWeight:500,opacity:x?1:.5},children:["Go to ",bo[e-1]," ",t]})]})}function tz({isOpen:t,onClose:e,year:n,month:r,isDeleting:a,onConfirm:o}){return c.jsxs(Ls,{isOpen:t,onClose:e,title:" Delete Month?",children:[c.jsx("div",{style:{background:"color-mix(in srgb, #ef4444 15%, transparent)",border:"1px solid color-mix(in srgb, #ef4444 40%, transparent)",borderRadius:"8px",padding:"1rem",marginBottom:"1rem"},children:c.jsxs("p",{style:{margin:0,color:"#fca5a5",fontWeight:500,fontSize:"0.95rem"},children:[" This will permanently delete ",bo[r-1]," ",n,"!"]})}),c.jsx("p",{style:{margin:"0 0 0.75rem",opacity:.9},children:"This month document and all its data (income, expenses, allocations) will be permanently deleted."}),c.jsx("p",{style:{margin:"0 0 1rem",opacity:.8,fontSize:"0.9rem"},children:"After deletion, you will be navigated to the previous month."}),c.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[c.jsx(De,{variant:"secondary",actionName:"Cancel Delete Month",onClick:e,disabled:a,children:"Cancel"}),c.jsx(De,{variant:"danger",actionName:"Confirm Delete Month",onClick:o,disabled:a,children:a?"Deleting...":" Delete Month"})]})]})}function nz(){const t=new Date;let e=t.getFullYear(),n=t.getMonth()+1+Nu;for(;n>12;)n-=12,e+=1;return{year:e,month:n}}function rz(){const t=new Date;let e=t.getFullYear(),n=t.getMonth()+1-Df;for(;n<1;)n+=12,e-=1;return{year:e,month:n}}function sz(t){return Object.keys(t).sort()[0]}function iz(t){const e=parseInt(t.slice(0,4),10),n=parseInt(t.slice(4,6),10);return{year:e,month:n}}function az(t){const e=rz(),n=sz(t);if(!n)return e;const r=At(e.year,e.month);return n<r?iz(n):e}function kw(t,e){return e===1?{year:t-1,month:12}:{year:t,month:e-1}}function oz(t,e){return e===12?{year:t+1,month:1}:{year:t,month:e+1}}function lz({onPreviousMonth:t,onNextMonth:e}){const{isLoading:n}=ir(),{currentYear:r,currentMonthNumber:a,isAdmin:o,selectedBudgetId:u,setCurrentYear:h,setCurrentMonthNumber:f}=zt(),{budget:m,monthMap:g}=kn(),{month:_}=_i(u,r,a),v=kw(r,a),S=oz(r,a),x=az(g),E=nz(),C=Number(At(x.year,x.month)),I=Number(At(E.year,E.month)),j=Number(At(v.year,v.month)),M=Number(At(S.year,S.month)),Q=j<C,q=M>I,[G,D]=T.useState(!1),[A,N]=T.useState(!1),[L,P]=T.useState(r),[B,O]=T.useState(a),[K,Y]=T.useState(!1),[z,V]=T.useState(!1),W=T.useRef(null),ee=(()=>{if(!g||Object.keys(g).length===0)return!1;const se=At(r,a),Z=Math.max(...Object.keys(g).map(Number));return Number(se)===Z})();async function ie(){if(u){V(!0);try{const se=yr(u,r,a);await Ou("months",se,`deleting month ${r}/${a}`),`${r}${a}`,Ve.removeQueries({queryKey:xe.month(u,r,a)}),Ve.invalidateQueries({queryKey:xe.budget(u)}),localStorage.removeItem("BUDGET_APP_QUERY_CACHE");const Z=kw(r,a);Y(!1),D(!1),window.location.href=`/budget/${Z.year}/${Z.month}/categories`}catch(se){console.error("Failed to delete month:",se),alert(`Failed to delete month: ${se instanceof Error?se.message:"Unknown error"}`)}finally{V(!1)}}}T.useEffect(()=>{if(!G)return;function se(Z){W.current&&!W.current.contains(Z.target)&&(D(!1),N(!1))}return document.addEventListener("mousedown",se),()=>document.removeEventListener("mousedown",se)},[G]);function U(){A||(P(r),O(a)),N(!A)}function H(){h(L),f(B),N(!1),D(!1)}function ne(){if(!_||!m)return;const se={..._,_meta:{downloaded_at:new Date().toISOString(),budget_id:m.id,budget_name:m.name}},Z=new Blob([JSON.stringify(se,null,2)],{type:"application/json"}),le=URL.createObjectURL(Z),pe=document.createElement("a");pe.href=le,pe.download=`month_${r}_${String(a).padStart(2,"0")}.json`,document.body.appendChild(pe),pe.click(),document.body.removeChild(pe),URL.revokeObjectURL(le),D(!1)}return c.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"1rem",marginBottom:"1.5rem",padding:"1rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"12px"},children:[c.jsx(Mw,{direction:"prev",isDisabled:Q,isLoading:n,disabledReason:"Cannot create months more than 3 months into the past",onNavigate:t}),c.jsxs("div",{ref:W,style:{textAlign:"center",minWidth:"180px",position:"relative"},children:[c.jsxs("div",{style:{display:"flex",alignItems:"flex-start",justifyContent:"center",gap:"0.25rem"},children:[c.jsxs("h2",{style:{margin:0,fontSize:"1.5rem"},children:[bo[a-1]," ",r]}),c.jsx("button",{onClick:()=>D(!G),style:{background:"transparent",border:"none",cursor:"pointer",fontSize:"0.5rem",opacity:.4,padding:"0.15rem",borderRadius:"4px",transition:"opacity 0.15s, transform 0.15s",transform:G?"rotate(180deg)":"rotate(0deg)",marginTop:"0.25rem"},title:"Month options",children:""})]}),n&&c.jsxs(c.Fragment,{children:[c.jsx("style",{children:"@keyframes spin { to { transform: rotate(360deg); } }"}),c.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0.4rem",marginTop:"0.35rem"},children:[c.jsx("span",{style:{display:"inline-block",width:"14px",height:"14px",border:"2px solid color-mix(in srgb, currentColor 20%, transparent)",borderTopColor:ae.primary,borderRadius:"50%",animation:"spin 0.8s linear infinite"}}),c.jsx("span",{style:{fontSize:"0.8rem",opacity:.6},children:"Loading..."})]})]}),G&&c.jsxs("div",{style:{position:"absolute",top:"100%",left:"50%",transform:"translateX(-50%)",marginTop:"0.5rem",background:"var(--background, #242424)",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",borderRadius:"8px",padding:"0.25rem",zIndex:100,minWidth:"160px",boxShadow:"0 4px 12px rgba(0,0,0,0.3)"},children:[c.jsx(z0,{isDisabled:n,onCloseMenu:()=>D(!1)}),c.jsx("button",{onClick:U,style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%",background:"transparent",border:"none",borderRadius:"6px",padding:"0.5rem 0.75rem",cursor:"pointer",fontSize:"0.85rem",color:"inherit",textAlign:"left",transition:"background 0.15s"},title:"Jump to a specific month",children:" Go to Month"}),A&&c.jsx(ez,{pickerYear:L,pickerMonth:B,currentYear:r,currentMonthNumber:a,minOrdinal:C,maxOrdinal:I,minAllowed:x,maxAllowed:E,onYearChange:P,onMonthChange:O,onGo:H}),o&&_&&c.jsx("button",{onClick:()=>{ne()},style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%",background:"transparent",border:"none",borderRadius:"6px",padding:"0.5rem 0.75rem",cursor:"pointer",fontSize:"0.85rem",color:"inherit",textAlign:"left",transition:"background 0.15s"},title:"Download month document as JSON (for debugging)",children:" Download JSON"}),o&&_&&ee&&c.jsx("button",{onClick:()=>Y(!0),style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%",background:"transparent",border:"none",borderRadius:"6px",padding:"0.5rem 0.75rem",cursor:"pointer",fontSize:"0.85rem",color:"#ef4444",textAlign:"left",transition:"background 0.15s"},title:"Delete this month (last month only)",children:" Delete Month"})]})]}),c.jsx(Mw,{direction:"next",isDisabled:q,isLoading:n,disabledReason:"Cannot create months more than 3 months into the future",onNavigate:e}),c.jsx(tz,{isOpen:K,onClose:()=>Y(!1),year:r,month:a,isDeleting:z,onConfirm:ie})]})}const U0={cursor:"pointer",fontSize:"0.9rem",padding:"0.35rem 0.5rem",borderRadius:"4px"},cz={...U0,background:ae.primary,border:"none",color:"white"},uz={...U0,background:"transparent",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)"},dz={...U0,background:"transparent",border:`1px solid ${ae.errorBorder}`,color:ae.error},Ow=t=>({display:"flex",alignItems:"center",justifyContent:"center",width:"2.25rem",height:"100%",minHeight:"2.25rem",background:t?`color-mix(in srgb, ${ae.error} 15%, transparent)`:`color-mix(in srgb, ${ae.success} 15%, transparent)`,border:`1px solid ${t?ae.errorBorder:"rgba(74, 222, 128, 0.4)"}`,borderRadius:"4px 0 0 4px",cursor:"pointer",fontSize:"1rem",fontWeight:600,color:t?ae.error:ae.success,transition:"all 0.15s ease",flexShrink:0});function F0({accounts:t,accountGroups:e,categories:n,categoryGroups:r,payees:a,initialData:o,defaultAccountId:u,defaultDate:h,config:f,onSubmit:m,onCancel:g,onDelete:_,extraContent:v}){const{isWide:S}=fT(),{showCategory:x=!1,showCleared:E=!1,showSignToggle:C=!1,accountLabel:I="Account",payeePlaceholder:j="Payee name",descriptionPlaceholder:M="Optional note",submitLabel:Q}=f,q=new Date().toISOString().split("T")[0],[G,D]=T.useState(o?.date||h||q),[A,N]=T.useState(o?.payee||""),[L,P]=T.useState(o?.categoryId||(f.showNoCategoryOption?Ut:"")),[B,O]=T.useState(o?.accountId||u||(f.showNoAccountOption?Bt:t[0]?t[0][0]:"")),K=o?.amount!==void 0?Math.abs(o.amount):void 0,[Y,z]=T.useState(K?.toString()||""),[V,W]=T.useState(o?.description||""),[ee,ie]=T.useState(o?.cleared||!1),[U,H]=T.useState(()=>C?o?.amount!==void 0?o.amount<0:!1:!0),[ne,se]=T.useState(!1),Z={},le=[];t.forEach(([je,Ye])=>{Ye.account_group_id?(Z[Ye.account_group_id]||(Z[Ye.account_group_id]=[]),Z[Ye.account_group_id].push([je,Ye])):le.push([je,Ye])});function pe(je){je.preventDefault();const Ye=parseFloat(Y);if(isNaN(Ye)||Ye<=0||x&&!L||!B||!G)return;if(L===Ut&&B===Bt){se(!0);return}se(!1);const zr=C&&U?-Ye:Ye;m({date:G,payee:A.trim()||void 0,categoryId:x?L:void 0,accountId:B,amount:zr,description:V.trim()||void 0,cleared:E?ee:void 0})}!(L===Ut&&B===Bt)&&ne&&se(!1);const Se=f.showNoAccountOption?c.jsx(WT,{id:"txn-account",value:B,onChange:O,accounts:t,accountGroups:e,placeholder:Bs,required:!0,showNoAccountOption:!0}):c.jsxs(Bu,{id:"txn-account",value:B,onChange:je=>O(je.target.value),required:!0,style:{fontSize:"0.85rem",padding:"0.5rem"},children:[Object.entries(e).map(([je,Ye])=>{const bi=Z[je];return bi?.length?c.jsx("optgroup",{label:Ye.name,children:bi.map(([dn,zr])=>c.jsx("option",{value:dn,children:zr.nickname},dn))},je):null}),le.length>0&&c.jsx("optgroup",{label:"Other",children:le.map(([je,Ye])=>c.jsx("option",{value:je,children:Ye.nickname},je))})]}),Ae=x&&n&&r?c.jsx(Ct,{label:"Category",htmlFor:"txn-category",children:c.jsx(QT,{id:"txn-category",value:L,onChange:P,categories:n,categoryGroups:r,placeholder:f.showNoCategoryOption?va:"Search...",required:!0,showNoCategoryOption:f.showNoCategoryOption})}):null,ct=E?c.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.25rem",paddingBottom:"0.35rem"},children:[c.jsx("label",{htmlFor:"txn-cleared",style:{fontSize:"0.75rem",opacity:.7,fontWeight:500},children:"Clr"}),c.jsx(Pr,{id:"txn-cleared",checked:ee,onChange:je=>ie(je.target.checked)})]}):null,Me=c.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.25rem",paddingBottom:"0.1rem"},children:[c.jsx("span",{style:{fontSize:"0.75rem",opacity:.7,fontWeight:500},children:""}),c.jsxs("div",{style:{display:"flex",gap:"0.25rem"},children:[c.jsx("button",{type:"submit",title:Q,style:cz,children:""}),c.jsx("button",{type:"button",onClick:()=>{g()},title:"Cancel",style:uz,children:""}),_&&c.jsx("button",{type:"button",onClick:()=>{_()},title:"Delete",style:dz,children:""})]})]}),Oe=ne?c.jsx("div",{style:{background:`color-mix(in srgb, ${ae.error} 15%, transparent)`,border:`1px solid ${ae.errorBorder}`,borderRadius:"6px",padding:"0.5rem 0.75rem",fontSize:"0.85rem",color:ae.error},children:'Cannot select both "No Category" and "No Account"  at least one must be a real category or account.'}):null,ot=c.jsxs(Aa,{children:[c.jsx(De,{type:"submit",actionName:Q,children:Q}),c.jsx(De,{type:"button",variant:"secondary",actionName:"Cancel Transaction Form",onClick:g,children:"Cancel"}),_&&c.jsx(De,{type:"button",variant:"danger",actionName:"Delete Transaction",onClick:_,children:" Delete"})]}),Sn=x&&n&&r,Qn={fontSize:"0.85rem",padding:"0.5rem"};if(!S)return c.jsxs(pi,{actionName:Q,onSubmit:pe,children:[c.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:[c.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[c.jsx(Ct,{label:"Date",htmlFor:"txn-date",children:c.jsx(Nf,{id:"txn-date",value:G,onChange:je=>D(je.target.value),required:!0})}),c.jsx(Ct,{label:C?U?"Amount (Expense)":"Amount (Refund)":"Amount",htmlFor:"txn-amount",children:C?c.jsxs("div",{style:{display:"flex",alignItems:"stretch"},children:[c.jsx("button",{type:"button",onClick:()=>H(!U),style:Ow(U),title:U?"Click to make this a refund (+)":"Click to make this an expense (-)",children:U?"":"+"}),c.jsx("div",{style:{flex:1},children:c.jsx(co,{id:"txn-amount",value:Y,onChange:z,placeholder:"$0.00",required:!0,autoFocus:!0,style:{borderTopLeftRadius:0,borderBottomLeftRadius:0,borderLeft:"none",color:U?ae.error:ae.success}})})]}):c.jsx(co,{id:"txn-amount",value:Y,onChange:z,placeholder:"$0.00",required:!0,autoFocus:!0})})]}),c.jsx(Ct,{label:"Payee",htmlFor:"txn-payee",children:c.jsx(Rw,{id:"txn-payee",value:A,onChange:N,payees:a,placeholder:j})}),Ae,c.jsx(Ct,{label:I,htmlFor:"txn-account",children:Se}),c.jsx(Ct,{label:"Description (optional)",htmlFor:"txn-description",children:c.jsx(gi,{id:"txn-description",value:V,onChange:je=>W(je.target.value),placeholder:M})}),E&&c.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[c.jsx(Pr,{id:"txn-cleared-stacked",checked:ee,onChange:je=>ie(je.target.checked)}),c.jsx("label",{htmlFor:"txn-cleared-stacked",style:{fontSize:"0.9rem",cursor:"pointer"},children:"Cleared (appeared in bank account)"})]}),Oe,v]}),ot]});const mt=C?"8.25rem":"6rem",Dt=Sn?E?`6rem minmax(8rem, 1fr) minmax(8rem, 1fr) minmax(8rem, 1fr) ${mt} minmax(10rem, 2fr) auto auto`:`6rem minmax(8rem, 1fr) minmax(8rem, 1fr) minmax(8rem, 1fr) ${mt} minmax(10rem, 2fr) auto`:E?`6rem minmax(10rem, 1fr) minmax(10rem, 1fr) ${mt} minmax(12rem, 2fr) auto auto`:`6rem minmax(10rem, 1fr) minmax(10rem, 1fr) ${mt} minmax(12rem, 2fr) auto`;return c.jsxs(pi,{actionName:Q,onSubmit:pe,children:[c.jsxs("div",{style:{display:"grid",gridTemplateColumns:Dt,gap:"1rem",alignItems:"end"},children:[c.jsx(Ct,{label:"Date",htmlFor:"txn-date",children:c.jsx(Nf,{id:"txn-date",value:G,onChange:je=>D(je.target.value),required:!0,style:Qn})}),c.jsx(Ct,{label:"Payee",htmlFor:"txn-payee",children:c.jsx(Rw,{id:"txn-payee",value:A,onChange:N,payees:a,placeholder:j})}),Ae,c.jsx(Ct,{label:I,htmlFor:"txn-account",children:Se}),c.jsx(Ct,{label:C?U?"Amount ()":"Amount (+)":"Amount",htmlFor:"txn-amount",children:C?c.jsxs("div",{style:{display:"flex",alignItems:"stretch"},children:[c.jsx("button",{type:"button",onClick:()=>H(!U),style:Ow(U),title:U?"Click to make this a refund (+)":"Click to make this an expense (-)",children:U?"":"+"}),c.jsx("div",{style:{flex:1},children:c.jsx(co,{id:"txn-amount",value:Y,onChange:z,placeholder:"$0.00",required:!0,autoFocus:!0,style:{borderTopLeftRadius:0,borderBottomLeftRadius:0,borderLeft:"none",color:U?ae.error:ae.success}})})]}):c.jsx(co,{id:"txn-amount",value:Y,onChange:z,placeholder:"$0.00",required:!0,autoFocus:!0})}),c.jsx(Ct,{label:"Description",htmlFor:"txn-description",children:c.jsx(gi,{id:"txn-description",value:V,onChange:je=>W(je.target.value),placeholder:M,style:Qn})}),ct,Me]}),Oe,v]})}function Nw({accounts:t,accountGroups:e,payees:n,initialData:r,defaultAccountId:a,defaultDate:o,onSubmit:u,onCancel:h,onDelete:f,submitLabel:m}){function g(_){u(_.amount,_.accountId,_.date,_.payee,_.description)}return c.jsx(F0,{accounts:t,accountGroups:e,payees:n,initialData:r?{date:r.date,payee:r.payee,accountId:r.account_id,amount:r.amount,description:r.description}:void 0,defaultAccountId:a,defaultDate:o,config:{showCategory:!1,showCleared:!1,accountLabel:"Deposit To",payeePlaceholder:"e.g., Employer, Client name",descriptionPlaceholder:"e.g., January paycheck",submitLabel:m},onSubmit:g,onCancel:h,onDelete:f})}function hz({income:t,accountName:e,accountGroupName:n,onEdit:r,onDelete:a,isMobile:o,isEvenRow:u}){const h=t.date?new Date(t.date+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"}):"",f=n?`${n} / ${e}`:e,m=u?"transparent":"rgba(255,255,255,0.04)";if(o)return c.jsxs("div",{onClick:r,style:{gridColumn:"1 / -1",display:"grid",gridTemplateColumns:"1fr auto",gap:"0.5rem",padding:"0.75rem 1rem",background:m,cursor:"pointer",transition:"background 0.15s"},children:[c.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[c.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[c.jsx("span",{style:{fontSize:"0.75rem",opacity:.5,fontFamily:"monospace",minWidth:"3rem"},children:h}),c.jsx("span",{style:{fontWeight:500,fontSize:"0.9rem"},children:t.payee||""})]}),c.jsxs("span",{style:{fontSize:"0.75rem",opacity:.6},children:[" ",f]})]}),c.jsx("div",{style:{display:"flex",alignItems:"center"},children:c.jsxs("span",{style:{fontWeight:600,color:ae.success,fontFamily:"monospace"},children:["+",$e(t.amount)]})})]});const g={padding:"0.6rem 0.5rem",background:m,display:"flex",alignItems:"center",fontSize:"0.9rem"};return c.jsxs("div",{style:{display:"contents"},children:[c.jsx("div",{style:{...g,fontSize:"0.85rem",fontFamily:"monospace"},children:c.jsx("span",{style:{opacity:.6},children:h})}),c.jsx("div",{style:{...g,fontWeight:500,overflow:"hidden"},children:c.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.payee||""})}),c.jsx("div",{style:{...g,overflow:"hidden"},children:c.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.85rem",opacity:.7},children:f})}),c.jsxs("div",{style:{...g,justifyContent:"flex-end",fontWeight:600,color:ae.success,fontFamily:"monospace"},children:["+",$e(t.amount)]}),c.jsx("div",{style:{...g,paddingLeft:"0.5rem",overflow:"hidden"},children:c.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.8rem",opacity:.6},children:t.description||""})}),c.jsxs("div",{style:{...g,justifyContent:"flex-end",gap:"0.25rem"},children:[c.jsx("button",{onClick:r,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:_=>_.currentTarget.style.opacity="1",onMouseLeave:_=>_.currentTarget.style.opacity="0.5",title:"Edit",children:""}),c.jsx("button",{onClick:a,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:_=>_.currentTarget.style.opacity="1",onMouseLeave:_=>_.currentTarget.style.opacity="0.5",title:"Delete",children:""})]})]})}const gl={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderTop:"1px solid rgba(255,255,255,0.1)"};function fz(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n,setCurrentYear:r,setCurrentMonthNumber:a}=zt(),{accounts:o,accountGroups:u}=kn(),{month:h,isLoading:f,addIncome:m,updateIncome:g,deleteIncome:_}=_i(t,e,n),v=zs(),[S,x]=T.useState(null),[E,C]=T.useState(!1),[I,j]=T.useState(null),q=iT(t,{enabled:E||I!==null}).data||[];function G(V){const W=V.account_group_id?u[V.account_group_id]:void 0;return W?.is_active!==void 0?W.is_active:V.is_active!==!1}function D(V){const W=V.account_group_id?u[V.account_group_id]:void 0;return W?.on_budget!==void 0?W.on_budget:V.on_budget!==!1}const A=Object.entries(o).filter(([,V])=>G(V)&&D(V)),N=A.filter(([,V])=>V.is_income_account),L=N.length>0?N:A,P=A.find(([,V])=>V.is_income_default),B=P?P[0]:void 0,O=h?.income.reduce((V,W)=>V+W.amount,0)||0;function K(V,W,ee,ie,U){x(null),C(!1);const[H,ne]=ee.split("-").map(Number);m(V,W,ee,ie,U).then(()=>{(H!==e||ne!==n)&&(r(H),a(ne))}).catch(se=>{x(se instanceof Error?se.message:"Failed to add income")})}function Y(V,W,ee,ie,U,H){x(null),j(null),g(V,W,ee,ie,U,H).catch(ne=>{x(ne instanceof Error?ne.message:"Failed to update income")})}function z(V){confirm("Are you sure you want to delete this income entry?")&&(x(null),_(V).catch(W=>{x(W instanceof Error?W.message:"Failed to delete income")}))}return c.jsxs("div",{style:{opacity:f?.5:1,transition:"opacity 0.15s ease-out",pointerEvents:f?"none":"auto"},children:[S&&c.jsx("div",{style:{background:`color-mix(in srgb, ${ae.error} 15%, transparent)`,border:`1px solid ${ae.error}`,borderRadius:"8px",padding:"0.75rem",marginBottom:"1rem",color:ae.error},children:S}),c.jsxs("div",{style:{display:"grid",gridTemplateColumns:v?"1fr":"5rem 1.5fr 2fr 7rem 1.5fr 3rem"},children:[c.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"#242424",borderBottom:"1px solid rgba(255,255,255,0.15)",display:v?"block":"grid",gridTemplateColumns:v?void 0:"subgrid"},children:[c.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem"},children:[c.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[c.jsx("span",{style:{fontWeight:600},children:"Income:"}),c.jsx("span",{style:{opacity:.6,fontSize:"0.8rem"},children:"Incoming money that should be factored into income calculations"}),c.jsxs("span",{children:[c.jsx("span",{style:{opacity:.6},children:"Total: "}),c.jsx("span",{style:{color:jt(O),fontWeight:600},children:$e(O)})]})]}),c.jsx("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:!E&&c.jsx(De,{actionName:"Open Add Income Form",onClick:()=>C(!0),disabled:L.length===0,style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:"+ Add Income"})})]}),!v&&c.jsxs(c.Fragment,{children:[c.jsx("div",{style:gl,children:"Date"}),c.jsx("div",{style:gl,children:"Payee"}),c.jsx("div",{style:gl,children:"Account"}),c.jsx("div",{style:{...gl,textAlign:"right"},children:"Amount"}),c.jsx("div",{style:gl,children:"Description"}),c.jsx("div",{style:gl})]})]}),c.jsx("div",{style:{gridColumn:"1 / -1",fontSize:"0.8rem",opacity:.55,fontStyle:"italic",padding:"0.5rem 0"},children:" All income entries on this page count towards the tithing owed calculation."}),L.length===0&&c.jsxs("p",{style:{gridColumn:"1 / -1",opacity:.6,fontSize:"0.9rem",padding:"1rem 0"},children:[Object.keys(o).length===0?"You need to create at least one account before adding income.":'No accounts are set up for income deposits. Edit an account and enable "Show in income deposit list".'," ",c.jsx(Ft,{to:"/budget/accounts",style:{opacity:1},children:"Manage accounts "})]}),E&&c.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"1rem"},children:c.jsx(Nw,{accounts:L,accountGroups:u,payees:q,defaultAccountId:B,defaultDate:`${e}-${String(n).padStart(2,"0")}-01`,onSubmit:K,onCancel:()=>C(!1),submitLabel:"Add Income",isMobile:v})}),h?.income.slice().sort((V,W)=>(V.date||"").localeCompare(W.date||"")).map((V,W)=>I===V.id?c.jsx("div",{style:{gridColumn:"1 / -1",padding:"0.5rem"},children:c.jsx(Nw,{accounts:L,accountGroups:u,payees:q,initialData:V,onSubmit:(ee,ie,U,H,ne)=>Y(V.id,ee,ie,U,H,ne),onCancel:()=>j(null),onDelete:()=>z(V.id),submitLabel:"Save",isMobile:v})},V.id):c.jsx(hz,{income:V,accountName:Be(V.account_id)?Bs:o[V.account_id]?.nickname||"Unknown Account",accountGroupName:Be(V.account_id)?void 0:o[V.account_id]?.account_group_id?u[o[V.account_id].account_group_id]?.name:void 0,onEdit:()=>{V.payee||`${V.amount}`,j(V.id)},onDelete:()=>z(V.id),isMobile:v,isEvenRow:W%2===0},V.id)),(!h?.income||h.income.length===0)&&!E&&c.jsx("p",{style:{gridColumn:"1 / -1",opacity:.5,fontSize:"0.9rem",textAlign:"center",padding:"1.5rem"},children:"No income recorded for this month"}),c.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]})]})}function Pw({accounts:t,accountGroups:e,categories:n,categoryGroups:r,payees:a,initialData:o,defaultAccountId:u,defaultDate:h,onSubmit:f,onCancel:m,onDelete:g,submitLabel:_}){function v(S){f(S.amount,S.categoryId,S.accountId,S.date,S.payee,S.description,S.cleared)}return c.jsx(F0,{accounts:t,accountGroups:e,categories:n,categoryGroups:r,payees:a,initialData:o?{date:o.date,payee:o.payee,categoryId:o.category_id,accountId:o.account_id,amount:o.amount,description:o.description,cleared:o.cleared}:void 0,defaultAccountId:u,defaultDate:h,config:{showCategory:!0,showCleared:!0,showNoCategoryOption:!1,showNoAccountOption:!1,showSignToggle:!0,accountLabel:"Pay From",payeePlaceholder:"e.g., Grocery Store",descriptionPlaceholder:"e.g., Weekly groceries",submitLabel:_},onSubmit:v,onCancel:m,onDelete:g})}function mz({expense:t,categoryName:e,accountName:n,accountGroupName:r,onEdit:a,onDelete:o,isMobile:u,isEvenRow:h}){const f=t.date?new Date(t.date+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"}):"",m=r?`${r} / ${n}`:n,g=h?"transparent":"rgba(255,255,255,0.04)";if(u)return c.jsxs("div",{onClick:a,style:{gridColumn:"1 / -1",display:"grid",gridTemplateColumns:"1fr auto",gap:"0.5rem",padding:"0.75rem 1rem",background:g,cursor:"pointer",transition:"background 0.15s"},children:[c.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[c.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[c.jsx("span",{style:{fontSize:"0.75rem",opacity:.5,fontFamily:"monospace",minWidth:"3rem"},children:f}),c.jsx("span",{style:{fontWeight:500,fontSize:"0.9rem"},children:t.payee||""}),t.cleared&&c.jsx("span",{style:{fontSize:"0.7rem",color:ae.success},title:"Cleared",children:""})]}),c.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap"},children:[c.jsx("span",{style:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px"},children:e}),c.jsxs("span",{style:{fontSize:"0.75rem",opacity:.6},children:[" ",m]})]})]}),c.jsx("div",{style:{display:"flex",alignItems:"center"},children:c.jsx("span",{style:{fontWeight:600,color:jt(t.amount),fontFamily:"monospace"},children:_r(t.amount)})})]});const _={padding:"0.6rem 0.5rem",background:g,display:"flex",alignItems:"center",fontSize:"0.9rem"};return c.jsxs("div",{style:{display:"contents"},children:[c.jsx("div",{style:{..._,fontSize:"0.85rem",fontFamily:"monospace"},children:c.jsx("span",{style:{opacity:.6},children:f})}),c.jsx("div",{style:{..._,fontWeight:500,overflow:"hidden"},children:c.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.payee||""})}),c.jsx("div",{style:{..._,justifyContent:"center"},children:c.jsx("span",{style:{fontSize:"0.8rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e})}),c.jsx("div",{style:{..._,overflow:"hidden"},children:c.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.85rem",opacity:.7},children:m})}),c.jsx("div",{style:{..._,justifyContent:"flex-end",fontWeight:600,color:jt(t.amount),fontFamily:"monospace"},children:_r(t.amount)}),c.jsx("div",{style:{..._,paddingLeft:"0.5rem",overflow:"hidden"},children:c.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.8rem",opacity:.6},children:t.description||""})}),c.jsx("div",{style:{..._,justifyContent:"center",color:t.cleared?ae.success:"inherit",opacity:t.cleared?1:.3,fontSize:"1rem"},children:t.cleared?"":""}),c.jsxs("div",{style:{..._,justifyContent:"flex-end",gap:"0.25rem"},children:[c.jsx("button",{onClick:a,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:v=>v.currentTarget.style.opacity="1",onMouseLeave:v=>v.currentTarget.style.opacity="0.5",title:"Edit",children:""}),c.jsx("button",{onClick:o,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:v=>v.currentTarget.style.opacity="1",onMouseLeave:v=>v.currentTarget.style.opacity="0.5",title:"Delete",children:""})]})]})}const Zi={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderTop:"1px solid rgba(255,255,255,0.1)"};function pz(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n,setCurrentYear:r,setCurrentMonthNumber:a}=zt(),{accounts:o,accountGroups:u,categories:h,categoryGroups:f}=kn(),{month:m,isLoading:g,addExpense:_,updateExpense:v,deleteExpense:S}=_i(t,e,n),x=zs(),[E,C]=T.useState(null),[I,j]=T.useState(!1),[M,Q]=T.useState(null),D=iT(t,{enabled:I||M!==null}).data||[];function A(ee){const ie=ee.account_group_id?u[ee.account_group_id]:void 0;return ie?.is_active!==void 0?ie.is_active:ee.is_active!==!1}function N(ee){const ie=ee.account_group_id?u[ee.account_group_id]:void 0;return ie?.on_budget!==void 0?ie.on_budget:ee.on_budget!==!1}const L=Object.entries(o).filter(([,ee])=>A(ee)&&N(ee)),P=L.filter(([,ee])=>ee.is_outgo_account),B=P.length>0?P:L,O=L.find(([,ee])=>ee.is_outgo_default),K=O?O[0]:void 0,Y=m?.expenses?.reduce((ee,ie)=>ee+ie.amount,0)||0;function z(ee,ie,U,H,ne,se,Z){C(null),j(!1);const[le,pe]=H.split("-").map(Number);_(ee,ie,U,H,ne,se,Z).then(()=>{(le!==e||pe!==n)&&(r(le),a(pe))}).catch(Ee=>{C(Ee instanceof Error?Ee.message:"Failed to add expense")})}function V(ee,ie,U,H,ne,se,Z,le){C(null),Q(null),v(ee,ie,U,H,ne,se,Z,le).catch(pe=>{C(pe instanceof Error?pe.message:"Failed to update expense")})}function W(ee){confirm("Are you sure you want to delete this expense?")&&(C(null),S(ee).catch(ie=>{C(ie instanceof Error?ie.message:"Failed to delete expense")}))}return c.jsxs("div",{style:{opacity:g?.5:1,transition:"opacity 0.15s ease-out",pointerEvents:g?"none":"auto"},children:[E&&c.jsx("div",{style:{background:`color-mix(in srgb, ${ae.error} 15%, transparent)`,border:`1px solid ${ae.error}`,borderRadius:"8px",padding:"0.75rem",marginBottom:"1rem",color:ae.error},children:E}),c.jsxs("div",{style:{display:"grid",gridTemplateColumns:x?"1fr":"5rem 1.5fr 7rem 1fr 6rem 1fr 3rem 4rem"},children:[c.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"#242424",borderBottom:"1px solid rgba(255,255,255,0.15)",display:x?"block":"grid",gridTemplateColumns:x?void 0:"subgrid"},children:[c.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem"},children:[c.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[c.jsx("span",{style:{fontWeight:600},children:"Expenses:"}),c.jsx("span",{style:{opacity:.6,fontSize:"0.8rem"},children:"Transactions that should be factored into spend calculations"}),c.jsxs("span",{children:[c.jsx("span",{style:{opacity:.6},children:"Total: "}),c.jsx("span",{style:{color:jt(Y),fontWeight:600},children:_r(Y)})]})]}),c.jsx("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:!I&&c.jsx(De,{actionName:"Open Add Expense Form",onClick:()=>j(!0),disabled:B.length===0||Object.keys(h).length===0,style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:"+ Add Expense"})})]}),!x&&c.jsxs(c.Fragment,{children:[c.jsx("div",{style:Zi,children:"Date"}),c.jsx("div",{style:Zi,children:"Payee"}),c.jsx("div",{style:{...Zi,textAlign:"center"},children:"Category"}),c.jsx("div",{style:Zi,children:"Account"}),c.jsx("div",{style:{...Zi,textAlign:"right"},children:"Amount"}),c.jsx("div",{style:Zi,children:"Description"}),c.jsx("div",{style:{...Zi,textAlign:"center"},children:"Clr"}),c.jsx("div",{style:Zi})]})]}),B.length===0&&c.jsxs("p",{style:{gridColumn:"1 / -1",opacity:.6,fontSize:"0.9rem",padding:"1rem 0"},children:[Object.keys(o).length===0?"You need to create at least one account before adding expenses.":'No accounts are set up for expenses. Edit an account and enable "Show in expense list".'," ",c.jsx(Ft,{to:"/budget/accounts",style:{opacity:1},children:"Manage accounts "})]}),Object.keys(h).length===0&&c.jsxs("p",{style:{gridColumn:"1 / -1",opacity:.6,fontSize:"0.9rem",padding:"1rem 0"},children:["You need to create at least one category before adding expenses."," ",c.jsx(Ft,{to:"/budget/settings/categories",style:{opacity:1},children:"Create categories "})]}),I&&c.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"1rem"},children:c.jsx(Pw,{accounts:B,accountGroups:u,categories:h,categoryGroups:f,payees:D,defaultAccountId:K,defaultDate:`${e}-${String(n).padStart(2,"0")}-01`,onSubmit:z,onCancel:()=>j(!1),submitLabel:"Add Expense",isMobile:x})}),m?.expenses?.slice().sort((ee,ie)=>(ee.date||"").localeCompare(ie.date||"")).map((ee,ie)=>M===ee.id?c.jsx("div",{style:{gridColumn:"1 / -1",padding:"0.5rem"},children:c.jsx(Pw,{accounts:B,accountGroups:u,categories:h,categoryGroups:f,payees:D,initialData:ee,onSubmit:(U,H,ne,se,Z,le,pe)=>V(ee.id,U,H,ne,se,Z,le,pe),onCancel:()=>Q(null),onDelete:()=>W(ee.id),submitLabel:"Save",isMobile:x})},ee.id):c.jsx(mz,{expense:ee,categoryName:et(ee.category_id)?va:h[ee.category_id]?.name||"Unknown Category",accountName:Be(ee.account_id)?Bs:o[ee.account_id]?.nickname||"Unknown Account",accountGroupName:Be(ee.account_id)?void 0:o[ee.account_id]?.account_group_id?u[o[ee.account_id].account_group_id]?.name:void 0,onEdit:()=>{ee.payee||`${ee.amount}`,Q(ee.id)},onDelete:()=>W(ee.id),isMobile:x,isEvenRow:ie%2===0},ee.id)),(!m?.expenses||m.expenses.length===0)&&!I&&c.jsx("p",{style:{gridColumn:"1 / -1",opacity:.5,fontSize:"0.9rem",textAlign:"center",padding:"1.5rem"},children:"No expenses recorded for this month"}),c.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]})]})}const gz={background:ae.primary,border:"none",cursor:"pointer",fontSize:"0.9rem",padding:"0.35rem 0.5rem",borderRadius:"4px",color:"white"},yz={background:"transparent",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)",cursor:"pointer",fontSize:"0.9rem",padding:"0.35rem 0.5rem",borderRadius:"4px"},_z={background:"transparent",border:`1px solid ${ae.errorBorder}`,color:ae.error,cursor:"pointer",fontSize:"0.9rem",padding:"0.35rem 0.5rem",borderRadius:"4px"};function Bw({accounts:t,accountGroups:e,categories:n,categoryGroups:r,initialData:a,defaultDate:o,onSubmit:u,onCancel:h,onDelete:f,submitLabel:m}){const{isWide:g}=fT(),_=new Date().toISOString().split("T")[0],[v,S]=T.useState(a?.date||o||_),[x,E]=T.useState(a?.amount?.toString()||""),[C,I]=T.useState(a?.from_account_id||Bt),[j,M]=T.useState(a?.to_account_id||Bt),[Q,q]=T.useState(a?.from_category_id||Ut),[G,D]=T.useState(a?.to_category_id||Ut),[A,N]=T.useState(a?.description||""),[L,P]=T.useState(a?.cleared||!1),[B,O]=T.useState(!1),ie=Q===Ut&&G===Ut&&(C===Bt&&j===Bt);!ie&&B&&O(!1);function U(ge){ge.preventDefault();const J=parseFloat(x);if(!(isNaN(J)||J<=0)&&!(!C||!j||!Q||!G||!v)){if(ie){O(!0);return}O(!1),u(J,C,j,Q,G,v,A.trim()||void 0,L)}}const H=B?c.jsx("div",{style:{background:`color-mix(in srgb, ${ae.error} 15%, transparent)`,border:`1px solid ${ae.errorBorder}`,borderRadius:"6px",padding:"0.5rem 0.75rem",fontSize:"0.85rem",color:ae.error,marginTop:"0.5rem"},children:'A transfer must move between real categories or real accounts  not all "No" options.'}):null,ne=(ge,J,Se,Ae)=>c.jsx(Ct,{label:Ae,htmlFor:ge,children:c.jsx(WT,{id:ge,value:J,onChange:Se,accounts:t,accountGroups:e,placeholder:Bs,required:!0,showNoAccountOption:!0})}),se=(ge,J,Se,Ae)=>c.jsx(Ct,{label:Ae,htmlFor:ge,children:c.jsx(QT,{id:ge,value:J,onChange:Se,categories:n,categoryGroups:r,placeholder:va,required:!0,showNoCategoryOption:!0})}),Z=c.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.25rem",paddingBottom:"0.35rem"},children:[c.jsx("label",{htmlFor:"transfer-cleared",style:{fontSize:"0.75rem",opacity:.7,fontWeight:500},children:"Clr"}),c.jsx(Pr,{id:"transfer-cleared",checked:L,onChange:ge=>P(ge.target.checked)})]}),le=c.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.25rem",paddingBottom:"0.1rem"},children:[c.jsx("span",{style:{fontSize:"0.75rem",opacity:.7,fontWeight:500},children:""}),c.jsxs("div",{style:{display:"flex",gap:"0.25rem"},children:[c.jsx("button",{type:"submit",title:m,style:gz,children:""}),c.jsx("button",{type:"button",onClick:()=>{h()},title:"Cancel",style:yz,children:""}),f&&c.jsx("button",{type:"button",onClick:()=>{f()},title:"Delete",style:_z,children:""})]})]}),pe=c.jsxs(Aa,{children:[c.jsx(De,{type:"submit",actionName:m,children:m}),c.jsx(De,{type:"button",variant:"secondary",actionName:"Cancel Transfer Form",onClick:h,children:"Cancel"}),f&&c.jsx(De,{type:"button",variant:"danger",actionName:"Delete Transfer",onClick:f,children:" Delete"})]}),Ee={fontSize:"0.85rem",padding:"0.5rem"};return g?c.jsx(pi,{actionName:m,onSubmit:U,children:c.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[c.jsxs("div",{style:{display:"grid",gridTemplateColumns:"5.5rem 5.5rem 1fr 1fr 1.5fr",gap:"0.75rem",alignItems:"end"},children:[c.jsx(Ct,{label:"Date",htmlFor:"transfer-date",children:c.jsx(Nf,{id:"transfer-date",value:v,onChange:ge=>S(ge.target.value),required:!0,style:Ee})}),c.jsx(Ct,{label:"Amount",htmlFor:"transfer-amount",children:c.jsx(co,{id:"transfer-amount",value:x,onChange:E,placeholder:"$0.00",required:!0,autoFocus:!0})}),se("from-category",Q,q,"From Category"),ne("from-account",C,I,"From Account"),c.jsx(Ct,{label:"Description",htmlFor:"transfer-description",children:c.jsx(gi,{id:"transfer-description",value:A,onChange:ge=>N(ge.target.value),placeholder:"e.g., Transfer",style:Ee})})]}),c.jsxs("div",{style:{display:"grid",gridTemplateColumns:"5.5rem 5.5rem 1fr 1fr 1.5fr",gap:"0.75rem",alignItems:"end"},children:[c.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1.2rem",opacity:.5,paddingBottom:"0.5rem"},children:""}),c.jsx("div",{}),se("to-category",G,D,"To Category"),ne("to-account",j,M,"To Account"),c.jsxs("div",{style:{display:"flex",gap:"0.75rem",alignItems:"end",paddingBottom:"0.25rem"},children:[Z,le]})]}),H]})}):c.jsxs(pi,{actionName:m,onSubmit:U,children:[c.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:[c.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[c.jsx(Ct,{label:"Date",htmlFor:"transfer-date",children:c.jsx(Nf,{id:"transfer-date",value:v,onChange:ge=>S(ge.target.value),required:!0})}),c.jsx(Ct,{label:"Amount",htmlFor:"transfer-amount",children:c.jsx(co,{id:"transfer-amount",value:x,onChange:E,placeholder:"$0.00",required:!0,autoFocus:!0})})]}),c.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem",background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1rem",borderRadius:"8px"},children:[c.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"0.75rem",alignItems:"end"},children:[se("from-category",Q,q,"From Cat."),ne("from-account",C,I,"From Acct.")]}),c.jsx("div",{style:{display:"flex",justifyContent:"center",fontSize:"1.5rem",opacity:.5},children:""}),c.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"0.75rem",alignItems:"end"},children:[se("to-category",G,D,"To Cat."),ne("to-account",j,M,"To Acct.")]})]}),c.jsx(Ct,{label:"Description (optional)",htmlFor:"transfer-description",children:c.jsx(gi,{id:"transfer-description",value:A,onChange:ge=>N(ge.target.value),placeholder:"e.g., Transfer to savings"})}),c.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[c.jsx(Pr,{id:"transfer-cleared-stacked",checked:L,onChange:ge=>P(ge.target.checked)}),c.jsx("label",{htmlFor:"transfer-cleared-stacked",style:{fontSize:"0.9rem",cursor:"pointer"},children:"Cleared (appeared in bank account)"})]}),H]}),pe]})}function bz({transfer:t,fromCategoryName:e,toCategoryName:n,fromAccountName:r,toAccountName:a,fromAccountGroupName:o,toAccountGroupName:u,isFromCategoryNo:h,isToCategoryNo:f,isFromAccountNo:m,isToAccountNo:g,onEdit:_,onDelete:v,isMobile:S,isEvenRow:x}){const E=t.date?new Date(t.date+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"}):"",C=x?"transparent":"rgba(255,255,255,0.04)";if(S)return c.jsxs("div",{onClick:_,style:{gridColumn:"1 / -1",display:"flex",flexDirection:"column",gap:"0.5rem",padding:"0.75rem 1rem",background:C,cursor:"pointer",transition:"background 0.15s"},children:[c.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:c.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[c.jsx("span",{style:{fontSize:"0.75rem",opacity:.5,fontFamily:"monospace",minWidth:"3rem"},children:E}),c.jsx("span",{style:{fontWeight:600,opacity:.8,fontFamily:"monospace"},children:$e(t.amount)}),t.cleared&&c.jsx("span",{style:{fontSize:"0.7rem",color:ae.success},title:"Cleared",children:""})]})}),c.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto 1fr",gap:"0.5rem",alignItems:"center"},children:[c.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[c.jsx("span",{style:h?{fontSize:"0.7rem",opacity:.4}:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px",display:"inline-block",width:"fit-content"},children:e}),m?c.jsx("span",{style:{fontSize:"0.75rem",opacity:.4},children:r}):c.jsxs("div",{style:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px",display:"inline-flex",flexDirection:"column",gap:"0.1rem",width:"fit-content"},children:[o&&c.jsx("span",{style:{fontSize:"0.65rem",opacity:.6},children:o}),c.jsx("span",{children:r})]})]}),c.jsx("span",{style:{opacity:.5},children:""}),c.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[c.jsx("span",{style:f?{fontSize:"0.7rem",opacity:.4}:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px",display:"inline-block",width:"fit-content"},children:n}),g?c.jsx("span",{style:{fontSize:"0.75rem",opacity:.4},children:a}):c.jsxs("div",{style:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px",display:"inline-flex",flexDirection:"column",gap:"0.1rem",width:"fit-content"},children:[u&&c.jsx("span",{style:{fontSize:"0.65rem",opacity:.6},children:u}),c.jsx("span",{children:a})]})]})]}),t.description&&c.jsx("div",{style:{fontSize:"0.75rem",opacity:.6},children:t.description})]});const I={padding:"0.6rem 0.5rem",background:C,display:"flex",alignItems:"center",fontSize:"0.9rem"};return c.jsxs("div",{style:{display:"contents"},children:[c.jsx("div",{style:{...I,fontSize:"0.85rem",fontFamily:"monospace"},children:c.jsx("span",{style:{opacity:.6},children:E})}),c.jsx("div",{style:{...I,justifyContent:"flex-end",fontWeight:600,opacity:.8,fontFamily:"monospace"},children:$e(t.amount)}),c.jsx("div",{style:{...I,justifyContent:"center"},children:c.jsx("span",{style:h?{fontSize:"0.8rem",opacity:.4}:{fontSize:"0.8rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e})}),c.jsx("div",{style:{...I,overflow:"hidden"},children:m?c.jsx("span",{style:{opacity:.4,fontSize:"0.85rem"},children:r}):c.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.1rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden"},children:[o&&c.jsx("span",{style:{fontSize:"0.7rem",opacity:.6,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:o}),c.jsx("span",{style:{fontSize:"0.8rem",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:r})]})}),c.jsx("div",{style:{...I,justifyContent:"center",fontSize:"1rem"},children:c.jsx("span",{style:{opacity:.5},children:""})}),c.jsx("div",{style:{...I,justifyContent:"center"},children:c.jsx("span",{style:f?{fontSize:"0.8rem",opacity:.4}:{fontSize:"0.8rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:n})}),c.jsx("div",{style:{...I,overflow:"hidden"},children:g?c.jsx("span",{style:{opacity:.4,fontSize:"0.85rem"},children:a}):c.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.1rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden"},children:[u&&c.jsx("span",{style:{fontSize:"0.7rem",opacity:.6,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:u}),c.jsx("span",{style:{fontSize:"0.8rem",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:a})]})}),c.jsx("div",{style:{...I,paddingLeft:"0.5rem",overflow:"hidden"},children:c.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.8rem",opacity:.6},children:t.description||""})}),c.jsx("div",{style:{...I,justifyContent:"center",color:t.cleared?ae.success:"inherit",opacity:t.cleared?1:.3,fontSize:"1rem"},children:t.cleared?"":""}),c.jsxs("div",{style:{...I,justifyContent:"flex-end",gap:"0.25rem"},children:[c.jsx("button",{onClick:_,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:j=>j.currentTarget.style.opacity="1",onMouseLeave:j=>j.currentTarget.style.opacity="0.5",title:"Edit",children:""}),c.jsx("button",{onClick:v,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:j=>j.currentTarget.style.opacity="1",onMouseLeave:j=>j.currentTarget.style.opacity="0.5",title:"Delete",children:""})]})]})}const As={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderTop:"1px solid rgba(255,255,255,0.1)"};function vz(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n,setCurrentYear:r,setCurrentMonthNumber:a}=zt(),{accounts:o,accountGroups:u,categories:h,categoryGroups:f}=kn(),{month:m,isLoading:g,addTransfer:_,updateTransfer:v,deleteTransfer:S}=_i(t,e,n),x=zs(),[E,C]=T.useState(null),[I,j]=T.useState(!1),[M,Q]=T.useState(null);function q(B){const O=B.account_group_id?u[B.account_group_id]:void 0;return O?.is_active!==void 0?O.is_active:B.is_active!==!1}function G(B){const O=B.account_group_id?u[B.account_group_id]:void 0;return O?.on_budget!==void 0?O.on_budget:B.on_budget!==!1}const D=Object.entries(o).filter(([,B])=>q(B)&&G(B));function A(B,O,K,Y,z,V,W,ee){C(null),j(!1);const[ie,U]=V.split("-").map(Number);_(B,O,K,Y,z,V,W,ee).then(()=>{(ie!==e||U!==n)&&(r(ie),a(U))}).catch(H=>{C(H instanceof Error?H.message:"Failed to add transfer")})}function N(B,O,K,Y,z,V,W,ee,ie){C(null),Q(null),v(B,O,K,Y,z,V,W,ee,ie).catch(U=>{C(U instanceof Error?U.message:"Failed to update transfer")})}function L(B){confirm("Are you sure you want to delete this transfer?")&&(C(null),S(B).catch(O=>{C(O instanceof Error?O.message:"Failed to delete transfer")}))}const P=D.length>=1&&Object.keys(h).length>=1;return c.jsxs("div",{style:{opacity:g?.5:1,transition:"opacity 0.15s ease-out",pointerEvents:g?"none":"auto"},children:[E&&c.jsx("div",{style:{background:`color-mix(in srgb, ${ae.error} 15%, transparent)`,border:`1px solid ${ae.error}`,borderRadius:"8px",padding:"0.75rem",marginBottom:"1rem",color:ae.error},children:E}),c.jsxs("div",{style:{display:"grid",gridTemplateColumns:x?"1fr":"5rem 6rem 1fr 1fr 2rem 1fr 1fr 1fr 3rem 4rem"},children:[c.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"#242424",borderBottom:"1px solid rgba(255,255,255,0.15)",display:x?"block":"grid",gridTemplateColumns:x?void 0:"subgrid"},children:[c.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem"},children:[c.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[c.jsx("span",{style:{fontWeight:600},children:"Transfers:"}),c.jsx("span",{style:{opacity:.6,fontSize:"0.8rem"},children:"Moving money between accounts and categories within the budget"})]}),c.jsx("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:!I&&c.jsx(De,{actionName:"Open Add Transfer Form",onClick:()=>j(!0),disabled:!P,style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:"+ Add Transfer"})})]}),!x&&c.jsxs(c.Fragment,{children:[c.jsx("div",{style:As,children:"Date"}),c.jsx("div",{style:{...As,textAlign:"right"},children:"Amount"}),c.jsx("div",{style:{...As,textAlign:"center"},children:"From Cat"}),c.jsx("div",{style:As,children:"From Acct"}),c.jsx("div",{style:As}),c.jsx("div",{style:{...As,textAlign:"center"},children:"To Cat"}),c.jsx("div",{style:As,children:"To Acct"}),c.jsx("div",{style:As,children:"Description"}),c.jsx("div",{style:{...As,textAlign:"center"},children:"Clr"}),c.jsx("div",{style:As})]})]}),!P&&c.jsxs("p",{style:{gridColumn:"1 / -1",opacity:.6,fontSize:"0.9rem",padding:"1rem 0"},children:["You need at least one account and one category before adding transfers."," ",c.jsx(Ft,{to:"/budget/accounts",style:{opacity:1},children:"Manage accounts "})]}),I&&c.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"1rem"},children:c.jsx(Bw,{accounts:D,accountGroups:u,categories:h,categoryGroups:f,defaultDate:`${e}-${String(n).padStart(2,"0")}-01`,onSubmit:A,onCancel:()=>j(!1),submitLabel:"Add Transfer"})}),m?.transfers?.slice().sort((B,O)=>(B.date||"").localeCompare(O.date||"")).map((B,O)=>M===B.id?c.jsx("div",{style:{gridColumn:"1 / -1",padding:"0.5rem"},children:c.jsx(Bw,{accounts:D,accountGroups:u,categories:h,categoryGroups:f,initialData:B,onSubmit:(K,Y,z,V,W,ee,ie,U)=>N(B.id,K,Y,z,V,W,ee,ie,U),onCancel:()=>Q(null),onDelete:()=>L(B.id),submitLabel:"Save"})},B.id):c.jsx(bz,{transfer:B,fromCategoryName:et(B.from_category_id)?va:h[B.from_category_id]?.name||"Unknown",toCategoryName:et(B.to_category_id)?va:h[B.to_category_id]?.name||"Unknown",fromAccountName:Be(B.from_account_id)?Bs:o[B.from_account_id]?.nickname||"Unknown",toAccountName:Be(B.to_account_id)?Bs:o[B.to_account_id]?.nickname||"Unknown",fromAccountGroupName:Be(B.from_account_id)?void 0:o[B.from_account_id]?.account_group_id?u[o[B.from_account_id].account_group_id]?.name:void 0,toAccountGroupName:Be(B.to_account_id)?void 0:o[B.to_account_id]?.account_group_id?u[o[B.to_account_id].account_group_id]?.name:void 0,isFromCategoryNo:et(B.from_category_id),isToCategoryNo:et(B.to_category_id),isFromAccountNo:Be(B.from_account_id),isToAccountNo:Be(B.to_account_id),onEdit:()=>{B.description||`${B.amount}`,Q(B.id)},onDelete:()=>L(B.id),isMobile:x,isEvenRow:O%2===0},B.id)),(!m?.transfers||m.transfers.length===0)&&!I&&c.jsx("p",{style:{gridColumn:"1 / -1",opacity:.5,fontSize:"0.9rem",textAlign:"center",padding:"1.5rem"},children:"No transfers recorded for this month"}),c.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]})]})}function Lw({accounts:t,accountGroups:e,categories:n,categoryGroups:r,initialData:a,defaultAccountId:o,defaultDate:u,onSubmit:h,onCancel:f,onDelete:m,submitLabel:g}){function _(v){h(v.amount,v.accountId,v.categoryId,v.date,v.description,v.cleared)}return c.jsx(F0,{accounts:t,accountGroups:e,categories:n,categoryGroups:r,payees:[],initialData:a?{date:a.date,categoryId:a.category_id,accountId:a.account_id,amount:a.amount,description:a.description,cleared:a.cleared}:void 0,defaultAccountId:o,defaultDate:u,config:{showCategory:!0,showCleared:!0,showNoCategoryOption:!0,showNoAccountOption:!0,showSignToggle:!0,accountLabel:"Account",payeePlaceholder:"",descriptionPlaceholder:"e.g., Starting balance, Correction",submitLabel:g},onSubmit:_,onCancel:f,onDelete:m})}function xz({adjustment:t,categoryName:e,accountName:n,accountGroupName:r,onEdit:a,onDelete:o,isMobile:u,isEvenRow:h}){const f=t.date?new Date(t.date+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"}):"",m=r?`${r} / ${n}`:n,g=h?"transparent":"rgba(255,255,255,0.04)";if(u)return c.jsxs("div",{onClick:a,style:{gridColumn:"1 / -1",display:"flex",flexDirection:"column",gap:"0.25rem",padding:"0.75rem 1rem",background:g,cursor:"pointer",transition:"background 0.15s"},children:[c.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[c.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[c.jsx("span",{style:{fontSize:"0.75rem",opacity:.5,fontFamily:"monospace"},children:f}),t.cleared&&c.jsx("span",{style:{fontSize:"0.7rem",color:ae.success},title:"Cleared",children:""})]}),c.jsx("span",{style:{fontWeight:600,color:jt(t.amount),fontFamily:"monospace"},children:_r(t.amount)})]}),c.jsx("div",{style:{fontWeight:500,fontSize:"0.9rem"},children:t.description||"Adjustment"}),c.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap",alignItems:"center"},children:[c.jsx("span",{style:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px"},children:e}),c.jsx("span",{style:{fontSize:"0.75rem",opacity:.6},children:m})]})]});const _={padding:"0.6rem 0.5rem",background:g,display:"flex",alignItems:"center",fontSize:"0.9rem"};return c.jsxs("div",{style:{display:"contents"},children:[c.jsx("div",{style:{..._,fontSize:"0.85rem",fontFamily:"monospace"},children:c.jsx("span",{style:{opacity:.6},children:f})}),c.jsx("div",{style:{..._,justifyContent:"center"},children:c.jsx("span",{style:{fontSize:"0.8rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e})}),c.jsx("div",{style:{..._,overflow:"hidden"},children:c.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.85rem",opacity:.7},children:m})}),c.jsx("div",{style:{..._,justifyContent:"flex-end",fontWeight:600,color:jt(t.amount),fontFamily:"monospace"},children:_r(t.amount)}),c.jsx("div",{style:{..._,paddingLeft:"0.5rem",overflow:"hidden"},children:c.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.8rem",opacity:.6},children:t.description||""})}),c.jsx("div",{style:{..._,justifyContent:"center",color:t.cleared?ae.success:"inherit",opacity:t.cleared?1:.3,fontSize:"1rem"},children:t.cleared?"":""}),c.jsxs("div",{style:{..._,justifyContent:"flex-end",gap:"0.25rem"},children:[c.jsx("button",{onClick:a,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:v=>v.currentTarget.style.opacity="1",onMouseLeave:v=>v.currentTarget.style.opacity="0.5",title:"Edit",children:""}),c.jsx("button",{onClick:o,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:v=>v.currentTarget.style.opacity="1",onMouseLeave:v=>v.currentTarget.style.opacity="0.5",title:"Delete",children:""})]})]})}const so={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderTop:"1px solid rgba(255,255,255,0.1)"};function Sz(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n,setCurrentYear:r,setCurrentMonthNumber:a}=zt(),{accounts:o,accountGroups:u,categories:h,categoryGroups:f}=kn(),{month:m,isLoading:g,addAdjustment:_,updateAdjustment:v,deleteAdjustment:S}=_i(t,e,n),x=zs(),[E,C]=T.useState(null),[I,j]=T.useState(!1),[M,Q]=T.useState(null);function q(P){const B=P.account_group_id?u[P.account_group_id]:void 0;return B?.is_active!==void 0?B.is_active:P.is_active!==!1}function G(P){const B=P.account_group_id?u[P.account_group_id]:void 0;return B?.on_budget!==void 0?B.on_budget:P.on_budget!==!1}const D=Object.entries(o).filter(([,P])=>q(P)&&G(P));function A(P,B,O,K,Y,z){C(null),j(!1);const[V,W]=K.split("-").map(Number);_(P,B,O,K,Y,z).then(()=>{(V!==e||W!==n)&&(r(V),a(W))}).catch(ee=>{C(ee instanceof Error?ee.message:"Failed to add adjustment")})}function N(P,B,O,K,Y,z,V){C(null),Q(null),v(P,B,O,K,Y,z,V).catch(W=>{C(W instanceof Error?W.message:"Failed to update adjustment")})}function L(P){confirm("Are you sure you want to delete this adjustment?")&&(C(null),S(P).catch(B=>{C(B instanceof Error?B.message:"Failed to delete adjustment")}))}return c.jsxs("div",{style:{opacity:g?.5:1,transition:"opacity 0.15s ease-out",pointerEvents:g?"none":"auto"},children:[E&&c.jsx("div",{style:{background:`color-mix(in srgb, ${ae.error} 15%, transparent)`,border:`1px solid ${ae.error}`,borderRadius:"8px",padding:"0.75rem",marginBottom:"1rem",color:ae.error},children:E}),c.jsxs("div",{style:{display:"grid",gridTemplateColumns:x?"1fr":"5rem 1fr 1fr 6rem 1.5fr 3rem 4rem"},children:[c.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"#242424",borderBottom:"1px solid rgba(255,255,255,0.15)",display:x?"block":"grid",gridTemplateColumns:x?void 0:"subgrid"},children:[c.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem"},children:[c.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[c.jsx("span",{style:{fontWeight:600},children:"Adjustments:"}),c.jsx("span",{style:{opacity:.6,fontSize:"0.8rem"},children:"Incoming or outgoing transactions that should bypass income and spend calculations"})]}),c.jsx("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:!I&&c.jsx(De,{actionName:"Open Add Adjustment Form",onClick:()=>j(!0),disabled:Object.keys(h).length===0&&D.length===0,style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:"+ Add Adjustment"})})]}),!x&&c.jsxs(c.Fragment,{children:[c.jsx("div",{style:so,children:"Date"}),c.jsx("div",{style:{...so,textAlign:"center"},children:"Category"}),c.jsx("div",{style:so,children:"Account"}),c.jsx("div",{style:{...so,textAlign:"right"},children:"Amount"}),c.jsx("div",{style:so,children:"Description"}),c.jsx("div",{style:{...so,textAlign:"center"},children:"Clr"}),c.jsx("div",{style:so})]})]}),D.length===0&&Object.keys(h).length===0&&c.jsxs("p",{style:{gridColumn:"1 / -1",opacity:.6,fontSize:"0.9rem",padding:"1rem 0"},children:["You need to create at least one account or category before adding adjustments."," ",c.jsx(Ft,{to:"/budget/accounts",style:{opacity:1},children:"Manage accounts "})]}),I&&c.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"1rem"},children:c.jsx(Lw,{accounts:D,accountGroups:u,categories:h,categoryGroups:f,defaultDate:`${e}-${String(n).padStart(2,"0")}-01`,onSubmit:A,onCancel:()=>j(!1),submitLabel:"Add Adjustment"})}),m?.adjustments?.slice().sort((P,B)=>(P.date||"").localeCompare(B.date||"")).map((P,B)=>M===P.id?c.jsx("div",{style:{gridColumn:"1 / -1",padding:"0.5rem"},children:c.jsx(Lw,{accounts:D,accountGroups:u,categories:h,categoryGroups:f,initialData:P,onSubmit:(O,K,Y,z,V,W)=>N(P.id,O,K,Y,z,V,W),onCancel:()=>Q(null),onDelete:()=>L(P.id),submitLabel:"Save"})},P.id):c.jsx(xz,{adjustment:P,categoryName:et(P.category_id)?va:h[P.category_id]?.name||"Unknown Category",accountName:Be(P.account_id)?Bs:o[P.account_id]?.nickname||"Unknown Account",accountGroupName:Be(P.account_id)?void 0:o[P.account_id]?.account_group_id?u[o[P.account_id].account_group_id]?.name:void 0,onEdit:()=>{P.description||`${P.amount}`,Q(P.id)},onDelete:()=>L(P.id),isMobile:x,isEvenRow:B%2===0},P.id)),(!m?.adjustments||m.adjustments.length===0)&&!I&&c.jsx("p",{style:{gridColumn:"1 / -1",opacity:.5,fontSize:"0.9rem",textAlign:"center",padding:"1.5rem"},children:"No adjustments recorded for this month"}),c.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]})]})}function wz({isOpen:t,onClose:e,onDeleted:n}){const{addLoadingHold:r,removeLoadingHold:a}=ir(),{selectedBudgetId:o,currentYear:u,currentMonthNumber:h}=zt(),{deleteAllocations:f}=dT(),[m,g]=T.useState(null),_=async()=>{if(o){g(null),r("allocations-delete","Deleting allocations...");try{await f({budgetId:o,year:u,month:h}),e(),n?.()}catch(v){g(v instanceof Error?v.message:"Failed to delete allocations")}finally{a("allocations-delete")}}};return c.jsxs(Ls,{isOpen:t,onClose:e,title:"Delete Allocations",children:[m&&c.jsx(Ao,{message:m,onDismiss:()=>g(null)}),c.jsx("p",{style:{margin:"0 0 1.5rem 0"},children:"Are you sure you want to delete all allocations for this month? This will remove all allocated amounts and reset the month to unfinalized."}),c.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[c.jsx(De,{actionName:"Cancel Delete Allocations",variant:"secondary",onClick:e,children:"Cancel"}),c.jsx(De,{actionName:"Confirm Delete Allocations",variant:"danger",onClick:_,children:"Delete Allocations"})]})]})}function JT({isDraftMode:t,isEditingAppliedAllocations:e,availableNow:n,currentMonthIncome:r,balanceTotals:a,draftChangeAmount:o,availableAfterApply:u,currentDraftTotal:h}){const f=t&&h!==void 0?h:a.allocated;return c.jsxs(c.Fragment,{children:[c.jsx("span",{style:{fontWeight:600,marginRight:"0.25rem"},children:t||e?"Allocations Worksheet:":"Month Summary:"}),c.jsxs("span",{children:[c.jsx("span",{style:{opacity:.6},children:t?"Avail: ":"Inc: "}),t?c.jsx("span",{style:{color:jt(n),fontWeight:600},children:$e(n)}):c.jsxs("span",{style:{color:ae.success,fontWeight:600},children:["+",$e(r)]})]}),c.jsxs("span",{children:[t&&c.jsx("span",{style:{opacity:.6},children:" "}),c.jsx("span",{style:{opacity:.6},children:t?"Draft: ":"Alloc: "}),c.jsxs("span",{style:{color:oc(t?f:a.allocated),fontWeight:600,...t?es:{}},children:[t?"":"+",$e(t?f:a.allocated)]}),e&&o!==0&&c.jsxs("span",{style:{fontSize:"0.85em",color:o>0?ae.warning:ae.success,marginLeft:"0.25rem"},children:["(",_r(o),")"]})]}),!t&&c.jsxs("span",{children:[c.jsx("span",{style:{opacity:.6},children:"Spent: "}),c.jsx("span",{style:{color:ac(a.spent),fontWeight:600},children:ja(a.spent)})]}),c.jsxs("span",{children:[t&&c.jsx("span",{style:{opacity:.6},children:"= "}),c.jsx("span",{style:{opacity:.6},children:t?"Remaining: ":"Net: "}),t?c.jsx("span",{style:{color:jt(u),fontWeight:600,...es},children:$e(u)}):c.jsx("span",{style:{color:jt(a.allocated+a.spent),fontWeight:600},children:$e(a.allocated+a.spent)})]})]})}function Ez({totals:t}){return c.jsxs(c.Fragment,{children:[c.jsxs("span",{children:[c.jsx("span",{style:{opacity:.6},children:"Start: "}),c.jsx("span",{style:{color:jt(t.start),fontWeight:600},children:$e(t.start)})]}),c.jsxs("span",{children:[c.jsx("span",{style:{opacity:.6},children:"Inc: "}),c.jsxs("span",{style:{color:ae.success,fontWeight:600},children:["+",$e(t.income)]})]}),c.jsxs("span",{children:[c.jsx("span",{style:{opacity:.6},children:"Exp: "}),c.jsx("span",{style:{color:ac(t.expenses),fontWeight:600},children:ja(t.expenses)})]}),c.jsxs("span",{children:[c.jsx("span",{style:{opacity:.6},children:"End: "}),c.jsx("span",{style:{color:jt(t.end),fontWeight:600},children:$e(t.end)})]})]})}function V0({isDraftMode:t,isEditingAppliedAllocations:e,allocationsFinalized:n,onSave:r,onApply:a,onEdit:o,onCancel:u,onDelete:h}){return c.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:[t&&!e&&c.jsxs(c.Fragment,{children:[c.jsx(De,{actionName:"Save Draft Allocations",onClick:r,variant:"secondary",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:" Save"}),c.jsx(De,{actionName:"Apply Allocations",onClick:a,variant:"secondary",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:" Apply"})]}),!t&&n&&c.jsx(De,{actionName:"Edit Allocations",onClick:o,variant:"secondary",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:" Edit Allocations"}),e&&c.jsxs(c.Fragment,{children:[c.jsx(De,{actionName:"Apply Allocations",onClick:a,variant:"secondary",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:" Apply"}),c.jsx(De,{actionName:"Cancel Edit Allocations",onClick:u,variant:"secondary",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:""}),c.jsx(De,{actionName:"Open Delete Allocations Modal",onClick:h,variant:"secondary",style:{fontSize:"0.8rem",padding:"0.4em 0.8em",color:ae.error},children:""})]})]})}function Cz({category:t,balance:e,localAllocation:n,previousMonthIncome:r,isDraftMode:a,onAllocationChange:o,projectedAllTime:u}){const h=t.default_monthly_type==="percentage"&&t.default_monthly_amount!==void 0&&t.default_monthly_amount>0,f=h?t.default_monthly_amount/100*r:0,m=h?f.toFixed(2):n,g=a&&!h,_=a?u:t.balance??0,v=t.balance??0,S=v<0,x=S?Math.abs(v):0,E=h?f:parseFloat(n)||0,C=S?Math.min(E,x):0,I=S?Math.max(0,E-x):0,j=S&&E>0&&I>0;return c.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",padding:"0.75rem"},children:[c.jsx("div",{style:{marginBottom:"0.5rem"},children:c.jsx("span",{style:{fontWeight:500},children:t.name})}),c.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr 1fr 1fr",gap:"0.25rem",fontSize:"0.75rem"},children:[c.jsxs("div",{children:[c.jsx("span",{style:{opacity:.6,display:"block"},children:"Start"}),c.jsx("span",{style:{color:In(e.start_balance)},children:ts(e.start_balance)})]}),c.jsxs("div",{children:[c.jsx("span",{style:{opacity:.6,display:"block"},children:"Alloc"}),g?c.jsxs(c.Fragment,{children:[c.jsx("input",{type:"text",inputMode:"decimal",value:m?`$${m}`:"",onChange:M=>{const Q=M.target.value.replace(/[^\d.]/g,"");o(Q)},placeholder:"$0",style:{width:"100%",maxWidth:"80px",padding:"0.25rem 0.35rem",borderRadius:"4px",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",background:"color-mix(in srgb, currentColor 8%, transparent)",fontSize:"0.8rem",color:"inherit",boxSizing:"border-box"}}),S&&E>0&&c.jsxs("div",{style:{fontSize:"0.65rem",marginTop:"0.15rem",lineHeight:1.3},children:[c.jsxs("span",{style:{color:ae.debt,display:"block"},children:[$e(C),"  debt"]}),j&&c.jsxs("span",{style:{color:ae.success,display:"block"},children:[$e(I),"  balance"]})]})]}):c.jsx("span",{style:{color:oc(e.allocated)},children:_r(e.allocated)})]}),c.jsxs("div",{children:[c.jsx("span",{style:{opacity:.6,display:"block"},children:"Spent"}),c.jsx("span",{style:{color:ac(e.spent)},children:ja(e.spent)})]}),c.jsxs("div",{children:[c.jsx("span",{style:{opacity:.6,display:"block"},children:"End"}),c.jsx("span",{style:{color:In(e.end_balance),...a&&!h?es:{}},children:ts(e.end_balance)})]}),c.jsxs("div",{children:[c.jsx("span",{style:{opacity:.6,display:"block"},children:a?"Proj. All-Time":"All-Time"}),c.jsx("span",{style:{color:In(_),...a&&!h?es:{}},children:ts(_)})]})]}),a&&h&&c.jsx("div",{style:{marginTop:"0.5rem"},children:c.jsxs("span",{style:{fontSize:"0.8rem"},children:[c.jsxs("span",{style:{opacity:.6},children:[$e(r),"  "]}),c.jsxs("span",{style:{color:ae.success},children:[t.default_monthly_amount,"%"]}),c.jsx("span",{style:{opacity:.6},children:" = "}),c.jsx("span",{style:{color:ae.success},children:$e(f)})]})})]})}function zw({name:t,categories:e,groupTotals:n,getCategoryBalance:r,localAllocations:a,savedAllocations:o,previousMonthIncome:u,isDraftMode:h,onAllocationChange:f,isMobile:m,isUngrouped:g,getAllocationAmount:_}){const v={paddingTop:"0.6rem",paddingBottom:"0.6rem",paddingLeft:"0.5rem",paddingRight:"0.5rem",marginTop:"1.25rem",borderTop:"1px solid rgba(255,255,255,0.2)",borderBottom:kf,background:"rgba(255,255,255,0.04)",display:"flex",alignItems:"center",fontSize:"0.9rem",fontWeight:600},S=n.allocated+n.spent,x=e.reduce((E,[C,I])=>{const j=I.balance??0;if(h){const M=_(C,I),Q=o[C]??0,q=M-Q;return E+j+q}return E+j},0);return c.jsxs("div",{style:{display:"contents"},children:[!m&&c.jsxs(c.Fragment,{children:[c.jsxs("div",{style:{...v,paddingLeft:"0.5rem",opacity:g?.7:1},children:[c.jsx("span",{children:t}),c.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",e.length,")"]})]}),c.jsx("div",{style:{...v,justifyContent:"flex-end",color:In(n.start)},children:$n.showGroupTotals}),c.jsx("div",{style:{...v,justifyContent:h?"center":"flex-end",color:oc(n.allocated)},children:$n.showGroupTotals}),c.jsx("div",{style:{...v,justifyContent:"flex-end",color:ac(n.spent)},children:$n.showGroupTotals}),c.jsx("div",{style:{...v,justifyContent:"flex-end",color:In(S)},children:$n.showGroupTotals}),c.jsx("div",{style:{...v,justifyContent:"flex-end",color:In(n.end),paddingRight:"1rem",borderRight:"2px solid rgba(128, 128, 128, 0.4)"},children:$n.showGroupTotals}),c.jsx("div",{style:{...v,justifyContent:"flex-end",color:In(x)},children:$n.showGroupTotals})]}),!h&&m&&c.jsxs("div",{style:{gridColumn:"1 / -1",paddingTop:"0.6rem",paddingBottom:"0.6rem",paddingLeft:"0.5rem",paddingRight:"0.5rem",marginTop:"1.25rem",borderTop:"1px solid rgba(255,255,255,0.2)",borderBottom:kf,background:"rgba(255,255,255,0.04)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[c.jsxs("span",{style:{fontWeight:600,opacity:g?.7:1},children:[t,c.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",e.length,")"]})]}),$n.showGroupTotals]}),e.map(([E,C],I)=>{const j=r(E);if(!j)return null;const M=C.balance??0;let Q=M;if(h){const q=_(E,C),G=o[E]??0,D=q-G;Q=M+D}return m?c.jsx("div",{style:{gridColumn:"1 / -1"},children:c.jsx(Cz,{category:C,balance:j,localAllocation:a[E]||"",previousMonthIncome:u,isDraftMode:h,onAllocationChange:q=>f(E,q),projectedAllTime:Q})},E):c.jsx(Tz,{category:C,balance:j,localAllocation:a[E]||"",previousMonthIncome:u,isDraftMode:h,onAllocationChange:q=>f(E,q),allTimeBalance:Q,isEvenRow:I%2===0},E)})]})}function Tz({category:t,balance:e,localAllocation:n,previousMonthIncome:r,isDraftMode:a,onAllocationChange:o,allTimeBalance:u,isEvenRow:h}){const f=t.default_monthly_type==="percentage"&&t.default_monthly_amount!==void 0&&t.default_monthly_amount>0,m=f?t.default_monthly_amount/100*r:0,g=f?m.toFixed(2):n,_=t.balance??0,v=_<0,S=v?Math.abs(_):0,x=f?m:parseFloat(n)||0,E=v?Math.min(x,S):0,C=v?Math.max(0,x-S):0,I=v&&x>0&&C>0,j=h?"transparent":"rgba(255,255,255,0.04)",M={paddingTop:"0.6rem",paddingBottom:"0.6rem",paddingLeft:"0.5rem",paddingRight:"0.5rem",background:j,display:"flex",alignItems:"center",fontSize:"0.9rem",minHeight:"2.4rem",boxSizing:"border-box"},Q=e.allocated+e.spent;return c.jsxs("div",{style:{display:"contents"},children:[c.jsx("div",{style:{paddingTop:"0.6rem",paddingBottom:"0.6rem",paddingRight:"0.5rem",paddingLeft:"1.5rem",background:j,display:"flex",alignItems:"center",fontSize:"0.9rem",fontWeight:500,overflow:"hidden",borderLeft:"2px solid rgba(255,255,255,0.1)",minHeight:"2.4rem",boxSizing:"border-box"},children:c.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.name})}),c.jsx("div",{style:{...M,justifyContent:"flex-end",color:In(e.start_balance)},children:ts(e.start_balance)}),a?c.jsx("div",{style:{...M,justifyContent:"center",flexDirection:"column",gap:"0.1rem",paddingTop:"0.35rem",paddingBottom:"0.35rem"},children:f?c.jsxs("span",{style:{fontSize:"0.85rem"},children:[c.jsxs("span",{style:{color:ae.success},children:[t.default_monthly_amount,"%"]}),c.jsx("span",{style:{opacity:.5},children:" = "}),c.jsx("span",{style:{color:ae.success},children:$e(m)})]}):c.jsxs(c.Fragment,{children:[c.jsx("input",{type:"text",inputMode:"decimal",value:g?`$${g}`:"",onChange:q=>{const G=q.target.value.replace(/[^\d.]/g,"");o(G)},placeholder:"$0.00",style:{width:"100px",padding:"0.2rem 0.5rem",borderRadius:"4px",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"0.9rem",lineHeight:1,color:"inherit",boxSizing:"border-box"}}),v&&x>0&&c.jsxs("div",{style:{fontSize:"0.6rem",whiteSpace:"nowrap",textAlign:"center",lineHeight:1.3,display:"flex",flexDirection:"column",alignItems:"center"},children:[c.jsxs("span",{style:{color:ae.debt},children:[$e(E),"  debt"]}),I&&c.jsxs("span",{style:{color:ae.success},children:[$e(C),"  bal"]})]})]})}):(()=>{const q=e.start_balance<0,G=q?Math.abs(e.start_balance):0,D=q?Math.min(e.allocated,G):0,A=q?Math.max(0,e.allocated-G):0,N=q&&e.allocated>0;return c.jsxs("div",{style:{...M,justifyContent:"flex-end",flexDirection:"column",alignItems:"flex-end",gap:"0.1rem",color:oc(e.allocated)},children:[c.jsxs("span",{children:["+",$e(e.allocated)]}),N&&c.jsxs("div",{style:{fontSize:"0.6rem",whiteSpace:"nowrap",textAlign:"right",lineHeight:1.3,display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[c.jsxs("span",{style:{color:ae.debt},children:[$e(D),"  debt"]}),A>0&&c.jsxs("span",{style:{color:ae.success},children:[$e(A),"  bal"]})]})]})})(),c.jsx("div",{style:{...M,justifyContent:"flex-end",color:ac(e.spent)},children:ja(e.spent)}),c.jsx("div",{style:{...M,justifyContent:"flex-end",color:In(Q),...a&&!f?es:{}},children:_r(Q)}),c.jsx("div",{style:{...M,justifyContent:"flex-end",fontWeight:600,color:In(e.end_balance),paddingRight:"1rem",borderRight:"2px solid rgba(128, 128, 128, 0.4)",...a&&!f?es:{}},children:ts(e.end_balance)}),c.jsx("div",{style:{...M,justifyContent:"flex-end",color:In(u),...a&&!f?es:{}},children:ts(u)})]})}function Az(t,e){const{includeHidden:n=!1}={},r=Object.entries(t).filter(([,a])=>n||!a.is_hidden).reduce((a,[o,u])=>{const h=u.category_group_id||"ungrouped";return a[h]||(a[h]=[]),a[h].push([o,u]),a},{});return Object.keys(r).forEach(a=>{r[a].sort((o,u)=>o[1].sort_order-u[1].sort_order)}),r}function jz(t,e,n,r,a){const o={};t?.category_balances&&t.category_balances.forEach(h=>{o[h.category_id]=h});const u={};return Object.entries(e).forEach(([h,f])=>{const m=o[h],g=m?.start_balance??0,_=m?.spent??0;let v=0;n?v=a(h,f):r&&m&&(v=m.allocated),u[h]={category_id:h,start_balance:g,allocated:v,spent:_,end_balance:g+v+_}}),u}function Rz(t,e){const n={};t?.account_balances&&t.account_balances.forEach(a=>{n[a.account_id]=a});const r={};return Object.entries(e).forEach(([a,o])=>{const h=n[a]?.start_balance??o.balance;let f=0;t?.income&&(f=t.income.filter(_=>_.account_id===a).reduce((_,v)=>_+v.amount,0));let m=0;t?.expenses&&(m=t.expenses.filter(_=>_.account_id===a).reduce((_,v)=>_+v.amount,0));const g=f+m;r[a]={account_id:a,start_balance:h,income:f,expenses:m,net_change:g,end_balance:h+g}}),r}function Dz(t){return Object.values(t).reduce((e,n)=>({start:e.start+n.start_balance,income:e.income+n.income,expenses:e.expenses+n.expenses,netChange:e.netChange+n.net_change,end:e.end+n.end_balance}),{start:0,income:0,expenses:0,netChange:0,end:0})}function Iz(t){return Object.values(t).reduce((e,n)=>({start:e.start+n.start_balance,allocated:e.allocated+n.allocated,spent:e.spent+n.spent,end:e.end+n.end_balance}),{start:0,allocated:0,spent:0,end:0})}function Mz({isDraftMode:t,allocationsFinalized:e,balanceTotals:n,grandAllTime:r,onSave:a,onApply:o,onEdit:u,onCancel:h,onDelete:f}){const m={paddingTop:"0.6rem",paddingBottom:"0.6rem",paddingLeft:"0.5rem",paddingRight:"0.5rem",borderTop:"2px solid rgba(255,255,255,0.3)",borderBottom:"2px solid rgba(255,255,255,0.3)",fontWeight:600,display:"flex",alignItems:"center",fontSize:"0.9rem"},g=n.allocated+n.spent;return c.jsxs(c.Fragment,{children:[c.jsxs("div",{style:{...m,gap:"0.75rem"},children:["Grand Totals",!t&&c.jsx(V0,{isDraftMode:!1,isEditingAppliedAllocations:!1,allocationsFinalized:e,onSave:a,onApply:o,onEdit:u,onCancel:h,onDelete:f})]}),c.jsx("div",{style:{...m,justifyContent:"flex-end",color:In(n.start)},children:ts(n.start)}),c.jsxs("div",{style:{...m,justifyContent:t?"center":"flex-end",color:oc(n.allocated),...t?es:{}},children:["+",$e(n.allocated)]}),c.jsx("div",{style:{...m,justifyContent:"flex-end",color:ac(n.spent)},children:ja(n.spent)}),c.jsx("div",{style:{...m,justifyContent:"flex-end",color:In(g),...t?es:{}},children:_r(g)}),c.jsx("div",{style:{...m,justifyContent:"flex-end",color:In(n.end),paddingRight:"1rem",borderRight:"2px solid rgba(128, 128, 128, 0.4)",...t?es:{}},children:ts(n.end)}),c.jsx("div",{style:{...m,justifyContent:"flex-end",color:In(r),...t?es:{}},children:ts(r)})]})}function kz({allocationsFinalized:t,availableNow:e,currentMonthIncome:n,balanceTotals:r,draftChangeAmount:a,availableAfterApply:o,currentDraftTotal:u,onSave:h,onApply:f,onEdit:m,onCancel:g,onDelete:_}){return c.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem",borderTop:"2px solid rgba(255,255,255,0.3)",borderBottom:"2px solid rgba(255,255,255,0.3)"},children:[c.jsx("span",{style:{fontWeight:600},children:"Grand Totals:"}),c.jsx(JT,{isDraftMode:!1,isEditingAppliedAllocations:!1,availableNow:e,currentMonthIncome:n,balanceTotals:r,draftChangeAmount:a,availableAfterApply:o,currentDraftTotal:u}),c.jsx(V0,{isDraftMode:!1,isEditingAppliedAllocations:!1,allocationsFinalized:t,onSave:h,onApply:f,onEdit:m,onCancel:g,onDelete:_})]})}const io={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderBottom:"2px solid rgba(255,255,255,0.2)"};function Oz(t){if(!t)return"";switch(t.phase){case"reading-budget":return"Reading budget data...";case"fetching-months":return"Fetching months...";case"recalculating":return t.currentMonth?`Recalculating ${t.currentMonth}...`:"Recalculating...";case"saving":return"Saving results...";case"complete":return"Recalculation complete!";default:return"Recalculating balances..."}}function Nz(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n}=zt(),{categories:r,categoryGroups:a,monthMap:o}=kn(),{month:u}=_i(t,e,n),h=zs(),f=At(e,n),m=o[f]?.needs_recalculation===!0,g=T.useRef(!1),[_,v]=T.useState(null);T.useEffect(()=>{!t||!u||!m||g.current||(g.current=!0,`${e}${String(n).padStart(2,"0")}`,fm(t,{onProgress:Z=>v(Z)}).then(()=>{Ve.invalidateQueries({queryKey:xe.month(t,e,n)})}).catch(Z=>{console.error("[MonthCategories] Recalculation failed:",Z)}).finally(()=>{g.current=!1,v(null)}))},[t,m,u,e,n]);const[S,x]=T.useState(!1),{localAllocations:E,isEditingAppliedAllocations:C,error:I,availableNow:j,currentDraftTotal:M,draftChangeAmount:Q,availableAfterApply:q,previousMonthIncome:G,currentMonthIncome:D,allocationsFinalized:A,getAllocationAmount:N,handleAllocationChange:L,resetAllocationsToSaved:P,handleSaveAllocations:B,handleFinalizeAllocations:O,setIsEditingAppliedAllocations:K,setError:Y}=jB(),z=[...a].sort((Z,le)=>Z.sort_order-le.sort_order),V=T.useMemo(()=>Az(r),[r]),W=!A||C,ee=T.useMemo(()=>jz(u,r,W,A,N),[u,r,W,A,N]),ie=Z=>ee[Z],U=T.useMemo(()=>Iz(ee),[ee]),H=T.useMemo(()=>{const Z={};if(u?.category_balances)for(const le of u.category_balances)Z[le.category_id]=le.allocated;return Z},[u]),ne=T.useMemo(()=>Object.entries(r).reduce((Z,[le,pe])=>{const Ee=pe.balance??0;if(W){const ge=N(le,pe),J=H[le]??0,Se=ge-J;return Z+Ee+Se}return Z+Ee},0),[r,W,N,H]),se={onSave:B,onApply:O,onEdit:()=>K(!0),onCancel:P,onDelete:()=>x(!0)};return c.jsxs(c.Fragment,{children:[_&&c.jsxs(ic,{message:Oz(_),spinnerColor:"#22c55e",children:[c.jsx(id,{percent:_.percentComplete,gradient:"linear-gradient(90deg, #22c55e, #10b981)"}),c.jsxs("div",{style:{display:"flex",gap:"2rem",justifyContent:"center",flexWrap:"wrap"},children:[(_.totalMonthsToFetch??0)>0&&c.jsx(on,{value:`${_.monthsFetched||0}/${_.totalMonthsToFetch}`,label:"Months Loaded",color:_.phase==="fetching-months"?"#22c55e":"#6b7280"}),(_.totalMonths??0)>0&&c.jsx(on,{value:`${_.monthsProcessed}/${_.totalMonths}`,label:"Months Recalculated",color:_.phase==="recalculating"?"#22c55e":"#6b7280"})]}),c.jsx(ad,{percent:_.percentComplete})]}),I&&c.jsx(Ao,{message:I,onDismiss:()=>Y(null)}),c.jsxs("div",{style:{display:"grid",gridTemplateColumns:h?"1fr":W?"2fr 1fr 200px 1fr 1fr 1fr 120px":"2fr 1fr 1fr 1fr 1fr 1fr 120px"},children:[c.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"#242424",display:h?"block":"grid",gridTemplateColumns:h?void 0:"subgrid"},children:[W&&c.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexDirection:h?"column":"row",flexWrap:"wrap",alignItems:h?"stretch":"center",gap:h?"0.5rem":"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:h?"0.5rem":"0.25rem"},children:[c.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:h?void 0:1,alignItems:"center"},children:c.jsx(JT,{isDraftMode:W,isEditingAppliedAllocations:C,availableNow:j,currentMonthIncome:D,balanceTotals:U,draftChangeAmount:Q,availableAfterApply:q,currentDraftTotal:M})}),c.jsx(V0,{isDraftMode:W,isEditingAppliedAllocations:C,allocationsFinalized:A,...se})]}),!h&&c.jsxs(c.Fragment,{children:[c.jsx("div",{style:io,children:"Category"}),c.jsx("div",{style:{...io,textAlign:"right"},children:"Start"}),c.jsx("div",{style:{...io,textAlign:W?"center":"right"},children:"Allocated"}),c.jsx("div",{style:{...io,textAlign:"right"},children:"Spent"}),c.jsx("div",{style:{...io,textAlign:"right"},children:"Net Change"}),c.jsx("div",{style:{...io,textAlign:"right",paddingRight:"1rem",borderRight:"2px solid rgba(128, 128, 128, 0.4)"},children:"End"}),c.jsx("div",{style:{...io,textAlign:"right"},children:"All-Time"})]}),!h&&c.jsx(Mz,{isDraftMode:W,allocationsFinalized:A,balanceTotals:U,grandAllTime:ne,...se}),!W&&h&&c.jsx(kz,{allocationsFinalized:A,availableNow:j,currentMonthIncome:D,balanceTotals:U,draftChangeAmount:Q,availableAfterApply:q,currentDraftTotal:M,...se})]}),Object.keys(r).length===0&&c.jsxs("p",{style:{gridColumn:"1 / -1",opacity:.6,textAlign:"center",padding:"2rem"},children:["No categories yet. ",c.jsx(Ft,{to:"/budget/settings/categories",style:{opacity:1},children:"Create categories "})]}),z.map(Z=>{const le=V[Z.id]||[];if(le.length===0)return null;const pe=le.reduce((Ee,[ge])=>{const J=ie(ge);return J?{start:Ee.start+J.start_balance,allocated:Ee.allocated+J.allocated,spent:Ee.spent+J.spent,end:Ee.end+J.end_balance}:Ee},{start:0,allocated:0,spent:0,end:0});return c.jsx(zw,{name:Z.name,categories:le,groupTotals:pe,getCategoryBalance:ie,localAllocations:E,savedAllocations:H,previousMonthIncome:G,isDraftMode:W,onAllocationChange:L,isMobile:h,getAllocationAmount:N},Z.id)}),V.ungrouped?.length>0&&(()=>{const Z=V.ungrouped,le=Z.reduce((pe,[Ee])=>{const ge=ie(Ee);return ge?{start:pe.start+ge.start_balance,allocated:pe.allocated+ge.allocated,spent:pe.spent+ge.spent,end:pe.end+ge.end_balance}:pe},{start:0,allocated:0,spent:0,end:0});return c.jsx(zw,{name:"Uncategorized",categories:Z,groupTotals:le,getCategoryBalance:ie,localAllocations:E,savedAllocations:H,previousMonthIncome:G,isDraftMode:W,onAllocationChange:L,isMobile:h,isUngrouped:!0,getAllocationAmount:N},"ungrouped")})(),c.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]}),c.jsx(wz,{isOpen:S,onClose:()=>x(!1),onDeleted:()=>K(!1)})]})}function ZT(t){return t===0?ae.zero:t>0?ae.success:ae.error}function eA(t){return t===0?ae.zero:t<0?ae.error:ae.success}function tA(t){return t===0?ae.zero:t>0?ae.success:ae.error}function Uw({name:t,accounts:e,groupTotals:n,accountBalances:r,isMobile:a,isUngrouped:o}){const u={padding:"0.6rem 0.5rem",marginTop:"1.25rem",borderTop:"1px solid rgba(255,255,255,0.2)",borderBottom:kf,background:"rgba(255,255,255,0.04)",display:"flex",alignItems:"center",fontSize:"0.9rem",fontWeight:600};return c.jsxs("div",{style:{display:"contents"},children:[!a&&c.jsxs(c.Fragment,{children:[c.jsxs("div",{style:{...u,opacity:o?.7:1},children:[c.jsx("span",{children:t}),c.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",e.length,")"]})]}),c.jsx("div",{style:{...u,justifyContent:"flex-end",color:jt(n.start)},children:$n.showGroupTotals}),c.jsx("div",{style:{...u,justifyContent:"flex-end",color:ZT(n.income)},children:$n.showGroupTotals}),c.jsx("div",{style:{...u,justifyContent:"flex-end",color:eA(n.expenses)},children:$n.showGroupTotals}),c.jsx("div",{style:{...u,justifyContent:"flex-end",color:tA(n.netChange)},children:$n.showGroupTotals}),c.jsx("div",{style:{...u,justifyContent:"flex-end",color:jt(n.end)},children:$n.showGroupTotals})]}),a&&c.jsxs("div",{style:{gridColumn:"1 / -1",padding:"0.6rem 0.5rem",marginTop:"1.25rem",borderTop:"1px solid rgba(255,255,255,0.2)",borderBottom:kf,background:"rgba(255,255,255,0.04)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[c.jsxs("span",{style:{fontWeight:600,opacity:o?.7:1},children:[t,c.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",e.length,")"]})]}),$n.showGroupTotals]}),e.map(([h,f],m)=>{const g=r[h];return g?a?c.jsx("div",{style:{gridColumn:"1 / -1"},children:c.jsx(Bz,{account:f,balance:g})},h):c.jsx(Pz,{account:f,balance:g,isEvenRow:m%2===0},h):null})]})}function Pz({account:t,balance:e,isEvenRow:n}){const a={padding:"0.5rem 0.5rem",background:n?"transparent":"rgba(255,255,255,0.04)",display:"flex",alignItems:"center",fontSize:"0.9rem"};return c.jsxs("div",{style:{display:"contents"},children:[c.jsx("div",{style:{...a,fontWeight:500,overflow:"hidden",paddingLeft:"1.5rem",borderLeft:"2px solid rgba(255,255,255,0.1)"},children:c.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.nickname})}),c.jsx("div",{style:{...a,justifyContent:"flex-end",color:jt(e.start_balance)},children:$e(e.start_balance)}),c.jsxs("div",{style:{...a,justifyContent:"flex-end",color:ZT(e.income)},children:["+",$e(e.income)]}),c.jsx("div",{style:{...a,justifyContent:"flex-end",color:eA(e.expenses)},children:ja(e.expenses)}),c.jsx("div",{style:{...a,justifyContent:"flex-end",color:tA(e.net_change)},children:_r(e.net_change)}),c.jsx("div",{style:{...a,justifyContent:"flex-end",fontWeight:600,color:jt(e.end_balance)},children:$e(e.end_balance)})]})}function Bz({account:t,balance:e}){return c.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",padding:"0.75rem",marginBottom:"0.25rem"},children:[c.jsx("div",{style:{marginBottom:"0.5rem"},children:c.jsx("span",{style:{fontWeight:500},children:t.nickname})}),c.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"0.25rem",fontSize:"0.75rem"},children:[c.jsxs("div",{children:[c.jsx("span",{style:{opacity:.6,display:"block"},children:"Start"}),c.jsx("span",{children:$e(e.start_balance)})]}),c.jsxs("div",{children:[c.jsx("span",{style:{opacity:.6,display:"block"},children:"Net Change"}),c.jsx("span",{style:{color:jt(e.net_change)},children:_r(e.net_change)})]}),c.jsxs("div",{children:[c.jsx("span",{style:{opacity:.6,display:"block"},children:"End"}),c.jsx("span",{style:{color:jt(e.end_balance)},children:$e(e.end_balance)})]})]}),(e.income!==0||e.expenses!==0)&&c.jsxs("div",{style:{marginTop:"0.5rem",paddingTop:"0.5rem",borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)",display:"flex",gap:"1rem",fontSize:"0.7rem",opacity:.7},children:[e.income!==0&&c.jsxs("span",{children:[_r(e.income)," income"]}),e.expenses!==0&&c.jsxs("span",{children:[ja(e.expenses)," expenses"]})]})]})}const yl={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderBottom:"2px solid rgba(255,255,255,0.2)"};function Lz(t){return t===0?ae.zero:t>0?ae.success:ae.error}function zz(t){return t===0?ae.zero:t<0?ae.error:ae.success}function Uz(t){return t===0?ae.zero:t>0?ae.success:ae.error}function Fz(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n}=zt(),{accounts:r,accountGroups:a,monthMap:o}=kn(),{month:u}=_i(t,e,n),h=zs(),f=At(e,n),m=o[f]?.needs_recalculation===!0,g=T.useRef(!1),[_,v]=T.useState(null);T.useEffect(()=>{!t||!u||!m||g.current||(g.current=!0,`${e}${String(n).padStart(2,"0")}`,fm(t,{onProgress:q=>v(q)}).then(()=>{Ve.invalidateQueries({queryKey:xe.month(t,e,n)})}).catch(q=>{console.error("[MonthAccounts] Recalculation failed:",q)}).finally(()=>{g.current=!1,v(null)}))},[t,m,u,e,n]);const S=T.useMemo(()=>Object.entries(a).map(([q,G])=>({id:q,...G})).sort((q,G)=>q.sort_order-G.sort_order),[a]),x=T.useMemo(()=>{const q={};return Object.entries(r).filter(([,G])=>!G.is_hidden).forEach(([G,D])=>{const A=D.account_group_id||"ungrouped";q[A]||(q[A]=[]),q[A].push([G,D])}),Object.keys(q).forEach(G=>{q[G].sort((D,A)=>D[1].sort_order-A[1].sort_order)}),q},[r]),E=T.useMemo(()=>Rz(u,r),[u,r]),C=T.useMemo(()=>Dz(E),[E]),I=C.income+C.expenses,M={...{padding:"0.6rem 0.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem"},borderTop:"2px solid rgba(255,255,255,0.3)",borderBottom:"2px solid rgba(255,255,255,0.3)",fontWeight:600},Q=()=>{if(!_)return"";switch(_.phase){case"reading-budget":return"Reading budget data...";case"fetching-months":return"Fetching months...";case"recalculating":return _.currentMonth?`Recalculating ${_.currentMonth}...`:"Recalculating...";case"saving":return"Saving results...";case"complete":return"Recalculation complete!";default:return"Recalculating balances..."}};return c.jsxs(c.Fragment,{children:[_&&c.jsxs(ic,{message:Q(),spinnerColor:"#22c55e",children:[c.jsx(id,{percent:_.percentComplete,gradient:"linear-gradient(90deg, #22c55e, #10b981)"}),c.jsxs("div",{style:{display:"flex",gap:"2rem",justifyContent:"center",flexWrap:"wrap"},children:[(_.totalMonthsToFetch??0)>0&&c.jsx(on,{value:`${_.monthsFetched||0}/${_.totalMonthsToFetch}`,label:"Months Loaded",color:_.phase==="fetching-months"?"#22c55e":"#6b7280"}),(_.totalMonths??0)>0&&c.jsx(on,{value:`${_.monthsProcessed}/${_.totalMonths}`,label:"Months Recalculated",color:_.phase==="recalculating"?"#22c55e":"#6b7280"})]}),c.jsx(ad,{percent:_.percentComplete})]}),c.jsxs("div",{style:{display:"grid",gridTemplateColumns:h?"1fr":"2fr 1fr 1fr 1fr 1fr 1fr"},children:[c.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"#242424",display:h?"block":"grid",gridTemplateColumns:h?void 0:"subgrid"},children:[!h&&c.jsxs(c.Fragment,{children:[c.jsx("div",{style:yl,children:"Account"}),c.jsx("div",{style:{...yl,textAlign:"right"},children:"Start"}),c.jsx("div",{style:{...yl,textAlign:"right"},children:"Income"}),c.jsx("div",{style:{...yl,textAlign:"right"},children:"Expenses"}),c.jsx("div",{style:{...yl,textAlign:"right"},children:"Net Change"}),c.jsx("div",{style:{...yl,textAlign:"right"},children:"End"})]}),h?c.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem",borderTop:"2px solid rgba(255,255,255,0.3)",borderBottom:"2px solid rgba(255,255,255,0.3)"},children:[c.jsx("span",{style:{fontWeight:600},children:"Grand Totals:"}),c.jsx(Ez,{totals:C})]}):c.jsxs(c.Fragment,{children:[c.jsx("div",{style:{...M},children:"Grand Totals"}),c.jsx("div",{style:{...M,justifyContent:"flex-end",color:jt(C.start)},children:$e(C.start)}),c.jsxs("div",{style:{...M,justifyContent:"flex-end",color:Lz(C.income)},children:["+",$e(C.income)]}),c.jsx("div",{style:{...M,justifyContent:"flex-end",color:zz(C.expenses)},children:ja(C.expenses)}),c.jsx("div",{style:{...M,justifyContent:"flex-end",color:Uz(I)},children:_r(I)}),c.jsx("div",{style:{...M,justifyContent:"flex-end",color:jt(C.end)},children:$e(C.end)})]})]}),Object.keys(r).length===0&&c.jsxs("p",{style:{gridColumn:"1 / -1",opacity:.6,textAlign:"center",padding:"2rem"},children:["No accounts yet."," ",c.jsx(Ft,{to:"/budget/settings/accounts",style:{opacity:1},children:"Add accounts "})]}),S.map(q=>{const G=x[q.id]||[];if(G.length===0)return null;const D=G.reduce((A,[N])=>{const L=E[N];return L?{start:A.start+L.start_balance,income:A.income+L.income,expenses:A.expenses+L.expenses,netChange:A.netChange+L.net_change,end:A.end+L.end_balance}:A},{start:0,income:0,expenses:0,netChange:0,end:0});return c.jsx(Uw,{name:q.name,accounts:G,groupTotals:D,accountBalances:E,isMobile:h},q.id)}),x.ungrouped?.length>0&&(()=>{const q=x.ungrouped,G=q.reduce((D,[A])=>{const N=E[A];return N?{start:D.start+N.start_balance,income:D.income+N.income,expenses:D.expenses+N.expenses,netChange:D.netChange+N.net_change,end:D.end+N.end_balance}:D},{start:0,income:0,expenses:0,netChange:0,end:0});return c.jsx(Uw,{name:"Ungrouped",accounts:q,groupTotals:G,accountBalances:E,isMobile:h,isUngrouped:!0},"ungrouped")})(),c.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]})]})}const Vz=["income","categories","accounts","spend","transfers","adjustments"];function Fw(t){const e=t.year?parseInt(t.year,10):null,n=t.month?parseInt(t.month,10):null,r=t.tab&&Vz.includes(t.tab)?t.tab:null;return{year:e&&!isNaN(e)&&e>=2e3&&e<=2100?e:null,month:n&&!isNaN(n)&&n>=1&&n<=12?n:null,tab:r}}function $z(){const t=new Date;return{year:t.getFullYear(),month:t.getMonth()+1}}function Vw(){const t=MR(),e=Fu(),[n,r]=uE(),{addLoadingHold:a,removeLoadingHold:o}=ir(),{selectedBudgetId:u,setSelectedBudgetId:h,currentYear:f,currentMonthNumber:m,lastActiveTab:g,setCurrentYear:_,setCurrentMonthNumber:v,setLastActiveTab:S,setPageTitle:x,goToPreviousMonth:E,goToNextMonth:C,hasPendingInvites:I,needsFirstBudget:j}=zt(),{budget:M,isLoading:Q}=kn(),q=!Q,[G,D]=T.useState(!1);T.useEffect(()=>(q||a("budget-data","Loading budget data..."),()=>o("budget-data")),[q,a,o]);const A=T.useRef(!1),N=n.get("error"),[L,P]=T.useState(N);T.useEffect(()=>{N&&(n.delete("error"),r(n,{replace:!0}))},[N,n,r]);const[B,O]=T.useState(()=>{const{tab:ie}=Fw(t);return ie??g}),K=ie=>{O(ie),S(ie)};T.useEffect(()=>{if(A.current)return;const{year:ie,month:U}=Fw(t);ie&&_(ie),U&&v(U),A.current=!0},[t,_,v]),T.useEffect(()=>{if(!A.current)return;const ie=`/budget/${f}/${m}/${B}`,U=`/budget/${t.year}/${t.month}/${t.tab}`;ie!==U&&e(ie,{replace:!0})},[f,m,B,e,t]);const{month:Y,error:z,isLoading:V}=_i(q?u:null,f,m);if(T.useEffect(()=>{if(!z||G)return;const ie=z.message||"";if(ie.includes("Budget")&&ie.includes("does not exist")){queueMicrotask(()=>{h(null),e("/budget/my-budgets?context=budget-not-found",{replace:!0})});return}(ie.includes("months in the past")||ie.includes("Refusing to create month"))&&queueMicrotask(()=>{a("month-redirect","Redirecting to current month..."),D(!0);const{year:U,month:H}=$z();P(`Cannot create month ${f}/${m} - it's too far in the past. Redirected to current month.`),_(U),v(H)})},[z,G,f,m,_,v,a,h,e]),T.useEffect(()=>{G&&Y&&!V&&queueMicrotask(()=>{D(!1),o("month-redirect")})},[G,Y,V,o]),T.useLayoutEffect(()=>{x(M?.name||"Budget")},[M?.name,x]),T.useEffect(()=>{if(q&&!G){if(!M&&!u){e("/budget/my-budgets",{replace:!0});return}if(!M&&I){e("/budget/my-budgets",{replace:!0});return}if(j){e("/budget/my-budgets",{replace:!0});return}}},[q,G,M,u,I,j,e]),!q||G||!M)return null;function W(){P(null),E()}function ee(){P(null),C()}return c.jsxs(c.Fragment,{children:[L&&c.jsx(Ao,{message:L,onDismiss:()=>P(null)}),c.jsx(lz,{onPreviousMonth:W,onNextMonth:ee}),c.jsx(Y6,{activeTab:B,setActiveTab:K,allocationsFinalized:Y?.are_allocations_finalized}),B==="income"&&c.jsx(fz,{},`${f}-${m}`),B==="categories"&&c.jsx(Nz,{},`${f}-${m}`),B==="accounts"&&c.jsx(Fz,{},`${f}-${m}`),B==="spend"&&c.jsx(pz,{},`${f}-${m}`),B==="transfers"&&c.jsx(vz,{},`${f}-${m}`),B==="adjustments"&&c.jsx(Sz,{},`${f}-${m}`)]})}function qz(){const{setPageTitle:t}=zt();return T.useLayoutEffect(()=>{t("Analytics")},[t]),c.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"50vh",textAlign:"center",gap:"1.5rem"},children:[c.jsx("div",{style:{fontSize:"4rem",opacity:.8},children:""}),c.jsx("h1",{style:{margin:0,fontSize:"2rem",fontWeight:600},children:"Analytics"}),c.jsx("p",{style:{margin:0,fontSize:"1.25rem",opacity:.6,maxWidth:"400px"},children:"Coming Soon"}),c.jsx("p",{style:{margin:0,fontSize:"0.95rem",opacity:.5,maxWidth:"500px",lineHeight:1.6},children:"Track spending trends, category breakdowns, and insights about your budget over time."}),c.jsx(Ft,{to:"/budget",style:{marginTop:"1rem",padding:"0.75rem 1.5rem",background:ae.primary,color:"white",borderRadius:"8px",textDecoration:"none",fontWeight:500,transition:"opacity 0.15s"},children:"Back to Budget"})]})}function Hz({message:t,onDismiss:e}){return c.jsxs("div",{style:{background:"rgba(220, 38, 38, 0.1)",border:"1px solid rgba(220, 38, 38, 0.3)",color:"#f87171",padding:"0.75rem 1rem",borderRadius:"8px",marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[c.jsx("span",{children:t}),c.jsx("button",{onClick:e,style:{background:"transparent",border:"none",color:"#f87171",cursor:"pointer",fontSize:"1.2rem",padding:"0 0.25rem",lineHeight:1},children:""})]})}function Gz({message:t,onDismiss:e}){return c.jsxs("div",{style:{background:"rgba(34, 197, 94, 0.1)",border:"1px solid rgba(34, 197, 94, 0.3)",color:"#4ade80",padding:"0.75rem 1rem",borderRadius:"8px",marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[c.jsx("span",{children:t}),c.jsx("button",{onClick:e,style:{background:"transparent",border:"none",color:"#4ade80",cursor:"pointer",fontSize:"1.2rem",padding:"0 0.25rem",lineHeight:1},children:""})]})}function Qz({budgetIdInput:t,setBudgetIdInput:e,isCheckingManual:n,manualInvite:r,isAccepting:a,onCheckInvite:o,onAcceptInvite:u,onCancel:h}){return c.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px"},children:[c.jsxs("h3",{style:{margin:"0 0 0.75rem 0",fontSize:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[c.jsx("span",{children:""})," Join Budget by ID"]}),c.jsx("p",{style:{margin:"0 0 1rem 0",fontSize:"0.9rem",opacity:.7},children:"If someone shared a budget ID with you, enter it below to accept the invitation:"}),r?c.jsxs("div",{style:{background:"color-mix(in srgb, #22c55e 10%, transparent)",border:"1px solid color-mix(in srgb, #22c55e 30%, transparent)",padding:"1rem",borderRadius:"8px"},children:[c.jsx("p",{style:{margin:"0 0 0.75rem 0",fontWeight:500},children:" You've been invited to join:"}),c.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 8%, transparent)",padding:"0.75rem 1rem",borderRadius:"6px",marginBottom:"1rem"},children:[c.jsx("p",{style:{margin:"0 0 0.25rem 0",fontWeight:600,fontSize:"1.1rem"},children:r.budgetName}),r.ownerEmail&&c.jsxs("p",{style:{margin:0,fontSize:"0.9rem",opacity:.7},children:["Owner: ",r.ownerEmail]})]}),c.jsxs("div",{style:{display:"flex",gap:"0.75rem"},children:[c.jsx("button",{onClick:u,disabled:a===r.budgetId,style:{background:"#22c55e",color:"white",border:"none",padding:"0.6rem 1.25rem",borderRadius:"6px",cursor:a===r.budgetId?"not-allowed":"pointer",fontWeight:500,opacity:a===r.budgetId?.7:1},children:a===r.budgetId?"Accepting...":"Accept Invitation"}),c.jsx("button",{onClick:h,disabled:a===r.budgetId,style:{background:"transparent",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)",padding:"0.6rem 1.25rem",borderRadius:"6px",cursor:a===r.budgetId?"not-allowed":"pointer",fontWeight:500,opacity:a===r.budgetId?.7:.8},children:"Cancel"})]})]}):c.jsxs("form",{onSubmit:o,style:{display:"flex",gap:"0.75rem"},children:[c.jsx("input",{type:"text",value:t,onChange:f=>e(f.target.value),placeholder:"Enter Budget ID",style:{flex:1,padding:"0.6rem 0.8rem",borderRadius:"6px",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"0.95rem",color:"inherit"}}),c.jsx("button",{type:"submit",disabled:n||!t.trim(),style:{background:"#646cff",color:"white",border:"none",padding:"0.6rem 1.25rem",borderRadius:"6px",cursor:n||!t.trim()?"not-allowed":"pointer",fontWeight:500,opacity:n||!t.trim()?.7:1,whiteSpace:"nowrap"},children:n?"Checking...":"Check Invite"})]})]})}function Wz({currentUserId:t}){return c.jsxs("div",{style:{marginTop:"1.5rem",padding:"1rem",background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"6px",fontSize:"0.85rem",opacity:.7},children:[c.jsx("p",{style:{margin:"0 0 0.5rem 0"},children:" Share your User ID with budget owners so they can invite you:"}),c.jsx("code",{style:{display:"block",padding:"0.5rem 0.75rem",background:"color-mix(in srgb, currentColor 8%, transparent)",borderRadius:"4px",fontSize:"0.8rem",wordBreak:"break-all"},children:t})]})}function Kz(){const{addLoadingHold:t,removeLoadingHold:e}=ir(),{selectedBudgetId:n,currentUserId:r,accessibleBudgets:a,loadAccessibleBudgets:o,switchToBudget:u,checkBudgetInvite:h,isInitialized:f,setPageTitle:m,needsFirstBudget:g}=zt(),_=T.useRef(!1),[v,S]=uE(),x=v.get("context");T.useEffect(()=>{x&&(v.delete("context"),S(v,{replace:!0}))},[x,v,S]);const E=x==="budget-not-found",C=g&&a.length===0;T.useLayoutEffect(()=>{m("My Budgets")},[m]),T.useEffect(()=>{f&&!_.current&&(_.current=!0,o())},[f,o]);const{budget:I,renameBudget:j,acceptInvite:M,createBudget:Q,isLoading:q}=kn(),[G,D]=T.useState(null),[A,N]=T.useState(null),[L,P]=T.useState(null),[B,O]=T.useState(null),[K,Y]=T.useState(null),[z,V]=T.useState(""),[W,ee]=T.useState(!1),[ie,U]=T.useState(""),[H,ne]=T.useState(!1),[se,Z]=T.useState(null),[le,pe]=T.useState(""),[Ee,ge]=T.useState(!1);async function J(je){if(je!==I?.id){D(je),P(null),O(null);try{await u(je),O("Switched to budget successfully!"),await o({force:!0})}catch(Ye){P(Ye instanceof Error?Ye.message:"Failed to switch budget")}finally{D(null)}}}async function Se(je){N(je),P(null),O(null);try{await M(je),O("Invitation accepted! You now have access to this budget."),await o({force:!0})}catch(Ye){P(Ye instanceof Error?Ye.message:"Failed to accept invitation")}finally{N(null)}}async function Ae(je){if(je.preventDefault(),!!ie.trim()){ne(!0),P(null),Z(null);try{const Ye=await h(ie.trim());Ye?Z(Ye):P("No pending invitation found for this budget ID. Make sure you've been invited by the budget owner.")}catch(Ye){P(Ye instanceof Error?Ye.message:"Failed to check invitation")}finally{ne(!1)}}}async function ct(){if(se){se.budgetName,N(se.budgetId),P(null);try{await M(se.budgetId),O(`Successfully joined "${se.budgetName}"!`),Z(null),U(""),await o({force:!0})}catch(je){P(je instanceof Error?je.message:"Failed to accept invitation")}finally{N(null)}}}function Me(je,Ye){V(Ye),Y(je)}async function Oe(je){if(je.preventDefault(),!(!z.trim()||!K)){z.trim(),ee(!0),P(null),O(null);try{await j(z.trim()),O("Budget renamed successfully!"),Y(null),await o({force:!0})}catch(Ye){P(Ye instanceof Error?Ye.message:"Failed to rename budget")}finally{ee(!1)}}}async function ot(je){je.preventDefault(),le.trim(),ge(!0),P(null),O(null);try{const Ye=await Q(le.trim()||"My Budget");await u(Ye.budgetId),O("Budget created successfully!"),pe(""),await o({force:!0})}catch(Ye){P(Ye instanceof Error?Ye.message:"Failed to create budget")}finally{ge(!1)}}const Sn=a.filter(je=>!je.isPending),Qn=a.filter(je=>je.isPending);if(T.useEffect(()=>(q||!f?t("my-budgets","Loading your budgets..."):e("my-budgets"),()=>e("my-budgets")),[q,f,t,e]),q||!f)return null;let mt="My Budgets",Dt="Switch between budgets, accept invitations, or create a new budget.";return E?(mt="Budget Not Found",Dt="Your selected budget could not be found. It may have been deleted. Select another budget or create a new one."):C&&(mt="Welcome!",Dt="Get started by creating your first budget or accepting an invitation."),c.jsxs("div",{children:[c.jsx("h1",{children:mt}),c.jsx("p",{style:{opacity:.7,marginBottom:"1.5rem"},children:Dt}),L&&c.jsx(Hz,{message:L,onDismiss:()=>P(null)}),B&&c.jsx(Gz,{message:B,onDismiss:()=>O(null)}),Qn.length>0&&c.jsxs("div",{style:{background:"color-mix(in srgb, #f59e0b 10%, transparent)",border:"1px solid color-mix(in srgb, #f59e0b 30%, transparent)",padding:"1.25rem",borderRadius:"8px",marginBottom:"1.5rem"},children:[c.jsxs("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[c.jsx("span",{children:""})," Pending Invitations (",Qn.length,")"]}),c.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:Qn.map(je=>c.jsx(jw,{budget:je,isCurrent:!1,isAccepting:A===je.id,isSwitching:!1,isEditing:!1,editName:"",isRenaming:!1,onAccept:()=>Se(je.id),onSwitch:()=>{},onStartEdit:()=>{},onCancelEdit:()=>{},onEditNameChange:()=>{},onSaveEdit:()=>{}},je.id))})]}),Sn.length>0&&c.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px",marginBottom:"1.5rem"},children:[c.jsxs("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[c.jsx("span",{children:""})," Your Budgets (",Sn.length,")"]}),c.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:Sn.map(je=>c.jsx(jw,{budget:je,isCurrent:je.id===n,isAccepting:!1,isSwitching:G===je.id,isEditing:K===je.id,editName:K===je.id?z:"",isRenaming:W,onAccept:()=>{},onSwitch:()=>J(je.id),onStartEdit:()=>Me(je.id,je.name),onCancelEdit:()=>{Y(null),V("")},onEditNameChange:V,onSaveEdit:Oe},je.id))})]}),c.jsxs("div",{style:{background:"color-mix(in srgb, #646cff 8%, transparent)",border:"1px solid color-mix(in srgb, #646cff 25%, transparent)",padding:"1.5rem",borderRadius:"8px",marginBottom:"1.5rem"},children:[c.jsxs("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[c.jsx("span",{children:""})," Create New Budget"]}),c.jsxs("form",{onSubmit:ot,children:[c.jsxs("div",{style:{marginBottom:"1rem"},children:[c.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.9rem",opacity:.8},children:"Budget Name"}),c.jsx("input",{type:"text",value:le,onChange:je=>pe(je.target.value),placeholder:"My Budget",style:{width:"100%",padding:"0.6rem 0.8rem",borderRadius:"6px",border:"1px solid color-mix(in srgb, currentColor 25%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"0.95rem",color:"inherit",boxSizing:"border-box"}}),c.jsx("p",{style:{margin:"0.5rem 0 0 0",fontSize:"0.8rem",opacity:.5},children:"You can always rename this later"})]}),c.jsx("button",{type:"submit",disabled:Ee,style:{background:ae.primary,color:"white",border:"none",padding:"0.6rem 1.5rem",borderRadius:"6px",cursor:Ee?"not-allowed":"pointer",fontWeight:500,opacity:Ee?.7:1,fontSize:"0.9rem"},children:Ee?"Creating...":"Create Budget"})]})]}),c.jsx(Qz,{budgetIdInput:ie,setBudgetIdInput:U,isCheckingManual:H,manualInvite:se,isAccepting:A,onCheckInvite:Ae,onAcceptInvite:ct,onCancel:()=>{Z(null),U("")}}),r&&c.jsx(Wz,{currentUserId:r})]})}const Yz=["accounts","categories","users"];function Xz(){const{addLoadingHold:t,removeLoadingHold:e}=ir(),{lastSettingsTab:n,setLastSettingsTab:r,setPageTitle:a}=zt();T.useLayoutEffect(()=>{a("Budget Settings")},[a]);const{isOwner:o,isLoading:u}=kn();T.useEffect(()=>(u?t("settings","Loading settings..."):e("settings"),()=>e("settings")),[u,t,e]);const h=zn(),f=h.pathname==="/budget/settings",m=T.useMemo(()=>{const x=h.pathname;return x.includes("/settings/accounts")?"accounts":x.includes("/settings/categories")?"categories":x.includes("/settings/users")?"users":"categories"},[h.pathname]),g=m==="users";T.useEffect(()=>{f||r(m)},[m,f,r]);function _(){return!Yz.includes(n)||n==="users"&&!o?"categories":n}const v=T.useMemo(()=>[{id:"accounts",label:"Accounts",icon:""},{id:"categories",label:"Categories",icon:""},{id:"users",label:"Users",icon:"",hidden:!o}],[o]);return u?null:!o&&g?c.jsxs("div",{children:[c.jsx("h1",{children:"Access Denied"}),c.jsx("p",{style:{opacity:.7},children:"Only the budget owner can access this section."}),c.jsx("p",{style:{marginTop:"1rem"},children:c.jsx(Ft,{to:"/budget/settings/categories",children:"Go to Categories "})})]}):c.jsxs("div",{children:[c.jsx(Pf,{mode:"link",linkPrefix:"/budget/settings",tabs:v,activeTab:f?_():m}),f?c.jsx(Lf,{to:`/budget/settings/${_()}`,replace:!0}):c.jsx(XT,{children:c.jsx(zf,{})})]})}function Lu({initialData:t,onSubmit:e,onCancel:n,submitLabel:r,accountGroups:a,showGroupSelector:o=!1,showIncomeSettings:u=!1,hasExistingIncomeDefault:h=!1,hasExistingOutgoDefault:f=!1,currentGroupId:m}){const[g,_]=T.useState(t||{nickname:"",account_group_id:null,is_income_account:!1,is_income_default:!1,is_outgo_account:!1,is_outgo_default:!1,on_budget:!0,is_active:!0,is_hidden:!1}),v=g.account_group_id||m,S=v?a.find(M=>M.id===v):null,x=S?.is_active!==void 0,E=S?.on_budget!==void 0;function C(M){M.preventDefault(),g.nickname.trim()&&e(g)}function I(M){_({...g,is_income_account:M,is_income_default:M?g.is_income_default:!1})}function j(M){_({...g,is_outgo_account:M,is_outgo_default:M?g.is_outgo_default:!1})}return c.jsxs(pi,{actionName:r==="Create Account"?"Create Account":"Update Account",onSubmit:C,children:[c.jsx(Ct,{label:"Account Nickname",htmlFor:"account-nickname",children:c.jsx(gi,{id:"account-nickname",type:"text",value:g.nickname,onChange:M=>_({...g,nickname:M.target.value}),placeholder:"e.g., Main Checking, Savings",required:!0,autoFocus:!0})}),o&&c.jsx(Ct,{label:"Account Type",htmlFor:"account-group",children:c.jsxs(Bu,{id:"account-group",value:g.account_group_id||"ungrouped",onChange:M=>_({...g,account_group_id:M.target.value==="ungrouped"?null:M.target.value}),children:[c.jsx("option",{value:"ungrouped",children:"Ungrouped"}),a.map(M=>c.jsx("option",{value:M.id,children:M.name},M.id))]})}),u&&c.jsxs("div",{style:{padding:"0.75rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",display:"flex",flexDirection:"column",gap:"0.75rem"},children:[c.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[c.jsx("p",{style:{margin:0,fontSize:"0.85rem",opacity:.7},children:"Account Status"}),c.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[c.jsx(Pr,{id:"is-active",checked:x?S.is_active:g.is_active!==!1,onChange:M=>_({...g,is_active:M.target.checked}),disabled:x,children:c.jsx("span",{style:{opacity:x?.5:1},children:"Active account"})}),x&&c.jsxs("p",{style:{margin:0,fontSize:"0.7rem",opacity:.6,marginLeft:"2rem",color:ae.warning},children:['Set by account type "',S.name,'"']})]}),c.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[c.jsx(Pr,{id:"on-budget",checked:E?S.on_budget:g.on_budget!==!1,onChange:M=>_({...g,on_budget:M.target.checked}),disabled:E,children:c.jsx("span",{style:{opacity:E?.5:1},children:"On budget (affects budget totals)"})}),E&&c.jsxs("p",{style:{margin:0,fontSize:"0.7rem",opacity:.6,marginLeft:"2rem",color:ae.warning},children:['Set by account type "',S.name,'"']})]}),c.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[c.jsx(Pr,{id:"is-hidden",checked:g.is_hidden||!1,onChange:M=>_({...g,is_hidden:M.target.checked}),children:"Hidden account"}),c.jsx("p",{style:{margin:0,fontSize:"0.7rem",opacity:.6,marginLeft:"2rem"},children:"Hidden accounts don't appear in dropdowns or balance displays. Use for historical accounts that aren't actively used."})]})]}),c.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[c.jsx("p",{style:{margin:0,fontSize:"0.85rem",opacity:.7},children:"Income Settings"}),c.jsx(Pr,{id:"is-income-account",checked:g.is_income_account||!1,onChange:M=>I(M.target.checked),children:"Show in income deposit list"}),g.is_income_account&&c.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem",marginLeft:"2rem"},children:[c.jsx(Pr,{id:"is-income-default",checked:g.is_income_default||!1,onChange:M=>_({...g,is_income_default:M.target.checked}),disabled:h&&!t?.is_income_default,children:"Default account for new income"}),h&&!t?.is_income_default&&c.jsx("p",{style:{margin:0,fontSize:"0.75rem",opacity:.5},children:"Another account is already set as default"})]})]}),c.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[c.jsx("p",{style:{margin:0,fontSize:"0.85rem",opacity:.7},children:"Expense Settings"}),c.jsx(Pr,{id:"is-outgo-account",checked:g.is_outgo_account||!1,onChange:M=>j(M.target.checked),children:"Show in expense account list"}),g.is_outgo_account&&c.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem",marginLeft:"2rem"},children:[c.jsx(Pr,{id:"is-outgo-default",checked:g.is_outgo_default||!1,onChange:M=>_({...g,is_outgo_default:M.target.checked}),disabled:f&&!t?.is_outgo_default,children:"Default account for new expenses"}),f&&!t?.is_outgo_default&&c.jsx("p",{style:{margin:0,fontSize:"0.75rem",opacity:.5},children:"Another account is already set as default"})]})]})]}),c.jsxs(Aa,{children:[c.jsx(De,{type:"submit",actionName:r,children:r}),c.jsx(De,{type:"button",variant:"secondary",actionName:"Cancel Account Form",onClick:n,children:"Cancel"})]})]})}function $w({label:t,value:e,onChange:n,trueLabel:r,falseLabel:a,undefinedLabel:o}){function u(){n(e===void 0?!0:e===!0?!1:void 0)}const h=e===!0?r:e===!1?a:o,f=e===!0?ae.success:e===!1?ae.warning:"inherit",m=e===!0?"":e===!1?"":"";return c.jsxs("button",{type:"button",onClick:u,style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 0.75rem",background:e!==void 0?`color-mix(in srgb, ${f} 15%, transparent)`:"color-mix(in srgb, currentColor 8%, transparent)",border:e!==void 0?`1px solid color-mix(in srgb, ${f} 40%, transparent)`:"1px solid color-mix(in srgb, currentColor 20%, transparent)",borderRadius:"6px",cursor:"pointer",fontSize:"0.85rem",color:"inherit",textAlign:"left",width:"100%"},children:[c.jsx("span",{style:{width:"1.25rem",height:"1.25rem",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"4px",background:e!==void 0?f:"color-mix(in srgb, currentColor 20%, transparent)",color:e!==void 0?"white":"inherit",fontWeight:600,fontSize:"0.75rem"},children:m}),c.jsxs("span",{style:{flex:1},children:[c.jsxs("span",{style:{opacity:.7},children:[t,":"]})," ",c.jsx("span",{style:{fontWeight:500,color:f},children:h})]}),c.jsx("span",{style:{fontSize:"0.7rem",opacity:.5},children:"click to cycle"})]})}function nA({initialData:t,onSubmit:e,onCancel:n,submitLabel:r}){const[a,o]=T.useState(t||{name:"",expected_balance:"positive"});function u(h){h.preventDefault(),a.name.trim()&&e(a)}return c.jsxs(pi,{actionName:r==="Create Account Type"?"Create Account Type":"Update Account Type",onSubmit:u,children:[c.jsx(Ct,{label:"Account Type Name",htmlFor:"group-name",children:c.jsx(gi,{id:"group-name",type:"text",value:a.name,onChange:h=>o({...a,name:h.target.value}),placeholder:"e.g., Checking, Savings, Credit Cards, Investments",required:!0,autoFocus:!0})}),c.jsx(Ct,{label:"Expected Balance",htmlFor:"expected-balance",children:c.jsxs(Bu,{id:"expected-balance",value:a.expected_balance,onChange:h=>o({...a,expected_balance:h.target.value}),children:[c.jsx("option",{value:"positive",children:"Normally Positive (e.g., Checking, Savings)"}),c.jsx("option",{value:"negative",children:"Normally Negative (e.g., Credit Cards, Loans)"}),c.jsx("option",{value:"any",children:"Either (no warnings)"})]})}),c.jsxs("div",{style:{padding:"0.75rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",display:"flex",flexDirection:"column",gap:"0.5rem"},children:[c.jsxs("p",{style:{margin:0,fontSize:"0.85rem",opacity:.7},children:["Group-Level Overrides ",c.jsx("span",{style:{fontSize:"0.75rem",opacity:.6},children:"(applies to all accounts in this type)"})]}),c.jsx($w,{label:"Active status",value:a.is_active,onChange:h=>o({...a,is_active:h}),trueLabel:"All active",falseLabel:"All inactive",undefinedLabel:"Per account"}),c.jsx($w,{label:"Budget status",value:a.on_budget,onChange:h=>o({...a,on_budget:h}),trueLabel:"All on budget",falseLabel:"All off budget",undefinedLabel:"Per account"})]}),c.jsxs(Aa,{children:[c.jsx(De,{type:"submit",actionName:r,children:r}),c.jsx(De,{type:"button",variant:"secondary",actionName:"Cancel Account Type Form",onClick:n,children:"Cancel"})]})]})}function _l({icon:t,label:e,variant:n,title:r}){const o={success:{background:`color-mix(in srgb, ${ae.success} 20%, transparent)`,border:`1px solid color-mix(in srgb, ${ae.success} 40%, transparent)`,color:ae.success,opacity:1},warning:{background:`color-mix(in srgb, ${ae.warning} 15%, transparent)`,border:`1px solid color-mix(in srgb, ${ae.warning} 35%, transparent)`,color:ae.warning,opacity:1},muted:{background:"color-mix(in srgb, currentColor 12%, transparent)",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",color:"inherit",opacity:.7},income:{background:`color-mix(in srgb, ${ae.success} 10%, transparent)`,border:`1px solid color-mix(in srgb, ${ae.success} 25%, transparent)`,color:ae.success,opacity:.7},expense:{background:`color-mix(in srgb, ${ae.warning} 10%, transparent)`,border:`1px solid color-mix(in srgb, ${ae.warning} 25%, transparent)`,color:ae.warning,opacity:.7}}[n];return c.jsxs("span",{title:r||e,style:{display:"inline-flex",alignItems:"center",gap:"0.25rem",background:o.background,border:o.border,padding:"0.15rem 0.4rem",borderRadius:"4px",fontSize:"0.7rem",fontWeight:500,textTransform:"uppercase",letterSpacing:"0.3px",color:o.color,opacity:o.opacity,whiteSpace:"nowrap"},children:[c.jsx("span",{style:{fontSize:"0.75rem"},children:t}),e]})}function rA({account:t,accountGroups:e}){const n=[],r=t.account_group_id?e.find(u=>u.id===t.account_group_id):null,a=r?.is_active!==void 0?r.is_active:t.is_active!==!1,o=r?.on_budget!==void 0?r.on_budget:t.on_budget!==!1;if(!a){const u=r?.is_active!==void 0;n.push(c.jsx(_l,{icon:"",label:u?"Inactive (type)":"Inactive",variant:"warning",title:u?`Set by "${r.name}" account type`:"Account is inactive/archived"},"inactive"))}if(!o){const u=r?.on_budget!==void 0;n.push(c.jsx(_l,{icon:"",label:u?"Off Budget (type)":"Off Budget",variant:"warning",title:u?`Set by "${r.name}" account type`:"Tracking only - not included in budget"},"off-budget"))}return t.is_income_default?n.push(c.jsx(_l,{icon:"",label:"Income Default",variant:"success",title:"Default income deposit account"},"income-default")):t.is_income_account&&n.push(c.jsx(_l,{icon:"",label:"Income",variant:"income",title:"Income deposit account"},"income")),t.is_outgo_default?n.push(c.jsx(_l,{icon:"",label:"Expense Default",variant:"warning",title:"Default expense account"},"outgo-default")):t.is_outgo_account&&n.push(c.jsx(_l,{icon:"",label:"Expense",variant:"expense",title:"Expense account"},"outgo")),n.length===0?null:c.jsx(c.Fragment,{children:n})}function Jz({group:t}){const e=[];return t.is_active===!1?e.push(c.jsx("span",{style:{fontSize:"0.65rem",fontWeight:500,padding:"0.15rem 0.35rem",borderRadius:"4px",background:`color-mix(in srgb, ${ae.warning} 20%, transparent)`,color:ae.warning,whiteSpace:"nowrap"},title:"All accounts in this type are inactive",children:"All Inactive"},"inactive")):t.is_active===!0&&e.push(c.jsx("span",{style:{fontSize:"0.65rem",fontWeight:500,padding:"0.15rem 0.35rem",borderRadius:"4px",background:`color-mix(in srgb, ${ae.success} 20%, transparent)`,color:ae.success,whiteSpace:"nowrap"},title:"All accounts in this type are active",children:"All Active"},"active")),t.on_budget===!1?e.push(c.jsx("span",{style:{fontSize:"0.65rem",fontWeight:500,padding:"0.15rem 0.35rem",borderRadius:"4px",background:`color-mix(in srgb, ${ae.warning} 20%, transparent)`,color:ae.warning,whiteSpace:"nowrap"},title:"All accounts in this type are off budget",children:"All Off Budget"},"off-budget")):t.on_budget===!0&&e.push(c.jsx("span",{style:{fontSize:"0.65rem",fontWeight:500,padding:"0.15rem 0.35rem",borderRadius:"4px",background:`color-mix(in srgb, ${ae.success} 20%, transparent)`,color:ae.success,whiteSpace:"nowrap"},title:"All accounts in this type are on budget",children:"All On Budget"},"on-budget")),e.length===0?null:c.jsx(c.Fragment,{children:e})}function sA({isActive:t,onDragOver:e,onDragLeave:n,onDrop:r}){return c.jsxs("div",{onDragOver:e,onDragLeave:n,onDrop:r,style:{position:"relative",height:"2rem",marginTop:"-0.25rem"},children:[c.jsx("div",{style:{position:"absolute",top:"50%",left:0,right:0,height:"3px",background:ae.primary,borderRadius:"2px",opacity:t?1:.3,transition:"opacity 0.15s",boxShadow:t?"0 0 8px rgba(100, 108, 255, 0.6)":"none"}}),t&&c.jsx("span",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"0.75rem",opacity:.7,background:"var(--background, #1a1a1a)",padding:"0 0.5rem",whiteSpace:"nowrap"},children:"Move to end"})]})}function Zz({group:t,accountCount:e,groupTotal:n,canMoveUp:r,canMoveDown:a,isMobile:o,createForGroupId:u,onEdit:h,onDelete:f,onMoveUp:m,onMoveDown:g,onAddAccount:_}){return c.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:o?"0.5rem":"0.75rem",paddingBottom:"0.5rem",borderBottom:"1px solid color-mix(in srgb, currentColor 15%, transparent)",gap:"0.5rem",flexWrap:o?"wrap":"nowrap"},children:[c.jsxs("h3",{style:{...ym,margin:0,display:"flex",alignItems:"center",gap:"0.5rem",flex:1,minWidth:0,flexWrap:"wrap"},children:[!o&&c.jsx("span",{style:{cursor:"grab",opacity:.4},children:""}),c.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",borderBottom:"2px solid currentColor",paddingBottom:"2px"},children:t.name}),c.jsxs("span",{style:{opacity:.5,fontWeight:400,fontSize:"0.9rem",flexShrink:0},children:["(",e,")"]}),$n.showGroupTotals,c.jsx(Jz,{group:t})]}),c.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0,alignItems:"center"},children:[!o&&c.jsx(De,{variant:"small",actionName:`Open Add Account Form (${t.name})`,onClick:_,disabled:u!==null,children:"+ Account"}),c.jsx("button",{onClick:()=>{t.name,h()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Edit account type",children:""}),c.jsx("button",{onClick:()=>{t.name,f()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Delete account type",children:""}),c.jsxs("div",{style:k0,children:[c.jsx("button",{onClick:m,disabled:!r,style:{...Ul,opacity:r?.6:.2,cursor:r?"pointer":"default"},title:"Move up","aria-label":"Move up",children:""}),c.jsx("button",{onClick:g,disabled:!a,style:{...Ul,opacity:a?.6:.2,cursor:a?"pointer":"default"},title:"Move down","aria-label":"Move down",children:""})]})]})]})}function eU(t,e){return!e||e==="any"||t===0?!1:e==="positive"&&t<0||e==="negative"&&t>0}function tU(t,e){return!e||e==="any"||t===0?null:e==="positive"&&t<0?"Unexpected negative balance":e==="negative"&&t>0?"Unexpected positive balance (credit owed to you?)":null}function nU({group:t,groupIndex:e,totalGroups:n,accounts:r,allGroups:a,allAccounts:o,editingAccountId:u,editingGroupId:h,createForGroupId:f,setEditingAccountId:m,setEditingGroupId:g,setCreateForGroupId:_,dragType:v,draggedId:S,dragOverId:x,dragOverGroupId:E,setDragOverId:C,setDragOverGroupId:I,onAccountDragStart:j,onAccountDragOver:M,onAccountDrop:Q,onGroupDragStart:q,onGroupDragOver:G,onGroupDrop:D,onDragLeave:A,onDragLeaveGroup:N,onDragEnd:L,onDropOnGroup:P,onCreateAccount:B,onUpdateAccount:O,onDeleteAccount:K,onMoveAccount:Y,onUpdateGroup:z,onDeleteGroup:V,onMoveGroup:W}){const ee=zs(),ie=[...r].sort((J,Se)=>J.sort_order-Se.sort_order),U=v==="group"&&S===t.id,H=v==="group"&&x===t.id,ne=v==="account"&&E===t.id,Z=(S&&v==="account"?o[S]:null)&&Object.entries(o).find(([J])=>J===S)?.[1]&&Object.entries(o).find(([J])=>J===S)?.[1]?.account_group_id!==t.id,le=v==="group"&&H&&S!==t.id,pe=e>0,Ee=e<n-1,ge=ie.reduce((J,Se)=>J+Se.balance,0);return c.jsxs("div",{children:[v==="group"&&!U&&c.jsxs("div",{onDragOver:J=>{J.preventDefault(),C(t.id)},onDragLeave:A,onDrop:J=>D(J,t.id),style:{position:"relative",height:le?"2.5rem":"0.5rem",marginBottom:le?"-0.5rem":"-0.25rem",transition:"height 0.15s"},children:[c.jsx("div",{style:{position:"absolute",top:"50%",left:0,right:0,height:"3px",background:ae.primary,borderRadius:"2px",opacity:le?1:0,transition:"opacity 0.15s",boxShadow:le?"0 0 8px rgba(100, 108, 255, 0.6)":"none"}}),le&&c.jsx("span",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"0.75rem",opacity:.7,background:"var(--background, #1a1a1a)",padding:"0 0.5rem",whiteSpace:"nowrap"},children:"Drop here"})]}),c.jsx("div",{draggable:h!==t.id,onDragStart:J=>q(J,t.id),onDragOver:J=>G(J,t.id),onDragLeave:N,onDragEnd:L,onDrop:J=>P(J,t.id),style:{background:U?"color-mix(in srgb, currentColor 3%, transparent)":ne&&Z?`color-mix(in srgb, ${ae.primary} 10%, transparent)`:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"12px",padding:"1rem",opacity:U?.5:1,border:ne&&Z?`2px dashed ${ae.primary}`:"2px solid transparent",cursor:h===t.id?"default":"grab",transition:"all 0.15s"},children:h===t.id?c.jsx(nA,{initialData:{name:t.name,expected_balance:t.expected_balance||"positive",on_budget:t.on_budget,is_active:t.is_active},onSubmit:J=>z(t.id,J),onCancel:()=>g(null),submitLabel:"Save"}):c.jsxs(c.Fragment,{children:[c.jsx(Zz,{group:t,accountCount:ie.length,groupTotal:ge,canMoveUp:pe,canMoveDown:Ee,isMobile:ee,createForGroupId:f,onEdit:()=>g(t.id),onDelete:()=>V(t.id),onMoveUp:()=>W(t.id,"up"),onMoveDown:()=>W(t.id,"down"),onAddAccount:()=>_(t.id)}),ee&&c.jsx("div",{style:{marginBottom:"0.5rem"},children:c.jsx(De,{variant:"small",actionName:`Open Add Account Form (${t.name})`,onClick:()=>_(t.id),disabled:f!==null,children:"+ Account"})}),c.jsxs("div",{style:Fl,children:[ie.map((J,Se)=>u===J.id?c.jsx(Lu,{initialData:{nickname:J.nickname,account_group_id:J.account_group_id,is_income_account:J.is_income_account,is_income_default:J.is_income_default,is_outgo_account:J.is_outgo_account,is_outgo_default:J.is_outgo_default,on_budget:J.on_budget,is_active:J.is_active},onSubmit:Ae=>O(J.id,Ae),onCancel:()=>m(null),submitLabel:"Save",accountGroups:a,showGroupSelector:!0,showIncomeSettings:!0,currentGroupId:J.account_group_id,hasExistingIncomeDefault:Object.entries(o).some(([Ae,ct])=>ct.is_income_default&&Ae!==J.id),hasExistingOutgoDefault:Object.entries(o).some(([Ae,ct])=>ct.is_outgo_default&&Ae!==J.id)},J.id):c.jsx(_m,{isDragging:v==="account"&&S===J.id,isDragOver:x===J.id,onDragStart:Ae=>{Ae.stopPropagation(),j(Ae,J.id)},onDragOver:Ae=>M(Ae,J.id,t.id),onDragLeave:A,onDragEnd:L,onDrop:Ae=>Q(Ae,J.id,t.id),onEdit:()=>{J.nickname,m(J.id)},onDelete:()=>{J.nickname,K(J.id)},onMoveUp:()=>Y(J.id,"up"),onMoveDown:()=>Y(J.id,"down"),canMoveUp:Se>0,canMoveDown:Se<ie.length-1,children:c.jsxs("div",{children:[c.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flexWrap:"wrap"},children:[c.jsx("span",{style:O0,children:J.nickname}),c.jsx(rA,{account:J,accountGroups:a})]}),c.jsxs("p",{style:{margin:"0.25rem 0 0 0",fontSize:"1.1rem",fontWeight:600,color:jt(J.balance)},children:[$e(J.balance),eU(J.balance,t.expected_balance)&&c.jsx("span",{title:tU(J.balance,t.expected_balance)||"",style:{marginLeft:"0.5rem",fontSize:"0.85rem"},children:""})]})]})},J.id)),ie.length===0&&!f&&c.jsx("p",{style:{opacity:.5,fontSize:"0.9rem",margin:"0.5rem 0"},children:"No accounts in this type"}),v==="account"&&ie.length>0&&c.jsx(sA,{groupId:t.id,isActive:x===`__end__${t.id}`,onDragOver:J=>{J.preventDefault(),J.stopPropagation(),C(`__end__${t.id}`),I(t.id)},onDragLeave:J=>{J.stopPropagation(),C(null)},onDrop:J=>{J.stopPropagation(),Q(J,"__group_end__",t.id)}}),f===t.id&&c.jsx(Lu,{initialData:{nickname:"",account_group_id:t.id},onSubmit:J=>B(J,t.id),onCancel:()=>_(null),submitLabel:"Create",accountGroups:a,showIncomeSettings:!0,currentGroupId:t.id})]}),f!==t.id&&c.jsx("div",{style:{marginTop:"0.75rem",paddingTop:"0.5rem",borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},children:c.jsx(De,{variant:"small",actionName:`Open Add Account Form (${t.name})`,onClick:()=>_(t.id),disabled:f!==null,children:"+ Add Account"})})]})})]})}function rU({accounts:t,allGroups:e,allAccounts:n,hasGroups:r,editingAccountId:a,createForGroupId:o,setEditingAccountId:u,setCreateForGroupId:h,dragType:f,draggedId:m,dragOverId:g,dragOverGroupId:_,setDragOverId:v,setDragOverGroupId:S,onAccountDragStart:x,onAccountDragOver:E,onAccountDrop:C,onDragOverGroup:I,onDropOnGroup:j,onDragLeave:M,onDragLeaveGroup:Q,onDragEnd:q,onCreateAccount:G,onUpdateAccount:D,onDeleteAccount:A,onMoveAccount:N}){const L=[...t].sort((K,Y)=>K.sort_order-Y.sort_order),P=f==="account"&&_==="ungrouped",O=(m&&f==="account"?n[m]:null)&&Object.entries(n).find(([K])=>K===m)?.[1]&&Object.entries(n).find(([K])=>K===m)?.[1]?.account_group_id!==null;return L.length===0&&!o&&r&&f!=="account"?null:(L.reduce((K,Y)=>K+Y.balance,0),c.jsxs("div",{onDragOver:K=>I(K,"ungrouped"),onDragLeave:Q,onDrop:K=>j(K,"ungrouped"),style:{background:P&&O?`color-mix(in srgb, ${ae.primary} 10%, transparent)`:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"12px",padding:"1rem",border:P&&O?`2px dashed ${ae.primary}`:"2px solid transparent",transition:"all 0.15s"},children:[c.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.75rem",paddingBottom:"0.5rem",borderBottom:"1px solid color-mix(in srgb, currentColor 15%, transparent)"},children:[c.jsxs("h3",{style:{...ym,margin:0,opacity:.7,display:"flex",alignItems:"center",gap:"0.5rem"},children:[c.jsx("span",{style:{borderBottom:"2px solid currentColor",paddingBottom:"2px"},children:"Ungrouped"}),c.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400,fontSize:"0.9rem"},children:["(",L.length,")"]}),$n.showGroupTotals]}),c.jsx(De,{variant:"small",actionName:"Open Add Account Form (Ungrouped)",onClick:()=>h("ungrouped"),disabled:o!==null,children:"+ Account"})]}),c.jsxs("div",{style:Fl,children:[L.map((K,Y)=>a===K.id?c.jsx(Lu,{initialData:{nickname:K.nickname,account_group_id:K.account_group_id,is_income_account:K.is_income_account,is_income_default:K.is_income_default,is_outgo_account:K.is_outgo_account,is_outgo_default:K.is_outgo_default,on_budget:K.on_budget,is_active:K.is_active},onSubmit:z=>D(K.id,z),onCancel:()=>u(null),submitLabel:"Save",accountGroups:e,showGroupSelector:!0,showIncomeSettings:!0,currentGroupId:null,hasExistingIncomeDefault:Object.entries(n).some(([z,V])=>V.is_income_default&&z!==K.id),hasExistingOutgoDefault:Object.entries(n).some(([z,V])=>V.is_outgo_default&&z!==K.id)},K.id):c.jsx(_m,{isDragging:f==="account"&&m===K.id,isDragOver:g===K.id,onDragStart:z=>x(z,K.id),onDragOver:z=>E(z,K.id,"ungrouped"),onDragLeave:M,onDragEnd:q,onDrop:z=>C(z,K.id,"ungrouped"),onEdit:()=>{K.nickname,u(K.id)},onDelete:()=>{K.nickname,A(K.id)},onMoveUp:()=>N(K.id,"up"),onMoveDown:()=>N(K.id,"down"),canMoveUp:Y>0,canMoveDown:Y<L.length-1,children:c.jsxs("div",{children:[c.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flexWrap:"wrap"},children:[c.jsx("span",{style:O0,children:K.nickname}),c.jsx(rA,{account:K,accountGroups:e})]}),c.jsx("p",{style:{margin:"0.25rem 0 0 0",fontSize:"1.1rem",fontWeight:600,color:jt(K.balance)},children:$e(K.balance)})]})},K.id)),L.length===0&&f==="account"&&c.jsx("p",{style:{opacity:.5,fontSize:"0.9rem",margin:"0.5rem 0",textAlign:"center"},children:"Drop here to ungroup"}),f==="account"&&L.length>0&&c.jsx(sA,{groupId:"ungrouped",isActive:g==="__end__ungrouped",onDragOver:K=>{K.preventDefault(),K.stopPropagation(),v("__end__ungrouped"),S("ungrouped")},onDragLeave:K=>{K.stopPropagation(),v(null)},onDrop:K=>{K.stopPropagation(),C(K,"__group_end__","ungrouped")}}),o==="ungrouped"&&c.jsx(Lu,{initialData:{nickname:"",account_group_id:null},onSubmit:K=>G(K,"ungrouped"),onCancel:()=>h(null),submitLabel:"Create",accountGroups:e,showIncomeSettings:!0,currentGroupId:null})]}),o!=="ungrouped"&&c.jsx("div",{style:{marginTop:"0.75rem",paddingTop:"0.5rem",borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},children:c.jsx(De,{variant:"small",actionName:"Open Add Account Form (Ungrouped)",onClick:()=>h("ungrouped"),disabled:o!==null,children:"+ Add Account"})})]}))}function sU(){const{accounts:t,accountsByGroup:e,hiddenAccounts:n,sortedGroups:r,currentBudget:a,error:o,setError:u,handleCreateAccount:h,handleUpdateAccount:f,handleDeleteAccount:m,handleMoveAccount:g,handleCreateGroup:_,handleUpdateGroup:v,handleDeleteGroup:S,handleMoveGroup:x,reorderAccountsInGroup:E,reorderGroups:C}=AB(),I=zs(),[j,M]=T.useState(null),[Q,q]=T.useState(null),[G,D]=T.useState(null),[A,N]=T.useState(!1),[L,P]=T.useState(null),[B,O]=T.useState(null),[K,Y]=T.useState(null),[z,V]=T.useState(null);function W(J,Se){P("account"),O(Se),J.dataTransfer.effectAllowed="move"}function ee(J,Se,Ae){J.preventDefault(),L==="account"&&(Se!==B&&Y(Se),V(Ae))}function ie(J,Se){J.preventDefault(),L==="account"?(V(Se),Y(null)):L==="group"&&Se!==B&&Y(Se)}function U(){Y(null)}function H(){V(null)}function ne(){P(null),O(null),Y(null),V(null)}async function se(J,Se,Ae){if(J.preventDefault(),J.stopPropagation(),!B||L!=="account"){ne();return}await E(B,Se,Ae),ne()}async function Z(J,Se){J.preventDefault(),L==="account"?await se(J,"__group_end__",Se):L==="group"&&await pe(J,Se)}function le(J,Se){J.stopPropagation(),P("group"),O(Se),J.dataTransfer.effectAllowed="move"}async function pe(J,Se){if(J.preventDefault(),!B||L!=="group"||B===Se){ne();return}await C(B,Se),ne()}const Ee=T.useMemo(()=>{const J=Object.values(t),Se=J.reduce((Me,Oe)=>Me+(Oe.balance??0),0);let Ae=0,ct=0;for(const Me of J){const Oe=r.find(Sn=>Sn.id===Me.account_group_id);Me.on_budget===!0||Me.on_budget===void 0&&Oe?.on_budget!==!1?Ae+=Me.balance??0:ct+=Me.balance??0}return{count:J.length,groupCount:r.length,totalBalance:Se,onBudgetTotal:Ae,offBudgetTotal:ct}},[t,r]);if(!a)return c.jsx("p",{children:"No budget found. Please log in."});const ge=e.ungrouped||[];return c.jsxs("div",{children:[o&&c.jsx(Ao,{message:o,onDismiss:()=>u(null)}),c.jsx("div",{style:{position:"sticky",top:0,zIndex:50,backgroundColor:"#242424",marginLeft:"calc(-1 * var(--page-padding, 2rem))",marginRight:"calc(-1 * var(--page-padding, 2rem))",paddingLeft:"var(--page-padding, 2rem)",paddingRight:"var(--page-padding, 2rem)",paddingTop:"0.5rem",paddingBottom:"0.5rem",borderBottom:"1px solid rgba(255,255,255,0.15)"},children:c.jsxs("div",{style:{display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem"},children:[c.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[c.jsx("span",{style:{fontWeight:600},children:"Accounts:"}),c.jsxs("span",{children:[c.jsx("span",{style:{opacity:.6},children:"On-Budget: "}),c.jsx("span",{style:{color:jt(Ee.onBudgetTotal),fontWeight:600},children:$e(Ee.onBudgetTotal)})]}),Ee.offBudgetTotal!==0&&c.jsxs("span",{children:[c.jsx("span",{style:{opacity:.6},children:"Off-Budget: "}),c.jsx("span",{style:{fontWeight:600,opacity:.7},children:$e(Ee.offBudgetTotal)})]}),c.jsxs("span",{children:[c.jsx("span",{style:{opacity:.6},children:"Total: "}),c.jsx("span",{style:{color:jt(Ee.totalBalance),fontWeight:600},children:$e(Ee.totalBalance)})]}),c.jsx("span",{style:{opacity:.5,fontSize:"0.8rem"},children:I?"Drag to move.":"Drag between types or use  to reorder."})]}),c.jsx("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:c.jsx(z0,{})})]})}),c.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem",marginBottom:"1.5rem",paddingTop:"1rem"},children:[Object.keys(t).length===0&&r.length===0&&c.jsx("p",{style:{opacity:.7},children:"No accounts yet. Create an account type first, then add accounts!"}),r.map((J,Se)=>c.jsx(nU,{group:J,groupIndex:Se,totalGroups:r.length,accounts:e[J.id]||[],allGroups:r,allAccounts:t,editingAccountId:j,editingGroupId:G,createForGroupId:Q,setEditingAccountId:M,setEditingGroupId:D,setCreateForGroupId:q,dragType:L,draggedId:B,dragOverId:K,dragOverGroupId:z,setDragOverId:Y,setDragOverGroupId:V,onAccountDragStart:W,onAccountDragOver:ee,onAccountDrop:se,onGroupDragStart:le,onGroupDragOver:ie,onGroupDrop:pe,onDragLeave:U,onDragLeaveGroup:H,onDragEnd:ne,onDropOnGroup:Z,onCreateAccount:h,onUpdateAccount:(Ae,ct)=>{f(Ae,ct),M(null)},onDeleteAccount:m,onMoveAccount:g,onUpdateGroup:(Ae,ct)=>{v(Ae,ct),D(null)},onDeleteGroup:S,onMoveGroup:x},J.id)),L==="group"&&r.length>0&&c.jsx(B0,{isActive:K==="__end__",onDragOver:J=>{J.preventDefault(),Y("__end__")},onDragLeave:U,onDrop:J=>pe(J,"__end__"),label:"Move account type to end"}),c.jsx(rU,{accounts:ge,allGroups:r,allAccounts:t,hasGroups:r.length>0,editingAccountId:j,createForGroupId:Q,setEditingAccountId:M,setCreateForGroupId:q,dragType:L,draggedId:B,dragOverId:K,dragOverGroupId:z,setDragOverId:Y,setDragOverGroupId:V,onAccountDragStart:W,onAccountDragOver:ee,onAccountDrop:se,onDragOverGroup:ie,onDropOnGroup:Z,onDragLeave:U,onDragLeaveGroup:H,onDragEnd:ne,onCreateAccount:h,onUpdateAccount:(J,Se)=>{f(J,Se),M(null)},onDeleteAccount:m,onMoveAccount:g})]}),n.length>0&&c.jsx("div",{style:{marginBottom:"2rem"},children:c.jsxs(L0,{title:"Hidden Accounts",count:n.length,children:[c.jsxs("div",{style:{padding:"0.75rem",marginBottom:"1rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",fontSize:"0.85rem"},children:[c.jsxs("p",{style:{margin:"0 0 0.5rem 0",opacity:.8},children:[c.jsx("strong",{children:" Hidden accounts"})," are excluded from dropdowns and balance displays. They're useful for historical accounts (like closed bank accounts or old 401Ks) that you want to keep for record-keeping but don't need in everyday use."]}),c.jsx("p",{style:{margin:0,opacity:.6},children:'To unhide an account, click it to edit and uncheck "Hidden account".'})]}),c.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:n.map(J=>j===J.id?c.jsx(Lu,{initialData:{nickname:J.nickname,account_group_id:J.account_group_id,is_income_account:J.is_income_account,is_income_default:J.is_income_default,is_outgo_account:J.is_outgo_account,is_outgo_default:J.is_outgo_default,on_budget:J.on_budget,is_active:J.is_active,is_hidden:J.is_hidden},onSubmit:Se=>{f(J.id,Se),M(null)},onCancel:()=>M(null),submitLabel:"Save",accountGroups:r,showGroupSelector:!0,showIncomeSettings:!0,currentGroupId:J.account_group_id,hasExistingIncomeDefault:Object.entries(t).some(([Se,Ae])=>Ae.is_income_default&&Se!==J.id),hasExistingOutgoDefault:Object.entries(t).some(([Se,Ae])=>Ae.is_outgo_default&&Se!==J.id)},J.id):c.jsxs("div",{onClick:()=>M(J.id),style:{padding:"0.75rem 1rem",background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"8px",cursor:"pointer",display:"flex",justifyContent:"space-between",alignItems:"center",opacity:.7},children:[c.jsx("span",{children:J.nickname}),c.jsx("span",{style:{color:jt(J.balance),fontWeight:500},children:$e(J.balance)})]},J.id))})]})}),A?c.jsx(nA,{onSubmit:J=>{_(J),N(!1)},onCancel:()=>N(!1),submitLabel:"Create Account Type"}):c.jsx(De,{variant:"primary-large",actionName:"Open Add Account Type Form",onClick:()=>N(!0),children:"+ Add Account Type"})]})}function zu({initialData:t,onSubmit:e,onCancel:n,submitLabel:r,categoryGroups:a=[],showGroupSelector:o=!1}){const[u,h]=T.useState(t||{name:"",category_group_id:null,is_hidden:!1}),[f,m]=T.useState(t?.default_monthly_amount?.toString()||""),[g,_]=T.useState(t?.default_monthly_type||"fixed"),[v,S]=T.useState(!1);function x(E){if(E.preventDefault(),!u.name.trim())return;S(!0);const C=parseFloat(f),I=!isNaN(C)&&C>0;e({...u,description:u.description?.trim()||void 0,default_monthly_amount:I?C:void 0,default_monthly_type:I?g:void 0})}return c.jsxs(pi,{actionName:r==="Create"?"Create Category":"Update Category",onSubmit:x,children:[c.jsx(Ct,{label:"Category Name",htmlFor:"category-name",children:c.jsx(gi,{id:"category-name",type:"text",value:u.name,onChange:E=>h({...u,name:E.target.value}),placeholder:"e.g., Groceries, Rent, Gas",required:!0,autoFocus:!0})}),c.jsx(Ct,{label:"Description (optional)",htmlFor:"category-description",children:c.jsx(P0,{id:"category-description",value:u.description||"",onChange:E=>h({...u,description:E.target.value}),placeholder:"What is this category used for?",minHeight:"3rem"})}),o&&c.jsx(Ct,{label:"Category Group",htmlFor:"category-group",children:c.jsxs(Bu,{id:"category-group",value:u.category_group_id||"ungrouped",onChange:E=>h({...u,category_group_id:E.target.value==="ungrouped"?null:E.target.value}),children:[c.jsx("option",{value:"ungrouped",children:"Uncategorized"}),a.map(E=>c.jsx("option",{value:E.id,children:E.name},E.id))]})}),c.jsxs(Ct,{label:"Default Monthly Allocation (optional)",htmlFor:"default-amount",children:[c.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center"},children:[c.jsxs(Bu,{id:"default-type",value:g,onChange:E=>_(E.target.value),style:{width:"auto",flex:"0 0 auto"},children:[c.jsx("option",{value:"fixed",children:"Fixed $"}),c.jsx("option",{value:"percentage",children:"% of Prev Income"})]}),g==="fixed"?c.jsx(co,{id:"default-amount",value:f,onChange:m,placeholder:"$0.00"}):c.jsx(gi,{id:"default-amount",type:"number",value:f,onChange:E=>m(E.target.value),placeholder:"0",min:"0",max:"100",step:"0.1",style:{width:"80px"}}),g==="percentage"&&c.jsx("span",{style:{opacity:.6},children:"%"})]}),c.jsx("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.75rem",opacity:.6},children:g==="fixed"?"Suggested fixed amount to allocate each month":"Percentage of previous month's total income"})]}),o&&c.jsxs("div",{style:{padding:"0.75rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px"},children:[c.jsx(Pr,{id:"is-hidden",checked:u.is_hidden||!1,onChange:E=>h({...u,is_hidden:E.target.checked}),children:"Hidden category"}),c.jsx("p",{style:{margin:"0.25rem 0 0 2rem",fontSize:"0.7rem",opacity:.6},children:"Hidden categories don't appear in dropdowns or balance displays. Use for historical categories that aren't actively used."})]}),c.jsxs(Aa,{children:[c.jsx(De,{type:"submit",actionName:r==="Create"?"Create Category":"Save Category",isLoading:v,children:r}),c.jsx(De,{type:"button",variant:"secondary",actionName:"Cancel Category Form",onClick:n,children:"Cancel"})]})]})}function iA({initialData:t,onSubmit:e,onCancel:n,submitLabel:r}){const[a,o]=T.useState(t||{name:""}),[u,h]=T.useState(!1);function f(m){m.preventDefault(),a.name.trim()&&(h(!0),e(a))}return c.jsxs(pi,{actionName:r==="Create Group"?"Create Category Group":"Update Category Group",onSubmit:f,children:[c.jsx(Ct,{label:"Group Name",htmlFor:"group-name",children:c.jsx(gi,{id:"group-name",type:"text",value:a.name,onChange:m=>o({...a,name:m.target.value}),placeholder:"e.g., Housing, Transportation, Food",required:!0,autoFocus:!0})}),c.jsxs(Aa,{children:[c.jsx(De,{type:"submit",actionName:r==="Create Group"?"Create Category Group":"Save Category Group",isLoading:u,children:r}),c.jsx(De,{type:"button",variant:"secondary",actionName:"Cancel Category Group Form",onClick:n,children:"Cancel"})]})]})}function aA({isActive:t,onDragOver:e,onDragLeave:n,onDrop:r}){return c.jsxs("div",{onDragOver:e,onDragLeave:n,onDrop:r,style:{position:"relative",height:"2rem",marginTop:"-0.25rem"},children:[c.jsx("div",{style:{position:"absolute",top:"50%",left:0,right:0,height:"3px",background:ae.primary,borderRadius:"2px",opacity:t?1:.3,transition:"opacity 0.15s",boxShadow:t?"0 0 8px rgba(100, 108, 255, 0.6)":"none"}}),t&&c.jsx("span",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"0.75rem",opacity:.7,background:"var(--background, #1a1a1a)",padding:"0 0.5rem",whiteSpace:"nowrap"},children:"Move to end"})]})}function oA({category:t,catId:e,categoryBalances:n,loadingBalances:r}){const a=n[e]||{current:0,total:0};return c.jsxs("div",{children:[c.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",flexWrap:"wrap"},children:[c.jsx("span",{style:O0,children:t.name}),t.default_monthly_amount!==void 0&&t.default_monthly_amount>0&&c.jsxs("span",{style:{fontSize:"0.75rem",opacity:.8,background:"color-mix(in srgb, currentColor 10%, transparent)",padding:"0.15rem 0.4rem",borderRadius:"4px"},children:["Default: ",t.default_monthly_type==="percentage"?c.jsxs(c.Fragment,{children:[c.jsxs("span",{style:{color:ae.success,fontWeight:500},children:[t.default_monthly_amount,"%"]})," of prev income"]}):c.jsxs(c.Fragment,{children:[c.jsx("span",{style:{color:ae.success,fontWeight:500},children:$e(t.default_monthly_amount)}),"/mo"]})]})]}),t.description&&c.jsx("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.8rem",opacity:.6,lineHeight:1.3},children:t.description}),c.jsxs("div",{style:{marginTop:"0.25rem"},children:[c.jsxs("p",{style:{margin:0,fontSize:"1rem",fontWeight:600,color:In(a.current)},children:[r?"...":ts(a.current),c.jsx("span",{style:{fontSize:"0.75rem",fontWeight:400,opacity:.6,marginLeft:"0.35rem"},children:"available now"})]}),c.jsxs("p",{style:{margin:"0.15rem 0 0 0",fontSize:"0.85rem",fontWeight:500,color:In(a.total),opacity:.75},children:[r?"...":ts(a.total),c.jsx("span",{style:{fontSize:"0.7rem",fontWeight:400,opacity:.7,marginLeft:"0.35rem"},children:"total allocated"})]})]})]})}function iU({group:t,categoryCount:e,canMoveUp:n,canMoveDown:r,isMobile:a,createForGroupId:o,onEdit:u,onDelete:h,onMoveUp:f,onMoveDown:m,onAddCategory:g,onDragStart:_,onDragEnd:v}){return c.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:a?"0.5rem":"0.75rem",paddingBottom:"0.5rem",borderBottom:"1px solid color-mix(in srgb, currentColor 15%, transparent)",gap:"0.5rem",flexWrap:a?"wrap":"nowrap"},children:[c.jsxs("h3",{style:{...ym,margin:0,display:"flex",alignItems:"center",gap:"0.5rem",flex:1,minWidth:0},children:[!a&&c.jsx("span",{draggable:!0,onDragStart:_,onDragEnd:v,style:{cursor:"grab",opacity:.4,padding:"0.25rem",margin:"-0.25rem",borderRadius:"4px",userSelect:"none"},title:"Drag to reorder group",children:""}),c.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.name}),c.jsxs("span",{style:{opacity:.5,fontWeight:400,fontSize:"0.9rem",flexShrink:0},children:["(",e,")"]})]}),c.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0,alignItems:"center"},children:[!a&&c.jsx(De,{variant:"small",actionName:`Open Add Category Form (${t.name})`,onClick:g,disabled:o!==null,children:"+ Category"}),c.jsx("button",{onClick:()=>{t.name,u()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Edit group",children:""}),c.jsx("button",{onClick:()=>{t.name,h()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Delete group",children:""}),c.jsxs("div",{style:k0,children:[c.jsx("button",{onClick:f,disabled:!n,style:{...Ul,opacity:n?.6:.2,cursor:n?"pointer":"default"},title:"Move group up","aria-label":"Move group up",children:""}),c.jsx("button",{onClick:m,disabled:!r,style:{...Ul,opacity:r?.6:.2,cursor:r?"pointer":"default"},title:"Move group down","aria-label":"Move group down",children:""})]})]})]})}function aU({group:t,groupIndex:e,groupCategories:n,sortedGroups:r,categoryGroups:a,categoryBalances:o,loadingBalances:u,dragType:h,draggedId:f,dragOverId:m,dragOverGroupId:g,editingCategoryId:_,setEditingCategoryId:v,createForGroupId:S,setCreateForGroupId:x,editingGroupId:E,setEditingGroupId:C,handleCreateCategory:I,handleUpdateCategory:j,handleDeleteCategory:M,handleMoveCategory:Q,handleUpdateGroup:q,handleDeleteGroup:G,handleMoveGroup:D,handleCategoryDragStart:A,handleCategoryDragOver:N,handleDragOverGroup:L,handleDragLeave:P,handleDragLeaveGroup:B,handleDragEnd:O,handleCategoryDrop:K,handleDropOnGroup:Y,handleGroupDragStart:z,handleGroupDrop:V,setDragOverId:W,setDragOverGroupId:ee,isMobile:ie,categories:U}){const H=h==="group"&&f===t.id,ne=h==="group"&&m===t.id,se=h==="category"&&g===t.id,Z=f&&h==="category"?U[f]:null,le=Z&&(Z.category_group_id||"ungrouped")!==t.id,pe=h==="group"&&ne&&f!==t.id,Ee=e>0,ge=e<r.length-1;return c.jsxs("div",{children:[h==="group"&&!H&&c.jsxs("div",{onDragOver:J=>{J.preventDefault(),W(t.id)},onDragLeave:P,onDrop:J=>V(J,t.id),style:{position:"relative",height:pe?"2.5rem":"0.5rem",marginBottom:pe?"-0.5rem":"-0.25rem",transition:"height 0.15s"},children:[c.jsx("div",{style:{position:"absolute",top:"50%",left:0,right:0,height:"3px",background:ae.primary,borderRadius:"2px",opacity:pe?1:0,transition:"opacity 0.15s",boxShadow:pe?"0 0 8px rgba(100, 108, 255, 0.6)":"none"}}),pe&&c.jsx("span",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"0.75rem",opacity:.7,background:"var(--background, #1a1a1a)",padding:"0 0.5rem",whiteSpace:"nowrap"},children:"Drop here"})]}),c.jsx("div",{onDragOver:J=>L(J,t.id),onDragLeave:B,onDrop:J=>Y(J,t.id),style:{background:H?"color-mix(in srgb, currentColor 3%, transparent)":se&&le?`color-mix(in srgb, ${ae.primary} 10%, transparent)`:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"12px",padding:"1rem",opacity:H?.5:1,border:se&&le?`2px dashed ${ae.primary}`:"2px solid transparent",transition:"all 0.15s"},children:E===t.id?c.jsx(iA,{initialData:{name:t.name},onSubmit:J=>q(t.id,J),onCancel:()=>C(null),submitLabel:"Save"}):c.jsxs(c.Fragment,{children:[c.jsx(iU,{group:t,categoryCount:n.length,canMoveUp:Ee,canMoveDown:ge,isMobile:ie,createForGroupId:S,onEdit:()=>C(t.id),onDelete:()=>G(t.id),onMoveUp:()=>D(t.id,"up"),onMoveDown:()=>D(t.id,"down"),onAddCategory:()=>x(t.id),onDragStart:J=>z(J,t.id),onDragEnd:O}),ie&&c.jsx("div",{style:{marginBottom:"0.5rem"},children:c.jsx(De,{variant:"small",actionName:`Open Add Category Form (${t.name})`,onClick:()=>x(t.id),disabled:S!==null,children:"+ Category"})}),c.jsxs("div",{style:Fl,children:[n.map(([J,Se])=>_===J?c.jsx(zu,{initialData:{name:Se.name,description:Se.description,category_group_id:Se.category_group_id,default_monthly_amount:Se.default_monthly_amount,default_monthly_type:Se.default_monthly_type,is_hidden:Se.is_hidden},onSubmit:Ae=>{j(J,Ae),v(null)},onCancel:()=>v(null),submitLabel:"Save",categoryGroups:a,showGroupSelector:!0},J):c.jsx(_m,{isDragging:h==="category"&&f===J,isDragOver:m===J,onDragStart:Ae=>{Ae.stopPropagation(),A(Ae,J)},onDragOver:Ae=>N(Ae,J,t.id),onDragLeave:P,onDragEnd:O,onDrop:Ae=>K(Ae,J,t.id),onEdit:()=>{Se.name,v(J)},onDelete:()=>{Se.name,M(J)},onMoveUp:()=>Q(J,"up"),onMoveDown:()=>Q(J,"down"),canMoveUp:n.findIndex(([Ae])=>Ae===J)>0,canMoveDown:n.findIndex(([Ae])=>Ae===J)<n.length-1,children:c.jsx(oA,{category:Se,catId:J,categoryBalances:o,loadingBalances:u})},J)),n.length===0&&!S&&c.jsx("p",{style:{opacity:.5,fontSize:"0.9rem",margin:"0.5rem 0"},children:"No categories in this group"}),h==="category"&&n.length>0&&c.jsx(aA,{groupId:t.id,isActive:m===`__end__${t.id}`,onDragOver:J=>{J.preventDefault(),J.stopPropagation(),W(`__end__${t.id}`),ee(t.id)},onDragLeave:J=>{J.stopPropagation(),W(null)},onDrop:J=>{J.stopPropagation(),K(J,"__group_end__",t.id)}}),S===t.id&&c.jsx(zu,{initialData:{name:"",category_group_id:t.id},onSubmit:J=>I(J,t.id),onCancel:()=>x(null),submitLabel:"Create",categoryGroups:a})]}),S!==t.id&&c.jsx("div",{style:{marginTop:"0.75rem",paddingTop:"0.5rem",borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},children:c.jsx(De,{variant:"small",actionName:`Open Add Category Form (${t.name})`,onClick:()=>x(t.id),disabled:S!==null,children:"+ Add Category"})})]})})]})}function oU({ungroupedCategories:t,categoryGroups:e,categoryBalances:n,loadingBalances:r,dragType:a,draggedId:o,dragOverId:u,dragOverGroupId:h,editingCategoryId:f,setEditingCategoryId:m,createForGroupId:g,setCreateForGroupId:_,handleCreateCategory:v,handleUpdateCategory:S,handleDeleteCategory:x,handleMoveCategory:E,handleCategoryDragStart:C,handleCategoryDragOver:I,handleDragOverGroup:j,handleDragLeaveGroup:M,handleDragLeave:Q,handleDragEnd:q,handleCategoryDrop:G,handleDropOnGroup:D,setDragOverId:A,setDragOverGroupId:N,categories:L,hasGroups:P}){const B=a==="category"&&h==="ungrouped",O=o&&a==="category"?L[o]:null,K=O&&O.category_group_id!==null;return t.length===0&&!g&&P&&a!=="category"?null:c.jsxs("div",{onDragOver:Y=>j(Y,"ungrouped"),onDragLeave:M,onDrop:Y=>D(Y,"ungrouped"),style:{background:B&&K?`color-mix(in srgb, ${ae.primary} 10%, transparent)`:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"12px",padding:"1rem",border:B&&K?`2px dashed ${ae.primary}`:"2px solid transparent",transition:"all 0.15s"},children:[c.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.75rem",paddingBottom:"0.5rem",borderBottom:"1px solid color-mix(in srgb, currentColor 15%, transparent)"},children:[c.jsxs("h3",{style:{...ym,margin:0,opacity:.7},children:["Uncategorized",c.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400,fontSize:"0.9rem"},children:["(",t.length,")"]})]}),c.jsx(De,{variant:"small",actionName:"Open Add Category Form (Uncategorized)",onClick:()=>_("ungrouped"),disabled:g!==null,children:"+ Category"})]}),c.jsxs("div",{style:Fl,children:[t.map(([Y,z])=>f===Y?c.jsx(zu,{initialData:{name:z.name,description:z.description,category_group_id:z.category_group_id,default_monthly_amount:z.default_monthly_amount,default_monthly_type:z.default_monthly_type,is_hidden:z.is_hidden},onSubmit:V=>{S(Y,V),m(null)},onCancel:()=>m(null),submitLabel:"Save",categoryGroups:e,showGroupSelector:!0},Y):c.jsx(_m,{isDragging:a==="category"&&o===Y,isDragOver:u===Y,onDragStart:V=>C(V,Y),onDragOver:V=>I(V,Y,"ungrouped"),onDragLeave:Q,onDragEnd:q,onDrop:V=>G(V,Y,"ungrouped"),onEdit:()=>{z.name,m(Y)},onDelete:()=>{z.name,x(Y)},onMoveUp:()=>E(Y,"up"),onMoveDown:()=>E(Y,"down"),canMoveUp:t.findIndex(([V])=>V===Y)>0,canMoveDown:t.findIndex(([V])=>V===Y)<t.length-1,children:c.jsx(oA,{category:z,catId:Y,categoryBalances:n,loadingBalances:r})},Y)),t.length===0&&a==="category"&&c.jsx("p",{style:{opacity:.5,fontSize:"0.9rem",margin:"0.5rem 0",textAlign:"center"},children:"Drop here to uncategorize"}),a==="category"&&t.length>0&&c.jsx(aA,{groupId:"ungrouped",isActive:u==="__end__ungrouped",onDragOver:Y=>{Y.preventDefault(),Y.stopPropagation(),A("__end__ungrouped"),N("ungrouped")},onDragLeave:Y=>{Y.stopPropagation(),A(null)},onDrop:Y=>{Y.stopPropagation(),G(Y,"__group_end__","ungrouped")}}),g==="ungrouped"&&c.jsx(zu,{initialData:{name:"",category_group_id:null},onSubmit:Y=>v(Y,"ungrouped"),onCancel:()=>_(null),submitLabel:"Create",categoryGroups:e})]}),g!=="ungrouped"&&c.jsx("div",{style:{marginTop:"0.75rem",paddingTop:"0.5rem",borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},children:c.jsx(De,{variant:"small",actionName:"Open Add Category Form (Uncategorized)",onClick:()=>_("ungrouped"),disabled:g!==null,children:"+ Add Category"})})]})}function lU(){const{currentBudget:t,categories:e,categoryGroups:n,categoriesByGroup:r,hiddenCategories:a,sortedGroups:o,categoryBalances:u,isLoading:h,loadingBalances:f,error:m,setError:g,getOnBudgetTotal:_,handleCreateCategory:v,handleUpdateCategory:S,handleDeleteCategory:x,handleMoveCategory:E,handleCreateGroup:C,handleUpdateGroup:I,handleDeleteGroup:j,handleMoveGroup:M,dragType:Q,draggedId:q,dragOverId:G,dragOverGroupId:D,setDragOverId:A,setDragOverGroupId:N,handleCategoryDragStart:L,handleCategoryDragOver:P,handleDragOverGroup:B,handleDragLeave:O,handleDragLeaveGroup:K,handleDragEnd:Y,handleCategoryDrop:z,handleDropOnGroup:V,handleGroupDragStart:W,handleGroupDrop:ee}=IB(),ie=zs(),{addLoadingHold:U,removeLoadingHold:H}=ir();T.useEffect(()=>(h?U("categories","Loading categories..."):H("categories"),()=>H("categories")),[h,U,H]);const[ne,se]=T.useState(null),[Z,le]=T.useState(null),[pe,Ee]=T.useState(null),[ge,J]=T.useState(!1);if(!t)return c.jsx("p",{children:"No budget found. Please log in."});const Se=Object.values(u).reduce((Oe,ot)=>Oe+ot.current,0),Ae=Object.values(u).reduce((Oe,ot)=>Oe+ot.total,0),ct=_()-Se,Me=Math.abs(Ae-Se)>.01;return h?null:c.jsxs("div",{children:[m&&c.jsx(Ao,{message:m,onDismiss:()=>g(null)}),c.jsx("div",{style:{position:"sticky",top:0,zIndex:50,backgroundColor:"#242424",marginLeft:"calc(-1 * var(--page-padding, 2rem))",marginRight:"calc(-1 * var(--page-padding, 2rem))",paddingLeft:"var(--page-padding, 2rem)",paddingRight:"var(--page-padding, 2rem)",paddingTop:"0.5rem",paddingBottom:"0.5rem",borderBottom:"1px solid rgba(255,255,255,0.15)"},children:c.jsxs("div",{style:{display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem"},children:[c.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[c.jsx("span",{style:{fontWeight:600},children:"Categories:"}),c.jsxs("span",{children:[c.jsx("span",{style:{opacity:.6},children:"On-Budget: "}),c.jsx("span",{style:{color:jt(_()),fontWeight:600},children:$e(_())})]}),c.jsxs("span",{children:[c.jsx("span",{style:{opacity:.6},children:"Allocated: "}),c.jsx("span",{style:{color:oc(Se),fontWeight:600},children:f?"...":$e(Se)}),Me&&c.jsxs("span",{style:{opacity:.5,fontSize:"0.8rem"},children:[" (",$e(Ae)," total)"]})]}),c.jsxs("span",{children:[c.jsx("span",{style:{opacity:.6},children:"Available: "}),c.jsx("span",{style:{color:jt(ct),fontWeight:600},children:f?"...":$e(ct)})]}),c.jsx("span",{style:{opacity:.6},children:ie?"Drag to move between groups.":"Drag categories between groups, or use  to reorder."})]}),c.jsx("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:c.jsx(z0,{})})]})}),c.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem",marginBottom:"1.5rem",paddingTop:"1rem"},children:[Object.keys(e).length===0&&n.length===0&&c.jsx("p",{style:{opacity:.7},children:"No categories yet. Create a group first, then add categories!"}),o.map((Oe,ot)=>{const Sn=(r[Oe.id]||[]).sort((Qn,mt)=>Qn[1].sort_order-mt[1].sort_order);return c.jsx(aU,{group:Oe,groupIndex:ot,groupCategories:Sn,sortedGroups:o,categoryGroups:n,categoryBalances:u,loadingBalances:f,dragType:Q,draggedId:q,dragOverId:G,dragOverGroupId:D,editingCategoryId:ne,setEditingCategoryId:se,createForGroupId:Z,setCreateForGroupId:le,editingGroupId:pe,setEditingGroupId:Ee,handleCreateCategory:v,handleUpdateCategory:S,handleDeleteCategory:x,handleMoveCategory:E,handleUpdateGroup:I,handleDeleteGroup:j,handleMoveGroup:M,handleCategoryDragStart:L,handleCategoryDragOver:P,handleDragOverGroup:B,handleDragLeave:O,handleDragLeaveGroup:K,handleDragEnd:Y,handleCategoryDrop:z,handleDropOnGroup:V,handleGroupDragStart:W,handleGroupDrop:ee,setDragOverId:A,setDragOverGroupId:N,isMobile:ie,categories:e},Oe.id)}),Q==="group"&&o.length>0&&c.jsx(B0,{isActive:G==="__end__",onDragOver:Oe=>{Oe.preventDefault(),A("__end__")},onDragLeave:O,onDrop:Oe=>ee(Oe,"__end__"),label:"Move group to end"}),c.jsx(oU,{ungroupedCategories:(r.ungrouped||[]).sort((Oe,ot)=>Oe[1].sort_order-ot[1].sort_order),categoryGroups:n,categoryBalances:u,loadingBalances:f,dragType:Q,draggedId:q,dragOverId:G,dragOverGroupId:D,editingCategoryId:ne,setEditingCategoryId:se,createForGroupId:Z,setCreateForGroupId:le,handleCreateCategory:v,handleUpdateCategory:S,handleDeleteCategory:x,handleMoveCategory:E,handleCategoryDragStart:L,handleCategoryDragOver:P,handleDragOverGroup:B,handleDragLeaveGroup:K,handleDragLeave:O,handleDragEnd:Y,handleCategoryDrop:z,handleDropOnGroup:V,setDragOverId:A,setDragOverGroupId:N,categories:e,hasGroups:n.length>0})]}),a.length>0&&c.jsx("div",{style:{marginBottom:"2rem"},children:c.jsxs(L0,{title:"Hidden Categories",count:a.length,children:[c.jsxs("div",{style:{padding:"0.75rem",marginBottom:"1rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",fontSize:"0.85rem"},children:[c.jsxs("p",{style:{margin:"0 0 0.5rem 0",opacity:.8},children:[c.jsx("strong",{children:" Hidden categories"})," are excluded from dropdowns and balance displays. They're useful for historical categories that you want to keep for record-keeping but don't need in everyday use."]}),c.jsx("p",{style:{margin:0,opacity:.6},children:'To unhide a category, click it to edit and uncheck "Hidden category".'})]}),c.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:a.map(([Oe,ot])=>ne===Oe?c.jsx(zu,{initialData:{name:ot.name,description:ot.description,category_group_id:ot.category_group_id,default_monthly_amount:ot.default_monthly_amount,default_monthly_type:ot.default_monthly_type,is_hidden:ot.is_hidden},onSubmit:Sn=>{S(Oe,Sn),se(null)},onCancel:()=>se(null),submitLabel:"Save",categoryGroups:n,showGroupSelector:!0},Oe):c.jsxs("div",{onClick:()=>se(Oe),style:{padding:"0.75rem 1rem",background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"8px",cursor:"pointer",display:"flex",justifyContent:"space-between",alignItems:"center",opacity:.7},children:[c.jsx("span",{children:ot.name}),c.jsx("span",{style:{color:jt(ot.balance),fontWeight:500},children:$e(ot.balance)})]},Oe))})]})}),ge?c.jsx(iA,{onSubmit:Oe=>{C(Oe),J(!1)},onCancel:()=>J(!1),submitLabel:"Create Group"}):c.jsx(De,{variant:"primary-large",actionName:"Open Add Category Group Form",onClick:()=>J(!0),children:"+ Add Category Group"})]})}function cU(){const{currentUserId:t}=zt(),{budget:e,budgetUserIds:n,acceptedUserIds:r,inviteUser:a,revokeUser:o}=kn(),[u,h]=T.useState(""),[f,m]=T.useState(!1),[g,_]=T.useState(null),[v,S]=T.useState(null);if(!e)return c.jsx("p",{children:"No budget found."});async function x(j){if(j.preventDefault(),!(!u.trim()||!e)){m(!0),_(null),S(null);try{await a(u.trim()),h(""),S("Invite sent! The user can now accept the invitation from their account.")}catch(M){_(M instanceof Error?M.message:"Failed to invite user")}finally{m(!1)}}}async function E(j){if(!e)return;if(j===e.owner_id){_("Cannot revoke the budget owner");return}if(j===t){_("Cannot revoke yourself from the budget");return}const M=r.includes(j);if(confirm(M?"Are you sure you want to revoke this user's access? They will lose access to this budget.":"Are you sure you want to cancel this invitation?")){_(null),S(null);try{await o(j),S(M?"User access revoked.":"Invitation cancelled.")}catch(q){_(q instanceof Error?q.message:"Failed to revoke user")}}}const C=n.filter(j=>r.includes(j)),I=n.filter(j=>!r.includes(j));return c.jsxs("div",{children:[c.jsx("h2",{style:{marginTop:0},children:"Budget Users"}),c.jsx("p",{style:{opacity:.7,marginBottom:"1.5rem"},children:"Invite users to access this budget. They must accept the invitation before they can access it."}),g&&c.jsxs("div",{style:{background:"rgba(220, 38, 38, 0.1)",border:"1px solid rgba(220, 38, 38, 0.3)",color:"#f87171",padding:"0.75rem 1rem",borderRadius:"8px",marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[c.jsx("span",{children:g}),c.jsx("button",{onClick:()=>_(null),style:{background:"transparent",border:"none",color:"#f87171",cursor:"pointer",fontSize:"1.2rem",padding:"0 0.25rem",lineHeight:1},children:""})]}),v&&c.jsxs("div",{style:{background:"rgba(34, 197, 94, 0.1)",border:"1px solid rgba(34, 197, 94, 0.3)",color:"#4ade80",padding:"0.75rem 1rem",borderRadius:"8px",marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[c.jsx("span",{children:v}),c.jsx("button",{onClick:()=>S(null),style:{background:"transparent",border:"none",color:"#4ade80",cursor:"pointer",fontSize:"1.2rem",padding:"0 0.25rem",lineHeight:1},children:""})]}),c.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px",marginBottom:"1.5rem"},children:[c.jsxs("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem"},children:["Active Users (",C.length,")"]}),C.length===0?c.jsx("p",{style:{opacity:.6,margin:0},children:"No users have accepted invitations yet."}):c.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:C.map(j=>{const M=j===e.owner_id,Q=j===t;return c.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 8%, transparent)",padding:"0.75rem 1rem",borderRadius:"6px",display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem"},children:[c.jsx("div",{style:{flex:1,minWidth:0},children:c.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flexWrap:"wrap"},children:[c.jsx("code",{style:{fontSize:"0.85rem",background:"color-mix(in srgb, currentColor 10%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",wordBreak:"break-all"},children:j}),M&&c.jsx("span",{style:{background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.7rem",textTransform:"uppercase",fontWeight:600},children:"Owner"}),Q&&c.jsx("span",{style:{background:"color-mix(in srgb, #22c55e 20%, transparent)",color:"#4ade80",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.7rem",textTransform:"uppercase",fontWeight:600},children:"You"})]})}),!M&&!Q&&c.jsx("button",{onClick:()=>E(j),style:{background:"transparent",border:"1px solid rgba(220, 38, 38, 0.4)",color:"#f87171",padding:"0.4rem 0.75rem",borderRadius:"6px",cursor:"pointer",fontSize:"0.8rem",whiteSpace:"nowrap"},children:"Revoke Access"})]},j)})})]}),I.length>0&&c.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px",marginBottom:"1.5rem"},children:[c.jsxs("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem"},children:["Pending Invitations (",I.length,")"]}),c.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:I.map(j=>c.jsxs("div",{style:{background:"color-mix(in srgb, #f59e0b 10%, transparent)",border:"1px solid color-mix(in srgb, #f59e0b 30%, transparent)",padding:"0.75rem 1rem",borderRadius:"6px",display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem"},children:[c.jsx("div",{style:{flex:1,minWidth:0},children:c.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flexWrap:"wrap"},children:[c.jsx("code",{style:{fontSize:"0.85rem",background:"color-mix(in srgb, currentColor 10%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",wordBreak:"break-all"},children:j}),c.jsx("span",{style:{background:"color-mix(in srgb, #f59e0b 20%, transparent)",color:"#fbbf24",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.7rem",textTransform:"uppercase",fontWeight:600},children:"Pending"})]})}),c.jsx("button",{onClick:()=>E(j),style:{background:"transparent",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)",color:"inherit",padding:"0.4rem 0.75rem",borderRadius:"6px",cursor:"pointer",fontSize:"0.8rem",whiteSpace:"nowrap",opacity:.8},children:"Cancel Invite"})]},j))})]}),c.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px"},children:[c.jsx("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem"},children:"Invite User"}),c.jsxs("form",{onSubmit:x,style:{display:"flex",gap:"0.75rem"},children:[c.jsx("input",{type:"text",value:u,onChange:j=>h(j.target.value),placeholder:"Enter Firebase User ID",style:{flex:1,padding:"0.6rem 0.8rem",borderRadius:"6px",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"0.95rem",color:"inherit"}}),c.jsx("button",{type:"submit",disabled:f||!u.trim(),style:{background:"#646cff",color:"white",border:"none",padding:"0.6rem 1.25rem",borderRadius:"6px",cursor:f||!u.trim()?"not-allowed":"pointer",fontWeight:500,opacity:f||!u.trim()?.7:1,whiteSpace:"nowrap"},children:f?"Inviting...":"Send Invite"})]}),c.jsx("p",{style:{margin:"1rem 0 0 0",fontSize:"0.85rem",opacity:.6},children:" The invited user will need to accept the invitation from their Account page using this budget's ID:"}),c.jsx("code",{style:{display:"block",marginTop:"0.5rem",padding:"0.5rem 0.75rem",background:"color-mix(in srgb, currentColor 10%, transparent)",borderRadius:"6px",fontSize:"0.85rem",wordBreak:"break-all"},children:e.id})]})]})}const uU=["budget","feedback","migration","tests"];function dU(){const{isAdmin:t,isTest:e,lastAdminTab:n,setLastAdminTab:r,setPageTitle:a}=zt();T.useLayoutEffect(()=>{a("Budget Admin")},[a]);const o=zn(),u=o.pathname==="/budget/admin",h=T.useMemo(()=>{const _=o.pathname;return _.includes("/admin/budget")?"budget":_.includes("/admin/feedback")?"feedback":_.includes("/admin/migration")?"migration":_.includes("/admin/tests")?"tests":"budget"},[o.pathname]),f=h==="tests";T.useEffect(()=>{u||r(h)},[h,u,r]);function m(){return!uU.includes(n)||n==="tests"&&!e?"budget":n}const g=T.useMemo(()=>[{id:"budget",label:"Budget",icon:""},{id:"feedback",label:"Feedback",icon:""},{id:"migration",label:"Migration",icon:""},{id:"tests",label:"Tests",icon:"",hidden:!e}],[e]);return t?!e&&f?c.jsxs("div",{children:[c.jsx("h1",{children:"Access Denied"}),c.jsx("p",{style:{opacity:.7},children:"Only test users can access this section."}),c.jsx("p",{style:{marginTop:"1rem"},children:c.jsx(Ft,{to:"/budget/admin/budget",children:"Go to Admin "})})]}):c.jsxs("div",{children:[c.jsx(Pf,{mode:"link",linkPrefix:"/budget/admin",tabs:g,activeTab:h}),u?c.jsx(Lf,{to:`/budget/admin/${m()}`,replace:!0}):c.jsx(zf,{})]}):c.jsxs("div",{children:[c.jsx("h1",{children:"Access Denied"}),c.jsx("p",{style:{opacity:.7},children:"Only administrators can access this section."}),c.jsx("p",{style:{marginTop:"1rem"},children:c.jsx(Ft,{to:"/budget",children:"Go to Budget "})})]})}function hU(){const{addLoadingHold:t,removeLoadingHold:e}=ir(),{isAdmin:n}=zt(),{budget:r,accounts:a,accountGroups:o,categories:u,categoryGroups:h,isOwner:f,isLoading:m}=kn();return T.useEffect(()=>(m?t("settings-budget","Loading budget info..."):e("settings-budget"),()=>e("settings-budget")),[m,t,e]),m?null:r?c.jsxs("div",{children:[c.jsx("h2",{style:{marginTop:0},children:"Budget Summary"}),c.jsx("p",{style:{opacity:.7,marginBottom:"1.5rem"},children:"Information about the currently selected budget."}),c.jsx("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px",marginBottom:"1.5rem"},children:c.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem",fontSize:"0.95rem"},children:[c.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[c.jsx("span",{children:""}),c.jsx("span",{style:{opacity:.7,minWidth:"80px"},children:"Name:"}),c.jsx("strong",{children:r.name})]}),c.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[c.jsx("span",{children:""}),c.jsx("span",{style:{opacity:.7,minWidth:"80px"},children:"ID:"}),c.jsx("code",{style:{background:"color-mix(in srgb, currentColor 10%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",fontSize:"0.85rem"},children:r.id})]}),c.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[c.jsx("span",{children:""}),c.jsx("span",{style:{opacity:.7,minWidth:"80px"},children:"Owner:"}),c.jsx("strong",{children:r.owner_email||r.owner_id})]}),c.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[c.jsx("span",{children:""}),c.jsx("span",{style:{opacity:.7,minWidth:"80px"},children:"Users:"}),c.jsxs("span",{children:[r.user_ids.length," user",r.user_ids.length!==1?"s":"",c.jsxs("span",{style:{opacity:.7},children:["  ",f?"You are the owner":"Shared with you"]})]})]})]})}),n&&c.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px"},children:[c.jsx("h3",{style:{margin:"0 0 0.75rem 0",fontSize:"1rem"},children:"Admin Tools"}),c.jsx("button",{onClick:()=>{const g={...r,accounts:a,account_groups:o,categories:u,category_groups:h,_meta:{downloaded_at:new Date().toISOString()}},_=new Blob([JSON.stringify(g,null,2)],{type:"application/json"}),v=URL.createObjectURL(_),S=document.createElement("a");S.href=v,S.download=`budget_${r.id}.json`,document.body.appendChild(S),S.click(),document.body.removeChild(S),URL.revokeObjectURL(v)},style:{display:"inline-flex",alignItems:"center",gap:"0.5rem",background:"color-mix(in srgb, currentColor 10%, transparent)",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",borderRadius:"6px",padding:"0.5rem 0.75rem",cursor:"pointer",fontSize:"0.85rem",color:"inherit",transition:"background 0.15s"},title:"Download budget document as JSON (for debugging)",children:" Download Budget JSON"})]})]}):c.jsx("p",{style:{opacity:.7},children:"No budget selected."})}function qw({selectedType:t,onSelect:e}){return c.jsx("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"0.75rem",paddingBottom:"1rem",flexWrap:"wrap"},children:["critical_bug","bug","new_feature","core_feature","qol"].map(n=>{const r=Ay[n],a=t==="feature"?"new_feature":t,o=a===n||!a&&n==="bug";return c.jsxs("button",{type:"button",onClick:()=>{r.label,e(n)},style:{flex:1,padding:"0.6rem 0.75rem",border:`2px solid ${r.color}`,borderRadius:"0.5rem",background:o?r.bgColor:"transparent",color:o?r.color:"rgba(255,255,255,0.5)",cursor:"pointer",fontWeight:o?600:400,fontSize:"0.85rem",transition:"all 0.15s ease",opacity:o?1:.5,boxShadow:o?`0 0 12px ${r.bgColor}`:"none",position:"relative"},children:[r.label,o&&c.jsx("span",{style:{position:"absolute",bottom:"-14px",left:"10%",right:"10%",height:"3px",background:"white",borderRadius:"2px"}})]},n)})})}function fU(){const[t,e]=T.useState(null),[n,r]=T.useState(null),[a,o]=T.useState(null),[u,h]=T.useState(!1),[f,m]=T.useState(""),[g,_]=T.useState("bug"),[v,S]=T.useState(null),[x,E]=T.useState(null),C=T.useContext(nd),j=wa().get_current_firebase_user(),M=C4(),{submitFeedback:Q}=KT(),{toggleFeedback:q}=g6(),{updateSortOrder:G}=y6(),D=M.data?.items||[],{addLoadingHold:A,removeLoadingHold:N}=ir();T.useEffect(()=>(M.isLoading?A("settings-feedback","Loading feedback..."):N("settings-feedback"),()=>N("settings-feedback")),[M.isLoading,A,N]);function L(H){H.preventDefault(),!(!f.trim()||!C.username||!j)&&(Q.mutate({userId:j.uid,userEmail:C.username,text:f.trim(),feedbackType:g,currentPath:"/settings/feedback"}),m(""),_("bug"),h(!1))}function P(H){H.is_done?B(H):S(H)}async function B(H){try{await q.mutateAsync({item:H})}catch(ne){e(ne instanceof Error?ne.message:"Failed to update feedback")}}function O(){v&&(B(v),S(null))}async function K(H){if(x){try{const se=D.filter(Z=>Z.doc_id===x.doc_id).map(Z=>({id:Z.id,text:Z.text,created_at:Z.created_at,is_done:Z.is_done,completed_at:Z.completed_at,sort_order:Z.sort_order,feedback_type:Z.id===x.id?H:Z.feedback_type}));await G.mutateAsync({docId:x.doc_id,items:se})}catch(ne){e(ne instanceof Error?ne.message:"Failed to update feedback type")}E(null)}}const Y=D.filter(H=>!H.is_done).sort((H,ne)=>H.sort_order-ne.sort_order),z=D.filter(H=>H.is_done).sort((H,ne)=>new Date(ne.completed_at||0).getTime()-new Date(H.completed_at||0).getTime());function V(H,ne){r(ne),H.dataTransfer.effectAllowed="move"}function W(H,ne){H.preventDefault(),ne!==n&&o(ne)}function ee(){o(null)}function ie(){r(null),o(null)}async function U(H,ne){if(H.preventDefault(),!n||n===ne){ie();return}const se=Y.findIndex(ge=>ge.id===n),Z=[...Y],[le]=Z.splice(se,1);if(ne==="__end__")Z.push(le);else{const ge=Z.findIndex(J=>J.id===ne);Z.splice(ge,0,le)}const pe=Z.map((ge,J)=>({...ge,sort_order:J}));ie();const Ee=new Map;for(const ge of pe)Ee.has(ge.doc_id)||Ee.set(ge.doc_id,[]),Ee.get(ge.doc_id).push({id:ge.id,text:ge.text,created_at:ge.created_at,is_done:ge.is_done,completed_at:ge.completed_at,sort_order:ge.sort_order,feedback_type:ge.feedback_type});for(const ge of z)Ee.has(ge.doc_id)||Ee.set(ge.doc_id,[]),Ee.get(ge.doc_id).push({id:ge.id,text:ge.text,created_at:ge.created_at,is_done:ge.is_done,completed_at:ge.completed_at,sort_order:ge.sort_order,feedback_type:ge.feedback_type});try{for(const[ge,J]of Ee)await G.mutateAsync({docId:ge,items:J})}catch(ge){e(ge instanceof Error?ge.message:"Failed to save order")}}return M.isLoading?null:c.jsxs("div",{children:[c.jsx("h2",{style:{marginTop:0},children:"Feedback"}),c.jsx("p",{style:{...FT,fontSize:"0.9rem"},children:"View and manage user feedback. Drag to reorder pending items."}),t&&c.jsx(Ao,{message:t,onDismiss:()=>e(null)}),c.jsxs("div",{style:Fl,children:[Y.length===0&&!u&&c.jsx("p",{style:{opacity:.7},children:"No pending feedback."}),Y.map(H=>c.jsx(l6,{item:H,isDragging:n===H.id,isDragOver:a===H.id,onDragStart:ne=>V(ne,H.id),onDragOver:ne=>W(ne,H.id),onDragLeave:ee,onDragEnd:ie,onDrop:ne=>U(ne,H.id),onToggleDone:()=>P(H),onTypeClick:()=>E(H)},H.id)),n&&Y.length>0&&c.jsx(B0,{isActive:a==="__end__",onDragOver:H=>W(H,"__end__"),onDragLeave:ee,onDrop:H=>U(H,"__end__")})]}),u?c.jsxs(pi,{actionName:"Add Feedback",onSubmit:L,children:[c.jsx(qw,{selectedType:g,onSelect:_}),c.jsx(P0,{value:f,onChange:H=>m(H.target.value),placeholder:"Enter your feedback, bug report, or feature request...",autoFocus:!0,required:!0}),c.jsxs(Aa,{children:[c.jsx(De,{type:"submit",actionName:"Add Feedback",disabled:!f.trim(),children:"Add Feedback"}),c.jsx(De,{type:"button",variant:"secondary",actionName:"Cancel Add Feedback",onClick:()=>{h(!1),m(""),_("bug")},children:"Cancel"})]})]}):c.jsx(De,{variant:"primary-large",actionName:"Open Add Feedback Form",onClick:()=>h(!0),children:"+ Add Feedback"}),z.length>0&&c.jsx(L0,{title:"Completed",count:z.length,children:c.jsx("div",{style:{...Fl,marginTop:"0.5rem"},children:z.map(H=>c.jsx(c6,{item:H,onToggleDone:()=>P(H),onTypeClick:()=>E(H)},H.id))})}),c.jsxs(Ls,{isOpen:v!==null,onClose:()=>S(null),title:"Mark as Complete",children:[c.jsx("p",{style:{margin:"0 0 1.5rem 0"},children:"Are you sure you want to mark this feedback item as complete?"}),v&&c.jsxs("p",{style:{margin:"0 0 1.5rem 0",padding:"0.75rem",background:"rgba(255,255,255,0.05)",borderRadius:"0.5rem",fontSize:"0.9rem"},children:['"',v.text,'"']}),c.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[c.jsx(De,{variant:"secondary",actionName:"Cancel Mark Complete",onClick:()=>S(null),children:"Cancel"}),c.jsx(De,{variant:"primary",actionName:"Confirm Mark Complete",onClick:O,children:"Mark Complete"})]})]}),c.jsxs(Ls,{isOpen:x!==null,onClose:()=>E(null),title:"Change Feedback Type",children:[c.jsx("p",{style:{margin:"0 0 1rem 0",fontSize:"0.9rem",opacity:.8},children:"Select a new type for this feedback:"}),c.jsx(qw,{selectedType:x?.feedback_type||"bug",onSelect:K}),c.jsx(De,{variant:"secondary",actionName:"Cancel Change Feedback Type",onClick:()=>E(null),style:{width:"100%"},children:"Cancel"})]})]})}function mU(){try{localStorage.removeItem("BUDGET_APP_QUERY_CACHE")}catch{}window.location.reload()}function pU(){const e=wa().get_current_firebase_user(),[n,r]=T.useState(!1),a=zB({currentUser:e}),o=FB({currentUser:e}),u=$B({currentUser:e}),h=qB({currentUser:e}),f=KB({currentUser:e}),m=aL({currentUser:e}),g=nL({currentUser:e}),_=hL({currentUser:e}),v=SL({currentUser:e}),S=TL({currentUser:e}),x=RL({currentUser:e}),E=ML(),C=a.isScanning||o.isScanning||u.isScanning||h.isScanning||f.isScanning||g.isScanning||m.isScanning||_.isScanning||S.isScanning,I=a.isRunning||o.isMigratingFeedback||u.isDeleting||h.isDeleting||f.isRunning||g.isRunning||m.isRunning||_.isRunning||S.isRunning,j=async()=>{await Promise.all([a.scanStatus(),o.scanStatus(),u.scanStatus(),h.scanStatus(),f.scan(),m.scanStatus(),g.scanStatus(),_.scanStatus(),S.scanStatus()])};return c.jsxs("div",{children:[c.jsx("style",{children:"@keyframes spin { to { transform: rotate(360deg); } }"}),c.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"},children:[c.jsx("h2",{style:{margin:0},children:"Data Migrations"}),c.jsxs("button",{onClick:j,disabled:C||I,style:{background:"#646cff",color:"white",border:"none",padding:"0.5rem 1rem",borderRadius:"6px",cursor:C||I?"not-allowed":"pointer",fontWeight:500,opacity:C||I?.7:1,display:"flex",alignItems:"center",gap:"0.4rem",minWidth:"130px",minHeight:"36px"},children:[c.jsx("span",{style:{width:"18px",height:"18px",display:"inline-flex",justifyContent:"center",alignItems:"center",flexShrink:0},children:C?c.jsx(xa,{noMargin:!0}):""}),"Refresh All"]})]}),c.jsx("p",{style:{opacity:.7,marginBottom:"1.5rem"},children:'Run migrations to validate and fix your database. Click "Refresh All" to scan Firestore directly.'}),c.jsx(F6,{hasData:!!v.status,status:v.status,report:v.report,hasViolations:v.hasViolations,violationCount:v.violationCount,isScanning:v.isScanning,onScan:v.scan,disabled:!e}),c.jsx(V6,{hasData:!!S.status,status:S.status,needsMigration:S.needsMigration,totalItemsToFix:S.totalItemsToFix,isRunning:S.isRunning,result:S.result,onRunMigration:S.runMigration,onRefresh:S.scanStatus,isRefreshing:S.isScanning,disabled:!e}),c.jsx(z6,{hasData:!!m.status,status:m.status,hasItemsToFix:m.hasItemsToFix,isRunning:m.isRunning,result:m.result,onRunMigration:m.runMigration,onRefresh:m.scanStatus,isRefreshing:m.isScanning,disabled:!e}),c.jsx(L6,{hasData:!!g.status,status:g.status,hasItemsToMigrate:g.hasItemsToMigrate,isRunning:g.isRunning,result:g.result,onRunMigration:g.runMigration,onRefresh:g.scanStatus,isRefreshing:g.isScanning,disabled:!e}),c.jsx(U6,{hasData:!!_.status,status:_.status,hasPairsToConvert:_.hasPairsToConvert,isRunning:_.isRunning,result:_.result,onRunMigration:_.runMigration,onRefresh:_.scanStatus,isRefreshing:_.isScanning,disabled:!e}),c.jsx(B6,{hasData:f.hasData,status:f.status,hasIssues:f.hasIssues,totalIssues:f.totalIssues,isRunning:f.isRunning,result:f.result,onRunCleanup:f.runCleanup,onRefresh:f.scan,isRefreshing:f.isScanning,disabled:!e}),c.jsx(d6,{hasData:!!a.status,status:a.status,hasIssues:a.hasIssues,totalIssues:a.totalIssues,isRunning:a.isRunning,result:a.result,onRunCleanup:a.runCleanup,onRefresh:a.scanStatus,isRefreshing:a.isScanning,disabled:!e}),c.jsx(h6,{hasData:!!o.status,status:o.status,isMigrating:o.isMigratingFeedback,onMigrate:o.migrateFeedbackDocuments,onRefresh:o.scanStatus,isRefreshing:o.isScanning,disabled:!e,migrationResult:o.feedbackMigrationResult}),c.jsx(A6,{hasData:!!u.status,monthsCount:u.status?.monthsCount??0,budgetCount:u.status?.budgetCount??0,monthsToDelete:u.status?.monthsToDelete??[],isDeleting:u.isDeleting,onDelete:u.deleteAllMonths,onRefresh:u.scanStatus,isRefreshing:u.isScanning,disabled:!e,deleteResult:u.deleteResult,deleteProgress:u.deleteProgress}),c.jsx(R6,{hasData:!!h.status,status:h.status,isDeleting:h.isDeleting,onDelete:h.deleteSampleUserBudget,onRefresh:h.scanStatus,isRefreshing:h.isScanning,disabled:!e,deleteResult:h.deleteResult,deleteProgress:h.deleteProgress}),c.jsx(P6,{disabled:!e}),c.jsx("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",padding:"1rem",marginBottom:"1rem",border:"1px solid color-mix(in srgb, #17a2b8 30%, transparent)"},children:c.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",gap:"1rem"},children:[c.jsxs("div",{style:{flex:1},children:[c.jsx("h3",{style:{margin:"0 0 0.25rem 0",fontSize:"1rem",color:"#17a2b8"},children:" Diagnostic Download"}),c.jsx("p",{style:{margin:0,fontSize:"0.85rem",opacity:.7},children:"Downloads all budget and month data as JSON for troubleshooting balance discrepancies. Includes stored vs calculated balances, transfers, adjustments, and full month breakdowns."}),x.error&&c.jsxs("p",{style:{margin:"0.5rem 0 0 0",fontSize:"0.85rem",color:"#dc3545"},children:["Error: ",x.error]}),x.progress&&c.jsxs("div",{style:{marginTop:"0.5rem"},children:[c.jsx("div",{style:{background:"rgba(0,0,0,0.2)",borderRadius:"4px",height:"6px",overflow:"hidden"},children:c.jsx("div",{style:{background:"#17a2b8",height:"100%",width:`${x.progress.percentComplete}%`,transition:"width 0.3s"}})}),c.jsxs("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.75rem",opacity:.7},children:[x.progress.phase==="reading"&&"Reading data from Firestore...",x.progress.phase==="analyzing"&&`Analyzing budget ${x.progress.current}/${x.progress.total}...`,x.progress.phase==="complete"&&"Download complete!"]})]})]}),c.jsx(De,{variant:"secondary",actionName:"Download Diagnostics",onClick:x.downloadDiagnostics,disabled:!e||x.isDownloading,style:{flexShrink:0},children:x.isDownloading?c.jsxs(c.Fragment,{children:[c.jsx(xa,{noMargin:!0})," Downloading..."]}):" Download JSON"})]})}),c.jsx($6,{status:E.status,result:E.result,isScanning:E.isScanning,isRunning:E.isRunning,onScan:E.scan,onRun:E.run,disabled:!e}),c.jsx("div",{style:{background:"color-mix(in srgb, currentColor 3%, transparent)",padding:"1rem",borderRadius:"8px",fontSize:"0.85rem"},children:c.jsxs("p",{style:{margin:0,opacity:.7},children:[c.jsx("strong",{children:"Note:"})," These migrations will process ",c.jsx("strong",{children:"all budgets and months"})," in the system, not just the ones you own or are invited to."]})}),c.jsxs("div",{style:{marginTop:"1.5rem",padding:"1rem",background:"color-mix(in srgb, #ff6b6b 10%, transparent)",borderRadius:"8px",border:"1px solid color-mix(in srgb, #ff6b6b 30%, transparent)"},children:[c.jsxs("p",{style:{margin:"0 0 0.75rem 0",fontSize:"0.9rem"},children:[c.jsx("strong",{children:" Clear All Caches"}),c.jsx("span",{style:{opacity:.7,display:"block",marginTop:"0.25rem"},children:"If you're seeing stale data after running migrations, clear all cached data and reload to fetch fresh data from Firestore."})]}),c.jsx(De,{variant:"danger",actionName:"Open Clear Caches Modal",onClick:()=>r(!0),style:{display:"flex",alignItems:"center",gap:"0.4rem"},children:" Clear All Caches & Reload"})]}),c.jsxs(Ls,{isOpen:n,onClose:()=>r(!1),title:"Clear Caches & Reload?",children:[c.jsx("p",{style:{margin:"0 0 1rem 0",opacity:.8},children:"This will clear all cached data from localStorage and reload the page. The app will fetch fresh data from Firestore for everything."}),c.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[c.jsx(De,{variant:"secondary",actionName:"Cancel Clear Caches",onClick:()=>r(!1),children:"Cancel"}),c.jsx(De,{variant:"danger",actionName:"Confirm Clear Caches & Reload",onClick:mU,children:"Clear & Reload"})]})]})]})}function bl({name:t,description:e,expectedBehavior:n,result:r,onRun:a,disabled:o,expectedToSucceed:u}){const h=r?.status==="passed"?ae.success:r?.status==="failed"?ae.danger:r?.status==="running"?ae.warning:"inherit";return c.jsxs("div",{style:{...sd,display:"flex",flexDirection:"column",gap:"0.5rem"},children:[c.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",gap:"1rem"},children:[c.jsxs("div",{style:{flex:1},children:[c.jsx("h4",{style:{margin:0,fontSize:"0.95rem"},children:t}),c.jsx("p",{style:{margin:"0.25rem 0 0",opacity:.7,fontSize:"0.85rem"},children:e}),c.jsxs("p",{style:{margin:"0.25rem 0 0",fontSize:"0.8rem",color:u?ae.success:ae.warning},children:["Expected: ",n]})]}),c.jsx(De,{onClick:a,disabled:o,variant:"secondary",style:{flexShrink:0},children:r?.status==="running"?"":"Run"})]}),r&&r.status!=="pending"&&c.jsx("div",{style:{padding:"0.5rem 0.75rem",borderRadius:"6px",background:`color-mix(in srgb, ${h} 15%, transparent)`,border:`1px solid color-mix(in srgb, ${h} 30%, transparent)`,fontSize:"0.85rem",color:h},children:r.message})]})}function gU({totalCount:t,passedCount:e,failedCount:n}){return c.jsxs("div",{style:{display:"flex",gap:"1rem",padding:"0.75rem 1rem",borderRadius:"8px",background:"color-mix(in srgb, currentColor 5%, transparent)",marginBottom:"1rem"},children:[c.jsxs("span",{children:["Total: ",c.jsx("strong",{children:t})]}),c.jsxs("span",{style:{color:ae.success},children:["Passed: ",c.jsx("strong",{children:e})]}),c.jsxs("span",{style:{color:ae.danger},children:["Failed: ",c.jsx("strong",{children:n})]})]})}const Hw=[{name:"Read unauthorized budget",expectedToFail:!0},{name:"Read another user's document",expectedToFail:!0},{name:"Read unauthorized budget month",expectedToFail:!0},{name:"Toggle is_admin in own permission_flags",expectedToFail:!0},{name:"Toggle is_test in own permission_flags",expectedToFail:!0},{name:"Read own user document",expectedToFail:!1}];function yU(){const{currentUserId:t}=zt(),[e,n]=T.useState([]),[r,a]=T.useState(!1);function o(S,x){n(E=>E.map(C=>C.name===S?{...C,...x}:C))}async function u(S,x,E){o(S,{status:"running",message:"Running..."});try{const C=await x();E?o(S,{status:"failed",message:` ${C}`}):o(S,{status:"passed",message:` ${C}`})}catch(C){const I=C instanceof Error?C.message:"Unknown error";E?o(S,{status:"passed",message:` Blocked as expected: ${I}`}):o(S,{status:"failed",message:` ${I}`})}}async function h(){a(!0),n(Hw.map(S=>({...S,status:"pending",message:""})));for(const S of Hw)await f(S.name);a(!1)}async function f(S){switch(S){case"Read unauthorized budget":await u(S,async()=>(await Qe("budgets","unauthorized_budget_test_12345","security test: attempting unauthorized budget read"),"Was able to read budget (unexpected)"),!0);break;case"Read another user's document":await u(S,async()=>(await Qe("users","another_user_test_12345","security test: attempting unauthorized user read"),"Was able to read user document (unexpected)"),!0);break;case"Read unauthorized budget month":await u(S,async()=>(await Qe("months","unauthorized_budget_test_12345_2024_01","security test: attempting unauthorized month read"),"Was able to read month document for unauthorized budget (unexpected)"),!0);break;case"Toggle is_admin in own permission_flags":await u(S,async()=>{if(!t)throw new Error("Not authenticated");const{data:x}=await Qe("users",t,"security test: reading own user to get current is_admin value"),E=x?.permission_flags?.is_admin??!1;return await zl("users",t,{"permission_flags.is_admin":!E},"security test: attempting to toggle is_admin (should fail)"),`Was able to change is_admin from ${E} to ${!E} (SECURITY ISSUE!)`},!0);break;case"Toggle is_test in own permission_flags":await u(S,async()=>{if(!t)throw new Error("Not authenticated");const{data:x}=await Qe("users",t,"security test: reading own user to get current is_test value"),E=x?.permission_flags?.is_test??!1;return await zl("users",t,{"permission_flags.is_test":!E},"security test: attempting to toggle is_test (should fail)"),`Was able to change is_test from ${E} to ${!E} (SECURITY ISSUE!)`},!0);break;case"Read own user document":await u(S,async()=>{if(!t)throw new Error("Not authenticated");const{exists:x}=await Qe("users",t,"security test: reading own user document (should succeed)");if(x)return"Successfully read own document";throw new Error("Document does not exist")},!1);break}}async function m(S){e.find(E=>E.name===S)||n(E=>[...E,{name:S,status:"pending",message:"",expectedToFail:!0}]),a(!0),await f(S),a(!1)}const g=e.filter(S=>S.status==="passed").length,_=e.filter(S=>S.status==="failed").length,v=e.length;return c.jsxs("div",{children:[c.jsx("p",{style:FT,children:'Run security tests to verify Firestore rules are working correctly. Tests that are expected to fail (blocked by security rules) should show as "passed".'}),c.jsx("div",{style:{marginBottom:"1.5rem"},children:c.jsx(De,{onClick:h,disabled:r,variant:"primary",children:r?"Running Tests...":"Run All Tests"})}),e.length>0&&c.jsx(gU,{totalCount:v,passedCount:g,failedCount:_}),c.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:[c.jsx("h3",{style:{margin:"0.5rem 0"},children:"Individual Tests"}),c.jsx(bl,{name:"Read unauthorized budget",description:"Try to read a budget the user doesn't have access to",expectedBehavior:"Should be blocked by Firestore rules",result:e.find(S=>S.name==="Read unauthorized budget"),onRun:()=>m("Read unauthorized budget"),disabled:r}),c.jsx(bl,{name:"Read another user's document",description:"Try to read another user's profile document",expectedBehavior:"Should be blocked by Firestore rules",result:e.find(S=>S.name==="Read another user's document"),onRun:()=>m("Read another user's document"),disabled:r}),c.jsx(bl,{name:"Read unauthorized budget month",description:"Try to read a month document for a budget you don't have access to",expectedBehavior:"Should be blocked - months inherit budget access",result:e.find(S=>S.name==="Read unauthorized budget month"),onRun:()=>m("Read unauthorized budget month"),disabled:r}),c.jsx(bl,{name:"Toggle is_admin in own permission_flags",description:"Try to change your admin privileges (toggles current value)",expectedBehavior:"Should be blocked - permission_flags is protected",result:e.find(S=>S.name==="Toggle is_admin in own permission_flags"),onRun:()=>m("Toggle is_admin in own permission_flags"),disabled:r}),c.jsx(bl,{name:"Toggle is_test in own permission_flags",description:"Try to change your test privileges (toggles current value)",expectedBehavior:"Should be blocked - permission_flags is protected",result:e.find(S=>S.name==="Toggle is_test in own permission_flags"),onRun:()=>m("Toggle is_test in own permission_flags"),disabled:r}),c.jsx(bl,{name:"Read own user document",description:"Read your own user profile document",expectedBehavior:"Should succeed - users can read their own data",result:e.find(S=>S.name==="Read own user document"),onRun:()=>m("Read own user document"),disabled:r,expectedToSucceed:!0})]}),_>0&&c.jsxs(Ao,{style:{marginTop:"1.5rem"},children:[" ",_," test(s) failed! This may indicate a security vulnerability in your Firestore rules."]})]})}function _U({children:t}){const{addLoadingHold:e,removeLoadingHold:n}=ir(),r=T.useContext(nd),a=zn();return T.useEffect(()=>(r.is_auth_checked?n("protected-route"):e("protected-route","Checking authentication..."),()=>n("protected-route")),[r.is_auth_checked,e,n]),r.is_auth_checked?r.is_logged_in?t?c.jsx(c.Fragment,{children:t}):c.jsx(zf,{}):c.jsx(Lf,{to:"/account",state:{from:a.pathname},replace:!0}):null}function bU(){const{addLoadingHold:t,removeLoadingHold:e}=ir(),{isInitialized:n,pageTitle:r}=zt(),{isLoading:a,error:o}=kn();return T.useEffect(()=>{n?e("budget-init"):t("budget-init",a?"Fetching data from server...":"Loading budget...")},[n,a,t,e]),T.useEffect(()=>()=>e("budget-init"),[e]),o?(console.error("[BudgetLayout] Error:",o),c.jsx("div",{style:Of,children:c.jsxs("p",{style:{color:"#ef4444"},children:["Error: ",o.message]})})):c.jsx("div",{style:{...Of,paddingBottom:"5rem"},children:c.jsxs(XT,{children:[c.jsx(T6,{title:r}),n&&c.jsx(zf,{})]})})}const vU={is_logged_in:!1,is_auth_checked:!1,username:"",set_user_context:()=>{}};function xU(){const{isLoading:t,loadingMessage:e}=ir();return t?c.jsx(ic,{message:e}):null}function SU(){const[t,e]=T.useState(vU),n=wa(),r=T.useRef(!1),{addLoadingHold:a,removeLoadingHold:o}=ir();return T.useEffect(function(){r.current||(r.current=!0,n.set_user_listener(u=>{e({is_logged_in:u!=null,is_auth_checked:!0,username:u?.email??"",set_user_context:e})}))},[n]),T.useEffect(()=>{t.is_auth_checked?o("auth"):a("auth","Authenticating...")},[t.is_auth_checked,a,o]),t.is_auth_checked?c.jsx(nd.Provider,{value:t,children:c.jsx(Rk,{children:c.jsx(hB,{children:c.jsx(MB,{children:c.jsxs(_5,{children:[c.jsxs(QR,{children:[c.jsx(fn,{path:"/",element:c.jsx(H6,{})}),c.jsx(fn,{path:"/account",element:c.jsx(G6,{})}),c.jsx(fn,{path:"/budget",element:c.jsx(_U,{}),children:c.jsxs(fn,{element:c.jsx(bU,{}),children:[c.jsx(fn,{index:!0,element:c.jsx(Vw,{})}),c.jsx(fn,{path:":year/:month/:tab/:view?",element:c.jsx(Vw,{})}),c.jsx(fn,{path:"analytics",element:c.jsx(qz,{})}),c.jsx(fn,{path:"my-budgets",element:c.jsx(Kz,{})}),c.jsxs(fn,{path:"settings",element:c.jsx(Xz,{}),children:[c.jsx(fn,{index:!0,element:c.jsx(Lf,{to:"categories",replace:!0})}),c.jsx(fn,{path:"accounts",element:c.jsx(sU,{})}),c.jsx(fn,{path:"categories",element:c.jsx(lU,{})}),c.jsx(fn,{path:"users",element:c.jsx(cU,{})})]}),c.jsxs(fn,{path:"admin",element:c.jsx(dU,{}),children:[c.jsx(fn,{path:"budget",element:c.jsx(hU,{})}),c.jsx(fn,{path:"feedback",element:c.jsx(fU,{})}),c.jsx(fn,{path:"migration",element:c.jsx(pU,{})}),c.jsx(fn,{path:"tests",element:c.jsx(yU,{})})]})]})})]}),c.jsx(w6,{}),c.jsx(v6,{}),c.jsx(q6,{})]})})})})}):null}function wU(){return c.jsxs(R5,{children:[c.jsx(xU,{}),c.jsx(SU,{})]})}Qj.createRoot(document.getElementById("root")).render(c.jsx(T.StrictMode,{children:c.jsx(wU,{})}));
