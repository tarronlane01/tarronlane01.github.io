(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function n(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=n(i);fetch(i.href,o)}})();var Kh=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function eR(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Dg={exports:{}},ju={};var zx;function tR(){if(zx)return ju;zx=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function n(r,i,o){var l=null;if(o!==void 0&&(l=""+o),i.key!==void 0&&(l=""+i.key),"key"in i){o={};for(var u in i)u!=="key"&&(o[u]=i[u])}else o=i;return i=o.ref,{$$typeof:t,type:r,key:l,ref:i!==void 0?i:null,props:o}}return ju.Fragment=e,ju.jsx=n,ju.jsxs=n,ju}var Lx;function nR(){return Lx||(Lx=1,Dg.exports=tR()),Dg.exports}var d=nR(),kg={exports:{}},nt={};var Ux;function rR(){if(Ux)return nt;Ux=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),o=Symbol.for("react.consumer"),l=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),h=Symbol.for("react.suspense"),f=Symbol.for("react.memo"),p=Symbol.for("react.lazy"),g=Symbol.for("react.activity"),b=Symbol.iterator;function _(B){return B===null||typeof B!="object"?null:(B=b&&B[b]||B["@@iterator"],typeof B=="function"?B:null)}var w={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},x=Object.assign,S={};function C(B,q,ee){this.props=B,this.context=q,this.refs=S,this.updater=ee||w}C.prototype.isReactComponent={},C.prototype.setState=function(B,q){if(typeof B!="object"&&typeof B!="function"&&B!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,B,q,"setState")},C.prototype.forceUpdate=function(B){this.updater.enqueueForceUpdate(this,B,"forceUpdate")};function T(){}T.prototype=C.prototype;function I(B,q,ee){this.props=B,this.context=q,this.refs=S,this.updater=ee||w}var M=I.prototype=new T;M.constructor=I,x(M,C.prototype),M.isPureReactComponent=!0;var U=Array.isArray;function H(){}var O={H:null,A:null,T:null,S:null},P=Object.prototype.hasOwnProperty;function N(B,q,ee){var ne=ee.ref;return{$$typeof:t,type:B,key:q,ref:ne!==void 0?ne:null,props:ee}}function V(B,q){return N(B.type,q,B.props)}function $(B){return typeof B=="object"&&B!==null&&B.$$typeof===t}function A(B){var q={"=":"=0",":":"=2"};return"$"+B.replace(/[=:]/g,function(ee){return q[ee]})}var k=/\/+/g;function D(B,q){return typeof B=="object"&&B!==null&&B.key!=null?A(""+B.key):q.toString(36)}function K(B){switch(B.status){case"fulfilled":return B.value;case"rejected":throw B.reason;default:switch(typeof B.status=="string"?B.then(H,H):(B.status="pending",B.then(function(q){B.status==="pending"&&(B.status="fulfilled",B.value=q)},function(q){B.status==="pending"&&(B.status="rejected",B.reason=q)})),B.status){case"fulfilled":return B.value;case"rejected":throw B.reason}}throw B}function X(B,q,ee,ne,le){var he=typeof B;(he==="undefined"||he==="boolean")&&(B=null);var Ee=!1;if(B===null)Ee=!0;else switch(he){case"bigint":case"string":case"number":Ee=!0;break;case"object":switch(B.$$typeof){case t:case e:Ee=!0;break;case p:return Ee=B._init,X(Ee(B._payload),q,ee,ne,le)}}if(Ee)return le=le(B),Ee=ne===""?"."+D(B,0):ne,U(le)?(ee="",Ee!=null&&(ee=Ee.replace(k,"$&/")+"/"),X(le,q,ee,"",function(Me){return Me})):le!=null&&($(le)&&(le=V(le,ee+(le.key==null||B&&B.key===le.key?"":(""+le.key).replace(k,"$&/")+"/")+Ee)),q.push(le)),1;Ee=0;var ae=ne===""?".":ne+":";if(U(B))for(var fe=0;fe<B.length;fe++)ne=B[fe],he=ae+D(ne,fe),Ee+=X(ne,q,ee,he,le);else if(fe=_(B),typeof fe=="function")for(B=fe.call(B),fe=0;!(ne=B.next()).done;)ne=ne.value,he=ae+D(ne,fe++),Ee+=X(ne,q,ee,he,le);else if(he==="object"){if(typeof B.then=="function")return X(K(B),q,ee,ne,le);throw q=String(B),Error("Objects are not valid as a React child (found: "+(q==="[object Object]"?"object with keys {"+Object.keys(B).join(", ")+"}":q)+"). If you meant to render a collection of children, use an array instead.")}return Ee}function G(B,q,ee){if(B==null)return B;var ne=[],le=0;return X(B,ne,"","",function(he){return q.call(ee,he,le++)}),ne}function te(B){if(B._status===-1){var q=B._result;q=q(),q.then(function(ee){(B._status===0||B._status===-1)&&(B._status=1,B._result=ee)},function(ee){(B._status===0||B._status===-1)&&(B._status=2,B._result=ee)}),B._status===-1&&(B._status=0,B._result=q)}if(B._status===1)return B._result.default;throw B._result}var Q=typeof reportError=="function"?reportError:function(B){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var q=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof B=="object"&&B!==null&&typeof B.message=="string"?String(B.message):String(B),error:B});if(!window.dispatchEvent(q))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",B);return}console.error(B)},se={map:G,forEach:function(B,q,ee){G(B,function(){q.apply(this,arguments)},ee)},count:function(B){var q=0;return G(B,function(){q++}),q},toArray:function(B){return G(B,function(q){return q})||[]},only:function(B){if(!$(B))throw Error("React.Children.only expected to receive a single React element child.");return B}};return nt.Activity=g,nt.Children=se,nt.Component=C,nt.Fragment=n,nt.Profiler=i,nt.PureComponent=I,nt.StrictMode=r,nt.Suspense=h,nt.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=O,nt.__COMPILER_RUNTIME={__proto__:null,c:function(B){return O.H.useMemoCache(B)}},nt.cache=function(B){return function(){return B.apply(null,arguments)}},nt.cacheSignal=function(){return null},nt.cloneElement=function(B,q,ee){if(B==null)throw Error("The argument must be a React element, but you passed "+B+".");var ne=x({},B.props),le=B.key;if(q!=null)for(he in q.key!==void 0&&(le=""+q.key),q)!P.call(q,he)||he==="key"||he==="__self"||he==="__source"||he==="ref"&&q.ref===void 0||(ne[he]=q[he]);var he=arguments.length-2;if(he===1)ne.children=ee;else if(1<he){for(var Ee=Array(he),ae=0;ae<he;ae++)Ee[ae]=arguments[ae+2];ne.children=Ee}return N(B.type,le,ne)},nt.createContext=function(B){return B={$$typeof:l,_currentValue:B,_currentValue2:B,_threadCount:0,Provider:null,Consumer:null},B.Provider=B,B.Consumer={$$typeof:o,_context:B},B},nt.createElement=function(B,q,ee){var ne,le={},he=null;if(q!=null)for(ne in q.key!==void 0&&(he=""+q.key),q)P.call(q,ne)&&ne!=="key"&&ne!=="__self"&&ne!=="__source"&&(le[ne]=q[ne]);var Ee=arguments.length-2;if(Ee===1)le.children=ee;else if(1<Ee){for(var ae=Array(Ee),fe=0;fe<Ee;fe++)ae[fe]=arguments[fe+2];le.children=ae}if(B&&B.defaultProps)for(ne in Ee=B.defaultProps,Ee)le[ne]===void 0&&(le[ne]=Ee[ne]);return N(B,he,le)},nt.createRef=function(){return{current:null}},nt.forwardRef=function(B){return{$$typeof:u,render:B}},nt.isValidElement=$,nt.lazy=function(B){return{$$typeof:p,_payload:{_status:-1,_result:B},_init:te}},nt.memo=function(B,q){return{$$typeof:f,type:B,compare:q===void 0?null:q}},nt.startTransition=function(B){var q=O.T,ee={};O.T=ee;try{var ne=B(),le=O.S;le!==null&&le(ee,ne),typeof ne=="object"&&ne!==null&&typeof ne.then=="function"&&ne.then(H,Q)}catch(he){Q(he)}finally{q!==null&&ee.types!==null&&(q.types=ee.types),O.T=q}},nt.unstable_useCacheRefresh=function(){return O.H.useCacheRefresh()},nt.use=function(B){return O.H.use(B)},nt.useActionState=function(B,q,ee){return O.H.useActionState(B,q,ee)},nt.useCallback=function(B,q){return O.H.useCallback(B,q)},nt.useContext=function(B){return O.H.useContext(B)},nt.useDebugValue=function(){},nt.useDeferredValue=function(B,q){return O.H.useDeferredValue(B,q)},nt.useEffect=function(B,q){return O.H.useEffect(B,q)},nt.useEffectEvent=function(B){return O.H.useEffectEvent(B)},nt.useId=function(){return O.H.useId()},nt.useImperativeHandle=function(B,q,ee){return O.H.useImperativeHandle(B,q,ee)},nt.useInsertionEffect=function(B,q){return O.H.useInsertionEffect(B,q)},nt.useLayoutEffect=function(B,q){return O.H.useLayoutEffect(B,q)},nt.useMemo=function(B,q){return O.H.useMemo(B,q)},nt.useOptimistic=function(B,q){return O.H.useOptimistic(B,q)},nt.useReducer=function(B,q,ee){return O.H.useReducer(B,q,ee)},nt.useRef=function(B){return O.H.useRef(B)},nt.useState=function(B){return O.H.useState(B)},nt.useSyncExternalStore=function(B,q,ee){return O.H.useSyncExternalStore(B,q,ee)},nt.useTransition=function(){return O.H.useTransition()},nt.version="19.2.3",nt}var Fx;function Wy(){return Fx||(Fx=1,kg.exports=rR()),kg.exports}var R=Wy(),Mg={exports:{}},Ru={},Og={exports:{}},Ng={};var Vx;function sR(){return Vx||(Vx=1,(function(t){function e(X,G){var te=X.length;X.push(G);e:for(;0<te;){var Q=te-1>>>1,se=X[Q];if(0<i(se,G))X[Q]=G,X[te]=se,te=Q;else break e}}function n(X){return X.length===0?null:X[0]}function r(X){if(X.length===0)return null;var G=X[0],te=X.pop();if(te!==G){X[0]=te;e:for(var Q=0,se=X.length,B=se>>>1;Q<B;){var q=2*(Q+1)-1,ee=X[q],ne=q+1,le=X[ne];if(0>i(ee,te))ne<se&&0>i(le,ee)?(X[Q]=le,X[ne]=te,Q=ne):(X[Q]=ee,X[q]=te,Q=q);else if(ne<se&&0>i(le,te))X[Q]=le,X[ne]=te,Q=ne;else break e}}return G}function i(X,G){var te=X.sortIndex-G.sortIndex;return te!==0?te:X.id-G.id}if(t.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var o=performance;t.unstable_now=function(){return o.now()}}else{var l=Date,u=l.now();t.unstable_now=function(){return l.now()-u}}var h=[],f=[],p=1,g=null,b=3,_=!1,w=!1,x=!1,S=!1,C=typeof setTimeout=="function"?setTimeout:null,T=typeof clearTimeout=="function"?clearTimeout:null,I=typeof setImmediate<"u"?setImmediate:null;function M(X){for(var G=n(f);G!==null;){if(G.callback===null)r(f);else if(G.startTime<=X)r(f),G.sortIndex=G.expirationTime,e(h,G);else break;G=n(f)}}function U(X){if(x=!1,M(X),!w)if(n(h)!==null)w=!0,H||(H=!0,A());else{var G=n(f);G!==null&&K(U,G.startTime-X)}}var H=!1,O=-1,P=5,N=-1;function V(){return S?!0:!(t.unstable_now()-N<P)}function $(){if(S=!1,H){var X=t.unstable_now();N=X;var G=!0;try{e:{w=!1,x&&(x=!1,T(O),O=-1),_=!0;var te=b;try{t:{for(M(X),g=n(h);g!==null&&!(g.expirationTime>X&&V());){var Q=g.callback;if(typeof Q=="function"){g.callback=null,b=g.priorityLevel;var se=Q(g.expirationTime<=X);if(X=t.unstable_now(),typeof se=="function"){g.callback=se,M(X),G=!0;break t}g===n(h)&&r(h),M(X)}else r(h);g=n(h)}if(g!==null)G=!0;else{var B=n(f);B!==null&&K(U,B.startTime-X),G=!1}}break e}finally{g=null,b=te,_=!1}G=void 0}}finally{G?A():H=!1}}}var A;if(typeof I=="function")A=function(){I($)};else if(typeof MessageChannel<"u"){var k=new MessageChannel,D=k.port2;k.port1.onmessage=$,A=function(){D.postMessage(null)}}else A=function(){C($,0)};function K(X,G){O=C(function(){X(t.unstable_now())},G)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(X){X.callback=null},t.unstable_forceFrameRate=function(X){0>X||125<X?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):P=0<X?Math.floor(1e3/X):5},t.unstable_getCurrentPriorityLevel=function(){return b},t.unstable_next=function(X){switch(b){case 1:case 2:case 3:var G=3;break;default:G=b}var te=b;b=G;try{return X()}finally{b=te}},t.unstable_requestPaint=function(){S=!0},t.unstable_runWithPriority=function(X,G){switch(X){case 1:case 2:case 3:case 4:case 5:break;default:X=3}var te=b;b=X;try{return G()}finally{b=te}},t.unstable_scheduleCallback=function(X,G,te){var Q=t.unstable_now();switch(typeof te=="object"&&te!==null?(te=te.delay,te=typeof te=="number"&&0<te?Q+te:Q):te=Q,X){case 1:var se=-1;break;case 2:se=250;break;case 5:se=1073741823;break;case 4:se=1e4;break;default:se=5e3}return se=te+se,X={id:p++,callback:G,priorityLevel:X,startTime:te,expirationTime:se,sortIndex:-1},te>Q?(X.sortIndex=te,e(f,X),n(h)===null&&X===n(f)&&(x?(T(O),O=-1):x=!0,K(U,te-Q))):(X.sortIndex=se,e(h,X),w||_||(w=!0,H||(H=!0,A()))),X},t.unstable_shouldYield=V,t.unstable_wrapCallback=function(X){var G=b;return function(){var te=b;b=G;try{return X.apply(this,arguments)}finally{b=te}}}})(Ng)),Ng}var $x;function iR(){return $x||($x=1,Og.exports=sR()),Og.exports}var Pg={exports:{}},Kn={};var qx;function aR(){if(qx)return Kn;qx=1;var t=Wy();function e(h){var f="https://react.dev/errors/"+h;if(1<arguments.length){f+="?args[]="+encodeURIComponent(arguments[1]);for(var p=2;p<arguments.length;p++)f+="&args[]="+encodeURIComponent(arguments[p])}return"Minified React error #"+h+"; visit "+f+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function n(){}var r={d:{f:n,r:function(){throw Error(e(522))},D:n,C:n,L:n,m:n,X:n,S:n,M:n},p:0,findDOMNode:null},i=Symbol.for("react.portal");function o(h,f,p){var g=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:i,key:g==null?null:""+g,children:h,containerInfo:f,implementation:p}}var l=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function u(h,f){if(h==="font")return"";if(typeof f=="string")return f==="use-credentials"?f:""}return Kn.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=r,Kn.createPortal=function(h,f){var p=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!f||f.nodeType!==1&&f.nodeType!==9&&f.nodeType!==11)throw Error(e(299));return o(h,f,null,p)},Kn.flushSync=function(h){var f=l.T,p=r.p;try{if(l.T=null,r.p=2,h)return h()}finally{l.T=f,r.p=p,r.d.f()}},Kn.preconnect=function(h,f){typeof h=="string"&&(f?(f=f.crossOrigin,f=typeof f=="string"?f==="use-credentials"?f:"":void 0):f=null,r.d.C(h,f))},Kn.prefetchDNS=function(h){typeof h=="string"&&r.d.D(h)},Kn.preinit=function(h,f){if(typeof h=="string"&&f&&typeof f.as=="string"){var p=f.as,g=u(p,f.crossOrigin),b=typeof f.integrity=="string"?f.integrity:void 0,_=typeof f.fetchPriority=="string"?f.fetchPriority:void 0;p==="style"?r.d.S(h,typeof f.precedence=="string"?f.precedence:void 0,{crossOrigin:g,integrity:b,fetchPriority:_}):p==="script"&&r.d.X(h,{crossOrigin:g,integrity:b,fetchPriority:_,nonce:typeof f.nonce=="string"?f.nonce:void 0})}},Kn.preinitModule=function(h,f){if(typeof h=="string")if(typeof f=="object"&&f!==null){if(f.as==null||f.as==="script"){var p=u(f.as,f.crossOrigin);r.d.M(h,{crossOrigin:p,integrity:typeof f.integrity=="string"?f.integrity:void 0,nonce:typeof f.nonce=="string"?f.nonce:void 0})}}else f==null&&r.d.M(h)},Kn.preload=function(h,f){if(typeof h=="string"&&typeof f=="object"&&f!==null&&typeof f.as=="string"){var p=f.as,g=u(p,f.crossOrigin);r.d.L(h,p,{crossOrigin:g,integrity:typeof f.integrity=="string"?f.integrity:void 0,nonce:typeof f.nonce=="string"?f.nonce:void 0,type:typeof f.type=="string"?f.type:void 0,fetchPriority:typeof f.fetchPriority=="string"?f.fetchPriority:void 0,referrerPolicy:typeof f.referrerPolicy=="string"?f.referrerPolicy:void 0,imageSrcSet:typeof f.imageSrcSet=="string"?f.imageSrcSet:void 0,imageSizes:typeof f.imageSizes=="string"?f.imageSizes:void 0,media:typeof f.media=="string"?f.media:void 0})}},Kn.preloadModule=function(h,f){if(typeof h=="string")if(f){var p=u(f.as,f.crossOrigin);r.d.m(h,{as:typeof f.as=="string"&&f.as!=="script"?f.as:void 0,crossOrigin:p,integrity:typeof f.integrity=="string"?f.integrity:void 0})}else r.d.m(h)},Kn.requestFormReset=function(h){r.d.r(h)},Kn.unstable_batchedUpdates=function(h,f){return h(f)},Kn.useFormState=function(h,f,p){return l.H.useFormState(h,f,p)},Kn.useFormStatus=function(){return l.H.useHostTransitionStatus()},Kn.version="19.2.3",Kn}var Hx;function oR(){if(Hx)return Pg.exports;Hx=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),Pg.exports=aR(),Pg.exports}var Gx;function lR(){if(Gx)return Ru;Gx=1;var t=iR(),e=Wy(),n=oR();function r(s){var a="https://react.dev/errors/"+s;if(1<arguments.length){a+="?args[]="+encodeURIComponent(arguments[1]);for(var c=2;c<arguments.length;c++)a+="&args[]="+encodeURIComponent(arguments[c])}return"Minified React error #"+s+"; visit "+a+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(s){return!(!s||s.nodeType!==1&&s.nodeType!==9&&s.nodeType!==11)}function o(s){var a=s,c=s;if(s.alternate)for(;a.return;)a=a.return;else{s=a;do a=s,(a.flags&4098)!==0&&(c=a.return),s=a.return;while(s)}return a.tag===3?c:null}function l(s){if(s.tag===13){var a=s.memoizedState;if(a===null&&(s=s.alternate,s!==null&&(a=s.memoizedState)),a!==null)return a.dehydrated}return null}function u(s){if(s.tag===31){var a=s.memoizedState;if(a===null&&(s=s.alternate,s!==null&&(a=s.memoizedState)),a!==null)return a.dehydrated}return null}function h(s){if(o(s)!==s)throw Error(r(188))}function f(s){var a=s.alternate;if(!a){if(a=o(s),a===null)throw Error(r(188));return a!==s?null:s}for(var c=s,m=a;;){var v=c.return;if(v===null)break;var E=v.alternate;if(E===null){if(m=v.return,m!==null){c=m;continue}break}if(v.child===E.child){for(E=v.child;E;){if(E===c)return h(v),s;if(E===m)return h(v),a;E=E.sibling}throw Error(r(188))}if(c.return!==m.return)c=v,m=E;else{for(var z=!1,W=v.child;W;){if(W===c){z=!0,c=v,m=E;break}if(W===m){z=!0,m=v,c=E;break}W=W.sibling}if(!z){for(W=E.child;W;){if(W===c){z=!0,c=E,m=v;break}if(W===m){z=!0,m=E,c=v;break}W=W.sibling}if(!z)throw Error(r(189))}}if(c.alternate!==m)throw Error(r(190))}if(c.tag!==3)throw Error(r(188));return c.stateNode.current===c?s:a}function p(s){var a=s.tag;if(a===5||a===26||a===27||a===6)return s;for(s=s.child;s!==null;){if(a=p(s),a!==null)return a;s=s.sibling}return null}var g=Object.assign,b=Symbol.for("react.element"),_=Symbol.for("react.transitional.element"),w=Symbol.for("react.portal"),x=Symbol.for("react.fragment"),S=Symbol.for("react.strict_mode"),C=Symbol.for("react.profiler"),T=Symbol.for("react.consumer"),I=Symbol.for("react.context"),M=Symbol.for("react.forward_ref"),U=Symbol.for("react.suspense"),H=Symbol.for("react.suspense_list"),O=Symbol.for("react.memo"),P=Symbol.for("react.lazy"),N=Symbol.for("react.activity"),V=Symbol.for("react.memo_cache_sentinel"),$=Symbol.iterator;function A(s){return s===null||typeof s!="object"?null:(s=$&&s[$]||s["@@iterator"],typeof s=="function"?s:null)}var k=Symbol.for("react.client.reference");function D(s){if(s==null)return null;if(typeof s=="function")return s.$$typeof===k?null:s.displayName||s.name||null;if(typeof s=="string")return s;switch(s){case x:return"Fragment";case C:return"Profiler";case S:return"StrictMode";case U:return"Suspense";case H:return"SuspenseList";case N:return"Activity"}if(typeof s=="object")switch(s.$$typeof){case w:return"Portal";case I:return s.displayName||"Context";case T:return(s._context.displayName||"Context")+".Consumer";case M:var a=s.render;return s=s.displayName,s||(s=a.displayName||a.name||"",s=s!==""?"ForwardRef("+s+")":"ForwardRef"),s;case O:return a=s.displayName||null,a!==null?a:D(s.type)||"Memo";case P:a=s._payload,s=s._init;try{return D(s(a))}catch{}}return null}var K=Array.isArray,X=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,G=n.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,te={pending:!1,data:null,method:null,action:null},Q=[],se=-1;function B(s){return{current:s}}function q(s){0>se||(s.current=Q[se],Q[se]=null,se--)}function ee(s,a){se++,Q[se]=s.current,s.current=a}var ne=B(null),le=B(null),he=B(null),Ee=B(null);function ae(s,a){switch(ee(he,a),ee(le,s),ee(ne,null),a.nodeType){case 9:case 11:s=(s=a.documentElement)&&(s=s.namespaceURI)?ox(s):0;break;default:if(s=a.tagName,a=a.namespaceURI)a=ox(a),s=lx(a,s);else switch(s){case"svg":s=1;break;case"math":s=2;break;default:s=0}}q(ne),ee(ne,s)}function fe(){q(ne),q(le),q(he)}function Me(s){s.memoizedState!==null&&ee(Ee,s);var a=ne.current,c=lx(a,s.type);a!==c&&(ee(le,s),ee(ne,c))}function Ne(s){le.current===s&&(q(ne),q(le)),Ee.current===s&&(q(Ee),Eu._currentValue=te)}var tt,Ue;function L(s){if(tt===void 0)try{throw Error()}catch(c){var a=c.stack.trim().match(/\n( *(at )?)/);tt=a&&a[1]||"",Ue=-1<c.stack.indexOf(`
    at`)?" (<anonymous>)":-1<c.stack.indexOf("@")?"@unknown:0:0":""}return`
`+tt+s+Ue}var de=!1;function _e(s,a){if(!s||de)return"";de=!0;var c=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var m={DetermineComponentFrameRoot:function(){try{if(a){var De=function(){throw Error()};if(Object.defineProperty(De.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(De,[])}catch(xe){var be=xe}Reflect.construct(s,[],De)}else{try{De.call()}catch(xe){be=xe}s.call(De.prototype)}}else{try{throw Error()}catch(xe){be=xe}(De=s())&&typeof De.catch=="function"&&De.catch(function(){})}}catch(xe){if(xe&&be&&typeof xe.stack=="string")return[xe.stack,be.stack]}return[null,null]}};m.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var v=Object.getOwnPropertyDescriptor(m.DetermineComponentFrameRoot,"name");v&&v.configurable&&Object.defineProperty(m.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var E=m.DetermineComponentFrameRoot(),z=E[0],W=E[1];if(z&&W){var re=z.split(`
`),ye=W.split(`
`);for(v=m=0;m<re.length&&!re[m].includes("DetermineComponentFrameRoot");)m++;for(;v<ye.length&&!ye[v].includes("DetermineComponentFrameRoot");)v++;if(m===re.length||v===ye.length)for(m=re.length-1,v=ye.length-1;1<=m&&0<=v&&re[m]!==ye[v];)v--;for(;1<=m&&0<=v;m--,v--)if(re[m]!==ye[v]){if(m!==1||v!==1)do if(m--,v--,0>v||re[m]!==ye[v]){var Te=`
`+re[m].replace(" at new "," at ");return s.displayName&&Te.includes("<anonymous>")&&(Te=Te.replace("<anonymous>",s.displayName)),Te}while(1<=m&&0<=v);break}}}finally{de=!1,Error.prepareStackTrace=c}return(c=s?s.displayName||s.name:"")?L(c):""}function J(s,a){switch(s.tag){case 26:case 27:case 5:return L(s.type);case 16:return L("Lazy");case 13:return s.child!==a&&a!==null?L("Suspense Fallback"):L("Suspense");case 19:return L("SuspenseList");case 0:case 15:return _e(s.type,!1);case 11:return _e(s.type.render,!1);case 1:return _e(s.type,!0);case 31:return L("Activity");default:return""}}function Z(s){try{var a="",c=null;do a+=J(s,c),c=s,s=s.return;while(s);return a}catch(m){return`
Error generating stack: `+m.message+`
`+m.stack}}var oe=Object.prototype.hasOwnProperty,Se=t.unstable_scheduleCallback,we=t.unstable_cancelCallback,ie=t.unstable_shouldYield,Re=t.unstable_requestPaint,Pe=t.unstable_now,Oe=t.unstable_getCurrentPriorityLevel,He=t.unstable_ImmediatePriority,xt=t.unstable_UserBlockingPriority,it=t.unstable_NormalPriority,Wn=t.unstable_LowPriority,ys=t.unstable_IdlePriority,rr=t.log,_s=t.unstable_setDisableYieldValue,vt=null,nn=null;function Qn(s){if(typeof rr=="function"&&_s(s),nn&&typeof nn.setStrictMode=="function")try{nn.setStrictMode(vt,s)}catch{}}var Et=Math.clz32?Math.clz32:tl,Ja=Math.log,Ui=Math.LN2;function tl(s){return s>>>=0,s===0?32:31-(Ja(s)/Ui|0)|0}var Br=256,bs=262144,Ut=4194304;function sr(s){var a=s&42;if(a!==0)return a;switch(s&-s){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return s&261888;case 262144:case 524288:case 1048576:case 2097152:return s&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return s&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return s}}function vs(s,a,c){var m=s.pendingLanes;if(m===0)return 0;var v=0,E=s.suspendedLanes,z=s.pingedLanes;s=s.warmLanes;var W=m&134217727;return W!==0?(m=W&~E,m!==0?v=sr(m):(z&=W,z!==0?v=sr(z):c||(c=W&~s,c!==0&&(v=sr(c))))):(W=m&~E,W!==0?v=sr(W):z!==0?v=sr(z):c||(c=m&~s,c!==0&&(v=sr(c)))),v===0?0:a!==0&&a!==v&&(a&E)===0&&(E=v&-v,c=a&-a,E>=c||E===32&&(c&4194048)!==0)?a:v}function es(s,a){return(s.pendingLanes&~(s.suspendedLanes&~s.pingedLanes)&a)===0}function Nm(s,a){switch(s){case 1:case 2:case 4:case 8:case 64:return a+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Td(){var s=Ut;return Ut<<=1,(Ut&62914560)===0&&(Ut=4194304),s}function xs(s){for(var a=[],c=0;31>c;c++)a.push(s);return a}function eo(s,a){s.pendingLanes|=a,a!==268435456&&(s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0)}function Pm(s,a,c,m,v,E){var z=s.pendingLanes;s.pendingLanes=c,s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0,s.expiredLanes&=c,s.entangledLanes&=c,s.errorRecoveryDisabledLanes&=c,s.shellSuspendCounter=0;var W=s.entanglements,re=s.expirationTimes,ye=s.hiddenUpdates;for(c=z&~c;0<c;){var Te=31-Et(c),De=1<<Te;W[Te]=0,re[Te]=-1;var be=ye[Te];if(be!==null)for(ye[Te]=null,Te=0;Te<be.length;Te++){var xe=be[Te];xe!==null&&(xe.lane&=-536870913)}c&=~De}m!==0&&to(s,m,0),E!==0&&v===0&&s.tag!==0&&(s.suspendedLanes|=E&~(z&~a))}function to(s,a,c){s.pendingLanes|=a,s.suspendedLanes&=~a;var m=31-Et(a);s.entangledLanes|=a,s.entanglements[m]=s.entanglements[m]|1073741824|c&261930}function Rc(s,a){var c=s.entangledLanes|=a;for(s=s.entanglements;c;){var m=31-Et(c),v=1<<m;v&a|s[m]&a&&(s[m]|=a),c&=~v}}function Ic(s,a){var c=a&-a;return c=(c&42)!==0?1:no(c),(c&(s.suspendedLanes|a))!==0?0:c}function no(s){switch(s){case 2:s=1;break;case 8:s=4;break;case 32:s=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:s=128;break;case 268435456:s=134217728;break;default:s=0}return s}function Zs(s){return s&=-s,2<s?8<s?(s&134217727)!==0?32:268435456:8:2}function Ad(){var s=G.p;return s!==0?s:(s=window.event,s===void 0?32:Dx(s.type))}function ts(s,a){var c=G.p;try{return G.p=s,a()}finally{G.p=c}}var ns=Math.random().toString(36).slice(2),fn="__reactFiber$"+ns,kn="__reactProps$"+ns,ws="__reactContainer$"+ns,nl="__reactEvents$"+ns,Bm="__reactListeners$"+ns,jd="__reactHandles$"+ns,Rd="__reactResources$"+ns,Ss="__reactMarker$"+ns;function rl(s){delete s[fn],delete s[kn],delete s[nl],delete s[Bm],delete s[jd]}function Es(s){var a=s[fn];if(a)return a;for(var c=s.parentNode;c;){if(a=c[ws]||c[fn]){if(c=a.alternate,a.child!==null||c!==null&&c.child!==null)for(s=px(s);s!==null;){if(c=s[fn])return c;s=px(s)}return a}s=c,c=s.parentNode}return null}function zr(s){if(s=s[fn]||s[ws]){var a=s.tag;if(a===5||a===6||a===13||a===31||a===26||a===27||a===3)return s}return null}function Sr(s){var a=s.tag;if(a===5||a===26||a===27||a===6)return s.stateNode;throw Error(r(33))}function Cs(s){var a=s[Rd];return a||(a=s[Rd]={hoistableStyles:new Map,hoistableScripts:new Map}),a}function mn(s){s[Ss]=!0}var Dc=new Set,kc={};function Ts(s,a){As(s,a),As(s+"Capture",a)}function As(s,a){for(kc[s]=a,s=0;s<a.length;s++)Dc.add(a[s])}var Mc=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Oc={},Nc={};function Id(s){return oe.call(Nc,s)?!0:oe.call(Oc,s)?!1:Mc.test(s)?Nc[s]=!0:(Oc[s]=!0,!1)}function sl(s,a,c){if(Id(a))if(c===null)s.removeAttribute(a);else{switch(typeof c){case"undefined":case"function":case"symbol":s.removeAttribute(a);return;case"boolean":var m=a.toLowerCase().slice(0,5);if(m!=="data-"&&m!=="aria-"){s.removeAttribute(a);return}}s.setAttribute(a,""+c)}}function Er(s,a,c){if(c===null)s.removeAttribute(a);else{switch(typeof c){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(a);return}s.setAttribute(a,""+c)}}function pn(s,a,c,m){if(m===null)s.removeAttribute(c);else{switch(typeof m){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(c);return}s.setAttributeNS(a,c,""+m)}}function Mn(s){switch(typeof s){case"bigint":case"boolean":case"number":case"string":case"undefined":return s;case"object":return s;default:return""}}function Fi(s){var a=s.type;return(s=s.nodeName)&&s.toLowerCase()==="input"&&(a==="checkbox"||a==="radio")}function Pc(s,a,c){var m=Object.getOwnPropertyDescriptor(s.constructor.prototype,a);if(!s.hasOwnProperty(a)&&typeof m<"u"&&typeof m.get=="function"&&typeof m.set=="function"){var v=m.get,E=m.set;return Object.defineProperty(s,a,{configurable:!0,get:function(){return v.call(this)},set:function(z){c=""+z,E.call(this,z)}}),Object.defineProperty(s,a,{enumerable:m.enumerable}),{getValue:function(){return c},setValue:function(z){c=""+z},stopTracking:function(){s._valueTracker=null,delete s[a]}}}}function It(s){if(!s._valueTracker){var a=Fi(s)?"checked":"value";s._valueTracker=Pc(s,a,""+s[a])}}function ro(s){if(!s)return!1;var a=s._valueTracker;if(!a)return!0;var c=a.getValue(),m="";return s&&(m=Fi(s)?s.checked?"true":"false":s.value),s=m,s!==c?(a.setValue(s),!0):!1}function js(s){if(s=s||(typeof document<"u"?document:void 0),typeof s>"u")return null;try{return s.activeElement||s.body}catch{return s.body}}var so=/[\n"\\]/g;function dr(s){return s.replace(so,function(a){return"\\"+a.charCodeAt(0).toString(16)+" "})}function il(s,a,c,m,v,E,z,W){s.name="",z!=null&&typeof z!="function"&&typeof z!="symbol"&&typeof z!="boolean"?s.type=z:s.removeAttribute("type"),a!=null?z==="number"?(a===0&&s.value===""||s.value!=a)&&(s.value=""+Mn(a)):s.value!==""+Mn(a)&&(s.value=""+Mn(a)):z!=="submit"&&z!=="reset"||s.removeAttribute("value"),a!=null?Bc(s,z,Mn(a)):c!=null?Bc(s,z,Mn(c)):m!=null&&s.removeAttribute("value"),v==null&&E!=null&&(s.defaultChecked=!!E),v!=null&&(s.checked=v&&typeof v!="function"&&typeof v!="symbol"),W!=null&&typeof W!="function"&&typeof W!="symbol"&&typeof W!="boolean"?s.name=""+Mn(W):s.removeAttribute("name")}function Dd(s,a,c,m,v,E,z,W){if(E!=null&&typeof E!="function"&&typeof E!="symbol"&&typeof E!="boolean"&&(s.type=E),a!=null||c!=null){if(!(E!=="submit"&&E!=="reset"||a!=null)){It(s);return}c=c!=null?""+Mn(c):"",a=a!=null?""+Mn(a):c,W||a===s.value||(s.value=a),s.defaultValue=a}m=m??v,m=typeof m!="function"&&typeof m!="symbol"&&!!m,s.checked=W?s.checked:!!m,s.defaultChecked=!!m,z!=null&&typeof z!="function"&&typeof z!="symbol"&&typeof z!="boolean"&&(s.name=z),It(s)}function Bc(s,a,c){a==="number"&&js(s.ownerDocument)===s||s.defaultValue===""+c||(s.defaultValue=""+c)}function Vi(s,a,c,m){if(s=s.options,a){a={};for(var v=0;v<c.length;v++)a["$"+c[v]]=!0;for(c=0;c<s.length;c++)v=a.hasOwnProperty("$"+s[c].value),s[c].selected!==v&&(s[c].selected=v),v&&m&&(s[c].defaultSelected=!0)}else{for(c=""+Mn(c),a=null,v=0;v<s.length;v++){if(s[v].value===c){s[v].selected=!0,m&&(s[v].defaultSelected=!0);return}a!==null||s[v].disabled||(a=s[v])}a!==null&&(a.selected=!0)}}function kd(s,a,c){if(a!=null&&(a=""+Mn(a),a!==s.value&&(s.value=a),c==null)){s.defaultValue!==a&&(s.defaultValue=a);return}s.defaultValue=c!=null?""+Mn(c):""}function $i(s,a,c,m){if(a==null){if(m!=null){if(c!=null)throw Error(r(92));if(K(m)){if(1<m.length)throw Error(r(93));m=m[0]}c=m}c==null&&(c=""),a=c}c=Mn(a),s.defaultValue=c,m=s.textContent,m===c&&m!==""&&m!==null&&(s.value=m),It(s)}function hr(s,a){if(a){var c=s.firstChild;if(c&&c===s.lastChild&&c.nodeType===3){c.nodeValue=a;return}}s.textContent=a}var Md=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function zc(s,a,c){var m=a.indexOf("--")===0;c==null||typeof c=="boolean"||c===""?m?s.setProperty(a,""):a==="float"?s.cssFloat="":s[a]="":m?s.setProperty(a,c):typeof c!="number"||c===0||Md.has(a)?a==="float"?s.cssFloat=c:s[a]=(""+c).trim():s[a]=c+"px"}function Lc(s,a,c){if(a!=null&&typeof a!="object")throw Error(r(62));if(s=s.style,c!=null){for(var m in c)!c.hasOwnProperty(m)||a!=null&&a.hasOwnProperty(m)||(m.indexOf("--")===0?s.setProperty(m,""):m==="float"?s.cssFloat="":s[m]="");for(var v in a)m=a[v],a.hasOwnProperty(v)&&c[v]!==m&&zc(s,v,m)}else for(var E in a)a.hasOwnProperty(E)&&zc(s,E,a[E])}function al(s){if(s.indexOf("-")===-1)return!1;switch(s){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Od=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),qi=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function ol(s){return qi.test(""+s)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":s}function rs(){}var Uc=null;function Lr(s){return s=s.target||s.srcElement||window,s.correspondingUseElement&&(s=s.correspondingUseElement),s.nodeType===3?s.parentNode:s}var Hi=null,Rs=null;function io(s){var a=zr(s);if(a&&(s=a.stateNode)){var c=s[kn]||null;e:switch(s=a.stateNode,a.type){case"input":if(il(s,c.value,c.defaultValue,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name),a=c.name,c.type==="radio"&&a!=null){for(c=s;c.parentNode;)c=c.parentNode;for(c=c.querySelectorAll('input[name="'+dr(""+a)+'"][type="radio"]'),a=0;a<c.length;a++){var m=c[a];if(m!==s&&m.form===s.form){var v=m[kn]||null;if(!v)throw Error(r(90));il(m,v.value,v.defaultValue,v.defaultValue,v.checked,v.defaultChecked,v.type,v.name)}}for(a=0;a<c.length;a++)m=c[a],m.form===s.form&&ro(m)}break e;case"textarea":kd(s,c.value,c.defaultValue);break e;case"select":a=c.value,a!=null&&Vi(s,!!c.multiple,a,!1)}}}var ll=!1;function Gi(s,a,c){if(ll)return s(a,c);ll=!0;try{var m=s(a);return m}finally{if(ll=!1,(Hi!==null||Rs!==null)&&(Ah(),Hi&&(a=Hi,s=Rs,Rs=Hi=null,io(a),s)))for(a=0;a<s.length;a++)io(s[a])}}function ss(s,a){var c=s.stateNode;if(c===null)return null;var m=c[kn]||null;if(m===null)return null;c=m[a];e:switch(a){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(m=!m.disabled)||(s=s.type,m=!(s==="button"||s==="input"||s==="select"||s==="textarea")),s=!m;break e;default:s=!1}if(s)return null;if(c&&typeof c!="function")throw Error(r(231,a,typeof c));return c}var Ur=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ao=!1;if(Ur)try{var Mt={};Object.defineProperty(Mt,"passive",{get:function(){ao=!0}}),window.addEventListener("test",Mt,Mt),window.removeEventListener("test",Mt,Mt)}catch{ao=!1}var Is=null,Fc=null,oo=null;function Vc(){if(oo)return oo;var s,a=Fc,c=a.length,m,v="value"in Is?Is.value:Is.textContent,E=v.length;for(s=0;s<c&&a[s]===v[s];s++);var z=c-s;for(m=1;m<=z&&a[c-m]===v[E-m];m++);return oo=v.slice(s,1<m?1-m:void 0)}function lo(s){var a=s.keyCode;return"charCode"in s?(s=s.charCode,s===0&&a===13&&(s=13)):s=a,s===10&&(s=13),32<=s||s===13?s:0}function Js(){return!0}function is(){return!1}function Bn(s){function a(c,m,v,E,z){this._reactName=c,this._targetInst=v,this.type=m,this.nativeEvent=E,this.target=z,this.currentTarget=null;for(var W in s)s.hasOwnProperty(W)&&(c=s[W],this[W]=c?c(E):E[W]);return this.isDefaultPrevented=(E.defaultPrevented!=null?E.defaultPrevented:E.returnValue===!1)?Js:is,this.isPropagationStopped=is,this}return g(a.prototype,{preventDefault:function(){this.defaultPrevented=!0;var c=this.nativeEvent;c&&(c.preventDefault?c.preventDefault():typeof c.returnValue!="unknown"&&(c.returnValue=!1),this.isDefaultPrevented=Js)},stopPropagation:function(){var c=this.nativeEvent;c&&(c.stopPropagation?c.stopPropagation():typeof c.cancelBubble!="unknown"&&(c.cancelBubble=!0),this.isPropagationStopped=Js)},persist:function(){},isPersistent:Js}),a}var ei={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(s){return s.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Ds=Bn(ei),Wi=g({},ei,{view:0,detail:0}),$c=Bn(Wi),Qi,cl,ks,ul=g({},Wi,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Ki,button:0,buttons:0,relatedTarget:function(s){return s.relatedTarget===void 0?s.fromElement===s.srcElement?s.toElement:s.fromElement:s.relatedTarget},movementX:function(s){return"movementX"in s?s.movementX:(s!==ks&&(ks&&s.type==="mousemove"?(Qi=s.screenX-ks.screenX,cl=s.screenY-ks.screenY):cl=Qi=0,ks=s),Qi)},movementY:function(s){return"movementY"in s?s.movementY:cl}}),qc=Bn(ul),co=g({},ul,{dataTransfer:0}),Nd=Bn(co),Pd=g({},Wi,{relatedTarget:0}),uo=Bn(Pd),Hc=g({},ei,{animationName:0,elapsedTime:0,pseudoElement:0}),Bd=Bn(Hc),dl=g({},ei,{clipboardData:function(s){return"clipboardData"in s?s.clipboardData:window.clipboardData}}),zd=Bn(dl),Ld=g({},ei,{data:0}),Ms=Bn(Ld),Ud={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Fd={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Vd={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function $d(s){var a=this.nativeEvent;return a.getModifierState?a.getModifierState(s):(s=Vd[s])?!!a[s]:!1}function Ki(){return $d}var ir=g({},Wi,{key:function(s){if(s.key){var a=Ud[s.key]||s.key;if(a!=="Unidentified")return a}return s.type==="keypress"?(s=lo(s),s===13?"Enter":String.fromCharCode(s)):s.type==="keydown"||s.type==="keyup"?Fd[s.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Ki,charCode:function(s){return s.type==="keypress"?lo(s):0},keyCode:function(s){return s.type==="keydown"||s.type==="keyup"?s.keyCode:0},which:function(s){return s.type==="keypress"?lo(s):s.type==="keydown"||s.type==="keyup"?s.keyCode:0}}),qd=Bn(ir),Hd=g({},ul,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),ti=Bn(Hd),y=g({},Wi,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Ki}),j=Bn(y),F=g({},ei,{propertyName:0,elapsedTime:0,pseudoElement:0}),Y=Bn(F),pe=g({},ul,{deltaX:function(s){return"deltaX"in s?s.deltaX:"wheelDeltaX"in s?-s.wheelDeltaX:0},deltaY:function(s){return"deltaY"in s?s.deltaY:"wheelDeltaY"in s?-s.wheelDeltaY:"wheelDelta"in s?-s.wheelDelta:0},deltaZ:0,deltaMode:0}),ve=Bn(pe),Be=g({},ei,{newState:0,oldState:0}),at=Bn(Be),on=[9,13,27,32],Ct=Ur&&"CompositionEvent"in window,Kt=null;Ur&&"documentMode"in document&&(Kt=document.documentMode);var Fr=Ur&&"TextEvent"in window&&!Kt,Os=Ur&&(!Ct||Kt&&8<Kt&&11>=Kt),as=" ",os=!1;function ho(s,a){switch(s){case"keyup":return on.indexOf(a.keyCode)!==-1;case"keydown":return a.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function hl(s){return s=s.detail,typeof s=="object"&&"data"in s?s.data:null}var fl=!1;function EA(s,a){switch(s){case"compositionend":return hl(a);case"keypress":return a.which!==32?null:(os=!0,as);case"textInput":return s=a.data,s===as&&os?null:s;default:return null}}function CA(s,a){if(fl)return s==="compositionend"||!Ct&&ho(s,a)?(s=Vc(),oo=Fc=Is=null,fl=!1,s):null;switch(s){case"paste":return null;case"keypress":if(!(a.ctrlKey||a.altKey||a.metaKey)||a.ctrlKey&&a.altKey){if(a.char&&1<a.char.length)return a.char;if(a.which)return String.fromCharCode(a.which)}return null;case"compositionend":return Os&&a.locale!=="ko"?null:a.data;default:return null}}var TA={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function __(s){var a=s&&s.nodeName&&s.nodeName.toLowerCase();return a==="input"?!!TA[s.type]:a==="textarea"}function b_(s,a,c,m){Hi?Rs?Rs.push(m):Rs=[m]:Hi=m,a=Oh(a,"onChange"),0<a.length&&(c=new Ds("onChange","change",null,c,m),s.push({event:c,listeners:a}))}var Gc=null,Wc=null;function AA(s){tx(s,0)}function Gd(s){var a=Sr(s);if(ro(a))return s}function v_(s,a){if(s==="change")return a}var x_=!1;if(Ur){var zm;if(Ur){var Lm="oninput"in document;if(!Lm){var w_=document.createElement("div");w_.setAttribute("oninput","return;"),Lm=typeof w_.oninput=="function"}zm=Lm}else zm=!1;x_=zm&&(!document.documentMode||9<document.documentMode)}function S_(){Gc&&(Gc.detachEvent("onpropertychange",E_),Wc=Gc=null)}function E_(s){if(s.propertyName==="value"&&Gd(Wc)){var a=[];b_(a,Wc,s,Lr(s)),Gi(AA,a)}}function jA(s,a,c){s==="focusin"?(S_(),Gc=a,Wc=c,Gc.attachEvent("onpropertychange",E_)):s==="focusout"&&S_()}function RA(s){if(s==="selectionchange"||s==="keyup"||s==="keydown")return Gd(Wc)}function IA(s,a){if(s==="click")return Gd(a)}function DA(s,a){if(s==="input"||s==="change")return Gd(a)}function kA(s,a){return s===a&&(s!==0||1/s===1/a)||s!==s&&a!==a}var Cr=typeof Object.is=="function"?Object.is:kA;function Qc(s,a){if(Cr(s,a))return!0;if(typeof s!="object"||s===null||typeof a!="object"||a===null)return!1;var c=Object.keys(s),m=Object.keys(a);if(c.length!==m.length)return!1;for(m=0;m<c.length;m++){var v=c[m];if(!oe.call(a,v)||!Cr(s[v],a[v]))return!1}return!0}function C_(s){for(;s&&s.firstChild;)s=s.firstChild;return s}function T_(s,a){var c=C_(s);s=0;for(var m;c;){if(c.nodeType===3){if(m=s+c.textContent.length,s<=a&&m>=a)return{node:c,offset:a-s};s=m}e:{for(;c;){if(c.nextSibling){c=c.nextSibling;break e}c=c.parentNode}c=void 0}c=C_(c)}}function A_(s,a){return s&&a?s===a?!0:s&&s.nodeType===3?!1:a&&a.nodeType===3?A_(s,a.parentNode):"contains"in s?s.contains(a):s.compareDocumentPosition?!!(s.compareDocumentPosition(a)&16):!1:!1}function j_(s){s=s!=null&&s.ownerDocument!=null&&s.ownerDocument.defaultView!=null?s.ownerDocument.defaultView:window;for(var a=js(s.document);a instanceof s.HTMLIFrameElement;){try{var c=typeof a.contentWindow.location.href=="string"}catch{c=!1}if(c)s=a.contentWindow;else break;a=js(s.document)}return a}function Um(s){var a=s&&s.nodeName&&s.nodeName.toLowerCase();return a&&(a==="input"&&(s.type==="text"||s.type==="search"||s.type==="tel"||s.type==="url"||s.type==="password")||a==="textarea"||s.contentEditable==="true")}var MA=Ur&&"documentMode"in document&&11>=document.documentMode,ml=null,Fm=null,Kc=null,Vm=!1;function R_(s,a,c){var m=c.window===c?c.document:c.nodeType===9?c:c.ownerDocument;Vm||ml==null||ml!==js(m)||(m=ml,"selectionStart"in m&&Um(m)?m={start:m.selectionStart,end:m.selectionEnd}:(m=(m.ownerDocument&&m.ownerDocument.defaultView||window).getSelection(),m={anchorNode:m.anchorNode,anchorOffset:m.anchorOffset,focusNode:m.focusNode,focusOffset:m.focusOffset}),Kc&&Qc(Kc,m)||(Kc=m,m=Oh(Fm,"onSelect"),0<m.length&&(a=new Ds("onSelect","select",null,a,c),s.push({event:a,listeners:m}),a.target=ml)))}function fo(s,a){var c={};return c[s.toLowerCase()]=a.toLowerCase(),c["Webkit"+s]="webkit"+a,c["Moz"+s]="moz"+a,c}var pl={animationend:fo("Animation","AnimationEnd"),animationiteration:fo("Animation","AnimationIteration"),animationstart:fo("Animation","AnimationStart"),transitionrun:fo("Transition","TransitionRun"),transitionstart:fo("Transition","TransitionStart"),transitioncancel:fo("Transition","TransitionCancel"),transitionend:fo("Transition","TransitionEnd")},$m={},I_={};Ur&&(I_=document.createElement("div").style,"AnimationEvent"in window||(delete pl.animationend.animation,delete pl.animationiteration.animation,delete pl.animationstart.animation),"TransitionEvent"in window||delete pl.transitionend.transition);function mo(s){if($m[s])return $m[s];if(!pl[s])return s;var a=pl[s],c;for(c in a)if(a.hasOwnProperty(c)&&c in I_)return $m[s]=a[c];return s}var D_=mo("animationend"),k_=mo("animationiteration"),M_=mo("animationstart"),OA=mo("transitionrun"),NA=mo("transitionstart"),PA=mo("transitioncancel"),O_=mo("transitionend"),N_=new Map,qm="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");qm.push("scrollEnd");function ls(s,a){N_.set(s,a),Ts(a,[s])}var Wd=typeof reportError=="function"?reportError:function(s){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var a=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof s=="object"&&s!==null&&typeof s.message=="string"?String(s.message):String(s),error:s});if(!window.dispatchEvent(a))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",s);return}console.error(s)},Vr=[],gl=0,Hm=0;function Qd(){for(var s=gl,a=Hm=gl=0;a<s;){var c=Vr[a];Vr[a++]=null;var m=Vr[a];Vr[a++]=null;var v=Vr[a];Vr[a++]=null;var E=Vr[a];if(Vr[a++]=null,m!==null&&v!==null){var z=m.pending;z===null?v.next=v:(v.next=z.next,z.next=v),m.pending=v}E!==0&&P_(c,v,E)}}function Kd(s,a,c,m){Vr[gl++]=s,Vr[gl++]=a,Vr[gl++]=c,Vr[gl++]=m,Hm|=m,s.lanes|=m,s=s.alternate,s!==null&&(s.lanes|=m)}function Gm(s,a,c,m){return Kd(s,a,c,m),Yd(s)}function po(s,a){return Kd(s,null,null,a),Yd(s)}function P_(s,a,c){s.lanes|=c;var m=s.alternate;m!==null&&(m.lanes|=c);for(var v=!1,E=s.return;E!==null;)E.childLanes|=c,m=E.alternate,m!==null&&(m.childLanes|=c),E.tag===22&&(s=E.stateNode,s===null||s._visibility&1||(v=!0)),s=E,E=E.return;return s.tag===3?(E=s.stateNode,v&&a!==null&&(v=31-Et(c),s=E.hiddenUpdates,m=s[v],m===null?s[v]=[a]:m.push(a),a.lane=c|536870912),E):null}function Yd(s){if(50<yu)throw yu=0,tg=null,Error(r(185));for(var a=s.return;a!==null;)s=a,a=s.return;return s.tag===3?s.stateNode:null}var yl={};function BA(s,a,c,m){this.tag=s,this.key=c,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=a,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=m,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Tr(s,a,c,m){return new BA(s,a,c,m)}function Wm(s){return s=s.prototype,!(!s||!s.isReactComponent)}function ni(s,a){var c=s.alternate;return c===null?(c=Tr(s.tag,a,s.key,s.mode),c.elementType=s.elementType,c.type=s.type,c.stateNode=s.stateNode,c.alternate=s,s.alternate=c):(c.pendingProps=a,c.type=s.type,c.flags=0,c.subtreeFlags=0,c.deletions=null),c.flags=s.flags&65011712,c.childLanes=s.childLanes,c.lanes=s.lanes,c.child=s.child,c.memoizedProps=s.memoizedProps,c.memoizedState=s.memoizedState,c.updateQueue=s.updateQueue,a=s.dependencies,c.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext},c.sibling=s.sibling,c.index=s.index,c.ref=s.ref,c.refCleanup=s.refCleanup,c}function B_(s,a){s.flags&=65011714;var c=s.alternate;return c===null?(s.childLanes=0,s.lanes=a,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=c.childLanes,s.lanes=c.lanes,s.child=c.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=c.memoizedProps,s.memoizedState=c.memoizedState,s.updateQueue=c.updateQueue,s.type=c.type,a=c.dependencies,s.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext}),s}function Xd(s,a,c,m,v,E){var z=0;if(m=s,typeof s=="function")Wm(s)&&(z=1);else if(typeof s=="string")z=Vj(s,c,ne.current)?26:s==="html"||s==="head"||s==="body"?27:5;else e:switch(s){case N:return s=Tr(31,c,a,v),s.elementType=N,s.lanes=E,s;case x:return go(c.children,v,E,a);case S:z=8,v|=24;break;case C:return s=Tr(12,c,a,v|2),s.elementType=C,s.lanes=E,s;case U:return s=Tr(13,c,a,v),s.elementType=U,s.lanes=E,s;case H:return s=Tr(19,c,a,v),s.elementType=H,s.lanes=E,s;default:if(typeof s=="object"&&s!==null)switch(s.$$typeof){case I:z=10;break e;case T:z=9;break e;case M:z=11;break e;case O:z=14;break e;case P:z=16,m=null;break e}z=29,c=Error(r(130,s===null?"null":typeof s,"")),m=null}return a=Tr(z,c,a,v),a.elementType=s,a.type=m,a.lanes=E,a}function go(s,a,c,m){return s=Tr(7,s,m,a),s.lanes=c,s}function Qm(s,a,c){return s=Tr(6,s,null,a),s.lanes=c,s}function z_(s){var a=Tr(18,null,null,0);return a.stateNode=s,a}function Km(s,a,c){return a=Tr(4,s.children!==null?s.children:[],s.key,a),a.lanes=c,a.stateNode={containerInfo:s.containerInfo,pendingChildren:null,implementation:s.implementation},a}var L_=new WeakMap;function $r(s,a){if(typeof s=="object"&&s!==null){var c=L_.get(s);return c!==void 0?c:(a={value:s,source:a,stack:Z(a)},L_.set(s,a),a)}return{value:s,source:a,stack:Z(a)}}var _l=[],bl=0,Zd=null,Yc=0,qr=[],Hr=0,Yi=null,Ns=1,Ps="";function ri(s,a){_l[bl++]=Yc,_l[bl++]=Zd,Zd=s,Yc=a}function U_(s,a,c){qr[Hr++]=Ns,qr[Hr++]=Ps,qr[Hr++]=Yi,Yi=s;var m=Ns;s=Ps;var v=32-Et(m)-1;m&=~(1<<v),c+=1;var E=32-Et(a)+v;if(30<E){var z=v-v%5;E=(m&(1<<z)-1).toString(32),m>>=z,v-=z,Ns=1<<32-Et(a)+v|c<<v|m,Ps=E+s}else Ns=1<<E|c<<v|m,Ps=s}function Ym(s){s.return!==null&&(ri(s,1),U_(s,1,0))}function Xm(s){for(;s===Zd;)Zd=_l[--bl],_l[bl]=null,Yc=_l[--bl],_l[bl]=null;for(;s===Yi;)Yi=qr[--Hr],qr[Hr]=null,Ps=qr[--Hr],qr[Hr]=null,Ns=qr[--Hr],qr[Hr]=null}function F_(s,a){qr[Hr++]=Ns,qr[Hr++]=Ps,qr[Hr++]=Yi,Ns=a.id,Ps=a.overflow,Yi=s}var zn=null,qt=null,_t=!1,Xi=null,Gr=!1,Zm=Error(r(519));function Zi(s){var a=Error(r(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Xc($r(a,s)),Zm}function V_(s){var a=s.stateNode,c=s.type,m=s.memoizedProps;switch(a[fn]=s,a[kn]=m,c){case"dialog":dt("cancel",a),dt("close",a);break;case"iframe":case"object":case"embed":dt("load",a);break;case"video":case"audio":for(c=0;c<bu.length;c++)dt(bu[c],a);break;case"source":dt("error",a);break;case"img":case"image":case"link":dt("error",a),dt("load",a);break;case"details":dt("toggle",a);break;case"input":dt("invalid",a),Dd(a,m.value,m.defaultValue,m.checked,m.defaultChecked,m.type,m.name,!0);break;case"select":dt("invalid",a);break;case"textarea":dt("invalid",a),$i(a,m.value,m.defaultValue,m.children)}c=m.children,typeof c!="string"&&typeof c!="number"&&typeof c!="bigint"||a.textContent===""+c||m.suppressHydrationWarning===!0||ix(a.textContent,c)?(m.popover!=null&&(dt("beforetoggle",a),dt("toggle",a)),m.onScroll!=null&&dt("scroll",a),m.onScrollEnd!=null&&dt("scrollend",a),m.onClick!=null&&(a.onclick=rs),a=!0):a=!1,a||Zi(s,!0)}function $_(s){for(zn=s.return;zn;)switch(zn.tag){case 5:case 31:case 13:Gr=!1;return;case 27:case 3:Gr=!0;return;default:zn=zn.return}}function vl(s){if(s!==zn)return!1;if(!_t)return $_(s),_t=!0,!1;var a=s.tag,c;if((c=a!==3&&a!==27)&&((c=a===5)&&(c=s.type,c=!(c!=="form"&&c!=="button")||gg(s.type,s.memoizedProps)),c=!c),c&&qt&&Zi(s),$_(s),a===13){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(r(317));qt=mx(s)}else if(a===31){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(r(317));qt=mx(s)}else a===27?(a=qt,ha(s.type)?(s=xg,xg=null,qt=s):qt=a):qt=zn?Qr(s.stateNode.nextSibling):null;return!0}function yo(){qt=zn=null,_t=!1}function Jm(){var s=Xi;return s!==null&&(gr===null?gr=s:gr.push.apply(gr,s),Xi=null),s}function Xc(s){Xi===null?Xi=[s]:Xi.push(s)}var ep=B(null),_o=null,si=null;function Ji(s,a,c){ee(ep,a._currentValue),a._currentValue=c}function ii(s){s._currentValue=ep.current,q(ep)}function tp(s,a,c){for(;s!==null;){var m=s.alternate;if((s.childLanes&a)!==a?(s.childLanes|=a,m!==null&&(m.childLanes|=a)):m!==null&&(m.childLanes&a)!==a&&(m.childLanes|=a),s===c)break;s=s.return}}function np(s,a,c,m){var v=s.child;for(v!==null&&(v.return=s);v!==null;){var E=v.dependencies;if(E!==null){var z=v.child;E=E.firstContext;e:for(;E!==null;){var W=E;E=v;for(var re=0;re<a.length;re++)if(W.context===a[re]){E.lanes|=c,W=E.alternate,W!==null&&(W.lanes|=c),tp(E.return,c,s),m||(z=null);break e}E=W.next}}else if(v.tag===18){if(z=v.return,z===null)throw Error(r(341));z.lanes|=c,E=z.alternate,E!==null&&(E.lanes|=c),tp(z,c,s),z=null}else z=v.child;if(z!==null)z.return=v;else for(z=v;z!==null;){if(z===s){z=null;break}if(v=z.sibling,v!==null){v.return=z.return,z=v;break}z=z.return}v=z}}function xl(s,a,c,m){s=null;for(var v=a,E=!1;v!==null;){if(!E){if((v.flags&524288)!==0)E=!0;else if((v.flags&262144)!==0)break}if(v.tag===10){var z=v.alternate;if(z===null)throw Error(r(387));if(z=z.memoizedProps,z!==null){var W=v.type;Cr(v.pendingProps.value,z.value)||(s!==null?s.push(W):s=[W])}}else if(v===Ee.current){if(z=v.alternate,z===null)throw Error(r(387));z.memoizedState.memoizedState!==v.memoizedState.memoizedState&&(s!==null?s.push(Eu):s=[Eu])}v=v.return}s!==null&&np(a,s,c,m),a.flags|=262144}function Jd(s){for(s=s.firstContext;s!==null;){if(!Cr(s.context._currentValue,s.memoizedValue))return!0;s=s.next}return!1}function bo(s){_o=s,si=null,s=s.dependencies,s!==null&&(s.firstContext=null)}function Ln(s){return q_(_o,s)}function eh(s,a){return _o===null&&bo(s),q_(s,a)}function q_(s,a){var c=a._currentValue;if(a={context:a,memoizedValue:c,next:null},si===null){if(s===null)throw Error(r(308));si=a,s.dependencies={lanes:0,firstContext:a},s.flags|=524288}else si=si.next=a;return c}var zA=typeof AbortController<"u"?AbortController:function(){var s=[],a=this.signal={aborted:!1,addEventListener:function(c,m){s.push(m)}};this.abort=function(){a.aborted=!0,s.forEach(function(c){return c()})}},LA=t.unstable_scheduleCallback,UA=t.unstable_NormalPriority,gn={$$typeof:I,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function rp(){return{controller:new zA,data:new Map,refCount:0}}function Zc(s){s.refCount--,s.refCount===0&&LA(UA,function(){s.controller.abort()})}var Jc=null,sp=0,wl=0,Sl=null;function FA(s,a){if(Jc===null){var c=Jc=[];sp=0,wl=og(),Sl={status:"pending",value:void 0,then:function(m){c.push(m)}}}return sp++,a.then(H_,H_),a}function H_(){if(--sp===0&&Jc!==null){Sl!==null&&(Sl.status="fulfilled");var s=Jc;Jc=null,wl=0,Sl=null;for(var a=0;a<s.length;a++)(0,s[a])()}}function VA(s,a){var c=[],m={status:"pending",value:null,reason:null,then:function(v){c.push(v)}};return s.then(function(){m.status="fulfilled",m.value=a;for(var v=0;v<c.length;v++)(0,c[v])(a)},function(v){for(m.status="rejected",m.reason=v,v=0;v<c.length;v++)(0,c[v])(void 0)}),m}var G_=X.S;X.S=function(s,a){Rv=Pe(),typeof a=="object"&&a!==null&&typeof a.then=="function"&&FA(s,a),G_!==null&&G_(s,a)};var vo=B(null);function ip(){var s=vo.current;return s!==null?s:Lt.pooledCache}function th(s,a){a===null?ee(vo,vo.current):ee(vo,a.pool)}function W_(){var s=ip();return s===null?null:{parent:gn._currentValue,pool:s}}var El=Error(r(460)),ap=Error(r(474)),nh=Error(r(542)),rh={then:function(){}};function Q_(s){return s=s.status,s==="fulfilled"||s==="rejected"}function K_(s,a,c){switch(c=s[c],c===void 0?s.push(a):c!==a&&(a.then(rs,rs),a=c),a.status){case"fulfilled":return a.value;case"rejected":throw s=a.reason,X_(s),s;default:if(typeof a.status=="string")a.then(rs,rs);else{if(s=Lt,s!==null&&100<s.shellSuspendCounter)throw Error(r(482));s=a,s.status="pending",s.then(function(m){if(a.status==="pending"){var v=a;v.status="fulfilled",v.value=m}},function(m){if(a.status==="pending"){var v=a;v.status="rejected",v.reason=m}})}switch(a.status){case"fulfilled":return a.value;case"rejected":throw s=a.reason,X_(s),s}throw wo=a,El}}function xo(s){try{var a=s._init;return a(s._payload)}catch(c){throw c!==null&&typeof c=="object"&&typeof c.then=="function"?(wo=c,El):c}}var wo=null;function Y_(){if(wo===null)throw Error(r(459));var s=wo;return wo=null,s}function X_(s){if(s===El||s===nh)throw Error(r(483))}var Cl=null,eu=0;function sh(s){var a=eu;return eu+=1,Cl===null&&(Cl=[]),K_(Cl,s,a)}function tu(s,a){a=a.props.ref,s.ref=a!==void 0?a:null}function ih(s,a){throw a.$$typeof===b?Error(r(525)):(s=Object.prototype.toString.call(a),Error(r(31,s==="[object Object]"?"object with keys {"+Object.keys(a).join(", ")+"}":s)))}function Z_(s){function a(ue,ce){if(s){var ge=ue.deletions;ge===null?(ue.deletions=[ce],ue.flags|=16):ge.push(ce)}}function c(ue,ce){if(!s)return null;for(;ce!==null;)a(ue,ce),ce=ce.sibling;return null}function m(ue){for(var ce=new Map;ue!==null;)ue.key!==null?ce.set(ue.key,ue):ce.set(ue.index,ue),ue=ue.sibling;return ce}function v(ue,ce){return ue=ni(ue,ce),ue.index=0,ue.sibling=null,ue}function E(ue,ce,ge){return ue.index=ge,s?(ge=ue.alternate,ge!==null?(ge=ge.index,ge<ce?(ue.flags|=67108866,ce):ge):(ue.flags|=67108866,ce)):(ue.flags|=1048576,ce)}function z(ue){return s&&ue.alternate===null&&(ue.flags|=67108866),ue}function W(ue,ce,ge,Ae){return ce===null||ce.tag!==6?(ce=Qm(ge,ue.mode,Ae),ce.return=ue,ce):(ce=v(ce,ge),ce.return=ue,ce)}function re(ue,ce,ge,Ae){var Ge=ge.type;return Ge===x?Te(ue,ce,ge.props.children,Ae,ge.key):ce!==null&&(ce.elementType===Ge||typeof Ge=="object"&&Ge!==null&&Ge.$$typeof===P&&xo(Ge)===ce.type)?(ce=v(ce,ge.props),tu(ce,ge),ce.return=ue,ce):(ce=Xd(ge.type,ge.key,ge.props,null,ue.mode,Ae),tu(ce,ge),ce.return=ue,ce)}function ye(ue,ce,ge,Ae){return ce===null||ce.tag!==4||ce.stateNode.containerInfo!==ge.containerInfo||ce.stateNode.implementation!==ge.implementation?(ce=Km(ge,ue.mode,Ae),ce.return=ue,ce):(ce=v(ce,ge.children||[]),ce.return=ue,ce)}function Te(ue,ce,ge,Ae,Ge){return ce===null||ce.tag!==7?(ce=go(ge,ue.mode,Ae,Ge),ce.return=ue,ce):(ce=v(ce,ge),ce.return=ue,ce)}function De(ue,ce,ge){if(typeof ce=="string"&&ce!==""||typeof ce=="number"||typeof ce=="bigint")return ce=Qm(""+ce,ue.mode,ge),ce.return=ue,ce;if(typeof ce=="object"&&ce!==null){switch(ce.$$typeof){case _:return ge=Xd(ce.type,ce.key,ce.props,null,ue.mode,ge),tu(ge,ce),ge.return=ue,ge;case w:return ce=Km(ce,ue.mode,ge),ce.return=ue,ce;case P:return ce=xo(ce),De(ue,ce,ge)}if(K(ce)||A(ce))return ce=go(ce,ue.mode,ge,null),ce.return=ue,ce;if(typeof ce.then=="function")return De(ue,sh(ce),ge);if(ce.$$typeof===I)return De(ue,eh(ue,ce),ge);ih(ue,ce)}return null}function be(ue,ce,ge,Ae){var Ge=ce!==null?ce.key:null;if(typeof ge=="string"&&ge!==""||typeof ge=="number"||typeof ge=="bigint")return Ge!==null?null:W(ue,ce,""+ge,Ae);if(typeof ge=="object"&&ge!==null){switch(ge.$$typeof){case _:return ge.key===Ge?re(ue,ce,ge,Ae):null;case w:return ge.key===Ge?ye(ue,ce,ge,Ae):null;case P:return ge=xo(ge),be(ue,ce,ge,Ae)}if(K(ge)||A(ge))return Ge!==null?null:Te(ue,ce,ge,Ae,null);if(typeof ge.then=="function")return be(ue,ce,sh(ge),Ae);if(ge.$$typeof===I)return be(ue,ce,eh(ue,ge),Ae);ih(ue,ge)}return null}function xe(ue,ce,ge,Ae,Ge){if(typeof Ae=="string"&&Ae!==""||typeof Ae=="number"||typeof Ae=="bigint")return ue=ue.get(ge)||null,W(ce,ue,""+Ae,Ge);if(typeof Ae=="object"&&Ae!==null){switch(Ae.$$typeof){case _:return ue=ue.get(Ae.key===null?ge:Ae.key)||null,re(ce,ue,Ae,Ge);case w:return ue=ue.get(Ae.key===null?ge:Ae.key)||null,ye(ce,ue,Ae,Ge);case P:return Ae=xo(Ae),xe(ue,ce,ge,Ae,Ge)}if(K(Ae)||A(Ae))return ue=ue.get(ge)||null,Te(ce,ue,Ae,Ge,null);if(typeof Ae.then=="function")return xe(ue,ce,ge,sh(Ae),Ge);if(Ae.$$typeof===I)return xe(ue,ce,ge,eh(ce,Ae),Ge);ih(ce,Ae)}return null}function Ve(ue,ce,ge,Ae){for(var Ge=null,wt=null,$e=ce,lt=ce=0,mt=null;$e!==null&&lt<ge.length;lt++){$e.index>lt?(mt=$e,$e=null):mt=$e.sibling;var St=be(ue,$e,ge[lt],Ae);if(St===null){$e===null&&($e=mt);break}s&&$e&&St.alternate===null&&a(ue,$e),ce=E(St,ce,lt),wt===null?Ge=St:wt.sibling=St,wt=St,$e=mt}if(lt===ge.length)return c(ue,$e),_t&&ri(ue,lt),Ge;if($e===null){for(;lt<ge.length;lt++)$e=De(ue,ge[lt],Ae),$e!==null&&(ce=E($e,ce,lt),wt===null?Ge=$e:wt.sibling=$e,wt=$e);return _t&&ri(ue,lt),Ge}for($e=m($e);lt<ge.length;lt++)mt=xe($e,ue,lt,ge[lt],Ae),mt!==null&&(s&&mt.alternate!==null&&$e.delete(mt.key===null?lt:mt.key),ce=E(mt,ce,lt),wt===null?Ge=mt:wt.sibling=mt,wt=mt);return s&&$e.forEach(function(ya){return a(ue,ya)}),_t&&ri(ue,lt),Ge}function Ke(ue,ce,ge,Ae){if(ge==null)throw Error(r(151));for(var Ge=null,wt=null,$e=ce,lt=ce=0,mt=null,St=ge.next();$e!==null&&!St.done;lt++,St=ge.next()){$e.index>lt?(mt=$e,$e=null):mt=$e.sibling;var ya=be(ue,$e,St.value,Ae);if(ya===null){$e===null&&($e=mt);break}s&&$e&&ya.alternate===null&&a(ue,$e),ce=E(ya,ce,lt),wt===null?Ge=ya:wt.sibling=ya,wt=ya,$e=mt}if(St.done)return c(ue,$e),_t&&ri(ue,lt),Ge;if($e===null){for(;!St.done;lt++,St=ge.next())St=De(ue,St.value,Ae),St!==null&&(ce=E(St,ce,lt),wt===null?Ge=St:wt.sibling=St,wt=St);return _t&&ri(ue,lt),Ge}for($e=m($e);!St.done;lt++,St=ge.next())St=xe($e,ue,lt,St.value,Ae),St!==null&&(s&&St.alternate!==null&&$e.delete(St.key===null?lt:St.key),ce=E(St,ce,lt),wt===null?Ge=St:wt.sibling=St,wt=St);return s&&$e.forEach(function(Jj){return a(ue,Jj)}),_t&&ri(ue,lt),Ge}function Pt(ue,ce,ge,Ae){if(typeof ge=="object"&&ge!==null&&ge.type===x&&ge.key===null&&(ge=ge.props.children),typeof ge=="object"&&ge!==null){switch(ge.$$typeof){case _:e:{for(var Ge=ge.key;ce!==null;){if(ce.key===Ge){if(Ge=ge.type,Ge===x){if(ce.tag===7){c(ue,ce.sibling),Ae=v(ce,ge.props.children),Ae.return=ue,ue=Ae;break e}}else if(ce.elementType===Ge||typeof Ge=="object"&&Ge!==null&&Ge.$$typeof===P&&xo(Ge)===ce.type){c(ue,ce.sibling),Ae=v(ce,ge.props),tu(Ae,ge),Ae.return=ue,ue=Ae;break e}c(ue,ce);break}else a(ue,ce);ce=ce.sibling}ge.type===x?(Ae=go(ge.props.children,ue.mode,Ae,ge.key),Ae.return=ue,ue=Ae):(Ae=Xd(ge.type,ge.key,ge.props,null,ue.mode,Ae),tu(Ae,ge),Ae.return=ue,ue=Ae)}return z(ue);case w:e:{for(Ge=ge.key;ce!==null;){if(ce.key===Ge)if(ce.tag===4&&ce.stateNode.containerInfo===ge.containerInfo&&ce.stateNode.implementation===ge.implementation){c(ue,ce.sibling),Ae=v(ce,ge.children||[]),Ae.return=ue,ue=Ae;break e}else{c(ue,ce);break}else a(ue,ce);ce=ce.sibling}Ae=Km(ge,ue.mode,Ae),Ae.return=ue,ue=Ae}return z(ue);case P:return ge=xo(ge),Pt(ue,ce,ge,Ae)}if(K(ge))return Ve(ue,ce,ge,Ae);if(A(ge)){if(Ge=A(ge),typeof Ge!="function")throw Error(r(150));return ge=Ge.call(ge),Ke(ue,ce,ge,Ae)}if(typeof ge.then=="function")return Pt(ue,ce,sh(ge),Ae);if(ge.$$typeof===I)return Pt(ue,ce,eh(ue,ge),Ae);ih(ue,ge)}return typeof ge=="string"&&ge!==""||typeof ge=="number"||typeof ge=="bigint"?(ge=""+ge,ce!==null&&ce.tag===6?(c(ue,ce.sibling),Ae=v(ce,ge),Ae.return=ue,ue=Ae):(c(ue,ce),Ae=Qm(ge,ue.mode,Ae),Ae.return=ue,ue=Ae),z(ue)):c(ue,ce)}return function(ue,ce,ge,Ae){try{eu=0;var Ge=Pt(ue,ce,ge,Ae);return Cl=null,Ge}catch($e){if($e===El||$e===nh)throw $e;var wt=Tr(29,$e,null,ue.mode);return wt.lanes=Ae,wt.return=ue,wt}}}var So=Z_(!0),J_=Z_(!1),ea=!1;function op(s){s.updateQueue={baseState:s.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function lp(s,a){s=s.updateQueue,a.updateQueue===s&&(a.updateQueue={baseState:s.baseState,firstBaseUpdate:s.firstBaseUpdate,lastBaseUpdate:s.lastBaseUpdate,shared:s.shared,callbacks:null})}function ta(s){return{lane:s,tag:0,payload:null,callback:null,next:null}}function na(s,a,c){var m=s.updateQueue;if(m===null)return null;if(m=m.shared,(Tt&2)!==0){var v=m.pending;return v===null?a.next=a:(a.next=v.next,v.next=a),m.pending=a,a=Yd(s),P_(s,null,c),a}return Kd(s,m,a,c),Yd(s)}function nu(s,a,c){if(a=a.updateQueue,a!==null&&(a=a.shared,(c&4194048)!==0)){var m=a.lanes;m&=s.pendingLanes,c|=m,a.lanes=c,Rc(s,c)}}function cp(s,a){var c=s.updateQueue,m=s.alternate;if(m!==null&&(m=m.updateQueue,c===m)){var v=null,E=null;if(c=c.firstBaseUpdate,c!==null){do{var z={lane:c.lane,tag:c.tag,payload:c.payload,callback:null,next:null};E===null?v=E=z:E=E.next=z,c=c.next}while(c!==null);E===null?v=E=a:E=E.next=a}else v=E=a;c={baseState:m.baseState,firstBaseUpdate:v,lastBaseUpdate:E,shared:m.shared,callbacks:m.callbacks},s.updateQueue=c;return}s=c.lastBaseUpdate,s===null?c.firstBaseUpdate=a:s.next=a,c.lastBaseUpdate=a}var up=!1;function ru(){if(up){var s=Sl;if(s!==null)throw s}}function su(s,a,c,m){up=!1;var v=s.updateQueue;ea=!1;var E=v.firstBaseUpdate,z=v.lastBaseUpdate,W=v.shared.pending;if(W!==null){v.shared.pending=null;var re=W,ye=re.next;re.next=null,z===null?E=ye:z.next=ye,z=re;var Te=s.alternate;Te!==null&&(Te=Te.updateQueue,W=Te.lastBaseUpdate,W!==z&&(W===null?Te.firstBaseUpdate=ye:W.next=ye,Te.lastBaseUpdate=re))}if(E!==null){var De=v.baseState;z=0,Te=ye=re=null,W=E;do{var be=W.lane&-536870913,xe=be!==W.lane;if(xe?(ft&be)===be:(m&be)===be){be!==0&&be===wl&&(up=!0),Te!==null&&(Te=Te.next={lane:0,tag:W.tag,payload:W.payload,callback:null,next:null});e:{var Ve=s,Ke=W;be=a;var Pt=c;switch(Ke.tag){case 1:if(Ve=Ke.payload,typeof Ve=="function"){De=Ve.call(Pt,De,be);break e}De=Ve;break e;case 3:Ve.flags=Ve.flags&-65537|128;case 0:if(Ve=Ke.payload,be=typeof Ve=="function"?Ve.call(Pt,De,be):Ve,be==null)break e;De=g({},De,be);break e;case 2:ea=!0}}be=W.callback,be!==null&&(s.flags|=64,xe&&(s.flags|=8192),xe=v.callbacks,xe===null?v.callbacks=[be]:xe.push(be))}else xe={lane:be,tag:W.tag,payload:W.payload,callback:W.callback,next:null},Te===null?(ye=Te=xe,re=De):Te=Te.next=xe,z|=be;if(W=W.next,W===null){if(W=v.shared.pending,W===null)break;xe=W,W=xe.next,xe.next=null,v.lastBaseUpdate=xe,v.shared.pending=null}}while(!0);Te===null&&(re=De),v.baseState=re,v.firstBaseUpdate=ye,v.lastBaseUpdate=Te,E===null&&(v.shared.lanes=0),oa|=z,s.lanes=z,s.memoizedState=De}}function eb(s,a){if(typeof s!="function")throw Error(r(191,s));s.call(a)}function tb(s,a){var c=s.callbacks;if(c!==null)for(s.callbacks=null,s=0;s<c.length;s++)eb(c[s],a)}var Tl=B(null),ah=B(0);function nb(s,a){s=mi,ee(ah,s),ee(Tl,a),mi=s|a.baseLanes}function dp(){ee(ah,mi),ee(Tl,Tl.current)}function hp(){mi=ah.current,q(Tl),q(ah)}var Ar=B(null),Wr=null;function ra(s){var a=s.alternate;ee(ln,ln.current&1),ee(Ar,s),Wr===null&&(a===null||Tl.current!==null||a.memoizedState!==null)&&(Wr=s)}function fp(s){ee(ln,ln.current),ee(Ar,s),Wr===null&&(Wr=s)}function rb(s){s.tag===22?(ee(ln,ln.current),ee(Ar,s),Wr===null&&(Wr=s)):sa()}function sa(){ee(ln,ln.current),ee(Ar,Ar.current)}function jr(s){q(Ar),Wr===s&&(Wr=null),q(ln)}var ln=B(0);function oh(s){for(var a=s;a!==null;){if(a.tag===13){var c=a.memoizedState;if(c!==null&&(c=c.dehydrated,c===null||bg(c)||vg(c)))return a}else if(a.tag===19&&(a.memoizedProps.revealOrder==="forwards"||a.memoizedProps.revealOrder==="backwards"||a.memoizedProps.revealOrder==="unstable_legacy-backwards"||a.memoizedProps.revealOrder==="together")){if((a.flags&128)!==0)return a}else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===s)break;for(;a.sibling===null;){if(a.return===null||a.return===s)return null;a=a.return}a.sibling.return=a.return,a=a.sibling}return null}var ai=0,ot=null,Ot=null,yn=null,lh=!1,Al=!1,Eo=!1,ch=0,iu=0,jl=null,$A=0;function rn(){throw Error(r(321))}function mp(s,a){if(a===null)return!1;for(var c=0;c<a.length&&c<s.length;c++)if(!Cr(s[c],a[c]))return!1;return!0}function pp(s,a,c,m,v,E){return ai=E,ot=a,a.memoizedState=null,a.updateQueue=null,a.lanes=0,X.H=s===null||s.memoizedState===null?Ub:Ip,Eo=!1,E=c(m,v),Eo=!1,Al&&(E=ib(a,c,m,v)),sb(s),E}function sb(s){X.H=lu;var a=Ot!==null&&Ot.next!==null;if(ai=0,yn=Ot=ot=null,lh=!1,iu=0,jl=null,a)throw Error(r(300));s===null||_n||(s=s.dependencies,s!==null&&Jd(s)&&(_n=!0))}function ib(s,a,c,m){ot=s;var v=0;do{if(Al&&(jl=null),iu=0,Al=!1,25<=v)throw Error(r(301));if(v+=1,yn=Ot=null,s.updateQueue!=null){var E=s.updateQueue;E.lastEffect=null,E.events=null,E.stores=null,E.memoCache!=null&&(E.memoCache.index=0)}X.H=Fb,E=a(c,m)}while(Al);return E}function qA(){var s=X.H,a=s.useState()[0];return a=typeof a.then=="function"?au(a):a,s=s.useState()[0],(Ot!==null?Ot.memoizedState:null)!==s&&(ot.flags|=1024),a}function gp(){var s=ch!==0;return ch=0,s}function yp(s,a,c){a.updateQueue=s.updateQueue,a.flags&=-2053,s.lanes&=~c}function _p(s){if(lh){for(s=s.memoizedState;s!==null;){var a=s.queue;a!==null&&(a.pending=null),s=s.next}lh=!1}ai=0,yn=Ot=ot=null,Al=!1,iu=ch=0,jl=null}function ar(){var s={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return yn===null?ot.memoizedState=yn=s:yn=yn.next=s,yn}function cn(){if(Ot===null){var s=ot.alternate;s=s!==null?s.memoizedState:null}else s=Ot.next;var a=yn===null?ot.memoizedState:yn.next;if(a!==null)yn=a,Ot=s;else{if(s===null)throw ot.alternate===null?Error(r(467)):Error(r(310));Ot=s,s={memoizedState:Ot.memoizedState,baseState:Ot.baseState,baseQueue:Ot.baseQueue,queue:Ot.queue,next:null},yn===null?ot.memoizedState=yn=s:yn=yn.next=s}return yn}function uh(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function au(s){var a=iu;return iu+=1,jl===null&&(jl=[]),s=K_(jl,s,a),a=ot,(yn===null?a.memoizedState:yn.next)===null&&(a=a.alternate,X.H=a===null||a.memoizedState===null?Ub:Ip),s}function dh(s){if(s!==null&&typeof s=="object"){if(typeof s.then=="function")return au(s);if(s.$$typeof===I)return Ln(s)}throw Error(r(438,String(s)))}function bp(s){var a=null,c=ot.updateQueue;if(c!==null&&(a=c.memoCache),a==null){var m=ot.alternate;m!==null&&(m=m.updateQueue,m!==null&&(m=m.memoCache,m!=null&&(a={data:m.data.map(function(v){return v.slice()}),index:0})))}if(a==null&&(a={data:[],index:0}),c===null&&(c=uh(),ot.updateQueue=c),c.memoCache=a,c=a.data[a.index],c===void 0)for(c=a.data[a.index]=Array(s),m=0;m<s;m++)c[m]=V;return a.index++,c}function oi(s,a){return typeof a=="function"?a(s):a}function hh(s){var a=cn();return vp(a,Ot,s)}function vp(s,a,c){var m=s.queue;if(m===null)throw Error(r(311));m.lastRenderedReducer=c;var v=s.baseQueue,E=m.pending;if(E!==null){if(v!==null){var z=v.next;v.next=E.next,E.next=z}a.baseQueue=v=E,m.pending=null}if(E=s.baseState,v===null)s.memoizedState=E;else{a=v.next;var W=z=null,re=null,ye=a,Te=!1;do{var De=ye.lane&-536870913;if(De!==ye.lane?(ft&De)===De:(ai&De)===De){var be=ye.revertLane;if(be===0)re!==null&&(re=re.next={lane:0,revertLane:0,gesture:null,action:ye.action,hasEagerState:ye.hasEagerState,eagerState:ye.eagerState,next:null}),De===wl&&(Te=!0);else if((ai&be)===be){ye=ye.next,be===wl&&(Te=!0);continue}else De={lane:0,revertLane:ye.revertLane,gesture:null,action:ye.action,hasEagerState:ye.hasEagerState,eagerState:ye.eagerState,next:null},re===null?(W=re=De,z=E):re=re.next=De,ot.lanes|=be,oa|=be;De=ye.action,Eo&&c(E,De),E=ye.hasEagerState?ye.eagerState:c(E,De)}else be={lane:De,revertLane:ye.revertLane,gesture:ye.gesture,action:ye.action,hasEagerState:ye.hasEagerState,eagerState:ye.eagerState,next:null},re===null?(W=re=be,z=E):re=re.next=be,ot.lanes|=De,oa|=De;ye=ye.next}while(ye!==null&&ye!==a);if(re===null?z=E:re.next=W,!Cr(E,s.memoizedState)&&(_n=!0,Te&&(c=Sl,c!==null)))throw c;s.memoizedState=E,s.baseState=z,s.baseQueue=re,m.lastRenderedState=E}return v===null&&(m.lanes=0),[s.memoizedState,m.dispatch]}function xp(s){var a=cn(),c=a.queue;if(c===null)throw Error(r(311));c.lastRenderedReducer=s;var m=c.dispatch,v=c.pending,E=a.memoizedState;if(v!==null){c.pending=null;var z=v=v.next;do E=s(E,z.action),z=z.next;while(z!==v);Cr(E,a.memoizedState)||(_n=!0),a.memoizedState=E,a.baseQueue===null&&(a.baseState=E),c.lastRenderedState=E}return[E,m]}function ab(s,a,c){var m=ot,v=cn(),E=_t;if(E){if(c===void 0)throw Error(r(407));c=c()}else c=a();var z=!Cr((Ot||v).memoizedState,c);if(z&&(v.memoizedState=c,_n=!0),v=v.queue,Ep(cb.bind(null,m,v,s),[s]),v.getSnapshot!==a||z||yn!==null&&yn.memoizedState.tag&1){if(m.flags|=2048,Rl(9,{destroy:void 0},lb.bind(null,m,v,c,a),null),Lt===null)throw Error(r(349));E||(ai&127)!==0||ob(m,a,c)}return c}function ob(s,a,c){s.flags|=16384,s={getSnapshot:a,value:c},a=ot.updateQueue,a===null?(a=uh(),ot.updateQueue=a,a.stores=[s]):(c=a.stores,c===null?a.stores=[s]:c.push(s))}function lb(s,a,c,m){a.value=c,a.getSnapshot=m,ub(a)&&db(s)}function cb(s,a,c){return c(function(){ub(a)&&db(s)})}function ub(s){var a=s.getSnapshot;s=s.value;try{var c=a();return!Cr(s,c)}catch{return!0}}function db(s){var a=po(s,2);a!==null&&yr(a,s,2)}function wp(s){var a=ar();if(typeof s=="function"){var c=s;if(s=c(),Eo){Qn(!0);try{c()}finally{Qn(!1)}}}return a.memoizedState=a.baseState=s,a.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:oi,lastRenderedState:s},a}function hb(s,a,c,m){return s.baseState=c,vp(s,Ot,typeof m=="function"?m:oi)}function HA(s,a,c,m,v){if(ph(s))throw Error(r(485));if(s=a.action,s!==null){var E={payload:v,action:s,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(z){E.listeners.push(z)}};X.T!==null?c(!0):E.isTransition=!1,m(E),c=a.pending,c===null?(E.next=a.pending=E,fb(a,E)):(E.next=c.next,a.pending=c.next=E)}}function fb(s,a){var c=a.action,m=a.payload,v=s.state;if(a.isTransition){var E=X.T,z={};X.T=z;try{var W=c(v,m),re=X.S;re!==null&&re(z,W),mb(s,a,W)}catch(ye){Sp(s,a,ye)}finally{E!==null&&z.types!==null&&(E.types=z.types),X.T=E}}else try{E=c(v,m),mb(s,a,E)}catch(ye){Sp(s,a,ye)}}function mb(s,a,c){c!==null&&typeof c=="object"&&typeof c.then=="function"?c.then(function(m){pb(s,a,m)},function(m){return Sp(s,a,m)}):pb(s,a,c)}function pb(s,a,c){a.status="fulfilled",a.value=c,gb(a),s.state=c,a=s.pending,a!==null&&(c=a.next,c===a?s.pending=null:(c=c.next,a.next=c,fb(s,c)))}function Sp(s,a,c){var m=s.pending;if(s.pending=null,m!==null){m=m.next;do a.status="rejected",a.reason=c,gb(a),a=a.next;while(a!==m)}s.action=null}function gb(s){s=s.listeners;for(var a=0;a<s.length;a++)(0,s[a])()}function yb(s,a){return a}function _b(s,a){if(_t){var c=Lt.formState;if(c!==null){e:{var m=ot;if(_t){if(qt){t:{for(var v=qt,E=Gr;v.nodeType!==8;){if(!E){v=null;break t}if(v=Qr(v.nextSibling),v===null){v=null;break t}}E=v.data,v=E==="F!"||E==="F"?v:null}if(v){qt=Qr(v.nextSibling),m=v.data==="F!";break e}}Zi(m)}m=!1}m&&(a=c[0])}}return c=ar(),c.memoizedState=c.baseState=a,m={pending:null,lanes:0,dispatch:null,lastRenderedReducer:yb,lastRenderedState:a},c.queue=m,c=Bb.bind(null,ot,m),m.dispatch=c,m=wp(!1),E=Rp.bind(null,ot,!1,m.queue),m=ar(),v={state:a,dispatch:null,action:s,pending:null},m.queue=v,c=HA.bind(null,ot,v,E,c),v.dispatch=c,m.memoizedState=s,[a,c,!1]}function bb(s){var a=cn();return vb(a,Ot,s)}function vb(s,a,c){if(a=vp(s,a,yb)[0],s=hh(oi)[0],typeof a=="object"&&a!==null&&typeof a.then=="function")try{var m=au(a)}catch(z){throw z===El?nh:z}else m=a;a=cn();var v=a.queue,E=v.dispatch;return c!==a.memoizedState&&(ot.flags|=2048,Rl(9,{destroy:void 0},GA.bind(null,v,c),null)),[m,E,s]}function GA(s,a){s.action=a}function xb(s){var a=cn(),c=Ot;if(c!==null)return vb(a,c,s);cn(),a=a.memoizedState,c=cn();var m=c.queue.dispatch;return c.memoizedState=s,[a,m,!1]}function Rl(s,a,c,m){return s={tag:s,create:c,deps:m,inst:a,next:null},a=ot.updateQueue,a===null&&(a=uh(),ot.updateQueue=a),c=a.lastEffect,c===null?a.lastEffect=s.next=s:(m=c.next,c.next=s,s.next=m,a.lastEffect=s),s}function wb(){return cn().memoizedState}function fh(s,a,c,m){var v=ar();ot.flags|=s,v.memoizedState=Rl(1|a,{destroy:void 0},c,m===void 0?null:m)}function mh(s,a,c,m){var v=cn();m=m===void 0?null:m;var E=v.memoizedState.inst;Ot!==null&&m!==null&&mp(m,Ot.memoizedState.deps)?v.memoizedState=Rl(a,E,c,m):(ot.flags|=s,v.memoizedState=Rl(1|a,E,c,m))}function Sb(s,a){fh(8390656,8,s,a)}function Ep(s,a){mh(2048,8,s,a)}function WA(s){ot.flags|=4;var a=ot.updateQueue;if(a===null)a=uh(),ot.updateQueue=a,a.events=[s];else{var c=a.events;c===null?a.events=[s]:c.push(s)}}function Eb(s){var a=cn().memoizedState;return WA({ref:a,nextImpl:s}),function(){if((Tt&2)!==0)throw Error(r(440));return a.impl.apply(void 0,arguments)}}function Cb(s,a){return mh(4,2,s,a)}function Tb(s,a){return mh(4,4,s,a)}function Ab(s,a){if(typeof a=="function"){s=s();var c=a(s);return function(){typeof c=="function"?c():a(null)}}if(a!=null)return s=s(),a.current=s,function(){a.current=null}}function jb(s,a,c){c=c!=null?c.concat([s]):null,mh(4,4,Ab.bind(null,a,s),c)}function Cp(){}function Rb(s,a){var c=cn();a=a===void 0?null:a;var m=c.memoizedState;return a!==null&&mp(a,m[1])?m[0]:(c.memoizedState=[s,a],s)}function Ib(s,a){var c=cn();a=a===void 0?null:a;var m=c.memoizedState;if(a!==null&&mp(a,m[1]))return m[0];if(m=s(),Eo){Qn(!0);try{s()}finally{Qn(!1)}}return c.memoizedState=[m,a],m}function Tp(s,a,c){return c===void 0||(ai&1073741824)!==0&&(ft&261930)===0?s.memoizedState=a:(s.memoizedState=c,s=Dv(),ot.lanes|=s,oa|=s,c)}function Db(s,a,c,m){return Cr(c,a)?c:Tl.current!==null?(s=Tp(s,c,m),Cr(s,a)||(_n=!0),s):(ai&42)===0||(ai&1073741824)!==0&&(ft&261930)===0?(_n=!0,s.memoizedState=c):(s=Dv(),ot.lanes|=s,oa|=s,a)}function kb(s,a,c,m,v){var E=G.p;G.p=E!==0&&8>E?E:8;var z=X.T,W={};X.T=W,Rp(s,!1,a,c);try{var re=v(),ye=X.S;if(ye!==null&&ye(W,re),re!==null&&typeof re=="object"&&typeof re.then=="function"){var Te=VA(re,m);ou(s,a,Te,Dr(s))}else ou(s,a,m,Dr(s))}catch(De){ou(s,a,{then:function(){},status:"rejected",reason:De},Dr())}finally{G.p=E,z!==null&&W.types!==null&&(z.types=W.types),X.T=z}}function QA(){}function Ap(s,a,c,m){if(s.tag!==5)throw Error(r(476));var v=Mb(s).queue;kb(s,v,a,te,c===null?QA:function(){return Ob(s),c(m)})}function Mb(s){var a=s.memoizedState;if(a!==null)return a;a={memoizedState:te,baseState:te,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:oi,lastRenderedState:te},next:null};var c={};return a.next={memoizedState:c,baseState:c,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:oi,lastRenderedState:c},next:null},s.memoizedState=a,s=s.alternate,s!==null&&(s.memoizedState=a),a}function Ob(s){var a=Mb(s);a.next===null&&(a=s.alternate.memoizedState),ou(s,a.next.queue,{},Dr())}function jp(){return Ln(Eu)}function Nb(){return cn().memoizedState}function Pb(){return cn().memoizedState}function KA(s){for(var a=s.return;a!==null;){switch(a.tag){case 24:case 3:var c=Dr();s=ta(c);var m=na(a,s,c);m!==null&&(yr(m,a,c),nu(m,a,c)),a={cache:rp()},s.payload=a;return}a=a.return}}function YA(s,a,c){var m=Dr();c={lane:m,revertLane:0,gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null},ph(s)?zb(a,c):(c=Gm(s,a,c,m),c!==null&&(yr(c,s,m),Lb(c,a,m)))}function Bb(s,a,c){var m=Dr();ou(s,a,c,m)}function ou(s,a,c,m){var v={lane:m,revertLane:0,gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null};if(ph(s))zb(a,v);else{var E=s.alternate;if(s.lanes===0&&(E===null||E.lanes===0)&&(E=a.lastRenderedReducer,E!==null))try{var z=a.lastRenderedState,W=E(z,c);if(v.hasEagerState=!0,v.eagerState=W,Cr(W,z))return Kd(s,a,v,0),Lt===null&&Qd(),!1}catch{}if(c=Gm(s,a,v,m),c!==null)return yr(c,s,m),Lb(c,a,m),!0}return!1}function Rp(s,a,c,m){if(m={lane:2,revertLane:og(),gesture:null,action:m,hasEagerState:!1,eagerState:null,next:null},ph(s)){if(a)throw Error(r(479))}else a=Gm(s,c,m,2),a!==null&&yr(a,s,2)}function ph(s){var a=s.alternate;return s===ot||a!==null&&a===ot}function zb(s,a){Al=lh=!0;var c=s.pending;c===null?a.next=a:(a.next=c.next,c.next=a),s.pending=a}function Lb(s,a,c){if((c&4194048)!==0){var m=a.lanes;m&=s.pendingLanes,c|=m,a.lanes=c,Rc(s,c)}}var lu={readContext:Ln,use:dh,useCallback:rn,useContext:rn,useEffect:rn,useImperativeHandle:rn,useLayoutEffect:rn,useInsertionEffect:rn,useMemo:rn,useReducer:rn,useRef:rn,useState:rn,useDebugValue:rn,useDeferredValue:rn,useTransition:rn,useSyncExternalStore:rn,useId:rn,useHostTransitionStatus:rn,useFormState:rn,useActionState:rn,useOptimistic:rn,useMemoCache:rn,useCacheRefresh:rn};lu.useEffectEvent=rn;var Ub={readContext:Ln,use:dh,useCallback:function(s,a){return ar().memoizedState=[s,a===void 0?null:a],s},useContext:Ln,useEffect:Sb,useImperativeHandle:function(s,a,c){c=c!=null?c.concat([s]):null,fh(4194308,4,Ab.bind(null,a,s),c)},useLayoutEffect:function(s,a){return fh(4194308,4,s,a)},useInsertionEffect:function(s,a){fh(4,2,s,a)},useMemo:function(s,a){var c=ar();a=a===void 0?null:a;var m=s();if(Eo){Qn(!0);try{s()}finally{Qn(!1)}}return c.memoizedState=[m,a],m},useReducer:function(s,a,c){var m=ar();if(c!==void 0){var v=c(a);if(Eo){Qn(!0);try{c(a)}finally{Qn(!1)}}}else v=a;return m.memoizedState=m.baseState=v,s={pending:null,lanes:0,dispatch:null,lastRenderedReducer:s,lastRenderedState:v},m.queue=s,s=s.dispatch=YA.bind(null,ot,s),[m.memoizedState,s]},useRef:function(s){var a=ar();return s={current:s},a.memoizedState=s},useState:function(s){s=wp(s);var a=s.queue,c=Bb.bind(null,ot,a);return a.dispatch=c,[s.memoizedState,c]},useDebugValue:Cp,useDeferredValue:function(s,a){var c=ar();return Tp(c,s,a)},useTransition:function(){var s=wp(!1);return s=kb.bind(null,ot,s.queue,!0,!1),ar().memoizedState=s,[!1,s]},useSyncExternalStore:function(s,a,c){var m=ot,v=ar();if(_t){if(c===void 0)throw Error(r(407));c=c()}else{if(c=a(),Lt===null)throw Error(r(349));(ft&127)!==0||ob(m,a,c)}v.memoizedState=c;var E={value:c,getSnapshot:a};return v.queue=E,Sb(cb.bind(null,m,E,s),[s]),m.flags|=2048,Rl(9,{destroy:void 0},lb.bind(null,m,E,c,a),null),c},useId:function(){var s=ar(),a=Lt.identifierPrefix;if(_t){var c=Ps,m=Ns;c=(m&~(1<<32-Et(m)-1)).toString(32)+c,a="_"+a+"R_"+c,c=ch++,0<c&&(a+="H"+c.toString(32)),a+="_"}else c=$A++,a="_"+a+"r_"+c.toString(32)+"_";return s.memoizedState=a},useHostTransitionStatus:jp,useFormState:_b,useActionState:_b,useOptimistic:function(s){var a=ar();a.memoizedState=a.baseState=s;var c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return a.queue=c,a=Rp.bind(null,ot,!0,c),c.dispatch=a,[s,a]},useMemoCache:bp,useCacheRefresh:function(){return ar().memoizedState=KA.bind(null,ot)},useEffectEvent:function(s){var a=ar(),c={impl:s};return a.memoizedState=c,function(){if((Tt&2)!==0)throw Error(r(440));return c.impl.apply(void 0,arguments)}}},Ip={readContext:Ln,use:dh,useCallback:Rb,useContext:Ln,useEffect:Ep,useImperativeHandle:jb,useInsertionEffect:Cb,useLayoutEffect:Tb,useMemo:Ib,useReducer:hh,useRef:wb,useState:function(){return hh(oi)},useDebugValue:Cp,useDeferredValue:function(s,a){var c=cn();return Db(c,Ot.memoizedState,s,a)},useTransition:function(){var s=hh(oi)[0],a=cn().memoizedState;return[typeof s=="boolean"?s:au(s),a]},useSyncExternalStore:ab,useId:Nb,useHostTransitionStatus:jp,useFormState:bb,useActionState:bb,useOptimistic:function(s,a){var c=cn();return hb(c,Ot,s,a)},useMemoCache:bp,useCacheRefresh:Pb};Ip.useEffectEvent=Eb;var Fb={readContext:Ln,use:dh,useCallback:Rb,useContext:Ln,useEffect:Ep,useImperativeHandle:jb,useInsertionEffect:Cb,useLayoutEffect:Tb,useMemo:Ib,useReducer:xp,useRef:wb,useState:function(){return xp(oi)},useDebugValue:Cp,useDeferredValue:function(s,a){var c=cn();return Ot===null?Tp(c,s,a):Db(c,Ot.memoizedState,s,a)},useTransition:function(){var s=xp(oi)[0],a=cn().memoizedState;return[typeof s=="boolean"?s:au(s),a]},useSyncExternalStore:ab,useId:Nb,useHostTransitionStatus:jp,useFormState:xb,useActionState:xb,useOptimistic:function(s,a){var c=cn();return Ot!==null?hb(c,Ot,s,a):(c.baseState=s,[s,c.queue.dispatch])},useMemoCache:bp,useCacheRefresh:Pb};Fb.useEffectEvent=Eb;function Dp(s,a,c,m){a=s.memoizedState,c=c(m,a),c=c==null?a:g({},a,c),s.memoizedState=c,s.lanes===0&&(s.updateQueue.baseState=c)}var kp={enqueueSetState:function(s,a,c){s=s._reactInternals;var m=Dr(),v=ta(m);v.payload=a,c!=null&&(v.callback=c),a=na(s,v,m),a!==null&&(yr(a,s,m),nu(a,s,m))},enqueueReplaceState:function(s,a,c){s=s._reactInternals;var m=Dr(),v=ta(m);v.tag=1,v.payload=a,c!=null&&(v.callback=c),a=na(s,v,m),a!==null&&(yr(a,s,m),nu(a,s,m))},enqueueForceUpdate:function(s,a){s=s._reactInternals;var c=Dr(),m=ta(c);m.tag=2,a!=null&&(m.callback=a),a=na(s,m,c),a!==null&&(yr(a,s,c),nu(a,s,c))}};function Vb(s,a,c,m,v,E,z){return s=s.stateNode,typeof s.shouldComponentUpdate=="function"?s.shouldComponentUpdate(m,E,z):a.prototype&&a.prototype.isPureReactComponent?!Qc(c,m)||!Qc(v,E):!0}function $b(s,a,c,m){s=a.state,typeof a.componentWillReceiveProps=="function"&&a.componentWillReceiveProps(c,m),typeof a.UNSAFE_componentWillReceiveProps=="function"&&a.UNSAFE_componentWillReceiveProps(c,m),a.state!==s&&kp.enqueueReplaceState(a,a.state,null)}function Co(s,a){var c=a;if("ref"in a){c={};for(var m in a)m!=="ref"&&(c[m]=a[m])}if(s=s.defaultProps){c===a&&(c=g({},c));for(var v in s)c[v]===void 0&&(c[v]=s[v])}return c}function qb(s){Wd(s)}function Hb(s){console.error(s)}function Gb(s){Wd(s)}function gh(s,a){try{var c=s.onUncaughtError;c(a.value,{componentStack:a.stack})}catch(m){setTimeout(function(){throw m})}}function Wb(s,a,c){try{var m=s.onCaughtError;m(c.value,{componentStack:c.stack,errorBoundary:a.tag===1?a.stateNode:null})}catch(v){setTimeout(function(){throw v})}}function Mp(s,a,c){return c=ta(c),c.tag=3,c.payload={element:null},c.callback=function(){gh(s,a)},c}function Qb(s){return s=ta(s),s.tag=3,s}function Kb(s,a,c,m){var v=c.type.getDerivedStateFromError;if(typeof v=="function"){var E=m.value;s.payload=function(){return v(E)},s.callback=function(){Wb(a,c,m)}}var z=c.stateNode;z!==null&&typeof z.componentDidCatch=="function"&&(s.callback=function(){Wb(a,c,m),typeof v!="function"&&(la===null?la=new Set([this]):la.add(this));var W=m.stack;this.componentDidCatch(m.value,{componentStack:W!==null?W:""})})}function XA(s,a,c,m,v){if(c.flags|=32768,m!==null&&typeof m=="object"&&typeof m.then=="function"){if(a=c.alternate,a!==null&&xl(a,c,v,!0),c=Ar.current,c!==null){switch(c.tag){case 31:case 13:return Wr===null?jh():c.alternate===null&&sn===0&&(sn=3),c.flags&=-257,c.flags|=65536,c.lanes=v,m===rh?c.flags|=16384:(a=c.updateQueue,a===null?c.updateQueue=new Set([m]):a.add(m),sg(s,m,v)),!1;case 22:return c.flags|=65536,m===rh?c.flags|=16384:(a=c.updateQueue,a===null?(a={transitions:null,markerInstances:null,retryQueue:new Set([m])},c.updateQueue=a):(c=a.retryQueue,c===null?a.retryQueue=new Set([m]):c.add(m)),sg(s,m,v)),!1}throw Error(r(435,c.tag))}return sg(s,m,v),jh(),!1}if(_t)return a=Ar.current,a!==null?((a.flags&65536)===0&&(a.flags|=256),a.flags|=65536,a.lanes=v,m!==Zm&&(s=Error(r(422),{cause:m}),Xc($r(s,c)))):(m!==Zm&&(a=Error(r(423),{cause:m}),Xc($r(a,c))),s=s.current.alternate,s.flags|=65536,v&=-v,s.lanes|=v,m=$r(m,c),v=Mp(s.stateNode,m,v),cp(s,v),sn!==4&&(sn=2)),!1;var E=Error(r(520),{cause:m});if(E=$r(E,c),gu===null?gu=[E]:gu.push(E),sn!==4&&(sn=2),a===null)return!0;m=$r(m,c),c=a;do{switch(c.tag){case 3:return c.flags|=65536,s=v&-v,c.lanes|=s,s=Mp(c.stateNode,m,s),cp(c,s),!1;case 1:if(a=c.type,E=c.stateNode,(c.flags&128)===0&&(typeof a.getDerivedStateFromError=="function"||E!==null&&typeof E.componentDidCatch=="function"&&(la===null||!la.has(E))))return c.flags|=65536,v&=-v,c.lanes|=v,v=Qb(v),Kb(v,s,c,m),cp(c,v),!1}c=c.return}while(c!==null);return!1}var Op=Error(r(461)),_n=!1;function Un(s,a,c,m){a.child=s===null?J_(a,null,c,m):So(a,s.child,c,m)}function Yb(s,a,c,m,v){c=c.render;var E=a.ref;if("ref"in m){var z={};for(var W in m)W!=="ref"&&(z[W]=m[W])}else z=m;return bo(a),m=pp(s,a,c,z,E,v),W=gp(),s!==null&&!_n?(yp(s,a,v),li(s,a,v)):(_t&&W&&Ym(a),a.flags|=1,Un(s,a,m,v),a.child)}function Xb(s,a,c,m,v){if(s===null){var E=c.type;return typeof E=="function"&&!Wm(E)&&E.defaultProps===void 0&&c.compare===null?(a.tag=15,a.type=E,Zb(s,a,E,m,v)):(s=Xd(c.type,null,m,a,a.mode,v),s.ref=a.ref,s.return=a,a.child=s)}if(E=s.child,!Vp(s,v)){var z=E.memoizedProps;if(c=c.compare,c=c!==null?c:Qc,c(z,m)&&s.ref===a.ref)return li(s,a,v)}return a.flags|=1,s=ni(E,m),s.ref=a.ref,s.return=a,a.child=s}function Zb(s,a,c,m,v){if(s!==null){var E=s.memoizedProps;if(Qc(E,m)&&s.ref===a.ref)if(_n=!1,a.pendingProps=m=E,Vp(s,v))(s.flags&131072)!==0&&(_n=!0);else return a.lanes=s.lanes,li(s,a,v)}return Np(s,a,c,m,v)}function Jb(s,a,c,m){var v=m.children,E=s!==null?s.memoizedState:null;if(s===null&&a.stateNode===null&&(a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),m.mode==="hidden"){if((a.flags&128)!==0){if(E=E!==null?E.baseLanes|c:c,s!==null){for(m=a.child=s.child,v=0;m!==null;)v=v|m.lanes|m.childLanes,m=m.sibling;m=v&~E}else m=0,a.child=null;return ev(s,a,E,c,m)}if((c&536870912)!==0)a.memoizedState={baseLanes:0,cachePool:null},s!==null&&th(a,E!==null?E.cachePool:null),E!==null?nb(a,E):dp(),rb(a);else return m=a.lanes=536870912,ev(s,a,E!==null?E.baseLanes|c:c,c,m)}else E!==null?(th(a,E.cachePool),nb(a,E),sa(),a.memoizedState=null):(s!==null&&th(a,null),dp(),sa());return Un(s,a,v,c),a.child}function cu(s,a){return s!==null&&s.tag===22||a.stateNode!==null||(a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),a.sibling}function ev(s,a,c,m,v){var E=ip();return E=E===null?null:{parent:gn._currentValue,pool:E},a.memoizedState={baseLanes:c,cachePool:E},s!==null&&th(a,null),dp(),rb(a),s!==null&&xl(s,a,m,!0),a.childLanes=v,null}function yh(s,a){return a=bh({mode:a.mode,children:a.children},s.mode),a.ref=s.ref,s.child=a,a.return=s,a}function tv(s,a,c){return So(a,s.child,null,c),s=yh(a,a.pendingProps),s.flags|=2,jr(a),a.memoizedState=null,s}function ZA(s,a,c){var m=a.pendingProps,v=(a.flags&128)!==0;if(a.flags&=-129,s===null){if(_t){if(m.mode==="hidden")return s=yh(a,m),a.lanes=536870912,cu(null,s);if(fp(a),(s=qt)?(s=fx(s,Gr),s=s!==null&&s.data==="&"?s:null,s!==null&&(a.memoizedState={dehydrated:s,treeContext:Yi!==null?{id:Ns,overflow:Ps}:null,retryLane:536870912,hydrationErrors:null},c=z_(s),c.return=a,a.child=c,zn=a,qt=null)):s=null,s===null)throw Zi(a);return a.lanes=536870912,null}return yh(a,m)}var E=s.memoizedState;if(E!==null){var z=E.dehydrated;if(fp(a),v)if(a.flags&256)a.flags&=-257,a=tv(s,a,c);else if(a.memoizedState!==null)a.child=s.child,a.flags|=128,a=null;else throw Error(r(558));else if(_n||xl(s,a,c,!1),v=(c&s.childLanes)!==0,_n||v){if(m=Lt,m!==null&&(z=Ic(m,c),z!==0&&z!==E.retryLane))throw E.retryLane=z,po(s,z),yr(m,s,z),Op;jh(),a=tv(s,a,c)}else s=E.treeContext,qt=Qr(z.nextSibling),zn=a,_t=!0,Xi=null,Gr=!1,s!==null&&F_(a,s),a=yh(a,m),a.flags|=4096;return a}return s=ni(s.child,{mode:m.mode,children:m.children}),s.ref=a.ref,a.child=s,s.return=a,s}function _h(s,a){var c=a.ref;if(c===null)s!==null&&s.ref!==null&&(a.flags|=4194816);else{if(typeof c!="function"&&typeof c!="object")throw Error(r(284));(s===null||s.ref!==c)&&(a.flags|=4194816)}}function Np(s,a,c,m,v){return bo(a),c=pp(s,a,c,m,void 0,v),m=gp(),s!==null&&!_n?(yp(s,a,v),li(s,a,v)):(_t&&m&&Ym(a),a.flags|=1,Un(s,a,c,v),a.child)}function nv(s,a,c,m,v,E){return bo(a),a.updateQueue=null,c=ib(a,m,c,v),sb(s),m=gp(),s!==null&&!_n?(yp(s,a,E),li(s,a,E)):(_t&&m&&Ym(a),a.flags|=1,Un(s,a,c,E),a.child)}function rv(s,a,c,m,v){if(bo(a),a.stateNode===null){var E=yl,z=c.contextType;typeof z=="object"&&z!==null&&(E=Ln(z)),E=new c(m,E),a.memoizedState=E.state!==null&&E.state!==void 0?E.state:null,E.updater=kp,a.stateNode=E,E._reactInternals=a,E=a.stateNode,E.props=m,E.state=a.memoizedState,E.refs={},op(a),z=c.contextType,E.context=typeof z=="object"&&z!==null?Ln(z):yl,E.state=a.memoizedState,z=c.getDerivedStateFromProps,typeof z=="function"&&(Dp(a,c,z,m),E.state=a.memoizedState),typeof c.getDerivedStateFromProps=="function"||typeof E.getSnapshotBeforeUpdate=="function"||typeof E.UNSAFE_componentWillMount!="function"&&typeof E.componentWillMount!="function"||(z=E.state,typeof E.componentWillMount=="function"&&E.componentWillMount(),typeof E.UNSAFE_componentWillMount=="function"&&E.UNSAFE_componentWillMount(),z!==E.state&&kp.enqueueReplaceState(E,E.state,null),su(a,m,E,v),ru(),E.state=a.memoizedState),typeof E.componentDidMount=="function"&&(a.flags|=4194308),m=!0}else if(s===null){E=a.stateNode;var W=a.memoizedProps,re=Co(c,W);E.props=re;var ye=E.context,Te=c.contextType;z=yl,typeof Te=="object"&&Te!==null&&(z=Ln(Te));var De=c.getDerivedStateFromProps;Te=typeof De=="function"||typeof E.getSnapshotBeforeUpdate=="function",W=a.pendingProps!==W,Te||typeof E.UNSAFE_componentWillReceiveProps!="function"&&typeof E.componentWillReceiveProps!="function"||(W||ye!==z)&&$b(a,E,m,z),ea=!1;var be=a.memoizedState;E.state=be,su(a,m,E,v),ru(),ye=a.memoizedState,W||be!==ye||ea?(typeof De=="function"&&(Dp(a,c,De,m),ye=a.memoizedState),(re=ea||Vb(a,c,re,m,be,ye,z))?(Te||typeof E.UNSAFE_componentWillMount!="function"&&typeof E.componentWillMount!="function"||(typeof E.componentWillMount=="function"&&E.componentWillMount(),typeof E.UNSAFE_componentWillMount=="function"&&E.UNSAFE_componentWillMount()),typeof E.componentDidMount=="function"&&(a.flags|=4194308)):(typeof E.componentDidMount=="function"&&(a.flags|=4194308),a.memoizedProps=m,a.memoizedState=ye),E.props=m,E.state=ye,E.context=z,m=re):(typeof E.componentDidMount=="function"&&(a.flags|=4194308),m=!1)}else{E=a.stateNode,lp(s,a),z=a.memoizedProps,Te=Co(c,z),E.props=Te,De=a.pendingProps,be=E.context,ye=c.contextType,re=yl,typeof ye=="object"&&ye!==null&&(re=Ln(ye)),W=c.getDerivedStateFromProps,(ye=typeof W=="function"||typeof E.getSnapshotBeforeUpdate=="function")||typeof E.UNSAFE_componentWillReceiveProps!="function"&&typeof E.componentWillReceiveProps!="function"||(z!==De||be!==re)&&$b(a,E,m,re),ea=!1,be=a.memoizedState,E.state=be,su(a,m,E,v),ru();var xe=a.memoizedState;z!==De||be!==xe||ea||s!==null&&s.dependencies!==null&&Jd(s.dependencies)?(typeof W=="function"&&(Dp(a,c,W,m),xe=a.memoizedState),(Te=ea||Vb(a,c,Te,m,be,xe,re)||s!==null&&s.dependencies!==null&&Jd(s.dependencies))?(ye||typeof E.UNSAFE_componentWillUpdate!="function"&&typeof E.componentWillUpdate!="function"||(typeof E.componentWillUpdate=="function"&&E.componentWillUpdate(m,xe,re),typeof E.UNSAFE_componentWillUpdate=="function"&&E.UNSAFE_componentWillUpdate(m,xe,re)),typeof E.componentDidUpdate=="function"&&(a.flags|=4),typeof E.getSnapshotBeforeUpdate=="function"&&(a.flags|=1024)):(typeof E.componentDidUpdate!="function"||z===s.memoizedProps&&be===s.memoizedState||(a.flags|=4),typeof E.getSnapshotBeforeUpdate!="function"||z===s.memoizedProps&&be===s.memoizedState||(a.flags|=1024),a.memoizedProps=m,a.memoizedState=xe),E.props=m,E.state=xe,E.context=re,m=Te):(typeof E.componentDidUpdate!="function"||z===s.memoizedProps&&be===s.memoizedState||(a.flags|=4),typeof E.getSnapshotBeforeUpdate!="function"||z===s.memoizedProps&&be===s.memoizedState||(a.flags|=1024),m=!1)}return E=m,_h(s,a),m=(a.flags&128)!==0,E||m?(E=a.stateNode,c=m&&typeof c.getDerivedStateFromError!="function"?null:E.render(),a.flags|=1,s!==null&&m?(a.child=So(a,s.child,null,v),a.child=So(a,null,c,v)):Un(s,a,c,v),a.memoizedState=E.state,s=a.child):s=li(s,a,v),s}function sv(s,a,c,m){return yo(),a.flags|=256,Un(s,a,c,m),a.child}var Pp={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Bp(s){return{baseLanes:s,cachePool:W_()}}function zp(s,a,c){return s=s!==null?s.childLanes&~c:0,a&&(s|=Ir),s}function iv(s,a,c){var m=a.pendingProps,v=!1,E=(a.flags&128)!==0,z;if((z=E)||(z=s!==null&&s.memoizedState===null?!1:(ln.current&2)!==0),z&&(v=!0,a.flags&=-129),z=(a.flags&32)!==0,a.flags&=-33,s===null){if(_t){if(v?ra(a):sa(),(s=qt)?(s=fx(s,Gr),s=s!==null&&s.data!=="&"?s:null,s!==null&&(a.memoizedState={dehydrated:s,treeContext:Yi!==null?{id:Ns,overflow:Ps}:null,retryLane:536870912,hydrationErrors:null},c=z_(s),c.return=a,a.child=c,zn=a,qt=null)):s=null,s===null)throw Zi(a);return vg(s)?a.lanes=32:a.lanes=536870912,null}var W=m.children;return m=m.fallback,v?(sa(),v=a.mode,W=bh({mode:"hidden",children:W},v),m=go(m,v,c,null),W.return=a,m.return=a,W.sibling=m,a.child=W,m=a.child,m.memoizedState=Bp(c),m.childLanes=zp(s,z,c),a.memoizedState=Pp,cu(null,m)):(ra(a),Lp(a,W))}var re=s.memoizedState;if(re!==null&&(W=re.dehydrated,W!==null)){if(E)a.flags&256?(ra(a),a.flags&=-257,a=Up(s,a,c)):a.memoizedState!==null?(sa(),a.child=s.child,a.flags|=128,a=null):(sa(),W=m.fallback,v=a.mode,m=bh({mode:"visible",children:m.children},v),W=go(W,v,c,null),W.flags|=2,m.return=a,W.return=a,m.sibling=W,a.child=m,So(a,s.child,null,c),m=a.child,m.memoizedState=Bp(c),m.childLanes=zp(s,z,c),a.memoizedState=Pp,a=cu(null,m));else if(ra(a),vg(W)){if(z=W.nextSibling&&W.nextSibling.dataset,z)var ye=z.dgst;z=ye,m=Error(r(419)),m.stack="",m.digest=z,Xc({value:m,source:null,stack:null}),a=Up(s,a,c)}else if(_n||xl(s,a,c,!1),z=(c&s.childLanes)!==0,_n||z){if(z=Lt,z!==null&&(m=Ic(z,c),m!==0&&m!==re.retryLane))throw re.retryLane=m,po(s,m),yr(z,s,m),Op;bg(W)||jh(),a=Up(s,a,c)}else bg(W)?(a.flags|=192,a.child=s.child,a=null):(s=re.treeContext,qt=Qr(W.nextSibling),zn=a,_t=!0,Xi=null,Gr=!1,s!==null&&F_(a,s),a=Lp(a,m.children),a.flags|=4096);return a}return v?(sa(),W=m.fallback,v=a.mode,re=s.child,ye=re.sibling,m=ni(re,{mode:"hidden",children:m.children}),m.subtreeFlags=re.subtreeFlags&65011712,ye!==null?W=ni(ye,W):(W=go(W,v,c,null),W.flags|=2),W.return=a,m.return=a,m.sibling=W,a.child=m,cu(null,m),m=a.child,W=s.child.memoizedState,W===null?W=Bp(c):(v=W.cachePool,v!==null?(re=gn._currentValue,v=v.parent!==re?{parent:re,pool:re}:v):v=W_(),W={baseLanes:W.baseLanes|c,cachePool:v}),m.memoizedState=W,m.childLanes=zp(s,z,c),a.memoizedState=Pp,cu(s.child,m)):(ra(a),c=s.child,s=c.sibling,c=ni(c,{mode:"visible",children:m.children}),c.return=a,c.sibling=null,s!==null&&(z=a.deletions,z===null?(a.deletions=[s],a.flags|=16):z.push(s)),a.child=c,a.memoizedState=null,c)}function Lp(s,a){return a=bh({mode:"visible",children:a},s.mode),a.return=s,s.child=a}function bh(s,a){return s=Tr(22,s,null,a),s.lanes=0,s}function Up(s,a,c){return So(a,s.child,null,c),s=Lp(a,a.pendingProps.children),s.flags|=2,a.memoizedState=null,s}function av(s,a,c){s.lanes|=a;var m=s.alternate;m!==null&&(m.lanes|=a),tp(s.return,a,c)}function Fp(s,a,c,m,v,E){var z=s.memoizedState;z===null?s.memoizedState={isBackwards:a,rendering:null,renderingStartTime:0,last:m,tail:c,tailMode:v,treeForkCount:E}:(z.isBackwards=a,z.rendering=null,z.renderingStartTime=0,z.last=m,z.tail=c,z.tailMode=v,z.treeForkCount=E)}function ov(s,a,c){var m=a.pendingProps,v=m.revealOrder,E=m.tail;m=m.children;var z=ln.current,W=(z&2)!==0;if(W?(z=z&1|2,a.flags|=128):z&=1,ee(ln,z),Un(s,a,m,c),m=_t?Yc:0,!W&&s!==null&&(s.flags&128)!==0)e:for(s=a.child;s!==null;){if(s.tag===13)s.memoizedState!==null&&av(s,c,a);else if(s.tag===19)av(s,c,a);else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===a)break e;for(;s.sibling===null;){if(s.return===null||s.return===a)break e;s=s.return}s.sibling.return=s.return,s=s.sibling}switch(v){case"forwards":for(c=a.child,v=null;c!==null;)s=c.alternate,s!==null&&oh(s)===null&&(v=c),c=c.sibling;c=v,c===null?(v=a.child,a.child=null):(v=c.sibling,c.sibling=null),Fp(a,!1,v,c,E,m);break;case"backwards":case"unstable_legacy-backwards":for(c=null,v=a.child,a.child=null;v!==null;){if(s=v.alternate,s!==null&&oh(s)===null){a.child=v;break}s=v.sibling,v.sibling=c,c=v,v=s}Fp(a,!0,c,null,E,m);break;case"together":Fp(a,!1,null,null,void 0,m);break;default:a.memoizedState=null}return a.child}function li(s,a,c){if(s!==null&&(a.dependencies=s.dependencies),oa|=a.lanes,(c&a.childLanes)===0)if(s!==null){if(xl(s,a,c,!1),(c&a.childLanes)===0)return null}else return null;if(s!==null&&a.child!==s.child)throw Error(r(153));if(a.child!==null){for(s=a.child,c=ni(s,s.pendingProps),a.child=c,c.return=a;s.sibling!==null;)s=s.sibling,c=c.sibling=ni(s,s.pendingProps),c.return=a;c.sibling=null}return a.child}function Vp(s,a){return(s.lanes&a)!==0?!0:(s=s.dependencies,!!(s!==null&&Jd(s)))}function JA(s,a,c){switch(a.tag){case 3:ae(a,a.stateNode.containerInfo),Ji(a,gn,s.memoizedState.cache),yo();break;case 27:case 5:Me(a);break;case 4:ae(a,a.stateNode.containerInfo);break;case 10:Ji(a,a.type,a.memoizedProps.value);break;case 31:if(a.memoizedState!==null)return a.flags|=128,fp(a),null;break;case 13:var m=a.memoizedState;if(m!==null)return m.dehydrated!==null?(ra(a),a.flags|=128,null):(c&a.child.childLanes)!==0?iv(s,a,c):(ra(a),s=li(s,a,c),s!==null?s.sibling:null);ra(a);break;case 19:var v=(s.flags&128)!==0;if(m=(c&a.childLanes)!==0,m||(xl(s,a,c,!1),m=(c&a.childLanes)!==0),v){if(m)return ov(s,a,c);a.flags|=128}if(v=a.memoizedState,v!==null&&(v.rendering=null,v.tail=null,v.lastEffect=null),ee(ln,ln.current),m)break;return null;case 22:return a.lanes=0,Jb(s,a,c,a.pendingProps);case 24:Ji(a,gn,s.memoizedState.cache)}return li(s,a,c)}function lv(s,a,c){if(s!==null)if(s.memoizedProps!==a.pendingProps)_n=!0;else{if(!Vp(s,c)&&(a.flags&128)===0)return _n=!1,JA(s,a,c);_n=(s.flags&131072)!==0}else _n=!1,_t&&(a.flags&1048576)!==0&&U_(a,Yc,a.index);switch(a.lanes=0,a.tag){case 16:e:{var m=a.pendingProps;if(s=xo(a.elementType),a.type=s,typeof s=="function")Wm(s)?(m=Co(s,m),a.tag=1,a=rv(null,a,s,m,c)):(a.tag=0,a=Np(null,a,s,m,c));else{if(s!=null){var v=s.$$typeof;if(v===M){a.tag=11,a=Yb(null,a,s,m,c);break e}else if(v===O){a.tag=14,a=Xb(null,a,s,m,c);break e}}throw a=D(s)||s,Error(r(306,a,""))}}return a;case 0:return Np(s,a,a.type,a.pendingProps,c);case 1:return m=a.type,v=Co(m,a.pendingProps),rv(s,a,m,v,c);case 3:e:{if(ae(a,a.stateNode.containerInfo),s===null)throw Error(r(387));m=a.pendingProps;var E=a.memoizedState;v=E.element,lp(s,a),su(a,m,null,c);var z=a.memoizedState;if(m=z.cache,Ji(a,gn,m),m!==E.cache&&np(a,[gn],c,!0),ru(),m=z.element,E.isDehydrated)if(E={element:m,isDehydrated:!1,cache:z.cache},a.updateQueue.baseState=E,a.memoizedState=E,a.flags&256){a=sv(s,a,m,c);break e}else if(m!==v){v=$r(Error(r(424)),a),Xc(v),a=sv(s,a,m,c);break e}else for(s=a.stateNode.containerInfo,s.nodeType===9?s=s.body:s=s.nodeName==="HTML"?s.ownerDocument.body:s,qt=Qr(s.firstChild),zn=a,_t=!0,Xi=null,Gr=!0,c=J_(a,null,m,c),a.child=c;c;)c.flags=c.flags&-3|4096,c=c.sibling;else{if(yo(),m===v){a=li(s,a,c);break e}Un(s,a,m,c)}a=a.child}return a;case 26:return _h(s,a),s===null?(c=bx(a.type,null,a.pendingProps,null))?a.memoizedState=c:_t||(c=a.type,s=a.pendingProps,m=Nh(he.current).createElement(c),m[fn]=a,m[kn]=s,Fn(m,c,s),mn(m),a.stateNode=m):a.memoizedState=bx(a.type,s.memoizedProps,a.pendingProps,s.memoizedState),null;case 27:return Me(a),s===null&&_t&&(m=a.stateNode=gx(a.type,a.pendingProps,he.current),zn=a,Gr=!0,v=qt,ha(a.type)?(xg=v,qt=Qr(m.firstChild)):qt=v),Un(s,a,a.pendingProps.children,c),_h(s,a),s===null&&(a.flags|=4194304),a.child;case 5:return s===null&&_t&&((v=m=qt)&&(m=Rj(m,a.type,a.pendingProps,Gr),m!==null?(a.stateNode=m,zn=a,qt=Qr(m.firstChild),Gr=!1,v=!0):v=!1),v||Zi(a)),Me(a),v=a.type,E=a.pendingProps,z=s!==null?s.memoizedProps:null,m=E.children,gg(v,E)?m=null:z!==null&&gg(v,z)&&(a.flags|=32),a.memoizedState!==null&&(v=pp(s,a,qA,null,null,c),Eu._currentValue=v),_h(s,a),Un(s,a,m,c),a.child;case 6:return s===null&&_t&&((s=c=qt)&&(c=Ij(c,a.pendingProps,Gr),c!==null?(a.stateNode=c,zn=a,qt=null,s=!0):s=!1),s||Zi(a)),null;case 13:return iv(s,a,c);case 4:return ae(a,a.stateNode.containerInfo),m=a.pendingProps,s===null?a.child=So(a,null,m,c):Un(s,a,m,c),a.child;case 11:return Yb(s,a,a.type,a.pendingProps,c);case 7:return Un(s,a,a.pendingProps,c),a.child;case 8:return Un(s,a,a.pendingProps.children,c),a.child;case 12:return Un(s,a,a.pendingProps.children,c),a.child;case 10:return m=a.pendingProps,Ji(a,a.type,m.value),Un(s,a,m.children,c),a.child;case 9:return v=a.type._context,m=a.pendingProps.children,bo(a),v=Ln(v),m=m(v),a.flags|=1,Un(s,a,m,c),a.child;case 14:return Xb(s,a,a.type,a.pendingProps,c);case 15:return Zb(s,a,a.type,a.pendingProps,c);case 19:return ov(s,a,c);case 31:return ZA(s,a,c);case 22:return Jb(s,a,c,a.pendingProps);case 24:return bo(a),m=Ln(gn),s===null?(v=ip(),v===null&&(v=Lt,E=rp(),v.pooledCache=E,E.refCount++,E!==null&&(v.pooledCacheLanes|=c),v=E),a.memoizedState={parent:m,cache:v},op(a),Ji(a,gn,v)):((s.lanes&c)!==0&&(lp(s,a),su(a,null,null,c),ru()),v=s.memoizedState,E=a.memoizedState,v.parent!==m?(v={parent:m,cache:m},a.memoizedState=v,a.lanes===0&&(a.memoizedState=a.updateQueue.baseState=v),Ji(a,gn,m)):(m=E.cache,Ji(a,gn,m),m!==v.cache&&np(a,[gn],c,!0))),Un(s,a,a.pendingProps.children,c),a.child;case 29:throw a.pendingProps}throw Error(r(156,a.tag))}function ci(s){s.flags|=4}function $p(s,a,c,m,v){if((a=(s.mode&32)!==0)&&(a=!1),a){if(s.flags|=16777216,(v&335544128)===v)if(s.stateNode.complete)s.flags|=8192;else if(Nv())s.flags|=8192;else throw wo=rh,ap}else s.flags&=-16777217}function cv(s,a){if(a.type!=="stylesheet"||(a.state.loading&4)!==0)s.flags&=-16777217;else if(s.flags|=16777216,!Ex(a))if(Nv())s.flags|=8192;else throw wo=rh,ap}function vh(s,a){a!==null&&(s.flags|=4),s.flags&16384&&(a=s.tag!==22?Td():536870912,s.lanes|=a,Ml|=a)}function uu(s,a){if(!_t)switch(s.tailMode){case"hidden":a=s.tail;for(var c=null;a!==null;)a.alternate!==null&&(c=a),a=a.sibling;c===null?s.tail=null:c.sibling=null;break;case"collapsed":c=s.tail;for(var m=null;c!==null;)c.alternate!==null&&(m=c),c=c.sibling;m===null?a||s.tail===null?s.tail=null:s.tail.sibling=null:m.sibling=null}}function Ht(s){var a=s.alternate!==null&&s.alternate.child===s.child,c=0,m=0;if(a)for(var v=s.child;v!==null;)c|=v.lanes|v.childLanes,m|=v.subtreeFlags&65011712,m|=v.flags&65011712,v.return=s,v=v.sibling;else for(v=s.child;v!==null;)c|=v.lanes|v.childLanes,m|=v.subtreeFlags,m|=v.flags,v.return=s,v=v.sibling;return s.subtreeFlags|=m,s.childLanes=c,a}function ej(s,a,c){var m=a.pendingProps;switch(Xm(a),a.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ht(a),null;case 1:return Ht(a),null;case 3:return c=a.stateNode,m=null,s!==null&&(m=s.memoizedState.cache),a.memoizedState.cache!==m&&(a.flags|=2048),ii(gn),fe(),c.pendingContext&&(c.context=c.pendingContext,c.pendingContext=null),(s===null||s.child===null)&&(vl(a)?ci(a):s===null||s.memoizedState.isDehydrated&&(a.flags&256)===0||(a.flags|=1024,Jm())),Ht(a),null;case 26:var v=a.type,E=a.memoizedState;return s===null?(ci(a),E!==null?(Ht(a),cv(a,E)):(Ht(a),$p(a,v,null,m,c))):E?E!==s.memoizedState?(ci(a),Ht(a),cv(a,E)):(Ht(a),a.flags&=-16777217):(s=s.memoizedProps,s!==m&&ci(a),Ht(a),$p(a,v,s,m,c)),null;case 27:if(Ne(a),c=he.current,v=a.type,s!==null&&a.stateNode!=null)s.memoizedProps!==m&&ci(a);else{if(!m){if(a.stateNode===null)throw Error(r(166));return Ht(a),null}s=ne.current,vl(a)?V_(a):(s=gx(v,m,c),a.stateNode=s,ci(a))}return Ht(a),null;case 5:if(Ne(a),v=a.type,s!==null&&a.stateNode!=null)s.memoizedProps!==m&&ci(a);else{if(!m){if(a.stateNode===null)throw Error(r(166));return Ht(a),null}if(E=ne.current,vl(a))V_(a);else{var z=Nh(he.current);switch(E){case 1:E=z.createElementNS("http://www.w3.org/2000/svg",v);break;case 2:E=z.createElementNS("http://www.w3.org/1998/Math/MathML",v);break;default:switch(v){case"svg":E=z.createElementNS("http://www.w3.org/2000/svg",v);break;case"math":E=z.createElementNS("http://www.w3.org/1998/Math/MathML",v);break;case"script":E=z.createElement("div"),E.innerHTML="<script><\/script>",E=E.removeChild(E.firstChild);break;case"select":E=typeof m.is=="string"?z.createElement("select",{is:m.is}):z.createElement("select"),m.multiple?E.multiple=!0:m.size&&(E.size=m.size);break;default:E=typeof m.is=="string"?z.createElement(v,{is:m.is}):z.createElement(v)}}E[fn]=a,E[kn]=m;e:for(z=a.child;z!==null;){if(z.tag===5||z.tag===6)E.appendChild(z.stateNode);else if(z.tag!==4&&z.tag!==27&&z.child!==null){z.child.return=z,z=z.child;continue}if(z===a)break e;for(;z.sibling===null;){if(z.return===null||z.return===a)break e;z=z.return}z.sibling.return=z.return,z=z.sibling}a.stateNode=E;e:switch(Fn(E,v,m),v){case"button":case"input":case"select":case"textarea":m=!!m.autoFocus;break e;case"img":m=!0;break e;default:m=!1}m&&ci(a)}}return Ht(a),$p(a,a.type,s===null?null:s.memoizedProps,a.pendingProps,c),null;case 6:if(s&&a.stateNode!=null)s.memoizedProps!==m&&ci(a);else{if(typeof m!="string"&&a.stateNode===null)throw Error(r(166));if(s=he.current,vl(a)){if(s=a.stateNode,c=a.memoizedProps,m=null,v=zn,v!==null)switch(v.tag){case 27:case 5:m=v.memoizedProps}s[fn]=a,s=!!(s.nodeValue===c||m!==null&&m.suppressHydrationWarning===!0||ix(s.nodeValue,c)),s||Zi(a,!0)}else s=Nh(s).createTextNode(m),s[fn]=a,a.stateNode=s}return Ht(a),null;case 31:if(c=a.memoizedState,s===null||s.memoizedState!==null){if(m=vl(a),c!==null){if(s===null){if(!m)throw Error(r(318));if(s=a.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(r(557));s[fn]=a}else yo(),(a.flags&128)===0&&(a.memoizedState=null),a.flags|=4;Ht(a),s=!1}else c=Jm(),s!==null&&s.memoizedState!==null&&(s.memoizedState.hydrationErrors=c),s=!0;if(!s)return a.flags&256?(jr(a),a):(jr(a),null);if((a.flags&128)!==0)throw Error(r(558))}return Ht(a),null;case 13:if(m=a.memoizedState,s===null||s.memoizedState!==null&&s.memoizedState.dehydrated!==null){if(v=vl(a),m!==null&&m.dehydrated!==null){if(s===null){if(!v)throw Error(r(318));if(v=a.memoizedState,v=v!==null?v.dehydrated:null,!v)throw Error(r(317));v[fn]=a}else yo(),(a.flags&128)===0&&(a.memoizedState=null),a.flags|=4;Ht(a),v=!1}else v=Jm(),s!==null&&s.memoizedState!==null&&(s.memoizedState.hydrationErrors=v),v=!0;if(!v)return a.flags&256?(jr(a),a):(jr(a),null)}return jr(a),(a.flags&128)!==0?(a.lanes=c,a):(c=m!==null,s=s!==null&&s.memoizedState!==null,c&&(m=a.child,v=null,m.alternate!==null&&m.alternate.memoizedState!==null&&m.alternate.memoizedState.cachePool!==null&&(v=m.alternate.memoizedState.cachePool.pool),E=null,m.memoizedState!==null&&m.memoizedState.cachePool!==null&&(E=m.memoizedState.cachePool.pool),E!==v&&(m.flags|=2048)),c!==s&&c&&(a.child.flags|=8192),vh(a,a.updateQueue),Ht(a),null);case 4:return fe(),s===null&&dg(a.stateNode.containerInfo),Ht(a),null;case 10:return ii(a.type),Ht(a),null;case 19:if(q(ln),m=a.memoizedState,m===null)return Ht(a),null;if(v=(a.flags&128)!==0,E=m.rendering,E===null)if(v)uu(m,!1);else{if(sn!==0||s!==null&&(s.flags&128)!==0)for(s=a.child;s!==null;){if(E=oh(s),E!==null){for(a.flags|=128,uu(m,!1),s=E.updateQueue,a.updateQueue=s,vh(a,s),a.subtreeFlags=0,s=c,c=a.child;c!==null;)B_(c,s),c=c.sibling;return ee(ln,ln.current&1|2),_t&&ri(a,m.treeForkCount),a.child}s=s.sibling}m.tail!==null&&Pe()>Ch&&(a.flags|=128,v=!0,uu(m,!1),a.lanes=4194304)}else{if(!v)if(s=oh(E),s!==null){if(a.flags|=128,v=!0,s=s.updateQueue,a.updateQueue=s,vh(a,s),uu(m,!0),m.tail===null&&m.tailMode==="hidden"&&!E.alternate&&!_t)return Ht(a),null}else 2*Pe()-m.renderingStartTime>Ch&&c!==536870912&&(a.flags|=128,v=!0,uu(m,!1),a.lanes=4194304);m.isBackwards?(E.sibling=a.child,a.child=E):(s=m.last,s!==null?s.sibling=E:a.child=E,m.last=E)}return m.tail!==null?(s=m.tail,m.rendering=s,m.tail=s.sibling,m.renderingStartTime=Pe(),s.sibling=null,c=ln.current,ee(ln,v?c&1|2:c&1),_t&&ri(a,m.treeForkCount),s):(Ht(a),null);case 22:case 23:return jr(a),hp(),m=a.memoizedState!==null,s!==null?s.memoizedState!==null!==m&&(a.flags|=8192):m&&(a.flags|=8192),m?(c&536870912)!==0&&(a.flags&128)===0&&(Ht(a),a.subtreeFlags&6&&(a.flags|=8192)):Ht(a),c=a.updateQueue,c!==null&&vh(a,c.retryQueue),c=null,s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(c=s.memoizedState.cachePool.pool),m=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(m=a.memoizedState.cachePool.pool),m!==c&&(a.flags|=2048),s!==null&&q(vo),null;case 24:return c=null,s!==null&&(c=s.memoizedState.cache),a.memoizedState.cache!==c&&(a.flags|=2048),ii(gn),Ht(a),null;case 25:return null;case 30:return null}throw Error(r(156,a.tag))}function tj(s,a){switch(Xm(a),a.tag){case 1:return s=a.flags,s&65536?(a.flags=s&-65537|128,a):null;case 3:return ii(gn),fe(),s=a.flags,(s&65536)!==0&&(s&128)===0?(a.flags=s&-65537|128,a):null;case 26:case 27:case 5:return Ne(a),null;case 31:if(a.memoizedState!==null){if(jr(a),a.alternate===null)throw Error(r(340));yo()}return s=a.flags,s&65536?(a.flags=s&-65537|128,a):null;case 13:if(jr(a),s=a.memoizedState,s!==null&&s.dehydrated!==null){if(a.alternate===null)throw Error(r(340));yo()}return s=a.flags,s&65536?(a.flags=s&-65537|128,a):null;case 19:return q(ln),null;case 4:return fe(),null;case 10:return ii(a.type),null;case 22:case 23:return jr(a),hp(),s!==null&&q(vo),s=a.flags,s&65536?(a.flags=s&-65537|128,a):null;case 24:return ii(gn),null;case 25:return null;default:return null}}function uv(s,a){switch(Xm(a),a.tag){case 3:ii(gn),fe();break;case 26:case 27:case 5:Ne(a);break;case 4:fe();break;case 31:a.memoizedState!==null&&jr(a);break;case 13:jr(a);break;case 19:q(ln);break;case 10:ii(a.type);break;case 22:case 23:jr(a),hp(),s!==null&&q(vo);break;case 24:ii(gn)}}function du(s,a){try{var c=a.updateQueue,m=c!==null?c.lastEffect:null;if(m!==null){var v=m.next;c=v;do{if((c.tag&s)===s){m=void 0;var E=c.create,z=c.inst;m=E(),z.destroy=m}c=c.next}while(c!==v)}}catch(W){kt(a,a.return,W)}}function ia(s,a,c){try{var m=a.updateQueue,v=m!==null?m.lastEffect:null;if(v!==null){var E=v.next;m=E;do{if((m.tag&s)===s){var z=m.inst,W=z.destroy;if(W!==void 0){z.destroy=void 0,v=a;var re=c,ye=W;try{ye()}catch(Te){kt(v,re,Te)}}}m=m.next}while(m!==E)}}catch(Te){kt(a,a.return,Te)}}function dv(s){var a=s.updateQueue;if(a!==null){var c=s.stateNode;try{tb(a,c)}catch(m){kt(s,s.return,m)}}}function hv(s,a,c){c.props=Co(s.type,s.memoizedProps),c.state=s.memoizedState;try{c.componentWillUnmount()}catch(m){kt(s,a,m)}}function hu(s,a){try{var c=s.ref;if(c!==null){switch(s.tag){case 26:case 27:case 5:var m=s.stateNode;break;case 30:m=s.stateNode;break;default:m=s.stateNode}typeof c=="function"?s.refCleanup=c(m):c.current=m}}catch(v){kt(s,a,v)}}function Bs(s,a){var c=s.ref,m=s.refCleanup;if(c!==null)if(typeof m=="function")try{m()}catch(v){kt(s,a,v)}finally{s.refCleanup=null,s=s.alternate,s!=null&&(s.refCleanup=null)}else if(typeof c=="function")try{c(null)}catch(v){kt(s,a,v)}else c.current=null}function fv(s){var a=s.type,c=s.memoizedProps,m=s.stateNode;try{e:switch(a){case"button":case"input":case"select":case"textarea":c.autoFocus&&m.focus();break e;case"img":c.src?m.src=c.src:c.srcSet&&(m.srcset=c.srcSet)}}catch(v){kt(s,s.return,v)}}function qp(s,a,c){try{var m=s.stateNode;Sj(m,s.type,c,a),m[kn]=a}catch(v){kt(s,s.return,v)}}function mv(s){return s.tag===5||s.tag===3||s.tag===26||s.tag===27&&ha(s.type)||s.tag===4}function Hp(s){e:for(;;){for(;s.sibling===null;){if(s.return===null||mv(s.return))return null;s=s.return}for(s.sibling.return=s.return,s=s.sibling;s.tag!==5&&s.tag!==6&&s.tag!==18;){if(s.tag===27&&ha(s.type)||s.flags&2||s.child===null||s.tag===4)continue e;s.child.return=s,s=s.child}if(!(s.flags&2))return s.stateNode}}function Gp(s,a,c){var m=s.tag;if(m===5||m===6)s=s.stateNode,a?(c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c).insertBefore(s,a):(a=c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c,a.appendChild(s),c=c._reactRootContainer,c!=null||a.onclick!==null||(a.onclick=rs));else if(m!==4&&(m===27&&ha(s.type)&&(c=s.stateNode,a=null),s=s.child,s!==null))for(Gp(s,a,c),s=s.sibling;s!==null;)Gp(s,a,c),s=s.sibling}function xh(s,a,c){var m=s.tag;if(m===5||m===6)s=s.stateNode,a?c.insertBefore(s,a):c.appendChild(s);else if(m!==4&&(m===27&&ha(s.type)&&(c=s.stateNode),s=s.child,s!==null))for(xh(s,a,c),s=s.sibling;s!==null;)xh(s,a,c),s=s.sibling}function pv(s){var a=s.stateNode,c=s.memoizedProps;try{for(var m=s.type,v=a.attributes;v.length;)a.removeAttributeNode(v[0]);Fn(a,m,c),a[fn]=s,a[kn]=c}catch(E){kt(s,s.return,E)}}var ui=!1,bn=!1,Wp=!1,gv=typeof WeakSet=="function"?WeakSet:Set,On=null;function nj(s,a){if(s=s.containerInfo,mg=Vh,s=j_(s),Um(s)){if("selectionStart"in s)var c={start:s.selectionStart,end:s.selectionEnd};else e:{c=(c=s.ownerDocument)&&c.defaultView||window;var m=c.getSelection&&c.getSelection();if(m&&m.rangeCount!==0){c=m.anchorNode;var v=m.anchorOffset,E=m.focusNode;m=m.focusOffset;try{c.nodeType,E.nodeType}catch{c=null;break e}var z=0,W=-1,re=-1,ye=0,Te=0,De=s,be=null;t:for(;;){for(var xe;De!==c||v!==0&&De.nodeType!==3||(W=z+v),De!==E||m!==0&&De.nodeType!==3||(re=z+m),De.nodeType===3&&(z+=De.nodeValue.length),(xe=De.firstChild)!==null;)be=De,De=xe;for(;;){if(De===s)break t;if(be===c&&++ye===v&&(W=z),be===E&&++Te===m&&(re=z),(xe=De.nextSibling)!==null)break;De=be,be=De.parentNode}De=xe}c=W===-1||re===-1?null:{start:W,end:re}}else c=null}c=c||{start:0,end:0}}else c=null;for(pg={focusedElem:s,selectionRange:c},Vh=!1,On=a;On!==null;)if(a=On,s=a.child,(a.subtreeFlags&1028)!==0&&s!==null)s.return=a,On=s;else for(;On!==null;){switch(a=On,E=a.alternate,s=a.flags,a.tag){case 0:if((s&4)!==0&&(s=a.updateQueue,s=s!==null?s.events:null,s!==null))for(c=0;c<s.length;c++)v=s[c],v.ref.impl=v.nextImpl;break;case 11:case 15:break;case 1:if((s&1024)!==0&&E!==null){s=void 0,c=a,v=E.memoizedProps,E=E.memoizedState,m=c.stateNode;try{var Ve=Co(c.type,v);s=m.getSnapshotBeforeUpdate(Ve,E),m.__reactInternalSnapshotBeforeUpdate=s}catch(Ke){kt(c,c.return,Ke)}}break;case 3:if((s&1024)!==0){if(s=a.stateNode.containerInfo,c=s.nodeType,c===9)_g(s);else if(c===1)switch(s.nodeName){case"HEAD":case"HTML":case"BODY":_g(s);break;default:s.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((s&1024)!==0)throw Error(r(163))}if(s=a.sibling,s!==null){s.return=a.return,On=s;break}On=a.return}}function yv(s,a,c){var m=c.flags;switch(c.tag){case 0:case 11:case 15:hi(s,c),m&4&&du(5,c);break;case 1:if(hi(s,c),m&4)if(s=c.stateNode,a===null)try{s.componentDidMount()}catch(z){kt(c,c.return,z)}else{var v=Co(c.type,a.memoizedProps);a=a.memoizedState;try{s.componentDidUpdate(v,a,s.__reactInternalSnapshotBeforeUpdate)}catch(z){kt(c,c.return,z)}}m&64&&dv(c),m&512&&hu(c,c.return);break;case 3:if(hi(s,c),m&64&&(s=c.updateQueue,s!==null)){if(a=null,c.child!==null)switch(c.child.tag){case 27:case 5:a=c.child.stateNode;break;case 1:a=c.child.stateNode}try{tb(s,a)}catch(z){kt(c,c.return,z)}}break;case 27:a===null&&m&4&&pv(c);case 26:case 5:hi(s,c),a===null&&m&4&&fv(c),m&512&&hu(c,c.return);break;case 12:hi(s,c);break;case 31:hi(s,c),m&4&&vv(s,c);break;case 13:hi(s,c),m&4&&xv(s,c),m&64&&(s=c.memoizedState,s!==null&&(s=s.dehydrated,s!==null&&(c=dj.bind(null,c),Dj(s,c))));break;case 22:if(m=c.memoizedState!==null||ui,!m){a=a!==null&&a.memoizedState!==null||bn,v=ui;var E=bn;ui=m,(bn=a)&&!E?fi(s,c,(c.subtreeFlags&8772)!==0):hi(s,c),ui=v,bn=E}break;case 30:break;default:hi(s,c)}}function _v(s){var a=s.alternate;a!==null&&(s.alternate=null,_v(a)),s.child=null,s.deletions=null,s.sibling=null,s.tag===5&&(a=s.stateNode,a!==null&&rl(a)),s.stateNode=null,s.return=null,s.dependencies=null,s.memoizedProps=null,s.memoizedState=null,s.pendingProps=null,s.stateNode=null,s.updateQueue=null}var Yt=null,fr=!1;function di(s,a,c){for(c=c.child;c!==null;)bv(s,a,c),c=c.sibling}function bv(s,a,c){if(nn&&typeof nn.onCommitFiberUnmount=="function")try{nn.onCommitFiberUnmount(vt,c)}catch{}switch(c.tag){case 26:bn||Bs(c,a),di(s,a,c),c.memoizedState?c.memoizedState.count--:c.stateNode&&(c=c.stateNode,c.parentNode.removeChild(c));break;case 27:bn||Bs(c,a);var m=Yt,v=fr;ha(c.type)&&(Yt=c.stateNode,fr=!1),di(s,a,c),xu(c.stateNode),Yt=m,fr=v;break;case 5:bn||Bs(c,a);case 6:if(m=Yt,v=fr,Yt=null,di(s,a,c),Yt=m,fr=v,Yt!==null)if(fr)try{(Yt.nodeType===9?Yt.body:Yt.nodeName==="HTML"?Yt.ownerDocument.body:Yt).removeChild(c.stateNode)}catch(E){kt(c,a,E)}else try{Yt.removeChild(c.stateNode)}catch(E){kt(c,a,E)}break;case 18:Yt!==null&&(fr?(s=Yt,dx(s.nodeType===9?s.body:s.nodeName==="HTML"?s.ownerDocument.body:s,c.stateNode),Fl(s)):dx(Yt,c.stateNode));break;case 4:m=Yt,v=fr,Yt=c.stateNode.containerInfo,fr=!0,di(s,a,c),Yt=m,fr=v;break;case 0:case 11:case 14:case 15:ia(2,c,a),bn||ia(4,c,a),di(s,a,c);break;case 1:bn||(Bs(c,a),m=c.stateNode,typeof m.componentWillUnmount=="function"&&hv(c,a,m)),di(s,a,c);break;case 21:di(s,a,c);break;case 22:bn=(m=bn)||c.memoizedState!==null,di(s,a,c),bn=m;break;default:di(s,a,c)}}function vv(s,a){if(a.memoizedState===null&&(s=a.alternate,s!==null&&(s=s.memoizedState,s!==null))){s=s.dehydrated;try{Fl(s)}catch(c){kt(a,a.return,c)}}}function xv(s,a){if(a.memoizedState===null&&(s=a.alternate,s!==null&&(s=s.memoizedState,s!==null&&(s=s.dehydrated,s!==null))))try{Fl(s)}catch(c){kt(a,a.return,c)}}function rj(s){switch(s.tag){case 31:case 13:case 19:var a=s.stateNode;return a===null&&(a=s.stateNode=new gv),a;case 22:return s=s.stateNode,a=s._retryCache,a===null&&(a=s._retryCache=new gv),a;default:throw Error(r(435,s.tag))}}function wh(s,a){var c=rj(s);a.forEach(function(m){if(!c.has(m)){c.add(m);var v=hj.bind(null,s,m);m.then(v,v)}})}function mr(s,a){var c=a.deletions;if(c!==null)for(var m=0;m<c.length;m++){var v=c[m],E=s,z=a,W=z;e:for(;W!==null;){switch(W.tag){case 27:if(ha(W.type)){Yt=W.stateNode,fr=!1;break e}break;case 5:Yt=W.stateNode,fr=!1;break e;case 3:case 4:Yt=W.stateNode.containerInfo,fr=!0;break e}W=W.return}if(Yt===null)throw Error(r(160));bv(E,z,v),Yt=null,fr=!1,E=v.alternate,E!==null&&(E.return=null),v.return=null}if(a.subtreeFlags&13886)for(a=a.child;a!==null;)wv(a,s),a=a.sibling}var cs=null;function wv(s,a){var c=s.alternate,m=s.flags;switch(s.tag){case 0:case 11:case 14:case 15:mr(a,s),pr(s),m&4&&(ia(3,s,s.return),du(3,s),ia(5,s,s.return));break;case 1:mr(a,s),pr(s),m&512&&(bn||c===null||Bs(c,c.return)),m&64&&ui&&(s=s.updateQueue,s!==null&&(m=s.callbacks,m!==null&&(c=s.shared.hiddenCallbacks,s.shared.hiddenCallbacks=c===null?m:c.concat(m))));break;case 26:var v=cs;if(mr(a,s),pr(s),m&512&&(bn||c===null||Bs(c,c.return)),m&4){var E=c!==null?c.memoizedState:null;if(m=s.memoizedState,c===null)if(m===null)if(s.stateNode===null){e:{m=s.type,c=s.memoizedProps,v=v.ownerDocument||v;t:switch(m){case"title":E=v.getElementsByTagName("title")[0],(!E||E[Ss]||E[fn]||E.namespaceURI==="http://www.w3.org/2000/svg"||E.hasAttribute("itemprop"))&&(E=v.createElement(m),v.head.insertBefore(E,v.querySelector("head > title"))),Fn(E,m,c),E[fn]=s,mn(E),m=E;break e;case"link":var z=wx("link","href",v).get(m+(c.href||""));if(z){for(var W=0;W<z.length;W++)if(E=z[W],E.getAttribute("href")===(c.href==null||c.href===""?null:c.href)&&E.getAttribute("rel")===(c.rel==null?null:c.rel)&&E.getAttribute("title")===(c.title==null?null:c.title)&&E.getAttribute("crossorigin")===(c.crossOrigin==null?null:c.crossOrigin)){z.splice(W,1);break t}}E=v.createElement(m),Fn(E,m,c),v.head.appendChild(E);break;case"meta":if(z=wx("meta","content",v).get(m+(c.content||""))){for(W=0;W<z.length;W++)if(E=z[W],E.getAttribute("content")===(c.content==null?null:""+c.content)&&E.getAttribute("name")===(c.name==null?null:c.name)&&E.getAttribute("property")===(c.property==null?null:c.property)&&E.getAttribute("http-equiv")===(c.httpEquiv==null?null:c.httpEquiv)&&E.getAttribute("charset")===(c.charSet==null?null:c.charSet)){z.splice(W,1);break t}}E=v.createElement(m),Fn(E,m,c),v.head.appendChild(E);break;default:throw Error(r(468,m))}E[fn]=s,mn(E),m=E}s.stateNode=m}else Sx(v,s.type,s.stateNode);else s.stateNode=xx(v,m,s.memoizedProps);else E!==m?(E===null?c.stateNode!==null&&(c=c.stateNode,c.parentNode.removeChild(c)):E.count--,m===null?Sx(v,s.type,s.stateNode):xx(v,m,s.memoizedProps)):m===null&&s.stateNode!==null&&qp(s,s.memoizedProps,c.memoizedProps)}break;case 27:mr(a,s),pr(s),m&512&&(bn||c===null||Bs(c,c.return)),c!==null&&m&4&&qp(s,s.memoizedProps,c.memoizedProps);break;case 5:if(mr(a,s),pr(s),m&512&&(bn||c===null||Bs(c,c.return)),s.flags&32){v=s.stateNode;try{hr(v,"")}catch(Ve){kt(s,s.return,Ve)}}m&4&&s.stateNode!=null&&(v=s.memoizedProps,qp(s,v,c!==null?c.memoizedProps:v)),m&1024&&(Wp=!0);break;case 6:if(mr(a,s),pr(s),m&4){if(s.stateNode===null)throw Error(r(162));m=s.memoizedProps,c=s.stateNode;try{c.nodeValue=m}catch(Ve){kt(s,s.return,Ve)}}break;case 3:if(zh=null,v=cs,cs=Ph(a.containerInfo),mr(a,s),cs=v,pr(s),m&4&&c!==null&&c.memoizedState.isDehydrated)try{Fl(a.containerInfo)}catch(Ve){kt(s,s.return,Ve)}Wp&&(Wp=!1,Sv(s));break;case 4:m=cs,cs=Ph(s.stateNode.containerInfo),mr(a,s),pr(s),cs=m;break;case 12:mr(a,s),pr(s);break;case 31:mr(a,s),pr(s),m&4&&(m=s.updateQueue,m!==null&&(s.updateQueue=null,wh(s,m)));break;case 13:mr(a,s),pr(s),s.child.flags&8192&&s.memoizedState!==null!=(c!==null&&c.memoizedState!==null)&&(Eh=Pe()),m&4&&(m=s.updateQueue,m!==null&&(s.updateQueue=null,wh(s,m)));break;case 22:v=s.memoizedState!==null;var re=c!==null&&c.memoizedState!==null,ye=ui,Te=bn;if(ui=ye||v,bn=Te||re,mr(a,s),bn=Te,ui=ye,pr(s),m&8192)e:for(a=s.stateNode,a._visibility=v?a._visibility&-2:a._visibility|1,v&&(c===null||re||ui||bn||To(s)),c=null,a=s;;){if(a.tag===5||a.tag===26){if(c===null){re=c=a;try{if(E=re.stateNode,v)z=E.style,typeof z.setProperty=="function"?z.setProperty("display","none","important"):z.display="none";else{W=re.stateNode;var De=re.memoizedProps.style,be=De!=null&&De.hasOwnProperty("display")?De.display:null;W.style.display=be==null||typeof be=="boolean"?"":(""+be).trim()}}catch(Ve){kt(re,re.return,Ve)}}}else if(a.tag===6){if(c===null){re=a;try{re.stateNode.nodeValue=v?"":re.memoizedProps}catch(Ve){kt(re,re.return,Ve)}}}else if(a.tag===18){if(c===null){re=a;try{var xe=re.stateNode;v?hx(xe,!0):hx(re.stateNode,!1)}catch(Ve){kt(re,re.return,Ve)}}}else if((a.tag!==22&&a.tag!==23||a.memoizedState===null||a===s)&&a.child!==null){a.child.return=a,a=a.child;continue}if(a===s)break e;for(;a.sibling===null;){if(a.return===null||a.return===s)break e;c===a&&(c=null),a=a.return}c===a&&(c=null),a.sibling.return=a.return,a=a.sibling}m&4&&(m=s.updateQueue,m!==null&&(c=m.retryQueue,c!==null&&(m.retryQueue=null,wh(s,c))));break;case 19:mr(a,s),pr(s),m&4&&(m=s.updateQueue,m!==null&&(s.updateQueue=null,wh(s,m)));break;case 30:break;case 21:break;default:mr(a,s),pr(s)}}function pr(s){var a=s.flags;if(a&2){try{for(var c,m=s.return;m!==null;){if(mv(m)){c=m;break}m=m.return}if(c==null)throw Error(r(160));switch(c.tag){case 27:var v=c.stateNode,E=Hp(s);xh(s,E,v);break;case 5:var z=c.stateNode;c.flags&32&&(hr(z,""),c.flags&=-33);var W=Hp(s);xh(s,W,z);break;case 3:case 4:var re=c.stateNode.containerInfo,ye=Hp(s);Gp(s,ye,re);break;default:throw Error(r(161))}}catch(Te){kt(s,s.return,Te)}s.flags&=-3}a&4096&&(s.flags&=-4097)}function Sv(s){if(s.subtreeFlags&1024)for(s=s.child;s!==null;){var a=s;Sv(a),a.tag===5&&a.flags&1024&&a.stateNode.reset(),s=s.sibling}}function hi(s,a){if(a.subtreeFlags&8772)for(a=a.child;a!==null;)yv(s,a.alternate,a),a=a.sibling}function To(s){for(s=s.child;s!==null;){var a=s;switch(a.tag){case 0:case 11:case 14:case 15:ia(4,a,a.return),To(a);break;case 1:Bs(a,a.return);var c=a.stateNode;typeof c.componentWillUnmount=="function"&&hv(a,a.return,c),To(a);break;case 27:xu(a.stateNode);case 26:case 5:Bs(a,a.return),To(a);break;case 22:a.memoizedState===null&&To(a);break;case 30:To(a);break;default:To(a)}s=s.sibling}}function fi(s,a,c){for(c=c&&(a.subtreeFlags&8772)!==0,a=a.child;a!==null;){var m=a.alternate,v=s,E=a,z=E.flags;switch(E.tag){case 0:case 11:case 15:fi(v,E,c),du(4,E);break;case 1:if(fi(v,E,c),m=E,v=m.stateNode,typeof v.componentDidMount=="function")try{v.componentDidMount()}catch(ye){kt(m,m.return,ye)}if(m=E,v=m.updateQueue,v!==null){var W=m.stateNode;try{var re=v.shared.hiddenCallbacks;if(re!==null)for(v.shared.hiddenCallbacks=null,v=0;v<re.length;v++)eb(re[v],W)}catch(ye){kt(m,m.return,ye)}}c&&z&64&&dv(E),hu(E,E.return);break;case 27:pv(E);case 26:case 5:fi(v,E,c),c&&m===null&&z&4&&fv(E),hu(E,E.return);break;case 12:fi(v,E,c);break;case 31:fi(v,E,c),c&&z&4&&vv(v,E);break;case 13:fi(v,E,c),c&&z&4&&xv(v,E);break;case 22:E.memoizedState===null&&fi(v,E,c),hu(E,E.return);break;case 30:break;default:fi(v,E,c)}a=a.sibling}}function Qp(s,a){var c=null;s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(c=s.memoizedState.cachePool.pool),s=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(s=a.memoizedState.cachePool.pool),s!==c&&(s!=null&&s.refCount++,c!=null&&Zc(c))}function Kp(s,a){s=null,a.alternate!==null&&(s=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==s&&(a.refCount++,s!=null&&Zc(s))}function us(s,a,c,m){if(a.subtreeFlags&10256)for(a=a.child;a!==null;)Ev(s,a,c,m),a=a.sibling}function Ev(s,a,c,m){var v=a.flags;switch(a.tag){case 0:case 11:case 15:us(s,a,c,m),v&2048&&du(9,a);break;case 1:us(s,a,c,m);break;case 3:us(s,a,c,m),v&2048&&(s=null,a.alternate!==null&&(s=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==s&&(a.refCount++,s!=null&&Zc(s)));break;case 12:if(v&2048){us(s,a,c,m),s=a.stateNode;try{var E=a.memoizedProps,z=E.id,W=E.onPostCommit;typeof W=="function"&&W(z,a.alternate===null?"mount":"update",s.passiveEffectDuration,-0)}catch(re){kt(a,a.return,re)}}else us(s,a,c,m);break;case 31:us(s,a,c,m);break;case 13:us(s,a,c,m);break;case 23:break;case 22:E=a.stateNode,z=a.alternate,a.memoizedState!==null?E._visibility&2?us(s,a,c,m):fu(s,a):E._visibility&2?us(s,a,c,m):(E._visibility|=2,Il(s,a,c,m,(a.subtreeFlags&10256)!==0||!1)),v&2048&&Qp(z,a);break;case 24:us(s,a,c,m),v&2048&&Kp(a.alternate,a);break;default:us(s,a,c,m)}}function Il(s,a,c,m,v){for(v=v&&((a.subtreeFlags&10256)!==0||!1),a=a.child;a!==null;){var E=s,z=a,W=c,re=m,ye=z.flags;switch(z.tag){case 0:case 11:case 15:Il(E,z,W,re,v),du(8,z);break;case 23:break;case 22:var Te=z.stateNode;z.memoizedState!==null?Te._visibility&2?Il(E,z,W,re,v):fu(E,z):(Te._visibility|=2,Il(E,z,W,re,v)),v&&ye&2048&&Qp(z.alternate,z);break;case 24:Il(E,z,W,re,v),v&&ye&2048&&Kp(z.alternate,z);break;default:Il(E,z,W,re,v)}a=a.sibling}}function fu(s,a){if(a.subtreeFlags&10256)for(a=a.child;a!==null;){var c=s,m=a,v=m.flags;switch(m.tag){case 22:fu(c,m),v&2048&&Qp(m.alternate,m);break;case 24:fu(c,m),v&2048&&Kp(m.alternate,m);break;default:fu(c,m)}a=a.sibling}}var mu=8192;function Dl(s,a,c){if(s.subtreeFlags&mu)for(s=s.child;s!==null;)Cv(s,a,c),s=s.sibling}function Cv(s,a,c){switch(s.tag){case 26:Dl(s,a,c),s.flags&mu&&s.memoizedState!==null&&$j(c,cs,s.memoizedState,s.memoizedProps);break;case 5:Dl(s,a,c);break;case 3:case 4:var m=cs;cs=Ph(s.stateNode.containerInfo),Dl(s,a,c),cs=m;break;case 22:s.memoizedState===null&&(m=s.alternate,m!==null&&m.memoizedState!==null?(m=mu,mu=16777216,Dl(s,a,c),mu=m):Dl(s,a,c));break;default:Dl(s,a,c)}}function Tv(s){var a=s.alternate;if(a!==null&&(s=a.child,s!==null)){a.child=null;do a=s.sibling,s.sibling=null,s=a;while(s!==null)}}function pu(s){var a=s.deletions;if((s.flags&16)!==0){if(a!==null)for(var c=0;c<a.length;c++){var m=a[c];On=m,jv(m,s)}Tv(s)}if(s.subtreeFlags&10256)for(s=s.child;s!==null;)Av(s),s=s.sibling}function Av(s){switch(s.tag){case 0:case 11:case 15:pu(s),s.flags&2048&&ia(9,s,s.return);break;case 3:pu(s);break;case 12:pu(s);break;case 22:var a=s.stateNode;s.memoizedState!==null&&a._visibility&2&&(s.return===null||s.return.tag!==13)?(a._visibility&=-3,Sh(s)):pu(s);break;default:pu(s)}}function Sh(s){var a=s.deletions;if((s.flags&16)!==0){if(a!==null)for(var c=0;c<a.length;c++){var m=a[c];On=m,jv(m,s)}Tv(s)}for(s=s.child;s!==null;){switch(a=s,a.tag){case 0:case 11:case 15:ia(8,a,a.return),Sh(a);break;case 22:c=a.stateNode,c._visibility&2&&(c._visibility&=-3,Sh(a));break;default:Sh(a)}s=s.sibling}}function jv(s,a){for(;On!==null;){var c=On;switch(c.tag){case 0:case 11:case 15:ia(8,c,a);break;case 23:case 22:if(c.memoizedState!==null&&c.memoizedState.cachePool!==null){var m=c.memoizedState.cachePool.pool;m!=null&&m.refCount++}break;case 24:Zc(c.memoizedState.cache)}if(m=c.child,m!==null)m.return=c,On=m;else e:for(c=s;On!==null;){m=On;var v=m.sibling,E=m.return;if(_v(m),m===c){On=null;break e}if(v!==null){v.return=E,On=v;break e}On=E}}}var sj={getCacheForType:function(s){var a=Ln(gn),c=a.data.get(s);return c===void 0&&(c=s(),a.data.set(s,c)),c},cacheSignal:function(){return Ln(gn).controller.signal}},ij=typeof WeakMap=="function"?WeakMap:Map,Tt=0,Lt=null,ut=null,ft=0,Dt=0,Rr=null,aa=!1,kl=!1,Yp=!1,mi=0,sn=0,oa=0,Ao=0,Xp=0,Ir=0,Ml=0,gu=null,gr=null,Zp=!1,Eh=0,Rv=0,Ch=1/0,Th=null,la=null,Tn=0,ca=null,Ol=null,pi=0,Jp=0,eg=null,Iv=null,yu=0,tg=null;function Dr(){return(Tt&2)!==0&&ft!==0?ft&-ft:X.T!==null?og():Ad()}function Dv(){if(Ir===0)if((ft&536870912)===0||_t){var s=bs;bs<<=1,(bs&3932160)===0&&(bs=262144),Ir=s}else Ir=536870912;return s=Ar.current,s!==null&&(s.flags|=32),Ir}function yr(s,a,c){(s===Lt&&(Dt===2||Dt===9)||s.cancelPendingCommit!==null)&&(Nl(s,0),ua(s,ft,Ir,!1)),eo(s,c),((Tt&2)===0||s!==Lt)&&(s===Lt&&((Tt&2)===0&&(Ao|=c),sn===4&&ua(s,ft,Ir,!1)),zs(s))}function kv(s,a,c){if((Tt&6)!==0)throw Error(r(327));var m=!c&&(a&127)===0&&(a&s.expiredLanes)===0||es(s,a),v=m?lj(s,a):rg(s,a,!0),E=m;do{if(v===0){kl&&!m&&ua(s,a,0,!1);break}else{if(c=s.current.alternate,E&&!aj(c)){v=rg(s,a,!1),E=!1;continue}if(v===2){if(E=a,s.errorRecoveryDisabledLanes&E)var z=0;else z=s.pendingLanes&-536870913,z=z!==0?z:z&536870912?536870912:0;if(z!==0){a=z;e:{var W=s;v=gu;var re=W.current.memoizedState.isDehydrated;if(re&&(Nl(W,z).flags|=256),z=rg(W,z,!1),z!==2){if(Yp&&!re){W.errorRecoveryDisabledLanes|=E,Ao|=E,v=4;break e}E=gr,gr=v,E!==null&&(gr===null?gr=E:gr.push.apply(gr,E))}v=z}if(E=!1,v!==2)continue}}if(v===1){Nl(s,0),ua(s,a,0,!0);break}e:{switch(m=s,E=v,E){case 0:case 1:throw Error(r(345));case 4:if((a&4194048)!==a)break;case 6:ua(m,a,Ir,!aa);break e;case 2:gr=null;break;case 3:case 5:break;default:throw Error(r(329))}if((a&62914560)===a&&(v=Eh+300-Pe(),10<v)){if(ua(m,a,Ir,!aa),vs(m,0,!0)!==0)break e;pi=a,m.timeoutHandle=cx(Mv.bind(null,m,c,gr,Th,Zp,a,Ir,Ao,Ml,aa,E,"Throttled",-0,0),v);break e}Mv(m,c,gr,Th,Zp,a,Ir,Ao,Ml,aa,E,null,-0,0)}}break}while(!0);zs(s)}function Mv(s,a,c,m,v,E,z,W,re,ye,Te,De,be,xe){if(s.timeoutHandle=-1,De=a.subtreeFlags,De&8192||(De&16785408)===16785408){De={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:rs},Cv(a,E,De);var Ve=(E&62914560)===E?Eh-Pe():(E&4194048)===E?Rv-Pe():0;if(Ve=qj(De,Ve),Ve!==null){pi=E,s.cancelPendingCommit=Ve(Fv.bind(null,s,a,E,c,m,v,z,W,re,Te,De,null,be,xe)),ua(s,E,z,!ye);return}}Fv(s,a,E,c,m,v,z,W,re)}function aj(s){for(var a=s;;){var c=a.tag;if((c===0||c===11||c===15)&&a.flags&16384&&(c=a.updateQueue,c!==null&&(c=c.stores,c!==null)))for(var m=0;m<c.length;m++){var v=c[m],E=v.getSnapshot;v=v.value;try{if(!Cr(E(),v))return!1}catch{return!1}}if(c=a.child,a.subtreeFlags&16384&&c!==null)c.return=a,a=c;else{if(a===s)break;for(;a.sibling===null;){if(a.return===null||a.return===s)return!0;a=a.return}a.sibling.return=a.return,a=a.sibling}}return!0}function ua(s,a,c,m){a&=~Xp,a&=~Ao,s.suspendedLanes|=a,s.pingedLanes&=~a,m&&(s.warmLanes|=a),m=s.expirationTimes;for(var v=a;0<v;){var E=31-Et(v),z=1<<E;m[E]=-1,v&=~z}c!==0&&to(s,c,a)}function Ah(){return(Tt&6)===0?(_u(0),!1):!0}function ng(){if(ut!==null){if(Dt===0)var s=ut.return;else s=ut,si=_o=null,_p(s),Cl=null,eu=0,s=ut;for(;s!==null;)uv(s.alternate,s),s=s.return;ut=null}}function Nl(s,a){var c=s.timeoutHandle;c!==-1&&(s.timeoutHandle=-1,Tj(c)),c=s.cancelPendingCommit,c!==null&&(s.cancelPendingCommit=null,c()),pi=0,ng(),Lt=s,ut=c=ni(s.current,null),ft=a,Dt=0,Rr=null,aa=!1,kl=es(s,a),Yp=!1,Ml=Ir=Xp=Ao=oa=sn=0,gr=gu=null,Zp=!1,(a&8)!==0&&(a|=a&32);var m=s.entangledLanes;if(m!==0)for(s=s.entanglements,m&=a;0<m;){var v=31-Et(m),E=1<<v;a|=s[v],m&=~E}return mi=a,Qd(),c}function Ov(s,a){ot=null,X.H=lu,a===El||a===nh?(a=Y_(),Dt=3):a===ap?(a=Y_(),Dt=4):Dt=a===Op?8:a!==null&&typeof a=="object"&&typeof a.then=="function"?6:1,Rr=a,ut===null&&(sn=1,gh(s,$r(a,s.current)))}function Nv(){var s=Ar.current;return s===null?!0:(ft&4194048)===ft?Wr===null:(ft&62914560)===ft||(ft&536870912)!==0?s===Wr:!1}function Pv(){var s=X.H;return X.H=lu,s===null?lu:s}function Bv(){var s=X.A;return X.A=sj,s}function jh(){sn=4,aa||(ft&4194048)!==ft&&Ar.current!==null||(kl=!0),(oa&134217727)===0&&(Ao&134217727)===0||Lt===null||ua(Lt,ft,Ir,!1)}function rg(s,a,c){var m=Tt;Tt|=2;var v=Pv(),E=Bv();(Lt!==s||ft!==a)&&(Th=null,Nl(s,a)),a=!1;var z=sn;e:do try{if(Dt!==0&&ut!==null){var W=ut,re=Rr;switch(Dt){case 8:ng(),z=6;break e;case 3:case 2:case 9:case 6:Ar.current===null&&(a=!0);var ye=Dt;if(Dt=0,Rr=null,Pl(s,W,re,ye),c&&kl){z=0;break e}break;default:ye=Dt,Dt=0,Rr=null,Pl(s,W,re,ye)}}oj(),z=sn;break}catch(Te){Ov(s,Te)}while(!0);return a&&s.shellSuspendCounter++,si=_o=null,Tt=m,X.H=v,X.A=E,ut===null&&(Lt=null,ft=0,Qd()),z}function oj(){for(;ut!==null;)zv(ut)}function lj(s,a){var c=Tt;Tt|=2;var m=Pv(),v=Bv();Lt!==s||ft!==a?(Th=null,Ch=Pe()+500,Nl(s,a)):kl=es(s,a);e:do try{if(Dt!==0&&ut!==null){a=ut;var E=Rr;t:switch(Dt){case 1:Dt=0,Rr=null,Pl(s,a,E,1);break;case 2:case 9:if(Q_(E)){Dt=0,Rr=null,Lv(a);break}a=function(){Dt!==2&&Dt!==9||Lt!==s||(Dt=7),zs(s)},E.then(a,a);break e;case 3:Dt=7;break e;case 4:Dt=5;break e;case 7:Q_(E)?(Dt=0,Rr=null,Lv(a)):(Dt=0,Rr=null,Pl(s,a,E,7));break;case 5:var z=null;switch(ut.tag){case 26:z=ut.memoizedState;case 5:case 27:var W=ut;if(z?Ex(z):W.stateNode.complete){Dt=0,Rr=null;var re=W.sibling;if(re!==null)ut=re;else{var ye=W.return;ye!==null?(ut=ye,Rh(ye)):ut=null}break t}}Dt=0,Rr=null,Pl(s,a,E,5);break;case 6:Dt=0,Rr=null,Pl(s,a,E,6);break;case 8:ng(),sn=6;break e;default:throw Error(r(462))}}cj();break}catch(Te){Ov(s,Te)}while(!0);return si=_o=null,X.H=m,X.A=v,Tt=c,ut!==null?0:(Lt=null,ft=0,Qd(),sn)}function cj(){for(;ut!==null&&!ie();)zv(ut)}function zv(s){var a=lv(s.alternate,s,mi);s.memoizedProps=s.pendingProps,a===null?Rh(s):ut=a}function Lv(s){var a=s,c=a.alternate;switch(a.tag){case 15:case 0:a=nv(c,a,a.pendingProps,a.type,void 0,ft);break;case 11:a=nv(c,a,a.pendingProps,a.type.render,a.ref,ft);break;case 5:_p(a);default:uv(c,a),a=ut=B_(a,mi),a=lv(c,a,mi)}s.memoizedProps=s.pendingProps,a===null?Rh(s):ut=a}function Pl(s,a,c,m){si=_o=null,_p(a),Cl=null,eu=0;var v=a.return;try{if(XA(s,v,a,c,ft)){sn=1,gh(s,$r(c,s.current)),ut=null;return}}catch(E){if(v!==null)throw ut=v,E;sn=1,gh(s,$r(c,s.current)),ut=null;return}a.flags&32768?(_t||m===1?s=!0:kl||(ft&536870912)!==0?s=!1:(aa=s=!0,(m===2||m===9||m===3||m===6)&&(m=Ar.current,m!==null&&m.tag===13&&(m.flags|=16384))),Uv(a,s)):Rh(a)}function Rh(s){var a=s;do{if((a.flags&32768)!==0){Uv(a,aa);return}s=a.return;var c=ej(a.alternate,a,mi);if(c!==null){ut=c;return}if(a=a.sibling,a!==null){ut=a;return}ut=a=s}while(a!==null);sn===0&&(sn=5)}function Uv(s,a){do{var c=tj(s.alternate,s);if(c!==null){c.flags&=32767,ut=c;return}if(c=s.return,c!==null&&(c.flags|=32768,c.subtreeFlags=0,c.deletions=null),!a&&(s=s.sibling,s!==null)){ut=s;return}ut=s=c}while(s!==null);sn=6,ut=null}function Fv(s,a,c,m,v,E,z,W,re){s.cancelPendingCommit=null;do Ih();while(Tn!==0);if((Tt&6)!==0)throw Error(r(327));if(a!==null){if(a===s.current)throw Error(r(177));if(E=a.lanes|a.childLanes,E|=Hm,Pm(s,c,E,z,W,re),s===Lt&&(ut=Lt=null,ft=0),Ol=a,ca=s,pi=c,Jp=E,eg=v,Iv=m,(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?(s.callbackNode=null,s.callbackPriority=0,fj(it,function(){return Gv(),null})):(s.callbackNode=null,s.callbackPriority=0),m=(a.flags&13878)!==0,(a.subtreeFlags&13878)!==0||m){m=X.T,X.T=null,v=G.p,G.p=2,z=Tt,Tt|=4;try{nj(s,a,c)}finally{Tt=z,G.p=v,X.T=m}}Tn=1,Vv(),$v(),qv()}}function Vv(){if(Tn===1){Tn=0;var s=ca,a=Ol,c=(a.flags&13878)!==0;if((a.subtreeFlags&13878)!==0||c){c=X.T,X.T=null;var m=G.p;G.p=2;var v=Tt;Tt|=4;try{wv(a,s);var E=pg,z=j_(s.containerInfo),W=E.focusedElem,re=E.selectionRange;if(z!==W&&W&&W.ownerDocument&&A_(W.ownerDocument.documentElement,W)){if(re!==null&&Um(W)){var ye=re.start,Te=re.end;if(Te===void 0&&(Te=ye),"selectionStart"in W)W.selectionStart=ye,W.selectionEnd=Math.min(Te,W.value.length);else{var De=W.ownerDocument||document,be=De&&De.defaultView||window;if(be.getSelection){var xe=be.getSelection(),Ve=W.textContent.length,Ke=Math.min(re.start,Ve),Pt=re.end===void 0?Ke:Math.min(re.end,Ve);!xe.extend&&Ke>Pt&&(z=Pt,Pt=Ke,Ke=z);var ue=T_(W,Ke),ce=T_(W,Pt);if(ue&&ce&&(xe.rangeCount!==1||xe.anchorNode!==ue.node||xe.anchorOffset!==ue.offset||xe.focusNode!==ce.node||xe.focusOffset!==ce.offset)){var ge=De.createRange();ge.setStart(ue.node,ue.offset),xe.removeAllRanges(),Ke>Pt?(xe.addRange(ge),xe.extend(ce.node,ce.offset)):(ge.setEnd(ce.node,ce.offset),xe.addRange(ge))}}}}for(De=[],xe=W;xe=xe.parentNode;)xe.nodeType===1&&De.push({element:xe,left:xe.scrollLeft,top:xe.scrollTop});for(typeof W.focus=="function"&&W.focus(),W=0;W<De.length;W++){var Ae=De[W];Ae.element.scrollLeft=Ae.left,Ae.element.scrollTop=Ae.top}}Vh=!!mg,pg=mg=null}finally{Tt=v,G.p=m,X.T=c}}s.current=a,Tn=2}}function $v(){if(Tn===2){Tn=0;var s=ca,a=Ol,c=(a.flags&8772)!==0;if((a.subtreeFlags&8772)!==0||c){c=X.T,X.T=null;var m=G.p;G.p=2;var v=Tt;Tt|=4;try{yv(s,a.alternate,a)}finally{Tt=v,G.p=m,X.T=c}}Tn=3}}function qv(){if(Tn===4||Tn===3){Tn=0,Re();var s=ca,a=Ol,c=pi,m=Iv;(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?Tn=5:(Tn=0,Ol=ca=null,Hv(s,s.pendingLanes));var v=s.pendingLanes;if(v===0&&(la=null),Zs(c),a=a.stateNode,nn&&typeof nn.onCommitFiberRoot=="function")try{nn.onCommitFiberRoot(vt,a,void 0,(a.current.flags&128)===128)}catch{}if(m!==null){a=X.T,v=G.p,G.p=2,X.T=null;try{for(var E=s.onRecoverableError,z=0;z<m.length;z++){var W=m[z];E(W.value,{componentStack:W.stack})}}finally{X.T=a,G.p=v}}(pi&3)!==0&&Ih(),zs(s),v=s.pendingLanes,(c&261930)!==0&&(v&42)!==0?s===tg?yu++:(yu=0,tg=s):yu=0,_u(0)}}function Hv(s,a){(s.pooledCacheLanes&=a)===0&&(a=s.pooledCache,a!=null&&(s.pooledCache=null,Zc(a)))}function Ih(){return Vv(),$v(),qv(),Gv()}function Gv(){if(Tn!==5)return!1;var s=ca,a=Jp;Jp=0;var c=Zs(pi),m=X.T,v=G.p;try{G.p=32>c?32:c,X.T=null,c=eg,eg=null;var E=ca,z=pi;if(Tn=0,Ol=ca=null,pi=0,(Tt&6)!==0)throw Error(r(331));var W=Tt;if(Tt|=4,Av(E.current),Ev(E,E.current,z,c),Tt=W,_u(0,!1),nn&&typeof nn.onPostCommitFiberRoot=="function")try{nn.onPostCommitFiberRoot(vt,E)}catch{}return!0}finally{G.p=v,X.T=m,Hv(s,a)}}function Wv(s,a,c){a=$r(c,a),a=Mp(s.stateNode,a,2),s=na(s,a,2),s!==null&&(eo(s,2),zs(s))}function kt(s,a,c){if(s.tag===3)Wv(s,s,c);else for(;a!==null;){if(a.tag===3){Wv(a,s,c);break}else if(a.tag===1){var m=a.stateNode;if(typeof a.type.getDerivedStateFromError=="function"||typeof m.componentDidCatch=="function"&&(la===null||!la.has(m))){s=$r(c,s),c=Qb(2),m=na(a,c,2),m!==null&&(Kb(c,m,a,s),eo(m,2),zs(m));break}}a=a.return}}function sg(s,a,c){var m=s.pingCache;if(m===null){m=s.pingCache=new ij;var v=new Set;m.set(a,v)}else v=m.get(a),v===void 0&&(v=new Set,m.set(a,v));v.has(c)||(Yp=!0,v.add(c),s=uj.bind(null,s,a,c),a.then(s,s))}function uj(s,a,c){var m=s.pingCache;m!==null&&m.delete(a),s.pingedLanes|=s.suspendedLanes&c,s.warmLanes&=~c,Lt===s&&(ft&c)===c&&(sn===4||sn===3&&(ft&62914560)===ft&&300>Pe()-Eh?(Tt&2)===0&&Nl(s,0):Xp|=c,Ml===ft&&(Ml=0)),zs(s)}function Qv(s,a){a===0&&(a=Td()),s=po(s,a),s!==null&&(eo(s,a),zs(s))}function dj(s){var a=s.memoizedState,c=0;a!==null&&(c=a.retryLane),Qv(s,c)}function hj(s,a){var c=0;switch(s.tag){case 31:case 13:var m=s.stateNode,v=s.memoizedState;v!==null&&(c=v.retryLane);break;case 19:m=s.stateNode;break;case 22:m=s.stateNode._retryCache;break;default:throw Error(r(314))}m!==null&&m.delete(a),Qv(s,c)}function fj(s,a){return Se(s,a)}var Dh=null,Bl=null,ig=!1,kh=!1,ag=!1,da=0;function zs(s){s!==Bl&&s.next===null&&(Bl===null?Dh=Bl=s:Bl=Bl.next=s),kh=!0,ig||(ig=!0,pj())}function _u(s,a){if(!ag&&kh){ag=!0;do for(var c=!1,m=Dh;m!==null;){if(s!==0){var v=m.pendingLanes;if(v===0)var E=0;else{var z=m.suspendedLanes,W=m.pingedLanes;E=(1<<31-Et(42|s)+1)-1,E&=v&~(z&~W),E=E&201326741?E&201326741|1:E?E|2:0}E!==0&&(c=!0,Zv(m,E))}else E=ft,E=vs(m,m===Lt?E:0,m.cancelPendingCommit!==null||m.timeoutHandle!==-1),(E&3)===0||es(m,E)||(c=!0,Zv(m,E));m=m.next}while(c);ag=!1}}function mj(){Kv()}function Kv(){kh=ig=!1;var s=0;da!==0&&Cj()&&(s=da);for(var a=Pe(),c=null,m=Dh;m!==null;){var v=m.next,E=Yv(m,a);E===0?(m.next=null,c===null?Dh=v:c.next=v,v===null&&(Bl=c)):(c=m,(s!==0||(E&3)!==0)&&(kh=!0)),m=v}Tn!==0&&Tn!==5||_u(s),da!==0&&(da=0)}function Yv(s,a){for(var c=s.suspendedLanes,m=s.pingedLanes,v=s.expirationTimes,E=s.pendingLanes&-62914561;0<E;){var z=31-Et(E),W=1<<z,re=v[z];re===-1?((W&c)===0||(W&m)!==0)&&(v[z]=Nm(W,a)):re<=a&&(s.expiredLanes|=W),E&=~W}if(a=Lt,c=ft,c=vs(s,s===a?c:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),m=s.callbackNode,c===0||s===a&&(Dt===2||Dt===9)||s.cancelPendingCommit!==null)return m!==null&&m!==null&&we(m),s.callbackNode=null,s.callbackPriority=0;if((c&3)===0||es(s,c)){if(a=c&-c,a===s.callbackPriority)return a;switch(m!==null&&we(m),Zs(c)){case 2:case 8:c=xt;break;case 32:c=it;break;case 268435456:c=ys;break;default:c=it}return m=Xv.bind(null,s),c=Se(c,m),s.callbackPriority=a,s.callbackNode=c,a}return m!==null&&m!==null&&we(m),s.callbackPriority=2,s.callbackNode=null,2}function Xv(s,a){if(Tn!==0&&Tn!==5)return s.callbackNode=null,s.callbackPriority=0,null;var c=s.callbackNode;if(Ih()&&s.callbackNode!==c)return null;var m=ft;return m=vs(s,s===Lt?m:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),m===0?null:(kv(s,m,a),Yv(s,Pe()),s.callbackNode!=null&&s.callbackNode===c?Xv.bind(null,s):null)}function Zv(s,a){if(Ih())return null;kv(s,a,!0)}function pj(){Aj(function(){(Tt&6)!==0?Se(He,mj):Kv()})}function og(){if(da===0){var s=wl;s===0&&(s=Br,Br<<=1,(Br&261888)===0&&(Br=256)),da=s}return da}function Jv(s){return s==null||typeof s=="symbol"||typeof s=="boolean"?null:typeof s=="function"?s:ol(""+s)}function ex(s,a){var c=a.ownerDocument.createElement("input");return c.name=a.name,c.value=a.value,s.id&&c.setAttribute("form",s.id),a.parentNode.insertBefore(c,a),s=new FormData(s),c.parentNode.removeChild(c),s}function gj(s,a,c,m,v){if(a==="submit"&&c&&c.stateNode===v){var E=Jv((v[kn]||null).action),z=m.submitter;z&&(a=(a=z[kn]||null)?Jv(a.formAction):z.getAttribute("formAction"),a!==null&&(E=a,z=null));var W=new Ds("action","action",null,m,v);s.push({event:W,listeners:[{instance:null,listener:function(){if(m.defaultPrevented){if(da!==0){var re=z?ex(v,z):new FormData(v);Ap(c,{pending:!0,data:re,method:v.method,action:E},null,re)}}else typeof E=="function"&&(W.preventDefault(),re=z?ex(v,z):new FormData(v),Ap(c,{pending:!0,data:re,method:v.method,action:E},E,re))},currentTarget:v}]})}}for(var lg=0;lg<qm.length;lg++){var cg=qm[lg],yj=cg.toLowerCase(),_j=cg[0].toUpperCase()+cg.slice(1);ls(yj,"on"+_j)}ls(D_,"onAnimationEnd"),ls(k_,"onAnimationIteration"),ls(M_,"onAnimationStart"),ls("dblclick","onDoubleClick"),ls("focusin","onFocus"),ls("focusout","onBlur"),ls(OA,"onTransitionRun"),ls(NA,"onTransitionStart"),ls(PA,"onTransitionCancel"),ls(O_,"onTransitionEnd"),As("onMouseEnter",["mouseout","mouseover"]),As("onMouseLeave",["mouseout","mouseover"]),As("onPointerEnter",["pointerout","pointerover"]),As("onPointerLeave",["pointerout","pointerover"]),Ts("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Ts("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Ts("onBeforeInput",["compositionend","keypress","textInput","paste"]),Ts("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Ts("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Ts("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var bu="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),bj=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(bu));function tx(s,a){a=(a&4)!==0;for(var c=0;c<s.length;c++){var m=s[c],v=m.event;m=m.listeners;e:{var E=void 0;if(a)for(var z=m.length-1;0<=z;z--){var W=m[z],re=W.instance,ye=W.currentTarget;if(W=W.listener,re!==E&&v.isPropagationStopped())break e;E=W,v.currentTarget=ye;try{E(v)}catch(Te){Wd(Te)}v.currentTarget=null,E=re}else for(z=0;z<m.length;z++){if(W=m[z],re=W.instance,ye=W.currentTarget,W=W.listener,re!==E&&v.isPropagationStopped())break e;E=W,v.currentTarget=ye;try{E(v)}catch(Te){Wd(Te)}v.currentTarget=null,E=re}}}}function dt(s,a){var c=a[nl];c===void 0&&(c=a[nl]=new Set);var m=s+"__bubble";c.has(m)||(nx(a,s,2,!1),c.add(m))}function ug(s,a,c){var m=0;a&&(m|=4),nx(c,s,m,a)}var Mh="_reactListening"+Math.random().toString(36).slice(2);function dg(s){if(!s[Mh]){s[Mh]=!0,Dc.forEach(function(c){c!=="selectionchange"&&(bj.has(c)||ug(c,!1,s),ug(c,!0,s))});var a=s.nodeType===9?s:s.ownerDocument;a===null||a[Mh]||(a[Mh]=!0,ug("selectionchange",!1,a))}}function nx(s,a,c,m){switch(Dx(a)){case 2:var v=Wj;break;case 8:v=Qj;break;default:v=Tg}c=v.bind(null,a,c,s),v=void 0,!ao||a!=="touchstart"&&a!=="touchmove"&&a!=="wheel"||(v=!0),m?v!==void 0?s.addEventListener(a,c,{capture:!0,passive:v}):s.addEventListener(a,c,!0):v!==void 0?s.addEventListener(a,c,{passive:v}):s.addEventListener(a,c,!1)}function hg(s,a,c,m,v){var E=m;if((a&1)===0&&(a&2)===0&&m!==null)e:for(;;){if(m===null)return;var z=m.tag;if(z===3||z===4){var W=m.stateNode.containerInfo;if(W===v)break;if(z===4)for(z=m.return;z!==null;){var re=z.tag;if((re===3||re===4)&&z.stateNode.containerInfo===v)return;z=z.return}for(;W!==null;){if(z=Es(W),z===null)return;if(re=z.tag,re===5||re===6||re===26||re===27){m=E=z;continue e}W=W.parentNode}}m=m.return}Gi(function(){var ye=E,Te=Lr(c),De=[];e:{var be=N_.get(s);if(be!==void 0){var xe=Ds,Ve=s;switch(s){case"keypress":if(lo(c)===0)break e;case"keydown":case"keyup":xe=qd;break;case"focusin":Ve="focus",xe=uo;break;case"focusout":Ve="blur",xe=uo;break;case"beforeblur":case"afterblur":xe=uo;break;case"click":if(c.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":xe=qc;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":xe=Nd;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":xe=j;break;case D_:case k_:case M_:xe=Bd;break;case O_:xe=Y;break;case"scroll":case"scrollend":xe=$c;break;case"wheel":xe=ve;break;case"copy":case"cut":case"paste":xe=zd;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":xe=ti;break;case"toggle":case"beforetoggle":xe=at}var Ke=(a&4)!==0,Pt=!Ke&&(s==="scroll"||s==="scrollend"),ue=Ke?be!==null?be+"Capture":null:be;Ke=[];for(var ce=ye,ge;ce!==null;){var Ae=ce;if(ge=Ae.stateNode,Ae=Ae.tag,Ae!==5&&Ae!==26&&Ae!==27||ge===null||ue===null||(Ae=ss(ce,ue),Ae!=null&&Ke.push(vu(ce,Ae,ge))),Pt)break;ce=ce.return}0<Ke.length&&(be=new xe(be,Ve,null,c,Te),De.push({event:be,listeners:Ke}))}}if((a&7)===0){e:{if(be=s==="mouseover"||s==="pointerover",xe=s==="mouseout"||s==="pointerout",be&&c!==Uc&&(Ve=c.relatedTarget||c.fromElement)&&(Es(Ve)||Ve[ws]))break e;if((xe||be)&&(be=Te.window===Te?Te:(be=Te.ownerDocument)?be.defaultView||be.parentWindow:window,xe?(Ve=c.relatedTarget||c.toElement,xe=ye,Ve=Ve?Es(Ve):null,Ve!==null&&(Pt=o(Ve),Ke=Ve.tag,Ve!==Pt||Ke!==5&&Ke!==27&&Ke!==6)&&(Ve=null)):(xe=null,Ve=ye),xe!==Ve)){if(Ke=qc,Ae="onMouseLeave",ue="onMouseEnter",ce="mouse",(s==="pointerout"||s==="pointerover")&&(Ke=ti,Ae="onPointerLeave",ue="onPointerEnter",ce="pointer"),Pt=xe==null?be:Sr(xe),ge=Ve==null?be:Sr(Ve),be=new Ke(Ae,ce+"leave",xe,c,Te),be.target=Pt,be.relatedTarget=ge,Ae=null,Es(Te)===ye&&(Ke=new Ke(ue,ce+"enter",Ve,c,Te),Ke.target=ge,Ke.relatedTarget=Pt,Ae=Ke),Pt=Ae,xe&&Ve)t:{for(Ke=vj,ue=xe,ce=Ve,ge=0,Ae=ue;Ae;Ae=Ke(Ae))ge++;Ae=0;for(var Ge=ce;Ge;Ge=Ke(Ge))Ae++;for(;0<ge-Ae;)ue=Ke(ue),ge--;for(;0<Ae-ge;)ce=Ke(ce),Ae--;for(;ge--;){if(ue===ce||ce!==null&&ue===ce.alternate){Ke=ue;break t}ue=Ke(ue),ce=Ke(ce)}Ke=null}else Ke=null;xe!==null&&rx(De,be,xe,Ke,!1),Ve!==null&&Pt!==null&&rx(De,Pt,Ve,Ke,!0)}}e:{if(be=ye?Sr(ye):window,xe=be.nodeName&&be.nodeName.toLowerCase(),xe==="select"||xe==="input"&&be.type==="file")var wt=v_;else if(__(be))if(x_)wt=DA;else{wt=RA;var $e=jA}else xe=be.nodeName,!xe||xe.toLowerCase()!=="input"||be.type!=="checkbox"&&be.type!=="radio"?ye&&al(ye.elementType)&&(wt=v_):wt=IA;if(wt&&(wt=wt(s,ye))){b_(De,wt,c,Te);break e}$e&&$e(s,be,ye),s==="focusout"&&ye&&be.type==="number"&&ye.memoizedProps.value!=null&&Bc(be,"number",be.value)}switch($e=ye?Sr(ye):window,s){case"focusin":(__($e)||$e.contentEditable==="true")&&(ml=$e,Fm=ye,Kc=null);break;case"focusout":Kc=Fm=ml=null;break;case"mousedown":Vm=!0;break;case"contextmenu":case"mouseup":case"dragend":Vm=!1,R_(De,c,Te);break;case"selectionchange":if(MA)break;case"keydown":case"keyup":R_(De,c,Te)}var lt;if(Ct)e:{switch(s){case"compositionstart":var mt="onCompositionStart";break e;case"compositionend":mt="onCompositionEnd";break e;case"compositionupdate":mt="onCompositionUpdate";break e}mt=void 0}else fl?ho(s,c)&&(mt="onCompositionEnd"):s==="keydown"&&c.keyCode===229&&(mt="onCompositionStart");mt&&(Os&&c.locale!=="ko"&&(fl||mt!=="onCompositionStart"?mt==="onCompositionEnd"&&fl&&(lt=Vc()):(Is=Te,Fc="value"in Is?Is.value:Is.textContent,fl=!0)),$e=Oh(ye,mt),0<$e.length&&(mt=new Ms(mt,s,null,c,Te),De.push({event:mt,listeners:$e}),lt?mt.data=lt:(lt=hl(c),lt!==null&&(mt.data=lt)))),(lt=Fr?EA(s,c):CA(s,c))&&(mt=Oh(ye,"onBeforeInput"),0<mt.length&&($e=new Ms("onBeforeInput","beforeinput",null,c,Te),De.push({event:$e,listeners:mt}),$e.data=lt)),gj(De,s,ye,c,Te)}tx(De,a)})}function vu(s,a,c){return{instance:s,listener:a,currentTarget:c}}function Oh(s,a){for(var c=a+"Capture",m=[];s!==null;){var v=s,E=v.stateNode;if(v=v.tag,v!==5&&v!==26&&v!==27||E===null||(v=ss(s,c),v!=null&&m.unshift(vu(s,v,E)),v=ss(s,a),v!=null&&m.push(vu(s,v,E))),s.tag===3)return m;s=s.return}return[]}function vj(s){if(s===null)return null;do s=s.return;while(s&&s.tag!==5&&s.tag!==27);return s||null}function rx(s,a,c,m,v){for(var E=a._reactName,z=[];c!==null&&c!==m;){var W=c,re=W.alternate,ye=W.stateNode;if(W=W.tag,re!==null&&re===m)break;W!==5&&W!==26&&W!==27||ye===null||(re=ye,v?(ye=ss(c,E),ye!=null&&z.unshift(vu(c,ye,re))):v||(ye=ss(c,E),ye!=null&&z.push(vu(c,ye,re)))),c=c.return}z.length!==0&&s.push({event:a,listeners:z})}var xj=/\r\n?/g,wj=/\u0000|\uFFFD/g;function sx(s){return(typeof s=="string"?s:""+s).replace(xj,`
`).replace(wj,"")}function ix(s,a){return a=sx(a),sx(s)===a}function Nt(s,a,c,m,v,E){switch(c){case"children":typeof m=="string"?a==="body"||a==="textarea"&&m===""||hr(s,m):(typeof m=="number"||typeof m=="bigint")&&a!=="body"&&hr(s,""+m);break;case"className":Er(s,"class",m);break;case"tabIndex":Er(s,"tabindex",m);break;case"dir":case"role":case"viewBox":case"width":case"height":Er(s,c,m);break;case"style":Lc(s,m,E);break;case"data":if(a!=="object"){Er(s,"data",m);break}case"src":case"href":if(m===""&&(a!=="a"||c!=="href")){s.removeAttribute(c);break}if(m==null||typeof m=="function"||typeof m=="symbol"||typeof m=="boolean"){s.removeAttribute(c);break}m=ol(""+m),s.setAttribute(c,m);break;case"action":case"formAction":if(typeof m=="function"){s.setAttribute(c,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof E=="function"&&(c==="formAction"?(a!=="input"&&Nt(s,a,"name",v.name,v,null),Nt(s,a,"formEncType",v.formEncType,v,null),Nt(s,a,"formMethod",v.formMethod,v,null),Nt(s,a,"formTarget",v.formTarget,v,null)):(Nt(s,a,"encType",v.encType,v,null),Nt(s,a,"method",v.method,v,null),Nt(s,a,"target",v.target,v,null)));if(m==null||typeof m=="symbol"||typeof m=="boolean"){s.removeAttribute(c);break}m=ol(""+m),s.setAttribute(c,m);break;case"onClick":m!=null&&(s.onclick=rs);break;case"onScroll":m!=null&&dt("scroll",s);break;case"onScrollEnd":m!=null&&dt("scrollend",s);break;case"dangerouslySetInnerHTML":if(m!=null){if(typeof m!="object"||!("__html"in m))throw Error(r(61));if(c=m.__html,c!=null){if(v.children!=null)throw Error(r(60));s.innerHTML=c}}break;case"multiple":s.multiple=m&&typeof m!="function"&&typeof m!="symbol";break;case"muted":s.muted=m&&typeof m!="function"&&typeof m!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(m==null||typeof m=="function"||typeof m=="boolean"||typeof m=="symbol"){s.removeAttribute("xlink:href");break}c=ol(""+m),s.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",c);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":m!=null&&typeof m!="function"&&typeof m!="symbol"?s.setAttribute(c,""+m):s.removeAttribute(c);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":m&&typeof m!="function"&&typeof m!="symbol"?s.setAttribute(c,""):s.removeAttribute(c);break;case"capture":case"download":m===!0?s.setAttribute(c,""):m!==!1&&m!=null&&typeof m!="function"&&typeof m!="symbol"?s.setAttribute(c,m):s.removeAttribute(c);break;case"cols":case"rows":case"size":case"span":m!=null&&typeof m!="function"&&typeof m!="symbol"&&!isNaN(m)&&1<=m?s.setAttribute(c,m):s.removeAttribute(c);break;case"rowSpan":case"start":m==null||typeof m=="function"||typeof m=="symbol"||isNaN(m)?s.removeAttribute(c):s.setAttribute(c,m);break;case"popover":dt("beforetoggle",s),dt("toggle",s),sl(s,"popover",m);break;case"xlinkActuate":pn(s,"http://www.w3.org/1999/xlink","xlink:actuate",m);break;case"xlinkArcrole":pn(s,"http://www.w3.org/1999/xlink","xlink:arcrole",m);break;case"xlinkRole":pn(s,"http://www.w3.org/1999/xlink","xlink:role",m);break;case"xlinkShow":pn(s,"http://www.w3.org/1999/xlink","xlink:show",m);break;case"xlinkTitle":pn(s,"http://www.w3.org/1999/xlink","xlink:title",m);break;case"xlinkType":pn(s,"http://www.w3.org/1999/xlink","xlink:type",m);break;case"xmlBase":pn(s,"http://www.w3.org/XML/1998/namespace","xml:base",m);break;case"xmlLang":pn(s,"http://www.w3.org/XML/1998/namespace","xml:lang",m);break;case"xmlSpace":pn(s,"http://www.w3.org/XML/1998/namespace","xml:space",m);break;case"is":sl(s,"is",m);break;case"innerText":case"textContent":break;default:(!(2<c.length)||c[0]!=="o"&&c[0]!=="O"||c[1]!=="n"&&c[1]!=="N")&&(c=Od.get(c)||c,sl(s,c,m))}}function fg(s,a,c,m,v,E){switch(c){case"style":Lc(s,m,E);break;case"dangerouslySetInnerHTML":if(m!=null){if(typeof m!="object"||!("__html"in m))throw Error(r(61));if(c=m.__html,c!=null){if(v.children!=null)throw Error(r(60));s.innerHTML=c}}break;case"children":typeof m=="string"?hr(s,m):(typeof m=="number"||typeof m=="bigint")&&hr(s,""+m);break;case"onScroll":m!=null&&dt("scroll",s);break;case"onScrollEnd":m!=null&&dt("scrollend",s);break;case"onClick":m!=null&&(s.onclick=rs);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!kc.hasOwnProperty(c))e:{if(c[0]==="o"&&c[1]==="n"&&(v=c.endsWith("Capture"),a=c.slice(2,v?c.length-7:void 0),E=s[kn]||null,E=E!=null?E[c]:null,typeof E=="function"&&s.removeEventListener(a,E,v),typeof m=="function")){typeof E!="function"&&E!==null&&(c in s?s[c]=null:s.hasAttribute(c)&&s.removeAttribute(c)),s.addEventListener(a,m,v);break e}c in s?s[c]=m:m===!0?s.setAttribute(c,""):sl(s,c,m)}}}function Fn(s,a,c){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":dt("error",s),dt("load",s);var m=!1,v=!1,E;for(E in c)if(c.hasOwnProperty(E)){var z=c[E];if(z!=null)switch(E){case"src":m=!0;break;case"srcSet":v=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(r(137,a));default:Nt(s,a,E,z,c,null)}}v&&Nt(s,a,"srcSet",c.srcSet,c,null),m&&Nt(s,a,"src",c.src,c,null);return;case"input":dt("invalid",s);var W=E=z=v=null,re=null,ye=null;for(m in c)if(c.hasOwnProperty(m)){var Te=c[m];if(Te!=null)switch(m){case"name":v=Te;break;case"type":z=Te;break;case"checked":re=Te;break;case"defaultChecked":ye=Te;break;case"value":E=Te;break;case"defaultValue":W=Te;break;case"children":case"dangerouslySetInnerHTML":if(Te!=null)throw Error(r(137,a));break;default:Nt(s,a,m,Te,c,null)}}Dd(s,E,W,re,ye,z,v,!1);return;case"select":dt("invalid",s),m=z=E=null;for(v in c)if(c.hasOwnProperty(v)&&(W=c[v],W!=null))switch(v){case"value":E=W;break;case"defaultValue":z=W;break;case"multiple":m=W;default:Nt(s,a,v,W,c,null)}a=E,c=z,s.multiple=!!m,a!=null?Vi(s,!!m,a,!1):c!=null&&Vi(s,!!m,c,!0);return;case"textarea":dt("invalid",s),E=v=m=null;for(z in c)if(c.hasOwnProperty(z)&&(W=c[z],W!=null))switch(z){case"value":m=W;break;case"defaultValue":v=W;break;case"children":E=W;break;case"dangerouslySetInnerHTML":if(W!=null)throw Error(r(91));break;default:Nt(s,a,z,W,c,null)}$i(s,m,v,E);return;case"option":for(re in c)c.hasOwnProperty(re)&&(m=c[re],m!=null)&&(re==="selected"?s.selected=m&&typeof m!="function"&&typeof m!="symbol":Nt(s,a,re,m,c,null));return;case"dialog":dt("beforetoggle",s),dt("toggle",s),dt("cancel",s),dt("close",s);break;case"iframe":case"object":dt("load",s);break;case"video":case"audio":for(m=0;m<bu.length;m++)dt(bu[m],s);break;case"image":dt("error",s),dt("load",s);break;case"details":dt("toggle",s);break;case"embed":case"source":case"link":dt("error",s),dt("load",s);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(ye in c)if(c.hasOwnProperty(ye)&&(m=c[ye],m!=null))switch(ye){case"children":case"dangerouslySetInnerHTML":throw Error(r(137,a));default:Nt(s,a,ye,m,c,null)}return;default:if(al(a)){for(Te in c)c.hasOwnProperty(Te)&&(m=c[Te],m!==void 0&&fg(s,a,Te,m,c,void 0));return}}for(W in c)c.hasOwnProperty(W)&&(m=c[W],m!=null&&Nt(s,a,W,m,c,null))}function Sj(s,a,c,m){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var v=null,E=null,z=null,W=null,re=null,ye=null,Te=null;for(xe in c){var De=c[xe];if(c.hasOwnProperty(xe)&&De!=null)switch(xe){case"checked":break;case"value":break;case"defaultValue":re=De;default:m.hasOwnProperty(xe)||Nt(s,a,xe,null,m,De)}}for(var be in m){var xe=m[be];if(De=c[be],m.hasOwnProperty(be)&&(xe!=null||De!=null))switch(be){case"type":E=xe;break;case"name":v=xe;break;case"checked":ye=xe;break;case"defaultChecked":Te=xe;break;case"value":z=xe;break;case"defaultValue":W=xe;break;case"children":case"dangerouslySetInnerHTML":if(xe!=null)throw Error(r(137,a));break;default:xe!==De&&Nt(s,a,be,xe,m,De)}}il(s,z,W,re,ye,Te,E,v);return;case"select":xe=z=W=be=null;for(E in c)if(re=c[E],c.hasOwnProperty(E)&&re!=null)switch(E){case"value":break;case"multiple":xe=re;default:m.hasOwnProperty(E)||Nt(s,a,E,null,m,re)}for(v in m)if(E=m[v],re=c[v],m.hasOwnProperty(v)&&(E!=null||re!=null))switch(v){case"value":be=E;break;case"defaultValue":W=E;break;case"multiple":z=E;default:E!==re&&Nt(s,a,v,E,m,re)}a=W,c=z,m=xe,be!=null?Vi(s,!!c,be,!1):!!m!=!!c&&(a!=null?Vi(s,!!c,a,!0):Vi(s,!!c,c?[]:"",!1));return;case"textarea":xe=be=null;for(W in c)if(v=c[W],c.hasOwnProperty(W)&&v!=null&&!m.hasOwnProperty(W))switch(W){case"value":break;case"children":break;default:Nt(s,a,W,null,m,v)}for(z in m)if(v=m[z],E=c[z],m.hasOwnProperty(z)&&(v!=null||E!=null))switch(z){case"value":be=v;break;case"defaultValue":xe=v;break;case"children":break;case"dangerouslySetInnerHTML":if(v!=null)throw Error(r(91));break;default:v!==E&&Nt(s,a,z,v,m,E)}kd(s,be,xe);return;case"option":for(var Ve in c)be=c[Ve],c.hasOwnProperty(Ve)&&be!=null&&!m.hasOwnProperty(Ve)&&(Ve==="selected"?s.selected=!1:Nt(s,a,Ve,null,m,be));for(re in m)be=m[re],xe=c[re],m.hasOwnProperty(re)&&be!==xe&&(be!=null||xe!=null)&&(re==="selected"?s.selected=be&&typeof be!="function"&&typeof be!="symbol":Nt(s,a,re,be,m,xe));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Ke in c)be=c[Ke],c.hasOwnProperty(Ke)&&be!=null&&!m.hasOwnProperty(Ke)&&Nt(s,a,Ke,null,m,be);for(ye in m)if(be=m[ye],xe=c[ye],m.hasOwnProperty(ye)&&be!==xe&&(be!=null||xe!=null))switch(ye){case"children":case"dangerouslySetInnerHTML":if(be!=null)throw Error(r(137,a));break;default:Nt(s,a,ye,be,m,xe)}return;default:if(al(a)){for(var Pt in c)be=c[Pt],c.hasOwnProperty(Pt)&&be!==void 0&&!m.hasOwnProperty(Pt)&&fg(s,a,Pt,void 0,m,be);for(Te in m)be=m[Te],xe=c[Te],!m.hasOwnProperty(Te)||be===xe||be===void 0&&xe===void 0||fg(s,a,Te,be,m,xe);return}}for(var ue in c)be=c[ue],c.hasOwnProperty(ue)&&be!=null&&!m.hasOwnProperty(ue)&&Nt(s,a,ue,null,m,be);for(De in m)be=m[De],xe=c[De],!m.hasOwnProperty(De)||be===xe||be==null&&xe==null||Nt(s,a,De,be,m,xe)}function ax(s){switch(s){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function Ej(){if(typeof performance.getEntriesByType=="function"){for(var s=0,a=0,c=performance.getEntriesByType("resource"),m=0;m<c.length;m++){var v=c[m],E=v.transferSize,z=v.initiatorType,W=v.duration;if(E&&W&&ax(z)){for(z=0,W=v.responseEnd,m+=1;m<c.length;m++){var re=c[m],ye=re.startTime;if(ye>W)break;var Te=re.transferSize,De=re.initiatorType;Te&&ax(De)&&(re=re.responseEnd,z+=Te*(re<W?1:(W-ye)/(re-ye)))}if(--m,a+=8*(E+z)/(v.duration/1e3),s++,10<s)break}}if(0<s)return a/s/1e6}return navigator.connection&&(s=navigator.connection.downlink,typeof s=="number")?s:5}var mg=null,pg=null;function Nh(s){return s.nodeType===9?s:s.ownerDocument}function ox(s){switch(s){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function lx(s,a){if(s===0)switch(a){case"svg":return 1;case"math":return 2;default:return 0}return s===1&&a==="foreignObject"?0:s}function gg(s,a){return s==="textarea"||s==="noscript"||typeof a.children=="string"||typeof a.children=="number"||typeof a.children=="bigint"||typeof a.dangerouslySetInnerHTML=="object"&&a.dangerouslySetInnerHTML!==null&&a.dangerouslySetInnerHTML.__html!=null}var yg=null;function Cj(){var s=window.event;return s&&s.type==="popstate"?s===yg?!1:(yg=s,!0):(yg=null,!1)}var cx=typeof setTimeout=="function"?setTimeout:void 0,Tj=typeof clearTimeout=="function"?clearTimeout:void 0,ux=typeof Promise=="function"?Promise:void 0,Aj=typeof queueMicrotask=="function"?queueMicrotask:typeof ux<"u"?function(s){return ux.resolve(null).then(s).catch(jj)}:cx;function jj(s){setTimeout(function(){throw s})}function ha(s){return s==="head"}function dx(s,a){var c=a,m=0;do{var v=c.nextSibling;if(s.removeChild(c),v&&v.nodeType===8)if(c=v.data,c==="/$"||c==="/&"){if(m===0){s.removeChild(v),Fl(a);return}m--}else if(c==="$"||c==="$?"||c==="$~"||c==="$!"||c==="&")m++;else if(c==="html")xu(s.ownerDocument.documentElement);else if(c==="head"){c=s.ownerDocument.head,xu(c);for(var E=c.firstChild;E;){var z=E.nextSibling,W=E.nodeName;E[Ss]||W==="SCRIPT"||W==="STYLE"||W==="LINK"&&E.rel.toLowerCase()==="stylesheet"||c.removeChild(E),E=z}}else c==="body"&&xu(s.ownerDocument.body);c=v}while(c);Fl(a)}function hx(s,a){var c=s;s=0;do{var m=c.nextSibling;if(c.nodeType===1?a?(c._stashedDisplay=c.style.display,c.style.display="none"):(c.style.display=c._stashedDisplay||"",c.getAttribute("style")===""&&c.removeAttribute("style")):c.nodeType===3&&(a?(c._stashedText=c.nodeValue,c.nodeValue=""):c.nodeValue=c._stashedText||""),m&&m.nodeType===8)if(c=m.data,c==="/$"){if(s===0)break;s--}else c!=="$"&&c!=="$?"&&c!=="$~"&&c!=="$!"||s++;c=m}while(c)}function _g(s){var a=s.firstChild;for(a&&a.nodeType===10&&(a=a.nextSibling);a;){var c=a;switch(a=a.nextSibling,c.nodeName){case"HTML":case"HEAD":case"BODY":_g(c),rl(c);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(c.rel.toLowerCase()==="stylesheet")continue}s.removeChild(c)}}function Rj(s,a,c,m){for(;s.nodeType===1;){var v=c;if(s.nodeName.toLowerCase()!==a.toLowerCase()){if(!m&&(s.nodeName!=="INPUT"||s.type!=="hidden"))break}else if(m){if(!s[Ss])switch(a){case"meta":if(!s.hasAttribute("itemprop"))break;return s;case"link":if(E=s.getAttribute("rel"),E==="stylesheet"&&s.hasAttribute("data-precedence"))break;if(E!==v.rel||s.getAttribute("href")!==(v.href==null||v.href===""?null:v.href)||s.getAttribute("crossorigin")!==(v.crossOrigin==null?null:v.crossOrigin)||s.getAttribute("title")!==(v.title==null?null:v.title))break;return s;case"style":if(s.hasAttribute("data-precedence"))break;return s;case"script":if(E=s.getAttribute("src"),(E!==(v.src==null?null:v.src)||s.getAttribute("type")!==(v.type==null?null:v.type)||s.getAttribute("crossorigin")!==(v.crossOrigin==null?null:v.crossOrigin))&&E&&s.hasAttribute("async")&&!s.hasAttribute("itemprop"))break;return s;default:return s}}else if(a==="input"&&s.type==="hidden"){var E=v.name==null?null:""+v.name;if(v.type==="hidden"&&s.getAttribute("name")===E)return s}else return s;if(s=Qr(s.nextSibling),s===null)break}return null}function Ij(s,a,c){if(a==="")return null;for(;s.nodeType!==3;)if((s.nodeType!==1||s.nodeName!=="INPUT"||s.type!=="hidden")&&!c||(s=Qr(s.nextSibling),s===null))return null;return s}function fx(s,a){for(;s.nodeType!==8;)if((s.nodeType!==1||s.nodeName!=="INPUT"||s.type!=="hidden")&&!a||(s=Qr(s.nextSibling),s===null))return null;return s}function bg(s){return s.data==="$?"||s.data==="$~"}function vg(s){return s.data==="$!"||s.data==="$?"&&s.ownerDocument.readyState!=="loading"}function Dj(s,a){var c=s.ownerDocument;if(s.data==="$~")s._reactRetry=a;else if(s.data!=="$?"||c.readyState!=="loading")a();else{var m=function(){a(),c.removeEventListener("DOMContentLoaded",m)};c.addEventListener("DOMContentLoaded",m),s._reactRetry=m}}function Qr(s){for(;s!=null;s=s.nextSibling){var a=s.nodeType;if(a===1||a===3)break;if(a===8){if(a=s.data,a==="$"||a==="$!"||a==="$?"||a==="$~"||a==="&"||a==="F!"||a==="F")break;if(a==="/$"||a==="/&")return null}}return s}var xg=null;function mx(s){s=s.nextSibling;for(var a=0;s;){if(s.nodeType===8){var c=s.data;if(c==="/$"||c==="/&"){if(a===0)return Qr(s.nextSibling);a--}else c!=="$"&&c!=="$!"&&c!=="$?"&&c!=="$~"&&c!=="&"||a++}s=s.nextSibling}return null}function px(s){s=s.previousSibling;for(var a=0;s;){if(s.nodeType===8){var c=s.data;if(c==="$"||c==="$!"||c==="$?"||c==="$~"||c==="&"){if(a===0)return s;a--}else c!=="/$"&&c!=="/&"||a++}s=s.previousSibling}return null}function gx(s,a,c){switch(a=Nh(c),s){case"html":if(s=a.documentElement,!s)throw Error(r(452));return s;case"head":if(s=a.head,!s)throw Error(r(453));return s;case"body":if(s=a.body,!s)throw Error(r(454));return s;default:throw Error(r(451))}}function xu(s){for(var a=s.attributes;a.length;)s.removeAttributeNode(a[0]);rl(s)}var Kr=new Map,yx=new Set;function Ph(s){return typeof s.getRootNode=="function"?s.getRootNode():s.nodeType===9?s:s.ownerDocument}var gi=G.d;G.d={f:kj,r:Mj,D:Oj,C:Nj,L:Pj,m:Bj,X:Lj,S:zj,M:Uj};function kj(){var s=gi.f(),a=Ah();return s||a}function Mj(s){var a=zr(s);a!==null&&a.tag===5&&a.type==="form"?Ob(a):gi.r(s)}var zl=typeof document>"u"?null:document;function _x(s,a,c){var m=zl;if(m&&typeof a=="string"&&a){var v=dr(a);v='link[rel="'+s+'"][href="'+v+'"]',typeof c=="string"&&(v+='[crossorigin="'+c+'"]'),yx.has(v)||(yx.add(v),s={rel:s,crossOrigin:c,href:a},m.querySelector(v)===null&&(a=m.createElement("link"),Fn(a,"link",s),mn(a),m.head.appendChild(a)))}}function Oj(s){gi.D(s),_x("dns-prefetch",s,null)}function Nj(s,a){gi.C(s,a),_x("preconnect",s,a)}function Pj(s,a,c){gi.L(s,a,c);var m=zl;if(m&&s&&a){var v='link[rel="preload"][as="'+dr(a)+'"]';a==="image"&&c&&c.imageSrcSet?(v+='[imagesrcset="'+dr(c.imageSrcSet)+'"]',typeof c.imageSizes=="string"&&(v+='[imagesizes="'+dr(c.imageSizes)+'"]')):v+='[href="'+dr(s)+'"]';var E=v;switch(a){case"style":E=Ll(s);break;case"script":E=Ul(s)}Kr.has(E)||(s=g({rel:"preload",href:a==="image"&&c&&c.imageSrcSet?void 0:s,as:a},c),Kr.set(E,s),m.querySelector(v)!==null||a==="style"&&m.querySelector(wu(E))||a==="script"&&m.querySelector(Su(E))||(a=m.createElement("link"),Fn(a,"link",s),mn(a),m.head.appendChild(a)))}}function Bj(s,a){gi.m(s,a);var c=zl;if(c&&s){var m=a&&typeof a.as=="string"?a.as:"script",v='link[rel="modulepreload"][as="'+dr(m)+'"][href="'+dr(s)+'"]',E=v;switch(m){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":E=Ul(s)}if(!Kr.has(E)&&(s=g({rel:"modulepreload",href:s},a),Kr.set(E,s),c.querySelector(v)===null)){switch(m){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(c.querySelector(Su(E)))return}m=c.createElement("link"),Fn(m,"link",s),mn(m),c.head.appendChild(m)}}}function zj(s,a,c){gi.S(s,a,c);var m=zl;if(m&&s){var v=Cs(m).hoistableStyles,E=Ll(s);a=a||"default";var z=v.get(E);if(!z){var W={loading:0,preload:null};if(z=m.querySelector(wu(E)))W.loading=5;else{s=g({rel:"stylesheet",href:s,"data-precedence":a},c),(c=Kr.get(E))&&wg(s,c);var re=z=m.createElement("link");mn(re),Fn(re,"link",s),re._p=new Promise(function(ye,Te){re.onload=ye,re.onerror=Te}),re.addEventListener("load",function(){W.loading|=1}),re.addEventListener("error",function(){W.loading|=2}),W.loading|=4,Bh(z,a,m)}z={type:"stylesheet",instance:z,count:1,state:W},v.set(E,z)}}}function Lj(s,a){gi.X(s,a);var c=zl;if(c&&s){var m=Cs(c).hoistableScripts,v=Ul(s),E=m.get(v);E||(E=c.querySelector(Su(v)),E||(s=g({src:s,async:!0},a),(a=Kr.get(v))&&Sg(s,a),E=c.createElement("script"),mn(E),Fn(E,"link",s),c.head.appendChild(E)),E={type:"script",instance:E,count:1,state:null},m.set(v,E))}}function Uj(s,a){gi.M(s,a);var c=zl;if(c&&s){var m=Cs(c).hoistableScripts,v=Ul(s),E=m.get(v);E||(E=c.querySelector(Su(v)),E||(s=g({src:s,async:!0,type:"module"},a),(a=Kr.get(v))&&Sg(s,a),E=c.createElement("script"),mn(E),Fn(E,"link",s),c.head.appendChild(E)),E={type:"script",instance:E,count:1,state:null},m.set(v,E))}}function bx(s,a,c,m){var v=(v=he.current)?Ph(v):null;if(!v)throw Error(r(446));switch(s){case"meta":case"title":return null;case"style":return typeof c.precedence=="string"&&typeof c.href=="string"?(a=Ll(c.href),c=Cs(v).hoistableStyles,m=c.get(a),m||(m={type:"style",instance:null,count:0,state:null},c.set(a,m)),m):{type:"void",instance:null,count:0,state:null};case"link":if(c.rel==="stylesheet"&&typeof c.href=="string"&&typeof c.precedence=="string"){s=Ll(c.href);var E=Cs(v).hoistableStyles,z=E.get(s);if(z||(v=v.ownerDocument||v,z={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},E.set(s,z),(E=v.querySelector(wu(s)))&&!E._p&&(z.instance=E,z.state.loading=5),Kr.has(s)||(c={rel:"preload",as:"style",href:c.href,crossOrigin:c.crossOrigin,integrity:c.integrity,media:c.media,hrefLang:c.hrefLang,referrerPolicy:c.referrerPolicy},Kr.set(s,c),E||Fj(v,s,c,z.state))),a&&m===null)throw Error(r(528,""));return z}if(a&&m!==null)throw Error(r(529,""));return null;case"script":return a=c.async,c=c.src,typeof c=="string"&&a&&typeof a!="function"&&typeof a!="symbol"?(a=Ul(c),c=Cs(v).hoistableScripts,m=c.get(a),m||(m={type:"script",instance:null,count:0,state:null},c.set(a,m)),m):{type:"void",instance:null,count:0,state:null};default:throw Error(r(444,s))}}function Ll(s){return'href="'+dr(s)+'"'}function wu(s){return'link[rel="stylesheet"]['+s+"]"}function vx(s){return g({},s,{"data-precedence":s.precedence,precedence:null})}function Fj(s,a,c,m){s.querySelector('link[rel="preload"][as="style"]['+a+"]")?m.loading=1:(a=s.createElement("link"),m.preload=a,a.addEventListener("load",function(){return m.loading|=1}),a.addEventListener("error",function(){return m.loading|=2}),Fn(a,"link",c),mn(a),s.head.appendChild(a))}function Ul(s){return'[src="'+dr(s)+'"]'}function Su(s){return"script[async]"+s}function xx(s,a,c){if(a.count++,a.instance===null)switch(a.type){case"style":var m=s.querySelector('style[data-href~="'+dr(c.href)+'"]');if(m)return a.instance=m,mn(m),m;var v=g({},c,{"data-href":c.href,"data-precedence":c.precedence,href:null,precedence:null});return m=(s.ownerDocument||s).createElement("style"),mn(m),Fn(m,"style",v),Bh(m,c.precedence,s),a.instance=m;case"stylesheet":v=Ll(c.href);var E=s.querySelector(wu(v));if(E)return a.state.loading|=4,a.instance=E,mn(E),E;m=vx(c),(v=Kr.get(v))&&wg(m,v),E=(s.ownerDocument||s).createElement("link"),mn(E);var z=E;return z._p=new Promise(function(W,re){z.onload=W,z.onerror=re}),Fn(E,"link",m),a.state.loading|=4,Bh(E,c.precedence,s),a.instance=E;case"script":return E=Ul(c.src),(v=s.querySelector(Su(E)))?(a.instance=v,mn(v),v):(m=c,(v=Kr.get(E))&&(m=g({},c),Sg(m,v)),s=s.ownerDocument||s,v=s.createElement("script"),mn(v),Fn(v,"link",m),s.head.appendChild(v),a.instance=v);case"void":return null;default:throw Error(r(443,a.type))}else a.type==="stylesheet"&&(a.state.loading&4)===0&&(m=a.instance,a.state.loading|=4,Bh(m,c.precedence,s));return a.instance}function Bh(s,a,c){for(var m=c.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),v=m.length?m[m.length-1]:null,E=v,z=0;z<m.length;z++){var W=m[z];if(W.dataset.precedence===a)E=W;else if(E!==v)break}E?E.parentNode.insertBefore(s,E.nextSibling):(a=c.nodeType===9?c.head:c,a.insertBefore(s,a.firstChild))}function wg(s,a){s.crossOrigin==null&&(s.crossOrigin=a.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=a.referrerPolicy),s.title==null&&(s.title=a.title)}function Sg(s,a){s.crossOrigin==null&&(s.crossOrigin=a.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=a.referrerPolicy),s.integrity==null&&(s.integrity=a.integrity)}var zh=null;function wx(s,a,c){if(zh===null){var m=new Map,v=zh=new Map;v.set(c,m)}else v=zh,m=v.get(c),m||(m=new Map,v.set(c,m));if(m.has(s))return m;for(m.set(s,null),c=c.getElementsByTagName(s),v=0;v<c.length;v++){var E=c[v];if(!(E[Ss]||E[fn]||s==="link"&&E.getAttribute("rel")==="stylesheet")&&E.namespaceURI!=="http://www.w3.org/2000/svg"){var z=E.getAttribute(a)||"";z=s+z;var W=m.get(z);W?W.push(E):m.set(z,[E])}}return m}function Sx(s,a,c){s=s.ownerDocument||s,s.head.insertBefore(c,a==="title"?s.querySelector("head > title"):null)}function Vj(s,a,c){if(c===1||a.itemProp!=null)return!1;switch(s){case"meta":case"title":return!0;case"style":if(typeof a.precedence!="string"||typeof a.href!="string"||a.href==="")break;return!0;case"link":if(typeof a.rel!="string"||typeof a.href!="string"||a.href===""||a.onLoad||a.onError)break;return a.rel==="stylesheet"?(s=a.disabled,typeof a.precedence=="string"&&s==null):!0;case"script":if(a.async&&typeof a.async!="function"&&typeof a.async!="symbol"&&!a.onLoad&&!a.onError&&a.src&&typeof a.src=="string")return!0}return!1}function Ex(s){return!(s.type==="stylesheet"&&(s.state.loading&3)===0)}function $j(s,a,c,m){if(c.type==="stylesheet"&&(typeof m.media!="string"||matchMedia(m.media).matches!==!1)&&(c.state.loading&4)===0){if(c.instance===null){var v=Ll(m.href),E=a.querySelector(wu(v));if(E){a=E._p,a!==null&&typeof a=="object"&&typeof a.then=="function"&&(s.count++,s=Lh.bind(s),a.then(s,s)),c.state.loading|=4,c.instance=E,mn(E);return}E=a.ownerDocument||a,m=vx(m),(v=Kr.get(v))&&wg(m,v),E=E.createElement("link"),mn(E);var z=E;z._p=new Promise(function(W,re){z.onload=W,z.onerror=re}),Fn(E,"link",m),c.instance=E}s.stylesheets===null&&(s.stylesheets=new Map),s.stylesheets.set(c,a),(a=c.state.preload)&&(c.state.loading&3)===0&&(s.count++,c=Lh.bind(s),a.addEventListener("load",c),a.addEventListener("error",c))}}var Eg=0;function qj(s,a){return s.stylesheets&&s.count===0&&Fh(s,s.stylesheets),0<s.count||0<s.imgCount?function(c){var m=setTimeout(function(){if(s.stylesheets&&Fh(s,s.stylesheets),s.unsuspend){var E=s.unsuspend;s.unsuspend=null,E()}},6e4+a);0<s.imgBytes&&Eg===0&&(Eg=62500*Ej());var v=setTimeout(function(){if(s.waitingForImages=!1,s.count===0&&(s.stylesheets&&Fh(s,s.stylesheets),s.unsuspend)){var E=s.unsuspend;s.unsuspend=null,E()}},(s.imgBytes>Eg?50:800)+a);return s.unsuspend=c,function(){s.unsuspend=null,clearTimeout(m),clearTimeout(v)}}:null}function Lh(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)Fh(this,this.stylesheets);else if(this.unsuspend){var s=this.unsuspend;this.unsuspend=null,s()}}}var Uh=null;function Fh(s,a){s.stylesheets=null,s.unsuspend!==null&&(s.count++,Uh=new Map,a.forEach(Hj,s),Uh=null,Lh.call(s))}function Hj(s,a){if(!(a.state.loading&4)){var c=Uh.get(s);if(c)var m=c.get(null);else{c=new Map,Uh.set(s,c);for(var v=s.querySelectorAll("link[data-precedence],style[data-precedence]"),E=0;E<v.length;E++){var z=v[E];(z.nodeName==="LINK"||z.getAttribute("media")!=="not all")&&(c.set(z.dataset.precedence,z),m=z)}m&&c.set(null,m)}v=a.instance,z=v.getAttribute("data-precedence"),E=c.get(z)||m,E===m&&c.set(null,v),c.set(z,v),this.count++,m=Lh.bind(this),v.addEventListener("load",m),v.addEventListener("error",m),E?E.parentNode.insertBefore(v,E.nextSibling):(s=s.nodeType===9?s.head:s,s.insertBefore(v,s.firstChild)),a.state.loading|=4}}var Eu={$$typeof:I,Provider:null,Consumer:null,_currentValue:te,_currentValue2:te,_threadCount:0};function Gj(s,a,c,m,v,E,z,W,re){this.tag=1,this.containerInfo=s,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=xs(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=xs(0),this.hiddenUpdates=xs(null),this.identifierPrefix=m,this.onUncaughtError=v,this.onCaughtError=E,this.onRecoverableError=z,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=re,this.incompleteTransitions=new Map}function Cx(s,a,c,m,v,E,z,W,re,ye,Te,De){return s=new Gj(s,a,c,z,re,ye,Te,De,W),a=1,E===!0&&(a|=24),E=Tr(3,null,null,a),s.current=E,E.stateNode=s,a=rp(),a.refCount++,s.pooledCache=a,a.refCount++,E.memoizedState={element:m,isDehydrated:c,cache:a},op(E),s}function Tx(s){return s?(s=yl,s):yl}function Ax(s,a,c,m,v,E){v=Tx(v),m.context===null?m.context=v:m.pendingContext=v,m=ta(a),m.payload={element:c},E=E===void 0?null:E,E!==null&&(m.callback=E),c=na(s,m,a),c!==null&&(yr(c,s,a),nu(c,s,a))}function jx(s,a){if(s=s.memoizedState,s!==null&&s.dehydrated!==null){var c=s.retryLane;s.retryLane=c!==0&&c<a?c:a}}function Cg(s,a){jx(s,a),(s=s.alternate)&&jx(s,a)}function Rx(s){if(s.tag===13||s.tag===31){var a=po(s,67108864);a!==null&&yr(a,s,67108864),Cg(s,67108864)}}function Ix(s){if(s.tag===13||s.tag===31){var a=Dr();a=no(a);var c=po(s,a);c!==null&&yr(c,s,a),Cg(s,a)}}var Vh=!0;function Wj(s,a,c,m){var v=X.T;X.T=null;var E=G.p;try{G.p=2,Tg(s,a,c,m)}finally{G.p=E,X.T=v}}function Qj(s,a,c,m){var v=X.T;X.T=null;var E=G.p;try{G.p=8,Tg(s,a,c,m)}finally{G.p=E,X.T=v}}function Tg(s,a,c,m){if(Vh){var v=Ag(m);if(v===null)hg(s,a,m,$h,c),kx(s,m);else if(Yj(v,s,a,c,m))m.stopPropagation();else if(kx(s,m),a&4&&-1<Kj.indexOf(s)){for(;v!==null;){var E=zr(v);if(E!==null)switch(E.tag){case 3:if(E=E.stateNode,E.current.memoizedState.isDehydrated){var z=sr(E.pendingLanes);if(z!==0){var W=E;for(W.pendingLanes|=2,W.entangledLanes|=2;z;){var re=1<<31-Et(z);W.entanglements[1]|=re,z&=~re}zs(E),(Tt&6)===0&&(Ch=Pe()+500,_u(0))}}break;case 31:case 13:W=po(E,2),W!==null&&yr(W,E,2),Ah(),Cg(E,2)}if(E=Ag(m),E===null&&hg(s,a,m,$h,c),E===v)break;v=E}v!==null&&m.stopPropagation()}else hg(s,a,m,null,c)}}function Ag(s){return s=Lr(s),jg(s)}var $h=null;function jg(s){if($h=null,s=Es(s),s!==null){var a=o(s);if(a===null)s=null;else{var c=a.tag;if(c===13){if(s=l(a),s!==null)return s;s=null}else if(c===31){if(s=u(a),s!==null)return s;s=null}else if(c===3){if(a.stateNode.current.memoizedState.isDehydrated)return a.tag===3?a.stateNode.containerInfo:null;s=null}else a!==s&&(s=null)}}return $h=s,null}function Dx(s){switch(s){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Oe()){case He:return 2;case xt:return 8;case it:case Wn:return 32;case ys:return 268435456;default:return 32}default:return 32}}var Rg=!1,fa=null,ma=null,pa=null,Cu=new Map,Tu=new Map,ga=[],Kj="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function kx(s,a){switch(s){case"focusin":case"focusout":fa=null;break;case"dragenter":case"dragleave":ma=null;break;case"mouseover":case"mouseout":pa=null;break;case"pointerover":case"pointerout":Cu.delete(a.pointerId);break;case"gotpointercapture":case"lostpointercapture":Tu.delete(a.pointerId)}}function Au(s,a,c,m,v,E){return s===null||s.nativeEvent!==E?(s={blockedOn:a,domEventName:c,eventSystemFlags:m,nativeEvent:E,targetContainers:[v]},a!==null&&(a=zr(a),a!==null&&Rx(a)),s):(s.eventSystemFlags|=m,a=s.targetContainers,v!==null&&a.indexOf(v)===-1&&a.push(v),s)}function Yj(s,a,c,m,v){switch(a){case"focusin":return fa=Au(fa,s,a,c,m,v),!0;case"dragenter":return ma=Au(ma,s,a,c,m,v),!0;case"mouseover":return pa=Au(pa,s,a,c,m,v),!0;case"pointerover":var E=v.pointerId;return Cu.set(E,Au(Cu.get(E)||null,s,a,c,m,v)),!0;case"gotpointercapture":return E=v.pointerId,Tu.set(E,Au(Tu.get(E)||null,s,a,c,m,v)),!0}return!1}function Mx(s){var a=Es(s.target);if(a!==null){var c=o(a);if(c!==null){if(a=c.tag,a===13){if(a=l(c),a!==null){s.blockedOn=a,ts(s.priority,function(){Ix(c)});return}}else if(a===31){if(a=u(c),a!==null){s.blockedOn=a,ts(s.priority,function(){Ix(c)});return}}else if(a===3&&c.stateNode.current.memoizedState.isDehydrated){s.blockedOn=c.tag===3?c.stateNode.containerInfo:null;return}}}s.blockedOn=null}function qh(s){if(s.blockedOn!==null)return!1;for(var a=s.targetContainers;0<a.length;){var c=Ag(s.nativeEvent);if(c===null){c=s.nativeEvent;var m=new c.constructor(c.type,c);Uc=m,c.target.dispatchEvent(m),Uc=null}else return a=zr(c),a!==null&&Rx(a),s.blockedOn=c,!1;a.shift()}return!0}function Ox(s,a,c){qh(s)&&c.delete(a)}function Xj(){Rg=!1,fa!==null&&qh(fa)&&(fa=null),ma!==null&&qh(ma)&&(ma=null),pa!==null&&qh(pa)&&(pa=null),Cu.forEach(Ox),Tu.forEach(Ox)}function Hh(s,a){s.blockedOn===a&&(s.blockedOn=null,Rg||(Rg=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,Xj)))}var Gh=null;function Nx(s){Gh!==s&&(Gh=s,t.unstable_scheduleCallback(t.unstable_NormalPriority,function(){Gh===s&&(Gh=null);for(var a=0;a<s.length;a+=3){var c=s[a],m=s[a+1],v=s[a+2];if(typeof m!="function"){if(jg(m||c)===null)continue;break}var E=zr(c);E!==null&&(s.splice(a,3),a-=3,Ap(E,{pending:!0,data:v,method:c.method,action:m},m,v))}}))}function Fl(s){function a(re){return Hh(re,s)}fa!==null&&Hh(fa,s),ma!==null&&Hh(ma,s),pa!==null&&Hh(pa,s),Cu.forEach(a),Tu.forEach(a);for(var c=0;c<ga.length;c++){var m=ga[c];m.blockedOn===s&&(m.blockedOn=null)}for(;0<ga.length&&(c=ga[0],c.blockedOn===null);)Mx(c),c.blockedOn===null&&ga.shift();if(c=(s.ownerDocument||s).$$reactFormReplay,c!=null)for(m=0;m<c.length;m+=3){var v=c[m],E=c[m+1],z=v[kn]||null;if(typeof E=="function")z||Nx(c);else if(z){var W=null;if(E&&E.hasAttribute("formAction")){if(v=E,z=E[kn]||null)W=z.formAction;else if(jg(v)!==null)continue}else W=z.action;typeof W=="function"?c[m+1]=W:(c.splice(m,3),m-=3),Nx(c)}}}function Px(){function s(E){E.canIntercept&&E.info==="react-transition"&&E.intercept({handler:function(){return new Promise(function(z){return v=z})},focusReset:"manual",scroll:"manual"})}function a(){v!==null&&(v(),v=null),m||setTimeout(c,20)}function c(){if(!m&&!navigation.transition){var E=navigation.currentEntry;E&&E.url!=null&&navigation.navigate(E.url,{state:E.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var m=!1,v=null;return navigation.addEventListener("navigate",s),navigation.addEventListener("navigatesuccess",a),navigation.addEventListener("navigateerror",a),setTimeout(c,100),function(){m=!0,navigation.removeEventListener("navigate",s),navigation.removeEventListener("navigatesuccess",a),navigation.removeEventListener("navigateerror",a),v!==null&&(v(),v=null)}}}function Ig(s){this._internalRoot=s}Wh.prototype.render=Ig.prototype.render=function(s){var a=this._internalRoot;if(a===null)throw Error(r(409));var c=a.current,m=Dr();Ax(c,m,s,a,null,null)},Wh.prototype.unmount=Ig.prototype.unmount=function(){var s=this._internalRoot;if(s!==null){this._internalRoot=null;var a=s.containerInfo;Ax(s.current,2,null,s,null,null),Ah(),a[ws]=null}};function Wh(s){this._internalRoot=s}Wh.prototype.unstable_scheduleHydration=function(s){if(s){var a=Ad();s={blockedOn:null,target:s,priority:a};for(var c=0;c<ga.length&&a!==0&&a<ga[c].priority;c++);ga.splice(c,0,s),c===0&&Mx(s)}};var Bx=e.version;if(Bx!=="19.2.3")throw Error(r(527,Bx,"19.2.3"));G.findDOMNode=function(s){var a=s._reactInternals;if(a===void 0)throw typeof s.render=="function"?Error(r(188)):(s=Object.keys(s).join(","),Error(r(268,s)));return s=f(a),s=s!==null?p(s):null,s=s===null?null:s.stateNode,s};var Zj={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:X,reconcilerVersion:"19.2.3"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Qh=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Qh.isDisabled&&Qh.supportsFiber)try{vt=Qh.inject(Zj),nn=Qh}catch{}}return Ru.createRoot=function(s,a){if(!i(s))throw Error(r(299));var c=!1,m="",v=qb,E=Hb,z=Gb;return a!=null&&(a.unstable_strictMode===!0&&(c=!0),a.identifierPrefix!==void 0&&(m=a.identifierPrefix),a.onUncaughtError!==void 0&&(v=a.onUncaughtError),a.onCaughtError!==void 0&&(E=a.onCaughtError),a.onRecoverableError!==void 0&&(z=a.onRecoverableError)),a=Cx(s,1,!1,null,null,c,m,null,v,E,z,Px),s[ws]=a.current,dg(s),new Ig(a)},Ru.hydrateRoot=function(s,a,c){if(!i(s))throw Error(r(299));var m=!1,v="",E=qb,z=Hb,W=Gb,re=null;return c!=null&&(c.unstable_strictMode===!0&&(m=!0),c.identifierPrefix!==void 0&&(v=c.identifierPrefix),c.onUncaughtError!==void 0&&(E=c.onUncaughtError),c.onCaughtError!==void 0&&(z=c.onCaughtError),c.onRecoverableError!==void 0&&(W=c.onRecoverableError),c.formState!==void 0&&(re=c.formState)),a=Cx(s,1,!0,a,c??null,m,v,re,E,z,W,Px),a.context=Tx(null),c=a.current,m=Dr(),m=no(m),v=ta(m),v.callback=null,na(c,v,m),c=m,a.current.lanes=c,eo(a,c),zs(a),s[ws]=a.current,dg(s),new Wh(a)},Ru.version="19.2.3",Ru}var Wx;function cR(){if(Wx)return Mg.exports;Wx=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),Mg.exports=lR(),Mg.exports}var uR=cR();var Qx="popstate";function dR(t={}){function e(r,i){let{pathname:o,search:l,hash:u}=r.location;return ly("",{pathname:o,search:l,hash:u},i.state&&i.state.usr||null,i.state&&i.state.key||"default")}function n(r,i){return typeof i=="string"?i:Hu(i)}return fR(e,n,null,t)}function en(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function Or(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function hR(){return Math.random().toString(36).substring(2,10)}function Kx(t,e){return{usr:t.state,key:t.key,idx:e}}function ly(t,e,n=null,r){return{pathname:typeof t=="string"?t:t.pathname,search:"",hash:"",...typeof e=="string"?hc(e):e,state:n,key:e&&e.key||r||hR()}}function Hu({pathname:t="/",search:e="",hash:n=""}){return e&&e!=="?"&&(t+=e.charAt(0)==="?"?e:"?"+e),n&&n!=="#"&&(t+=n.charAt(0)==="#"?n:"#"+n),t}function hc(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substring(n),t=t.substring(0,n));let r=t.indexOf("?");r>=0&&(e.search=t.substring(r),t=t.substring(0,r)),t&&(e.pathname=t)}return e}function fR(t,e,n,r={}){let{window:i=document.defaultView,v5Compat:o=!1}=r,l=i.history,u="POP",h=null,f=p();f==null&&(f=0,l.replaceState({...l.state,idx:f},""));function p(){return(l.state||{idx:null}).idx}function g(){u="POP";let S=p(),C=S==null?null:S-f;f=S,h&&h({action:u,location:x.location,delta:C})}function b(S,C){u="PUSH";let T=ly(x.location,S,C);f=p()+1;let I=Kx(T,f),M=x.createHref(T);try{l.pushState(I,"",M)}catch(U){if(U instanceof DOMException&&U.name==="DataCloneError")throw U;i.location.assign(M)}o&&h&&h({action:u,location:x.location,delta:1})}function _(S,C){u="REPLACE";let T=ly(x.location,S,C);f=p();let I=Kx(T,f),M=x.createHref(T);l.replaceState(I,"",M),o&&h&&h({action:u,location:x.location,delta:0})}function w(S){return mR(S)}let x={get action(){return u},get location(){return t(i,l)},listen(S){if(h)throw new Error("A history only accepts one active listener");return i.addEventListener(Qx,g),h=S,()=>{i.removeEventListener(Qx,g),h=null}},createHref(S){return e(i,S)},createURL:w,encodeLocation(S){let C=w(S);return{pathname:C.pathname,search:C.search,hash:C.hash}},push:b,replace:_,go(S){return l.go(S)}};return x}function mR(t,e=!1){let n="http://localhost";typeof window<"u"&&(n=window.location.origin!=="null"?window.location.origin:window.location.href),en(n,"No window.location.(origin|href) available to create URL");let r=typeof t=="string"?t:Hu(t);return r=r.replace(/ $/,"%20"),!e&&r.startsWith("//")&&(r=n+r),new URL(r,n)}function E1(t,e,n="/"){return pR(t,e,n,!1)}function pR(t,e,n,r){let i=typeof e=="string"?hc(e):e,o=ji(i.pathname||"/",n);if(o==null)return null;let l=C1(t);gR(l);let u=null;for(let h=0;u==null&&h<l.length;++h){let f=AR(o);u=CR(l[h],f,r)}return u}function C1(t,e=[],n=[],r="",i=!1){let o=(l,u,h=i,f)=>{let p={relativePath:f===void 0?l.path||"":f,caseSensitive:l.caseSensitive===!0,childrenIndex:u,route:l};if(p.relativePath.startsWith("/")){if(!p.relativePath.startsWith(r)&&h)return;en(p.relativePath.startsWith(r),`Absolute route path "${p.relativePath}" nested under path "${r}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),p.relativePath=p.relativePath.slice(r.length)}let g=Ci([r,p.relativePath]),b=n.concat(p);l.children&&l.children.length>0&&(en(l.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${g}".`),C1(l.children,e,b,g,h)),!(l.path==null&&!l.index)&&e.push({path:g,score:SR(g,l.index),routesMeta:b})};return t.forEach((l,u)=>{if(l.path===""||!l.path?.includes("?"))o(l,u);else for(let h of T1(l.path))o(l,u,!0,h)}),e}function T1(t){let e=t.split("/");if(e.length===0)return[];let[n,...r]=e,i=n.endsWith("?"),o=n.replace(/\?$/,"");if(r.length===0)return i?[o,""]:[o];let l=T1(r.join("/")),u=[];return u.push(...l.map(h=>h===""?o:[o,h].join("/"))),i&&u.push(...l),u.map(h=>t.startsWith("/")&&h===""?"/":h)}function gR(t){t.sort((e,n)=>e.score!==n.score?n.score-e.score:ER(e.routesMeta.map(r=>r.childrenIndex),n.routesMeta.map(r=>r.childrenIndex)))}var yR=/^:[\w-]+$/,_R=3,bR=2,vR=1,xR=10,wR=-2,Yx=t=>t==="*";function SR(t,e){let n=t.split("/"),r=n.length;return n.some(Yx)&&(r+=wR),e&&(r+=bR),n.filter(i=>!Yx(i)).reduce((i,o)=>i+(yR.test(o)?_R:o===""?vR:xR),r)}function ER(t,e){return t.length===e.length&&t.slice(0,-1).every((r,i)=>r===e[i])?t[t.length-1]-e[e.length-1]:0}function CR(t,e,n=!1){let{routesMeta:r}=t,i={},o="/",l=[];for(let u=0;u<r.length;++u){let h=r[u],f=u===r.length-1,p=o==="/"?e:e.slice(o.length)||"/",g=bf({path:h.relativePath,caseSensitive:h.caseSensitive,end:f},p),b=h.route;if(!g&&f&&n&&!r[r.length-1].route.index&&(g=bf({path:h.relativePath,caseSensitive:h.caseSensitive,end:!1},p)),!g)return null;Object.assign(i,g.params),l.push({params:i,pathname:Ci([o,g.pathname]),pathnameBase:DR(Ci([o,g.pathnameBase])),route:b}),g.pathnameBase!=="/"&&(o=Ci([o,g.pathnameBase]))}return l}function bf(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,r]=TR(t.path,t.caseSensitive,t.end),i=e.match(n);if(!i)return null;let o=i[0],l=o.replace(/(.)\/+$/,"$1"),u=i.slice(1);return{params:r.reduce((f,{paramName:p,isOptional:g},b)=>{if(p==="*"){let w=u[b]||"";l=o.slice(0,o.length-w.length).replace(/(.)\/+$/,"$1")}const _=u[b];return g&&!_?f[p]=void 0:f[p]=(_||"").replace(/%2F/g,"/"),f},{}),pathname:o,pathnameBase:l,pattern:t}}function TR(t,e=!1,n=!0){Or(t==="*"||!t.endsWith("*")||t.endsWith("/*"),`Route path "${t}" will be treated as if it were "${t.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${t.replace(/\*$/,"/*")}".`);let r=[],i="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(l,u,h)=>(r.push({paramName:u,isOptional:h!=null}),h?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return t.endsWith("*")?(r.push({paramName:"*"}),i+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?i+="\\/*$":t!==""&&t!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,e?void 0:"i"),r]}function AR(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return Or(!1,`The URL path "${t}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),t}}function ji(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,r=t.charAt(n);return r&&r!=="/"?null:t.slice(n)||"/"}var A1=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,jR=t=>A1.test(t);function RR(t,e="/"){let{pathname:n,search:r="",hash:i=""}=typeof t=="string"?hc(t):t,o;if(n)if(jR(n))o=n;else{if(n.includes("//")){let l=n;n=n.replace(/\/\/+/g,"/"),Or(!1,`Pathnames cannot have embedded double slashes - normalizing ${l} -> ${n}`)}n.startsWith("/")?o=Xx(n.substring(1),"/"):o=Xx(n,e)}else o=e;return{pathname:o,search:kR(r),hash:MR(i)}}function Xx(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(i=>{i===".."?n.length>1&&n.pop():i!=="."&&n.push(i)}),n.length>1?n.join("/"):"/"}function Bg(t,e,n,r){return`Cannot include a '${t}' character in a manually specified \`to.${e}\` field [${JSON.stringify(r)}].  Please separate it out to the \`to.${n}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function IR(t){return t.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function Qy(t){let e=IR(t);return e.map((n,r)=>r===e.length-1?n.pathname:n.pathnameBase)}function Ky(t,e,n,r=!1){let i;typeof t=="string"?i=hc(t):(i={...t},en(!i.pathname||!i.pathname.includes("?"),Bg("?","pathname","search",i)),en(!i.pathname||!i.pathname.includes("#"),Bg("#","pathname","hash",i)),en(!i.search||!i.search.includes("#"),Bg("#","search","hash",i)));let o=t===""||i.pathname==="",l=o?"/":i.pathname,u;if(l==null)u=n;else{let g=e.length-1;if(!r&&l.startsWith("..")){let b=l.split("/");for(;b[0]==="..";)b.shift(),g-=1;i.pathname=b.join("/")}u=g>=0?e[g]:"/"}let h=RR(i,u),f=l&&l!=="/"&&l.endsWith("/"),p=(o||l===".")&&n.endsWith("/");return!h.pathname.endsWith("/")&&(f||p)&&(h.pathname+="/"),h}var Ci=t=>t.join("/").replace(/\/\/+/g,"/"),DR=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),kR=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,MR=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t,OR=class{constructor(t,e,n,r=!1){this.status=t,this.statusText=e||"",this.internal=r,n instanceof Error?(this.data=n.toString(),this.error=n):this.data=n}};function NR(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}function PR(t){return t.map(e=>e.route.path).filter(Boolean).join("/").replace(/\/\/*/g,"/")||"/"}var j1=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function R1(t,e){let n=t;if(typeof n!="string"||!A1.test(n))return{absoluteURL:void 0,isExternal:!1,to:n};let r=n,i=!1;if(j1)try{let o=new URL(window.location.href),l=n.startsWith("//")?new URL(o.protocol+n):new URL(n),u=ji(l.pathname,e);l.origin===o.origin&&u!=null?n=u+l.search+l.hash:i=!0}catch{Or(!1,`<Link to="${n}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}return{absoluteURL:r,isExternal:i,to:n}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var I1=["POST","PUT","PATCH","DELETE"];new Set(I1);var BR=["GET",...I1];new Set(BR);var fc=R.createContext(null);fc.displayName="DataRouter";var Qf=R.createContext(null);Qf.displayName="DataRouterState";var zR=R.createContext(!1),D1=R.createContext({isTransitioning:!1});D1.displayName="ViewTransition";var LR=R.createContext(new Map);LR.displayName="Fetchers";var UR=R.createContext(null);UR.displayName="Await";var Pr=R.createContext(null);Pr.displayName="Navigation";var ad=R.createContext(null);ad.displayName="Location";var Jr=R.createContext({outlet:null,matches:[],isDataRoute:!1});Jr.displayName="Route";var Yy=R.createContext(null);Yy.displayName="RouteError";var k1="REACT_ROUTER_ERROR",FR="REDIRECT",VR="ROUTE_ERROR_RESPONSE";function $R(t){if(t.startsWith(`${k1}:${FR}:{`))try{let e=JSON.parse(t.slice(28));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.location=="string"&&typeof e.reloadDocument=="boolean"&&typeof e.replace=="boolean")return e}catch{}}function qR(t){if(t.startsWith(`${k1}:${VR}:{`))try{let e=JSON.parse(t.slice(40));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string")return new OR(e.status,e.statusText,e.data)}catch{}}function HR(t,{relative:e}={}){en(mc(),"useHref() may be used only in the context of a <Router> component.");let{basename:n,navigator:r}=R.useContext(Pr),{hash:i,pathname:o,search:l}=ld(t,{relative:e}),u=o;return n!=="/"&&(u=o==="/"?n:Ci([n,o])),r.createHref({pathname:u,search:l,hash:i})}function mc(){return R.useContext(ad)!=null}function tr(){return en(mc(),"useLocation() may be used only in the context of a <Router> component."),R.useContext(ad).location}var M1="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function O1(t){R.useContext(Pr).static||R.useLayoutEffect(t)}function od(){let{isDataRoute:t}=R.useContext(Jr);return t?oI():GR()}function GR(){en(mc(),"useNavigate() may be used only in the context of a <Router> component.");let t=R.useContext(fc),{basename:e,navigator:n}=R.useContext(Pr),{matches:r}=R.useContext(Jr),{pathname:i}=tr(),o=JSON.stringify(Qy(r)),l=R.useRef(!1);return O1(()=>{l.current=!0}),R.useCallback((h,f={})=>{if(Or(l.current,M1),!l.current)return;if(typeof h=="number"){n.go(h);return}let p=Ky(h,JSON.parse(o),i,f.relative==="path");t==null&&e!=="/"&&(p.pathname=p.pathname==="/"?e:Ci([e,p.pathname])),(f.replace?n.replace:n.push)(p,f.state,f)},[e,n,o,i,t])}var WR=R.createContext(null);function QR(t){let e=R.useContext(Jr).outlet;return R.useMemo(()=>e&&R.createElement(WR.Provider,{value:t},e),[e,t])}function KR(){let{matches:t}=R.useContext(Jr),e=t[t.length-1];return e?e.params:{}}function ld(t,{relative:e}={}){let{matches:n}=R.useContext(Jr),{pathname:r}=tr(),i=JSON.stringify(Qy(n));return R.useMemo(()=>Ky(t,JSON.parse(i),r,e==="path"),[t,i,r,e])}function YR(t,e){return N1(t,e)}function N1(t,e,n,r,i){en(mc(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:o}=R.useContext(Pr),{matches:l}=R.useContext(Jr),u=l[l.length-1],h=u?u.params:{},f=u?u.pathname:"/",p=u?u.pathnameBase:"/",g=u&&u.route;{let T=g&&g.path||"";B1(f,!g||T.endsWith("*")||T.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${f}" (under <Route path="${T}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${T}"> to <Route path="${T==="/"?"*":`${T}/*`}">.`)}let b=tr(),_;if(e){let T=typeof e=="string"?hc(e):e;en(p==="/"||T.pathname?.startsWith(p),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${p}" but pathname "${T.pathname}" was given in the \`location\` prop.`),_=T}else _=b;let w=_.pathname||"/",x=w;if(p!=="/"){let T=p.replace(/^\//,"").split("/");x="/"+w.replace(/^\//,"").split("/").slice(T.length).join("/")}let S=E1(t,{pathname:x});Or(g||S!=null,`No routes matched location "${_.pathname}${_.search}${_.hash}" `),Or(S==null||S[S.length-1].route.element!==void 0||S[S.length-1].route.Component!==void 0||S[S.length-1].route.lazy!==void 0,`Matched leaf route at location "${_.pathname}${_.search}${_.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let C=tI(S&&S.map(T=>Object.assign({},T,{params:Object.assign({},h,T.params),pathname:Ci([p,o.encodeLocation?o.encodeLocation(T.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:T.pathname]),pathnameBase:T.pathnameBase==="/"?p:Ci([p,o.encodeLocation?o.encodeLocation(T.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:T.pathnameBase])})),l,n,r,i);return e&&C?R.createElement(ad.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",..._},navigationType:"POP"}},C):C}function XR(){let t=aI(),e=NR(t)?`${t.status} ${t.statusText}`:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,r="rgba(200,200,200, 0.5)",i={padding:"0.5rem",backgroundColor:r},o={padding:"2px 4px",backgroundColor:r},l=null;return console.error("Error handled by React Router default ErrorBoundary:",t),l=R.createElement(R.Fragment,null,R.createElement("p",null," Hey developer "),R.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",R.createElement("code",{style:o},"ErrorBoundary")," or"," ",R.createElement("code",{style:o},"errorElement")," prop on your route.")),R.createElement(R.Fragment,null,R.createElement("h2",null,"Unexpected Application Error!"),R.createElement("h3",{style:{fontStyle:"italic"}},e),n?R.createElement("pre",{style:i},n):null,l)}var ZR=R.createElement(XR,null),P1=class extends R.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,e){return e.location!==t.location||e.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:e.error,location:e.location,revalidation:t.revalidation||e.revalidation}}componentDidCatch(t,e){this.props.onError?this.props.onError(t,e):console.error("React Router caught the following error during render",t)}render(){let t=this.state.error;if(this.context&&typeof t=="object"&&t&&"digest"in t&&typeof t.digest=="string"){const n=qR(t.digest);n&&(t=n)}let e=t!==void 0?R.createElement(Jr.Provider,{value:this.props.routeContext},R.createElement(Yy.Provider,{value:t,children:this.props.component})):this.props.children;return this.context?R.createElement(JR,{error:t},e):e}};P1.contextType=zR;var zg=new WeakMap;function JR({children:t,error:e}){let{basename:n}=R.useContext(Pr);if(typeof e=="object"&&e&&"digest"in e&&typeof e.digest=="string"){let r=$R(e.digest);if(r){let i=zg.get(e);if(i)throw i;let o=R1(r.location,n);if(j1&&!zg.get(e))if(o.isExternal||r.reloadDocument)window.location.href=o.absoluteURL||o.to;else{const l=Promise.resolve().then(()=>window.__reactRouterDataRouter.navigate(o.to,{replace:r.replace}));throw zg.set(e,l),l}return R.createElement("meta",{httpEquiv:"refresh",content:`0;url=${o.absoluteURL||o.to}`})}}return t}function eI({routeContext:t,match:e,children:n}){let r=R.useContext(fc);return r&&r.static&&r.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=e.route.id),R.createElement(Jr.Provider,{value:t},n)}function tI(t,e=[],n=null,r=null,i=null){if(t==null){if(!n)return null;if(n.errors)t=n.matches;else if(e.length===0&&!n.initialized&&n.matches.length>0)t=n.matches;else return null}let o=t,l=n?.errors;if(l!=null){let p=o.findIndex(g=>g.route.id&&l?.[g.route.id]!==void 0);en(p>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(l).join(",")}`),o=o.slice(0,Math.min(o.length,p+1))}let u=!1,h=-1;if(n)for(let p=0;p<o.length;p++){let g=o[p];if((g.route.HydrateFallback||g.route.hydrateFallbackElement)&&(h=p),g.route.id){let{loaderData:b,errors:_}=n,w=g.route.loader&&!b.hasOwnProperty(g.route.id)&&(!_||_[g.route.id]===void 0);if(g.route.lazy||w){u=!0,h>=0?o=o.slice(0,h+1):o=[o[0]];break}}}let f=n&&r?(p,g)=>{r(p,{location:n.location,params:n.matches?.[0]?.params??{},unstable_pattern:PR(n.matches),errorInfo:g})}:void 0;return o.reduceRight((p,g,b)=>{let _,w=!1,x=null,S=null;n&&(_=l&&g.route.id?l[g.route.id]:void 0,x=g.route.errorElement||ZR,u&&(h<0&&b===0?(B1("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),w=!0,S=null):h===b&&(w=!0,S=g.route.hydrateFallbackElement||null)));let C=e.concat(o.slice(0,b+1)),T=()=>{let I;return _?I=x:w?I=S:g.route.Component?I=R.createElement(g.route.Component,null):g.route.element?I=g.route.element:I=p,R.createElement(eI,{match:g,routeContext:{outlet:p,matches:C,isDataRoute:n!=null},children:I})};return n&&(g.route.ErrorBoundary||g.route.errorElement||b===0)?R.createElement(P1,{location:n.location,revalidation:n.revalidation,component:x,error:_,children:T(),routeContext:{outlet:null,matches:C,isDataRoute:!0},onError:f}):T()},null)}function Xy(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function nI(t){let e=R.useContext(fc);return en(e,Xy(t)),e}function rI(t){let e=R.useContext(Qf);return en(e,Xy(t)),e}function sI(t){let e=R.useContext(Jr);return en(e,Xy(t)),e}function Zy(t){let e=sI(t),n=e.matches[e.matches.length-1];return en(n.route.id,`${t} can only be used on routes that contain a unique "id"`),n.route.id}function iI(){return Zy("useRouteId")}function aI(){let t=R.useContext(Yy),e=rI("useRouteError"),n=Zy("useRouteError");return t!==void 0?t:e.errors?.[n]}function oI(){let{router:t}=nI("useNavigate"),e=Zy("useNavigate"),n=R.useRef(!1);return O1(()=>{n.current=!0}),R.useCallback(async(i,o={})=>{Or(n.current,M1),n.current&&(typeof i=="number"?await t.navigate(i):await t.navigate(i,{fromRouteId:e,...o}))},[t,e])}var Zx={};function B1(t,e,n){!e&&!Zx[t]&&(Zx[t]=!0,Or(!1,n))}R.memo(lI);function lI({routes:t,future:e,state:n,onError:r}){return N1(t,void 0,n,r,e)}function Kf({to:t,replace:e,state:n,relative:r}){en(mc(),"<Navigate> may be used only in the context of a <Router> component.");let{static:i}=R.useContext(Pr);Or(!i,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:o}=R.useContext(Jr),{pathname:l}=tr(),u=od(),h=Ky(t,Qy(o),l,r==="path"),f=JSON.stringify(h);return R.useEffect(()=>{u(JSON.parse(f),{replace:e,state:n,relative:r})},[u,f,r,e,n]),null}function Yf(t){return QR(t.context)}function vn(t){en(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function cI({basename:t="/",children:e=null,location:n,navigationType:r="POP",navigator:i,static:o=!1,unstable_useTransitions:l}){en(!mc(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let u=t.replace(/^\/*/,"/"),h=R.useMemo(()=>({basename:u,navigator:i,static:o,unstable_useTransitions:l,future:{}}),[u,i,o,l]);typeof n=="string"&&(n=hc(n));let{pathname:f="/",search:p="",hash:g="",state:b=null,key:_="default"}=n,w=R.useMemo(()=>{let x=ji(f,u);return x==null?null:{location:{pathname:x,search:p,hash:g,state:b,key:_},navigationType:r}},[u,f,p,g,b,_,r]);return Or(w!=null,`<Router basename="${u}"> is not able to match the URL "${f}${p}${g}" because it does not start with the basename, so the <Router> won't render anything.`),w==null?null:R.createElement(Pr.Provider,{value:h},R.createElement(ad.Provider,{children:e,value:w}))}function uI({children:t,location:e}){return YR(cy(t),e)}function cy(t,e=[]){let n=[];return R.Children.forEach(t,(r,i)=>{if(!R.isValidElement(r))return;let o=[...e,i];if(r.type===R.Fragment){n.push.apply(n,cy(r.props.children,o));return}en(r.type===vn,`[${typeof r.type=="string"?r.type:r.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),en(!r.props.index||!r.props.children,"An index route cannot have child routes.");let l={id:r.props.id||o.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,middleware:r.props.middleware,loader:r.props.loader,action:r.props.action,hydrateFallbackElement:r.props.hydrateFallbackElement,HydrateFallback:r.props.HydrateFallback,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.hasErrorBoundary===!0||r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(l.children=cy(r.props.children,o)),n.push(l)}),n}var of="get",lf="application/x-www-form-urlencoded";function Xf(t){return typeof HTMLElement<"u"&&t instanceof HTMLElement}function dI(t){return Xf(t)&&t.tagName.toLowerCase()==="button"}function hI(t){return Xf(t)&&t.tagName.toLowerCase()==="form"}function fI(t){return Xf(t)&&t.tagName.toLowerCase()==="input"}function mI(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function pI(t,e){return t.button===0&&(!e||e==="_self")&&!mI(t)}function uy(t=""){return new URLSearchParams(typeof t=="string"||Array.isArray(t)||t instanceof URLSearchParams?t:Object.keys(t).reduce((e,n)=>{let r=t[n];return e.concat(Array.isArray(r)?r.map(i=>[n,i]):[[n,r]])},[]))}function gI(t,e){let n=uy(t);return e&&e.forEach((r,i)=>{n.has(i)||e.getAll(i).forEach(o=>{n.append(i,o)})}),n}var Yh=null;function yI(){if(Yh===null)try{new FormData(document.createElement("form"),0),Yh=!1}catch{Yh=!0}return Yh}var _I=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function Lg(t){return t!=null&&!_I.has(t)?(Or(!1,`"${t}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${lf}"`),null):t}function bI(t,e){let n,r,i,o,l;if(hI(t)){let u=t.getAttribute("action");r=u?ji(u,e):null,n=t.getAttribute("method")||of,i=Lg(t.getAttribute("enctype"))||lf,o=new FormData(t)}else if(dI(t)||fI(t)&&(t.type==="submit"||t.type==="image")){let u=t.form;if(u==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let h=t.getAttribute("formaction")||u.getAttribute("action");if(r=h?ji(h,e):null,n=t.getAttribute("formmethod")||u.getAttribute("method")||of,i=Lg(t.getAttribute("formenctype"))||Lg(u.getAttribute("enctype"))||lf,o=new FormData(u,t),!yI()){let{name:f,type:p,value:g}=t;if(p==="image"){let b=f?`${f}.`:"";o.append(`${b}x`,"0"),o.append(`${b}y`,"0")}else f&&o.append(f,g)}}else{if(Xf(t))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');n=of,r=null,i=lf,l=t}return o&&i==="text/plain"&&(l=o,o=void 0),{action:r,method:n.toLowerCase(),encType:i,formData:o,body:l}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function Jy(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function vI(t,e,n){let r=typeof t=="string"?new URL(t,typeof window>"u"?"server://singlefetch/":window.location.origin):t;return r.pathname==="/"?r.pathname=`_root.${n}`:e&&ji(r.pathname,e)==="/"?r.pathname=`${e.replace(/\/$/,"")}/_root.${n}`:r.pathname=`${r.pathname.replace(/\/$/,"")}.${n}`,r}async function xI(t,e){if(t.id in e)return e[t.id];try{let n=await import(t.module);return e[t.id]=n,n}catch(n){return console.error(`Error loading route module \`${t.module}\`, reloading page...`),console.error(n),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function wI(t){return t==null?!1:t.href==null?t.rel==="preload"&&typeof t.imageSrcSet=="string"&&typeof t.imageSizes=="string":typeof t.rel=="string"&&typeof t.href=="string"}async function SI(t,e,n){let r=await Promise.all(t.map(async i=>{let o=e.routes[i.route.id];if(o){let l=await xI(o,n);return l.links?l.links():[]}return[]}));return AI(r.flat(1).filter(wI).filter(i=>i.rel==="stylesheet"||i.rel==="preload").map(i=>i.rel==="stylesheet"?{...i,rel:"prefetch",as:"style"}:{...i,rel:"prefetch"}))}function Jx(t,e,n,r,i,o){let l=(h,f)=>n[f]?h.route.id!==n[f].route.id:!0,u=(h,f)=>n[f].pathname!==h.pathname||n[f].route.path?.endsWith("*")&&n[f].params["*"]!==h.params["*"];return o==="assets"?e.filter((h,f)=>l(h,f)||u(h,f)):o==="data"?e.filter((h,f)=>{let p=r.routes[h.route.id];if(!p||!p.hasLoader)return!1;if(l(h,f)||u(h,f))return!0;if(h.route.shouldRevalidate){let g=h.route.shouldRevalidate({currentUrl:new URL(i.pathname+i.search+i.hash,window.origin),currentParams:n[0]?.params||{},nextUrl:new URL(t,window.origin),nextParams:h.params,defaultShouldRevalidate:!0});if(typeof g=="boolean")return g}return!0}):[]}function EI(t,e,{includeHydrateFallback:n}={}){return CI(t.map(r=>{let i=e.routes[r.route.id];if(!i)return[];let o=[i.module];return i.clientActionModule&&(o=o.concat(i.clientActionModule)),i.clientLoaderModule&&(o=o.concat(i.clientLoaderModule)),n&&i.hydrateFallbackModule&&(o=o.concat(i.hydrateFallbackModule)),i.imports&&(o=o.concat(i.imports)),o}).flat(1))}function CI(t){return[...new Set(t)]}function TI(t){let e={},n=Object.keys(t).sort();for(let r of n)e[r]=t[r];return e}function AI(t,e){let n=new Set;return new Set(e),t.reduce((r,i)=>{let o=JSON.stringify(TI(i));return n.has(o)||(n.add(o),r.push({key:o,link:i})),r},[])}function z1(){let t=R.useContext(fc);return Jy(t,"You must render this element inside a <DataRouterContext.Provider> element"),t}function jI(){let t=R.useContext(Qf);return Jy(t,"You must render this element inside a <DataRouterStateContext.Provider> element"),t}var e0=R.createContext(void 0);e0.displayName="FrameworkContext";function L1(){let t=R.useContext(e0);return Jy(t,"You must render this element inside a <HydratedRouter> element"),t}function RI(t,e){let n=R.useContext(e0),[r,i]=R.useState(!1),[o,l]=R.useState(!1),{onFocus:u,onBlur:h,onMouseEnter:f,onMouseLeave:p,onTouchStart:g}=e,b=R.useRef(null);R.useEffect(()=>{if(t==="render"&&l(!0),t==="viewport"){let x=C=>{C.forEach(T=>{l(T.isIntersecting)})},S=new IntersectionObserver(x,{threshold:.5});return b.current&&S.observe(b.current),()=>{S.disconnect()}}},[t]),R.useEffect(()=>{if(r){let x=setTimeout(()=>{l(!0)},100);return()=>{clearTimeout(x)}}},[r]);let _=()=>{i(!0)},w=()=>{i(!1),l(!1)};return n?t!=="intent"?[o,b,{}]:[o,b,{onFocus:Iu(u,_),onBlur:Iu(h,w),onMouseEnter:Iu(f,_),onMouseLeave:Iu(p,w),onTouchStart:Iu(g,_)}]:[!1,b,{}]}function Iu(t,e){return n=>{t&&t(n),n.defaultPrevented||e(n)}}function II({page:t,...e}){let{router:n}=z1(),r=R.useMemo(()=>E1(n.routes,t,n.basename),[n.routes,t,n.basename]);return r?R.createElement(kI,{page:t,matches:r,...e}):null}function DI(t){let{manifest:e,routeModules:n}=L1(),[r,i]=R.useState([]);return R.useEffect(()=>{let o=!1;return SI(t,e,n).then(l=>{o||i(l)}),()=>{o=!0}},[t,e,n]),r}function kI({page:t,matches:e,...n}){let r=tr(),{manifest:i,routeModules:o}=L1(),{basename:l}=z1(),{loaderData:u,matches:h}=jI(),f=R.useMemo(()=>Jx(t,e,h,i,r,"data"),[t,e,h,i,r]),p=R.useMemo(()=>Jx(t,e,h,i,r,"assets"),[t,e,h,i,r]),g=R.useMemo(()=>{if(t===r.pathname+r.search+r.hash)return[];let w=new Set,x=!1;if(e.forEach(C=>{let T=i.routes[C.route.id];!T||!T.hasLoader||(!f.some(I=>I.route.id===C.route.id)&&C.route.id in u&&o[C.route.id]?.shouldRevalidate||T.hasClientLoader?x=!0:w.add(C.route.id))}),w.size===0)return[];let S=vI(t,l,"data");return x&&w.size>0&&S.searchParams.set("_routes",e.filter(C=>w.has(C.route.id)).map(C=>C.route.id).join(",")),[S.pathname+S.search]},[l,u,r,i,f,e,t,o]),b=R.useMemo(()=>EI(p,i),[p,i]),_=DI(p);return R.createElement(R.Fragment,null,g.map(w=>R.createElement("link",{key:w,rel:"prefetch",as:"fetch",href:w,...n})),b.map(w=>R.createElement("link",{key:w,rel:"modulepreload",href:w,...n})),_.map(({key:w,link:x})=>R.createElement("link",{key:w,nonce:n.nonce,...x})))}function MI(...t){return e=>{t.forEach(n=>{typeof n=="function"?n(e):n!=null&&(n.current=e)})}}var OI=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{OI&&(window.__reactRouterVersion="7.11.0")}catch{}function NI({basename:t,children:e,unstable_useTransitions:n,window:r}){let i=R.useRef();i.current==null&&(i.current=dR({window:r,v5Compat:!0}));let o=i.current,[l,u]=R.useState({action:o.action,location:o.location}),h=R.useCallback(f=>{n===!1?u(f):R.startTransition(()=>u(f))},[n]);return R.useLayoutEffect(()=>o.listen(h),[o,h]),R.createElement(cI,{basename:t,children:e,location:l.location,navigationType:l.action,navigator:o,unstable_useTransitions:n})}var U1=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,jn=R.forwardRef(function({onClick:e,discover:n="render",prefetch:r="none",relative:i,reloadDocument:o,replace:l,state:u,target:h,to:f,preventScrollReset:p,viewTransition:g,unstable_defaultShouldRevalidate:b,..._},w){let{basename:x,unstable_useTransitions:S}=R.useContext(Pr),C=typeof f=="string"&&U1.test(f),T=R1(f,x);f=T.to;let I=HR(f,{relative:i}),[M,U,H]=RI(r,_),O=LI(f,{replace:l,state:u,target:h,preventScrollReset:p,relative:i,viewTransition:g,unstable_defaultShouldRevalidate:b,unstable_useTransitions:S});function P(V){e&&e(V),V.defaultPrevented||O(V)}let N=R.createElement("a",{..._,...H,href:T.absoluteURL||I,onClick:T.isExternal||o?e:P,ref:MI(w,U),target:h,"data-discover":!C&&n==="render"?"true":void 0});return M&&!C?R.createElement(R.Fragment,null,N,R.createElement(II,{page:I})):N});jn.displayName="Link";var PI=R.forwardRef(function({"aria-current":e="page",caseSensitive:n=!1,className:r="",end:i=!1,style:o,to:l,viewTransition:u,children:h,...f},p){let g=ld(l,{relative:f.relative}),b=tr(),_=R.useContext(Qf),{navigator:w,basename:x}=R.useContext(Pr),S=_!=null&&qI(g)&&u===!0,C=w.encodeLocation?w.encodeLocation(g).pathname:g.pathname,T=b.pathname,I=_&&_.navigation&&_.navigation.location?_.navigation.location.pathname:null;n||(T=T.toLowerCase(),I=I?I.toLowerCase():null,C=C.toLowerCase()),I&&x&&(I=ji(I,x)||I);const M=C!=="/"&&C.endsWith("/")?C.length-1:C.length;let U=T===C||!i&&T.startsWith(C)&&T.charAt(M)==="/",H=I!=null&&(I===C||!i&&I.startsWith(C)&&I.charAt(C.length)==="/"),O={isActive:U,isPending:H,isTransitioning:S},P=U?e:void 0,N;typeof r=="function"?N=r(O):N=[r,U?"active":null,H?"pending":null,S?"transitioning":null].filter(Boolean).join(" ");let V=typeof o=="function"?o(O):o;return R.createElement(jn,{...f,"aria-current":P,className:N,ref:p,style:V,to:l,viewTransition:u},typeof h=="function"?h(O):h)});PI.displayName="NavLink";var BI=R.forwardRef(({discover:t="render",fetcherKey:e,navigate:n,reloadDocument:r,replace:i,state:o,method:l=of,action:u,onSubmit:h,relative:f,preventScrollReset:p,viewTransition:g,unstable_defaultShouldRevalidate:b,..._},w)=>{let{unstable_useTransitions:x}=R.useContext(Pr),S=VI(),C=$I(u,{relative:f}),T=l.toLowerCase()==="get"?"get":"post",I=typeof u=="string"&&U1.test(u),M=U=>{if(h&&h(U),U.defaultPrevented)return;U.preventDefault();let H=U.nativeEvent.submitter,O=H?.getAttribute("formmethod")||l,P=()=>S(H||U.currentTarget,{fetcherKey:e,method:O,navigate:n,replace:i,state:o,relative:f,preventScrollReset:p,viewTransition:g,unstable_defaultShouldRevalidate:b});x&&n!==!1?R.startTransition(()=>P()):P()};return R.createElement("form",{ref:w,method:T,action:C,onSubmit:r?h:M,..._,"data-discover":!I&&t==="render"?"true":void 0})});BI.displayName="Form";function zI(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function F1(t){let e=R.useContext(fc);return en(e,zI(t)),e}function LI(t,{target:e,replace:n,state:r,preventScrollReset:i,relative:o,viewTransition:l,unstable_defaultShouldRevalidate:u,unstable_useTransitions:h}={}){let f=od(),p=tr(),g=ld(t,{relative:o});return R.useCallback(b=>{if(pI(b,e)){b.preventDefault();let _=n!==void 0?n:Hu(p)===Hu(g),w=()=>f(t,{replace:_,state:r,preventScrollReset:i,relative:o,viewTransition:l,unstable_defaultShouldRevalidate:u});h?R.startTransition(()=>w()):w()}},[p,f,g,n,r,e,t,i,o,l,u,h])}function V1(t){Or(typeof URLSearchParams<"u","You cannot use the `useSearchParams` hook in a browser that does not support the URLSearchParams API. If you need to support Internet Explorer 11, we recommend you load a polyfill such as https://github.com/ungap/url-search-params.");let e=R.useRef(uy(t)),n=R.useRef(!1),r=tr(),i=R.useMemo(()=>gI(r.search,n.current?null:e.current),[r.search]),o=od(),l=R.useCallback((u,h)=>{const f=uy(typeof u=="function"?u(new URLSearchParams(i)):u);n.current=!0,o("?"+f,h)},[o,i]);return[i,l]}var UI=0,FI=()=>`__${String(++UI)}__`;function VI(){let{router:t}=F1("useSubmit"),{basename:e}=R.useContext(Pr),n=iI(),r=t.fetch,i=t.navigate;return R.useCallback(async(o,l={})=>{let{action:u,method:h,encType:f,formData:p,body:g}=bI(o,e);if(l.navigate===!1){let b=l.fetcherKey||FI();await r(b,n,l.action||u,{unstable_defaultShouldRevalidate:l.unstable_defaultShouldRevalidate,preventScrollReset:l.preventScrollReset,formData:p,body:g,formMethod:l.method||h,formEncType:l.encType||f,flushSync:l.flushSync})}else await i(l.action||u,{unstable_defaultShouldRevalidate:l.unstable_defaultShouldRevalidate,preventScrollReset:l.preventScrollReset,formData:p,body:g,formMethod:l.method||h,formEncType:l.encType||f,replace:l.replace,state:l.state,fromRouteId:n,flushSync:l.flushSync,viewTransition:l.viewTransition})},[r,i,e,n])}function $I(t,{relative:e}={}){let{basename:n}=R.useContext(Pr),r=R.useContext(Jr);en(r,"useFormAction must be used inside a RouteContext");let[i]=r.matches.slice(-1),o={...ld(t||".",{relative:e})},l=tr();if(t==null){o.search=l.search;let u=new URLSearchParams(o.search),h=u.getAll("index");if(h.some(p=>p==="")){u.delete("index"),h.filter(g=>g).forEach(g=>u.append("index",g));let p=u.toString();o.search=p?`?${p}`:""}}return(!t||t===".")&&i.route.index&&(o.search=o.search?o.search.replace(/^\?/,"?index&"):"?index"),n!=="/"&&(o.pathname=o.pathname==="/"?n:Ci([n,o.pathname])),Hu(o)}function qI(t,{relative:e}={}){let n=R.useContext(D1);en(n!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:r}=F1("useViewTransitionState"),i=ld(t,{relative:e});if(!n.isTransitioning)return!1;let o=ji(n.currentLocation.pathname,r)||n.currentLocation.pathname,l=ji(n.nextLocation.pathname,r)||n.nextLocation.pathname;return bf(i.pathname,l)!=null||bf(i.pathname,o)!=null}const HI={isLoading:!1,loadingMessage:"Loading...",addLoadingHold:()=>{},removeLoadingHold:()=>{}},$1=R.createContext(HI);function GI({children:t}){const[e,n]=R.useState(new Map),r=R.useCallback((h,f)=>{n(p=>new Map(p).set(h,f))},[]),i=R.useCallback(h=>{n(f=>{const p=new Map(f);return p.delete(h),p})},[]),o=e.size>0,l=e.size>0&&Array.from(e.values()).pop()||"Loading...",u={isLoading:o,loadingMessage:l,addLoadingHold:r,removeLoadingHold:i};return d.jsx($1.Provider,{value:u,children:t})}function In(){const t=R.useContext($1);if(!t)throw new Error("useApp must be used within an AppProvider");return t}const WI=()=>{};var ew={};const q1=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let i=t.charCodeAt(r);i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=i&63|128):(i&64512)===55296&&r+1<t.length&&(t.charCodeAt(r+1)&64512)===56320?(i=65536+((i&1023)<<10)+(t.charCodeAt(++r)&1023),e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=i&63|128):(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=i&63|128)}return e},QI=function(t){const e=[];let n=0,r=0;for(;n<t.length;){const i=t[n++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){const o=t[n++];e[r++]=String.fromCharCode((i&31)<<6|o&63)}else if(i>239&&i<365){const o=t[n++],l=t[n++],u=t[n++],h=((i&7)<<18|(o&63)<<12|(l&63)<<6|u&63)-65536;e[r++]=String.fromCharCode(55296+(h>>10)),e[r++]=String.fromCharCode(56320+(h&1023))}else{const o=t[n++],l=t[n++];e[r++]=String.fromCharCode((i&15)<<12|(o&63)<<6|l&63)}}return e.join("")},H1={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<t.length;i+=3){const o=t[i],l=i+1<t.length,u=l?t[i+1]:0,h=i+2<t.length,f=h?t[i+2]:0,p=o>>2,g=(o&3)<<4|u>>4;let b=(u&15)<<2|f>>6,_=f&63;h||(_=64,l||(b=64)),r.push(n[p],n[g],n[b],n[_])}return r.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(q1(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):QI(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<t.length;){const o=n[t.charAt(i++)],u=i<t.length?n[t.charAt(i)]:0;++i;const f=i<t.length?n[t.charAt(i)]:64;++i;const g=i<t.length?n[t.charAt(i)]:64;if(++i,o==null||u==null||f==null||g==null)throw new KI;const b=o<<2|u>>4;if(r.push(b),f!==64){const _=u<<4&240|f>>2;if(r.push(_),g!==64){const w=f<<6&192|g;r.push(w)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class KI extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const YI=function(t){const e=q1(t);return H1.encodeByteArray(e,!0)},vf=function(t){return YI(t).replace(/\./g,"")},G1=function(t){try{return H1.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function XI(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const ZI=()=>XI().__FIREBASE_DEFAULTS__,JI=()=>{if(typeof process>"u"||typeof ew>"u")return;const t=ew.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},e2=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&G1(t[1]);return e&&JSON.parse(e)},Zf=()=>{try{return WI()||ZI()||JI()||e2()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},W1=t=>Zf()?.emulatorHosts?.[t],t2=t=>{const e=W1(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(n+1),10);return e[0]==="["?[e.substring(1,n-1),r]:[e.substring(0,n),r]},Q1=()=>Zf()?.config,K1=t=>Zf()?.[`_${t}`];class n2{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,r)=>{n?this.reject(n):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,r))}}}function pc(t){try{return(t.startsWith("http://")||t.startsWith("https://")?new URL(t).hostname:t).endsWith(".cloudworkstations.dev")}catch{return!1}}async function Y1(t){return(await fetch(t,{credentials:"include"})).ok}function r2(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n={alg:"none",type:"JWT"},r=e||"demo-project",i=t.iat||0,o=t.sub||t.user_id;if(!o)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const l={iss:`https://securetoken.google.com/${r}`,aud:r,iat:i,exp:i+3600,auth_time:i,sub:o,user_id:o,firebase:{sign_in_provider:"custom",identities:{}},...t};return[vf(JSON.stringify(n)),vf(JSON.stringify(l)),""].join(".")}const zu={};function s2(){const t={prod:[],emulator:[]};for(const e of Object.keys(zu))zu[e]?t.emulator.push(e):t.prod.push(e);return t}function i2(t){let e=document.getElementById(t),n=!1;return e||(e=document.createElement("div"),e.setAttribute("id",t),n=!0),{created:n,element:e}}let tw=!1;function X1(t,e){if(typeof window>"u"||typeof document>"u"||!pc(window.location.host)||zu[t]===e||zu[t]||tw)return;zu[t]=e;function n(b){return`__firebase__banner__${b}`}const r="__firebase__banner",o=s2().prod.length>0;function l(){const b=document.getElementById(r);b&&b.remove()}function u(b){b.style.display="flex",b.style.background="#7faaf0",b.style.position="fixed",b.style.bottom="5px",b.style.left="5px",b.style.padding=".5em",b.style.borderRadius="5px",b.style.alignItems="center"}function h(b,_){b.setAttribute("width","24"),b.setAttribute("id",_),b.setAttribute("height","24"),b.setAttribute("viewBox","0 0 24 24"),b.setAttribute("fill","none"),b.style.marginLeft="-6px"}function f(){const b=document.createElement("span");return b.style.cursor="pointer",b.style.marginLeft="16px",b.style.fontSize="24px",b.innerHTML=" &times;",b.onclick=()=>{tw=!0,l()},b}function p(b,_){b.setAttribute("id",_),b.innerText="Learn more",b.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",b.setAttribute("target","__blank"),b.style.paddingLeft="5px",b.style.textDecoration="underline"}function g(){const b=i2(r),_=n("text"),w=document.getElementById(_)||document.createElement("span"),x=n("learnmore"),S=document.getElementById(x)||document.createElement("a"),C=n("preprendIcon"),T=document.getElementById(C)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(b.created){const I=b.element;u(I),p(S,x);const M=f();h(T,C),I.append(T,w,S,M),document.body.appendChild(I)}o?(w.innerText="Preview backend disconnected.",T.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(T.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,w.innerText="Preview backend running in this workspace."),w.setAttribute("id",_)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",g):g()}function er(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function a2(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(er())}function o2(){const t=Zf()?.forceEnvironment;if(t==="node")return!0;if(t==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function l2(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function c2(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function u2(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function d2(){const t=er();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function h2(){return!o2()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function f2(){try{return typeof indexedDB=="object"}catch{return!1}}function m2(){return new Promise((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{e(i.error?.message||"")}}catch(n){e(n)}})}const p2="FirebaseError";class Bi extends Error{constructor(e,n,r){super(n),this.code=e,this.customData=r,this.name=p2,Object.setPrototypeOf(this,Bi.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,cd.prototype.create)}}class cd{constructor(e,n,r){this.service=e,this.serviceName=n,this.errors=r}create(e,...n){const r=n[0]||{},i=`${this.service}/${e}`,o=this.errors[e],l=o?g2(o,r):"Error",u=`${this.serviceName}: ${l} (${i}).`;return new Bi(i,u,r)}}function g2(t,e){return t.replace(y2,(n,r)=>{const i=e[r];return i!=null?String(i):`<${r}?>`})}const y2=/\{\$([^}]+)}/g;function _2(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function Ri(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const i of n){if(!r.includes(i))return!1;const o=t[i],l=e[i];if(nw(o)&&nw(l)){if(!Ri(o,l))return!1}else if(o!==l)return!1}for(const i of r)if(!n.includes(i))return!1;return!0}function nw(t){return t!==null&&typeof t=="object"}function ud(t){const e=[];for(const[n,r]of Object.entries(t))Array.isArray(r)?r.forEach(i=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function ku(t){const e={};return t.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[i,o]=r.split("=");e[decodeURIComponent(i)]=decodeURIComponent(o)}}),e}function Mu(t){const e=t.indexOf("?");if(!e)return"";const n=t.indexOf("#",e);return t.substring(e,n>0?n:void 0)}function b2(t,e){const n=new v2(t,e);return n.subscribe.bind(n)}class v2{constructor(e,n){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(n=>{n.next(e)})}error(e){this.forEachObserver(n=>{n.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,n,r){let i;if(e===void 0&&n===void 0&&r===void 0)throw new Error("Missing Observer.");x2(e,["next","error","complete"])?i=e:i={next:e,error:n,complete:r},i.next===void 0&&(i.next=Ug),i.error===void 0&&(i.error=Ug),i.complete===void 0&&(i.complete=Ug);const o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),o}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let n=0;n<this.observers.length;n++)this.sendOne(n,e)}sendOne(e,n){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{n(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function x2(t,e){if(typeof t!="object"||t===null)return!1;for(const n of e)if(n in t&&typeof t[n]=="function")return!0;return!1}function Ug(){}function En(t){return t&&t._delegate?t._delegate:t}class zo{constructor(e,n,r){this.name=e,this.instanceFactory=n,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const Io="[DEFAULT]";class w2{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){const r=new n2;if(this.instancesDeferred.set(n,r),this.isInitialized(n)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:n});i&&r.resolve(i)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){const n=this.normalizeInstanceIdentifier(e?.identifier),r=e?.optional??!1;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(i){if(r)return null;throw i}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(E2(e))try{this.getOrInitializeService({instanceIdentifier:Io})}catch{}for(const[n,r]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(n);try{const o=this.getOrInitializeService({instanceIdentifier:i});r.resolve(o)}catch{}}}}clearInstance(e=Io){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Io){return this.instances.has(e)}getOptions(e=Io){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:n={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:r,options:n});for(const[o,l]of this.instancesDeferred.entries()){const u=this.normalizeInstanceIdentifier(o);r===u&&l.resolve(i)}return i}onInit(e,n){const r=this.normalizeInstanceIdentifier(n),i=this.onInitCallbacks.get(r)??new Set;i.add(e),this.onInitCallbacks.set(r,i);const o=this.instances.get(r);return o&&e(o,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,n){const r=this.onInitCallbacks.get(n);if(r)for(const i of r)try{i(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:S2(e),options:n}),this.instances.set(e,r),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=Io){return this.component?this.component.multipleInstances?e:Io:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function S2(t){return t===Io?void 0:t}function E2(t){return t.instantiationMode==="EAGER"}class C2{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const n=new w2(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}}var pt;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(pt||(pt={}));const T2={debug:pt.DEBUG,verbose:pt.VERBOSE,info:pt.INFO,warn:pt.WARN,error:pt.ERROR,silent:pt.SILENT},A2=pt.INFO,j2={[pt.DEBUG]:"log",[pt.VERBOSE]:"log",[pt.INFO]:"info",[pt.WARN]:"warn",[pt.ERROR]:"error"},R2=(t,e,...n)=>{if(e<t.logLevel)return;const r=new Date().toISOString(),i=j2[e];if(i)console[i](`[${r}]  ${t.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class t0{constructor(e){this.name=e,this._logLevel=A2,this._logHandler=R2,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in pt))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?T2[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,pt.DEBUG,...e),this._logHandler(this,pt.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,pt.VERBOSE,...e),this._logHandler(this,pt.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,pt.INFO,...e),this._logHandler(this,pt.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,pt.WARN,...e),this._logHandler(this,pt.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,pt.ERROR,...e),this._logHandler(this,pt.ERROR,...e)}}const I2=(t,e)=>e.some(n=>t instanceof n);let rw,sw;function D2(){return rw||(rw=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function k2(){return sw||(sw=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Z1=new WeakMap,dy=new WeakMap,J1=new WeakMap,Fg=new WeakMap,n0=new WeakMap;function M2(t){const e=new Promise((n,r)=>{const i=()=>{t.removeEventListener("success",o),t.removeEventListener("error",l)},o=()=>{n(Aa(t.result)),i()},l=()=>{r(t.error),i()};t.addEventListener("success",o),t.addEventListener("error",l)});return e.then(n=>{n instanceof IDBCursor&&Z1.set(n,t)}).catch(()=>{}),n0.set(e,t),e}function O2(t){if(dy.has(t))return;const e=new Promise((n,r)=>{const i=()=>{t.removeEventListener("complete",o),t.removeEventListener("error",l),t.removeEventListener("abort",l)},o=()=>{n(),i()},l=()=>{r(t.error||new DOMException("AbortError","AbortError")),i()};t.addEventListener("complete",o),t.addEventListener("error",l),t.addEventListener("abort",l)});dy.set(t,e)}let hy={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return dy.get(t);if(e==="objectStoreNames")return t.objectStoreNames||J1.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Aa(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function N2(t){hy=t(hy)}function P2(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const r=t.call(Vg(this),e,...n);return J1.set(r,e.sort?e.sort():[e]),Aa(r)}:k2().includes(t)?function(...e){return t.apply(Vg(this),e),Aa(Z1.get(this))}:function(...e){return Aa(t.apply(Vg(this),e))}}function B2(t){return typeof t=="function"?P2(t):(t instanceof IDBTransaction&&O2(t),I2(t,D2())?new Proxy(t,hy):t)}function Aa(t){if(t instanceof IDBRequest)return M2(t);if(Fg.has(t))return Fg.get(t);const e=B2(t);return e!==t&&(Fg.set(t,e),n0.set(e,t)),e}const Vg=t=>n0.get(t);function z2(t,e,{blocked:n,upgrade:r,blocking:i,terminated:o}={}){const l=indexedDB.open(t,e),u=Aa(l);return r&&l.addEventListener("upgradeneeded",h=>{r(Aa(l.result),h.oldVersion,h.newVersion,Aa(l.transaction),h)}),n&&l.addEventListener("blocked",h=>n(h.oldVersion,h.newVersion,h)),u.then(h=>{o&&h.addEventListener("close",()=>o()),i&&h.addEventListener("versionchange",f=>i(f.oldVersion,f.newVersion,f))}).catch(()=>{}),u}const L2=["get","getKey","getAll","getAllKeys","count"],U2=["put","add","delete","clear"],$g=new Map;function iw(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if($g.get(e))return $g.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,i=U2.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(i||L2.includes(n)))return;const o=async function(l,...u){const h=this.transaction(l,i?"readwrite":"readonly");let f=h.store;return r&&(f=f.index(u.shift())),(await Promise.all([f[n](...u),i&&h.done]))[0]};return $g.set(e,o),o}N2(t=>({...t,get:(e,n,r)=>iw(e,n)||t.get(e,n,r),has:(e,n)=>!!iw(e,n)||t.has(e,n)}));class F2{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(V2(n)){const r=n.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(n=>n).join(" ")}}function V2(t){return t.getComponent()?.type==="VERSION"}const fy="@firebase/app",aw="0.14.6";const Ii=new t0("@firebase/app"),$2="@firebase/app-compat",q2="@firebase/analytics-compat",H2="@firebase/analytics",G2="@firebase/app-check-compat",W2="@firebase/app-check",Q2="@firebase/auth",K2="@firebase/auth-compat",Y2="@firebase/database",X2="@firebase/data-connect",Z2="@firebase/database-compat",J2="@firebase/functions",eD="@firebase/functions-compat",tD="@firebase/installations",nD="@firebase/installations-compat",rD="@firebase/messaging",sD="@firebase/messaging-compat",iD="@firebase/performance",aD="@firebase/performance-compat",oD="@firebase/remote-config",lD="@firebase/remote-config-compat",cD="@firebase/storage",uD="@firebase/storage-compat",dD="@firebase/firestore",hD="@firebase/ai",fD="@firebase/firestore-compat",mD="firebase",pD="12.6.0";const my="[DEFAULT]",gD={[fy]:"fire-core",[$2]:"fire-core-compat",[H2]:"fire-analytics",[q2]:"fire-analytics-compat",[W2]:"fire-app-check",[G2]:"fire-app-check-compat",[Q2]:"fire-auth",[K2]:"fire-auth-compat",[Y2]:"fire-rtdb",[X2]:"fire-data-connect",[Z2]:"fire-rtdb-compat",[J2]:"fire-fn",[eD]:"fire-fn-compat",[tD]:"fire-iid",[nD]:"fire-iid-compat",[rD]:"fire-fcm",[sD]:"fire-fcm-compat",[iD]:"fire-perf",[aD]:"fire-perf-compat",[oD]:"fire-rc",[lD]:"fire-rc-compat",[cD]:"fire-gcs",[uD]:"fire-gcs-compat",[dD]:"fire-fst",[fD]:"fire-fst-compat",[hD]:"fire-vertex","fire-js":"fire-js",[mD]:"fire-js-all"};const xf=new Map,yD=new Map,py=new Map;function ow(t,e){try{t.container.addComponent(e)}catch(n){Ii.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function tc(t){const e=t.name;if(py.has(e))return Ii.debug(`There were multiple attempts to register component ${e}.`),!1;py.set(e,t);for(const n of xf.values())ow(n,t);for(const n of yD.values())ow(n,t);return!0}function r0(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function ds(t){return t==null?!1:t.settings!==void 0}const _D={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},ja=new cd("app","Firebase",_D);class bD{constructor(e,n,r){this._isDeleted=!1,this._options={...e},this._config={...n},this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new zo("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw ja.create("app-deleted",{appName:this._name})}}const gc=pD;function eE(t,e={}){let n=t;typeof e!="object"&&(e={name:e});const r={name:my,automaticDataCollectionEnabled:!0,...e},i=r.name;if(typeof i!="string"||!i)throw ja.create("bad-app-name",{appName:String(i)});if(n||(n=Q1()),!n)throw ja.create("no-options");const o=xf.get(i);if(o){if(Ri(n,o.options)&&Ri(r,o.config))return o;throw ja.create("duplicate-app",{appName:i})}const l=new C2(i);for(const h of py.values())l.addComponent(h);const u=new bD(n,r,l);return xf.set(i,u),u}function tE(t=my){const e=xf.get(t);if(!e&&t===my&&Q1())return eE();if(!e)throw ja.create("no-app",{appName:t});return e}function Ra(t,e,n){let r=gD[t]??t;n&&(r+=`-${n}`);const i=r.match(/\s|\//),o=e.match(/\s|\//);if(i||o){const l=[`Unable to register library "${r}" with version "${e}":`];i&&l.push(`library name "${r}" contains illegal characters (whitespace or "/")`),i&&o&&l.push("and"),o&&l.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Ii.warn(l.join(" "));return}tc(new zo(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}const vD="firebase-heartbeat-database",xD=1,Gu="firebase-heartbeat-store";let qg=null;function nE(){return qg||(qg=z2(vD,xD,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(Gu)}catch(n){console.warn(n)}}}}).catch(t=>{throw ja.create("idb-open",{originalErrorMessage:t.message})})),qg}async function wD(t){try{const n=(await nE()).transaction(Gu),r=await n.objectStore(Gu).get(rE(t));return await n.done,r}catch(e){if(e instanceof Bi)Ii.warn(e.message);else{const n=ja.create("idb-get",{originalErrorMessage:e?.message});Ii.warn(n.message)}}}async function lw(t,e){try{const r=(await nE()).transaction(Gu,"readwrite");await r.objectStore(Gu).put(e,rE(t)),await r.done}catch(n){if(n instanceof Bi)Ii.warn(n.message);else{const r=ja.create("idb-set",{originalErrorMessage:n?.message});Ii.warn(r.message)}}}function rE(t){return`${t.name}!${t.options.appId}`}const SD=1024,ED=30;class CD{constructor(e){this.container=e,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new AD(n),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){try{const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=cw();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(i=>i.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:n}),this._heartbeatsCache.heartbeats.length>ED){const i=jD(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(i,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){Ii.warn(e)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const e=cw(),{heartbeatsToSend:n,unsentEntries:r}=TD(this._heartbeatsCache.heartbeats),i=vf(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(e){return Ii.warn(e),""}}}function cw(){return new Date().toISOString().substring(0,10)}function TD(t,e=SD){const n=[];let r=t.slice();for(const i of t){const o=n.find(l=>l.agent===i.agent);if(o){if(o.dates.push(i.date),uw(n)>e){o.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),uw(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}class AD{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return f2()?m2().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const n=await wD(this.app);return n?.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return lw(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return lw(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function uw(t){return vf(JSON.stringify({version:2,heartbeats:t})).length}function jD(t){if(t.length===0)return-1;let e=0,n=t[0].date;for(let r=1;r<t.length;r++)t[r].date<n&&(n=t[r].date,e=r);return e}function RD(t){tc(new zo("platform-logger",e=>new F2(e),"PRIVATE")),tc(new zo("heartbeat",e=>new CD(e),"PRIVATE")),Ra(fy,aw,t),Ra(fy,aw,"esm2020"),Ra("fire-js","")}RD("");function sE(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const ID=sE,iE=new cd("auth","Firebase",sE());const wf=new t0("@firebase/auth");function DD(t,...e){wf.logLevel<=pt.WARN&&wf.warn(`Auth (${gc}): ${t}`,...e)}function cf(t,...e){wf.logLevel<=pt.ERROR&&wf.error(`Auth (${gc}): ${t}`,...e)}function ms(t,...e){throw s0(t,...e)}function Vs(t,...e){return s0(t,...e)}function aE(t,e,n){const r={...ID(),[e]:n};return new cd("auth","Firebase",r).create(e,{appName:t.name})}function Ia(t){return aE(t,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function s0(t,...e){if(typeof t!="string"){const n=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=t.name),t._errorFactory.create(n,...r)}return iE.create(t,...e)}function Xe(t,e,...n){if(!t)throw s0(e,...n)}function Si(t){const e="INTERNAL ASSERTION FAILED: "+t;throw cf(e),new Error(e)}function Di(t,e){t||Si(e)}function gy(){return typeof self<"u"&&self.location?.href||""}function kD(){return dw()==="http:"||dw()==="https:"}function dw(){return typeof self<"u"&&self.location?.protocol||null}function MD(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(kD()||c2()||"connection"in navigator)?navigator.onLine:!0}function OD(){if(typeof navigator>"u")return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}class dd{constructor(e,n){this.shortDelay=e,this.longDelay=n,Di(n>e,"Short delay should be less than long delay!"),this.isMobile=a2()||u2()}get(){return MD()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function i0(t,e){Di(t.emulator,"Emulator should always be set here");const{url:n}=t.emulator;return e?`${n}${e.startsWith("/")?e.slice(1):e}`:n}class oE{static initialize(e,n,r){this.fetchImpl=e,n&&(this.headersImpl=n),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Si("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Si("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Si("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const ND={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};const PD=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],BD=new dd(3e4,6e4);function Ho(t,e){return t.tenantId&&!e.tenantId?{...e,tenantId:t.tenantId}:e}async function Ga(t,e,n,r,i={}){return lE(t,i,async()=>{let o={},l={};r&&(e==="GET"?l=r:o={body:JSON.stringify(r)});const u=ud({key:t.config.apiKey,...l}).slice(1),h=await t._getAdditionalHeaders();h["Content-Type"]="application/json",t.languageCode&&(h["X-Firebase-Locale"]=t.languageCode);const f={method:e,headers:h,...o};return l2()||(f.referrerPolicy="no-referrer"),t.emulatorConfig&&pc(t.emulatorConfig.host)&&(f.credentials="include"),oE.fetch()(await cE(t,t.config.apiHost,n,u),f)})}async function lE(t,e,n){t._canInitEmulator=!1;const r={...ND,...e};try{const i=new LD(t),o=await Promise.race([n(),i.promise]);i.clearNetworkTimeout();const l=await o.json();if("needConfirmation"in l)throw Xh(t,"account-exists-with-different-credential",l);if(o.ok&&!("errorMessage"in l))return l;{const u=o.ok?l.errorMessage:l.error.message,[h,f]=u.split(" : ");if(h==="FEDERATED_USER_ID_ALREADY_LINKED")throw Xh(t,"credential-already-in-use",l);if(h==="EMAIL_EXISTS")throw Xh(t,"email-already-in-use",l);if(h==="USER_DISABLED")throw Xh(t,"user-disabled",l);const p=r[h]||h.toLowerCase().replace(/[_\s]+/g,"-");if(f)throw aE(t,p,f);ms(t,p)}}catch(i){if(i instanceof Bi)throw i;ms(t,"network-request-failed",{message:String(i)})}}async function Jf(t,e,n,r,i={}){const o=await Ga(t,e,n,r,i);return"mfaPendingCredential"in o&&ms(t,"multi-factor-auth-required",{_serverResponse:o}),o}async function cE(t,e,n,r){const i=`${e}${n}?${r}`,o=t,l=o.config.emulator?i0(t.config,i):`${t.config.apiScheme}://${i}`;return PD.includes(n)&&(await o._persistenceManagerAvailable,o._getPersistenceType()==="COOKIE")?o._getPersistence()._getFinalTarget(l).toString():l}function zD(t){switch(t){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class LD{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((n,r)=>{this.timer=setTimeout(()=>r(Vs(this.auth,"network-request-failed")),BD.get())})}}function Xh(t,e,n){const r={appName:t.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const i=Vs(t,e,r);return i.customData._tokenResponse=n,i}function hw(t){return t!==void 0&&t.enterprise!==void 0}class UD{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const n of this.recaptchaEnforcementState)if(n.provider&&n.provider===e)return zD(n.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function FD(t,e){return Ga(t,"GET","/v2/recaptchaConfig",Ho(t,e))}async function VD(t,e){return Ga(t,"POST","/v1/accounts:delete",e)}async function Sf(t,e){return Ga(t,"POST","/v1/accounts:lookup",e)}function Lu(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function $D(t,e=!1){const n=En(t),r=await n.getIdToken(e),i=a0(r);Xe(i&&i.exp&&i.auth_time&&i.iat,n.auth,"internal-error");const o=typeof i.firebase=="object"?i.firebase:void 0,l=o?.sign_in_provider;return{claims:i,token:r,authTime:Lu(Hg(i.auth_time)),issuedAtTime:Lu(Hg(i.iat)),expirationTime:Lu(Hg(i.exp)),signInProvider:l||null,signInSecondFactor:o?.sign_in_second_factor||null}}function Hg(t){return Number(t)*1e3}function a0(t){const[e,n,r]=t.split(".");if(e===void 0||n===void 0||r===void 0)return cf("JWT malformed, contained fewer than 3 sections"),null;try{const i=G1(n);return i?JSON.parse(i):(cf("Failed to decode base64 JWT payload"),null)}catch(i){return cf("Caught error parsing JWT payload as JSON",i?.toString()),null}}function fw(t){const e=a0(t);return Xe(e,"internal-error"),Xe(typeof e.exp<"u","internal-error"),Xe(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}async function Wu(t,e,n=!1){if(n)return e;try{return await e}catch(r){throw r instanceof Bi&&qD(r)&&t.auth.currentUser===t&&await t.auth.signOut(),r}}function qD({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}class HD{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const n=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),n}else{this.errorBackoff=3e4;const r=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;const n=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},n)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class yy{constructor(e,n){this.createdAt=e,this.lastLoginAt=n,this._initializeTime()}_initializeTime(){this.lastSignInTime=Lu(this.lastLoginAt),this.creationTime=Lu(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function Ef(t){const e=t.auth,n=await t.getIdToken(),r=await Wu(t,Sf(e,{idToken:n}));Xe(r?.users.length,e,"internal-error");const i=r.users[0];t._notifyReloadListener(i);const o=i.providerUserInfo?.length?uE(i.providerUserInfo):[],l=WD(t.providerData,o),u=t.isAnonymous,h=!(t.email&&i.passwordHash)&&!l?.length,f=u?h:!1,p={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:l,metadata:new yy(i.createdAt,i.lastLoginAt),isAnonymous:f};Object.assign(t,p)}async function GD(t){const e=En(t);await Ef(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function WD(t,e){return[...t.filter(r=>!e.some(i=>i.providerId===r.providerId)),...e]}function uE(t){return t.map(({providerId:e,...n})=>({providerId:e,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}))}async function QD(t,e){const n=await lE(t,{},async()=>{const r=ud({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:o}=t.config,l=await cE(t,i,"/v1/token",`key=${o}`),u=await t._getAdditionalHeaders();u["Content-Type"]="application/x-www-form-urlencoded";const h={method:"POST",headers:u,body:r};return t.emulatorConfig&&pc(t.emulatorConfig.host)&&(h.credentials="include"),oE.fetch()(l,h)});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}async function KD(t,e){return Ga(t,"POST","/v2/accounts:revokeToken",Ho(t,e))}class Yl{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Xe(e.idToken,"internal-error"),Xe(typeof e.idToken<"u","internal-error"),Xe(typeof e.refreshToken<"u","internal-error");const n="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):fw(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,n)}updateFromIdToken(e){Xe(e.length!==0,"internal-error");const n=fw(e);this.updateTokensAndExpiration(e,null,n)}async getToken(e,n=!1){return!n&&this.accessToken&&!this.isExpired?this.accessToken:(Xe(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,n){const{accessToken:r,refreshToken:i,expiresIn:o}=await QD(e,n);this.updateTokensAndExpiration(r,i,Number(o))}updateTokensAndExpiration(e,n,r){this.refreshToken=n||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,n){const{refreshToken:r,accessToken:i,expirationTime:o}=n,l=new Yl;return r&&(Xe(typeof r=="string","internal-error",{appName:e}),l.refreshToken=r),i&&(Xe(typeof i=="string","internal-error",{appName:e}),l.accessToken=i),o&&(Xe(typeof o=="number","internal-error",{appName:e}),l.expirationTime=o),l}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Yl,this.toJSON())}_performRefresh(){return Si("not implemented")}}function _a(t,e){Xe(typeof t=="string"||typeof t>"u","internal-error",{appName:e})}class hs{constructor({uid:e,auth:n,stsTokenManager:r,...i}){this.providerId="firebase",this.proactiveRefresh=new HD(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new yy(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const n=await Wu(this,this.stsTokenManager.getToken(this.auth,e));return Xe(n,this.auth,"internal-error"),this.accessToken!==n&&(this.accessToken=n,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),n}getIdTokenResult(e){return $D(this,e)}reload(){return GD(this)}_assign(e){this!==e&&(Xe(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(n=>({...n})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const n=new hs({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return n.metadata._copy(this.metadata),n}_onReload(e){Xe(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,n=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),n&&await Ef(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(ds(this.auth.app))return Promise.reject(Ia(this.auth));const e=await this.getIdToken();return await Wu(this,VD(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,n){const r=n.displayName??void 0,i=n.email??void 0,o=n.phoneNumber??void 0,l=n.photoURL??void 0,u=n.tenantId??void 0,h=n._redirectEventId??void 0,f=n.createdAt??void 0,p=n.lastLoginAt??void 0,{uid:g,emailVerified:b,isAnonymous:_,providerData:w,stsTokenManager:x}=n;Xe(g&&x,e,"internal-error");const S=Yl.fromJSON(this.name,x);Xe(typeof g=="string",e,"internal-error"),_a(r,e.name),_a(i,e.name),Xe(typeof b=="boolean",e,"internal-error"),Xe(typeof _=="boolean",e,"internal-error"),_a(o,e.name),_a(l,e.name),_a(u,e.name),_a(h,e.name),_a(f,e.name),_a(p,e.name);const C=new hs({uid:g,auth:e,email:i,emailVerified:b,displayName:r,isAnonymous:_,photoURL:l,phoneNumber:o,tenantId:u,stsTokenManager:S,createdAt:f,lastLoginAt:p});return w&&Array.isArray(w)&&(C.providerData=w.map(T=>({...T}))),h&&(C._redirectEventId=h),C}static async _fromIdTokenResponse(e,n,r=!1){const i=new Yl;i.updateFromServerResponse(n);const o=new hs({uid:n.localId,auth:e,stsTokenManager:i,isAnonymous:r});return await Ef(o),o}static async _fromGetAccountInfoResponse(e,n,r){const i=n.users[0];Xe(i.localId!==void 0,"internal-error");const o=i.providerUserInfo!==void 0?uE(i.providerUserInfo):[],l=!(i.email&&i.passwordHash)&&!o?.length,u=new Yl;u.updateFromIdToken(r);const h=new hs({uid:i.localId,auth:e,stsTokenManager:u,isAnonymous:l}),f={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:o,metadata:new yy(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!o?.length};return Object.assign(h,f),h}}const mw=new Map;function Ei(t){Di(t instanceof Function,"Expected a class definition");let e=mw.get(t);return e?(Di(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,mw.set(t,e),e)}class dE{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,n){this.storage[e]=n}async _get(e){const n=this.storage[e];return n===void 0?null:n}async _remove(e){delete this.storage[e]}_addListener(e,n){}_removeListener(e,n){}}dE.type="NONE";const pw=dE;function uf(t,e,n){return`firebase:${t}:${e}:${n}`}class Xl{constructor(e,n,r){this.persistence=e,this.auth=n,this.userKey=r;const{config:i,name:o}=this.auth;this.fullUserKey=uf(this.userKey,i.apiKey,o),this.fullPersistenceKey=uf("persistence",i.apiKey,o),this.boundEventHandler=n._onStorageEvent.bind(n),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const n=await Sf(this.auth,{idToken:e}).catch(()=>{});return n?hs._fromGetAccountInfoResponse(this.auth,n,e):null}return hs._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const n=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,n)return this.setCurrentUser(n)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,n,r="authUser"){if(!n.length)return new Xl(Ei(pw),e,r);const i=(await Promise.all(n.map(async f=>{if(await f._isAvailable())return f}))).filter(f=>f);let o=i[0]||Ei(pw);const l=uf(r,e.config.apiKey,e.name);let u=null;for(const f of n)try{const p=await f._get(l);if(p){let g;if(typeof p=="string"){const b=await Sf(e,{idToken:p}).catch(()=>{});if(!b)break;g=await hs._fromGetAccountInfoResponse(e,b,p)}else g=hs._fromJSON(e,p);f!==o&&(u=g),o=f;break}}catch{}const h=i.filter(f=>f._shouldAllowMigration);return!o._shouldAllowMigration||!h.length?new Xl(o,e,r):(o=h[0],u&&await o._set(l,u.toJSON()),await Promise.all(n.map(async f=>{if(f!==o)try{await f._remove(l)}catch{}})),new Xl(o,e,r))}}function gw(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(pE(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(hE(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(yE(e))return"Blackberry";if(_E(e))return"Webos";if(fE(e))return"Safari";if((e.includes("chrome/")||mE(e))&&!e.includes("edge/"))return"Chrome";if(gE(e))return"Android";{const n=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=t.match(n);if(r?.length===2)return r[1]}return"Other"}function hE(t=er()){return/firefox\//i.test(t)}function fE(t=er()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function mE(t=er()){return/crios\//i.test(t)}function pE(t=er()){return/iemobile/i.test(t)}function gE(t=er()){return/android/i.test(t)}function yE(t=er()){return/blackberry/i.test(t)}function _E(t=er()){return/webos/i.test(t)}function o0(t=er()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function YD(t=er()){return o0(t)&&!!window.navigator?.standalone}function XD(){return d2()&&document.documentMode===10}function bE(t=er()){return o0(t)||gE(t)||_E(t)||yE(t)||/windows phone/i.test(t)||pE(t)}function vE(t,e=[]){let n;switch(t){case"Browser":n=gw(er());break;case"Worker":n=`${gw(er())}-${t}`;break;default:n=t}const r=e.length?e.join(","):"FirebaseCore-web";return`${n}/JsCore/${gc}/${r}`}class ZD{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,n){const r=o=>new Promise((l,u)=>{try{const h=e(o);l(h)}catch(h){u(h)}});r.onAbort=n,this.queue.push(r);const i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const n=[];try{for(const r of this.queue)await r(e),r.onAbort&&n.push(r.onAbort)}catch(r){n.reverse();for(const i of n)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r?.message})}}}async function JD(t,e={}){return Ga(t,"GET","/v2/passwordPolicy",Ho(t,e))}const ek=6;class tk{constructor(e){const n=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=n.minPasswordLength??ek,n.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=n.maxPasswordLength),n.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=n.containsLowercaseCharacter),n.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=n.containsUppercaseCharacter),n.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=n.containsNumericCharacter),n.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=n.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const n={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,n),this.validatePasswordCharacterOptions(e,n),n.isValid&&(n.isValid=n.meetsMinPasswordLength??!0),n.isValid&&(n.isValid=n.meetsMaxPasswordLength??!0),n.isValid&&(n.isValid=n.containsLowercaseLetter??!0),n.isValid&&(n.isValid=n.containsUppercaseLetter??!0),n.isValid&&(n.isValid=n.containsNumericCharacter??!0),n.isValid&&(n.isValid=n.containsNonAlphanumericCharacter??!0),n}validatePasswordLengthOptions(e,n){const r=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;r&&(n.meetsMinPasswordLength=e.length>=r),i&&(n.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,n){this.updatePasswordCharacterOptionsStatuses(n,!1,!1,!1,!1);let r;for(let i=0;i<e.length;i++)r=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(n,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,n,r,i,o){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=n)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=o))}}class nk{constructor(e,n,r,i){this.app=e,this.heartbeatServiceProvider=n,this.appCheckServiceProvider=r,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new yw(this),this.idTokenSubscription=new yw(this),this.beforeStateQueue=new ZD(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=iE,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion,this._persistenceManagerAvailable=new Promise(o=>this._resolvePersistenceManagerAvailable=o)}_initializeWithPersistence(e,n){return n&&(this._popupRedirectResolver=Ei(n)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await Xl.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(n),this.lastNotifiedUid=this.currentUser?.uid||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const n=await Sf(this,{idToken:e}),r=await hs._fromGetAccountInfoResponse(this,n,e);await this.directlySetCurrentUser(r)}catch(n){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",n),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(ds(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(l=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(l,l))}):this.directlySetCurrentUser(null)}const n=await this.assertedPersistence.getCurrentUser();let r=n,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=this.redirectUser?._redirectEventId,l=r?._redirectEventId,u=await this.tryRedirectSignIn(e);(!o||o===l)&&u?.user&&(r=u.user,i=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(r)}catch(o){r=n,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return Xe(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let n=null;try{n=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return n}async reloadAndSetCurrentUserOrClear(e){try{await Ef(e)}catch(n){if(n?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=OD()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(ds(this.app))return Promise.reject(Ia(this));const n=e?En(e):null;return n&&Xe(n.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(n&&n._clone(this))}async _updateCurrentUser(e,n=!1){if(!this._deleted)return e&&Xe(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),n||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return ds(this.app)?Promise.reject(Ia(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return ds(this.app)?Promise.reject(Ia(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Ei(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const n=this._getPasswordPolicyInternal();return n.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):n.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await JD(this),n=new tk(e);this.tenantId===null?this._projectPasswordPolicy=n:this._tenantPasswordPolicies[this.tenantId]=n}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new cd("auth","Firebase",e())}onAuthStateChanged(e,n,r){return this.registerStateListener(this.authStateSubscription,e,n,r)}beforeAuthStateChanged(e,n){return this.beforeStateQueue.pushCallback(e,n)}onIdTokenChanged(e,n,r){return this.registerStateListener(this.idTokenSubscription,e,n,r)}authStateReady(){return new Promise((e,n)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},n)}})}async revokeAccessToken(e){if(this.currentUser){const n=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:n};this.tenantId!=null&&(r.tenantId=this.tenantId),await KD(this,r)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,n){const r=await this.getOrInitRedirectPersistenceManager(n);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const n=e&&Ei(e)||this._popupRedirectResolver;Xe(n,this,"argument-error"),this.redirectPersistenceManager=await Xl.create(this,[Ei(n._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,n,r,i){if(this._deleted)return()=>{};const o=typeof n=="function"?n:n.next.bind(n);let l=!1;const u=this._isInitialized?Promise.resolve():this._initializationPromise;if(Xe(u,this,"internal-error"),u.then(()=>{l||o(this.currentUser)}),typeof n=="function"){const h=e.addObserver(n,r,i);return()=>{l=!0,h()}}else{const h=e.addObserver(n);return()=>{l=!0,h()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Xe(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=vE(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const n=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();n&&(e["X-Firebase-Client"]=n);const r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){if(ds(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&DD(`Error while retrieving App Check token: ${e.error}`),e?.token}}function yc(t){return En(t)}class yw{constructor(e){this.auth=e,this.observer=null,this.addObserver=b2(n=>this.observer=n)}get next(){return Xe(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let em={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function rk(t){em=t}function xE(t){return em.loadJS(t)}function sk(){return em.recaptchaEnterpriseScript}function ik(){return em.gapiScript}function ak(t){return`__${t}${Math.floor(Math.random()*1e6)}`}class ok{constructor(){this.enterprise=new lk}ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}class lk{ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}const ck="recaptcha-enterprise",wE="NO_RECAPTCHA";class uk{constructor(e){this.type=ck,this.auth=yc(e)}async verify(e="verify",n=!1){async function r(o){if(!n){if(o.tenantId==null&&o._agentRecaptchaConfig!=null)return o._agentRecaptchaConfig.siteKey;if(o.tenantId!=null&&o._tenantRecaptchaConfigs[o.tenantId]!==void 0)return o._tenantRecaptchaConfigs[o.tenantId].siteKey}return new Promise(async(l,u)=>{FD(o,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(h=>{if(h.recaptchaKey===void 0)u(new Error("recaptcha Enterprise site key undefined"));else{const f=new UD(h);return o.tenantId==null?o._agentRecaptchaConfig=f:o._tenantRecaptchaConfigs[o.tenantId]=f,l(f.siteKey)}}).catch(h=>{u(h)})})}function i(o,l,u){const h=window.grecaptcha;hw(h)?h.enterprise.ready(()=>{h.enterprise.execute(o,{action:e}).then(f=>{l(f)}).catch(()=>{l(wE)})}):u(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new ok().execute("siteKey",{action:"verify"}):new Promise((o,l)=>{r(this.auth).then(u=>{if(!n&&hw(window.grecaptcha))i(u,o,l);else{if(typeof window>"u"){l(new Error("RecaptchaVerifier is only supported in browser"));return}let h=sk();h.length!==0&&(h+=u),xE(h).then(()=>{i(u,o,l)}).catch(f=>{l(f)})}}).catch(u=>{l(u)})})}}async function _w(t,e,n,r=!1,i=!1){const o=new uk(t);let l;if(i)l=wE;else try{l=await o.verify(n)}catch{l=await o.verify(n,!0)}const u={...e};if(n==="mfaSmsEnrollment"||n==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in u){const h=u.phoneEnrollmentInfo.phoneNumber,f=u.phoneEnrollmentInfo.recaptchaToken;Object.assign(u,{phoneEnrollmentInfo:{phoneNumber:h,recaptchaToken:f,captchaResponse:l,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in u){const h=u.phoneSignInInfo.recaptchaToken;Object.assign(u,{phoneSignInInfo:{recaptchaToken:h,captchaResponse:l,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return u}return r?Object.assign(u,{captchaResp:l}):Object.assign(u,{captchaResponse:l}),Object.assign(u,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(u,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),u}async function bw(t,e,n,r,i){if(t._getRecaptchaConfig()?.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const o=await _w(t,e,n,n==="getOobCode");return r(t,o)}else return r(t,e).catch(async o=>{if(o.code==="auth/missing-recaptcha-token"){console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const l=await _w(t,e,n,n==="getOobCode");return r(t,l)}else return Promise.reject(o)})}function dk(t,e){const n=r0(t,"auth");if(n.isInitialized()){const i=n.getImmediate(),o=n.getOptions();if(Ri(o,e??{}))return i;ms(i,"already-initialized")}return n.initialize({options:e})}function hk(t,e){const n=e?.persistence||[],r=(Array.isArray(n)?n:[n]).map(Ei);e?.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(r,e?.popupRedirectResolver)}function fk(t,e,n){const r=yc(t);Xe(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const i=!1,o=SE(e),{host:l,port:u}=mk(e),h=u===null?"":`:${u}`,f={url:`${o}//${l}${h}/`},p=Object.freeze({host:l,port:u,protocol:o.replace(":",""),options:Object.freeze({disableWarnings:i})});if(!r._canInitEmulator){Xe(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),Xe(Ri(f,r.config.emulator)&&Ri(p,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=f,r.emulatorConfig=p,r.settings.appVerificationDisabledForTesting=!0,pc(l)?(Y1(`${o}//${l}${h}`),X1("Auth",!0)):pk()}function SE(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function mk(t){const e=SE(t),n=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){const o=i[1];return{host:o,port:vw(r.substr(o.length+1))}}else{const[o,l]=r.split(":");return{host:o,port:vw(l)}}}function vw(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}function pk(){function t(){const e=document.createElement("p"),n=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",n.position="fixed",n.width="100%",n.backgroundColor="#ffffff",n.border=".1em solid #000000",n.color="#b50000",n.bottom="0px",n.left="0px",n.margin="0px",n.zIndex="10000",n.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",t):t())}class l0{constructor(e,n){this.providerId=e,this.signInMethod=n}toJSON(){return Si("not implemented")}_getIdTokenResponse(e){return Si("not implemented")}_linkToIdToken(e,n){return Si("not implemented")}_getReauthenticationResolver(e){return Si("not implemented")}}async function gk(t,e){return Ga(t,"POST","/v1/accounts:signUp",e)}async function yk(t,e){return Jf(t,"POST","/v1/accounts:signInWithPassword",Ho(t,e))}async function _k(t,e){return Jf(t,"POST","/v1/accounts:signInWithEmailLink",Ho(t,e))}async function bk(t,e){return Jf(t,"POST","/v1/accounts:signInWithEmailLink",Ho(t,e))}class Qu extends l0{constructor(e,n,r,i=null){super("password",r),this._email=e,this._password=n,this._tenantId=i}static _fromEmailAndPassword(e,n){return new Qu(e,n,"password")}static _fromEmailAndCode(e,n,r=null){return new Qu(e,n,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e;if(n?.email&&n?.password){if(n.signInMethod==="password")return this._fromEmailAndPassword(n.email,n.password);if(n.signInMethod==="emailLink")return this._fromEmailAndCode(n.email,n.password,n.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const n={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return bw(e,n,"signInWithPassword",yk);case"emailLink":return _k(e,{email:this._email,oobCode:this._password});default:ms(e,"internal-error")}}async _linkToIdToken(e,n){switch(this.signInMethod){case"password":const r={idToken:n,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return bw(e,r,"signUpPassword",gk);case"emailLink":return bk(e,{idToken:n,email:this._email,oobCode:this._password});default:ms(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function Zl(t,e){return Jf(t,"POST","/v1/accounts:signInWithIdp",Ho(t,e))}const vk="http://localhost";class Lo extends l0{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const n=new Lo(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(n.idToken=e.idToken),e.accessToken&&(n.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(n.nonce=e.nonce),e.pendingToken&&(n.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(n.accessToken=e.oauthToken,n.secret=e.oauthTokenSecret):ms("argument-error"),n}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:i,...o}=n;if(!r||!i)return null;const l=new Lo(r,i);return l.idToken=o.idToken||void 0,l.accessToken=o.accessToken||void 0,l.secret=o.secret,l.nonce=o.nonce,l.pendingToken=o.pendingToken||null,l}_getIdTokenResponse(e){const n=this.buildRequest();return Zl(e,n)}_linkToIdToken(e,n){const r=this.buildRequest();return r.idToken=n,Zl(e,r)}_getReauthenticationResolver(e){const n=this.buildRequest();return n.autoCreate=!1,Zl(e,n)}buildRequest(){const e={requestUri:vk,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const n={};this.idToken&&(n.id_token=this.idToken),this.accessToken&&(n.access_token=this.accessToken),this.secret&&(n.oauth_token_secret=this.secret),n.providerId=this.providerId,this.nonce&&!this.pendingToken&&(n.nonce=this.nonce),e.postBody=ud(n)}return e}}function xk(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function wk(t){const e=ku(Mu(t)).link,n=e?ku(Mu(e)).deep_link_id:null,r=ku(Mu(t)).deep_link_id;return(r?ku(Mu(r)).link:null)||r||n||e||t}class c0{constructor(e){const n=ku(Mu(e)),r=n.apiKey??null,i=n.oobCode??null,o=xk(n.mode??null);Xe(r&&i&&o,"argument-error"),this.apiKey=r,this.operation=o,this.code=i,this.continueUrl=n.continueUrl??null,this.languageCode=n.lang??null,this.tenantId=n.tenantId??null}static parseLink(e){const n=wk(e);try{return new c0(n)}catch{return null}}}class _c{constructor(){this.providerId=_c.PROVIDER_ID}static credential(e,n){return Qu._fromEmailAndPassword(e,n)}static credentialWithLink(e,n){const r=c0.parseLink(n);return Xe(r,"argument-error"),Qu._fromEmailAndCode(e,r.code,r.tenantId)}}_c.PROVIDER_ID="password";_c.EMAIL_PASSWORD_SIGN_IN_METHOD="password";_c.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class EE{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class hd extends EE{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class va extends hd{constructor(){super("facebook.com")}static credential(e){return Lo._fromParams({providerId:va.PROVIDER_ID,signInMethod:va.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return va.credentialFromTaggedObject(e)}static credentialFromError(e){return va.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return va.credential(e.oauthAccessToken)}catch{return null}}}va.FACEBOOK_SIGN_IN_METHOD="facebook.com";va.PROVIDER_ID="facebook.com";class xa extends hd{constructor(){super("google.com"),this.addScope("profile")}static credential(e,n){return Lo._fromParams({providerId:xa.PROVIDER_ID,signInMethod:xa.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:n})}static credentialFromResult(e){return xa.credentialFromTaggedObject(e)}static credentialFromError(e){return xa.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:n,oauthAccessToken:r}=e;if(!n&&!r)return null;try{return xa.credential(n,r)}catch{return null}}}xa.GOOGLE_SIGN_IN_METHOD="google.com";xa.PROVIDER_ID="google.com";class wa extends hd{constructor(){super("github.com")}static credential(e){return Lo._fromParams({providerId:wa.PROVIDER_ID,signInMethod:wa.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return wa.credentialFromTaggedObject(e)}static credentialFromError(e){return wa.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return wa.credential(e.oauthAccessToken)}catch{return null}}}wa.GITHUB_SIGN_IN_METHOD="github.com";wa.PROVIDER_ID="github.com";class Sa extends hd{constructor(){super("twitter.com")}static credential(e,n){return Lo._fromParams({providerId:Sa.PROVIDER_ID,signInMethod:Sa.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:n})}static credentialFromResult(e){return Sa.credentialFromTaggedObject(e)}static credentialFromError(e){return Sa.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:n,oauthTokenSecret:r}=e;if(!n||!r)return null;try{return Sa.credential(n,r)}catch{return null}}}Sa.TWITTER_SIGN_IN_METHOD="twitter.com";Sa.PROVIDER_ID="twitter.com";class nc{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,n,r,i=!1){const o=await hs._fromIdTokenResponse(e,r,i),l=xw(r);return new nc({user:o,providerId:l,_tokenResponse:r,operationType:n})}static async _forOperation(e,n,r){await e._updateTokensIfNecessary(r,!0);const i=xw(r);return new nc({user:e,providerId:i,_tokenResponse:r,operationType:n})}}function xw(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}class Cf extends Bi{constructor(e,n,r,i){super(n.code,n.message),this.operationType=r,this.user=i,Object.setPrototypeOf(this,Cf.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:n.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,n,r,i){return new Cf(e,n,r,i)}}function CE(t,e,n,r){return(e==="reauthenticate"?n._getReauthenticationResolver(t):n._getIdTokenResponse(t)).catch(o=>{throw o.code==="auth/multi-factor-auth-required"?Cf._fromErrorAndOperation(t,o,e,r):o})}async function Sk(t,e,n=!1){const r=await Wu(t,e._linkToIdToken(t.auth,await t.getIdToken()),n);return nc._forOperation(t,"link",r)}async function Ek(t,e,n=!1){const{auth:r}=t;if(ds(r.app))return Promise.reject(Ia(r));const i="reauthenticate";try{const o=await Wu(t,CE(r,i,e,t),n);Xe(o.idToken,r,"internal-error");const l=a0(o.idToken);Xe(l,r,"internal-error");const{sub:u}=l;return Xe(t.uid===u,r,"user-mismatch"),nc._forOperation(t,i,o)}catch(o){throw o?.code==="auth/user-not-found"&&ms(r,"user-mismatch"),o}}async function TE(t,e,n=!1){if(ds(t.app))return Promise.reject(Ia(t));const r="signIn",i=await CE(t,r,e),o=await nc._fromIdTokenResponse(t,r,i);return n||await t._updateCurrentUser(o.user),o}async function Ck(t,e){return TE(yc(t),e)}async function Tk(t){const e=yc(t);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}function Ak(t,e,n){return ds(t.app)?Promise.reject(Ia(t)):Ck(En(t),_c.credential(e,n)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&Tk(t),r})}function jk(t,e,n,r){return En(t).onIdTokenChanged(e,n,r)}function Rk(t,e,n){return En(t).beforeAuthStateChanged(e,n)}function Ik(t,e,n,r){return En(t).onAuthStateChanged(e,n,r)}function Dk(t){return En(t).signOut()}const Tf="__sak";class AE{constructor(e,n){this.storageRetriever=e,this.type=n}_isAvailable(){try{return this.storage?(this.storage.setItem(Tf,"1"),this.storage.removeItem(Tf),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,n){return this.storage.setItem(e,JSON.stringify(n)),Promise.resolve()}_get(e){const n=this.storage.getItem(e);return Promise.resolve(n?JSON.parse(n):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}const kk=1e3,Mk=10;class jE extends AE{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,n)=>this.onStorageEvent(e,n),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=bE(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const n of Object.keys(this.listeners)){const r=this.storage.getItem(n),i=this.localCache[n];r!==i&&e(n,i,r)}}onStorageEvent(e,n=!1){if(!e.key){this.forAllChangedKeys((l,u,h)=>{this.notifyListeners(l,h)});return}const r=e.key;n?this.detachListener():this.stopPolling();const i=()=>{const l=this.storage.getItem(r);!n&&this.localCache[r]===l||this.notifyListeners(r,l)},o=this.storage.getItem(r);XD()&&o!==e.newValue&&e.newValue!==e.oldValue?setTimeout(i,Mk):i()}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const i of Array.from(r))i(n&&JSON.parse(n))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,n,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:n,newValue:r}),!0)})},kk)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,n){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,n){await super._set(e,n),this.localCache[e]=JSON.stringify(n)}async _get(e){const n=await super._get(e);return this.localCache[e]=JSON.stringify(n),n}async _remove(e){await super._remove(e),delete this.localCache[e]}}jE.type="LOCAL";const Ok=jE;class RE extends AE{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,n){}_removeListener(e,n){}}RE.type="SESSION";const IE=RE;function Nk(t){return Promise.all(t.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(n){return{fulfilled:!1,reason:n}}}))}class tm{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const n=this.receivers.find(i=>i.isListeningto(e));if(n)return n;const r=new tm(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const n=e,{eventId:r,eventType:i,data:o}=n.data,l=this.handlersMap[i];if(!l?.size)return;n.ports[0].postMessage({status:"ack",eventId:r,eventType:i});const u=Array.from(l).map(async f=>f(n.origin,o)),h=await Nk(u);n.ports[0].postMessage({status:"done",eventId:r,eventType:i,response:h})}_subscribe(e,n){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(n)}_unsubscribe(e,n){this.handlersMap[e]&&n&&this.handlersMap[e].delete(n),(!n||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}tm.receivers=[];function u0(t="",e=10){let n="";for(let r=0;r<e;r++)n+=Math.floor(Math.random()*10);return t+n}class Pk{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,n,r=50){const i=typeof MessageChannel<"u"?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let o,l;return new Promise((u,h)=>{const f=u0("",20);i.port1.start();const p=setTimeout(()=>{h(new Error("unsupported_event"))},r);l={messageChannel:i,onMessage(g){const b=g;if(b.data.eventId===f)switch(b.data.status){case"ack":clearTimeout(p),o=setTimeout(()=>{h(new Error("timeout"))},3e3);break;case"done":clearTimeout(o),u(b.data.response);break;default:clearTimeout(p),clearTimeout(o),h(new Error("invalid_response"));break}}},this.handlers.add(l),i.port1.addEventListener("message",l.onMessage),this.target.postMessage({eventType:e,eventId:f,data:n},[i.port2])}).finally(()=>{l&&this.removeMessageHandler(l)})}}function $s(){return window}function Bk(t){$s().location.href=t}function DE(){return typeof $s().WorkerGlobalScope<"u"&&typeof $s().importScripts=="function"}async function zk(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function Lk(){return navigator?.serviceWorker?.controller||null}function Uk(){return DE()?self:null}const kE="firebaseLocalStorageDb",Fk=1,Af="firebaseLocalStorage",ME="fbase_key";class fd{constructor(e){this.request=e}toPromise(){return new Promise((e,n)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{n(this.request.error)})})}}function nm(t,e){return t.transaction([Af],e?"readwrite":"readonly").objectStore(Af)}function Vk(){const t=indexedDB.deleteDatabase(kE);return new fd(t).toPromise()}function _y(){const t=indexedDB.open(kE,Fk);return new Promise((e,n)=>{t.addEventListener("error",()=>{n(t.error)}),t.addEventListener("upgradeneeded",()=>{const r=t.result;try{r.createObjectStore(Af,{keyPath:ME})}catch(i){n(i)}}),t.addEventListener("success",async()=>{const r=t.result;r.objectStoreNames.contains(Af)?e(r):(r.close(),await Vk(),e(await _y()))})})}async function ww(t,e,n){const r=nm(t,!0).put({[ME]:e,value:n});return new fd(r).toPromise()}async function $k(t,e){const n=nm(t,!1).get(e),r=await new fd(n).toPromise();return r===void 0?null:r.value}function Sw(t,e){const n=nm(t,!0).delete(e);return new fd(n).toPromise()}const qk=800,Hk=3;class OE{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await _y(),this.db)}async _withRetries(e){let n=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(n++>Hk)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return DE()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=tm._getInstance(Uk()),this.receiver._subscribe("keyChanged",async(e,n)=>({keyProcessed:(await this._poll()).includes(n.key)})),this.receiver._subscribe("ping",async(e,n)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await zk(),!this.activeServiceWorker)return;this.sender=new Pk(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||Lk()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await _y();return await ww(e,Tf,"1"),await Sw(e,Tf),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,n){return this._withPendingWrite(async()=>(await this._withRetries(r=>ww(r,e,n)),this.localCache[e]=n,this.notifyServiceWorker(e)))}async _get(e){const n=await this._withRetries(r=>$k(r,e));return this.localCache[e]=n,n}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(n=>Sw(n,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(i=>{const o=nm(i,!1).getAll();return new fd(o).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const n=[],r=new Set;if(e.length!==0)for(const{fbase_key:i,value:o}of e)r.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(o)&&(this.notifyListeners(i,o),n.push(i));for(const i of Object.keys(this.localCache))this.localCache[i]&&!r.has(i)&&(this.notifyListeners(i,null),n.push(i));return n}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const i of Array.from(r))i(n)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),qk)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,n){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}OE.type="LOCAL";const Gk=OE;new dd(3e4,6e4);function Wk(t,e){return e?Ei(e):(Xe(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}class d0 extends l0{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Zl(e,this._buildIdpRequest())}_linkToIdToken(e,n){return Zl(e,this._buildIdpRequest(n))}_getReauthenticationResolver(e){return Zl(e,this._buildIdpRequest())}_buildIdpRequest(e){const n={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(n.idToken=e),n}}function Qk(t){return TE(t.auth,new d0(t),t.bypassAuthState)}function Kk(t){const{auth:e,user:n}=t;return Xe(n,e,"internal-error"),Ek(n,new d0(t),t.bypassAuthState)}async function Yk(t){const{auth:e,user:n}=t;return Xe(n,e,"internal-error"),Sk(n,new d0(t),t.bypassAuthState)}class NE{constructor(e,n,r,i,o=!1){this.auth=e,this.resolver=r,this.user=i,this.bypassAuthState=o,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(n)?n:[n]}execute(){return new Promise(async(e,n)=>{this.pendingPromise={resolve:e,reject:n};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:n,sessionId:r,postBody:i,tenantId:o,error:l,type:u}=e;if(l){this.reject(l);return}const h={auth:this.auth,requestUri:n,sessionId:r,tenantId:o||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(u)(h))}catch(f){this.reject(f)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Qk;case"linkViaPopup":case"linkViaRedirect":return Yk;case"reauthViaPopup":case"reauthViaRedirect":return Kk;default:ms(this.auth,"internal-error")}}resolve(e){Di(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Di(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const Xk=new dd(2e3,1e4);class Kl extends NE{constructor(e,n,r,i,o){super(e,n,i,o),this.provider=r,this.authWindow=null,this.pollId=null,Kl.currentPopupAction&&Kl.currentPopupAction.cancel(),Kl.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Xe(e,this.auth,"internal-error"),e}async onExecution(){Di(this.filter.length===1,"Popup operations only handle one event");const e=u0();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(n=>{this.reject(n)}),this.resolver._isIframeWebStorageSupported(this.auth,n=>{n||this.reject(Vs(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(Vs(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Kl.currentPopupAction=null}pollUserCancellation(){const e=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Vs(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,Xk.get())};e()}}Kl.currentPopupAction=null;const Zk="pendingRedirect",df=new Map;class Jk extends NE{constructor(e,n,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],n,void 0,r),this.eventId=null}async execute(){let e=df.get(this.auth._key());if(!e){try{const r=await e5(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(n){e=()=>Promise.reject(n)}df.set(this.auth._key(),e)}return this.bypassAuthState||df.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const n=await this.auth._redirectUserForId(e.eventId);if(n)return this.user=n,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function e5(t,e){const n=r5(e),r=n5(t);if(!await r._isAvailable())return!1;const i=await r._get(n)==="true";return await r._remove(n),i}function t5(t,e){df.set(t._key(),e)}function n5(t){return Ei(t._redirectPersistence)}function r5(t){return uf(Zk,t.config.apiKey,t.name)}async function s5(t,e,n=!1){if(ds(t.app))return Promise.reject(Ia(t));const r=yc(t),i=Wk(r,e),l=await new Jk(r,i,n).execute();return l&&!n&&(delete l.user._redirectEventId,await r._persistUserIfCurrent(l.user),await r._setRedirectUser(null,e)),l}const i5=600*1e3;class a5{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let n=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(n=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!o5(e)||(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=e,n=!0)),n}sendToConsumer(e,n){if(e.error&&!PE(e)){const r=e.error.code?.split("auth/")[1]||"internal-error";n.onError(Vs(this.auth,r))}else n.onAuthEvent(e)}isEventForConsumer(e,n){const r=n.eventId===null||!!e.eventId&&e.eventId===n.eventId;return n.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=i5&&this.cachedEventUids.clear(),this.cachedEventUids.has(Ew(e))}saveEventToCache(e){this.cachedEventUids.add(Ew(e)),this.lastProcessedEventTime=Date.now()}}function Ew(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(e=>e).join("-")}function PE({type:t,error:e}){return t==="unknown"&&e?.code==="auth/no-auth-event"}function o5(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return PE(t);default:return!1}}async function l5(t,e={}){return Ga(t,"GET","/v1/projects",e)}const c5=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,u5=/^https?/;async function d5(t){if(t.config.emulator)return;const{authorizedDomains:e}=await l5(t);for(const n of e)try{if(h5(n))return}catch{}ms(t,"unauthorized-domain")}function h5(t){const e=gy(),{protocol:n,hostname:r}=new URL(e);if(t.startsWith("chrome-extension://")){const l=new URL(t);return l.hostname===""&&r===""?n==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):n==="chrome-extension:"&&l.hostname===r}if(!u5.test(n))return!1;if(c5.test(t))return r===t;const i=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}const f5=new dd(3e4,6e4);function Cw(){const t=$s().___jsl;if(t?.H){for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let n=0;n<t.CP.length;n++)t.CP[n]=null}}function m5(t){return new Promise((e,n)=>{function r(){Cw(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{Cw(),n(Vs(t,"network-request-failed"))},timeout:f5.get()})}if($s().gapi?.iframes?.Iframe)e(gapi.iframes.getContext());else if($s().gapi?.load)r();else{const i=ak("iframefcb");return $s()[i]=()=>{gapi.load?r():n(Vs(t,"network-request-failed"))},xE(`${ik()}?onload=${i}`).catch(o=>n(o))}}).catch(e=>{throw hf=null,e})}let hf=null;function p5(t){return hf=hf||m5(t),hf}const g5=new dd(5e3,15e3),y5="__/auth/iframe",_5="emulator/auth/iframe",b5={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},v5=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function x5(t){const e=t.config;Xe(e.authDomain,t,"auth-domain-config-required");const n=e.emulator?i0(e,_5):`https://${t.config.authDomain}/${y5}`,r={apiKey:e.apiKey,appName:t.name,v:gc},i=v5.get(t.config.apiHost);i&&(r.eid=i);const o=t._getFrameworks();return o.length&&(r.fw=o.join(",")),`${n}?${ud(r).slice(1)}`}async function w5(t){const e=await p5(t),n=$s().gapi;return Xe(n,t,"internal-error"),e.open({where:document.body,url:x5(t),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:b5,dontclear:!0},r=>new Promise(async(i,o)=>{await r.restyle({setHideOnLeave:!1});const l=Vs(t,"network-request-failed"),u=$s().setTimeout(()=>{o(l)},g5.get());function h(){$s().clearTimeout(u),i(r)}r.ping(h).then(h,()=>{o(l)})}))}const S5={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},E5=500,C5=600,T5="_blank",A5="http://localhost";class Tw{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function j5(t,e,n,r=E5,i=C5){const o=Math.max((window.screen.availHeight-i)/2,0).toString(),l=Math.max((window.screen.availWidth-r)/2,0).toString();let u="";const h={...S5,width:r.toString(),height:i.toString(),top:o,left:l},f=er().toLowerCase();n&&(u=mE(f)?T5:n),hE(f)&&(e=e||A5,h.scrollbars="yes");const p=Object.entries(h).reduce((b,[_,w])=>`${b}${_}=${w},`,"");if(YD(f)&&u!=="_self")return R5(e||"",u),new Tw(null);const g=window.open(e||"",u,p);Xe(g,t,"popup-blocked");try{g.focus()}catch{}return new Tw(g)}function R5(t,e){const n=document.createElement("a");n.href=t,n.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}const I5="__/auth/handler",D5="emulator/auth/handler",k5=encodeURIComponent("fac");async function Aw(t,e,n,r,i,o){Xe(t.config.authDomain,t,"auth-domain-config-required"),Xe(t.config.apiKey,t,"invalid-api-key");const l={apiKey:t.config.apiKey,appName:t.name,authType:n,redirectUrl:r,v:gc,eventId:i};if(e instanceof EE){e.setDefaultLanguage(t.languageCode),l.providerId=e.providerId||"",_2(e.getCustomParameters())||(l.customParameters=JSON.stringify(e.getCustomParameters()));for(const[p,g]of Object.entries({}))l[p]=g}if(e instanceof hd){const p=e.getScopes().filter(g=>g!=="");p.length>0&&(l.scopes=p.join(","))}t.tenantId&&(l.tid=t.tenantId);const u=l;for(const p of Object.keys(u))u[p]===void 0&&delete u[p];const h=await t._getAppCheckToken(),f=h?`#${k5}=${encodeURIComponent(h)}`:"";return`${M5(t)}?${ud(u).slice(1)}${f}`}function M5({config:t}){return t.emulator?i0(t,D5):`https://${t.authDomain}/${I5}`}const Gg="webStorageSupport";class O5{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=IE,this._completeRedirectFn=s5,this._overrideRedirectResult=t5}async _openPopup(e,n,r,i){Di(this.eventManagers[e._key()]?.manager,"_initialize() not called before _openPopup()");const o=await Aw(e,n,r,gy(),i);return j5(e,o,u0())}async _openRedirect(e,n,r,i){await this._originValidation(e);const o=await Aw(e,n,r,gy(),i);return Bk(o),new Promise(()=>{})}_initialize(e){const n=e._key();if(this.eventManagers[n]){const{manager:i,promise:o}=this.eventManagers[n];return i?Promise.resolve(i):(Di(o,"If manager is not set, promise should be"),o)}const r=this.initAndGetManager(e);return this.eventManagers[n]={promise:r},r.catch(()=>{delete this.eventManagers[n]}),r}async initAndGetManager(e){const n=await w5(e),r=new a5(e);return n.register("authEvent",i=>(Xe(i?.authEvent,e,"invalid-auth-event"),{status:r.onEvent(i.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=n,r}_isIframeWebStorageSupported(e,n){this.iframes[e._key()].send(Gg,{type:Gg},i=>{const o=i?.[0]?.[Gg];o!==void 0&&n(!!o),ms(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const n=e._key();return this.originValidationPromises[n]||(this.originValidationPromises[n]=d5(e)),this.originValidationPromises[n]}get _shouldInitProactively(){return bE()||fE()||o0()}}const N5=O5;var jw="@firebase/auth",Rw="1.12.0";class P5{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const n=this.auth.onIdTokenChanged(r=>{e(r?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,n),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const n=this.internalListeners.get(e);n&&(this.internalListeners.delete(e),n(),this.updateProactiveRefresh())}assertAuthConfigured(){Xe(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function B5(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function z5(t){tc(new zo("auth",(e,{options:n})=>{const r=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),o=e.getProvider("app-check-internal"),{apiKey:l,authDomain:u}=r.options;Xe(l&&!l.includes(":"),"invalid-api-key",{appName:r.name});const h={apiKey:l,authDomain:u,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:vE(t)},f=new nk(r,i,o,h);return hk(f,n),f},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,n,r)=>{e.getProvider("auth-internal").initialize()})),tc(new zo("auth-internal",e=>{const n=yc(e.getProvider("auth").getImmediate());return(r=>new P5(r))(n)},"PRIVATE").setInstantiationMode("EXPLICIT")),Ra(jw,Rw,B5(t)),Ra(jw,Rw,"esm2020")}const L5=300,U5=K1("authIdTokenMaxAge")||L5;let Iw=null;const F5=t=>async e=>{const n=e&&await e.getIdTokenResult(),r=n&&(new Date().getTime()-Date.parse(n.issuedAtTime))/1e3;if(r&&r>U5)return;const i=n?.token;Iw!==i&&(Iw=i,await fetch(t,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))};function V5(t=tE()){const e=r0(t,"auth");if(e.isInitialized())return e.getImmediate();const n=dk(t,{popupRedirectResolver:N5,persistence:[Gk,Ok,IE]}),r=K1("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const o=new URL(r,location.origin);if(location.origin===o.origin){const l=F5(o.toString());Rk(n,l,()=>l(n.currentUser)),jk(n,u=>l(u))}}const i=W1("auth");return i&&fk(n,`http://${i}`),n}function $5(){return document.getElementsByTagName("head")?.[0]??document}rk({loadJS(t){return new Promise((e,n)=>{const r=document.createElement("script");r.setAttribute("src",t),r.onload=e,r.onerror=i=>{const o=Vs("internal-error");o.customData=i,n(o)},r.type="text/javascript",r.charset="UTF-8",$5().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});z5("Browser");var q5="firebase",H5="12.7.0";Ra(q5,H5,"app");const G5={apiKey:"AIzaSyCfvR8bEeW2CXdD31Ec34doRNThnbryXJo",authDomain:"budget-tkl.firebaseapp.com",projectId:"budget-tkl",storageBucket:"budget-tkl.firebasestorage.app",messagingSenderId:"631248313026",appId:"1:631248313026:web:36574d789a42b2d102f95b"},BE=eE(G5);function zi(){const t=V5(BE);async function e(){return!1}async function n(h,f){return Ak(t,h,f)}function r(){return Dk(t)}function i(h){Ik(t,f=>{h(f)})}function o(){return t.currentUser}function l(){const h=t.currentUser;if(!h)throw new Error("Not authenticated");if(!h.email)throw new Error("Email is required but not available for this account");return h.email}return{set_user_listener:i,delete_firebase_user:e,login_firebase_user:n,logout_firebase_user:r,get_current_firebase_user:o,requireUserEmail:l}}var bc=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(t){return this.listeners.add(t),this.onSubscribe(),()=>{this.listeners.delete(t),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},W5={setTimeout:(t,e)=>setTimeout(t,e),clearTimeout:t=>clearTimeout(t),setInterval:(t,e)=>setInterval(t,e),clearInterval:t=>clearInterval(t)},Q5=class{#e=W5;#t=!1;setTimeoutProvider(t){this.#e=t}setTimeout(t,e){return this.#e.setTimeout(t,e)}clearTimeout(t){this.#e.clearTimeout(t)}setInterval(t,e){return this.#e.setInterval(t,e)}clearInterval(t){this.#e.clearInterval(t)}},Mo=new Q5;function K5(t){setTimeout(t,0)}var Uo=typeof window>"u"||"Deno"in globalThis;function cr(){}function Y5(t,e){return typeof t=="function"?t(e):t}function by(t){return typeof t=="number"&&t>=0&&t!==1/0}function zE(t,e){return Math.max(t+(e||0)-Date.now(),0)}function Da(t,e){return typeof t=="function"?t(e):t}function Yr(t,e){return typeof t=="function"?t(e):t}function Dw(t,e){const{type:n="all",exact:r,fetchStatus:i,predicate:o,queryKey:l,stale:u}=t;if(l){if(r){if(e.queryHash!==h0(l,e.options))return!1}else if(!Ku(e.queryKey,l))return!1}if(n!=="all"){const h=e.isActive();if(n==="active"&&!h||n==="inactive"&&h)return!1}return!(typeof u=="boolean"&&e.isStale()!==u||i&&i!==e.state.fetchStatus||o&&!o(e))}function kw(t,e){const{exact:n,status:r,predicate:i,mutationKey:o}=t;if(o){if(!e.options.mutationKey)return!1;if(n){if(Fo(e.options.mutationKey)!==Fo(o))return!1}else if(!Ku(e.options.mutationKey,o))return!1}return!(r&&e.state.status!==r||i&&!i(e))}function h0(t,e){return(e?.queryKeyHashFn||Fo)(t)}function Fo(t){return JSON.stringify(t,(e,n)=>vy(n)?Object.keys(n).sort().reduce((r,i)=>(r[i]=n[i],r),{}):n)}function Ku(t,e){return t===e?!0:typeof t!=typeof e?!1:t&&e&&typeof t=="object"&&typeof e=="object"?Object.keys(e).every(n=>Ku(t[n],e[n])):!1}var X5=Object.prototype.hasOwnProperty;function LE(t,e){if(t===e)return t;const n=Mw(t)&&Mw(e);if(!n&&!(vy(t)&&vy(e)))return e;const i=(n?t:Object.keys(t)).length,o=n?e:Object.keys(e),l=o.length,u=n?new Array(l):{};let h=0;for(let f=0;f<l;f++){const p=n?f:o[f],g=t[p],b=e[p];if(g===b){u[p]=g,(n?f<i:X5.call(t,p))&&h++;continue}if(g===null||b===null||typeof g!="object"||typeof b!="object"){u[p]=b;continue}const _=LE(g,b);u[p]=_,_===g&&h++}return i===l&&h===i?t:u}function jf(t,e){if(!e||Object.keys(t).length!==Object.keys(e).length)return!1;for(const n in t)if(t[n]!==e[n])return!1;return!0}function Mw(t){return Array.isArray(t)&&t.length===Object.keys(t).length}function vy(t){if(!Ow(t))return!1;const e=t.constructor;if(e===void 0)return!0;const n=e.prototype;return!(!Ow(n)||!n.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(t)!==Object.prototype)}function Ow(t){return Object.prototype.toString.call(t)==="[object Object]"}function Z5(t){return new Promise(e=>{Mo.setTimeout(e,t)})}function xy(t,e,n){return typeof n.structuralSharing=="function"?n.structuralSharing(t,e):n.structuralSharing!==!1?LE(t,e):e}function J5(t,e,n=0){const r=[...t,e];return n&&r.length>n?r.slice(1):r}function eM(t,e,n=0){const r=[e,...t];return n&&r.length>n?r.slice(0,-1):r}var f0=Symbol();function UE(t,e){return!t.queryFn&&e?.initialPromise?()=>e.initialPromise:!t.queryFn||t.queryFn===f0?()=>Promise.reject(new Error(`Missing queryFn: '${t.queryHash}'`)):t.queryFn}function FE(t,e){return typeof t=="function"?t(...e):!!t}var tM=class extends bc{#e;#t;#n;constructor(){super(),this.#n=t=>{if(!Uo&&window.addEventListener){const e=()=>t();return window.addEventListener("visibilitychange",e,!1),()=>{window.removeEventListener("visibilitychange",e)}}}}onSubscribe(){this.#t||this.setEventListener(this.#n)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(t){this.#n=t,this.#t?.(),this.#t=t(e=>{typeof e=="boolean"?this.setFocused(e):this.onFocus()})}setFocused(t){this.#e!==t&&(this.#e=t,this.onFocus())}onFocus(){const t=this.isFocused();this.listeners.forEach(e=>{e(t)})}isFocused(){return typeof this.#e=="boolean"?this.#e:globalThis.document?.visibilityState!=="hidden"}},m0=new tM;function wy(){let t,e;const n=new Promise((i,o)=>{t=i,e=o});n.status="pending",n.catch(()=>{});function r(i){Object.assign(n,i),delete n.resolve,delete n.reject}return n.resolve=i=>{r({status:"fulfilled",value:i}),t(i)},n.reject=i=>{r({status:"rejected",reason:i}),e(i)},n}var nM=K5;function rM(){let t=[],e=0,n=u=>{u()},r=u=>{u()},i=nM;const o=u=>{e?t.push(u):i(()=>{n(u)})},l=()=>{const u=t;t=[],u.length&&i(()=>{r(()=>{u.forEach(h=>{n(h)})})})};return{batch:u=>{let h;e++;try{h=u()}finally{e--,e||l()}return h},batchCalls:u=>(...h)=>{o(()=>{u(...h)})},schedule:o,setNotifyFunction:u=>{n=u},setBatchNotifyFunction:u=>{r=u},setScheduler:u=>{i=u}}}var An=rM(),sM=class extends bc{#e=!0;#t;#n;constructor(){super(),this.#n=t=>{if(!Uo&&window.addEventListener){const e=()=>t(!0),n=()=>t(!1);return window.addEventListener("online",e,!1),window.addEventListener("offline",n,!1),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",n)}}}}onSubscribe(){this.#t||this.setEventListener(this.#n)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(t){this.#n=t,this.#t?.(),this.#t=t(this.setOnline.bind(this))}setOnline(t){this.#e!==t&&(this.#e=t,this.listeners.forEach(n=>{n(t)}))}isOnline(){return this.#e}},Rf=new sM;function iM(t){return Math.min(1e3*2**t,3e4)}function VE(t){return(t??"online")==="online"?Rf.isOnline():!0}var Sy=class extends Error{constructor(t){super("CancelledError"),this.revert=t?.revert,this.silent=t?.silent}};function $E(t){let e=!1,n=0,r;const i=wy(),o=()=>i.status!=="pending",l=x=>{if(!o()){const S=new Sy(x);b(S),t.onCancel?.(S)}},u=()=>{e=!0},h=()=>{e=!1},f=()=>m0.isFocused()&&(t.networkMode==="always"||Rf.isOnline())&&t.canRun(),p=()=>VE(t.networkMode)&&t.canRun(),g=x=>{o()||(r?.(),i.resolve(x))},b=x=>{o()||(r?.(),i.reject(x))},_=()=>new Promise(x=>{r=S=>{(o()||f())&&x(S)},t.onPause?.()}).then(()=>{r=void 0,o()||t.onContinue?.()}),w=()=>{if(o())return;let x;const S=n===0?t.initialPromise:void 0;try{x=S??t.fn()}catch(C){x=Promise.reject(C)}Promise.resolve(x).then(g).catch(C=>{if(o())return;const T=t.retry??(Uo?0:3),I=t.retryDelay??iM,M=typeof I=="function"?I(n,C):I,U=T===!0||typeof T=="number"&&n<T||typeof T=="function"&&T(n,C);if(e||!U){b(C);return}n++,t.onFail?.(n,C),Z5(M).then(()=>f()?void 0:_()).then(()=>{e?b(C):w()})})};return{promise:i,status:()=>i.status,cancel:l,continue:()=>(r?.(),i),cancelRetry:u,continueRetry:h,canStart:p,start:()=>(p()?w():_().then(w),i)}}var qE=class{#e;destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),by(this.gcTime)&&(this.#e=Mo.setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(t){this.gcTime=Math.max(this.gcTime||0,t??(Uo?1/0:300*1e3))}clearGcTimeout(){this.#e&&(Mo.clearTimeout(this.#e),this.#e=void 0)}},aM=class extends qE{#e;#t;#n;#s;#r;#a;#o;constructor(e){super(),this.#o=!1,this.#a=e.defaultOptions,this.setOptions(e.options),this.observers=[],this.#s=e.client,this.#n=this.#s.getQueryCache(),this.queryKey=e.queryKey,this.queryHash=e.queryHash,this.#e=Pw(this.options),this.state=e.state??this.#e,this.scheduleGc()}get meta(){return this.options.meta}get promise(){return this.#r?.promise}setOptions(e){if(this.options={...this.#a,...e},this.updateGcTime(this.options.gcTime),this.state&&this.state.data===void 0){const n=Pw(this.options);n.data!==void 0&&(this.setState(Nw(n.data,n.dataUpdatedAt)),this.#e=n)}}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&this.#n.remove(this)}setData(e,n){const r=xy(this.state.data,e,this.options);return this.#i({data:r,type:"success",dataUpdatedAt:n?.updatedAt,manual:n?.manual}),r}setState(e,n){this.#i({type:"setState",state:e,setStateOptions:n})}cancel(e){const n=this.#r?.promise;return this.#r?.cancel(e),n?n.then(cr).catch(cr):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(this.#e)}isActive(){return this.observers.some(e=>Yr(e.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===f0||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(e=>Da(e.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(e=>e.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(e=0){return this.state.data===void 0?!0:e==="static"?!1:this.state.isInvalidated?!0:!zE(this.state.dataUpdatedAt,e)}onFocus(){this.observers.find(n=>n.shouldFetchOnWindowFocus())?.refetch({cancelRefetch:!1}),this.#r?.continue()}onOnline(){this.observers.find(n=>n.shouldFetchOnReconnect())?.refetch({cancelRefetch:!1}),this.#r?.continue()}addObserver(e){this.observers.includes(e)||(this.observers.push(e),this.clearGcTimeout(),this.#n.notify({type:"observerAdded",query:this,observer:e}))}removeObserver(e){this.observers.includes(e)&&(this.observers=this.observers.filter(n=>n!==e),this.observers.length||(this.#r&&(this.#o?this.#r.cancel({revert:!0}):this.#r.cancelRetry()),this.scheduleGc()),this.#n.notify({type:"observerRemoved",query:this,observer:e}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||this.#i({type:"invalidate"})}async fetch(e,n){if(this.state.fetchStatus!=="idle"&&this.#r?.status()!=="rejected"){if(this.state.data!==void 0&&n?.cancelRefetch)this.cancel({silent:!0});else if(this.#r)return this.#r.continueRetry(),this.#r.promise}if(e&&this.setOptions(e),!this.options.queryFn){const h=this.observers.find(f=>f.options.queryFn);h&&this.setOptions(h.options)}const r=new AbortController,i=h=>{Object.defineProperty(h,"signal",{enumerable:!0,get:()=>(this.#o=!0,r.signal)})},o=()=>{const h=UE(this.options,n),p=(()=>{const g={client:this.#s,queryKey:this.queryKey,meta:this.meta};return i(g),g})();return this.#o=!1,this.options.persister?this.options.persister(h,p,this):h(p)},u=(()=>{const h={fetchOptions:n,options:this.options,queryKey:this.queryKey,client:this.#s,state:this.state,fetchFn:o};return i(h),h})();this.options.behavior?.onFetch(u,this),this.#t=this.state,(this.state.fetchStatus==="idle"||this.state.fetchMeta!==u.fetchOptions?.meta)&&this.#i({type:"fetch",meta:u.fetchOptions?.meta}),this.#r=$E({initialPromise:n?.initialPromise,fn:u.fetchFn,onCancel:h=>{h instanceof Sy&&h.revert&&this.setState({...this.#t,fetchStatus:"idle"}),r.abort()},onFail:(h,f)=>{this.#i({type:"failed",failureCount:h,error:f})},onPause:()=>{this.#i({type:"pause"})},onContinue:()=>{this.#i({type:"continue"})},retry:u.options.retry,retryDelay:u.options.retryDelay,networkMode:u.options.networkMode,canRun:()=>!0});try{const h=await this.#r.start();if(h===void 0)throw new Error(`${this.queryHash} data is undefined`);return this.setData(h),this.#n.config.onSuccess?.(h,this),this.#n.config.onSettled?.(h,this.state.error,this),h}catch(h){if(h instanceof Sy){if(h.silent)return this.#r.promise;if(h.revert){if(this.state.data===void 0)throw h;return this.state.data}}throw this.#i({type:"error",error:h}),this.#n.config.onError?.(h,this),this.#n.config.onSettled?.(this.state.data,h,this),h}finally{this.scheduleGc()}}#i(e){const n=r=>{switch(e.type){case"failed":return{...r,fetchFailureCount:e.failureCount,fetchFailureReason:e.error};case"pause":return{...r,fetchStatus:"paused"};case"continue":return{...r,fetchStatus:"fetching"};case"fetch":return{...r,...HE(r.data,this.options),fetchMeta:e.meta??null};case"success":const i={...r,...Nw(e.data,e.dataUpdatedAt),dataUpdateCount:r.dataUpdateCount+1,...!e.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return this.#t=e.manual?i:void 0,i;case"error":const o=e.error;return{...r,error:o,errorUpdateCount:r.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:r.fetchFailureCount+1,fetchFailureReason:o,fetchStatus:"idle",status:"error"};case"invalidate":return{...r,isInvalidated:!0};case"setState":return{...r,...e.state}}};this.state=n(this.state),An.batch(()=>{this.observers.forEach(r=>{r.onQueryUpdate()}),this.#n.notify({query:this,type:"updated",action:e})})}};function HE(t,e){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:VE(e.networkMode)?"fetching":"paused",...t===void 0&&{error:null,status:"pending"}}}function Nw(t,e){return{data:t,dataUpdatedAt:e??Date.now(),error:null,isInvalidated:!1,status:"success"}}function Pw(t){const e=typeof t.initialData=="function"?t.initialData():t.initialData,n=e!==void 0,r=n?typeof t.initialDataUpdatedAt=="function"?t.initialDataUpdatedAt():t.initialDataUpdatedAt:0;return{data:e,dataUpdateCount:0,dataUpdatedAt:n?r??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:n?"success":"pending",fetchStatus:"idle"}}var oM=class extends bc{constructor(t,e){super(),this.options=e,this.#e=t,this.#i=null,this.#o=wy(),this.bindMethods(),this.setOptions(e)}#e;#t=void 0;#n=void 0;#s=void 0;#r;#a;#o;#i;#p;#h;#f;#c;#u;#l;#m=new Set;bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(this.#t.addObserver(this),Bw(this.#t,this.options)?this.#d():this.updateResult(),this.#b())}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return Ey(this.#t,this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return Ey(this.#t,this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,this.#v(),this.#x(),this.#t.removeObserver(this)}setOptions(t){const e=this.options,n=this.#t;if(this.options=this.#e.defaultQueryOptions(t),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof Yr(this.options.enabled,this.#t)!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");this.#w(),this.#t.setOptions(this.options),e._defaulted&&!jf(this.options,e)&&this.#e.getQueryCache().notify({type:"observerOptionsUpdated",query:this.#t,observer:this});const r=this.hasListeners();r&&zw(this.#t,n,this.options,e)&&this.#d(),this.updateResult(),r&&(this.#t!==n||Yr(this.options.enabled,this.#t)!==Yr(e.enabled,this.#t)||Da(this.options.staleTime,this.#t)!==Da(e.staleTime,this.#t))&&this.#g();const i=this.#y();r&&(this.#t!==n||Yr(this.options.enabled,this.#t)!==Yr(e.enabled,this.#t)||i!==this.#l)&&this.#_(i)}getOptimisticResult(t){const e=this.#e.getQueryCache().build(this.#e,t),n=this.createResult(e,t);return cM(this,n)&&(this.#s=n,this.#a=this.options,this.#r=this.#t.state),n}getCurrentResult(){return this.#s}trackResult(t,e){return new Proxy(t,{get:(n,r)=>(this.trackProp(r),e?.(r),r==="promise"&&(this.trackProp("data"),!this.options.experimental_prefetchInRender&&this.#o.status==="pending"&&this.#o.reject(new Error("experimental_prefetchInRender feature flag is not enabled"))),Reflect.get(n,r))})}trackProp(t){this.#m.add(t)}getCurrentQuery(){return this.#t}refetch({...t}={}){return this.fetch({...t})}fetchOptimistic(t){const e=this.#e.defaultQueryOptions(t),n=this.#e.getQueryCache().build(this.#e,e);return n.fetch().then(()=>this.createResult(n,e))}fetch(t){return this.#d({...t,cancelRefetch:t.cancelRefetch??!0}).then(()=>(this.updateResult(),this.#s))}#d(t){this.#w();let e=this.#t.fetch(this.options,t);return t?.throwOnError||(e=e.catch(cr)),e}#g(){this.#v();const t=Da(this.options.staleTime,this.#t);if(Uo||this.#s.isStale||!by(t))return;const n=zE(this.#s.dataUpdatedAt,t)+1;this.#c=Mo.setTimeout(()=>{this.#s.isStale||this.updateResult()},n)}#y(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(this.#t):this.options.refetchInterval)??!1}#_(t){this.#x(),this.#l=t,!(Uo||Yr(this.options.enabled,this.#t)===!1||!by(this.#l)||this.#l===0)&&(this.#u=Mo.setInterval(()=>{(this.options.refetchIntervalInBackground||m0.isFocused())&&this.#d()},this.#l))}#b(){this.#g(),this.#_(this.#y())}#v(){this.#c&&(Mo.clearTimeout(this.#c),this.#c=void 0)}#x(){this.#u&&(Mo.clearInterval(this.#u),this.#u=void 0)}createResult(t,e){const n=this.#t,r=this.options,i=this.#s,o=this.#r,l=this.#a,h=t!==n?t.state:this.#n,{state:f}=t;let p={...f},g=!1,b;if(e._optimisticResults){const P=this.hasListeners(),N=!P&&Bw(t,e),V=P&&zw(t,n,e,r);(N||V)&&(p={...p,...HE(f.data,t.options)}),e._optimisticResults==="isRestoring"&&(p.fetchStatus="idle")}let{error:_,errorUpdatedAt:w,status:x}=p;b=p.data;let S=!1;if(e.placeholderData!==void 0&&b===void 0&&x==="pending"){let P;i?.isPlaceholderData&&e.placeholderData===l?.placeholderData?(P=i.data,S=!0):P=typeof e.placeholderData=="function"?e.placeholderData(this.#f?.state.data,this.#f):e.placeholderData,P!==void 0&&(x="success",b=xy(i?.data,P,e),g=!0)}if(e.select&&b!==void 0&&!S)if(i&&b===o?.data&&e.select===this.#p)b=this.#h;else try{this.#p=e.select,b=e.select(b),b=xy(i?.data,b,e),this.#h=b,this.#i=null}catch(P){this.#i=P}this.#i&&(_=this.#i,b=this.#h,w=Date.now(),x="error");const C=p.fetchStatus==="fetching",T=x==="pending",I=x==="error",M=T&&C,U=b!==void 0,O={status:x,fetchStatus:p.fetchStatus,isPending:T,isSuccess:x==="success",isError:I,isInitialLoading:M,isLoading:M,data:b,dataUpdatedAt:p.dataUpdatedAt,error:_,errorUpdatedAt:w,failureCount:p.fetchFailureCount,failureReason:p.fetchFailureReason,errorUpdateCount:p.errorUpdateCount,isFetched:p.dataUpdateCount>0||p.errorUpdateCount>0,isFetchedAfterMount:p.dataUpdateCount>h.dataUpdateCount||p.errorUpdateCount>h.errorUpdateCount,isFetching:C,isRefetching:C&&!T,isLoadingError:I&&!U,isPaused:p.fetchStatus==="paused",isPlaceholderData:g,isRefetchError:I&&U,isStale:p0(t,e),refetch:this.refetch,promise:this.#o,isEnabled:Yr(e.enabled,t)!==!1};if(this.options.experimental_prefetchInRender){const P=$=>{O.status==="error"?$.reject(O.error):O.data!==void 0&&$.resolve(O.data)},N=()=>{const $=this.#o=O.promise=wy();P($)},V=this.#o;switch(V.status){case"pending":t.queryHash===n.queryHash&&P(V);break;case"fulfilled":(O.status==="error"||O.data!==V.value)&&N();break;case"rejected":(O.status!=="error"||O.error!==V.reason)&&N();break}}return O}updateResult(){const t=this.#s,e=this.createResult(this.#t,this.options);if(this.#r=this.#t.state,this.#a=this.options,this.#r.data!==void 0&&(this.#f=this.#t),jf(e,t))return;this.#s=e;const n=()=>{if(!t)return!0;const{notifyOnChangeProps:r}=this.options,i=typeof r=="function"?r():r;if(i==="all"||!i&&!this.#m.size)return!0;const o=new Set(i??this.#m);return this.options.throwOnError&&o.add("error"),Object.keys(this.#s).some(l=>{const u=l;return this.#s[u]!==t[u]&&o.has(u)})};this.#S({listeners:n()})}#w(){const t=this.#e.getQueryCache().build(this.#e,this.options);if(t===this.#t)return;const e=this.#t;this.#t=t,this.#n=t.state,this.hasListeners()&&(e?.removeObserver(this),t.addObserver(this))}onQueryUpdate(){this.updateResult(),this.hasListeners()&&this.#b()}#S(t){An.batch(()=>{t.listeners&&this.listeners.forEach(e=>{e(this.#s)}),this.#e.getQueryCache().notify({query:this.#t,type:"observerResultsUpdated"})})}};function lM(t,e){return Yr(e.enabled,t)!==!1&&t.state.data===void 0&&!(t.state.status==="error"&&e.retryOnMount===!1)}function Bw(t,e){return lM(t,e)||t.state.data!==void 0&&Ey(t,e,e.refetchOnMount)}function Ey(t,e,n){if(Yr(e.enabled,t)!==!1&&Da(e.staleTime,t)!=="static"){const r=typeof n=="function"?n(t):n;return r==="always"||r!==!1&&p0(t,e)}return!1}function zw(t,e,n,r){return(t!==e||Yr(r.enabled,t)===!1)&&(!n.suspense||t.state.status!=="error")&&p0(t,n)}function p0(t,e){return Yr(e.enabled,t)!==!1&&t.isStaleByTime(Da(e.staleTime,t))}function cM(t,e){return!jf(t.getCurrentResult(),e)}function Lw(t){return{onFetch:(e,n)=>{const r=e.options,i=e.fetchOptions?.meta?.fetchMore?.direction,o=e.state.data?.pages||[],l=e.state.data?.pageParams||[];let u={pages:[],pageParams:[]},h=0;const f=async()=>{let p=!1;const g=w=>{Object.defineProperty(w,"signal",{enumerable:!0,get:()=>(e.signal.aborted?p=!0:e.signal.addEventListener("abort",()=>{p=!0}),e.signal)})},b=UE(e.options,e.fetchOptions),_=async(w,x,S)=>{if(p)return Promise.reject();if(x==null&&w.pages.length)return Promise.resolve(w);const T=(()=>{const H={client:e.client,queryKey:e.queryKey,pageParam:x,direction:S?"backward":"forward",meta:e.options.meta};return g(H),H})(),I=await b(T),{maxPages:M}=e.options,U=S?eM:J5;return{pages:U(w.pages,I,M),pageParams:U(w.pageParams,x,M)}};if(i&&o.length){const w=i==="backward",x=w?uM:Uw,S={pages:o,pageParams:l},C=x(r,S);u=await _(S,C,w)}else{const w=t??o.length;do{const x=h===0?l[0]??r.initialPageParam:Uw(r,u);if(h>0&&x==null)break;u=await _(u,x),h++}while(h<w)}return u};e.options.persister?e.fetchFn=()=>e.options.persister?.(f,{client:e.client,queryKey:e.queryKey,meta:e.options.meta,signal:e.signal},n):e.fetchFn=f}}}function Uw(t,{pages:e,pageParams:n}){const r=e.length-1;return e.length>0?t.getNextPageParam(e[r],e,n[r],n):void 0}function uM(t,{pages:e,pageParams:n}){return e.length>0?t.getPreviousPageParam?.(e[0],e,n[0],n):void 0}var dM=class extends qE{#e;#t;#n;#s;constructor(e){super(),this.#e=e.client,this.mutationId=e.mutationId,this.#n=e.mutationCache,this.#t=[],this.state=e.state||GE(),this.setOptions(e.options),this.scheduleGc()}setOptions(e){this.options=e,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(e){this.#t.includes(e)||(this.#t.push(e),this.clearGcTimeout(),this.#n.notify({type:"observerAdded",mutation:this,observer:e}))}removeObserver(e){this.#t=this.#t.filter(n=>n!==e),this.scheduleGc(),this.#n.notify({type:"observerRemoved",mutation:this,observer:e})}optionalRemove(){this.#t.length||(this.state.status==="pending"?this.scheduleGc():this.#n.remove(this))}continue(){return this.#s?.continue()??this.execute(this.state.variables)}async execute(e){const n=()=>{this.#r({type:"continue"})},r={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};this.#s=$E({fn:()=>this.options.mutationFn?this.options.mutationFn(e,r):Promise.reject(new Error("No mutationFn found")),onFail:(l,u)=>{this.#r({type:"failed",failureCount:l,error:u})},onPause:()=>{this.#r({type:"pause"})},onContinue:n,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>this.#n.canRun(this)});const i=this.state.status==="pending",o=!this.#s.canStart();try{if(i)n();else{this.#r({type:"pending",variables:e,isPaused:o}),await this.#n.config.onMutate?.(e,this,r);const u=await this.options.onMutate?.(e,r);u!==this.state.context&&this.#r({type:"pending",context:u,variables:e,isPaused:o})}const l=await this.#s.start();return await this.#n.config.onSuccess?.(l,e,this.state.context,this,r),await this.options.onSuccess?.(l,e,this.state.context,r),await this.#n.config.onSettled?.(l,null,this.state.variables,this.state.context,this,r),await this.options.onSettled?.(l,null,e,this.state.context,r),this.#r({type:"success",data:l}),l}catch(l){try{throw await this.#n.config.onError?.(l,e,this.state.context,this,r),await this.options.onError?.(l,e,this.state.context,r),await this.#n.config.onSettled?.(void 0,l,this.state.variables,this.state.context,this,r),await this.options.onSettled?.(void 0,l,e,this.state.context,r),l}finally{this.#r({type:"error",error:l})}}finally{this.#n.runNext(this)}}#r(e){const n=r=>{switch(e.type){case"failed":return{...r,failureCount:e.failureCount,failureReason:e.error};case"pause":return{...r,isPaused:!0};case"continue":return{...r,isPaused:!1};case"pending":return{...r,context:e.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:e.isPaused,status:"pending",variables:e.variables,submittedAt:Date.now()};case"success":return{...r,data:e.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...r,data:void 0,error:e.error,failureCount:r.failureCount+1,failureReason:e.error,isPaused:!1,status:"error"}}};this.state=n(this.state),An.batch(()=>{this.#t.forEach(r=>{r.onMutationUpdate(e)}),this.#n.notify({mutation:this,type:"updated",action:e})})}};function GE(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var hM=class extends bc{constructor(t={}){super(),this.config=t,this.#e=new Set,this.#t=new Map,this.#n=0}#e;#t;#n;build(t,e,n){const r=new dM({client:t,mutationCache:this,mutationId:++this.#n,options:t.defaultMutationOptions(e),state:n});return this.add(r),r}add(t){this.#e.add(t);const e=Zh(t);if(typeof e=="string"){const n=this.#t.get(e);n?n.push(t):this.#t.set(e,[t])}this.notify({type:"added",mutation:t})}remove(t){if(this.#e.delete(t)){const e=Zh(t);if(typeof e=="string"){const n=this.#t.get(e);if(n)if(n.length>1){const r=n.indexOf(t);r!==-1&&n.splice(r,1)}else n[0]===t&&this.#t.delete(e)}}this.notify({type:"removed",mutation:t})}canRun(t){const e=Zh(t);if(typeof e=="string"){const r=this.#t.get(e)?.find(i=>i.state.status==="pending");return!r||r===t}else return!0}runNext(t){const e=Zh(t);return typeof e=="string"?this.#t.get(e)?.find(r=>r!==t&&r.state.isPaused)?.continue()??Promise.resolve():Promise.resolve()}clear(){An.batch(()=>{this.#e.forEach(t=>{this.notify({type:"removed",mutation:t})}),this.#e.clear(),this.#t.clear()})}getAll(){return Array.from(this.#e)}find(t){const e={exact:!0,...t};return this.getAll().find(n=>kw(e,n))}findAll(t={}){return this.getAll().filter(e=>kw(t,e))}notify(t){An.batch(()=>{this.listeners.forEach(e=>{e(t)})})}resumePausedMutations(){const t=this.getAll().filter(e=>e.state.isPaused);return An.batch(()=>Promise.all(t.map(e=>e.continue().catch(cr))))}};function Zh(t){return t.options.scope?.id}var fM=class extends bc{#e;#t=void 0;#n;#s;constructor(e,n){super(),this.#e=e,this.setOptions(n),this.bindMethods(),this.#r()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){const n=this.options;this.options=this.#e.defaultMutationOptions(e),jf(this.options,n)||this.#e.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#n,observer:this}),n?.mutationKey&&this.options.mutationKey&&Fo(n.mutationKey)!==Fo(this.options.mutationKey)?this.reset():this.#n?.state.status==="pending"&&this.#n.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#n?.removeObserver(this)}onMutationUpdate(e){this.#r(),this.#a(e)}getCurrentResult(){return this.#t}reset(){this.#n?.removeObserver(this),this.#n=void 0,this.#r(),this.#a()}mutate(e,n){return this.#s=n,this.#n?.removeObserver(this),this.#n=this.#e.getMutationCache().build(this.#e,this.options),this.#n.addObserver(this),this.#n.execute(e)}#r(){const e=this.#n?.state??GE();this.#t={...e,isPending:e.status==="pending",isSuccess:e.status==="success",isError:e.status==="error",isIdle:e.status==="idle",mutate:this.mutate,reset:this.reset}}#a(e){An.batch(()=>{if(this.#s&&this.hasListeners()){const n=this.#t.variables,r=this.#t.context,i={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};e?.type==="success"?(this.#s.onSuccess?.(e.data,n,r,i),this.#s.onSettled?.(e.data,null,n,r,i)):e?.type==="error"&&(this.#s.onError?.(e.error,n,r,i),this.#s.onSettled?.(void 0,e.error,n,r,i))}this.listeners.forEach(n=>{n(this.#t)})})}},mM=class extends bc{constructor(t={}){super(),this.config=t,this.#e=new Map}#e;build(t,e,n){const r=e.queryKey,i=e.queryHash??h0(r,e);let o=this.get(i);return o||(o=new aM({client:t,queryKey:r,queryHash:i,options:t.defaultQueryOptions(e),state:n,defaultOptions:t.getQueryDefaults(r)}),this.add(o)),o}add(t){this.#e.has(t.queryHash)||(this.#e.set(t.queryHash,t),this.notify({type:"added",query:t}))}remove(t){const e=this.#e.get(t.queryHash);e&&(t.destroy(),e===t&&this.#e.delete(t.queryHash),this.notify({type:"removed",query:t}))}clear(){An.batch(()=>{this.getAll().forEach(t=>{this.remove(t)})})}get(t){return this.#e.get(t)}getAll(){return[...this.#e.values()]}find(t){const e={exact:!0,...t};return this.getAll().find(n=>Dw(e,n))}findAll(t={}){const e=this.getAll();return Object.keys(t).length>0?e.filter(n=>Dw(t,n)):e}notify(t){An.batch(()=>{this.listeners.forEach(e=>{e(t)})})}onFocus(){An.batch(()=>{this.getAll().forEach(t=>{t.onFocus()})})}onOnline(){An.batch(()=>{this.getAll().forEach(t=>{t.onOnline()})})}},pM=class{#e;#t;#n;#s;#r;#a;#o;#i;constructor(t={}){this.#e=t.queryCache||new mM,this.#t=t.mutationCache||new hM,this.#n=t.defaultOptions||{},this.#s=new Map,this.#r=new Map,this.#a=0}mount(){this.#a++,this.#a===1&&(this.#o=m0.subscribe(async t=>{t&&(await this.resumePausedMutations(),this.#e.onFocus())}),this.#i=Rf.subscribe(async t=>{t&&(await this.resumePausedMutations(),this.#e.onOnline())}))}unmount(){this.#a--,this.#a===0&&(this.#o?.(),this.#o=void 0,this.#i?.(),this.#i=void 0)}isFetching(t){return this.#e.findAll({...t,fetchStatus:"fetching"}).length}isMutating(t){return this.#t.findAll({...t,status:"pending"}).length}getQueryData(t){const e=this.defaultQueryOptions({queryKey:t});return this.#e.get(e.queryHash)?.state.data}ensureQueryData(t){const e=this.defaultQueryOptions(t),n=this.#e.build(this,e),r=n.state.data;return r===void 0?this.fetchQuery(t):(t.revalidateIfStale&&n.isStaleByTime(Da(e.staleTime,n))&&this.prefetchQuery(e),Promise.resolve(r))}getQueriesData(t){return this.#e.findAll(t).map(({queryKey:e,state:n})=>{const r=n.data;return[e,r]})}setQueryData(t,e,n){const r=this.defaultQueryOptions({queryKey:t}),o=this.#e.get(r.queryHash)?.state.data,l=Y5(e,o);if(l!==void 0)return this.#e.build(this,r).setData(l,{...n,manual:!0})}setQueriesData(t,e,n){return An.batch(()=>this.#e.findAll(t).map(({queryKey:r})=>[r,this.setQueryData(r,e,n)]))}getQueryState(t){const e=this.defaultQueryOptions({queryKey:t});return this.#e.get(e.queryHash)?.state}removeQueries(t){const e=this.#e;An.batch(()=>{e.findAll(t).forEach(n=>{e.remove(n)})})}resetQueries(t,e){const n=this.#e;return An.batch(()=>(n.findAll(t).forEach(r=>{r.reset()}),this.refetchQueries({type:"active",...t},e)))}cancelQueries(t,e={}){const n={revert:!0,...e},r=An.batch(()=>this.#e.findAll(t).map(i=>i.cancel(n)));return Promise.all(r).then(cr).catch(cr)}invalidateQueries(t,e={}){return An.batch(()=>(this.#e.findAll(t).forEach(n=>{n.invalidate()}),t?.refetchType==="none"?Promise.resolve():this.refetchQueries({...t,type:t?.refetchType??t?.type??"active"},e)))}refetchQueries(t,e={}){const n={...e,cancelRefetch:e.cancelRefetch??!0},r=An.batch(()=>this.#e.findAll(t).filter(i=>!i.isDisabled()&&!i.isStatic()).map(i=>{let o=i.fetch(void 0,n);return n.throwOnError||(o=o.catch(cr)),i.state.fetchStatus==="paused"?Promise.resolve():o}));return Promise.all(r).then(cr)}fetchQuery(t){const e=this.defaultQueryOptions(t);e.retry===void 0&&(e.retry=!1);const n=this.#e.build(this,e);return n.isStaleByTime(Da(e.staleTime,n))?n.fetch(e):Promise.resolve(n.state.data)}prefetchQuery(t){return this.fetchQuery(t).then(cr).catch(cr)}fetchInfiniteQuery(t){return t.behavior=Lw(t.pages),this.fetchQuery(t)}prefetchInfiniteQuery(t){return this.fetchInfiniteQuery(t).then(cr).catch(cr)}ensureInfiniteQueryData(t){return t.behavior=Lw(t.pages),this.ensureQueryData(t)}resumePausedMutations(){return Rf.isOnline()?this.#t.resumePausedMutations():Promise.resolve()}getQueryCache(){return this.#e}getMutationCache(){return this.#t}getDefaultOptions(){return this.#n}setDefaultOptions(t){this.#n=t}setQueryDefaults(t,e){this.#s.set(Fo(t),{queryKey:t,defaultOptions:e})}getQueryDefaults(t){const e=[...this.#s.values()],n={};return e.forEach(r=>{Ku(t,r.queryKey)&&Object.assign(n,r.defaultOptions)}),n}setMutationDefaults(t,e){this.#r.set(Fo(t),{mutationKey:t,defaultOptions:e})}getMutationDefaults(t){const e=[...this.#r.values()],n={};return e.forEach(r=>{Ku(t,r.mutationKey)&&Object.assign(n,r.defaultOptions)}),n}defaultQueryOptions(t){if(t._defaulted)return t;const e={...this.#n.queries,...this.getQueryDefaults(t.queryKey),...t,_defaulted:!0};return e.queryHash||(e.queryHash=h0(e.queryKey,e)),e.refetchOnReconnect===void 0&&(e.refetchOnReconnect=e.networkMode!=="always"),e.throwOnError===void 0&&(e.throwOnError=!!e.suspense),!e.networkMode&&e.persister&&(e.networkMode="offlineFirst"),e.queryFn===f0&&(e.enabled=!1),e}defaultMutationOptions(t){return t?._defaulted?t:{...this.#n.mutations,...t?.mutationKey&&this.getMutationDefaults(t.mutationKey),...t,_defaulted:!0}}clear(){this.#e.clear(),this.#t.clear()}},WE=R.createContext(void 0),Rt=t=>{const e=R.useContext(WE);if(!e)throw new Error("No QueryClient set, use QueryClientProvider to set one");return e},gM=({client:t,children:e})=>(R.useEffect(()=>(t.mount(),()=>{t.unmount()}),[t]),d.jsx(WE.Provider,{value:t,children:e})),QE=R.createContext(!1),yM=()=>R.useContext(QE);QE.Provider;function _M(){let t=!1;return{clearReset:()=>{t=!1},reset:()=>{t=!0},isReset:()=>t}}var bM=R.createContext(_M()),vM=()=>R.useContext(bM),xM=(t,e)=>{(t.suspense||t.throwOnError||t.experimental_prefetchInRender)&&(e.isReset()||(t.retryOnMount=!1))},wM=t=>{R.useEffect(()=>{t.clearReset()},[t])},SM=({result:t,errorResetBoundary:e,throwOnError:n,query:r,suspense:i})=>t.isError&&!e.isReset()&&!t.isFetching&&r&&(i&&t.data===void 0||FE(n,[t.error,r])),EM=t=>{if(t.suspense){const n=i=>i==="static"?i:Math.max(i??1e3,1e3),r=t.staleTime;t.staleTime=typeof r=="function"?(...i)=>n(r(...i)):n(r),typeof t.gcTime=="number"&&(t.gcTime=Math.max(t.gcTime,1e3))}},CM=(t,e)=>t.isLoading&&t.isFetching&&!e,TM=(t,e)=>t?.suspense&&e.isPending,Fw=(t,e,n)=>e.fetchOptimistic(t).catch(()=>{n.clearReset()});function AM(t,e,n){const r=yM(),i=vM(),o=Rt(),l=o.defaultQueryOptions(t);o.getDefaultOptions().queries?._experimental_beforeQuery?.(l),l._optimisticResults=r?"isRestoring":"optimistic",EM(l),xM(l,i),wM(i);const u=!o.getQueryCache().get(l.queryHash),[h]=R.useState(()=>new e(o,l)),f=h.getOptimisticResult(l),p=!r&&t.subscribed!==!1;if(R.useSyncExternalStore(R.useCallback(g=>{const b=p?h.subscribe(An.batchCalls(g)):cr;return h.updateResult(),b},[h,p]),()=>h.getCurrentResult(),()=>h.getCurrentResult()),R.useEffect(()=>{h.setOptions(l)},[l,h]),TM(l,f))throw Fw(l,h,i);if(SM({result:f,errorResetBoundary:i,throwOnError:l.throwOnError,query:o.getQueryCache().get(l.queryHash),suspense:l.suspense}))throw f.error;return o.getDefaultOptions().queries?._experimental_afterQuery?.(l,f),l.experimental_prefetchInRender&&!Uo&&CM(f,r)&&(u?Fw(l,h,i):o.getQueryCache().get(l.queryHash)?.promise)?.catch(cr).finally(()=>{h.updateResult()}),l.notifyOnChangeProps?f:h.trackResult(f)}function Go(t,e){return AM(t,oM)}function Cn(t,e){const n=Rt(),[r]=R.useState(()=>new fM(n,t));R.useEffect(()=>{r.setOptions(t)},[r,t]);const i=R.useSyncExternalStore(R.useCallback(l=>r.subscribe(An.batchCalls(l)),[r]),()=>r.getCurrentResult(),()=>r.getCurrentResult()),o=R.useCallback((l,u)=>{r.mutate(l,u).catch(cr)},[r]);if(i.error&&FE(r.options.throwOnError,[i.error]))throw i.error;return{...i,mutate:o,mutateAsync:i.mutate}}const fs=300*1e3,jM=1800*1e3,ze=new pM({defaultOptions:{queries:{staleTime:fs,gcTime:jM,refetchOnWindowFocus:!1,refetchOnReconnect:!0,retry:1,refetchOnMount:!0},mutations:{retry:1}}});ze.getQueryCache().subscribe(t=>{const e=t?.query;if(e&&t.type==="updated"){const{state:n}=e;n.status==="error"&&n.error&&console.error("[RQ] Query FAILED:",e.queryKey,n.error)}});const Ce={user:t=>["user",t],budget:t=>["budget",t],month:(t,e,n)=>["month",t,e,n],payees:t=>["payees",t],accessibleBudgets:t=>["accessibleBudgets",t],feedback:()=>["feedback"]};function RM({children:t}){return d.jsx(gM,{client:ze,children:t})}var Vw=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var ka,KE;(function(){var t;function e(O,P){function N(){}N.prototype=P.prototype,O.F=P.prototype,O.prototype=new N,O.prototype.constructor=O,O.D=function(V,$,A){for(var k=Array(arguments.length-2),D=2;D<arguments.length;D++)k[D-2]=arguments[D];return P.prototype[$].apply(V,k)}}function n(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(r,n),r.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(O,P,N){N||(N=0);const V=Array(16);if(typeof P=="string")for(var $=0;$<16;++$)V[$]=P.charCodeAt(N++)|P.charCodeAt(N++)<<8|P.charCodeAt(N++)<<16|P.charCodeAt(N++)<<24;else for($=0;$<16;++$)V[$]=P[N++]|P[N++]<<8|P[N++]<<16|P[N++]<<24;P=O.g[0],N=O.g[1],$=O.g[2];let A=O.g[3],k;k=P+(A^N&($^A))+V[0]+3614090360&4294967295,P=N+(k<<7&4294967295|k>>>25),k=A+($^P&(N^$))+V[1]+3905402710&4294967295,A=P+(k<<12&4294967295|k>>>20),k=$+(N^A&(P^N))+V[2]+606105819&4294967295,$=A+(k<<17&4294967295|k>>>15),k=N+(P^$&(A^P))+V[3]+3250441966&4294967295,N=$+(k<<22&4294967295|k>>>10),k=P+(A^N&($^A))+V[4]+4118548399&4294967295,P=N+(k<<7&4294967295|k>>>25),k=A+($^P&(N^$))+V[5]+1200080426&4294967295,A=P+(k<<12&4294967295|k>>>20),k=$+(N^A&(P^N))+V[6]+2821735955&4294967295,$=A+(k<<17&4294967295|k>>>15),k=N+(P^$&(A^P))+V[7]+4249261313&4294967295,N=$+(k<<22&4294967295|k>>>10),k=P+(A^N&($^A))+V[8]+1770035416&4294967295,P=N+(k<<7&4294967295|k>>>25),k=A+($^P&(N^$))+V[9]+2336552879&4294967295,A=P+(k<<12&4294967295|k>>>20),k=$+(N^A&(P^N))+V[10]+4294925233&4294967295,$=A+(k<<17&4294967295|k>>>15),k=N+(P^$&(A^P))+V[11]+2304563134&4294967295,N=$+(k<<22&4294967295|k>>>10),k=P+(A^N&($^A))+V[12]+1804603682&4294967295,P=N+(k<<7&4294967295|k>>>25),k=A+($^P&(N^$))+V[13]+4254626195&4294967295,A=P+(k<<12&4294967295|k>>>20),k=$+(N^A&(P^N))+V[14]+2792965006&4294967295,$=A+(k<<17&4294967295|k>>>15),k=N+(P^$&(A^P))+V[15]+1236535329&4294967295,N=$+(k<<22&4294967295|k>>>10),k=P+($^A&(N^$))+V[1]+4129170786&4294967295,P=N+(k<<5&4294967295|k>>>27),k=A+(N^$&(P^N))+V[6]+3225465664&4294967295,A=P+(k<<9&4294967295|k>>>23),k=$+(P^N&(A^P))+V[11]+643717713&4294967295,$=A+(k<<14&4294967295|k>>>18),k=N+(A^P&($^A))+V[0]+3921069994&4294967295,N=$+(k<<20&4294967295|k>>>12),k=P+($^A&(N^$))+V[5]+3593408605&4294967295,P=N+(k<<5&4294967295|k>>>27),k=A+(N^$&(P^N))+V[10]+38016083&4294967295,A=P+(k<<9&4294967295|k>>>23),k=$+(P^N&(A^P))+V[15]+3634488961&4294967295,$=A+(k<<14&4294967295|k>>>18),k=N+(A^P&($^A))+V[4]+3889429448&4294967295,N=$+(k<<20&4294967295|k>>>12),k=P+($^A&(N^$))+V[9]+568446438&4294967295,P=N+(k<<5&4294967295|k>>>27),k=A+(N^$&(P^N))+V[14]+3275163606&4294967295,A=P+(k<<9&4294967295|k>>>23),k=$+(P^N&(A^P))+V[3]+4107603335&4294967295,$=A+(k<<14&4294967295|k>>>18),k=N+(A^P&($^A))+V[8]+1163531501&4294967295,N=$+(k<<20&4294967295|k>>>12),k=P+($^A&(N^$))+V[13]+2850285829&4294967295,P=N+(k<<5&4294967295|k>>>27),k=A+(N^$&(P^N))+V[2]+4243563512&4294967295,A=P+(k<<9&4294967295|k>>>23),k=$+(P^N&(A^P))+V[7]+1735328473&4294967295,$=A+(k<<14&4294967295|k>>>18),k=N+(A^P&($^A))+V[12]+2368359562&4294967295,N=$+(k<<20&4294967295|k>>>12),k=P+(N^$^A)+V[5]+4294588738&4294967295,P=N+(k<<4&4294967295|k>>>28),k=A+(P^N^$)+V[8]+2272392833&4294967295,A=P+(k<<11&4294967295|k>>>21),k=$+(A^P^N)+V[11]+1839030562&4294967295,$=A+(k<<16&4294967295|k>>>16),k=N+($^A^P)+V[14]+4259657740&4294967295,N=$+(k<<23&4294967295|k>>>9),k=P+(N^$^A)+V[1]+2763975236&4294967295,P=N+(k<<4&4294967295|k>>>28),k=A+(P^N^$)+V[4]+1272893353&4294967295,A=P+(k<<11&4294967295|k>>>21),k=$+(A^P^N)+V[7]+4139469664&4294967295,$=A+(k<<16&4294967295|k>>>16),k=N+($^A^P)+V[10]+3200236656&4294967295,N=$+(k<<23&4294967295|k>>>9),k=P+(N^$^A)+V[13]+681279174&4294967295,P=N+(k<<4&4294967295|k>>>28),k=A+(P^N^$)+V[0]+3936430074&4294967295,A=P+(k<<11&4294967295|k>>>21),k=$+(A^P^N)+V[3]+3572445317&4294967295,$=A+(k<<16&4294967295|k>>>16),k=N+($^A^P)+V[6]+76029189&4294967295,N=$+(k<<23&4294967295|k>>>9),k=P+(N^$^A)+V[9]+3654602809&4294967295,P=N+(k<<4&4294967295|k>>>28),k=A+(P^N^$)+V[12]+3873151461&4294967295,A=P+(k<<11&4294967295|k>>>21),k=$+(A^P^N)+V[15]+530742520&4294967295,$=A+(k<<16&4294967295|k>>>16),k=N+($^A^P)+V[2]+3299628645&4294967295,N=$+(k<<23&4294967295|k>>>9),k=P+($^(N|~A))+V[0]+4096336452&4294967295,P=N+(k<<6&4294967295|k>>>26),k=A+(N^(P|~$))+V[7]+1126891415&4294967295,A=P+(k<<10&4294967295|k>>>22),k=$+(P^(A|~N))+V[14]+2878612391&4294967295,$=A+(k<<15&4294967295|k>>>17),k=N+(A^($|~P))+V[5]+4237533241&4294967295,N=$+(k<<21&4294967295|k>>>11),k=P+($^(N|~A))+V[12]+1700485571&4294967295,P=N+(k<<6&4294967295|k>>>26),k=A+(N^(P|~$))+V[3]+2399980690&4294967295,A=P+(k<<10&4294967295|k>>>22),k=$+(P^(A|~N))+V[10]+4293915773&4294967295,$=A+(k<<15&4294967295|k>>>17),k=N+(A^($|~P))+V[1]+2240044497&4294967295,N=$+(k<<21&4294967295|k>>>11),k=P+($^(N|~A))+V[8]+1873313359&4294967295,P=N+(k<<6&4294967295|k>>>26),k=A+(N^(P|~$))+V[15]+4264355552&4294967295,A=P+(k<<10&4294967295|k>>>22),k=$+(P^(A|~N))+V[6]+2734768916&4294967295,$=A+(k<<15&4294967295|k>>>17),k=N+(A^($|~P))+V[13]+1309151649&4294967295,N=$+(k<<21&4294967295|k>>>11),k=P+($^(N|~A))+V[4]+4149444226&4294967295,P=N+(k<<6&4294967295|k>>>26),k=A+(N^(P|~$))+V[11]+3174756917&4294967295,A=P+(k<<10&4294967295|k>>>22),k=$+(P^(A|~N))+V[2]+718787259&4294967295,$=A+(k<<15&4294967295|k>>>17),k=N+(A^($|~P))+V[9]+3951481745&4294967295,O.g[0]=O.g[0]+P&4294967295,O.g[1]=O.g[1]+($+(k<<21&4294967295|k>>>11))&4294967295,O.g[2]=O.g[2]+$&4294967295,O.g[3]=O.g[3]+A&4294967295}r.prototype.v=function(O,P){P===void 0&&(P=O.length);const N=P-this.blockSize,V=this.C;let $=this.h,A=0;for(;A<P;){if($==0)for(;A<=N;)i(this,O,A),A+=this.blockSize;if(typeof O=="string"){for(;A<P;)if(V[$++]=O.charCodeAt(A++),$==this.blockSize){i(this,V),$=0;break}}else for(;A<P;)if(V[$++]=O[A++],$==this.blockSize){i(this,V),$=0;break}}this.h=$,this.o+=P},r.prototype.A=function(){var O=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);O[0]=128;for(var P=1;P<O.length-8;++P)O[P]=0;P=this.o*8;for(var N=O.length-8;N<O.length;++N)O[N]=P&255,P/=256;for(this.v(O),O=Array(16),P=0,N=0;N<4;++N)for(let V=0;V<32;V+=8)O[P++]=this.g[N]>>>V&255;return O};function o(O,P){var N=u;return Object.prototype.hasOwnProperty.call(N,O)?N[O]:N[O]=P(O)}function l(O,P){this.h=P;const N=[];let V=!0;for(let $=O.length-1;$>=0;$--){const A=O[$]|0;V&&A==P||(N[$]=A,V=!1)}this.g=N}var u={};function h(O){return-128<=O&&O<128?o(O,function(P){return new l([P|0],P<0?-1:0)}):new l([O|0],O<0?-1:0)}function f(O){if(isNaN(O)||!isFinite(O))return g;if(O<0)return S(f(-O));const P=[];let N=1;for(let V=0;O>=N;V++)P[V]=O/N|0,N*=4294967296;return new l(P,0)}function p(O,P){if(O.length==0)throw Error("number format error: empty string");if(P=P||10,P<2||36<P)throw Error("radix out of range: "+P);if(O.charAt(0)=="-")return S(p(O.substring(1),P));if(O.indexOf("-")>=0)throw Error('number format error: interior "-" character');const N=f(Math.pow(P,8));let V=g;for(let A=0;A<O.length;A+=8){var $=Math.min(8,O.length-A);const k=parseInt(O.substring(A,A+$),P);$<8?($=f(Math.pow(P,$)),V=V.j($).add(f(k))):(V=V.j(N),V=V.add(f(k)))}return V}var g=h(0),b=h(1),_=h(16777216);t=l.prototype,t.m=function(){if(x(this))return-S(this).m();let O=0,P=1;for(let N=0;N<this.g.length;N++){const V=this.i(N);O+=(V>=0?V:4294967296+V)*P,P*=4294967296}return O},t.toString=function(O){if(O=O||10,O<2||36<O)throw Error("radix out of range: "+O);if(w(this))return"0";if(x(this))return"-"+S(this).toString(O);const P=f(Math.pow(O,6));var N=this;let V="";for(;;){const $=M(N,P).g;N=C(N,$.j(P));let A=((N.g.length>0?N.g[0]:N.h)>>>0).toString(O);if(N=$,w(N))return A+V;for(;A.length<6;)A="0"+A;V=A+V}},t.i=function(O){return O<0?0:O<this.g.length?this.g[O]:this.h};function w(O){if(O.h!=0)return!1;for(let P=0;P<O.g.length;P++)if(O.g[P]!=0)return!1;return!0}function x(O){return O.h==-1}t.l=function(O){return O=C(this,O),x(O)?-1:w(O)?0:1};function S(O){const P=O.g.length,N=[];for(let V=0;V<P;V++)N[V]=~O.g[V];return new l(N,~O.h).add(b)}t.abs=function(){return x(this)?S(this):this},t.add=function(O){const P=Math.max(this.g.length,O.g.length),N=[];let V=0;for(let $=0;$<=P;$++){let A=V+(this.i($)&65535)+(O.i($)&65535),k=(A>>>16)+(this.i($)>>>16)+(O.i($)>>>16);V=k>>>16,A&=65535,k&=65535,N[$]=k<<16|A}return new l(N,N[N.length-1]&-2147483648?-1:0)};function C(O,P){return O.add(S(P))}t.j=function(O){if(w(this)||w(O))return g;if(x(this))return x(O)?S(this).j(S(O)):S(S(this).j(O));if(x(O))return S(this.j(S(O)));if(this.l(_)<0&&O.l(_)<0)return f(this.m()*O.m());const P=this.g.length+O.g.length,N=[];for(var V=0;V<2*P;V++)N[V]=0;for(V=0;V<this.g.length;V++)for(let $=0;$<O.g.length;$++){const A=this.i(V)>>>16,k=this.i(V)&65535,D=O.i($)>>>16,K=O.i($)&65535;N[2*V+2*$]+=k*K,T(N,2*V+2*$),N[2*V+2*$+1]+=A*K,T(N,2*V+2*$+1),N[2*V+2*$+1]+=k*D,T(N,2*V+2*$+1),N[2*V+2*$+2]+=A*D,T(N,2*V+2*$+2)}for(O=0;O<P;O++)N[O]=N[2*O+1]<<16|N[2*O];for(O=P;O<2*P;O++)N[O]=0;return new l(N,0)};function T(O,P){for(;(O[P]&65535)!=O[P];)O[P+1]+=O[P]>>>16,O[P]&=65535,P++}function I(O,P){this.g=O,this.h=P}function M(O,P){if(w(P))throw Error("division by zero");if(w(O))return new I(g,g);if(x(O))return P=M(S(O),P),new I(S(P.g),S(P.h));if(x(P))return P=M(O,S(P)),new I(S(P.g),P.h);if(O.g.length>30){if(x(O)||x(P))throw Error("slowDivide_ only works with positive integers.");for(var N=b,V=P;V.l(O)<=0;)N=U(N),V=U(V);var $=H(N,1),A=H(V,1);for(V=H(V,2),N=H(N,2);!w(V);){var k=A.add(V);k.l(O)<=0&&($=$.add(N),A=k),V=H(V,1),N=H(N,1)}return P=C(O,$.j(P)),new I($,P)}for($=g;O.l(P)>=0;){for(N=Math.max(1,Math.floor(O.m()/P.m())),V=Math.ceil(Math.log(N)/Math.LN2),V=V<=48?1:Math.pow(2,V-48),A=f(N),k=A.j(P);x(k)||k.l(O)>0;)N-=V,A=f(N),k=A.j(P);w(A)&&(A=b),$=$.add(A),O=C(O,k)}return new I($,O)}t.B=function(O){return M(this,O).h},t.and=function(O){const P=Math.max(this.g.length,O.g.length),N=[];for(let V=0;V<P;V++)N[V]=this.i(V)&O.i(V);return new l(N,this.h&O.h)},t.or=function(O){const P=Math.max(this.g.length,O.g.length),N=[];for(let V=0;V<P;V++)N[V]=this.i(V)|O.i(V);return new l(N,this.h|O.h)},t.xor=function(O){const P=Math.max(this.g.length,O.g.length),N=[];for(let V=0;V<P;V++)N[V]=this.i(V)^O.i(V);return new l(N,this.h^O.h)};function U(O){const P=O.g.length+1,N=[];for(let V=0;V<P;V++)N[V]=O.i(V)<<1|O.i(V-1)>>>31;return new l(N,O.h)}function H(O,P){const N=P>>5;P%=32;const V=O.g.length-N,$=[];for(let A=0;A<V;A++)$[A]=P>0?O.i(A+N)>>>P|O.i(A+N+1)<<32-P:O.i(A+N);return new l($,O.h)}r.prototype.digest=r.prototype.A,r.prototype.reset=r.prototype.u,r.prototype.update=r.prototype.v,KE=r,l.prototype.add=l.prototype.add,l.prototype.multiply=l.prototype.j,l.prototype.modulo=l.prototype.B,l.prototype.compare=l.prototype.l,l.prototype.toNumber=l.prototype.m,l.prototype.toString=l.prototype.toString,l.prototype.getBits=l.prototype.i,l.fromNumber=f,l.fromString=p,ka=l}).apply(typeof Vw<"u"?Vw:typeof self<"u"?self:typeof window<"u"?window:{});var Jh=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var YE,Ou,XE,ff,Cy,ZE,JE,eC;(function(){var t,e=Object.defineProperty;function n(y){y=[typeof globalThis=="object"&&globalThis,y,typeof window=="object"&&window,typeof self=="object"&&self,typeof Jh=="object"&&Jh];for(var j=0;j<y.length;++j){var F=y[j];if(F&&F.Math==Math)return F}throw Error("Cannot find global object")}var r=n(this);function i(y,j){if(j)e:{var F=r;y=y.split(".");for(var Y=0;Y<y.length-1;Y++){var pe=y[Y];if(!(pe in F))break e;F=F[pe]}y=y[y.length-1],Y=F[y],j=j(Y),j!=Y&&j!=null&&e(F,y,{configurable:!0,writable:!0,value:j})}}i("Symbol.dispose",function(y){return y||Symbol("Symbol.dispose")}),i("Array.prototype.values",function(y){return y||function(){return this[Symbol.iterator]()}}),i("Object.entries",function(y){return y||function(j){var F=[],Y;for(Y in j)Object.prototype.hasOwnProperty.call(j,Y)&&F.push([Y,j[Y]]);return F}});var o=o||{},l=this||self;function u(y){var j=typeof y;return j=="object"&&y!=null||j=="function"}function h(y,j,F){return y.call.apply(y.bind,arguments)}function f(y,j,F){return f=h,f.apply(null,arguments)}function p(y,j){var F=Array.prototype.slice.call(arguments,1);return function(){var Y=F.slice();return Y.push.apply(Y,arguments),y.apply(this,Y)}}function g(y,j){function F(){}F.prototype=j.prototype,y.Z=j.prototype,y.prototype=new F,y.prototype.constructor=y,y.Ob=function(Y,pe,ve){for(var Be=Array(arguments.length-2),at=2;at<arguments.length;at++)Be[at-2]=arguments[at];return j.prototype[pe].apply(Y,Be)}}var b=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?y=>y&&AsyncContext.Snapshot.wrap(y):y=>y;function _(y){const j=y.length;if(j>0){const F=Array(j);for(let Y=0;Y<j;Y++)F[Y]=y[Y];return F}return[]}function w(y,j){for(let Y=1;Y<arguments.length;Y++){const pe=arguments[Y];var F=typeof pe;if(F=F!="object"?F:pe?Array.isArray(pe)?"array":F:"null",F=="array"||F=="object"&&typeof pe.length=="number"){F=y.length||0;const ve=pe.length||0;y.length=F+ve;for(let Be=0;Be<ve;Be++)y[F+Be]=pe[Be]}else y.push(pe)}}class x{constructor(j,F){this.i=j,this.j=F,this.h=0,this.g=null}get(){let j;return this.h>0?(this.h--,j=this.g,this.g=j.next,j.next=null):j=this.i(),j}}function S(y){l.setTimeout(()=>{throw y},0)}function C(){var y=O;let j=null;return y.g&&(j=y.g,y.g=y.g.next,y.g||(y.h=null),j.next=null),j}class T{constructor(){this.h=this.g=null}add(j,F){const Y=I.get();Y.set(j,F),this.h?this.h.next=Y:this.g=Y,this.h=Y}}var I=new x(()=>new M,y=>y.reset());class M{constructor(){this.next=this.g=this.h=null}set(j,F){this.h=j,this.g=F,this.next=null}reset(){this.next=this.g=this.h=null}}let U,H=!1,O=new T,P=()=>{const y=Promise.resolve(void 0);U=()=>{y.then(N)}};function N(){for(var y;y=C();){try{y.h.call(y.g)}catch(F){S(F)}var j=I;j.j(y),j.h<100&&(j.h++,y.next=j.g,j.g=y)}H=!1}function V(){this.u=this.u,this.C=this.C}V.prototype.u=!1,V.prototype.dispose=function(){this.u||(this.u=!0,this.N())},V.prototype[Symbol.dispose]=function(){this.dispose()},V.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function $(y,j){this.type=y,this.g=this.target=j,this.defaultPrevented=!1}$.prototype.h=function(){this.defaultPrevented=!0};var A=(function(){if(!l.addEventListener||!Object.defineProperty)return!1;var y=!1,j=Object.defineProperty({},"passive",{get:function(){y=!0}});try{const F=()=>{};l.addEventListener("test",F,j),l.removeEventListener("test",F,j)}catch{}return y})();function k(y){return/^[\s\xa0]*$/.test(y)}function D(y,j){$.call(this,y?y.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,y&&this.init(y,j)}g(D,$),D.prototype.init=function(y,j){const F=this.type=y.type,Y=y.changedTouches&&y.changedTouches.length?y.changedTouches[0]:null;this.target=y.target||y.srcElement,this.g=j,j=y.relatedTarget,j||(F=="mouseover"?j=y.fromElement:F=="mouseout"&&(j=y.toElement)),this.relatedTarget=j,Y?(this.clientX=Y.clientX!==void 0?Y.clientX:Y.pageX,this.clientY=Y.clientY!==void 0?Y.clientY:Y.pageY,this.screenX=Y.screenX||0,this.screenY=Y.screenY||0):(this.clientX=y.clientX!==void 0?y.clientX:y.pageX,this.clientY=y.clientY!==void 0?y.clientY:y.pageY,this.screenX=y.screenX||0,this.screenY=y.screenY||0),this.button=y.button,this.key=y.key||"",this.ctrlKey=y.ctrlKey,this.altKey=y.altKey,this.shiftKey=y.shiftKey,this.metaKey=y.metaKey,this.pointerId=y.pointerId||0,this.pointerType=y.pointerType,this.state=y.state,this.i=y,y.defaultPrevented&&D.Z.h.call(this)},D.prototype.h=function(){D.Z.h.call(this);const y=this.i;y.preventDefault?y.preventDefault():y.returnValue=!1};var K="closure_listenable_"+(Math.random()*1e6|0),X=0;function G(y,j,F,Y,pe){this.listener=y,this.proxy=null,this.src=j,this.type=F,this.capture=!!Y,this.ha=pe,this.key=++X,this.da=this.fa=!1}function te(y){y.da=!0,y.listener=null,y.proxy=null,y.src=null,y.ha=null}function Q(y,j,F){for(const Y in y)j.call(F,y[Y],Y,y)}function se(y,j){for(const F in y)j.call(void 0,y[F],F,y)}function B(y){const j={};for(const F in y)j[F]=y[F];return j}const q="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ee(y,j){let F,Y;for(let pe=1;pe<arguments.length;pe++){Y=arguments[pe];for(F in Y)y[F]=Y[F];for(let ve=0;ve<q.length;ve++)F=q[ve],Object.prototype.hasOwnProperty.call(Y,F)&&(y[F]=Y[F])}}function ne(y){this.src=y,this.g={},this.h=0}ne.prototype.add=function(y,j,F,Y,pe){const ve=y.toString();y=this.g[ve],y||(y=this.g[ve]=[],this.h++);const Be=he(y,j,Y,pe);return Be>-1?(j=y[Be],F||(j.fa=!1)):(j=new G(j,this.src,ve,!!Y,pe),j.fa=F,y.push(j)),j};function le(y,j){const F=j.type;if(F in y.g){var Y=y.g[F],pe=Array.prototype.indexOf.call(Y,j,void 0),ve;(ve=pe>=0)&&Array.prototype.splice.call(Y,pe,1),ve&&(te(j),y.g[F].length==0&&(delete y.g[F],y.h--))}}function he(y,j,F,Y){for(let pe=0;pe<y.length;++pe){const ve=y[pe];if(!ve.da&&ve.listener==j&&ve.capture==!!F&&ve.ha==Y)return pe}return-1}var Ee="closure_lm_"+(Math.random()*1e6|0),ae={};function fe(y,j,F,Y,pe){if(Array.isArray(j)){for(let ve=0;ve<j.length;ve++)fe(y,j[ve],F,Y,pe);return null}return F=Z(F),y&&y[K]?y.J(j,F,u(Y)?!!Y.capture:!1,pe):Me(y,j,F,!1,Y,pe)}function Me(y,j,F,Y,pe,ve){if(!j)throw Error("Invalid event type");const Be=u(pe)?!!pe.capture:!!pe;let at=_e(y);if(at||(y[Ee]=at=new ne(y)),F=at.add(j,F,Y,Be,ve),F.proxy)return F;if(Y=Ne(),F.proxy=Y,Y.src=y,Y.listener=F,y.addEventListener)A||(pe=Be),pe===void 0&&(pe=!1),y.addEventListener(j.toString(),Y,pe);else if(y.attachEvent)y.attachEvent(L(j.toString()),Y);else if(y.addListener&&y.removeListener)y.addListener(Y);else throw Error("addEventListener and attachEvent are unavailable.");return F}function Ne(){function y(F){return j.call(y.src,y.listener,F)}const j=de;return y}function tt(y,j,F,Y,pe){if(Array.isArray(j))for(var ve=0;ve<j.length;ve++)tt(y,j[ve],F,Y,pe);else Y=u(Y)?!!Y.capture:!!Y,F=Z(F),y&&y[K]?(y=y.i,ve=String(j).toString(),ve in y.g&&(j=y.g[ve],F=he(j,F,Y,pe),F>-1&&(te(j[F]),Array.prototype.splice.call(j,F,1),j.length==0&&(delete y.g[ve],y.h--)))):y&&(y=_e(y))&&(j=y.g[j.toString()],y=-1,j&&(y=he(j,F,Y,pe)),(F=y>-1?j[y]:null)&&Ue(F))}function Ue(y){if(typeof y!="number"&&y&&!y.da){var j=y.src;if(j&&j[K])le(j.i,y);else{var F=y.type,Y=y.proxy;j.removeEventListener?j.removeEventListener(F,Y,y.capture):j.detachEvent?j.detachEvent(L(F),Y):j.addListener&&j.removeListener&&j.removeListener(Y),(F=_e(j))?(le(F,y),F.h==0&&(F.src=null,j[Ee]=null)):te(y)}}}function L(y){return y in ae?ae[y]:ae[y]="on"+y}function de(y,j){if(y.da)y=!0;else{j=new D(j,this);const F=y.listener,Y=y.ha||y.src;y.fa&&Ue(y),y=F.call(Y,j)}return y}function _e(y){return y=y[Ee],y instanceof ne?y:null}var J="__closure_events_fn_"+(Math.random()*1e9>>>0);function Z(y){return typeof y=="function"?y:(y[J]||(y[J]=function(j){return y.handleEvent(j)}),y[J])}function oe(){V.call(this),this.i=new ne(this),this.M=this,this.G=null}g(oe,V),oe.prototype[K]=!0,oe.prototype.removeEventListener=function(y,j,F,Y){tt(this,y,j,F,Y)};function Se(y,j){var F,Y=y.G;if(Y)for(F=[];Y;Y=Y.G)F.push(Y);if(y=y.M,Y=j.type||j,typeof j=="string")j=new $(j,y);else if(j instanceof $)j.target=j.target||y;else{var pe=j;j=new $(Y,y),ee(j,pe)}pe=!0;let ve,Be;if(F)for(Be=F.length-1;Be>=0;Be--)ve=j.g=F[Be],pe=we(ve,Y,!0,j)&&pe;if(ve=j.g=y,pe=we(ve,Y,!0,j)&&pe,pe=we(ve,Y,!1,j)&&pe,F)for(Be=0;Be<F.length;Be++)ve=j.g=F[Be],pe=we(ve,Y,!1,j)&&pe}oe.prototype.N=function(){if(oe.Z.N.call(this),this.i){var y=this.i;for(const j in y.g){const F=y.g[j];for(let Y=0;Y<F.length;Y++)te(F[Y]);delete y.g[j],y.h--}}this.G=null},oe.prototype.J=function(y,j,F,Y){return this.i.add(String(y),j,!1,F,Y)},oe.prototype.K=function(y,j,F,Y){return this.i.add(String(y),j,!0,F,Y)};function we(y,j,F,Y){if(j=y.i.g[String(j)],!j)return!0;j=j.concat();let pe=!0;for(let ve=0;ve<j.length;++ve){const Be=j[ve];if(Be&&!Be.da&&Be.capture==F){const at=Be.listener,on=Be.ha||Be.src;Be.fa&&le(y.i,Be),pe=at.call(on,Y)!==!1&&pe}}return pe&&!Y.defaultPrevented}function ie(y,j){if(typeof y!="function")if(y&&typeof y.handleEvent=="function")y=f(y.handleEvent,y);else throw Error("Invalid listener argument");return Number(j)>2147483647?-1:l.setTimeout(y,j||0)}function Re(y){y.g=ie(()=>{y.g=null,y.i&&(y.i=!1,Re(y))},y.l);const j=y.h;y.h=null,y.m.apply(null,j)}class Pe extends V{constructor(j,F){super(),this.m=j,this.l=F,this.h=null,this.i=!1,this.g=null}j(j){this.h=arguments,this.g?this.i=!0:Re(this)}N(){super.N(),this.g&&(l.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Oe(y){V.call(this),this.h=y,this.g={}}g(Oe,V);var He=[];function xt(y){Q(y.g,function(j,F){this.g.hasOwnProperty(F)&&Ue(j)},y),y.g={}}Oe.prototype.N=function(){Oe.Z.N.call(this),xt(this)},Oe.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var it=l.JSON.stringify,Wn=l.JSON.parse,ys=class{stringify(y){return l.JSON.stringify(y,void 0)}parse(y){return l.JSON.parse(y,void 0)}};function rr(){}function _s(){}var vt={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function nn(){$.call(this,"d")}g(nn,$);function Qn(){$.call(this,"c")}g(Qn,$);var Et={},Ja=null;function Ui(){return Ja=Ja||new oe}Et.Ia="serverreachability";function tl(y){$.call(this,Et.Ia,y)}g(tl,$);function Br(y){const j=Ui();Se(j,new tl(j))}Et.STAT_EVENT="statevent";function bs(y,j){$.call(this,Et.STAT_EVENT,y),this.stat=j}g(bs,$);function Ut(y){const j=Ui();Se(j,new bs(j,y))}Et.Ja="timingevent";function sr(y,j){$.call(this,Et.Ja,y),this.size=j}g(sr,$);function vs(y,j){if(typeof y!="function")throw Error("Fn must not be null and must be a function");return l.setTimeout(function(){y()},j)}function es(){this.g=!0}es.prototype.ua=function(){this.g=!1};function Nm(y,j,F,Y,pe,ve){y.info(function(){if(y.g)if(ve){var Be="",at=ve.split("&");for(let Ct=0;Ct<at.length;Ct++){var on=at[Ct].split("=");if(on.length>1){const Kt=on[0];on=on[1];const Fr=Kt.split("_");Be=Fr.length>=2&&Fr[1]=="type"?Be+(Kt+"="+on+"&"):Be+(Kt+"=redacted&")}}}else Be=null;else Be=ve;return"XMLHTTP REQ ("+Y+") [attempt "+pe+"]: "+j+`
`+F+`
`+Be})}function Td(y,j,F,Y,pe,ve,Be){y.info(function(){return"XMLHTTP RESP ("+Y+") [ attempt "+pe+"]: "+j+`
`+F+`
`+ve+" "+Be})}function xs(y,j,F,Y){y.info(function(){return"XMLHTTP TEXT ("+j+"): "+Pm(y,F)+(Y?" "+Y:"")})}function eo(y,j){y.info(function(){return"TIMEOUT: "+j})}es.prototype.info=function(){};function Pm(y,j){if(!y.g)return j;if(!j)return null;try{const ve=JSON.parse(j);if(ve){for(y=0;y<ve.length;y++)if(Array.isArray(ve[y])){var F=ve[y];if(!(F.length<2)){var Y=F[1];if(Array.isArray(Y)&&!(Y.length<1)){var pe=Y[0];if(pe!="noop"&&pe!="stop"&&pe!="close")for(let Be=1;Be<Y.length;Be++)Y[Be]=""}}}}return it(ve)}catch{return j}}var to={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},Rc={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},Ic;function no(){}g(no,rr),no.prototype.g=function(){return new XMLHttpRequest},Ic=new no;function Zs(y){return encodeURIComponent(String(y))}function Ad(y){var j=1;y=y.split(":");const F=[];for(;j>0&&y.length;)F.push(y.shift()),j--;return y.length&&F.push(y.join(":")),F}function ts(y,j,F,Y){this.j=y,this.i=j,this.l=F,this.S=Y||1,this.V=new Oe(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new ns}function ns(){this.i=null,this.g="",this.h=!1}var fn={},kn={};function ws(y,j,F){y.M=1,y.A=ro(pn(j)),y.u=F,y.R=!0,nl(y,null)}function nl(y,j){y.F=Date.now(),Ss(y),y.B=pn(y.A);var F=y.B,Y=y.S;Array.isArray(Y)||(Y=[String(Y)]),al(F.i,"t",Y),y.C=0,F=y.j.L,y.h=new ns,y.g=Vd(y.j,F?j:null,!y.u),y.P>0&&(y.O=new Pe(f(y.Y,y,y.g),y.P)),j=y.V,F=y.g,Y=y.ba;var pe="readystatechange";Array.isArray(pe)||(pe&&(He[0]=pe.toString()),pe=He);for(let ve=0;ve<pe.length;ve++){const Be=fe(F,pe[ve],Y||j.handleEvent,!1,j.h||j);if(!Be)break;j.g[Be.key]=Be}j=y.J?B(y.J):{},y.u?(y.v||(y.v="POST"),j["Content-Type"]="application/x-www-form-urlencoded",y.g.ea(y.B,y.v,y.u,j)):(y.v="GET",y.g.ea(y.B,y.v,null,j)),Br(),Nm(y.i,y.v,y.B,y.l,y.S,y.u)}ts.prototype.ba=function(y){y=y.target;const j=this.O;j&&is(y)==3?j.j():this.Y(y)},ts.prototype.Y=function(y){try{if(y==this.g)e:{const at=is(this.g),on=this.g.ya(),Ct=this.g.ca();if(!(at<3)&&(at!=3||this.g&&(this.h.h||this.g.la()||Bn(this.g)))){this.K||at!=4||on==7||(on==8||Ct<=0?Br(3):Br(2)),Es(this);var j=this.g.ca();this.X=j;var F=Bm(this);if(this.o=j==200,Td(this.i,this.v,this.B,this.l,this.S,at,j),this.o){if(this.U&&!this.L){t:{if(this.g){var Y,pe=this.g;if((Y=pe.g?pe.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!k(Y)){var ve=Y;break t}}ve=null}if(y=ve)xs(this.i,this.l,y,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,Cs(this,y);else{this.o=!1,this.m=3,Ut(12),Sr(this),zr(this);break e}}if(this.R){y=!0;let Kt;for(;!this.K&&this.C<F.length;)if(Kt=Rd(this,F),Kt==kn){at==4&&(this.m=4,Ut(14),y=!1),xs(this.i,this.l,null,"[Incomplete Response]");break}else if(Kt==fn){this.m=4,Ut(15),xs(this.i,this.l,F,"[Invalid Chunk]"),y=!1;break}else xs(this.i,this.l,Kt,null),Cs(this,Kt);if(jd(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),at!=4||F.length!=0||this.h.h||(this.m=1,Ut(16),y=!1),this.o=this.o&&y,!y)xs(this.i,this.l,F,"[Invalid Chunked Response]"),Sr(this),zr(this);else if(F.length>0&&!this.W){this.W=!0;var Be=this.j;Be.g==this&&Be.aa&&!Be.P&&(Be.j.info("Great, no buffering proxy detected. Bytes received: "+F.length),Hc(Be),Be.P=!0,Ut(11))}}else xs(this.i,this.l,F,null),Cs(this,F);at==4&&Sr(this),this.o&&!this.K&&(at==4?zd(this.j,this):(this.o=!1,Ss(this)))}else ei(this.g),j==400&&F.indexOf("Unknown SID")>0?(this.m=3,Ut(12)):(this.m=0,Ut(13)),Sr(this),zr(this)}}}catch{}};function Bm(y){if(!jd(y))return y.g.la();const j=Bn(y.g);if(j==="")return"";let F="";const Y=j.length,pe=is(y.g)==4;if(!y.h.i){if(typeof TextDecoder>"u")return Sr(y),zr(y),"";y.h.i=new l.TextDecoder}for(let ve=0;ve<Y;ve++)y.h.h=!0,F+=y.h.i.decode(j[ve],{stream:!(pe&&ve==Y-1)});return j.length=0,y.h.g+=F,y.C=0,y.h.g}function jd(y){return y.g?y.v=="GET"&&y.M!=2&&y.j.Aa:!1}function Rd(y,j){var F=y.C,Y=j.indexOf(`
`,F);return Y==-1?kn:(F=Number(j.substring(F,Y)),isNaN(F)?fn:(Y+=1,Y+F>j.length?kn:(j=j.slice(Y,Y+F),y.C=Y+F,j)))}ts.prototype.cancel=function(){this.K=!0,Sr(this)};function Ss(y){y.T=Date.now()+y.H,rl(y,y.H)}function rl(y,j){if(y.D!=null)throw Error("WatchDog timer not null");y.D=vs(f(y.aa,y),j)}function Es(y){y.D&&(l.clearTimeout(y.D),y.D=null)}ts.prototype.aa=function(){this.D=null;const y=Date.now();y-this.T>=0?(eo(this.i,this.B),this.M!=2&&(Br(),Ut(17)),Sr(this),this.m=2,zr(this)):rl(this,this.T-y)};function zr(y){y.j.I==0||y.K||zd(y.j,y)}function Sr(y){Es(y);var j=y.O;j&&typeof j.dispose=="function"&&j.dispose(),y.O=null,xt(y.V),y.g&&(j=y.g,y.g=null,j.abort(),j.dispose())}function Cs(y,j){try{var F=y.j;if(F.I!=0&&(F.g==y||As(F.h,y))){if(!y.L&&As(F.h,y)&&F.I==3){try{var Y=F.Ba.g.parse(j)}catch{Y=null}if(Array.isArray(Y)&&Y.length==3){var pe=Y;if(pe[0]==0){e:if(!F.v){if(F.g)if(F.g.F+3e3<y.F)dl(F),Qi(F);else break e;uo(F),Ut(18)}}else F.xa=pe[1],0<F.xa-F.K&&pe[2]<37500&&F.F&&F.A==0&&!F.C&&(F.C=vs(f(F.Va,F),6e3));Ts(F.h)<=1&&F.ta&&(F.ta=void 0)}else Ms(F,11)}else if((y.L||F.g==y)&&dl(F),!k(j))for(pe=F.Ba.g.parse(j),j=0;j<pe.length;j++){let Ct=pe[j];const Kt=Ct[0];if(!(Kt<=F.K))if(F.K=Kt,Ct=Ct[1],F.I==2)if(Ct[0]=="c"){F.M=Ct[1],F.ba=Ct[2];const Fr=Ct[3];Fr!=null&&(F.ka=Fr,F.j.info("VER="+F.ka));const Os=Ct[4];Os!=null&&(F.za=Os,F.j.info("SVER="+F.za));const as=Ct[5];as!=null&&typeof as=="number"&&as>0&&(Y=1.5*as,F.O=Y,F.j.info("backChannelRequestTimeoutMs_="+Y)),Y=F;const os=y.g;if(os){const ho=os.g?os.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(ho){var ve=Y.h;ve.g||ho.indexOf("spdy")==-1&&ho.indexOf("quic")==-1&&ho.indexOf("h2")==-1||(ve.j=ve.l,ve.g=new Set,ve.h&&(Mc(ve,ve.h),ve.h=null))}if(Y.G){const hl=os.g?os.g.getResponseHeader("X-HTTP-Session-Id"):null;hl&&(Y.wa=hl,It(Y.J,Y.G,hl))}}F.I=3,F.l&&F.l.ra(),F.aa&&(F.T=Date.now()-y.F,F.j.info("Handshake RTT: "+F.T+"ms")),Y=F;var Be=y;if(Y.na=Fd(Y,Y.L?Y.ba:null,Y.W),Be.L){Oc(Y.h,Be);var at=Be,on=Y.O;on&&(at.H=on),at.D&&(Es(at),Ss(at)),Y.g=Be}else Pd(Y);F.i.length>0&&ks(F)}else Ct[0]!="stop"&&Ct[0]!="close"||Ms(F,7);else F.I==3&&(Ct[0]=="stop"||Ct[0]=="close"?Ct[0]=="stop"?Ms(F,7):$c(F):Ct[0]!="noop"&&F.l&&F.l.qa(Ct),F.A=0)}}Br(4)}catch{}}var mn=class{constructor(y,j){this.g=y,this.map=j}};function Dc(y){this.l=y||10,l.PerformanceNavigationTiming?(y=l.performance.getEntriesByType("navigation"),y=y.length>0&&(y[0].nextHopProtocol=="hq"||y[0].nextHopProtocol=="h2")):y=!!(l.chrome&&l.chrome.loadTimes&&l.chrome.loadTimes()&&l.chrome.loadTimes().wasFetchedViaSpdy),this.j=y?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function kc(y){return y.h?!0:y.g?y.g.size>=y.j:!1}function Ts(y){return y.h?1:y.g?y.g.size:0}function As(y,j){return y.h?y.h==j:y.g?y.g.has(j):!1}function Mc(y,j){y.g?y.g.add(j):y.h=j}function Oc(y,j){y.h&&y.h==j?y.h=null:y.g&&y.g.has(j)&&y.g.delete(j)}Dc.prototype.cancel=function(){if(this.i=Nc(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const y of this.g.values())y.cancel();this.g.clear()}};function Nc(y){if(y.h!=null)return y.i.concat(y.h.G);if(y.g!=null&&y.g.size!==0){let j=y.i;for(const F of y.g.values())j=j.concat(F.G);return j}return _(y.i)}var Id=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function sl(y,j){if(y){y=y.split("&");for(let F=0;F<y.length;F++){const Y=y[F].indexOf("=");let pe,ve=null;Y>=0?(pe=y[F].substring(0,Y),ve=y[F].substring(Y+1)):pe=y[F],j(pe,ve?decodeURIComponent(ve.replace(/\+/g," ")):"")}}}function Er(y){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let j;y instanceof Er?(this.l=y.l,Mn(this,y.j),this.o=y.o,this.g=y.g,Fi(this,y.u),this.h=y.h,Pc(this,Od(y.i)),this.m=y.m):y&&(j=String(y).match(Id))?(this.l=!1,Mn(this,j[1]||"",!0),this.o=js(j[2]||""),this.g=js(j[3]||"",!0),Fi(this,j[4]),this.h=js(j[5]||"",!0),Pc(this,j[6]||"",!0),this.m=js(j[7]||"")):(this.l=!1,this.i=new $i(null,this.l))}Er.prototype.toString=function(){const y=[];var j=this.j;j&&y.push(so(j,il,!0),":");var F=this.g;return(F||j=="file")&&(y.push("//"),(j=this.o)&&y.push(so(j,il,!0),"@"),y.push(Zs(F).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),F=this.u,F!=null&&y.push(":",String(F))),(F=this.h)&&(this.g&&F.charAt(0)!="/"&&y.push("/"),y.push(so(F,F.charAt(0)=="/"?Bc:Dd,!0))),(F=this.i.toString())&&y.push("?",F),(F=this.m)&&y.push("#",so(F,kd)),y.join("")},Er.prototype.resolve=function(y){const j=pn(this);let F=!!y.j;F?Mn(j,y.j):F=!!y.o,F?j.o=y.o:F=!!y.g,F?j.g=y.g:F=y.u!=null;var Y=y.h;if(F)Fi(j,y.u);else if(F=!!y.h){if(Y.charAt(0)!="/")if(this.g&&!this.h)Y="/"+Y;else{var pe=j.h.lastIndexOf("/");pe!=-1&&(Y=j.h.slice(0,pe+1)+Y)}if(pe=Y,pe==".."||pe==".")Y="";else if(pe.indexOf("./")!=-1||pe.indexOf("/.")!=-1){Y=pe.lastIndexOf("/",0)==0,pe=pe.split("/");const ve=[];for(let Be=0;Be<pe.length;){const at=pe[Be++];at=="."?Y&&Be==pe.length&&ve.push(""):at==".."?((ve.length>1||ve.length==1&&ve[0]!="")&&ve.pop(),Y&&Be==pe.length&&ve.push("")):(ve.push(at),Y=!0)}Y=ve.join("/")}else Y=pe}return F?j.h=Y:F=y.i.toString()!=="",F?Pc(j,Od(y.i)):F=!!y.m,F&&(j.m=y.m),j};function pn(y){return new Er(y)}function Mn(y,j,F){y.j=F?js(j,!0):j,y.j&&(y.j=y.j.replace(/:$/,""))}function Fi(y,j){if(j){if(j=Number(j),isNaN(j)||j<0)throw Error("Bad port number "+j);y.u=j}else y.u=null}function Pc(y,j,F){j instanceof $i?(y.i=j,ol(y.i,y.l)):(F||(j=so(j,Vi)),y.i=new $i(j,y.l))}function It(y,j,F){y.i.set(j,F)}function ro(y){return It(y,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),y}function js(y,j){return y?j?decodeURI(y.replace(/%25/g,"%2525")):decodeURIComponent(y):""}function so(y,j,F){return typeof y=="string"?(y=encodeURI(y).replace(j,dr),F&&(y=y.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),y):null}function dr(y){return y=y.charCodeAt(0),"%"+(y>>4&15).toString(16)+(y&15).toString(16)}var il=/[#\/\?@]/g,Dd=/[#\?:]/g,Bc=/[#\?]/g,Vi=/[#\?@]/g,kd=/#/g;function $i(y,j){this.h=this.g=null,this.i=y||null,this.j=!!j}function hr(y){y.g||(y.g=new Map,y.h=0,y.i&&sl(y.i,function(j,F){y.add(decodeURIComponent(j.replace(/\+/g," ")),F)}))}t=$i.prototype,t.add=function(y,j){hr(this),this.i=null,y=qi(this,y);let F=this.g.get(y);return F||this.g.set(y,F=[]),F.push(j),this.h+=1,this};function Md(y,j){hr(y),j=qi(y,j),y.g.has(j)&&(y.i=null,y.h-=y.g.get(j).length,y.g.delete(j))}function zc(y,j){return hr(y),j=qi(y,j),y.g.has(j)}t.forEach=function(y,j){hr(this),this.g.forEach(function(F,Y){F.forEach(function(pe){y.call(j,pe,Y,this)},this)},this)};function Lc(y,j){hr(y);let F=[];if(typeof j=="string")zc(y,j)&&(F=F.concat(y.g.get(qi(y,j))));else for(y=Array.from(y.g.values()),j=0;j<y.length;j++)F=F.concat(y[j]);return F}t.set=function(y,j){return hr(this),this.i=null,y=qi(this,y),zc(this,y)&&(this.h-=this.g.get(y).length),this.g.set(y,[j]),this.h+=1,this},t.get=function(y,j){return y?(y=Lc(this,y),y.length>0?String(y[0]):j):j};function al(y,j,F){Md(y,j),F.length>0&&(y.i=null,y.g.set(qi(y,j),_(F)),y.h+=F.length)}t.toString=function(){if(this.i)return this.i;if(!this.g)return"";const y=[],j=Array.from(this.g.keys());for(let Y=0;Y<j.length;Y++){var F=j[Y];const pe=Zs(F);F=Lc(this,F);for(let ve=0;ve<F.length;ve++){let Be=pe;F[ve]!==""&&(Be+="="+Zs(F[ve])),y.push(Be)}}return this.i=y.join("&")};function Od(y){const j=new $i;return j.i=y.i,y.g&&(j.g=new Map(y.g),j.h=y.h),j}function qi(y,j){return j=String(j),y.j&&(j=j.toLowerCase()),j}function ol(y,j){j&&!y.j&&(hr(y),y.i=null,y.g.forEach(function(F,Y){const pe=Y.toLowerCase();Y!=pe&&(Md(this,Y),al(this,pe,F))},y)),y.j=j}function rs(y,j){const F=new es;if(l.Image){const Y=new Image;Y.onload=p(Lr,F,"TestLoadImage: loaded",!0,j,Y),Y.onerror=p(Lr,F,"TestLoadImage: error",!1,j,Y),Y.onabort=p(Lr,F,"TestLoadImage: abort",!1,j,Y),Y.ontimeout=p(Lr,F,"TestLoadImage: timeout",!1,j,Y),l.setTimeout(function(){Y.ontimeout&&Y.ontimeout()},1e4),Y.src=y}else j(!1)}function Uc(y,j){const F=new es,Y=new AbortController,pe=setTimeout(()=>{Y.abort(),Lr(F,"TestPingServer: timeout",!1,j)},1e4);fetch(y,{signal:Y.signal}).then(ve=>{clearTimeout(pe),ve.ok?Lr(F,"TestPingServer: ok",!0,j):Lr(F,"TestPingServer: server error",!1,j)}).catch(()=>{clearTimeout(pe),Lr(F,"TestPingServer: error",!1,j)})}function Lr(y,j,F,Y,pe){try{pe&&(pe.onload=null,pe.onerror=null,pe.onabort=null,pe.ontimeout=null),Y(F)}catch{}}function Hi(){this.g=new ys}function Rs(y){this.i=y.Sb||null,this.h=y.ab||!1}g(Rs,rr),Rs.prototype.g=function(){return new io(this.i,this.h)};function io(y,j){oe.call(this),this.H=y,this.o=j,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}g(io,oe),t=io.prototype,t.open=function(y,j){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=y,this.D=j,this.readyState=1,ss(this)},t.send=function(y){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const j={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};y&&(j.body=y),(this.H||l).fetch(new Request(this.D,j)).then(this.Pa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,Gi(this)),this.readyState=0},t.Pa=function(y){if(this.g&&(this.l=y,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=y.headers,this.readyState=2,ss(this)),this.g&&(this.readyState=3,ss(this),this.g)))if(this.responseType==="arraybuffer")y.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof l.ReadableStream<"u"&&"body"in y){if(this.j=y.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;ll(this)}else y.text().then(this.Oa.bind(this),this.ga.bind(this))};function ll(y){y.j.read().then(y.Ma.bind(y)).catch(y.ga.bind(y))}t.Ma=function(y){if(this.g){if(this.o&&y.value)this.response.push(y.value);else if(!this.o){var j=y.value?y.value:new Uint8Array(0);(j=this.B.decode(j,{stream:!y.done}))&&(this.response=this.responseText+=j)}y.done?Gi(this):ss(this),this.readyState==3&&ll(this)}},t.Oa=function(y){this.g&&(this.response=this.responseText=y,Gi(this))},t.Na=function(y){this.g&&(this.response=y,Gi(this))},t.ga=function(){this.g&&Gi(this)};function Gi(y){y.readyState=4,y.l=null,y.j=null,y.B=null,ss(y)}t.setRequestHeader=function(y,j){this.A.append(y,j)},t.getResponseHeader=function(y){return this.h&&this.h.get(y.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";const y=[],j=this.h.entries();for(var F=j.next();!F.done;)F=F.value,y.push(F[0]+": "+F[1]),F=j.next();return y.join(`\r
`)};function ss(y){y.onreadystatechange&&y.onreadystatechange.call(y)}Object.defineProperty(io.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(y){this.m=y?"include":"same-origin"}});function Ur(y){let j="";return Q(y,function(F,Y){j+=Y,j+=":",j+=F,j+=`\r
`}),j}function ao(y,j,F){e:{for(Y in F){var Y=!1;break e}Y=!0}Y||(F=Ur(F),typeof y=="string"?F!=null&&Zs(F):It(y,j,F))}function Mt(y){oe.call(this),this.headers=new Map,this.L=y||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}g(Mt,oe);var Is=/^https?$/i,Fc=["POST","PUT"];t=Mt.prototype,t.Fa=function(y){this.H=y},t.ea=function(y,j,F,Y){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+y);j=j?j.toUpperCase():"GET",this.D=y,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():Ic.g(),this.g.onreadystatechange=b(f(this.Ca,this));try{this.B=!0,this.g.open(j,String(y),!0),this.B=!1}catch(ve){oo(this,ve);return}if(y=F||"",F=new Map(this.headers),Y)if(Object.getPrototypeOf(Y)===Object.prototype)for(var pe in Y)F.set(pe,Y[pe]);else if(typeof Y.keys=="function"&&typeof Y.get=="function")for(const ve of Y.keys())F.set(ve,Y.get(ve));else throw Error("Unknown input type for opt_headers: "+String(Y));Y=Array.from(F.keys()).find(ve=>ve.toLowerCase()=="content-type"),pe=l.FormData&&y instanceof l.FormData,!(Array.prototype.indexOf.call(Fc,j,void 0)>=0)||Y||pe||F.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[ve,Be]of F)this.g.setRequestHeader(ve,Be);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(y),this.v=!1}catch(ve){oo(this,ve)}};function oo(y,j){y.h=!1,y.g&&(y.j=!0,y.g.abort(),y.j=!1),y.l=j,y.o=5,Vc(y),Js(y)}function Vc(y){y.A||(y.A=!0,Se(y,"complete"),Se(y,"error"))}t.abort=function(y){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=y||7,Se(this,"complete"),Se(this,"abort"),Js(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Js(this,!0)),Mt.Z.N.call(this)},t.Ca=function(){this.u||(this.B||this.v||this.j?lo(this):this.Xa())},t.Xa=function(){lo(this)};function lo(y){if(y.h&&typeof o<"u"){if(y.v&&is(y)==4)setTimeout(y.Ca.bind(y),0);else if(Se(y,"readystatechange"),is(y)==4){y.h=!1;try{const ve=y.ca();e:switch(ve){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var j=!0;break e;default:j=!1}var F;if(!(F=j)){var Y;if(Y=ve===0){let Be=String(y.D).match(Id)[1]||null;!Be&&l.self&&l.self.location&&(Be=l.self.location.protocol.slice(0,-1)),Y=!Is.test(Be?Be.toLowerCase():"")}F=Y}if(F)Se(y,"complete"),Se(y,"success");else{y.o=6;try{var pe=is(y)>2?y.g.statusText:""}catch{pe=""}y.l=pe+" ["+y.ca()+"]",Vc(y)}}finally{Js(y)}}}}function Js(y,j){if(y.g){y.m&&(clearTimeout(y.m),y.m=null);const F=y.g;y.g=null,j||Se(y,"ready");try{F.onreadystatechange=null}catch{}}}t.isActive=function(){return!!this.g};function is(y){return y.g?y.g.readyState:0}t.ca=function(){try{return is(this)>2?this.g.status:-1}catch{return-1}},t.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},t.La=function(y){if(this.g){var j=this.g.responseText;return y&&j.indexOf(y)==0&&(j=j.substring(y.length)),Wn(j)}};function Bn(y){try{if(!y.g)return null;if("response"in y.g)return y.g.response;switch(y.F){case"":case"text":return y.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in y.g)return y.g.mozResponseArrayBuffer}return null}catch{return null}}function ei(y){const j={};y=(y.g&&is(y)>=2&&y.g.getAllResponseHeaders()||"").split(`\r
`);for(let Y=0;Y<y.length;Y++){if(k(y[Y]))continue;var F=Ad(y[Y]);const pe=F[0];if(F=F[1],typeof F!="string")continue;F=F.trim();const ve=j[pe]||[];j[pe]=ve,ve.push(F)}se(j,function(Y){return Y.join(", ")})}t.ya=function(){return this.o},t.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function Ds(y,j,F){return F&&F.internalChannelParams&&F.internalChannelParams[y]||j}function Wi(y){this.za=0,this.i=[],this.j=new es,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=Ds("failFast",!1,y),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=Ds("baseRetryDelayMs",5e3,y),this.Za=Ds("retryDelaySeedMs",1e4,y),this.Ta=Ds("forwardChannelMaxRetries",2,y),this.va=Ds("forwardChannelRequestTimeoutMs",2e4,y),this.ma=y&&y.xmlHttpFactory||void 0,this.Ua=y&&y.Rb||void 0,this.Aa=y&&y.useFetchStreams||!1,this.O=void 0,this.L=y&&y.supportsCrossDomainXhr||!1,this.M="",this.h=new Dc(y&&y.concurrentRequestLimit),this.Ba=new Hi,this.S=y&&y.fastHandshake||!1,this.R=y&&y.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=y&&y.Pb||!1,y&&y.ua&&this.j.ua(),y&&y.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&y&&y.detectBufferingProxy||!1,this.ia=void 0,y&&y.longPollingTimeout&&y.longPollingTimeout>0&&(this.ia=y.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}t=Wi.prototype,t.ka=8,t.I=1,t.connect=function(y,j,F,Y){Ut(0),this.W=y,this.H=j||{},F&&Y!==void 0&&(this.H.OSID=F,this.H.OAID=Y),this.F=this.X,this.J=Fd(this,null,this.W),ks(this)};function $c(y){if(cl(y),y.I==3){var j=y.V++,F=pn(y.J);if(It(F,"SID",y.M),It(F,"RID",j),It(F,"TYPE","terminate"),co(y,F),j=new ts(y,y.j,j),j.M=2,j.A=ro(pn(F)),F=!1,l.navigator&&l.navigator.sendBeacon)try{F=l.navigator.sendBeacon(j.A.toString(),"")}catch{}!F&&l.Image&&(new Image().src=j.A,F=!0),F||(j.g=Vd(j.j,null),j.g.ea(j.A)),j.F=Date.now(),Ss(j)}Ud(y)}function Qi(y){y.g&&(Hc(y),y.g.cancel(),y.g=null)}function cl(y){Qi(y),y.v&&(l.clearTimeout(y.v),y.v=null),dl(y),y.h.cancel(),y.m&&(typeof y.m=="number"&&l.clearTimeout(y.m),y.m=null)}function ks(y){if(!kc(y.h)&&!y.m){y.m=!0;var j=y.Ea;U||P(),H||(U(),H=!0),O.add(j,y),y.D=0}}function ul(y,j){return Ts(y.h)>=y.h.j-(y.m?1:0)?!1:y.m?(y.i=j.G.concat(y.i),!0):y.I==1||y.I==2||y.D>=(y.Sa?0:y.Ta)?!1:(y.m=vs(f(y.Ea,y,j),Ld(y,y.D)),y.D++,!0)}t.Ea=function(y){if(this.m)if(this.m=null,this.I==1){if(!y){this.V=Math.floor(Math.random()*1e5),y=this.V++;const pe=new ts(this,this.j,y);let ve=this.o;if(this.U&&(ve?(ve=B(ve),ee(ve,this.U)):ve=this.U),this.u!==null||this.R||(pe.J=ve,ve=null),this.S)e:{for(var j=0,F=0;F<this.i.length;F++){t:{var Y=this.i[F];if("__data__"in Y.map&&(Y=Y.map.__data__,typeof Y=="string")){Y=Y.length;break t}Y=void 0}if(Y===void 0)break;if(j+=Y,j>4096){j=F;break e}if(j===4096||F===this.i.length-1){j=F+1;break e}}j=1e3}else j=1e3;j=Nd(this,pe,j),F=pn(this.J),It(F,"RID",y),It(F,"CVER",22),this.G&&It(F,"X-HTTP-Session-Id",this.G),co(this,F),ve&&(this.R?j="headers="+Zs(Ur(ve))+"&"+j:this.u&&ao(F,this.u,ve)),Mc(this.h,pe),this.Ra&&It(F,"TYPE","init"),this.S?(It(F,"$req",j),It(F,"SID","null"),pe.U=!0,ws(pe,F,null)):ws(pe,F,j),this.I=2}}else this.I==3&&(y?qc(this,y):this.i.length==0||kc(this.h)||qc(this))};function qc(y,j){var F;j?F=j.l:F=y.V++;const Y=pn(y.J);It(Y,"SID",y.M),It(Y,"RID",F),It(Y,"AID",y.K),co(y,Y),y.u&&y.o&&ao(Y,y.u,y.o),F=new ts(y,y.j,F,y.D+1),y.u===null&&(F.J=y.o),j&&(y.i=j.G.concat(y.i)),j=Nd(y,F,1e3),F.H=Math.round(y.va*.5)+Math.round(y.va*.5*Math.random()),Mc(y.h,F),ws(F,Y,j)}function co(y,j){y.H&&Q(y.H,function(F,Y){It(j,Y,F)}),y.l&&Q({},function(F,Y){It(j,Y,F)})}function Nd(y,j,F){F=Math.min(y.i.length,F);const Y=y.l?f(y.l.Ka,y.l,y):null;e:{var pe=y.i;let at=-1;for(;;){const on=["count="+F];at==-1?F>0?(at=pe[0].g,on.push("ofs="+at)):at=0:on.push("ofs="+at);let Ct=!0;for(let Kt=0;Kt<F;Kt++){var ve=pe[Kt].g;const Fr=pe[Kt].map;if(ve-=at,ve<0)at=Math.max(0,pe[Kt].g-100),Ct=!1;else try{ve="req"+ve+"_"||"";try{var Be=Fr instanceof Map?Fr:Object.entries(Fr);for(const[Os,as]of Be){let os=as;u(as)&&(os=it(as)),on.push(ve+Os+"="+encodeURIComponent(os))}}catch(Os){throw on.push(ve+"type="+encodeURIComponent("_badmap")),Os}}catch{Y&&Y(Fr)}}if(Ct){Be=on.join("&");break e}}Be=void 0}return y=y.i.splice(0,F),j.G=y,Be}function Pd(y){if(!y.g&&!y.v){y.Y=1;var j=y.Da;U||P(),H||(U(),H=!0),O.add(j,y),y.A=0}}function uo(y){return y.g||y.v||y.A>=3?!1:(y.Y++,y.v=vs(f(y.Da,y),Ld(y,y.A)),y.A++,!0)}t.Da=function(){if(this.v=null,Bd(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var y=4*this.T;this.j.info("BP detection timer enabled: "+y),this.B=vs(f(this.Wa,this),y)}},t.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,Ut(10),Qi(this),Bd(this))};function Hc(y){y.B!=null&&(l.clearTimeout(y.B),y.B=null)}function Bd(y){y.g=new ts(y,y.j,"rpc",y.Y),y.u===null&&(y.g.J=y.o),y.g.P=0;var j=pn(y.na);It(j,"RID","rpc"),It(j,"SID",y.M),It(j,"AID",y.K),It(j,"CI",y.F?"0":"1"),!y.F&&y.ia&&It(j,"TO",y.ia),It(j,"TYPE","xmlhttp"),co(y,j),y.u&&y.o&&ao(j,y.u,y.o),y.O&&(y.g.H=y.O);var F=y.g;y=y.ba,F.M=1,F.A=ro(pn(j)),F.u=null,F.R=!0,nl(F,y)}t.Va=function(){this.C!=null&&(this.C=null,Qi(this),uo(this),Ut(19))};function dl(y){y.C!=null&&(l.clearTimeout(y.C),y.C=null)}function zd(y,j){var F=null;if(y.g==j){dl(y),Hc(y),y.g=null;var Y=2}else if(As(y.h,j))F=j.G,Oc(y.h,j),Y=1;else return;if(y.I!=0){if(j.o)if(Y==1){F=j.u?j.u.length:0,j=Date.now()-j.F;var pe=y.D;Y=Ui(),Se(Y,new sr(Y,F)),ks(y)}else Pd(y);else if(pe=j.m,pe==3||pe==0&&j.X>0||!(Y==1&&ul(y,j)||Y==2&&uo(y)))switch(F&&F.length>0&&(j=y.h,j.i=j.i.concat(F)),pe){case 1:Ms(y,5);break;case 4:Ms(y,10);break;case 3:Ms(y,6);break;default:Ms(y,2)}}}function Ld(y,j){let F=y.Qa+Math.floor(Math.random()*y.Za);return y.isActive()||(F*=2),F*j}function Ms(y,j){if(y.j.info("Error code "+j),j==2){var F=f(y.bb,y),Y=y.Ua;const pe=!Y;Y=new Er(Y||"//www.google.com/images/cleardot.gif"),l.location&&l.location.protocol=="http"||Mn(Y,"https"),ro(Y),pe?rs(Y.toString(),F):Uc(Y.toString(),F)}else Ut(2);y.I=0,y.l&&y.l.pa(j),Ud(y),cl(y)}t.bb=function(y){y?(this.j.info("Successfully pinged google.com"),Ut(2)):(this.j.info("Failed to ping google.com"),Ut(1))};function Ud(y){if(y.I=0,y.ja=[],y.l){const j=Nc(y.h);(j.length!=0||y.i.length!=0)&&(w(y.ja,j),w(y.ja,y.i),y.h.i.length=0,_(y.i),y.i.length=0),y.l.oa()}}function Fd(y,j,F){var Y=F instanceof Er?pn(F):new Er(F);if(Y.g!="")j&&(Y.g=j+"."+Y.g),Fi(Y,Y.u);else{var pe=l.location;Y=pe.protocol,j=j?j+"."+pe.hostname:pe.hostname,pe=+pe.port;const ve=new Er(null);Y&&Mn(ve,Y),j&&(ve.g=j),pe&&Fi(ve,pe),F&&(ve.h=F),Y=ve}return F=y.G,j=y.wa,F&&j&&It(Y,F,j),It(Y,"VER",y.ka),co(y,Y),Y}function Vd(y,j,F){if(j&&!y.L)throw Error("Can't create secondary domain capable XhrIo object.");return j=y.Aa&&!y.ma?new Mt(new Rs({ab:F})):new Mt(y.ma),j.Fa(y.L),j}t.isActive=function(){return!!this.l&&this.l.isActive(this)};function $d(){}t=$d.prototype,t.ra=function(){},t.qa=function(){},t.pa=function(){},t.oa=function(){},t.isActive=function(){return!0},t.Ka=function(){};function Ki(){}Ki.prototype.g=function(y,j){return new ir(y,j)};function ir(y,j){oe.call(this),this.g=new Wi(j),this.l=y,this.h=j&&j.messageUrlParams||null,y=j&&j.messageHeaders||null,j&&j.clientProtocolHeaderRequired&&(y?y["X-Client-Protocol"]="webchannel":y={"X-Client-Protocol":"webchannel"}),this.g.o=y,y=j&&j.initMessageHeaders||null,j&&j.messageContentType&&(y?y["X-WebChannel-Content-Type"]=j.messageContentType:y={"X-WebChannel-Content-Type":j.messageContentType}),j&&j.sa&&(y?y["X-WebChannel-Client-Profile"]=j.sa:y={"X-WebChannel-Client-Profile":j.sa}),this.g.U=y,(y=j&&j.Qb)&&!k(y)&&(this.g.u=y),this.A=j&&j.supportsCrossDomainXhr||!1,this.v=j&&j.sendRawJson||!1,(j=j&&j.httpSessionIdParam)&&!k(j)&&(this.g.G=j,y=this.h,y!==null&&j in y&&(y=this.h,j in y&&delete y[j])),this.j=new ti(this)}g(ir,oe),ir.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},ir.prototype.close=function(){$c(this.g)},ir.prototype.o=function(y){var j=this.g;if(typeof y=="string"){var F={};F.__data__=y,y=F}else this.v&&(F={},F.__data__=it(y),y=F);j.i.push(new mn(j.Ya++,y)),j.I==3&&ks(j)},ir.prototype.N=function(){this.g.l=null,delete this.j,$c(this.g),delete this.g,ir.Z.N.call(this)};function qd(y){nn.call(this),y.__headers__&&(this.headers=y.__headers__,this.statusCode=y.__status__,delete y.__headers__,delete y.__status__);var j=y.__sm__;if(j){e:{for(const F in j){y=F;break e}y=void 0}(this.i=y)&&(y=this.i,j=j!==null&&y in j?j[y]:void 0),this.data=j}else this.data=y}g(qd,nn);function Hd(){Qn.call(this),this.status=1}g(Hd,Qn);function ti(y){this.g=y}g(ti,$d),ti.prototype.ra=function(){Se(this.g,"a")},ti.prototype.qa=function(y){Se(this.g,new qd(y))},ti.prototype.pa=function(y){Se(this.g,new Hd)},ti.prototype.oa=function(){Se(this.g,"b")},Ki.prototype.createWebChannel=Ki.prototype.g,ir.prototype.send=ir.prototype.o,ir.prototype.open=ir.prototype.m,ir.prototype.close=ir.prototype.close,eC=function(){return new Ki},JE=function(){return Ui()},ZE=Et,Cy={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},to.NO_ERROR=0,to.TIMEOUT=8,to.HTTP_ERROR=6,ff=to,Rc.COMPLETE="complete",XE=Rc,_s.EventType=vt,vt.OPEN="a",vt.CLOSE="b",vt.ERROR="c",vt.MESSAGE="d",oe.prototype.listen=oe.prototype.J,Ou=_s,Mt.prototype.listenOnce=Mt.prototype.K,Mt.prototype.getLastError=Mt.prototype.Ha,Mt.prototype.getLastErrorCode=Mt.prototype.ya,Mt.prototype.getStatus=Mt.prototype.ca,Mt.prototype.getResponseJson=Mt.prototype.La,Mt.prototype.getResponseText=Mt.prototype.la,Mt.prototype.send=Mt.prototype.ea,Mt.prototype.setWithCredentials=Mt.prototype.Fa,YE=Mt}).apply(typeof Jh<"u"?Jh:typeof self<"u"?self:typeof window<"u"?window:{});const $w="@firebase/firestore",qw="4.9.3";class Zn{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Zn.UNAUTHENTICATED=new Zn(null),Zn.GOOGLE_CREDENTIALS=new Zn("google-credentials-uid"),Zn.FIRST_PARTY=new Zn("first-party-uid"),Zn.MOCK_USER=new Zn("mock-user");let vc="12.7.0";const Vo=new t0("@firebase/firestore");function Hl(){return Vo.logLevel}function Fe(t,...e){if(Vo.logLevel<=pt.DEBUG){const n=e.map(g0);Vo.debug(`Firestore (${vc}): ${t}`,...n)}}function ki(t,...e){if(Vo.logLevel<=pt.ERROR){const n=e.map(g0);Vo.error(`Firestore (${vc}): ${t}`,...n)}}function rc(t,...e){if(Vo.logLevel<=pt.WARN){const n=e.map(g0);Vo.warn(`Firestore (${vc}): ${t}`,...n)}}function g0(t){if(typeof t=="string")return t;try{return(function(n){return JSON.stringify(n)})(t)}catch{return t}}function Ze(t,e,n){let r="Unexpected state";typeof e=="string"?r=e:n=e,tC(t,r,n)}function tC(t,e,n){let r=`FIRESTORE (${vc}) INTERNAL ASSERTION FAILED: ${e} (ID: ${t.toString(16)})`;if(n!==void 0)try{r+=" CONTEXT: "+JSON.stringify(n)}catch{r+=" CONTEXT: "+n}throw ki(r),new Error(r)}function jt(t,e,n,r){let i="Unexpected state";typeof n=="string"?i=n:r=n,t||tC(e,i,r)}function st(t,e){return t}const Ie={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Le extends Bi{constructor(e,n){super(e,n),this.code=e,this.message=n,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Ti{constructor(){this.promise=new Promise(((e,n)=>{this.resolve=e,this.reject=n}))}}class nC{constructor(e,n){this.user=n,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class IM{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,n){e.enqueueRetryable((()=>n(Zn.UNAUTHENTICATED)))}shutdown(){}}class DM{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,n){this.changeListener=n,e.enqueueRetryable((()=>n(this.token.user)))}shutdown(){this.changeListener=null}}class kM{constructor(e){this.t=e,this.currentUser=Zn.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,n){jt(this.o===void 0,42304);let r=this.i;const i=h=>this.i!==r?(r=this.i,n(h)):Promise.resolve();let o=new Ti;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new Ti,e.enqueueRetryable((()=>i(this.currentUser)))};const l=()=>{const h=o;e.enqueueRetryable((async()=>{await h.promise,await i(this.currentUser)}))},u=h=>{Fe("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=h,this.o&&(this.auth.addAuthTokenListener(this.o),l())};this.t.onInit((h=>u(h))),setTimeout((()=>{if(!this.auth){const h=this.t.getImmediate({optional:!0});h?u(h):(Fe("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new Ti)}}),0),l()}getToken(){const e=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then((r=>this.i!==e?(Fe("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(jt(typeof r.accessToken=="string",31837,{l:r}),new nC(r.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return jt(e===null||typeof e=="string",2055,{h:e}),new Zn(e)}}class MM{constructor(e,n,r){this.P=e,this.T=n,this.I=r,this.type="FirstParty",this.user=Zn.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class OM{constructor(e,n,r){this.P=e,this.T=n,this.I=r}getToken(){return Promise.resolve(new MM(this.P,this.T,this.I))}start(e,n){e.enqueueRetryable((()=>n(Zn.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class Hw{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class NM{constructor(e,n){this.V=n,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,ds(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,n){jt(this.o===void 0,3512);const r=o=>{o.error!=null&&Fe("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${o.error.message}`);const l=o.token!==this.m;return this.m=o.token,Fe("FirebaseAppCheckTokenProvider",`Received ${l?"new":"existing"} token.`),l?n(o.token):Promise.resolve()};this.o=o=>{e.enqueueRetryable((()=>r(o)))};const i=o=>{Fe("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=o,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((o=>i(o))),setTimeout((()=>{if(!this.appCheck){const o=this.V.getImmediate({optional:!0});o?i(o):Fe("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new Hw(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((n=>n?(jt(typeof n.token=="string",44558,{tokenResult:n}),this.m=n.token,new Hw(n.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function PM(t){const e=typeof self<"u"&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(n);else for(let r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}class y0{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const i=PM(40);for(let o=0;o<i.length;++o)r.length<20&&i[o]<n&&(r+=e.charAt(i[o]%62))}return r}}function gt(t,e){return t<e?-1:t>e?1:0}function Ty(t,e){const n=Math.min(t.length,e.length);for(let r=0;r<n;r++){const i=t.charAt(r),o=e.charAt(r);if(i!==o)return Wg(i)===Wg(o)?gt(i,o):Wg(i)?1:-1}return gt(t.length,e.length)}const BM=55296,zM=57343;function Wg(t){const e=t.charCodeAt(0);return e>=BM&&e<=zM}function sc(t,e,n){return t.length===e.length&&t.every(((r,i)=>n(r,e[i])))}const Gw="__name__";class Us{constructor(e,n,r){n===void 0?n=0:n>e.length&&Ze(637,{offset:n,range:e.length}),r===void 0?r=e.length-n:r>e.length-n&&Ze(1746,{length:r,range:e.length-n}),this.segments=e,this.offset=n,this.len=r}get length(){return this.len}isEqual(e){return Us.comparator(this,e)===0}child(e){const n=this.segments.slice(this.offset,this.limit());return e instanceof Us?e.forEach((r=>{n.push(r)})):n.push(e),this.construct(n)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}forEach(e){for(let n=this.offset,r=this.limit();n<r;n++)e(this.segments[n])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,n){const r=Math.min(e.length,n.length);for(let i=0;i<r;i++){const o=Us.compareSegments(e.get(i),n.get(i));if(o!==0)return o}return gt(e.length,n.length)}static compareSegments(e,n){const r=Us.isNumericId(e),i=Us.isNumericId(n);return r&&!i?-1:!r&&i?1:r&&i?Us.extractNumericId(e).compare(Us.extractNumericId(n)):Ty(e,n)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return ka.fromString(e.substring(4,e.length-2))}}class $t extends Us{construct(e,n,r){return new $t(e,n,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const n=[];for(const r of e){if(r.indexOf("//")>=0)throw new Le(Ie.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);n.push(...r.split("/").filter((i=>i.length>0)))}return new $t(n)}static emptyPath(){return new $t([])}}const LM=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class $n extends Us{construct(e,n,r){return new $n(e,n,r)}static isValidIdentifier(e){return LM.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),$n.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===Gw}static keyField(){return new $n([Gw])}static fromServerFormat(e){const n=[];let r="",i=0;const o=()=>{if(r.length===0)throw new Le(Ie.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);n.push(r),r=""};let l=!1;for(;i<e.length;){const u=e[i];if(u==="\\"){if(i+1===e.length)throw new Le(Ie.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const h=e[i+1];if(h!=="\\"&&h!=="."&&h!=="`")throw new Le(Ie.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=h,i+=2}else u==="`"?(l=!l,i++):u!=="."||l?(r+=u,i++):(o(),i++)}if(o(),l)throw new Le(Ie.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new $n(n)}static emptyPath(){return new $n([])}}class We{constructor(e){this.path=e}static fromPath(e){return new We($t.fromString(e))}static fromName(e){return new We($t.fromString(e).popFirst(5))}static empty(){return new We($t.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&$t.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,n){return $t.comparator(e.path,n.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new We(new $t(e.slice()))}}function rC(t,e,n){if(!n)throw new Le(Ie.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function UM(t,e,n,r){if(e===!0&&r===!0)throw new Le(Ie.INVALID_ARGUMENT,`${t} and ${n} cannot be used together.`)}function Ww(t){if(!We.isDocumentKey(t))throw new Le(Ie.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function Qw(t){if(We.isDocumentKey(t))throw new Le(Ie.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function sC(t){return typeof t=="object"&&t!==null&&(Object.getPrototypeOf(t)===Object.prototype||Object.getPrototypeOf(t)===null)}function rm(t){if(t===void 0)return"undefined";if(t===null)return"null";if(typeof t=="string")return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if(typeof t=="number"||typeof t=="boolean")return""+t;if(typeof t=="object"){if(t instanceof Array)return"an array";{const e=(function(r){return r.constructor?r.constructor.name:null})(t);return e?`a custom ${e} object`:"an object"}}return typeof t=="function"?"a function":Ze(12329,{type:typeof t})}function ps(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new Le(Ie.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=rm(t);throw new Le(Ie.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}function Sn(t,e){const n={typeString:t};return e&&(n.value=e),n}function md(t,e){if(!sC(t))throw new Le(Ie.INVALID_ARGUMENT,"JSON must be an object");let n;for(const r in e)if(e[r]){const i=e[r].typeString,o="value"in e[r]?{value:e[r].value}:void 0;if(!(r in t)){n=`JSON missing required field: '${r}'`;break}const l=t[r];if(i&&typeof l!==i){n=`JSON field '${r}' must be a ${i}.`;break}if(o!==void 0&&l!==o.value){n=`Expected '${r}' field to equal '${o.value}'`;break}}if(n)throw new Le(Ie.INVALID_ARGUMENT,n);return!0}const Kw=-62135596800,Yw=1e6;class Wt{static now(){return Wt.fromMillis(Date.now())}static fromDate(e){return Wt.fromMillis(e.getTime())}static fromMillis(e){const n=Math.floor(e/1e3),r=Math.floor((e-1e3*n)*Yw);return new Wt(n,r)}constructor(e,n){if(this.seconds=e,this.nanoseconds=n,n<0)throw new Le(Ie.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new Le(Ie.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(e<Kw)throw new Le(Ie.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Le(Ie.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/Yw}_compareTo(e){return this.seconds===e.seconds?gt(this.nanoseconds,e.nanoseconds):gt(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:Wt._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(md(e,Wt._jsonSchema))return new Wt(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-Kw;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}Wt._jsonSchemaVersion="firestore/timestamp/1.0",Wt._jsonSchema={type:Sn("string",Wt._jsonSchemaVersion),seconds:Sn("number"),nanoseconds:Sn("number")};class Je{static fromTimestamp(e){return new Je(e)}static min(){return new Je(new Wt(0,0))}static max(){return new Je(new Wt(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const Yu=-1;function FM(t,e){const n=t.toTimestamp().seconds,r=t.toTimestamp().nanoseconds+1,i=Je.fromTimestamp(r===1e9?new Wt(n+1,0):new Wt(n,r));return new Pa(i,We.empty(),e)}function VM(t){return new Pa(t.readTime,t.key,Yu)}class Pa{constructor(e,n,r){this.readTime=e,this.documentKey=n,this.largestBatchId=r}static min(){return new Pa(Je.min(),We.empty(),Yu)}static max(){return new Pa(Je.max(),We.empty(),Yu)}}function $M(t,e){let n=t.readTime.compareTo(e.readTime);return n!==0?n:(n=We.comparator(t.documentKey,e.documentKey),n!==0?n:gt(t.largestBatchId,e.largestBatchId))}const qM="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class HM{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function xc(t){if(t.code!==Ie.FAILED_PRECONDITION||t.message!==qM)throw t;Fe("LocalStore","Unexpectedly lost primary lease")}class ke{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((n=>{this.isDone=!0,this.result=n,this.nextCallback&&this.nextCallback(n)}),(n=>{this.isDone=!0,this.error=n,this.catchCallback&&this.catchCallback(n)}))}catch(e){return this.next(void 0,e)}next(e,n){return this.callbackAttached&&Ze(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new ke(((r,i)=>{this.nextCallback=o=>{this.wrapSuccess(e,o).next(r,i)},this.catchCallback=o=>{this.wrapFailure(n,o).next(r,i)}}))}toPromise(){return new Promise(((e,n)=>{this.next(e,n)}))}wrapUserFunction(e){try{const n=e();return n instanceof ke?n:ke.resolve(n)}catch(n){return ke.reject(n)}}wrapSuccess(e,n){return e?this.wrapUserFunction((()=>e(n))):ke.resolve(n)}wrapFailure(e,n){return e?this.wrapUserFunction((()=>e(n))):ke.reject(n)}static resolve(e){return new ke(((n,r)=>{n(e)}))}static reject(e){return new ke(((n,r)=>{r(e)}))}static waitFor(e){return new ke(((n,r)=>{let i=0,o=0,l=!1;e.forEach((u=>{++i,u.next((()=>{++o,l&&o===i&&n()}),(h=>r(h)))})),l=!0,o===i&&n()}))}static or(e){let n=ke.resolve(!1);for(const r of e)n=n.next((i=>i?ke.resolve(i):r()));return n}static forEach(e,n){const r=[];return e.forEach(((i,o)=>{r.push(n.call(this,i,o))})),this.waitFor(r)}static mapArray(e,n){return new ke(((r,i)=>{const o=e.length,l=new Array(o);let u=0;for(let h=0;h<o;h++){const f=h;n(e[f]).next((p=>{l[f]=p,++u,u===o&&r(l)}),(p=>i(p)))}}))}static doWhile(e,n){return new ke(((r,i)=>{const o=()=>{e()===!0?n().next((()=>{o()}),i):r()};o()}))}}function GM(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}function wc(t){return t.name==="IndexedDbTransactionError"}class sm{constructor(e,n){this.previousValue=e,n&&(n.sequenceNumberHandler=r=>this.ae(r),this.ue=r=>n.writeSequenceNumber(r))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}sm.ce=-1;const _0=-1;function im(t){return t==null}function If(t){return t===0&&1/t==-1/0}function WM(t){return typeof t=="number"&&Number.isInteger(t)&&!If(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}const iC="";function QM(t){let e="";for(let n=0;n<t.length;n++)e.length>0&&(e=Xw(e)),e=KM(t.get(n),e);return Xw(e)}function KM(t,e){let n=e;const r=t.length;for(let i=0;i<r;i++){const o=t.charAt(i);switch(o){case"\0":n+="";break;case iC:n+="";break;default:n+=o}}return n}function Xw(t){return t+iC+""}function Zw(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Wa(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function aC(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}class tn{constructor(e,n){this.comparator=e,this.root=n||Vn.EMPTY}insert(e,n){return new tn(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,Vn.BLACK,null,null))}remove(e){return new tn(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Vn.BLACK,null,null))}get(e){let n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(r===0)return n.value;r<0?n=n.left:r>0&&(n=n.right)}return null}indexOf(e){let n=0,r=this.root;for(;!r.isEmpty();){const i=this.comparator(e,r.key);if(i===0)return n+r.left.size;i<0?r=r.left:(n+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((n,r)=>(e(n,r),!1)))}toString(){const e=[];return this.inorderTraversal(((n,r)=>(e.push(`${n}:${r}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new ef(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new ef(this.root,e,this.comparator,!1)}getReverseIterator(){return new ef(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new ef(this.root,e,this.comparator,!0)}}class ef{constructor(e,n,r,i){this.isReverse=i,this.nodeStack=[];let o=1;for(;!e.isEmpty();)if(o=n?r(e.key,n):1,n&&i&&(o*=-1),o<0)e=this.isReverse?e.left:e.right;else{if(o===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const n={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return n}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Vn{constructor(e,n,r,i,o){this.key=e,this.value=n,this.color=r??Vn.RED,this.left=i??Vn.EMPTY,this.right=o??Vn.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,n,r,i,o){return new Vn(e??this.key,n??this.value,r??this.color,i??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,r){let i=this;const o=r(e,i.key);return i=o<0?i.copy(null,null,null,i.left.insert(e,n,r),null):o===0?i.copy(null,n,null,null,null):i.copy(null,null,null,null,i.right.insert(e,n,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return Vn.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,n){let r,i=this;if(n(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),n(e,i.key)===0){if(i.right.isEmpty())return Vn.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Vn.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Vn.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Ze(43730,{key:this.key,value:this.value});if(this.right.isRed())throw Ze(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw Ze(27949);return e+(this.isRed()?0:1)}}Vn.EMPTY=null,Vn.RED=!0,Vn.BLACK=!1;Vn.EMPTY=new class{constructor(){this.size=0}get key(){throw Ze(57766)}get value(){throw Ze(16141)}get color(){throw Ze(16727)}get left(){throw Ze(29726)}get right(){throw Ze(36894)}copy(e,n,r,i,o){return this}insert(e,n,r){return new Vn(e,n)}remove(e,n){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Rn{constructor(e){this.comparator=e,this.data=new tn(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((n,r)=>(e(n),!1)))}forEachInRange(e,n){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;n(i.key)}}forEachWhile(e,n){let r;for(r=n!==void 0?this.data.getIteratorFrom(n):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const n=this.data.getIteratorFrom(e);return n.hasNext()?n.getNext().key:null}getIterator(){return new Jw(this.data.getIterator())}getIteratorFrom(e){return new Jw(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let n=this;return n.size<e.size&&(n=e,e=this),e.forEach((r=>{n=n.add(r)})),n}isEqual(e){if(!(e instanceof Rn)||this.size!==e.size)return!1;const n=this.data.getIterator(),r=e.data.getIterator();for(;n.hasNext();){const i=n.getNext().key,o=r.getNext().key;if(this.comparator(i,o)!==0)return!1}return!0}toArray(){const e=[];return this.forEach((n=>{e.push(n)})),e}toString(){const e=[];return this.forEach((n=>e.push(n))),"SortedSet("+e.toString()+")"}copy(e){const n=new Rn(this.comparator);return n.data=e,n}}class Jw{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class kr{constructor(e){this.fields=e,e.sort($n.comparator)}static empty(){return new kr([])}unionWith(e){let n=new Rn($n.comparator);for(const r of this.fields)n=n.add(r);for(const r of e)n=n.add(r);return new kr(n.toArray())}covers(e){for(const n of this.fields)if(n.isPrefixOf(e))return!0;return!1}isEqual(e){return sc(this.fields,e.fields,((n,r)=>n.isEqual(r)))}}class oC extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Gn{constructor(e){this.binaryString=e}static fromBase64String(e){const n=(function(i){try{return atob(i)}catch(o){throw typeof DOMException<"u"&&o instanceof DOMException?new oC("Invalid base64 string: "+o):o}})(e);return new Gn(n)}static fromUint8Array(e){const n=(function(i){let o="";for(let l=0;l<i.length;++l)o+=String.fromCharCode(i[l]);return o})(e);return new Gn(n)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(n){return btoa(n)})(this.binaryString)}toUint8Array(){return(function(n){const r=new Uint8Array(n.length);for(let i=0;i<n.length;i++)r[i]=n.charCodeAt(i);return r})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return gt(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Gn.EMPTY_BYTE_STRING=new Gn("");const YM=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Ba(t){if(jt(!!t,39018),typeof t=="string"){let e=0;const n=YM.exec(t);if(jt(!!n,46558,{timestamp:t}),n[1]){let i=n[1];i=(i+"000000000").substr(0,9),e=Number(i)}const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:un(t.seconds),nanos:un(t.nanos)}}function un(t){return typeof t=="number"?t:typeof t=="string"?Number(t):0}function za(t){return typeof t=="string"?Gn.fromBase64String(t):Gn.fromUint8Array(t)}const lC="server_timestamp",cC="__type__",uC="__previous_value__",dC="__local_write_time__";function b0(t){return(t?.mapValue?.fields||{})[cC]?.stringValue===lC}function am(t){const e=t.mapValue.fields[uC];return b0(e)?am(e):e}function Xu(t){const e=Ba(t.mapValue.fields[dC].timestampValue);return new Wt(e.seconds,e.nanos)}class XM{constructor(e,n,r,i,o,l,u,h,f,p){this.databaseId=e,this.appId=n,this.persistenceKey=r,this.host=i,this.ssl=o,this.forceLongPolling=l,this.autoDetectLongPolling=u,this.longPollingOptions=h,this.useFetchStreams=f,this.isUsingEmulator=p}}const Df="(default)";class Zu{constructor(e,n){this.projectId=e,this.database=n||Df}static empty(){return new Zu("","")}get isDefaultDatabase(){return this.database===Df}isEqual(e){return e instanceof Zu&&e.projectId===this.projectId&&e.database===this.database}}const hC="__type__",ZM="__max__",tf={mapValue:{}},fC="__vector__",kf="value";function La(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?b0(t)?4:eO(t)?9007199254740991:JM(t)?10:11:Ze(28295,{value:t})}function Ys(t,e){if(t===e)return!0;const n=La(t);if(n!==La(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Xu(t).isEqual(Xu(e));case 3:return(function(i,o){if(typeof i.timestampValue=="string"&&typeof o.timestampValue=="string"&&i.timestampValue.length===o.timestampValue.length)return i.timestampValue===o.timestampValue;const l=Ba(i.timestampValue),u=Ba(o.timestampValue);return l.seconds===u.seconds&&l.nanos===u.nanos})(t,e);case 5:return t.stringValue===e.stringValue;case 6:return(function(i,o){return za(i.bytesValue).isEqual(za(o.bytesValue))})(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return(function(i,o){return un(i.geoPointValue.latitude)===un(o.geoPointValue.latitude)&&un(i.geoPointValue.longitude)===un(o.geoPointValue.longitude)})(t,e);case 2:return(function(i,o){if("integerValue"in i&&"integerValue"in o)return un(i.integerValue)===un(o.integerValue);if("doubleValue"in i&&"doubleValue"in o){const l=un(i.doubleValue),u=un(o.doubleValue);return l===u?If(l)===If(u):isNaN(l)&&isNaN(u)}return!1})(t,e);case 9:return sc(t.arrayValue.values||[],e.arrayValue.values||[],Ys);case 10:case 11:return(function(i,o){const l=i.mapValue.fields||{},u=o.mapValue.fields||{};if(Zw(l)!==Zw(u))return!1;for(const h in l)if(l.hasOwnProperty(h)&&(u[h]===void 0||!Ys(l[h],u[h])))return!1;return!0})(t,e);default:return Ze(52216,{left:t})}}function Ju(t,e){return(t.values||[]).find((n=>Ys(n,e)))!==void 0}function ic(t,e){if(t===e)return 0;const n=La(t),r=La(e);if(n!==r)return gt(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return gt(t.booleanValue,e.booleanValue);case 2:return(function(o,l){const u=un(o.integerValue||o.doubleValue),h=un(l.integerValue||l.doubleValue);return u<h?-1:u>h?1:u===h?0:isNaN(u)?isNaN(h)?0:-1:1})(t,e);case 3:return eS(t.timestampValue,e.timestampValue);case 4:return eS(Xu(t),Xu(e));case 5:return Ty(t.stringValue,e.stringValue);case 6:return(function(o,l){const u=za(o),h=za(l);return u.compareTo(h)})(t.bytesValue,e.bytesValue);case 7:return(function(o,l){const u=o.split("/"),h=l.split("/");for(let f=0;f<u.length&&f<h.length;f++){const p=gt(u[f],h[f]);if(p!==0)return p}return gt(u.length,h.length)})(t.referenceValue,e.referenceValue);case 8:return(function(o,l){const u=gt(un(o.latitude),un(l.latitude));return u!==0?u:gt(un(o.longitude),un(l.longitude))})(t.geoPointValue,e.geoPointValue);case 9:return tS(t.arrayValue,e.arrayValue);case 10:return(function(o,l){const u=o.fields||{},h=l.fields||{},f=u[kf]?.arrayValue,p=h[kf]?.arrayValue,g=gt(f?.values?.length||0,p?.values?.length||0);return g!==0?g:tS(f,p)})(t.mapValue,e.mapValue);case 11:return(function(o,l){if(o===tf.mapValue&&l===tf.mapValue)return 0;if(o===tf.mapValue)return 1;if(l===tf.mapValue)return-1;const u=o.fields||{},h=Object.keys(u),f=l.fields||{},p=Object.keys(f);h.sort(),p.sort();for(let g=0;g<h.length&&g<p.length;++g){const b=Ty(h[g],p[g]);if(b!==0)return b;const _=ic(u[h[g]],f[p[g]]);if(_!==0)return _}return gt(h.length,p.length)})(t.mapValue,e.mapValue);default:throw Ze(23264,{he:n})}}function eS(t,e){if(typeof t=="string"&&typeof e=="string"&&t.length===e.length)return gt(t,e);const n=Ba(t),r=Ba(e),i=gt(n.seconds,r.seconds);return i!==0?i:gt(n.nanos,r.nanos)}function tS(t,e){const n=t.values||[],r=e.values||[];for(let i=0;i<n.length&&i<r.length;++i){const o=ic(n[i],r[i]);if(o)return o}return gt(n.length,r.length)}function ac(t){return Ay(t)}function Ay(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?(function(n){const r=Ba(n);return`time(${r.seconds},${r.nanos})`})(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?(function(n){return za(n).toBase64()})(t.bytesValue):"referenceValue"in t?(function(n){return We.fromName(n).toString()})(t.referenceValue):"geoPointValue"in t?(function(n){return`geo(${n.latitude},${n.longitude})`})(t.geoPointValue):"arrayValue"in t?(function(n){let r="[",i=!0;for(const o of n.values||[])i?i=!1:r+=",",r+=Ay(o);return r+"]"})(t.arrayValue):"mapValue"in t?(function(n){const r=Object.keys(n.fields||{}).sort();let i="{",o=!0;for(const l of r)o?o=!1:i+=",",i+=`${l}:${Ay(n.fields[l])}`;return i+"}"})(t.mapValue):Ze(61005,{value:t})}function mf(t){switch(La(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=am(t);return e?16+mf(e):16;case 5:return 2*t.stringValue.length;case 6:return za(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return(function(r){return(r.values||[]).reduce(((i,o)=>i+mf(o)),0)})(t.arrayValue);case 10:case 11:return(function(r){let i=0;return Wa(r.fields,((o,l)=>{i+=o.length+mf(l)})),i})(t.mapValue);default:throw Ze(13486,{value:t})}}function nS(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function jy(t){return!!t&&"integerValue"in t}function v0(t){return!!t&&"arrayValue"in t}function rS(t){return!!t&&"nullValue"in t}function sS(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function pf(t){return!!t&&"mapValue"in t}function JM(t){return(t?.mapValue?.fields||{})[hC]?.stringValue===fC}function Uu(t){if(t.geoPointValue)return{geoPointValue:{...t.geoPointValue}};if(t.timestampValue&&typeof t.timestampValue=="object")return{timestampValue:{...t.timestampValue}};if(t.mapValue){const e={mapValue:{fields:{}}};return Wa(t.mapValue.fields,((n,r)=>e.mapValue.fields[n]=Uu(r))),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=Uu(t.arrayValue.values[n]);return e}return{...t}}function eO(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue===ZM}class br{constructor(e){this.value=e}static empty(){return new br({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let n=this.value;for(let r=0;r<e.length-1;++r)if(n=(n.mapValue.fields||{})[e.get(r)],!pf(n))return null;return n=(n.mapValue.fields||{})[e.lastSegment()],n||null}}set(e,n){this.getFieldsMap(e.popLast())[e.lastSegment()]=Uu(n)}setAll(e){let n=$n.emptyPath(),r={},i=[];e.forEach(((l,u)=>{if(!n.isImmediateParentOf(u)){const h=this.getFieldsMap(n);this.applyChanges(h,r,i),r={},i=[],n=u.popLast()}l?r[u.lastSegment()]=Uu(l):i.push(u.lastSegment())}));const o=this.getFieldsMap(n);this.applyChanges(o,r,i)}delete(e){const n=this.field(e.popLast());pf(n)&&n.mapValue.fields&&delete n.mapValue.fields[e.lastSegment()]}isEqual(e){return Ys(this.value,e.value)}getFieldsMap(e){let n=this.value;n.mapValue.fields||(n.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=n.mapValue.fields[e.get(r)];pf(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},n.mapValue.fields[e.get(r)]=i),n=i}return n.mapValue.fields}applyChanges(e,n,r){Wa(n,((i,o)=>e[i]=o));for(const i of r)delete e[i]}clone(){return new br(Uu(this.value))}}function mC(t){const e=[];return Wa(t.fields,((n,r)=>{const i=new $n([n]);if(pf(r)){const o=mC(r.mapValue).fields;if(o.length===0)e.push(i);else for(const l of o)e.push(i.child(l))}else e.push(i)})),new kr(e)}class Jn{constructor(e,n,r,i,o,l,u){this.key=e,this.documentType=n,this.version=r,this.readTime=i,this.createTime=o,this.data=l,this.documentState=u}static newInvalidDocument(e){return new Jn(e,0,Je.min(),Je.min(),Je.min(),br.empty(),0)}static newFoundDocument(e,n,r,i){return new Jn(e,1,n,Je.min(),r,i,0)}static newNoDocument(e,n){return new Jn(e,2,n,Je.min(),Je.min(),br.empty(),0)}static newUnknownDocument(e,n){return new Jn(e,3,n,Je.min(),Je.min(),br.empty(),2)}convertToFoundDocument(e,n){return!this.createTime.isEqual(Je.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=n,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=br.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=br.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Je.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Jn&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Jn(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Mf{constructor(e,n){this.position=e,this.inclusive=n}}function iS(t,e,n){let r=0;for(let i=0;i<t.position.length;i++){const o=e[i],l=t.position[i];if(o.field.isKeyField()?r=We.comparator(We.fromName(l.referenceValue),n.key):r=ic(l,n.data.field(o.field)),o.dir==="desc"&&(r*=-1),r!==0)break}return r}function aS(t,e){if(t===null)return e===null;if(e===null||t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!Ys(t.position[n],e.position[n]))return!1;return!0}class Of{constructor(e,n="asc"){this.field=e,this.dir=n}}function tO(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}class pC{}class wn extends pC{constructor(e,n,r){super(),this.field=e,this.op=n,this.value=r}static create(e,n,r){return e.isKeyField()?n==="in"||n==="not-in"?this.createKeyFieldInFilter(e,n,r):new rO(e,n,r):n==="array-contains"?new aO(e,r):n==="in"?new oO(e,r):n==="not-in"?new lO(e,r):n==="array-contains-any"?new cO(e,r):new wn(e,n,r)}static createKeyFieldInFilter(e,n,r){return n==="in"?new sO(e,r):new iO(e,r)}matches(e){const n=e.data.field(this.field);return this.op==="!="?n!==null&&n.nullValue===void 0&&this.matchesComparison(ic(n,this.value)):n!==null&&La(this.value)===La(n)&&this.matchesComparison(ic(n,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Ze(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class gs extends pC{constructor(e,n){super(),this.filters=e,this.op=n,this.Pe=null}static create(e,n){return new gs(e,n)}matches(e){return gC(this)?this.filters.find((n=>!n.matches(e)))===void 0:this.filters.find((n=>n.matches(e)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((e,n)=>e.concat(n.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function gC(t){return t.op==="and"}function yC(t){return nO(t)&&gC(t)}function nO(t){for(const e of t.filters)if(e instanceof gs)return!1;return!0}function Ry(t){if(t instanceof wn)return t.field.canonicalString()+t.op.toString()+ac(t.value);if(yC(t))return t.filters.map((e=>Ry(e))).join(",");{const e=t.filters.map((n=>Ry(n))).join(",");return`${t.op}(${e})`}}function _C(t,e){return t instanceof wn?(function(r,i){return i instanceof wn&&r.op===i.op&&r.field.isEqual(i.field)&&Ys(r.value,i.value)})(t,e):t instanceof gs?(function(r,i){return i instanceof gs&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce(((o,l,u)=>o&&_C(l,i.filters[u])),!0):!1})(t,e):void Ze(19439)}function bC(t){return t instanceof wn?(function(n){return`${n.field.canonicalString()} ${n.op} ${ac(n.value)}`})(t):t instanceof gs?(function(n){return n.op.toString()+" {"+n.getFilters().map(bC).join(" ,")+"}"})(t):"Filter"}class rO extends wn{constructor(e,n,r){super(e,n,r),this.key=We.fromName(r.referenceValue)}matches(e){const n=We.comparator(e.key,this.key);return this.matchesComparison(n)}}class sO extends wn{constructor(e,n){super(e,"in",n),this.keys=vC("in",n)}matches(e){return this.keys.some((n=>n.isEqual(e.key)))}}class iO extends wn{constructor(e,n){super(e,"not-in",n),this.keys=vC("not-in",n)}matches(e){return!this.keys.some((n=>n.isEqual(e.key)))}}function vC(t,e){return(e.arrayValue?.values||[]).map((n=>We.fromName(n.referenceValue)))}class aO extends wn{constructor(e,n){super(e,"array-contains",n)}matches(e){const n=e.data.field(this.field);return v0(n)&&Ju(n.arrayValue,this.value)}}class oO extends wn{constructor(e,n){super(e,"in",n)}matches(e){const n=e.data.field(this.field);return n!==null&&Ju(this.value.arrayValue,n)}}class lO extends wn{constructor(e,n){super(e,"not-in",n)}matches(e){if(Ju(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const n=e.data.field(this.field);return n!==null&&n.nullValue===void 0&&!Ju(this.value.arrayValue,n)}}class cO extends wn{constructor(e,n){super(e,"array-contains-any",n)}matches(e){const n=e.data.field(this.field);return!(!v0(n)||!n.arrayValue.values)&&n.arrayValue.values.some((r=>Ju(this.value.arrayValue,r)))}}class uO{constructor(e,n=null,r=[],i=[],o=null,l=null,u=null){this.path=e,this.collectionGroup=n,this.orderBy=r,this.filters=i,this.limit=o,this.startAt=l,this.endAt=u,this.Te=null}}function oS(t,e=null,n=[],r=[],i=null,o=null,l=null){return new uO(t,e,n,r,i,o,l)}function x0(t){const e=st(t);if(e.Te===null){let n=e.path.canonicalString();e.collectionGroup!==null&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map((r=>Ry(r))).join(","),n+="|ob:",n+=e.orderBy.map((r=>(function(o){return o.field.canonicalString()+o.dir})(r))).join(","),im(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map((r=>ac(r))).join(",")),e.endAt&&(n+="|ub:",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map((r=>ac(r))).join(",")),e.Te=n}return e.Te}function w0(t,e){if(t.limit!==e.limit||t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!tO(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!_C(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!aS(t.startAt,e.startAt)&&aS(t.endAt,e.endAt)}function Iy(t){return We.isDocumentKey(t.path)&&t.collectionGroup===null&&t.filters.length===0}class pd{constructor(e,n=null,r=[],i=[],o=null,l="F",u=null,h=null){this.path=e,this.collectionGroup=n,this.explicitOrderBy=r,this.filters=i,this.limit=o,this.limitType=l,this.startAt=u,this.endAt=h,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function dO(t,e,n,r,i,o,l,u){return new pd(t,e,n,r,i,o,l,u)}function S0(t){return new pd(t)}function lS(t){return t.filters.length===0&&t.limit===null&&t.startAt==null&&t.endAt==null&&(t.explicitOrderBy.length===0||t.explicitOrderBy.length===1&&t.explicitOrderBy[0].field.isKeyField())}function xC(t){return t.collectionGroup!==null}function Fu(t){const e=st(t);if(e.Ie===null){e.Ie=[];const n=new Set;for(const o of e.explicitOrderBy)e.Ie.push(o),n.add(o.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(l){let u=new Rn($n.comparator);return l.filters.forEach((h=>{h.getFlattenedFilters().forEach((f=>{f.isInequality()&&(u=u.add(f.field))}))})),u})(e).forEach((o=>{n.has(o.canonicalString())||o.isKeyField()||e.Ie.push(new Of(o,r))})),n.has($n.keyField().canonicalString())||e.Ie.push(new Of($n.keyField(),r))}return e.Ie}function qs(t){const e=st(t);return e.Ee||(e.Ee=hO(e,Fu(t))),e.Ee}function hO(t,e){if(t.limitType==="F")return oS(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map((i=>{const o=i.dir==="desc"?"asc":"desc";return new Of(i.field,o)}));const n=t.endAt?new Mf(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new Mf(t.startAt.position,t.startAt.inclusive):null;return oS(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}}function Dy(t,e){const n=t.filters.concat([e]);return new pd(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}function ky(t,e,n){return new pd(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function om(t,e){return w0(qs(t),qs(e))&&t.limitType===e.limitType}function wC(t){return`${x0(qs(t))}|lt:${t.limitType}`}function Gl(t){return`Query(target=${(function(n){let r=n.path.canonicalString();return n.collectionGroup!==null&&(r+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(r+=`, filters: [${n.filters.map((i=>bC(i))).join(", ")}]`),im(n.limit)||(r+=", limit: "+n.limit),n.orderBy.length>0&&(r+=`, orderBy: [${n.orderBy.map((i=>(function(l){return`${l.field.canonicalString()} (${l.dir})`})(i))).join(", ")}]`),n.startAt&&(r+=", startAt: ",r+=n.startAt.inclusive?"b:":"a:",r+=n.startAt.position.map((i=>ac(i))).join(",")),n.endAt&&(r+=", endAt: ",r+=n.endAt.inclusive?"a:":"b:",r+=n.endAt.position.map((i=>ac(i))).join(",")),`Target(${r})`})(qs(t))}; limitType=${t.limitType})`}function lm(t,e){return e.isFoundDocument()&&(function(r,i){const o=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(o):We.isDocumentKey(r.path)?r.path.isEqual(o):r.path.isImmediateParentOf(o)})(t,e)&&(function(r,i){for(const o of Fu(r))if(!o.field.isKeyField()&&i.data.field(o.field)===null)return!1;return!0})(t,e)&&(function(r,i){for(const o of r.filters)if(!o.matches(i))return!1;return!0})(t,e)&&(function(r,i){return!(r.startAt&&!(function(l,u,h){const f=iS(l,u,h);return l.inclusive?f<=0:f<0})(r.startAt,Fu(r),i)||r.endAt&&!(function(l,u,h){const f=iS(l,u,h);return l.inclusive?f>=0:f>0})(r.endAt,Fu(r),i))})(t,e)}function fO(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function SC(t){return(e,n)=>{let r=!1;for(const i of Fu(t)){const o=mO(i,e,n);if(o!==0)return o;r=r||i.field.isKeyField()}return 0}}function mO(t,e,n){const r=t.field.isKeyField()?We.comparator(e.key,n.key):(function(o,l,u){const h=l.data.field(o),f=u.data.field(o);return h!==null&&f!==null?ic(h,f):Ze(42886)})(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return Ze(19790,{direction:t.dir})}}class Wo{constructor(e,n){this.mapKeyFn=e,this.equalsFn=n,this.inner={},this.innerSize=0}get(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r!==void 0){for(const[i,o]of r)if(this.equalsFn(i,e))return o}}has(e){return this.get(e)!==void 0}set(e,n){const r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,n]],void this.innerSize++;for(let o=0;o<i.length;o++)if(this.equalsFn(i[o][0],e))return void(i[o]=[e,n]);i.push([e,n]),this.innerSize++}delete(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[n]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Wa(this.inner,((n,r)=>{for(const[i,o]of r)e(i,o)}))}isEmpty(){return aC(this.inner)}size(){return this.innerSize}}const pO=new tn(We.comparator);function Mi(){return pO}const EC=new tn(We.comparator);function Nu(...t){let e=EC;for(const n of t)e=e.insert(n.key,n);return e}function CC(t){let e=EC;return t.forEach(((n,r)=>e=e.insert(n,r.overlayedDocument))),e}function Oo(){return Vu()}function TC(){return Vu()}function Vu(){return new Wo((t=>t.toString()),((t,e)=>t.isEqual(e)))}const gO=new tn(We.comparator),yO=new Rn(We.comparator);function yt(...t){let e=yO;for(const n of t)e=e.add(n);return e}const _O=new Rn(gt);function bO(){return _O}function E0(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:If(e)?"-0":e}}function AC(t){return{integerValue:""+t}}function vO(t,e){return WM(e)?AC(e):E0(t,e)}class cm{constructor(){this._=void 0}}function xO(t,e,n){return t instanceof Nf?(function(i,o){const l={fields:{[cC]:{stringValue:lC},[dC]:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return o&&b0(o)&&(o=am(o)),o&&(l.fields[uC]=o),{mapValue:l}})(n,e):t instanceof oc?RC(t,e):t instanceof lc?IC(t,e):(function(i,o){const l=jC(i,o),u=cS(l)+cS(i.Ae);return jy(l)&&jy(i.Ae)?AC(u):E0(i.serializer,u)})(t,e)}function wO(t,e,n){return t instanceof oc?RC(t,e):t instanceof lc?IC(t,e):n}function jC(t,e){return t instanceof Pf?(function(r){return jy(r)||(function(o){return!!o&&"doubleValue"in o})(r)})(e)?e:{integerValue:0}:null}class Nf extends cm{}class oc extends cm{constructor(e){super(),this.elements=e}}function RC(t,e){const n=DC(e);for(const r of t.elements)n.some((i=>Ys(i,r)))||n.push(r);return{arrayValue:{values:n}}}class lc extends cm{constructor(e){super(),this.elements=e}}function IC(t,e){let n=DC(e);for(const r of t.elements)n=n.filter((i=>!Ys(i,r)));return{arrayValue:{values:n}}}class Pf extends cm{constructor(e,n){super(),this.serializer=e,this.Ae=n}}function cS(t){return un(t.integerValue||t.doubleValue)}function DC(t){return v0(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}class kC{constructor(e,n){this.field=e,this.transform=n}}function SO(t,e){return t.field.isEqual(e.field)&&(function(r,i){return r instanceof oc&&i instanceof oc||r instanceof lc&&i instanceof lc?sc(r.elements,i.elements,Ys):r instanceof Pf&&i instanceof Pf?Ys(r.Ae,i.Ae):r instanceof Nf&&i instanceof Nf})(t.transform,e.transform)}class EO{constructor(e,n){this.version=e,this.transformResults=n}}class vr{constructor(e,n){this.updateTime=e,this.exists=n}static none(){return new vr}static exists(e){return new vr(void 0,e)}static updateTime(e){return new vr(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function gf(t,e){return t.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(t.updateTime):t.exists===void 0||t.exists===e.isFoundDocument()}class um{}function MC(t,e){if(!t.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return t.isNoDocument()?new dm(t.key,vr.none()):new gd(t.key,t.data,vr.none());{const n=t.data,r=br.empty();let i=new Rn($n.comparator);for(let o of e.fields)if(!i.has(o)){let l=n.field(o);l===null&&o.length>1&&(o=o.popLast(),l=n.field(o)),l===null?r.delete(o):r.set(o,l),i=i.add(o)}return new Qa(t.key,r,new kr(i.toArray()),vr.none())}}function CO(t,e,n){t instanceof gd?(function(i,o,l){const u=i.value.clone(),h=dS(i.fieldTransforms,o,l.transformResults);u.setAll(h),o.convertToFoundDocument(l.version,u).setHasCommittedMutations()})(t,e,n):t instanceof Qa?(function(i,o,l){if(!gf(i.precondition,o))return void o.convertToUnknownDocument(l.version);const u=dS(i.fieldTransforms,o,l.transformResults),h=o.data;h.setAll(OC(i)),h.setAll(u),o.convertToFoundDocument(l.version,h).setHasCommittedMutations()})(t,e,n):(function(i,o,l){o.convertToNoDocument(l.version).setHasCommittedMutations()})(0,e,n)}function $u(t,e,n,r){return t instanceof gd?(function(o,l,u,h){if(!gf(o.precondition,l))return u;const f=o.value.clone(),p=hS(o.fieldTransforms,h,l);return f.setAll(p),l.convertToFoundDocument(l.version,f).setHasLocalMutations(),null})(t,e,n,r):t instanceof Qa?(function(o,l,u,h){if(!gf(o.precondition,l))return u;const f=hS(o.fieldTransforms,h,l),p=l.data;return p.setAll(OC(o)),p.setAll(f),l.convertToFoundDocument(l.version,p).setHasLocalMutations(),u===null?null:u.unionWith(o.fieldMask.fields).unionWith(o.fieldTransforms.map((g=>g.field)))})(t,e,n,r):(function(o,l,u){return gf(o.precondition,l)?(l.convertToNoDocument(l.version).setHasLocalMutations(),null):u})(t,e,n)}function TO(t,e){let n=null;for(const r of t.fieldTransforms){const i=e.data.field(r.field),o=jC(r.transform,i||null);o!=null&&(n===null&&(n=br.empty()),n.set(r.field,o))}return n||null}function uS(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!(function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&sc(r,i,((o,l)=>SO(o,l)))})(t.fieldTransforms,e.fieldTransforms)&&(t.type===0?t.value.isEqual(e.value):t.type!==1||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class gd extends um{constructor(e,n,r,i=[]){super(),this.key=e,this.value=n,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class Qa extends um{constructor(e,n,r,i,o=[]){super(),this.key=e,this.data=n,this.fieldMask=r,this.precondition=i,this.fieldTransforms=o,this.type=1}getFieldMask(){return this.fieldMask}}function OC(t){const e=new Map;return t.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const r=t.data.field(n);e.set(n,r)}})),e}function dS(t,e,n){const r=new Map;jt(t.length===n.length,32656,{Re:n.length,Ve:t.length});for(let i=0;i<n.length;i++){const o=t[i],l=o.transform,u=e.data.field(o.field);r.set(o.field,wO(l,u,n[i]))}return r}function hS(t,e,n){const r=new Map;for(const i of t){const o=i.transform,l=n.data.field(i.field);r.set(i.field,xO(o,l,e))}return r}class dm extends um{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class AO extends um{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class jO{constructor(e,n,r,i){this.batchId=e,this.localWriteTime=n,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,n){const r=n.mutationResults;for(let i=0;i<this.mutations.length;i++){const o=this.mutations[i];o.key.isEqual(e.key)&&CO(o,e,r[i])}}applyToLocalView(e,n){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(n=$u(r,e,n,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(n=$u(r,e,n,this.localWriteTime));return n}applyToLocalDocumentSet(e,n){const r=TC();return this.mutations.forEach((i=>{const o=e.get(i.key),l=o.overlayedDocument;let u=this.applyToLocalView(l,o.mutatedFields);u=n.has(i.key)?null:u;const h=MC(l,u);h!==null&&r.set(i.key,h),l.isValidDocument()||l.convertToNoDocument(Je.min())})),r}keys(){return this.mutations.reduce(((e,n)=>e.add(n.key)),yt())}isEqual(e){return this.batchId===e.batchId&&sc(this.mutations,e.mutations,((n,r)=>uS(n,r)))&&sc(this.baseMutations,e.baseMutations,((n,r)=>uS(n,r)))}}class C0{constructor(e,n,r,i){this.batch=e,this.commitVersion=n,this.mutationResults=r,this.docVersions=i}static from(e,n,r){jt(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let i=(function(){return gO})();const o=e.mutations;for(let l=0;l<o.length;l++)i=i.insert(o[l].key,r[l].version);return new C0(e,n,r,i)}}class RO{constructor(e,n){this.largestBatchId=e,this.mutation=n}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class IO{constructor(e,n){this.count=e,this.unchangedNames=n}}var xn,bt;function DO(t){switch(t){case Ie.OK:return Ze(64938);case Ie.CANCELLED:case Ie.UNKNOWN:case Ie.DEADLINE_EXCEEDED:case Ie.RESOURCE_EXHAUSTED:case Ie.INTERNAL:case Ie.UNAVAILABLE:case Ie.UNAUTHENTICATED:return!1;case Ie.INVALID_ARGUMENT:case Ie.NOT_FOUND:case Ie.ALREADY_EXISTS:case Ie.PERMISSION_DENIED:case Ie.FAILED_PRECONDITION:case Ie.ABORTED:case Ie.OUT_OF_RANGE:case Ie.UNIMPLEMENTED:case Ie.DATA_LOSS:return!0;default:return Ze(15467,{code:t})}}function NC(t){if(t===void 0)return ki("GRPC error has no .code"),Ie.UNKNOWN;switch(t){case xn.OK:return Ie.OK;case xn.CANCELLED:return Ie.CANCELLED;case xn.UNKNOWN:return Ie.UNKNOWN;case xn.DEADLINE_EXCEEDED:return Ie.DEADLINE_EXCEEDED;case xn.RESOURCE_EXHAUSTED:return Ie.RESOURCE_EXHAUSTED;case xn.INTERNAL:return Ie.INTERNAL;case xn.UNAVAILABLE:return Ie.UNAVAILABLE;case xn.UNAUTHENTICATED:return Ie.UNAUTHENTICATED;case xn.INVALID_ARGUMENT:return Ie.INVALID_ARGUMENT;case xn.NOT_FOUND:return Ie.NOT_FOUND;case xn.ALREADY_EXISTS:return Ie.ALREADY_EXISTS;case xn.PERMISSION_DENIED:return Ie.PERMISSION_DENIED;case xn.FAILED_PRECONDITION:return Ie.FAILED_PRECONDITION;case xn.ABORTED:return Ie.ABORTED;case xn.OUT_OF_RANGE:return Ie.OUT_OF_RANGE;case xn.UNIMPLEMENTED:return Ie.UNIMPLEMENTED;case xn.DATA_LOSS:return Ie.DATA_LOSS;default:return Ze(39323,{code:t})}}(bt=xn||(xn={}))[bt.OK=0]="OK",bt[bt.CANCELLED=1]="CANCELLED",bt[bt.UNKNOWN=2]="UNKNOWN",bt[bt.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",bt[bt.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",bt[bt.NOT_FOUND=5]="NOT_FOUND",bt[bt.ALREADY_EXISTS=6]="ALREADY_EXISTS",bt[bt.PERMISSION_DENIED=7]="PERMISSION_DENIED",bt[bt.UNAUTHENTICATED=16]="UNAUTHENTICATED",bt[bt.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",bt[bt.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",bt[bt.ABORTED=10]="ABORTED",bt[bt.OUT_OF_RANGE=11]="OUT_OF_RANGE",bt[bt.UNIMPLEMENTED=12]="UNIMPLEMENTED",bt[bt.INTERNAL=13]="INTERNAL",bt[bt.UNAVAILABLE=14]="UNAVAILABLE",bt[bt.DATA_LOSS=15]="DATA_LOSS";function kO(){return new TextEncoder}const MO=new ka([4294967295,4294967295],0);function fS(t){const e=kO().encode(t),n=new KE;return n.update(e),new Uint8Array(n.digest())}function mS(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),o=e.getUint32(12,!0);return[new ka([n,r],0),new ka([i,o],0)]}class T0{constructor(e,n,r){if(this.bitmap=e,this.padding=n,this.hashCount=r,n<0||n>=8)throw new Pu(`Invalid padding: ${n}`);if(r<0)throw new Pu(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Pu(`Invalid hash count: ${r}`);if(e.length===0&&n!==0)throw new Pu(`Invalid padding when bitmap length is 0: ${n}`);this.ge=8*e.length-n,this.pe=ka.fromNumber(this.ge)}ye(e,n,r){let i=e.add(n.multiply(ka.fromNumber(r)));return i.compare(MO)===1&&(i=new ka([i.getBits(0),i.getBits(1)],0)),i.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const n=fS(e),[r,i]=mS(n);for(let o=0;o<this.hashCount;o++){const l=this.ye(r,i,o);if(!this.we(l))return!1}return!0}static create(e,n,r){const i=e%8==0?0:8-e%8,o=new Uint8Array(Math.ceil(e/8)),l=new T0(o,i,n);return r.forEach((u=>l.insert(u))),l}insert(e){if(this.ge===0)return;const n=fS(e),[r,i]=mS(n);for(let o=0;o<this.hashCount;o++){const l=this.ye(r,i,o);this.Se(l)}}Se(e){const n=Math.floor(e/8),r=e%8;this.bitmap[n]|=1<<r}}class Pu extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class hm{constructor(e,n,r,i,o){this.snapshotVersion=e,this.targetChanges=n,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=o}static createSynthesizedRemoteEventForCurrentChange(e,n,r){const i=new Map;return i.set(e,yd.createSynthesizedTargetChangeForCurrentChange(e,n,r)),new hm(Je.min(),i,new tn(gt),Mi(),yt())}}class yd{constructor(e,n,r,i,o){this.resumeToken=e,this.current=n,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=o}static createSynthesizedTargetChangeForCurrentChange(e,n,r){return new yd(r,n,yt(),yt(),yt())}}class yf{constructor(e,n,r,i){this.be=e,this.removedTargetIds=n,this.key=r,this.De=i}}class PC{constructor(e,n){this.targetId=e,this.Ce=n}}class BC{constructor(e,n,r=Gn.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=n,this.resumeToken=r,this.cause=i}}class pS{constructor(){this.ve=0,this.Fe=gS(),this.Me=Gn.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=yt(),n=yt(),r=yt();return this.Fe.forEach(((i,o)=>{switch(o){case 0:e=e.add(i);break;case 2:n=n.add(i);break;case 1:r=r.add(i);break;default:Ze(38017,{changeType:o})}})),new yd(this.Me,this.xe,e,n,r)}qe(){this.Oe=!1,this.Fe=gS()}Qe(e,n){this.Oe=!0,this.Fe=this.Fe.insert(e,n)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,jt(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class OO{constructor(e){this.Ge=e,this.ze=new Map,this.je=Mi(),this.Je=nf(),this.He=nf(),this.Ye=new tn(gt)}Ze(e){for(const n of e.be)e.De&&e.De.isFoundDocument()?this.Xe(n,e.De):this.et(n,e.key,e.De);for(const n of e.removedTargetIds)this.et(n,e.key,e.De)}tt(e){this.forEachTarget(e,(n=>{const r=this.nt(n);switch(e.state){case 0:this.rt(n)&&r.Le(e.resumeToken);break;case 1:r.Ke(),r.Ne||r.qe(),r.Le(e.resumeToken);break;case 2:r.Ke(),r.Ne||this.removeTarget(n);break;case 3:this.rt(n)&&(r.We(),r.Le(e.resumeToken));break;case 4:this.rt(n)&&(this.it(n),r.Le(e.resumeToken));break;default:Ze(56790,{state:e.state})}}))}forEachTarget(e,n){e.targetIds.length>0?e.targetIds.forEach(n):this.ze.forEach(((r,i)=>{this.rt(i)&&n(i)}))}st(e){const n=e.targetId,r=e.Ce.count,i=this.ot(n);if(i){const o=i.target;if(Iy(o))if(r===0){const l=new We(o.path);this.et(n,l,Jn.newNoDocument(l,Je.min()))}else jt(r===1,20013,{expectedCount:r});else{const l=this._t(n);if(l!==r){const u=this.ut(e),h=u?this.ct(u,e,l):1;if(h!==0){this.it(n);const f=h===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(n,f)}}}}}ut(e){const n=e.Ce.unchangedNames;if(!n||!n.bits)return null;const{bits:{bitmap:r="",padding:i=0},hashCount:o=0}=n;let l,u;try{l=za(r).toUint8Array()}catch(h){if(h instanceof oC)return rc("Decoding the base64 bloom filter in existence filter failed ("+h.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw h}try{u=new T0(l,i,o)}catch(h){return rc(h instanceof Pu?"BloomFilter error: ":"Applying bloom filter failed: ",h),null}return u.ge===0?null:u}ct(e,n,r){return n.Ce.count===r-this.Pt(e,n.targetId)?0:2}Pt(e,n){const r=this.Ge.getRemoteKeysForTarget(n);let i=0;return r.forEach((o=>{const l=this.Ge.ht(),u=`projects/${l.projectId}/databases/${l.database}/documents/${o.path.canonicalString()}`;e.mightContain(u)||(this.et(n,o,null),i++)})),i}Tt(e){const n=new Map;this.ze.forEach(((o,l)=>{const u=this.ot(l);if(u){if(o.current&&Iy(u.target)){const h=new We(u.target.path);this.It(h).has(l)||this.Et(l,h)||this.et(l,h,Jn.newNoDocument(h,e))}o.Be&&(n.set(l,o.ke()),o.qe())}}));let r=yt();this.He.forEach(((o,l)=>{let u=!0;l.forEachWhile((h=>{const f=this.ot(h);return!f||f.purpose==="TargetPurposeLimboResolution"||(u=!1,!1)})),u&&(r=r.add(o))})),this.je.forEach(((o,l)=>l.setReadTime(e)));const i=new hm(e,n,this.Ye,this.je,r);return this.je=Mi(),this.Je=nf(),this.He=nf(),this.Ye=new tn(gt),i}Xe(e,n){if(!this.rt(e))return;const r=this.Et(e,n.key)?2:0;this.nt(e).Qe(n.key,r),this.je=this.je.insert(n.key,n),this.Je=this.Je.insert(n.key,this.It(n.key).add(e)),this.He=this.He.insert(n.key,this.dt(n.key).add(e))}et(e,n,r){if(!this.rt(e))return;const i=this.nt(e);this.Et(e,n)?i.Qe(n,1):i.$e(n),this.He=this.He.insert(n,this.dt(n).delete(e)),this.He=this.He.insert(n,this.dt(n).add(e)),r&&(this.je=this.je.insert(n,r))}removeTarget(e){this.ze.delete(e)}_t(e){const n=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+n.addedDocuments.size-n.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let n=this.ze.get(e);return n||(n=new pS,this.ze.set(e,n)),n}dt(e){let n=this.He.get(e);return n||(n=new Rn(gt),this.He=this.He.insert(e,n)),n}It(e){let n=this.Je.get(e);return n||(n=new Rn(gt),this.Je=this.Je.insert(e,n)),n}rt(e){const n=this.ot(e)!==null;return n||Fe("WatchChangeAggregator","Detected inactive target",e),n}ot(e){const n=this.ze.get(e);return n&&n.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new pS),this.Ge.getRemoteKeysForTarget(e).forEach((n=>{this.et(e,n,null)}))}Et(e,n){return this.Ge.getRemoteKeysForTarget(e).has(n)}}function nf(){return new tn(We.comparator)}function gS(){return new tn(We.comparator)}const NO={asc:"ASCENDING",desc:"DESCENDING"},PO={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},BO={and:"AND",or:"OR"};class zO{constructor(e,n){this.databaseId=e,this.useProto3Json=n}}function My(t,e){return t.useProto3Json||im(e)?e:{value:e}}function Bf(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function zC(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function LO(t,e){return Bf(t,e.toTimestamp())}function Hs(t){return jt(!!t,49232),Je.fromTimestamp((function(n){const r=Ba(n);return new Wt(r.seconds,r.nanos)})(t))}function A0(t,e){return Oy(t,e).canonicalString()}function Oy(t,e){const n=(function(i){return new $t(["projects",i.projectId,"databases",i.database])})(t).child("documents");return e===void 0?n:n.child(e)}function LC(t){const e=$t.fromString(t);return jt(qC(e),10190,{key:e.toString()}),e}function Ny(t,e){return A0(t.databaseId,e.path)}function Qg(t,e){const n=LC(e);if(n.get(1)!==t.databaseId.projectId)throw new Le(Ie.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new Le(Ie.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new We(FC(n))}function UC(t,e){return A0(t.databaseId,e)}function UO(t){const e=LC(t);return e.length===4?$t.emptyPath():FC(e)}function Py(t){return new $t(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function FC(t){return jt(t.length>4&&t.get(4)==="documents",29091,{key:t.toString()}),t.popFirst(5)}function yS(t,e,n){return{name:Ny(t,e),fields:n.value.mapValue.fields}}function FO(t,e){let n;if("targetChange"in e){e.targetChange;const r=(function(f){return f==="NO_CHANGE"?0:f==="ADD"?1:f==="REMOVE"?2:f==="CURRENT"?3:f==="RESET"?4:Ze(39313,{state:f})})(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],o=(function(f,p){return f.useProto3Json?(jt(p===void 0||typeof p=="string",58123),Gn.fromBase64String(p||"")):(jt(p===void 0||p instanceof Buffer||p instanceof Uint8Array,16193),Gn.fromUint8Array(p||new Uint8Array))})(t,e.targetChange.resumeToken),l=e.targetChange.cause,u=l&&(function(f){const p=f.code===void 0?Ie.UNKNOWN:NC(f.code);return new Le(p,f.message||"")})(l);n=new BC(r,i,o,u||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const i=Qg(t,r.document.name),o=Hs(r.document.updateTime),l=r.document.createTime?Hs(r.document.createTime):Je.min(),u=new br({mapValue:{fields:r.document.fields}}),h=Jn.newFoundDocument(i,o,l,u),f=r.targetIds||[],p=r.removedTargetIds||[];n=new yf(f,p,h.key,h)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const i=Qg(t,r.document),o=r.readTime?Hs(r.readTime):Je.min(),l=Jn.newNoDocument(i,o),u=r.removedTargetIds||[];n=new yf([],u,l.key,l)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const i=Qg(t,r.document),o=r.removedTargetIds||[];n=new yf([],o,i,null)}else{if(!("filter"in e))return Ze(11601,{Rt:e});{e.filter;const r=e.filter;r.targetId;const{count:i=0,unchangedNames:o}=r,l=new IO(i,o),u=r.targetId;n=new PC(u,l)}}return n}function VO(t,e){let n;if(e instanceof gd)n={update:yS(t,e.key,e.value)};else if(e instanceof dm)n={delete:Ny(t,e.key)};else if(e instanceof Qa)n={update:yS(t,e.key,e.data),updateMask:XO(e.fieldMask)};else{if(!(e instanceof AO))return Ze(16599,{Vt:e.type});n={verify:Ny(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map((r=>(function(o,l){const u=l.transform;if(u instanceof Nf)return{fieldPath:l.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof oc)return{fieldPath:l.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof lc)return{fieldPath:l.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof Pf)return{fieldPath:l.field.canonicalString(),increment:u.Ae};throw Ze(20930,{transform:l.transform})})(0,r)))),e.precondition.isNone||(n.currentDocument=(function(i,o){return o.updateTime!==void 0?{updateTime:LO(i,o.updateTime)}:o.exists!==void 0?{exists:o.exists}:Ze(27497)})(t,e.precondition)),n}function $O(t,e){return t&&t.length>0?(jt(e!==void 0,14353),t.map((n=>(function(i,o){let l=i.updateTime?Hs(i.updateTime):Hs(o);return l.isEqual(Je.min())&&(l=Hs(o)),new EO(l,i.transformResults||[])})(n,e)))):[]}function qO(t,e){return{documents:[UC(t,e.path)]}}function HO(t,e){const n={structuredQuery:{}},r=e.path;let i;e.collectionGroup!==null?(i=r,n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=UC(t,i);const o=(function(f){if(f.length!==0)return $C(gs.create(f,"and"))})(e.filters);o&&(n.structuredQuery.where=o);const l=(function(f){if(f.length!==0)return f.map((p=>(function(b){return{field:Wl(b.field),direction:QO(b.dir)}})(p)))})(e.orderBy);l&&(n.structuredQuery.orderBy=l);const u=My(t,e.limit);return u!==null&&(n.structuredQuery.limit=u),e.startAt&&(n.structuredQuery.startAt=(function(f){return{before:f.inclusive,values:f.position}})(e.startAt)),e.endAt&&(n.structuredQuery.endAt=(function(f){return{before:!f.inclusive,values:f.position}})(e.endAt)),{ft:n,parent:i}}function GO(t){let e=UO(t.parent);const n=t.structuredQuery,r=n.from?n.from.length:0;let i=null;if(r>0){jt(r===1,65062);const p=n.from[0];p.allDescendants?i=p.collectionId:e=e.child(p.collectionId)}let o=[];n.where&&(o=(function(g){const b=VC(g);return b instanceof gs&&yC(b)?b.getFilters():[b]})(n.where));let l=[];n.orderBy&&(l=(function(g){return g.map((b=>(function(w){return new Of(Ql(w.field),(function(S){switch(S){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(w.direction))})(b)))})(n.orderBy));let u=null;n.limit&&(u=(function(g){let b;return b=typeof g=="object"?g.value:g,im(b)?null:b})(n.limit));let h=null;n.startAt&&(h=(function(g){const b=!!g.before,_=g.values||[];return new Mf(_,b)})(n.startAt));let f=null;return n.endAt&&(f=(function(g){const b=!g.before,_=g.values||[];return new Mf(_,b)})(n.endAt)),dO(e,i,l,o,u,"F",h,f)}function WO(t,e){const n=(function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Ze(28987,{purpose:i})}})(e.purpose);return n==null?null:{"goog-listen-tags":n}}function VC(t){return t.unaryFilter!==void 0?(function(n){switch(n.unaryFilter.op){case"IS_NAN":const r=Ql(n.unaryFilter.field);return wn.create(r,"==",{doubleValue:NaN});case"IS_NULL":const i=Ql(n.unaryFilter.field);return wn.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const o=Ql(n.unaryFilter.field);return wn.create(o,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const l=Ql(n.unaryFilter.field);return wn.create(l,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return Ze(61313);default:return Ze(60726)}})(t):t.fieldFilter!==void 0?(function(n){return wn.create(Ql(n.fieldFilter.field),(function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return Ze(58110);default:return Ze(50506)}})(n.fieldFilter.op),n.fieldFilter.value)})(t):t.compositeFilter!==void 0?(function(n){return gs.create(n.compositeFilter.filters.map((r=>VC(r))),(function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return Ze(1026)}})(n.compositeFilter.op))})(t):Ze(30097,{filter:t})}function QO(t){return NO[t]}function KO(t){return PO[t]}function YO(t){return BO[t]}function Wl(t){return{fieldPath:t.canonicalString()}}function Ql(t){return $n.fromServerFormat(t.fieldPath)}function $C(t){return t instanceof wn?(function(n){if(n.op==="=="){if(sS(n.value))return{unaryFilter:{field:Wl(n.field),op:"IS_NAN"}};if(rS(n.value))return{unaryFilter:{field:Wl(n.field),op:"IS_NULL"}}}else if(n.op==="!="){if(sS(n.value))return{unaryFilter:{field:Wl(n.field),op:"IS_NOT_NAN"}};if(rS(n.value))return{unaryFilter:{field:Wl(n.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Wl(n.field),op:KO(n.op),value:n.value}}})(t):t instanceof gs?(function(n){const r=n.getFilters().map((i=>$C(i)));return r.length===1?r[0]:{compositeFilter:{op:YO(n.op),filters:r}}})(t):Ze(54877,{filter:t})}function XO(t){const e=[];return t.fields.forEach((n=>e.push(n.canonicalString()))),{fieldPaths:e}}function qC(t){return t.length>=4&&t.get(0)==="projects"&&t.get(2)==="databases"}class Ea{constructor(e,n,r,i,o=Je.min(),l=Je.min(),u=Gn.EMPTY_BYTE_STRING,h=null){this.target=e,this.targetId=n,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=o,this.lastLimboFreeSnapshotVersion=l,this.resumeToken=u,this.expectedCount=h}withSequenceNumber(e){return new Ea(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,n){return new Ea(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Ea(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Ea(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class ZO{constructor(e){this.yt=e}}function JO(t){const e=GO({parent:t.parent,structuredQuery:t.structuredQuery});return t.limitType==="LAST"?ky(e,e.limit,"L"):e}class eN{constructor(){this.Cn=new tN}addToCollectionParentIndex(e,n){return this.Cn.add(n),ke.resolve()}getCollectionParents(e,n){return ke.resolve(this.Cn.getEntries(n))}addFieldIndex(e,n){return ke.resolve()}deleteFieldIndex(e,n){return ke.resolve()}deleteAllFieldIndexes(e){return ke.resolve()}createTargetIndexes(e,n){return ke.resolve()}getDocumentsMatchingTarget(e,n){return ke.resolve(null)}getIndexType(e,n){return ke.resolve(0)}getFieldIndexes(e,n){return ke.resolve([])}getNextCollectionGroupToUpdate(e){return ke.resolve(null)}getMinOffset(e,n){return ke.resolve(Pa.min())}getMinOffsetFromCollectionGroup(e,n){return ke.resolve(Pa.min())}updateCollectionGroup(e,n,r){return ke.resolve()}updateIndexEntries(e,n){return ke.resolve()}}class tN{constructor(){this.index={}}add(e){const n=e.lastSegment(),r=e.popLast(),i=this.index[n]||new Rn($t.comparator),o=!i.has(r);return this.index[n]=i.add(r),o}has(e){const n=e.lastSegment(),r=e.popLast(),i=this.index[n];return i&&i.has(r)}getEntries(e){return(this.index[e]||new Rn($t.comparator)).toArray()}}const _S={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},HC=41943040;class _r{static withCacheSize(e){return new _r(e,_r.DEFAULT_COLLECTION_PERCENTILE,_r.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,n,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=n,this.maximumSequenceNumbersToCollect=r}}_r.DEFAULT_COLLECTION_PERCENTILE=10,_r.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,_r.DEFAULT=new _r(HC,_r.DEFAULT_COLLECTION_PERCENTILE,_r.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),_r.DISABLED=new _r(-1,0,0);class cc{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new cc(0)}static cr(){return new cc(-1)}}const bS="LruGarbageCollector",nN=1048576;function vS([t,e],[n,r]){const i=gt(t,n);return i===0?gt(e,r):i}class rN{constructor(e){this.Ir=e,this.buffer=new Rn(vS),this.Er=0}dr(){return++this.Er}Ar(e){const n=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(n);else{const r=this.buffer.last();vS(n,r)<0&&(this.buffer=this.buffer.delete(r).add(n))}}get maxValue(){return this.buffer.last()[0]}}class sN{constructor(e,n,r){this.garbageCollector=e,this.asyncQueue=n,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){Fe(bS,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(n){wc(n)?Fe(bS,"Ignoring IndexedDB error during garbage collection: ",n):await xc(n)}await this.Vr(3e5)}))}}class iN{constructor(e,n){this.mr=e,this.params=n}calculateTargetCount(e,n){return this.mr.gr(e).next((r=>Math.floor(n/100*r)))}nthSequenceNumber(e,n){if(n===0)return ke.resolve(sm.ce);const r=new rN(n);return this.mr.forEachTarget(e,(i=>r.Ar(i.sequenceNumber))).next((()=>this.mr.pr(e,(i=>r.Ar(i))))).next((()=>r.maxValue))}removeTargets(e,n,r){return this.mr.removeTargets(e,n,r)}removeOrphanedDocuments(e,n){return this.mr.removeOrphanedDocuments(e,n)}collect(e,n){return this.params.cacheSizeCollectionThreshold===-1?(Fe("LruGarbageCollector","Garbage collection skipped; disabled"),ke.resolve(_S)):this.getCacheSize(e).next((r=>r<this.params.cacheSizeCollectionThreshold?(Fe("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),_S):this.yr(e,n)))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,n){let r,i,o,l,u,h,f;const p=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((g=>(g>this.params.maximumSequenceNumbersToCollect?(Fe("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${g}`),i=this.params.maximumSequenceNumbersToCollect):i=g,l=Date.now(),this.nthSequenceNumber(e,i)))).next((g=>(r=g,u=Date.now(),this.removeTargets(e,r,n)))).next((g=>(o=g,h=Date.now(),this.removeOrphanedDocuments(e,r)))).next((g=>(f=Date.now(),Hl()<=pt.DEBUG&&Fe("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${l-p}ms
	Determined least recently used ${i} in `+(u-l)+`ms
	Removed ${o} targets in `+(h-u)+`ms
	Removed ${g} documents in `+(f-h)+`ms
Total Duration: ${f-p}ms`),ke.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:o,documentsRemoved:g}))))}}function aN(t,e){return new iN(t,e)}class oN{constructor(){this.changes=new Wo((e=>e.toString()),((e,n)=>e.isEqual(n))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,n){this.assertNotApplied(),this.changes.set(e,Jn.newInvalidDocument(e).setReadTime(n))}getEntry(e,n){this.assertNotApplied();const r=this.changes.get(n);return r!==void 0?ke.resolve(r):this.getFromCache(e,n)}getEntries(e,n){return this.getAllFromCache(e,n)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class lN{constructor(e,n){this.overlayedDocument=e,this.mutatedFields=n}}class cN{constructor(e,n,r,i){this.remoteDocumentCache=e,this.mutationQueue=n,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,n){let r=null;return this.documentOverlayCache.getOverlay(e,n).next((i=>(r=i,this.remoteDocumentCache.getEntry(e,n)))).next((i=>(r!==null&&$u(r.mutation,i,kr.empty(),Wt.now()),i)))}getDocuments(e,n){return this.remoteDocumentCache.getEntries(e,n).next((r=>this.getLocalViewOfDocuments(e,r,yt()).next((()=>r))))}getLocalViewOfDocuments(e,n,r=yt()){const i=Oo();return this.populateOverlays(e,i,n).next((()=>this.computeViews(e,n,i,r).next((o=>{let l=Nu();return o.forEach(((u,h)=>{l=l.insert(u,h.overlayedDocument)})),l}))))}getOverlayedDocuments(e,n){const r=Oo();return this.populateOverlays(e,r,n).next((()=>this.computeViews(e,n,r,yt())))}populateOverlays(e,n,r){const i=[];return r.forEach((o=>{n.has(o)||i.push(o)})),this.documentOverlayCache.getOverlays(e,i).next((o=>{o.forEach(((l,u)=>{n.set(l,u)}))}))}computeViews(e,n,r,i){let o=Mi();const l=Vu(),u=(function(){return Vu()})();return n.forEach(((h,f)=>{const p=r.get(f.key);i.has(f.key)&&(p===void 0||p.mutation instanceof Qa)?o=o.insert(f.key,f):p!==void 0?(l.set(f.key,p.mutation.getFieldMask()),$u(p.mutation,f,p.mutation.getFieldMask(),Wt.now())):l.set(f.key,kr.empty())})),this.recalculateAndSaveOverlays(e,o).next((h=>(h.forEach(((f,p)=>l.set(f,p))),n.forEach(((f,p)=>u.set(f,new lN(p,l.get(f)??null)))),u)))}recalculateAndSaveOverlays(e,n){const r=Vu();let i=new tn(((l,u)=>l-u)),o=yt();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,n).next((l=>{for(const u of l)u.keys().forEach((h=>{const f=n.get(h);if(f===null)return;let p=r.get(h)||kr.empty();p=u.applyToLocalView(f,p),r.set(h,p);const g=(i.get(u.batchId)||yt()).add(h);i=i.insert(u.batchId,g)}))})).next((()=>{const l=[],u=i.getReverseIterator();for(;u.hasNext();){const h=u.getNext(),f=h.key,p=h.value,g=TC();p.forEach((b=>{if(!o.has(b)){const _=MC(n.get(b),r.get(b));_!==null&&g.set(b,_),o=o.add(b)}})),l.push(this.documentOverlayCache.saveOverlays(e,f,g))}return ke.waitFor(l)})).next((()=>r))}recalculateAndSaveOverlaysForDocumentKeys(e,n){return this.remoteDocumentCache.getEntries(e,n).next((r=>this.recalculateAndSaveOverlays(e,r)))}getDocumentsMatchingQuery(e,n,r,i){return(function(l){return We.isDocumentKey(l.path)&&l.collectionGroup===null&&l.filters.length===0})(n)?this.getDocumentsMatchingDocumentQuery(e,n.path):xC(n)?this.getDocumentsMatchingCollectionGroupQuery(e,n,r,i):this.getDocumentsMatchingCollectionQuery(e,n,r,i)}getNextDocuments(e,n,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,n,r,i).next((o=>{const l=i-o.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,n,r.largestBatchId,i-o.size):ke.resolve(Oo());let u=Yu,h=o;return l.next((f=>ke.forEach(f,((p,g)=>(u<g.largestBatchId&&(u=g.largestBatchId),o.get(p)?ke.resolve():this.remoteDocumentCache.getEntry(e,p).next((b=>{h=h.insert(p,b)}))))).next((()=>this.populateOverlays(e,f,o))).next((()=>this.computeViews(e,h,f,yt()))).next((p=>({batchId:u,changes:CC(p)})))))}))}getDocumentsMatchingDocumentQuery(e,n){return this.getDocument(e,new We(n)).next((r=>{let i=Nu();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i}))}getDocumentsMatchingCollectionGroupQuery(e,n,r,i){const o=n.collectionGroup;let l=Nu();return this.indexManager.getCollectionParents(e,o).next((u=>ke.forEach(u,(h=>{const f=(function(g,b){return new pd(b,null,g.explicitOrderBy.slice(),g.filters.slice(),g.limit,g.limitType,g.startAt,g.endAt)})(n,h.child(o));return this.getDocumentsMatchingCollectionQuery(e,f,r,i).next((p=>{p.forEach(((g,b)=>{l=l.insert(g,b)}))}))})).next((()=>l))))}getDocumentsMatchingCollectionQuery(e,n,r,i){let o;return this.documentOverlayCache.getOverlaysForCollection(e,n.path,r.largestBatchId).next((l=>(o=l,this.remoteDocumentCache.getDocumentsMatchingQuery(e,n,r,o,i)))).next((l=>{o.forEach(((h,f)=>{const p=f.getKey();l.get(p)===null&&(l=l.insert(p,Jn.newInvalidDocument(p)))}));let u=Nu();return l.forEach(((h,f)=>{const p=o.get(h);p!==void 0&&$u(p.mutation,f,kr.empty(),Wt.now()),lm(n,f)&&(u=u.insert(h,f))})),u}))}}class uN{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,n){return ke.resolve(this.Lr.get(n))}saveBundleMetadata(e,n){return this.Lr.set(n.id,(function(i){return{id:i.id,version:i.version,createTime:Hs(i.createTime)}})(n)),ke.resolve()}getNamedQuery(e,n){return ke.resolve(this.kr.get(n))}saveNamedQuery(e,n){return this.kr.set(n.name,(function(i){return{name:i.name,query:JO(i.bundledQuery),readTime:Hs(i.readTime)}})(n)),ke.resolve()}}class dN{constructor(){this.overlays=new tn(We.comparator),this.qr=new Map}getOverlay(e,n){return ke.resolve(this.overlays.get(n))}getOverlays(e,n){const r=Oo();return ke.forEach(n,(i=>this.getOverlay(e,i).next((o=>{o!==null&&r.set(i,o)})))).next((()=>r))}saveOverlays(e,n,r){return r.forEach(((i,o)=>{this.St(e,n,o)})),ke.resolve()}removeOverlaysForBatchId(e,n,r){const i=this.qr.get(r);return i!==void 0&&(i.forEach((o=>this.overlays=this.overlays.remove(o))),this.qr.delete(r)),ke.resolve()}getOverlaysForCollection(e,n,r){const i=Oo(),o=n.length+1,l=new We(n.child("")),u=this.overlays.getIteratorFrom(l);for(;u.hasNext();){const h=u.getNext().value,f=h.getKey();if(!n.isPrefixOf(f.path))break;f.path.length===o&&h.largestBatchId>r&&i.set(h.getKey(),h)}return ke.resolve(i)}getOverlaysForCollectionGroup(e,n,r,i){let o=new tn(((f,p)=>f-p));const l=this.overlays.getIterator();for(;l.hasNext();){const f=l.getNext().value;if(f.getKey().getCollectionGroup()===n&&f.largestBatchId>r){let p=o.get(f.largestBatchId);p===null&&(p=Oo(),o=o.insert(f.largestBatchId,p)),p.set(f.getKey(),f)}}const u=Oo(),h=o.getIterator();for(;h.hasNext()&&(h.getNext().value.forEach(((f,p)=>u.set(f,p))),!(u.size()>=i)););return ke.resolve(u)}St(e,n,r){const i=this.overlays.get(r.key);if(i!==null){const l=this.qr.get(i.largestBatchId).delete(r.key);this.qr.set(i.largestBatchId,l)}this.overlays=this.overlays.insert(r.key,new RO(n,r));let o=this.qr.get(n);o===void 0&&(o=yt(),this.qr.set(n,o)),this.qr.set(n,o.add(r.key))}}class hN{constructor(){this.sessionToken=Gn.EMPTY_BYTE_STRING}getSessionToken(e){return ke.resolve(this.sessionToken)}setSessionToken(e,n){return this.sessionToken=n,ke.resolve()}}class j0{constructor(){this.Qr=new Rn(Nn.$r),this.Ur=new Rn(Nn.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,n){const r=new Nn(e,n);this.Qr=this.Qr.add(r),this.Ur=this.Ur.add(r)}Wr(e,n){e.forEach((r=>this.addReference(r,n)))}removeReference(e,n){this.Gr(new Nn(e,n))}zr(e,n){e.forEach((r=>this.removeReference(r,n)))}jr(e){const n=new We(new $t([])),r=new Nn(n,e),i=new Nn(n,e+1),o=[];return this.Ur.forEachInRange([r,i],(l=>{this.Gr(l),o.push(l.key)})),o}Jr(){this.Qr.forEach((e=>this.Gr(e)))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const n=new We(new $t([])),r=new Nn(n,e),i=new Nn(n,e+1);let o=yt();return this.Ur.forEachInRange([r,i],(l=>{o=o.add(l.key)})),o}containsKey(e){const n=new Nn(e,0),r=this.Qr.firstAfterOrEqual(n);return r!==null&&e.isEqual(r.key)}}class Nn{constructor(e,n){this.key=e,this.Yr=n}static $r(e,n){return We.comparator(e.key,n.key)||gt(e.Yr,n.Yr)}static Kr(e,n){return gt(e.Yr,n.Yr)||We.comparator(e.key,n.key)}}class fN{constructor(e,n){this.indexManager=e,this.referenceDelegate=n,this.mutationQueue=[],this.tr=1,this.Zr=new Rn(Nn.$r)}checkEmpty(e){return ke.resolve(this.mutationQueue.length===0)}addMutationBatch(e,n,r,i){const o=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const l=new jO(o,n,r,i);this.mutationQueue.push(l);for(const u of i)this.Zr=this.Zr.add(new Nn(u.key,o)),this.indexManager.addToCollectionParentIndex(e,u.key.path.popLast());return ke.resolve(l)}lookupMutationBatch(e,n){return ke.resolve(this.Xr(n))}getNextMutationBatchAfterBatchId(e,n){const r=n+1,i=this.ei(r),o=i<0?0:i;return ke.resolve(this.mutationQueue.length>o?this.mutationQueue[o]:null)}getHighestUnacknowledgedBatchId(){return ke.resolve(this.mutationQueue.length===0?_0:this.tr-1)}getAllMutationBatches(e){return ke.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,n){const r=new Nn(n,0),i=new Nn(n,Number.POSITIVE_INFINITY),o=[];return this.Zr.forEachInRange([r,i],(l=>{const u=this.Xr(l.Yr);o.push(u)})),ke.resolve(o)}getAllMutationBatchesAffectingDocumentKeys(e,n){let r=new Rn(gt);return n.forEach((i=>{const o=new Nn(i,0),l=new Nn(i,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([o,l],(u=>{r=r.add(u.Yr)}))})),ke.resolve(this.ti(r))}getAllMutationBatchesAffectingQuery(e,n){const r=n.path,i=r.length+1;let o=r;We.isDocumentKey(o)||(o=o.child(""));const l=new Nn(new We(o),0);let u=new Rn(gt);return this.Zr.forEachWhile((h=>{const f=h.key.path;return!!r.isPrefixOf(f)&&(f.length===i&&(u=u.add(h.Yr)),!0)}),l),ke.resolve(this.ti(u))}ti(e){const n=[];return e.forEach((r=>{const i=this.Xr(r);i!==null&&n.push(i)})),n}removeMutationBatch(e,n){jt(this.ni(n.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Zr;return ke.forEach(n.mutations,(i=>{const o=new Nn(i.key,n.batchId);return r=r.delete(o),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)})).next((()=>{this.Zr=r}))}ir(e){}containsKey(e,n){const r=new Nn(n,0),i=this.Zr.firstAfterOrEqual(r);return ke.resolve(n.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,ke.resolve()}ni(e,n){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const n=this.ei(e);return n<0||n>=this.mutationQueue.length?null:this.mutationQueue[n]}}class mN{constructor(e){this.ri=e,this.docs=(function(){return new tn(We.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,n){const r=n.key,i=this.docs.get(r),o=i?i.size:0,l=this.ri(n);return this.docs=this.docs.insert(r,{document:n.mutableCopy(),size:l}),this.size+=l-o,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const n=this.docs.get(e);n&&(this.docs=this.docs.remove(e),this.size-=n.size)}getEntry(e,n){const r=this.docs.get(n);return ke.resolve(r?r.document.mutableCopy():Jn.newInvalidDocument(n))}getEntries(e,n){let r=Mi();return n.forEach((i=>{const o=this.docs.get(i);r=r.insert(i,o?o.document.mutableCopy():Jn.newInvalidDocument(i))})),ke.resolve(r)}getDocumentsMatchingQuery(e,n,r,i){let o=Mi();const l=n.path,u=new We(l.child("__id-9223372036854775808__")),h=this.docs.getIteratorFrom(u);for(;h.hasNext();){const{key:f,value:{document:p}}=h.getNext();if(!l.isPrefixOf(f.path))break;f.path.length>l.length+1||$M(VM(p),r)<=0||(i.has(p.key)||lm(n,p))&&(o=o.insert(p.key,p.mutableCopy()))}return ke.resolve(o)}getAllFromCollectionGroup(e,n,r,i){Ze(9500)}ii(e,n){return ke.forEach(this.docs,(r=>n(r)))}newChangeBuffer(e){return new pN(this)}getSize(e){return ke.resolve(this.size)}}class pN extends oN{constructor(e){super(),this.Nr=e}applyChanges(e){const n=[];return this.changes.forEach(((r,i)=>{i.isValidDocument()?n.push(this.Nr.addEntry(e,i)):this.Nr.removeEntry(r)})),ke.waitFor(n)}getFromCache(e,n){return this.Nr.getEntry(e,n)}getAllFromCache(e,n){return this.Nr.getEntries(e,n)}}class gN{constructor(e){this.persistence=e,this.si=new Wo((n=>x0(n)),w0),this.lastRemoteSnapshotVersion=Je.min(),this.highestTargetId=0,this.oi=0,this._i=new j0,this.targetCount=0,this.ai=cc.ur()}forEachTarget(e,n){return this.si.forEach(((r,i)=>n(i))),ke.resolve()}getLastRemoteSnapshotVersion(e){return ke.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return ke.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),ke.resolve(this.highestTargetId)}setTargetsMetadata(e,n,r){return r&&(this.lastRemoteSnapshotVersion=r),n>this.oi&&(this.oi=n),ke.resolve()}Pr(e){this.si.set(e.target,e);const n=e.targetId;n>this.highestTargetId&&(this.ai=new cc(n),this.highestTargetId=n),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,n){return this.Pr(n),this.targetCount+=1,ke.resolve()}updateTargetData(e,n){return this.Pr(n),ke.resolve()}removeTargetData(e,n){return this.si.delete(n.target),this._i.jr(n.targetId),this.targetCount-=1,ke.resolve()}removeTargets(e,n,r){let i=0;const o=[];return this.si.forEach(((l,u)=>{u.sequenceNumber<=n&&r.get(u.targetId)===null&&(this.si.delete(l),o.push(this.removeMatchingKeysForTargetId(e,u.targetId)),i++)})),ke.waitFor(o).next((()=>i))}getTargetCount(e){return ke.resolve(this.targetCount)}getTargetData(e,n){const r=this.si.get(n)||null;return ke.resolve(r)}addMatchingKeys(e,n,r){return this._i.Wr(n,r),ke.resolve()}removeMatchingKeys(e,n,r){this._i.zr(n,r);const i=this.persistence.referenceDelegate,o=[];return i&&n.forEach((l=>{o.push(i.markPotentiallyOrphaned(e,l))})),ke.waitFor(o)}removeMatchingKeysForTargetId(e,n){return this._i.jr(n),ke.resolve()}getMatchingKeysForTargetId(e,n){const r=this._i.Hr(n);return ke.resolve(r)}containsKey(e,n){return ke.resolve(this._i.containsKey(n))}}class GC{constructor(e,n){this.ui={},this.overlays={},this.ci=new sm(0),this.li=!1,this.li=!0,this.hi=new hN,this.referenceDelegate=e(this),this.Pi=new gN(this),this.indexManager=new eN,this.remoteDocumentCache=(function(i){return new mN(i)})((r=>this.referenceDelegate.Ti(r))),this.serializer=new ZO(n),this.Ii=new uN(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let n=this.overlays[e.toKey()];return n||(n=new dN,this.overlays[e.toKey()]=n),n}getMutationQueue(e,n){let r=this.ui[e.toKey()];return r||(r=new fN(n,this.referenceDelegate),this.ui[e.toKey()]=r),r}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,n,r){Fe("MemoryPersistence","Starting transaction:",e);const i=new yN(this.ci.next());return this.referenceDelegate.Ei(),r(i).next((o=>this.referenceDelegate.di(i).next((()=>o)))).toPromise().then((o=>(i.raiseOnCommittedEvent(),o)))}Ai(e,n){return ke.or(Object.values(this.ui).map((r=>()=>r.containsKey(e,n))))}}class yN extends HM{constructor(e){super(),this.currentSequenceNumber=e}}class R0{constructor(e){this.persistence=e,this.Ri=new j0,this.Vi=null}static mi(e){return new R0(e)}get fi(){if(this.Vi)return this.Vi;throw Ze(60996)}addReference(e,n,r){return this.Ri.addReference(r,n),this.fi.delete(r.toString()),ke.resolve()}removeReference(e,n,r){return this.Ri.removeReference(r,n),this.fi.add(r.toString()),ke.resolve()}markPotentiallyOrphaned(e,n){return this.fi.add(n.toString()),ke.resolve()}removeTarget(e,n){this.Ri.jr(n.targetId).forEach((i=>this.fi.add(i.toString())));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,n.targetId).next((i=>{i.forEach((o=>this.fi.add(o.toString())))})).next((()=>r.removeTargetData(e,n)))}Ei(){this.Vi=new Set}di(e){const n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return ke.forEach(this.fi,(r=>{const i=We.fromPath(r);return this.gi(e,i).next((o=>{o||n.removeEntry(i,Je.min())}))})).next((()=>(this.Vi=null,n.apply(e))))}updateLimboDocument(e,n){return this.gi(e,n).next((r=>{r?this.fi.delete(n.toString()):this.fi.add(n.toString())}))}Ti(e){return 0}gi(e,n){return ke.or([()=>ke.resolve(this.Ri.containsKey(n)),()=>this.persistence.getTargetCache().containsKey(e,n),()=>this.persistence.Ai(e,n)])}}class zf{constructor(e,n){this.persistence=e,this.pi=new Wo((r=>QM(r.path)),((r,i)=>r.isEqual(i))),this.garbageCollector=aN(this,n)}static mi(e,n){return new zf(e,n)}Ei(){}di(e){return ke.resolve()}forEachTarget(e,n){return this.persistence.getTargetCache().forEachTarget(e,n)}gr(e){const n=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next((r=>n.next((i=>r+i))))}wr(e){let n=0;return this.pr(e,(r=>{n++})).next((()=>n))}pr(e,n){return ke.forEach(this.pi,((r,i)=>this.br(e,r,i).next((o=>o?ke.resolve():n(i)))))}removeTargets(e,n,r){return this.persistence.getTargetCache().removeTargets(e,n,r)}removeOrphanedDocuments(e,n){let r=0;const i=this.persistence.getRemoteDocumentCache(),o=i.newChangeBuffer();return i.ii(e,(l=>this.br(e,l,n).next((u=>{u||(r++,o.removeEntry(l,Je.min()))})))).next((()=>o.apply(e))).next((()=>r))}markPotentiallyOrphaned(e,n){return this.pi.set(n,e.currentSequenceNumber),ke.resolve()}removeTarget(e,n){const r=n.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,n,r){return this.pi.set(r,e.currentSequenceNumber),ke.resolve()}removeReference(e,n,r){return this.pi.set(r,e.currentSequenceNumber),ke.resolve()}updateLimboDocument(e,n){return this.pi.set(n,e.currentSequenceNumber),ke.resolve()}Ti(e){let n=e.key.toString().length;return e.isFoundDocument()&&(n+=mf(e.data.value)),n}br(e,n,r){return ke.or([()=>this.persistence.Ai(e,n),()=>this.persistence.getTargetCache().containsKey(e,n),()=>{const i=this.pi.get(n);return ke.resolve(i!==void 0&&i>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class I0{constructor(e,n,r,i){this.targetId=e,this.fromCache=n,this.Es=r,this.ds=i}static As(e,n){let r=yt(),i=yt();for(const o of n.docChanges)switch(o.type){case 0:r=r.add(o.doc.key);break;case 1:i=i.add(o.doc.key)}return new I0(e,n.fromCache,r,i)}}class _N{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class bN{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(function(){return h2()?8:GM(er())>0?6:4})()}initialize(e,n){this.ps=e,this.indexManager=n,this.Rs=!0}getDocumentsMatchingQuery(e,n,r,i){const o={result:null};return this.ys(e,n).next((l=>{o.result=l})).next((()=>{if(!o.result)return this.ws(e,n,i,r).next((l=>{o.result=l}))})).next((()=>{if(o.result)return;const l=new _N;return this.Ss(e,n,l).next((u=>{if(o.result=u,this.Vs)return this.bs(e,n,l,u.size)}))})).next((()=>o.result))}bs(e,n,r,i){return r.documentReadCount<this.fs?(Hl()<=pt.DEBUG&&Fe("QueryEngine","SDK will not create cache indexes for query:",Gl(n),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),ke.resolve()):(Hl()<=pt.DEBUG&&Fe("QueryEngine","Query:",Gl(n),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.gs*i?(Hl()<=pt.DEBUG&&Fe("QueryEngine","The SDK decides to create cache indexes for query:",Gl(n),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,qs(n))):ke.resolve())}ys(e,n){if(lS(n))return ke.resolve(null);let r=qs(n);return this.indexManager.getIndexType(e,r).next((i=>i===0?null:(n.limit!==null&&i===1&&(n=ky(n,null,"F"),r=qs(n)),this.indexManager.getDocumentsMatchingTarget(e,r).next((o=>{const l=yt(...o);return this.ps.getDocuments(e,l).next((u=>this.indexManager.getMinOffset(e,r).next((h=>{const f=this.Ds(n,u);return this.Cs(n,f,l,h.readTime)?this.ys(e,ky(n,null,"F")):this.vs(e,f,n,h)}))))})))))}ws(e,n,r,i){return lS(n)||i.isEqual(Je.min())?ke.resolve(null):this.ps.getDocuments(e,r).next((o=>{const l=this.Ds(n,o);return this.Cs(n,l,r,i)?ke.resolve(null):(Hl()<=pt.DEBUG&&Fe("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Gl(n)),this.vs(e,l,n,FM(i,Yu)).next((u=>u)))}))}Ds(e,n){let r=new Rn(SC(e));return n.forEach(((i,o)=>{lm(e,o)&&(r=r.add(o))})),r}Cs(e,n,r,i){if(e.limit===null)return!1;if(r.size!==n.size)return!0;const o=e.limitType==="F"?n.last():n.first();return!!o&&(o.hasPendingWrites||o.version.compareTo(i)>0)}Ss(e,n,r){return Hl()<=pt.DEBUG&&Fe("QueryEngine","Using full collection scan to execute query:",Gl(n)),this.ps.getDocumentsMatchingQuery(e,n,Pa.min(),r)}vs(e,n,r,i){return this.ps.getDocumentsMatchingQuery(e,r,i).next((o=>(n.forEach((l=>{o=o.insert(l.key,l)})),o)))}}const D0="LocalStore",vN=3e8;class xN{constructor(e,n,r,i){this.persistence=e,this.Fs=n,this.serializer=i,this.Ms=new tn(gt),this.xs=new Wo((o=>x0(o)),w0),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(r)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new cN(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(n=>e.collect(n,this.Ms)))}}function wN(t,e,n,r){return new xN(t,e,n,r)}async function WC(t,e){const n=st(t);return await n.persistence.runTransaction("Handle user change","readonly",(r=>{let i;return n.mutationQueue.getAllMutationBatches(r).next((o=>(i=o,n.Bs(e),n.mutationQueue.getAllMutationBatches(r)))).next((o=>{const l=[],u=[];let h=yt();for(const f of i){l.push(f.batchId);for(const p of f.mutations)h=h.add(p.key)}for(const f of o){u.push(f.batchId);for(const p of f.mutations)h=h.add(p.key)}return n.localDocuments.getDocuments(r,h).next((f=>({Ls:f,removedBatchIds:l,addedBatchIds:u})))}))}))}function SN(t,e){const n=st(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(r=>{const i=e.batch.keys(),o=n.Ns.newChangeBuffer({trackRemovals:!0});return(function(u,h,f,p){const g=f.batch,b=g.keys();let _=ke.resolve();return b.forEach((w=>{_=_.next((()=>p.getEntry(h,w))).next((x=>{const S=f.docVersions.get(w);jt(S!==null,48541),x.version.compareTo(S)<0&&(g.applyToRemoteDocument(x,f),x.isValidDocument()&&(x.setReadTime(f.commitVersion),p.addEntry(x)))}))})),_.next((()=>u.mutationQueue.removeMutationBatch(h,g)))})(n,r,e,o).next((()=>o.apply(r))).next((()=>n.mutationQueue.performConsistencyCheck(r))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,(function(u){let h=yt();for(let f=0;f<u.mutationResults.length;++f)u.mutationResults[f].transformResults.length>0&&(h=h.add(u.batch.mutations[f].key));return h})(e)))).next((()=>n.localDocuments.getDocuments(r,i)))}))}function QC(t){const e=st(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(n=>e.Pi.getLastRemoteSnapshotVersion(n)))}function EN(t,e){const n=st(t),r=e.snapshotVersion;let i=n.Ms;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(o=>{const l=n.Ns.newChangeBuffer({trackRemovals:!0});i=n.Ms;const u=[];e.targetChanges.forEach(((p,g)=>{const b=i.get(g);if(!b)return;u.push(n.Pi.removeMatchingKeys(o,p.removedDocuments,g).next((()=>n.Pi.addMatchingKeys(o,p.addedDocuments,g))));let _=b.withSequenceNumber(o.currentSequenceNumber);e.targetMismatches.get(g)!==null?_=_.withResumeToken(Gn.EMPTY_BYTE_STRING,Je.min()).withLastLimboFreeSnapshotVersion(Je.min()):p.resumeToken.approximateByteSize()>0&&(_=_.withResumeToken(p.resumeToken,r)),i=i.insert(g,_),(function(x,S,C){return x.resumeToken.approximateByteSize()===0||S.snapshotVersion.toMicroseconds()-x.snapshotVersion.toMicroseconds()>=vN?!0:C.addedDocuments.size+C.modifiedDocuments.size+C.removedDocuments.size>0})(b,_,p)&&u.push(n.Pi.updateTargetData(o,_))}));let h=Mi(),f=yt();if(e.documentUpdates.forEach((p=>{e.resolvedLimboDocuments.has(p)&&u.push(n.persistence.referenceDelegate.updateLimboDocument(o,p))})),u.push(CN(o,l,e.documentUpdates).next((p=>{h=p.ks,f=p.qs}))),!r.isEqual(Je.min())){const p=n.Pi.getLastRemoteSnapshotVersion(o).next((g=>n.Pi.setTargetsMetadata(o,o.currentSequenceNumber,r)));u.push(p)}return ke.waitFor(u).next((()=>l.apply(o))).next((()=>n.localDocuments.getLocalViewOfDocuments(o,h,f))).next((()=>h))})).then((o=>(n.Ms=i,o)))}function CN(t,e,n){let r=yt(),i=yt();return n.forEach((o=>r=r.add(o))),e.getEntries(t,r).next((o=>{let l=Mi();return n.forEach(((u,h)=>{const f=o.get(u);h.isFoundDocument()!==f.isFoundDocument()&&(i=i.add(u)),h.isNoDocument()&&h.version.isEqual(Je.min())?(e.removeEntry(u,h.readTime),l=l.insert(u,h)):!f.isValidDocument()||h.version.compareTo(f.version)>0||h.version.compareTo(f.version)===0&&f.hasPendingWrites?(e.addEntry(h),l=l.insert(u,h)):Fe(D0,"Ignoring outdated watch update for ",u,". Current version:",f.version," Watch version:",h.version)})),{ks:l,qs:i}}))}function TN(t,e){const n=st(t);return n.persistence.runTransaction("Get next mutation batch","readonly",(r=>(e===void 0&&(e=_0),n.mutationQueue.getNextMutationBatchAfterBatchId(r,e))))}function AN(t,e){const n=st(t);return n.persistence.runTransaction("Allocate target","readwrite",(r=>{let i;return n.Pi.getTargetData(r,e).next((o=>o?(i=o,ke.resolve(i)):n.Pi.allocateTargetId(r).next((l=>(i=new Ea(e,l,"TargetPurposeListen",r.currentSequenceNumber),n.Pi.addTargetData(r,i).next((()=>i)))))))})).then((r=>{const i=n.Ms.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(n.Ms=n.Ms.insert(r.targetId,r),n.xs.set(e,r.targetId)),r}))}async function By(t,e,n){const r=st(t),i=r.Ms.get(e),o=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",o,(l=>r.persistence.referenceDelegate.removeTarget(l,i)))}catch(l){if(!wc(l))throw l;Fe(D0,`Failed to update sequence numbers for target ${e}: ${l}`)}r.Ms=r.Ms.remove(e),r.xs.delete(i.target)}function xS(t,e,n){const r=st(t);let i=Je.min(),o=yt();return r.persistence.runTransaction("Execute query","readwrite",(l=>(function(h,f,p){const g=st(h),b=g.xs.get(p);return b!==void 0?ke.resolve(g.Ms.get(b)):g.Pi.getTargetData(f,p)})(r,l,qs(e)).next((u=>{if(u)return i=u.lastLimboFreeSnapshotVersion,r.Pi.getMatchingKeysForTargetId(l,u.targetId).next((h=>{o=h}))})).next((()=>r.Fs.getDocumentsMatchingQuery(l,e,n?i:Je.min(),n?o:yt()))).next((u=>(jN(r,fO(e),u),{documents:u,Qs:o})))))}function jN(t,e,n){let r=t.Os.get(e)||Je.min();n.forEach(((i,o)=>{o.readTime.compareTo(r)>0&&(r=o.readTime)})),t.Os.set(e,r)}class wS{constructor(){this.activeTargetIds=bO()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class RN{constructor(){this.Mo=new wS,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,n,r){}addLocalQueryTarget(e,n=!0){return n&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,n,r){this.xo[e]=n}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new wS,Promise.resolve()}handleUserChange(e,n,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class IN{Oo(e){}shutdown(){}}const SS="ConnectivityMonitor";class ES{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){Fe(SS,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){Fe(SS,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}let rf=null;function zy(){return rf===null?rf=(function(){return 268435456+Math.round(2147483648*Math.random())})():rf++,"0x"+rf.toString(16)}const Kg="RestConnection",DN={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class kN{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const n=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Uo=n+"://"+e.host,this.Ko=`projects/${r}/databases/${i}`,this.Wo=this.databaseId.database===Df?`project_id=${r}`:`project_id=${r}&database_id=${i}`}Go(e,n,r,i,o){const l=zy(),u=this.zo(e,n.toUriEncodedString());Fe(Kg,`Sending RPC '${e}' ${l}:`,u,r);const h={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(h,i,o);const{host:f}=new URL(u),p=pc(f);return this.Jo(e,u,h,r,p).then((g=>(Fe(Kg,`Received RPC '${e}' ${l}: `,g),g)),(g=>{throw rc(Kg,`RPC '${e}' ${l} failed with error: `,g,"url: ",u,"request:",r),g}))}Ho(e,n,r,i,o,l){return this.Go(e,n,r,i,o)}jo(e,n,r){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+vc})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach(((i,o)=>e[o]=i)),r&&r.headers.forEach(((i,o)=>e[o]=i))}zo(e,n){const r=DN[e];return`${this.Uo}/v1/${n}:${r}`}terminate(){}}class MN{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}const Yn="WebChannelConnection";class ON extends kN{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,n,r,i,o){const l=zy();return new Promise(((u,h)=>{const f=new YE;f.setWithCredentials(!0),f.listenOnce(XE.COMPLETE,(()=>{try{switch(f.getLastErrorCode()){case ff.NO_ERROR:const g=f.getResponseJson();Fe(Yn,`XHR for RPC '${e}' ${l} received:`,JSON.stringify(g)),u(g);break;case ff.TIMEOUT:Fe(Yn,`RPC '${e}' ${l} timed out`),h(new Le(Ie.DEADLINE_EXCEEDED,"Request time out"));break;case ff.HTTP_ERROR:const b=f.getStatus();if(Fe(Yn,`RPC '${e}' ${l} failed with status:`,b,"response text:",f.getResponseText()),b>0){let _=f.getResponseJson();Array.isArray(_)&&(_=_[0]);const w=_?.error;if(w&&w.status&&w.message){const x=(function(C){const T=C.toLowerCase().replace(/_/g,"-");return Object.values(Ie).indexOf(T)>=0?T:Ie.UNKNOWN})(w.status);h(new Le(x,w.message))}else h(new Le(Ie.UNKNOWN,"Server responded with status "+f.getStatus()))}else h(new Le(Ie.UNAVAILABLE,"Connection failed."));break;default:Ze(9055,{l_:e,streamId:l,h_:f.getLastErrorCode(),P_:f.getLastError()})}}finally{Fe(Yn,`RPC '${e}' ${l} completed.`)}}));const p=JSON.stringify(i);Fe(Yn,`RPC '${e}' ${l} sending request:`,i),f.send(n,"POST",p,r,15)}))}T_(e,n,r){const i=zy(),o=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],l=eC(),u=JE(),h={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},f=this.longPollingOptions.timeoutSeconds;f!==void 0&&(h.longPollingTimeout=Math.round(1e3*f)),this.useFetchStreams&&(h.useFetchStreams=!0),this.jo(h.initMessageHeaders,n,r),h.encodeInitMessageHeaders=!0;const p=o.join("");Fe(Yn,`Creating RPC '${e}' stream ${i}: ${p}`,h);const g=l.createWebChannel(p,h);this.I_(g);let b=!1,_=!1;const w=new MN({Yo:S=>{_?Fe(Yn,`Not sending because RPC '${e}' stream ${i} is closed:`,S):(b||(Fe(Yn,`Opening RPC '${e}' stream ${i} transport.`),g.open(),b=!0),Fe(Yn,`RPC '${e}' stream ${i} sending:`,S),g.send(S))},Zo:()=>g.close()}),x=(S,C,T)=>{S.listen(C,(I=>{try{T(I)}catch(M){setTimeout((()=>{throw M}),0)}}))};return x(g,Ou.EventType.OPEN,(()=>{_||(Fe(Yn,`RPC '${e}' stream ${i} transport opened.`),w.o_())})),x(g,Ou.EventType.CLOSE,(()=>{_||(_=!0,Fe(Yn,`RPC '${e}' stream ${i} transport closed`),w.a_(),this.E_(g))})),x(g,Ou.EventType.ERROR,(S=>{_||(_=!0,rc(Yn,`RPC '${e}' stream ${i} transport errored. Name:`,S.name,"Message:",S.message),w.a_(new Le(Ie.UNAVAILABLE,"The operation could not be completed")))})),x(g,Ou.EventType.MESSAGE,(S=>{if(!_){const C=S.data[0];jt(!!C,16349);const T=C,I=T?.error||T[0]?.error;if(I){Fe(Yn,`RPC '${e}' stream ${i} received error:`,I);const M=I.status;let U=(function(P){const N=xn[P];if(N!==void 0)return NC(N)})(M),H=I.message;U===void 0&&(U=Ie.INTERNAL,H="Unknown error status: "+M+" with message "+I.message),_=!0,w.a_(new Le(U,H)),g.close()}else Fe(Yn,`RPC '${e}' stream ${i} received:`,C),w.u_(C)}})),x(u,ZE.STAT_EVENT,(S=>{S.stat===Cy.PROXY?Fe(Yn,`RPC '${e}' stream ${i} detected buffering proxy`):S.stat===Cy.NOPROXY&&Fe(Yn,`RPC '${e}' stream ${i} detected no buffering proxy`)})),setTimeout((()=>{w.__()}),0),w}terminate(){this.c_.forEach((e=>e.close())),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter((n=>n===e))}}function Yg(){return typeof document<"u"?document:null}function fm(t){return new zO(t,!0)}class KC{constructor(e,n,r=1e3,i=1.5,o=6e4){this.Mi=e,this.timerId=n,this.d_=r,this.A_=i,this.R_=o,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const n=Math.floor(this.V_+this.y_()),r=Math.max(0,Date.now()-this.f_),i=Math.max(0,n-r);i>0&&Fe("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.V_} ms, delay with jitter: ${n} ms, last attempt: ${r} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,i,(()=>(this.f_=Date.now(),e()))),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}const CS="PersistentStream";class YC{constructor(e,n,r,i,o,l,u,h){this.Mi=e,this.S_=r,this.b_=i,this.connection=o,this.authCredentialsProvider=l,this.appCheckCredentialsProvider=u,this.listener=h,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new KC(e,n)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,(()=>this.k_())))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,n){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():n&&n.code===Ie.RESOURCE_EXHAUSTED?(ki(n.toString()),ki("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):n&&n.code===Ie.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(n)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),n=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([r,i])=>{this.D_===n&&this.G_(r,i)}),(r=>{e((()=>{const i=new Le(Ie.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(i)}))}))}G_(e,n){const r=this.W_(this.D_);this.stream=this.j_(e,n),this.stream.Xo((()=>{r((()=>this.listener.Xo()))})),this.stream.t_((()=>{r((()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.t_())))})),this.stream.r_((i=>{r((()=>this.z_(i)))})),this.stream.onMessage((i=>{r((()=>++this.F_==1?this.J_(i):this.onNext(i)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(e){return Fe(CS,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return n=>{this.Mi.enqueueAndForget((()=>this.D_===e?n():(Fe(CS,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class NN extends YC{constructor(e,n,r,i,o,l){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",n,r,i,l),this.serializer=o}j_(e,n){return this.connection.T_("Listen",e,n)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const n=FO(this.serializer,e),r=(function(o){if(!("targetChange"in o))return Je.min();const l=o.targetChange;return l.targetIds&&l.targetIds.length?Je.min():l.readTime?Hs(l.readTime):Je.min()})(e);return this.listener.H_(n,r)}Y_(e){const n={};n.database=Py(this.serializer),n.addTarget=(function(o,l){let u;const h=l.target;if(u=Iy(h)?{documents:qO(o,h)}:{query:HO(o,h).ft},u.targetId=l.targetId,l.resumeToken.approximateByteSize()>0){u.resumeToken=zC(o,l.resumeToken);const f=My(o,l.expectedCount);f!==null&&(u.expectedCount=f)}else if(l.snapshotVersion.compareTo(Je.min())>0){u.readTime=Bf(o,l.snapshotVersion.toTimestamp());const f=My(o,l.expectedCount);f!==null&&(u.expectedCount=f)}return u})(this.serializer,e);const r=WO(this.serializer,e);r&&(n.labels=r),this.q_(n)}Z_(e){const n={};n.database=Py(this.serializer),n.removeTarget=e,this.q_(n)}}class PN extends YC{constructor(e,n,r,i,o,l){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",n,r,i,l),this.serializer=o}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,n){return this.connection.T_("Write",e,n)}J_(e){return jt(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,jt(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){jt(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const n=$O(e.writeResults,e.commitTime),r=Hs(e.commitTime);return this.listener.na(r,n)}ra(){const e={};e.database=Py(this.serializer),this.q_(e)}ea(e){const n={streamToken:this.lastStreamToken,writes:e.map((r=>VO(this.serializer,r)))};this.q_(n)}}class BN{}class zN extends BN{constructor(e,n,r,i){super(),this.authCredentials=e,this.appCheckCredentials=n,this.connection=r,this.serializer=i,this.ia=!1}sa(){if(this.ia)throw new Le(Ie.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,n,r,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([o,l])=>this.connection.Go(e,Oy(n,r),i,o,l))).catch((o=>{throw o.name==="FirebaseError"?(o.code===Ie.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new Le(Ie.UNKNOWN,o.toString())}))}Ho(e,n,r,i,o){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([l,u])=>this.connection.Ho(e,Oy(n,r),i,l,u,o))).catch((l=>{throw l.name==="FirebaseError"?(l.code===Ie.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),l):new Le(Ie.UNKNOWN,l.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}class LN{constructor(e,n){this.asyncQueue=e,this.onlineStateHandler=n,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const n=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(ki(n),this.aa=!1):Fe("OnlineStateTracker",n)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}const $o="RemoteStore";class UN{constructor(e,n,r,i,o){this.localStore=e,this.datastore=n,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=o,this.Aa.Oo((l=>{r.enqueueAndForget((async()=>{Qo(this)&&(Fe($o,"Restarting streams for network reachability change."),await(async function(h){const f=st(h);f.Ea.add(4),await _d(f),f.Ra.set("Unknown"),f.Ea.delete(4),await mm(f)})(this))}))})),this.Ra=new LN(r,i)}}async function mm(t){if(Qo(t))for(const e of t.da)await e(!0)}async function _d(t){for(const e of t.da)await e(!1)}function XC(t,e){const n=st(t);n.Ia.has(e.targetId)||(n.Ia.set(e.targetId,e),N0(n)?O0(n):Sc(n).O_()&&M0(n,e))}function k0(t,e){const n=st(t),r=Sc(n);n.Ia.delete(e),r.O_()&&ZC(n,e),n.Ia.size===0&&(r.O_()?r.L_():Qo(n)&&n.Ra.set("Unknown"))}function M0(t,e){if(t.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Je.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}Sc(t).Y_(e)}function ZC(t,e){t.Va.Ue(e),Sc(t).Z_(e)}function O0(t){t.Va=new OO({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),At:e=>t.Ia.get(e)||null,ht:()=>t.datastore.serializer.databaseId}),Sc(t).start(),t.Ra.ua()}function N0(t){return Qo(t)&&!Sc(t).x_()&&t.Ia.size>0}function Qo(t){return st(t).Ea.size===0}function JC(t){t.Va=void 0}async function FN(t){t.Ra.set("Online")}async function VN(t){t.Ia.forEach(((e,n)=>{M0(t,e)}))}async function $N(t,e){JC(t),N0(t)?(t.Ra.ha(e),O0(t)):t.Ra.set("Unknown")}async function qN(t,e,n){if(t.Ra.set("Online"),e instanceof BC&&e.state===2&&e.cause)try{await(async function(i,o){const l=o.cause;for(const u of o.targetIds)i.Ia.has(u)&&(await i.remoteSyncer.rejectListen(u,l),i.Ia.delete(u),i.Va.removeTarget(u))})(t,e)}catch(r){Fe($o,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await Lf(t,r)}else if(e instanceof yf?t.Va.Ze(e):e instanceof PC?t.Va.st(e):t.Va.tt(e),!n.isEqual(Je.min()))try{const r=await QC(t.localStore);n.compareTo(r)>=0&&await(function(o,l){const u=o.Va.Tt(l);return u.targetChanges.forEach(((h,f)=>{if(h.resumeToken.approximateByteSize()>0){const p=o.Ia.get(f);p&&o.Ia.set(f,p.withResumeToken(h.resumeToken,l))}})),u.targetMismatches.forEach(((h,f)=>{const p=o.Ia.get(h);if(!p)return;o.Ia.set(h,p.withResumeToken(Gn.EMPTY_BYTE_STRING,p.snapshotVersion)),ZC(o,h);const g=new Ea(p.target,h,f,p.sequenceNumber);M0(o,g)})),o.remoteSyncer.applyRemoteEvent(u)})(t,n)}catch(r){Fe($o,"Failed to raise snapshot:",r),await Lf(t,r)}}async function Lf(t,e,n){if(!wc(e))throw e;t.Ea.add(1),await _d(t),t.Ra.set("Offline"),n||(n=()=>QC(t.localStore)),t.asyncQueue.enqueueRetryable((async()=>{Fe($o,"Retrying IndexedDB access"),await n(),t.Ea.delete(1),await mm(t)}))}function eT(t,e){return e().catch((n=>Lf(t,n,e)))}async function pm(t){const e=st(t),n=Ua(e);let r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:_0;for(;HN(e);)try{const i=await TN(e.localStore,r);if(i===null){e.Ta.length===0&&n.L_();break}r=i.batchId,GN(e,i)}catch(i){await Lf(e,i)}tT(e)&&nT(e)}function HN(t){return Qo(t)&&t.Ta.length<10}function GN(t,e){t.Ta.push(e);const n=Ua(t);n.O_()&&n.X_&&n.ea(e.mutations)}function tT(t){return Qo(t)&&!Ua(t).x_()&&t.Ta.length>0}function nT(t){Ua(t).start()}async function WN(t){Ua(t).ra()}async function QN(t){const e=Ua(t);for(const n of t.Ta)e.ea(n.mutations)}async function KN(t,e,n){const r=t.Ta.shift(),i=C0.from(r,e,n);await eT(t,(()=>t.remoteSyncer.applySuccessfulWrite(i))),await pm(t)}async function YN(t,e){e&&Ua(t).X_&&await(async function(r,i){if((function(l){return DO(l)&&l!==Ie.ABORTED})(i.code)){const o=r.Ta.shift();Ua(r).B_(),await eT(r,(()=>r.remoteSyncer.rejectFailedWrite(o.batchId,i))),await pm(r)}})(t,e),tT(t)&&nT(t)}async function TS(t,e){const n=st(t);n.asyncQueue.verifyOperationInProgress(),Fe($o,"RemoteStore received new credentials");const r=Qo(n);n.Ea.add(3),await _d(n),r&&n.Ra.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.Ea.delete(3),await mm(n)}async function XN(t,e){const n=st(t);e?(n.Ea.delete(2),await mm(n)):e||(n.Ea.add(2),await _d(n),n.Ra.set("Unknown"))}function Sc(t){return t.ma||(t.ma=(function(n,r,i){const o=st(n);return o.sa(),new NN(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,i)})(t.datastore,t.asyncQueue,{Xo:FN.bind(null,t),t_:VN.bind(null,t),r_:$N.bind(null,t),H_:qN.bind(null,t)}),t.da.push((async e=>{e?(t.ma.B_(),N0(t)?O0(t):t.Ra.set("Unknown")):(await t.ma.stop(),JC(t))}))),t.ma}function Ua(t){return t.fa||(t.fa=(function(n,r,i){const o=st(n);return o.sa(),new PN(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,i)})(t.datastore,t.asyncQueue,{Xo:()=>Promise.resolve(),t_:WN.bind(null,t),r_:YN.bind(null,t),ta:QN.bind(null,t),na:KN.bind(null,t)}),t.da.push((async e=>{e?(t.fa.B_(),await pm(t)):(await t.fa.stop(),t.Ta.length>0&&(Fe($o,`Stopping write stream with ${t.Ta.length} pending writes`),t.Ta=[]))}))),t.fa}class P0{constructor(e,n,r,i,o){this.asyncQueue=e,this.timerId=n,this.targetTimeMs=r,this.op=i,this.removalCallback=o,this.deferred=new Ti,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((l=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,n,r,i,o){const l=Date.now()+r,u=new P0(e,n,l,i,o);return u.start(r),u}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Le(Ie.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function B0(t,e){if(ki("AsyncQueue",`${e}: ${t}`),wc(t))return new Le(Ie.UNAVAILABLE,`${e}: ${t}`);throw t}class Jl{static emptySet(e){return new Jl(e.comparator)}constructor(e){this.comparator=e?(n,r)=>e(n,r)||We.comparator(n.key,r.key):(n,r)=>We.comparator(n.key,r.key),this.keyedMap=Nu(),this.sortedSet=new tn(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const n=this.keyedMap.get(e);return n?this.sortedSet.indexOf(n):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((n,r)=>(e(n),!1)))}add(e){const n=this.delete(e.key);return n.copy(n.keyedMap.insert(e.key,e),n.sortedSet.insert(e,null))}delete(e){const n=this.get(e);return n?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(n)):this}isEqual(e){if(!(e instanceof Jl)||this.size!==e.size)return!1;const n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;n.hasNext();){const i=n.getNext().key,o=r.getNext().key;if(!i.isEqual(o))return!1}return!0}toString(){const e=[];return this.forEach((n=>{e.push(n.toString())})),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,n){const r=new Jl;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r}}class AS{constructor(){this.ga=new tn(We.comparator)}track(e){const n=e.doc.key,r=this.ga.get(n);r?e.type!==0&&r.type===3?this.ga=this.ga.insert(n,e):e.type===3&&r.type!==1?this.ga=this.ga.insert(n,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.ga=this.ga.insert(n,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.ga=this.ga.insert(n,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.ga=this.ga.remove(n):e.type===1&&r.type===2?this.ga=this.ga.insert(n,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.ga=this.ga.insert(n,{type:2,doc:e.doc}):Ze(63341,{Rt:e,pa:r}):this.ga=this.ga.insert(n,e)}ya(){const e=[];return this.ga.inorderTraversal(((n,r)=>{e.push(r)})),e}}class uc{constructor(e,n,r,i,o,l,u,h,f){this.query=e,this.docs=n,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=o,this.fromCache=l,this.syncStateChanged=u,this.excludesMetadataChanges=h,this.hasCachedResults=f}static fromInitialDocuments(e,n,r,i,o){const l=[];return n.forEach((u=>{l.push({type:0,doc:u})})),new uc(e,n,Jl.emptySet(n),l,r,i,!0,!1,o)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&om(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const n=this.docChanges,r=e.docChanges;if(n.length!==r.length)return!1;for(let i=0;i<n.length;i++)if(n[i].type!==r[i].type||!n[i].doc.isEqual(r[i].doc))return!1;return!0}}class ZN{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some((e=>e.Da()))}}class JN{constructor(){this.queries=jS(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(n,r){const i=st(n),o=i.queries;i.queries=jS(),o.forEach(((l,u)=>{for(const h of u.Sa)h.onError(r)}))})(this,new Le(Ie.ABORTED,"Firestore shutting down"))}}function jS(){return new Wo((t=>wC(t)),om)}async function rT(t,e){const n=st(t);let r=3;const i=e.query;let o=n.queries.get(i);o?!o.ba()&&e.Da()&&(r=2):(o=new ZN,r=e.Da()?0:1);try{switch(r){case 0:o.wa=await n.onListen(i,!0);break;case 1:o.wa=await n.onListen(i,!1);break;case 2:await n.onFirstRemoteStoreListen(i)}}catch(l){const u=B0(l,`Initialization of query '${Gl(e.query)}' failed`);return void e.onError(u)}n.queries.set(i,o),o.Sa.push(e),e.va(n.onlineState),o.wa&&e.Fa(o.wa)&&z0(n)}async function sT(t,e){const n=st(t),r=e.query;let i=3;const o=n.queries.get(r);if(o){const l=o.Sa.indexOf(e);l>=0&&(o.Sa.splice(l,1),o.Sa.length===0?i=e.Da()?0:1:!o.ba()&&e.Da()&&(i=2))}switch(i){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}}function e6(t,e){const n=st(t);let r=!1;for(const i of e){const o=i.query,l=n.queries.get(o);if(l){for(const u of l.Sa)u.Fa(i)&&(r=!0);l.wa=i}}r&&z0(n)}function t6(t,e,n){const r=st(t),i=r.queries.get(e);if(i)for(const o of i.Sa)o.onError(n);r.queries.delete(e)}function z0(t){t.Ca.forEach((e=>{e.next()}))}var Ly,RS;(RS=Ly||(Ly={})).Ma="default",RS.Cache="cache";class iT{constructor(e,n,r){this.query=e,this.xa=n,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){const r=[];for(const i of e.docChanges)i.type!==3&&r.push(i);e=new uc(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let n=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),n=!0):this.La(e,this.onlineState)&&(this.ka(e),n=!0),this.Na=e,n}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let n=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),n=!0),n}La(e,n){if(!e.fromCache||!this.Da())return!0;const r=n!=="Offline";return(!this.options.qa||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||n==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const n=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!n)&&this.options.includeMetadataChanges===!0}ka(e){e=uc.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==Ly.Cache}}class aT{constructor(e){this.key=e}}class oT{constructor(e){this.key=e}}class n6{constructor(e,n){this.query=e,this.Ya=n,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=yt(),this.mutatedKeys=yt(),this.eu=SC(e),this.tu=new Jl(this.eu)}get nu(){return this.Ya}ru(e,n){const r=n?n.iu:new AS,i=n?n.tu:this.tu;let o=n?n.mutatedKeys:this.mutatedKeys,l=i,u=!1;const h=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,f=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal(((p,g)=>{const b=i.get(p),_=lm(this.query,g)?g:null,w=!!b&&this.mutatedKeys.has(b.key),x=!!_&&(_.hasLocalMutations||this.mutatedKeys.has(_.key)&&_.hasCommittedMutations);let S=!1;b&&_?b.data.isEqual(_.data)?w!==x&&(r.track({type:3,doc:_}),S=!0):this.su(b,_)||(r.track({type:2,doc:_}),S=!0,(h&&this.eu(_,h)>0||f&&this.eu(_,f)<0)&&(u=!0)):!b&&_?(r.track({type:0,doc:_}),S=!0):b&&!_&&(r.track({type:1,doc:b}),S=!0,(h||f)&&(u=!0)),S&&(_?(l=l.add(_),o=x?o.add(p):o.delete(p)):(l=l.delete(p),o=o.delete(p)))})),this.query.limit!==null)for(;l.size>this.query.limit;){const p=this.query.limitType==="F"?l.last():l.first();l=l.delete(p.key),o=o.delete(p.key),r.track({type:1,doc:p})}return{tu:l,iu:r,Cs:u,mutatedKeys:o}}su(e,n){return e.hasLocalMutations&&n.hasCommittedMutations&&!n.hasLocalMutations}applyChanges(e,n,r,i){const o=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const l=e.iu.ya();l.sort(((p,g)=>(function(_,w){const x=S=>{switch(S){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Ze(20277,{Rt:S})}};return x(_)-x(w)})(p.type,g.type)||this.eu(p.doc,g.doc))),this.ou(r),i=i??!1;const u=n&&!i?this._u():[],h=this.Xa.size===0&&this.current&&!i?1:0,f=h!==this.Za;return this.Za=h,l.length!==0||f?{snapshot:new uc(this.query,e.tu,o,l,e.mutatedKeys,h===0,f,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:u}:{au:u}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new AS,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach((n=>this.Ya=this.Ya.add(n))),e.modifiedDocuments.forEach((n=>{})),e.removedDocuments.forEach((n=>this.Ya=this.Ya.delete(n))),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=yt(),this.tu.forEach((r=>{this.uu(r.key)&&(this.Xa=this.Xa.add(r.key))}));const n=[];return e.forEach((r=>{this.Xa.has(r)||n.push(new oT(r))})),this.Xa.forEach((r=>{e.has(r)||n.push(new aT(r))})),n}cu(e){this.Ya=e.Qs,this.Xa=yt();const n=this.ru(e.documents);return this.applyChanges(n,!0)}lu(){return uc.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const L0="SyncEngine";class r6{constructor(e,n,r){this.query=e,this.targetId=n,this.view=r}}class s6{constructor(e){this.key=e,this.hu=!1}}class i6{constructor(e,n,r,i,o,l){this.localStore=e,this.remoteStore=n,this.eventManager=r,this.sharedClientState=i,this.currentUser=o,this.maxConcurrentLimboResolutions=l,this.Pu={},this.Tu=new Wo((u=>wC(u)),om),this.Iu=new Map,this.Eu=new Set,this.du=new tn(We.comparator),this.Au=new Map,this.Ru=new j0,this.Vu={},this.mu=new Map,this.fu=cc.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function a6(t,e,n=!0){const r=fT(t);let i;const o=r.Tu.get(e);return o?(r.sharedClientState.addLocalQueryTarget(o.targetId),i=o.view.lu()):i=await lT(r,e,n,!0),i}async function o6(t,e){const n=fT(t);await lT(n,e,!0,!1)}async function lT(t,e,n,r){const i=await AN(t.localStore,qs(e)),o=i.targetId,l=t.sharedClientState.addLocalQueryTarget(o,n);let u;return r&&(u=await l6(t,e,o,l==="current",i.resumeToken)),t.isPrimaryClient&&n&&XC(t.remoteStore,i),u}async function l6(t,e,n,r,i){t.pu=(g,b,_)=>(async function(x,S,C,T){let I=S.view.ru(C);I.Cs&&(I=await xS(x.localStore,S.query,!1).then((({documents:O})=>S.view.ru(O,I))));const M=T&&T.targetChanges.get(S.targetId),U=T&&T.targetMismatches.get(S.targetId)!=null,H=S.view.applyChanges(I,x.isPrimaryClient,M,U);return DS(x,S.targetId,H.au),H.snapshot})(t,g,b,_);const o=await xS(t.localStore,e,!0),l=new n6(e,o.Qs),u=l.ru(o.documents),h=yd.createSynthesizedTargetChangeForCurrentChange(n,r&&t.onlineState!=="Offline",i),f=l.applyChanges(u,t.isPrimaryClient,h);DS(t,n,f.au);const p=new r6(e,n,l);return t.Tu.set(e,p),t.Iu.has(n)?t.Iu.get(n).push(e):t.Iu.set(n,[e]),f.snapshot}async function c6(t,e,n){const r=st(t),i=r.Tu.get(e),o=r.Iu.get(i.targetId);if(o.length>1)return r.Iu.set(i.targetId,o.filter((l=>!om(l,e)))),void r.Tu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||await By(r.localStore,i.targetId,!1).then((()=>{r.sharedClientState.clearQueryState(i.targetId),n&&k0(r.remoteStore,i.targetId),Uy(r,i.targetId)})).catch(xc)):(Uy(r,i.targetId),await By(r.localStore,i.targetId,!0))}async function u6(t,e){const n=st(t),r=n.Tu.get(e),i=n.Iu.get(r.targetId);n.isPrimaryClient&&i.length===1&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),k0(n.remoteStore,r.targetId))}async function d6(t,e,n){const r=_6(t);try{const i=await(function(l,u){const h=st(l),f=Wt.now(),p=u.reduce(((_,w)=>_.add(w.key)),yt());let g,b;return h.persistence.runTransaction("Locally write mutations","readwrite",(_=>{let w=Mi(),x=yt();return h.Ns.getEntries(_,p).next((S=>{w=S,w.forEach(((C,T)=>{T.isValidDocument()||(x=x.add(C))}))})).next((()=>h.localDocuments.getOverlayedDocuments(_,w))).next((S=>{g=S;const C=[];for(const T of u){const I=TO(T,g.get(T.key).overlayedDocument);I!=null&&C.push(new Qa(T.key,I,mC(I.value.mapValue),vr.exists(!0)))}return h.mutationQueue.addMutationBatch(_,f,C,u)})).next((S=>{b=S;const C=S.applyToLocalDocumentSet(g,x);return h.documentOverlayCache.saveOverlays(_,S.batchId,C)}))})).then((()=>({batchId:b.batchId,changes:CC(g)})))})(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),(function(l,u,h){let f=l.Vu[l.currentUser.toKey()];f||(f=new tn(gt)),f=f.insert(u,h),l.Vu[l.currentUser.toKey()]=f})(r,i.batchId,n),await bd(r,i.changes),await pm(r.remoteStore)}catch(i){const o=B0(i,"Failed to persist write");n.reject(o)}}async function cT(t,e){const n=st(t);try{const r=await EN(n.localStore,e);e.targetChanges.forEach(((i,o)=>{const l=n.Au.get(o);l&&(jt(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1,22616),i.addedDocuments.size>0?l.hu=!0:i.modifiedDocuments.size>0?jt(l.hu,14607):i.removedDocuments.size>0&&(jt(l.hu,42227),l.hu=!1))})),await bd(n,r,e)}catch(r){await xc(r)}}function IS(t,e,n){const r=st(t);if(r.isPrimaryClient&&n===0||!r.isPrimaryClient&&n===1){const i=[];r.Tu.forEach(((o,l)=>{const u=l.view.va(e);u.snapshot&&i.push(u.snapshot)})),(function(l,u){const h=st(l);h.onlineState=u;let f=!1;h.queries.forEach(((p,g)=>{for(const b of g.Sa)b.va(u)&&(f=!0)})),f&&z0(h)})(r.eventManager,e),i.length&&r.Pu.H_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function h6(t,e,n){const r=st(t);r.sharedClientState.updateQueryState(e,"rejected",n);const i=r.Au.get(e),o=i&&i.key;if(o){let l=new tn(We.comparator);l=l.insert(o,Jn.newNoDocument(o,Je.min()));const u=yt().add(o),h=new hm(Je.min(),new Map,new tn(gt),l,u);await cT(r,h),r.du=r.du.remove(o),r.Au.delete(e),U0(r)}else await By(r.localStore,e,!1).then((()=>Uy(r,e,n))).catch(xc)}async function f6(t,e){const n=st(t),r=e.batch.batchId;try{const i=await SN(n.localStore,e);dT(n,r,null),uT(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await bd(n,i)}catch(i){await xc(i)}}async function m6(t,e,n){const r=st(t);try{const i=await(function(l,u){const h=st(l);return h.persistence.runTransaction("Reject batch","readwrite-primary",(f=>{let p;return h.mutationQueue.lookupMutationBatch(f,u).next((g=>(jt(g!==null,37113),p=g.keys(),h.mutationQueue.removeMutationBatch(f,g)))).next((()=>h.mutationQueue.performConsistencyCheck(f))).next((()=>h.documentOverlayCache.removeOverlaysForBatchId(f,p,u))).next((()=>h.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(f,p))).next((()=>h.localDocuments.getDocuments(f,p)))}))})(r.localStore,e);dT(r,e,n),uT(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),await bd(r,i)}catch(i){await xc(i)}}function uT(t,e){(t.mu.get(e)||[]).forEach((n=>{n.resolve()})),t.mu.delete(e)}function dT(t,e,n){const r=st(t);let i=r.Vu[r.currentUser.toKey()];if(i){const o=i.get(e);o&&(n?o.reject(n):o.resolve(),i=i.remove(e)),r.Vu[r.currentUser.toKey()]=i}}function Uy(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.Iu.get(e))t.Tu.delete(r),n&&t.Pu.yu(r,n);t.Iu.delete(e),t.isPrimaryClient&&t.Ru.jr(e).forEach((r=>{t.Ru.containsKey(r)||hT(t,r)}))}function hT(t,e){t.Eu.delete(e.path.canonicalString());const n=t.du.get(e);n!==null&&(k0(t.remoteStore,n),t.du=t.du.remove(e),t.Au.delete(n),U0(t))}function DS(t,e,n){for(const r of n)r instanceof aT?(t.Ru.addReference(r.key,e),p6(t,r)):r instanceof oT?(Fe(L0,"Document no longer in limbo: "+r.key),t.Ru.removeReference(r.key,e),t.Ru.containsKey(r.key)||hT(t,r.key)):Ze(19791,{wu:r})}function p6(t,e){const n=e.key,r=n.path.canonicalString();t.du.get(n)||t.Eu.has(r)||(Fe(L0,"New document in limbo: "+n),t.Eu.add(r),U0(t))}function U0(t){for(;t.Eu.size>0&&t.du.size<t.maxConcurrentLimboResolutions;){const e=t.Eu.values().next().value;t.Eu.delete(e);const n=new We($t.fromString(e)),r=t.fu.next();t.Au.set(r,new s6(n)),t.du=t.du.insert(n,r),XC(t.remoteStore,new Ea(qs(S0(n.path)),r,"TargetPurposeLimboResolution",sm.ce))}}async function bd(t,e,n){const r=st(t),i=[],o=[],l=[];r.Tu.isEmpty()||(r.Tu.forEach(((u,h)=>{l.push(r.pu(h,e,n).then((f=>{if((f||n)&&r.isPrimaryClient){const p=f?!f.fromCache:n?.targetChanges.get(h.targetId)?.current;r.sharedClientState.updateQueryState(h.targetId,p?"current":"not-current")}if(f){i.push(f);const p=I0.As(h.targetId,f);o.push(p)}})))})),await Promise.all(l),r.Pu.H_(i),await(async function(h,f){const p=st(h);try{await p.persistence.runTransaction("notifyLocalViewChanges","readwrite",(g=>ke.forEach(f,(b=>ke.forEach(b.Es,(_=>p.persistence.referenceDelegate.addReference(g,b.targetId,_))).next((()=>ke.forEach(b.ds,(_=>p.persistence.referenceDelegate.removeReference(g,b.targetId,_)))))))))}catch(g){if(!wc(g))throw g;Fe(D0,"Failed to update sequence numbers: "+g)}for(const g of f){const b=g.targetId;if(!g.fromCache){const _=p.Ms.get(b),w=_.snapshotVersion,x=_.withLastLimboFreeSnapshotVersion(w);p.Ms=p.Ms.insert(b,x)}}})(r.localStore,o))}async function g6(t,e){const n=st(t);if(!n.currentUser.isEqual(e)){Fe(L0,"User change. New user:",e.toKey());const r=await WC(n.localStore,e);n.currentUser=e,(function(o,l){o.mu.forEach((u=>{u.forEach((h=>{h.reject(new Le(Ie.CANCELLED,l))}))})),o.mu.clear()})(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await bd(n,r.Ls)}}function y6(t,e){const n=st(t),r=n.Au.get(e);if(r&&r.hu)return yt().add(r.key);{let i=yt();const o=n.Iu.get(e);if(!o)return i;for(const l of o){const u=n.Tu.get(l);i=i.unionWith(u.view.nu)}return i}}function fT(t){const e=st(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=cT.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=y6.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=h6.bind(null,e),e.Pu.H_=e6.bind(null,e.eventManager),e.Pu.yu=t6.bind(null,e.eventManager),e}function _6(t){const e=st(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=f6.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=m6.bind(null,e),e}class Uf{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=fm(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,n){return null}Mu(e,n){return null}vu(e){return wN(this.persistence,new bN,e.initialUser,this.serializer)}Cu(e){return new GC(R0.mi,this.serializer)}Du(e){return new RN}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Uf.provider={build:()=>new Uf};class b6 extends Uf{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,n){jt(this.persistence.referenceDelegate instanceof zf,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new sN(r,e.asyncQueue,n)}Cu(e){const n=this.cacheSizeBytes!==void 0?_r.withCacheSize(this.cacheSizeBytes):_r.DEFAULT;return new GC((r=>zf.mi(r,n)),this.serializer)}}class Fy{async initialize(e,n){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>IS(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=g6.bind(null,this.syncEngine),await XN(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new JN})()}createDatastore(e){const n=fm(e.databaseInfo.databaseId),r=(function(o){return new ON(o)})(e.databaseInfo);return(function(o,l,u,h){return new zN(o,l,u,h)})(e.authCredentials,e.appCheckCredentials,r,n)}createRemoteStore(e){return(function(r,i,o,l,u){return new UN(r,i,o,l,u)})(this.localStore,this.datastore,e.asyncQueue,(n=>IS(this.syncEngine,n,0)),(function(){return ES.v()?new ES:new IN})())}createSyncEngine(e,n){return(function(i,o,l,u,h,f,p){const g=new i6(i,o,l,u,h,f);return p&&(g.gu=!0),g})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,n)}async terminate(){await(async function(n){const r=st(n);Fe($o,"RemoteStore shutting down."),r.Ea.add(5),await _d(r),r.Aa.shutdown(),r.Ra.set("Unknown")})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}Fy.provider={build:()=>new Fy};class mT{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):ki("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,n){setTimeout((()=>{this.muted||e(n)}),0)}}const Fa="FirestoreClient";class v6{constructor(e,n,r,i,o){this.authCredentials=e,this.appCheckCredentials=n,this.asyncQueue=r,this.databaseInfo=i,this.user=Zn.UNAUTHENTICATED,this.clientId=y0.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=o,this.authCredentials.start(r,(async l=>{Fe(Fa,"Received user=",l.uid),await this.authCredentialListener(l),this.user=l})),this.appCheckCredentials.start(r,(l=>(Fe(Fa,"Received new app check token=",l),this.appCheckCredentialListener(l,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Ti;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){const r=B0(n,"Failed to shutdown persistence");e.reject(r)}})),e.promise}}async function Xg(t,e){t.asyncQueue.verifyOperationInProgress(),Fe(Fa,"Initializing OfflineComponentProvider");const n=t.configuration;await e.initialize(n);let r=n.initialUser;t.setCredentialChangeListener((async i=>{r.isEqual(i)||(await WC(e.localStore,i),r=i)})),e.persistence.setDatabaseDeletedListener((()=>t.terminate())),t._offlineComponents=e}async function kS(t,e){t.asyncQueue.verifyOperationInProgress();const n=await x6(t);Fe(Fa,"Initializing OnlineComponentProvider"),await e.initialize(n,t.configuration),t.setCredentialChangeListener((r=>TS(e.remoteStore,r))),t.setAppCheckTokenChangeListener(((r,i)=>TS(e.remoteStore,i))),t._onlineComponents=e}async function x6(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){Fe(Fa,"Using user provided OfflineComponentProvider");try{await Xg(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!(function(i){return i.name==="FirebaseError"?i.code===Ie.FAILED_PRECONDITION||i.code===Ie.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11})(n))throw n;rc("Error using user provided cache. Falling back to memory cache: "+n),await Xg(t,new Uf)}}else Fe(Fa,"Using default OfflineComponentProvider"),await Xg(t,new b6(void 0));return t._offlineComponents}async function pT(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(Fe(Fa,"Using user provided OnlineComponentProvider"),await kS(t,t._uninitializedComponentsProvider._online)):(Fe(Fa,"Using default OnlineComponentProvider"),await kS(t,new Fy))),t._onlineComponents}function w6(t){return pT(t).then((e=>e.syncEngine))}async function gT(t){const e=await pT(t),n=e.eventManager;return n.onListen=a6.bind(null,e.syncEngine),n.onUnlisten=c6.bind(null,e.syncEngine),n.onFirstRemoteStoreListen=o6.bind(null,e.syncEngine),n.onLastRemoteStoreUnlisten=u6.bind(null,e.syncEngine),n}function S6(t,e,n={}){const r=new Ti;return t.asyncQueue.enqueueAndForget((async()=>(function(o,l,u,h,f){const p=new mT({next:b=>{p.Nu(),l.enqueueAndForget((()=>sT(o,g)));const _=b.docs.has(u);!_&&b.fromCache?f.reject(new Le(Ie.UNAVAILABLE,"Failed to get document because the client is offline.")):_&&b.fromCache&&h&&h.source==="server"?f.reject(new Le(Ie.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):f.resolve(b)},error:b=>f.reject(b)}),g=new iT(S0(u.path),p,{includeMetadataChanges:!0,qa:!0});return rT(o,g)})(await gT(t),t.asyncQueue,e,n,r))),r.promise}function E6(t,e,n={}){const r=new Ti;return t.asyncQueue.enqueueAndForget((async()=>(function(o,l,u,h,f){const p=new mT({next:b=>{p.Nu(),l.enqueueAndForget((()=>sT(o,g))),b.fromCache&&h.source==="server"?f.reject(new Le(Ie.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):f.resolve(b)},error:b=>f.reject(b)}),g=new iT(u,p,{includeMetadataChanges:!0,qa:!0});return rT(o,g)})(await gT(t),t.asyncQueue,e,n,r))),r.promise}function yT(t){const e={};return t.timeoutSeconds!==void 0&&(e.timeoutSeconds=t.timeoutSeconds),e}const MS=new Map;const _T="firestore.googleapis.com",OS=!0;class NS{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new Le(Ie.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=_T,this.ssl=OS}else this.host=e.host,this.ssl=e.ssl??OS;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=HC;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<nN)throw new Le(Ie.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}UM("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=yT(e.experimentalLongPollingOptions??{}),(function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new Le(Ie.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new Le(Ie.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new Le(Ie.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(r,i){return r.timeoutSeconds===i.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class gm{constructor(e,n,r,i){this._authCredentials=e,this._appCheckCredentials=n,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new NS({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Le(Ie.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new Le(Ie.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new NS(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(r){if(!r)return new IM;switch(r.type){case"firstParty":return new OM(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new Le(Ie.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(n){const r=MS.get(n);r&&(Fe("ComponentProvider","Removing Datastore"),MS.delete(n),r.terminate())})(this),Promise.resolve()}}function C6(t,e,n,r={}){t=ps(t,gm);const i=pc(e),o=t._getSettings(),l={...o,emulatorOptions:t._getEmulatorOptions()},u=`${e}:${n}`;i&&(Y1(`https://${u}`),X1("Firestore",!0)),o.host!==_T&&o.host!==u&&rc("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const h={...o,host:u,ssl:i,emulatorOptions:r};if(!Ri(h,l)&&(t._setSettings(h),r.mockUserToken)){let f,p;if(typeof r.mockUserToken=="string")f=r.mockUserToken,p=Zn.MOCK_USER;else{f=r2(r.mockUserToken,t._app?.options.projectId);const g=r.mockUserToken.sub||r.mockUserToken.user_id;if(!g)throw new Le(Ie.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");p=new Zn(g)}t._authCredentials=new DM(new nC(f,p))}}class Ec{constructor(e,n,r){this.converter=n,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new Ec(this.firestore,e,this._query)}}class dn{constructor(e,n,r){this.converter=n,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Ma(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new dn(this.firestore,e,this._key)}toJSON(){return{type:dn._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,n,r){if(md(n,dn._jsonSchema))return new dn(e,r||null,new We($t.fromString(n.referencePath)))}}dn._jsonSchemaVersion="firestore/documentReference/1.0",dn._jsonSchema={type:Sn("string",dn._jsonSchemaVersion),referencePath:Sn("string")};class Ma extends Ec{constructor(e,n,r){super(e,n,S0(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new dn(this.firestore,null,new We(e))}withConverter(e){return new Ma(this.firestore,e,this._path)}}function T6(t,e,...n){if(t=En(t),rC("collection","path",e),t instanceof gm){const r=$t.fromString(e,...n);return Qw(r),new Ma(t,null,r)}{if(!(t instanceof dn||t instanceof Ma))throw new Le(Ie.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child($t.fromString(e,...n));return Qw(r),new Ma(t.firestore,null,r)}}function Cc(t,e,...n){if(t=En(t),arguments.length===1&&(e=y0.newId()),rC("doc","path",e),t instanceof gm){const r=$t.fromString(e,...n);return Ww(r),new dn(t,null,new We(r))}{if(!(t instanceof dn||t instanceof Ma))throw new Le(Ie.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child($t.fromString(e,...n));return Ww(r),new dn(t.firestore,t instanceof Ma?t.converter:null,new We(r))}}const PS="AsyncQueue";class BS{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new KC(this,"async_queue_retry"),this._c=()=>{const r=Yg();r&&Fe(PS,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=e;const n=Yg();n&&typeof n.addEventListener=="function"&&n.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const n=Yg();n&&typeof n.removeEventListener=="function"&&n.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise((()=>{}));const n=new Ti;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(e().then(n.resolve,n.reject),n.promise))).then((()=>n.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Xu.push(e),this.lc())))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!wc(e))throw e;Fe(PS,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_((()=>this.lc()))}}cc(e){const n=this.ac.then((()=>(this.rc=!0,e().catch((r=>{throw this.nc=r,this.rc=!1,ki("INTERNAL UNHANDLED ERROR: ",zS(r)),r})).then((r=>(this.rc=!1,r))))));return this.ac=n,n}enqueueAfterDelay(e,n,r){this.uc(),this.oc.indexOf(e)>-1&&(n=0);const i=P0.createAndSchedule(this,e,n,r,(o=>this.hc(o)));return this.tc.push(i),i}uc(){this.nc&&Ze(47125,{Pc:zS(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const n of this.tc)if(n.timerId===e)return!0;return!1}Ec(e){return this.Tc().then((()=>{this.tc.sort(((n,r)=>n.targetTimeMs-r.targetTimeMs));for(const n of this.tc)if(n.skipDelay(),e!=="all"&&n.timerId===e)break;return this.Tc()}))}dc(e){this.oc.push(e)}hc(e){const n=this.tc.indexOf(e);this.tc.splice(n,1)}}function zS(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+`
`+t.stack),e}class Ko extends gm{constructor(e,n,r,i){super(e,n,r,i),this.type="firestore",this._queue=new BS,this._persistenceKey=i?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new BS(e),this._firestoreClient=void 0,await e}}}function A6(t,e){const n=typeof t=="object"?t:tE(),r=typeof t=="string"?t:Df,i=r0(n,"firestore").getImmediate({identifier:r});if(!i._initialized){const o=t2("firestore");o&&C6(i,...o)}return i}function ym(t){if(t._terminated)throw new Le(Ie.FAILED_PRECONDITION,"The client has already been terminated.");return t._firestoreClient||j6(t),t._firestoreClient}function j6(t){const e=t._freezeSettings(),n=(function(i,o,l,u){return new XM(i,o,l,u.host,u.ssl,u.experimentalForceLongPolling,u.experimentalAutoDetectLongPolling,yT(u.experimentalLongPollingOptions),u.useFetchStreams,u.isUsingEmulator)})(t._databaseId,t._app?.options.appId||"",t._persistenceKey,e);t._componentsProvider||e.localCache?._offlineComponentProvider&&e.localCache?._onlineComponentProvider&&(t._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),t._firestoreClient=new v6(t._authCredentials,t._appCheckCredentials,t._queue,n,t._componentsProvider&&(function(i){const o=i?._online.build();return{_offline:i?._offline.build(o),_online:o}})(t._componentsProvider))}class Zr{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Zr(Gn.fromBase64String(e))}catch(n){throw new Le(Ie.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+n)}}static fromUint8Array(e){return new Zr(Gn.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:Zr._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(md(e,Zr._jsonSchema))return Zr.fromBase64String(e.bytes)}}Zr._jsonSchemaVersion="firestore/bytes/1.0",Zr._jsonSchema={type:Sn("string",Zr._jsonSchemaVersion),bytes:Sn("string")};class vd{constructor(...e){for(let n=0;n<e.length;++n)if(e[n].length===0)throw new Le(Ie.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new $n(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class xd{constructor(e){this._methodName=e}}class Gs{constructor(e,n){if(!isFinite(e)||e<-90||e>90)throw new Le(Ie.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(n)||n<-180||n>180)throw new Le(Ie.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=e,this._long=n}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return gt(this._lat,e._lat)||gt(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Gs._jsonSchemaVersion}}static fromJSON(e){if(md(e,Gs._jsonSchema))return new Gs(e.latitude,e.longitude)}}Gs._jsonSchemaVersion="firestore/geoPoint/1.0",Gs._jsonSchema={type:Sn("string",Gs._jsonSchemaVersion),latitude:Sn("number"),longitude:Sn("number")};class Ws{constructor(e){this._values=(e||[]).map((n=>n))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(r,i){if(r.length!==i.length)return!1;for(let o=0;o<r.length;++o)if(r[o]!==i[o])return!1;return!0})(this._values,e._values)}toJSON(){return{type:Ws._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(md(e,Ws._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every((n=>typeof n=="number")))return new Ws(e.vectorValues);throw new Le(Ie.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Ws._jsonSchemaVersion="firestore/vectorValue/1.0",Ws._jsonSchema={type:Sn("string",Ws._jsonSchemaVersion),vectorValues:Sn("object")};const R6=/^__.*__$/;class I6{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return this.fieldMask!==null?new Qa(e,this.data,this.fieldMask,n,this.fieldTransforms):new gd(e,this.data,n,this.fieldTransforms)}}class bT{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return new Qa(e,this.data,this.fieldMask,n,this.fieldTransforms)}}function vT(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Ze(40011,{Ac:t})}}class _m{constructor(e,n,r,i,o,l){this.settings=e,this.databaseId=n,this.serializer=r,this.ignoreUndefinedProperties=i,o===void 0&&this.Rc(),this.fieldTransforms=o||[],this.fieldMask=l||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new _m({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){const n=this.path?.child(e),r=this.Vc({path:n,fc:!1});return r.gc(e),r}yc(e){const n=this.path?.child(e),r=this.Vc({path:n,fc:!1});return r.Rc(),r}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return Ff(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find((n=>e.isPrefixOf(n)))!==void 0||this.fieldTransforms.find((n=>e.isPrefixOf(n.field)))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(vT(this.Ac)&&R6.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class D6{constructor(e,n,r){this.databaseId=e,this.ignoreUndefinedProperties=n,this.serializer=r||fm(e)}Cc(e,n,r,i=!1){return new _m({Ac:e,methodName:n,Dc:r,path:$n.emptyPath(),fc:!1,bc:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function bm(t){const e=t._freezeSettings(),n=fm(t._databaseId);return new D6(t._databaseId,!!e.ignoreUndefinedProperties,n)}function xT(t,e,n,r,i,o={}){const l=t.Cc(o.merge||o.mergeFields?2:0,e,n,i);$0("Data must be an object, but it was:",l,r);const u=CT(r,l);let h,f;if(o.merge)h=new kr(l.fieldMask),f=l.fieldTransforms;else if(o.mergeFields){const p=[];for(const g of o.mergeFields){const b=Vy(e,g,n);if(!l.contains(b))throw new Le(Ie.INVALID_ARGUMENT,`Field '${b}' is specified in your field mask but missing from your input data.`);AT(p,b)||p.push(b)}h=new kr(p),f=l.fieldTransforms.filter((g=>h.covers(g.field)))}else h=null,f=l.fieldTransforms;return new I6(new br(u),h,f)}class wd extends xd{_toFieldTransform(e){if(e.Ac!==2)throw e.Ac===1?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof wd}}function wT(t,e,n){return new _m({Ac:3,Dc:e.settings.Dc,methodName:t._methodName,fc:n},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class F0 extends xd{constructor(e,n){super(e),this.vc=n}_toFieldTransform(e){const n=wT(this,e,!0),r=this.vc.map((o=>Yo(o,n))),i=new oc(r);return new kC(e.path,i)}isEqual(e){return e instanceof F0&&Ri(this.vc,e.vc)}}class V0 extends xd{constructor(e,n){super(e),this.vc=n}_toFieldTransform(e){const n=wT(this,e,!0),r=this.vc.map((o=>Yo(o,n))),i=new lc(r);return new kC(e.path,i)}isEqual(e){return e instanceof V0&&Ri(this.vc,e.vc)}}function ST(t,e,n,r){const i=t.Cc(1,e,n);$0("Data must be an object, but it was:",i,r);const o=[],l=br.empty();Wa(r,((h,f)=>{const p=q0(e,h,n);f=En(f);const g=i.yc(p);if(f instanceof wd)o.push(p);else{const b=Yo(f,g);b!=null&&(o.push(p),l.set(p,b))}}));const u=new kr(o);return new bT(l,u,i.fieldTransforms)}function ET(t,e,n,r,i,o){const l=t.Cc(1,e,n),u=[Vy(e,r,n)],h=[i];if(o.length%2!=0)throw new Le(Ie.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let b=0;b<o.length;b+=2)u.push(Vy(e,o[b])),h.push(o[b+1]);const f=[],p=br.empty();for(let b=u.length-1;b>=0;--b)if(!AT(f,u[b])){const _=u[b];let w=h[b];w=En(w);const x=l.yc(_);if(w instanceof wd)f.push(_);else{const S=Yo(w,x);S!=null&&(f.push(_),p.set(_,S))}}const g=new kr(f);return new bT(p,g,l.fieldTransforms)}function k6(t,e,n,r=!1){return Yo(n,t.Cc(r?4:3,e))}function Yo(t,e){if(TT(t=En(t)))return $0("Unsupported field value:",e,t),CT(t,e);if(t instanceof xd)return(function(r,i){if(!vT(i.Ac))throw i.Sc(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Sc(`${r._methodName}() is not currently supported inside arrays`);const o=r._toFieldTransform(i);o&&i.fieldTransforms.push(o)})(t,e),null;if(t===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return(function(r,i){const o=[];let l=0;for(const u of r){let h=Yo(u,i.wc(l));h==null&&(h={nullValue:"NULL_VALUE"}),o.push(h),l++}return{arrayValue:{values:o}}})(t,e)}return(function(r,i){if((r=En(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return vO(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const o=Wt.fromDate(r);return{timestampValue:Bf(i.serializer,o)}}if(r instanceof Wt){const o=new Wt(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Bf(i.serializer,o)}}if(r instanceof Gs)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Zr)return{bytesValue:zC(i.serializer,r._byteString)};if(r instanceof dn){const o=i.databaseId,l=r.firestore._databaseId;if(!l.isEqual(o))throw i.Sc(`Document reference is for database ${l.projectId}/${l.database} but should be for database ${o.projectId}/${o.database}`);return{referenceValue:A0(r.firestore._databaseId||i.databaseId,r._key.path)}}if(r instanceof Ws)return(function(l,u){return{mapValue:{fields:{[hC]:{stringValue:fC},[kf]:{arrayValue:{values:l.toArray().map((f=>{if(typeof f!="number")throw u.Sc("VectorValues must only contain numeric values.");return E0(u.serializer,f)}))}}}}}})(r,i);throw i.Sc(`Unsupported field value: ${rm(r)}`)})(t,e)}function CT(t,e){const n={};return aC(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Wa(t,((r,i)=>{const o=Yo(i,e.mc(r));o!=null&&(n[r]=o)})),{mapValue:{fields:n}}}function TT(t){return!(typeof t!="object"||t===null||t instanceof Array||t instanceof Date||t instanceof Wt||t instanceof Gs||t instanceof Zr||t instanceof dn||t instanceof xd||t instanceof Ws)}function $0(t,e,n){if(!TT(n)||!sC(n)){const r=rm(n);throw r==="an object"?e.Sc(t+" a custom object"):e.Sc(t+" "+r)}}function Vy(t,e,n){if((e=En(e))instanceof vd)return e._internalPath;if(typeof e=="string")return q0(t,e);throw Ff("Field path arguments must be of type string or ",t,!1,void 0,n)}const M6=new RegExp("[~\\*/\\[\\]]");function q0(t,e,n){if(e.search(M6)>=0)throw Ff(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new vd(...e.split("."))._internalPath}catch{throw Ff(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function Ff(t,e,n,r,i){const o=r&&!r.isEmpty(),l=i!==void 0;let u=`Function ${e}() called with invalid data`;n&&(u+=" (via `toFirestore()`)"),u+=". ";let h="";return(o||l)&&(h+=" (found",o&&(h+=` in field ${r}`),l&&(h+=` in document ${i}`),h+=")"),new Le(Ie.INVALID_ARGUMENT,u+t+h)}function AT(t,e){return t.some((n=>n.isEqual(e)))}class jT{constructor(e,n,r,i,o){this._firestore=e,this._userDataWriter=n,this._key=r,this._document=i,this._converter=o}get id(){return this._key.path.lastSegment()}get ref(){return new dn(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new O6(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const n=this._document.data.field(H0("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n)}}}class O6 extends jT{data(){return super.data()}}function H0(t,e){return typeof e=="string"?q0(t,e):e instanceof vd?e._internalPath:e._delegate._internalPath}function N6(t){if(t.limitType==="L"&&t.explicitOrderBy.length===0)throw new Le(Ie.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class G0{}class P6 extends G0{}function B6(t,e,...n){let r=[];e instanceof G0&&r.push(e),r=r.concat(n),(function(o){const l=o.filter((h=>h instanceof W0)).length,u=o.filter((h=>h instanceof vm)).length;if(l>1||l>0&&u>0)throw new Le(Ie.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")})(r);for(const i of r)t=i._apply(t);return t}class vm extends P6{constructor(e,n,r){super(),this._field=e,this._op=n,this._value=r,this.type="where"}static _create(e,n,r){return new vm(e,n,r)}_apply(e){const n=this._parse(e);return RT(e._query,n),new Ec(e.firestore,e.converter,Dy(e._query,n))}_parse(e){const n=bm(e.firestore);return(function(o,l,u,h,f,p,g){let b;if(f.isKeyField()){if(p==="array-contains"||p==="array-contains-any")throw new Le(Ie.INVALID_ARGUMENT,`Invalid Query. You can't perform '${p}' queries on documentId().`);if(p==="in"||p==="not-in"){US(g,p);const w=[];for(const x of g)w.push(LS(h,o,x));b={arrayValue:{values:w}}}else b=LS(h,o,g)}else p!=="in"&&p!=="not-in"&&p!=="array-contains-any"||US(g,p),b=k6(u,l,g,p==="in"||p==="not-in");return wn.create(f,p,b)})(e._query,"where",n,e.firestore._databaseId,this._field,this._op,this._value)}}function z6(t,e,n){const r=e,i=H0("where",t);return vm._create(i,r,n)}class W0 extends G0{constructor(e,n){super(),this.type=e,this._queryConstraints=n}static _create(e,n){return new W0(e,n)}_parse(e){const n=this._queryConstraints.map((r=>r._parse(e))).filter((r=>r.getFilters().length>0));return n.length===1?n[0]:gs.create(n,this._getOperator())}_apply(e){const n=this._parse(e);return n.getFilters().length===0?e:((function(i,o){let l=i;const u=o.getFlattenedFilters();for(const h of u)RT(l,h),l=Dy(l,h)})(e._query,n),new Ec(e.firestore,e.converter,Dy(e._query,n)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function LS(t,e,n){if(typeof(n=En(n))=="string"){if(n==="")throw new Le(Ie.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!xC(e)&&n.indexOf("/")!==-1)throw new Le(Ie.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=e.path.child($t.fromString(n));if(!We.isDocumentKey(r))throw new Le(Ie.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return nS(t,new We(r))}if(n instanceof dn)return nS(t,n._key);throw new Le(Ie.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${rm(n)}.`)}function US(t,e){if(!Array.isArray(t)||t.length===0)throw new Le(Ie.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function RT(t,e){const n=(function(i,o){for(const l of i)for(const u of l.getFlattenedFilters())if(o.indexOf(u.op)>=0)return u.op;return null})(t.filters,(function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(e.op));if(n!==null)throw n===e.op?new Le(Ie.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new Le(Ie.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}class L6{convertValue(e,n="none"){switch(La(e)){case 0:return null;case 1:return e.booleanValue;case 2:return un(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,n);case 5:return e.stringValue;case 6:return this.convertBytes(za(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,n);case 11:return this.convertObject(e.mapValue,n);case 10:return this.convertVectorValue(e.mapValue);default:throw Ze(62114,{value:e})}}convertObject(e,n){return this.convertObjectMap(e.fields,n)}convertObjectMap(e,n="none"){const r={};return Wa(e,((i,o)=>{r[i]=this.convertValue(o,n)})),r}convertVectorValue(e){const n=e.fields?.[kf].arrayValue?.values?.map((r=>un(r.doubleValue)));return new Ws(n)}convertGeoPoint(e){return new Gs(un(e.latitude),un(e.longitude))}convertArray(e,n){return(e.values||[]).map((r=>this.convertValue(r,n)))}convertServerTimestamp(e,n){switch(n){case"previous":const r=am(e);return r==null?null:this.convertValue(r,n);case"estimate":return this.convertTimestamp(Xu(e));default:return null}}convertTimestamp(e){const n=Ba(e);return new Wt(n.seconds,n.nanos)}convertDocumentKey(e,n){const r=$t.fromString(e);jt(qC(r),9688,{name:e});const i=new Zu(r.get(1),r.get(3)),o=new We(r.popFirst(5));return i.isEqual(n)||ki(`Document ${o} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${n.projectId}/${n.database}) instead.`),o}}function IT(t,e,n){let r;return r=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,r}class Bu{constructor(e,n){this.hasPendingWrites=e,this.fromCache=n}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Po extends jT{constructor(e,n,r,i,o,l){super(e,n,r,i,l),this._firestore=e,this._firestoreImpl=e,this.metadata=o}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const n=new _f(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(n,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,n={}){if(this._document){const r=this._document.data.field(H0("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,n.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new Le(Ie.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,n={};return n.type=Po._jsonSchemaVersion,n.bundle="",n.bundleSource="DocumentSnapshot",n.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?n:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),n.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),n)}}Po._jsonSchemaVersion="firestore/documentSnapshot/1.0",Po._jsonSchema={type:Sn("string",Po._jsonSchemaVersion),bundleSource:Sn("string","DocumentSnapshot"),bundleName:Sn("string"),bundle:Sn("string")};class _f extends Po{data(e={}){return super.data(e)}}class ec{constructor(e,n,r,i){this._firestore=e,this._userDataWriter=n,this._snapshot=i,this.metadata=new Bu(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){const e=[];return this.forEach((n=>e.push(n))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,n){this._snapshot.docs.forEach((r=>{e.call(n,new _f(this._firestore,this._userDataWriter,r.key,r,new Bu(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const n=!!e.includeMetadataChanges;if(n&&this._snapshot.excludesMetadataChanges)throw new Le(Ie.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===n||(this._cachedChanges=(function(i,o){if(i._snapshot.oldDocs.isEmpty()){let l=0;return i._snapshot.docChanges.map((u=>{const h=new _f(i._firestore,i._userDataWriter,u.doc.key,u.doc,new Bu(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter);return u.doc,{type:"added",doc:h,oldIndex:-1,newIndex:l++}}))}{let l=i._snapshot.oldDocs;return i._snapshot.docChanges.filter((u=>o||u.type!==3)).map((u=>{const h=new _f(i._firestore,i._userDataWriter,u.doc.key,u.doc,new Bu(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter);let f=-1,p=-1;return u.type!==0&&(f=l.indexOf(u.doc.key),l=l.delete(u.doc.key)),u.type!==1&&(l=l.add(u.doc),p=l.indexOf(u.doc.key)),{type:U6(u.type),doc:h,oldIndex:f,newIndex:p}}))}})(this,n),this._cachedChangesIncludeMetadataChanges=n),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new Le(Ie.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=ec._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=y0.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const n=[],r=[],i=[];return this.docs.forEach((o=>{o._document!==null&&(n.push(o._document),r.push(this._userDataWriter.convertObjectMap(o._document.data.value.mapValue.fields,"previous")),i.push(o.ref.path))})),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function U6(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Ze(61501,{type:t})}}function F6(t){t=ps(t,dn);const e=ps(t.firestore,Ko);return S6(ym(e),t._key).then((n=>G6(e,t,n)))}ec._jsonSchemaVersion="firestore/querySnapshot/1.0",ec._jsonSchema={type:Sn("string",ec._jsonSchemaVersion),bundleSource:Sn("string","QuerySnapshot"),bundleName:Sn("string"),bundle:Sn("string")};class DT extends L6{constructor(e){super(),this.firestore=e}convertBytes(e){return new Zr(e)}convertReference(e){const n=this.convertDocumentKey(e,this.firestore._databaseId);return new dn(this.firestore,null,n)}}function V6(t){t=ps(t,Ec);const e=ps(t.firestore,Ko),n=ym(e),r=new DT(e);return N6(t._query),E6(n,t._query).then((i=>new ec(e,r,t,i)))}function $6(t,e,n){t=ps(t,dn);const r=ps(t.firestore,Ko),i=IT(t.converter,e,n);return xm(r,[xT(bm(r),"setDoc",t._key,i,t.converter!==null,n).toMutation(t._key,vr.none())])}function q6(t,e,n,...r){t=ps(t,dn);const i=ps(t.firestore,Ko),o=bm(i);let l;return l=typeof(e=En(e))=="string"||e instanceof vd?ET(o,"updateDoc",t._key,e,n,r):ST(o,"updateDoc",t._key,e),xm(i,[l.toMutation(t._key,vr.exists(!0))])}function H6(t){return xm(ps(t.firestore,Ko),[new dm(t._key,vr.none())])}function xm(t,e){return(function(r,i){const o=new Ti;return r.asyncQueue.enqueueAndForget((async()=>d6(await w6(r),i,o))),o.promise})(ym(t),e)}function G6(t,e,n){const r=n.docs.get(e._key),i=new DT(t);return new Po(t,i,e._key,r,new Bu(n.hasPendingWrites,n.fromCache),e.converter)}class W6{constructor(e,n){this._firestore=e,this._commitHandler=n,this._mutations=[],this._committed=!1,this._dataReader=bm(e)}set(e,n,r){this._verifyNotCommitted();const i=Zg(e,this._firestore),o=IT(i.converter,n,r),l=xT(this._dataReader,"WriteBatch.set",i._key,o,i.converter!==null,r);return this._mutations.push(l.toMutation(i._key,vr.none())),this}update(e,n,r,...i){this._verifyNotCommitted();const o=Zg(e,this._firestore);let l;return l=typeof(n=En(n))=="string"||n instanceof vd?ET(this._dataReader,"WriteBatch.update",o._key,n,r,i):ST(this._dataReader,"WriteBatch.update",o._key,n),this._mutations.push(l.toMutation(o._key,vr.exists(!0))),this}delete(e){this._verifyNotCommitted();const n=Zg(e,this._firestore);return this._mutations=this._mutations.concat(new dm(n._key,vr.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new Le(Ie.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Zg(t,e){if((t=En(t)).firestore!==e)throw new Le(Ie.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}function Q0(){return new wd("deleteField")}function ed(...t){return new F0("arrayUnion",t)}function FS(...t){return new V0("arrayRemove",t)}function kT(t){return ym(t=ps(t,Ko)),new W6(t,(e=>xm(t,e)))}(function(e,n=!0){(function(i){vc=i})(gc),tc(new zo("firestore",((r,{instanceIdentifier:i,options:o})=>{const l=r.getProvider("app").getImmediate(),u=new Ko(new kM(r.getProvider("auth-internal")),new NM(l,r.getProvider("app-check-internal")),(function(f,p){if(!Object.prototype.hasOwnProperty.apply(f.options,["projectId"]))throw new Le(Ie.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Zu(f.options.projectId,p)})(l,i),l);return o={useFetchStreams:n,...o},u._setSettings(o),u}),"PUBLIC").setMultipleInstances(!0)),Ra($w,qw,e),Ra($w,qw,"esm2020")})();function Xo(){return A6(BE)}const an={showGroupTotals:!1};function Zo(t,e,n,r=1,i,o){let l=e;if(e.startsWith("budgets/"))l="budgets";else if(e.startsWith("months/")){const p=e.replace("months/","").split("_");if(p.length>=2){const g=p[p.length-1];l=`months/${p[p.length-2]}/${g}`}}console.log(`[Firebase] ${t}(${r}): ${l}${i===!1?" [NOT FOUND]":""}`)}async function At(t,e,n){const r=Cc(Xo(),t,e),i=`${t}/${e}`,o=await F6(r),l=o.exists(),u=l?o.data():null;return Zo("READ",i,n,1,l),{exists:l,data:u,ref:r}}async function ur(t,e,n){const r=Xo(),i=T6(r,t);let o;if(n&&n.length>0){const f=n.map(p=>z6(p.field,p.op,p.value));o=B6(i,...f)}else o=i;const l=await V6(o),u=l.docs.map(f=>({id:f.id,data:f.data()}));let h=t;if(n&&n.length>0){const f=n.map(p=>`${p.field} ${p.op} ${JSON.stringify(p.value)}`).join(", ");h+=` WHERE ${f}`}return Zo("QUERY",h,e,l.docs.length,void 0),{docs:u}}async function Nr(t,e,n,r,i){const o=Cc(Xo(),t,e),l=`${t}/${e}`;return Zo("WRITE",l,r,1,void 0),$6(o,n,i??{})}async function K0(t,e){const r=Xo();for(let i=0;i<t.length;i+=500){const o=t.slice(i,i+500),l=kT(r);for(const{collectionPath:u,docId:h,data:f}of o){const p=Cc(r,u,h);l.set(p,f)}Zo("BATCH_WRITE",`${o.length} docs`,e,o.length,void 0);try{await l.commit()}catch(u){throw console.error(`[Firebase] BATCH_WRITE ERROR in ${e}:`,u),console.error("[Firebase] Failed batch details:",{batchIndex:Math.floor(i/500)+1,totalBatches:Math.ceil(t.length/500),docsInBatch:o.length,firstDoc:o[0]?`${o[0].collectionPath}/${o[0].docId}`:"none"}),u}}}async function Oi(t,e,n,r){const i=Cc(Xo(),t,e),o=`${t}/${e}`;return Zo("UPDATE",o,r,1,void 0),q6(i,n)}async function $y(t,e,n){const r=Cc(Xo(),t,e),i=`${t}/${e}`;return Zo("DELETE",i),H6(r)}async function MT(t,e,n){const i=Xo();for(let o=0;o<t.length;o+=500){const l=t.slice(o,o+500),u=kT(i);for(const{collectionPath:h,docId:f}of l){const p=Cc(i,h,f);u.delete(p)}Zo("BATCH_DELETE",`${l.length} docs`,e,l.length),await u.commit(),n?.(o+l.length)}}const Do={mobile:640,tablet:768,wide:1200},Q6=Do.mobile,yi={primary:"--color-primary",error:"--color-error",errorBg:"--color-error-bg",errorBorder:"--color-error-border",success:"--color-success",warning:"--color-warning",danger:"--color-danger",debt:"--color-debt",zero:"--color-zero"},Vf=["January","February","March","April","May","June","July","August","September","October","November","December"],Ai=3,Y0=3,Vt="ungrouped_accounts",Xt="ungrouped_categories";function K6(t={}){const e={};return Object.entries(t).forEach(([n,r])=>{e[n]={nickname:r.nickname??"",description:r.description??"",balance:0,account_group_id:r.account_group_id??Vt,sort_order:r.sort_order??0,is_income_account:r.is_income_account??!1,is_income_default:r.is_income_default??!1,is_outgo_account:r.is_outgo_account??!1,is_outgo_default:r.is_outgo_default??!1,on_budget:r.on_budget??!0,is_active:r.is_active??!0}}),e}function Y6(t={}){const e={};return Object.entries(t).forEach(([n,r])=>{e[n]={name:r.name,sort_order:r.sort_order??0,expected_balance:r.expected_balance??"positive",on_budget:r.on_budget!==void 0?r.on_budget:null,is_active:r.is_active!==void 0?r.is_active:null}}),e[Vt]||(e[Vt]={name:"Ungrouped",sort_order:0,expected_balance:"positive",on_budget:null,is_active:null}),e}function X6(t={}){const e={};return Object.entries(t).forEach(([n,r])=>{e[n]={name:r.name,description:r.description,category_group_id:r.category_group_id??Xt,sort_order:r.sort_order??0,default_monthly_amount:r.default_monthly_amount,default_monthly_type:r.default_monthly_type,balance:0,is_hidden:r.is_hidden??!1}}),e}function Z6(t=[]){const e=t.map(r=>({id:r.id,name:r.name,sort_order:r.sort_order??0}));if(!e.some(r=>r.id===Xt)){const r=e.length>0?Math.max(...e.map(i=>i.sort_order)):-1;e.push({id:Xt,name:"Uncategorized",sort_order:r+1})}return e.sort((r,i)=>r.sort_order-i.sort_order),e}function J6(t={}){const e={};return Object.keys(t).forEach(n=>{e[n]={}}),e}async function X0(t){const{exists:e,data:n}=await At("budgets",t,"loading budget data (cache miss or stale)");if(!e||!n)throw new Error(`Budget ${t} not found`);const r=K6(n.accounts),i=Y6(n.account_groups),o=X6(n.categories),l=Z6(n.category_groups),u=J6(n.month_map);return{budget:{id:t,name:n.name,user_ids:n.user_ids||[],accepted_user_ids:n.accepted_user_ids||[],owner_id:n.owner_id||n.user_ids?.[0]||"",owner_email:n.owner_email||"",accounts:r,account_groups:i,categories:o,category_groups:l,month_map:u,percentage_income_months_back:n.percentage_income_months_back},accounts:r,accountGroups:i,categories:o,categoryGroups:l,monthMap:u}}async function $f(t,e){return e.fetchQuery({queryKey:Ce.budget(t),queryFn:()=>X0(t),staleTime:fs})}function eP(t,e){const{initialDataLoadComplete:n}=Ye(),r=!!t&&e?.enabled!==!1&&n;return Go({queryKey:t?Ce.budget(t):["budget","none"],queryFn:()=>X0(t),enabled:r,staleTime:fs})}function Qs(t,e,n){const r=n.toString().padStart(2,"0");return`${t}_${e}_${r}`}function Tc(t,e){return e===1?{year:t-1,month:12}:{year:t,month:e-1}}function wm(t,e,n){if(n<1)return null;let r=t,i=e;for(let o=0;o<n;o++)i===1?(r-=1,i=12):i-=1;return{year:r,month:i}}function Bo(t,e){return e===12?{year:t+1,month:1}:{year:t,month:e+1}}function Qe(t,e){return`${t}${e.toString().padStart(2,"0")}`}function qy(t){return new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit"})}function Sm(t,e){const n=new Date,r=n.getFullYear(),i=n.getMonth()+1;if(t===r&&e===i){const o=n.getDate();return`${r}-${String(i).padStart(2,"0")}-${String(o).padStart(2,"0")}`}return`${t}-${String(e).padStart(2,"0")}-01`}function Em(t){const[e,n]=t.split("-").map(Number);return{year:e,month:n}}function je(t){return Math.round((t+Number.EPSILON)*100)/100}function ht(t){if(t==null||isNaN(t))return!1;const e=t*100;return Math.abs(e-Math.round(e))>1e-9}function Va(t){if(t==null)return t;if(Array.isArray(t))return t.map(e=>Va(e));if(typeof t=="object"){const e={};for(const[n,r]of Object.entries(t))r!==void 0&&(e[n]=Va(r));return e}return t}const Zt="__NO_CATEGORY__",qo="No Category";function ct(t){return t===Zt}const Gt="__NO_ACCOUNT__",$a="No Account";function rt(t){return t===Gt}function OT(t,e){return je(e.filter(n=>n.category_id===t).reduce((n,r)=>n+r.amount,0))}function NT(t,e){let n=0;for(const r of e)r.from_category_id===t&&!ct(r.from_category_id)&&(n-=r.amount),r.to_category_id===t&&!ct(r.to_category_id)&&(n+=r.amount);return je(n)}function PT(t,e){return je(e.filter(n=>n.category_id===t&&!ct(n.category_id)).reduce((n,r)=>n+r.amount,0))}function BT(t,e,n){const r={},i={},o={};for(const l of t)ct(l.category_id)||(r[l.category_id]=(r[l.category_id]||0)+l.amount);for(const l of e)ct(l.from_category_id)||(i[l.from_category_id]=(i[l.from_category_id]||0)-l.amount),ct(l.to_category_id)||(i[l.to_category_id]=(i[l.to_category_id]||0)+l.amount);for(const l of n)ct(l.category_id)||(o[l.category_id]=(o[l.category_id]||0)+l.amount);for(const l of Object.keys(r))r[l]=je(r[l]);for(const l of Object.keys(i))i[l]=je(i[l]);for(const l of Object.keys(o))o[l]=je(o[l]);return{spentMap:r,transfersMap:i,adjustmentsMap:o}}function zT(t,e,n,r){const i=OT(t.category_id,e),o=NT(t.category_id,n),l=PT(t.category_id,r),u=je(t.start_balance+t.allocated+i+o+l);return{...t,spent:i,transfers:o,adjustments:l,end_balance:u}}function LT(t,e,n,r){return t.map(i=>zT(i,e,n,r))}const tP=Object.freeze(Object.defineProperty({__proto__:null,calculateCategoryBalance:zT,calculateCategoryBalances:LT},Symbol.toStringTag,{value:"Module"}));function nP(t,e){return je(e.filter(n=>n.account_id===t).reduce((n,r)=>n+r.amount,0))}function rP(t,e){return je(e.filter(n=>n.account_id===t).reduce((n,r)=>n+r.amount,0))}function sP(t,e){let n=0;for(const r of e)r.from_account_id===t&&!rt(r.from_account_id)&&(n-=r.amount),r.to_account_id===t&&!rt(r.to_account_id)&&(n+=r.amount);return je(n)}function iP(t,e){return je(e.filter(n=>n.account_id===t&&!rt(n.account_id)).reduce((n,r)=>n+r.amount,0))}function aP(t,e,n,r,i){const o=nP(t.account_id,e),l=rP(t.account_id,n),u=sP(t.account_id,r),h=iP(t.account_id,i),f=je(o+l+u+h),p=je(t.start_balance+f);return{...t,income:o,expenses:l,transfers:u,adjustments:h,net_change:f,end_balance:p}}function oP(t,e,n,r,i){return t.map(o=>aP(o,e,n,r,i))}function Cm(){const t=new Date,e=t.getFullYear(),n=t.getMonth()+1;let r=e,i=n-Y0;for(;i<1;)i+=12,r-=1;return{year:r,month:i}}function Z0(t,e){const n=Cm(),r=Qe(t,e),i=Qe(n.year,n.month);return r<=i}function lP(t,e,n,r){if("spent"in t&&"transfers"in t&&"adjustments"in t&&"end_balance"in t)return t;const[i]=LT([t],e,n,r);return i}function cP(t,e,n,r,i){if("income"in t&&"expenses"in t&&"transfers"in t&&"adjustments"in t&&"net_change"in t&&"end_balance"in t)return t;const[o]=oP([t],e,n,r,i);return o}function uP(t,e,n){const r=Z0(e,n);return{category_id:t.category_id,start_balance:r?je(t.start_balance):0,allocated:je(t.allocated)}}function dP(t,e,n){const r=Z0(e,n);return{account_id:t.account_id,start_balance:r?je(t.start_balance):0}}function Sd(t){const e=t.category_balances.map(r=>lP(r,t.expenses,t.transfers,t.adjustments)),n=t.account_balances.map(r=>cP(r,t.income,t.expenses,t.transfers,t.adjustments));return{...t,category_balances:e,account_balances:n}}function Tm(t){const e=t.category_balances.map(u=>uP(u,t.year,t.month)),n=t.account_balances.map(u=>dP(u,t.year,t.month)),{total_income:r,total_expenses:i,previous_month_income:o,...l}=t;return{...l,category_balances:e,account_balances:n}}async function Am(t,e,n,r,i=1){const o=wm(e,n,i);if(!o)return 0;const{year:l,month:u}=o,h=Ce.month(t,l,u);if(r){const f=r.getQueryData(h);if(f?.month){const p=f.month.income||[];return je(p.reduce((g,b)=>g+(b.amount||0),0))}}try{const f=Qs(t,l,u),{exists:p,data:g}=await At("months",f,`[calculatePreviousMonthIncome] income ${i} month(s) back for ${e}/${n}`);if(p&&g?.income){const b=g.income;return je(b.reduce((_,w)=>_+(w.amount||0),0))}}catch(f){console.warn(`[calculatePreviousMonthIncome] Could not read month ${l}/${u}:`,f)}return 0}async function hP(t,e,n,r,i,o=1){const l=t.income||[],u=t.expenses||[],h=l.reduce((_,w)=>_+(w.amount||0),0),f=u.reduce((_,w)=>_+(w.amount||0),0),g=t.are_allocations_finalized??!1?0:await Am(e,n,r,i,o),b={budget_id:e,year_month_ordinal:t.year_month_ordinal??Qe(n,r),year:t.year??n,month:t.month??r,income:l,total_income:h,previous_month_income:g,expenses:u,total_expenses:f,transfers:t.transfers||[],adjustments:t.adjustments||[],account_balances:t.account_balances||[],category_balances:t.category_balances||[],are_allocations_finalized:t.are_allocations_finalized??!1,created_at:t.created_at,updated_at:t.updated_at};return Sd(b)}async function xr(t,e,n,r){const i=Qs(t,e,n),l=(await $f(t,ze)).budget.percentage_income_months_back??1;return(await ze.fetchQuery({queryKey:Ce.month(t,e,n),queryFn:async()=>{const{exists:h,data:f}=await At("months",i,r?.description??`reading month ${e}/${n}`);return!h||!f?null:{month:await hP(f,t,e,n,ze,l)}},staleTime:fs}))?.month??null}async function fP(t,e,n,r){const i=t.income||[],o=t.expenses||[],l=i.reduce((b,_)=>b+(_.amount||0),0),u=o.reduce((b,_)=>b+(_.amount||0),0),f=(await $f(e,ze)).budget.percentage_income_months_back??1,p=await Am(e,n,r,ze,f),g={budget_id:e,year_month_ordinal:t.year_month_ordinal??Qe(n,r),year:t.year??n,month:t.month??r,income:i,total_income:l,previous_month_income:p,expenses:o,total_expenses:u,transfers:t.transfers||[],adjustments:t.adjustments||[],account_balances:t.account_balances||[],category_balances:t.category_balances||[],are_allocations_finalized:t.are_allocations_finalized??!1,created_at:t.created_at,updated_at:t.updated_at};return Sd(g)}async function mP(t,e,n,r){const i=Qs(t,e,n),o=`PRE-EDIT-READ: ${r}`,{exists:l,data:u}=await At("months",i,o);if(!l||!u)throw new Error(`Month data not found for ${e}/${n}`);return await fP(u,t,e,n)}function pP(t){const e={},n={};return t.category_balances&&t.category_balances.forEach(r=>{e[r.category_id]=r.end_balance}),t.account_balances&&t.account_balances.forEach(r=>{n[r.account_id]=r.end_balance}),{categoryEndBalances:e,accountEndBalances:n}}function UT(){const t=new Date,e=t.getFullYear(),n=t.getMonth()+1,r=[];for(let i=Y0;i>0;i--){let o=e,l=n-i;for(;l<1;)l+=12,o-=1;r.push(Qe(o,l))}r.push(Qe(e,n));for(let i=1;i<=Ai;i++){let o=e,l=n+i;for(;l>12;)l-=12,o+=1;r.push(Qe(o,l))}return r}function gP(t,e){const n=Ce.budget(t),r=ze.getQueryData(n);if(!r?.monthMap||!(e in r.monthMap))return!1;const i=UT();for(const o of i)if(o>=e&&!(o in r.monthMap))return!1;return!0}function yP(t,e,n){const r=Ce.budget(t),i=ze.getQueryData(r);i&&ze.setQueryData(r,{...i,monthMap:n,budget:{...i.budget,month_map:n}})}function _P(t,e){const n=Ce.budget(t),r=ze.getQueryData(n);r&&ze.setQueryData(n,{...r,monthMap:e,budget:{...r.budget,month_map:e}})}function bP(t,e){const n=Ce.budget(t),r=ze.getQueryData(n);r&&ze.setQueryData(n,{...r,monthMap:e,budget:{...r.budget,month_map:e}})}function vP(t,e,n){const r=Qe(e,n),i=Ce.budget(t),o=ze.getQueryData(i);if(!o)return console.warn(`[removeMonthFromMap] Budget ${t} not found in cache`),{};const l=o.monthMap||{},{[r]:u,...h}=l;return ze.setQueryData(i,{...o,monthMap:h,budget:{...o.budget,month_map:h}}),h}async function xP(t,e,n,r){const{bypassDateLimit:i=!1}={},o=new Date,l=o.getFullYear(),u=o.getMonth()+1,h=(e-l)*12+(n-u);if(!i&&h>Ai){const N=`[createMonth] Refusing to create month ${e}/${n} - it's ${h} months in the future (max allowed: ${Ai}). This likely indicates a bug in month navigation.`;throw console.error(N),new Error(N)}const{exists:f,data:p}=await At("budgets",t,"validating budget exists before creating month");if(!f||!p){ze.removeQueries({queryKey:Ce.budget(t)});const N=`[createMonth] Budget ${t} does not exist. It may have been deleted. Please refresh the page.`;throw console.error(N),new Error(N)}const g=o.toISOString(),b=Qs(t,e,n),_=p.percentage_income_months_back??1;let w=0,x={},S={};if(n>1||e>new Date().getFullYear()-10){const{year:N,month:V}=Tc(e,n),$=Qs(t,N,V),A=Ce.month(t,N,V),k=ze.getQueryData(A);let D=null;if(k?.month){const K=k.month;D={budget_id:K.budget_id,year_month_ordinal:K.year_month_ordinal,year:K.year,month:K.month,income:K.income,expenses:K.expenses,transfers:K.transfers,adjustments:K.adjustments,account_balances:K.account_balances,category_balances:K.category_balances,are_allocations_finalized:K.are_allocations_finalized,created_at:K.created_at,updated_at:K.updated_at}}else try{const{exists:K,data:X}=await At("months",$,"fetching previous month to create start balances for new month");K&&(D=X)}catch(K){if(K instanceof Error&&K.message.includes("Missing or insufficient permissions"))console.warn(`[createMonth] Permission error reading previous month ${N}/${V}, starting with zero balances`);else throw K}if(D){const K={year_month_ordinal:D.year_month_ordinal??Qe(N,V),year:D.year??N,month:D.month??V,income:D.income||[],total_income:D.total_income??0,previous_month_income:D.previous_month_income??0,expenses:D.expenses||[],total_expenses:D.total_expenses??0,transfers:D.transfers||[],adjustments:D.adjustments||[],account_balances:D.account_balances||[],category_balances:D.category_balances||[],are_allocations_finalized:D.are_allocations_finalized??!1,created_at:D.created_at,updated_at:D.updated_at};if(_===1)w=K.total_income;else{const te=wm(e,n,_);if(te){const Q=Ce.month(t,te.year,te.month),se=ze.getQueryData(Q);if(se?.month)w=(se.month.income||[]).reduce((B,q)=>B+(q.amount||0),0);else try{const B=Qs(t,te.year,te.month),{exists:q,data:ee}=await At("months",B,"fetching month for percentage income");q&&ee?.income&&(w=ee.income.reduce((ne,le)=>ne+(le.amount||0),0))}catch{}}}const{categoryEndBalances:X,accountEndBalances:G}=pP(K);x=X,S=G}}const C=Z0(e,n),T=Object.entries(x).map(([N,V])=>({category_id:N,start_balance:C?V:0,allocated:0,spent:0,transfers:0,adjustments:0,end_balance:V})),I=Object.entries(S).map(([N,V])=>({account_id:N,start_balance:C?V:0,income:0,expenses:0,transfers:0,adjustments:0,net_change:0,end_balance:V})),M={budget_id:t,year_month_ordinal:Qe(e,n),year:e,month:n,income:[],total_income:0,previous_month_income:w,expenses:[],total_expenses:0,transfers:[],adjustments:[],account_balances:I,category_balances:T,are_allocations_finalized:!1,created_at:g,updated_at:g},U={budget_id:t,year_month_ordinal:Qe(e,n),year:e,month:n,income:[],expenses:[],transfers:[],adjustments:[],account_balances:I,category_balances:T,are_allocations_finalized:!1,created_at:g,updated_at:g};await Nr("months",b,U,"creating new month document (first time viewing this month)"),ze.setQueryData(Ce.month(t,e,n),{month:M});const H=Qe(e,n),P={...p.month_map||{},[H]:{}};return _P(t,P),await Oi("budgets",t,{month_map:P,updated_at:g},`adding month ${e}/${n} to budget month_map`),M}async function wP(t,e,n,r,i,o=1){const l=t.income||[],u=t.expenses||[],h=l.reduce((_,w)=>_+(w.amount||0),0),f=u.reduce((_,w)=>_+(w.amount||0),0),g=t.are_allocations_finalized??!1?0:await Am(e,n,r,i,o),b={budget_id:e,year_month_ordinal:t.year_month_ordinal??Qe(n,r),year:t.year??n,month:t.month??r,income:l,total_income:h,previous_month_income:g,expenses:u,total_expenses:f,transfers:t.transfers||[],adjustments:t.adjustments||[],account_balances:t.account_balances||[],category_balances:t.category_balances||[],are_allocations_finalized:t.are_allocations_finalized??!1,created_at:t.created_at,updated_at:t.updated_at};return Sd(b)}async function J0(t,e,n,r,i=1){const o=Qs(t,e,n);try{const{exists:l,data:u}=await At("months",o,`loading month ${e}/${n}`);return!l||!u?null:await wP(u,t,e,n,r,i)}catch(l){if(l instanceof Error&&l.message.includes("Missing or insufficient permissions"))return console.warn(`[readMonthDirect] Permission error reading month ${e}/${n}, treating as not found`),null;throw l}}async function SP(t,e,n,r){if(r){const h=Ce.month(t,e,n),f=r.getQueryData(h);if(f?.month){if(!f.month.are_allocations_finalized){const g=(await $f(t,r)).budget.percentage_income_months_back??1,b=await Am(t,e,n,r,g);return{...f.month,previous_month_income:b}}return f.month}}const i=r?await $f(t,r):null,o=i?.budget.percentage_income_months_back??1,l=await J0(t,e,n,r,o);if(l)return l;let u=!1;if(r&&i)i.monthMap&&(u=Qe(e,n)in i.monthMap);else{const{exists:h,data:f}=await At("budgets",t,"checking month_map before creating month");if(h&&f?.month_map){const p=Qe(e,n),g=f.month_map;u=p in g}}if(u)return xP(t,e,n);throw new Error(`Month ${e}/${n} does not exist in budget. Cannot create months that are not in month_map.`)}function EP(t,e,n,r){const i=Rt(),{initialDataLoadComplete:o}=Ye(),l=t?Ce.month(t,e,n):["month","none"],u=!!t&&r?.enabled!==!1&&o;return Go({queryKey:l,queryFn:async()=>({month:await SP(t,e,n,i)}),enabled:u,staleTime:fs})}async function FT(t){const{exists:e,data:n}=await At("payees",t,"loading payees for autocomplete (cache miss or stale)");return e&&n?n.payees||[]:[]}function e_(t,e){const{initialDataLoadComplete:n}=Ye(),r=!!t&&e?.enabled!==!1&&n;return Go({queryKey:t?Ce.payees(t):["payees","none"],queryFn:()=>FT(t),enabled:r,staleTime:fs})}async function CP(t,e){const{exists:n,data:r}=await At("users",t,"loading user profile (cache miss or stale)");if(n&&r)return r;const i={uid:t,email:e,budget_ids:[],created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return await Nr("users",t,i,"creating new user document (first login)"),i}function VT(t,e,n){return Go({queryKey:t?Ce.user(t):["user","none"],queryFn:()=>CP(t,e),enabled:!!t&&n?.enabled!==!1})}async function TP(t,e){const n=await ur("budgets","loading budgets user has access to (cache miss or stale)",[{field:"user_ids",op:"array-contains",value:t}]),r=[],i=[];for(const o of n.docs){const l=o.data;l.accepted_user_ids?.includes(t)||e?.budget_ids?.includes(o.id)?r.push({id:o.id,name:l.name||"Unnamed Budget",ownerEmail:l.owner_email||null,isOwner:l.owner_id===t,isPending:!1}):i.push({budgetId:o.id,budgetName:l.name||"Unnamed Budget",ownerEmail:l.owner_email||null})}return{budgets:r,pendingInvites:i}}function AP(t,e,n){return Go({queryKey:t?Ce.accessibleBudgets(t):["accessibleBudgets","none"],queryFn:async()=>t?TP(t,e):{budgets:[],pendingInvites:[]},enabled:!!t&&n?.enabled!==!1,staleTime:60*1e3})}function jP(t){if(Array.isArray(t))return t;if(t&&typeof t=="object"&&!Array.isArray(t)){const e=t;if(e._methodName==="arrayUnion"&&Array.isArray(e.vc))return console.warn("[fetchFeedback] Found corrupted arrayUnion in feedback document - extracting items from vc"),e.vc}return[]}async function RP(){const t=await ur("feedback","admin loading all feedback (cache miss or stale)"),e=[];for(const n of t.docs){const r=jP(n.data.items),i=n.data.user_email||n.id;r.forEach(o=>{e.push({...o,doc_id:n.id,user_email:i})})}return{items:e}}function IP(t){return Go({queryKey:Ce.feedback(),queryFn:RP,enabled:t?.enabled!==!1})}const DP="modulepreload",kP=function(t){return"/"+t},VS={},td=function(e,n,r){let i=Promise.resolve();if(n&&n.length>0){let f=function(p){return Promise.all(p.map(g=>Promise.resolve(g).then(b=>({status:"fulfilled",value:b}),b=>({status:"rejected",reason:b}))))};var l=f;document.getElementsByTagName("link");const u=document.querySelector("meta[property=csp-nonce]"),h=u?.nonce||u?.getAttribute("nonce");i=f(n.map(p=>{if(p=kP(p),p in VS)return;VS[p]=!0;const g=p.endsWith(".css"),b=g?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${p}"]${b}`))return;const _=document.createElement("link");if(_.rel=g?"stylesheet":DP,g||(_.as="script"),_.crossOrigin="",_.href=p,h&&_.setAttribute("nonce",h),document.head.appendChild(_),g)return new Promise((w,x)=>{_.addEventListener("load",w),_.addEventListener("error",()=>x(new Error(`Unable to preload CSS for ${p}`)))})}))}function o(u){const h=new Event("vite:preloadError",{cancelable:!0});if(h.payload=u,window.dispatchEvent(h),!h.defaultPrevented)throw u}return i.then(u=>{for(const h of u||[])h.status==="rejected"&&o(h.reason);return e().catch(o)})},Oa={categoryEndBalances:{},accountEndBalances:{},totalIncome:0};function Ed(t,e,n){const r=t.income||[],i=t.expenses||[],o=je(r.reduce((_,w)=>_+w.amount,0)),l=je(i.reduce((_,w)=>_+w.amount,0)),{spentMap:u,transfersMap:h,adjustmentsMap:f}=BT(i,t.transfers||[],t.adjustments||[]),p=MP(t.category_balances,e.categoryEndBalances,h,f,u),g=OP(t,e.accountEndBalances),b=n!==void 0?n:e.totalIncome;return{...t,total_income:o,total_expenses:l,previous_month_income:b,category_balances:p,account_balances:g,updated_at:new Date().toISOString()}}function MP(t,e,n,r,i){const o=new Map;for(const h of t)ct(h.category_id)||o.set(h.category_id,h);const l=new Set;for(const h of t)ct(h.category_id)||l.add(h.category_id);for(const h of Object.keys(e))ct(h)||l.add(h);for(const h of Object.keys(n))ct(h)||l.add(h);for(const h of Object.keys(r))ct(h)||l.add(h);const u=[];for(const h of l){const f=o.get(h),p=je(e[h]??0),g=je(f?.allocated??0),b=je(i[h]??0),_=je(n[h]??0),w=je(r[h]??0);u.push({category_id:h,start_balance:p,allocated:g,spent:b,transfers:_,adjustments:w,end_balance:je(p+g+b+_+w)})}return u}function OP(t,e){const n=new Set;for(const i of t.income||[])rt(i.account_id)||n.add(i.account_id);for(const i of t.expenses||[])rt(i.account_id)||n.add(i.account_id);for(const i of t.transfers||[])rt(i.from_account_id)||n.add(i.from_account_id),rt(i.to_account_id)||n.add(i.to_account_id);for(const i of t.adjustments||[])rt(i.account_id)||n.add(i.account_id);for(const i of Object.keys(e))rt(i)||n.add(i);for(const i of t.account_balances||[])rt(i.account_id)||n.add(i.account_id);const r=[];for(const i of n){const o=je(e[i]??0),l=je((t.income||[]).filter(_=>_.account_id===i).reduce((_,w)=>_+w.amount,0)),u=je((t.expenses||[]).filter(_=>_.account_id===i).reduce((_,w)=>_+w.amount,0)),h=je((t.transfers||[]).filter(_=>_.from_account_id===i).reduce((_,w)=>_-w.amount,0)),f=je((t.transfers||[]).filter(_=>_.to_account_id===i).reduce((_,w)=>_+w.amount,0)),p=je(f+h),g=je((t.adjustments||[]).filter(_=>_.account_id===i).reduce((_,w)=>_+w.amount,0)),b=je(l+u+p+g);r.push({account_id:i,start_balance:o,income:l,expenses:u,transfers:p,adjustments:g,net_change:b,end_balance:je(o+b)})}return r}function dc(t){const e={},n={};for(const r of t.category_balances||[])ct(r.category_id)||(e[r.category_id]=je(r.end_balance));for(const r of t.account_balances||[])rt(r.account_id)||(n[r.account_id]=je(r.end_balance));return{categoryEndBalances:e,accountEndBalances:n,totalIncome:je(t.total_income)}}async function NP(t,e){return ze.fetchQuery({queryKey:["budgetInvite",t,e],queryFn:async()=>{const{exists:n,data:r}=await At("budgets",t,"checking if user has pending invite for budget");return!n||!r?null:{isInvited:r.user_ids?.includes(e)??!1,hasAccepted:r.accepted_user_ids?.includes(e)??!1,budgetName:r.name||"Unnamed Budget",ownerEmail:r.owner_email||null}},staleTime:60*1e3})}async function Hy(t,e,n){const r=await xr(t,e,n,{description:`fetching month for balance calculation (walking ${e}/${n})`});return r?{year:r.year,month:r.month,category_balances:r.category_balances,are_allocations_finalized:r.are_allocations_finalized,expenses:r.expenses}:null}async function PP(t,e,n,r){const i={};e.forEach(b=>{i[b]=0});const o=await Hy(t,n,r);if(o?.category_balances){for(const b of o.category_balances)e.includes(b.category_id)&&(i[b.category_id]=b.end_balance);return i}const l={};e.forEach(b=>{l[b]=0});const u=[];o&&u.push(o);let h=n,f=r,p=!1;const g=120;for(let b=0;b<g&&!p;b++){const _=Tc(h,f);h=_.year,f=_.month;const w=await Hy(t,h,f);if(!w)p=!0;else if(w.category_balances){p=!0;for(const x of w.category_balances)e.includes(x.category_id)&&(l[x.category_id]=x.end_balance)}else u.push(w)}u.reverse(),Object.assign(i,l);for(const b of u){if(b.are_allocations_finalized&&b.category_balances)for(const _ of b.category_balances)e.includes(_.category_id)&&(i[_.category_id]=(i[_.category_id]||0)+_.allocated);if(b.expenses)for(const _ of b.expenses)e.includes(_.category_id)&&(i[_.category_id]=(i[_.category_id]||0)-_.amount)}return i}async function BP(t,e,n,r,i){const o={...n},u=ze.getQueryData(Ce.budget(t))?.monthMap||{},h=new Date,f=h.getFullYear(),p=h.getMonth()+1;let g=f,b=p+Ai;for(;b>12;)b-=12,g+=1;const _=Qe(g,b);let w=r,x=i;const S=Ai*2;for(let C=0;C<S;C++){const T=Bo(w,x);w=T.year,x=T.month;const I=Qe(w,x);if(I>_||!(I in u))break;const M=await Hy(t,w,x);if(!M)break;if(M.are_allocations_finalized&&M.category_balances)for(const U of M.category_balances)e.includes(U.category_id)&&(o[U.category_id]=(o[U.category_id]||0)+U.allocated);if(M.expenses)for(const U of M.expenses)e.includes(U.category_id)&&(o[U.category_id]=(o[U.category_id]||0)-U.amount)}return o}async function $S(t,e,n,r){const i=await PP(t,e,n,r),o=await BP(t,e,i,n,r);return{current:i,total:o}}function jm(t,e){const n=t.account_group_id?e[t.account_group_id]:void 0,r=n&&n.on_budget!==null?n.on_budget:t.on_budget!==!1,i=n&&n.is_active!==null?n.is_active:t.is_active!==!1;return r&&i}function $T(t,e,n){const r=Object.entries(t).reduce((o,[,l])=>jm(l,n)?o+(l.balance??0):o,0),i=Object.values(e).reduce((o,l)=>{const u=l.balance??0;return o+(u>0?u:0)},0);return je(r-i)}const zP=Object.freeze(Object.defineProperty({__proto__:null,calculateTotalAvailable:$T,isAccountOnBudget:jm},Symbol.toStringTag,{value:"Module"}));function LP(t={}){const e={};return Object.keys(t).forEach(n=>{e[n]={}}),e}async function UP(t,e,n,r){const i=ze.getQueryData(Ce.budget(t));let o=null;if(i?.budget)o=i.budget;else{const{exists:g,data:b}=await At("budgets",t,"[recalc] reading budget for cache update");if(!g||!b)return;o=b}if(!o)return;const l={...o.accounts};for(const[g,b]of Object.entries(e))l[g]&&(l[g]={...l[g],balance:je(b)});const u={...o.categories};for(const[g,b]of Object.entries(n))u[g]&&(u[g]={...u[g],balance:je(b)});const{calculateTotalAvailable:h}=await td(async()=>{const{calculateTotalAvailable:g}=await Promise.resolve().then(()=>zP);return{calculateTotalAvailable:g}},[]),f=h(l,u,o.account_groups||{}),{writeBudgetData:p}=await td(async()=>{const{writeBudgetData:g}=await Promise.resolve().then(()=>iA);return{writeBudgetData:g}},void 0);await p({budgetId:t,updates:{month_map:r},description:"[recalc] updating month_map"}),FP(t,l,u,f,r)}function FP(t,e,n,r,i){const o=ze.getQueryData(Ce.budget(t));if(o){const l={};for(const[h,f]of Object.entries(o.accounts)){const p=e[h];p&&p.balance!==void 0?l[h]={...f,balance:je(p.balance)}:l[h]=f}const u={};for(const[h,f]of Object.entries(o.categories)){const p=n[h];p&&p.balance!==void 0?u[h]={...f,balance:je(p.balance)}:u[h]=f}ze.setQueryData(Ce.budget(t),{...o,accounts:l,categories:u,accountGroups:o.accountGroups,categoryGroups:o.categoryGroups,monthMap:i,budget:{...o.budget,accounts:l,categories:u,account_groups:o.budget.account_groups,category_groups:o.budget.category_groups,month_map:i}})}}async function t_(t,e,n){const r=Qe(e,n);if(gP(t,r))return{addedCount:0,budgetUpdated:!1};const i=Ce.budget(t),o=ze.getQueryData(i);let l=null;if(o?.budget)l=o.budget;else{const{exists:g,data:b}=await At("budgets",t,"reading budget for month_map update");if(!g||!b)return console.warn(`[ensureMonthsInMap] Budget ${t} not found`),{addedCount:0,budgetUpdated:!1};l=b}const h={...l.month_map||{}},f=UT();let p=0;r in h||(h[r]={},p++);for(const g of f)g>=r&&!(g in h)&&(h[g]={},p++);return p===0?{addedCount:0,budgetUpdated:!1}:(yP(t,r,h),await Oi("budgets",t,{month_map:h,updated_at:new Date().toISOString()},`adding ${p} month(s) to budget month_map`),{addedCount:p,budgetUpdated:!0})}async function VP(t,e){if(e.length===0)return{addedCount:0,budgetUpdated:!1};const n=Ce.budget(t),r=ze.getQueryData(n);let i=null;if(r?.budget)i=r.budget;else{const{exists:h,data:f}=await At("budgets",t,"reading budget for batch month_map update");if(!h||!f)return console.warn(`[ensureMonthsInMapBatch] Budget ${t} not found`),{addedCount:0,budgetUpdated:!1};i=f}const l={...i.month_map||{}};let u=0;for(const{year:h,month:f}of e){const p=Qe(h,f);p in l||(l[p]={},u++)}return u===0?{addedCount:0,budgetUpdated:!1}:(bP(t,l),await Oi("budgets",t,{month_map:l,updated_at:new Date().toISOString()},`adding ${u} month(s) to budget month_map (batch)`),{addedCount:u,budgetUpdated:!0})}const $P=Object.freeze(Object.defineProperty({__proto__:null,ensureMonthsInMap:t_,ensureMonthsInMapBatch:VP},Symbol.toStringTag,{value:"Module"}));function qS(t){return{year:parseInt(t.substring(0,4),10),month:parseInt(t.substring(4,6),10)}}const HS=t=>(t.category_balances||[]).some(e=>!ct(e.category_id)&&(e.start_balance??0)!==0)||(t.account_balances||[]).some(e=>!rt(e.account_id)&&(e.start_balance??0)!==0);async function qP(t,e){if(e.length===0)return Oa;const n=e[0];if(HS(n)){const l={},u={};for(const h of n.category_balances||[])ct(h.category_id)||(l[h.category_id]=je(h.start_balance??0));for(const h of n.account_balances||[])rt(h.account_id)||(u[h.account_id]=je(h.start_balance??0));return{categoryEndBalances:l,accountEndBalances:u,totalIncome:je(n.previous_month_income??0)}}let r=n.year,i=n.month;const o=120;for(let l=0;l<o;l++){const u=Tc(r,i);r=u.year,i=u.month;const h=await xr(t,r,i,{description:"recalculateAllBalances: walking backward for start_balance"});if(!h)return Oa;if(HS(h)){const f={},p={};for(const g of h.category_balances||[])ct(g.category_id)||(f[g.category_id]=je(g.end_balance??0));for(const g of h.account_balances||[])rt(g.account_id)||(p[g.account_id]=je(g.end_balance??0));return{categoryEndBalances:f,accountEndBalances:p,totalIncome:je(h.total_income??0)}}}return Oa}async function qT(t,e){const n=ze.getQueryData(Ce.budget(t));if(!n){console.warn("[recalculateAllBalancesFromCache] Budget not in cache");return}const{budget:r,accounts:i,categories:o}=n,l=Object.keys(o),u=n.monthMap||{},h=new Date,f=h.getFullYear(),p=h.getMonth()+1;let g;if(e?.months?.length)g=[...e.months].sort((V,$)=>V.year!==$.year?V.year-$.year:V.month-$.month);else{const V=Object.keys(u).sort();g=[];for(const $ of V){const{year:A,month:k}=qS($),D=ze.getQueryData(Ce.month(t,A,k));D?.month&&g.push(D.month)}g.sort(($,A)=>$.year!==A.year?$.year-A.year:$.month-A.month)}const b=(()=>{for(let V=g.length-1;V>=0;V--){const $=g[V];if($.are_allocations_finalized)return Qe($.year,$.month)}return null})(),_=b!=null?g.filter(V=>Qe(V.year,V.month)<=b):g;if(_.length===0){const V={},$={};for(const[A,k]of Object.entries(i))V[A]={...k,balance:0};for(const[A,k]of Object.entries(o))$[A]={...k,balance:0};ze.setQueryData(Ce.budget(t),{...n,accounts:V,categories:$,budget:{...r,accounts:V,categories:$}});return}let w=await qP(t,_);const x=new Map;let S=Oa,C=null;for(const V of _){const $=Ed(V,w,V.previous_month_income),A=Qe($.year,$.month);x.set(A,$),w=dc($),$.are_allocations_finalized&&(S=w,C=A)}for(const[,V]of x){const $=Ce.month(t,V.year,V.month);ze.setQueryData($,{month:V})}for(const V of x.values())ze.invalidateQueries({queryKey:Ce.month(t,V.year,V.month)});const T={...S.categoryEndBalances};for(const V of l)T[V]===void 0&&(T[V]=0);const I=Qe(f+Math.floor((p+Ai-1)/12),(p+Ai-1)%12+1),M=C?qS(C):{year:f,month:p};let U=Bo(M.year,M.month).year,H=Bo(M.year,M.month).month;const O=[];for(let V=0;V<Ai*2;V++){const $=Qe(U,H);if($>I||!($ in u))break;const k=ze.getQueryData(Ce.month(t,U,H))?.month;if(!k)break;if(k.are_allocations_finalized){if(k.category_balances){O.push($);for(const K of k.category_balances)l.includes(K.category_id)&&(T[K.category_id]=(T[K.category_id]??0)+(K.allocated??0))}if(k.expenses)for(const K of k.expenses)l.includes(K.category_id)&&(T[K.category_id]=(T[K.category_id]??0)-K.amount)}const D=Bo(U,H);U=D.year,H=D.month}const P={};for(const[V,$]of Object.entries(i))P[V]={...$,balance:je(S.accountEndBalances[V]??0)};const N={};for(const[V,$]of Object.entries(o))N[V]={...$,balance:je(T[V]??0)};ze.setQueryData(Ce.budget(t),{...n,accounts:P,categories:N,budget:{...r,accounts:P,categories:N}})}async function HT(t,e,n){const r=Qs(t,e.year,e.month),i=Tm(e);await Nr("months",r,i,`writeMonthData: ${n}`)}async function GT(t){const{budgetId:e,month:n,description:r,updateMonthMap:i=!0}=t;await HT(e,n,r||`${n.year}/${n.month}`),ze.setQueryData(Ce.month(e,n.year,n.month),{month:n}),i&&await t_(e,n.year,n.month)}function HP(){const t=Rt();return{writeData:Cn({mutationFn:async({budgetId:n,month:r,description:i,updateMonthMap:o=!0})=>(await HT(n,r,i||`${r.year}/${r.month}`),{budgetId:n,year:r.year,month:r.month,updateMonthMap:o}),onMutate:async({budgetId:n,month:r})=>{const i=Ce.month(n,r.year,r.month);await t.cancelQueries({queryKey:i});const o=t.getQueryData(i);return t.setQueryData(i,{month:r}),{oldMonthQueryData:o,monthKey:i}},onSuccess:async({budgetId:n,year:r,month:i,updateMonthMap:o})=>{o&&await t_(n,r,i)},onError:(n,r,i)=>{i?.oldMonthQueryData&&t.setQueryData(i.monthKey,i.oldMonthQueryData)}})}}function GP(){const{writeData:t}=HP();return{saveDraftAllocations:async(n,r,i,o)=>{const l=await xr(n,r,i);if(!l)throw new Error(`Month not found: ${r}/${i}`);const{calculateCategoryBalances:u}=await td(async()=>{const{calculateCategoryBalances:g}=await Promise.resolve().then(()=>tP);return{calculateCategoryBalances:g}},void 0),h=l.category_balances.map(g=>({category_id:g.category_id,start_balance:g.start_balance,allocated:je(o[g.category_id]??g.allocated)})),f=u(h,l.expenses||[],l.transfers||[],l.adjustments||[]),p={...l,category_balances:f,updated_at:new Date().toISOString()};return await t.mutateAsync({budgetId:n,month:p,updateMonthMap:!1}),{updatedMonth:p}},isPending:t.isPending,isError:t.isError,error:t.error}}const me={primary:`var(${yi.primary})`,error:`var(${yi.error})`,errorBg:`var(${yi.errorBg})`,errorBorder:`var(${yi.errorBorder})`,success:`var(${yi.success})`,danger:`var(${yi.danger})`,warning:`var(${yi.warning})`,debt:`var(${yi.debt})`,zero:`var(${yi.zero})`},Mr={textDecoration:"underline",textDecorationStyle:"dotted",textUnderlineOffset:"3px"},qa="1px solid color-mix(in srgb, currentColor 20%, transparent)",qf={maxWidth:"var(--page-max-width, 85rem)",margin:"0 auto",padding:"var(--page-padding, 2rem)"},n_={background:"color-mix(in srgb, currentColor 8%, transparent)",padding:"1rem 1.25rem",borderRadius:"8px",display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem"},WP={background:"color-mix(in srgb, currentColor 8%, transparent)",padding:"1.25rem",borderRadius:"8px",display:"flex",flexDirection:"column",gap:"1rem"},QP={display:"flex",flexDirection:"column",gap:"0.5rem"},KP={fontSize:"0.9rem",fontWeight:500},Ka={padding:"0.6rem 0.8rem",borderRadius:"6px",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"1rem",color:"inherit",width:"100%",boxSizing:"border-box"},YP={...Ka,cursor:"pointer"},r_={padding:"0.6rem 1.25rem",borderRadius:"6px",cursor:"pointer",fontWeight:500,fontSize:"0.9rem",transition:"opacity 0.15s"},WT={...r_,background:me.primary,color:"white",border:"none"},XP={...WT,padding:"0.75rem 1.5rem",borderRadius:"8px"},ZP={...r_,background:"transparent",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)"},JP={...r_,background:"transparent",border:`1px solid ${me.errorBorder}`,color:me.error},eB={background:"transparent",border:"1px solid color-mix(in srgb, currentColor 25%, transparent)",padding:"0.35rem 0.75rem",borderRadius:"6px",cursor:"pointer",fontSize:"0.8rem",opacity:.8,transition:"opacity 0.15s",whiteSpace:"nowrap"},Ca={background:"transparent",border:"1px solid color-mix(in srgb, currentColor 15%, transparent)",padding:"0.25rem 0.35rem",borderRadius:"4px",cursor:"pointer",fontSize:"0.75rem",lineHeight:1,display:"flex",alignItems:"center",justifyContent:"center",opacity:.6,transition:"opacity 0.15s, background 0.15s"},Hf={display:"flex",flexDirection:"column",gap:"2px"},tB={display:"flex",gap:"0.75rem",marginTop:"0.5rem"},nB={opacity:.4,cursor:"grab"},rB={position:"absolute",top:"-4px",left:0,right:0,height:"3px",background:me.primary,borderRadius:"2px",transition:"opacity 0.15s"},sB={position:"relative",height:"2rem",marginTop:"-0.25rem"},iB={position:"absolute",top:"50%",left:0,right:0,height:"3px",background:me.primary,borderRadius:"2px",transition:"opacity 0.15s"},aB={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"0.75rem",opacity:.7,background:"var(--surface-base)",padding:"0 0.5rem",whiteSpace:"nowrap"},oB={background:me.errorBg,border:`1px solid ${me.errorBorder}`,color:me.error,padding:"0.75rem 1rem",borderRadius:"8px",marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem"},lB={background:"transparent",border:"none",color:me.error,cursor:"pointer",fontSize:"1.2rem",padding:"0 0.25rem",lineHeight:1},QT={opacity:.7,marginBottom:"1.5rem"},GS={display:"flex",flexDirection:"column",gap:"0.5rem",marginBottom:"1.5rem"};function s_({message:t,children:e,onDismiss:n,style:r}){return d.jsxs("div",{style:{...oB,...r},children:[d.jsx("span",{children:e??t}),n&&d.jsx("button",{onClick:n,style:lB,children:""})]})}const cB={primary:WT,"primary-large":XP,secondary:ZP,danger:JP,small:eB},uB={position:"absolute",bottom:"100%",left:"50%",transform:"translateX(-50%)",background:me.warning,color:"var(--text-primary)",padding:"0.5rem 0.75rem",borderRadius:"6px",fontSize:"0.8rem",fontWeight:500,whiteSpace:"nowrap",marginBottom:"0.5rem",zIndex:100,boxShadow:"0 2px 8px var(--shadow-overlay)",animation:"tooltipFadeIn 0.15s ease-out"},dB={position:"absolute",top:"100%",left:"50%",transform:"translateX(-50%)",width:0,height:0,borderLeft:"6px solid transparent",borderRight:"6px solid transparent",borderTop:`6px solid ${me.warning}`};function qe({variant:t="primary",isLoading:e,loadingText:n="Saving...",children:r,disabled:i,style:o,actionName:l,disabledReason:u,onClick:h,...f}){const p=cB[t],g=i||e,[b,_]=R.useState(!1);function w(C){h?.(C)}function x(C){g&&u&&(C.preventDefault(),C.stopPropagation(),_(!0),setTimeout(()=>_(!1),3e3))}const S=g?{cursor:"not-allowed",opacity:.35,filter:"grayscale(50%)"}:{};return d.jsxs("div",{style:{position:"relative",display:"inline-block"},onClick:x,children:[b&&u&&d.jsxs("div",{style:uB,children:[u,d.jsx("div",{style:dB})]}),d.jsx("button",{disabled:g,style:{...p,cursor:g?"not-allowed":"pointer",...S,...o},onClick:w,...f,children:e?n:r})]})}function KT(t,e){const n=t.toLowerCase(),r=e.toLowerCase();if(r.includes(n)){const u=r.indexOf(n);return{match:!0,score:u===0||/\s/.test(r[u-1])?100:90}}let i=0,o=0,l=0;for(let u=0;u<r.length&&i<n.length;u++)r[u]===n[i]?(i++,l++,o+=l*2):l=0;return i===n.length?{match:!0,score:o}:{match:!1,score:0}}function YT(t){return[...t].sort((e,n)=>!e.groupId&&n.groupId?1:e.groupId&&!n.groupId?-1:!e.groupId&&!n.groupId?e.sortOrder-n.sortOrder:e.groupSortOrder!==n.groupSortOrder?e.groupSortOrder-n.groupSortOrder:e.sortOrder-n.sortOrder)}function XT(t){const e=YT(t),n=[];let r="__initial__";return e.forEach(i=>{i.groupId!==r&&(r=i.groupId,n.push({groupId:i.groupId,groupName:i.groupName,groupSortOrder:i.groupSortOrder,items:[]})),n[n.length-1].items.push(i)}),n}function ZT(t,e,n){return e.trim()?t.map(i=>{const o=n(i);let l=0,u=!1;for(const h of o){const f=KT(e,h);f.match&&(u=!0,l=Math.max(l,f.score))}return{item:i,score:l,hasMatch:u}}).filter(({hasMatch:i})=>i).sort((i,o)=>o.score!==i.score?o.score-i.score:!i.item.groupId&&o.item.groupId?1:i.item.groupId&&!o.item.groupId?-1:i.item.groupSortOrder!==o.item.groupSortOrder?i.item.groupSortOrder-o.item.groupSortOrder:i.item.sortOrder-o.item.sortOrder).map(({item:i})=>i):YT(t)}const i_={position:"absolute",top:"100%",left:0,right:0,marginTop:"4px",background:"var(--surface-base)",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",borderRadius:"6px",boxShadow:"0 4px 12px var(--shadow-overlay)",zIndex:1e3},nd={padding:"0.6rem 0.8rem",cursor:"pointer",transition:"background 0.1s"};function WS({id:t,value:e,onChange:n,payees:r,placeholder:i="Enter payee name",autoFocus:o}){const[l,u]=R.useState(!1),[h,f]=R.useState(-1),p=R.useRef(null),g=R.useRef(null),b=e.trim()?r.map(x=>({payee:x,...KT(e,x)})).filter(x=>x.match).sort((x,S)=>S.score-x.score).slice(0,8).map(x=>x.payee):[];R.useEffect(()=>{function x(S){p.current&&!p.current.contains(S.target)&&u(!1)}return document.addEventListener("mousedown",x),()=>document.removeEventListener("mousedown",x)},[]);function _(x){!l||b.length===0||(x.key==="ArrowDown"?(x.preventDefault(),f(S=>Math.min(S+1,b.length-1))):x.key==="ArrowUp"?(x.preventDefault(),f(S=>Math.max(S-1,-1))):x.key==="Enter"&&h>=0?(x.preventDefault(),n(b[h]),u(!1),f(-1)):x.key==="Escape"&&(u(!1),f(-1)))}function w(x){n(x),u(!1),f(-1),g.current?.focus()}return d.jsxs("div",{ref:p,style:{position:"relative"},children:[d.jsx("input",{ref:g,id:t,type:"text",value:e,onChange:x=>{n(x.target.value),u(!0),f(-1)},onFocus:()=>u(!0),onKeyDown:_,placeholder:i,autoComplete:"off",autoFocus:o,style:Ka}),l&&b.length>0&&d.jsx("div",{style:{...i_,maxHeight:"200px",overflowY:"auto"},children:b.map((x,S)=>d.jsx("div",{onClick:()=>w(x),style:{...nd,background:S===h?`color-mix(in srgb, ${me.primary} 20%, transparent)`:"transparent",borderBottom:S<b.length-1?"1px solid color-mix(in srgb, currentColor 10%, transparent)":"none"},onMouseEnter:()=>f(S),children:x},x))})]})}function JT({id:t,value:e,onChange:n,categories:r,categoryGroups:i,placeholder:o="Search categories...",required:l,showNoCategoryOption:u=!1,showHiddenCategories:h=!1}){const f=Object.fromEntries(i.map(G=>[G.id,G.name])),p=Object.fromEntries(i.map(G=>[G.id,G.sort_order])),g=h?r:Object.fromEntries(Object.entries(r).filter(([,G])=>!G.is_hidden)),b=Object.entries(g).map(([G,te])=>({id:G,name:te.name,groupId:te.category_group_id,groupName:te.category_group_id&&f[te.category_group_id]||null,sortOrder:te.sort_order,groupSortOrder:te.category_group_id?p[te.category_group_id]??999:999})),_=e===Zt,w=_?null:e?r[e]:null,x=_?"":w?.name||"",[S,C]=R.useState(x),[T,I]=R.useState(!1),[M,U]=R.useState(-1),H=R.useRef(null),O=R.useRef(null);R.useEffect(()=>{if(e===Zt)C("");else if(e){const G=r[e];C(G?.name||"")}},[e,r]);const P=ZT(b,S,G=>[G.name]),N=XT(P);R.useEffect(()=>{function G(te){if(H.current&&!H.current.contains(te.target))if(I(!1),e===Zt)C("");else{const Q=e?r[e]:null;C(Q?.name||"")}}return document.addEventListener("mousedown",G),()=>document.removeEventListener("mousedown",G)},[e,r]);function V(G){if(G.key==="ArrowDown")G.preventDefault(),T?U(te=>Math.min(te+1,P.length-1)):(I(!0),U(0));else if(G.key==="ArrowUp")G.preventDefault(),U(te=>Math.max(te-1,0));else if(G.key==="Enter")G.preventDefault(),T&&M>=0&&P[M]&&$(P[M]);else if(G.key==="Escape")if(I(!1),U(-1),e===Zt)C("");else{const te=e?r[e]:null;C(te?.name||"")}else if(G.key==="Tab")if(T&&M>=0&&P[M])$(P[M]);else if(I(!1),U(-1),e===Zt)C("");else{const te=e?r[e]:null;C(te?.name||"")}}function $(G){n(G.id),C(G.id===Zt?"":G.name),I(!1),U(-1)}function A(){n(Zt),C(""),I(!1),U(-1)}function k(G){const te=G.target.value;C(te),I(!0),U(te.trim()?0:-1),te!==x&&(u&&te.trim()===""?n(Zt):n(""))}function D(){I(!0),u&&(e===Zt||S.trim()==="")?U(-1):P.length>0&&U(0)}let K=-1;const X=()=>++K;return d.jsxs("div",{ref:H,style:{position:"relative"},children:[d.jsx("input",{ref:O,id:t,type:"text",value:S,onChange:k,onFocus:D,onKeyDown:V,placeholder:o,autoComplete:"off",required:l&&!u,style:{...Ka,borderColor:l&&!e?me.error:void 0}}),T&&d.jsxs("div",{style:{...i_,maxHeight:"250px",overflowY:"auto"},children:[u&&d.jsx("div",{onClick:A,onMouseEnter:()=>U(-1),style:{...nd,opacity:.7,fontStyle:"italic",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)",background:M===-1?`color-mix(in srgb, ${me.primary} 20%, transparent)`:"transparent"},children:qo}),N.map((G,te)=>d.jsxs("div",{children:[G.groupName&&d.jsx("div",{style:{padding:"0.4rem 0.8rem",fontSize:"0.75rem",textTransform:"uppercase",letterSpacing:"0.5px",opacity:.6,background:"color-mix(in srgb, currentColor 5%, transparent)",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},children:G.groupName}),G.items.map(Q=>{const se=X();return d.jsx("div",{onClick:()=>$(Q),style:{...nd,paddingLeft:G.groupName?"1.2rem":"0.8rem",background:se===M?`color-mix(in srgb, ${me.primary} 20%, transparent)`:"transparent",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},onMouseEnter:()=>U(se),children:Q.name},Q.id)})]},`group-${te}`)),P.length===0&&S.trim()&&!u&&d.jsx("div",{style:{padding:"0.6rem 0.8rem",opacity:.6,fontStyle:"italic"},children:"No matching categories"})]})]})}function eA({id:t,value:e,onChange:n,accounts:r,accountGroups:i,placeholder:o="Search accounts...",required:l,showNoAccountOption:u=!1,showHiddenAccounts:h=!1}){const p=(h?r:r.filter(([,K])=>!K.is_hidden)).map(([K,X])=>({id:K,name:X.nickname,groupId:X.account_group_id,groupName:X.account_group_id&&i[X.account_group_id]?.name||null,sortOrder:X.sort_order,groupSortOrder:X.account_group_id?i[X.account_group_id]?.sort_order??999:999})),g=e===Gt,b=g?null:r.find(([K])=>K===e)?.[1],_=g?"":b?.nickname||"",[w,x]=R.useState(_),[S,C]=R.useState(!1),[T,I]=R.useState(-1),M=R.useRef(null),U=R.useRef(null);R.useEffect(()=>{if(e===Gt)x("");else if(e){const K=r.find(([X])=>X===e)?.[1];x(K?.nickname||"")}},[e,r]);const H=ZT(p,w,K=>[K.name]),O=XT(H);R.useEffect(()=>{function K(X){if(M.current&&!M.current.contains(X.target))if(C(!1),e===Gt)x("");else{const G=r.find(([te])=>te===e)?.[1];x(G?.nickname||"")}}return document.addEventListener("mousedown",K),()=>document.removeEventListener("mousedown",K)},[e,r]);function P(K){if(K.key==="ArrowDown")K.preventDefault(),S?I(X=>Math.min(X+1,H.length-1)):(C(!0),I(0));else if(K.key==="ArrowUp")K.preventDefault(),I(X=>Math.max(X-1,0));else if(K.key==="Enter")K.preventDefault(),S&&T>=0&&H[T]&&N(H[T]);else if(K.key==="Escape")if(C(!1),I(-1),e===Gt)x("");else{const X=r.find(([G])=>G===e)?.[1];x(X?.nickname||"")}else if(K.key==="Tab")if(S&&T>=0&&H[T])N(H[T]);else if(C(!1),I(-1),e===Gt)x("");else{const X=r.find(([G])=>G===e)?.[1];x(X?.nickname||"")}}function N(K){n(K.id),x(K.id===Gt?"":K.name),C(!1),I(-1)}function V(){n(Gt),x(""),C(!1),I(-1)}function $(K){const X=K.target.value;x(X),C(!0),I(X.trim()?0:-1),X!==_&&(u&&X.trim()===""?n(Gt):n(""))}function A(){C(!0),u&&(e===Gt||w.trim()==="")?I(-1):H.length>0&&I(0)}let k=-1;const D=()=>++k;return d.jsxs("div",{ref:M,style:{position:"relative"},children:[d.jsx("input",{ref:U,id:t,type:"text",value:w,onChange:$,onFocus:A,onKeyDown:P,placeholder:o,autoComplete:"off",required:l&&!u,style:{...Ka,borderColor:l&&!e?me.error:void 0}}),S&&d.jsxs("div",{style:{...i_,maxHeight:"250px",overflowY:"auto"},children:[u&&d.jsx("div",{onClick:V,onMouseEnter:()=>I(-1),style:{...nd,opacity:.7,fontStyle:"italic",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)",background:T===-1?`color-mix(in srgb, ${me.primary} 20%, transparent)`:"transparent"},children:$a}),O.map((K,X)=>d.jsxs("div",{children:[K.groupName&&d.jsx("div",{style:{padding:"0.4rem 0.8rem",fontSize:"0.75rem",textTransform:"uppercase",letterSpacing:"0.5px",opacity:.6,background:"color-mix(in srgb, currentColor 5%, transparent)",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},children:K.groupName}),K.items.map(G=>{const te=D();return d.jsx("div",{onClick:()=>N(G),style:{...nd,paddingLeft:K.groupName?"1.2rem":"0.8rem",background:te===T?`color-mix(in srgb, ${me.primary} 20%, transparent)`:"transparent",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},onMouseEnter:()=>I(te),children:G.name},G.id)})]},`group-${X}`)),H.length===0&&w.trim()&&!u&&d.jsx("div",{style:{padding:"0.6rem 0.8rem",opacity:.6,fontStyle:"italic"},children:"No matching accounts"})]})]})}function Ni({children:t,onSubmit:e,actionName:n}){function r(i){e(i)}return d.jsx("form",{onSubmit:r,style:WP,children:t})}function Bt({label:t,htmlFor:e,children:n,hint:r,style:i}){return d.jsxs("div",{style:{...QP,...i},children:[d.jsx("label",{htmlFor:e,style:KP,children:t}),n,r&&d.jsx("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.85rem",opacity:.6},children:r})]})}function Pi(t){return d.jsx("input",{style:Ka,...t})}function hB(t){if(!t)return"";try{return new Date(t+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"})}catch{return t}}function Gf({value:t,onChange:e,style:n,autoFocus:r,...i}){const o=R.useRef(null),l=R.useRef(null),u=hB(t);R.useEffect(()=>{r&&l.current?.focus()},[r]);function h(){o.current?.showPicker?.()}function f(p){p.key==="Enter"&&(p.preventDefault(),o.current?.showPicker?.())}return d.jsxs("div",{style:{position:"relative"},children:[d.jsx("input",{ref:o,type:"date",value:t||"",onChange:e,style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",opacity:0,pointerEvents:"none"},...i}),d.jsx("div",{ref:l,tabIndex:0,onClick:h,onKeyDown:f,style:{...Ka,cursor:"pointer",display:"flex",alignItems:"center",fontSize:"0.85rem",fontFamily:"monospace",color:t?"inherit":"color-mix(in srgb, currentColor 50%, transparent)",...n},children:u||"Select date"})]})}function rd({children:t,...e}){return d.jsx("select",{style:YP,...e,children:t})}function a_({minHeight:t="6rem",style:e,...n}){return d.jsx("textarea",{style:{...Ka,width:"100%",minHeight:t,resize:"vertical",fontFamily:"inherit",boxSizing:"border-box",...e},...n})}function Ya({children:t}){return d.jsx("div",{style:tB,children:t})}function Jg(t){const n=t.replace(/[^\d.]/g,"").split("."),r=n[0]||"",i=n[1],o=r.replace(/\B(?=(\d{3})+(?!\d))/g,",");return i!==void 0?`$${o}.${i.slice(0,2)}`:o?`$${o}`:""}function fB(t){return t.replace(/[$,]/g,"")}function No({id:t,value:e,onChange:n,placeholder:r="$0.00",required:i,autoFocus:o,style:l}){const[u,h]=R.useState(()=>Jg(e)),f=R.useRef(null);R.useEffect(()=>{const g=Jg(e);fB(u)!==e&&h(g)},[e]);function p(g){const b=g.target.value;if(!b||b==="$"){h(""),n("");return}const w=b.replace(/[^\d.]/g,"").split(".");let x=w[0];w.length>1&&(x+="."+w.slice(1).join("").slice(0,2));const S=Jg(x);h(S),n(x)}return d.jsx("input",{ref:f,id:t,type:"text",inputMode:"decimal",value:u,onChange:p,placeholder:r,required:i,autoFocus:o,style:{...Ka,...l}})}function Li(t=Q6){const[e,n]=R.useState(()=>typeof window>"u"?!1:window.innerWidth<t);return R.useEffect(()=>{const r=window.matchMedia(`(max-width: ${t-1}px)`);function i(l){n(l.matches)}i(r),r.addEventListener("change",i);function o(){n(window.innerWidth<t)}return window.addEventListener("resize",o),()=>{r.removeEventListener("change",i),window.removeEventListener("resize",o)}},[t]),e}function tA(){const[t,e]=R.useState(()=>typeof window>"u"?1200:window.innerWidth);return R.useEffect(()=>{function n(){e(window.innerWidth)}return window.addEventListener("resize",n),n(),()=>window.removeEventListener("resize",n)},[]),{width:t,isWide:t>=Do.wide,isMedium:t>=Do.tablet&&t<Do.wide,isNarrowMedium:t>=Do.mobile&&t<Do.tablet,isMobile:t<Do.mobile}}function Dn(){const{selectedBudgetId:t,currentUserId:e}=Ye(),n=eP(t),r=n.data,i=r?.budget||null,o=R.useMemo(()=>r?.accounts||{},[r?.accounts]),l=R.useMemo(()=>r?.accountGroups||{},[r?.accountGroups]),u=R.useMemo(()=>r?.categories||{},[r?.categories]),h=R.useMemo(()=>{const M=r?.categoryGroups||[];return M.length>0?[...M]:[]},[r?.categoryGroups]),f=i?.owner_id===e,p=R.useMemo(()=>i?.user_ids||[],[i?.user_ids]),g=R.useMemo(()=>i?.accepted_user_ids||[],[i?.accepted_user_ids]),b=R.useMemo(()=>i?$T(o,u,l):0,[i,o,l,u]),_=R.useMemo(()=>r?.monthMap||{},[r?.monthMap]),w=R.useCallback(M=>{if(!t)return;const U=ze.getQueryData(Ce.budget(t));U&&ze.setQueryData(Ce.budget(t),{...U,accounts:M})},[t]),x=R.useCallback(M=>{if(!t)return;const U=ze.getQueryData(Ce.budget(t));U&&ze.setQueryData(Ce.budget(t),{...U,accountGroups:M})},[t]),S=R.useCallback(M=>{if(!t)return;const U=ze.getQueryData(Ce.budget(t));U&&ze.setQueryData(Ce.budget(t),{...U,categories:M,budget:{...U.budget,categories:M}})},[t]),C=R.useCallback(M=>{if(!t)return;const U=ze.getQueryData(Ce.budget(t));if(U){const H=[...M];ze.setQueryData(Ce.budget(t),{...U,categoryGroups:H,budget:{...U.budget,category_groups:H}})}},[t]),T=R.useCallback(async()=>{t&&await ze.invalidateQueries({queryKey:Ce.budget(t)})},[t]),I=R.useCallback(()=>Object.entries(o).filter(([,M])=>jm(M,l)).reduce((M,[,U])=>M+U.balance,0),[o,l]);return{isLoading:n.isLoading,isFetching:n.isFetching,error:n.error,budget:i,accounts:o,accountGroups:l,categories:u,categoryGroups:h,isOwner:f,budgetUserIds:p,acceptedUserIds:g,totalAvailable:b,monthMap:_,setAccountsOptimistic:w,setAccountGroupsOptimistic:x,setCategoriesOptimistic:S,setCategoryGroupsOptimistic:C,refreshBudget:T,getOnBudgetTotal:I}}function Xs(t,e,n){const{addLoadingHold:r,removeLoadingHold:i}=In(),o=Rt(),l=EP(t,e,n,{enabled:!!t});R.useEffect(()=>{const T=t?Ce.month(t,e,n):null;if(!T){i("month-query");return}const I=!!l.data,M=o.getQueryState(T),U=M?.dataUpdatedAt?Date.now()-M.dataUpdatedAt>fs:!1;return!I||U&&l.isFetching||l.isLoading?r("month-query","Loading month data..."):i("month-query"),()=>i("month-query")},[l.isLoading,l.isFetching,l.data,t,e,n,o,r,i]);const u=l.data?.month||null,h=R.useMemo(()=>u?.income||[],[u?.income]),f=R.useMemo(()=>u?.expenses||[],[u?.expenses]),p=R.useMemo(()=>u?.transfers||[],[u?.transfers]),g=R.useMemo(()=>u?.adjustments||[],[u?.adjustments]),b=R.useMemo(()=>u?.category_balances||[],[u?.category_balances]),_=R.useMemo(()=>u?.account_balances||[],[u?.account_balances]),w=u?.total_income||0,x=u?.total_expenses||0,S=u?.are_allocations_finalized||!1,C=u?.previous_month_income??0;return{isLoading:l.isLoading,isFetching:l.isFetching,error:l.error,month:u,income:h,expenses:f,transfers:p,adjustments:g,categoryBalances:b,accountBalances:_,totalIncome:w,totalExpenses:x,areAllocationsFinalized:S,previousMonthIncome:C}}function Jo(){return{updateBudgetCacheAndTrack:(e,n)=>{ze.setQueryData(Ce.budget(e),n)}}}function mB(){const t=Rt(),{currentViewingDocument:e}=Ye(),{saveCurrentDocument:n}=Pn(),{updateBudgetCacheAndTrack:r}=Jo(),i=Cn({onMutate:async l=>{const{budgetId:u,accounts:h}=l,f=Ce.budget(u);await t.cancelQueries({queryKey:f});const p=t.getQueryData(f);if(p){const b={...p,accounts:h};r(u,b)}if(e.type==="budget")try{await n(u,"budget")}catch(b){console.warn("[useUpdateAccounts] Failed to save current document immediately:",b)}return{previousData:p}},mutationFn:async l=>{const{accounts:u}=l;return{accounts:u}},onError:(l,u,h)=>{h?.previousData&&t.setQueryData(Ce.budget(u.budgetId),h.previousData)}});return{updateAccounts:{mutate:l=>i.mutate(l),mutateAsync:l=>i.mutateAsync(l),isPending:i.isPending,isError:i.isError,error:i.error,reset:i.reset}}}function pB(){const t=Rt(),{currentViewingDocument:e}=Ye(),{saveCurrentDocument:n}=Pn(),{updateBudgetCacheAndTrack:r}=Jo(),i=Cn({onMutate:async l=>{const{budgetId:u,accountGroups:h}=l,f=Ce.budget(u);await t.cancelQueries({queryKey:f});const p=t.getQueryData(f);if(p){const b={...p,accountGroups:h};r(u,b)}if(e.type==="budget")try{await n(u,"budget")}catch(b){console.warn("[useUpdateAccountGroups] Failed to save current document immediately:",b)}return{previousData:p}},mutationFn:async l=>{const{accountGroups:u}=l;return{accountGroups:u}},onError:(l,u,h)=>{h?.previousData&&t.setQueryData(Ce.budget(u.budgetId),h.previousData)}});return{updateAccountGroups:{mutate:l=>i.mutate(l),mutateAsync:l=>i.mutateAsync(l),isPending:i.isPending,isError:i.isError,error:i.error,reset:i.reset}}}async function nA(t,e,n){const r={[`categories.${e}`]:Q0(),updated_at:new Date().toISOString()};await Oi("budgets",t,r,n);const i=ze.getQueryData(Ce.budget(t));if(i?.categories&&e in i.categories){const{[e]:o,...l}=i.categories;ze.setQueryData(Ce.budget(t),{...i,categories:l,budget:{...i.budget,categories:l}})}}async function rA(t,e,n){const r={[`accounts.${e}`]:Q0(),updated_at:new Date().toISOString()};await Oi("budgets",t,r,n);const i=ze.getQueryData(Ce.budget(t));if(i?.accounts&&e in i.accounts){const{[e]:o,...l}=i.accounts;ze.setQueryData(Ce.budget(t),{...i,accounts:l,budget:{...i.budget,accounts:l}})}}async function sA(t,e,n,r){const i={[`account_groups.${e}`]:Q0(),updated_at:new Date().toISOString()};for(const l of n)i[`accounts.${l}.account_group_id`]=Vt;await Oi("budgets",t,i,r);const o=ze.getQueryData(Ce.budget(t));if(o?.accounts&&o?.accountGroups&&e in o.accountGroups){const{[e]:l,...u}=o.accountGroups,h={...o.accounts};for(const f of n)h[f]&&(h[f]={...h[f],account_group_id:Vt});ze.setQueryData(Ce.budget(t),{...o,accounts:h,accountGroups:u,budget:{...o.budget,accounts:h,account_groups:u}})}}async function el(t){const{budgetId:e,updates:n,description:r}=t,{total_available:i,is_needs_recalculation:o,...l}=n;let u={...l};if(u.accounts&&typeof u.accounts=="object"){const g=u.accounts;u={...u,accounts:Object.fromEntries(Object.entries(g).map(([b,_])=>{if(_&&typeof _=="object"){const{balance:w,...x}=_;return[b,x]}return[b,_]}))}}if(u.categories&&typeof u.categories=="object"){const g=u.categories;u={...u,categories:Object.fromEntries(Object.entries(g).map(([b,_])=>{if(_&&typeof _=="object"){const{balance:w,...x}=_;return[b,x]}return[b,_]}))}}const h={...u,updated_at:new Date().toISOString()},f=Va(h);await Oi("budgets",e,f,r);const p=ze.getQueryData(Ce.budget(e));p&&ze.setQueryData(Ce.budget(e),{...p,budget:{...p.budget,...n}})}const iA=Object.freeze(Object.defineProperty({__proto__:null,deleteBudgetAccountGroupKey:sA,deleteBudgetAccountKey:rA,deleteBudgetCategoryKey:nA,writeBudgetData:el},Symbol.toStringTag,{value:"Module"}));function gB(){const t=Rt(),{currentViewingDocument:e}=Ye(),{updateBudgetCacheAndTrack:n}=Jo(),r=Cn({onMutate:async o=>{const{budgetId:l,accountId:u}=o,h=Ce.budget(l);await t.cancelQueries({queryKey:h});const f=t.getQueryData(h),p=e.type==="budget";if(f?.accounts&&u in f.accounts){const{[u]:g,...b}=f.accounts,_={...f,accounts:b,budget:{...f.budget,accounts:b}};t.setQueryData(h,_),p||n(l,_)}if(p)try{await rA(l,u,"accounts: delete (targeted key)")}catch(g){console.warn("[useDeleteAccount] Failed to delete account key:",g)}return{previousData:f}},mutationFn:async()=>{},onError:(o,l,u)=>{u?.previousData&&t.setQueryData(Ce.budget(l.budgetId),u.previousData)}});return{deleteAccount:{mutate:o=>r.mutate(o),mutateAsync:o=>r.mutateAsync(o),isPending:r.isPending,isError:r.isError,error:r.error,reset:r.reset}}}function yB(){const t=Rt(),{currentViewingDocument:e}=Ye(),{updateBudgetCacheAndTrack:n}=Jo(),r=Cn({onMutate:async o=>{const{budgetId:l,groupId:u,accountIdsToUngroup:h}=o,f=Ce.budget(l);await t.cancelQueries({queryKey:f});const p=t.getQueryData(f),g=e.type==="budget";if(p?.accounts&&p?.accountGroups&&u in p.accountGroups){const{[u]:b,..._}=p.accountGroups,w={...p.accounts};for(const S of h)w[S]&&(w[S]={...w[S],account_group_id:Vt});const x={...p,accounts:w,accountGroups:_,budget:{...p.budget,accounts:w,account_groups:_}};t.setQueryData(f,x),g||n(l,x)}if(g)try{await sA(l,u,h,"account_groups: delete (targeted key)")}catch(b){console.warn("[useDeleteAccountGroup] Failed to delete account group key:",b)}return{previousData:p}},mutationFn:async()=>{},onError:(o,l,u)=>{u?.previousData&&t.setQueryData(Ce.budget(l.budgetId),u.previousData)}});return{deleteAccountGroup:{mutate:o=>r.mutate(o),mutateAsync:o=>r.mutateAsync(o),isPending:r.isPending,isError:r.isError,error:r.error,reset:r.reset}}}function _B(){const t=Rt(),{currentViewingDocument:e}=Ye(),{updateBudgetCacheAndTrack:n}=Jo(),r=Cn({onMutate:async o=>{const{budgetId:l,categories:u}=o,h=Ce.budget(l);await t.cancelQueries({queryKey:h});const f=t.getQueryData(h),p=e.type==="budget";if(f){const g={...f,categories:u,budget:{...f.budget,categories:u}};t.setQueryData(h,g),p||n(l,g)}if(p)try{await el({budgetId:l,updates:{categories:u},description:"categories: update (settings)"})}catch(g){console.warn("[useUpdateCategories] Failed to save categories immediately:",g)}return{previousData:f}},mutationFn:async o=>{const{categories:l}=o;return{categories:l}},onError:(o,l,u)=>{u?.previousData&&t.setQueryData(Ce.budget(l.budgetId),u.previousData)}});return{updateCategories:{mutate:o=>r.mutate(o),mutateAsync:o=>r.mutateAsync(o),isPending:r.isPending,isError:r.isError,error:r.error,reset:r.reset}}}function bB(){const t=Rt(),{currentViewingDocument:e}=Ye(),{saveCurrentDocument:n}=Pn(),{updateBudgetCacheAndTrack:r}=Jo(),i=Cn({onMutate:async l=>{const{budgetId:u,categoryGroups:h}=l,f=Ce.budget(u);await t.cancelQueries({queryKey:f});const p=t.getQueryData(f);if(p){const b={...p,categoryGroups:h,budget:{...p.budget,category_groups:h}};r(u,b)}if(e.type==="budget")try{await n(u,"budget")}catch(b){console.warn("[useUpdateCategoryGroups] Failed to save current document immediately:",b)}return{previousData:p}},mutationFn:async l=>{const{categoryGroups:u}=l;return{categoryGroups:u}},onError:(l,u,h)=>{h?.previousData&&t.setQueryData(Ce.budget(u.budgetId),h.previousData)}});return{updateCategoryGroups:{mutate:l=>i.mutate(l),mutateAsync:l=>i.mutateAsync(l),isPending:i.isPending,isError:i.isError,error:i.error,reset:i.reset}}}function vB(){const t=Rt(),{currentViewingDocument:e}=Ye(),{updateBudgetCacheAndTrack:n}=Jo(),r=Cn({onMutate:async o=>{const{budgetId:l,categoryId:u}=o,h=Ce.budget(l);await t.cancelQueries({queryKey:h});const f=t.getQueryData(h),p=e.type==="budget";if(f?.categories&&u in f.categories){const{[u]:g,...b}=f.categories,_={...f,categories:b,budget:{...f.budget,categories:b}};t.setQueryData(h,_),p||n(l,_)}if(p)try{await nA(l,u,"categories: delete (targeted key)")}catch(g){console.warn("[useDeleteCategory] Failed to delete category key:",g)}return{previousData:f}},mutationFn:async()=>{},onError:(o,l,u)=>{u?.previousData&&t.setQueryData(Ce.budget(l.budgetId),u.previousData)}});return{deleteCategory:{mutate:o=>r.mutate(o),mutateAsync:o=>r.mutateAsync(o),isPending:r.isPending,isError:r.isError,error:r.error,reset:r.reset}}}function xB(){const t=Rt(),e=Cn({onMutate:async r=>{const{budgetId:i,newName:o}=r,l=Ce.budget(i);await t.cancelQueries({queryKey:l});const u=t.getQueryData(l);return u&&t.setQueryData(l,{...u,budget:{...u.budget,name:o.trim()}}),{previousData:u}},mutationFn:async r=>{const{budgetId:i,newName:o}=r,l=o.trim();return await el({budgetId:i,updates:{name:l},description:`renaming budget to "${l}"`}),{newName:l}},onError:(r,i,o)=>{o?.previousData&&t.setQueryData(Ce.budget(i.budgetId),o.previousData)}});return{renameBudget:{mutate:r=>e.mutate(r),mutateAsync:r=>e.mutateAsync(r),isPending:e.isPending,isError:e.isError,error:e.error,reset:e.reset}}}function wB({currentBudget:t,accounts:e,accountGroups:n,setAccountsOptimistic:r,setAccountGroupsOptimistic:i,saveAccounts:o,saveAccountGroups:l,setError:u}){const h=R.useCallback(async(p,g,b)=>{const _=e[p];if(!_)return;const w=b==="ungrouped"?Vt:b,x=Object.entries(e).filter(([,T])=>(T.account_group_id||"ungrouped")===b),S={};Object.entries(e).forEach(([T,I])=>{T!==p&&(S[T]={...I})});let C;if(g==="__group_end__"||x.length===0||!x.find(([T])=>T===g))C=(x.length>0?Math.max(...x.filter(([I])=>I!==p).map(([,I])=>I.sort_order)):-1)+1;else{const T=x.find(([I])=>I===g);if(T){const[,I]=T;C=I.sort_order,Object.entries(S).forEach(([M,U])=>{(U.account_group_id||"ungrouped")===b&&U.sort_order>=C&&(S[M]={...U,sort_order:U.sort_order+1})})}else C=0}if(S[p]={..._,account_group_id:w,sort_order:C},r(S),!!t)try{await o(S)}catch(T){u(T instanceof Error?T.message:"Failed to save changes")}},[t,e,r,o,u]),f=R.useCallback(async(p,g)=>{if(p===g)return;const b=Object.entries(n).sort(([,C],[,T])=>C.sort_order-T.sort_order),_=b.findIndex(([C])=>C===p),w=[...b],[x]=w.splice(_,1);if(g==="__end__")w.push(x);else{const C=w.findIndex(([T])=>T===g);w.splice(C,0,x)}const S={};if(w.forEach(([C,T],I)=>{S[C]={...T,sort_order:I}}),i(S),!!t)try{await l(S)}catch(C){u(C instanceof Error?C.message:"Failed to save new order")}},[t,n,i,l,u]);return{reorderAccountsInGroup:h,reorderGroups:f}}function SB(){const{selectedBudgetId:t}=Ye(),{budget:e,accounts:n,accountGroups:r,setAccountsOptimistic:i,setAccountGroupsOptimistic:o}=Dn(),{updateAccounts:l}=mB(),{updateAccountGroups:u}=pB(),{deleteAccount:h}=gB(),{deleteAccountGroup:f}=yB(),[p,g]=R.useState(null),b=R.useCallback(async $=>{if(!t)throw new Error("No budget selected");await l.mutateAsync({budgetId:t,accounts:$})},[t,l]),_=R.useCallback(async $=>{if(!t)throw new Error("No budget selected");await u.mutateAsync({budgetId:t,accountGroups:$})},[t,u]),w=R.useMemo(()=>Object.entries(n).filter(([,$])=>!$.is_hidden).reduce(($,[A,k])=>{const D=k.account_group_id||Vt;return $[D]||($[D]=[]),$[D].push({...k,id:A}),$},{}),[n]),x=R.useMemo(()=>Object.entries(n).filter(([,$])=>$.is_hidden).map(([$,A])=>({...A,id:$})).sort(($,A)=>$.sort_order-A.sort_order),[n]),S=R.useMemo(()=>Object.entries(r).sort(([,$],[,A])=>$.sort_order-A.sort_order).map(([$,A])=>({...A,id:$})),[r]),C=R.useCallback(($,A)=>{if(!e)return;const k=A||Vt,D=Object.values(n).filter(Q=>Q.account_group_id===k),K=D.length>0?Math.max(...D.map(Q=>Q.sort_order)):-1,X=`account_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,G={nickname:$.nickname,description:"",balance:0,account_group_id:k,sort_order:K+1,is_income_account:$.is_income_account??!1,is_income_default:$.is_income_default??!1,is_outgo_account:$.is_outgo_account??!1,is_outgo_default:$.is_outgo_default??!1,on_budget:$.on_budget!==!1,is_active:$.is_active!==!1,is_hidden:$.is_hidden??!1},te={...n};$.is_income_default&&Object.keys(te).forEach(Q=>{te[Q]={...te[Q],is_income_default:!1}}),$.is_outgo_default&&Object.keys(te).forEach(Q=>{te[Q]={...te[Q],is_outgo_default:!1}}),te[X]=G,i(te),b(te).catch(Q=>g(Q instanceof Error?Q.message:"Failed to create account."))},[e,n,i,b]),T=R.useCallback(($,A)=>{if(!e)return;const k=n[$];if(!k)return;const D=k.account_group_id||Vt,K=A.account_group_id||Vt;let X=k.sort_order;if(D!==K){const te=Object.values(n).filter(Q=>Q.account_group_id===K);X=te.length>0?Math.max(...te.map(Q=>Q.sort_order))+1:0}const G={};Object.entries(n).forEach(([te,Q])=>{te===$?G[te]={...Q,nickname:A.nickname,account_group_id:K,sort_order:X,is_income_account:A.is_income_account??!1,is_income_default:A.is_income_default??!1,is_outgo_account:A.is_outgo_account??!1,is_outgo_default:A.is_outgo_default??!1,on_budget:A.on_budget!==!1,is_active:A.is_active!==!1,is_hidden:A.is_hidden??!1}:(G[te]={...Q},A.is_income_default&&!k.is_income_default&&(G[te].is_income_default=!1),A.is_outgo_default&&!k.is_outgo_default&&(G[te].is_outgo_default=!1))}),i(G),b(G).catch(te=>g(te instanceof Error?te.message:"Failed to save account."))},[e,n,i,b]),I=R.useCallback($=>{confirm("Are you sure you want to delete this account?")&&(!e||!t||h.mutateAsync({budgetId:t,accountId:$}).catch(A=>g(A instanceof Error?A.message:"Failed to delete account.")))},[e,t,h]),M=R.useCallback(async($,A)=>{const k=n[$];if(!k)return;const D=k.account_group_id||Vt,K=Object.entries(n).filter(([,B])=>B.account_group_id===D).sort(([,B],[,q])=>B.sort_order-q.sort_order),X=K.findIndex(([B])=>B===$),G=A==="up"?X-1:X+1;if(G<0||G>=K.length)return;const[te,Q]=K[G],se={};if(Object.entries(n).forEach(([B,q])=>{B===$?se[B]={...q,sort_order:Q.sort_order}:B===te?se[B]={...q,sort_order:k.sort_order}:se[B]={...q}}),i(se),!!e)try{await b(se)}catch(B){i(n),g(B instanceof Error?B.message:"Failed to move account")}},[e,n,i,b]),U=R.useCallback($=>{if(!e)return;const A=Object.values(r).map(G=>G.sort_order),k=A.length>0?Math.max(...A):-1,D=`account_group_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,K={name:$.name,sort_order:k+1,expected_balance:$.expected_balance,on_budget:$.on_budget??null,is_active:$.is_active??null},X={...r,[D]:K};o(X),_(X).catch(G=>g(G instanceof Error?G.message:"Failed to create account type."))},[e,r,o,_]),H=R.useCallback(($,A)=>{if(!e)return;const k={...r,[$]:{...r[$],name:A.name,expected_balance:A.expected_balance,on_budget:A.on_budget??null,is_active:A.is_active??null}};o(k),_(k).catch(D=>g(D instanceof Error?D.message:"Failed to update account type."))},[e,r,o,_]),O=R.useCallback($=>{if($===Vt){alert("Cannot delete the default Ungrouped account type.");return}if(!confirm("Are you sure you want to delete this account type? Accounts in this type will move to Ungrouped.")||!e||!t)return;const A=Object.entries(n).filter(([,k])=>(k.account_group_id||Vt)===$).map(([k])=>k);f.mutateAsync({budgetId:t,groupId:$,accountIdsToUngroup:A}).catch(k=>g(k instanceof Error?k.message:"Failed to delete account type."))},[e,t,n,f]),P=R.useCallback(async($,A)=>{const k=Object.entries(r).sort(([,te],[,Q])=>te.sort_order-Q.sort_order),D=k.findIndex(([te])=>te===$),K=A==="up"?D-1:D+1;if(K<0||K>=k.length)return;const[X]=k.splice(D,1);k.splice(K,0,X);const G={};if(k.forEach(([te,Q],se)=>{G[te]={...Q,sort_order:se}}),o(G),!!e)try{await _(G)}catch(te){o(r),g(te instanceof Error?te.message:"Failed to move account type")}},[e,r,o,_]),{reorderAccountsInGroup:N,reorderGroups:V}=wB({currentBudget:e,accounts:n,accountGroups:r,setAccountsOptimistic:i,setAccountGroupsOptimistic:o,saveAccounts:b,saveAccountGroups:_,setError:g});return{accounts:n,accountGroups:r,accountsByGroup:w,hiddenAccounts:x,sortedGroups:S,currentBudget:e,error:p,setError:g,handleCreateAccount:C,handleUpdateAccount:T,handleDeleteAccount:I,handleMoveAccount:M,handleCreateGroup:U,handleUpdateGroup:H,handleDeleteGroup:O,handleMoveGroup:P,reorderAccountsInGroup:N,reorderGroups:V}}function QS(t,e){if(!t)return{};const n={};return Object.entries(e).forEach(([r,i])=>{if(i.is_hidden){n[r]="";return}if(i.default_monthly_type==="percentage")return;const o=t.category_balances?.find(l=>l.category_id===r);o&&o.allocated>0?n[r]=o.allocated.toString():i.default_monthly_amount!==void 0&&i.default_monthly_amount>0?n[r]=i.default_monthly_amount.toString():n[r]=""}),n}function EB(){const t=Rt(),{addLoadingHold:e,removeLoadingHold:n}=In(),{selectedBudgetId:r,currentYear:i,currentMonthNumber:o}=Ye(),{categories:l,getOnBudgetTotal:u,totalAvailable:h}=Dn(),{month:f,isLoading:p,previousMonthIncome:g,areAllocationsFinalized:b}=Xs(r,i,o),_=R.useMemo(()=>f?.income?f.income.reduce((B,q)=>B+q.amount,0):0,[f]),{saveDraftAllocations:w}=GP(),{finalizeAllocations:x}=uz(),{deleteAllocations:S}=yA(),C=R.useMemo(()=>QS(f,l),[f,l]),[T,I]=R.useState(C),[M,U]=R.useState(!1),H=R.useRef(null);R.useMemo(()=>Object.values(l).reduce((B,q)=>B+(q.balance??0),0),[l]),R.useEffect(()=>{if(!f)return;const B=`${f.year}-${f.month}`;H.current!==B&&(U(!1),I(QS(f,l)),H.current=B)},[f,l]);const O=R.useCallback((B,q)=>{if(q.is_hidden)return 0;if(q.default_monthly_type==="percentage"&&q.default_monthly_amount!==void 0)return je(q.default_monthly_amount/100*g);const ee=T[B],ne=parseFloat(ee||"0");return isNaN(ne)?0:je(ne)},[T,g]),P=R.useMemo(()=>Object.entries(l).reduce((B,[q,ee])=>{const ne=O(q,ee),le=ee.balance??0;if(le<0){const he=Math.abs(le),Ee=Math.max(0,ne-he);return B+Ee}return B+ne},0),[l,O]),N=u(),V=b?(f?.category_balances||[]).reduce((B,q)=>{const ee=l[q.category_id]?.balance??0,ne=q.allocated,le=ee-ne;if(le<0){const he=Math.abs(le);return B+Math.max(0,ne-he)}return B+ne},0):0,$=M?h+V:h,A=R.useMemo(()=>M?$-P:$-P+V,[$,P,V,M]),k=R.useCallback((B,q)=>{I(ee=>({...ee,[B]:q}))},[]),D=R.useCallback(()=>{if(!f)return;const B={};Object.entries(l).forEach(([q,ee])=>{if(ee.is_hidden){B[q]="";return}if(ee.default_monthly_type==="percentage")return;const ne=f.category_balances?.find(le=>le.category_id===q);ne&&ne.allocated>0?B[q]=ne.allocated.toString():ee.default_monthly_amount!==void 0&&ee.default_monthly_amount>0?B[q]=ee.default_monthly_amount.toString():B[q]=""}),I(B),U(!1)},[f,l]),K=R.useCallback(async()=>{if(r){e("allocations-edit","Loading allocations...");try{const B=await mP(r,i,o,"Edit Allocations"),q=Ce.month(r,i,o);t.setQueryData(q,{month:B}),U(!0)}catch(B){console.error("[useAllocationsPage] Edit Allocations failed:",B),qn.add({type:"error",message:"Failed to load allocations. See console for details.",autoDismissMs:0})}finally{n("allocations-edit")}}},[r,i,o,t,e,n]),X=R.useCallback(()=>{const B={};return Object.entries(l).forEach(([q,ee])=>{const ne=ee.is_hidden?0:O(q,ee);(ne>0||ee.is_hidden)&&(B[q]=ne)}),B},[l,O]),G=R.useCallback(async()=>{if(r){e("allocations-save","Saving allocations...");try{await w(r,i,o,X()),U(!1)}catch(B){console.error("[useAllocationsPage] Save allocations failed:",B),qn.add({type:"error",message:"Failed to save allocations. See console for details.",autoDismissMs:0})}finally{n("allocations-save")}}},[r,i,o,w,X,e,n]),te=R.useCallback(async()=>{if(r){e("allocations-finalize","Applying allocations...");try{await x({budgetId:r,year:i,month:o,allocations:X(),onProgress:B=>{e("allocations-finalize",B.message)}}),U(!1)}catch(B){console.error("[useAllocationsPage] Finalize allocations failed:",B),qn.add({type:"error",message:"Failed to apply allocations. See console for details.",autoDismissMs:0})}finally{n("allocations-finalize")}}},[r,i,o,x,X,e,n]),Q=R.useCallback(async()=>{if(r){e("allocations-delete","Deleting allocations...");try{await S({budgetId:r,year:i,month:o,onProgress:q=>{e("allocations-delete",q.message)}});const B={};Object.entries(l).forEach(([q,ee])=>{if(ee.is_hidden){B[q]="";return}ee.default_monthly_type!=="percentage"&&(ee.default_monthly_amount!==void 0&&ee.default_monthly_amount>0?B[q]=ee.default_monthly_amount.toString():B[q]="")}),I(B),U(!1)}catch(B){console.error("[useAllocationsPage] Delete allocations failed:",B),qn.add({type:"error",message:"Failed to delete allocations. See console for details.",autoDismissMs:0})}finally{n("allocations-delete")}}},[r,i,o,S,l,e,n]),se=P-V;return{localAllocations:T,isEditingAppliedAllocations:M,monthLoading:p,onBudgetTotal:N,totalAvailable:h,availableNow:$,currentDraftTotal:P,draftChangeAmount:se,availableAfterApply:A,previousMonthIncome:g,currentMonthIncome:_,allocationsFinalized:b,getAllocationAmount:O,handleAllocationChange:k,resetAllocationsToSaved:D,handleSaveAllocations:G,handleFinalizeAllocations:te,handleDeleteAllocations:Q,handleEditAllocations:K,setIsEditingAppliedAllocations:U}}function CB({budgetId:t,categories:e,currentYear:n,currentMonth:r,updateCategoriesWithBalances:i}){const o=Object.keys(e),l=o.length>0,u=R.useMemo(()=>{const w={};return Object.entries(e).forEach(([x,S])=>{w[x]={current:S.balance??0,total:S.balance??0}}),w},[e]),[h,f]=R.useState(!1),[p,g]=R.useState(null),b=R.useCallback(async()=>{if(!t||Object.keys(e).length===0)return null;const w=Object.keys(e),{total:x}=await $S(t,w,n,r),S={};Object.entries(e).forEach(([T,I])=>{const M=I.balance,U=x[T]??0;Math.abs(M-U)>.01&&(S[T]={stored:M,calculated:U})});const C=Object.keys(S).length>0?S:null;return g(C),C},[t,e,n,r]),_=R.useCallback(async()=>{if(!(!t||!l)){f(!0);try{const{total:w}=await $S(t,o,n,r),x={};Object.entries(e).forEach(([S,C])=>{x[S]={...C,balance:w[S]??0}}),await i(x),g(null)}finally{f(!1)}}},[t,e,i,n,r,o,l]);return{categoryBalances:u,loadingBalances:h,categoryBalanceMismatch:p,checkCategoryBalanceMismatch:b,recalculateAndSaveCategoryBalances:_}}function TB({categories:t,categoryGroups:e,currentBudget:n,setCategoriesOptimistic:r,setCategoryGroupsOptimistic:i,saveCategories:o,saveCategoryGroups:l,setError:u}){const[h,f]=R.useState(null),[p,g]=R.useState(null),[b,_]=R.useState(null),[w,x]=R.useState(null);function S(P,N){f("category"),g(N),P.dataTransfer.effectAllowed="move"}function C(P,N,V){P.preventDefault(),h==="category"&&(N!==p&&_(N),x(V))}function T(P,N){P.preventDefault(),h==="category"&&(x(N),_(null))}function I(){_(null)}function M(){x(null)}function U(){f(null),g(null),_(null),x(null)}async function H(P,N,V){if(P.preventDefault(),P.stopPropagation(),!p||h!=="category"){U();return}const $=t[p];if(!$)return;const A=V==="ungrouped"?Xt:V,k=Object.entries(t).filter(([,X])=>(X.category_group_id||"ungrouped")===V),D={};Object.entries(t).forEach(([X,G])=>{X!==p&&(D[X]=G)});let K;if(N==="__group_end__"||k.length===0||!k.find(([X])=>X===N))K=(k.length>0?Math.max(...k.filter(([G])=>G!==p).map(([,G])=>G.sort_order)):-1)+1;else{const X=k.find(([G])=>G===N);X?(K=X[1].sort_order,Object.entries(D).forEach(([G,te])=>{(te.category_group_id||"ungrouped")===V&&te.sort_order>=K&&(D[G]={...te,sort_order:te.sort_order+1})})):K=0}if(D[p]={...$,category_group_id:A,sort_order:K},r(D),U(),!!n)try{await o(D)}catch(X){u(X instanceof Error?X.message:"Failed to save changes")}}async function O(P,N){P.preventDefault(),h==="category"&&await H(P,"__group_end__",N)}return{dragType:h,draggedId:p,dragOverId:b,dragOverGroupId:w,setDragOverId:_,setDragOverGroupId:x,handleCategoryDragStart:S,handleCategoryDragOver:C,handleDragOverGroup:T,handleDragLeave:I,handleDragLeaveGroup:M,handleDragEnd:U,handleCategoryDrop:H,handleDropOnGroup:O}}function AB(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n}=Ye(),{budget:r,categories:i,categoryGroups:o,isLoading:l,setCategoriesOptimistic:u,setCategoryGroupsOptimistic:h,getOnBudgetTotal:f}=Dn(),{updateCategories:p}=_B(),{updateCategoryGroups:g}=bB(),{deleteCategory:b}=vB(),[_,w]=R.useState(null),x=R.useCallback(async Q=>{if(!t)throw new Error("No budget selected");await p.mutateAsync({budgetId:t,categories:Q})},[t,p]),S=R.useCallback(async Q=>{if(!t)throw new Error("No budget selected");await g.mutateAsync({budgetId:t,categoryGroups:Q})},[t,g]),C=R.useCallback(async(Q,se)=>{if(!t)throw new Error("No budget selected");await Promise.all([p.mutateAsync({budgetId:t,categories:Q}),g.mutateAsync({budgetId:t,categoryGroups:se})])},[t,p,g]),{categoryBalances:T,loadingBalances:I,categoryBalanceMismatch:M,checkCategoryBalanceMismatch:U,recalculateAndSaveCategoryBalances:H}=CB({budgetId:t,categories:i,currentYear:e,currentMonth:n,updateCategoriesWithBalances:x}),O=TB({categories:i,categoryGroups:o,currentBudget:r,setCategoriesOptimistic:u,setCategoryGroupsOptimistic:h,saveCategories:x,saveCategoryGroups:S,setError:w});async function P(Q,se){if(!r)return;const B=se||Xt,q=Object.values(i).filter(Ee=>Ee.category_group_id===B),ee=q.length>0?Math.max(...q.map(Ee=>Ee.sort_order)):-1,ne=`category_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,le={name:Q.name,description:Q.description??"",category_group_id:B,sort_order:ee+1,default_monthly_amount:Q.default_monthly_amount??0,default_monthly_type:Q.default_monthly_type??"fixed",balance:0,is_hidden:Q.is_hidden??!1},he={...i,[ne]:le};u(he);try{await x(he)}catch(Ee){u(i);const ae=Ee instanceof Error?Ee.message:"Failed to create category";throw w(ae),Ee}}async function N(Q,se){if(r)try{const B=i[Q];if(!B)return;const q=B.category_group_id||Xt,ee=se.category_group_id||Xt;let ne=B.sort_order;if(q!==ee){const he=Object.values(i).filter(Ee=>Ee.category_group_id===ee&&Ee!==B);ne=he.length>0?Math.max(...he.map(Ee=>Ee.sort_order))+1:0}const le={...i,[Q]:{...B,name:se.name,description:se.description??"",category_group_id:ee,sort_order:ne,default_monthly_amount:se.default_monthly_amount??0,default_monthly_type:se.default_monthly_type??"fixed",is_hidden:se.is_hidden??!1}};u(le),await x(le)}catch(B){w(B instanceof Error?B.message:"Failed to update category")}}async function V(Q){if(confirm("Are you sure you want to delete this category?")&&!(!r||!t))try{await b.mutateAsync({budgetId:t,categoryId:Q})}catch(se){w(se instanceof Error?se.message:"Failed to delete category")}}async function $(Q,se){const B=i[Q];if(!B)return;const q=B.category_group_id||Xt,ee=Object.entries(i).filter(([,fe])=>fe.category_group_id===q).sort((fe,Me)=>fe[1].sort_order-Me[1].sort_order),ne=ee.findIndex(([fe])=>fe===Q),le=se==="up"?ne-1:ne+1;if(le<0||le>=ee.length)return;const[he,Ee]=ee[le],ae={};if(Object.entries(i).forEach(([fe,Me])=>{fe===Q?ae[fe]={...Me,sort_order:Ee.sort_order}:fe===he?ae[fe]={...Me,sort_order:B.sort_order}:ae[fe]=Me}),u(ae),!!r)try{await x(ae)}catch(fe){u(i),w(fe instanceof Error?fe.message:"Failed to move category")}}async function A(Q){if(r)try{const se=o.length>0?Math.max(...o.map(ee=>ee.sort_order)):-1,B={id:`category_group_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,name:Q.name,sort_order:se+1},q=[...o,B];h(q),await S(q)}catch(se){w(se instanceof Error?se.message:"Failed to create group")}}async function k(Q,se){if(r)try{const B=o.map(q=>q.id===Q?{...q,name:se.name}:q);h(B),await S(B)}catch(B){w(B instanceof Error?B.message:"Failed to update group")}}async function D(Q){if(Q===Xt){alert("Cannot delete the default Uncategorized category group.");return}if(confirm("Are you sure you want to delete this group? Categories in this group will move to Uncategorized.")&&r)try{const se={};Object.entries(i).forEach(([q,ee])=>{se[q]=ee.category_group_id===Q?{...ee,category_group_id:Xt}:ee});const B=o.filter(q=>q.id!==Q);u(se),h(B),await C(se,B)}catch(se){w(se instanceof Error?se.message:"Failed to delete group")}}async function K(Q,se){const B=o.filter(ae=>ae.id!==Xt).sort((ae,fe)=>ae.sort_order-fe.sort_order),q=o.find(ae=>ae.id===Xt),ee=B.findIndex(ae=>ae.id===Q),ne=se==="up"?ee-1:ee+1;if(ne<0||ne>=B.length)return;const[le]=B.splice(ee,1);B.splice(ne,0,le);const he=B.map((ae,fe)=>({...ae,sort_order:fe})),Ee=[...he,...q?[{...q,sort_order:he.length}]:[]];if(h(Ee),!!r)try{await S(Ee)}catch(ae){h(o),w(ae instanceof Error?ae.message:"Failed to move group")}}const X=R.useMemo(()=>Object.entries(i).filter(([,Q])=>!Q.is_hidden).reduce((Q,[se,B])=>{const q=B.category_group_id||Xt;return Q[q]||(Q[q]=[]),Q[q].push([se,B]),Q},{}),[i]),G=R.useMemo(()=>Object.entries(i).filter(([,Q])=>Q.is_hidden).map(([Q,se])=>[Q,se]).sort((Q,se)=>Q[1].sort_order-se[1].sort_order),[i]),te=R.useMemo(()=>[...o].sort((Q,se)=>Q.sort_order-se.sort_order),[o]);return{currentBudget:r,categories:i,categoryGroups:o,categoriesByGroup:X,hiddenCategories:G,sortedGroups:te,categoryBalances:T,isLoading:l,loadingBalances:I,error:_,setError:w,getOnBudgetTotal:f,categoryBalanceMismatch:M,checkCategoryBalanceMismatch:U,recalculateAndSaveCategoryBalances:H,handleCreateCategory:P,handleUpdateCategory:N,handleDeleteCategory:V,handleMoveCategory:$,handleCreateGroup:A,handleUpdateGroup:k,handleDeleteGroup:D,handleMoveGroup:K,dragType:O.dragType,draggedId:O.draggedId,dragOverId:O.dragOverId,dragOverGroupId:O.dragOverGroupId,setDragOverId:O.setDragOverId,setDragOverGroupId:O.setDragOverGroupId,handleCategoryDragStart:O.handleCategoryDragStart,handleCategoryDragOver:O.handleCategoryDragOver,handleDragOverGroup:O.handleDragOverGroup,handleDragLeave:O.handleDragLeave,handleDragLeaveGroup:O.handleDragLeaveGroup,handleDragEnd:O.handleDragEnd,handleCategoryDrop:O.handleCategoryDrop,handleDropOnGroup:O.handleDropOnGroup}}function jB({categories:t,categoryBalances:e,totalAvailable:n,onBudgetTotal:r,isDataLoading:i,loadingBalances:o,currentBudget:l}){const u=R.useMemo(()=>Object.values(t).reduce((x,S)=>x+Math.max(0,S.balance??0),0),[t]),h=R.useMemo(()=>Object.values(e).reduce((x,S)=>x+Math.max(0,S.total),0),[e]),f=u,p=R.useMemo(()=>Object.values(t).reduce((x,S)=>x+Math.max(0,S.balance??0),0),[t]),g=n,b=R.useMemo(()=>Math.abs(u-h)>.01,[u,h]),_=R.useMemo(()=>Math.abs(r-(f+g))>.01,[r,f,g]),w=R.useMemo(()=>Math.abs(u-p)>.01,[u,p]);return R.useEffect(()=>{},[b,_,w,u,h,f,g,r,p,i,o,l]),{allocatedFromStored:u,allocatedFromCalculated:h,allocated:f,unallocated:g,monthViewAllTime:p,calculationMismatch:b,relationshipMismatch:_,monthViewMismatch:w}}function RB(t,e,n,r){const i={budget_id:e,year_month_ordinal:t.year_month_ordinal??Qe(n,r),year:t.year??n,month:t.month??r,income:t.income||[],total_income:t.total_income??0,previous_month_income:0,expenses:t.expenses||[],total_expenses:t.total_expenses??0,transfers:t.transfers||[],adjustments:t.adjustments||[],account_balances:t.account_balances||[],category_balances:t.category_balances||[],are_allocations_finalized:t.are_allocations_finalized??!1,created_at:t.created_at,updated_at:t.updated_at};return Sd(i)}async function IB(t){const e=new Date,n=e.getFullYear(),r=e.getMonth()+1;let i=n,o=r-3;for(;o<=0;)o+=12,i-=1;const l=Qe(i,o);return(await ur("months","useInitialDataLoad: loading initial months",[{field:"budget_id",op:"==",value:t},{field:"year_month_ordinal",op:">=",value:l}])).docs.map(f=>{const p=f.data,g=p.year,b=p.month;return RB(p,t,g,b)}).sort((f,p)=>f.year!==p.year?f.year-p.year:f.month-p.month)}function DB(t,e){if(e<1)return t;const n=new Map;for(const r of t)n.set(`${r.year}/${r.month}`,r);return t.map(r=>{const i=wm(r.year,r.month,e);if(!i)return r;const o=n.get(`${i.year}/${i.month}`);if(!o)return r;const l=o.income||[],u=je(l.reduce((h,f)=>h+(f.amount||0),0));return{...r,previous_month_income:u}})}async function kB(t){const[e,n,r]=await Promise.all([X0(t),FT(t),IB(t)]),i=e.budget.percentage_income_months_back??1,o=DB(r,i);return{budget:e,payees:n,months:o}}function MB(t,e){return Go({queryKey:t?["initialDataLoad",t]:["initialDataLoad","none"],queryFn:()=>kB(t),enabled:!!t&&e?.enabled!==!1,staleTime:1/0})}async function OB(t,e,n,r){const i=Ce.month(t,e,n),o=r.getQueryData(i);if(!o?.month)throw new Error(`Month ${e}/${n} not found in cache`);const l=o.month,u=await NB(t,e,n,r),h=Ed(l,u);return r.setQueryData(i,{month:h}),h}async function NB(t,e,n,r){const{year:i,month:o}=Tc(e,n),l=Ce.month(t,i,o),u=r.getQueryData(l);if(u?.month)return dc(u.month);try{const h=await xr(t,i,o,{description:`fetching previous month ${i}/${o} for recalculation`});if(h)return dc(h)}catch(h){console.warn(`[useLocalRecalculation] Could not fetch previous month ${i}/${o}:`,h)}return Oa}async function PB(t,e,n){const i=n.getQueryCache().findAll({predicate:h=>h.queryKey[0]==="month"&&h.queryKey[1]===t&&h.state.status==="success"&&h.state.data!=null});if(i.length===0)return;const o=[];for(const h of i){const f=h.queryKey,p=f[2],g=f[3],b=n.getQueryData(h.queryKey);b?.month&&o.push({year:p,month:g,monthDoc:b.month})}o.sort((h,f)=>h.year!==f.year?h.year-f.year:h.month-f.month);const l=new Map;for(const{year:h,month:f,monthDoc:p}of o)l.set(`${h}/${f}`,p);let u=Oa;for(const{year:h,month:f,monthDoc:p}of o){const g=wm(h,f,e),b=g?(()=>{const x=l.get(`${g.year}/${g.month}`);if(!x)return 0;const S=x.income||[];return je(S.reduce((C,T)=>C+(T.amount||0),0))})():0,_=Ed(p,u,b),w=Ce.month(t,h,f);n.setQueryData(w,{month:_}),u=dc(_)}}function BB(t,e,n){const r=Rt(),i=R.useRef(null),o=R.useRef(null),l=R.useRef(null),u=R.useCallback((h,f)=>{if(!t)return;const p=Ce.month(t,h,f);if(r.getQueryData(p))return;const b=r.getQueryData(Ce.budget(t)),_=Qe(h,f);b?.monthMap&&_ in b.monthMap&&r.prefetchQuery({queryKey:p,queryFn:async()=>{const x=await J0(t,h,f);return x?{month:x}:null},staleTime:fs}).catch(x=>{console.warn(`[useMonthPrefetch] Failed to prefetch month ${h}/${f}:`,x)})},[t,r]);R.useEffect(()=>{if(!t)return;const h=`${t}-${e}-${n}`;if(l.current===h)return;l.current=h;const f=Bo(e,n);u(f.year,f.month)},[t,e,n,u]),R.useEffect(()=>{if(i.current===null||o.current===null){i.current=e,o.current=n;return}if(i.current===e&&o.current===n)return;if(!t){i.current=e,o.current=n;return}const h=Qe(i.current,o.current),g=Qe(e,n)>h?Bo(e,n):Tc(e,n);u(g.year,g.month),i.current=e,o.current=n},[t,e,n,u])}async function aA(t,e,n=!0){if(!ze.getQueryData(Ce.budget(t))){console.warn("[ensureMonthsFreshAndRecalculateBalances] Budget not in cache");return}n&&await qT(t)}function o_(t=!0,e={}){const{alwaysRecalculate:n=!1}=e,{selectedBudgetId:r}=Ye(),{addLoadingHold:i,removeLoadingHold:o}=In(),l=R.useRef(!1);R.useEffect(()=>{if(!t||!r||l.current)return;l.current=!0;let u=null;aA(r,(h,f)=>{h?(u="ensure-balances-fresh",i(u,f)):u&&(o(u),u=null)},n).catch(h=>{console.error("[useEnsureBalancesFresh] Failed to ensure balances fresh:",h),u&&o(u)})},[t,r,n,i,o]),R.useEffect(()=>{r||(l.current=!1)},[r])}function zB(){const t=new Date,e=t.getFullYear(),n=t.getMonth()+1;let r=e,i=n-3;for(;i<=0;)i+=12,r-=1;return Qe(r,i)}function LB(t,e){const n=Qe(t,e),r=zB();return n>=r}function UB({budgetId:t,viewingYear:e,viewingMonth:n,initialDataLoadComplete:r,enabled:i=!0}){const o=Rt(),l=R.useRef(!1),u=R.useRef(null),h=R.useCallback(()=>{if(!t||!i||!r)return;const f=["initialDataLoad",t],p=o.getQueryState(f);if(!p?.dataUpdatedAt)return;Date.now()-p.dataUpdatedAt>fs&&!l.current&&(l.current=!0,o.invalidateQueries({queryKey:f}))},[t,i,r,o]);R.useEffect(()=>{r&&h()},[r,h]),R.useEffect(()=>{if(!i||!r)return;const f=()=>{document.visibilityState==="visible"&&(l.current=!1,h())};return document.addEventListener("visibilitychange",f),()=>{document.removeEventListener("visibilitychange",f)}},[i,r,h]),R.useEffect(()=>{l.current=!1,u.current=null},[t]),R.useEffect(()=>{if(!t||!i||!r||LB(e,n))return;const p=`${t}-${e}-${n}`;if(u.current===p)return;u.current=p;const g=[{year:e,month:n},Tc(e,n),Bo(e,n)];for(const{year:b,month:_}of g){const w=Ce.month(t,b,_);if(o.getQueryData(w)){const S=o.getQueryState(w);if(!(S?.dataUpdatedAt?Date.now()-S.dataUpdatedAt>fs:!1))continue}o.prefetchQuery({queryKey:w,queryFn:async()=>{const S=await J0(t,b,_);return S?{month:S}:null},staleTime:fs}).catch(S=>{console.warn(`[useStaleDataRefresh] Failed to prefetch month ${b}/${_}:`,S)})}},[t,i,r,e,n,o])}function Ha(){ze.removeQueries({queryKey:["budget"]}),ze.removeQueries({queryKey:["month"]}),ze.removeQueries({queryKey:["accessibleBudgets"]}),ze.removeQueries({queryKey:["payees"]}),ze.removeQueries({queryKey:["user"]}),console.log("[Migration] All caches cleared")}async function Rm(t){try{const e=await t();return Ha(),e}catch(e){throw Ha(),e}}const oA=R.createContext(null),KS={isOpen:!1,migrationName:"",stage:"",progress:null,currentItem:null,details:null,isComplete:!1,error:null};function FB({children:t}){const[e,n]=R.useState(KS),r=R.useCallback(()=>({setStage:u=>{n(h=>({...h,stage:u}))},setProgress:u=>{n(h=>({...h,progress:u}))},setCurrentItem:u=>{n(h=>({...h,currentItem:u}))},setDetails:u=>{n(h=>({...h,details:u}))},updateItemProgress:(u,h,f)=>{const p=h>0?Math.round(u/h*100):0;n(g=>({...g,progress:p,currentItem:f||`Item ${u} of ${h}`,details:`${u} / ${h} complete`}))}}),[]),i=R.useCallback(async(u,h)=>{n({isOpen:!0,migrationName:u,stage:"Starting migration...",progress:null,currentItem:null,details:null,isComplete:!1,error:null});const f=r();try{const p=await h(f);return Ha(),n(g=>({...g,isComplete:!0,stage:"Migration complete",progress:100,details:p.errors.length>0?`Completed with ${p.errors.length} error(s)`:"All operations successful"})),p}catch(p){Ha();const g=p instanceof Error?p.message:"Unknown error occurred";throw n(b=>({...b,isComplete:!0,error:g,stage:"Migration failed",progress:null})),p}},[r]),o=R.useCallback(()=>{n(u=>u.isComplete?KS:(console.warn("[MigrationProgress] Cannot close modal while migration is running"),u))},[]),l={state:e,runMigrationWithProgress:i,closeModal:o};return d.jsx(oA.Provider,{value:l,children:t})}function Ac(){const t=R.useContext(oA);if(!t)throw new Error("useMigrationProgress must be used within MigrationProgressProvider");return t}async function l_(t){return(await ur("budgets",`${t}: batch reading all budgets`)).docs.map(n=>({id:n.id,data:n.data}))}async function lA(t,e){return(await ur("months",`${e}: batch reading months for budget ${t}`,[{field:"budget_id",op:"==",value:t}])).docs.map(i=>({id:i.id,data:i.data,budgetId:i.data.budget_id,year:i.data.year,month:i.data.month})).sort((i,o)=>i.year!==o.year?i.year-o.year:i.month-o.month)}async function nr(t){const e=await l_(t),n=await ur("months",`${t}: batch reading all months`),r=new Map;for(const i of n.docs){const o=i.data.budget_id,l={id:i.id,data:i.data,budgetId:o,year:i.data.year,month:i.data.month};r.has(o)||r.set(o,[]),r.get(o).push(l)}for(const i of r.values())i.sort((o,l)=>o.year!==l.year?o.year-l.year:o.month-l.month);return{budgets:e,monthsByBudget:r}}async function Xa(t,e){if(t.length===0)return;const n=t.map(o=>{const l=Tm(o.data);return{collectionPath:"months",docId:Qs(o.budgetId,o.year,o.month),data:Va({...l,updated_at:new Date().toISOString()})}});await K0(n,`${e}: batch writing ${t.length} months`);const r=new Map;for(const o of t)r.has(o.budgetId)||r.set(o.budgetId,[]),r.get(o.budgetId).push({year:o.year,month:o.month});const{ensureMonthsInMapBatch:i}=await td(async()=>{const{ensureMonthsInMapBatch:o}=await Promise.resolve().then(()=>$P);return{ensureMonthsInMapBatch:o}},void 0);for(const[o,l]of r)try{await i(o,l)}catch(u){console.warn(`[batchWriteMonths] Failed to update month_map for budget ${o}:`,u)}}async function Im(t,e){if(t.length===0)return;const n=t.map(r=>{const i={...r.data};if(i.accounts&&typeof i.accounts=="object"){const o=i.accounts;i.accounts=Object.fromEntries(Object.entries(o).map(([l,u])=>{if(u&&typeof u=="object"){const{balance:h,...f}=u;return[l,f]}return[l,u]}))}if(i.categories&&typeof i.categories=="object"){const o=i.categories;i.categories=Object.fromEntries(Object.entries(o).map(([l,u])=>{if(u&&typeof u=="object"){const{balance:h,...f}=u;return[l,f]}return[l,u]}))}return delete i.total_available,delete i.is_needs_recalculation,{collectionPath:"budgets",docId:r.budgetId,data:Va({...i,updated_at:new Date().toISOString()})}});await K0(n,`${e}: batch writing ${t.length} budgets`)}async function cA(t,e,n){if(e.length===0)return;let r=Oa;const i=[];for(const p of e){const g=Ed(p,r);i.push(g),r=dc(g)}const o=i.map(p=>({budgetId:t,year:p.year,month:p.month,data:p}));await Xa(o,n);const l=r.accountEndBalances,u=r.categoryEndBalances,{exists:h,data:f}=await At("budgets",t,`${n}: reading budget for final update`);if(h&&f){const p=LP(f.month_map||{}),g={...u},b=f.categories||{};for(const _ of Object.keys(b))_ in g||(g[_]=0);await UP(t,l,g,p)}}async function VB(t,e){if(t.length===0)return;const n=new Map;for(const r of t)n.has(r.budgetId)||n.set(r.budgetId,[]),n.get(r.budgetId).push(r);for(const[r,i]of n){i.sort((u,h)=>u.year!==h.year?u.year-h.year:u.month-h.month),await Xa(i,e);const l=(await lA(r,e)).map(u=>u.data);await cA(r,l,e)}}async function $B(t){const{exists:e,data:n}=await At("budgets",t,`[delete all months] reading budget ${t} for reset`);if(!e||!n)return;const r=Object.fromEntries(Object.entries(n.accounts||{}).map(([o,l])=>{if(l&&typeof l=="object"){const{balance:u,...h}=l;return[o,h]}return[o,l]})),i=Object.fromEntries(Object.entries(n.categories||{}).map(([o,l])=>{if(l&&typeof l=="object"){const{balance:u,...h}=l;return[o,h]}return[o,l]}));await Nr("budgets",t,{...n,accounts:r,categories:i,month_map:{},updated_at:new Date().toISOString()},`[delete all months] resetting budget ${t} (removing balances)`)}function qB({currentUser:t,onComplete:e}){const[n,r]=R.useState(!1),[i,o]=R.useState(!1),[l,u]=R.useState(null),[h,f]=R.useState(null),[p,g]=R.useState(null);async function b(){if(t){r(!0);try{const w=await ur("months","delete all months: scanning for all months"),x=[],S=new Set;for(const C of w.docs){const{budget_id:T,year:I,month:M}=C.data;S.add(T),x.push({docId:C.id,budgetId:T,year:I,month:M})}x.sort((C,T)=>C.budgetId!==T.budgetId?C.budgetId.localeCompare(T.budgetId):C.year!==T.year?C.year-T.year:C.month-T.month),u({monthsToDelete:x,monthsCount:x.length,budgetCount:S.size})}catch{}finally{r(!1)}}}async function _(){if(!t||!l||l.monthsToDelete.length===0)return;o(!0),f(null);const w=l.monthsToDelete.length,x=new Set,S=[];for(const U of l.monthsToDelete)x.add(U.budgetId);g({phase:"deleting",deleted:0,total:w,currentMonth:null,budgetsRecalculated:0,totalBudgets:l.budgetCount,percentComplete:0});const C=l.monthsToDelete.map(U=>({collectionPath:"months",docId:U.docId}));let T=0;try{await MT(C,"delete all months: batch deleting all month documents",U=>{T=U,g({phase:"deleting",deleted:U,total:w,currentMonth:`Batch ${Math.ceil(U/500)} of ${Math.ceil(w/500)}`,budgetsRecalculated:0,totalBudgets:l.budgetCount,percentComplete:Math.round(U/w*70)})}),T=w}catch(U){S.push(`Batch delete failed: ${U instanceof Error?U.message:"Unknown error"}`)}const I=Array.from(x);let M=0;for(const U of I){g({phase:"resetting-budgets",deleted:T,total:w,currentMonth:`Budget ${M+1}/${I.length}`,budgetsRecalculated:M,totalBudgets:I.length,percentComplete:70+Math.round(M/I.length*25)});try{await $B(U),M++}catch{M++}}g({phase:"clearing-cache",deleted:T,total:w,currentMonth:null,budgetsRecalculated:M,totalBudgets:I.length,percentComplete:95}),Ha(),g({phase:"complete",deleted:T,total:w,currentMonth:null,budgetsRecalculated:M,totalBudgets:I.length,percentComplete:100}),f({deleted:T,errors:S,budgetsRecalculated:M}),o(!1),g(null),S.length===0&&(u({monthsToDelete:[],monthsCount:0,budgetCount:0}),e?.())}return{status:l,isScanning:n,scanStatus:b,isDeleting:i,deleteResult:h,deleteProgress:p,deleteAllMonths:_}}const ey="sample@sample.com",jo="budget_1767746876726_xuj7nzl4l";function HB({currentUser:t,onComplete:e}){const[n,r]=R.useState(!1),[i,o]=R.useState(!1),[l,u]=R.useState(null),[h,f]=R.useState(null),[p,g]=R.useState(null);async function b(){if(t){r(!0);try{let x=(await ur("budgets","delete sample user budget: scanning for sample user budgets",[{field:"owner_email",op:"==",value:ey}])).docs;if(x.length===0){console.log("delete sample user budget: no budgets found by owner_email, checking fallback budget ID");const U=await At("budgets",jo,"delete sample user budget: checking fallback budget ID");U.exists&&U.data&&(console.log("delete sample user budget: found fallback budget",jo),x=[{id:jo,data:U.data}])}const S=[];let C=0,T=!1;for(const U of x){const H=U.id,O=U.data.name,N=(await ur("months",`delete sample user budget: counting months for budget ${H}`,[{field:"budget_id",op:"==",value:H}])).docs.length;C+=N,S.push({budgetId:H,budgetName:O,monthCount:N}),(await ur("payees",`delete sample user budget: checking payees for budget ${H}`,[{field:"budget_id",op:"==",value:H}])).docs.length>0&&(T=!0)}const I=[],M=await ur("users","delete sample user budget: finding sample user document",[{field:"email",op:"==",value:ey}]);M.docs.length>0&&M.docs[0].data.budget_ids?.includes(jo)&&(S.some(P=>P.budgetId===jo)||(console.log("delete sample user budget: found stale budget reference in sample user document",jo),I.push(jo))),u({budgets:S,totalBudgets:S.length,totalMonths:C,hasPayees:T,staleBudgetIds:I})}catch(w){console.error("Error scanning for sample user budgets:",w)}finally{r(!1)}}}async function _(){if(!t||!l||l.budgets.length===0&&l.staleBudgetIds.length===0)return;o(!0),f(null);const w=[];let x=0,S=0,C=0;const T=l.totalMonths,I=l.totalBudgets;g({phase:"deleting-months",monthsDeleted:0,totalMonths:T,budgetsDeleted:0,totalBudgets:I,percentComplete:0});for(const U of l.budgets)try{const O=(await ur("months",`delete sample user budget: fetching month IDs for budget ${U.budgetId}`)).docs.filter(P=>P.data.budget_id===U.budgetId).map(P=>({collectionPath:"months",docId:P.id}));O.length>0&&(await MT(O,`delete sample user budget: deleting ${O.length} months for budget ${U.budgetId}`,P=>{x=P,g({phase:"deleting-months",monthsDeleted:x,totalMonths:T,budgetsDeleted:S,totalBudgets:I,percentComplete:Math.round(x/Math.max(T,1)*60)})}),x=O.length)}catch(H){w.push(`Failed to delete months for budget ${U.budgetId}: ${H instanceof Error?H.message:"Unknown error"}`)}g({phase:"deleting-payees",monthsDeleted:x,totalMonths:T,budgetsDeleted:S,totalBudgets:I,percentComplete:60});for(const U of l.budgets)try{await $y("payees",U.budgetId,`delete sample user budget: deleting payees for budget ${U.budgetId}`),C++}catch{}g({phase:"deleting-budgets",monthsDeleted:x,totalMonths:T,budgetsDeleted:S,totalBudgets:I,percentComplete:70});for(const U of l.budgets)try{await $y("budgets",U.budgetId,`delete sample user budget: deleting budget ${U.budgetId}`),S++,g({phase:"deleting-budgets",monthsDeleted:x,totalMonths:T,budgetsDeleted:S,totalBudgets:I,percentComplete:70+Math.round(S/I*10)})}catch(H){w.push(`Failed to delete budget ${U.budgetId}: ${H instanceof Error?H.message:"Unknown error"}`)}g({phase:"updating-user",monthsDeleted:x,totalMonths:T,budgetsDeleted:S,totalBudgets:I,percentComplete:80});const M=[...l.budgets.map(U=>U.budgetId),...l.staleBudgetIds];try{const U=await ur("users","delete sample user budget: finding sample user document to remove budget references",[{field:"email",op:"==",value:ey}]);if(U.docs.length>0){const H=U.docs[0],O=H.id,P=H.data,N=(P.budget_ids||[]).filter(V=>!M.includes(V));await Nr("users",O,{...P,budget_ids:N,updated_at:new Date().toISOString()},"delete sample user budget: removing deleted budget IDs from sample user document"),console.log(`delete sample user budget: removed ${M.length} budget IDs from sample user document`)}else console.log("delete sample user budget: no sample user document found, skipping user update")}catch(U){w.push(`Failed to update sample user document: ${U instanceof Error?U.message:"Unknown error"}`)}g({phase:"clearing-cache",monthsDeleted:x,totalMonths:T,budgetsDeleted:S,totalBudgets:I,percentComplete:95}),Ha(),g({phase:"complete",monthsDeleted:x,totalMonths:T,budgetsDeleted:S,totalBudgets:I,percentComplete:100}),f({budgetsDeleted:S,monthsDeleted:x,payeesDeleted:C,errors:w}),o(!1),g(null),w.length===0&&(u({budgets:[],totalBudgets:0,totalMonths:0,hasPayees:!1,staleBudgetIds:[]}),e?.())}return{status:l,isScanning:n,scanStatus:b,isDeleting:i,deleteResult:h,deleteProgress:p,deleteSampleUserBudget:_}}function YS(t){if(!t)return 0;let e=0;for(const n of t)ht(n.start_balance??0)&&e++,ht(n.end_balance??0)&&e++,ht(n.allocated??0)&&e++,ht(n.spent??0)&&e++,ht(n.income??0)&&e++,ht(n.expenses??0)&&e++,ht(n.net_change??0)&&e++;return e}function XS(t){if(!t)return 0;let e=0;for(const n of t)ht(n.amount??0)&&e++;return e}async function ZS(){const t=await ur("budgets","precision cleanup: scanning all budgets");let e=0,n=0,r=0,i=0;for(const g of t.docs){const b=g.data;let _=!1;ht(b.total_available??0)&&(i++,_=!0);const w=b.accounts;if(w&&typeof w=="object")for(const S of Object.values(w))ht(S.balance??0)&&(n++,_=!0);const x=b.categories;if(x&&typeof x=="object")for(const S of Object.values(x))ht(S.balance??0)&&(r++,_=!0),ht(S.default_monthly_amount??0)&&(r++,_=!0);_&&e++}const o=await ur("months","precision cleanup: scanning all months");let l=0,u=0,h=0,f=0,p=0;for(const g of o.docs){const b=g.data;let _=!1;(ht(b.total_income??0)||ht(b.total_expenses??0)||ht(b.previous_month_income??0))&&(_=!0);const w=XS(b.income);w>0&&(u+=w,_=!0);const x=XS(b.expenses);x>0&&(h+=x,_=!0);const S=YS(b.category_balances);S>0&&(f+=S,_=!0);const C=YS(b.account_balances);C>0&&(p+=C,_=!0),_&&l++}return{totalBudgets:t.docs.length,budgetsWithPrecisionIssues:e,accountsWithPrecisionIssues:n,categoriesWithPrecisionIssues:r,totalAvailableWithPrecisionIssues:i,totalMonths:o.docs.length,monthsWithPrecisionIssues:l,incomeValuesWithPrecisionIssues:u,expenseValuesWithPrecisionIssues:h,categoryBalancesWithPrecisionIssues:f,accountBalancesWithPrecisionIssues:p}}function JS(t){const e={...t};return e.start_balance!==void 0&&(e.start_balance=je(e.start_balance)),e.end_balance!==void 0&&(e.end_balance=je(e.end_balance)),e.allocated!==void 0&&(e.allocated=je(e.allocated)),e.spent!==void 0&&(e.spent=je(e.spent)),e.income!==void 0&&(e.income=je(e.income)),e.expenses!==void 0&&(e.expenses=je(e.expenses)),e.transfers!==void 0&&(e.transfers=je(e.transfers)),e.adjustments!==void 0&&(e.adjustments=je(e.adjustments)),e.net_change!==void 0&&(e.net_change=je(e.net_change)),e}function GB(t,e){let n=!1;ht(t.total_available??0)&&(t.total_available=je(t.total_available??0),e.totalAvailableFixed++,n=!0);const r=t.accounts;if(r&&typeof r=="object")for(const[o,l]of Object.entries(r)){const u=l;ht(u.balance??0)&&(r[o].balance=je(u.balance??0),e.accountsFixed++,n=!0)}const i=t.categories;if(i&&typeof i=="object")for(const[o,l]of Object.entries(i)){const u=l;ht(u.balance??0)&&(i[o].balance=je(u.balance??0),e.categoriesFixed++,n=!0),ht(u.default_monthly_amount??0)&&(i[o].default_monthly_amount=je(u.default_monthly_amount??0),e.categoriesFixed++,n=!0)}return{fixed:n,data:t}}function WB(t,e){let n=!1;if(ht(t.total_income??0)&&(t.total_income=je(t.total_income??0),n=!0),ht(t.total_expenses??0)&&(t.total_expenses=je(t.total_expenses??0),n=!0),ht(t.previous_month_income??0)&&(t.previous_month_income=je(t.previous_month_income??0),n=!0),t.income&&Array.isArray(t.income)){const r=[];for(const i of t.income)ht(i.amount??0)?(r.push({...i,amount:je(i.amount??0)}),e.incomeValuesFixed++,n=!0):r.push(i);t.income=r}if(t.expenses&&Array.isArray(t.expenses)){const r=[];for(const i of t.expenses)ht(i.amount??0)?(r.push({...i,amount:je(i.amount??0)}),e.expenseValuesFixed++,n=!0):r.push(i);t.expenses=r}if(t.category_balances&&Array.isArray(t.category_balances)){const r=[];for(const i of t.category_balances)ht(i.start_balance??0)||ht(i.end_balance??0)||ht(i.allocated??0)||ht(i.spent??0)||ht(i.transfers??0)||ht(i.adjustments??0)?(r.push(JS(i)),e.categoryBalancesFixed++,n=!0):r.push(i);t.category_balances=r}if(t.account_balances&&Array.isArray(t.account_balances)){const r=[];for(const i of t.account_balances)ht(i.start_balance??0)||ht(i.end_balance??0)||ht(i.income??0)||ht(i.expenses??0)||ht(i.transfers??0)||ht(i.adjustments??0)||ht(i.net_change??0)?(r.push(JS(i)),e.accountBalancesFixed++,n=!0):r.push(i);t.account_balances=r}return{fixed:n,data:t}}function QB(t,e,n){const r={...t.data},{fixed:i,data:o}=GB(r,n),l=i?{budgetId:t.id,data:o}:null;i&&n.budgetsProcessed++;const u=[];let h=!1;for(const f of e){const p={...f.data},{fixed:g,data:b}=WB(p,n);g&&(n.monthsProcessed++,h=!0),u.push(b)}return{budgetUpdate:l,fixedMonths:u,hasMonthFixes:h}}async function KB(){const t={budgetsProcessed:0,accountsFixed:0,categoriesFixed:0,totalAvailableFixed:0,monthsProcessed:0,incomeValuesFixed:0,expenseValuesFixed:0,categoryBalancesFixed:0,accountBalancesFixed:0,errors:[]},{budgets:e,monthsByBudget:n}=await nr("precision cleanup"),r=[],i=[];for(const o of e)try{const l=n.get(o.id)||[],{budgetUpdate:u,fixedMonths:h,hasMonthFixes:f}=QB(o,l,t);u&&r.push(u),(f||h.length>0)&&i.push({budgetId:o.id,months:h})}catch(l){t.errors.push(`Budget ${o.id}: ${l instanceof Error?l.message:String(l)}`)}if(r.length>0)try{await Im(r,"precision cleanup")}catch(o){t.errors.push(`Budget batch write: ${o instanceof Error?o.message:String(o)}`)}for(const{budgetId:o,months:l}of i)try{await cA(o,l,"precision cleanup")}catch(u){t.errors.push(`Budget ${o} recalc: ${u instanceof Error?u.message:String(u)}`)}return t}function YB({currentUser:t,onComplete:e}){const[n,r]=R.useState(null),[i,o]=R.useState(!1),[l,u]=R.useState(!1),[h,f]=R.useState(null),[p,g]=R.useState(null),b=n?n.accountsWithPrecisionIssues+n.categoriesWithPrecisionIssues+n.totalAvailableWithPrecisionIssues+n.incomeValuesWithPrecisionIssues+n.expenseValuesWithPrecisionIssues+n.categoryBalancesWithPrecisionIssues+n.accountBalancesWithPrecisionIssues:0,_=b>0,w=R.useCallback(async()=>{if(t){o(!0),g(null);try{const S=await ZS();r(S),f(null)}catch(S){g(S instanceof Error?S.message:"Failed to scan for precision issues")}finally{o(!1)}}},[t]),x=R.useCallback(async()=>{if(!(!t||!_)){u(!0),g(null);try{const S=await Rm(()=>KB());f(S);const C=await ZS();r(C),e?.()}catch(S){g(S instanceof Error?S.message:"Failed to run precision cleanup")}finally{u(!1)}}},[t,_,e]);return{status:n,isScanning:i,isRunning:l,result:h,error:p,totalIssues:b,hasIssues:_,hasData:n!==null,scan:w,runCleanup:x}}function c_(t){const e=t.income||[],n=t.expenses||[],r=je(e.reduce((u,h)=>u+h.amount,0)),i=je(n.reduce((u,h)=>u+h.amount,0)),o=XB(t),l=ZB(t);return{...t,total_income:r,total_expenses:i,account_balances:o,category_balances:l}}function XB(t){const e=t.income||[],n=t.expenses||[],r=t.transfers||[],i=t.adjustments||[],o=t.account_balances||[],l=new Map;for(const f of o)rt(f.account_id)||l.set(f.account_id,f);const u=new Set;for(const f of e)rt(f.account_id)||u.add(f.account_id);for(const f of n)rt(f.account_id)||u.add(f.account_id);for(const f of r)rt(f.from_account_id)||u.add(f.from_account_id),rt(f.to_account_id)||u.add(f.to_account_id);for(const f of i)rt(f.account_id)||u.add(f.account_id);for(const f of o)rt(f.account_id)||u.add(f.account_id);const h=[];for(const f of u){const p=l.get(f),g=je(p?.start_balance??0),b=je(e.filter(I=>I.account_id===f).reduce((I,M)=>I+M.amount,0)),_=je(n.filter(I=>I.account_id===f).reduce((I,M)=>I+M.amount,0)),w=je(r.filter(I=>I.from_account_id===f).reduce((I,M)=>I-M.amount,0)),x=je(r.filter(I=>I.to_account_id===f).reduce((I,M)=>I+M.amount,0)),S=je(x+w),C=je(i.filter(I=>I.account_id===f).reduce((I,M)=>I+M.amount,0)),T=je(b+_+S+C);h.push({account_id:f,start_balance:g,income:b,expenses:_,transfers:S,adjustments:C,net_change:T,end_balance:je(g+T)})}return h}function ZB(t){const e=t.expenses||[],n=t.transfers||[],r=t.adjustments||[],i=t.category_balances||[],o=new Map;for(const g of i)ct(g.category_id)||o.set(g.category_id,g);const{spentMap:l,transfersMap:u,adjustmentsMap:h}=BT(e,n,r),f=new Set;for(const g of i)ct(g.category_id)||f.add(g.category_id);for(const g of e)ct(g.category_id)||f.add(g.category_id);for(const g of n)ct(g.from_category_id)||f.add(g.from_category_id),ct(g.to_category_id)||f.add(g.to_category_id);for(const g of r)ct(g.category_id)||f.add(g.category_id);const p=[];for(const g of f){const b=o.get(g),_=l[g]??0,w=u[g]??0,x=h[g]??0;if(b){const S=je(b.start_balance),C=je(b.allocated);p.push({category_id:g,start_balance:S,allocated:C,spent:_,transfers:w,adjustments:x,end_balance:je(S+C+_+w+x)})}else p.push({category_id:g,start_balance:0,allocated:0,spent:_,transfers:w,adjustments:x,end_balance:je(_+w+x)})}return p}const JB=["unknown","Unknown","UNKNOWN","","null","undefined","N/A","n/a"],e3=["unknown","Unknown","UNKNOWN","","null","undefined","N/A","n/a"];function Dm(t){return!t||rt(t)?!0:JB.includes(t)}function km(t){return!t||ct(t)?!0:e3.includes(t)}function uA(t){return Dm(t.account_id)||km(t.category_id)}function t3(t){return{id:t.id.replace("expense_","adjustment_"),amount:t.amount,account_id:Dm(t.account_id)?Gt:t.account_id,category_id:km(t.category_id)?Zt:t.category_id,date:t.date,description:t.description||t.payee,cleared:t.cleared,created_at:t.created_at}}function n3(t){const e=t.data,n=e.expenses||[],r=e.adjustments||[],i=[],o=[];let l=0,u=0;for(const f of n)uA(f)?(Dm(f.account_id)&&!rt(f.account_id)&&l++,km(f.category_id)&&!ct(f.category_id)&&u++,o.push(t3(f))):i.push(f);return o.length===0?{needsUpdate:!1,updatedMonth:null,stats:{expensesMigrated:0,invalidAccountsFixed:0,invalidCategoriesFixed:0}}:{needsUpdate:!0,updatedMonth:c_({...e,expenses:i,adjustments:[...r,...o],transfers:e.transfers||[],updated_at:new Date().toISOString()}),stats:{expensesMigrated:o.length,invalidAccountsFixed:l,invalidCategoriesFixed:u}}}async function r3(){const{budgets:t,monthsByBudget:e}=await nr("expense-to-adjustment-scan");let n=0,r=0,i=0,o=0;for(const l of t){const u=e.get(l.id)||[];n+=u.length;for(const h of u){const p=h.data.expenses||[];for(const g of p)uA(g)&&(r++,Dm(g.account_id)&&!rt(g.account_id)&&i++,km(g.category_id)&&!ct(g.category_id)&&o++)}}return{totalBudgets:t.length,totalMonths:n,expensesToMigrate:r,invalidAccountsToFix:i,invalidCategoriesToFix:o}}async function s3(){const{budgets:t,monthsByBudget:e}=await nr("expense-to-adjustment-migration"),n=[];let r=0,i=0,o=0;const l=[];for(const u of t){const h=e.get(u.id)||[];for(const f of h)try{const{needsUpdate:p,updatedMonth:g,stats:b}=n3(f);p&&g&&(n.push({budgetId:u.id,year:f.year,month:f.month,data:g}),r+=b.expensesMigrated,i+=b.invalidAccountsFixed,o+=b.invalidCategoriesFixed)}catch(p){l.push(`Month ${f.year}/${f.month} in budget ${u.id}: ${p instanceof Error?p.message:String(p)}`)}}return n.length>0&&await Xa(n,"expense-to-adjustment-migration"),{budgetsProcessed:t.length,monthsProcessed:n.length,expensesMigrated:r,invalidAccountsFixed:i,invalidCategoriesFixed:o,errors:l}}function i3({currentUser:t,onComplete:e}){const[n,r]=R.useState(!1),[i,o]=R.useState(!1),[l,u]=R.useState(null),[h,f]=R.useState(null);async function p(){if(t){r(!0);try{const _=await r3();u(_)}catch(_){console.error("Failed to scan for expense to adjustment migration:",_)}finally{r(!1)}}}async function g(){if(t){o(!0),f(null);try{const _=await Rm(()=>s3());f(_),e?.()}catch(_){f({budgetsProcessed:0,monthsProcessed:0,expensesMigrated:0,invalidAccountsFixed:0,invalidCategoriesFixed:0,errors:[_ instanceof Error?_.message:"Unknown error"]})}finally{o(!1)}}}const b=l!==null&&l.expensesToMigrate>0;return{status:l,isScanning:n,scanStatus:p,hasItemsToMigrate:b,isRunning:i,result:h,runMigration:g}}function dA(t){const e=new Set,n=new Set,r=t.categories;if(r)for(const o of Object.keys(r))e.add(o);const i=t.accounts;if(i)for(const o of Object.keys(i))n.add(o);return{categoryIds:e,accountIds:n}}function Ta(t,e){return!t||ct(t)?!1:!e.has(t)}function Fs(t,e){return!t||rt(t)?!1:!e.has(t)}function a3(t,e){const n=t.data;let r=0,i=0,o=0,l=0,u=0,h=0,f=!1;const p=(n.expenses||[]).map(x=>{const S={...x};let C=!1;return Ta(x.category_id,e.categoryIds)&&(S.category_id=Zt,r++,C=!0),Fs(x.account_id,e.accountIds)&&(S.account_id=Gt,i++,C=!0),C&&(o++,f=!0),S}),g=(n.income||[]).map(x=>{const S={...x};let C=!1;return Fs(x.account_id,e.accountIds)&&(S.account_id=Gt,i++,C=!0),C&&(l++,f=!0),S}),b=(n.transfers||[]).map(x=>{const S={...x};let C=!1;return Ta(x.from_category_id,e.categoryIds)&&(S.from_category_id=Zt,r++,C=!0),Ta(x.to_category_id,e.categoryIds)&&(S.to_category_id=Zt,r++,C=!0),Fs(x.from_account_id,e.accountIds)&&(S.from_account_id=Gt,i++,C=!0),Fs(x.to_account_id,e.accountIds)&&(S.to_account_id=Gt,i++,C=!0),C&&(u++,f=!0),S}),_=(n.adjustments||[]).map(x=>{const S={...x};let C=!1;return Ta(x.category_id,e.categoryIds)&&(S.category_id=Zt,r++,C=!0),Fs(x.account_id,e.accountIds)&&(S.account_id=Gt,i++,C=!0),C&&(h++,f=!0),S});return f?{needsUpdate:!0,updatedMonth:{...n,expenses:p,income:g,transfers:b,adjustments:_,updated_at:new Date().toISOString()},stats:{categoryIdsFixed:r,accountIdsFixed:i,affectedExpenses:o,affectedIncome:l,affectedTransfers:u,affectedAdjustments:h}}:{needsUpdate:!1,updatedMonth:null,stats:{categoryIdsFixed:0,accountIdsFixed:0,affectedExpenses:0,affectedIncome:0,affectedTransfers:0,affectedAdjustments:0}}}async function o3(){const{budgets:t,monthsByBudget:e}=await nr("orphaned-id-scan");let n=0,r=0,i=0,o=0,l=0,u=0,h=0;for(const f of t){const p=dA(f.data),g=e.get(f.id)||[];n+=g.length;for(const b of g){const _=b.data;for(const w of _.expenses||[]){let x=!1;Ta(w.category_id,p.categoryIds)&&(r++,x=!0),Fs(w.account_id,p.accountIds)&&(i++,x=!0),x&&o++}for(const w of _.income||[])Fs(w.account_id,p.accountIds)&&(i++,l++);for(const w of _.transfers||[]){let x=!1;Ta(w.from_category_id,p.categoryIds)&&(r++,x=!0),Ta(w.to_category_id,p.categoryIds)&&(r++,x=!0),Fs(w.from_account_id,p.accountIds)&&(i++,x=!0),Fs(w.to_account_id,p.accountIds)&&(i++,x=!0),x&&u++}for(const w of _.adjustments||[]){let x=!1;Ta(w.category_id,p.categoryIds)&&(r++,x=!0),Fs(w.account_id,p.accountIds)&&(i++,x=!0),x&&h++}}}return{totalBudgets:t.length,totalMonths:n,orphanedCategoryIds:r,orphanedAccountIds:i,affectedExpenses:o,affectedIncome:l,affectedTransfers:u,affectedAdjustments:h}}async function l3(){const{budgets:t,monthsByBudget:e}=await nr("orphaned-id-cleanup"),n=[];let r=0,i=0;const o=[];for(const l of t){const u=dA(l.data),h=e.get(l.id)||[];for(const f of h)try{const{needsUpdate:p,updatedMonth:g,stats:b}=a3(f,u);p&&g&&(n.push({budgetId:l.id,year:f.year,month:f.month,data:g}),r+=b.categoryIdsFixed,i+=b.accountIdsFixed)}catch(p){o.push(`Month ${f.year}/${f.month} in budget ${l.id}: ${p instanceof Error?p.message:String(p)}`)}}return n.length>0&&await Xa(n,"orphaned-id-cleanup"),{budgetsProcessed:t.length,monthsProcessed:n.length,categoryIdsFixed:r,accountIdsFixed:i,errors:o}}function c3({currentUser:t,onComplete:e}){const[n,r]=R.useState(!1),[i,o]=R.useState(!1),[l,u]=R.useState(null),[h,f]=R.useState(null);async function p(){if(t){r(!0);try{const _=await o3();u(_)}catch(_){console.error("Failed to scan for orphaned IDs:",_)}finally{r(!1)}}}async function g(){if(t){o(!0),f(null);try{const _=await Rm(()=>l3());f(_),e?.()}catch(_){f({budgetsProcessed:0,monthsProcessed:0,categoryIdsFixed:0,accountIdsFixed:0,errors:[_ instanceof Error?_.message:"Unknown error"]})}finally{o(!1)}}}const b=l!==null&&(l.orphanedCategoryIds>0||l.orphanedAccountIds>0);return{status:l,isScanning:n,scanStatus:p,hasItemsToFix:b,isRunning:i,result:h,runMigration:g}}function u3(t,e){if(t.date!==e.date||Math.abs(t.amount+e.amount)>.001)return null;const n=t.amount<0?t:e,r=t.amount<0?e:t,i=ct(t.category_id)&&ct(e.category_id),o=!rt(t.account_id)&&!rt(e.account_id),l=t.account_id!==e.account_id;if(i&&o&&l)return{negative:n,positive:r,type:"account"};const u=rt(t.account_id)&&rt(e.account_id),h=!ct(t.category_id)&&!ct(e.category_id),f=t.category_id!==e.category_id;return u&&h&&f?{negative:n,positive:r,type:"category"}:null}function hA(t){const e=[],n=new Set;for(let r=0;r<t.length;r++)if(!n.has(t[r].id))for(let i=r+1;i<t.length;i++){if(n.has(t[i].id))continue;const o=u3(t[r],t[i]);if(o){e.push(o),n.add(t[r].id),n.add(t[i].id);break}}return e}function d3(t){const{negative:e,positive:n,type:r}=t;return r==="account"?{id:`transfer_from_adj_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,amount:Math.abs(e.amount),from_account_id:e.account_id,to_account_id:n.account_id,from_category_id:Zt,to_category_id:Zt,date:e.date,description:e.description||n.description||"Transfer",cleared:e.cleared&&n.cleared,created_at:new Date().toISOString()}:{id:`transfer_from_adj_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,amount:Math.abs(e.amount),from_account_id:Gt,to_account_id:Gt,from_category_id:e.category_id,to_category_id:n.category_id,date:e.date,description:e.description||n.description||"Transfer",cleared:e.cleared&&n.cleared,created_at:new Date().toISOString()}}function h3(t){const e=t.data,n=e.adjustments||[],r=e.transfers||[],i=hA(n);if(i.length===0)return{needsUpdate:!1,updatedMonth:null,stats:{pairsConverted:0,adjustmentsRemoved:0}};const o=i.map(d3),l=new Set;for(const f of i)l.add(f.negative.id),l.add(f.positive.id);const u=n.filter(f=>!l.has(f.id));return{needsUpdate:!0,updatedMonth:{...e,adjustments:u,transfers:[...r,...o],updated_at:new Date().toISOString()},stats:{pairsConverted:i.length,adjustmentsRemoved:l.size}}}async function f3(){const{budgets:t,monthsByBudget:e}=await nr("adjustments-to-transfers-scan");let n=0,r=0,i=0,o=0;for(const l of t){const u=e.get(l.id)||[];n+=u.length;for(const h of u){const p=h.data.adjustments||[],g=hA(p);r+=g.length;for(const b of g)b.type==="account"?i++:o++}}return{totalBudgets:t.length,totalMonths:n,pairsFound:r,accountTransferPairs:i,categoryTransferPairs:o}}async function m3(){const{budgets:t,monthsByBudget:e}=await nr("adjustments-to-transfers-migration"),n=[];let r=0,i=0;const o=[];for(const l of t){const u=e.get(l.id)||[];for(const h of u)try{const{needsUpdate:f,updatedMonth:p,stats:g}=h3(h);f&&p&&(n.push({budgetId:l.id,year:h.year,month:h.month,data:p}),r+=g.pairsConverted,i+=g.adjustmentsRemoved)}catch(f){o.push(`Month ${h.year}/${h.month} in budget ${l.id}: ${f instanceof Error?f.message:String(f)}`)}}return n.length>0&&await Xa(n,"adjustments-to-transfers-migration"),{budgetsProcessed:t.length,monthsProcessed:n.length,transfersCreated:r,adjustmentsRemoved:i,errors:o}}function p3({currentUser:t,onComplete:e}){const[n,r]=R.useState(!1),[i,o]=R.useState(!1),[l,u]=R.useState(null),[h,f]=R.useState(null);async function p(){if(t){r(!0);try{const _=await f3();u(_)}catch(_){console.error("Failed to scan for adjustment pairs:",_)}finally{r(!1)}}}async function g(){if(t){o(!0),f(null);try{const _=await Rm(()=>m3());f(_),e?.()}catch(_){f({budgetsProcessed:0,monthsProcessed:0,transfersCreated:0,adjustmentsRemoved:0,errors:[_ instanceof Error?_.message:"Unknown error"]})}finally{o(!1)}}}const b=l!==null&&l.pairsFound>0;return{status:l,isScanning:n,scanStatus:p,hasPairsToConvert:b,isRunning:i,result:h,runMigration:g}}function g3(t){const e=[];let n="",r=!1;for(let i=0;i<t.length;i++){const o=t[i];o==='"'?r=!r:o===","&&!r?(e.push(n.trim()),n=""):n+=o}return e.push(n.trim()),e}function y3(t){if(!t)return 0;let e=t.replace(/[$\s]/g,"");const n=e.startsWith("(")||e.startsWith("-");e=e.replace(/[()]/g,"").replace("-",""),e=e.replace(/,/g,"");const r=parseFloat(e);return isNaN(r)?0:n?-r:r}function _3(t){if(!t)return null;const e=t.split("/");if(e.length!==3)return null;const n=parseInt(e[0],10),r=parseInt(e[1],10),i=parseInt(e[2],10);return isNaN(n)||isNaN(r)||isNaN(i)||n<1||n>12||r<1||r>31?null:{year:i,month:n,day:r}}function b3(t){if(!t)return!1;const e=t.toLowerCase().trim();return e==="true"||e==="1"||e==="yes"}function v3(t,e){return e.toLowerCase()==="income"?"income":t.toLowerCase()==="budget allocation"?"allocation":"spend"}function x3(t){const e=t.split(`
`).filter(r=>r.trim()),n=[];for(const r of e){const i=g3(r);if(i.length<5)continue;const[o,l,u,h,f,p,g]=i;if(o.toLowerCase()==="cash flow"||o.toLowerCase()==="date")continue;const b=_3(o);if(!b)continue;const _=v3(l,u),w=y3(f),x=b3(g||"");n.push({recordType:_,date:o,year:b.year,month:b.month,day:b.day,payee:l,category:u,account:h,amount:w,description:p||"",cleared:x,rawLine:r})}return n}function w3(t){return!t.account_id||t.account_id.trim()===""?"Missing account_id (empty or undefined)":null}function S3(t){const e=[];return(!t.account_id||t.account_id.trim()==="")&&e.push("missing account_id"),(!t.category_id||t.category_id.trim()==="")&&e.push("missing category_id"),e.length>0?e.join(", "):null}function E3(t){const e=rt(t.account_id)||!t.account_id||t.account_id.trim()==="",n=ct(t.category_id)||!t.category_id||t.category_id.trim()==="";return e&&n?"Both account_id and category_id are missing/NO_* (must have at least one real ID)":null}function C3(t){const e=[];if((!t.from_account_id||t.from_account_id.trim()==="")&&e.push("missing from_account_id"),(!t.to_account_id||t.to_account_id.trim()==="")&&e.push("missing to_account_id"),(!t.from_category_id||t.from_category_id.trim()==="")&&e.push("missing from_category_id"),(!t.to_category_id||t.to_category_id.trim()==="")&&e.push("missing to_category_id"),e.length>0)return e.join(", ");const n=t.from_account_id===t.to_account_id,r=t.from_category_id===t.to_category_id;if(n&&r)return"Transfer has same from/to on both account and category (nothing would transfer)";const i=rt(t.from_account_id),o=rt(t.to_account_id),l=ct(t.from_category_id),u=ct(t.to_category_id);return i&&o&&l&&u?"All from/to account and category IDs are NO_* (must involve at least one real entity)":i&&o&&r?"Both accounts are NO_ACCOUNT and categories are the same (nothing transfers)":l&&u&&n?"Both categories are NO_CATEGORY and accounts are the same (nothing transfers)":null}function sf(t,e,n,r,i){return t.filter(o=>{const[l,u,h]=e.split("-").map(Number);return o.year!==l||o.month!==u||o.day!==h||Math.abs(Math.abs(o.amount)-Math.abs(n))>.01?!1:(r&&o.payee&&o.payee.toLowerCase()===r.toLowerCase()||i&&o.description&&o.description.toLowerCase().includes(i.toLowerCase()),!0)})}async function T3(t){const e=[];let n=0,r=0,i=0,o=0;const l=t?x3(t):[],{budgets:u,monthsByBudget:h}=await nr("account-category-validation");for(const f of u){const p=h.get(f.id)||[];for(const g of p){const b=g.data,_=`${b.year}-${String(b.month).padStart(2,"0")}`,w=b.income||[];n+=w.length;for(const T of w){const I=w3(T);I&&e.push({budgetId:f.id,monthKey:_,transactionType:"income",transactionId:T.id,violation:I,transactionDetails:{date:T.date,amount:T.amount,payee:T.payee,description:T.description,accountId:T.account_id},potentialSeedMatches:sf(l,T.date,T.amount,T.payee,T.description)})}const x=b.expenses||[];r+=x.length;for(const T of x){const I=S3(T);I&&e.push({budgetId:f.id,monthKey:_,transactionType:"expense",transactionId:T.id,violation:I,transactionDetails:{date:T.date,amount:T.amount,payee:T.payee,description:T.description,accountId:T.account_id,categoryId:T.category_id},potentialSeedMatches:sf(l,T.date,T.amount,T.payee,T.description)})}const S=b.adjustments||[];i+=S.length;for(const T of S){const I=E3(T);I&&e.push({budgetId:f.id,monthKey:_,transactionType:"adjustment",transactionId:T.id,violation:I,transactionDetails:{date:T.date,amount:T.amount,description:T.description,accountId:T.account_id,categoryId:T.category_id},potentialSeedMatches:sf(l,T.date,T.amount,void 0,T.description)})}const C=b.transfers||[];o+=C.length;for(const T of C){const I=C3(T);I&&e.push({budgetId:f.id,monthKey:_,transactionType:"transfer",transactionId:T.id,violation:I,transactionDetails:{date:T.date,amount:T.amount,description:T.description,fromAccountId:T.from_account_id,toAccountId:T.to_account_id,fromCategoryId:T.from_category_id,toCategoryId:T.to_category_id},potentialSeedMatches:sf(l,T.date,T.amount,void 0,T.description)})}}}return e.sort((f,p)=>{const g=f.monthKey.localeCompare(p.monthKey);return g!==0?g:f.transactionType.localeCompare(p.transactionType)}),{totalBudgets:u.length,totalMonths:Array.from(h.values()).reduce((f,p)=>f+p.length,0),totalIncome:n,totalExpenses:r,totalAdjustments:i,totalTransfers:o,violations:e,scannedAt:new Date().toISOString()}}function A3(t){const e=[];if(e.push("=".repeat(80),"ACCOUNT/CATEGORY VALIDATION REPORT",`Scanned at: ${t.scannedAt}`,"=".repeat(80),"","SUMMARY:"),e.push(`  Budgets scanned: ${t.totalBudgets}`,`  Months scanned: ${t.totalMonths}`,`  Income transactions: ${t.totalIncome}`,`  Expense transactions: ${t.totalExpenses}`,`  Adjustment transactions: ${t.totalAdjustments}`,`  Transfer transactions: ${t.totalTransfers}`,`  VIOLATIONS FOUND: ${t.violations.length}`,""),t.violations.length===0)return e.push(" No violations found!"),e.join(`
`);const n=new Map;for(const r of t.violations)n.has(r.transactionType)||n.set(r.transactionType,[]),n.get(r.transactionType).push(r);e.push("-".repeat(80),"VIOLATIONS BY TYPE:","-".repeat(80));for(const[r,i]of n){e.push("",`## ${r.toUpperCase()} (${i.length} violations)`,"");for(const o of i){if(e.push(`  [${o.monthKey}] ID: ${o.transactionId}`,`    Violation: ${o.violation}`,`    Date: ${o.transactionDetails.date}`,`    Amount: ${o.transactionDetails.amount}`),o.transactionDetails.payee&&e.push(`    Payee: ${o.transactionDetails.payee}`),o.transactionDetails.description&&e.push(`    Description: ${o.transactionDetails.description}`),o.transactionDetails.accountId!==void 0&&e.push(`    Account ID: ${o.transactionDetails.accountId||"(empty)"}`),o.transactionDetails.categoryId!==void 0&&e.push(`    Category ID: ${o.transactionDetails.categoryId||"(empty)"}`),o.transactionDetails.fromAccountId!==void 0&&e.push(`    From Account: ${o.transactionDetails.fromAccountId||"(empty)"}`,`    To Account: ${o.transactionDetails.toAccountId||"(empty)"}`,`    From Category: ${o.transactionDetails.fromCategoryId||"(empty)"}`,`    To Category: ${o.transactionDetails.toCategoryId||"(empty)"}`),o.potentialSeedMatches.length>0){e.push(`    POTENTIAL SEED MATCHES (${o.potentialSeedMatches.length}):`);for(const l of o.potentialSeedMatches.slice(0,5))e.push(`      - Line: ${l.rawLine}`,`        Type: ${l.recordType}, Date: ${l.date}, Payee: ${l.payee}`,`        Category: ${l.category}, Account: ${l.account}`);o.potentialSeedMatches.length>5&&e.push(`      ... and ${o.potentialSeedMatches.length-5} more matches`)}else e.push("    No seed matches found");e.push("")}}return e.join(`
`)}function j3({currentUser:t}){const[e,n]=R.useState(!1),[r,i]=R.useState(null),[o,l]=R.useState(null);async function u(h){if(t){n(!0),i(null),l(null);try{const f=await T3(h);i(f),l(A3(f))}catch(f){console.error("Failed to scan transactions:",f),l(`Error scanning: ${f instanceof Error?f.message:"Unknown error"}`)}finally{n(!1)}}}return{isScanning:e,status:r,report:o,scan:u,hasViolations:r!==null&&r.violations.length>0,violationCount:r?.violations.length??0}}async function R3(){const{budgets:t,monthsByBudget:e}=await nr("remove-total-fields-migration-scan");let n=0,r=0,i=0;for(const l of t){const u=e.get(l.id)||[];for(const h of u){const f=h.data,p="total_income"in f&&f.total_income!==void 0,g="total_expenses"in f&&f.total_expenses!==void 0;p&&r++,g&&i++,(p||g)&&n++}}const o=e.size>0?Array.from(e.values()).reduce((l,u)=>l+u.length,0):0;return{totalBudgets:t.length,totalMonths:o,monthsNeedingMigration:n,monthsWithTotalIncome:r,monthsWithTotalExpenses:i}}async function I3(t){const e={budgetsProcessed:0,monthsProcessed:0,monthsUpdated:0,errors:[]};t.setStage("Reading all budgets and months..."),t.setProgress(null);const{budgets:n,monthsByBudget:r}=await nr("remove-total-fields-migration");t.setDetails(`Found ${n.length} budget(s) to process`);const i=[];t.setStage("Processing months...");let o=0;for(const u of r.values())o+=u.length;let l=0;for(const u of n)try{const h=r.get(u.id)||[];for(const f of h){l++;const p=f.data;t.updateItemProgress(l,o,`Month ${p.year}/${p.month}`);const g="total_income"in p&&p.total_income!==void 0,b="total_expenses"in p&&p.total_expenses!==void 0;if(g||b){const{total_income:_,total_expenses:w,...x}=p;i.push({budgetId:u.id,year:p.year,month:p.month,data:{...x,updated_at:new Date().toISOString()}}),e.monthsUpdated++}e.monthsProcessed++}h.length>0&&e.budgetsProcessed++}catch(h){e.errors.push(`Budget ${u.id}: ${h instanceof Error?h.message:String(h)}`)}return i.length>0&&(t.setStage(`Writing ${i.length} month update(s)...`),t.setProgress(null),t.setCurrentItem(`${i.length} month(s) to update`),await Xa(i,"remove-total-fields-migration")),t.setStage("Migration complete"),t.setProgress(100),e}function D3({currentUser:t}){const[e,n]=R.useState(!1),[r,i]=R.useState(!1),[o,l]=R.useState(null),[u,h]=R.useState(null),{runMigrationWithProgress:f}=Ac();async function p(){if(t){n(!0);try{const w=await R3();l(w)}catch(w){console.error("Failed to scan remove total fields status:",w)}finally{n(!1)}}}async function g(){if(t){i(!0),h(null);try{const w=await f("Remove Total Fields Migration",x=>I3(x));h(w)}catch(w){h({budgetsProcessed:0,monthsProcessed:0,monthsUpdated:0,errors:[w instanceof Error?w.message:"Unknown error"]})}finally{i(!1)}}}const b=o!==null&&o.monthsNeedingMigration>0,_=o?.monthsNeedingMigration??0;return{isScanning:e,isRunning:r,status:o,result:u,scanStatus:p,runMigration:g,needsMigration:b,totalItemsToFix:_}}async function k3(){const{budgets:t,monthsByBudget:e}=await nr("remove-previous-month-income-migration-scan");let n=0;for(const i of t){const o=e.get(i.id)||[];for(const l of o){const u=l.data;"previous_month_income"in u&&u.previous_month_income!==void 0&&n++}}const r=e.size>0?Array.from(e.values()).reduce((i,o)=>i+o.length,0):0;return{totalBudgets:t.length,totalMonths:r,monthsNeedingMigration:n}}async function M3(t){const e={budgetsProcessed:0,monthsProcessed:0,monthsUpdated:0,errors:[]},{budgets:n,monthsByBudget:r}=await nr("remove-previous-month-income-migration");t.setStage(`Processing ${n.length} budget(s)...`),t.setProgress(0);const i=[];for(let o=0;o<n.length;o++){const l=n[o];t.setProgress(o/n.length*100),t.setCurrentItem(`Budget ${o+1}/${n.length}: ${l.id}`);try{const u=r.get(l.id)||[];for(const h of u){const f=h.data;if("previous_month_income"in f&&f.previous_month_income!==void 0){const{previous_month_income:g,...b}=f;i.push({budgetId:l.id,year:f.year,month:f.month,data:{...b,updated_at:new Date().toISOString()}}),e.monthsUpdated++}e.monthsProcessed++}u.length>0&&e.budgetsProcessed++}catch(u){e.errors.push(`Budget ${l.id}: ${u instanceof Error?u.message:String(u)}`)}}return i.length>0&&(t.setStage(`Writing ${i.length} month update(s)...`),t.setProgress(null),t.setCurrentItem(`${i.length} month(s) to update`),await Xa(i,"remove-previous-month-income-migration")),t.setStage("Migration complete"),t.setProgress(100),e}function O3({currentUser:t}){const[e,n]=R.useState(!1),[r,i]=R.useState(!1),[o,l]=R.useState(null),[u,h]=R.useState(null),{runMigrationWithProgress:f}=Ac();async function p(){if(t){n(!0);try{const w=await k3();l(w)}catch(w){console.error("Failed to scan remove previous month income status:",w)}finally{n(!1)}}}async function g(){if(t){i(!0),h(null);try{const w=await f("Remove Previous Month Income Migration",x=>M3(x));h(w)}catch(w){h({budgetsProcessed:0,monthsProcessed:0,monthsUpdated:0,errors:[w instanceof Error?w.message:"Unknown error"]})}finally{i(!1)}}}const b=o!==null&&o.monthsNeedingMigration>0,_=o?.monthsNeedingMigration??0;return{isScanning:e,isRunning:r,status:o,result:u,scanStatus:p,runMigration:g,needsMigration:b,totalItemsToFix:_}}async function N3(){const t=await l_("percentage-income-months-back-migration-scan");let e=0;for(const n of t)n.data.percentage_income_months_back===void 0&&e++;return{totalBudgets:t.length,budgetsNeedingMigration:e}}async function P3(t){const e={budgetsProcessed:0,budgetsUpdated:0,errors:[]};t.setStage("Reading all budgets..."),t.setProgress(null);const n=await l_("percentage-income-months-back-migration");t.setDetails(`Found ${n.length} budget(s) to process`);const r=[];for(let i=0;i<n.length;i++){const o=n[i];t.updateItemProgress(i+1,n.length,`Budget: ${o.data.name??o.id}`);try{const l=o.data;l.percentage_income_months_back===void 0&&(r.push({budgetId:o.id,data:{...l,percentage_income_months_back:1}}),e.budgetsProcessed++)}catch(l){e.errors.push(`Budget ${o.id}: ${l instanceof Error?l.message:String(l)}`)}}return r.length>0&&(t.setStage("Writing budget updates..."),t.setProgress(null),t.setCurrentItem(`${r.length} budget(s) to update`),await Im(r,"percentage-income-months-back-migration"),e.budgetsUpdated=r.length),t.setStage("Migration complete"),t.setProgress(100),e}function B3({currentUser:t}){const[e,n]=R.useState(!1),[r,i]=R.useState(!1),[o,l]=R.useState(null),[u,h]=R.useState(null),{runMigrationWithProgress:f}=Ac();async function p(){if(t){n(!0);try{const w=await N3();l(w)}catch(w){console.error("Failed to scan percentage income months back status:",w)}finally{n(!1)}}}async function g(){if(t){i(!0),h(null);try{const w=await f("Percentage Income Months Back",x=>P3(x));h(w)}catch(w){h({budgetsProcessed:0,budgetsUpdated:0,errors:[w instanceof Error?w.message:"Unknown error"]})}finally{i(!1)}}}const b=o!==null&&o.budgetsNeedingMigration>0,_=o?.budgetsNeedingMigration??0;return{isScanning:e,isRunning:r,status:o,result:u,scanStatus:p,runMigration:g,needsMigration:b,totalItemsToFix:_}}async function z3(){const{budgets:t,monthsByBudget:e}=await nr("recalculate-start-balances-migration-scan"),n=Cm(),r=Qe(n.year,n.month);let i=0;for(const l of t){const h=(e.get(l.id)||[]).filter(f=>{const p=f.data;return Qe(p.year,p.month)<=r});i+=h.length}const o=e.size>0?Array.from(e.values()).reduce((l,u)=>l+u.length,0):0;return{totalBudgets:t.length,totalMonths:o,monthsNeedingRecalculation:i}}async function L3(t){const e={budgetsProcessed:0,monthsProcessed:0,monthsUpdated:0,errors:[]};t.setStage("Reading all budgets and months..."),t.setProgress(null);const{budgets:n,monthsByBudget:r}=await nr("recalculate-start-balances-migration");t.setDetails(`Found ${n.length} budget(s) to process`);const i=Cm(),o=Qe(i.year,i.month),l=[];t.setStage("Processing months...");let u=0;for(const f of n){const g=(r.get(f.id)||[]).filter(b=>{const _=b.data;return Qe(_.year,_.month)<=o});u+=g.length}let h=0;for(const f of n)try{const g=(r.get(f.id)||[]).filter(_=>{const w=_.data;return Qe(w.year,w.month)<=o}).sort((_,w)=>{const x=_.data,S=w.data,C=Qe(x.year,x.month),T=Qe(S.year,S.month);return C.localeCompare(T)});if(g.length===0){e.budgetsProcessed++;continue}let b=Oa;for(const _ of g){h++;const w=_.data,x=w.year,S=w.month;t.updateItemProgress(h,u,`Budget ${f.id}: ${x}/${S}`);const C={budget_id:f.id,year_month_ordinal:w.year_month_ordinal,year:x,month:S,income:w.income||[],total_income:0,previous_month_income:0,expenses:w.expenses||[],total_expenses:0,transfers:w.transfers||[],adjustments:w.adjustments||[],account_balances:w.account_balances||[],category_balances:w.category_balances||[],are_allocations_finalized:w.are_allocations_finalized??!1,created_at:w.created_at,updated_at:w.updated_at},T=Sd(C),I=Ed(T,b);b=dc(I);const M=Tm(I);l.push({budgetId:f.id,year:x,month:S,data:M}),e.monthsUpdated++,e.monthsProcessed++}e.budgetsProcessed++}catch(p){e.errors.push(`Budget ${f.id}: ${p instanceof Error?p.message:String(p)}`)}return l.length>0&&(t.setStage(`Writing ${l.length} month update(s)...`),t.setProgress(null),t.setCurrentItem(`${l.length} month(s) to update`),await Xa(l,"recalculate-start-balances-migration")),t.setStage("Migration complete"),t.setProgress(100),e}function U3({currentUser:t}){const[e,n]=R.useState(!1),[r,i]=R.useState(!1),[o,l]=R.useState(null),[u,h]=R.useState(null),{runMigrationWithProgress:f}=Ac();async function p(){if(t){n(!0);try{const w=await z3();l(w)}catch(w){console.error("Failed to scan recalculate start balances status:",w)}finally{n(!1)}}}async function g(){if(t){i(!0),h(null);try{const w=await f("Recalculate Start Balances Migration",x=>L3(x));h(w)}catch(w){h({budgetsProcessed:0,monthsProcessed:0,monthsUpdated:0,errors:[w instanceof Error?w.message:"Unknown error"]})}finally{i(!1)}}}const b=o!==null&&o.monthsNeedingRecalculation>0,_=o?.monthsNeedingRecalculation??0;return{isScanning:e,isRunning:r,status:o,result:u,scanStatus:p,runMigration:g,needsMigration:b,totalItemsToFix:_}}async function F3(){const{budgets:t,monthsByBudget:e}=await nr("repair-month-map-migration-scan");let n=0,r=0,i=0;for(const l of t){const u=e.get(l.id)||[],f=l.data.month_map||{},p=new Set;for(const _ of u){const w=Qe(_.year,_.month);p.add(w)}let g=0;for(const _ of p)_ in f||g++;let b=0;for(const _ of Object.keys(f))p.has(_)||b++;(g>0||b>0)&&(n++,r+=g,i+=b)}const o=e.size>0?Array.from(e.values()).reduce((l,u)=>l+u.length,0):0;return{totalBudgets:t.length,totalMonths:o,budgetsNeedingRepair:n,totalMissingMonths:r,totalOrphanedEntries:i}}async function V3(t){const e={budgetsProcessed:0,budgetsUpdated:0,monthsAdded:0,orphanedEntriesRemoved:0,errors:[]};t.setStage("Reading all budgets and months..."),t.setProgress(null);const{budgets:n,monthsByBudget:r}=await nr("repair-month-map-migration");t.setDetails(`Found ${n.length} budget(s) to process`);const i=[];t.setStage("Processing budgets...");let o=0;for(const l of n)try{o++;const u=r.get(l.id)||[],f=l.data.month_map||{};t.updateItemProgress(o,n.length,`Budget ${l.id}`);const p=new Set;for(const w of u){const x=Qe(w.year,w.month);p.add(x)}const g={...f};let b=0,_=0;for(const w of p)w in g||(g[w]={},b++);for(const w of Object.keys(g))p.has(w)||(delete g[w],_++);(b>0||_>0)&&(i.push({budgetId:l.id,data:{...l.data,month_map:g,updated_at:new Date().toISOString()}}),e.monthsAdded+=b,e.orphanedEntriesRemoved+=_,e.budgetsUpdated++),e.budgetsProcessed++}catch(u){e.errors.push(`Budget ${l.id}: ${u instanceof Error?u.message:String(u)}`)}return i.length>0&&(t.setStage(`Writing ${i.length} budget update(s)...`),t.setProgress(null),t.setCurrentItem(`${i.length} budget(s) to update`),await Im(i,"repair-month-map-migration")),t.setStage("Migration complete"),t.setProgress(100),e}function $3({currentUser:t}){const[e,n]=R.useState(!1),[r,i]=R.useState(!1),[o,l]=R.useState(null),[u,h]=R.useState(null),{runMigrationWithProgress:f}=Ac();async function p(){if(t){n(!0);try{const w=await F3();l(w)}catch(w){console.error("Failed to scan repair month map status:",w)}finally{n(!1)}}}async function g(){if(t){i(!0),h(null);try{const w=await f("Repair Month Map Migration",x=>V3(x));h(w)}catch(w){h({budgetsProcessed:0,budgetsUpdated:0,monthsAdded:0,orphanedEntriesRemoved:0,errors:[w instanceof Error?w.message:"Unknown error"]})}finally{i(!1)}}}const b=o!==null&&(o.totalMissingMonths>0||o.totalOrphanedEntries>0),_=o?o.totalMissingMonths+o.totalOrphanedEntries:0;return{isScanning:e,isRunning:r,status:o,result:u,scanStatus:p,runMigration:g,needsMigration:b,totalItemsToFix:_}}function af(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var ty={exports:{}};var e1;function q3(){return e1||(e1=1,(function(t,e){(function(n){t.exports=n()})(function(){return(function n(r,i,o){function l(f,p){if(!i[f]){if(!r[f]){var g=typeof af=="function"&&af;if(!p&&g)return g(f,!0);if(u)return u(f,!0);var b=new Error("Cannot find module '"+f+"'");throw b.code="MODULE_NOT_FOUND",b}var _=i[f]={exports:{}};r[f][0].call(_.exports,function(w){var x=r[f][1][w];return l(x||w)},_,_.exports,n,r,i,o)}return i[f].exports}for(var u=typeof af=="function"&&af,h=0;h<o.length;h++)l(o[h]);return l})({1:[function(n,r,i){var o=n("./utils"),l=n("./support"),u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(h){for(var f,p,g,b,_,w,x,S=[],C=0,T=h.length,I=T,M=o.getTypeOf(h)!=="string";C<h.length;)I=T-C,g=M?(f=h[C++],p=C<T?h[C++]:0,C<T?h[C++]:0):(f=h.charCodeAt(C++),p=C<T?h.charCodeAt(C++):0,C<T?h.charCodeAt(C++):0),b=f>>2,_=(3&f)<<4|p>>4,w=1<I?(15&p)<<2|g>>6:64,x=2<I?63&g:64,S.push(u.charAt(b)+u.charAt(_)+u.charAt(w)+u.charAt(x));return S.join("")},i.decode=function(h){var f,p,g,b,_,w,x=0,S=0,C="data:";if(h.substr(0,C.length)===C)throw new Error("Invalid base64 input, it looks like a data url.");var T,I=3*(h=h.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(h.charAt(h.length-1)===u.charAt(64)&&I--,h.charAt(h.length-2)===u.charAt(64)&&I--,I%1!=0)throw new Error("Invalid base64 input, bad content length.");for(T=l.uint8array?new Uint8Array(0|I):new Array(0|I);x<h.length;)f=u.indexOf(h.charAt(x++))<<2|(b=u.indexOf(h.charAt(x++)))>>4,p=(15&b)<<4|(_=u.indexOf(h.charAt(x++)))>>2,g=(3&_)<<6|(w=u.indexOf(h.charAt(x++))),T[S++]=f,_!==64&&(T[S++]=p),w!==64&&(T[S++]=g);return T}},{"./support":30,"./utils":32}],2:[function(n,r,i){var o=n("./external"),l=n("./stream/DataWorker"),u=n("./stream/Crc32Probe"),h=n("./stream/DataLengthProbe");function f(p,g,b,_,w){this.compressedSize=p,this.uncompressedSize=g,this.crc32=b,this.compression=_,this.compressedContent=w}f.prototype={getContentWorker:function(){var p=new l(o.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new h("data_length")),g=this;return p.on("end",function(){if(this.streamInfo.data_length!==g.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),p},getCompressedWorker:function(){return new l(o.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},f.createWorkerFrom=function(p,g,b){return p.pipe(new u).pipe(new h("uncompressedSize")).pipe(g.compressWorker(b)).pipe(new h("compressedSize")).withStreamInfo("compression",g)},r.exports=f},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(n,r,i){var o=n("./stream/GenericWorker");i.STORE={magic:"\0\0",compressWorker:function(){return new o("STORE compression")},uncompressWorker:function(){return new o("STORE decompression")}},i.DEFLATE=n("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(n,r,i){var o=n("./utils"),l=(function(){for(var u,h=[],f=0;f<256;f++){u=f;for(var p=0;p<8;p++)u=1&u?3988292384^u>>>1:u>>>1;h[f]=u}return h})();r.exports=function(u,h){return u!==void 0&&u.length?o.getTypeOf(u)!=="string"?(function(f,p,g,b){var _=l,w=b+g;f^=-1;for(var x=b;x<w;x++)f=f>>>8^_[255&(f^p[x])];return-1^f})(0|h,u,u.length,0):(function(f,p,g,b){var _=l,w=b+g;f^=-1;for(var x=b;x<w;x++)f=f>>>8^_[255&(f^p.charCodeAt(x))];return-1^f})(0|h,u,u.length,0):0}},{"./utils":32}],5:[function(n,r,i){i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!0,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],6:[function(n,r,i){var o=null;o=typeof Promise<"u"?Promise:n("lie"),r.exports={Promise:o}},{lie:37}],7:[function(n,r,i){var o=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",l=n("pako"),u=n("./utils"),h=n("./stream/GenericWorker"),f=o?"uint8array":"array";function p(g,b){h.call(this,"FlateWorker/"+g),this._pako=null,this._pakoAction=g,this._pakoOptions=b,this.meta={}}i.magic="\b\0",u.inherits(p,h),p.prototype.processChunk=function(g){this.meta=g.meta,this._pako===null&&this._createPako(),this._pako.push(u.transformTo(f,g.data),!1)},p.prototype.flush=function(){h.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},p.prototype.cleanUp=function(){h.prototype.cleanUp.call(this),this._pako=null},p.prototype._createPako=function(){this._pako=new l[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var g=this;this._pako.onData=function(b){g.push({data:b,meta:g.meta})}},i.compressWorker=function(g){return new p("Deflate",g)},i.uncompressWorker=function(){return new p("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(n,r,i){function o(_,w){var x,S="";for(x=0;x<w;x++)S+=String.fromCharCode(255&_),_>>>=8;return S}function l(_,w,x,S,C,T){var I,M,U=_.file,H=_.compression,O=T!==f.utf8encode,P=u.transformTo("string",T(U.name)),N=u.transformTo("string",f.utf8encode(U.name)),V=U.comment,$=u.transformTo("string",T(V)),A=u.transformTo("string",f.utf8encode(V)),k=N.length!==U.name.length,D=A.length!==V.length,K="",X="",G="",te=U.dir,Q=U.date,se={crc32:0,compressedSize:0,uncompressedSize:0};w&&!x||(se.crc32=_.crc32,se.compressedSize=_.compressedSize,se.uncompressedSize=_.uncompressedSize);var B=0;w&&(B|=8),O||!k&&!D||(B|=2048);var q=0,ee=0;te&&(q|=16),C==="UNIX"?(ee=798,q|=(function(le,he){var Ee=le;return le||(Ee=he?16893:33204),(65535&Ee)<<16})(U.unixPermissions,te)):(ee=20,q|=(function(le){return 63&(le||0)})(U.dosPermissions)),I=Q.getUTCHours(),I<<=6,I|=Q.getUTCMinutes(),I<<=5,I|=Q.getUTCSeconds()/2,M=Q.getUTCFullYear()-1980,M<<=4,M|=Q.getUTCMonth()+1,M<<=5,M|=Q.getUTCDate(),k&&(X=o(1,1)+o(p(P),4)+N,K+="up"+o(X.length,2)+X),D&&(G=o(1,1)+o(p($),4)+A,K+="uc"+o(G.length,2)+G);var ne="";return ne+=`
\0`,ne+=o(B,2),ne+=H.magic,ne+=o(I,2),ne+=o(M,2),ne+=o(se.crc32,4),ne+=o(se.compressedSize,4),ne+=o(se.uncompressedSize,4),ne+=o(P.length,2),ne+=o(K.length,2),{fileRecord:g.LOCAL_FILE_HEADER+ne+P+K,dirRecord:g.CENTRAL_FILE_HEADER+o(ee,2)+ne+o($.length,2)+"\0\0\0\0"+o(q,4)+o(S,4)+P+K+$}}var u=n("../utils"),h=n("../stream/GenericWorker"),f=n("../utf8"),p=n("../crc32"),g=n("../signature");function b(_,w,x,S){h.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=w,this.zipPlatform=x,this.encodeFileName=S,this.streamFiles=_,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}u.inherits(b,h),b.prototype.push=function(_){var w=_.meta.percent||0,x=this.entriesCount,S=this._sources.length;this.accumulate?this.contentBuffer.push(_):(this.bytesWritten+=_.data.length,h.prototype.push.call(this,{data:_.data,meta:{currentFile:this.currentFile,percent:x?(w+100*(x-S-1))/x:100}}))},b.prototype.openedSource=function(_){this.currentSourceOffset=this.bytesWritten,this.currentFile=_.file.name;var w=this.streamFiles&&!_.file.dir;if(w){var x=l(_,w,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:x.fileRecord,meta:{percent:0}})}else this.accumulate=!0},b.prototype.closedSource=function(_){this.accumulate=!1;var w=this.streamFiles&&!_.file.dir,x=l(_,w,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(x.dirRecord),w)this.push({data:(function(S){return g.DATA_DESCRIPTOR+o(S.crc32,4)+o(S.compressedSize,4)+o(S.uncompressedSize,4)})(_),meta:{percent:100}});else for(this.push({data:x.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},b.prototype.flush=function(){for(var _=this.bytesWritten,w=0;w<this.dirRecords.length;w++)this.push({data:this.dirRecords[w],meta:{percent:100}});var x=this.bytesWritten-_,S=(function(C,T,I,M,U){var H=u.transformTo("string",U(M));return g.CENTRAL_DIRECTORY_END+"\0\0\0\0"+o(C,2)+o(C,2)+o(T,4)+o(I,4)+o(H.length,2)+H})(this.dirRecords.length,x,_,this.zipComment,this.encodeFileName);this.push({data:S,meta:{percent:100}})},b.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},b.prototype.registerPrevious=function(_){this._sources.push(_);var w=this;return _.on("data",function(x){w.processChunk(x)}),_.on("end",function(){w.closedSource(w.previous.streamInfo),w._sources.length?w.prepareNextSource():w.end()}),_.on("error",function(x){w.error(x)}),this},b.prototype.resume=function(){return!!h.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},b.prototype.error=function(_){var w=this._sources;if(!h.prototype.error.call(this,_))return!1;for(var x=0;x<w.length;x++)try{w[x].error(_)}catch{}return!0},b.prototype.lock=function(){h.prototype.lock.call(this);for(var _=this._sources,w=0;w<_.length;w++)_[w].lock()},r.exports=b},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(n,r,i){var o=n("../compressions"),l=n("./ZipFileWorker");i.generateWorker=function(u,h,f){var p=new l(h.streamFiles,f,h.platform,h.encodeFileName),g=0;try{u.forEach(function(b,_){g++;var w=(function(T,I){var M=T||I,U=o[M];if(!U)throw new Error(M+" is not a valid compression method !");return U})(_.options.compression,h.compression),x=_.options.compressionOptions||h.compressionOptions||{},S=_.dir,C=_.date;_._compressWorker(w,x).withStreamInfo("file",{name:b,dir:S,date:C,comment:_.comment||"",unixPermissions:_.unixPermissions,dosPermissions:_.dosPermissions}).pipe(p)}),p.entriesCount=g}catch(b){p.error(b)}return p}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(n,r,i){function o(){if(!(this instanceof o))return new o;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var l=new o;for(var u in this)typeof this[u]!="function"&&(l[u]=this[u]);return l}}(o.prototype=n("./object")).loadAsync=n("./load"),o.support=n("./support"),o.defaults=n("./defaults"),o.version="3.10.1",o.loadAsync=function(l,u){return new o().loadAsync(l,u)},o.external=n("./external"),r.exports=o},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(n,r,i){var o=n("./utils"),l=n("./external"),u=n("./utf8"),h=n("./zipEntries"),f=n("./stream/Crc32Probe"),p=n("./nodejsUtils");function g(b){return new l.Promise(function(_,w){var x=b.decompressed.getContentWorker().pipe(new f);x.on("error",function(S){w(S)}).on("end",function(){x.streamInfo.crc32!==b.decompressed.crc32?w(new Error("Corrupted zip : CRC32 mismatch")):_()}).resume()})}r.exports=function(b,_){var w=this;return _=o.extend(_||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:u.utf8decode}),p.isNode&&p.isStream(b)?l.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):o.prepareContent("the loaded zip file",b,!0,_.optimizedBinaryString,_.base64).then(function(x){var S=new h(_);return S.load(x),S}).then(function(x){var S=[l.Promise.resolve(x)],C=x.files;if(_.checkCRC32)for(var T=0;T<C.length;T++)S.push(g(C[T]));return l.Promise.all(S)}).then(function(x){for(var S=x.shift(),C=S.files,T=0;T<C.length;T++){var I=C[T],M=I.fileNameStr,U=o.resolve(I.fileNameStr);w.file(U,I.decompressed,{binary:!0,optimizedBinaryString:!0,date:I.date,dir:I.dir,comment:I.fileCommentStr.length?I.fileCommentStr:null,unixPermissions:I.unixPermissions,dosPermissions:I.dosPermissions,createFolders:_.createFolders}),I.dir||(w.file(U).unsafeOriginalName=M)}return S.zipComment.length&&(w.comment=S.zipComment),w})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(n,r,i){var o=n("../utils"),l=n("../stream/GenericWorker");function u(h,f){l.call(this,"Nodejs stream input adapter for "+h),this._upstreamEnded=!1,this._bindStream(f)}o.inherits(u,l),u.prototype._bindStream=function(h){var f=this;(this._stream=h).pause(),h.on("data",function(p){f.push({data:p,meta:{percent:0}})}).on("error",function(p){f.isPaused?this.generatedError=p:f.error(p)}).on("end",function(){f.isPaused?f._upstreamEnded=!0:f.end()})},u.prototype.pause=function(){return!!l.prototype.pause.call(this)&&(this._stream.pause(),!0)},u.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},r.exports=u},{"../stream/GenericWorker":28,"../utils":32}],13:[function(n,r,i){var o=n("readable-stream").Readable;function l(u,h,f){o.call(this,h),this._helper=u;var p=this;u.on("data",function(g,b){p.push(g)||p._helper.pause(),f&&f(b)}).on("error",function(g){p.emit("error",g)}).on("end",function(){p.push(null)})}n("../utils").inherits(l,o),l.prototype._read=function(){this._helper.resume()},r.exports=l},{"../utils":32,"readable-stream":16}],14:[function(n,r,i){r.exports={isNode:typeof Buffer<"u",newBufferFrom:function(o,l){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(o,l);if(typeof o=="number")throw new Error('The "data" argument must not be a number');return new Buffer(o,l)},allocBuffer:function(o){if(Buffer.alloc)return Buffer.alloc(o);var l=new Buffer(o);return l.fill(0),l},isBuffer:function(o){return Buffer.isBuffer(o)},isStream:function(o){return o&&typeof o.on=="function"&&typeof o.pause=="function"&&typeof o.resume=="function"}}},{}],15:[function(n,r,i){function o(U,H,O){var P,N=u.getTypeOf(H),V=u.extend(O||{},p);V.date=V.date||new Date,V.compression!==null&&(V.compression=V.compression.toUpperCase()),typeof V.unixPermissions=="string"&&(V.unixPermissions=parseInt(V.unixPermissions,8)),V.unixPermissions&&16384&V.unixPermissions&&(V.dir=!0),V.dosPermissions&&16&V.dosPermissions&&(V.dir=!0),V.dir&&(U=C(U)),V.createFolders&&(P=S(U))&&T.call(this,P,!0);var $=N==="string"&&V.binary===!1&&V.base64===!1;O&&O.binary!==void 0||(V.binary=!$),(H instanceof g&&H.uncompressedSize===0||V.dir||!H||H.length===0)&&(V.base64=!1,V.binary=!0,H="",V.compression="STORE",N="string");var A=null;A=H instanceof g||H instanceof h?H:w.isNode&&w.isStream(H)?new x(U,H):u.prepareContent(U,H,V.binary,V.optimizedBinaryString,V.base64);var k=new b(U,A,V);this.files[U]=k}var l=n("./utf8"),u=n("./utils"),h=n("./stream/GenericWorker"),f=n("./stream/StreamHelper"),p=n("./defaults"),g=n("./compressedObject"),b=n("./zipObject"),_=n("./generate"),w=n("./nodejsUtils"),x=n("./nodejs/NodejsStreamInputAdapter"),S=function(U){U.slice(-1)==="/"&&(U=U.substring(0,U.length-1));var H=U.lastIndexOf("/");return 0<H?U.substring(0,H):""},C=function(U){return U.slice(-1)!=="/"&&(U+="/"),U},T=function(U,H){return H=H!==void 0?H:p.createFolders,U=C(U),this.files[U]||o.call(this,U,null,{dir:!0,createFolders:H}),this.files[U]};function I(U){return Object.prototype.toString.call(U)==="[object RegExp]"}var M={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(U){var H,O,P;for(H in this.files)P=this.files[H],(O=H.slice(this.root.length,H.length))&&H.slice(0,this.root.length)===this.root&&U(O,P)},filter:function(U){var H=[];return this.forEach(function(O,P){U(O,P)&&H.push(P)}),H},file:function(U,H,O){if(arguments.length!==1)return U=this.root+U,o.call(this,U,H,O),this;if(I(U)){var P=U;return this.filter(function(V,$){return!$.dir&&P.test(V)})}var N=this.files[this.root+U];return N&&!N.dir?N:null},folder:function(U){if(!U)return this;if(I(U))return this.filter(function(N,V){return V.dir&&U.test(N)});var H=this.root+U,O=T.call(this,H),P=this.clone();return P.root=O.name,P},remove:function(U){U=this.root+U;var H=this.files[U];if(H||(U.slice(-1)!=="/"&&(U+="/"),H=this.files[U]),H&&!H.dir)delete this.files[U];else for(var O=this.filter(function(N,V){return V.name.slice(0,U.length)===U}),P=0;P<O.length;P++)delete this.files[O[P].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(U){var H,O={};try{if((O=u.extend(U||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:l.utf8encode})).type=O.type.toLowerCase(),O.compression=O.compression.toUpperCase(),O.type==="binarystring"&&(O.type="string"),!O.type)throw new Error("No output type specified.");u.checkSupport(O.type),O.platform!=="darwin"&&O.platform!=="freebsd"&&O.platform!=="linux"&&O.platform!=="sunos"||(O.platform="UNIX"),O.platform==="win32"&&(O.platform="DOS");var P=O.comment||this.comment||"";H=_.generateWorker(this,O,P)}catch(N){(H=new h("error")).error(N)}return new f(H,O.type||"string",O.mimeType)},generateAsync:function(U,H){return this.generateInternalStream(U).accumulate(H)},generateNodeStream:function(U,H){return(U=U||{}).type||(U.type="nodebuffer"),this.generateInternalStream(U).toNodejsStream(H)}};r.exports=M},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(n,r,i){r.exports=n("stream")},{stream:void 0}],17:[function(n,r,i){var o=n("./DataReader");function l(u){o.call(this,u);for(var h=0;h<this.data.length;h++)u[h]=255&u[h]}n("../utils").inherits(l,o),l.prototype.byteAt=function(u){return this.data[this.zero+u]},l.prototype.lastIndexOfSignature=function(u){for(var h=u.charCodeAt(0),f=u.charCodeAt(1),p=u.charCodeAt(2),g=u.charCodeAt(3),b=this.length-4;0<=b;--b)if(this.data[b]===h&&this.data[b+1]===f&&this.data[b+2]===p&&this.data[b+3]===g)return b-this.zero;return-1},l.prototype.readAndCheckSignature=function(u){var h=u.charCodeAt(0),f=u.charCodeAt(1),p=u.charCodeAt(2),g=u.charCodeAt(3),b=this.readData(4);return h===b[0]&&f===b[1]&&p===b[2]&&g===b[3]},l.prototype.readData=function(u){if(this.checkOffset(u),u===0)return[];var h=this.data.slice(this.zero+this.index,this.zero+this.index+u);return this.index+=u,h},r.exports=l},{"../utils":32,"./DataReader":18}],18:[function(n,r,i){var o=n("../utils");function l(u){this.data=u,this.length=u.length,this.index=0,this.zero=0}l.prototype={checkOffset:function(u){this.checkIndex(this.index+u)},checkIndex:function(u){if(this.length<this.zero+u||u<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+u+"). Corrupted zip ?")},setIndex:function(u){this.checkIndex(u),this.index=u},skip:function(u){this.setIndex(this.index+u)},byteAt:function(){},readInt:function(u){var h,f=0;for(this.checkOffset(u),h=this.index+u-1;h>=this.index;h--)f=(f<<8)+this.byteAt(h);return this.index+=u,f},readString:function(u){return o.transformTo("string",this.readData(u))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var u=this.readInt(4);return new Date(Date.UTC(1980+(u>>25&127),(u>>21&15)-1,u>>16&31,u>>11&31,u>>5&63,(31&u)<<1))}},r.exports=l},{"../utils":32}],19:[function(n,r,i){var o=n("./Uint8ArrayReader");function l(u){o.call(this,u)}n("../utils").inherits(l,o),l.prototype.readData=function(u){this.checkOffset(u);var h=this.data.slice(this.zero+this.index,this.zero+this.index+u);return this.index+=u,h},r.exports=l},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(n,r,i){var o=n("./DataReader");function l(u){o.call(this,u)}n("../utils").inherits(l,o),l.prototype.byteAt=function(u){return this.data.charCodeAt(this.zero+u)},l.prototype.lastIndexOfSignature=function(u){return this.data.lastIndexOf(u)-this.zero},l.prototype.readAndCheckSignature=function(u){return u===this.readData(4)},l.prototype.readData=function(u){this.checkOffset(u);var h=this.data.slice(this.zero+this.index,this.zero+this.index+u);return this.index+=u,h},r.exports=l},{"../utils":32,"./DataReader":18}],21:[function(n,r,i){var o=n("./ArrayReader");function l(u){o.call(this,u)}n("../utils").inherits(l,o),l.prototype.readData=function(u){if(this.checkOffset(u),u===0)return new Uint8Array(0);var h=this.data.subarray(this.zero+this.index,this.zero+this.index+u);return this.index+=u,h},r.exports=l},{"../utils":32,"./ArrayReader":17}],22:[function(n,r,i){var o=n("../utils"),l=n("../support"),u=n("./ArrayReader"),h=n("./StringReader"),f=n("./NodeBufferReader"),p=n("./Uint8ArrayReader");r.exports=function(g){var b=o.getTypeOf(g);return o.checkSupport(b),b!=="string"||l.uint8array?b==="nodebuffer"?new f(g):l.uint8array?new p(o.transformTo("uint8array",g)):new u(o.transformTo("array",g)):new h(g)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(n,r,i){i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(n,r,i){var o=n("./GenericWorker"),l=n("../utils");function u(h){o.call(this,"ConvertWorker to "+h),this.destType=h}l.inherits(u,o),u.prototype.processChunk=function(h){this.push({data:l.transformTo(this.destType,h.data),meta:h.meta})},r.exports=u},{"../utils":32,"./GenericWorker":28}],25:[function(n,r,i){var o=n("./GenericWorker"),l=n("../crc32");function u(){o.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}n("../utils").inherits(u,o),u.prototype.processChunk=function(h){this.streamInfo.crc32=l(h.data,this.streamInfo.crc32||0),this.push(h)},r.exports=u},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(n,r,i){var o=n("../utils"),l=n("./GenericWorker");function u(h){l.call(this,"DataLengthProbe for "+h),this.propName=h,this.withStreamInfo(h,0)}o.inherits(u,l),u.prototype.processChunk=function(h){if(h){var f=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=f+h.data.length}l.prototype.processChunk.call(this,h)},r.exports=u},{"../utils":32,"./GenericWorker":28}],27:[function(n,r,i){var o=n("../utils"),l=n("./GenericWorker");function u(h){l.call(this,"DataWorker");var f=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,h.then(function(p){f.dataIsReady=!0,f.data=p,f.max=p&&p.length||0,f.type=o.getTypeOf(p),f.isPaused||f._tickAndRepeat()},function(p){f.error(p)})}o.inherits(u,l),u.prototype.cleanUp=function(){l.prototype.cleanUp.call(this),this.data=null},u.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,o.delay(this._tickAndRepeat,[],this)),!0)},u.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(o.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},u.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var h=null,f=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":h=this.data.substring(this.index,f);break;case"uint8array":h=this.data.subarray(this.index,f);break;case"array":case"nodebuffer":h=this.data.slice(this.index,f)}return this.index=f,this.push({data:h,meta:{percent:this.max?this.index/this.max*100:0}})},r.exports=u},{"../utils":32,"./GenericWorker":28}],28:[function(n,r,i){function o(l){this.name=l||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}o.prototype={push:function(l){this.emit("data",l)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(l){this.emit("error",l)}return!0},error:function(l){return!this.isFinished&&(this.isPaused?this.generatedError=l:(this.isFinished=!0,this.emit("error",l),this.previous&&this.previous.error(l),this.cleanUp()),!0)},on:function(l,u){return this._listeners[l].push(u),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(l,u){if(this._listeners[l])for(var h=0;h<this._listeners[l].length;h++)this._listeners[l][h].call(this,u)},pipe:function(l){return l.registerPrevious(this)},registerPrevious:function(l){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=l.streamInfo,this.mergeStreamInfo(),this.previous=l;var u=this;return l.on("data",function(h){u.processChunk(h)}),l.on("end",function(){u.end()}),l.on("error",function(h){u.error(h)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var l=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),l=!0),this.previous&&this.previous.resume(),!l},flush:function(){},processChunk:function(l){this.push(l)},withStreamInfo:function(l,u){return this.extraStreamInfo[l]=u,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var l in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,l)&&(this.streamInfo[l]=this.extraStreamInfo[l])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var l="Worker "+this.name;return this.previous?this.previous+" -> "+l:l}},r.exports=o},{}],29:[function(n,r,i){var o=n("../utils"),l=n("./ConvertWorker"),u=n("./GenericWorker"),h=n("../base64"),f=n("../support"),p=n("../external"),g=null;if(f.nodestream)try{g=n("../nodejs/NodejsStreamOutputAdapter")}catch{}function b(w,x){return new p.Promise(function(S,C){var T=[],I=w._internalType,M=w._outputType,U=w._mimeType;w.on("data",function(H,O){T.push(H),x&&x(O)}).on("error",function(H){T=[],C(H)}).on("end",function(){try{var H=(function(O,P,N){switch(O){case"blob":return o.newBlob(o.transformTo("arraybuffer",P),N);case"base64":return h.encode(P);default:return o.transformTo(O,P)}})(M,(function(O,P){var N,V=0,$=null,A=0;for(N=0;N<P.length;N++)A+=P[N].length;switch(O){case"string":return P.join("");case"array":return Array.prototype.concat.apply([],P);case"uint8array":for($=new Uint8Array(A),N=0;N<P.length;N++)$.set(P[N],V),V+=P[N].length;return $;case"nodebuffer":return Buffer.concat(P);default:throw new Error("concat : unsupported type '"+O+"'")}})(I,T),U);S(H)}catch(O){C(O)}T=[]}).resume()})}function _(w,x,S){var C=x;switch(x){case"blob":case"arraybuffer":C="uint8array";break;case"base64":C="string"}try{this._internalType=C,this._outputType=x,this._mimeType=S,o.checkSupport(C),this._worker=w.pipe(new l(C)),w.lock()}catch(T){this._worker=new u("error"),this._worker.error(T)}}_.prototype={accumulate:function(w){return b(this,w)},on:function(w,x){var S=this;return w==="data"?this._worker.on(w,function(C){x.call(S,C.data,C.meta)}):this._worker.on(w,function(){o.delay(x,arguments,S)}),this},resume:function(){return o.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(w){if(o.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new g(this,{objectMode:this._outputType!=="nodebuffer"},w)}},r.exports=_},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(n,r,i){if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",i.nodebuffer=typeof Buffer<"u",i.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")i.blob=!1;else{var o=new ArrayBuffer(0);try{i.blob=new Blob([o],{type:"application/zip"}).size===0}catch{try{var l=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);l.append(o),i.blob=l.getBlob("application/zip").size===0}catch{i.blob=!1}}}try{i.nodestream=!!n("readable-stream").Readable}catch{i.nodestream=!1}},{"readable-stream":16}],31:[function(n,r,i){for(var o=n("./utils"),l=n("./support"),u=n("./nodejsUtils"),h=n("./stream/GenericWorker"),f=new Array(256),p=0;p<256;p++)f[p]=252<=p?6:248<=p?5:240<=p?4:224<=p?3:192<=p?2:1;f[254]=f[254]=1;function g(){h.call(this,"utf-8 decode"),this.leftOver=null}function b(){h.call(this,"utf-8 encode")}i.utf8encode=function(_){return l.nodebuffer?u.newBufferFrom(_,"utf-8"):(function(w){var x,S,C,T,I,M=w.length,U=0;for(T=0;T<M;T++)(64512&(S=w.charCodeAt(T)))==55296&&T+1<M&&(64512&(C=w.charCodeAt(T+1)))==56320&&(S=65536+(S-55296<<10)+(C-56320),T++),U+=S<128?1:S<2048?2:S<65536?3:4;for(x=l.uint8array?new Uint8Array(U):new Array(U),T=I=0;I<U;T++)(64512&(S=w.charCodeAt(T)))==55296&&T+1<M&&(64512&(C=w.charCodeAt(T+1)))==56320&&(S=65536+(S-55296<<10)+(C-56320),T++),S<128?x[I++]=S:(S<2048?x[I++]=192|S>>>6:(S<65536?x[I++]=224|S>>>12:(x[I++]=240|S>>>18,x[I++]=128|S>>>12&63),x[I++]=128|S>>>6&63),x[I++]=128|63&S);return x})(_)},i.utf8decode=function(_){return l.nodebuffer?o.transformTo("nodebuffer",_).toString("utf-8"):(function(w){var x,S,C,T,I=w.length,M=new Array(2*I);for(x=S=0;x<I;)if((C=w[x++])<128)M[S++]=C;else if(4<(T=f[C]))M[S++]=65533,x+=T-1;else{for(C&=T===2?31:T===3?15:7;1<T&&x<I;)C=C<<6|63&w[x++],T--;1<T?M[S++]=65533:C<65536?M[S++]=C:(C-=65536,M[S++]=55296|C>>10&1023,M[S++]=56320|1023&C)}return M.length!==S&&(M.subarray?M=M.subarray(0,S):M.length=S),o.applyFromCharCode(M)})(_=o.transformTo(l.uint8array?"uint8array":"array",_))},o.inherits(g,h),g.prototype.processChunk=function(_){var w=o.transformTo(l.uint8array?"uint8array":"array",_.data);if(this.leftOver&&this.leftOver.length){if(l.uint8array){var x=w;(w=new Uint8Array(x.length+this.leftOver.length)).set(this.leftOver,0),w.set(x,this.leftOver.length)}else w=this.leftOver.concat(w);this.leftOver=null}var S=(function(T,I){var M;for((I=I||T.length)>T.length&&(I=T.length),M=I-1;0<=M&&(192&T[M])==128;)M--;return M<0||M===0?I:M+f[T[M]]>I?M:I})(w),C=w;S!==w.length&&(l.uint8array?(C=w.subarray(0,S),this.leftOver=w.subarray(S,w.length)):(C=w.slice(0,S),this.leftOver=w.slice(S,w.length))),this.push({data:i.utf8decode(C),meta:_.meta})},g.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:i.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},i.Utf8DecodeWorker=g,o.inherits(b,h),b.prototype.processChunk=function(_){this.push({data:i.utf8encode(_.data),meta:_.meta})},i.Utf8EncodeWorker=b},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(n,r,i){var o=n("./support"),l=n("./base64"),u=n("./nodejsUtils"),h=n("./external");function f(x){return x}function p(x,S){for(var C=0;C<x.length;++C)S[C]=255&x.charCodeAt(C);return S}n("setimmediate"),i.newBlob=function(x,S){i.checkSupport("blob");try{return new Blob([x],{type:S})}catch{try{var C=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return C.append(x),C.getBlob(S)}catch{throw new Error("Bug : can't construct the Blob.")}}};var g={stringifyByChunk:function(x,S,C){var T=[],I=0,M=x.length;if(M<=C)return String.fromCharCode.apply(null,x);for(;I<M;)S==="array"||S==="nodebuffer"?T.push(String.fromCharCode.apply(null,x.slice(I,Math.min(I+C,M)))):T.push(String.fromCharCode.apply(null,x.subarray(I,Math.min(I+C,M)))),I+=C;return T.join("")},stringifyByChar:function(x){for(var S="",C=0;C<x.length;C++)S+=String.fromCharCode(x[C]);return S},applyCanBeUsed:{uint8array:(function(){try{return o.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}})(),nodebuffer:(function(){try{return o.nodebuffer&&String.fromCharCode.apply(null,u.allocBuffer(1)).length===1}catch{return!1}})()}};function b(x){var S=65536,C=i.getTypeOf(x),T=!0;if(C==="uint8array"?T=g.applyCanBeUsed.uint8array:C==="nodebuffer"&&(T=g.applyCanBeUsed.nodebuffer),T)for(;1<S;)try{return g.stringifyByChunk(x,C,S)}catch{S=Math.floor(S/2)}return g.stringifyByChar(x)}function _(x,S){for(var C=0;C<x.length;C++)S[C]=x[C];return S}i.applyFromCharCode=b;var w={};w.string={string:f,array:function(x){return p(x,new Array(x.length))},arraybuffer:function(x){return w.string.uint8array(x).buffer},uint8array:function(x){return p(x,new Uint8Array(x.length))},nodebuffer:function(x){return p(x,u.allocBuffer(x.length))}},w.array={string:b,array:f,arraybuffer:function(x){return new Uint8Array(x).buffer},uint8array:function(x){return new Uint8Array(x)},nodebuffer:function(x){return u.newBufferFrom(x)}},w.arraybuffer={string:function(x){return b(new Uint8Array(x))},array:function(x){return _(new Uint8Array(x),new Array(x.byteLength))},arraybuffer:f,uint8array:function(x){return new Uint8Array(x)},nodebuffer:function(x){return u.newBufferFrom(new Uint8Array(x))}},w.uint8array={string:b,array:function(x){return _(x,new Array(x.length))},arraybuffer:function(x){return x.buffer},uint8array:f,nodebuffer:function(x){return u.newBufferFrom(x)}},w.nodebuffer={string:b,array:function(x){return _(x,new Array(x.length))},arraybuffer:function(x){return w.nodebuffer.uint8array(x).buffer},uint8array:function(x){return _(x,new Uint8Array(x.length))},nodebuffer:f},i.transformTo=function(x,S){if(S=S||"",!x)return S;i.checkSupport(x);var C=i.getTypeOf(S);return w[C][x](S)},i.resolve=function(x){for(var S=x.split("/"),C=[],T=0;T<S.length;T++){var I=S[T];I==="."||I===""&&T!==0&&T!==S.length-1||(I===".."?C.pop():C.push(I))}return C.join("/")},i.getTypeOf=function(x){return typeof x=="string"?"string":Object.prototype.toString.call(x)==="[object Array]"?"array":o.nodebuffer&&u.isBuffer(x)?"nodebuffer":o.uint8array&&x instanceof Uint8Array?"uint8array":o.arraybuffer&&x instanceof ArrayBuffer?"arraybuffer":void 0},i.checkSupport=function(x){if(!o[x.toLowerCase()])throw new Error(x+" is not supported by this platform")},i.MAX_VALUE_16BITS=65535,i.MAX_VALUE_32BITS=-1,i.pretty=function(x){var S,C,T="";for(C=0;C<(x||"").length;C++)T+="\\x"+((S=x.charCodeAt(C))<16?"0":"")+S.toString(16).toUpperCase();return T},i.delay=function(x,S,C){setImmediate(function(){x.apply(C||null,S||[])})},i.inherits=function(x,S){function C(){}C.prototype=S.prototype,x.prototype=new C},i.extend=function(){var x,S,C={};for(x=0;x<arguments.length;x++)for(S in arguments[x])Object.prototype.hasOwnProperty.call(arguments[x],S)&&C[S]===void 0&&(C[S]=arguments[x][S]);return C},i.prepareContent=function(x,S,C,T,I){return h.Promise.resolve(S).then(function(M){return o.blob&&(M instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(M))!==-1)&&typeof FileReader<"u"?new h.Promise(function(U,H){var O=new FileReader;O.onload=function(P){U(P.target.result)},O.onerror=function(P){H(P.target.error)},O.readAsArrayBuffer(M)}):M}).then(function(M){var U=i.getTypeOf(M);return U?(U==="arraybuffer"?M=i.transformTo("uint8array",M):U==="string"&&(I?M=l.decode(M):C&&T!==!0&&(M=(function(H){return p(H,o.uint8array?new Uint8Array(H.length):new Array(H.length))})(M))),M):h.Promise.reject(new Error("Can't read the data of '"+x+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(n,r,i){var o=n("./reader/readerFor"),l=n("./utils"),u=n("./signature"),h=n("./zipEntry"),f=n("./support");function p(g){this.files=[],this.loadOptions=g}p.prototype={checkSignature:function(g){if(!this.reader.readAndCheckSignature(g)){this.reader.index-=4;var b=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+l.pretty(b)+", expected "+l.pretty(g)+")")}},isSignature:function(g,b){var _=this.reader.index;this.reader.setIndex(g);var w=this.reader.readString(4)===b;return this.reader.setIndex(_),w},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var g=this.reader.readData(this.zipCommentLength),b=f.uint8array?"uint8array":"array",_=l.transformTo(b,g);this.zipComment=this.loadOptions.decodeFileName(_)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var g,b,_,w=this.zip64EndOfCentralSize-44;0<w;)g=this.reader.readInt(2),b=this.reader.readInt(4),_=this.reader.readData(b),this.zip64ExtensibleData[g]={id:g,length:b,value:_}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var g,b;for(g=0;g<this.files.length;g++)b=this.files[g],this.reader.setIndex(b.localHeaderOffset),this.checkSignature(u.LOCAL_FILE_HEADER),b.readLocalPart(this.reader),b.handleUTF8(),b.processAttributes()},readCentralDir:function(){var g;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(u.CENTRAL_FILE_HEADER);)(g=new h({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(g);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var g=this.reader.lastIndexOfSignature(u.CENTRAL_DIRECTORY_END);if(g<0)throw this.isSignature(0,u.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(g);var b=g;if(this.checkSignature(u.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===l.MAX_VALUE_16BITS||this.diskWithCentralDirStart===l.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===l.MAX_VALUE_16BITS||this.centralDirRecords===l.MAX_VALUE_16BITS||this.centralDirSize===l.MAX_VALUE_32BITS||this.centralDirOffset===l.MAX_VALUE_32BITS){if(this.zip64=!0,(g=this.reader.lastIndexOfSignature(u.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(g),this.checkSignature(u.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,u.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(u.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(u.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var _=this.centralDirOffset+this.centralDirSize;this.zip64&&(_+=20,_+=12+this.zip64EndOfCentralSize);var w=b-_;if(0<w)this.isSignature(b,u.CENTRAL_FILE_HEADER)||(this.reader.zero=w);else if(w<0)throw new Error("Corrupted zip: missing "+Math.abs(w)+" bytes.")},prepareReader:function(g){this.reader=o(g)},load:function(g){this.prepareReader(g),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},r.exports=p},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(n,r,i){var o=n("./reader/readerFor"),l=n("./utils"),u=n("./compressedObject"),h=n("./crc32"),f=n("./utf8"),p=n("./compressions"),g=n("./support");function b(_,w){this.options=_,this.loadOptions=w}b.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(_){var w,x;if(_.skip(22),this.fileNameLength=_.readInt(2),x=_.readInt(2),this.fileName=_.readData(this.fileNameLength),_.skip(x),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((w=(function(S){for(var C in p)if(Object.prototype.hasOwnProperty.call(p,C)&&p[C].magic===S)return p[C];return null})(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+l.pretty(this.compressionMethod)+" unknown (inner file : "+l.transformTo("string",this.fileName)+")");this.decompressed=new u(this.compressedSize,this.uncompressedSize,this.crc32,w,_.readData(this.compressedSize))},readCentralPart:function(_){this.versionMadeBy=_.readInt(2),_.skip(2),this.bitFlag=_.readInt(2),this.compressionMethod=_.readString(2),this.date=_.readDate(),this.crc32=_.readInt(4),this.compressedSize=_.readInt(4),this.uncompressedSize=_.readInt(4);var w=_.readInt(2);if(this.extraFieldsLength=_.readInt(2),this.fileCommentLength=_.readInt(2),this.diskNumberStart=_.readInt(2),this.internalFileAttributes=_.readInt(2),this.externalFileAttributes=_.readInt(4),this.localHeaderOffset=_.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");_.skip(w),this.readExtraFields(_),this.parseZIP64ExtraField(_),this.fileComment=_.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var _=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),_==0&&(this.dosPermissions=63&this.externalFileAttributes),_==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var _=o(this.extraFields[1].value);this.uncompressedSize===l.MAX_VALUE_32BITS&&(this.uncompressedSize=_.readInt(8)),this.compressedSize===l.MAX_VALUE_32BITS&&(this.compressedSize=_.readInt(8)),this.localHeaderOffset===l.MAX_VALUE_32BITS&&(this.localHeaderOffset=_.readInt(8)),this.diskNumberStart===l.MAX_VALUE_32BITS&&(this.diskNumberStart=_.readInt(4))}},readExtraFields:function(_){var w,x,S,C=_.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});_.index+4<C;)w=_.readInt(2),x=_.readInt(2),S=_.readData(x),this.extraFields[w]={id:w,length:x,value:S};_.setIndex(C)},handleUTF8:function(){var _=g.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=f.utf8decode(this.fileName),this.fileCommentStr=f.utf8decode(this.fileComment);else{var w=this.findExtraFieldUnicodePath();if(w!==null)this.fileNameStr=w;else{var x=l.transformTo(_,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(x)}var S=this.findExtraFieldUnicodeComment();if(S!==null)this.fileCommentStr=S;else{var C=l.transformTo(_,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(C)}}},findExtraFieldUnicodePath:function(){var _=this.extraFields[28789];if(_){var w=o(_.value);return w.readInt(1)!==1||h(this.fileName)!==w.readInt(4)?null:f.utf8decode(w.readData(_.length-5))}return null},findExtraFieldUnicodeComment:function(){var _=this.extraFields[25461];if(_){var w=o(_.value);return w.readInt(1)!==1||h(this.fileComment)!==w.readInt(4)?null:f.utf8decode(w.readData(_.length-5))}return null}},r.exports=b},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(n,r,i){function o(w,x,S){this.name=w,this.dir=S.dir,this.date=S.date,this.comment=S.comment,this.unixPermissions=S.unixPermissions,this.dosPermissions=S.dosPermissions,this._data=x,this._dataBinary=S.binary,this.options={compression:S.compression,compressionOptions:S.compressionOptions}}var l=n("./stream/StreamHelper"),u=n("./stream/DataWorker"),h=n("./utf8"),f=n("./compressedObject"),p=n("./stream/GenericWorker");o.prototype={internalStream:function(w){var x=null,S="string";try{if(!w)throw new Error("No output type specified.");var C=(S=w.toLowerCase())==="string"||S==="text";S!=="binarystring"&&S!=="text"||(S="string"),x=this._decompressWorker();var T=!this._dataBinary;T&&!C&&(x=x.pipe(new h.Utf8EncodeWorker)),!T&&C&&(x=x.pipe(new h.Utf8DecodeWorker))}catch(I){(x=new p("error")).error(I)}return new l(x,S,"")},async:function(w,x){return this.internalStream(w).accumulate(x)},nodeStream:function(w,x){return this.internalStream(w||"nodebuffer").toNodejsStream(x)},_compressWorker:function(w,x){if(this._data instanceof f&&this._data.compression.magic===w.magic)return this._data.getCompressedWorker();var S=this._decompressWorker();return this._dataBinary||(S=S.pipe(new h.Utf8EncodeWorker)),f.createWorkerFrom(S,w,x)},_decompressWorker:function(){return this._data instanceof f?this._data.getContentWorker():this._data instanceof p?this._data:new u(this._data)}};for(var g=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],b=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},_=0;_<g.length;_++)o.prototype[g[_]]=b;r.exports=o},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(n,r,i){(function(o){var l,u,h=o.MutationObserver||o.WebKitMutationObserver;if(h){var f=0,p=new h(w),g=o.document.createTextNode("");p.observe(g,{characterData:!0}),l=function(){g.data=f=++f%2}}else if(o.setImmediate||o.MessageChannel===void 0)l="document"in o&&"onreadystatechange"in o.document.createElement("script")?function(){var x=o.document.createElement("script");x.onreadystatechange=function(){w(),x.onreadystatechange=null,x.parentNode.removeChild(x),x=null},o.document.documentElement.appendChild(x)}:function(){setTimeout(w,0)};else{var b=new o.MessageChannel;b.port1.onmessage=w,l=function(){b.port2.postMessage(0)}}var _=[];function w(){var x,S;u=!0;for(var C=_.length;C;){for(S=_,_=[],x=-1;++x<C;)S[x]();C=_.length}u=!1}r.exports=function(x){_.push(x)!==1||u||l()}}).call(this,typeof Kh<"u"?Kh:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(n,r,i){var o=n("immediate");function l(){}var u={},h=["REJECTED"],f=["FULFILLED"],p=["PENDING"];function g(C){if(typeof C!="function")throw new TypeError("resolver must be a function");this.state=p,this.queue=[],this.outcome=void 0,C!==l&&x(this,C)}function b(C,T,I){this.promise=C,typeof T=="function"&&(this.onFulfilled=T,this.callFulfilled=this.otherCallFulfilled),typeof I=="function"&&(this.onRejected=I,this.callRejected=this.otherCallRejected)}function _(C,T,I){o(function(){var M;try{M=T(I)}catch(U){return u.reject(C,U)}M===C?u.reject(C,new TypeError("Cannot resolve promise with itself")):u.resolve(C,M)})}function w(C){var T=C&&C.then;if(C&&(typeof C=="object"||typeof C=="function")&&typeof T=="function")return function(){T.apply(C,arguments)}}function x(C,T){var I=!1;function M(O){I||(I=!0,u.reject(C,O))}function U(O){I||(I=!0,u.resolve(C,O))}var H=S(function(){T(U,M)});H.status==="error"&&M(H.value)}function S(C,T){var I={};try{I.value=C(T),I.status="success"}catch(M){I.status="error",I.value=M}return I}(r.exports=g).prototype.finally=function(C){if(typeof C!="function")return this;var T=this.constructor;return this.then(function(I){return T.resolve(C()).then(function(){return I})},function(I){return T.resolve(C()).then(function(){throw I})})},g.prototype.catch=function(C){return this.then(null,C)},g.prototype.then=function(C,T){if(typeof C!="function"&&this.state===f||typeof T!="function"&&this.state===h)return this;var I=new this.constructor(l);return this.state!==p?_(I,this.state===f?C:T,this.outcome):this.queue.push(new b(I,C,T)),I},b.prototype.callFulfilled=function(C){u.resolve(this.promise,C)},b.prototype.otherCallFulfilled=function(C){_(this.promise,this.onFulfilled,C)},b.prototype.callRejected=function(C){u.reject(this.promise,C)},b.prototype.otherCallRejected=function(C){_(this.promise,this.onRejected,C)},u.resolve=function(C,T){var I=S(w,T);if(I.status==="error")return u.reject(C,I.value);var M=I.value;if(M)x(C,M);else{C.state=f,C.outcome=T;for(var U=-1,H=C.queue.length;++U<H;)C.queue[U].callFulfilled(T)}return C},u.reject=function(C,T){C.state=h,C.outcome=T;for(var I=-1,M=C.queue.length;++I<M;)C.queue[I].callRejected(T);return C},g.resolve=function(C){return C instanceof this?C:u.resolve(new this(l),C)},g.reject=function(C){var T=new this(l);return u.reject(T,C)},g.all=function(C){var T=this;if(Object.prototype.toString.call(C)!=="[object Array]")return this.reject(new TypeError("must be an array"));var I=C.length,M=!1;if(!I)return this.resolve([]);for(var U=new Array(I),H=0,O=-1,P=new this(l);++O<I;)N(C[O],O);return P;function N(V,$){T.resolve(V).then(function(A){U[$]=A,++H!==I||M||(M=!0,u.resolve(P,U))},function(A){M||(M=!0,u.reject(P,A))})}},g.race=function(C){var T=this;if(Object.prototype.toString.call(C)!=="[object Array]")return this.reject(new TypeError("must be an array"));var I=C.length,M=!1;if(!I)return this.resolve([]);for(var U=-1,H=new this(l);++U<I;)O=C[U],T.resolve(O).then(function(P){M||(M=!0,u.resolve(H,P))},function(P){M||(M=!0,u.reject(H,P))});var O;return H}},{immediate:36}],38:[function(n,r,i){var o={};(0,n("./lib/utils/common").assign)(o,n("./lib/deflate"),n("./lib/inflate"),n("./lib/zlib/constants")),r.exports=o},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(n,r,i){var o=n("./zlib/deflate"),l=n("./utils/common"),u=n("./utils/strings"),h=n("./zlib/messages"),f=n("./zlib/zstream"),p=Object.prototype.toString,g=0,b=-1,_=0,w=8;function x(C){if(!(this instanceof x))return new x(C);this.options=l.assign({level:b,method:w,chunkSize:16384,windowBits:15,memLevel:8,strategy:_,to:""},C||{});var T=this.options;T.raw&&0<T.windowBits?T.windowBits=-T.windowBits:T.gzip&&0<T.windowBits&&T.windowBits<16&&(T.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new f,this.strm.avail_out=0;var I=o.deflateInit2(this.strm,T.level,T.method,T.windowBits,T.memLevel,T.strategy);if(I!==g)throw new Error(h[I]);if(T.header&&o.deflateSetHeader(this.strm,T.header),T.dictionary){var M;if(M=typeof T.dictionary=="string"?u.string2buf(T.dictionary):p.call(T.dictionary)==="[object ArrayBuffer]"?new Uint8Array(T.dictionary):T.dictionary,(I=o.deflateSetDictionary(this.strm,M))!==g)throw new Error(h[I]);this._dict_set=!0}}function S(C,T){var I=new x(T);if(I.push(C,!0),I.err)throw I.msg||h[I.err];return I.result}x.prototype.push=function(C,T){var I,M,U=this.strm,H=this.options.chunkSize;if(this.ended)return!1;M=T===~~T?T:T===!0?4:0,typeof C=="string"?U.input=u.string2buf(C):p.call(C)==="[object ArrayBuffer]"?U.input=new Uint8Array(C):U.input=C,U.next_in=0,U.avail_in=U.input.length;do{if(U.avail_out===0&&(U.output=new l.Buf8(H),U.next_out=0,U.avail_out=H),(I=o.deflate(U,M))!==1&&I!==g)return this.onEnd(I),!(this.ended=!0);U.avail_out!==0&&(U.avail_in!==0||M!==4&&M!==2)||(this.options.to==="string"?this.onData(u.buf2binstring(l.shrinkBuf(U.output,U.next_out))):this.onData(l.shrinkBuf(U.output,U.next_out)))}while((0<U.avail_in||U.avail_out===0)&&I!==1);return M===4?(I=o.deflateEnd(this.strm),this.onEnd(I),this.ended=!0,I===g):M!==2||(this.onEnd(g),!(U.avail_out=0))},x.prototype.onData=function(C){this.chunks.push(C)},x.prototype.onEnd=function(C){C===g&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=l.flattenChunks(this.chunks)),this.chunks=[],this.err=C,this.msg=this.strm.msg},i.Deflate=x,i.deflate=S,i.deflateRaw=function(C,T){return(T=T||{}).raw=!0,S(C,T)},i.gzip=function(C,T){return(T=T||{}).gzip=!0,S(C,T)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(n,r,i){var o=n("./zlib/inflate"),l=n("./utils/common"),u=n("./utils/strings"),h=n("./zlib/constants"),f=n("./zlib/messages"),p=n("./zlib/zstream"),g=n("./zlib/gzheader"),b=Object.prototype.toString;function _(x){if(!(this instanceof _))return new _(x);this.options=l.assign({chunkSize:16384,windowBits:0,to:""},x||{});var S=this.options;S.raw&&0<=S.windowBits&&S.windowBits<16&&(S.windowBits=-S.windowBits,S.windowBits===0&&(S.windowBits=-15)),!(0<=S.windowBits&&S.windowBits<16)||x&&x.windowBits||(S.windowBits+=32),15<S.windowBits&&S.windowBits<48&&(15&S.windowBits)==0&&(S.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new p,this.strm.avail_out=0;var C=o.inflateInit2(this.strm,S.windowBits);if(C!==h.Z_OK)throw new Error(f[C]);this.header=new g,o.inflateGetHeader(this.strm,this.header)}function w(x,S){var C=new _(S);if(C.push(x,!0),C.err)throw C.msg||f[C.err];return C.result}_.prototype.push=function(x,S){var C,T,I,M,U,H,O=this.strm,P=this.options.chunkSize,N=this.options.dictionary,V=!1;if(this.ended)return!1;T=S===~~S?S:S===!0?h.Z_FINISH:h.Z_NO_FLUSH,typeof x=="string"?O.input=u.binstring2buf(x):b.call(x)==="[object ArrayBuffer]"?O.input=new Uint8Array(x):O.input=x,O.next_in=0,O.avail_in=O.input.length;do{if(O.avail_out===0&&(O.output=new l.Buf8(P),O.next_out=0,O.avail_out=P),(C=o.inflate(O,h.Z_NO_FLUSH))===h.Z_NEED_DICT&&N&&(H=typeof N=="string"?u.string2buf(N):b.call(N)==="[object ArrayBuffer]"?new Uint8Array(N):N,C=o.inflateSetDictionary(this.strm,H)),C===h.Z_BUF_ERROR&&V===!0&&(C=h.Z_OK,V=!1),C!==h.Z_STREAM_END&&C!==h.Z_OK)return this.onEnd(C),!(this.ended=!0);O.next_out&&(O.avail_out!==0&&C!==h.Z_STREAM_END&&(O.avail_in!==0||T!==h.Z_FINISH&&T!==h.Z_SYNC_FLUSH)||(this.options.to==="string"?(I=u.utf8border(O.output,O.next_out),M=O.next_out-I,U=u.buf2string(O.output,I),O.next_out=M,O.avail_out=P-M,M&&l.arraySet(O.output,O.output,I,M,0),this.onData(U)):this.onData(l.shrinkBuf(O.output,O.next_out)))),O.avail_in===0&&O.avail_out===0&&(V=!0)}while((0<O.avail_in||O.avail_out===0)&&C!==h.Z_STREAM_END);return C===h.Z_STREAM_END&&(T=h.Z_FINISH),T===h.Z_FINISH?(C=o.inflateEnd(this.strm),this.onEnd(C),this.ended=!0,C===h.Z_OK):T!==h.Z_SYNC_FLUSH||(this.onEnd(h.Z_OK),!(O.avail_out=0))},_.prototype.onData=function(x){this.chunks.push(x)},_.prototype.onEnd=function(x){x===h.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=l.flattenChunks(this.chunks)),this.chunks=[],this.err=x,this.msg=this.strm.msg},i.Inflate=_,i.inflate=w,i.inflateRaw=function(x,S){return(S=S||{}).raw=!0,w(x,S)},i.ungzip=w},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(n,r,i){var o=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";i.assign=function(h){for(var f=Array.prototype.slice.call(arguments,1);f.length;){var p=f.shift();if(p){if(typeof p!="object")throw new TypeError(p+"must be non-object");for(var g in p)p.hasOwnProperty(g)&&(h[g]=p[g])}}return h},i.shrinkBuf=function(h,f){return h.length===f?h:h.subarray?h.subarray(0,f):(h.length=f,h)};var l={arraySet:function(h,f,p,g,b){if(f.subarray&&h.subarray)h.set(f.subarray(p,p+g),b);else for(var _=0;_<g;_++)h[b+_]=f[p+_]},flattenChunks:function(h){var f,p,g,b,_,w;for(f=g=0,p=h.length;f<p;f++)g+=h[f].length;for(w=new Uint8Array(g),f=b=0,p=h.length;f<p;f++)_=h[f],w.set(_,b),b+=_.length;return w}},u={arraySet:function(h,f,p,g,b){for(var _=0;_<g;_++)h[b+_]=f[p+_]},flattenChunks:function(h){return[].concat.apply([],h)}};i.setTyped=function(h){h?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,l)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,u))},i.setTyped(o)},{}],42:[function(n,r,i){var o=n("./common"),l=!0,u=!0;try{String.fromCharCode.apply(null,[0])}catch{l=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{u=!1}for(var h=new o.Buf8(256),f=0;f<256;f++)h[f]=252<=f?6:248<=f?5:240<=f?4:224<=f?3:192<=f?2:1;function p(g,b){if(b<65537&&(g.subarray&&u||!g.subarray&&l))return String.fromCharCode.apply(null,o.shrinkBuf(g,b));for(var _="",w=0;w<b;w++)_+=String.fromCharCode(g[w]);return _}h[254]=h[254]=1,i.string2buf=function(g){var b,_,w,x,S,C=g.length,T=0;for(x=0;x<C;x++)(64512&(_=g.charCodeAt(x)))==55296&&x+1<C&&(64512&(w=g.charCodeAt(x+1)))==56320&&(_=65536+(_-55296<<10)+(w-56320),x++),T+=_<128?1:_<2048?2:_<65536?3:4;for(b=new o.Buf8(T),x=S=0;S<T;x++)(64512&(_=g.charCodeAt(x)))==55296&&x+1<C&&(64512&(w=g.charCodeAt(x+1)))==56320&&(_=65536+(_-55296<<10)+(w-56320),x++),_<128?b[S++]=_:(_<2048?b[S++]=192|_>>>6:(_<65536?b[S++]=224|_>>>12:(b[S++]=240|_>>>18,b[S++]=128|_>>>12&63),b[S++]=128|_>>>6&63),b[S++]=128|63&_);return b},i.buf2binstring=function(g){return p(g,g.length)},i.binstring2buf=function(g){for(var b=new o.Buf8(g.length),_=0,w=b.length;_<w;_++)b[_]=g.charCodeAt(_);return b},i.buf2string=function(g,b){var _,w,x,S,C=b||g.length,T=new Array(2*C);for(_=w=0;_<C;)if((x=g[_++])<128)T[w++]=x;else if(4<(S=h[x]))T[w++]=65533,_+=S-1;else{for(x&=S===2?31:S===3?15:7;1<S&&_<C;)x=x<<6|63&g[_++],S--;1<S?T[w++]=65533:x<65536?T[w++]=x:(x-=65536,T[w++]=55296|x>>10&1023,T[w++]=56320|1023&x)}return p(T,w)},i.utf8border=function(g,b){var _;for((b=b||g.length)>g.length&&(b=g.length),_=b-1;0<=_&&(192&g[_])==128;)_--;return _<0||_===0?b:_+h[g[_]]>b?_:b}},{"./common":41}],43:[function(n,r,i){r.exports=function(o,l,u,h){for(var f=65535&o|0,p=o>>>16&65535|0,g=0;u!==0;){for(u-=g=2e3<u?2e3:u;p=p+(f=f+l[h++]|0)|0,--g;);f%=65521,p%=65521}return f|p<<16|0}},{}],44:[function(n,r,i){r.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(n,r,i){var o=(function(){for(var l,u=[],h=0;h<256;h++){l=h;for(var f=0;f<8;f++)l=1&l?3988292384^l>>>1:l>>>1;u[h]=l}return u})();r.exports=function(l,u,h,f){var p=o,g=f+h;l^=-1;for(var b=f;b<g;b++)l=l>>>8^p[255&(l^u[b])];return-1^l}},{}],46:[function(n,r,i){var o,l=n("../utils/common"),u=n("./trees"),h=n("./adler32"),f=n("./crc32"),p=n("./messages"),g=0,b=4,_=0,w=-2,x=-1,S=4,C=2,T=8,I=9,M=286,U=30,H=19,O=2*M+1,P=15,N=3,V=258,$=V+N+1,A=42,k=113,D=1,K=2,X=3,G=4;function te(L,de){return L.msg=p[de],de}function Q(L){return(L<<1)-(4<L?9:0)}function se(L){for(var de=L.length;0<=--de;)L[de]=0}function B(L){var de=L.state,_e=de.pending;_e>L.avail_out&&(_e=L.avail_out),_e!==0&&(l.arraySet(L.output,de.pending_buf,de.pending_out,_e,L.next_out),L.next_out+=_e,de.pending_out+=_e,L.total_out+=_e,L.avail_out-=_e,de.pending-=_e,de.pending===0&&(de.pending_out=0))}function q(L,de){u._tr_flush_block(L,0<=L.block_start?L.block_start:-1,L.strstart-L.block_start,de),L.block_start=L.strstart,B(L.strm)}function ee(L,de){L.pending_buf[L.pending++]=de}function ne(L,de){L.pending_buf[L.pending++]=de>>>8&255,L.pending_buf[L.pending++]=255&de}function le(L,de){var _e,J,Z=L.max_chain_length,oe=L.strstart,Se=L.prev_length,we=L.nice_match,ie=L.strstart>L.w_size-$?L.strstart-(L.w_size-$):0,Re=L.window,Pe=L.w_mask,Oe=L.prev,He=L.strstart+V,xt=Re[oe+Se-1],it=Re[oe+Se];L.prev_length>=L.good_match&&(Z>>=2),we>L.lookahead&&(we=L.lookahead);do if(Re[(_e=de)+Se]===it&&Re[_e+Se-1]===xt&&Re[_e]===Re[oe]&&Re[++_e]===Re[oe+1]){oe+=2,_e++;do;while(Re[++oe]===Re[++_e]&&Re[++oe]===Re[++_e]&&Re[++oe]===Re[++_e]&&Re[++oe]===Re[++_e]&&Re[++oe]===Re[++_e]&&Re[++oe]===Re[++_e]&&Re[++oe]===Re[++_e]&&Re[++oe]===Re[++_e]&&oe<He);if(J=V-(He-oe),oe=He-V,Se<J){if(L.match_start=de,we<=(Se=J))break;xt=Re[oe+Se-1],it=Re[oe+Se]}}while((de=Oe[de&Pe])>ie&&--Z!=0);return Se<=L.lookahead?Se:L.lookahead}function he(L){var de,_e,J,Z,oe,Se,we,ie,Re,Pe,Oe=L.w_size;do{if(Z=L.window_size-L.lookahead-L.strstart,L.strstart>=Oe+(Oe-$)){for(l.arraySet(L.window,L.window,Oe,Oe,0),L.match_start-=Oe,L.strstart-=Oe,L.block_start-=Oe,de=_e=L.hash_size;J=L.head[--de],L.head[de]=Oe<=J?J-Oe:0,--_e;);for(de=_e=Oe;J=L.prev[--de],L.prev[de]=Oe<=J?J-Oe:0,--_e;);Z+=Oe}if(L.strm.avail_in===0)break;if(Se=L.strm,we=L.window,ie=L.strstart+L.lookahead,Re=Z,Pe=void 0,Pe=Se.avail_in,Re<Pe&&(Pe=Re),_e=Pe===0?0:(Se.avail_in-=Pe,l.arraySet(we,Se.input,Se.next_in,Pe,ie),Se.state.wrap===1?Se.adler=h(Se.adler,we,Pe,ie):Se.state.wrap===2&&(Se.adler=f(Se.adler,we,Pe,ie)),Se.next_in+=Pe,Se.total_in+=Pe,Pe),L.lookahead+=_e,L.lookahead+L.insert>=N)for(oe=L.strstart-L.insert,L.ins_h=L.window[oe],L.ins_h=(L.ins_h<<L.hash_shift^L.window[oe+1])&L.hash_mask;L.insert&&(L.ins_h=(L.ins_h<<L.hash_shift^L.window[oe+N-1])&L.hash_mask,L.prev[oe&L.w_mask]=L.head[L.ins_h],L.head[L.ins_h]=oe,oe++,L.insert--,!(L.lookahead+L.insert<N)););}while(L.lookahead<$&&L.strm.avail_in!==0)}function Ee(L,de){for(var _e,J;;){if(L.lookahead<$){if(he(L),L.lookahead<$&&de===g)return D;if(L.lookahead===0)break}if(_e=0,L.lookahead>=N&&(L.ins_h=(L.ins_h<<L.hash_shift^L.window[L.strstart+N-1])&L.hash_mask,_e=L.prev[L.strstart&L.w_mask]=L.head[L.ins_h],L.head[L.ins_h]=L.strstart),_e!==0&&L.strstart-_e<=L.w_size-$&&(L.match_length=le(L,_e)),L.match_length>=N)if(J=u._tr_tally(L,L.strstart-L.match_start,L.match_length-N),L.lookahead-=L.match_length,L.match_length<=L.max_lazy_match&&L.lookahead>=N){for(L.match_length--;L.strstart++,L.ins_h=(L.ins_h<<L.hash_shift^L.window[L.strstart+N-1])&L.hash_mask,_e=L.prev[L.strstart&L.w_mask]=L.head[L.ins_h],L.head[L.ins_h]=L.strstart,--L.match_length!=0;);L.strstart++}else L.strstart+=L.match_length,L.match_length=0,L.ins_h=L.window[L.strstart],L.ins_h=(L.ins_h<<L.hash_shift^L.window[L.strstart+1])&L.hash_mask;else J=u._tr_tally(L,0,L.window[L.strstart]),L.lookahead--,L.strstart++;if(J&&(q(L,!1),L.strm.avail_out===0))return D}return L.insert=L.strstart<N-1?L.strstart:N-1,de===b?(q(L,!0),L.strm.avail_out===0?X:G):L.last_lit&&(q(L,!1),L.strm.avail_out===0)?D:K}function ae(L,de){for(var _e,J,Z;;){if(L.lookahead<$){if(he(L),L.lookahead<$&&de===g)return D;if(L.lookahead===0)break}if(_e=0,L.lookahead>=N&&(L.ins_h=(L.ins_h<<L.hash_shift^L.window[L.strstart+N-1])&L.hash_mask,_e=L.prev[L.strstart&L.w_mask]=L.head[L.ins_h],L.head[L.ins_h]=L.strstart),L.prev_length=L.match_length,L.prev_match=L.match_start,L.match_length=N-1,_e!==0&&L.prev_length<L.max_lazy_match&&L.strstart-_e<=L.w_size-$&&(L.match_length=le(L,_e),L.match_length<=5&&(L.strategy===1||L.match_length===N&&4096<L.strstart-L.match_start)&&(L.match_length=N-1)),L.prev_length>=N&&L.match_length<=L.prev_length){for(Z=L.strstart+L.lookahead-N,J=u._tr_tally(L,L.strstart-1-L.prev_match,L.prev_length-N),L.lookahead-=L.prev_length-1,L.prev_length-=2;++L.strstart<=Z&&(L.ins_h=(L.ins_h<<L.hash_shift^L.window[L.strstart+N-1])&L.hash_mask,_e=L.prev[L.strstart&L.w_mask]=L.head[L.ins_h],L.head[L.ins_h]=L.strstart),--L.prev_length!=0;);if(L.match_available=0,L.match_length=N-1,L.strstart++,J&&(q(L,!1),L.strm.avail_out===0))return D}else if(L.match_available){if((J=u._tr_tally(L,0,L.window[L.strstart-1]))&&q(L,!1),L.strstart++,L.lookahead--,L.strm.avail_out===0)return D}else L.match_available=1,L.strstart++,L.lookahead--}return L.match_available&&(J=u._tr_tally(L,0,L.window[L.strstart-1]),L.match_available=0),L.insert=L.strstart<N-1?L.strstart:N-1,de===b?(q(L,!0),L.strm.avail_out===0?X:G):L.last_lit&&(q(L,!1),L.strm.avail_out===0)?D:K}function fe(L,de,_e,J,Z){this.good_length=L,this.max_lazy=de,this.nice_length=_e,this.max_chain=J,this.func=Z}function Me(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=T,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new l.Buf16(2*O),this.dyn_dtree=new l.Buf16(2*(2*U+1)),this.bl_tree=new l.Buf16(2*(2*H+1)),se(this.dyn_ltree),se(this.dyn_dtree),se(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new l.Buf16(P+1),this.heap=new l.Buf16(2*M+1),se(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new l.Buf16(2*M+1),se(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Ne(L){var de;return L&&L.state?(L.total_in=L.total_out=0,L.data_type=C,(de=L.state).pending=0,de.pending_out=0,de.wrap<0&&(de.wrap=-de.wrap),de.status=de.wrap?A:k,L.adler=de.wrap===2?0:1,de.last_flush=g,u._tr_init(de),_):te(L,w)}function tt(L){var de=Ne(L);return de===_&&(function(_e){_e.window_size=2*_e.w_size,se(_e.head),_e.max_lazy_match=o[_e.level].max_lazy,_e.good_match=o[_e.level].good_length,_e.nice_match=o[_e.level].nice_length,_e.max_chain_length=o[_e.level].max_chain,_e.strstart=0,_e.block_start=0,_e.lookahead=0,_e.insert=0,_e.match_length=_e.prev_length=N-1,_e.match_available=0,_e.ins_h=0})(L.state),de}function Ue(L,de,_e,J,Z,oe){if(!L)return w;var Se=1;if(de===x&&(de=6),J<0?(Se=0,J=-J):15<J&&(Se=2,J-=16),Z<1||I<Z||_e!==T||J<8||15<J||de<0||9<de||oe<0||S<oe)return te(L,w);J===8&&(J=9);var we=new Me;return(L.state=we).strm=L,we.wrap=Se,we.gzhead=null,we.w_bits=J,we.w_size=1<<we.w_bits,we.w_mask=we.w_size-1,we.hash_bits=Z+7,we.hash_size=1<<we.hash_bits,we.hash_mask=we.hash_size-1,we.hash_shift=~~((we.hash_bits+N-1)/N),we.window=new l.Buf8(2*we.w_size),we.head=new l.Buf16(we.hash_size),we.prev=new l.Buf16(we.w_size),we.lit_bufsize=1<<Z+6,we.pending_buf_size=4*we.lit_bufsize,we.pending_buf=new l.Buf8(we.pending_buf_size),we.d_buf=1*we.lit_bufsize,we.l_buf=3*we.lit_bufsize,we.level=de,we.strategy=oe,we.method=_e,tt(L)}o=[new fe(0,0,0,0,function(L,de){var _e=65535;for(_e>L.pending_buf_size-5&&(_e=L.pending_buf_size-5);;){if(L.lookahead<=1){if(he(L),L.lookahead===0&&de===g)return D;if(L.lookahead===0)break}L.strstart+=L.lookahead,L.lookahead=0;var J=L.block_start+_e;if((L.strstart===0||L.strstart>=J)&&(L.lookahead=L.strstart-J,L.strstart=J,q(L,!1),L.strm.avail_out===0)||L.strstart-L.block_start>=L.w_size-$&&(q(L,!1),L.strm.avail_out===0))return D}return L.insert=0,de===b?(q(L,!0),L.strm.avail_out===0?X:G):(L.strstart>L.block_start&&(q(L,!1),L.strm.avail_out),D)}),new fe(4,4,8,4,Ee),new fe(4,5,16,8,Ee),new fe(4,6,32,32,Ee),new fe(4,4,16,16,ae),new fe(8,16,32,32,ae),new fe(8,16,128,128,ae),new fe(8,32,128,256,ae),new fe(32,128,258,1024,ae),new fe(32,258,258,4096,ae)],i.deflateInit=function(L,de){return Ue(L,de,T,15,8,0)},i.deflateInit2=Ue,i.deflateReset=tt,i.deflateResetKeep=Ne,i.deflateSetHeader=function(L,de){return L&&L.state?L.state.wrap!==2?w:(L.state.gzhead=de,_):w},i.deflate=function(L,de){var _e,J,Z,oe;if(!L||!L.state||5<de||de<0)return L?te(L,w):w;if(J=L.state,!L.output||!L.input&&L.avail_in!==0||J.status===666&&de!==b)return te(L,L.avail_out===0?-5:w);if(J.strm=L,_e=J.last_flush,J.last_flush=de,J.status===A)if(J.wrap===2)L.adler=0,ee(J,31),ee(J,139),ee(J,8),J.gzhead?(ee(J,(J.gzhead.text?1:0)+(J.gzhead.hcrc?2:0)+(J.gzhead.extra?4:0)+(J.gzhead.name?8:0)+(J.gzhead.comment?16:0)),ee(J,255&J.gzhead.time),ee(J,J.gzhead.time>>8&255),ee(J,J.gzhead.time>>16&255),ee(J,J.gzhead.time>>24&255),ee(J,J.level===9?2:2<=J.strategy||J.level<2?4:0),ee(J,255&J.gzhead.os),J.gzhead.extra&&J.gzhead.extra.length&&(ee(J,255&J.gzhead.extra.length),ee(J,J.gzhead.extra.length>>8&255)),J.gzhead.hcrc&&(L.adler=f(L.adler,J.pending_buf,J.pending,0)),J.gzindex=0,J.status=69):(ee(J,0),ee(J,0),ee(J,0),ee(J,0),ee(J,0),ee(J,J.level===9?2:2<=J.strategy||J.level<2?4:0),ee(J,3),J.status=k);else{var Se=T+(J.w_bits-8<<4)<<8;Se|=(2<=J.strategy||J.level<2?0:J.level<6?1:J.level===6?2:3)<<6,J.strstart!==0&&(Se|=32),Se+=31-Se%31,J.status=k,ne(J,Se),J.strstart!==0&&(ne(J,L.adler>>>16),ne(J,65535&L.adler)),L.adler=1}if(J.status===69)if(J.gzhead.extra){for(Z=J.pending;J.gzindex<(65535&J.gzhead.extra.length)&&(J.pending!==J.pending_buf_size||(J.gzhead.hcrc&&J.pending>Z&&(L.adler=f(L.adler,J.pending_buf,J.pending-Z,Z)),B(L),Z=J.pending,J.pending!==J.pending_buf_size));)ee(J,255&J.gzhead.extra[J.gzindex]),J.gzindex++;J.gzhead.hcrc&&J.pending>Z&&(L.adler=f(L.adler,J.pending_buf,J.pending-Z,Z)),J.gzindex===J.gzhead.extra.length&&(J.gzindex=0,J.status=73)}else J.status=73;if(J.status===73)if(J.gzhead.name){Z=J.pending;do{if(J.pending===J.pending_buf_size&&(J.gzhead.hcrc&&J.pending>Z&&(L.adler=f(L.adler,J.pending_buf,J.pending-Z,Z)),B(L),Z=J.pending,J.pending===J.pending_buf_size)){oe=1;break}oe=J.gzindex<J.gzhead.name.length?255&J.gzhead.name.charCodeAt(J.gzindex++):0,ee(J,oe)}while(oe!==0);J.gzhead.hcrc&&J.pending>Z&&(L.adler=f(L.adler,J.pending_buf,J.pending-Z,Z)),oe===0&&(J.gzindex=0,J.status=91)}else J.status=91;if(J.status===91)if(J.gzhead.comment){Z=J.pending;do{if(J.pending===J.pending_buf_size&&(J.gzhead.hcrc&&J.pending>Z&&(L.adler=f(L.adler,J.pending_buf,J.pending-Z,Z)),B(L),Z=J.pending,J.pending===J.pending_buf_size)){oe=1;break}oe=J.gzindex<J.gzhead.comment.length?255&J.gzhead.comment.charCodeAt(J.gzindex++):0,ee(J,oe)}while(oe!==0);J.gzhead.hcrc&&J.pending>Z&&(L.adler=f(L.adler,J.pending_buf,J.pending-Z,Z)),oe===0&&(J.status=103)}else J.status=103;if(J.status===103&&(J.gzhead.hcrc?(J.pending+2>J.pending_buf_size&&B(L),J.pending+2<=J.pending_buf_size&&(ee(J,255&L.adler),ee(J,L.adler>>8&255),L.adler=0,J.status=k)):J.status=k),J.pending!==0){if(B(L),L.avail_out===0)return J.last_flush=-1,_}else if(L.avail_in===0&&Q(de)<=Q(_e)&&de!==b)return te(L,-5);if(J.status===666&&L.avail_in!==0)return te(L,-5);if(L.avail_in!==0||J.lookahead!==0||de!==g&&J.status!==666){var we=J.strategy===2?(function(ie,Re){for(var Pe;;){if(ie.lookahead===0&&(he(ie),ie.lookahead===0)){if(Re===g)return D;break}if(ie.match_length=0,Pe=u._tr_tally(ie,0,ie.window[ie.strstart]),ie.lookahead--,ie.strstart++,Pe&&(q(ie,!1),ie.strm.avail_out===0))return D}return ie.insert=0,Re===b?(q(ie,!0),ie.strm.avail_out===0?X:G):ie.last_lit&&(q(ie,!1),ie.strm.avail_out===0)?D:K})(J,de):J.strategy===3?(function(ie,Re){for(var Pe,Oe,He,xt,it=ie.window;;){if(ie.lookahead<=V){if(he(ie),ie.lookahead<=V&&Re===g)return D;if(ie.lookahead===0)break}if(ie.match_length=0,ie.lookahead>=N&&0<ie.strstart&&(Oe=it[He=ie.strstart-1])===it[++He]&&Oe===it[++He]&&Oe===it[++He]){xt=ie.strstart+V;do;while(Oe===it[++He]&&Oe===it[++He]&&Oe===it[++He]&&Oe===it[++He]&&Oe===it[++He]&&Oe===it[++He]&&Oe===it[++He]&&Oe===it[++He]&&He<xt);ie.match_length=V-(xt-He),ie.match_length>ie.lookahead&&(ie.match_length=ie.lookahead)}if(ie.match_length>=N?(Pe=u._tr_tally(ie,1,ie.match_length-N),ie.lookahead-=ie.match_length,ie.strstart+=ie.match_length,ie.match_length=0):(Pe=u._tr_tally(ie,0,ie.window[ie.strstart]),ie.lookahead--,ie.strstart++),Pe&&(q(ie,!1),ie.strm.avail_out===0))return D}return ie.insert=0,Re===b?(q(ie,!0),ie.strm.avail_out===0?X:G):ie.last_lit&&(q(ie,!1),ie.strm.avail_out===0)?D:K})(J,de):o[J.level].func(J,de);if(we!==X&&we!==G||(J.status=666),we===D||we===X)return L.avail_out===0&&(J.last_flush=-1),_;if(we===K&&(de===1?u._tr_align(J):de!==5&&(u._tr_stored_block(J,0,0,!1),de===3&&(se(J.head),J.lookahead===0&&(J.strstart=0,J.block_start=0,J.insert=0))),B(L),L.avail_out===0))return J.last_flush=-1,_}return de!==b?_:J.wrap<=0?1:(J.wrap===2?(ee(J,255&L.adler),ee(J,L.adler>>8&255),ee(J,L.adler>>16&255),ee(J,L.adler>>24&255),ee(J,255&L.total_in),ee(J,L.total_in>>8&255),ee(J,L.total_in>>16&255),ee(J,L.total_in>>24&255)):(ne(J,L.adler>>>16),ne(J,65535&L.adler)),B(L),0<J.wrap&&(J.wrap=-J.wrap),J.pending!==0?_:1)},i.deflateEnd=function(L){var de;return L&&L.state?(de=L.state.status)!==A&&de!==69&&de!==73&&de!==91&&de!==103&&de!==k&&de!==666?te(L,w):(L.state=null,de===k?te(L,-3):_):w},i.deflateSetDictionary=function(L,de){var _e,J,Z,oe,Se,we,ie,Re,Pe=de.length;if(!L||!L.state||(oe=(_e=L.state).wrap)===2||oe===1&&_e.status!==A||_e.lookahead)return w;for(oe===1&&(L.adler=h(L.adler,de,Pe,0)),_e.wrap=0,Pe>=_e.w_size&&(oe===0&&(se(_e.head),_e.strstart=0,_e.block_start=0,_e.insert=0),Re=new l.Buf8(_e.w_size),l.arraySet(Re,de,Pe-_e.w_size,_e.w_size,0),de=Re,Pe=_e.w_size),Se=L.avail_in,we=L.next_in,ie=L.input,L.avail_in=Pe,L.next_in=0,L.input=de,he(_e);_e.lookahead>=N;){for(J=_e.strstart,Z=_e.lookahead-(N-1);_e.ins_h=(_e.ins_h<<_e.hash_shift^_e.window[J+N-1])&_e.hash_mask,_e.prev[J&_e.w_mask]=_e.head[_e.ins_h],_e.head[_e.ins_h]=J,J++,--Z;);_e.strstart=J,_e.lookahead=N-1,he(_e)}return _e.strstart+=_e.lookahead,_e.block_start=_e.strstart,_e.insert=_e.lookahead,_e.lookahead=0,_e.match_length=_e.prev_length=N-1,_e.match_available=0,L.next_in=we,L.input=ie,L.avail_in=Se,_e.wrap=oe,_},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(n,r,i){r.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(n,r,i){r.exports=function(o,l){var u,h,f,p,g,b,_,w,x,S,C,T,I,M,U,H,O,P,N,V,$,A,k,D,K;u=o.state,h=o.next_in,D=o.input,f=h+(o.avail_in-5),p=o.next_out,K=o.output,g=p-(l-o.avail_out),b=p+(o.avail_out-257),_=u.dmax,w=u.wsize,x=u.whave,S=u.wnext,C=u.window,T=u.hold,I=u.bits,M=u.lencode,U=u.distcode,H=(1<<u.lenbits)-1,O=(1<<u.distbits)-1;e:do{I<15&&(T+=D[h++]<<I,I+=8,T+=D[h++]<<I,I+=8),P=M[T&H];t:for(;;){if(T>>>=N=P>>>24,I-=N,(N=P>>>16&255)===0)K[p++]=65535&P;else{if(!(16&N)){if((64&N)==0){P=M[(65535&P)+(T&(1<<N)-1)];continue t}if(32&N){u.mode=12;break e}o.msg="invalid literal/length code",u.mode=30;break e}V=65535&P,(N&=15)&&(I<N&&(T+=D[h++]<<I,I+=8),V+=T&(1<<N)-1,T>>>=N,I-=N),I<15&&(T+=D[h++]<<I,I+=8,T+=D[h++]<<I,I+=8),P=U[T&O];n:for(;;){if(T>>>=N=P>>>24,I-=N,!(16&(N=P>>>16&255))){if((64&N)==0){P=U[(65535&P)+(T&(1<<N)-1)];continue n}o.msg="invalid distance code",u.mode=30;break e}if($=65535&P,I<(N&=15)&&(T+=D[h++]<<I,(I+=8)<N&&(T+=D[h++]<<I,I+=8)),_<($+=T&(1<<N)-1)){o.msg="invalid distance too far back",u.mode=30;break e}if(T>>>=N,I-=N,(N=p-g)<$){if(x<(N=$-N)&&u.sane){o.msg="invalid distance too far back",u.mode=30;break e}if(k=C,(A=0)===S){if(A+=w-N,N<V){for(V-=N;K[p++]=C[A++],--N;);A=p-$,k=K}}else if(S<N){if(A+=w+S-N,(N-=S)<V){for(V-=N;K[p++]=C[A++],--N;);if(A=0,S<V){for(V-=N=S;K[p++]=C[A++],--N;);A=p-$,k=K}}}else if(A+=S-N,N<V){for(V-=N;K[p++]=C[A++],--N;);A=p-$,k=K}for(;2<V;)K[p++]=k[A++],K[p++]=k[A++],K[p++]=k[A++],V-=3;V&&(K[p++]=k[A++],1<V&&(K[p++]=k[A++]))}else{for(A=p-$;K[p++]=K[A++],K[p++]=K[A++],K[p++]=K[A++],2<(V-=3););V&&(K[p++]=K[A++],1<V&&(K[p++]=K[A++]))}break}}break}}while(h<f&&p<b);h-=V=I>>3,T&=(1<<(I-=V<<3))-1,o.next_in=h,o.next_out=p,o.avail_in=h<f?f-h+5:5-(h-f),o.avail_out=p<b?b-p+257:257-(p-b),u.hold=T,u.bits=I}},{}],49:[function(n,r,i){var o=n("../utils/common"),l=n("./adler32"),u=n("./crc32"),h=n("./inffast"),f=n("./inftrees"),p=1,g=2,b=0,_=-2,w=1,x=852,S=592;function C(A){return(A>>>24&255)+(A>>>8&65280)+((65280&A)<<8)+((255&A)<<24)}function T(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new o.Buf16(320),this.work=new o.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function I(A){var k;return A&&A.state?(k=A.state,A.total_in=A.total_out=k.total=0,A.msg="",k.wrap&&(A.adler=1&k.wrap),k.mode=w,k.last=0,k.havedict=0,k.dmax=32768,k.head=null,k.hold=0,k.bits=0,k.lencode=k.lendyn=new o.Buf32(x),k.distcode=k.distdyn=new o.Buf32(S),k.sane=1,k.back=-1,b):_}function M(A){var k;return A&&A.state?((k=A.state).wsize=0,k.whave=0,k.wnext=0,I(A)):_}function U(A,k){var D,K;return A&&A.state?(K=A.state,k<0?(D=0,k=-k):(D=1+(k>>4),k<48&&(k&=15)),k&&(k<8||15<k)?_:(K.window!==null&&K.wbits!==k&&(K.window=null),K.wrap=D,K.wbits=k,M(A))):_}function H(A,k){var D,K;return A?(K=new T,(A.state=K).window=null,(D=U(A,k))!==b&&(A.state=null),D):_}var O,P,N=!0;function V(A){if(N){var k;for(O=new o.Buf32(512),P=new o.Buf32(32),k=0;k<144;)A.lens[k++]=8;for(;k<256;)A.lens[k++]=9;for(;k<280;)A.lens[k++]=7;for(;k<288;)A.lens[k++]=8;for(f(p,A.lens,0,288,O,0,A.work,{bits:9}),k=0;k<32;)A.lens[k++]=5;f(g,A.lens,0,32,P,0,A.work,{bits:5}),N=!1}A.lencode=O,A.lenbits=9,A.distcode=P,A.distbits=5}function $(A,k,D,K){var X,G=A.state;return G.window===null&&(G.wsize=1<<G.wbits,G.wnext=0,G.whave=0,G.window=new o.Buf8(G.wsize)),K>=G.wsize?(o.arraySet(G.window,k,D-G.wsize,G.wsize,0),G.wnext=0,G.whave=G.wsize):(K<(X=G.wsize-G.wnext)&&(X=K),o.arraySet(G.window,k,D-K,X,G.wnext),(K-=X)?(o.arraySet(G.window,k,D-K,K,0),G.wnext=K,G.whave=G.wsize):(G.wnext+=X,G.wnext===G.wsize&&(G.wnext=0),G.whave<G.wsize&&(G.whave+=X))),0}i.inflateReset=M,i.inflateReset2=U,i.inflateResetKeep=I,i.inflateInit=function(A){return H(A,15)},i.inflateInit2=H,i.inflate=function(A,k){var D,K,X,G,te,Q,se,B,q,ee,ne,le,he,Ee,ae,fe,Me,Ne,tt,Ue,L,de,_e,J,Z=0,oe=new o.Buf8(4),Se=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!A||!A.state||!A.output||!A.input&&A.avail_in!==0)return _;(D=A.state).mode===12&&(D.mode=13),te=A.next_out,X=A.output,se=A.avail_out,G=A.next_in,K=A.input,Q=A.avail_in,B=D.hold,q=D.bits,ee=Q,ne=se,de=b;e:for(;;)switch(D.mode){case w:if(D.wrap===0){D.mode=13;break}for(;q<16;){if(Q===0)break e;Q--,B+=K[G++]<<q,q+=8}if(2&D.wrap&&B===35615){oe[D.check=0]=255&B,oe[1]=B>>>8&255,D.check=u(D.check,oe,2,0),q=B=0,D.mode=2;break}if(D.flags=0,D.head&&(D.head.done=!1),!(1&D.wrap)||(((255&B)<<8)+(B>>8))%31){A.msg="incorrect header check",D.mode=30;break}if((15&B)!=8){A.msg="unknown compression method",D.mode=30;break}if(q-=4,L=8+(15&(B>>>=4)),D.wbits===0)D.wbits=L;else if(L>D.wbits){A.msg="invalid window size",D.mode=30;break}D.dmax=1<<L,A.adler=D.check=1,D.mode=512&B?10:12,q=B=0;break;case 2:for(;q<16;){if(Q===0)break e;Q--,B+=K[G++]<<q,q+=8}if(D.flags=B,(255&D.flags)!=8){A.msg="unknown compression method",D.mode=30;break}if(57344&D.flags){A.msg="unknown header flags set",D.mode=30;break}D.head&&(D.head.text=B>>8&1),512&D.flags&&(oe[0]=255&B,oe[1]=B>>>8&255,D.check=u(D.check,oe,2,0)),q=B=0,D.mode=3;case 3:for(;q<32;){if(Q===0)break e;Q--,B+=K[G++]<<q,q+=8}D.head&&(D.head.time=B),512&D.flags&&(oe[0]=255&B,oe[1]=B>>>8&255,oe[2]=B>>>16&255,oe[3]=B>>>24&255,D.check=u(D.check,oe,4,0)),q=B=0,D.mode=4;case 4:for(;q<16;){if(Q===0)break e;Q--,B+=K[G++]<<q,q+=8}D.head&&(D.head.xflags=255&B,D.head.os=B>>8),512&D.flags&&(oe[0]=255&B,oe[1]=B>>>8&255,D.check=u(D.check,oe,2,0)),q=B=0,D.mode=5;case 5:if(1024&D.flags){for(;q<16;){if(Q===0)break e;Q--,B+=K[G++]<<q,q+=8}D.length=B,D.head&&(D.head.extra_len=B),512&D.flags&&(oe[0]=255&B,oe[1]=B>>>8&255,D.check=u(D.check,oe,2,0)),q=B=0}else D.head&&(D.head.extra=null);D.mode=6;case 6:if(1024&D.flags&&(Q<(le=D.length)&&(le=Q),le&&(D.head&&(L=D.head.extra_len-D.length,D.head.extra||(D.head.extra=new Array(D.head.extra_len)),o.arraySet(D.head.extra,K,G,le,L)),512&D.flags&&(D.check=u(D.check,K,le,G)),Q-=le,G+=le,D.length-=le),D.length))break e;D.length=0,D.mode=7;case 7:if(2048&D.flags){if(Q===0)break e;for(le=0;L=K[G+le++],D.head&&L&&D.length<65536&&(D.head.name+=String.fromCharCode(L)),L&&le<Q;);if(512&D.flags&&(D.check=u(D.check,K,le,G)),Q-=le,G+=le,L)break e}else D.head&&(D.head.name=null);D.length=0,D.mode=8;case 8:if(4096&D.flags){if(Q===0)break e;for(le=0;L=K[G+le++],D.head&&L&&D.length<65536&&(D.head.comment+=String.fromCharCode(L)),L&&le<Q;);if(512&D.flags&&(D.check=u(D.check,K,le,G)),Q-=le,G+=le,L)break e}else D.head&&(D.head.comment=null);D.mode=9;case 9:if(512&D.flags){for(;q<16;){if(Q===0)break e;Q--,B+=K[G++]<<q,q+=8}if(B!==(65535&D.check)){A.msg="header crc mismatch",D.mode=30;break}q=B=0}D.head&&(D.head.hcrc=D.flags>>9&1,D.head.done=!0),A.adler=D.check=0,D.mode=12;break;case 10:for(;q<32;){if(Q===0)break e;Q--,B+=K[G++]<<q,q+=8}A.adler=D.check=C(B),q=B=0,D.mode=11;case 11:if(D.havedict===0)return A.next_out=te,A.avail_out=se,A.next_in=G,A.avail_in=Q,D.hold=B,D.bits=q,2;A.adler=D.check=1,D.mode=12;case 12:if(k===5||k===6)break e;case 13:if(D.last){B>>>=7&q,q-=7&q,D.mode=27;break}for(;q<3;){if(Q===0)break e;Q--,B+=K[G++]<<q,q+=8}switch(D.last=1&B,q-=1,3&(B>>>=1)){case 0:D.mode=14;break;case 1:if(V(D),D.mode=20,k!==6)break;B>>>=2,q-=2;break e;case 2:D.mode=17;break;case 3:A.msg="invalid block type",D.mode=30}B>>>=2,q-=2;break;case 14:for(B>>>=7&q,q-=7&q;q<32;){if(Q===0)break e;Q--,B+=K[G++]<<q,q+=8}if((65535&B)!=(B>>>16^65535)){A.msg="invalid stored block lengths",D.mode=30;break}if(D.length=65535&B,q=B=0,D.mode=15,k===6)break e;case 15:D.mode=16;case 16:if(le=D.length){if(Q<le&&(le=Q),se<le&&(le=se),le===0)break e;o.arraySet(X,K,G,le,te),Q-=le,G+=le,se-=le,te+=le,D.length-=le;break}D.mode=12;break;case 17:for(;q<14;){if(Q===0)break e;Q--,B+=K[G++]<<q,q+=8}if(D.nlen=257+(31&B),B>>>=5,q-=5,D.ndist=1+(31&B),B>>>=5,q-=5,D.ncode=4+(15&B),B>>>=4,q-=4,286<D.nlen||30<D.ndist){A.msg="too many length or distance symbols",D.mode=30;break}D.have=0,D.mode=18;case 18:for(;D.have<D.ncode;){for(;q<3;){if(Q===0)break e;Q--,B+=K[G++]<<q,q+=8}D.lens[Se[D.have++]]=7&B,B>>>=3,q-=3}for(;D.have<19;)D.lens[Se[D.have++]]=0;if(D.lencode=D.lendyn,D.lenbits=7,_e={bits:D.lenbits},de=f(0,D.lens,0,19,D.lencode,0,D.work,_e),D.lenbits=_e.bits,de){A.msg="invalid code lengths set",D.mode=30;break}D.have=0,D.mode=19;case 19:for(;D.have<D.nlen+D.ndist;){for(;fe=(Z=D.lencode[B&(1<<D.lenbits)-1])>>>16&255,Me=65535&Z,!((ae=Z>>>24)<=q);){if(Q===0)break e;Q--,B+=K[G++]<<q,q+=8}if(Me<16)B>>>=ae,q-=ae,D.lens[D.have++]=Me;else{if(Me===16){for(J=ae+2;q<J;){if(Q===0)break e;Q--,B+=K[G++]<<q,q+=8}if(B>>>=ae,q-=ae,D.have===0){A.msg="invalid bit length repeat",D.mode=30;break}L=D.lens[D.have-1],le=3+(3&B),B>>>=2,q-=2}else if(Me===17){for(J=ae+3;q<J;){if(Q===0)break e;Q--,B+=K[G++]<<q,q+=8}q-=ae,L=0,le=3+(7&(B>>>=ae)),B>>>=3,q-=3}else{for(J=ae+7;q<J;){if(Q===0)break e;Q--,B+=K[G++]<<q,q+=8}q-=ae,L=0,le=11+(127&(B>>>=ae)),B>>>=7,q-=7}if(D.have+le>D.nlen+D.ndist){A.msg="invalid bit length repeat",D.mode=30;break}for(;le--;)D.lens[D.have++]=L}}if(D.mode===30)break;if(D.lens[256]===0){A.msg="invalid code -- missing end-of-block",D.mode=30;break}if(D.lenbits=9,_e={bits:D.lenbits},de=f(p,D.lens,0,D.nlen,D.lencode,0,D.work,_e),D.lenbits=_e.bits,de){A.msg="invalid literal/lengths set",D.mode=30;break}if(D.distbits=6,D.distcode=D.distdyn,_e={bits:D.distbits},de=f(g,D.lens,D.nlen,D.ndist,D.distcode,0,D.work,_e),D.distbits=_e.bits,de){A.msg="invalid distances set",D.mode=30;break}if(D.mode=20,k===6)break e;case 20:D.mode=21;case 21:if(6<=Q&&258<=se){A.next_out=te,A.avail_out=se,A.next_in=G,A.avail_in=Q,D.hold=B,D.bits=q,h(A,ne),te=A.next_out,X=A.output,se=A.avail_out,G=A.next_in,K=A.input,Q=A.avail_in,B=D.hold,q=D.bits,D.mode===12&&(D.back=-1);break}for(D.back=0;fe=(Z=D.lencode[B&(1<<D.lenbits)-1])>>>16&255,Me=65535&Z,!((ae=Z>>>24)<=q);){if(Q===0)break e;Q--,B+=K[G++]<<q,q+=8}if(fe&&(240&fe)==0){for(Ne=ae,tt=fe,Ue=Me;fe=(Z=D.lencode[Ue+((B&(1<<Ne+tt)-1)>>Ne)])>>>16&255,Me=65535&Z,!(Ne+(ae=Z>>>24)<=q);){if(Q===0)break e;Q--,B+=K[G++]<<q,q+=8}B>>>=Ne,q-=Ne,D.back+=Ne}if(B>>>=ae,q-=ae,D.back+=ae,D.length=Me,fe===0){D.mode=26;break}if(32&fe){D.back=-1,D.mode=12;break}if(64&fe){A.msg="invalid literal/length code",D.mode=30;break}D.extra=15&fe,D.mode=22;case 22:if(D.extra){for(J=D.extra;q<J;){if(Q===0)break e;Q--,B+=K[G++]<<q,q+=8}D.length+=B&(1<<D.extra)-1,B>>>=D.extra,q-=D.extra,D.back+=D.extra}D.was=D.length,D.mode=23;case 23:for(;fe=(Z=D.distcode[B&(1<<D.distbits)-1])>>>16&255,Me=65535&Z,!((ae=Z>>>24)<=q);){if(Q===0)break e;Q--,B+=K[G++]<<q,q+=8}if((240&fe)==0){for(Ne=ae,tt=fe,Ue=Me;fe=(Z=D.distcode[Ue+((B&(1<<Ne+tt)-1)>>Ne)])>>>16&255,Me=65535&Z,!(Ne+(ae=Z>>>24)<=q);){if(Q===0)break e;Q--,B+=K[G++]<<q,q+=8}B>>>=Ne,q-=Ne,D.back+=Ne}if(B>>>=ae,q-=ae,D.back+=ae,64&fe){A.msg="invalid distance code",D.mode=30;break}D.offset=Me,D.extra=15&fe,D.mode=24;case 24:if(D.extra){for(J=D.extra;q<J;){if(Q===0)break e;Q--,B+=K[G++]<<q,q+=8}D.offset+=B&(1<<D.extra)-1,B>>>=D.extra,q-=D.extra,D.back+=D.extra}if(D.offset>D.dmax){A.msg="invalid distance too far back",D.mode=30;break}D.mode=25;case 25:if(se===0)break e;if(le=ne-se,D.offset>le){if((le=D.offset-le)>D.whave&&D.sane){A.msg="invalid distance too far back",D.mode=30;break}he=le>D.wnext?(le-=D.wnext,D.wsize-le):D.wnext-le,le>D.length&&(le=D.length),Ee=D.window}else Ee=X,he=te-D.offset,le=D.length;for(se<le&&(le=se),se-=le,D.length-=le;X[te++]=Ee[he++],--le;);D.length===0&&(D.mode=21);break;case 26:if(se===0)break e;X[te++]=D.length,se--,D.mode=21;break;case 27:if(D.wrap){for(;q<32;){if(Q===0)break e;Q--,B|=K[G++]<<q,q+=8}if(ne-=se,A.total_out+=ne,D.total+=ne,ne&&(A.adler=D.check=D.flags?u(D.check,X,ne,te-ne):l(D.check,X,ne,te-ne)),ne=se,(D.flags?B:C(B))!==D.check){A.msg="incorrect data check",D.mode=30;break}q=B=0}D.mode=28;case 28:if(D.wrap&&D.flags){for(;q<32;){if(Q===0)break e;Q--,B+=K[G++]<<q,q+=8}if(B!==(4294967295&D.total)){A.msg="incorrect length check",D.mode=30;break}q=B=0}D.mode=29;case 29:de=1;break e;case 30:de=-3;break e;case 31:return-4;default:return _}return A.next_out=te,A.avail_out=se,A.next_in=G,A.avail_in=Q,D.hold=B,D.bits=q,(D.wsize||ne!==A.avail_out&&D.mode<30&&(D.mode<27||k!==4))&&$(A,A.output,A.next_out,ne-A.avail_out)?(D.mode=31,-4):(ee-=A.avail_in,ne-=A.avail_out,A.total_in+=ee,A.total_out+=ne,D.total+=ne,D.wrap&&ne&&(A.adler=D.check=D.flags?u(D.check,X,ne,A.next_out-ne):l(D.check,X,ne,A.next_out-ne)),A.data_type=D.bits+(D.last?64:0)+(D.mode===12?128:0)+(D.mode===20||D.mode===15?256:0),(ee==0&&ne===0||k===4)&&de===b&&(de=-5),de)},i.inflateEnd=function(A){if(!A||!A.state)return _;var k=A.state;return k.window&&(k.window=null),A.state=null,b},i.inflateGetHeader=function(A,k){var D;return A&&A.state?(2&(D=A.state).wrap)==0?_:((D.head=k).done=!1,b):_},i.inflateSetDictionary=function(A,k){var D,K=k.length;return A&&A.state?(D=A.state).wrap!==0&&D.mode!==11?_:D.mode===11&&l(1,k,K,0)!==D.check?-3:$(A,k,K,K)?(D.mode=31,-4):(D.havedict=1,b):_},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(n,r,i){var o=n("../utils/common"),l=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],u=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],h=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],f=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];r.exports=function(p,g,b,_,w,x,S,C){var T,I,M,U,H,O,P,N,V,$=C.bits,A=0,k=0,D=0,K=0,X=0,G=0,te=0,Q=0,se=0,B=0,q=null,ee=0,ne=new o.Buf16(16),le=new o.Buf16(16),he=null,Ee=0;for(A=0;A<=15;A++)ne[A]=0;for(k=0;k<_;k++)ne[g[b+k]]++;for(X=$,K=15;1<=K&&ne[K]===0;K--);if(K<X&&(X=K),K===0)return w[x++]=20971520,w[x++]=20971520,C.bits=1,0;for(D=1;D<K&&ne[D]===0;D++);for(X<D&&(X=D),A=Q=1;A<=15;A++)if(Q<<=1,(Q-=ne[A])<0)return-1;if(0<Q&&(p===0||K!==1))return-1;for(le[1]=0,A=1;A<15;A++)le[A+1]=le[A]+ne[A];for(k=0;k<_;k++)g[b+k]!==0&&(S[le[g[b+k]]++]=k);if(O=p===0?(q=he=S,19):p===1?(q=l,ee-=257,he=u,Ee-=257,256):(q=h,he=f,-1),A=D,H=x,te=k=B=0,M=-1,U=(se=1<<(G=X))-1,p===1&&852<se||p===2&&592<se)return 1;for(;;){for(P=A-te,V=S[k]<O?(N=0,S[k]):S[k]>O?(N=he[Ee+S[k]],q[ee+S[k]]):(N=96,0),T=1<<A-te,D=I=1<<G;w[H+(B>>te)+(I-=T)]=P<<24|N<<16|V|0,I!==0;);for(T=1<<A-1;B&T;)T>>=1;if(T!==0?(B&=T-1,B+=T):B=0,k++,--ne[A]==0){if(A===K)break;A=g[b+S[k]]}if(X<A&&(B&U)!==M){for(te===0&&(te=X),H+=D,Q=1<<(G=A-te);G+te<K&&!((Q-=ne[G+te])<=0);)G++,Q<<=1;if(se+=1<<G,p===1&&852<se||p===2&&592<se)return 1;w[M=B&U]=X<<24|G<<16|H-x|0}}return B!==0&&(w[H+B]=A-te<<24|64<<16|0),C.bits=X,0}},{"../utils/common":41}],51:[function(n,r,i){r.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(n,r,i){var o=n("../utils/common"),l=0,u=1;function h(Z){for(var oe=Z.length;0<=--oe;)Z[oe]=0}var f=0,p=29,g=256,b=g+1+p,_=30,w=19,x=2*b+1,S=15,C=16,T=7,I=256,M=16,U=17,H=18,O=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],P=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],N=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],V=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],$=new Array(2*(b+2));h($);var A=new Array(2*_);h(A);var k=new Array(512);h(k);var D=new Array(256);h(D);var K=new Array(p);h(K);var X,G,te,Q=new Array(_);function se(Z,oe,Se,we,ie){this.static_tree=Z,this.extra_bits=oe,this.extra_base=Se,this.elems=we,this.max_length=ie,this.has_stree=Z&&Z.length}function B(Z,oe){this.dyn_tree=Z,this.max_code=0,this.stat_desc=oe}function q(Z){return Z<256?k[Z]:k[256+(Z>>>7)]}function ee(Z,oe){Z.pending_buf[Z.pending++]=255&oe,Z.pending_buf[Z.pending++]=oe>>>8&255}function ne(Z,oe,Se){Z.bi_valid>C-Se?(Z.bi_buf|=oe<<Z.bi_valid&65535,ee(Z,Z.bi_buf),Z.bi_buf=oe>>C-Z.bi_valid,Z.bi_valid+=Se-C):(Z.bi_buf|=oe<<Z.bi_valid&65535,Z.bi_valid+=Se)}function le(Z,oe,Se){ne(Z,Se[2*oe],Se[2*oe+1])}function he(Z,oe){for(var Se=0;Se|=1&Z,Z>>>=1,Se<<=1,0<--oe;);return Se>>>1}function Ee(Z,oe,Se){var we,ie,Re=new Array(S+1),Pe=0;for(we=1;we<=S;we++)Re[we]=Pe=Pe+Se[we-1]<<1;for(ie=0;ie<=oe;ie++){var Oe=Z[2*ie+1];Oe!==0&&(Z[2*ie]=he(Re[Oe]++,Oe))}}function ae(Z){var oe;for(oe=0;oe<b;oe++)Z.dyn_ltree[2*oe]=0;for(oe=0;oe<_;oe++)Z.dyn_dtree[2*oe]=0;for(oe=0;oe<w;oe++)Z.bl_tree[2*oe]=0;Z.dyn_ltree[2*I]=1,Z.opt_len=Z.static_len=0,Z.last_lit=Z.matches=0}function fe(Z){8<Z.bi_valid?ee(Z,Z.bi_buf):0<Z.bi_valid&&(Z.pending_buf[Z.pending++]=Z.bi_buf),Z.bi_buf=0,Z.bi_valid=0}function Me(Z,oe,Se,we){var ie=2*oe,Re=2*Se;return Z[ie]<Z[Re]||Z[ie]===Z[Re]&&we[oe]<=we[Se]}function Ne(Z,oe,Se){for(var we=Z.heap[Se],ie=Se<<1;ie<=Z.heap_len&&(ie<Z.heap_len&&Me(oe,Z.heap[ie+1],Z.heap[ie],Z.depth)&&ie++,!Me(oe,we,Z.heap[ie],Z.depth));)Z.heap[Se]=Z.heap[ie],Se=ie,ie<<=1;Z.heap[Se]=we}function tt(Z,oe,Se){var we,ie,Re,Pe,Oe=0;if(Z.last_lit!==0)for(;we=Z.pending_buf[Z.d_buf+2*Oe]<<8|Z.pending_buf[Z.d_buf+2*Oe+1],ie=Z.pending_buf[Z.l_buf+Oe],Oe++,we===0?le(Z,ie,oe):(le(Z,(Re=D[ie])+g+1,oe),(Pe=O[Re])!==0&&ne(Z,ie-=K[Re],Pe),le(Z,Re=q(--we),Se),(Pe=P[Re])!==0&&ne(Z,we-=Q[Re],Pe)),Oe<Z.last_lit;);le(Z,I,oe)}function Ue(Z,oe){var Se,we,ie,Re=oe.dyn_tree,Pe=oe.stat_desc.static_tree,Oe=oe.stat_desc.has_stree,He=oe.stat_desc.elems,xt=-1;for(Z.heap_len=0,Z.heap_max=x,Se=0;Se<He;Se++)Re[2*Se]!==0?(Z.heap[++Z.heap_len]=xt=Se,Z.depth[Se]=0):Re[2*Se+1]=0;for(;Z.heap_len<2;)Re[2*(ie=Z.heap[++Z.heap_len]=xt<2?++xt:0)]=1,Z.depth[ie]=0,Z.opt_len--,Oe&&(Z.static_len-=Pe[2*ie+1]);for(oe.max_code=xt,Se=Z.heap_len>>1;1<=Se;Se--)Ne(Z,Re,Se);for(ie=He;Se=Z.heap[1],Z.heap[1]=Z.heap[Z.heap_len--],Ne(Z,Re,1),we=Z.heap[1],Z.heap[--Z.heap_max]=Se,Z.heap[--Z.heap_max]=we,Re[2*ie]=Re[2*Se]+Re[2*we],Z.depth[ie]=(Z.depth[Se]>=Z.depth[we]?Z.depth[Se]:Z.depth[we])+1,Re[2*Se+1]=Re[2*we+1]=ie,Z.heap[1]=ie++,Ne(Z,Re,1),2<=Z.heap_len;);Z.heap[--Z.heap_max]=Z.heap[1],(function(it,Wn){var ys,rr,_s,vt,nn,Qn,Et=Wn.dyn_tree,Ja=Wn.max_code,Ui=Wn.stat_desc.static_tree,tl=Wn.stat_desc.has_stree,Br=Wn.stat_desc.extra_bits,bs=Wn.stat_desc.extra_base,Ut=Wn.stat_desc.max_length,sr=0;for(vt=0;vt<=S;vt++)it.bl_count[vt]=0;for(Et[2*it.heap[it.heap_max]+1]=0,ys=it.heap_max+1;ys<x;ys++)Ut<(vt=Et[2*Et[2*(rr=it.heap[ys])+1]+1]+1)&&(vt=Ut,sr++),Et[2*rr+1]=vt,Ja<rr||(it.bl_count[vt]++,nn=0,bs<=rr&&(nn=Br[rr-bs]),Qn=Et[2*rr],it.opt_len+=Qn*(vt+nn),tl&&(it.static_len+=Qn*(Ui[2*rr+1]+nn)));if(sr!==0){do{for(vt=Ut-1;it.bl_count[vt]===0;)vt--;it.bl_count[vt]--,it.bl_count[vt+1]+=2,it.bl_count[Ut]--,sr-=2}while(0<sr);for(vt=Ut;vt!==0;vt--)for(rr=it.bl_count[vt];rr!==0;)Ja<(_s=it.heap[--ys])||(Et[2*_s+1]!==vt&&(it.opt_len+=(vt-Et[2*_s+1])*Et[2*_s],Et[2*_s+1]=vt),rr--)}})(Z,oe),Ee(Re,xt,Z.bl_count)}function L(Z,oe,Se){var we,ie,Re=-1,Pe=oe[1],Oe=0,He=7,xt=4;for(Pe===0&&(He=138,xt=3),oe[2*(Se+1)+1]=65535,we=0;we<=Se;we++)ie=Pe,Pe=oe[2*(we+1)+1],++Oe<He&&ie===Pe||(Oe<xt?Z.bl_tree[2*ie]+=Oe:ie!==0?(ie!==Re&&Z.bl_tree[2*ie]++,Z.bl_tree[2*M]++):Oe<=10?Z.bl_tree[2*U]++:Z.bl_tree[2*H]++,Re=ie,xt=(Oe=0)===Pe?(He=138,3):ie===Pe?(He=6,3):(He=7,4))}function de(Z,oe,Se){var we,ie,Re=-1,Pe=oe[1],Oe=0,He=7,xt=4;for(Pe===0&&(He=138,xt=3),we=0;we<=Se;we++)if(ie=Pe,Pe=oe[2*(we+1)+1],!(++Oe<He&&ie===Pe)){if(Oe<xt)for(;le(Z,ie,Z.bl_tree),--Oe!=0;);else ie!==0?(ie!==Re&&(le(Z,ie,Z.bl_tree),Oe--),le(Z,M,Z.bl_tree),ne(Z,Oe-3,2)):Oe<=10?(le(Z,U,Z.bl_tree),ne(Z,Oe-3,3)):(le(Z,H,Z.bl_tree),ne(Z,Oe-11,7));Re=ie,xt=(Oe=0)===Pe?(He=138,3):ie===Pe?(He=6,3):(He=7,4)}}h(Q);var _e=!1;function J(Z,oe,Se,we){ne(Z,(f<<1)+(we?1:0),3),(function(ie,Re,Pe,Oe){fe(ie),ee(ie,Pe),ee(ie,~Pe),o.arraySet(ie.pending_buf,ie.window,Re,Pe,ie.pending),ie.pending+=Pe})(Z,oe,Se)}i._tr_init=function(Z){_e||((function(){var oe,Se,we,ie,Re,Pe=new Array(S+1);for(ie=we=0;ie<p-1;ie++)for(K[ie]=we,oe=0;oe<1<<O[ie];oe++)D[we++]=ie;for(D[we-1]=ie,ie=Re=0;ie<16;ie++)for(Q[ie]=Re,oe=0;oe<1<<P[ie];oe++)k[Re++]=ie;for(Re>>=7;ie<_;ie++)for(Q[ie]=Re<<7,oe=0;oe<1<<P[ie]-7;oe++)k[256+Re++]=ie;for(Se=0;Se<=S;Se++)Pe[Se]=0;for(oe=0;oe<=143;)$[2*oe+1]=8,oe++,Pe[8]++;for(;oe<=255;)$[2*oe+1]=9,oe++,Pe[9]++;for(;oe<=279;)$[2*oe+1]=7,oe++,Pe[7]++;for(;oe<=287;)$[2*oe+1]=8,oe++,Pe[8]++;for(Ee($,b+1,Pe),oe=0;oe<_;oe++)A[2*oe+1]=5,A[2*oe]=he(oe,5);X=new se($,O,g+1,b,S),G=new se(A,P,0,_,S),te=new se(new Array(0),N,0,w,T)})(),_e=!0),Z.l_desc=new B(Z.dyn_ltree,X),Z.d_desc=new B(Z.dyn_dtree,G),Z.bl_desc=new B(Z.bl_tree,te),Z.bi_buf=0,Z.bi_valid=0,ae(Z)},i._tr_stored_block=J,i._tr_flush_block=function(Z,oe,Se,we){var ie,Re,Pe=0;0<Z.level?(Z.strm.data_type===2&&(Z.strm.data_type=(function(Oe){var He,xt=4093624447;for(He=0;He<=31;He++,xt>>>=1)if(1&xt&&Oe.dyn_ltree[2*He]!==0)return l;if(Oe.dyn_ltree[18]!==0||Oe.dyn_ltree[20]!==0||Oe.dyn_ltree[26]!==0)return u;for(He=32;He<g;He++)if(Oe.dyn_ltree[2*He]!==0)return u;return l})(Z)),Ue(Z,Z.l_desc),Ue(Z,Z.d_desc),Pe=(function(Oe){var He;for(L(Oe,Oe.dyn_ltree,Oe.l_desc.max_code),L(Oe,Oe.dyn_dtree,Oe.d_desc.max_code),Ue(Oe,Oe.bl_desc),He=w-1;3<=He&&Oe.bl_tree[2*V[He]+1]===0;He--);return Oe.opt_len+=3*(He+1)+5+5+4,He})(Z),ie=Z.opt_len+3+7>>>3,(Re=Z.static_len+3+7>>>3)<=ie&&(ie=Re)):ie=Re=Se+5,Se+4<=ie&&oe!==-1?J(Z,oe,Se,we):Z.strategy===4||Re===ie?(ne(Z,2+(we?1:0),3),tt(Z,$,A)):(ne(Z,4+(we?1:0),3),(function(Oe,He,xt,it){var Wn;for(ne(Oe,He-257,5),ne(Oe,xt-1,5),ne(Oe,it-4,4),Wn=0;Wn<it;Wn++)ne(Oe,Oe.bl_tree[2*V[Wn]+1],3);de(Oe,Oe.dyn_ltree,He-1),de(Oe,Oe.dyn_dtree,xt-1)})(Z,Z.l_desc.max_code+1,Z.d_desc.max_code+1,Pe+1),tt(Z,Z.dyn_ltree,Z.dyn_dtree)),ae(Z),we&&fe(Z)},i._tr_tally=function(Z,oe,Se){return Z.pending_buf[Z.d_buf+2*Z.last_lit]=oe>>>8&255,Z.pending_buf[Z.d_buf+2*Z.last_lit+1]=255&oe,Z.pending_buf[Z.l_buf+Z.last_lit]=255&Se,Z.last_lit++,oe===0?Z.dyn_ltree[2*Se]++:(Z.matches++,oe--,Z.dyn_ltree[2*(D[Se]+g+1)]++,Z.dyn_dtree[2*q(oe)]++),Z.last_lit===Z.lit_bufsize-1},i._tr_align=function(Z){ne(Z,2,3),le(Z,I,$),(function(oe){oe.bi_valid===16?(ee(oe,oe.bi_buf),oe.bi_buf=0,oe.bi_valid=0):8<=oe.bi_valid&&(oe.pending_buf[oe.pending++]=255&oe.bi_buf,oe.bi_buf>>=8,oe.bi_valid-=8)})(Z)}},{"../utils/common":41}],53:[function(n,r,i){r.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(n,r,i){(function(o){(function(l,u){if(!l.setImmediate){var h,f,p,g,b=1,_={},w=!1,x=l.document,S=Object.getPrototypeOf&&Object.getPrototypeOf(l);S=S&&S.setTimeout?S:l,h={}.toString.call(l.process)==="[object process]"?function(M){process.nextTick(function(){T(M)})}:(function(){if(l.postMessage&&!l.importScripts){var M=!0,U=l.onmessage;return l.onmessage=function(){M=!1},l.postMessage("","*"),l.onmessage=U,M}})()?(g="setImmediate$"+Math.random()+"$",l.addEventListener?l.addEventListener("message",I,!1):l.attachEvent("onmessage",I),function(M){l.postMessage(g+M,"*")}):l.MessageChannel?((p=new MessageChannel).port1.onmessage=function(M){T(M.data)},function(M){p.port2.postMessage(M)}):x&&"onreadystatechange"in x.createElement("script")?(f=x.documentElement,function(M){var U=x.createElement("script");U.onreadystatechange=function(){T(M),U.onreadystatechange=null,f.removeChild(U),U=null},f.appendChild(U)}):function(M){setTimeout(T,0,M)},S.setImmediate=function(M){typeof M!="function"&&(M=new Function(""+M));for(var U=new Array(arguments.length-1),H=0;H<U.length;H++)U[H]=arguments[H+1];var O={callback:M,args:U};return _[b]=O,h(b),b++},S.clearImmediate=C}function C(M){delete _[M]}function T(M){if(w)setTimeout(T,0,M);else{var U=_[M];if(U){w=!0;try{(function(H){var O=H.callback,P=H.args;switch(P.length){case 0:O();break;case 1:O(P[0]);break;case 2:O(P[0],P[1]);break;case 3:O(P[0],P[1],P[2]);break;default:O.apply(u,P)}})(U)}finally{C(M),w=!1}}}}function I(M){M.source===l&&typeof M.data=="string"&&M.data.indexOf(g)===0&&T(+M.data.slice(g.length))}})(typeof self>"u"?o===void 0?this:o:self)}).call(this,typeof Kh<"u"?Kh:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(ty)),ty.exports}var H3=q3();const Mm=eR(H3);function G3({currentUser:t,budgetId:e}){const[n,r]=R.useState(!1),[i,o]=R.useState(null),[l,u]=R.useState(null);async function h(){if(!t){u("Must be logged in to download budget");return}if(!e){u("No budget selected");return}r(!0),u(null),o({phase:"reading",current:0,total:1,percentComplete:0});try{o({phase:"reading",current:0,total:1,percentComplete:10});const{exists:f,data:p}=await At("budgets",e,`downloading budget ${e}`);if(!f||!p){u(`Budget ${e} not found`);return}const g=await lA(e,"download-budget");let b=null;try{const{exists:A,data:k}=await At("payees",e,`downloading payees for budget ${e}`);A&&k&&(b=k)}catch(A){console.warn(`Could not read payees for budget ${e}:`,A)}o({phase:"processing",current:0,total:g.length+1,percentComplete:20});const _=new Mm,w=new Date,x=w.toISOString().split("T")[0],S=`budget_${e}`,{accounts:C,account_groups:T,categories:I,category_groups:M,...U}=p;_.file(`${S}/budget.json`,JSON.stringify(U,null,2)),_.file(`${S}/accounts.json`,JSON.stringify(C||{},null,2)),_.file(`${S}/account_groups.json`,JSON.stringify(T||{},null,2)),_.file(`${S}/categories.json`,JSON.stringify(I||{},null,2)),_.file(`${S}/category_groups.json`,JSON.stringify(M||[],null,2)),b&&_.file(`${S}/payees.json`,JSON.stringify(b,null,2));let H=0;for(const A of g){const k=A.data,D=`${S}/months/month_${k.year}_${String(k.month).padStart(2,"0")}`,K={};if(k.are_allocations_finalized&&k.category_balances)for(const X of k.category_balances)X.allocated!==void 0&&(K[X.category_id]=X.allocated);_.file(`${D}/metadata.json`,JSON.stringify({budget_id:k.budget_id,year_month_ordinal:k.year_month_ordinal,year:k.year,month:k.month,total_income:k.total_income,previous_month_income:k.previous_month_income,total_expenses:k.total_expenses,are_allocations_finalized:k.are_allocations_finalized,created_at:k.created_at,updated_at:k.updated_at,...k.are_allocations_finalized&&{allocations:K},downloaded_at:w.toISOString()},null,2)),_.file(`${D}/income.json`,JSON.stringify(k.income||[],null,2)),_.file(`${D}/expenses.json`,JSON.stringify(k.expenses||[],null,2)),_.file(`${D}/transfers.json`,JSON.stringify(k.transfers||[],null,2)),_.file(`${D}/adjustments.json`,JSON.stringify(k.adjustments||[],null,2)),_.file(`${D}/account_balances.json`,JSON.stringify(k.account_balances||[],null,2)),_.file(`${D}/category_balances.json`,JSON.stringify(k.category_balances||[],null,2)),H++,o({phase:"processing",current:H,total:g.length,percentComplete:20+Math.round(H/g.length*60)})}o({phase:"zipping",current:0,total:1,percentComplete:80});const O=await _.generateAsync({type:"blob"});o({phase:"complete",current:1,total:1,percentComplete:100});const N=(p.name||"budget").replace(/[^a-z0-9]/gi,"_").toLowerCase(),V=URL.createObjectURL(O),$=document.createElement("a");$.href=V,$.download=`${x}_${N}_${e}.zip`,document.body.appendChild($),$.click(),document.body.removeChild($),URL.revokeObjectURL(V)}catch(f){u(f instanceof Error?f.message:"Unknown error during download")}finally{r(!1),o(null)}}return{isDownloading:n,progress:i,error:l,downloadBudget:h}}async function W3(t){const n=await new Mm().loadAsync(t),r=new Set,i=new Set;for(const[o]of Object.entries(n.files)){const l=o.match(/^budget_([^/]+)\//);if(l){const u=l[1];r.add(u),o.match(/^budget_([^/]+)\/months\/month_\d{4}_\d{2}\//)&&i.add(o.split("/months/")[1].split("/")[0])}}return{budgetsFound:r.size,monthsFound:i.size,payeesFound:r.size,budgetsToRestore:Array.from(r)}}async function Q3(t,e,n){const i=`${`${e}/months/`}${n}/`,o=`${i}metadata.json`,l=t.files[o];if(!l)return null;const u=await l.async("string"),h=JSON.parse(u),{downloaded_at:f,allocations:p,...g}=h,b=async S=>{const C=`${i}${S}`,T=t.files[C];if(T){const I=await T.async("string");return JSON.parse(I)}return[]},_={budget_id:g.budget_id,year:g.year,month:g.month,year_month_ordinal:g.year_month_ordinal,total_income:0,previous_month_income:0,total_expenses:0,are_allocations_finalized:g.are_allocations_finalized??!1,created_at:g.created_at||new Date().toISOString(),updated_at:new Date().toISOString(),income:await b("income.json"),expenses:await b("expenses.json"),transfers:await b("transfers.json"),adjustments:await b("adjustments.json"),account_balances:[],category_balances:[]},w=Va(_);let x=c_(w);if(h.are_allocations_finalized&&p!==void 0){const S=new Map;for(const I of x.category_balances)S.set(I.category_id,I);const C=[],T=new Set;for(const I of x.category_balances){const M=p[I.category_id];if(M!==void 0){const U=je(M);C.push({...I,allocated:U,end_balance:je(I.start_balance+U+I.spent+I.transfers+I.adjustments)})}else C.push(I);T.add(I.category_id)}for(const[I,M]of Object.entries(p))if(!T.has(I)){const U=je(M);C.push({category_id:I,start_balance:0,allocated:U,spent:0,transfers:0,adjustments:0,end_balance:U})}x={...x,category_balances:C}}return{budgetId:g.budget_id,year:g.year,month:g.month,data:x}}async function K3(t,e){const n=`budget_${e}`,r=async H=>{const O=t.files[H];if(O){const P=await O.async("string");return JSON.parse(P)}return null},i=`${n}/budget.json`,o=`${n}/accounts.json`,l=`${n}/account_groups.json`,u=`${n}/categories.json`,h=`${n}/category_groups.json`,f=await r(i);if(!f)throw new Error("Missing required file budget.json");const p=await r(o)||{},g=await r(l)||{},b=await r(u)||{},_=await r(h)||[],w=Va({...f,accounts:p,account_groups:g,categories:b,category_groups:_}),x={budgetId:e,data:w},S=`${n}/payees.json`,C=await r(S);let T=null;if(C){const H={...C,budget_id:e,updated_at:new Date().toISOString()};T={collectionPath:"payees",docId:e,data:Va(H)}}const I=`${n}/months/`,M=new Set;for(const H of Object.keys(t.files))if(H.startsWith(I)&&H.includes("/metadata.json")){const O=H.split("/months/")[1].split("/")[0];M.add(O)}const U=[];for(const H of M){const O=await Q3(t,n,H);O&&U.push(O)}return{budgetUpdate:x,monthUpdates:U,payeeWrite:T}}function Y3({currentUser:t}){const[e,n]=R.useState(!1),[r,i]=R.useState(!1),[o,l]=R.useState(null),[u,h]=R.useState(null),[f,p]=R.useState(null),[g,b]=R.useState(null);async function _(x){if(!t){p("Must be logged in to upload budget");return}n(!0),p(null),l(null),b(null);try{const S=await W3(x);l(S)}catch(S){p(S instanceof Error?S.message:"Failed to parse zip file")}finally{n(!1)}}async function w(x){if(!t){p("Must be logged in to upload budget");return}if(!o){p("Must scan file first");return}i(!0),p(null),h({phase:"parsing",current:0,total:1,percentComplete:0});const S=[];let C=0,T=0,I=0;try{h({phase:"parsing",current:0,total:1,percentComplete:10});const U=await new Mm().loadAsync(x);h({phase:"validating",current:0,total:1,percentComplete:20}),h({phase:"uploading",current:0,total:o.budgetsToRestore.length,percentComplete:30});const H=[],O=[],P=[];for(let N=0;N<o.budgetsToRestore.length;N++){const V=o.budgetsToRestore[N];try{const{budgetUpdate:$,monthUpdates:A,payeeWrite:k}=await K3(U,V);H.push($),O.push(...A),k&&P.push(k),h({phase:"uploading",current:N+1,total:o.budgetsToRestore.length,percentComplete:30+Math.round((N+1)/o.budgetsToRestore.length*50)})}catch($){S.push(`Budget ${V}: ${$ instanceof Error?$.message:String($)}`)}}if(h({phase:"uploading",current:o.budgetsToRestore.length,total:o.budgetsToRestore.length,percentComplete:80}),H.length>0)try{console.log(`[Upload] Writing ${H.length} budget(s)...`),await Im(H,"upload-budget"),C=H.length,console.log(`[Upload] Successfully wrote ${C} budget(s)`)}catch(N){const V=`Failed to write budgets: ${N instanceof Error?N.message:String(N)}`;throw console.error(`[Upload] ${V}`,N),S.push(V),N}if(P.length>0)try{console.log(`[Upload] Writing ${P.length} payee doc(s)...`),await K0(P,"upload-budget: writing payees"),I=P.length,console.log(`[Upload] Successfully wrote ${I} payee doc(s)`)}catch(N){const V=`Failed to write payees: ${N instanceof Error?N.message:String(N)}`;throw console.error(`[Upload] ${V}`,N),S.push(V),N}if(O.length>0)try{console.log(`[Upload] Writing ${O.length} month(s) and recalculating...`),await VB(O,"upload-budget"),T=O.length,console.log(`[Upload] Successfully wrote ${T} month(s)`)}catch(N){const V=`Failed to write months: ${N instanceof Error?N.message:String(N)}`;throw console.error(`[Upload] ${V}`,N),S.push(V),N}h({phase:"complete",current:1,total:1,percentComplete:100}),b({success:S.length===0,budgetsRestored:C,monthsRestored:T,payeesRestored:I,errors:S}),console.log("[Upload] Clearing all caches after upload..."),Ha()}catch(M){const U=M instanceof Error?M.message:"Unknown error during upload";console.error("[Upload] Upload failed with error:",M),console.error("[Upload] Error details:",{errorMessage:U,budgetsRestored:C,monthsRestored:T,payeesRestored:I,errorsSoFar:S}),p(U),b({success:!1,budgetsRestored:C,monthsRestored:T,payeesRestored:I,errors:[...S,U]}),console.log("[Upload] Clearing all caches after failed upload (partial writes possible)..."),Ha()}finally{i(!1),h(null)}}return{isScanning:e,isUploading:r,status:o,progress:u,error:f,result:g,scanZipFile:_,uploadBudget:w}}function X3({isActive:t,onDragOver:e,onDragLeave:n,onDrop:r,label:i="Move to end"}){return d.jsxs("div",{onDragOver:e,onDragLeave:n,onDrop:r,style:sB,children:[d.jsx("div",{style:{...iB,opacity:t?1:.3,boxShadow:t?"0 0 8px var(--shadow-primary)":"none"}}),t&&d.jsx("span",{style:aB,children:i})]})}function Jt(t){return`$${Math.abs(t).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`}function zt(t){return t<0?`-$${Math.abs(t).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`:`$${t.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`}function Ft(t){return t<0?`-$${Math.abs(t).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`:`$${t.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`}function Xn(t){return t===0?"$0.00":`${t>0?"+":"-"}${Jt(t)}`}function Qt(t){return`${t>=0?"+":"-"}${Jt(t)}`}function et(t){return t===0?me.zero:t>0?me.success:me.danger}function hn(t){return t===0?me.zero:t>0?me.success:me.debt}function jc(t){return t===0?me.zero:t<0?me.error:me.success}function Na(t){return t===0?me.zero:t>0?me.success:me.error}async function fA(t,e){const{exists:n,data:r}=await At("feedback",t,`VALIDATION-READ: ${e}`);if(!n||!r)throw new Error(`Feedback document not found: ${t}`);return{items:r.items||[],user_email:r.user_email,created_at:r.created_at,updated_at:r.updated_at}}async function u_(t){const{docId:e,items:n,description:r}=t;await Nr("feedback",e,{items:n,updated_at:new Date().toISOString()},r,{merge:!0})}async function Z3(t,e,n,r){const{exists:i}=await At("feedback",t,"checking if user has existing feedback document");i?await Nr("feedback",t,{items:ed(e),user_email:n,updated_at:new Date().toISOString()},r,{merge:!0}):await Nr("feedback",t,{items:[e],user_email:n,created_at:new Date().toISOString(),updated_at:new Date().toISOString()},r)}function mA(){const t=Rt(),e=Cn({onMutate:async r=>{const{userId:i,userEmail:o,text:l,feedbackType:u,currentPath:h}=r,f=o||i,p=Ce.feedback();await t.cancelQueries({queryKey:p});const g=t.getQueryData(p),b=`feedback_optimistic_${Date.now()}`,_={id:b,text:`${l}

(Submitted from: ${h})`,created_at:new Date().toISOString(),is_done:!1,completed_at:null,sort_order:Date.now(),feedback_type:u,doc_id:f,user_email:o};return g&&t.setQueryData(p,{items:[...g.items,_]}),{previousData:g,optimisticId:b}},mutationFn:async r=>{const{userId:i,userEmail:o,text:l,feedbackType:u,currentPath:h}=r,f=o||i,p={id:`feedback_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,text:`${l}

(Submitted from: ${h})`,created_at:new Date().toISOString(),is_done:!1,completed_at:null,sort_order:Date.now(),feedback_type:u};return await Z3(f,p,o,"submitting new feedback"),{feedbackItem:p,docId:f}},onSuccess:(r,i,o)=>{if(!o?.optimisticId)return;const l=t.getQueryData(Ce.feedback());l&&t.setQueryData(Ce.feedback(),{items:l.items.map(u=>u.id===o.optimisticId?{...r.feedbackItem,doc_id:r.docId,user_email:i.userEmail}:u)})},onError:(r,i,o)=>{o?.previousData&&t.setQueryData(Ce.feedback(),o.previousData)}});return{submitFeedback:{mutate:r=>e.mutate(r),mutateAsync:r=>e.mutateAsync(r),isPending:e.isPending,isError:e.isError,error:e.error,reset:e.reset}}}function J3(){const t=Rt(),e=Cn({onMutate:async r=>{const{item:i}=r,o=Ce.feedback(),l=!i.is_done,u=l?new Date().toISOString():null;await t.cancelQueries({queryKey:o});const h=t.getQueryData(o);return h&&t.setQueryData(o,{items:h.items.map(f=>f.id===i.id?{...f,is_done:l,completed_at:u}:f)}),{previousData:h}},mutationFn:async r=>{const{item:i}=r,o=!i.is_done,l=o?new Date().toISOString():null,u=await fA(i.doc_id,"toggle feedback");let h=!1;const f=u.items.map(p=>p.id===i.id?(h=!0,{...p,is_done:o,completed_at:l}):p);if(!h)throw console.error("[toggleFeedback] Item not found in document",{searchingFor:i.id,inDocument:i.doc_id,availableIds:u.items.map(p=>p.id)}),new Error(`Feedback item not found in document. Item ID: ${i.id}, Doc ID: ${i.doc_id}`);return await u_({docId:i.doc_id,items:f,description:`marking feedback item as ${o?"done":"not done"}`}),{itemId:i.id,isDone:o,completedAt:l}},onError:(r,i,o)=>{o?.previousData&&t.setQueryData(Ce.feedback(),o.previousData)}});return{toggleFeedback:{mutate:r=>e.mutate(r),mutateAsync:r=>e.mutateAsync(r),isPending:e.isPending,isError:e.isError,error:e.error,reset:e.reset}}}function ez(){const t=Rt(),e=Cn({onMutate:async r=>{const{docId:i,items:o}=r,l=Ce.feedback();await t.cancelQueries({queryKey:l});const u=t.getQueryData(l),h=new Map;return o.forEach(f=>{h.set(f.id,f.sort_order)}),u&&t.setQueryData(l,{items:u.items.map(f=>f.doc_id===i&&h.has(f.id)?{...f,sort_order:h.get(f.id)}:f)}),{previousData:u}},mutationFn:async r=>{const{docId:i,items:o}=r;return await u_({docId:i,items:o,description:"saving reordered feedback items"}),{docId:i,items:o}},onError:(r,i,o)=>{o?.previousData&&t.setQueryData(Ce.feedback(),o.previousData)}});return{updateSortOrder:{mutate:r=>e.mutate(r),mutateAsync:r=>e.mutateAsync(r),isPending:e.isPending,isError:e.isError,error:e.error,reset:e.reset}}}const sd={critical_bug:{label:"Critical Bug",color:"var(--color-error)",bgColor:"var(--color-error-bg)"},bug:{label:"Bug",color:"var(--color-warning)",bgColor:"var(--color-warning-bg)"},new_feature:{label:"New Feature",color:"var(--color-success)",bgColor:"var(--color-success-bg)"},core_feature:{label:"Core Feature",color:"var(--color-migration-blue)",bgColor:"var(--color-migration-blue-bg)"},qol:{label:"QOL",color:"var(--color-migration-purple)",bgColor:"var(--color-migration-purple-bg)"}};function Ks({isOpen:t,onClose:e,title:n,children:r,width:i="28rem"}){if(!t)return null;function o(){e()}return d.jsx("div",{style:{position:"fixed",inset:0,background:"var(--modal-backdrop)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1001,padding:"1rem"},onClick:o,children:d.jsxs("div",{style:{background:"var(--surface-base)",color:"var(--text-primary)",borderRadius:"12px",padding:"1.5rem",width:i,maxWidth:"calc(100vw - 2rem)",flexShrink:0,boxSizing:"border-box",boxShadow:"0 8px 32px var(--shadow-overlay)"},onClick:l=>l.stopPropagation(),children:[d.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[d.jsx("h2",{style:{margin:0,fontSize:"1.25rem"},children:n}),d.jsx("button",{onClick:o,style:{background:"transparent",border:"none",color:"inherit",cursor:"pointer",fontSize:"1.5rem",opacity:.6,lineHeight:1},children:""})]}),r]})})}const tz=2e3;function nz(){const[t,e]=R.useState(!1),[n,r]=R.useState(""),[i,o]=R.useState("bug"),[l,u]=R.useState(!1),h=R.useContext(Cd),p=zi().get_current_firebase_user(),g=tr(),{submitFeedback:b}=mA();if(R.useEffect(()=>{if(l){const x=setTimeout(()=>u(!1),tz);return()=>clearTimeout(x)}},[l]),g.pathname.includes("/admin/feedback")||!h.is_logged_in)return null;function w(x){x.preventDefault(),!(!n.trim()||!h.username||!p)&&(b.mutate({userId:p.uid,userEmail:h.username,text:n.trim(),feedbackType:i,currentPath:g.pathname}),r(""),o("bug"),e(!1),u(!0))}return d.jsxs(d.Fragment,{children:[l&&d.jsxs("div",{style:{position:"fixed",bottom:"5rem",right:"1.5rem",background:"var(--banner-success)",color:"white",padding:"0.75rem 1rem",borderRadius:"0.5rem",fontSize:"0.9rem",fontWeight:500,boxShadow:"0 4px 12px var(--shadow-overlay)",zIndex:1001,display:"flex",alignItems:"center",gap:"0.5rem",animation:"fadeInUp 0.2s ease-out"},children:[d.jsx("span",{children:""}),d.jsx("span",{children:"Feedback submitted!"})]}),d.jsx("button",{onClick:()=>{e(!0)},style:{position:"fixed",bottom:"1.5rem",right:"1.5rem",width:"3rem",height:"3rem",borderRadius:"50%",background:me.primary,color:"white",border:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1.25rem",boxShadow:"0 4px 12px var(--shadow-overlay)",transition:"transform 0.15s, box-shadow 0.15s",zIndex:1e3},title:"Send Feedback",onMouseEnter:x=>{x.currentTarget.style.transform="scale(1.1)",x.currentTarget.style.boxShadow="0 6px 16px var(--shadow-overlay)"},onMouseLeave:x=>{x.currentTarget.style.transform="scale(1)",x.currentTarget.style.boxShadow="0 4px 12px var(--shadow-overlay)"},children:""}),d.jsx(Ks,{isOpen:t,onClose:()=>{e(!1),o("bug")},title:"Send Feedback",children:d.jsxs("form",{onSubmit:w,children:[d.jsx("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"0.75rem",paddingBottom:"1rem",flexWrap:"wrap"},children:["critical_bug","bug","new_feature","core_feature","qol"].map(x=>{const S=sd[x],C=i===x;return d.jsxs("button",{type:"button",onClick:()=>{S.label,o(x)},style:{flex:1,padding:"0.6rem 0.5rem",border:`2px solid ${S.color}`,borderRadius:"0.5rem",background:C?S.bgColor:"transparent",color:C?S.color:"var(--text-muted)",cursor:"pointer",fontWeight:C?600:400,fontSize:"0.8rem",transition:"all 0.15s ease",opacity:C?1:.5,boxShadow:C?`0 0 12px ${S.bgColor}`:"none",position:"relative"},children:[S.label,C&&d.jsx("span",{style:{position:"absolute",bottom:"-14px",left:"10%",right:"10%",height:"3px",background:"white",borderRadius:"2px"}})]},x)})}),d.jsx(a_,{value:n,onChange:x=>r(x.target.value),placeholder:"Share your feedback, bug reports, or feature requests...",minHeight:"8rem",autoFocus:!0,required:!0}),d.jsxs(Ya,{children:[d.jsx(qe,{type:"button",variant:"secondary",actionName:"Cancel Feedback",onClick:()=>{e(!1),o("bug")},children:"Cancel"}),d.jsx(qe,{type:"submit",actionName:"Submit Feedback",disabled:!n.trim(),children:"Submit"})]})]})})]})}function Xr({children:t,labelStyle:e,...n}){return d.jsxs("label",{style:{display:"flex",alignItems:"flex-start",gap:"0.75rem",flex:1,cursor:"pointer",...e},children:[d.jsx("input",{type:"checkbox",style:{width:"1.25rem",height:"1.25rem",marginTop:"0.1rem",cursor:"pointer",accentColor:me.primary},...n}),t]})}function d_({title:t,count:e,children:n,defaultExpanded:r=!1}){const[i,o]=R.useState(r);return d.jsxs("div",{style:{marginTop:"2rem"},children:[d.jsxs("button",{onClick:()=>o(!i),style:{background:"transparent",border:"none",color:"inherit",cursor:"pointer",display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 0",fontSize:"0.9rem",opacity:.7},children:[d.jsx("span",{style:{transition:"transform 0.2s",transform:i?"rotate(90deg)":"rotate(0deg)"},children:""}),t,e!==void 0&&` (${e})`]}),i&&n]})}const rz=t=>{switch(t){case 2:return 220;case 3:return 320;case 4:return 420;case 5:return 520;case 6:return 620;default:return t*100+20}},sz=t=>t<=4?2:t<=6?3:Math.ceil(t/2);function Wf(t){const{tabs:e,activeTab:n,variant:r="primary"}=t,i=e.filter(S=>!S.hidden),o=i.length,l=rz(o),u=sz(o),h=Math.floor(100/u),f=`tab-nav-${o}-${r}`,p=r==="primary",g=r==="secondary",b=r==="segmented",_=S=>{const C="color-mix(in srgb, currentColor 10%, transparent)",T="color-mix(in srgb, currentColor 3%, transparent)";return b?{flex:"1 1 0",padding:"0.75rem 1rem",border:"none",borderRadius:0,background:S?C:T,cursor:"pointer",fontWeight:S?600:400,fontSize:"0.95rem",color:"inherit",opacity:S?1:.55,transition:"all 0.15s",textDecoration:"none",display:"inline-flex",alignItems:"center",justifyContent:"center",gap:"0.25rem",position:"relative",boxSizing:"border-box",outline:"none",borderBottom:S?"2px solid currentColor":"2px solid transparent"}:g?{flex:"none",minWidth:"8.5rem",padding:"0.55rem 1rem 0.65rem",border:"none",borderRadius:"10px 10px 0 0",background:"transparent",cursor:"pointer",fontWeight:600,fontSize:"0.85rem",color:S?"inherit":"color-mix(in srgb, currentColor 55%, transparent)",transition:"color 0.15s",textDecoration:"none",display:"inline-flex",alignItems:"center",justifyContent:"center",gap:"0.25rem",position:"relative",boxSizing:"border-box",outline:"none",marginBottom:S?"-1px":"0"}:{flex:"1 1 0",padding:"0.7rem 0.75rem",border:"none",borderRadius:0,background:"transparent",cursor:"pointer",fontWeight:S?600:400,fontSize:"1rem",letterSpacing:"0.01em",color:"inherit",opacity:S?1:.6,transition:"all 0.15s",textDecoration:"none",display:"inline-flex",alignItems:"center",justifyContent:"center",gap:"0.25rem",position:"relative",boxSizing:"border-box",outline:"none"}},w=(S,C)=>d.jsxs(d.Fragment,{children:[d.jsx("span",{children:S.label}),S.checkmark&&d.jsx("span",{style:{color:me.success,fontWeight:600},children:""}),p&&C&&d.jsx("span",{style:{position:"absolute",bottom:"-1px",left:"10%",right:"10%",height:"3px",background:"white",borderRadius:"2px"}})]}),x=()=>b?`
        .${f} {
          display: flex;
          margin-bottom: 0.75rem;
          border-bottom: 1px solid color-mix(in srgb, currentColor 15%, transparent);
        }
      `:g?`
        .${f} {
          display: flex;
          flex-wrap: nowrap;
          margin-bottom: 1rem;
          border-bottom: 1px solid color-mix(in srgb, currentColor 10%, transparent);
          justify-content: flex-start;
          padding-left: 0.75rem;
          position: relative;
        }
        .${f} > button,
        .${f} > a {
          margin-right: -8px;
          isolation: isolate;
        }
        .${f} > button:last-child,
        .${f} > a:last-child {
          margin-right: 0;
        }
        .${f} > button::before,
        .${f} > a::before {
          content: '';
          position: absolute;
          inset: 0;
          background: var(--tab-bg);
          border-radius: 10px 10px 0 0;
          z-index: -1;
          transform: perspective(50px) rotateX(5deg);
          transform-origin: bottom center;
          transition: background 0.15s;
          box-shadow: -1px 0 0 var(--sticky-header-bg), 1px 0 0 var(--sticky-header-bg);
        }
        .${f} > button:nth-child(1),
        .${f} > a:nth-child(1) {
          z-index: 4;
        }
        .${f} > button:nth-child(2),
        .${f} > a:nth-child(2) {
          z-index: 3;
        }
        .${f} > button:nth-child(3),
        .${f} > a:nth-child(3) {
          z-index: 2;
        }
        .${f} > button:nth-child(4),
        .${f} > a:nth-child(4) {
          z-index: 1;
        }
        .${f} > button.tab-active,
        .${f} > a.tab-active {
          z-index: 10;
        }
        .${f} > button.tab-active::before,
        .${f} > a.tab-active::before {
          background: var(--tab-bg-active);
        }
        .${f} > button:not(.tab-active):hover,
        .${f} > a:not(.tab-active):hover {
          color: color-mix(in srgb, currentColor 80%, transparent);
        }
        .${f} > button:not(.tab-active):hover::before,
        .${f} > a:not(.tab-active):hover::before {
          background: var(--tab-bg-hover);
        }
        @media (max-width: 480px) {
          .${f} {
            padding-left: 0;
            padding-right: 0;
          }
          .${f} > button,
          .${f} > a {
            flex: 0 0 27% !important;
            min-width: 27% !important;
            padding: 0.55rem 0.5rem 0.65rem !important;
            font-size: 0.8rem !important;
          }
        }
      `:`
      .${f} {
        display: flex;
        flex-wrap: wrap;
        margin-bottom: 0;
        border-bottom: 1px solid color-mix(in srgb, currentColor 25%, transparent);
      }
      @media (max-width: ${l}px) {
        .${f} > * {
          flex: 1 1 ${h}% !important;
          min-width: ${h}% !important;
        }
      }
    `;return d.jsxs(d.Fragment,{children:[d.jsx("style",{children:`
        ${x()}
        .${f} > button,
        .${f} > a {
          border: none !important;
          border-radius: 0 !important;
          outline: none !important;
        }
        .${f} > button:hover,
        .${f} > button:focus,
        .${f} > a:hover,
        .${f} > a:focus {
          border: none !important;
          border-color: transparent !important;
          ${p?"opacity: 0.85;":""}
          ${b?"background: color-mix(in srgb, currentColor 7%, transparent);":""}
        }
      `}),d.jsx("div",{className:f,children:i.map(S=>{const C=n===S.id;return t.mode==="link"?d.jsx(jn,{to:`${t.linkPrefix}/${S.id}`,onClick:()=>(`${S.label}`,void 0),style:_(C),className:C?"tab-active":"",children:w(S,C)},S.id):d.jsx("button",{onClick:()=>{`${S.label}`,t.onTabChange(S.id)},style:_(C),className:C?"tab-active":"",children:w(S,C)},S.id)})})]})}function pA({items:t}){const[e,n]=R.useState(!1),r=R.useRef(null),o=tr().pathname;R.useEffect(()=>{function u(h){r.current&&!r.current.contains(h.target)&&n(!1)}if(e)return document.addEventListener("mousedown",u),()=>document.removeEventListener("mousedown",u)},[e]),R.useEffect(()=>{function u(h){h.key==="Escape"&&n(!1)}if(e)return document.addEventListener("keydown",u),()=>document.removeEventListener("keydown",u)},[e]);const l=t.filter(u=>u.hidden?!1:u.to?u.to==="/budget"?!(o==="/budget"||/^\/budget\/\d{4}\/\d{1,2}\/\w+$/.test(o)):u.to==="/account"||u.to==="/"?o!==u.to:!o.startsWith(u.to):!0);return d.jsxs("div",{ref:r,style:{position:"relative"},children:[d.jsx("button",{onClick:()=>{n(!e)},style:{display:"flex",alignItems:"center",justifyContent:"center",width:"2.5rem",height:"2.5rem",borderRadius:"8px",background:e?"color-mix(in srgb, currentColor 15%, transparent)":"color-mix(in srgb, currentColor 8%, transparent)",border:"none",cursor:"pointer",fontSize:"1.25rem",color:"inherit",transition:"background 0.15s",lineHeight:1},title:"Menu","aria-expanded":e,"aria-haspopup":"true",children:""}),e&&d.jsx("div",{style:{position:"absolute",top:"100%",right:0,marginTop:"0.5rem",minWidth:"180px",background:"var(--overlay-panel-bg)",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",borderRadius:"8px",boxShadow:"0 4px 20px var(--shadow-overlay)",zIndex:1e3,overflow:"hidden"},children:l.map((u,h)=>{if(u.divider)return d.jsx("div",{style:{height:"1px",background:"color-mix(in srgb, currentColor 15%, transparent)",margin:"0.25rem 0"}},h);const f=d.jsxs(d.Fragment,{children:[u.icon&&d.jsx("span",{style:{width:"1.5rem",textAlign:"center"},children:u.icon}),d.jsx("span",{children:u.label})]}),p={display:"flex",alignItems:"center",gap:"0.75rem",padding:"0.75rem 1rem",fontSize:"0.95rem",color:"inherit",textDecoration:"none",cursor:"pointer",transition:"background 0.15s",background:"transparent",border:"none",width:"100%",textAlign:"left"},g={background:"color-mix(in srgb, currentColor 10%, transparent)"};return u.to?d.jsx(jn,{to:u.to,style:p,onMouseEnter:b=>Object.assign(b.currentTarget.style,g),onMouseLeave:b=>b.currentTarget.style.background="transparent",onClick:()=>{`${u.label}`,n(!1)},children:f},h):d.jsx("button",{onClick:()=>{`${u.label}`,u.onClick?.(),n(!1)},style:p,onMouseEnter:b=>Object.assign(b.currentTarget.style,g),onMouseLeave:b=>b.currentTarget.style.background="transparent",children:f},h)})})]})}function iz({title:t,showBackArrow:e=!1,hideMenu:n=!1}){const{isAdmin:r}=Ye(),i=tr(),l=[...i.pathname==="/budget"||i.pathname.startsWith("/budget/")&&!i.pathname.startsWith("/budget/settings")&&!i.pathname.startsWith("/budget/admin")&&!i.pathname.startsWith("/budget/analytics")&&!i.pathname.startsWith("/budget/my-budgets")?[]:[{label:"Budget",icon:"",to:"/budget"}],{label:"Budget Settings",icon:"",to:"/budget/settings"},{label:"Analytics",icon:"",to:"/budget/analytics"},...r?[{label:"Admin",icon:"",to:"/budget/admin"}]:[],{label:"Switch Budgets",icon:"",to:"/budget/my-budgets"},{divider:!0,label:""},{label:"Exit Budget App",icon:"",to:"/"}];return d.jsxs("nav",{style:{marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%"},children:[d.jsx("div",{style:{flex:"0 0 auto"},children:e?d.jsx(jn,{to:"/",onClick:()=>void 0,style:{opacity:.6,fontSize:"1.5rem",textDecoration:"none"},title:"Back to Home",children:""}):d.jsx(jn,{to:"/budget",onClick:()=>void 0,title:"Budget Home",children:d.jsx("img",{src:"/budget-icon.svg",alt:"Budget",style:{width:"1.5rem",height:"1.5rem"}})})}),d.jsx("span",{style:{fontWeight:600,fontSize:"1.1rem",textAlign:"center",flex:"1 1 auto"},children:t}),d.jsx("div",{style:{flex:"0 0 auto"},children:n?d.jsx("div",{style:{width:"1.5rem"}}):d.jsx(pA,{items:l})})]})}function gA({children:t,style:e}){return d.jsx("div",{style:{width:"100%",maxWidth:"var(--content-max-width, 900px)",marginLeft:"auto",marginRight:"auto",...e},children:t})}function id({message:t,linkText:e,linkTo:n}){return d.jsx("div",{style:{gridColumn:"1 / -1",background:`color-mix(in srgb, ${me.warning} 12%, transparent)`,border:`2px solid ${me.warning}`,borderRadius:"8px",padding:"1rem 1.25rem",margin:"0.75rem 0",animation:"warningPulse 2s ease-in-out infinite"},children:d.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"0.75rem",flexWrap:"wrap"},children:[d.jsx("span",{style:{fontSize:"1.25rem",lineHeight:1.3},children:""}),d.jsxs("div",{style:{flex:1,minWidth:"200px"},children:[d.jsx("p",{style:{margin:0,fontWeight:500,color:me.warning,fontSize:"0.95rem"},children:t}),d.jsxs(jn,{to:n,style:{display:"inline-flex",alignItems:"center",gap:"0.35rem",marginTop:"0.5rem",color:me.warning,fontWeight:600,fontSize:"0.9rem",textDecoration:"underline",textUnderlineOffset:"3px"},children:[e," "]})]})]})})}const az={success:{bgColor:"var(--banner-success)",color:"white",icon:""},error:{bgColor:"var(--banner-error)",color:"white",icon:""},warning:{bgColor:"var(--banner-warning)",color:"white",icon:""},info:{bgColor:"var(--banner-info)",color:"white",icon:""}};function oz({item:t,onDismiss:e}){const[n,r]=R.useState(!1);if(R.useEffect(()=>{if(t){if(r(!0),t.autoDismissMs&&t.autoDismissMs>0){const o=setTimeout(()=>{r(!1),setTimeout(()=>e(t.id),200)},t.autoDismissMs);return()=>clearTimeout(o)}}else r(!1)},[t,e]),!t||!n)return null;const i=az[t.type];return d.jsxs("div",{style:{position:"fixed",bottom:"1.5rem",right:"1.5rem",left:"1.5rem",maxWidth:"600px",margin:"0 auto",background:i.bgColor,color:i.color,padding:"0.75rem 1rem",borderRadius:"0.5rem",fontSize:"0.9rem",fontWeight:500,boxShadow:"0 4px 12px var(--shadow-overlay)",zIndex:1001,display:"flex",alignItems:"center",gap:"0.5rem",animation:n?"fadeInUp 0.2s ease-out":"fadeOut 0.2s ease-out",cursor:"pointer"},onClick:()=>{r(!1),setTimeout(()=>e(t.id),200)},children:[d.jsx("span",{children:i.icon}),d.jsx("span",{style:{flex:1},children:t.message}),d.jsx("span",{style:{fontSize:"1.2rem",lineHeight:1},children:""})]})}class lz{items=[];listeners=new Set;nextId=1;add(e){const n=`banner-${this.nextId++}`,r={...e,id:n};return this.items.push(r),this.notify(),n}remove(e){this.items=this.items.filter(n=>n.id!==e),this.notify()}getCurrent(){return this.items[0]||null}subscribe(e){return this.listeners.add(e),e(this.getCurrent()),()=>{this.listeners.delete(e)}}notify(){const e=this.getCurrent();this.listeners.forEach(n=>n(e))}}const qn=new lz;function Pn(){const t=R.useCallback(async(r,i,o,l)=>{const u=Ce.month(r,i,o),h=ze.getQueryData(u);if(!h?.month)throw new Error(`Month ${i}/${o} not found in cache`);await GT({budgetId:r,month:h.month,description:`${l}: ${i}/${o}`,updateMonthMap:!1})},[]),e=R.useCallback(async(r,i)=>{const o=Ce.budget(r),l=ze.getQueryData(o);if(!l)throw new Error(`Budget ${r} not found in cache`);const u=Object.fromEntries(Object.entries(l.budget.accounts||{}).map(([f,p])=>{const{balance:g,...b}=p;return[f,b]})),h=Object.fromEntries(Object.entries(l.budget.categories||{}).map(([f,p])=>{const{balance:g,...b}=p;return[f,b]}));await el({budgetId:r,updates:{name:l.budget.name,user_ids:l.budget.user_ids,accepted_user_ids:l.budget.accepted_user_ids,owner_id:l.budget.owner_id,owner_email:l.budget.owner_email,accounts:u,account_groups:l.budget.account_groups,categories:h,category_groups:l.budget.category_groups,month_map:l.budget.month_map},description:`${i}: budget`})},[]);return{saveCurrentDocument:R.useCallback(async(r,i,o,l)=>{try{i==="month"&&o!==void 0&&l!==void 0?await t(r,o,l,"immediate save (current viewing document)"):i==="budget"&&await e(r,"immediate save (current viewing document)")}catch(u){const h=u instanceof Error?u.message:String(u);throw qn.add({type:"error",message:`Failed to save current document: ${h}`,autoDismissMs:0}),u}},[t,e])}}async function cz(t,e,n){const r=ze.getQueryData(Ce.budget(t));if(!r){console.warn("[mutationHelpers] Budget not in cache, skipping local recalculation");return}const i=r.budget.month_map,o=Qe(e,n),l=[];for(const[u]of Object.entries(i))if(u>=o){const h=parseInt(u.substring(0,4),10),f=parseInt(u.substring(4,6),10);l.push({year:h,month:f})}l.sort((u,h)=>u.year!==h.year?u.year-h.year:u.month-h.month);for(const{year:u,month:h}of l)try{await OB(t,u,h,ze)}catch(f){console.warn(`[mutationHelpers] Failed to recalculate month ${u}/${h} locally:`,f)}}function wr(){const{addLoadingHold:t,removeLoadingHold:e}=In();return{updateMonthCacheAndTrack:(i,o,l,u)=>{ze.setQueryData(Ce.month(i,o,l),{month:u})},recalculateMonthAndCascade:async(i,o,l,u)=>{const h="recalculate-month-cascade",f=u||((S,C)=>{S?t(h,C):e(h)}),p=Ce.month(i,o,l),g=ze.getQueryData(p);if(g?.month){const S=c_(g.month);ze.setQueryData(p,{month:S})}const b=Cm(),_=Qe(b.year,b.month),w=Qe(o,l),x=w<_;if(await cz(i,o,l),x){f(!0,"Saving start balances...");try{const S=ze.getQueryData(Ce.budget(i));if(!S){console.warn("[mutationHelpers] Budget not in cache, skipping start_balance save");return}const C=S.monthMap||{},T=[];for(const[I]of Object.entries(C))if(I>=w&&I<=_){const M=parseInt(I.substring(0,4),10),U=parseInt(I.substring(4,6),10);T.push({year:M,month:U})}T.sort((I,M)=>I.year!==M.year?I.year-M.year:I.month-M.month);for(const{year:I,month:M}of T){const U=Ce.month(i,I,M),H=ze.getQueryData(U);if(H?.month){const O=Tm(H.month);await GT({budgetId:i,month:O,description:`recalculation: saving start_balance for ${I}/${M}`,updateMonthMap:!1})}}}catch(S){console.error("[mutationHelpers] Failed to save start_balance for months at/before window:",S)}finally{f(!1,"")}}try{await aA(i,f)}catch(S){console.warn("[mutationHelpers] Failed to ensure months fresh and recalculate balances:",S)}}}}function uz(){const{currentViewingDocument:t}=Ye(),{saveCurrentDocument:e}=Pn(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=wr();return{finalizeAllocations:async o=>{const{budgetId:l,year:u,month:h,allocations:f,onProgress:p}=o;p?.({phase:"saving",message:"Saving allocations..."});const g=await xr(l,u,h);if(!g)throw new Error(`Month not found: ${u}/${h}`);const b=g.category_balances?.map(S=>S.category_id)??[],_=g.category_balances.map(S=>{const C=je(f[S.category_id]??S.allocated);return{...S,allocated:C}});for(const[S,C]of Object.entries(f))b.includes(S)||_.push({category_id:S,start_balance:0,allocated:je(C),spent:0,transfers:0,adjustments:0,end_balance:0});const w={...g,category_balances:_,are_allocations_finalized:!0,updated_at:new Date().toISOString()};n(l,u,h,w),p?.({phase:"recalculating",message:"Recalculating month balances..."});try{await r(l,u,h)}catch(S){console.warn("[useFinalizeAllocations] Failed to recalculate month and cascade:",S)}if(t.type==="month"&&t.year===u&&t.month===h)try{await e(l,"month",u,h)}catch(S){console.warn("[useFinalizeAllocations] Failed to save current document immediately:",S)}return p?.({phase:"complete",message:"Allocations applied!"}),{updatedMonth:w}},isPending:!1,isError:!1,error:null}}function yA(){const{currentViewingDocument:t}=Ye(),{saveCurrentDocument:e}=Pn(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=wr();return{deleteAllocations:async o=>{const{budgetId:l,year:u,month:h,onProgress:f}=o;f?.({phase:"saving",message:"Deleting allocations..."});const p=await xr(l,u,h);if(!p)throw new Error(`Month not found: ${u}/${h}`);const g=p.category_balances.map(w=>({...w,allocated:0})),b={...p,category_balances:g,are_allocations_finalized:!1,updated_at:new Date().toISOString()};n(l,u,h,b),f?.({phase:"recalculating",message:"Recalculating month balances..."});try{await r(l,u,h)}catch(w){console.warn("[useDeleteAllocations] Failed to recalculate month and cascade:",w)}if(t.type==="month"&&t.year===u&&t.month===h)try{await e(l,"month",u,h)}catch(w){console.warn("[useDeleteAllocations] Failed to save current document immediately:",w)}return f?.({phase:"complete",message:"Allocations deleted!"}),{updatedMonth:b}},isPending:!1,isError:!1,error:null}}async function Om(t,e,n){const r=e.trim();if(!r||n.includes(r))return null;const i=[...n,r].sort((o,l)=>o.toLowerCase().localeCompare(l.toLowerCase()));return await Nr("payees",t,{budget_id:t,payees:i,updated_at:new Date().toISOString()},`adding new payee "${r}" to autocomplete list`),i}function dz(t,e){const n={id:e,amount:je(t.amount),account_id:t.accountId,date:t.date,created_at:new Date().toISOString()};return t.payee?.trim()&&(n.payee=t.payee.trim()),t.description&&(n.description=t.description),n}function hz(){const t=Rt(),{currentViewingDocument:e}=Ye(),{saveCurrentDocument:n}=Pn(),{updateMonthCacheAndTrack:r,recalculateMonthAndCascade:i}=wr(),o=Cn({onMutate:async u=>{const{budgetId:h,year:f,month:p}=u,g=Ce.month(h,f,p);await t.cancelQueries({queryKey:g});const b=t.getQueryData(g),_=`income_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,w=dz(u,_);if(b?.month){const S={...b.month,income:[...b.month.income||[],w],updated_at:new Date().toISOString()};r(h,f,p,S)}try{await i(h,f,p)}catch(S){console.warn("[useAddIncome] Failed to recalculate month and cascade:",S)}if(u.payee?.trim()){const S=t.getQueryData(Ce.payees(h))||[],C=await Om(h,u.payee,S);C&&t.setQueryData(Ce.payees(h),C)}if(e.type==="month"&&e.year===f&&e.month===p)try{await n(h,"month",f,p)}catch(S){console.warn("[useAddIncome] Failed to save current document immediately:",S)}return{previousData:b,incomeId:_,newIncome:w}},mutationFn:async u=>{const{budgetId:h,year:f,month:p}=u,g=Ce.month(h,f,p),b=t.getQueryData(g);if(!b?.month)throw new Error("No month data in cache after optimistic update");const _=b.month,w=_.income?.[_.income.length-1];if(!w)throw new Error("Could not find new income in updated month");return{updatedMonth:_,newIncome:w}},onError:(u,h,f)=>{if(f?.previousData){const{budgetId:p,year:g,month:b}=h;t.setQueryData(Ce.month(p,g,b),f.previousData)}}});return{addIncome:async(u,h,f,p,g,b,_,w)=>o.mutateAsync({budgetId:u,year:h,month:f,amount:p,accountId:g,date:b,payee:_,description:w}),isPending:o.isPending,isError:o.isError,error:o.error}}function fz(t,e,n,r,i,o){if(!t)return!0;const l=t.payee||void 0,u=i?.trim()||void 0,h=t.description||void 0,f=o||void 0;return e!==t.amount||n!==t.account_id||r!==t.date||u!==l||f!==h}function mz(){const t=Rt(),{currentViewingDocument:e}=Ye(),{saveCurrentDocument:n}=Pn(),{updateMonthCacheAndTrack:r,recalculateMonthAndCascade:i}=wr();return{updateIncome:async(l,u,h,f,p,g,b,_,w)=>{const x=await xr(l,u,h);if(!x)throw new Error(`Month not found: ${u}/${h}`);const S=(x.income||[]).find(U=>U.id===f);if(!fz(S,p,g,b,_,w))return{updatedMonth:x,noOp:!0};const C={id:f,amount:je(p),account_id:g,date:b,created_at:(x.income||[]).find(U=>U.id===f)?.created_at||new Date().toISOString()};_?.trim()&&(C.payee=_.trim()),w&&(C.description=w);const T=(x.income||[]).map(U=>U.id===f?C:U),I={...x,income:T,updated_at:new Date().toISOString()};r(l,u,h,I);try{await i(l,u,h)}catch(U){console.warn("[useUpdateIncome] Failed to recalculate month and cascade:",U)}if(_?.trim()){const U=t.getQueryData(Ce.payees(l))||[],H=await Om(l,_,U);H&&t.setQueryData(Ce.payees(l),H)}if(e.type==="month"&&e.year===u&&e.month===h)try{await n(l,"month",u,h)}catch(U){console.warn("[useUpdateIncome] Failed to save current document immediately:",U)}return{updatedMonth:I}},isPending:!1,isError:!1,error:null}}function pz(){const{currentViewingDocument:t}=Ye(),{saveCurrentDocument:e}=Pn(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=wr();return{deleteIncome:async(o,l,u,h)=>{const f=await xr(o,l,u);if(!f)throw new Error(`Month not found: ${l}/${u}`);const p=(f.income||[]).filter(_=>_.id!==h),g={...f,income:p,updated_at:new Date().toISOString()};n(o,l,u,g);try{await r(o,l,u)}catch(_){console.warn("[useDeleteIncome] Failed to recalculate month and cascade:",_)}if(t.type==="month"&&t.year===l&&t.month===u)try{await e(o,"month",l,u)}catch(_){console.warn("[useDeleteIncome] Failed to save current document immediately:",_)}return{updatedMonth:g}},isPending:!1,isError:!1,error:null}}function gz(t,e){const n={id:e,amount:je(t.amount),category_id:t.categoryId,account_id:t.accountId,date:t.date,created_at:new Date().toISOString()};return t.payee?.trim()&&(n.payee=t.payee.trim()),t.description&&(n.description=t.description),t.cleared!==void 0&&(n.cleared=t.cleared),n}function yz(){const t=Rt(),{currentViewingDocument:e}=Ye(),{saveCurrentDocument:n}=Pn(),{updateMonthCacheAndTrack:r,recalculateMonthAndCascade:i}=wr(),o=Cn({onMutate:async u=>{const{budgetId:h,year:f,month:p}=u,g=Ce.month(h,f,p);await t.cancelQueries({queryKey:g});const b=t.getQueryData(g),_=`expense_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,w=gz(u,_);if(b?.month){const S={...b.month,expenses:[...b.month.expenses||[],w],updated_at:new Date().toISOString()};r(h,f,p,S)}try{await i(h,f,p)}catch(S){console.warn("[useAddExpense] Failed to recalculate month and cascade:",S)}if(u.payee?.trim()){const S=t.getQueryData(Ce.payees(h))||[],C=await Om(h,u.payee,S);C&&t.setQueryData(Ce.payees(h),C)}if(e.type==="month"&&e.year===f&&e.month===p)try{await n(h,"month",f,p)}catch(S){console.warn("[useAddExpense] Failed to save current document immediately:",S)}return{previousData:b,expenseId:_,newExpense:w}},mutationFn:async u=>{const{budgetId:h,year:f,month:p}=u,g=Ce.month(h,f,p),b=t.getQueryData(g);if(!b?.month)throw new Error("No month data in cache after optimistic update");const _=b.month,w=_.expenses?.[_.expenses.length-1];if(!w)throw new Error("Could not find new expense in updated month");return{updatedMonth:_,newExpense:w}},onError:(u,h,f)=>{if(f?.previousData){const{budgetId:p,year:g,month:b}=h;t.setQueryData(Ce.month(p,g,b),f.previousData)}}});return{addExpense:async(u,h,f,p,g,b,_,w,x,S)=>o.mutateAsync({budgetId:u,year:h,month:f,amount:p,categoryId:g,accountId:b,date:_,payee:w,description:x,cleared:S}),isPending:o.isPending,isError:o.isError,error:o.error}}function _z(t,e,n,r,i,o,l,u){if(!t)return!0;const h=t.payee||void 0,f=o?.trim()||void 0,p=t.description||void 0,g=l||void 0;return e!==t.amount||n!==t.category_id||r!==t.account_id||i!==t.date||f!==h||g!==p||u!==t.cleared}function bz(){const t=Rt(),{currentViewingDocument:e}=Ye(),{saveCurrentDocument:n}=Pn(),{updateMonthCacheAndTrack:r,recalculateMonthAndCascade:i}=wr();return{updateExpense:async(l,u,h,f,p,g,b,_,w,x,S)=>{const C=await xr(l,u,h);if(!C)throw new Error(`Month not found: ${u}/${h}`);const T=(C.expenses||[]).find(O=>O.id===f);if(!_z(T,p,g,b,_,w,x,S))return{updatedMonth:C,noOp:!0};const I={id:f,amount:je(p),category_id:g,account_id:b,date:_,created_at:C.expenses?.find(O=>O.id===f)?.created_at||new Date().toISOString()};w?.trim()&&(I.payee=w.trim()),x&&(I.description=x),S!==void 0&&(I.cleared=S);const M=(C.expenses||[]).map(O=>O.id===f?I:O),U={...C,expenses:M,updated_at:new Date().toISOString()};r(l,u,h,U);try{await i(l,u,h)}catch(O){console.warn("[useUpdateExpense] Failed to recalculate month and cascade:",O)}if(w?.trim()){const O=t.getQueryData(Ce.payees(l))||[],P=await Om(l,w,O);P&&t.setQueryData(Ce.payees(l),P)}if(e.type==="month"&&e.year===u&&e.month===h)try{await n(l,"month",u,h)}catch(O){console.warn("[useUpdateExpense] Failed to save current document immediately:",O)}return{updatedMonth:U}},isPending:!1,isError:!1,error:null}}function vz(){const{currentViewingDocument:t}=Ye(),{saveCurrentDocument:e}=Pn(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=wr();return{deleteExpense:async(o,l,u,h)=>{const f=await xr(o,l,u);if(!f)throw new Error(`Month not found: ${l}/${u}`);const p=(f.expenses||[]).filter(_=>_.id!==h),g={...f,expenses:p,updated_at:new Date().toISOString()};n(o,l,u,g);try{await r(o,l,u)}catch(_){console.warn("[useDeleteExpense] Failed to recalculate month and cascade:",_)}if(t.type==="month"&&t.year===l&&t.month===u)try{await e(o,"month",l,u)}catch(_){console.warn("[useDeleteExpense] Failed to save current document immediately:",_)}return{updatedMonth:g}},isPending:!1,isError:!1,error:null}}function xz(t,e){const n={id:e,amount:je(t.amount),from_account_id:t.fromAccountId,to_account_id:t.toAccountId,from_category_id:t.fromCategoryId,to_category_id:t.toCategoryId,date:t.date,created_at:new Date().toISOString()};return t.description&&(n.description=t.description),t.cleared!==void 0&&(n.cleared=t.cleared),n}function wz(){const t=Rt(),{currentViewingDocument:e}=Ye(),{saveCurrentDocument:n}=Pn(),{updateMonthCacheAndTrack:r,recalculateMonthAndCascade:i}=wr(),o=Cn({onMutate:async u=>{const{budgetId:h,year:f,month:p}=u,g=Ce.month(h,f,p);await t.cancelQueries({queryKey:g});const b=t.getQueryData(g),_=`transfer_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,w=xz(u,_);if(b?.month){const S={...b.month,transfers:[...b.month.transfers||[],w],updated_at:new Date().toISOString()};r(h,f,p,S)}try{await i(h,f,p)}catch(S){console.warn("[useAddTransfer] Failed to recalculate month and cascade:",S)}if(e.type==="month"&&e.year===f&&e.month===p)try{await n(h,"month",f,p)}catch(S){console.warn("[useAddTransfer] Failed to save current document immediately:",S)}return{previousData:b,transferId:_,newTransfer:w}},mutationFn:async u=>{const{budgetId:h,year:f,month:p}=u,g=Ce.month(h,f,p),b=t.getQueryData(g);if(!b?.month)throw new Error("No month data in cache after optimistic update");const _=b.month,w=_.transfers?.[_.transfers.length-1];if(!w)throw new Error("Could not find new transfer in updated month");return{updatedMonth:_,newTransfer:w}},onError:(u,h,f)=>{if(f?.previousData){const{budgetId:p,year:g,month:b}=h;t.setQueryData(Ce.month(p,g,b),f.previousData)}}});return{addTransfer:async(u,h,f,p,g,b,_,w,x,S,C)=>o.mutateAsync({budgetId:u,year:h,month:f,amount:p,fromAccountId:g,toAccountId:b,fromCategoryId:_,toCategoryId:w,date:x,description:S,cleared:C}),isPending:o.isPending,isError:o.isError,error:o.error}}function Sz(t,e,n,r,i,o,l,u,h){if(!t)return!0;const f=t.description||void 0,p=u||void 0;return e!==t.amount||n!==t.from_account_id||r!==t.to_account_id||i!==t.from_category_id||o!==t.to_category_id||l!==t.date||p!==f||h!==t.cleared}function Ez(){const{currentViewingDocument:t}=Ye(),{saveCurrentDocument:e}=Pn(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=wr();return{updateTransfer:async(o,l,u,h,f,p,g,b,_,w,x,S)=>{const C=await xr(o,l,u);if(!C)throw new Error(`Month not found: ${l}/${u}`);const T=(C.transfers||[]).find(O=>O.id===h);if(!Sz(T,f,p,g,b,_,w,x,S))return{updatedMonth:C,noOp:!0};const I={id:h,amount:je(f),from_account_id:p,to_account_id:g,from_category_id:b,to_category_id:_,date:w,created_at:C.transfers?.find(O=>O.id===h)?.created_at||new Date().toISOString()};x&&(I.description=x),S!==void 0&&(I.cleared=S);const M=(C.transfers||[]).map(O=>O.id===h?I:O),U={...C,transfers:M,updated_at:new Date().toISOString()};n(o,l,u,U);try{await r(o,l,u)}catch(O){console.warn("[useUpdateTransfer] Failed to recalculate month and cascade:",O)}if(t.type==="month"&&t.year===l&&t.month===u)try{await e(o,"month",l,u)}catch(O){console.warn("[useUpdateTransfer] Failed to save current document immediately:",O)}return{updatedMonth:U}},isPending:!1,isError:!1,error:null}}function Cz(){const{currentViewingDocument:t}=Ye(),{saveCurrentDocument:e}=Pn(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=wr();return{deleteTransfer:async(o,l,u,h)=>{const f=await xr(o,l,u);if(!f)throw new Error(`Month not found: ${l}/${u}`);const p=(f.transfers||[]).filter(_=>_.id!==h),g={...f,transfers:p,updated_at:new Date().toISOString()};n(o,l,u,g);try{await r(o,l,u)}catch(_){console.warn("[useDeleteTransfer] Failed to recalculate month and cascade:",_)}if(t.type==="month"&&t.year===l&&t.month===u)try{await e(o,"month",l,u)}catch(_){console.warn("[useDeleteTransfer] Failed to save current document immediately:",_)}return{updatedMonth:g}},isPending:!1,isError:!1,error:null}}function Tz(t,e){const n={id:e,amount:je(t.amount),account_id:t.accountId,category_id:t.categoryId,date:t.date,created_at:new Date().toISOString()};return t.payee?.trim()&&(n.payee=t.payee.trim()),t.description&&(n.description=t.description),t.cleared!==void 0&&(n.cleared=t.cleared),n}function Az(){const t=Rt(),{currentViewingDocument:e}=Ye(),{saveCurrentDocument:n}=Pn(),{updateMonthCacheAndTrack:r,recalculateMonthAndCascade:i}=wr(),o=Cn({onMutate:async u=>{const{budgetId:h,year:f,month:p}=u,g=Ce.month(h,f,p);await t.cancelQueries({queryKey:g});const b=t.getQueryData(g),_=`adjustment_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,w=Tz(u,_);if(b?.month){const S={...b.month,adjustments:[...b.month.adjustments||[],w],updated_at:new Date().toISOString()};r(h,f,p,S)}try{await i(h,f,p)}catch(S){console.warn("[useAddAdjustment] Failed to recalculate month and cascade:",S)}if(e.type==="month"&&e.year===f&&e.month===p)try{await n(h,"month",f,p)}catch(S){console.warn("[useAddAdjustment] Failed to save current document immediately:",S)}return{previousData:b,adjustmentId:_,newAdjustment:w}},mutationFn:async u=>{const{budgetId:h,year:f,month:p}=u,g=Ce.month(h,f,p),b=t.getQueryData(g);if(!b?.month)throw new Error("No month data in cache after optimistic update");const _=b.month,w=_.adjustments?.[_.adjustments.length-1];if(!w)throw new Error("Could not find new adjustment in updated month");return{updatedMonth:_,newAdjustment:w}},onError:(u,h,f)=>{if(f?.previousData){const{budgetId:p,year:g,month:b}=h;t.setQueryData(Ce.month(p,g,b),f.previousData)}}});return{addAdjustment:async(u,h,f,p,g,b,_,w,x,S)=>o.mutateAsync({budgetId:u,year:h,month:f,amount:p,accountId:g,categoryId:b,date:_,payee:w,description:x,cleared:S}),isPending:o.isPending,isError:o.isError,error:o.error}}function jz(t,e,n,r,i,o,l,u){if(!t)return!0;const h=t.payee||void 0,f=o?.trim()||void 0,p=t.description||void 0,g=l||void 0;return e!==t.amount||n!==t.account_id||r!==t.category_id||i!==t.date||f!==h||g!==p||u!==t.cleared}function Rz(){const{currentViewingDocument:t}=Ye(),{saveCurrentDocument:e}=Pn(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=wr();return{updateAdjustment:async(o,l,u,h,f,p,g,b,_,w,x)=>{const S=await xr(o,l,u);if(!S)throw new Error(`Month not found: ${l}/${u}`);const C=(S.adjustments||[]).find(H=>H.id===h);if(!jz(C,f,p,g,b,_,w,x))return{updatedMonth:S,noOp:!0};const T={id:h,amount:je(f),account_id:p,category_id:g,date:b,created_at:S.adjustments?.find(H=>H.id===h)?.created_at||new Date().toISOString()};_?.trim()&&(T.payee=_.trim()),w&&(T.description=w),x!==void 0&&(T.cleared=x);const I=(S.adjustments||[]).map(H=>H.id===h?T:H),M={...S,adjustments:I,updated_at:new Date().toISOString()};n(o,l,u,M);try{await r(o,l,u)}catch(H){console.warn("[useUpdateAdjustment] Failed to recalculate month and cascade:",H)}if(t.type==="month"&&t.year===l&&t.month===u)try{await e(o,"month",l,u)}catch(H){console.warn("[useUpdateAdjustment] Failed to save current document immediately:",H)}return{updatedMonth:M}},isPending:!1,isError:!1,error:null}}function Iz(){const{currentViewingDocument:t}=Ye(),{saveCurrentDocument:e}=Pn(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=wr();return{deleteAdjustment:async(o,l,u,h)=>{const f=await xr(o,l,u);if(!f)throw new Error(`Month not found: ${l}/${u}`);const p=(f.adjustments||[]).filter(_=>_.id!==h),g={...f,adjustments:p,updated_at:new Date().toISOString()};n(o,l,u,g);try{await r(o,l,u)}catch(_){console.warn("[useDeleteAdjustment] Failed to recalculate month and cascade:",_)}if(t.type==="month"&&t.year===l&&t.month===u)try{await e(o,"month",l,u)}catch(_){console.warn("[useDeleteAdjustment] Failed to save current document immediately:",_)}return{updatedMonth:g}},isPending:!1,isError:!1,error:null}}function Dz({budgetId:t,enabled:e,initialDataLoadComplete:n,months:r,setInitialBalanceCalculationComplete:i}){const{addLoadingHold:o,removeLoadingHold:l}=In(),u=R.useRef(!1);R.useEffect(()=>{if(!e||!t||!n||u.current)return;if(r.length===0){i(!0);return}u.current=!0,(async()=>{try{o("initial-balance-calculation","Calculating balances..."),await qT(t,{months:r});const f=ze.getQueryData(Ce.budget(t));if(!f){i(!0);return}const{budget:p}=f,g=p.month_map||{},b={...g};for(const w of r){const x=Qe(w.year,w.month);x in b||(b[x]={})}if(JSON.stringify(g)!==JSON.stringify(b)){l("initial-balance-calculation"),o("initial-balance-calculation","Saving month map...");const{writeBudgetData:w}=await td(async()=>{const{writeBudgetData:x}=await Promise.resolve().then(()=>iA);return{writeBudgetData:x}},void 0);await w({budgetId:t,updates:{month_map:b},description:"initial balance calculation: updating month_map"}),ze.setQueryData(Ce.budget(t),{...f,budget:{...p,month_map:b},monthMap:b})}}catch(f){console.error("[useInitialBalanceCalculation] Error:",f),qn.add({type:"error",message:`Initial balance calculation failed: ${f instanceof Error?f.message:"Unknown error"}`,autoDismissMs:1e4})}finally{l("initial-balance-calculation"),i(!0)}})()},[e,t,n,r,o,l,i]),R.useEffect(()=>{t||(u.current=!1)},[t])}const kz={currentUserId:null,selectedBudgetId:null,currentYear:new Date().getFullYear(),currentMonthNumber:new Date().getMonth()+1,lastActiveTab:"categories",lastBalancesTab:"categories",lastTransactionsTab:"income",lastSettingsTab:"categories",lastAdminTab:"budget",currentViewingDocument:{type:null},setCurrentViewingDocument:()=>{},setSelectedBudgetId:()=>{},setCurrentYear:()=>{},setCurrentMonthNumber:()=>{},setLastActiveTab:()=>{},setLastSettingsTab:()=>{},setLastAdminTab:()=>{},pageTitle:"Budget",setPageTitle:()=>{},isInitialized:!1,needsFirstBudget:!1,initialDataLoadComplete:!1,initialBalanceCalculationComplete:!1,goToPreviousMonth:()=>{},goToNextMonth:()=>{},pendingInvites:[],hasPendingInvites:!1,accessibleBudgets:[],isAdmin:!1,isTest:!1,loadAccessibleBudgets:async()=>{},switchToBudget:()=>{},checkBudgetInvite:async()=>null,clearCache:()=>{}},_A=R.createContext(kz);function Mz({children:t}){const n=zi().get_current_firebase_user(),[r,i]=R.useState(null),[o,l]=R.useState(new Date().getFullYear()),[u,h]=R.useState(new Date().getMonth()+1),[f,p]=R.useState("categories"),[g,b]=R.useState("categories"),[_,w]=R.useState("income"),x=R.useCallback(Ue=>{p(Ue),Ue==="categories"||Ue==="accounts"?b(Ue):w(Ue)},[]),[S,C]=R.useState("categories"),[T,I]=R.useState("budget"),[M,U]=R.useState("Budget"),H=R.useCallback(Ue=>{U(L=>L===Ue?L:Ue)},[]),[O,P]=R.useState({type:null}),[N,V]=R.useState(!1),[$,A]=R.useState(!1),k=VT(n?.uid||null,n?.email||null),D=k.data&&k.data.budget_ids.length===0,K=AP(n?.uid||null,k.data||null,{enabled:!!n?.uid&&!!k.data&&D}),X=MB(r,{enabled:!!r&&N}),[G,te]=R.useState(!1),[Q,se]=R.useState(!1);R.useEffect(()=>{if(!X.data){te(!1);return}const{budget:Ue,payees:L,months:de}=X.data,_e=Date.now();ze.setQueryData(Ce.budget(r),Ue,{updatedAt:_e}),ze.setQueryData(Ce.payees(r),L,{updatedAt:_e});for(const J of de)ze.setQueryData(Ce.month(r,J.year,J.month),{month:J},{updatedAt:_e});te(!0)},[X.data,r]),Dz({budgetId:r,enabled:!!r&&N&&G,initialDataLoadComplete:G,months:X.data?.months||[],setInitialBalanceCalculationComplete:se}),R.useEffect(()=>{r||(te(!1),se(!1))},[r]);const B=k.data?.permission_flags?.is_admin===!0,q=k.data?.permission_flags?.is_test===!0,ee=K.data?.pendingInvites||[],ne=K.data?.budgets||[],le=ee.length>0;R.useEffect(()=>{if(!n||N||k.isLoading)return;const Ue=k.data;if(!(!Ue&&!k.isError))if(Ue&&Ue.budget_ids.length>0)i(Ue.budget_ids[0]),A(!1),V(!0);else{if(K.isLoading)return;const L=K.data;A(!(L?.pendingInvites&&L.pendingInvites.length>0)),V(!0)}},[n,N,k.data,k.isLoading,k.isError,K.data,K.isLoading]);const he=R.useCallback(()=>{u===1?(l(Ue=>Ue-1),h(12)):h(Ue=>Ue-1)},[u]),Ee=R.useCallback(()=>{u===12?(l(Ue=>Ue+1),h(1)):h(Ue=>Ue+1)},[u]),ae=R.useCallback(async Ue=>{(Ue?.force||!K.data)&&await K.refetch()},[K]),fe=R.useCallback(Ue=>{i(Ue),A(!1)},[]),Me=R.useCallback(async Ue=>{if(!n)return null;try{const L=await NP(Ue,n.uid);return L&&L.isInvited&&!L.hasAccepted?{budgetId:Ue,budgetName:L.budgetName,ownerEmail:L.ownerEmail}:null}catch(L){return console.error("[BudgetContext] Error checking budget invite:",L),null}},[n]),Ne=R.useCallback(()=>ze.clear(),[]),tt={currentUserId:n?.uid||null,selectedBudgetId:r,currentYear:o,currentMonthNumber:u,lastActiveTab:f,lastBalancesTab:g,lastTransactionsTab:_,lastSettingsTab:S,lastAdminTab:T,currentViewingDocument:O,setCurrentViewingDocument:P,setSelectedBudgetId:i,setCurrentYear:l,setCurrentMonthNumber:h,setLastActiveTab:x,setLastSettingsTab:C,setLastAdminTab:I,pageTitle:M,setPageTitle:H,isInitialized:N,needsFirstBudget:$,initialDataLoadComplete:G,initialBalanceCalculationComplete:Q,goToPreviousMonth:he,goToNextMonth:Ee,pendingInvites:ee,hasPendingInvites:le,accessibleBudgets:ne,isAdmin:B,isTest:q,loadAccessibleBudgets:ae,switchToBudget:fe,checkBudgetInvite:Me,clearCache:Ne};return d.jsx(_A.Provider,{value:tt,children:t})}function Ye(){const t=R.useContext(_A);if(!t)throw new Error("useBudget must be used within a BudgetProvider");return t}const Oz=function(){},Nz={is_logged_in:!1,is_auth_checked:!1,username:"",set_user_context:Oz},Cd=R.createContext(Nz);function t1({budget:t,isCurrent:e,isAccepting:n,isSwitching:r,isEditing:i,editName:o,isRenaming:l,onAccept:u,onSwitch:h,onStartEdit:f,onCancelEdit:p,onEditNameChange:g,onSaveEdit:b}){const _=e&&t.isOwner;return d.jsx("div",{style:{background:e?"color-mix(in srgb, var(--color-primary) 15%, transparent)":"color-mix(in srgb, currentColor 8%, transparent)",border:e?"2px solid color-mix(in srgb, var(--color-primary) 50%, transparent)":"1px solid transparent",padding:"1rem",borderRadius:"8px"},children:i?d.jsxs("form",{onSubmit:b,children:[d.jsx("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"0.5rem"},children:d.jsx("input",{type:"text",value:o,onChange:w=>g(w.target.value),placeholder:"Budget name",autoFocus:!0,style:{flex:1,padding:"0.5rem 0.75rem",borderRadius:"6px",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"1rem",fontWeight:600,color:"inherit"}})}),d.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[d.jsx("button",{type:"submit",disabled:l||!o.trim(),style:{background:"var(--color-success)",color:"white",border:"none",padding:"0.4rem 0.75rem",borderRadius:"6px",cursor:l||!o.trim()?"not-allowed":"pointer",fontWeight:500,opacity:l||!o.trim()?.7:1,fontSize:"0.8rem"},children:l?"Saving...":"Save"}),d.jsx("button",{type:"button",onClick:p,disabled:l,style:{background:"transparent",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)",padding:"0.4rem 0.75rem",borderRadius:"6px",cursor:l?"not-allowed":"pointer",fontWeight:500,opacity:l?.7:.8,fontSize:"0.8rem"},children:"Cancel"})]})]}):d.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem",flexWrap:"wrap"},children:[d.jsxs("div",{style:{flex:1,minWidth:"200px"},children:[d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flexWrap:"wrap",marginBottom:"0.25rem"},children:[d.jsx("span",{style:{fontWeight:600},children:t.name}),t.isOwner&&d.jsx("span",{style:{background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.65rem",textTransform:"uppercase",fontWeight:600},children:"Owner"}),e&&d.jsx("span",{style:{background:"color-mix(in srgb, var(--color-success) 20%, transparent)",color:"var(--color-success)",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.65rem",textTransform:"uppercase",fontWeight:600},children:"Active"}),t.isPending&&d.jsx("span",{style:{background:"color-mix(in srgb, var(--color-warning) 20%, transparent)",color:"var(--color-warning)",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.65rem",textTransform:"uppercase",fontWeight:600},children:"Pending"}),_&&d.jsx("button",{onClick:f,style:{background:"transparent",border:"none",padding:"0.15rem",cursor:"pointer",opacity:.5,fontSize:"0.8rem",lineHeight:1},title:"Rename budget",children:""})]}),d.jsx("p",{style:{margin:0,fontSize:"0.8rem",opacity:.6},children:t.ownerEmail?`Owner: ${t.ownerEmail}`:`ID: ${t.id}`})]}),d.jsx("div",{style:{display:"flex",gap:"0.5rem"},children:t.isPending?d.jsx("button",{onClick:u,disabled:n,style:{background:"var(--color-success)",color:"white",border:"none",padding:"0.5rem 1rem",borderRadius:"6px",cursor:n?"not-allowed":"pointer",fontWeight:500,opacity:n?.7:1,fontSize:"0.85rem"},children:n?"Accepting...":"Accept"}):e?null:d.jsx("button",{onClick:h,disabled:r,style:{background:"var(--color-primary)",color:"white",border:"none",padding:"0.5rem 1rem",borderRadius:"6px",cursor:r?"not-allowed":"pointer",fontWeight:500,opacity:r?.7:1,fontSize:"0.85rem"},children:r?"Switching...":"Switch"})})]})})}function bA({type:t,onClick:e}){const n=t==="feature"?"new_feature":t,r=n&&n in sd?n:"bug",i=sd[r];return d.jsx("button",{type:"button",onClick:e,style:{padding:"0.25rem 0.5rem",borderRadius:"0.25rem",background:i.bgColor,color:i.color,fontSize:"0.7rem",fontWeight:600,textTransform:"uppercase",letterSpacing:"0.025em",flexShrink:0,border:"none",cursor:"pointer",transition:"opacity 0.15s, transform 0.15s"},onMouseEnter:o=>{o.currentTarget.style.opacity="0.8",o.currentTarget.style.transform="scale(1.05)"},onMouseLeave:o=>{o.currentTarget.style.opacity="1",o.currentTarget.style.transform="scale(1)"},title:"Click to change type",children:i.label})}function Pz({item:t,isDragging:e,isDragOver:n,onDragStart:r,onDragOver:i,onDragLeave:o,onDragEnd:l,onDrop:u,onToggleDone:h,onTypeClick:f}){return d.jsxs("div",{onDragOver:p=>{p.stopPropagation(),i(p)},onDragLeave:p=>{p.stopPropagation(),o()},onDrop:p=>{p.stopPropagation(),u(p)},style:{position:"relative"},children:[d.jsx("div",{style:{...rB,opacity:n?1:0,boxShadow:n?"0 0 8px var(--shadow-primary)":"none"}}),d.jsxs("div",{draggable:!0,onDragStart:r,onDragEnd:l,style:{...n_,cursor:"grab",opacity:e?.5:1,flexDirection:"column",alignItems:"stretch",gap:"0.5rem"},children:[d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[d.jsx("span",{style:{...nB},children:""}),d.jsx("input",{type:"checkbox",checked:t.is_done,onChange:h,style:{width:"1.25rem",height:"1.25rem",cursor:"pointer",accentColor:me.primary,flexShrink:0}}),d.jsx(bA,{type:t.feedback_type,onClick:f})]}),d.jsxs("div",{style:{marginLeft:"3.25rem"},children:[d.jsx("p",{style:{margin:0,lineHeight:1.5},children:t.text}),d.jsxs("p",{style:{margin:"0.5rem 0 0 0",fontSize:"0.8rem",opacity:.6},children:[t.user_email,"  ",qy(t.created_at)]})]})]})]})}function Bz({item:t,onToggleDone:e,onTypeClick:n}){return d.jsxs("div",{style:{...n_,opacity:.6,flexDirection:"column",alignItems:"stretch",gap:"0.5rem"},children:[d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[d.jsx("input",{type:"checkbox",checked:t.is_done,onChange:e,style:{width:"1.25rem",height:"1.25rem",cursor:"pointer",accentColor:me.primary,flexShrink:0}}),d.jsx(bA,{type:t.feedback_type,onClick:n})]}),d.jsxs("div",{style:{marginLeft:"2rem"},children:[d.jsx("p",{style:{margin:0,lineHeight:1.5,textDecoration:"line-through"},children:t.text}),d.jsxs("p",{style:{margin:"0.5rem 0 0 0",fontSize:"0.8rem",opacity:.8},children:[t.user_email,"  Created: ",qy(t.created_at)]}),t.completed_at&&d.jsxs("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.8rem",color:me.success},children:[" Completed: ",qy(t.completed_at)]})]})]})}function Hn({noMargin:t}={}){return d.jsx("span",{style:{display:"inline-block",width:"14px",height:"14px",border:"2px solid var(--border-strong)",borderTopColor:"white",borderRadius:"50%",animation:"spin 0.8s linear infinite",marginRight:t?0:"0.5rem",verticalAlign:"middle"}})}function vA(){const{state:t,closeModal:e}=Ac();if(!t.isOpen)return null;const n=t.isComplete;return d.jsx("div",{style:{position:"fixed",inset:0,background:"var(--modal-backdrop)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1002,padding:"1rem"},onClick:n?e:void 0,children:d.jsxs("div",{style:{background:"var(--surface-base)",color:"var(--text-primary)",borderRadius:"16px",padding:"2rem",width:"32rem",maxWidth:"calc(100vw - 2rem)",boxShadow:"0 8px 32px var(--shadow-overlay)"},onClick:r=>r.stopPropagation(),children:[d.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1.5rem"},children:[d.jsxs("h2",{style:{margin:0,fontSize:"1.25rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[!t.isComplete&&d.jsx(Hn,{noMargin:!0}),t.migrationName]}),n&&d.jsx("button",{onClick:e,style:{background:"transparent",border:"none",color:"inherit",cursor:"pointer",fontSize:"1.5rem",opacity:.6,lineHeight:1,padding:"0.25rem"},title:"Close",children:""})]}),d.jsxs("div",{style:{fontSize:"1rem",fontWeight:500,marginBottom:"1rem",color:t.error?"var(--color-error)":t.isComplete?"var(--color-success)":"inherit"},children:[t.error?" ":t.isComplete?" ":"",t.stage]}),d.jsx("div",{style:{background:"var(--border-subtle)",borderRadius:"8px",height:"12px",overflow:"hidden",marginBottom:"1rem"},children:t.progress!==null?d.jsx("div",{style:{background:t.error?"var(--color-error)":t.isComplete?"var(--color-success)":"var(--color-primary)",height:"100%",width:`${t.progress}%`,transition:"width 0.3s ease-out",borderRadius:"8px"}}):d.jsx("div",{style:{background:t.error?"var(--color-error)":"var(--color-primary)",height:"100%",width:"30%",borderRadius:"8px",animation:"progressIndeterminate 1.5s ease-in-out infinite"}})}),t.currentItem&&d.jsx("div",{style:{fontSize:"0.9rem",opacity:.8,marginBottom:"0.5rem",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:t.currentItem}),t.details&&d.jsx("div",{style:{fontSize:"0.85rem",opacity:.6,marginBottom:t.error?"1rem":0},children:t.details}),t.error&&d.jsx("div",{style:{background:"var(--color-error-bg)",border:"1px solid var(--color-error-border)",borderRadius:"8px",padding:"0.75rem 1rem",fontSize:"0.9rem",color:"var(--color-error)"},children:t.error}),t.isComplete&&d.jsx("button",{onClick:e,style:{marginTop:"1.5rem",width:"100%",background:t.error?"var(--color-error-bg)":"var(--color-primary)",color:"white",border:"none",padding:"0.75rem 1.5rem",borderRadius:"8px",cursor:"pointer",fontWeight:500,fontSize:"1rem"},children:t.error?"Close":"Done"}),!t.isComplete&&d.jsx("div",{style:{marginTop:"1rem",fontSize:"0.85rem",opacity:.5,textAlign:"center"},children:"Please wait  do not close this window"}),d.jsx("style",{children:`
            @keyframes progressIndeterminate {
              0% { transform: translateX(-100%); }
              100% { transform: translateX(400%); }
            }
          `})]})})}function xi({isOpen:t,onClose:e,onConfirm:n,migrationName:r,isDestructive:i=!1,onDownloadBackup:o,isDownloading:l=!1}){const[u,h]=R.useState(!1),f=R.useCallback(async()=>{o&&(await o(),h(!0))},[o]),p=R.useCallback(()=>{n(u?"downloaded":"already-have")},[u,n]),g=R.useCallback(()=>{n("cancelled"),e()},[n,e]);return d.jsxs(Ks,{isOpen:t,onClose:g,title:" Backup Recommended",children:[d.jsx("div",{style:{background:i?"color-mix(in srgb, var(--color-error) 15%, transparent)":"color-mix(in srgb, var(--color-warning) 15%, transparent)",border:`1px solid ${i?"color-mix(in srgb, var(--color-error) 40%, transparent)":"color-mix(in srgb, var(--color-warning) 40%, transparent)"}`,borderRadius:"8px",padding:"1rem",marginBottom:"1rem"},children:d.jsx("p",{style:{margin:0,color:i?"var(--color-error-light)":"var(--color-warning-light)",fontWeight:500,fontSize:"0.95rem"},children:i?" This migration modifies your data. A backup is strongly recommended!":" Before running migrations, we recommend having a recent backup."})}),d.jsxs("p",{style:{margin:"0 0 0.75rem",opacity:.9},children:["You are about to run: ",d.jsx("strong",{children:r})]}),d.jsx("p",{style:{margin:"0 0 1rem",opacity:.8,fontSize:"0.9rem"},children:"Please ensure you have a recent backup of your data. You can download a diagnostic backup that includes all your budget and month data."}),o&&d.jsx("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",padding:"1rem",marginBottom:"1rem"},children:d.jsx(qe,{variant:"secondary",onClick:f,disabled:l,actionName:"Download Backup Before Migration",style:{width:"100%"},children:l?d.jsxs(d.Fragment,{children:[d.jsx(Hn,{noMargin:!0})," Downloading Backup..."]}):u?" Backup Downloaded":" Download Backup Now"})}),d.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[d.jsx(qe,{variant:"secondary",actionName:"Cancel Migration",onClick:g,children:"Cancel"}),d.jsx(qe,{variant:i?"danger":"primary",actionName:`Proceed with ${r}`,onClick:p,disabled:l,children:u?" Proceed with Migration":" I Have a Backup - Proceed"})]})]})}function wi({migrationName:t,isDestructive:e=!1,onDownloadBackup:n}){const[r,i]=R.useState(!1),[o,l]=R.useState(!1),[u,h]=R.useState(null),f=R.useCallback(_=>{h(()=>_),i(!0)},[]),p=R.useCallback(_=>{_!=="cancelled"&&u&&u(),h(null),i(!1)},[u]),g=R.useCallback(()=>{h(null),i(!1)},[]),b=R.useCallback(async()=>{if(n){l(!0);try{await n()}finally{l(!1)}}},[n]);return{promptBeforeAction:f,promptProps:{isOpen:r,onClose:g,onConfirm:p,migrationName:t,isDestructive:e,onDownloadBackup:n?b:void 0,isDownloading:o}}}const zz={onetime:{borderColor:"color-mix(in srgb, var(--color-migration-purple) 30%, transparent)",iconBg:"color-mix(in srgb, var(--color-migration-purple) 15%, transparent)",headerBg:"color-mix(in srgb, var(--color-migration-purple) 8%, transparent)"},maintenance:{borderColor:"color-mix(in srgb, var(--color-migration-blue) 30%, transparent)",iconBg:"color-mix(in srgb, var(--color-migration-blue) 15%, transparent)",headerBg:"color-mix(in srgb, var(--color-migration-blue) 8%, transparent)"},utility:{borderColor:"color-mix(in srgb, var(--color-migration-green) 30%, transparent)",iconBg:"color-mix(in srgb, var(--color-migration-green) 15%, transparent)",headerBg:"color-mix(in srgb, var(--color-migration-green) 8%, transparent)"}};function h_({title:t,icon:e,description:n,type:r,children:i,onValidateAll:o,isValidating:l=!1,isAnyRunning:u=!1}){const h=zz[r],f=l||u,p=()=>{o&&!f&&o()};return d.jsxs("section",{style:{background:"color-mix(in srgb, currentColor 3%, transparent)",border:`1px solid ${h.borderColor}`,borderRadius:"12px",marginBottom:"1.5rem",overflow:"hidden"},children:[d.jsxs("div",{style:{background:h.headerBg,padding:"1.25rem 1.5rem",borderBottom:`2px solid ${h.borderColor}`,display:"flex",justifyContent:"space-between",alignItems:"flex-start",gap:"1rem"},children:[d.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"0.875rem",flex:1},children:[d.jsx("span",{style:{fontSize:"1.75rem",background:h.iconBg,padding:"0.625rem",borderRadius:"10px",lineHeight:1,display:"flex",alignItems:"center",justifyContent:"center",minWidth:"48px",minHeight:"48px"},children:e}),d.jsxs("div",{children:[d.jsx("h3",{style:{margin:"0 0 0.375rem 0",fontSize:"1.25rem",fontWeight:600,letterSpacing:"-0.01em"},children:t}),d.jsx("p",{style:{margin:0,opacity:.75,fontSize:"0.9rem",lineHeight:1.4},children:n})]})]}),o&&d.jsx("button",{onClick:p,disabled:f,style:{background:"color-mix(in srgb, var(--color-migration-blue) 20%, transparent)",color:"var(--color-migration-blue-light)",border:"1px solid color-mix(in srgb, var(--color-migration-blue) 40%, transparent)",padding:"0.5rem 1rem",borderRadius:"6px",cursor:f?"not-allowed":"pointer",fontWeight:500,fontSize:"0.85rem",opacity:f?.6:1,display:"flex",alignItems:"center",gap:"0.4rem",flexShrink:0},children:l?d.jsxs(d.Fragment,{children:[d.jsx(Hn,{noMargin:!0})," Validating..."]}):" Validate All"})]}),d.jsx("div",{style:{padding:"0.75rem",background:"color-mix(in srgb, currentColor 1%, transparent)"},children:i})]})}const Lz={unknown:{color:"var(--text-muted)",icon:"",text:"Unknown"},clean:{color:"var(--color-success)",icon:"",text:"Clean"},"needs-action":{color:"var(--color-warning)",icon:"",text:"Needs Action"},running:{color:"var(--color-migration-blue-light)",icon:"",text:"Running"},complete:{color:"var(--color-success)",icon:"",text:"Complete"},error:{color:"var(--color-error)",icon:"",text:"Error"}};function Za({name:t,description:e,status:n,statusText:r,onCheck:i,isChecking:o,onRun:l,isRunning:u=!1,actionText:h="Run",disabled:f=!1,itemCount:p,details:g,isDestructive:b=!1}){const[_,w]=R.useState(!1),x=Lz[n],S=r||x.text,C=f||u||o,T=()=>{i()},I=()=>{l&&l()},M=()=>{g&&w(!_)};return d.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"8px",margin:"0.25rem 0",overflow:"hidden"},children:[d.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"0.75rem 1rem",gap:"1rem"},children:[d.jsx("div",{style:{width:"28px",height:"28px",borderRadius:"50%",background:`color-mix(in srgb, ${x.color} 20%, transparent)`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.85rem",flexShrink:0},children:u||o?d.jsx(Hn,{noMargin:!0}):x.icon}),d.jsxs("div",{style:{flex:1,minWidth:0},children:[d.jsx("div",{style:{fontWeight:500,fontSize:"0.95rem",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:t}),d.jsx("div",{style:{fontSize:"0.8rem",opacity:.6,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:e})]}),d.jsxs("div",{style:{color:x.color,fontSize:"0.8rem",fontWeight:500,display:"flex",alignItems:"center",gap:"0.25rem",flexShrink:0},children:[S,p!==void 0&&p>0&&d.jsx("span",{style:{background:`color-mix(in srgb, ${x.color} 20%, transparent)`,padding:"0.15rem 0.4rem",borderRadius:"4px",fontSize:"0.75rem"},children:p})]}),d.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:[d.jsx("button",{onClick:T,disabled:C,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",padding:"0.35rem 0.6rem",borderRadius:"4px",cursor:C?"not-allowed":"pointer",fontSize:"0.8rem",opacity:C?.5:1,display:"flex",alignItems:"center",gap:"0.25rem"},title:"Check status",children:o?d.jsx(Hn,{noMargin:!0}):""}),l&&n==="needs-action"&&d.jsx("button",{onClick:I,disabled:C,style:{background:b?"var(--color-error)":"var(--color-primary)",color:"white",border:"none",padding:"0.35rem 0.75rem",borderRadius:"4px",cursor:C?"not-allowed":"pointer",fontSize:"0.8rem",fontWeight:500,opacity:C?.6:1,display:"flex",alignItems:"center",gap:"0.25rem"},children:u?d.jsx(Hn,{noMargin:!0}):h}),g&&d.jsx("button",{onClick:M,style:{background:"transparent",color:"inherit",border:"none",padding:"0.35rem",borderRadius:"4px",cursor:"pointer",fontSize:"0.9rem",opacity:.6},title:_?"Collapse details":"Expand details",children:_?"":""})]})]}),_&&g&&d.jsx("div",{style:{borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)",padding:"1rem",background:"color-mix(in srgb, currentColor 2%, transparent)"},children:g})]})}function Uz({name:t,description:e,onAction:n,actionText:r,actionIcon:i,isRunning:o=!1,disabled:l=!1,progress:u,error:h,isDestructive:f=!1}){const p=l||o,g=()=>{n()};return d.jsx("div",{style:{background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"8px",margin:"0.25rem 0",padding:"0.75rem 1rem"},children:d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},children:[d.jsxs("div",{style:{flex:1,minWidth:0},children:[d.jsx("div",{style:{fontWeight:500,fontSize:"0.95rem",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:t}),d.jsx("div",{style:{fontSize:"0.8rem",opacity:.6,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:e}),h&&d.jsx("div",{style:{fontSize:"0.8rem",color:"var(--color-error)",marginTop:"0.25rem"},children:h})]}),u!==void 0&&o&&d.jsxs("div",{style:{width:"100px",flexShrink:0},children:[d.jsx("div",{style:{background:"var(--border-subtle)",borderRadius:"4px",height:"6px",overflow:"hidden"},children:d.jsx("div",{style:{background:f?"var(--color-error)":"var(--color-primary)",height:"100%",width:`${u}%`,transition:"width 0.3s"}})}),d.jsxs("div",{style:{fontSize:"0.7rem",opacity:.6,textAlign:"center",marginTop:"0.15rem"},children:[u,"%"]})]}),d.jsx("button",{onClick:g,disabled:p,style:{background:f?"var(--color-error)":"var(--color-primary)",color:"white",border:"none",padding:"0.5rem 1rem",borderRadius:"6px",cursor:p?"not-allowed":"pointer",fontSize:"0.85rem",fontWeight:500,opacity:p?.6:1,display:"flex",alignItems:"center",gap:"0.4rem",flexShrink:0},children:o?d.jsxs(d.Fragment,{children:[d.jsx(Hn,{noMargin:!0})," Running..."]}):d.jsxs(d.Fragment,{children:[i&&d.jsx("span",{children:i}),r]})})]})})}function Fz(t,e,n,r,i){return r?"running":i?i.errors.length>0?"error":"complete":e?n?"needs-action":"clean":"unknown"}function Vz(t,e,n,r){return e?n?`${r} month(s) need migration`:"No data to migrate":"No data scanned"}function $z(t,e,n,r,i){return t?d.jsxs("div",{style:{fontSize:"0.85rem"},children:[d.jsx("div",{style:{marginBottom:"0.5rem",fontWeight:500},children:t.errors.length>0?" Completed with errors":" Migration complete"}),d.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[t.budgetsProcessed>0&&d.jsxs("li",{children:[t.budgetsProcessed," budget(s) processed"]}),t.monthsProcessed>0&&d.jsxs("li",{children:[t.monthsProcessed," month(s) processed"]}),t.monthsUpdated>0&&d.jsxs("li",{children:[t.monthsUpdated," month(s) updated"]}),t.monthsUpdated===0&&t.monthsProcessed>0&&d.jsx("li",{children:"No months needed updates"})]}),t.errors.length>0&&d.jsxs("div",{style:{marginTop:"0.5rem",color:"var(--color-error)"},children:[d.jsxs("div",{children:["Errors (",t.errors.length,"):"]}),d.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1.25rem"},children:[t.errors.slice(0,3).map((o,l)=>d.jsx("li",{children:o},l)),t.errors.length>3&&d.jsxs("li",{children:["...and ",t.errors.length-3," more"]})]})]})]}):e?n?d.jsxs("div",{style:{fontSize:"0.85rem"},children:[d.jsxs("div",{style:{marginBottom:"0.25rem"},children:["Found ",i," month(s) with total_income or total_expenses fields."]}),r&&d.jsxs("div",{style:{opacity:.6,fontSize:"0.8rem"},children:[r.monthsWithTotalIncome>0&&`${r.monthsWithTotalIncome} with total_income`,r.monthsWithTotalIncome>0&&r.monthsWithTotalExpenses>0&&", ",r.monthsWithTotalExpenses>0&&`${r.monthsWithTotalExpenses} with total_expenses`]})]}):d.jsxs("div",{style:{fontSize:"0.85rem"},children:[" All months are clean.",d.jsxs("div",{style:{marginTop:"0.25rem",opacity:.6},children:["Scanned ",r.totalMonths," month(s) across ",r.totalBudgets," budget(s)."]})]}):d.jsx("div",{style:{fontSize:"0.85rem",opacity:.7},children:"Click check to scan for months with total_income or total_expenses fields."})}function qz({status:t,hasData:e,needsMigration:n,totalItemsToFix:r,isChecking:i,isRunning:o,result:l,onCheck:u,onRun:h,disabled:f}){return d.jsx(Za,{name:"Remove Total Fields Migration",description:"Removes total_income and total_expenses from month documents. These are calculated from income/expenses arrays on-the-fly.",status:Fz(t,e,n,o,l),statusText:Vz(t,e,n,r),isChecking:i,isRunning:o,onCheck:u,onRun:n?h:void 0,actionText:n?`Migrate ${r}`:void 0,disabled:f,itemCount:r,details:$z(l,e,n,t,r)})}function Hz(t,e,n,r,i){return r?"running":i?i.errors.length>0?"error":"complete":e?n?"needs-action":"clean":"unknown"}function Gz(t,e,n,r){return e?n?`${r} month(s) need migration`:"No data to migrate":"No data scanned"}function Wz(t,e,n,r,i){return t?d.jsxs("div",{style:{fontSize:"0.85rem"},children:[d.jsx("div",{style:{marginBottom:"0.5rem",fontWeight:500},children:t.errors.length>0?" Completed with errors":" Migration complete"}),d.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[t.budgetsProcessed>0&&d.jsxs("li",{children:[t.budgetsProcessed," budget(s) processed"]}),t.monthsProcessed>0&&d.jsxs("li",{children:[t.monthsProcessed," month(s) processed"]}),t.monthsUpdated>0&&d.jsxs("li",{children:[t.monthsUpdated," month(s) updated"]}),t.monthsUpdated===0&&t.monthsProcessed>0&&d.jsx("li",{children:"No months needed updates"})]}),t.errors.length>0&&d.jsxs("div",{style:{marginTop:"0.5rem",color:"var(--color-error)"},children:[d.jsxs("div",{children:["Errors (",t.errors.length,"):"]}),d.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1.25rem"},children:[t.errors.slice(0,3).map((o,l)=>d.jsx("li",{children:o},l)),t.errors.length>3&&d.jsxs("li",{children:["...and ",t.errors.length-3," more"]})]})]})]}):e?n?d.jsxs("div",{style:{fontSize:"0.85rem"},children:[d.jsxs("div",{style:{marginBottom:"0.25rem"},children:["Found ",i," month(s) with previous_month_income field."]}),d.jsx("div",{style:{opacity:.6,fontSize:"0.8rem"},children:"This field is now calculated from the previous month's income array."})]}):d.jsxs("div",{style:{fontSize:"0.85rem"},children:[" All months are clean.",d.jsxs("div",{style:{marginTop:"0.25rem",opacity:.6},children:["Scanned ",r.totalMonths," month(s) across ",r.totalBudgets," budget(s)."]})]}):d.jsx("div",{style:{fontSize:"0.85rem",opacity:.7},children:"Click check to scan for months with previous_month_income field."})}function Qz({status:t,hasData:e,needsMigration:n,totalItemsToFix:r,isChecking:i,isRunning:o,result:l,onCheck:u,onRun:h,disabled:f}){return d.jsx(Za,{name:"Remove Previous Month Income Migration",description:"Removes previous_month_income from month documents. This is calculated from the previous month's income array on-the-fly.",status:Hz(t,e,n,o,l),statusText:Gz(t,e,n,r),isChecking:i,isRunning:o,onCheck:u,onRun:n?h:void 0,actionText:n?`Migrate ${r}`:void 0,disabled:f,itemCount:r,details:Wz(l,e,n,t,r)})}function Kz(t,e,n,r,i){return r?"running":i?i.errors.length>0?"error":"complete":e?n?"needs-action":"clean":"unknown"}function Yz(t,e,n,r){return e?n?`${r} budget(s) need migration`:"No data to migrate":"No data scanned"}function Xz(t,e,n,r,i){return t?d.jsxs("div",{style:{fontSize:"0.85rem"},children:[d.jsx("div",{style:{marginBottom:"0.5rem",fontWeight:500},children:t.errors.length>0?" Completed with errors":" Migration complete"}),d.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[t.budgetsProcessed>0&&d.jsxs("li",{children:[t.budgetsProcessed," budget(s) processed"]}),t.budgetsUpdated>0&&d.jsxs("li",{children:[t.budgetsUpdated," budget(s) updated"]}),t.budgetsUpdated===0&&t.budgetsProcessed>0&&d.jsx("li",{children:"No budgets needed updates"})]}),t.errors.length>0&&d.jsxs("div",{style:{marginTop:"0.5rem",color:"var(--color-error)"},children:[d.jsxs("div",{children:["Errors (",t.errors.length,"):"]}),d.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1.25rem"},children:[t.errors.slice(0,3).map((o,l)=>d.jsx("li",{children:o},l)),t.errors.length>3&&d.jsxs("li",{children:["...and ",t.errors.length-3," more"]})]})]})]}):e?n?d.jsxs("div",{style:{fontSize:"0.85rem"},children:[d.jsxs("div",{style:{marginBottom:"0.25rem"},children:["Found ",i," budget(s) missing percentage_income_months_back."]}),d.jsx("div",{style:{opacity:.6,fontSize:"0.8rem"},children:"Adds percentage_income_months_back: 1 so percentage-based allocations use previous month income by default."})]}):d.jsxs("div",{style:{fontSize:"0.85rem"},children:[" All budgets have percentage_income_months_back set.",d.jsxs("div",{style:{marginTop:"0.25rem",opacity:.6},children:["Scanned ",r.totalBudgets," budget(s)."]})]}):d.jsx("div",{style:{fontSize:"0.85rem",opacity:.7},children:"Click check to scan for budgets missing percentage_income_months_back."})}function Zz({status:t,hasData:e,needsMigration:n,totalItemsToFix:r,isChecking:i,isRunning:o,result:l,onCheck:u,onRun:h,disabled:f}){return d.jsx(Za,{name:"Percentage Income Months Back",description:"Adds percentage_income_months_back to all budgets (default 1). Use budget settings to change how many months back percentage-based allocation income is taken from.",status:Kz(t,e,n,o,l),statusText:Yz(t,e,n,r),isChecking:i,isRunning:o,onCheck:u,onRun:n?h:void 0,actionText:n?`Migrate ${r}`:void 0,disabled:f,itemCount:r,details:Xz(l,e,n,t,r)})}function Jz({disabled:t,onDownloadBackup:e,isDownloadingBackup:n,removeTotalFieldsMigration:r,removePreviousMonthIncomeMigration:i,percentageIncomeMonthsBackMigration:o}){const l=r.isRunning||i.isRunning||o.isRunning;return d.jsx(d.Fragment,{children:d.jsxs(h_,{title:"One-Time Migrations",icon:"",description:"Migrations that typically only need to be run once. Check status first, then apply if needed.",type:"onetime",isAnyRunning:l,children:[d.jsx(qz,{status:r.status,hasData:r.hasData,needsMigration:r.needsMigration,totalItemsToFix:r.totalItemsToFix,isChecking:r.isScanning,isRunning:r.isRunning,result:r.result,onCheck:r.scanStatus,onRun:r.runMigration,disabled:t}),d.jsx(Qz,{status:i.status,hasData:i.hasData,needsMigration:i.needsMigration,totalItemsToFix:i.totalItemsToFix,isChecking:i.isScanning,isRunning:i.isRunning,result:i.result,onCheck:i.scanStatus,onRun:i.runMigration,disabled:t}),d.jsx(Zz,{status:o.status,hasData:!!o.status,needsMigration:o.needsMigration,totalItemsToFix:o.totalItemsToFix,isChecking:o.isScanning,isRunning:o.isRunning,result:o.result,onCheck:o.scanStatus,onRun:o.runMigration,disabled:t})]})})}const xA={unknown:{color:"var(--text-muted)",icon:""},clean:{color:"var(--color-success)",icon:""},"needs-action":{color:"var(--color-warning)",icon:""},running:{color:"var(--color-migration-blue-light)",icon:""},complete:{color:"var(--color-success)",icon:""},error:{color:"var(--color-error)",icon:""}};function e4({check:t,disabled:e}){const n=xA[t.status],r=e||t.isRunning||t.isChecking;return d.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"0.5rem 0.75rem",gap:"0.75rem",borderRadius:"6px",background:"color-mix(in srgb, currentColor 3%, transparent)",marginBottom:"0.25rem"},children:[d.jsx("div",{style:{width:"20px",height:"20px",borderRadius:"50%",background:`color-mix(in srgb, ${n.color} 20%, transparent)`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.7rem",flexShrink:0},children:t.isRunning||t.isChecking?d.jsx(Hn,{noMargin:!0}):n.icon}),d.jsxs("div",{style:{flex:1,minWidth:0},children:[d.jsxs("div",{style:{fontWeight:500,fontSize:"0.85rem"},children:[t.name,t.issueCount>0&&d.jsxs("span",{style:{marginLeft:"0.5rem",color:n.color,fontSize:"0.75rem"},children:["(",t.issueCount,")"]})]}),d.jsx("div",{style:{fontSize:"0.75rem",opacity:.6},children:t.description}),t.details]}),d.jsxs("div",{style:{display:"flex",gap:"0.35rem",flexShrink:0},children:[d.jsx("button",{onClick:()=>{`${t.name}`,t.onCheck()},disabled:r,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",padding:"0.25rem 0.4rem",borderRadius:"4px",cursor:r?"not-allowed":"pointer",fontSize:"0.7rem",opacity:r?.5:1},title:"Check",children:t.isChecking?d.jsx(Hn,{noMargin:!0}):""}),t.canFix&&t.onFix&&d.jsx("button",{onClick:()=>{`${t.name}`,t.onFix()},disabled:r,style:{background:"var(--color-primary)",color:"white",border:"none",padding:"0.25rem 0.5rem",borderRadius:"4px",cursor:r?"not-allowed":"pointer",fontSize:"0.7rem",fontWeight:500,opacity:r?.6:1},children:t.isRunning?d.jsx(Hn,{noMargin:!0}):"Fix"})]})]})}function t4({accountCategoryValidation:t,orphanedIdCleanup:e,expenseToAdjustment:n,adjustmentsToTransfers:r,needsAction:i,totalIssues:o,isScanning:l,isRunning:u,disabled:h,onRunOrphaned:f,onRunExpense:p,onRunTransfers:g}){const[b,_]=R.useState(!1),x=u?"running":t.hasData&&e.hasData&&n.hasData&&r.hasData?i?"needs-action":"clean":"unknown",S=xA[x],C=[{id:"validation",name:"Account/Category Validation",status:t.isScanning?"running":t.hasData?t.hasViolations?"needs-action":"clean":"unknown",issueCount:t.violationCount,description:"Validates all transactions have proper account/category combinations",canFix:!1,onCheck:()=>t.scan(),isChecking:t.isScanning,isRunning:!1,details:t.hasViolations&&t.status&&d.jsxs("div",{style:{fontSize:"0.8rem",opacity:.8},children:[t.status.violations.filter(M=>M.transactionType==="income").length>0&&d.jsxs("span",{children:["Income: ",t.status.violations.filter(M=>M.transactionType==="income").length," "]}),t.status.violations.filter(M=>M.transactionType==="expense").length>0&&d.jsxs("span",{children:["Expenses: ",t.status.violations.filter(M=>M.transactionType==="expense").length," "]}),t.status.violations.filter(M=>M.transactionType==="adjustment").length>0&&d.jsxs("span",{children:["Adjustments: ",t.status.violations.filter(M=>M.transactionType==="adjustment").length," "]}),t.status.violations.filter(M=>M.transactionType==="transfer").length>0&&d.jsxs("span",{children:["Transfers: ",t.status.violations.filter(M=>M.transactionType==="transfer").length]})]})},{id:"orphaned",name:"Orphaned ID Cleanup",status:ny(e),issueCount:e.totalOrphaned,description:"Finds transactions with deleted/invalid account/category IDs",canFix:e.hasItemsToFix,onCheck:e.scanStatus,onFix:f,isChecking:e.isScanning,isRunning:e.isRunning,details:e.hasItemsToFix&&e.status&&d.jsxs("div",{style:{fontSize:"0.8rem",opacity:.8},children:[e.status.orphanedCategoryIds>0&&d.jsxs("span",{children:["Categories: ",e.status.orphanedCategoryIds," "]}),e.status.orphanedAccountIds>0&&d.jsxs("span",{children:["Accounts: ",e.status.orphanedAccountIds]})]})},{id:"expense",name:"Expense  Adjustment",status:ny(n,"hasItemsToMigrate"),issueCount:n.totalToMigrate,description:"Moves expenses without account/category to adjustments",canFix:n.hasItemsToMigrate,onCheck:n.scanStatus,onFix:p,isChecking:n.isScanning,isRunning:n.isRunning,details:n.hasItemsToMigrate&&n.status&&d.jsxs("div",{style:{fontSize:"0.8rem",opacity:.8},children:[n.status.expensesToMigrate," expense(s) with No Account or No Category"]})},{id:"transfers",name:"Adjustment  Transfers",status:ny(r,"hasPairsToConvert"),issueCount:r.totalPairs,description:"Converts opposite adjustment pairs to transfers",canFix:r.hasPairsToConvert,onCheck:r.scanStatus,onFix:g,isChecking:r.isScanning,isRunning:r.isRunning,details:r.hasPairsToConvert&&r.status&&d.jsxs("div",{style:{fontSize:"0.8rem",opacity:.8},children:[r.status.accountTransferPairs>0&&d.jsxs("span",{children:["Account transfers: ",r.status.accountTransferPairs," "]}),r.status.categoryTransferPairs>0&&d.jsxs("span",{children:["Category transfers: ",r.status.categoryTransferPairs]})]})}],T=h||u||l,I=()=>{C.forEach(M=>M.onCheck())};return d.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"8px",margin:"0.25rem 0",overflow:"hidden"},children:[d.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"0.75rem 1rem",gap:"1rem"},children:[d.jsx("div",{style:{width:"28px",height:"28px",borderRadius:"50%",background:`color-mix(in srgb, ${S.color} 20%, transparent)`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.85rem",flexShrink:0},children:u||l?d.jsx(Hn,{noMargin:!0}):S.icon}),d.jsxs("div",{style:{flex:1,minWidth:0},children:[d.jsx("div",{style:{fontWeight:500,fontSize:"0.95rem",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:"Transaction Type Audit"}),d.jsx("div",{style:{fontSize:"0.8rem",opacity:.6,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:"Validates account/category assignments and fixes invalid transactions"})]}),d.jsxs("div",{style:{color:S.color,fontSize:"0.8rem",fontWeight:500,display:"flex",alignItems:"center",gap:"0.25rem",flexShrink:0},children:[x==="unknown"?"Unknown":x==="clean"?"Clean":x==="running"?"Running":"Needs Action",o>0&&d.jsx("span",{style:{background:`color-mix(in srgb, ${S.color} 20%, transparent)`,padding:"0.15rem 0.4rem",borderRadius:"4px",fontSize:"0.75rem"},children:o})]}),d.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:[d.jsx("button",{onClick:I,disabled:T,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",padding:"0.35rem 0.6rem",borderRadius:"4px",cursor:T?"not-allowed":"pointer",fontSize:"0.8rem",opacity:T?.5:1,display:"flex",alignItems:"center",gap:"0.25rem"},title:"Check all",children:l?d.jsx(Hn,{noMargin:!0}):""}),d.jsx("button",{onClick:()=>_(!b),style:{background:"transparent",color:"inherit",border:"none",padding:"0.35rem",borderRadius:"4px",cursor:"pointer",fontSize:"0.9rem",opacity:.6},title:b?"Collapse":"Expand",children:b?"":""})]})]}),b&&d.jsx("div",{style:{borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)",padding:"0.5rem",background:"color-mix(in srgb, currentColor 2%, transparent)"},children:C.map(M=>d.jsx(e4,{check:M,disabled:h},M.id))})]})}function ny(t,e="hasItemsToFix"){return t.isRunning?"running":t.result&&t.result.errors.length===0?"complete":t.isScanning?"running":t.hasData?t[e]?"needs-action":"clean":"unknown"}function n4({status:t,hasData:e,hasIssues:n,totalIssues:r,isChecking:i,isRunning:o,result:l,onCheck:u,onRun:h,disabled:f}){const p=()=>o?"running":e?l&&l.errors.length===0?"complete":l&&l.errors.length>0?"error":n?"needs-action":"clean":"unknown",g=()=>{if(l&&l.errors.length===0){const _=l.accountsFixed+l.categoriesFixed+l.totalAvailableFixed+l.incomeValuesFixed+l.expenseValuesFixed+l.categoryBalancesFixed+l.accountBalancesFixed;return _>0?`Fixed ${_}`:"Complete"}},b=()=>{if(l){const _=l.accountsFixed+l.categoriesFixed+l.totalAvailableFixed+l.incomeValuesFixed+l.expenseValuesFixed+l.categoryBalancesFixed+l.accountBalancesFixed;return d.jsxs("div",{style:{fontSize:"0.85rem"},children:[d.jsx("div",{style:{marginBottom:"0.5rem",fontWeight:500},children:l.errors.length>0?" Completed with errors":" Cleanup complete"}),d.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[l.budgetsProcessed>0&&d.jsxs("li",{children:[l.budgetsProcessed," budget(s) updated"]}),l.accountsFixed>0&&d.jsxs("li",{children:[l.accountsFixed," account balance(s) fixed"]}),l.categoriesFixed>0&&d.jsxs("li",{children:[l.categoriesFixed," category value(s) fixed"]}),l.totalAvailableFixed>0&&d.jsxs("li",{children:[l.totalAvailableFixed," total_available value(s) fixed"]}),l.monthsProcessed>0&&d.jsxs("li",{children:[l.monthsProcessed," month(s) updated"]}),l.incomeValuesFixed>0&&d.jsxs("li",{children:[l.incomeValuesFixed," income amount(s) fixed"]}),l.expenseValuesFixed>0&&d.jsxs("li",{children:[l.expenseValuesFixed," expense amount(s) fixed"]}),l.categoryBalancesFixed>0&&d.jsxs("li",{children:[l.categoryBalancesFixed," category balance(s) fixed"]}),l.accountBalancesFixed>0&&d.jsxs("li",{children:[l.accountBalancesFixed," account balance(s) fixed"]}),_===0&&d.jsx("li",{children:"No changes needed"})]}),l.errors.length>0&&d.jsxs("div",{style:{marginTop:"0.5rem",color:"var(--color-error)"},children:[d.jsxs("div",{children:["Errors (",l.errors.length,"):"]}),d.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1.25rem"},children:[l.errors.slice(0,3).map((w,x)=>d.jsx("li",{children:w},x)),l.errors.length>3&&d.jsxs("li",{children:["...and ",l.errors.length-3," more"]})]})]})]})}return e?n?d.jsxs("div",{style:{fontSize:"0.85rem"},children:[d.jsx("div",{style:{marginBottom:"0.5rem",color:"var(--color-warning)"},children:"Precision issues found:"}),d.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[t.budgetsWithPrecisionIssues>0&&d.jsxs("li",{children:[t.budgetsWithPrecisionIssues," budget(s) with issues:",d.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1rem",opacity:.8},children:[t.accountsWithPrecisionIssues>0&&d.jsxs("li",{children:[t.accountsWithPrecisionIssues," account balance(s)"]}),t.categoriesWithPrecisionIssues>0&&d.jsxs("li",{children:[t.categoriesWithPrecisionIssues," category value(s)"]}),t.totalAvailableWithPrecisionIssues>0&&d.jsxs("li",{children:[t.totalAvailableWithPrecisionIssues," total_available value(s)"]})]})]}),t.monthsWithPrecisionIssues>0&&d.jsxs("li",{children:[t.monthsWithPrecisionIssues," month(s) with issues:",d.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1rem",opacity:.8},children:[t.incomeValuesWithPrecisionIssues>0&&d.jsxs("li",{children:[t.incomeValuesWithPrecisionIssues," income amount(s)"]}),t.expenseValuesWithPrecisionIssues>0&&d.jsxs("li",{children:[t.expenseValuesWithPrecisionIssues," expense amount(s)"]}),t.categoryBalancesWithPrecisionIssues>0&&d.jsxs("li",{children:[t.categoryBalancesWithPrecisionIssues," category balance(s)"]}),t.accountBalancesWithPrecisionIssues>0&&d.jsxs("li",{children:[t.accountBalancesWithPrecisionIssues," account balance(s)"]})]})]})]}),d.jsxs("div",{style:{marginTop:"0.5rem",opacity:.6},children:["Scanned ",t.totalBudgets," budget(s) and ",t.totalMonths," month(s)."]})]}):d.jsxs("div",{style:{fontSize:"0.85rem"},children:[" All currency values have proper precision (2 decimal places).",d.jsxs("div",{style:{marginTop:"0.25rem",opacity:.6},children:["Scanned ",t.totalBudgets," budget(s) and ",t.totalMonths," month(s)."]})]}):d.jsx("div",{style:{fontSize:"0.85rem",opacity:.7},children:"Click check to scan for precision issues."})};return d.jsx(Za,{name:"Currency Precision",description:"Fixes floating-point precision by rounding all values to 2 decimal places",status:p(),statusText:g(),onCheck:u,isChecking:i,onRun:h,isRunning:o,actionText:`Fix ${r}`,disabled:f,itemCount:n?r:void 0,details:b(),isDestructive:!0})}function r4({status:t,hasData:e,needsMigration:n,totalItemsToFix:r,isChecking:i,isRunning:o,result:l,onCheck:u,onRun:h,disabled:f}){const p=()=>o?"running":e?l&&l.errors.length===0?"complete":l&&l.errors.length>0?"error":n?"needs-action":"clean":"unknown",g=()=>{if(l&&l.errors.length===0)return l.monthsUpdated>0?`Updated ${l.monthsUpdated} month(s)`:"Complete"},b=()=>l?d.jsxs("div",{style:{fontSize:"0.85rem"},children:[d.jsx("div",{style:{marginBottom:"0.5rem",fontWeight:500},children:l.errors.length>0?" Completed with errors":" Recalculation complete"}),d.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[l.budgetsProcessed>0&&d.jsxs("li",{children:[l.budgetsProcessed," budget(s) processed"]}),l.monthsProcessed>0&&d.jsxs("li",{children:[l.monthsProcessed," month(s) processed"]}),l.monthsUpdated>0&&d.jsxs("li",{children:[l.monthsUpdated," month(s) updated"]}),l.monthsUpdated===0&&d.jsx("li",{children:"No changes needed"})]}),l.errors.length>0&&d.jsxs("div",{style:{marginTop:"0.5rem",color:"var(--color-error)"},children:[d.jsxs("div",{children:["Errors (",l.errors.length,"):"]}),d.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1.25rem"},children:[l.errors.slice(0,3).map((_,w)=>d.jsx("li",{children:_},w)),l.errors.length>3&&d.jsxs("li",{children:["...and ",l.errors.length-3," more"]})]})]})]}):e?n?d.jsxs("div",{style:{fontSize:"0.85rem"},children:[d.jsx("div",{style:{marginBottom:"0.5rem",color:"var(--color-warning)"},children:"Months needing recalculation:"}),d.jsx("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:d.jsxs("li",{children:[t.monthsNeedingRecalculation," month(s) from first month up to earliest window month"]})}),d.jsxs("div",{style:{marginTop:"0.5rem",opacity:.6},children:["Scanned ",t.totalBudgets," budget(s) and ",t.totalMonths," month(s)."]})]}):d.jsxs("div",{style:{fontSize:"0.85rem"},children:[" All start balances are up to date.",d.jsxs("div",{style:{marginTop:"0.25rem",opacity:.6},children:["Scanned ",t.totalBudgets," budget(s) and ",t.totalMonths," month(s)."]})]}):d.jsx("div",{style:{fontSize:"0.85rem",opacity:.7},children:"Click check to scan for months needing recalculation."});return d.jsx(Za,{name:"Recalculate Start Balances",description:"Recalculates and saves start_balance for all months from the first month up to the earliest month in the window",status:p(),statusText:g(),onCheck:u,isChecking:i,onRun:h,isRunning:o,actionText:n?`Recalculate ${r}`:void 0,disabled:f,itemCount:n?r:void 0,details:b(),isDestructive:!0})}function s4({status:t,hasData:e,needsMigration:n,totalItemsToFix:r,isChecking:i,isRunning:o,result:l,onCheck:u,onRun:h,disabled:f}){const p=()=>o?"running":e?l&&l.errors.length===0?"complete":l&&l.errors.length>0?"error":n?"needs-action":"clean":"unknown",g=()=>{if(l&&l.errors.length===0){const _=l.monthsAdded+l.orphanedEntriesRemoved;return _>0?`Fixed ${_} issue(s)`:"Complete"}},b=()=>l?d.jsxs("div",{style:{fontSize:"0.85rem"},children:[d.jsx("div",{style:{marginBottom:"0.5rem",fontWeight:500},children:l.errors.length>0?" Completed with errors":" Repair complete"}),d.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[l.budgetsProcessed>0&&d.jsxs("li",{children:[l.budgetsProcessed," budget(s) processed"]}),l.budgetsUpdated>0&&d.jsxs("li",{children:[l.budgetsUpdated," budget(s) updated"]}),l.monthsAdded>0&&d.jsxs("li",{children:[l.monthsAdded," month(s) added to month_map"]}),l.orphanedEntriesRemoved>0&&d.jsxs("li",{children:[l.orphanedEntriesRemoved," orphaned entry(ies) removed"]}),l.monthsAdded===0&&l.orphanedEntriesRemoved===0&&d.jsx("li",{children:"No changes needed"})]}),l.errors.length>0&&d.jsxs("div",{style:{marginTop:"0.5rem",color:"var(--color-error)"},children:[d.jsxs("div",{children:["Errors (",l.errors.length,"):"]}),d.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1.25rem"},children:[l.errors.slice(0,3).map((_,w)=>d.jsx("li",{children:_},w)),l.errors.length>3&&d.jsxs("li",{children:["...and ",l.errors.length-3," more"]})]})]})]}):e?n?d.jsxs("div",{style:{fontSize:"0.85rem"},children:[d.jsx("div",{style:{marginBottom:"0.5rem",color:"var(--color-warning)"},children:"Month_map issues found:"}),d.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[t.totalMissingMonths>0&&d.jsxs("li",{children:[t.totalMissingMonths," month(s) missing from month_map"]}),t.totalOrphanedEntries>0&&d.jsxs("li",{children:[t.totalOrphanedEntries," orphaned entry(ies) in month_map"]}),t.budgetsNeedingRepair>0&&d.jsxs("li",{children:[t.budgetsNeedingRepair," budget(s) need repair"]})]}),d.jsxs("div",{style:{marginTop:"0.5rem",opacity:.6},children:["Scanned ",t.totalBudgets," budget(s) and ",t.totalMonths," month(s)."]})]}):d.jsxs("div",{style:{fontSize:"0.85rem"},children:[" All month_map entries are up to date.",d.jsxs("div",{style:{marginTop:"0.25rem",opacity:.6},children:["Scanned ",t.totalBudgets," budget(s) and ",t.totalMonths," month(s)."]})]}):d.jsx("div",{style:{fontSize:"0.85rem",opacity:.7},children:"Click check to scan for month_map issues."});return d.jsx(Za,{name:"Repair Month Map",description:"Updates month_map for all budgets by adding missing months and removing orphaned entries",status:p(),statusText:g(),onCheck:u,isChecking:i,onRun:h,isRunning:o,actionText:n?`Repair ${r}`:void 0,disabled:f,itemCount:n?r:void 0,details:b(),isDestructive:!0})}function i4({disabled:t,onDownloadBackup:e,isDownloadingBackup:n,accountCategoryValidation:r,orphanedIdCleanup:i,expenseToAdjustment:o,adjustmentsToTransfers:l,precisionCleanup:u,recalculateStartBalances:h,repairMonthMap:f}){const p=r.isScanning||i.isScanning||o.isScanning||l.isScanning||u.isScanning||h.isScanning||f.isScanning,g=i.isRunning||o.isRunning||l.isRunning||u.isRunning||h.isRunning||f.isRunning,b=async()=>{await Promise.all([r.scan(),i.scanStatus(),o.scanStatus(),l.scanStatus(),u.scan(),h.scanStatus(),f.scanStatus()])},_=wi({migrationName:"Orphaned ID Cleanup",isDestructive:!0,onDownloadBackup:e}),w=wi({migrationName:"Expense to Adjustment Migration",isDestructive:!0,onDownloadBackup:e}),x=wi({migrationName:"Adjustments to Transfers Migration",isDestructive:!0,onDownloadBackup:e}),S=wi({migrationName:"Currency Precision Cleanup",isDestructive:!0,onDownloadBackup:e}),C=wi({migrationName:"Recalculate Start Balances Migration",isDestructive:!0,onDownloadBackup:e}),T=wi({migrationName:"Repair Month Map Migration",isDestructive:!0,onDownloadBackup:e}),I=r.hasViolations||i.hasItemsToFix||o.hasItemsToMigrate||l.hasPairsToConvert,M=(r.violationCount||0)+(i.totalOrphaned||0)+(o.totalToMigrate||0)+(l.totalPairs||0);return d.jsxs(d.Fragment,{children:[d.jsxs(h_,{title:"Maintenance",icon:"",description:"Re-runnable database validation scripts. Validate all to see which need resolution.",type:"maintenance",onValidateAll:b,isValidating:p,isAnyRunning:g,children:[d.jsx(t4,{accountCategoryValidation:r,orphanedIdCleanup:i,expenseToAdjustment:o,adjustmentsToTransfers:l,needsAction:I,totalIssues:M,isScanning:r.isScanning||i.isScanning||o.isScanning||l.isScanning,isRunning:i.isRunning||o.isRunning||l.isRunning,disabled:t,onRunOrphaned:()=>_.promptBeforeAction(i.runMigration),onRunExpense:()=>w.promptBeforeAction(o.runMigration),onRunTransfers:()=>x.promptBeforeAction(l.runMigration)}),d.jsx(n4,{status:u.status,hasData:u.hasData,hasIssues:u.hasIssues,totalIssues:u.totalIssues,isChecking:u.isScanning,isRunning:u.isRunning,result:u.result,onCheck:u.scan,onRun:()=>S.promptBeforeAction(u.runCleanup),disabled:t}),d.jsx(r4,{status:h.status,hasData:h.hasData,needsMigration:h.needsMigration,totalItemsToFix:h.totalItemsToFix,isChecking:h.isScanning,isRunning:h.isRunning,result:h.result,onCheck:h.scanStatus,onRun:()=>C.promptBeforeAction(h.runMigration),disabled:t}),d.jsx(s4,{status:f.status,hasData:f.hasData,needsMigration:f.needsMigration,totalItemsToFix:f.totalItemsToFix,isChecking:f.isScanning,isRunning:f.isRunning,result:f.result,onCheck:f.scanStatus,onRun:()=>T.promptBeforeAction(f.runMigration),disabled:t})]}),d.jsx(xi,{..._.promptProps,isDownloading:n}),d.jsx(xi,{...w.promptProps,isDownloading:n}),d.jsx(xi,{...x.promptProps,isDownloading:n}),d.jsx(xi,{...S.promptProps,isDownloading:n}),d.jsx(xi,{...C.promptProps,isDownloading:n}),d.jsx(xi,{...T.promptProps,isDownloading:n})]})}function a4({isDownloading:t,downloadProgress:e,downloadError:n,onDownload:r,isScanning:i,isUploading:o,uploadStatus:l,uploadProgress:u,uploadError:h,uploadResult:f,onScan:p,onUpload:g,disabled:b}){const _=R.useRef(null),[w,x]=R.useState(null),[S,C]=R.useState(!1),T=async $=>{const A=$.target.files?.[0];A&&(x(A),await p(A))},I=l!==null,M=I&&(l.budgetsFound>0||l.monthsFound>0),U=b||t||i||o,H=f?.success?"var(--color-success)":M?"var(--color-warning)":I?"var(--color-success)":"var(--text-muted)",O=f?.success?"":o||i||t?"":M?"":I?"":"",P=f?.success?"Uploaded":o?"Uploading":i?"Scanning":t?"Downloading":M?`${l.budgetsFound} budget(s), ${l.monthsFound} month(s) ready`:I?"Nothing to upload":"Select file",N=t?e?.percentComplete:u?.percentComplete,V=n||h;return d.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"8px",margin:"0.25rem 0",overflow:"hidden"},children:[d.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"0.75rem 1rem",gap:"1rem"},children:[d.jsx("div",{style:{width:"28px",height:"28px",borderRadius:"50%",background:`color-mix(in srgb, ${H} 20%, transparent)`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.85rem",flexShrink:0},children:o||i||t?d.jsx(Hn,{noMargin:!0}):O}),d.jsxs("div",{style:{flex:1,minWidth:0},children:[d.jsx("div",{style:{fontWeight:500,fontSize:"0.95rem",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:" Budget Backup & Restore"}),d.jsx("div",{style:{fontSize:"0.8rem",opacity:.6,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:"Download selected budget as zip or restore from zip file"})]}),d.jsx("div",{style:{color:H,fontSize:"0.8rem",fontWeight:500,flexShrink:0},children:P}),d.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:[d.jsx("button",{onClick:()=>{r()},disabled:U,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",padding:"0.35rem 0.6rem",borderRadius:"4px",cursor:U?"not-allowed":"pointer",fontSize:"0.8rem",opacity:U?.5:1,display:"flex",alignItems:"center",gap:"0.25rem"},title:"Download all budgets as zip",children:t?d.jsx(Hn,{noMargin:!0}):""}),d.jsx("input",{ref:_,type:"file",accept:".zip",onChange:T,style:{display:"none"}}),d.jsx("button",{onClick:()=>_.current?.click(),disabled:U,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",padding:"0.35rem 0.6rem",borderRadius:"4px",cursor:U?"not-allowed":"pointer",fontSize:"0.8rem",opacity:U?.5:1,display:"flex",alignItems:"center",gap:"0.25rem"},title:"Select zip file to restore",children:i?d.jsx(Hn,{noMargin:!0}):""}),M&&w&&d.jsx("button",{onClick:async()=>{await g(w)},disabled:U,style:{background:"var(--color-primary)",color:"white",border:"none",padding:"0.35rem 0.75rem",borderRadius:"4px",cursor:U?"not-allowed":"pointer",fontSize:"0.8rem",fontWeight:500,opacity:U?.6:1,display:"flex",alignItems:"center",gap:"0.25rem"},children:o?d.jsx(Hn,{noMargin:!0}):"Upload"}),(I||f||V)&&d.jsx("button",{onClick:()=>C(!S),style:{background:"transparent",color:"inherit",border:"none",padding:"0.35rem",borderRadius:"4px",cursor:"pointer",fontSize:"0.9rem",opacity:.6},title:S?"Collapse":"Expand",children:S?"":""})]})]}),(t||o)&&N!==void 0&&d.jsxs("div",{style:{padding:"0 1rem 0.5rem 1rem"},children:[d.jsx("div",{style:{width:"100%",height:"4px",background:"color-mix(in srgb, currentColor 10%, transparent)",borderRadius:"2px",overflow:"hidden"},children:d.jsx("div",{style:{width:`${N}%`,height:"100%",background:"var(--color-primary)",transition:"width 0.3s ease"}})}),d.jsxs("div",{style:{fontSize:"0.75rem",opacity:.6,marginTop:"0.25rem",textAlign:"center"},children:[t?e?.phase:u?.phase,": ",N,"%"]})]}),S&&(I||f||V)&&d.jsxs("div",{style:{borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)",padding:"1rem",background:"color-mix(in srgb, currentColor 2%, transparent)",fontSize:"0.85rem"},children:[V&&d.jsxs("div",{style:{marginBottom:"0.75rem",color:"var(--color-error)"},children:[" Error: ",V]}),f&&d.jsx("div",{style:{marginBottom:l?"0.75rem":0,color:f.success?"var(--color-success)":"var(--color-error)"},children:f.success?d.jsxs(d.Fragment,{children:[" Restored ",f.budgetsRestored," budget(s), ",f.monthsRestored," month(s), ",f.payeesRestored," payee doc(s)"]}):d.jsxs(d.Fragment,{children:[" Upload failed: ",f.errors.join(", ")]})}),l&&d.jsxs(d.Fragment,{children:[d.jsxs("div",{style:{marginBottom:"0.25rem"},children:[d.jsx("strong",{children:"Found in zip:"})," ",l.budgetsFound," budget(s), ",l.monthsFound," month(s), ",l.payeesFound," payee doc(s)"]}),l.budgetsToRestore.length>0&&d.jsxs("div",{children:[d.jsx("strong",{children:"Budgets to restore:"})," ",l.budgetsToRestore.join(", ")]})]})]})]})}function o4({hasData:t,monthsCount:e,budgetCount:n,isChecking:r,isDeleting:i,deleteResult:o,onCheck:l,onDelete:u,disabled:h}){const[f,p]=R.useState(!1),g=()=>i?"running":t?o&&o.errors.length===0?"complete":e===0?"clean":"needs-action":"unknown",b=()=>o&&o.errors.length===0?`Deleted ${o.deleted}`:e===0?"No months":`${e} months`,_=()=>{p(!0)},w=()=>{p(!1),u()},x=()=>o?d.jsxs("div",{style:{fontSize:"0.85rem"},children:[d.jsx("div",{style:{marginBottom:"0.5rem",fontWeight:500},children:o.errors.length>0?" Completed with errors":" Deletion complete"}),d.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[d.jsxs("li",{children:[o.deleted," month(s) deleted"]}),o.budgetsRecalculated>0&&d.jsxs("li",{children:[o.budgetsRecalculated," budget(s) reset"]})]}),o.errors.length>0&&d.jsxs("div",{style:{marginTop:"0.5rem",color:"var(--color-error)"},children:[d.jsxs("div",{children:["Errors (",o.errors.length,"):"]}),d.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1.25rem"},children:[o.errors.slice(0,3).map((S,C)=>d.jsx("li",{children:S},C)),o.errors.length>3&&d.jsxs("li",{children:["...and ",o.errors.length-3," more"]})]})]})]}):t?e===0?d.jsx("div",{style:{fontSize:"0.85rem"},children:" No month documents found in Firebase."}):d.jsxs("div",{style:{fontSize:"0.85rem"},children:[d.jsx("div",{style:{marginBottom:"0.5rem",color:"var(--color-error)"},children:" DESTRUCTIVE ACTION"}),d.jsxs("div",{children:["Found ",e," month(s) across ",n," budget(s)."]}),d.jsx("div",{style:{marginTop:"0.5rem",opacity:.7},children:"This will permanently delete ALL month documents and reset all budgets."})]}):d.jsx("div",{style:{fontSize:"0.85rem",opacity:.7},children:"Click check to scan for months."});return d.jsxs(d.Fragment,{children:[d.jsx(Za,{name:"Delete ALL Months",description:"DESTRUCTIVE: Deletes all month documents from all budgets",status:g(),statusText:b(),onCheck:l,isChecking:r,onRun:e>0?_:void 0,isRunning:i,actionText:"Delete",disabled:h,itemCount:e>0?e:void 0,details:x(),isDestructive:!0}),d.jsxs(Ks,{isOpen:f,onClose:()=>p(!1),title:" Delete All Months?",children:[d.jsx("div",{style:{background:"color-mix(in srgb, var(--color-error) 15%, transparent)",border:"1px solid color-mix(in srgb, var(--color-error) 40%, transparent)",borderRadius:"8px",padding:"1rem",marginBottom:"1rem"},children:d.jsx("p",{style:{margin:0,color:"var(--color-error-light)",fontWeight:500,fontSize:"0.95rem"},children:" This is a destructive operation that cannot be undone!"})}),d.jsxs("p",{style:{margin:"0 0 0.75rem",opacity:.9},children:["This will permanently delete ",d.jsxs("strong",{style:{color:"var(--color-error)"},children:[e," month(s)"]})," across"," ",d.jsxs("strong",{style:{color:"var(--color-error)"},children:[n," budget(s)"]}),"."]}),d.jsxs("ul",{style:{margin:"0 0 1.5rem",paddingLeft:"1.5rem",opacity:.8,fontSize:"0.9rem"},children:[d.jsx("li",{children:"All account balances  $0"}),d.jsx("li",{children:"All category balances  $0"}),d.jsx("li",{children:"Month history cleared"})]}),d.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[d.jsx(qe,{variant:"secondary",actionName:"Cancel Delete All Months",onClick:()=>p(!1),children:"Cancel"}),d.jsxs(qe,{variant:"danger",actionName:"Confirm Delete All Months",onClick:w,children:[" Delete All ",e," Months"]})]})]})]})}function l4({status:t,hasData:e,totalBudgets:n,totalMonths:r,isChecking:i,isDeleting:o,deleteResult:l,onCheck:u,onDelete:h,disabled:f}){const[p,g]=R.useState(!1),b=t?.staleBudgetIds??[],_=b.length>0,w=()=>o?"running":e?l&&l.errors.length===0?"complete":n===0&&!_?"clean":"needs-action":"unknown",x=()=>l&&l.errors.length===0?`Deleted ${l.budgetsDeleted}`:n===0&&!_?"Clean":_?`${b.length} stale ref(s)`:`${n} budget(s)`,S=()=>{g(!0)},C=()=>{g(!1),h()},T=()=>l?d.jsxs("div",{style:{fontSize:"0.85rem"},children:[d.jsx("div",{style:{marginBottom:"0.5rem",fontWeight:500},children:l.errors.length>0?" Completed with errors":" Deletion complete"}),d.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[l.budgetsDeleted>0&&d.jsxs("li",{children:[l.budgetsDeleted," budget(s) deleted"]}),l.monthsDeleted>0&&d.jsxs("li",{children:[l.monthsDeleted," month(s) deleted"]}),l.payeesDeleted>0&&d.jsxs("li",{children:[l.payeesDeleted," payee doc(s) deleted"]})]}),l.errors.length>0&&d.jsxs("div",{style:{marginTop:"0.5rem",color:"var(--color-error)"},children:[d.jsxs("div",{children:["Errors (",l.errors.length,"):"]}),d.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1.25rem"},children:[l.errors.slice(0,3).map((M,U)=>d.jsx("li",{children:M},U)),l.errors.length>3&&d.jsxs("li",{children:["...and ",l.errors.length-3," more"]})]})]})]}):e?n===0&&!_?d.jsx("div",{style:{fontSize:"0.85rem"},children:' No budget found for sample@sample.com  user is in "new user" state.'}):_?d.jsxs("div",{style:{fontSize:"0.85rem"},children:[d.jsx("div",{style:{marginBottom:"0.5rem",color:"var(--color-warning)"},children:" Found stale budget references:"}),d.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[b.slice(0,3).map(M=>d.jsx("li",{style:{opacity:.8},children:M},M)),b.length>3&&d.jsxs("li",{style:{opacity:.6},children:["...and ",b.length-3," more"]})]})]}):d.jsxs("div",{style:{fontSize:"0.85rem"},children:[d.jsx("div",{style:{marginBottom:"0.5rem",color:"var(--color-warning)"},children:" Sample user budget found:"}),d.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[d.jsxs("li",{children:[n," budget(s)"]}),d.jsxs("li",{children:[r," month(s)"]})]}),d.jsx("div",{style:{marginTop:"0.5rem",opacity:.7},children:"Deleting will reset sample@sample.com to a new user state."})]}):d.jsx("div",{style:{fontSize:"0.85rem",opacity:.7},children:"Click check to scan for sample user budget."}),I=n>0||_;return d.jsxs(d.Fragment,{children:[d.jsx(Za,{name:"Delete Sample User Budget",description:"Reset sample@sample.com to new user state",status:w(),statusText:x(),onCheck:u,isChecking:i,onRun:I?S:void 0,isRunning:o,actionText:"Delete",disabled:f,itemCount:I?n||b.length:void 0,details:T(),isDestructive:!0}),d.jsxs(Ks,{isOpen:p,onClose:()=>g(!1),title:" Delete Sample User Budget?",children:[d.jsx("div",{style:{background:"color-mix(in srgb, var(--color-warning) 15%, transparent)",border:"1px solid color-mix(in srgb, var(--color-warning) 40%, transparent)",borderRadius:"8px",padding:"1rem",marginBottom:"1rem"},children:d.jsx("p",{style:{margin:0,color:"var(--color-warning-light)",fontWeight:500,fontSize:"0.95rem"},children:" This will delete all data for sample@sample.com!"})}),n>0&&d.jsxs("p",{style:{margin:"0 0 0.75rem",opacity:.9},children:["This will permanently delete ",d.jsxs("strong",{style:{color:"var(--color-warning)"},children:[n," budget(s)"]})," and"," ",d.jsxs("strong",{style:{color:"var(--color-warning)"},children:[r," month(s)"]}),"."]}),_&&d.jsxs("p",{style:{margin:"0 0 0.75rem",opacity:.9},children:["This will remove ",d.jsxs("strong",{style:{color:"var(--color-warning)"},children:[b.length," stale reference(s)"]})," from the user document."]}),d.jsxs("ul",{style:{margin:"0 0 1.5rem",paddingLeft:"1.5rem",opacity:.8,fontSize:"0.9rem"},children:[d.jsx("li",{children:"Budget document deleted"}),d.jsx("li",{children:"All month documents deleted"}),d.jsx("li",{children:"Payees document deleted"}),d.jsx("li",{children:"User will see onboarding flow"})]}),d.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[d.jsx(qe,{variant:"secondary",actionName:"Cancel Delete Sample User Budget",onClick:()=>g(!1),children:"Cancel"}),d.jsx(qe,{variant:"danger",actionName:"Confirm Delete Sample User Budget",onClick:C,children:" Delete Sample User Data"})]})]})]})}function c4({onClearCache:t,disabled:e}){const[n,r]=R.useState(!1),i=()=>{r(!0)},o=()=>{r(!1),t()};return d.jsxs(d.Fragment,{children:[d.jsx(Uz,{name:"Clear All Caches",description:"Clear cached data and reload to fetch fresh data from Firestore",onAction:i,actionText:"Clear & Reload",actionIcon:"",disabled:e,isDestructive:!0}),d.jsxs(Ks,{isOpen:n,onClose:()=>r(!1),title:"Clear Caches & Reload?",children:[d.jsx("p",{style:{margin:"0 0 1rem 0",opacity:.8},children:"This will clear all cached data and reload the page. The app will fetch fresh data from Firestore for everything."}),d.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[d.jsx(qe,{variant:"secondary",actionName:"Cancel Clear Caches",onClick:()=>r(!1),children:"Cancel"}),d.jsx(qe,{variant:"danger",actionName:"Confirm Clear Caches & Reload",onClick:o,children:"Clear & Reload"})]})]})]})}function u4({disabled:t,onDownloadBackup:e,isDownloadingBackup:n,budgetDownloadUpload:r,deleteAllMonths:i,deleteSampleUserBudget:o,onClearCache:l}){const u=r.isDownloading||r.isUploading||i.isDeleting||o.isDeleting,h=wi({migrationName:"Delete All Months",isDestructive:!0,onDownloadBackup:e}),f=wi({migrationName:"Delete Sample User Budget",isDestructive:!0,onDownloadBackup:e}),p=wi({migrationName:"Upload Budget",isDestructive:!0,onDownloadBackup:e});return d.jsxs(d.Fragment,{children:[d.jsxs(h_,{title:"Utilities",icon:"",description:"Administrative utilities for data management, downloads, and cache control.",type:"utility",isAnyRunning:u,children:[d.jsx(a4,{isDownloading:r.isDownloading,downloadProgress:r.downloadProgress,downloadError:r.downloadError,onDownload:r.downloadBudget,isScanning:r.isScanning,isUploading:r.isUploading,uploadStatus:r.uploadStatus,uploadProgress:r.uploadProgress,uploadError:r.uploadError,uploadResult:r.uploadResult,onScan:r.scanZipFile,onUpload:async g=>{p.promptBeforeAction(()=>{r.uploadBudget(g).catch(b=>console.error("Upload failed:",b))})},disabled:t}),d.jsxs("div",{style:{marginTop:"0.75rem",paddingTop:"0.75rem",borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},children:[d.jsx("div",{style:{fontSize:"0.75rem",opacity:.5,textTransform:"uppercase",letterSpacing:"0.05em",marginBottom:"0.5rem",paddingLeft:"0.5rem"},children:"Destructive Actions"}),d.jsx(o4,{status:i.status,hasData:i.hasData,monthsCount:i.monthsCount,budgetCount:i.budgetCount,isChecking:i.isScanning,isDeleting:i.isDeleting,deleteResult:i.deleteResult,deleteProgress:i.deleteProgress,onCheck:i.scanStatus,onDelete:()=>h.promptBeforeAction(i.deleteAllMonths),disabled:t}),d.jsx(l4,{status:o.status,hasData:o.hasData,totalBudgets:o.totalBudgets,totalMonths:o.totalMonths,isChecking:o.isScanning,isDeleting:o.isDeleting,deleteResult:o.deleteResult,deleteProgress:o.deleteProgress,onCheck:o.scanStatus,onDelete:()=>f.promptBeforeAction(o.deleteSampleUserBudget),disabled:t}),d.jsx(c4,{onClearCache:l,disabled:t})]})]}),d.jsx(xi,{...h.promptProps,isDownloading:n}),d.jsx(xi,{...f.promptProps,isDownloading:n}),d.jsx(xi,{...p.promptProps,isDownloading:n})]})}function d4({message:t="Loading...",spinnerColor:e=me.primary,children:n,spinnerSize:r=4}){return d.jsxs("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"var(--loading-overlay-bg)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",zIndex:9999,gap:"1.5rem",backdropFilter:"blur(4px)"},children:[d.jsx("div",{style:{width:`${r}rem`,height:`${r}rem`,border:"3px solid var(--loading-overlay-content-border)",borderTopColor:e,borderRadius:"50%",animation:"loadingOverlaySpin 0.8s linear infinite"}}),d.jsx("p",{style:{color:"var(--loading-overlay-text)",fontSize:"1.2rem",fontWeight:600,letterSpacing:"0.02em",margin:0},children:t}),n,d.jsx("style",{children:`
        @keyframes loadingOverlaySpin {
          to { transform: rotate(360deg); }
        }
      `})]})}function h4(){return d.jsxs("div",{style:qf,children:[d.jsx("nav",{style:{marginBottom:"1rem",display:"flex",alignItems:"center"},children:d.jsx(jn,{to:"/",style:{display:"flex",alignItems:"center"},title:"Tarron Lane Home",children:d.jsx("img",{src:"/t-icon.svg",alt:"Tarron Lane Home",style:{width:"2rem",height:"2rem"}})})}),d.jsx("h1",{children:"Tarron Lane Homepage"}),d.jsx("nav",{children:d.jsxs("ul",{children:[d.jsx("li",{children:d.jsx(jn,{to:"/sql-test",children:"SQL Test"})}),d.jsx("li",{children:d.jsx(jn,{to:"/budget",children:"Budget"})}),d.jsx("li",{children:d.jsx(jn,{to:"/account",children:"Account"})})]})})]})}function f4(){const t=R.useContext(Cd),e=zi(),[n,r]=R.useState(!1),i=tr(),o=od(),l=i.state?.from||"/";R.useEffect(()=>{t.is_logged_in&&l!=="/"&&o(l,{replace:!0})},[t.is_logged_in,l,o]);function u(){r(!0),e.logout_firebase_user().then(function(){ze.clear(),window.location.href="/"})}return d.jsxs("div",{style:qf,children:[d.jsxs("nav",{style:{marginBottom:"1rem",display:"grid",gridTemplateColumns:"1fr auto 1fr",alignItems:"center"},children:[d.jsx("div",{style:{display:"flex",alignItems:"center"},children:d.jsx(jn,{to:"/",style:{opacity:.6,fontSize:"1.5rem",textDecoration:"none",padding:"0.25rem 0.5rem"},title:"Back to Home",children:""})}),d.jsxs(jn,{to:"/",style:{display:"flex",alignItems:"center",gap:"0.5rem",textDecoration:"none",color:"inherit"},title:"Tarron Lane Home",children:[d.jsx("img",{src:"/t-icon.svg",alt:"Tarron Lane",style:{width:"1.5rem",height:"1.5rem"}}),d.jsx("span",{style:{fontWeight:600,fontSize:"1.1rem"},children:"Account"})]}),d.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:d.jsx(pA,{items:[{label:"Budget",icon:"",to:"/budget"},{label:"Account",icon:"",to:"/account"}]})})]}),d.jsx("h1",{children:"Account"}),t.is_logged_in?n?d.jsx("p",{children:"Logging Out..."}):d.jsxs(d.Fragment,{children:[d.jsxs("p",{children:["You are logged in as ",t.username]}),d.jsx("button",{onClick:u,style:{marginTop:"1rem"},children:"Logout"})]}):d.jsx(m4,{})]})}function m4(){const t=zi(),[e,n]=R.useState(""),[r,i]=R.useState(""),[o,l]=R.useState(!1),[u,h]=R.useState(!1),[f,p]=R.useState("");function g(w){n(w.target.value)}function b(w){i(w.target.value)}function _(w){w.preventDefault(),h(!0),p(""),ze.clear(),t.login_firebase_user(e,r).then(function(){}).catch(function(){p("Incorrect login credentials")}).finally(function(){h(!1)})}return d.jsxs("form",{onSubmit:_,children:[d.jsxs("div",{children:[d.jsx("label",{htmlFor:"username",children:"Email: "}),d.jsx("input",{id:"username",type:"email",value:e,onChange:g})]}),d.jsxs("div",{children:[d.jsx("label",{htmlFor:"password",children:"Password: "}),d.jsxs("div",{style:{display:"inline-flex",alignItems:"center",position:"relative"},children:[d.jsx("input",{id:"password",type:o?"text":"password",value:r,onChange:b,style:{paddingRight:"2rem"}}),d.jsx("button",{type:"button",onClick:()=>l(!o),style:{position:"absolute",right:"0.25rem",background:"none",border:"none",cursor:"pointer",padding:"0.25rem",opacity:.6,fontSize:"1rem"},title:o?"Hide password":"Show password",children:o?"":""})]})]}),u?d.jsx("p",{children:"Logging in..."}):d.jsx("button",{children:"Login"}),f&&d.jsx("p",{style:{color:"red"},children:f})]})}const p4={categories:"balances",accounts:"balances",income:"transactions",spend:"transactions",transfers:"transactions",adjustments:"transactions"};function g4({activeTab:t,setActiveTab:e,lastBalancesTab:n,lastTransactionsTab:r,allocationsFinalized:i}){const o=p4[t],l=R.useMemo(()=>[{id:"balances",label:"Balances"},{id:"transactions",label:"Transactions"}],[]),u=R.useMemo(()=>[{id:"categories",label:"Categories",checkmark:i},{id:"accounts",label:"Accounts"}],[i]),h=R.useMemo(()=>[{id:"income",label:"Income"},{id:"spend",label:"Spend"},{id:"transfers",label:"Transfers"},{id:"adjustments",label:"Adjustments"}],[]),f=g=>{e(g==="balances"?n:r)},p=o==="balances"?u:h;return d.jsxs("div",{children:[d.jsx(Wf,{mode:"button",tabs:l,activeTab:o,onTabChange:f,variant:"segmented"}),d.jsx(Wf,{mode:"button",tabs:p,activeTab:t,onTabChange:g=>e(g),variant:"secondary"})]})}function n1({direction:t,isDisabled:e,isLoading:n,disabledReason:r,onNavigate:i}){const[o,l]=R.useState(!1),u=n||e,h=t==="prev"?"":"",f=t==="prev"?"Previous month":"Next month",p=()=>{n||(e?(l(!0),setTimeout(()=>l(!1),2e3)):i())};return d.jsxs("div",{style:{position:"relative"},children:[d.jsx("button",{onClick:p,onMouseEnter:()=>e&&l(!0),onMouseLeave:()=>l(!1),style:{background:"color-mix(in srgb, currentColor 10%, transparent)",border:"none",borderRadius:"8px",padding:"0.75rem 1rem",cursor:u?"not-allowed":"pointer",fontSize:"1.25rem",opacity:u?.5:1,transition:"opacity 0.15s, background 0.15s"},title:e?void 0:f,children:h}),o&&e&&r&&d.jsx("div",{style:{position:"absolute",top:"100%",...t==="prev"?{left:0}:{right:0},marginTop:"0.5rem",padding:"0.5rem 0.75rem",background:me.warning,color:"var(--color-warning-on-warning)",borderRadius:"6px",fontSize:"0.75rem",fontWeight:500,width:"max-content",maxWidth:"min(300px, 50vw)",textAlign:"center",zIndex:20,boxShadow:"0 2px 8px var(--shadow-overlay)"},children:r})]})}function y4({pickerYear:t,pickerMonth:e,currentYear:n,currentMonthNumber:r,minOrdinal:i,maxOrdinal:o,minAllowed:l,maxAllowed:u,monthMap:h,onYearChange:f,onMonthChange:p,onGo:g}){const b=t>l.year,_=t<u.year,w=Number(Qe(t,e)),x=h?Qe(t,e)in h:!1,S=w<=o,C=(x||S)&&w>=i;return d.jsxs("div",{style:{padding:"0.75rem",borderTop:"1px solid color-mix(in srgb, currentColor 15%, transparent)",marginTop:"0.25rem"},children:[d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.5rem"},children:[d.jsx("button",{onClick:()=>f(t-1),disabled:!b,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",border:"none",borderRadius:"4px",padding:"0.25rem 0.5rem",cursor:b?"pointer":"not-allowed",fontSize:"0.8rem",opacity:b?1:.3},title:b?"Previous year":"Cannot go further back",children:""}),d.jsx("span",{style:{flex:1,textAlign:"center",fontSize:"0.9rem",fontWeight:500},children:t}),d.jsx("button",{onClick:()=>f(t+1),disabled:!_,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",border:"none",borderRadius:"4px",padding:"0.25rem 0.5rem",cursor:_?"pointer":"not-allowed",fontSize:"0.8rem",opacity:_?1:.3},title:_?"Next year":"Cannot go further ahead",children:""})]}),d.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"0.25rem",marginBottom:"0.5rem"},children:Vf.map((T,I)=>{const M=I+1,U=M===e,H=t===n&&M===r,O=Number(Qe(t,M)),P=Qe(t,M),N=O<i,V=O>o,$=O<Number(Qe(n,r)),A=h?P in h:!1,k=N||V||$&&!A;let D=T;return N?D="Too far in the past":V?D="Too far in the future":$&&!A&&(D="Month not in budget"),d.jsx("button",{onClick:()=>p(M),disabled:k,style:{background:U?me.primary:"color-mix(in srgb, currentColor 8%, transparent)",border:H?`1px solid ${me.primary}`:"1px solid transparent",borderRadius:"4px",padding:"0.35rem 0.25rem",cursor:k?"not-allowed":"pointer",fontSize:"0.7rem",color:U?"var(--color-primary-on-primary)":"inherit",opacity:k?.3:1,transition:"background 0.15s"},title:D,children:T.slice(0,3)},M)})}),d.jsxs("button",{onClick:g,disabled:!C,style:{width:"100%",background:C?me.primary:"color-mix(in srgb, currentColor 20%, transparent)",border:"none",borderRadius:"6px",padding:"0.5rem",cursor:C?"pointer":"not-allowed",fontSize:"0.85rem",color:C?"var(--color-primary-on-primary)":"inherit",fontWeight:500,opacity:C?1:.5},children:["Go to ",Vf[e-1]," ",t]})]})}function _4({isOpen:t,onClose:e,year:n,month:r,isDeleting:i,onConfirm:o}){return d.jsxs(Ks,{isOpen:t,onClose:e,title:" Delete Month?",children:[d.jsx("div",{style:{background:"color-mix(in srgb, var(--color-error) 15%, transparent)",border:"1px solid color-mix(in srgb, var(--color-error) 40%, transparent)",borderRadius:"8px",padding:"1rem",marginBottom:"1rem"},children:d.jsxs("p",{style:{margin:0,color:"var(--color-error-light)",fontWeight:500,fontSize:"0.95rem"},children:[" This will permanently delete ",Vf[r-1]," ",n,"!"]})}),d.jsx("p",{style:{margin:"0 0 0.75rem",opacity:.9},children:"This month document and all its data (income, expenses, allocations) will be permanently deleted."}),d.jsx("p",{style:{margin:"0 0 1rem",opacity:.8,fontSize:"0.9rem"},children:"After deletion, you will be navigated to the previous month."}),d.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[d.jsx(qe,{variant:"secondary",actionName:"Cancel Delete Month",onClick:e,disabled:i,children:"Cancel"}),d.jsx(qe,{variant:"danger",actionName:"Confirm Delete Month",onClick:o,disabled:i,children:i?"Deleting...":" Delete Month"})]})]})}function b4(){const t=new Date;let e=t.getFullYear(),n=t.getMonth()+1+Ai;for(;n>12;)n-=12,e+=1;return{year:e,month:n}}function v4(){const t=new Date;let e=t.getFullYear(),n=t.getMonth()+1-Y0;for(;n<1;)n+=12,e-=1;return{year:e,month:n}}function x4(t){return Object.keys(t).sort()[0]}function w4(t){const e=parseInt(t.slice(0,4),10),n=parseInt(t.slice(4,6),10);return{year:e,month:n}}function S4(t){const e=x4(t);return e?w4(e):v4()}function r1(t,e){return e===1?{year:t-1,month:12}:{year:t,month:e-1}}function E4(t,e){return e===12?{year:t+1,month:1}:{year:t,month:e+1}}function C4({onPreviousMonth:t,onNextMonth:e,onDownloadCategories:n}){const{isLoading:r}=In(),{currentYear:i,currentMonthNumber:o,isAdmin:l,selectedBudgetId:u,setCurrentYear:h,setCurrentMonthNumber:f}=Ye(),{budget:p,monthMap:g}=Dn(),{month:b}=Xs(u,i,o),_=r1(i,o),w=E4(i,o),x=b4(),S=Number(Qe(x.year,x.month)),T=Number(Qe(w.year,w.month))>S,I=Qe(_.year,_.month),M=g?I in g:!1,U=!M,H=S4(g||{}),O=Number(Qe(H.year,H.month)),[P,N]=R.useState(!1),[V,$]=R.useState(!1),[A,k]=R.useState(i),[D,K]=R.useState(o),[X,G]=R.useState(!1),[te,Q]=R.useState(!1),se=R.useRef(null),B=(()=>{if(!g||Object.keys(g).length===0)return!1;const he=Qe(i,o),Ee=Math.max(...Object.keys(g).map(Number));return Number(he)===Ee})();async function q(){if(u){Q(!0);try{const he=Qs(u,i,o);vP(u,i,o),await $y("months",he,`deleting month ${i}/${o}`),`${i}${o}`,ze.removeQueries({queryKey:Ce.month(u,i,o)});const Ee=r1(i,o);G(!1),N(!1),window.location.href=`/budget/${Ee.year}/${Ee.month}/categories`}catch(he){console.error("Failed to delete month:",he),alert(`Failed to delete month: ${he instanceof Error?he.message:"Unknown error"}`)}finally{Q(!1)}}}R.useEffect(()=>{if(!P)return;function he(Ee){se.current&&!se.current.contains(Ee.target)&&(N(!1),$(!1))}return document.addEventListener("mousedown",he),()=>document.removeEventListener("mousedown",he)},[P]);function ee(){V||(k(i),K(o)),$(!V)}function ne(){h(A),f(D),$(!1),N(!1)}async function le(){if(!b||!p)return;const he=new Date,ae=`${he.toISOString().split("T")[0]}_month_${i}_${String(o).padStart(2,"0")}`,fe=new Mm,Me=[{name:`${ae}_income.json`,data:b.income||[]},{name:`${ae}_expenses.json`,data:b.expenses||[]},{name:`${ae}_transfers.json`,data:b.transfers||[]},{name:`${ae}_adjustments.json`,data:b.adjustments||[]},{name:`${ae}_account_balances.json`,data:b.account_balances||[]},{name:`${ae}_category_balances.json`,data:b.category_balances||[]}],Ne={budget_id:p.id,budget_name:p.name,year_month_ordinal:b.year_month_ordinal,year:b.year,month:b.month,total_income:b.total_income,previous_month_income:b.previous_month_income,total_expenses:b.total_expenses,are_allocations_finalized:b.are_allocations_finalized,created_at:b.created_at,updated_at:b.updated_at,downloaded_at:he.toISOString()};Me.push({name:`${ae}_metadata.json`,data:Ne});for(const de of Me)fe.file(de.name,JSON.stringify(de.data,null,2));const tt=await fe.generateAsync({type:"blob"}),Ue=URL.createObjectURL(tt),L=document.createElement("a");L.href=Ue,L.download=`${ae}.zip`,document.body.appendChild(L),L.click(),document.body.removeChild(L),URL.revokeObjectURL(Ue),N(!1)}return d.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"1rem",marginBottom:"1.5rem",padding:"1rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"12px"},children:[d.jsx(n1,{direction:"prev",isDisabled:U,isLoading:r,disabledReason:M?void 0:"No previous month available in this budget",onNavigate:t}),d.jsxs("div",{ref:se,style:{textAlign:"center",minWidth:"180px",position:"relative"},children:[d.jsxs("div",{style:{display:"flex",alignItems:"flex-start",justifyContent:"center",gap:"0.25rem"},children:[d.jsxs("h2",{style:{margin:0,fontSize:"1.5rem"},children:[Vf[o-1]," ",i]}),d.jsx("button",{onClick:()=>N(!P),style:{background:"transparent",border:"none",cursor:"pointer",fontSize:"0.5rem",opacity:.4,padding:"0.15rem",borderRadius:"4px",transition:"opacity 0.15s, transform 0.15s",transform:P?"rotate(180deg)":"rotate(0deg)",marginTop:"0.25rem"},title:"Month options",children:""})]}),r&&d.jsxs(d.Fragment,{children:[d.jsx("style",{children:"@keyframes spin { to { transform: rotate(360deg); } }"}),d.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0.4rem",marginTop:"0.35rem"},children:[d.jsx("span",{style:{display:"inline-block",width:"14px",height:"14px",border:"2px solid color-mix(in srgb, currentColor 20%, transparent)",borderTopColor:me.primary,borderRadius:"50%",animation:"spin 0.8s linear infinite"}}),d.jsx("span",{style:{fontSize:"0.8rem",opacity:.6},children:"Loading..."})]})]}),P&&d.jsxs("div",{style:{position:"absolute",top:"100%",left:"50%",transform:"translateX(-50%)",marginTop:"0.5rem",background:"var(--sticky-header-bg)",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",borderRadius:"8px",padding:"0.25rem",zIndex:100,minWidth:"160px",boxShadow:"0 4px 12px var(--shadow-overlay)"},children:[d.jsx("button",{onClick:ee,style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%",background:"transparent",border:"none",borderRadius:"6px",padding:"0.5rem 0.75rem",cursor:"pointer",fontSize:"0.85rem",color:"inherit",textAlign:"left",transition:"background 0.15s"},title:"Jump to a specific month",children:" Go to Month"}),n&&d.jsx("button",{onClick:()=>{n(),N(!1)},style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%",background:"transparent",border:"none",borderRadius:"6px",padding:"0.5rem 0.75rem",cursor:"pointer",fontSize:"0.85rem",color:"inherit",textAlign:"left",transition:"background 0.15s"},title:"Download category balances as Markdown",children:" Download data"}),V&&d.jsx(y4,{pickerYear:A,pickerMonth:D,currentYear:i,currentMonthNumber:o,minOrdinal:O,maxOrdinal:S,minAllowed:H,maxAllowed:x,monthMap:g,onYearChange:k,onMonthChange:K,onGo:ne}),l&&b&&d.jsx("button",{onClick:()=>{le()},style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%",background:"transparent",border:"none",borderRadius:"6px",padding:"0.5rem 0.75rem",cursor:"pointer",fontSize:"0.85rem",color:"inherit",textAlign:"left",transition:"background 0.15s"},title:"Download month document as JSON (for debugging)",children:" Download JSON"}),l&&b&&B&&d.jsx("button",{onClick:()=>G(!0),style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%",background:"transparent",border:"none",borderRadius:"6px",padding:"0.5rem 0.75rem",cursor:"pointer",fontSize:"0.85rem",color:"var(--color-error)",textAlign:"left",transition:"background 0.15s"},title:"Delete this month (last month only)",children:" Delete Month"})]})]}),d.jsx(n1,{direction:"next",isDisabled:T,isLoading:r,disabledReason:"Cannot create months more than 3 months into the future",onNavigate:e}),d.jsx(_4,{isOpen:X,onClose:()=>G(!1),year:i,month:o,isDeleting:te,onConfirm:q})]})}const f_={cursor:"pointer",fontSize:"0.9rem",padding:"0.35rem 0.5rem",borderRadius:"4px"},T4={...f_,background:me.primary,border:"none",color:"white"},A4={...f_,background:"transparent",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)"},j4={...f_,background:"transparent",border:`1px solid ${me.errorBorder}`,color:me.error},s1=t=>({display:"flex",alignItems:"center",justifyContent:"center",width:"2.25rem",height:"100%",minHeight:"2.25rem",background:t?`color-mix(in srgb, ${me.error} 15%, transparent)`:`color-mix(in srgb, ${me.success} 15%, transparent)`,border:`1px solid ${t?me.errorBorder:"var(--color-success-border)"}`,borderRadius:"4px 0 0 4px",cursor:"pointer",fontSize:"1rem",fontWeight:600,color:t?me.error:me.success,transition:"all 0.15s ease",flexShrink:0});function m_({accounts:t,accountGroups:e,categories:n,categoryGroups:r,payees:i,initialData:o,defaultAccountId:l,defaultDate:u,config:h,onSubmit:f,onCancel:p,onDelete:g,extraContent:b}){const{isWide:_}=tA(),{showCategory:w=!1,showCleared:x=!1,showSignToggle:S=!1,accountLabel:C="Account",payeePlaceholder:T="Payee name",descriptionPlaceholder:I="Optional note",submitLabel:M}=h,U=new Date().toISOString().split("T")[0],[H,O]=R.useState(o?.date||u||U),[P,N]=R.useState(o?.payee||""),[V,$]=R.useState(o?.categoryId||(h.showNoCategoryOption?Zt:"")),[A,k]=R.useState(o?.accountId||l||(h.showNoAccountOption?Gt:t[0]?t[0][0]:"")),D=o?.amount!==void 0?Math.abs(o.amount):void 0,[K,X]=R.useState(D?.toString()||""),[G,te]=R.useState(o?.description||""),[Q,se]=R.useState(o?.cleared||!1),[B,q]=R.useState(()=>S?o?.amount!==void 0?o.amount<0:!1:!0),[ee,ne]=R.useState(!1),le={},he=[];t.forEach(([we,ie])=>{ie.account_group_id?(le[ie.account_group_id]||(le[ie.account_group_id]=[]),le[ie.account_group_id].push([we,ie])):he.push([we,ie])});function Ee(we){we.preventDefault();const ie=parseFloat(K);if(isNaN(ie)||ie<=0||w&&!V||!A||!H)return;if(V===Zt&&A===Gt){ne(!0);return}ne(!1);const Oe=S&&B?-ie:ie;f({date:H,payee:P.trim()||void 0,categoryId:w?V:void 0,accountId:A,amount:Oe,description:G.trim()||void 0,cleared:x?Q:void 0})}!(V===Zt&&A===Gt)&&ee&&ne(!1);const Ne=h.showNoAccountOption?d.jsx(eA,{id:"txn-account",value:A,onChange:k,accounts:t,accountGroups:e,placeholder:$a,required:!0,showNoAccountOption:!0}):d.jsxs(rd,{id:"txn-account",value:A,onChange:we=>k(we.target.value),required:!0,style:{fontSize:"0.85rem",padding:"0.5rem"},children:[Object.entries(e).map(([we,ie])=>{const Re=le[we];return Re?.length?d.jsx("optgroup",{label:ie.name,children:Re.map(([Pe,Oe])=>d.jsx("option",{value:Pe,children:Oe.nickname},Pe))},we):null}),he.length>0&&d.jsx("optgroup",{label:"Other",children:he.map(([we,ie])=>d.jsx("option",{value:we,children:ie.nickname},we))})]}),tt=w&&n&&r?d.jsx(Bt,{label:"Category",htmlFor:"txn-category",children:d.jsx(JT,{id:"txn-category",value:V,onChange:$,categories:n,categoryGroups:r,placeholder:h.showNoCategoryOption?qo:"Search...",required:!0,showNoCategoryOption:h.showNoCategoryOption})}):null,Ue=x?d.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.25rem",paddingBottom:"0.35rem"},children:[d.jsx("label",{htmlFor:"txn-cleared",style:{fontSize:"0.75rem",opacity:.7,fontWeight:500},children:"Clr"}),d.jsx(Xr,{id:"txn-cleared",checked:Q,onChange:we=>se(we.target.checked)})]}):null,L=d.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.25rem",paddingBottom:"0.1rem"},children:[d.jsx("span",{style:{fontSize:"0.75rem",opacity:.7,fontWeight:500},children:""}),d.jsxs("div",{style:{display:"flex",gap:"0.25rem"},children:[d.jsx("button",{type:"submit",title:M,style:T4,children:""}),d.jsx("button",{type:"button",onClick:()=>{p()},title:"Cancel",style:A4,children:""}),g&&d.jsx("button",{type:"button",onClick:()=>{g()},title:"Delete",style:j4,children:""})]})]}),de=ee?d.jsx("div",{style:{background:`color-mix(in srgb, ${me.error} 15%, transparent)`,border:`1px solid ${me.errorBorder}`,borderRadius:"6px",padding:"0.5rem 0.75rem",fontSize:"0.85rem",color:me.error},children:'Cannot select both "No Category" and "No Account"  at least one must be a real category or account.'}):null,_e=d.jsxs(Ya,{children:[d.jsx(qe,{type:"submit",actionName:M,children:M}),d.jsx(qe,{type:"button",variant:"secondary",actionName:"Cancel Transaction Form",onClick:p,children:"Cancel"}),g&&d.jsx(qe,{type:"button",variant:"danger",actionName:"Delete Transaction",onClick:g,children:" Delete"})]}),J=w&&n&&r,Z={fontSize:"0.85rem",padding:"0.5rem"};if(!_)return d.jsxs(Ni,{actionName:M,onSubmit:Ee,children:[d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:[d.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[d.jsx(Bt,{label:"Date",htmlFor:"txn-date",children:d.jsx(Gf,{id:"txn-date",value:H,onChange:we=>O(we.target.value),required:!0,autoFocus:!0})}),d.jsx(Bt,{label:S?B?"Amount (Expense)":"Amount (Refund)":"Amount",htmlFor:"txn-amount",children:S?d.jsxs("div",{className:"currency-with-sign",style:{display:"flex",alignItems:"stretch"},children:[d.jsx("button",{type:"button",onClick:()=>q(!B),style:s1(B),title:B?"Click to make this a refund (+)":"Click to make this an expense (-)",children:B?"":"+"}),d.jsx("div",{style:{flex:1},children:d.jsx(No,{id:"txn-amount",value:K,onChange:X,placeholder:"$0.00",required:!0,style:{borderTopLeftRadius:0,borderBottomLeftRadius:0,borderLeft:"none",color:B?me.error:me.success}})})]}):d.jsx(No,{id:"txn-amount",value:K,onChange:X,placeholder:"$0.00",required:!0})})]}),d.jsx(Bt,{label:"Payee",htmlFor:"txn-payee",children:d.jsx(WS,{id:"txn-payee",value:P,onChange:N,payees:i,placeholder:T})}),tt,d.jsx(Bt,{label:C,htmlFor:"txn-account",children:Ne}),d.jsx(Bt,{label:"Description (optional)",htmlFor:"txn-description",children:d.jsx(Pi,{id:"txn-description",value:G,onChange:we=>te(we.target.value),placeholder:I})}),x&&d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[d.jsx(Xr,{id:"txn-cleared-stacked",checked:Q,onChange:we=>se(we.target.checked)}),d.jsx("label",{htmlFor:"txn-cleared-stacked",style:{fontSize:"0.9rem",cursor:"pointer"},children:"Cleared (appeared in bank account)"})]}),de,b]}),_e]});const oe=S?"8.25rem":"6rem",Se=J?x?`6rem minmax(8rem, 1fr) minmax(8rem, 1fr) minmax(8rem, 1fr) ${oe} minmax(10rem, 2fr) auto auto`:`6rem minmax(8rem, 1fr) minmax(8rem, 1fr) minmax(8rem, 1fr) ${oe} minmax(10rem, 2fr) auto`:x?`6rem minmax(10rem, 1fr) minmax(10rem, 1fr) ${oe} minmax(12rem, 2fr) auto auto`:`6rem minmax(10rem, 1fr) minmax(10rem, 1fr) ${oe} minmax(12rem, 2fr) auto`;return d.jsxs(Ni,{actionName:M,onSubmit:Ee,children:[d.jsxs("div",{style:{display:"grid",gridTemplateColumns:Se,gap:"1rem",alignItems:"end"},children:[d.jsx(Bt,{label:"Date",htmlFor:"txn-date",children:d.jsx(Gf,{id:"txn-date",value:H,onChange:we=>O(we.target.value),required:!0,style:Z,autoFocus:!0})}),d.jsx(Bt,{label:"Payee",htmlFor:"txn-payee",children:d.jsx(WS,{id:"txn-payee",value:P,onChange:N,payees:i,placeholder:T})}),tt,d.jsx(Bt,{label:C,htmlFor:"txn-account",children:Ne}),d.jsx(Bt,{label:S?B?"Amount ()":"Amount (+)":"Amount",htmlFor:"txn-amount",children:S?d.jsxs("div",{className:"currency-with-sign",style:{display:"flex",alignItems:"stretch"},children:[d.jsx("button",{type:"button",onClick:()=>q(!B),style:s1(B),title:B?"Click to make this a refund (+)":"Click to make this an expense (-)",children:B?"":"+"}),d.jsx("div",{style:{flex:1},children:d.jsx(No,{id:"txn-amount",value:K,onChange:X,placeholder:"$0.00",required:!0,style:{borderTopLeftRadius:0,borderBottomLeftRadius:0,borderLeft:"none",color:B?me.error:me.success}})})]}):d.jsx(No,{id:"txn-amount",value:K,onChange:X,placeholder:"$0.00",required:!0})}),d.jsx(Bt,{label:"Description",htmlFor:"txn-description",children:d.jsx(Pi,{id:"txn-description",value:G,onChange:we=>te(we.target.value),placeholder:I,style:Z})}),Ue,L]}),de,b]})}function i1({accounts:t,accountGroups:e,payees:n,initialData:r,defaultAccountId:i,defaultDate:o,onSubmit:l,onCancel:u,onDelete:h,submitLabel:f}){function p(g){l(g.amount,g.accountId,g.date,g.payee,g.description)}return d.jsx(m_,{accounts:t,accountGroups:e,payees:n,initialData:r?{date:r.date,payee:r.payee,accountId:r.account_id,amount:r.amount,description:r.description}:void 0,defaultAccountId:i,defaultDate:o,config:{showCategory:!1,showCleared:!1,accountLabel:"Deposit To",payeePlaceholder:"e.g., Employer, Client name",descriptionPlaceholder:"e.g., January paycheck",submitLabel:f},onSubmit:p,onCancel:u,onDelete:h})}function R4({income:t,accountName:e,accountGroupName:n,onEdit:r,onDelete:i,isMobile:o,isEvenRow:l}){const u=t.date?new Date(t.date+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"}):"",h=n?`${n} / ${e}`:e,f=l?"transparent":"var(--row-alt-bg)";if(o)return d.jsxs("div",{onClick:r,style:{gridColumn:"1 / -1",display:"grid",gridTemplateColumns:"1fr auto",gap:"0.5rem",padding:"0.75rem 1rem",background:f,cursor:"pointer",transition:"background 0.15s"},children:[d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[d.jsx("span",{style:{fontSize:"0.75rem",opacity:.5,fontFamily:"monospace",minWidth:"3rem"},children:u}),d.jsx("span",{style:{fontWeight:500,fontSize:"0.9rem"},children:t.payee||""})]}),d.jsxs("span",{style:{fontSize:"0.75rem",opacity:.6},children:[" ",h]})]}),d.jsx("div",{style:{display:"flex",alignItems:"center"},children:d.jsxs("span",{style:{fontWeight:600,color:me.success,fontFamily:"monospace"},children:["+",Jt(t.amount)]})})]});const p={padding:"0.6rem 0.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem"};return d.jsxs("div",{style:{gridColumn:"1 / -1",background:f,display:"grid",gridTemplateColumns:"5rem 1.5fr 7rem 1fr 6rem 1fr 3rem 4rem"},children:[d.jsx("div",{style:{...p,fontSize:"0.85rem",fontFamily:"monospace"},children:d.jsx("span",{style:{opacity:.6},children:u})}),d.jsx("div",{style:{...p,fontWeight:500,overflow:"hidden"},children:d.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.payee||""})}),d.jsx("div",{style:{...p,overflow:"hidden"},children:d.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.85rem",opacity:.7},children:h})}),d.jsxs("div",{style:{...p,justifyContent:"flex-end",fontWeight:600,color:me.success,fontFamily:"monospace"},children:["+",Jt(t.amount)]}),d.jsx("div",{style:{...p,paddingLeft:"0.5rem",overflow:"hidden"},children:d.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.8rem",opacity:.6},children:t.description||""})}),d.jsxs("div",{style:{...p,justifyContent:"flex-end",gap:"0.25rem"},children:[d.jsx("button",{onClick:r,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:g=>g.currentTarget.style.opacity="1",onMouseLeave:g=>g.currentTarget.style.opacity="0.5",title:"Edit",children:""}),d.jsx("button",{onClick:i,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:g=>g.currentTarget.style.opacity="1",onMouseLeave:g=>g.currentTarget.style.opacity="0.5",title:"Delete",children:""})]})]})}const Vl={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderTop:"1px solid var(--border-subtle)"};function I4(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n,setCurrentYear:r,setCurrentMonthNumber:i}=Ye(),{accounts:o,accountGroups:l}=Dn(),{month:u,isLoading:h}=Xs(t,e,n),{addIncome:f}=hz(),{updateIncome:p}=mz(),{deleteIncome:g}=pz(),b=Li(),[_,w]=R.useState(null),[x,S]=R.useState(!1),[C,T]=R.useState(null),U=e_(t,{enabled:x||C!==null}).data||[];function H(G){const te=G.account_group_id?l[G.account_group_id]:void 0;return te&&te.is_active!==null?te.is_active:G.is_active!==!1}function O(G){const te=G.account_group_id?l[G.account_group_id]:void 0;return te&&te.on_budget!==null?te.on_budget:G.on_budget!==!1}const P=Object.entries(o).filter(([,G])=>H(G)&&O(G)),N=P.filter(([,G])=>G.is_income_account),V=N.length>0?N:P,$=P.find(([,G])=>G.is_income_default),A=$?$[0]:void 0,k=u?.income.reduce((G,te)=>G+te.amount,0)||0;function D(G,te,Q,se,B){if(!t)return;w(null),S(!1);const{year:q,month:ee}=Em(Q);(q!==e||ee!==n)&&(r(q),i(ee)),f(t,q,ee,G,te,Q,se,B).catch(ne=>{w(ne instanceof Error?ne.message:"Failed to add income")})}function K(G,te,Q,se,B,q){t&&(w(null),T(null),p(t,e,n,G,te,Q,se,B,q).catch(ee=>{w(ee instanceof Error?ee.message:"Failed to update income")}))}function X(G){t&&confirm("Are you sure you want to delete this income entry?")&&(w(null),g(t,e,n,G).catch(te=>{w(te instanceof Error?te.message:"Failed to delete income")}))}return d.jsxs("div",{style:{opacity:h?.5:1,transition:"opacity 0.15s ease-out",pointerEvents:h?"none":"auto"},children:[_&&d.jsx("div",{style:{background:`color-mix(in srgb, ${me.error} 15%, transparent)`,border:`1px solid ${me.error}`,borderRadius:"8px",padding:"0.75rem",marginBottom:"1rem",color:me.error},children:_}),d.jsxs("div",{style:{display:"grid",gridTemplateColumns:b?"1fr":"5rem 1.5fr 2fr 7rem 1.5fr 3rem"},children:[d.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"var(--sticky-header-bg)",borderBottom:"1px solid var(--border-medium)",display:b?"block":"grid",gridTemplateColumns:b?void 0:"subgrid"},children:[d.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem"},children:[d.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[d.jsx("span",{style:{fontWeight:600},children:"Income:"}),d.jsx("span",{style:{opacity:.6,fontSize:"0.8rem"},children:"Incoming money that should be factored into income calculations"}),d.jsxs("span",{children:[d.jsx("span",{style:{opacity:.6},children:"Total: "}),d.jsx("span",{style:{color:et(k),fontWeight:600},children:Jt(k)})]})]}),d.jsx("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:!x&&d.jsx(qe,{actionName:"Open Add Income Form",onClick:()=>S(!0),disabled:V.length===0,disabledReason:Object.keys(o).length===0?"Create an account first":"Set up an income account first",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:"+ Add Income"})})]}),!b&&d.jsxs(d.Fragment,{children:[d.jsx("div",{style:Vl,children:"Date"}),d.jsx("div",{style:Vl,children:"Payee"}),d.jsx("div",{style:Vl,children:"Account"}),d.jsx("div",{style:{...Vl,textAlign:"right"},children:"Amount"}),d.jsx("div",{style:Vl,children:"Description"}),d.jsx("div",{style:Vl})]})]}),d.jsx("div",{style:{gridColumn:"1 / -1",fontSize:"0.8rem",opacity:.55,fontStyle:"italic",padding:"0.5rem 0"},children:" All income entries on this page count towards the tithing owed calculation."}),V.length===0&&d.jsx(id,{message:Object.keys(o).length===0?"You need to create at least one account before adding income.":'No accounts are set up for income deposits. Edit an account and enable "Show in income deposit list".',linkText:"Manage accounts",linkTo:"/budget/settings/accounts"}),x&&d.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"1rem"},children:d.jsx(i1,{accounts:V,accountGroups:l,payees:U,defaultAccountId:A,defaultDate:Sm(e,n),onSubmit:D,onCancel:()=>S(!1),submitLabel:"Add Income",isMobile:b})}),u?.income.slice().sort((G,te)=>(G.date||"").localeCompare(te.date||"")).map((G,te)=>C===G.id?d.jsx("div",{style:{gridColumn:"1 / -1",padding:"0.5rem"},children:d.jsx(i1,{accounts:V,accountGroups:l,payees:U,initialData:G,onSubmit:(Q,se,B,q,ee)=>K(G.id,Q,se,B,q,ee),onCancel:()=>T(null),onDelete:()=>X(G.id),submitLabel:"Save",isMobile:b})},G.id):d.jsx(R4,{income:G,accountName:rt(G.account_id)?$a:o[G.account_id]?.nickname||"Unknown Account",accountGroupName:rt(G.account_id)?void 0:o[G.account_id]?.account_group_id?l[o[G.account_id].account_group_id]?.name:void 0,onEdit:()=>{G.payee||`${G.amount}`,T(G.id)},onDelete:()=>X(G.id),isMobile:b,isEvenRow:te%2===0},G.id)),(!u?.income||u.income.length===0)&&!x&&d.jsx("p",{style:{gridColumn:"1 / -1",opacity:.5,fontSize:"0.9rem",textAlign:"center",padding:"1.5rem"},children:"No income recorded for this month"}),d.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]})]})}function a1({accounts:t,accountGroups:e,categories:n,categoryGroups:r,payees:i,initialData:o,defaultAccountId:l,defaultDate:u,onSubmit:h,onCancel:f,onDelete:p,submitLabel:g}){function b(_){h(_.amount,_.categoryId,_.accountId,_.date,_.payee,_.description,_.cleared)}return d.jsx(m_,{accounts:t,accountGroups:e,categories:n,categoryGroups:r,payees:i,initialData:o?{date:o.date,payee:o.payee,categoryId:o.category_id,accountId:o.account_id,amount:o.amount,description:o.description,cleared:o.cleared}:void 0,defaultAccountId:l,defaultDate:u,config:{showCategory:!0,showCleared:!0,showNoCategoryOption:!1,showNoAccountOption:!1,showSignToggle:!0,accountLabel:"Pay From",payeePlaceholder:"e.g., Grocery Store",descriptionPlaceholder:"e.g., Weekly groceries",submitLabel:g},onSubmit:b,onCancel:f,onDelete:p})}function D4({expense:t,categoryName:e,accountName:n,accountGroupName:r,onEdit:i,onDelete:o,isMobile:l,isEvenRow:u}){const h=t.date?new Date(t.date+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"}):"",f=r?`${r} / ${n}`:n,p=u?"transparent":"var(--row-alt-bg)";if(l)return d.jsxs("div",{onClick:i,style:{gridColumn:"1 / -1",display:"grid",gridTemplateColumns:"1fr auto",gap:"0.5rem",padding:"0.75rem 1rem",background:p,cursor:"pointer",transition:"background 0.15s"},children:[d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[d.jsx("span",{style:{fontSize:"0.75rem",opacity:.5,fontFamily:"monospace",minWidth:"3rem"},children:h}),d.jsx("span",{style:{fontWeight:500,fontSize:"0.9rem"},children:t.payee||""}),t.cleared&&d.jsx("span",{style:{fontSize:"0.7rem",color:me.success},title:"Cleared",children:""})]}),d.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap"},children:[d.jsx("span",{style:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px"},children:e}),d.jsxs("span",{style:{fontSize:"0.75rem",opacity:.6},children:[" ",f]})]})]}),d.jsx("div",{style:{display:"flex",alignItems:"center"},children:d.jsx("span",{style:{fontWeight:600,color:et(t.amount),fontFamily:"monospace"},children:Qt(t.amount)})})]});const g={padding:"0.6rem 0.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem"};return d.jsxs("div",{style:{gridColumn:"1 / -1",background:p,display:"grid",gridTemplateColumns:"5rem 1.5fr 7rem 1fr 6rem 1fr 3rem 4rem"},children:[d.jsx("div",{style:{...g,fontSize:"0.85rem",fontFamily:"monospace"},children:d.jsx("span",{style:{opacity:.6},children:h})}),d.jsx("div",{style:{...g,fontWeight:500,overflow:"hidden"},children:d.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.payee||""})}),d.jsx("div",{style:{...g,justifyContent:"center"},children:d.jsx("span",{style:{fontSize:"0.8rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e})}),d.jsx("div",{style:{...g,overflow:"hidden"},children:d.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.85rem",opacity:.7},children:f})}),d.jsx("div",{style:{...g,justifyContent:"flex-end",fontWeight:600,color:et(t.amount),fontFamily:"monospace"},children:Qt(t.amount)}),d.jsx("div",{style:{...g,paddingLeft:"0.5rem",overflow:"hidden"},children:d.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.8rem",opacity:.6},children:t.description||""})}),d.jsx("div",{style:{...g,justifyContent:"center",color:t.cleared?me.success:"inherit",opacity:t.cleared?1:.3,fontSize:"1rem"},children:t.cleared?"":""}),d.jsxs("div",{style:{...g,justifyContent:"flex-end",gap:"0.25rem"},children:[d.jsx("button",{onClick:i,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:b=>b.currentTarget.style.opacity="1",onMouseLeave:b=>b.currentTarget.style.opacity="0.5",title:"Edit",children:""}),d.jsx("button",{onClick:o,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:b=>b.currentTarget.style.opacity="1",onMouseLeave:b=>b.currentTarget.style.opacity="0.5",title:"Delete",children:""})]})]})}const ba={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderTop:"1px solid var(--border-subtle)"};function k4(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n,setCurrentYear:r,setCurrentMonthNumber:i}=Ye(),{accounts:o,accountGroups:l,categories:u,categoryGroups:h}=Dn(),{month:f,isLoading:p}=Xs(t,e,n),{addExpense:g}=yz(),{updateExpense:b}=bz(),{deleteExpense:_}=vz(),w=Li(),[x,S]=R.useState(null),[C,T]=R.useState(!1),[I,M]=R.useState(null),O=e_(t,{enabled:C||I!==null}).data||[];function P(Q){const se=Q.account_group_id?l[Q.account_group_id]:void 0;return se&&se.is_active!==null?se.is_active:Q.is_active!==!1}function N(Q){const se=Q.account_group_id?l[Q.account_group_id]:void 0;return se&&se.on_budget!==null?se.on_budget:Q.on_budget!==!1}const V=Object.entries(o).filter(([,Q])=>P(Q)&&N(Q)),$=V.filter(([,Q])=>Q.is_outgo_account),A=$.length>0?$:V,k=V.find(([,Q])=>Q.is_outgo_default),D=k?k[0]:void 0,K=f?.expenses?.reduce((Q,se)=>Q+se.amount,0)||0;function X(Q,se,B,q,ee,ne,le){if(!t)return;S(null),T(!1);const{year:he,month:Ee}=Em(q);(he!==e||Ee!==n)&&(r(he),i(Ee)),g(t,he,Ee,Q,se,B,q,ee,ne,le).catch(ae=>{S(ae instanceof Error?ae.message:"Failed to add expense")})}function G(Q,se,B,q,ee,ne,le,he){t&&(S(null),M(null),b(t,e,n,Q,se,B,q,ee,ne,le,he).catch(Ee=>{S(Ee instanceof Error?Ee.message:"Failed to update expense")}))}function te(Q){t&&confirm("Are you sure you want to delete this expense?")&&(S(null),_(t,e,n,Q).catch(se=>{S(se instanceof Error?se.message:"Failed to delete expense")}))}return d.jsxs("div",{style:{opacity:p?.5:1,transition:"opacity 0.15s ease-out",pointerEvents:p?"none":"auto"},children:[x&&d.jsx("div",{style:{background:`color-mix(in srgb, ${me.error} 15%, transparent)`,border:`1px solid ${me.error}`,borderRadius:"8px",padding:"0.75rem",marginBottom:"1rem",color:me.error},children:x}),d.jsxs("div",{style:{display:"grid",gridTemplateColumns:w?"1fr":"5rem 1.5fr 7rem 1fr 6rem 1fr 3rem 4rem"},children:[d.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"var(--sticky-header-bg)",borderBottom:"1px solid var(--border-medium)",display:w?"block":"grid",gridTemplateColumns:w?void 0:"subgrid"},children:[d.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem"},children:[d.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[d.jsx("span",{style:{fontWeight:600},children:"Expenses:"}),d.jsx("span",{style:{opacity:.6,fontSize:"0.8rem"},children:"Transactions that should be factored into spend calculations"}),d.jsxs("span",{children:[d.jsx("span",{style:{opacity:.6},children:"Total: "}),d.jsx("span",{style:{color:et(K),fontWeight:600},children:Qt(K)})]})]}),d.jsx("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:!C&&d.jsx(qe,{actionName:"Open Add Expense Form",onClick:()=>T(!0),disabled:A.length===0||Object.keys(u).length===0,disabledReason:A.length===0&&Object.keys(u).length===0?"Create accounts and categories first":A.length===0?"Create an expense account first":"Create a category first",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:"+ Add Expense"})})]}),!w&&d.jsxs(d.Fragment,{children:[d.jsx("div",{style:ba,children:"Date"}),d.jsx("div",{style:ba,children:"Payee"}),d.jsx("div",{style:{...ba,textAlign:"center"},children:"Category"}),d.jsx("div",{style:ba,children:"Account"}),d.jsx("div",{style:{...ba,textAlign:"right"},children:"Amount"}),d.jsx("div",{style:ba,children:"Description"}),d.jsx("div",{style:{...ba,textAlign:"center"},children:"Clr"}),d.jsx("div",{style:ba})]})]}),A.length===0&&d.jsx(id,{message:Object.keys(o).length===0?"You need to create at least one account before adding expenses.":'No accounts are set up for expenses. Edit an account and enable "Show in expense list".',linkText:"Manage accounts",linkTo:"/budget/settings/accounts"}),Object.keys(u).length===0&&d.jsx(id,{message:"You need to create at least one category before adding expenses.",linkText:"Create categories",linkTo:"/budget/settings/categories"}),C&&d.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"1rem"},children:d.jsx(a1,{accounts:A,accountGroups:l,categories:u,categoryGroups:h,payees:O,defaultAccountId:D,defaultDate:Sm(e,n),onSubmit:X,onCancel:()=>T(!1),submitLabel:"Add Expense",isMobile:w})}),f?.expenses?.slice().sort((Q,se)=>(Q.date||"").localeCompare(se.date||"")).map((Q,se)=>I===Q.id?d.jsx("div",{style:{gridColumn:"1 / -1",padding:"0.5rem"},children:d.jsx(a1,{accounts:A,accountGroups:l,categories:u,categoryGroups:h,payees:O,initialData:Q,onSubmit:(B,q,ee,ne,le,he,Ee)=>G(Q.id,B,q,ee,ne,le,he,Ee),onCancel:()=>M(null),onDelete:()=>te(Q.id),submitLabel:"Save",isMobile:w})},Q.id):d.jsx(D4,{expense:Q,categoryName:ct(Q.category_id)?qo:u[Q.category_id]?.name||"Unknown Category",accountName:rt(Q.account_id)?$a:o[Q.account_id]?.nickname||"Unknown Account",accountGroupName:rt(Q.account_id)?void 0:o[Q.account_id]?.account_group_id?l[o[Q.account_id].account_group_id]?.name:void 0,onEdit:()=>{Q.payee||`${Q.amount}`,M(Q.id)},onDelete:()=>te(Q.id),isMobile:w,isEvenRow:se%2===0},Q.id)),(!f?.expenses||f.expenses.length===0)&&!C&&d.jsx("p",{style:{gridColumn:"1 / -1",opacity:.5,fontSize:"0.9rem",textAlign:"center",padding:"1.5rem"},children:"No expenses recorded for this month"}),d.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]})]})}const M4={background:me.primary,border:"none",cursor:"pointer",fontSize:"0.9rem",padding:"0.35rem 0.5rem",borderRadius:"4px",color:"white"},O4={background:"transparent",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)",cursor:"pointer",fontSize:"0.9rem",padding:"0.35rem 0.5rem",borderRadius:"4px"},N4={background:"transparent",border:`1px solid ${me.errorBorder}`,color:me.error,cursor:"pointer",fontSize:"0.9rem",padding:"0.35rem 0.5rem",borderRadius:"4px"};function o1({accounts:t,accountGroups:e,categories:n,categoryGroups:r,initialData:i,defaultDate:o,onSubmit:l,onCancel:u,onDelete:h,submitLabel:f}){const{isWide:p}=tA(),g=new Date().toISOString().split("T")[0],[b,_]=R.useState(i?.date||o||g),[w,x]=R.useState(i?.amount?.toString()||""),[S,C]=R.useState(i?.from_account_id||Gt),[T,I]=R.useState(i?.to_account_id||Gt),[M,U]=R.useState(i?.from_category_id||Zt),[H,O]=R.useState(i?.to_category_id||Zt),[P,N]=R.useState(i?.description||""),[V,$]=R.useState(i?.cleared||!1),[A,k]=R.useState(null),D=M===Zt,K=H===Zt,X=S===Gt,G=T===Gt;function te(){return D&&K&&(X&&G)?'A transfer must move between real categories or real accounts  not all "No" options.':X!==G?'Both accounts must be real accounts, or both must be "No Account". Cannot transfer from a real account to nothing.':D!==K?'Both categories must be real categories, or both must be "No Category". Cannot transfer from a real category to nothing.':null}te()===null&&A!==null&&k(null);function se(ae){ae.preventDefault();const fe=parseFloat(w);if(isNaN(fe)||fe<=0||!S||!T||!M||!H||!b)return;const Me=te();if(Me){k(Me);return}k(null),l(fe,S,T,M,H,b,P.trim()||void 0,V)}const B=A?d.jsx("div",{style:{background:`color-mix(in srgb, ${me.error} 15%, transparent)`,border:`1px solid ${me.errorBorder}`,borderRadius:"6px",padding:"0.5rem 0.75rem",fontSize:"0.85rem",color:me.error,marginTop:"0.5rem"},children:A}):null,q=(ae,fe,Me,Ne)=>d.jsx(Bt,{label:Ne,htmlFor:ae,children:d.jsx(eA,{id:ae,value:fe,onChange:Me,accounts:t,accountGroups:e,placeholder:$a,required:!0,showNoAccountOption:!0})}),ee=(ae,fe,Me,Ne)=>d.jsx(Bt,{label:Ne,htmlFor:ae,children:d.jsx(JT,{id:ae,value:fe,onChange:Me,categories:n,categoryGroups:r,placeholder:qo,required:!0,showNoCategoryOption:!0})}),ne=d.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.25rem",paddingBottom:"0.35rem"},children:[d.jsx("label",{htmlFor:"transfer-cleared",style:{fontSize:"0.75rem",opacity:.7,fontWeight:500},children:"Clr"}),d.jsx(Xr,{id:"transfer-cleared",checked:V,onChange:ae=>$(ae.target.checked)})]}),le=d.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.25rem",paddingBottom:"0.1rem"},children:[d.jsx("span",{style:{fontSize:"0.75rem",opacity:.7,fontWeight:500},children:""}),d.jsxs("div",{style:{display:"flex",gap:"0.25rem"},children:[d.jsx("button",{type:"submit",title:f,style:M4,children:""}),d.jsx("button",{type:"button",onClick:()=>{u()},title:"Cancel",style:O4,children:""}),h&&d.jsx("button",{type:"button",onClick:()=>{h()},title:"Delete",style:N4,children:""})]})]}),he=d.jsxs(Ya,{children:[d.jsx(qe,{type:"submit",actionName:f,children:f}),d.jsx(qe,{type:"button",variant:"secondary",actionName:"Cancel Transfer Form",onClick:u,children:"Cancel"}),h&&d.jsx(qe,{type:"button",variant:"danger",actionName:"Delete Transfer",onClick:h,children:" Delete"})]}),Ee={fontSize:"0.85rem",padding:"0.5rem"};return p?d.jsx(Ni,{actionName:f,onSubmit:se,children:d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[d.jsxs("div",{style:{display:"grid",gridTemplateColumns:"5.5rem 5.5rem 1fr 1fr 1.5fr",gap:"0.75rem",alignItems:"end"},children:[d.jsx(Bt,{label:"Date",htmlFor:"transfer-date",children:d.jsx(Gf,{id:"transfer-date",value:b,onChange:ae=>_(ae.target.value),required:!0,style:Ee,autoFocus:!0})}),d.jsx(Bt,{label:"Amount",htmlFor:"transfer-amount",children:d.jsx(No,{id:"transfer-amount",value:w,onChange:x,placeholder:"$0.00",required:!0})}),ee("from-category",M,U,"From Category"),q("from-account",S,C,"From Account"),d.jsx(Bt,{label:"Description",htmlFor:"transfer-description",children:d.jsx(Pi,{id:"transfer-description",value:P,onChange:ae=>N(ae.target.value),placeholder:"e.g., Transfer",style:Ee})})]}),d.jsxs("div",{style:{display:"grid",gridTemplateColumns:"5.5rem 5.5rem 1fr 1fr 1.5fr",gap:"0.75rem",alignItems:"end"},children:[d.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1.2rem",opacity:.5,paddingBottom:"0.5rem"},children:""}),d.jsx("div",{}),ee("to-category",H,O,"To Category"),q("to-account",T,I,"To Account"),d.jsxs("div",{style:{display:"flex",gap:"0.75rem",alignItems:"end",paddingBottom:"0.25rem"},children:[ne,le]})]}),B]})}):d.jsxs(Ni,{actionName:f,onSubmit:se,children:[d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:[d.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[d.jsx(Bt,{label:"Date",htmlFor:"transfer-date",children:d.jsx(Gf,{id:"transfer-date",value:b,onChange:ae=>_(ae.target.value),required:!0,autoFocus:!0})}),d.jsx(Bt,{label:"Amount",htmlFor:"transfer-amount",children:d.jsx(No,{id:"transfer-amount",value:w,onChange:x,placeholder:"$0.00",required:!0})})]}),d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem",background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1rem",borderRadius:"8px"},children:[d.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"0.75rem",alignItems:"end"},children:[ee("from-category",M,U,"From Cat."),q("from-account",S,C,"From Acct.")]}),d.jsx("div",{style:{display:"flex",justifyContent:"center",fontSize:"1.5rem",opacity:.5},children:""}),d.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"0.75rem",alignItems:"end"},children:[ee("to-category",H,O,"To Cat."),q("to-account",T,I,"To Acct.")]})]}),d.jsx(Bt,{label:"Description (optional)",htmlFor:"transfer-description",children:d.jsx(Pi,{id:"transfer-description",value:P,onChange:ae=>N(ae.target.value),placeholder:"e.g., Transfer to savings"})}),d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[d.jsx(Xr,{id:"transfer-cleared-stacked",checked:V,onChange:ae=>$(ae.target.checked)}),d.jsx("label",{htmlFor:"transfer-cleared-stacked",style:{fontSize:"0.9rem",cursor:"pointer"},children:"Cleared (appeared in bank account)"})]}),B]}),he]})}function P4({transfer:t,fromCategoryName:e,toCategoryName:n,fromAccountName:r,toAccountName:i,fromAccountGroupName:o,toAccountGroupName:l,isFromCategoryNo:u,isToCategoryNo:h,isFromAccountNo:f,isToAccountNo:p,onEdit:g,onDelete:b,isMobile:_,isEvenRow:w}){const x=t.date?new Date(t.date+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"}):"",S=w?"transparent":"var(--row-alt-bg)";if(_)return d.jsxs("div",{onClick:g,style:{gridColumn:"1 / -1",display:"flex",flexDirection:"column",gap:"0.5rem",padding:"0.75rem 1rem",background:S,cursor:"pointer",transition:"background 0.15s"},children:[d.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[d.jsx("span",{style:{fontSize:"0.75rem",opacity:.5,fontFamily:"monospace",minWidth:"3rem"},children:x}),d.jsx("span",{style:{fontWeight:600,opacity:.8,fontFamily:"monospace"},children:Jt(t.amount)}),t.cleared&&d.jsx("span",{style:{fontSize:"0.7rem",color:me.success},title:"Cleared",children:""})]})}),d.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto 1fr",gap:"0.5rem",alignItems:"center"},children:[d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[d.jsx("span",{style:u?{fontSize:"0.7rem",opacity:.4}:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px",display:"inline-block",width:"fit-content"},children:e}),f?d.jsx("span",{style:{fontSize:"0.75rem",opacity:.4},children:r}):d.jsxs("div",{style:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px",display:"inline-flex",flexDirection:"column",gap:"0.1rem",width:"fit-content"},children:[o&&d.jsx("span",{style:{fontSize:"0.65rem",opacity:.6},children:o}),d.jsx("span",{children:r})]})]}),d.jsx("span",{style:{opacity:.5},children:""}),d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[d.jsx("span",{style:h?{fontSize:"0.7rem",opacity:.4}:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px",display:"inline-block",width:"fit-content"},children:n}),p?d.jsx("span",{style:{fontSize:"0.75rem",opacity:.4},children:i}):d.jsxs("div",{style:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px",display:"inline-flex",flexDirection:"column",gap:"0.1rem",width:"fit-content"},children:[l&&d.jsx("span",{style:{fontSize:"0.65rem",opacity:.6},children:l}),d.jsx("span",{children:i})]})]})]}),t.description&&d.jsx("div",{style:{fontSize:"0.75rem",opacity:.6},children:t.description})]});const C={padding:"0.6rem 0.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem"};return d.jsxs("div",{style:{gridColumn:"1 / -1",background:S,display:"grid",gridTemplateColumns:"5rem 6rem 1fr 1fr 2rem 1fr 1fr 1fr 3rem 4rem"},children:[d.jsx("div",{style:{...C,fontSize:"0.85rem",fontFamily:"monospace"},children:d.jsx("span",{style:{opacity:.6},children:x})}),d.jsx("div",{style:{...C,justifyContent:"flex-end",fontWeight:600,opacity:.8,fontFamily:"monospace"},children:Jt(t.amount)}),d.jsx("div",{style:{...C,justifyContent:"center"},children:d.jsx("span",{style:u?{fontSize:"0.8rem",opacity:.4}:{fontSize:"0.8rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e})}),d.jsx("div",{style:{...C,overflow:"hidden"},children:f?d.jsx("span",{style:{opacity:.4,fontSize:"0.85rem"},children:r}):d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.1rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden"},children:[o&&d.jsx("span",{style:{fontSize:"0.7rem",opacity:.6,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:o}),d.jsx("span",{style:{fontSize:"0.8rem",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:r})]})}),d.jsx("div",{style:{...C,justifyContent:"center",fontSize:"1rem"},children:d.jsx("span",{style:{opacity:.5},children:""})}),d.jsx("div",{style:{...C,justifyContent:"center"},children:d.jsx("span",{style:h?{fontSize:"0.8rem",opacity:.4}:{fontSize:"0.8rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:n})}),d.jsx("div",{style:{...C,overflow:"hidden"},children:p?d.jsx("span",{style:{opacity:.4,fontSize:"0.85rem"},children:i}):d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.1rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden"},children:[l&&d.jsx("span",{style:{fontSize:"0.7rem",opacity:.6,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:l}),d.jsx("span",{style:{fontSize:"0.8rem",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:i})]})}),d.jsx("div",{style:{...C,paddingLeft:"0.5rem",overflow:"hidden"},children:d.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.8rem",opacity:.6},children:t.description||""})}),d.jsx("div",{style:{...C,justifyContent:"center",color:t.cleared?me.success:"inherit",opacity:t.cleared?1:.3,fontSize:"1rem"},children:t.cleared?"":""}),d.jsxs("div",{style:{...C,justifyContent:"flex-end",gap:"0.25rem"},children:[d.jsx("button",{onClick:g,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:T=>T.currentTarget.style.opacity="1",onMouseLeave:T=>T.currentTarget.style.opacity="0.5",title:"Edit",children:""}),d.jsx("button",{onClick:b,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:T=>T.currentTarget.style.opacity="1",onMouseLeave:T=>T.currentTarget.style.opacity="0.5",title:"Delete",children:""})]})]})}const Ls={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderTop:"1px solid var(--border-subtle)"};function B4(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n,setCurrentYear:r,setCurrentMonthNumber:i}=Ye(),{accounts:o,accountGroups:l,categories:u,categoryGroups:h}=Dn(),{month:f,isLoading:p}=Xs(t,e,n),{addTransfer:g}=wz(),{updateTransfer:b}=Ez(),{deleteTransfer:_}=Cz(),w=Li(),[x,S]=R.useState(null),[C,T]=R.useState(!1),[I,M]=R.useState(null);function U(A){const k=A.account_group_id?l[A.account_group_id]:void 0;return k&&k.is_active!==null?k.is_active:A.is_active!==!1}function H(A){const k=A.account_group_id?l[A.account_group_id]:void 0;return k&&k.on_budget!==null?k.on_budget:A.on_budget!==!1}const O=Object.entries(o).filter(([,A])=>U(A)&&H(A));function P(A,k,D,K,X,G,te,Q){if(!t)return;S(null),T(!1);const{year:se,month:B}=Em(G);(se!==e||B!==n)&&(r(se),i(B)),g(t,se,B,A,k,D,K,X,G,te,Q).catch(q=>{S(q instanceof Error?q.message:"Failed to add transfer")})}function N(A,k,D,K,X,G,te,Q,se){t&&(S(null),M(null),b(t,e,n,A,k,D,K,X,G,te,Q,se).catch(B=>{S(B instanceof Error?B.message:"Failed to update transfer")}))}function V(A){t&&confirm("Are you sure you want to delete this transfer?")&&(S(null),_(t,e,n,A).catch(k=>{S(k instanceof Error?k.message:"Failed to delete transfer")}))}const $=O.length>=1&&Object.keys(u).length>=1;return d.jsxs("div",{style:{opacity:p?.5:1,transition:"opacity 0.15s ease-out",pointerEvents:p?"none":"auto"},children:[x&&d.jsx("div",{style:{background:`color-mix(in srgb, ${me.error} 15%, transparent)`,border:`1px solid ${me.error}`,borderRadius:"8px",padding:"0.75rem",marginBottom:"1rem",color:me.error},children:x}),d.jsxs("div",{style:{display:"grid",gridTemplateColumns:w?"1fr":"5rem 6rem 1fr 1fr 2rem 1fr 1fr 1fr 3rem 4rem"},children:[d.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"var(--sticky-header-bg)",borderBottom:"1px solid var(--border-medium)",display:w?"block":"grid",gridTemplateColumns:w?void 0:"subgrid"},children:[d.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem"},children:[d.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[d.jsx("span",{style:{fontWeight:600},children:"Transfers:"}),d.jsx("span",{style:{opacity:.6,fontSize:"0.8rem"},children:"Moving money between accounts and categories within the budget"})]}),d.jsx("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:!C&&d.jsx(qe,{actionName:"Open Add Transfer Form",onClick:()=>T(!0),disabled:!$,disabledReason:O.length===0&&Object.keys(u).length===0?"Create accounts and categories first":O.length===0?"Create an account first":"Create a category first",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:"+ Add Transfer"})})]}),!w&&d.jsxs(d.Fragment,{children:[d.jsx("div",{style:Ls,children:"Date"}),d.jsx("div",{style:{...Ls,textAlign:"right"},children:"Amount"}),d.jsx("div",{style:{...Ls,textAlign:"center"},children:"From Cat"}),d.jsx("div",{style:Ls,children:"From Acct"}),d.jsx("div",{style:Ls}),d.jsx("div",{style:{...Ls,textAlign:"center"},children:"To Cat"}),d.jsx("div",{style:Ls,children:"To Acct"}),d.jsx("div",{style:Ls,children:"Description"}),d.jsx("div",{style:{...Ls,textAlign:"center"},children:"Clr"}),d.jsx("div",{style:Ls})]})]}),!$&&d.jsx(id,{message:"You need at least one account and one category before adding transfers.",linkText:"Manage accounts",linkTo:"/budget/settings/accounts"}),C&&d.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"1rem"},children:d.jsx(o1,{accounts:O,accountGroups:l,categories:u,categoryGroups:h,defaultDate:Sm(e,n),onSubmit:P,onCancel:()=>T(!1),submitLabel:"Add Transfer"})}),f?.transfers?.slice().sort((A,k)=>(A.date||"").localeCompare(k.date||"")).map((A,k)=>I===A.id?d.jsx("div",{style:{gridColumn:"1 / -1",padding:"0.5rem"},children:d.jsx(o1,{accounts:O,accountGroups:l,categories:u,categoryGroups:h,initialData:A,onSubmit:(D,K,X,G,te,Q,se,B)=>N(A.id,D,K,X,G,te,Q,se,B),onCancel:()=>M(null),onDelete:()=>V(A.id),submitLabel:"Save"})},A.id):d.jsx(P4,{transfer:A,fromCategoryName:ct(A.from_category_id)?qo:u[A.from_category_id]?.name||"Unknown",toCategoryName:ct(A.to_category_id)?qo:u[A.to_category_id]?.name||"Unknown",fromAccountName:rt(A.from_account_id)?$a:o[A.from_account_id]?.nickname||"Unknown",toAccountName:rt(A.to_account_id)?$a:o[A.to_account_id]?.nickname||"Unknown",fromAccountGroupName:rt(A.from_account_id)?void 0:o[A.from_account_id]?.account_group_id?l[o[A.from_account_id].account_group_id]?.name:void 0,toAccountGroupName:rt(A.to_account_id)?void 0:o[A.to_account_id]?.account_group_id?l[o[A.to_account_id].account_group_id]?.name:void 0,isFromCategoryNo:ct(A.from_category_id),isToCategoryNo:ct(A.to_category_id),isFromAccountNo:rt(A.from_account_id),isToAccountNo:rt(A.to_account_id),onEdit:()=>{A.description||`${A.amount}`,M(A.id)},onDelete:()=>V(A.id),isMobile:w,isEvenRow:k%2===0},A.id)),(!f?.transfers||f.transfers.length===0)&&!C&&d.jsx("p",{style:{gridColumn:"1 / -1",opacity:.5,fontSize:"0.9rem",textAlign:"center",padding:"1.5rem"},children:"No transfers recorded for this month"}),d.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]})]})}function l1({accounts:t,accountGroups:e,categories:n,categoryGroups:r,payees:i,initialData:o,defaultAccountId:l,defaultDate:u,onSubmit:h,onCancel:f,onDelete:p,submitLabel:g}){function b(_){h(_.amount,_.accountId,_.categoryId,_.date,_.payee,_.description,_.cleared)}return d.jsx(m_,{accounts:t,accountGroups:e,categories:n,categoryGroups:r,payees:i,initialData:o?{date:o.date,payee:o.payee,categoryId:o.category_id,accountId:o.account_id,amount:o.amount,description:o.description,cleared:o.cleared}:void 0,defaultAccountId:l,defaultDate:u,config:{showCategory:!0,showCleared:!0,showNoCategoryOption:!0,showNoAccountOption:!0,showSignToggle:!0,accountLabel:"Account",payeePlaceholder:"e.g., Bank, Interest source",descriptionPlaceholder:"e.g., Starting balance, Correction",submitLabel:g},onSubmit:b,onCancel:f,onDelete:p})}function z4({adjustment:t,categoryName:e,accountName:n,accountGroupName:r,onEdit:i,onDelete:o,isMobile:l,isEvenRow:u}){const h=t.date?new Date(t.date+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"}):"",f=r?`${r} / ${n}`:n,p=u?"transparent":"var(--row-alt-bg)";if(l)return d.jsxs("div",{onClick:i,style:{gridColumn:"1 / -1",display:"flex",flexDirection:"column",gap:"0.25rem",padding:"0.75rem 1rem",background:p,cursor:"pointer",transition:"background 0.15s"},children:[d.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[d.jsx("span",{style:{fontSize:"0.75rem",opacity:.5,fontFamily:"monospace"},children:h}),t.cleared&&d.jsx("span",{style:{fontSize:"0.7rem",color:me.success},title:"Cleared",children:""})]}),d.jsx("span",{style:{fontWeight:600,color:et(t.amount),fontFamily:"monospace"},children:Qt(t.amount)})]}),d.jsx("div",{style:{fontWeight:500,fontSize:"0.9rem"},children:t.description||"Adjustment"}),d.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap",alignItems:"center"},children:[d.jsx("span",{style:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px"},children:e}),d.jsx("span",{style:{fontSize:"0.75rem",opacity:.6},children:f})]})]});const g={padding:"0.6rem 0.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem"};return d.jsxs("div",{style:{gridColumn:"1 / -1",background:p,display:"grid",gridTemplateColumns:"5rem 1.5fr 7rem 1fr 6rem 1fr 3rem 4rem"},children:[d.jsx("div",{style:{...g,fontSize:"0.85rem",fontFamily:"monospace"},children:d.jsx("span",{style:{opacity:.6},children:h})}),d.jsx("div",{style:{...g,justifyContent:"center"},children:d.jsx("span",{style:{fontSize:"0.8rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e})}),d.jsx("div",{style:{...g,overflow:"hidden"},children:d.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.85rem",opacity:.7},children:f})}),d.jsx("div",{style:{...g,justifyContent:"flex-end",fontWeight:600,color:et(t.amount),fontFamily:"monospace"},children:Qt(t.amount)}),d.jsx("div",{style:{...g,paddingLeft:"0.5rem",overflow:"hidden"},children:d.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.8rem",opacity:.6},children:t.description||""})}),d.jsx("div",{style:{...g,justifyContent:"center",color:t.cleared?me.success:"inherit",opacity:t.cleared?1:.3,fontSize:"1rem"},children:t.cleared?"":""}),d.jsxs("div",{style:{...g,justifyContent:"flex-end",gap:"0.25rem"},children:[d.jsx("button",{onClick:i,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:b=>b.currentTarget.style.opacity="1",onMouseLeave:b=>b.currentTarget.style.opacity="0.5",title:"Edit",children:""}),d.jsx("button",{onClick:o,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:b=>b.currentTarget.style.opacity="1",onMouseLeave:b=>b.currentTarget.style.opacity="0.5",title:"Delete",children:""})]})]})}const Ro={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderTop:"1px solid var(--border-subtle)"};function L4(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n,setCurrentYear:r,setCurrentMonthNumber:i}=Ye(),{accounts:o,accountGroups:l,categories:u,categoryGroups:h}=Dn(),{month:f,isLoading:p}=Xs(t,e,n),{addAdjustment:g}=Az(),{updateAdjustment:b}=Rz(),{deleteAdjustment:_}=Iz(),w=Li(),[x,S]=R.useState(null),[C,T]=R.useState(!1),[I,M]=R.useState(null),O=e_(t,{enabled:C||I!==null}).data||[];function P(D){const K=D.account_group_id?l[D.account_group_id]:void 0;return K&&K.is_active!==null?K.is_active:D.is_active!==!1}function N(D){const K=D.account_group_id?l[D.account_group_id]:void 0;return K&&K.on_budget!==null?K.on_budget:D.on_budget!==!1}const V=Object.entries(o).filter(([,D])=>P(D)&&N(D));function $(D,K,X,G,te,Q,se){if(!t)return;S(null),T(!1);const{year:B,month:q}=Em(G);(B!==e||q!==n)&&(r(B),i(q)),g(t,B,q,D,K,X,G,te,Q,se).catch(ee=>{S(ee instanceof Error?ee.message:"Failed to add adjustment")})}function A(D,K,X,G,te,Q,se,B){t&&(S(null),M(null),b(t,e,n,D,K,X,G,te,Q,se,B).catch(q=>{S(q instanceof Error?q.message:"Failed to update adjustment")}))}function k(D){t&&confirm("Are you sure you want to delete this adjustment?")&&(S(null),_(t,e,n,D).catch(K=>{S(K instanceof Error?K.message:"Failed to delete adjustment")}))}return d.jsxs("div",{style:{opacity:p?.5:1,transition:"opacity 0.15s ease-out",pointerEvents:p?"none":"auto"},children:[x&&d.jsx("div",{style:{background:`color-mix(in srgb, ${me.error} 15%, transparent)`,border:`1px solid ${me.error}`,borderRadius:"8px",padding:"0.75rem",marginBottom:"1rem",color:me.error},children:x}),d.jsxs("div",{style:{display:"grid",gridTemplateColumns:w?"1fr":"5rem 1fr 1fr 6rem 1.5fr 3rem 4rem"},children:[d.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"var(--sticky-header-bg)",borderBottom:"1px solid var(--border-medium)",display:w?"block":"grid",gridTemplateColumns:w?void 0:"subgrid"},children:[d.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem"},children:[d.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[d.jsx("span",{style:{fontWeight:600},children:"Adjustments:"}),d.jsx("span",{style:{opacity:.6,fontSize:"0.8rem"},children:"Incoming or outgoing transactions that should bypass income and spend calculations"})]}),d.jsx("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:!C&&d.jsx(qe,{actionName:"Open Add Adjustment Form",onClick:()=>T(!0),disabled:Object.keys(u).length===0&&V.length===0,disabledReason:"Create an account or category first",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:"+ Add Adjustment"})})]}),!w&&d.jsxs(d.Fragment,{children:[d.jsx("div",{style:Ro,children:"Date"}),d.jsx("div",{style:{...Ro,textAlign:"center"},children:"Category"}),d.jsx("div",{style:Ro,children:"Account"}),d.jsx("div",{style:{...Ro,textAlign:"right"},children:"Amount"}),d.jsx("div",{style:Ro,children:"Description"}),d.jsx("div",{style:{...Ro,textAlign:"center"},children:"Clr"}),d.jsx("div",{style:Ro})]})]}),V.length===0&&Object.keys(u).length===0&&d.jsx(id,{message:"You need to create at least one account or category before adding adjustments.",linkText:"Manage accounts",linkTo:"/budget/settings/accounts"}),C&&d.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"1rem"},children:d.jsx(l1,{accounts:V,accountGroups:l,categories:u,categoryGroups:h,payees:O,defaultDate:Sm(e,n),onSubmit:$,onCancel:()=>T(!1),submitLabel:"Add Adjustment"})}),f?.adjustments?.slice().sort((D,K)=>(D.date||"").localeCompare(K.date||"")).map((D,K)=>I===D.id?d.jsx("div",{style:{gridColumn:"1 / -1",padding:"0.5rem"},children:d.jsx(l1,{accounts:V,accountGroups:l,categories:u,categoryGroups:h,payees:O,initialData:D,onSubmit:(X,G,te,Q,se,B,q)=>A(D.id,X,G,te,Q,se,B,q),onCancel:()=>M(null),onDelete:()=>k(D.id),submitLabel:"Save"})},D.id):d.jsx(z4,{adjustment:D,categoryName:ct(D.category_id)?qo:u[D.category_id]?.name||"Unknown Category",accountName:rt(D.account_id)?$a:o[D.account_id]?.nickname||"Unknown Account",accountGroupName:rt(D.account_id)?void 0:o[D.account_id]?.account_group_id?l[o[D.account_id].account_group_id]?.name:void 0,onEdit:()=>{D.description||`${D.amount}`,M(D.id)},onDelete:()=>k(D.id),isMobile:w,isEvenRow:K%2===0},D.id)),(!f?.adjustments||f.adjustments.length===0)&&!C&&d.jsx("p",{style:{gridColumn:"1 / -1",opacity:.5,fontSize:"0.9rem",textAlign:"center",padding:"1.5rem"},children:"No adjustments recorded for this month"}),d.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]})]})}const Gy={minimumFractionDigits:2,maximumFractionDigits:2};function ko(t){return`$${Math.abs(t).toLocaleString("en-US",Gy)}`}function or(t){return t<0?`-$${Math.abs(t).toLocaleString("en-US",Gy)}`:`$${t.toLocaleString("en-US",Gy)}`}function Du(t){return t===0?"$0.00":`${t>0?"+":"-"}${ko(t)}`}function lr(t){return`${t>=0?"+":"-"}${ko(t)}`}const U4=["January","February","March","April","May","June","July","August","September","October","November","December"];function F4(t){const{year:e,monthNumber:n,categoryGroups:r,categoriesByGroup:i,liveCategoryBalances:o,getAllocationAmount:l,isDraftMode:u,balanceTotals:h,grandAllTime:f}=t,p=`${U4[n-1]} ${e}`,g=[];g.push(`# Category Balances  ${p}`),g.push(""),u&&(g.push("*Draft allocations (not yet applied).*"),g.push(""));const b="| Category | Start | Allocated | Spent | Transfers | Adjust | Net Change | End | All-Time |",_="| --- | ---: | ---: | ---: | ---: | ---: | ---: | ---: | ---: |";g.push(b),g.push(_);const w=[...r].sort((T,I)=>T.sort_order-I.sort_order);function x(T,I){const M=I.balance??0;if(!u)return Math.max(0,M);const U=l(T,I),H=t.savedAllocations[T]??0,O=U-H;return Math.max(0,M+O)}for(const T of w){const I=i[T.id]||[];if(I.length===0)continue;let M=0,U=0,H=0,O=0,P=0,N=0,V=0;for(const[k,D]of I){const K=o[k];if(!K)continue;const X=K.allocated+K.spent+K.transfers+K.adjustments,G=x(k,D);M+=K.start_balance,U+=K.allocated,H+=K.spent,O+=K.transfers,P+=K.adjustments,N+=K.end_balance,V+=G;const te=D.name.replace(/\|/g,"\\|");g.push(`| ${te} | ${or(K.start_balance)} | +${ko(K.allocated)} | ${Du(K.spent)} | ${lr(K.transfers)} | ${lr(K.adjustments)} | ${lr(X)} | ${or(K.end_balance)} | ${or(G)} |`)}const $=U+H+O+P,A=T.name.replace(/\|/g,"\\|");g.push(`| **${A}** *(total)* | **${or(M)}** | **+${ko(U)}** | **${Du(H)}** | **${lr(O)}** | **${lr(P)}** | **${lr($)}** | **${or(N)}** | **${or(V)}** |`)}const S=i[Xt]||[];if(S.length>0){let T=0,I=0,M=0,U=0,H=0,O=0,P=0;for(const[V,$]of S){const A=o[V];if(!A)continue;const k=A.allocated+A.spent+A.transfers+A.adjustments,D=x(V,$);T+=A.start_balance,I+=A.allocated,M+=A.spent,U+=A.transfers,H+=A.adjustments,O+=A.end_balance,P+=D;const K=$.name.replace(/\|/g,"\\|");g.push(`| ${K} | ${or(A.start_balance)} | +${ko(A.allocated)} | ${Du(A.spent)} | ${lr(A.transfers)} | ${lr(A.adjustments)} | ${lr(k)} | ${or(A.end_balance)} | ${or(D)} |`)}const N=I+M+U+H;g.push(`| **Uncategorized** *(total)* | **${or(T)}** | **+${ko(I)}** | **${Du(M)}** | **${lr(U)}** | **${lr(H)}** | **${lr(N)}** | **${or(O)}** | **${or(P)}** |`)}const C=h.allocated+h.spent+h.transfers+h.adjustments;return g.push(`| **Grand Totals** | **${or(h.start)}** | **+${ko(h.allocated)}** | **${Du(h.spent)}** | **${lr(h.transfers)}** | **${lr(h.adjustments)}** | **${lr(C)}** | **${or(h.end)}** | **${or(f)}** |`),g.join(`
`)}function V4(t,e){const n=new Blob([t],{type:"text/markdown;charset=utf-8"}),r=URL.createObjectURL(n),i=document.createElement("a");i.href=r,i.download=e,i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(r)}function $4({isOpen:t,onClose:e,onDeleted:n}){const{addLoadingHold:r,removeLoadingHold:i}=In(),{selectedBudgetId:o,currentYear:l,currentMonthNumber:u}=Ye(),{deleteAllocations:h}=yA(),[f,p]=R.useState(null),g=async()=>{if(o){p(null),r("allocations-delete","Deleting allocations...");try{await h({budgetId:o,year:l,month:u}),e(),n?.()}catch(b){p(b instanceof Error?b.message:"Failed to delete allocations")}finally{i("allocations-delete")}}};return d.jsxs(Ks,{isOpen:t,onClose:e,title:"Delete Allocations",children:[f&&d.jsx(s_,{message:f,onDismiss:()=>p(null)}),d.jsx("p",{style:{margin:"0 0 1.5rem 0"},children:"Are you sure you want to delete all allocations for this month? This will remove all allocated amounts and reset the month to unfinalized."}),d.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[d.jsx(qe,{actionName:"Cancel Delete Allocations",variant:"secondary",onClick:e,children:"Cancel"}),d.jsx(qe,{actionName:"Confirm Delete Allocations",variant:"danger",onClick:g,children:"Delete Allocations"})]})]})}function wA({isDraftMode:t,isEditingAppliedAllocations:e,onBudgetTotal:n,availableNow:r,currentMonthIncome:i,balanceTotals:o,draftChangeAmount:l,availableAfterApply:u,currentDraftTotal:h}){const f=t&&h!==void 0?h:o.allocated,p=n!==void 0?n-r:void 0;return t||e?d.jsxs(d.Fragment,{children:[d.jsx("span",{style:{fontWeight:600,marginRight:"0.25rem"},children:"Allocations Worksheet:"}),n!==void 0&&p!==void 0&&h!==void 0?d.jsxs("span",{style:{display:"flex",flexWrap:"wrap",gap:"0.25rem 0.5rem",alignItems:"center"},children:[d.jsx("span",{style:{opacity:.6},children:"On-Budget: "}),d.jsx("span",{style:{color:et(n),fontWeight:600},children:Ft(n)}),d.jsx("span",{style:{opacity:.6},children:" Allocated: "}),d.jsx("span",{style:{fontWeight:600},children:Ft(p)}),d.jsx("span",{style:{opacity:.6},children:"= Avail: "}),d.jsx("span",{style:{color:et(r),fontWeight:600},children:Ft(r)}),d.jsx("span",{style:{opacity:.6},children:" Draft: "}),d.jsx("span",{style:{color:Na(f),fontWeight:600,...Mr},children:Ft(f)}),d.jsx("span",{style:{opacity:.6},children:"= Remaining: "}),d.jsx("span",{style:{color:et(u),fontWeight:600,...Mr},children:Ft(u)}),e&&l!==0&&d.jsxs("span",{style:{fontSize:"0.85em",color:l>0?me.warning:me.success},children:["(",Qt(l),")"]})]}):d.jsxs(d.Fragment,{children:[d.jsx("span",{style:{opacity:.6},children:"Avail: "}),d.jsx("span",{style:{color:et(r),fontWeight:600},children:Ft(r)}),d.jsx("span",{style:{opacity:.6},children:" Draft: "}),d.jsx("span",{style:{color:Na(f),fontWeight:600,...Mr},children:Ft(f)}),d.jsx("span",{style:{opacity:.6},children:"= Remaining: "}),d.jsx("span",{style:{color:et(u),fontWeight:600,...Mr},children:Ft(u)})]})]}):d.jsxs(d.Fragment,{children:[d.jsx("span",{style:{fontWeight:600,marginRight:"0.25rem"},children:"Month Summary:"}),d.jsx("span",{style:{opacity:.6},children:"Inc: "}),d.jsx("span",{style:{color:me.success,fontWeight:600},children:Ft(i)}),d.jsx("span",{style:{opacity:.6},children:"Alloc: "}),d.jsx("span",{style:{color:Na(o.allocated),fontWeight:600},children:Ft(o.allocated)}),d.jsx("span",{style:{opacity:.6},children:"Spent: "}),d.jsx("span",{style:{color:jc(o.spent),fontWeight:600},children:Ft(o.spent)}),d.jsx("span",{style:{opacity:.6},children:"Net: "}),d.jsx("span",{style:{color:et(o.allocated+o.spent),fontWeight:600},children:Ft(o.allocated+o.spent)})]})}function q4({totals:t}){return d.jsxs(d.Fragment,{children:[d.jsxs("span",{children:[d.jsx("span",{style:{opacity:.6},children:"Start: "}),d.jsx("span",{style:{color:et(t.start),fontWeight:600},children:Ft(t.start)})]}),d.jsxs("span",{children:[d.jsx("span",{style:{opacity:.6},children:"Inc: "}),d.jsx("span",{style:{color:me.success,fontWeight:600},children:Ft(t.income)})]}),d.jsxs("span",{children:[d.jsx("span",{style:{opacity:.6},children:"Exp: "}),d.jsx("span",{style:{color:jc(t.expenses),fontWeight:600},children:Ft(t.expenses)})]}),d.jsxs("span",{children:[d.jsx("span",{style:{opacity:.6},children:"End: "}),d.jsx("span",{style:{color:et(t.end),fontWeight:600},children:Ft(t.end)})]})]})}function p_({isDraftMode:t,isEditingAppliedAllocations:e,allocationsFinalized:n,onSave:r,onApply:i,onEdit:o,onCancel:l,onDelete:u}){const h={fontSize:"0.8rem",padding:"0.4em 0.8em",height:32,minHeight:32,boxSizing:"border-box",lineHeight:1,display:"inline-flex",alignItems:"center",justifyContent:"center"};return d.jsxs("div",{style:{display:"flex",alignItems:"flex-end",gap:"0.5rem",flexShrink:0},children:[t&&!e&&d.jsxs(d.Fragment,{children:[d.jsx(qe,{actionName:"Save Draft Allocations",onClick:r,variant:"secondary",style:h,children:" Save"}),d.jsx(qe,{actionName:"Apply Allocations",onClick:i,variant:"secondary",style:h,children:" Apply"})]}),!t&&n&&d.jsx(qe,{actionName:"Edit Allocations",onClick:o,variant:"secondary",style:h,children:" Edit Allocations"}),e&&d.jsxs(d.Fragment,{children:[d.jsx(qe,{actionName:"Apply Allocations",onClick:i,variant:"secondary",style:h,children:" Apply"}),d.jsx(qe,{actionName:"Cancel Edit Allocations",onClick:l,variant:"secondary",style:h,children:""}),d.jsx(qe,{actionName:"Open Delete Allocations Modal",onClick:u,variant:"secondary",style:{...h,color:me.error},children:""})]})]})}function c1(t){return t===0?me.zero:t>0?me.success:me.error}function H4({category:t,balance:e,localAllocation:n,previousMonthIncome:r,isDraftMode:i,onAllocationChange:o,projectedAllTime:l}){const u=t.default_monthly_type==="percentage"&&t.default_monthly_amount!==void 0&&t.default_monthly_amount>0,h=u?t.default_monthly_amount/100*r:0,f=u?h.toFixed(2):n,p=i&&!u,g=i?l:t.balance??0,b=t.balance??0,_=b<0,w=_?Math.abs(b):0,x=u?h:parseFloat(n)||0,S=_?Math.min(x,w):0,C=_?Math.max(0,x-w):0,T=_&&x>0&&C>0;return d.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",padding:"0.75rem"},children:[d.jsx("div",{style:{marginBottom:"0.5rem"},children:d.jsx("span",{style:{fontWeight:500},children:t.name})}),d.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr 1fr 1fr",gap:"0.25rem",fontSize:"0.75rem"},children:[d.jsxs("div",{children:[d.jsx("span",{style:{opacity:.6,display:"block"},children:"Start"}),d.jsx("span",{style:{color:hn(e.start_balance)},children:zt(e.start_balance)})]}),d.jsxs("div",{children:[d.jsx("span",{style:{opacity:.6,display:"block"},children:"Alloc"}),p?d.jsxs(d.Fragment,{children:[d.jsx("input",{type:"text",inputMode:"decimal",value:f?`$${f}`:"",onChange:I=>{const M=I.target.value.replace(/[^\d.]/g,"");o(M)},placeholder:"$0",style:{width:"100%",maxWidth:"80px",padding:"0.25rem 0.35rem",borderRadius:"4px",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",background:"color-mix(in srgb, currentColor 8%, transparent)",fontSize:"0.8rem",color:"inherit",boxSizing:"border-box"}}),_&&x>0&&d.jsxs("div",{style:{fontSize:"0.65rem",marginTop:"0.15rem",lineHeight:1.3},children:[d.jsxs("span",{style:{color:me.debt,display:"block"},children:[Jt(S),"  debt"]}),T&&d.jsxs("span",{style:{color:me.success,display:"block"},children:[Jt(C),"  balance"]})]})]}):d.jsx("span",{style:{color:Na(e.allocated)},children:Qt(e.allocated)})]}),d.jsxs("div",{children:[d.jsx("span",{style:{opacity:.6,display:"block"},children:"Spent"}),d.jsx("span",{style:{color:jc(e.spent)},children:Xn(e.spent)})]}),d.jsxs("div",{children:[d.jsx("span",{style:{opacity:.6,display:"block"},children:"End"}),d.jsx("span",{style:{color:hn(e.end_balance),...i&&!u?Mr:{}},children:zt(e.end_balance)})]}),d.jsxs("div",{children:[d.jsx("span",{style:{opacity:.6,display:"block"},children:i?"Proj. All-Time":"All-Time"}),d.jsx("span",{style:{color:hn(g),...i&&!u?Mr:{}},children:zt(g)})]})]}),(e.transfers!==0||e.adjustments!==0)&&d.jsxs("div",{style:{marginTop:"0.5rem",paddingTop:"0.5rem",borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)",display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",fontSize:"0.7rem",opacity:.7},children:[e.transfers!==0&&d.jsxs("span",{style:{color:c1(e.transfers)},children:[Qt(e.transfers)," transfers"]}),e.adjustments!==0&&d.jsxs("span",{style:{color:c1(e.adjustments)},children:[Qt(e.adjustments)," adjust"]})]}),i&&u&&d.jsx("div",{style:{marginTop:"0.5rem"},children:d.jsxs("span",{style:{fontSize:"0.8rem"},children:[d.jsxs("span",{style:{opacity:.6},children:[Jt(r),"  "]}),d.jsxs("span",{style:{color:me.success},children:[t.default_monthly_amount,"%"]}),d.jsx("span",{style:{opacity:.6},children:" = "}),d.jsx("span",{style:{color:me.success},children:Jt(h)})]})})]})}function u1(t){return t===0?me.zero:t>0?me.success:me.error}function G4({category:t,balance:e,localAllocation:n,previousMonthIncome:r,isDraftMode:i,onAllocationChange:o,allTimeBalance:l,isEvenRow:u,gridTemplateColumns:h}){const f=t.default_monthly_type==="percentage"&&t.default_monthly_amount!==void 0&&t.default_monthly_amount>0,p=f?t.default_monthly_amount/100*r:0,g=f?p.toFixed(2):n,b=t.balance??0,_=b<0,w=_?Math.abs(b):0,x=f?p:parseFloat(n)||0,S=_?Math.min(x,w):0,C=_?Math.max(0,x-w):0,T=_&&x>0&&C>0,I=u?"transparent":"var(--row-alt-bg)",M={paddingTop:"0.6rem",paddingBottom:"0.6rem",paddingLeft:"0.5rem",paddingRight:"0.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem",minHeight:"2.4rem",boxSizing:"border-box"},U=e.allocated+e.spent+e.transfers+e.adjustments;return d.jsxs("div",{style:{gridColumn:"1 / -1",background:I,display:"grid",gridTemplateColumns:h},children:[d.jsx("div",{style:{paddingTop:"0.6rem",paddingBottom:"0.6rem",paddingRight:"0.5rem",paddingLeft:"1.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem",fontWeight:500,overflow:"hidden",borderLeft:"2px solid var(--border-subtle)",minHeight:"2.4rem",boxSizing:"border-box"},children:d.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.name})}),d.jsx("div",{style:{...M,justifyContent:"flex-end",color:hn(e.start_balance)},children:zt(e.start_balance)}),i?d.jsx("div",{style:{...M,justifyContent:"center",flexDirection:"column",gap:"0.1rem"},children:f?d.jsxs("span",{style:{fontSize:"0.85rem"},children:[d.jsxs("span",{style:{color:me.success},children:[t.default_monthly_amount,"%"]}),d.jsx("span",{style:{opacity:.5},children:" = "}),d.jsx("span",{style:{color:me.success},children:Jt(p)})]}):d.jsxs(d.Fragment,{children:[d.jsx("input",{type:"text",inputMode:"decimal",value:g?`$${g}`:"",onChange:H=>{const O=H.target.value.replace(/[^\d.]/g,"");o(O)},placeholder:"$0.00",style:{width:"100px",padding:"0.2rem 0.5rem",borderRadius:"4px",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"0.9rem",lineHeight:1,color:"inherit",boxSizing:"border-box"}}),_&&x>0&&d.jsxs("div",{style:{fontSize:"0.6rem",whiteSpace:"nowrap",textAlign:"center",lineHeight:1.3,display:"flex",flexDirection:"column",alignItems:"center"},children:[d.jsxs("span",{style:{color:me.debt},children:[Jt(S),"  debt"]}),T&&d.jsxs("span",{style:{color:me.success},children:[Jt(C),"  bal"]})]})]})}):(()=>{const H=e.start_balance<0,O=H?Math.abs(e.start_balance):0,P=H?Math.min(e.allocated,O):0,N=H?Math.max(0,e.allocated-O):0,V=H&&e.allocated>0;return d.jsxs("div",{style:{...M,justifyContent:"flex-end",flexDirection:"column",alignItems:"flex-end",gap:"0.1rem",color:Na(e.allocated)},children:[d.jsxs("span",{children:["+",Jt(e.allocated)]}),V&&d.jsxs("div",{style:{fontSize:"0.6rem",whiteSpace:"nowrap",textAlign:"right",lineHeight:1.3,display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[d.jsxs("span",{style:{color:me.debt},children:[Jt(P),"  debt"]}),N>0&&d.jsxs("span",{style:{color:me.success},children:[Jt(N),"  bal"]})]})]})})(),d.jsx("div",{style:{...M,justifyContent:"flex-end",color:jc(e.spent)},children:Xn(e.spent)}),d.jsx("div",{style:{...M,justifyContent:"flex-end",color:u1(e.transfers)},children:Qt(e.transfers)}),d.jsx("div",{style:{...M,justifyContent:"flex-end",color:u1(e.adjustments)},children:Qt(e.adjustments)}),d.jsx("div",{style:{...M,justifyContent:"flex-end",color:hn(U),...i&&!f?Mr:{}},children:Qt(U)}),d.jsx("div",{style:{...M,justifyContent:"flex-end",fontWeight:600,color:hn(e.end_balance),paddingRight:"1rem",borderRight:"2px solid var(--border-muted)",...i&&!f?Mr:{}},children:zt(e.end_balance)}),d.jsx("div",{style:{...M,justifyContent:"flex-end",color:hn(l),...i&&!f?Mr:{}},children:zt(l)})]})}function d1(t){return t===0?me.zero:t>0?me.success:me.error}function h1({name:t,categories:e,groupTotals:n,getCategoryBalance:r,localAllocations:i,savedAllocations:o,previousMonthIncome:l,isDraftMode:u,allocationsFinalized:h,onAllocationChange:f,isMobile:p,isUngrouped:g,isFirstGroup:b=!1,getAllocationAmount:_,gridTemplateColumns:w}){const x={paddingTop:"0.6rem",paddingBottom:"0.6rem",paddingLeft:"0.5rem",paddingRight:"0.5rem",marginTop:b?0:"1.25rem",borderTop:"1px solid var(--border-medium)",borderBottom:qa,background:"var(--row-alt-bg)",display:"flex",alignItems:"center",fontSize:"0.9rem",fontWeight:600},S=n.allocated+n.spent+n.transfers+n.adjustments,C=!h,T=e.reduce((I,[M,U])=>{const H=U.balance??0;let O;if(C){const P=u?_(M,U):o[M]??0;O=H+P}else if(O=H,u){const P=_(M,U),N=o[M]??0;O+=P-N}return I+Math.max(0,O)},0);return d.jsxs("div",{style:{display:"contents"},children:[!p&&d.jsxs(d.Fragment,{children:[d.jsxs("div",{style:{...x,paddingLeft:"0.5rem",opacity:g?.7:1},children:[d.jsx("span",{children:t}),d.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",e.length,")"]})]}),d.jsx("div",{style:{...x,justifyContent:"flex-end",color:hn(n.start)},children:an.showGroupTotals}),d.jsx("div",{style:{...x,justifyContent:u?"center":"flex-end",color:Na(n.allocated)},children:an.showGroupTotals}),d.jsx("div",{style:{...x,justifyContent:"flex-end",color:jc(n.spent)},children:an.showGroupTotals}),d.jsx("div",{style:{...x,justifyContent:"flex-end",color:d1(n.transfers)},children:an.showGroupTotals}),d.jsx("div",{style:{...x,justifyContent:"flex-end",color:d1(n.adjustments)},children:an.showGroupTotals}),d.jsx("div",{style:{...x,justifyContent:"flex-end",color:hn(S)},children:an.showGroupTotals}),d.jsx("div",{style:{...x,justifyContent:"flex-end",color:hn(n.end),paddingRight:"1rem",borderRight:"2px solid var(--border-muted)"},children:an.showGroupTotals}),d.jsx("div",{style:{...x,justifyContent:"flex-end",color:hn(T)},children:an.showGroupTotals})]}),!u&&p&&d.jsxs("div",{style:{gridColumn:"1 / -1",paddingTop:"0.6rem",paddingBottom:"0.6rem",paddingLeft:"0.5rem",paddingRight:"0.5rem",marginTop:b?0:"1.25rem",borderTop:"1px solid var(--border-medium)",borderBottom:qa,background:"var(--row-alt-bg)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[d.jsxs("span",{style:{fontWeight:600,opacity:g?.7:1},children:[t,d.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",e.length,")"]})]}),an.showGroupTotals]}),e.map(([I,M],U)=>{const H=r(I);if(!H)return null;const O=M.balance??0;let P;if(C){const N=u?_(I,M):H.allocated??0;P=O+N}else if(P=O,u){const N=_(I,M),V=o[I]??0;P+=N-V}return p?d.jsx("div",{style:{gridColumn:"1 / -1"},children:d.jsx(H4,{category:M,balance:H,localAllocation:i[I]||"",previousMonthIncome:l,isDraftMode:u,onAllocationChange:N=>f(I,N),projectedAllTime:P})},I):d.jsx(G4,{category:M,balance:H,localAllocation:i[I]||"",previousMonthIncome:l,isDraftMode:u,onAllocationChange:N=>f(I,N),allTimeBalance:P,isEvenRow:U%2===0,gridTemplateColumns:w},I)})]})}function W4(t,e){const{includeHidden:n=!1}={},r=Object.entries(t).filter(([,i])=>n||!i.is_hidden).reduce((i,[o,l])=>{const u=l.category_group_id||"ungrouped";return i[u]||(i[u]=[]),i[u].push([o,l]),i},{});return Object.keys(r).forEach(i=>{r[i].sort((o,l)=>o[1].sort_order-l[1].sort_order)}),r}function Q4(t,e,n,r,i){const o={};t?.category_balances&&t.category_balances.forEach(u=>{o[u.category_id]=u});const l={};return Object.entries(e).forEach(([u,h])=>{const f=o[u],p=je(f?.start_balance??0);let g=0;n?g=je(i(u,h)):r&&f&&(g=je(f.allocated));const b=OT(u,t?.expenses||[]),_=NT(u,t?.transfers||[]),w=PT(u,t?.adjustments||[]);l[u]={category_id:u,start_balance:p,allocated:g,spent:b,transfers:_,adjustments:w,end_balance:je(p+g+b+_+w)}}),l}function K4(t,e){const n={};t?.account_balances&&t.account_balances.forEach(i=>{n[i.account_id]=i});const r={};return Object.entries(e).forEach(([i,o])=>{const l=n[i],u=je(l?.start_balance??o.balance);let h=0;t?.income&&(h=je(t.income.filter(_=>_.account_id===i).reduce((_,w)=>_+w.amount,0)));let f=0;t?.expenses&&(f=je(t.expenses.filter(_=>_.account_id===i).reduce((_,w)=>_+w.amount,0)));let p=0;if(t?.transfers){let _=0;t.transfers.forEach(w=>{w.to_account_id===i&&(_+=w.amount),w.from_account_id===i&&(_-=w.amount)}),p=je(_)}let g=0;t?.adjustments&&(g=je(t.adjustments.filter(_=>_.account_id===i).reduce((_,w)=>_+w.amount,0)));const b=je(h+f+p+g);r[i]={account_id:i,start_balance:u,income:h,expenses:f,transfers:p,adjustments:g,net_change:b,end_balance:je(u+b)}}),r}function Y4(t){return Object.values(t).reduce((e,n)=>({start:e.start+n.start_balance,income:e.income+n.income,expenses:e.expenses+n.expenses,transfers:e.transfers+n.transfers,adjustments:e.adjustments+n.adjustments,netChange:e.netChange+n.net_change,end:e.end+n.end_balance}),{start:0,income:0,expenses:0,transfers:0,adjustments:0,netChange:0,end:0})}function X4(t){return Object.values(t).reduce((e,n)=>({start:e.start+n.start_balance,allocated:e.allocated+n.allocated,spent:e.spent+n.spent,transfers:e.transfers+n.transfers,adjustments:e.adjustments+n.adjustments,end:e.end+Math.max(0,n.end_balance)}),{start:0,allocated:0,spent:0,transfers:0,adjustments:0,end:0})}function SA(t,e){const n={},r={};return t?.account_balances&&t.account_balances.forEach(i=>{r[i.account_id]=i}),t?(Object.entries(e).forEach(([i,o])=>{const l=r[i],u=je(l?.start_balance??o.balance);let h=0,f=0;t?.income&&t.income.filter(T=>T.account_id===i).forEach(T=>{f+=T.amount,h+=T.amount});let p=0,g=0;t?.expenses&&t.expenses.filter(T=>T.account_id===i).forEach(T=>{g+=T.amount,T.cleared===!0&&(p+=T.amount)});let b=0,_=0;t?.transfers&&t.transfers.forEach(T=>{T.to_account_id===i&&(_+=T.amount,T.cleared===!0&&(b+=T.amount)),T.from_account_id===i&&(_-=T.amount,T.cleared===!0&&(b-=T.amount))});let w=0,x=0;t?.adjustments&&t.adjustments.filter(T=>T.account_id===i).forEach(T=>{x+=T.amount,T.cleared===!0&&(w+=T.amount)});const S=je(h+p+b+w),C=je(f+g+_+x);n[i]={account_id:i,cleared_balance:je(u+S),uncleared_balance:je(u+C)}}),n):(Object.entries(e).forEach(([i,o])=>{const l=je(o.balance??0);n[i]={account_id:i,cleared_balance:l,uncleared_balance:l}}),n)}function f1(t){return t===0?me.zero:t>0?me.success:me.error}function Z4({isDraftMode:t,allocationsFinalized:e,balanceTotals:n,grandAllTime:r,onSave:i,onApply:o,onEdit:l,onCancel:u,onDelete:h}){const f={paddingTop:"0.6rem",paddingBottom:"0.6rem",paddingLeft:"0.5rem",paddingRight:"0.5rem",borderTop:"2px solid var(--border-strong)",borderBottom:"2px solid var(--border-strong)",fontWeight:600,display:"flex",alignItems:"center",fontSize:"0.9rem"},p=n.allocated+n.spent+n.transfers+n.adjustments;return d.jsxs(d.Fragment,{children:[d.jsxs("div",{style:{...f,gap:"0.75rem"},children:["Grand Totals",!t&&d.jsx(p_,{isDraftMode:!1,isEditingAppliedAllocations:!1,allocationsFinalized:e,onSave:i,onApply:o,onEdit:l,onCancel:u,onDelete:h})]}),d.jsx("div",{style:{...f,justifyContent:"flex-end",color:hn(n.start)},children:zt(n.start)}),d.jsxs("div",{style:{...f,justifyContent:t?"center":"flex-end",color:Na(n.allocated),...t?Mr:{}},children:["+",Jt(n.allocated)]}),d.jsx("div",{style:{...f,justifyContent:"flex-end",color:jc(n.spent)},children:Xn(n.spent)}),d.jsx("div",{style:{...f,justifyContent:"flex-end",color:f1(n.transfers)},children:Qt(n.transfers)}),d.jsx("div",{style:{...f,justifyContent:"flex-end",color:f1(n.adjustments)},children:Qt(n.adjustments)}),d.jsx("div",{style:{...f,justifyContent:"flex-end",color:hn(p),...t?Mr:{}},children:Qt(p)}),d.jsx("div",{style:{...f,justifyContent:"flex-end",color:hn(n.end),paddingRight:"1rem",borderRight:"2px solid var(--border-muted)",...t?Mr:{}},children:zt(n.end)}),d.jsx("div",{style:{...f,justifyContent:"flex-end",color:hn(r),...t?Mr:{}},children:zt(r)})]})}function J4({allocationsFinalized:t,availableNow:e,currentMonthIncome:n,balanceTotals:r,draftChangeAmount:i,availableAfterApply:o,currentDraftTotal:l,onSave:u,onApply:h,onEdit:f,onCancel:p,onDelete:g}){return d.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem",borderTop:"2px solid var(--border-strong)",borderBottom:"2px solid var(--border-strong)"},children:[d.jsx("span",{style:{fontWeight:600},children:"Grand Totals:"}),d.jsx(wA,{isDraftMode:!1,isEditingAppliedAllocations:!1,availableNow:e,currentMonthIncome:n,balanceTotals:r,draftChangeAmount:i,availableAfterApply:o,currentDraftTotal:l}),d.jsx(p_,{isDraftMode:!1,isEditingAppliedAllocations:!1,allocationsFinalized:t,onSave:u,onApply:h,onEdit:f,onCancel:p,onDelete:g})]})}const _i={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderBottom:"2px solid var(--border-medium)"};function eL({registerDownloadCategories:t}={}){const{selectedBudgetId:e,currentYear:n,currentMonthNumber:r}=Ye(),{categories:i,categoryGroups:o}=Dn(),{month:l}=Xs(e,n,r),u=Li(),[h,f]=R.useState(!1),{localAllocations:p,isEditingAppliedAllocations:g,availableNow:b,onBudgetTotal:_,currentDraftTotal:w,draftChangeAmount:x,availableAfterApply:S,previousMonthIncome:C,currentMonthIncome:T,allocationsFinalized:I,getAllocationAmount:M,handleAllocationChange:U,resetAllocationsToSaved:H,handleSaveAllocations:O,handleFinalizeAllocations:P,handleEditAllocations:N,setIsEditingAppliedAllocations:V}=EB(),$=[...o].sort((ee,ne)=>ee.sort_order-ne.sort_order),A=R.useMemo(()=>W4(i),[i]),k=!I||g,D=R.useMemo(()=>Q4(l,i,k,I,M),[l,i,k,I,M]),K=R.useMemo(()=>{if(I)return D;const ee={};for(const[ne,le]of Object.entries(i)){const he=D[ne];if(!he)continue;const Ee=le.balance??0,ae=he.allocated+he.spent+he.transfers+he.adjustments;ee[ne]={...he,start_balance:Ee,end_balance:Ee+ae}}return ee},[D,i,I]),X=ee=>K[ee]??D[ee],G=R.useMemo(()=>{const ee={};for(const[ne,le]of Object.entries(i)){if(le.is_hidden)continue;const he=K[ne]??D[ne];he&&(ee[ne]=he)}return X4(ee)},[K,D,i]),te=R.useMemo(()=>{const ee={};if(l?.category_balances)for(const ne of l.category_balances)ee[ne.category_id]=ne.allocated;return ee},[l]),Q=R.useMemo(()=>{const ee=!I;return Object.entries(i).reduce((ne,[le,he])=>{if(he.is_hidden)return ne;const Ee=he.balance??0;let ae;if(ee){const fe=k?M(le,he):te[le]??0;ae=Ee+fe}else if(ae=Ee,k){const fe=M(le,he),Me=te[le]??0;ae+=fe-Me}return ne+Math.max(0,ae)},0)},[i,k,I,M,te]),se=R.useMemo(()=>Object.values(i).reduce((ee,ne)=>ne.is_hidden?ee:ee+Math.max(0,ne.balance??0),0),[i]);R.useEffect(()=>{if(!e||k)return;const ee=Math.abs(Q-se);ee>.02&&(console.error("[MonthCategories] Month View vs Settings Mismatch:",{grandAllTime:Q,settingsPageAllocated:se,difference:ee}),qn.add({type:"error",message:`Balance display mismatch: Month view "ALL-TIME" (${Jt(Q)})  Settings "Allocated" (${Jt(se)}). Difference: ${Jt(ee)}.`,autoDismissMs:1e4}))},[Q,se,k,e]);const B={onSave:O,onApply:P,onEdit:N,onCancel:H,onDelete:()=>f(!0)},q=R.useRef(()=>{});return R.useLayoutEffect(()=>(q.current=()=>{const ee=F4({year:n,monthNumber:r,categoryGroups:$,categoriesByGroup:A,liveCategoryBalances:D,getAllocationAmount:M,savedAllocations:te,isDraftMode:k,balanceTotals:G,grandAllTime:Q}),le=`categories-${n}-${(he=>String(he).padStart(2,"0"))(r)}.md`;V4(ee,le)},()=>{q.current=()=>{}}),[n,r,$,A,i,D,M,te,C,k,G,Q]),R.useEffect(()=>{if(t)return t(()=>q.current()),()=>t(null)},[t]),d.jsxs(d.Fragment,{children:[d.jsxs("div",{style:{display:"grid",gridTemplateColumns:u?"1fr":k?"2fr 1fr 200px 1fr 1fr 1fr 1fr 1fr 120px":"2fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 120px"},children:[d.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"var(--sticky-header-bg)",display:u?"block":"grid",gridTemplateColumns:u?void 0:"subgrid"},children:[k&&d.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexDirection:u?"column":"row",flexWrap:"wrap",alignItems:u?"stretch":"center",gap:u?"0.5rem":"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:u?"0.5rem":"0.25rem"},children:[d.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:u?void 0:1,alignItems:"center"},children:d.jsx(wA,{isDraftMode:k,isEditingAppliedAllocations:g,onBudgetTotal:_,availableNow:b,currentMonthIncome:T,balanceTotals:G,draftChangeAmount:x,availableAfterApply:S,currentDraftTotal:w})}),d.jsx(p_,{isDraftMode:k,isEditingAppliedAllocations:g,allocationsFinalized:I,...B})]}),!u&&d.jsxs(d.Fragment,{children:[d.jsx("div",{style:_i,children:"Category"}),d.jsx("div",{style:{..._i,textAlign:"right"},children:"Start"}),d.jsx("div",{style:{..._i,textAlign:k?"center":"right"},children:"Allocated"}),d.jsx("div",{style:{..._i,textAlign:"right"},children:"Spent"}),d.jsx("div",{style:{..._i,textAlign:"right"},children:"Transfers"}),d.jsx("div",{style:{..._i,textAlign:"right"},children:"Adjust"}),d.jsx("div",{style:{..._i,textAlign:"right"},children:"Net Change"}),d.jsx("div",{style:{..._i,textAlign:"right",paddingRight:"1rem",borderRight:"2px solid var(--border-muted)"},children:"End"}),d.jsx("div",{style:{..._i,textAlign:"right"},children:"All-Time"})]}),!u&&d.jsx(Z4,{isDraftMode:k,allocationsFinalized:I,balanceTotals:G,grandAllTime:Q,...B}),!k&&u&&d.jsx(J4,{allocationsFinalized:I,availableNow:b,currentMonthIncome:T,balanceTotals:G,draftChangeAmount:x,availableAfterApply:S,currentDraftTotal:w,...B})]}),Object.keys(i).length===0&&d.jsxs("p",{style:{gridColumn:"1 / -1",opacity:.6,textAlign:"center",padding:"2rem"},children:["No categories yet. ",d.jsx(jn,{to:"/budget/settings/categories",style:{opacity:1},children:"Create categories "})]}),$.map((ee,ne)=>{const le=A[ee.id]||[];if(le.length===0)return null;const he=le.reduce((Ee,[ae])=>{const fe=X(ae);return fe?{start:Ee.start+fe.start_balance,allocated:Ee.allocated+fe.allocated,spent:Ee.spent+fe.spent,transfers:Ee.transfers+fe.transfers,adjustments:Ee.adjustments+fe.adjustments,end:Ee.end+fe.end_balance}:Ee},{start:0,allocated:0,spent:0,transfers:0,adjustments:0,end:0});return d.jsx(h1,{name:ee.name,categories:le,groupTotals:he,getCategoryBalance:X,localAllocations:p,savedAllocations:te,previousMonthIncome:C,isDraftMode:k,allocationsFinalized:I,onAllocationChange:U,isMobile:u,isFirstGroup:ne===0,getAllocationAmount:M,gridTemplateColumns:k?"2fr 1fr 200px 1fr 1fr 1fr 1fr 1fr 120px":"2fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 120px"},ee.id)}),A[Xt]?.length>0&&(()=>{const ee=A[Xt],ne=ee.reduce((he,[Ee])=>{const ae=X(Ee);return ae?{start:he.start+ae.start_balance,allocated:he.allocated+ae.allocated,spent:he.spent+ae.spent,transfers:he.transfers+ae.transfers,adjustments:he.adjustments+ae.adjustments,end:he.end+ae.end_balance}:he},{start:0,allocated:0,spent:0,transfers:0,adjustments:0,end:0}),le=$.length===0;return d.jsx(h1,{name:"Uncategorized",categories:ee,groupTotals:ne,getCategoryBalance:X,localAllocations:p,savedAllocations:te,previousMonthIncome:C,isDraftMode:k,allocationsFinalized:I,onAllocationChange:U,isMobile:u,isUngrouped:!0,isFirstGroup:le,getAllocationAmount:M,gridTemplateColumns:k?"2fr 1fr 200px 1fr 1fr 1fr 1fr 1fr 120px":"2fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 120px"},Xt)})(),d.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]}),d.jsx($4,{isOpen:h,onClose:()=>f(!1),onDeleted:()=>V(!1)})]})}function tL(t){return t===0?me.zero:t>0?me.success:me.error}function nL(t){return t===0?me.zero:t<0?me.error:me.success}function ry(t){return t===0?me.zero:t>0?me.success:me.error}const rL="5rem",sL=`2fr repeat(8, minmax(${rL}, 1fr))`,iL={fontVariantNumeric:"tabular-nums",whiteSpace:"nowrap",paddingLeft:"0.5rem",paddingRight:"0.5rem"};function aL({account:t,balance:e,clearedBalance:n,isEvenRow:r,hasUnclearedDetail:i,isExpanded:o,onToggleExpand:l}){const u=r?"transparent":"var(--row-alt-bg)",h={padding:"0.5rem 0.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem"},f={...h,...iL,justifyContent:"flex-end"};return d.jsxs("div",{style:{gridColumn:"1 / -1",background:u,display:"grid",gridTemplateColumns:sL},children:[d.jsx("div",{style:{...h,fontWeight:500,overflow:"hidden",paddingLeft:"1.5rem",borderLeft:"2px solid var(--border-subtle)"},children:d.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.nickname})}),d.jsx("div",{style:{...f,color:et(e.start_balance)},children:zt(e.start_balance)}),d.jsxs("div",{style:{...f,color:tL(e.income)},children:["+",Jt(e.income)]}),d.jsx("div",{style:{...f,color:nL(e.expenses)},children:Xn(e.expenses)}),d.jsx("div",{style:{...f,color:ry(e.transfers)},children:Qt(e.transfers)}),d.jsx("div",{style:{...f,color:ry(e.adjustments)},children:Qt(e.adjustments)}),d.jsx("div",{style:{...f,color:ry(e.net_change)},children:Qt(e.net_change)}),d.jsx("div",{style:{...f,fontWeight:600,color:et(e.end_balance)},children:zt(e.end_balance)}),d.jsx("div",{style:{...f,gap:"0.25rem",color:n?et(n.uncleared_balance):void 0,fontWeight:600},children:n?d.jsxs(d.Fragment,{children:[d.jsx("span",{children:zt(n.uncleared_balance)}),i&&d.jsx("button",{type:"button",onClick:p=>{p.stopPropagation(),l()},title:o?"Hide cleared/uncleared breakdown":"Show cleared/uncleared breakdown",style:{background:"transparent",border:"none",cursor:"pointer",fontSize:"0.5rem",opacity:.5,padding:"0.1rem",borderRadius:"2px",transition:"transform 0.15s",transform:o?"rotate(180deg)":"rotate(0deg)"},children:""})]}):d.jsx("span",{style:{opacity:.3,color:"var(--text-muted)"},children:""})})]})}function oL(t){return t===0?me.zero:t>0?me.success:me.error}function lL(t){return t===0?me.zero:t<0?me.error:me.success}function qu(t){return t===0?me.zero:t>0?me.success:me.error}const cL={fontVariantNumeric:"tabular-nums",whiteSpace:"nowrap",paddingLeft:"0.5rem",paddingRight:"0.5rem"};function m1({name:t,accounts:e,groupTotals:n,accountBalances:r,accountClearedBalances:i,isMobile:o,isUngrouped:l,isFirstGroup:u=!1}){const[h,f]=R.useState(null),p={padding:"0.6rem 0.5rem",marginTop:u?0:"1.25rem",borderTop:"1px solid var(--border-medium)",borderBottom:qa,background:"var(--row-alt-bg)",display:"flex",alignItems:"center",fontSize:"0.9rem",fontWeight:600},g={...cL,justifyContent:"flex-end"};return d.jsxs("div",{style:{display:"contents"},children:[!o&&d.jsxs(d.Fragment,{children:[d.jsxs("div",{style:{...p,opacity:l?.7:1},children:[d.jsx("span",{children:t}),d.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",e.length,")"]})]}),d.jsx("div",{style:{...p,...g,color:et(n.start)},children:an.showGroupTotals}),d.jsx("div",{style:{...p,...g,color:oL(n.income)},children:an.showGroupTotals}),d.jsx("div",{style:{...p,...g,color:lL(n.expenses)},children:an.showGroupTotals}),d.jsx("div",{style:{...p,...g,color:qu(n.transfers)},children:an.showGroupTotals}),d.jsx("div",{style:{...p,...g,color:qu(n.adjustments)},children:an.showGroupTotals}),d.jsx("div",{style:{...p,...g,color:qu(n.netChange)},children:an.showGroupTotals}),d.jsx("div",{style:{...p,...g,color:et(n.end)},children:an.showGroupTotals}),d.jsx("div",{style:{...p,...g},children:an.showGroupTotals})]}),o&&d.jsxs("div",{style:{gridColumn:"1 / -1",padding:"0.6rem 0.5rem",marginTop:u?0:"1.25rem",borderTop:"1px solid var(--border-medium)",borderBottom:qa,background:"var(--row-alt-bg)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[d.jsxs("span",{style:{fontWeight:600,opacity:l?.7:1},children:[t,d.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",e.length,")"]})]}),an.showGroupTotals]}),e.flatMap(([b,_],w)=>{const x=r[b];if(!x)return[];const S=i?.[b],C=!!S&&Math.abs(S.uncleared_balance-S.cleared_balance)>=.01,T=h===b;return o?[d.jsx("div",{style:{gridColumn:"1 / -1"},children:d.jsx(dL,{account:_,balance:x,clearedBalance:S,hasUnclearedDetail:C})},b)]:[d.jsx(aL,{account:_,balance:x,clearedBalance:S,isEvenRow:w%2===0,hasUnclearedDetail:C,isExpanded:T,onToggleExpand:()=>f(T?null:b)},b),T&&C&&S&&d.jsx(uL,{clearedBalance:S},`${b}-exp`)].filter(Boolean)})]})}function uL({clearedBalance:t}){const e=t.uncleared_balance-t.cleared_balance,n="auto auto auto auto auto",r={fontSize:"0.7rem",fontWeight:600,opacity:.7,textTransform:"uppercase",letterSpacing:"0.03em",padding:"0.25rem 0.5rem",textAlign:"right"},i={fontSize:"0.85rem",opacity:.5,padding:"0.25rem 0.35rem",textAlign:"center"},o={fontSize:"0.85rem",fontVariantNumeric:"tabular-nums",padding:"0.35rem 0.5rem",textAlign:"right"};return d.jsx("div",{style:{gridColumn:"1 / -1",padding:"0.5rem 1rem 0.75rem 2.5rem",background:"color-mix(in srgb, currentColor 4%, transparent)",borderBottom:"1px solid var(--border-subtle)"},children:d.jsxs("div",{style:{display:"grid",gridTemplateColumns:n,gap:0,alignContent:"start",width:"fit-content",border:"1px solid var(--border-subtle)",borderRadius:"6px",overflow:"hidden"},children:[d.jsx("div",{style:{...r,borderBottom:"1px solid var(--border-subtle)"},children:"Total"}),d.jsx("div",{style:{...i,borderBottom:"1px solid var(--border-subtle)"},children:"="}),d.jsx("div",{style:{...r,borderBottom:"1px solid var(--border-subtle)"},children:"Cleared"}),d.jsx("div",{style:{...i,borderBottom:"1px solid var(--border-subtle)"},children:"+"}),d.jsx("div",{style:{...r,borderBottom:"1px solid var(--border-subtle)"},children:"Uncleared"}),d.jsx("div",{style:{...o,borderTop:"1px solid var(--border-subtle)",color:et(t.uncleared_balance)},children:zt(t.uncleared_balance)}),d.jsx("div",{style:{...i,borderTop:"1px solid var(--border-subtle)"},children:"="}),d.jsx("div",{style:{...o,borderTop:"1px solid var(--border-subtle)",color:et(t.cleared_balance)},children:zt(t.cleared_balance)}),d.jsx("div",{style:{...i,borderTop:"1px solid var(--border-subtle)"},children:"+"}),d.jsx("div",{style:{...o,borderTop:"1px solid var(--border-subtle)",color:qu(e)},children:zt(e)})]})})}function dL({account:t,balance:e,clearedBalance:n,hasUnclearedDetail:r}){const i=n?n.uncleared_balance-n.cleared_balance:0;return d.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",padding:"0.75rem",marginBottom:"0.25rem"},children:[d.jsx("div",{style:{marginBottom:"0.5rem"},children:d.jsx("span",{style:{fontWeight:500},children:t.nickname})}),d.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr 1fr",gap:"0.25rem",fontSize:"0.75rem"},children:[d.jsxs("div",{children:[d.jsx("span",{style:{opacity:.6,display:"block"},children:"Start"}),d.jsx("span",{children:zt(e.start_balance)})]}),d.jsxs("div",{children:[d.jsx("span",{style:{opacity:.6,display:"block"},children:"Net Change"}),d.jsx("span",{style:{color:et(e.net_change)},children:Qt(e.net_change)})]}),d.jsxs("div",{children:[d.jsx("span",{style:{opacity:.6,display:"block"},children:"End"}),d.jsx("span",{style:{color:et(e.end_balance)},children:zt(e.end_balance)})]}),d.jsxs("div",{children:[d.jsx("span",{style:{opacity:.6,display:"block"},children:"Total"}),n?d.jsx("span",{style:{color:et(n.uncleared_balance),fontWeight:600},children:zt(n.uncleared_balance)}):d.jsx("span",{style:{opacity:.3,color:"var(--text-muted)"},children:""})]})]}),r&&n&&d.jsxs("div",{style:{marginTop:"0.5rem",paddingTop:"0.5rem",borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)",display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",fontSize:"0.7rem",opacity:.85},children:[d.jsxs("span",{children:["Cleared: ",d.jsx("span",{style:{color:et(n.cleared_balance)},children:zt(n.cleared_balance)})]}),d.jsxs("span",{children:["Uncleared: ",d.jsx("span",{style:{color:qu(i)},children:zt(i)})]})]}),(e.income!==0||e.expenses!==0||e.transfers!==0||e.adjustments!==0)&&d.jsxs("div",{style:{marginTop:"0.5rem",paddingTop:"0.5rem",borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)",display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",fontSize:"0.7rem",opacity:.7},children:[e.income!==0&&d.jsxs("span",{children:[Qt(e.income)," income"]}),e.expenses!==0&&d.jsxs("span",{children:[Xn(e.expenses)," expenses"]}),e.transfers!==0&&d.jsxs("span",{children:[Qt(e.transfers)," transfers"]}),e.adjustments!==0&&d.jsxs("span",{children:[Qt(e.adjustments)," adjust"]})]})]})}const hL="5rem",bi={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem 0.5rem",borderBottom:"2px solid var(--border-medium)"},vi={fontVariantNumeric:"tabular-nums",whiteSpace:"nowrap",paddingLeft:"0.5rem",paddingRight:"0.5rem"};function fL(t){return t===0?me.zero:t>0?me.success:me.error}function mL(t){return t===0?me.zero:t<0?me.error:me.success}function sy(t){return t===0?me.zero:t>0?me.success:me.error}function pL(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n}=Ye(),{accounts:r,accountGroups:i}=Dn(),{month:o}=Xs(t,e,n),l=Li(),u=R.useMemo(()=>Object.entries(i).map(([C,T])=>({id:C,...T})).sort((C,T)=>C.sort_order-T.sort_order),[i]),h=R.useMemo(()=>{const C={};return Object.entries(r).filter(([,T])=>!T.is_hidden).forEach(([T,I])=>{const M=I.account_group_id||Vt;C[M]||(C[M]=[]),C[M].push([T,I])}),Object.keys(C).forEach(T=>{C[T].sort((I,M)=>I[1].sort_order-M[1].sort_order)}),C},[r]),f=R.useMemo(()=>K4(o,r),[o,r]),p=R.useMemo(()=>SA(o,r),[o,r]),g=R.useMemo(()=>Y4(f),[f]),b=g.income+g.expenses,_=R.useMemo(()=>Object.keys(p).length===0?null:Object.values(p).reduce((C,T)=>C+T.uncleared_balance,0),[p]),x={...{padding:"0.6rem 0.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem"},borderTop:"2px solid var(--border-strong)",borderBottom:"2px solid var(--border-strong)",fontWeight:600},S={...vi,justifyContent:"flex-end"};return d.jsx(d.Fragment,{children:d.jsxs("div",{style:{display:"grid",gridTemplateColumns:l?"1fr":`2fr repeat(8, minmax(${hL}, 1fr))`},children:[d.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"var(--sticky-header-bg)",display:l?"block":"grid",gridTemplateColumns:l?void 0:"subgrid"},children:[!l&&d.jsxs(d.Fragment,{children:[d.jsx("div",{style:{...bi,paddingLeft:"0.5rem",paddingRight:"0.5rem"},children:"Account"}),d.jsx("div",{style:{...bi,...vi,textAlign:"right"},children:"Start"}),d.jsx("div",{style:{...bi,...vi,textAlign:"right"},children:"Income"}),d.jsx("div",{style:{...bi,...vi,textAlign:"right"},children:"Expenses"}),d.jsx("div",{style:{...bi,...vi,textAlign:"right"},children:"Transfers"}),d.jsx("div",{style:{...bi,...vi,textAlign:"right"},children:"Adjust"}),d.jsx("div",{style:{...bi,...vi,textAlign:"right"},children:"Net Change"}),d.jsx("div",{style:{...bi,...vi,textAlign:"right"},children:"End"}),d.jsx("div",{style:{...bi,...vi,textAlign:"right"},children:"Total"})]}),l?d.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem",borderTop:"2px solid var(--border-strong)",borderBottom:"2px solid var(--border-strong)"},children:[d.jsx("span",{style:{fontWeight:600},children:"Grand Totals:"}),d.jsx(q4,{totals:g})]}):d.jsxs(d.Fragment,{children:[d.jsx("div",{style:{...x},children:"Grand Totals"}),d.jsx("div",{style:{...x,...S,color:et(g.start)},children:zt(g.start)}),d.jsxs("div",{style:{...x,...S,color:fL(g.income)},children:["+",Jt(g.income)]}),d.jsx("div",{style:{...x,...S,color:mL(g.expenses)},children:Xn(g.expenses)}),d.jsx("div",{style:{...x,...S,color:sy(g.transfers)},children:Qt(g.transfers)}),d.jsx("div",{style:{...x,...S,color:sy(g.adjustments)},children:Qt(g.adjustments)}),d.jsx("div",{style:{...x,...S,color:sy(b)},children:Qt(b)}),d.jsx("div",{style:{...x,...S,color:et(g.end)},children:zt(g.end)}),d.jsx("div",{style:{...x,...S,color:_!==null?et(_):void 0},children:_!==null?zt(_):d.jsx("span",{style:{opacity:.3,color:"var(--text-muted)"},children:""})})]})]}),Object.keys(r).length===0&&d.jsxs("p",{style:{gridColumn:"1 / -1",opacity:.6,textAlign:"center",padding:"2rem"},children:["No accounts yet."," ",d.jsx(jn,{to:"/budget/settings/accounts",style:{opacity:1},children:"Add accounts "})]}),u.map((C,T)=>{const I=h[C.id]||[];if(I.length===0)return null;const M=I.reduce((U,[H])=>{const O=f[H];return O?{start:U.start+O.start_balance,income:U.income+O.income,expenses:U.expenses+O.expenses,transfers:U.transfers+O.transfers,adjustments:U.adjustments+O.adjustments,netChange:U.netChange+O.net_change,end:U.end+O.end_balance}:U},{start:0,income:0,expenses:0,transfers:0,adjustments:0,netChange:0,end:0});return d.jsx(m1,{name:C.name,accounts:I,groupTotals:M,accountBalances:f,accountClearedBalances:p,isMobile:l,isFirstGroup:T===0},C.id)}),h[Vt]?.length>0&&(()=>{const C=h[Vt],T=C.reduce((M,[U])=>{const H=f[U];return H?{start:M.start+H.start_balance,income:M.income+H.income,expenses:M.expenses+H.expenses,transfers:M.transfers+H.transfers,adjustments:M.adjustments+H.adjustments,netChange:M.netChange+H.net_change,end:M.end+H.end_balance}:M},{start:0,income:0,expenses:0,transfers:0,adjustments:0,netChange:0,end:0}),I=u.length===0;return d.jsx(m1,{name:"Ungrouped",accounts:C,groupTotals:T,accountBalances:f,accountClearedBalances:p,isMobile:l,isUngrouped:!0,isFirstGroup:I},Vt)})(),d.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]})})}const gL=["income","categories","accounts","spend","transfers","adjustments"];function iy(t){const e=t.year?parseInt(t.year,10):null,n=t.month?parseInt(t.month,10):null,r=t.tab&&gL.includes(t.tab)?t.tab:null;return{year:e&&!isNaN(e)&&e>=2e3&&e<=2100?e:null,month:n&&!isNaN(n)&&n>=1&&n<=12?n:null,tab:r}}function yL(){const t=new Date;return{year:t.getFullYear(),month:t.getMonth()+1}}function p1(){const t=KR(),e=od(),[n,r]=V1(),{addLoadingHold:i,removeLoadingHold:o}=In(),{selectedBudgetId:l,setSelectedBudgetId:u,currentYear:h,currentMonthNumber:f,lastActiveTab:p,lastBalancesTab:g,lastTransactionsTab:b,setCurrentYear:_,setCurrentMonthNumber:w,setLastActiveTab:x,setPageTitle:S,goToPreviousMonth:C,goToNextMonth:T,hasPendingInvites:I,needsFirstBudget:M,initialDataLoadComplete:U}=Ye(),{budget:H,isLoading:O}=Dn(),P=!O&&!!H;o_(P&&!!l,{alwaysRecalculate:!0});const[N,V]=R.useState(!1);R.useEffect(()=>(!P||!U?i("budget-data","Loading budget data..."):o("budget-data"),()=>o("budget-data")),[P,U,i,o]);const $=R.useRef(!1),A=R.useRef(null),k=n.get("error"),[D,K]=R.useState(k);R.useEffect(()=>{k&&(n.delete("error"),r(n,{replace:!0}))},[k,n,r]);const X=R.useMemo(()=>{const{tab:ne}=iy(t);return ne??p},[t,p]),G=ne=>{e(`/budget/${h}/${f}/${ne}`),x(ne)};R.useEffect(()=>{const{tab:ne}=iy(t);ne!=null&&x(X)},[X,t,x]),R.useEffect(()=>{if($.current)return;const{year:ne,month:le}=iy(t);ne&&_(ne),le&&w(le),$.current=!0},[t,_,w]),R.useEffect(()=>{if(!$.current)return;const ne=`/budget/${h}/${f}/${X}`,le=`/budget/${t.year}/${t.month}/${t.tab}`;ne!==le&&e(ne,{replace:!0})},[h,f,X,e,t]);const{month:te,error:Q,isLoading:se}=Xs(P&&U?l:null,h,f);R.useEffect(()=>{if(!Q||N)return;const ne=Q.message||"";if(ne.includes("Budget")&&ne.includes("does not exist")){queueMicrotask(()=>{u(null),e("/budget/my-budgets?context=budget-not-found",{replace:!0})});return}(ne.includes("months in the past")||ne.includes("Refusing to create month"))&&queueMicrotask(()=>{i("month-redirect","Redirecting to current month..."),V(!0);const{year:le,month:he}=yL();K(`Cannot create month ${h}/${f} - it's too far in the past. Redirected to current month.`),_(le),w(he)})},[Q,N,h,f,_,w,i,u,e]),R.useEffect(()=>{N&&te&&!se&&queueMicrotask(()=>{V(!1),o("month-redirect")})},[N,te,se,o]),R.useLayoutEffect(()=>{S(H?.name||"Budget")},[H?.name,S]);const{setCurrentViewingDocument:B}=Ye();if(R.useEffect(()=>(H&&h&&f&&B({type:"month",year:h,month:f}),()=>{B({type:null})}),[H,h,f,B]),R.useEffect(()=>{if(P&&!N){if(!H&&!l){e("/budget/my-budgets",{replace:!0});return}if(!H&&I){e("/budget/my-budgets",{replace:!0});return}if(M){e("/budget/my-budgets",{replace:!0});return}}},[P,N,H,l,I,M,e]),BB(U?l:null,h,f),UB({budgetId:l,viewingYear:h,viewingMonth:f,initialDataLoadComplete:U,enabled:!!l&&U}),!P||!U||N||!H)return null;function q(){K(null),C()}function ee(){K(null),T()}return d.jsxs(d.Fragment,{children:[D&&d.jsx(s_,{message:D,onDismiss:()=>K(null)}),d.jsx(C4,{onPreviousMonth:q,onNextMonth:ee,onDownloadCategories:X==="categories"?()=>A.current?.():void 0}),d.jsx(g4,{activeTab:X,setActiveTab:G,lastBalancesTab:g,lastTransactionsTab:b,allocationsFinalized:te?.are_allocations_finalized}),X==="income"&&d.jsx(I4,{},`${h}-${f}`),X==="categories"&&d.jsx(eL,{registerDownloadCategories:ne=>{A.current=ne}},`${h}-${f}`),X==="accounts"&&d.jsx(pL,{},`${h}-${f}`),X==="spend"&&d.jsx(k4,{},`${h}-${f}`),X==="transfers"&&d.jsx(B4,{},`${h}-${f}`),X==="adjustments"&&d.jsx(L4,{},`${h}-${f}`)]})}function _L(){const{setPageTitle:t}=Ye();return R.useLayoutEffect(()=>{t("Analytics")},[t]),d.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"50vh",textAlign:"center",gap:"1.5rem"},children:[d.jsx("div",{style:{fontSize:"4rem",opacity:.8},children:""}),d.jsx("h1",{style:{margin:0,fontSize:"2rem",fontWeight:600},children:"Analytics"}),d.jsx("p",{style:{margin:0,fontSize:"1.25rem",opacity:.6,maxWidth:"400px"},children:"Coming Soon"}),d.jsx("p",{style:{margin:0,fontSize:"0.95rem",opacity:.5,maxWidth:"500px",lineHeight:1.6},children:"Track spending trends, category breakdowns, and insights about your budget over time."}),d.jsx(jn,{to:"/budget",style:{marginTop:"1rem",padding:"0.75rem 1.5rem",background:me.primary,color:"white",borderRadius:"8px",textDecoration:"none",fontWeight:500,transition:"opacity 0.15s"},children:"Back to Budget"})]})}function bL(){const t=Rt();return{createBudget:Cn({mutationFn:async({name:n,userId:r,userEmail:i})=>{const o=`budget_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,l=new Date().toISOString(),u={name:n.trim()||"My Budget",user_ids:[r],accepted_user_ids:[r],owner_id:r,owner_email:i,accounts:{},account_groups:{[Vt]:{name:"Ungrouped",sort_order:0,expected_balance:"positive",on_budget:null,is_active:null}},categories:{},category_groups:[{id:Xt,name:"Uncategorized",sort_order:0}],month_map:{},percentage_income_months_back:1,created_at:l,updated_at:l};return await Nr("budgets",o,u,"creating new budget document"),await Nr("users",r,{uid:r,email:i,budget_ids:ed(o),updated_at:l},"adding new budget to user's budget list",{merge:!0}),{budgetId:o,budget:{id:o,...u}}},onSuccess:(n,{userId:r})=>{t.invalidateQueries({queryKey:Ce.user(r)}),t.invalidateQueries({queryKey:Ce.accessibleBudgets(r)})}})}}function vL(){const t=Rt();return{acceptInvite:Cn({mutationFn:async({budgetId:n,userId:r})=>{const i=new Date().toISOString(),{exists:o,data:l}=await At("budgets",n,"validating user was invited to this budget");if(!o||!l)throw new Error("Budget not found");if(!l.user_ids?.includes(r))throw new Error("You have not been invited to this budget");if(l.accepted_user_ids?.includes(r))throw new Error("You have already accepted this invite");return await Nr("users",r,{uid:r,budget_ids:ed(n),updated_at:i},"adding accepted budget to user's budget list",{merge:!0}),await Nr("budgets",n,{accepted_user_ids:ed(r),updated_at:i},"marking user as accepted in budget's accepted_user_ids",{merge:!0}),{budgetId:n}},onSuccess:(n,{userId:r})=>{t.invalidateQueries({queryKey:Ce.user(r)}),t.invalidateQueries({queryKey:Ce.accessibleBudgets(r)}),t.invalidateQueries({queryKey:Ce.budget(n.budgetId)})}})}}function xL(){const t=Rt(),e=Cn({onMutate:async r=>{const{budgetId:i,userId:o}=r,l=Ce.budget(i);await t.cancelQueries({queryKey:l});const u=t.getQueryData(l);return u&&t.setQueryData(l,{...u,budget:{...u.budget,user_ids:[...u.budget.user_ids,o]}}),{previousData:u}},mutationFn:async r=>{const{budgetId:i,userId:o}=r,{exists:l,data:u}=await At("budgets",i,"validating user is not already invited");if(!l||!u)throw new Error("Budget not found");if(u.user_ids?.includes(o))throw new Error("User is already invited");return await el({budgetId:i,updates:{user_ids:ed(o)},description:"adding user to budget's invited users list"}),{budgetId:i}},onError:(r,i,o)=>{o?.previousData&&t.setQueryData(Ce.budget(i.budgetId),o.previousData)}});return{inviteUser:{mutate:r=>e.mutate(r),mutateAsync:r=>e.mutateAsync(r),isPending:e.isPending,isError:e.isError,error:e.error,reset:e.reset}}}function wL(){const t=Rt(),e=Cn({onMutate:async r=>{const{budgetId:i,userId:o}=r,l=Ce.budget(i);await t.cancelQueries({queryKey:l});const u=t.getQueryData(l);return u&&t.setQueryData(l,{...u,budget:{...u.budget,user_ids:u.budget.user_ids.filter(h=>h!==o),accepted_user_ids:u.budget.accepted_user_ids.filter(h=>h!==o)}}),{previousData:u}},mutationFn:async r=>{const{budgetId:i,userId:o}=r;return await el({budgetId:i,updates:{user_ids:FS(o),accepted_user_ids:FS(o)},description:"removing user from budget's access lists"}),{budgetId:i}},onError:(r,i,o)=>{o?.previousData&&t.setQueryData(Ce.budget(i.budgetId),o.previousData)}});return{revokeUser:{mutate:r=>e.mutate(r),mutateAsync:r=>e.mutateAsync(r),isPending:e.isPending,isError:e.isError,error:e.error,reset:e.reset}}}function SL({message:t,onDismiss:e}){return d.jsxs("div",{style:{background:"var(--color-error-bg)",border:"1px solid var(--color-error-border)",color:"var(--color-error)",padding:"0.75rem 1rem",borderRadius:"8px",marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[d.jsx("span",{children:t}),d.jsx("button",{onClick:e,style:{background:"transparent",border:"none",color:"var(--color-error)",cursor:"pointer",fontSize:"1.2rem",padding:"0 0.25rem",lineHeight:1},children:""})]})}function EL({message:t,onDismiss:e}){return d.jsxs("div",{style:{background:"var(--color-success-bg)",border:"1px solid var(--color-success-border)",color:"var(--color-success)",padding:"0.75rem 1rem",borderRadius:"8px",marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[d.jsx("span",{children:t}),d.jsx("button",{onClick:e,style:{background:"transparent",border:"none",color:"var(--color-success)",cursor:"pointer",fontSize:"1.2rem",padding:"0 0.25rem",lineHeight:1},children:""})]})}function CL({budgetIdInput:t,setBudgetIdInput:e,isCheckingManual:n,manualInvite:r,isAccepting:i,onCheckInvite:o,onAcceptInvite:l,onCancel:u}){return d.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px"},children:[d.jsxs("h3",{style:{margin:"0 0 0.75rem 0",fontSize:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[d.jsx("span",{children:""})," Join Budget by ID"]}),d.jsx("p",{style:{margin:"0 0 1rem 0",fontSize:"0.9rem",opacity:.7},children:"If someone shared a budget ID with you, enter it below to accept the invitation:"}),r?d.jsxs("div",{style:{background:"color-mix(in srgb, var(--color-success) 10%, transparent)",border:"1px solid color-mix(in srgb, var(--color-success) 30%, transparent)",padding:"1rem",borderRadius:"8px"},children:[d.jsx("p",{style:{margin:"0 0 0.75rem 0",fontWeight:500},children:" You've been invited to join:"}),d.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 8%, transparent)",padding:"0.75rem 1rem",borderRadius:"6px",marginBottom:"1rem"},children:[d.jsx("p",{style:{margin:"0 0 0.25rem 0",fontWeight:600,fontSize:"1.1rem"},children:r.budgetName}),r.ownerEmail&&d.jsxs("p",{style:{margin:0,fontSize:"0.9rem",opacity:.7},children:["Owner: ",r.ownerEmail]})]}),d.jsxs("div",{style:{display:"flex",gap:"0.75rem"},children:[d.jsx("button",{onClick:l,disabled:i===r.budgetId,style:{background:"var(--color-success)",color:"white",border:"none",padding:"0.6rem 1.25rem",borderRadius:"6px",cursor:i===r.budgetId?"not-allowed":"pointer",fontWeight:500,opacity:i===r.budgetId?.7:1},children:i===r.budgetId?"Accepting...":"Accept Invitation"}),d.jsx("button",{onClick:u,disabled:i===r.budgetId,style:{background:"transparent",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)",padding:"0.6rem 1.25rem",borderRadius:"6px",cursor:i===r.budgetId?"not-allowed":"pointer",fontWeight:500,opacity:i===r.budgetId?.7:.8},children:"Cancel"})]})]}):d.jsxs("form",{onSubmit:o,style:{display:"flex",gap:"0.75rem"},children:[d.jsx("input",{type:"text",value:t,onChange:h=>e(h.target.value),placeholder:"Enter Budget ID",style:{flex:1,padding:"0.6rem 0.8rem",borderRadius:"6px",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"0.95rem",color:"inherit"}}),d.jsx("button",{type:"submit",disabled:n||!t.trim(),style:{background:"var(--color-primary)",color:"white",border:"none",padding:"0.6rem 1.25rem",borderRadius:"6px",cursor:n||!t.trim()?"not-allowed":"pointer",fontWeight:500,opacity:n||!t.trim()?.7:1,whiteSpace:"nowrap"},children:n?"Checking...":"Check Invite"})]})]})}function TL({currentUserId:t}){return d.jsxs("div",{style:{marginTop:"1.5rem",padding:"1rem",background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"6px",fontSize:"0.85rem",opacity:.7},children:[d.jsx("p",{style:{margin:"0 0 0.5rem 0"},children:" Share your User ID with budget owners so they can invite you:"}),d.jsx("code",{style:{display:"block",padding:"0.5rem 0.75rem",background:"color-mix(in srgb, currentColor 8%, transparent)",borderRadius:"4px",fontSize:"0.8rem",wordBreak:"break-all"},children:t})]})}function AL(){const{addLoadingHold:t,removeLoadingHold:e}=In(),{selectedBudgetId:n,currentUserId:r,accessibleBudgets:i,loadAccessibleBudgets:o,switchToBudget:l,checkBudgetInvite:u,isInitialized:h,setPageTitle:f,needsFirstBudget:p}=Ye(),{requireUserEmail:g}=zi(),b=R.useRef(!1),[_,w]=V1(),x=_.get("context");R.useEffect(()=>{x&&(_.delete("context"),w(_,{replace:!0}))},[x,_,w]);const S=x==="budget-not-found",C=p&&i.length===0;R.useLayoutEffect(()=>{f("My Budgets")},[f]),R.useEffect(()=>{h&&!b.current&&(b.current=!0,o())},[h,o]);const{budget:T,isLoading:I}=Dn(),{renameBudget:M}=xB(),{acceptInvite:U}=vL(),{createBudget:H}=bL(),[O,P]=R.useState(null),[N,V]=R.useState(null),[$,A]=R.useState(null),[k,D]=R.useState(null),[K,X]=R.useState(null),[G,te]=R.useState(""),[Q,se]=R.useState(!1),[B,q]=R.useState(""),[ee,ne]=R.useState(!1),[le,he]=R.useState(null),[Ee,ae]=R.useState(""),[fe,Me]=R.useState(!1);async function Ne(ie){if(ie!==T?.id){P(ie),A(null),D(null);try{await l(ie),D("Switched to budget successfully!"),await o({force:!0})}catch(Re){A(Re instanceof Error?Re.message:"Failed to switch budget")}finally{P(null)}}}async function tt(ie){if(r){V(ie),A(null),D(null);try{await U.mutateAsync({budgetId:ie,userId:r}),D("Invitation accepted! You now have access to this budget."),await o({force:!0})}catch(Re){A(Re instanceof Error?Re.message:"Failed to accept invitation")}finally{V(null)}}}async function Ue(ie){if(ie.preventDefault(),!!B.trim()){ne(!0),A(null),he(null);try{const Re=await u(B.trim());Re?he(Re):A("No pending invitation found for this budget ID. Make sure you've been invited by the budget owner.")}catch(Re){A(Re instanceof Error?Re.message:"Failed to check invitation")}finally{ne(!1)}}}async function L(){if(!(!le||!r)){le.budgetName,V(le.budgetId),A(null);try{await U.mutateAsync({budgetId:le.budgetId,userId:r}),D(`Successfully joined "${le.budgetName}"!`),he(null),q(""),await o({force:!0})}catch(ie){A(ie instanceof Error?ie.message:"Failed to accept invitation")}finally{V(null)}}}function de(ie,Re){te(Re),X(ie)}async function _e(ie){if(ie.preventDefault(),!(!G.trim()||!K||!n)){G.trim(),se(!0),A(null),D(null);try{await M.mutateAsync({budgetId:n,newName:G.trim()}),D("Budget renamed successfully!"),X(null),await o({force:!0})}catch(Re){A(Re instanceof Error?Re.message:"Failed to rename budget")}finally{se(!1)}}}async function J(ie){if(ie.preventDefault(),!!r){Ee.trim(),Me(!0),A(null),D(null);try{const Re=await H.mutateAsync({name:Ee.trim()||"My Budget",userId:r,userEmail:g()});await l(Re.budgetId),D("Budget created successfully!"),ae(""),await o({force:!0})}catch(Re){A(Re instanceof Error?Re.message:"Failed to create budget")}finally{Me(!1)}}}const Z=i.filter(ie=>!ie.isPending),oe=i.filter(ie=>ie.isPending);if(R.useEffect(()=>(I||!h?t("my-budgets","Loading your budgets..."):e("my-budgets"),()=>e("my-budgets")),[I,h,t,e]),I||!h)return null;let Se="My Budgets",we="Switch between budgets, accept invitations, or create a new budget.";return S?(Se="Budget Not Found",we="Your selected budget could not be found. It may have been deleted. Select another budget or create a new one."):C&&(Se="Welcome!",we="Get started by creating your first budget or accepting an invitation."),d.jsxs("div",{children:[d.jsx("h1",{children:Se}),d.jsx("p",{style:{opacity:.7,marginBottom:"1.5rem"},children:we}),$&&d.jsx(SL,{message:$,onDismiss:()=>A(null)}),k&&d.jsx(EL,{message:k,onDismiss:()=>D(null)}),oe.length>0&&d.jsxs("div",{style:{background:"color-mix(in srgb, var(--color-warning) 10%, transparent)",border:"1px solid color-mix(in srgb, var(--color-warning) 30%, transparent)",padding:"1.25rem",borderRadius:"8px",marginBottom:"1.5rem"},children:[d.jsxs("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[d.jsx("span",{children:""})," Pending Invitations (",oe.length,")"]}),d.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:oe.map(ie=>d.jsx(t1,{budget:ie,isCurrent:!1,isAccepting:N===ie.id,isSwitching:!1,isEditing:!1,editName:"",isRenaming:!1,onAccept:()=>tt(ie.id),onSwitch:()=>{},onStartEdit:()=>{},onCancelEdit:()=>{},onEditNameChange:()=>{},onSaveEdit:()=>{}},ie.id))})]}),Z.length>0&&d.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px",marginBottom:"1.5rem"},children:[d.jsxs("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[d.jsx("span",{children:""})," Your Budgets (",Z.length,")"]}),d.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:Z.map(ie=>d.jsx(t1,{budget:ie,isCurrent:ie.id===n,isAccepting:!1,isSwitching:O===ie.id,isEditing:K===ie.id,editName:K===ie.id?G:"",isRenaming:Q,onAccept:()=>{},onSwitch:()=>Ne(ie.id),onStartEdit:()=>de(ie.id,ie.name),onCancelEdit:()=>{X(null),te("")},onEditNameChange:te,onSaveEdit:_e},ie.id))})]}),d.jsxs("div",{style:{background:"color-mix(in srgb, var(--color-primary) 8%, transparent)",border:"1px solid color-mix(in srgb, var(--color-primary) 25%, transparent)",padding:"1.5rem",borderRadius:"8px",marginBottom:"1.5rem"},children:[d.jsxs("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[d.jsx("span",{children:""})," Create New Budget"]}),d.jsxs("form",{onSubmit:J,children:[d.jsxs("div",{style:{marginBottom:"1rem"},children:[d.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.9rem",opacity:.8},children:"Budget Name"}),d.jsx("input",{type:"text",value:Ee,onChange:ie=>ae(ie.target.value),placeholder:"My Budget",style:{width:"100%",padding:"0.6rem 0.8rem",borderRadius:"6px",border:"1px solid color-mix(in srgb, currentColor 25%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"0.95rem",color:"inherit",boxSizing:"border-box"}}),d.jsx("p",{style:{margin:"0.5rem 0 0 0",fontSize:"0.8rem",opacity:.5},children:"You can always rename this later"})]}),d.jsx("button",{type:"submit",disabled:fe,style:{background:me.primary,color:"white",border:"none",padding:"0.6rem 1.5rem",borderRadius:"6px",cursor:fe?"not-allowed":"pointer",fontWeight:500,opacity:fe?.7:1,fontSize:"0.9rem"},children:fe?"Creating...":"Create Budget"})]})]}),d.jsx(CL,{budgetIdInput:B,setBudgetIdInput:q,isCheckingManual:ee,manualInvite:le,isAccepting:N,onCheckInvite:Ue,onAcceptInvite:L,onCancel:()=>{he(null),q("")}}),r&&d.jsx(TL,{currentUserId:r})]})}const jL=["general","accounts","categories","users"];function RL(){const{addLoadingHold:t,removeLoadingHold:e}=In(),{lastSettingsTab:n,setLastSettingsTab:r,setPageTitle:i,selectedBudgetId:o,setCurrentViewingDocument:l}=Ye();R.useLayoutEffect(()=>{i("Budget Settings")},[i]),R.useEffect(()=>(o&&l({type:"budget"}),()=>{l({type:null})}),[o,l]);const{isOwner:u,isLoading:h,isFetching:f}=Dn();R.useEffect(()=>(h||f?t("settings","Loading settings..."):e("settings"),()=>e("settings")),[h,f,t,e]);const p=tr(),g=p.pathname==="/budget/settings",b=R.useMemo(()=>{const C=p.pathname;return C.includes("/settings/general")?"general":C.includes("/settings/accounts")?"accounts":C.includes("/settings/categories")?"categories":C.includes("/settings/users")?"users":"general"},[p.pathname]),_=b==="users";R.useEffect(()=>{g||r(b)},[b,g,r]);function w(){return!jL.includes(n)||n==="users"&&!u?"general":n}const x=R.useMemo(()=>[{id:"general",label:"General",icon:""},{id:"accounts",label:"Accounts",icon:""},{id:"categories",label:"Categories",icon:""},{id:"users",label:"Users",icon:"",hidden:!u}],[u]);return h||f?null:!u&&_?d.jsxs("div",{children:[d.jsx("h1",{children:"Access Denied"}),d.jsx("p",{style:{opacity:.7},children:"Only the budget owner can access this section."}),d.jsx("p",{style:{marginTop:"1rem"},children:d.jsx(jn,{to:"/budget/settings/general",children:"Go to General "})})]}):d.jsxs("div",{children:[d.jsx(Wf,{mode:"link",linkPrefix:"/budget/settings",tabs:x,activeTab:g?w():b}),g?d.jsx(Kf,{to:`/budget/settings/${w()}`,replace:!0}):d.jsx(gA,{children:d.jsx(Yf,{})})]})}const ay=1,oy=12;function IL(){const{selectedBudgetId:t}=Ye(),{budget:e,isLoading:n}=Dn(),r=e?.percentage_income_months_back??1,[i,o]=R.useState(r),[l,u]=R.useState(!1),[h,f]=R.useState(null);R.useEffect(()=>{o(e?.percentage_income_months_back??1)},[e?.percentage_income_months_back]);const p=Math.min(oy,Math.max(ay,Math.round(Number(i))||1));async function g(){if(!t)return;const _=p;f(null),u(!0);try{await el({budgetId:t,updates:{percentage_income_months_back:_},description:"update percentage income months back"}),ze.setQueryData(Ce.budget(t),w=>w&&{...w,budget:{...w.budget,percentage_income_months_back:_}}),await PB(t,_,ze),o(_),f(null)}catch(w){const x=w instanceof Error?w.message:"Failed to save";console.error("[Settings/General] Failed to save percentage income months back:",w),qn.add({type:"error",message:"Failed to save setting. See console for details.",autoDismissMs:0}),f(x)}finally{u(!1)}}const b=p!==r;return n||!e?d.jsx("div",{style:{padding:"1rem"},children:d.jsx("p",{style:{opacity:.7},children:"Loading..."})}):d.jsxs("div",{style:{padding:"1rem",maxWidth:"32rem"},children:[d.jsx("h3",{style:{marginTop:0,marginBottom:"1rem"},children:"Budget behavior"}),d.jsxs("div",{style:{marginBottom:"1.5rem"},children:[d.jsx("label",{htmlFor:"percentage-income-months-back",style:{display:"block",marginBottom:"0.35rem",fontWeight:500},children:"Income reference for % allocations (months back)"}),d.jsx("p",{style:{fontSize:"0.85rem",opacity:.7,margin:"0 0 0.5rem 0"},children:"Percentage-based category allocations use income from this many months ago. Use 1 for previous month or 2 if you budget for the month after next."}),d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",flexWrap:"wrap"},children:[d.jsx("input",{id:"percentage-income-months-back",type:"number",min:ay,max:oy,value:i,onChange:_=>{const w=_.target.value;o(w===""?1:Math.min(oy,Math.max(ay,Math.round(Number(w))||1)))},style:{width:"4rem",padding:"0.4rem 0.5rem",fontSize:"1rem",border:"1px solid var(--border-medium)",borderRadius:"6px"}}),d.jsx("span",{style:{opacity:.7},children:"month(s) back"}),b&&d.jsx("button",{type:"button",onClick:g,disabled:l,style:{padding:"0.4rem 0.75rem",background:"var(--color-primary)",color:"white",border:"none",borderRadius:"6px",cursor:l?"not-allowed":"pointer",opacity:l?.7:1},children:l?"Saving":"Save"})]}),h&&d.jsx("p",{style:{marginTop:"0.5rem",color:"var(--color-error)",fontSize:"0.9rem"},"aria-live":"polite",children:"Save failed. See banner for details."})]}),d.jsx("p",{style:{fontSize:"0.8rem",opacity:.6},children:"Changing this only affects non-finalized allocation calculations. Finalized months keep their existing amounts."})]})}function g_({initialData:t,onSubmit:e,onCancel:n,submitLabel:r,accountGroups:i,showGroupSelector:o=!1,showIncomeSettings:l=!1,hasExistingIncomeDefault:u=!1,hasExistingOutgoDefault:h=!1,currentGroupId:f,onDelete:p}){const[g,b]=R.useState(t||{nickname:"",account_group_id:null,is_income_account:!1,is_income_default:!1,is_outgo_account:!1,is_outgo_default:!1,on_budget:!0,is_active:!0,is_hidden:!1}),_=g.account_group_id||f,w=_?i.find(M=>M.id===_):null,x=!!(w&&w.is_active!==null),S=!!(w&&w.on_budget!==null);function C(M){M.preventDefault(),g.nickname.trim()&&e(g)}function T(M){b({...g,is_income_account:M,is_income_default:M?g.is_income_default:!1})}function I(M){b({...g,is_outgo_account:M,is_outgo_default:M?g.is_outgo_default:!1})}return d.jsxs(Ni,{actionName:r==="Create Account"?"Create Account":"Update Account",onSubmit:C,children:[d.jsx(Bt,{label:"Account Nickname",htmlFor:"account-nickname",children:d.jsx(Pi,{id:"account-nickname",type:"text",value:g.nickname,onChange:M=>b({...g,nickname:M.target.value}),placeholder:"e.g., Main Checking, Savings",required:!0,autoFocus:!0})}),o&&d.jsx(Bt,{label:"Account Type",htmlFor:"account-group",children:d.jsxs(rd,{id:"account-group",value:g.account_group_id||Vt,onChange:M=>b({...g,account_group_id:M.target.value===Vt?null:M.target.value}),children:[d.jsx("option",{value:Vt,children:"Ungrouped"}),i.map(M=>d.jsx("option",{value:M.id,children:M.name},M.id))]})}),l&&d.jsxs("div",{style:{padding:"0.75rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",display:"flex",flexDirection:"column",gap:"0.75rem"},children:[d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[d.jsx("p",{style:{margin:0,fontSize:"0.85rem",opacity:.7},children:"Account Status"}),d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[d.jsx(Xr,{id:"is-active",checked:(()=>{if(x&&w){const M=w.is_active;return M===null||M===void 0?!1:M}return g.is_active??!0})(),onChange:M=>b({...g,is_active:M.target.checked}),disabled:x,children:d.jsx("span",{style:{opacity:x?.5:1},children:"Active account"})}),x&&w&&d.jsxs("p",{style:{margin:0,fontSize:"0.7rem",opacity:.6,marginLeft:"2rem",color:me.warning},children:['Set by account type "',w.name,'"']})]}),d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[d.jsx(Xr,{id:"on-budget",checked:(()=>{if(S&&w){const M=w.on_budget;return M===null||M===void 0?!1:M}return g.on_budget??!0})(),onChange:M=>b({...g,on_budget:M.target.checked}),disabled:S,children:d.jsx("span",{style:{opacity:S?.5:1},children:"On budget (affects budget totals)"})}),S&&w&&d.jsxs("p",{style:{margin:0,fontSize:"0.7rem",opacity:.6,marginLeft:"2rem",color:me.warning},children:['Set by account type "',w.name,'"']})]}),d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[d.jsx(Xr,{id:"is-hidden",checked:g.is_hidden||!1,onChange:M=>b({...g,is_hidden:M.target.checked}),children:"Hidden account"}),d.jsx("p",{style:{margin:0,fontSize:"0.7rem",opacity:.6,marginLeft:"2rem"},children:"Hidden accounts don't appear in dropdowns or balance displays. Use for historical accounts that aren't actively used."})]})]}),d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[d.jsx("p",{style:{margin:0,fontSize:"0.85rem",opacity:.7},children:"Income Settings"}),d.jsx(Xr,{id:"is-income-account",checked:g.is_income_account||!1,onChange:M=>T(M.target.checked),children:"Show in income deposit list"}),g.is_income_account&&d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem",marginLeft:"2rem"},children:[d.jsx(Xr,{id:"is-income-default",checked:g.is_income_default||!1,onChange:M=>b({...g,is_income_default:M.target.checked}),disabled:u&&!t?.is_income_default,children:"Default account for new income"}),u&&!t?.is_income_default&&d.jsx("p",{style:{margin:0,fontSize:"0.75rem",opacity:.5},children:"Another account is already set as default"})]})]}),d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[d.jsx("p",{style:{margin:0,fontSize:"0.85rem",opacity:.7},children:"Expense Settings"}),d.jsx(Xr,{id:"is-outgo-account",checked:g.is_outgo_account||!1,onChange:M=>I(M.target.checked),children:"Show in expense account list"}),g.is_outgo_account&&d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem",marginLeft:"2rem"},children:[d.jsx(Xr,{id:"is-outgo-default",checked:g.is_outgo_default||!1,onChange:M=>b({...g,is_outgo_default:M.target.checked}),disabled:h&&!t?.is_outgo_default,children:"Default account for new expenses"}),h&&!t?.is_outgo_default&&d.jsx("p",{style:{margin:0,fontSize:"0.75rem",opacity:.5},children:"Another account is already set as default"})]})]})]}),d.jsxs(Ya,{children:[d.jsx(qe,{type:"submit",actionName:r,children:r}),d.jsx(qe,{type:"button",variant:"secondary",actionName:"Cancel Account Form",onClick:n,children:"Cancel"}),p&&d.jsx(qe,{type:"button",variant:"secondary",actionName:"Delete Account",onClick:M=>{M.preventDefault(),p()},style:{color:"var(--color-validation-error)",borderColor:"var(--color-validation-error)"},children:" Delete"})]})]})}function g1({label:t,value:e,onChange:n,trueLabel:r,falseLabel:i,undefinedLabel:o}){function l(){n(e===void 0?!0:e===!0?!1:void 0)}const u=e===!0?r:e===!1?i:o,h=e===!0?me.success:e===!1?me.warning:"inherit",f=e===!0?"":e===!1?"":"";return d.jsxs("button",{type:"button",onClick:l,style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 0.75rem",background:e!==void 0?`color-mix(in srgb, ${h} 15%, transparent)`:"color-mix(in srgb, currentColor 8%, transparent)",border:e!==void 0?`1px solid color-mix(in srgb, ${h} 40%, transparent)`:"1px solid color-mix(in srgb, currentColor 20%, transparent)",borderRadius:"6px",cursor:"pointer",fontSize:"0.85rem",color:"inherit",textAlign:"left",width:"100%"},children:[d.jsx("span",{style:{width:"1.25rem",height:"1.25rem",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"4px",background:e!==void 0?h:"color-mix(in srgb, currentColor 20%, transparent)",color:e!==void 0?"white":"inherit",fontWeight:600,fontSize:"0.75rem"},children:f}),d.jsxs("span",{style:{flex:1},children:[d.jsxs("span",{style:{opacity:.7},children:[t,":"]})," ",d.jsx("span",{style:{fontWeight:500,color:h},children:u})]}),d.jsx("span",{style:{fontSize:"0.7rem",opacity:.5},children:"click to cycle"})]})}function y1({initialData:t,onSubmit:e,onCancel:n,submitLabel:r}){const[i,o]=R.useState(t||{name:"",expected_balance:"positive"});function l(u){u.preventDefault(),i.name.trim()&&e(i)}return d.jsxs(Ni,{actionName:r==="Create Account Type"?"Create Account Type":"Update Account Type",onSubmit:l,children:[d.jsx(Bt,{label:"Account Type Name",htmlFor:"group-name",children:d.jsx(Pi,{id:"group-name",type:"text",value:i.name,onChange:u=>o({...i,name:u.target.value}),placeholder:"e.g., Checking, Savings, Credit Cards, Investments",required:!0,autoFocus:!0})}),d.jsx(Bt,{label:"Expected Balance",htmlFor:"expected-balance",children:d.jsxs(rd,{id:"expected-balance",value:i.expected_balance,onChange:u=>o({...i,expected_balance:u.target.value}),children:[d.jsx("option",{value:"positive",children:"Normally Positive (e.g., Checking, Savings)"}),d.jsx("option",{value:"negative",children:"Normally Negative (e.g., Credit Cards, Loans)"}),d.jsx("option",{value:"any",children:"Either (no warnings)"})]})}),d.jsxs("div",{style:{padding:"0.75rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",display:"flex",flexDirection:"column",gap:"0.5rem"},children:[d.jsxs("p",{style:{margin:0,fontSize:"0.85rem",opacity:.7},children:["Group-Level Overrides ",d.jsx("span",{style:{fontSize:"0.75rem",opacity:.6},children:"(applies to all accounts in this type)"})]}),d.jsx(g1,{label:"Active status",value:i.is_active,onChange:u=>o({...i,is_active:u}),trueLabel:"All active",falseLabel:"All inactive",undefinedLabel:"Per account"}),d.jsx(g1,{label:"Budget status",value:i.on_budget,onChange:u=>o({...i,on_budget:u}),trueLabel:"All on budget",falseLabel:"All off budget",undefinedLabel:"Per account"})]}),d.jsxs(Ya,{children:[d.jsx(qe,{type:"submit",actionName:r,children:r}),d.jsx(qe,{type:"button",variant:"secondary",actionName:"Cancel Account Type Form",onClick:n,children:"Cancel"})]})]})}function $l({icon:t,label:e,variant:n,title:r}){const o={success:{background:`color-mix(in srgb, ${me.success} 20%, transparent)`,border:`1px solid color-mix(in srgb, ${me.success} 40%, transparent)`,color:me.success,opacity:1},warning:{background:`color-mix(in srgb, ${me.warning} 15%, transparent)`,border:`1px solid color-mix(in srgb, ${me.warning} 35%, transparent)`,color:me.warning,opacity:1},muted:{background:"color-mix(in srgb, currentColor 12%, transparent)",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",color:"inherit",opacity:.7},income:{background:`color-mix(in srgb, ${me.success} 10%, transparent)`,border:`1px solid color-mix(in srgb, ${me.success} 25%, transparent)`,color:me.success,opacity:.7},expense:{background:`color-mix(in srgb, ${me.warning} 10%, transparent)`,border:`1px solid color-mix(in srgb, ${me.warning} 25%, transparent)`,color:me.warning,opacity:.7}}[n];return d.jsxs("span",{title:r||e,style:{display:"inline-flex",alignItems:"center",gap:"0.25rem",background:o.background,border:o.border,padding:"0.15rem 0.4rem",borderRadius:"4px",fontSize:"0.7rem",fontWeight:500,textTransform:"uppercase",letterSpacing:"0.3px",color:o.color,opacity:o.opacity,whiteSpace:"nowrap"},children:[d.jsx("span",{style:{fontSize:"0.75rem"},children:t}),e]})}function _1({account:t,accountGroups:e}){const n=[],r=t.account_group_id?e.find(l=>l.id===t.account_group_id):null,i=r&&r.is_active!==null?r.is_active:t.is_active!==!1,o=r&&r.on_budget!==null?r.on_budget:t.on_budget!==!1;if(!i){const l=r&&r.is_active!==null;n.push(d.jsx($l,{icon:"",label:"Inactive",variant:"warning",title:l?`Set by "${r.name}" account type`:"Account is inactive/archived"},"inactive"))}if(!o){const l=r&&r.on_budget!==null;n.push(d.jsx($l,{icon:"",label:"Off Budget",variant:"warning",title:l?`Set by "${r.name}" account type`:"Tracking only - not included in budget"},"off-budget"))}return t.is_income_default?n.push(d.jsx($l,{icon:"",label:"Income Default",variant:"success",title:"Default income deposit account"},"income-default")):t.is_income_account&&n.push(d.jsx($l,{icon:"",label:"Income",variant:"income",title:"Income deposit account"},"income")),t.is_outgo_default?n.push(d.jsx($l,{icon:"",label:"Expense Default",variant:"warning",title:"Default expense account"},"outgo-default")):t.is_outgo_account&&n.push(d.jsx($l,{icon:"",label:"Expense",variant:"expense",title:"Expense account"},"outgo")),n.length===0?null:d.jsx(d.Fragment,{children:n})}function DL({account:t,accountIndex:e,allGroups:n,allAccounts:r,clearedBalance:i,onEdit:o,onDelete:l,onMoveUp:u,onMoveDown:h,canMoveUp:f,canMoveDown:p,editingAccountId:g,setEditingAccountId:b,onUpdateAccount:_,isMobile:w}){if(g===t.id)return d.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"0.5rem"},children:d.jsx(g_,{initialData:{nickname:t.nickname,account_group_id:t.account_group_id,is_income_account:t.is_income_account,is_income_default:t.is_income_default,is_outgo_account:t.is_outgo_account,is_outgo_default:t.is_outgo_default,on_budget:t.on_budget,is_active:t.is_active},onSubmit:T=>{_(t.id,T),b(null)},onCancel:()=>b(null),onDelete:()=>{t.nickname,l(t.id),b(null)},submitLabel:"Save",accountGroups:n,showGroupSelector:!0,showIncomeSettings:!0,currentGroupId:t.account_group_id,hasExistingIncomeDefault:Object.entries(r).some(([T,I])=>I.is_income_default&&T!==t.id),hasExistingOutgoDefault:Object.entries(r).some(([T,I])=>I.is_outgo_default&&T!==t.id)})});if(w)return d.jsx("div",{style:{gridColumn:"1 / -1"},children:d.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",padding:"0.75rem",marginBottom:"0.25rem"},children:[d.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"},children:[d.jsx("span",{style:{fontWeight:500},children:t.nickname}),d.jsx("div",{style:{display:"flex",gap:"1rem",fontSize:"0.85rem"},children:i?d.jsxs(d.Fragment,{children:[d.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[d.jsx("span",{style:{opacity:.6,fontSize:"0.7rem"},children:"Total"}),d.jsx("span",{style:{color:et(i.uncleared_balance),fontWeight:600},children:Xn(i.uncleared_balance)})]}),Math.abs(i.uncleared_balance-i.cleared_balance)>=.01?d.jsxs(d.Fragment,{children:[d.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[d.jsx("span",{style:{opacity:.6,fontSize:"0.7rem"},children:"Cleared"}),d.jsx("span",{style:{color:et(i.cleared_balance)},children:Xn(i.cleared_balance)})]}),d.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[d.jsx("span",{style:{opacity:.6,fontSize:"0.7rem"},children:"Uncleared"}),d.jsx("span",{style:{color:et(i.uncleared_balance-i.cleared_balance)},children:Xn(i.uncleared_balance-i.cleared_balance)})]})]}):d.jsxs(d.Fragment,{children:[d.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[d.jsx("span",{style:{opacity:.6,fontSize:"0.7rem"},children:"Cleared"}),d.jsx("span",{style:{opacity:.3,color:"var(--text-muted)"},children:""})]}),d.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[d.jsx("span",{style:{opacity:.6,fontSize:"0.7rem"},children:"Uncleared"}),d.jsx("span",{style:{opacity:.3,color:"var(--text-muted)"},children:""})]})]})]}):d.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:d.jsx("span",{style:{color:et(t.balance),fontWeight:600},children:Xn(t.balance)})})})]}),d.jsx("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap",marginBottom:"0.5rem"},children:d.jsx(_1,{account:t,accountGroups:n})}),d.jsxs("div",{style:{display:"flex",gap:"0.5rem",justifyContent:"flex-end"},children:[d.jsx("button",{onClick:T=>{T.stopPropagation(),t.nickname,o(t.id)},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Edit",children:""}),d.jsx("button",{onClick:T=>{T.stopPropagation(),u()},disabled:!f,style:{background:"transparent",border:"none",cursor:f?"pointer":"default",opacity:f?.6:.2,fontSize:"0.9rem",padding:"0.25rem"},title:"Move up",children:""}),d.jsx("button",{onClick:T=>{T.stopPropagation(),h()},disabled:!p,style:{background:"transparent",border:"none",cursor:p?"pointer":"default",opacity:p?.6:.2,fontSize:"0.9rem",padding:"0.25rem"},title:"Move down",children:""})]})]})});const S=e%2===0?"transparent":"var(--row-alt-bg)",C={padding:"0.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem"};return d.jsxs("div",{style:{gridColumn:"1 / -1",background:S,display:"grid",gridTemplateColumns:"2fr 1fr 1fr 1fr 1.5fr 1fr"},children:[d.jsx("div",{style:{...C,fontWeight:500,overflow:"hidden",paddingLeft:"1.5rem",borderLeft:"2px solid var(--border-subtle)"},children:d.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.nickname})}),i?d.jsx("div",{style:{...C,justifyContent:"flex-end",color:et(i.uncleared_balance),fontWeight:600},children:Xn(i.uncleared_balance)}):d.jsx("div",{style:{...C,justifyContent:"flex-end",color:et(t.balance),fontWeight:600},children:Xn(t.balance)}),i?d.jsx("div",{style:{...C,justifyContent:"flex-end",color:et(i.cleared_balance)},children:Math.abs(i.uncleared_balance-i.cleared_balance)<.01?d.jsx("span",{style:{opacity:.3,color:"var(--text-muted)"},children:""}):Xn(i.cleared_balance)}):d.jsx("div",{style:{...C,justifyContent:"flex-end",color:et(t.balance),fontWeight:600},children:Xn(t.balance)}),i&&Math.abs(i.uncleared_balance-i.cleared_balance)>=.01?d.jsx("div",{style:{...C,justifyContent:"flex-end",color:et(i.uncleared_balance-i.cleared_balance)},children:Xn(i.uncleared_balance-i.cleared_balance)}):d.jsx("div",{style:{...C,justifyContent:"flex-end",opacity:.3,color:"var(--text-muted)"},children:""}),d.jsx("div",{style:{...C,gap:"0.25rem",flexWrap:"wrap"},children:d.jsx(_1,{account:t,accountGroups:n})}),d.jsxs("div",{style:{...C,justifyContent:"flex-end",gap:"0.25rem"},children:[d.jsx("button",{onClick:T=>{T.stopPropagation(),t.nickname,o(t.id)},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Edit",children:""}),d.jsx("button",{onClick:T=>{T.stopPropagation(),u()},disabled:!f,style:{background:"transparent",border:"none",cursor:f?"pointer":"default",opacity:f?.6:.2,fontSize:"0.9rem",padding:"0.25rem"},title:"Move up",children:""}),d.jsx("button",{onClick:T=>{T.stopPropagation(),h()},disabled:!p,style:{background:"transparent",border:"none",cursor:p?"pointer":"default",opacity:p?.6:.2,fontSize:"0.9rem",padding:"0.25rem"},title:"Move down",children:""})]})]})}function b1({group:t,accounts:e,allGroups:n,allAccounts:r,accountClearedBalances:i,editingAccountId:o,createForGroupId:l,setEditingAccountId:u,setCreateForGroupId:h,onUpdateAccount:f,onDeleteAccount:p,onMoveAccount:g,onCreateAccount:b,isMobile:_,isUngrouped:w,canMoveGroupUp:x,canMoveGroupDown:S,onEditGroup:C,onDeleteGroup:T,onMoveGroupUp:I,onMoveGroupDown:M}){const U=[...e].sort((O,P)=>O.sort_order-P.sort_order);U.reduce((O,P)=>O+P.balance,0);const H={padding:"0.6rem 0.5rem",marginTop:"1.25rem",borderTop:"1px solid var(--border-medium)",borderBottom:qa,background:"var(--row-alt-bg)",display:"flex",alignItems:"center",fontSize:"0.9rem",fontWeight:600};return d.jsxs("div",{style:{display:"contents"},children:[!_&&d.jsxs(d.Fragment,{children:[d.jsxs("div",{style:{...H,opacity:w?.7:1,justifyContent:"space-between"},children:[d.jsxs("span",{children:[d.jsx("span",{children:t.name}),d.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",U.length,")"]})]}),d.jsx("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center",flexShrink:0},children:!w&&d.jsxs(d.Fragment,{children:[d.jsx(qe,{variant:"small",actionName:`Open Add Account Form (${t.name})`,onClick:()=>h(t.id),disabled:l!==null,children:"+ Account"}),d.jsx("button",{onClick:()=>{t.name,C()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Edit account type",children:""}),d.jsx("button",{onClick:()=>{t.name,T()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Delete account type",children:""}),d.jsxs("div",{style:Hf,children:[d.jsx("button",{onClick:I,disabled:!x,style:{...Ca,opacity:x?.6:.2,cursor:x?"pointer":"default"},title:"Move up","aria-label":"Move up",children:""}),d.jsx("button",{onClick:M,disabled:!S,style:{...Ca,opacity:S?.6:.2,cursor:S?"pointer":"default"},title:"Move down","aria-label":"Move down",children:""})]})]})})]}),d.jsx("div",{style:H}),d.jsx("div",{style:H}),d.jsx("div",{style:H}),d.jsx("div",{style:H}),d.jsx("div",{style:H})]}),_&&d.jsxs("div",{style:{gridColumn:"1 / -1",padding:"0.6rem 0.5rem",marginTop:"1.25rem",borderTop:"1px solid var(--border-medium)",borderBottom:qa,background:"var(--row-alt-bg)"},children:[d.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"},children:[d.jsxs("span",{style:{fontWeight:600,opacity:w?.7:1},children:[t.name,d.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",U.length,")"]})]}),an.showGroupTotals]}),!w&&d.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center",flexWrap:"wrap"},children:[d.jsx(qe,{variant:"small",actionName:`Open Add Account Form (${t.name})`,onClick:()=>h(t.id),disabled:l!==null,children:"+ Account"}),d.jsx("button",{onClick:()=>{t.name,C()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Edit account type",children:""}),d.jsx("button",{onClick:()=>{t.name,T()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Delete account type",children:""}),d.jsxs("div",{style:Hf,children:[d.jsx("button",{onClick:I,disabled:!x,style:{...Ca,opacity:x?.6:.2,cursor:x?"pointer":"default"},title:"Move up","aria-label":"Move up",children:""}),d.jsx("button",{onClick:M,disabled:!S,style:{...Ca,opacity:S?.6:.2,cursor:S?"pointer":"default"},title:"Move down","aria-label":"Move down",children:""})]})]})]}),U.map((O,P)=>d.jsx(DL,{account:O,accountIndex:P,totalAccounts:U.length,allGroups:n,allAccounts:r,clearedBalance:i?.[O.id],onEdit:u,onDelete:p,onMoveUp:()=>g(O.id,"up"),onMoveDown:()=>g(O.id,"down"),canMoveUp:P>0,canMoveDown:P<U.length-1,editingAccountId:o,setEditingAccountId:u,onUpdateAccount:f,isMobile:_},O.id)),l===t.id&&d.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"0.5rem"},children:d.jsx(g_,{initialData:{nickname:"",account_group_id:t.id},onSubmit:O=>b(O,t.id),onCancel:()=>h(null),submitLabel:"Create",accountGroups:n,showIncomeSettings:!0,currentGroupId:t.id})})]})}function kL({hiddenAccounts:t,accounts:e,sortedGroups:n,editingAccountId:r,setEditingAccountId:i,onUpdateAccount:o}){return t.length===0?null:d.jsx("div",{style:{marginBottom:"2rem"},children:d.jsxs(d_,{title:"Hidden Accounts",count:t.length,children:[d.jsxs("div",{style:{padding:"0.75rem",marginBottom:"1rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",fontSize:"0.85rem"},children:[d.jsxs("p",{style:{margin:"0 0 0.5rem 0",opacity:.8},children:[d.jsx("strong",{children:" Hidden accounts"})," are excluded from dropdowns and balance displays. They're useful for historical accounts (like closed bank accounts or old 401Ks) that you want to keep for record-keeping but don't need in everyday use."]}),d.jsx("p",{style:{margin:0,opacity:.6},children:'To unhide an account, click it to edit and uncheck "Hidden account".'})]}),d.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:t.map(l=>r===l.id?d.jsx(g_,{initialData:{nickname:l.nickname,account_group_id:l.account_group_id,is_income_account:l.is_income_account,is_income_default:l.is_income_default,is_outgo_account:l.is_outgo_account,is_outgo_default:l.is_outgo_default,on_budget:l.on_budget,is_active:l.is_active,is_hidden:l.is_hidden},onSubmit:u=>{o(l.id,u),i(null)},onCancel:()=>i(null),submitLabel:"Save",accountGroups:n,showGroupSelector:!0,showIncomeSettings:!0,currentGroupId:l.account_group_id,hasExistingIncomeDefault:Object.entries(e).some(([u,h])=>h.is_income_default&&u!==l.id),hasExistingOutgoDefault:Object.entries(e).some(([u,h])=>h.is_outgo_default&&u!==l.id)},l.id):d.jsxs("div",{onClick:()=>i(l.id),style:{padding:"0.75rem 1rem",background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"8px",cursor:"pointer",display:"flex",justifyContent:"space-between",alignItems:"center",opacity:.7},children:[d.jsx("span",{children:l.nickname}),d.jsx("span",{style:{color:et(l.balance),fontWeight:500},children:Xn(l.balance)})]},l.id))})]})})}function ML(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n}=Ye(),{isLoading:r,isFetching:i,accounts:o,getOnBudgetTotal:l,totalAvailable:u}=Dn(),{month:h}=Xs(t,e,n),{accounts:f,accountsByGroup:p,hiddenAccounts:g,sortedGroups:b,currentBudget:_,error:w,setError:x,handleCreateAccount:S,handleUpdateAccount:C,handleDeleteAccount:T,handleMoveAccount:I,handleCreateGroup:M,handleUpdateGroup:U,handleDeleteGroup:H,handleMoveGroup:O}=SB(),P=Li(),{addLoadingHold:N,removeLoadingHold:V}=In(),$=r||i||!_;o_(!$&&!!_),R.useEffect(()=>($?N("accounts","Loading accounts..."):V("accounts"),()=>V("accounts")),[$,N,V]);const[A,k]=R.useState(null),[D,K]=R.useState(null),[X,G]=R.useState(null),[te,Q]=R.useState(!1),se=R.useMemo(()=>{const he=Object.values(f),Ee=he.reduce((Ne,tt)=>Ne+(tt.balance??0),0);let ae=0,fe=0;const Me=Object.fromEntries(b.map(Ne=>[Ne.id,Ne]));for(const Ne of he)jm(Ne,Me)?ae+=Ne.balance??0:fe+=Ne.balance??0;return{count:he.length,groupCount:b.filter(Ne=>Ne.id!==Vt).length,totalBalance:Ee,onBudgetTotal:ae,offBudgetTotal:fe}},[f,b]),B=R.useMemo(()=>b.filter(he=>he.id!==Vt),[b]),q=R.useMemo(()=>({id:Vt,name:"Ungrouped",sort_order:B.length,expected_balance:"any",on_budget:null,is_active:null}),[B.length]),ee=p[Vt]||[],ne=R.useMemo(()=>h?SA(h,o):{},[h,o]),le={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",paddingTop:"0.75rem",paddingBottom:"0.5rem",paddingLeft:"0.5rem",paddingRight:"0.5rem",borderBottom:"2px solid var(--border-medium)"};return R.useEffect(()=>{w&&(console.error("[Settings/Accounts] Error:",w),qn.add({type:"error",message:"Failed to update accounts. See console for details.",autoDismissMs:0}),x(null))},[w,x]),$||!_?$?null:d.jsx("p",{children:"No budget found. Please log in."}):d.jsxs("div",{children:[d.jsxs("div",{style:{display:"grid",gridTemplateColumns:P?"1fr":"2fr 1fr 1fr 1fr 1.5fr 1fr",marginBottom:"1.5rem"},children:[d.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:50,backgroundColor:"var(--sticky-header-bg)",display:P?"block":"grid",gridTemplateColumns:P?void 0:"subgrid"},children:[d.jsx("div",{style:{gridColumn:"1 / -1",marginLeft:"calc(-1 * var(--page-padding, 2rem))",marginRight:"calc(-1 * var(--page-padding, 2rem))",paddingLeft:"var(--page-padding, 2rem)",paddingRight:"var(--page-padding, 2rem)",paddingTop:"0.5rem",paddingBottom:"0.5rem"},children:d.jsx("div",{style:{display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingBottom:"0.5rem",borderBottom:"1px solid var(--border-medium)"},children:d.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[d.jsx("span",{style:{fontWeight:600},children:"Accounts:"}),d.jsxs("span",{children:[d.jsx("span",{style:{opacity:.6},children:"On-Budget: "}),d.jsx("span",{style:{color:et(se.onBudgetTotal),fontWeight:600},children:Ft(se.onBudgetTotal)})]}),se.offBudgetTotal!==0&&d.jsxs("span",{children:[d.jsx("span",{style:{opacity:.6},children:"Off-Budget: "}),d.jsx("span",{style:{fontWeight:600,opacity:.7},children:Ft(se.offBudgetTotal)})]}),d.jsxs("span",{children:[d.jsx("span",{style:{opacity:.6},children:"Total: "}),d.jsx("span",{style:{color:et(se.totalBalance),fontWeight:600},children:Ft(se.totalBalance)})]}),d.jsxs("span",{style:{marginLeft:"0.5rem",paddingLeft:"0.5rem",borderLeft:"1px solid var(--border-medium)"},children:[d.jsx("span",{style:{opacity:.6},children:"On-Budget: "}),d.jsx("span",{style:{color:et(l()),fontWeight:600},children:Ft(l())}),d.jsx("span",{style:{opacity:.6},children:"  Allocated: "}),d.jsx("span",{style:{fontWeight:600},children:Ft(l()-u)}),d.jsx("span",{style:{opacity:.6},children:" = Avail: "}),d.jsx("span",{style:{color:et(u),fontWeight:600},children:Ft(u)})]})]})})}),!P&&d.jsxs(d.Fragment,{children:[d.jsx("div",{style:le,children:"Account"}),d.jsx("div",{style:{...le,textAlign:"right"},children:"Total"}),d.jsx("div",{style:{...le,textAlign:"right"},children:"Cleared"}),d.jsx("div",{style:{...le,textAlign:"right"},children:"Uncleared"}),d.jsx("div",{style:le,children:"Flags"}),d.jsx("div",{style:{...le,textAlign:"right"},children:"Actions"})]})]}),Object.keys(f).length===0&&B.length===0&&d.jsx("p",{style:{gridColumn:"1 / -1",opacity:.7,textAlign:"center",padding:"2rem"},children:"No accounts yet. Create an account type first, then add accounts!"}),B.map((he,Ee)=>{const ae=p[he.id]||[];return ae.length===0&&X!==he.id&&D!==he.id?null:X===he.id?d.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"1rem"},children:d.jsx(y1,{initialData:{name:he.name,expected_balance:he.expected_balance||"positive",on_budget:he.on_budget??void 0,is_active:he.is_active??void 0},onSubmit:fe=>{U(he.id,fe),G(null)},onCancel:()=>G(null),submitLabel:"Save"})},he.id):d.jsx(b1,{group:he,accounts:ae,allGroups:B,allAccounts:f,accountClearedBalances:ne,editingAccountId:A,createForGroupId:D,setEditingAccountId:k,setCreateForGroupId:K,onUpdateAccount:(fe,Me)=>{C(fe,Me),k(null)},onDeleteAccount:T,onMoveAccount:I,onCreateAccount:S,isMobile:P,canMoveGroupUp:Ee>0,canMoveGroupDown:Ee<B.length-1,onEditGroup:()=>G(he.id),onDeleteGroup:()=>H(he.id),onMoveGroupUp:()=>O(he.id,"up"),onMoveGroupDown:()=>O(he.id,"down")},he.id)}),(ee.length>0||D==="ungrouped")&&d.jsx(b1,{group:q,accounts:ee,allGroups:B,allAccounts:f,accountClearedBalances:ne,editingAccountId:A,createForGroupId:D,setEditingAccountId:k,setCreateForGroupId:K,onUpdateAccount:(he,Ee)=>{C(he,Ee),k(null)},onDeleteAccount:T,onMoveAccount:I,onCreateAccount:S,isMobile:P,isUngrouped:!0,canMoveGroupUp:!1,canMoveGroupDown:!1,onEditGroup:()=>{},onDeleteGroup:()=>{},onMoveGroupUp:()=>{},onMoveGroupDown:()=>{}}),d.jsx("div",{style:{gridColumn:"1 / -1",height:"1rem"}})]}),d.jsx(kL,{hiddenAccounts:g,accounts:f,sortedGroups:B,editingAccountId:A,setEditingAccountId:k,onUpdateAccount:C}),te?d.jsx(y1,{onSubmit:he=>{M(he),Q(!1)},onCancel:()=>Q(!1),submitLabel:"Create Account Type"}):d.jsx(qe,{variant:"primary-large",actionName:"Open Add Account Type Form",onClick:()=>Q(!0),children:"+ Add Account Type"})]})}function y_({initialData:t,onSubmit:e,onCancel:n,submitLabel:r,categoryGroups:i=[],showGroupSelector:o=!1,onDelete:l}){const[u,h]=R.useState(t||{name:"",category_group_id:null,is_hidden:!1}),[f,p]=R.useState(t?.default_monthly_amount?.toString()||""),[g,b]=R.useState(t?.default_monthly_type||"fixed"),[_,w]=R.useState(!1);function x(S){if(S.preventDefault(),!u.name.trim())return;w(!0);const C=parseFloat(f),T=!isNaN(C)&&C>0;Promise.resolve(e({...u,description:u.description?.trim()||void 0,default_monthly_amount:T?C:void 0,default_monthly_type:T?g:void 0})).catch(I=>{console.error("[CategoryForm] Error submitting form:",I)}).finally(()=>{w(!1)}),n()}return d.jsxs(Ni,{actionName:r==="Create"?"Create Category":"Update Category",onSubmit:x,children:[d.jsx(Bt,{label:"Category Name",htmlFor:"category-name",children:d.jsx(Pi,{id:"category-name",type:"text",value:u.name,onChange:S=>h({...u,name:S.target.value}),placeholder:"e.g., Groceries, Rent, Gas",required:!0,autoFocus:!0})}),d.jsx(Bt,{label:"Description (optional)",htmlFor:"category-description",children:d.jsx(a_,{id:"category-description",value:u.description||"",onChange:S=>h({...u,description:S.target.value}),placeholder:"What is this category used for?",minHeight:"3rem"})}),o&&d.jsx(Bt,{label:"Category Group",htmlFor:"category-group",children:d.jsxs(rd,{id:"category-group",value:u.category_group_id||Xt,onChange:S=>h({...u,category_group_id:S.target.value===Xt?null:S.target.value}),children:[d.jsx("option",{value:Xt,children:"Uncategorized"}),i.map(S=>d.jsx("option",{value:S.id,children:S.name},S.id))]})}),d.jsxs(Bt,{label:"Default Monthly Allocation (optional)",htmlFor:"default-amount",children:[d.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center"},children:[d.jsxs(rd,{id:"default-type",value:g,onChange:S=>b(S.target.value),style:{width:"auto",flex:"0 0 auto"},children:[d.jsx("option",{value:"fixed",children:"Fixed $"}),d.jsx("option",{value:"percentage",children:"% of Prev Income"})]}),g==="fixed"?d.jsx(No,{id:"default-amount",value:f,onChange:p,placeholder:"$0.00"}):d.jsx(Pi,{id:"default-amount",type:"number",value:f,onChange:S=>p(S.target.value),placeholder:"0",min:"0",max:"100",step:"0.1",style:{width:"80px"}}),g==="percentage"&&d.jsx("span",{style:{opacity:.6},children:"%"})]}),d.jsx("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.75rem",opacity:.6},children:g==="fixed"?"Suggested fixed amount to allocate each month":"Percentage of previous month's total income"})]}),o&&d.jsxs("div",{style:{padding:"0.75rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px"},children:[d.jsx(Xr,{id:"is-hidden",checked:u.is_hidden||!1,onChange:S=>h({...u,is_hidden:S.target.checked}),children:"Hidden category"}),d.jsx("p",{style:{margin:"0.25rem 0 0 2rem",fontSize:"0.7rem",opacity:.6},children:"Hidden categories don't appear in dropdowns or balance displays. Use for historical categories that aren't actively used."})]}),d.jsxs(Ya,{children:[d.jsx(qe,{type:"submit",actionName:r==="Create"?"Create Category":"Save Category",isLoading:_,children:r}),d.jsx(qe,{type:"button",variant:"secondary",actionName:"Cancel Category Form",onClick:n,children:"Cancel"}),l&&d.jsx(qe,{type:"button",variant:"secondary",actionName:"Delete Category",onClick:S=>{S.preventDefault(),l()},style:{color:"var(--color-validation-error)",borderColor:"var(--color-validation-error)"},children:" Delete"})]})]})}function v1({initialData:t,onSubmit:e,onCancel:n,submitLabel:r}){const[i,o]=R.useState(t||{name:""}),[l,u]=R.useState(!1);function h(f){f.preventDefault(),i.name.trim()&&(u(!0),e(i))}return d.jsxs(Ni,{actionName:r==="Create Group"?"Create Category Group":"Update Category Group",onSubmit:h,children:[d.jsx(Bt,{label:"Group Name",htmlFor:"group-name",children:d.jsx(Pi,{id:"group-name",type:"text",value:i.name,onChange:f=>o({...i,name:f.target.value}),placeholder:"e.g., Housing, Transportation, Food",required:!0,autoFocus:!0})}),d.jsxs(Ya,{children:[d.jsx(qe,{type:"submit",actionName:r==="Create Group"?"Create Category Group":"Save Category Group",isLoading:l,children:r}),d.jsx(qe,{type:"button",variant:"secondary",actionName:"Cancel Category Group Form",onClick:n,children:"Cancel"})]})]})}function OL({category:t,catId:e,categoryIndex:n,categoryGroups:r,categoryBalances:i,loadingBalances:o,onEdit:l,onDelete:u,onMoveUp:h,onMoveDown:f,canMoveUp:p,canMoveDown:g,editingCategoryId:b,setEditingCategoryId:_,onUpdateCategory:w,isMobile:x}){const S=i[e]||{current:0,total:0};if(b===e)return d.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"0.5rem"},children:d.jsx(y_,{initialData:{name:t.name,description:t.description,category_group_id:t.category_group_id,default_monthly_amount:t.default_monthly_amount,default_monthly_type:t.default_monthly_type,is_hidden:t.is_hidden},onSubmit:M=>{w(e,M),_(null)},onCancel:()=>_(null),onDelete:()=>{t.name,u(e),_(null)},submitLabel:"Save",categoryGroups:r,showGroupSelector:!0})});if(x)return d.jsx("div",{style:{gridColumn:"1 / -1"},children:d.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",padding:"0.75rem",marginBottom:"0.25rem"},children:[d.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"},children:[d.jsx("span",{style:{fontWeight:500},children:t.name}),d.jsxs("div",{style:{display:"flex",gap:"1rem",fontSize:"0.85rem"},children:[t.default_monthly_amount!==void 0&&t.default_monthly_amount>0&&d.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[d.jsx("span",{style:{opacity:.6,fontSize:"0.7rem"},children:"Default"}),d.jsx("span",{style:{opacity:.7},children:t.default_monthly_type==="percentage"?`${t.default_monthly_amount}%`:`${Jt(t.default_monthly_amount)}/mo`})]}),d.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[d.jsx("span",{style:{opacity:.6,fontSize:"0.7rem"},children:"Available Now"}),d.jsx("span",{style:{color:hn(S.current),fontWeight:600},children:o?"...":zt(S.current)})]}),d.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[d.jsx("span",{style:{opacity:.6,fontSize:"0.7rem"},children:"Total Allocated"}),d.jsx("span",{style:{color:hn(S.total)},children:o?"...":zt(S.total)})]})]})]}),t.description&&d.jsx("p",{style:{fontSize:"0.8rem",opacity:.6,margin:"0 0 0.5rem 0"},children:t.description}),t.default_monthly_amount!==void 0&&t.default_monthly_amount>0&&d.jsxs("div",{style:{fontSize:"0.75rem",opacity:.8,marginBottom:"0.5rem"},children:["Default: ",t.default_monthly_type==="percentage"?d.jsxs(d.Fragment,{children:[d.jsxs("span",{style:{color:me.success,fontWeight:500},children:[t.default_monthly_amount,"%"]})," of prev income"]}):d.jsxs(d.Fragment,{children:[d.jsx("span",{style:{color:me.success,fontWeight:500},children:t.default_monthly_amount}),"/mo"]})]}),d.jsxs("div",{style:{display:"flex",gap:"0.5rem",justifyContent:"flex-end"},children:[d.jsx("button",{onClick:M=>{M.stopPropagation(),t.name,l(e)},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Edit",children:""}),d.jsx("button",{onClick:M=>{M.stopPropagation(),h()},disabled:!p,style:{background:"transparent",border:"none",cursor:p?"pointer":"default",opacity:p?.6:.2,fontSize:"0.9rem",padding:"0.25rem"},title:"Move up",children:""}),d.jsx("button",{onClick:M=>{M.stopPropagation(),f()},disabled:!g,style:{background:"transparent",border:"none",cursor:g?"pointer":"default",opacity:g?.6:.2,fontSize:"0.9rem",padding:"0.25rem"},title:"Move down",children:""})]})]})});const T=n%2===0?"transparent":"var(--row-alt-bg)",I={padding:"0.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem"};return d.jsxs("div",{style:{gridColumn:"1 / -1",background:T,display:"grid",gridTemplateColumns:"2fr 1fr 1fr 1fr 2fr 1fr"},children:[d.jsx("div",{style:{...I,fontWeight:500,overflow:"hidden",paddingLeft:"1.5rem",borderLeft:"2px solid var(--border-subtle)"},children:d.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.name})}),d.jsx("div",{style:{...I,justifyContent:"flex-end",opacity:.7,fontSize:"0.85rem"},children:t.default_monthly_amount!==void 0&&t.default_monthly_amount>0?d.jsx("span",{children:t.default_monthly_type==="percentage"?`${t.default_monthly_amount}%`:`${zt(t.default_monthly_amount)}/mo`}):d.jsx("span",{style:{opacity:.3,fontStyle:"italic",color:"var(--text-muted)"},children:""})}),d.jsx("div",{style:{...I,justifyContent:"flex-end",color:hn(S.current),fontWeight:600},children:o?"...":zt(S.current)}),d.jsx("div",{style:{...I,justifyContent:"flex-end",color:hn(S.total)},children:o?"...":zt(S.total)}),d.jsx("div",{style:{...I,opacity:.7,fontSize:"0.85rem"},children:t.description?d.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.description}):d.jsx("span",{style:{opacity:.3,fontStyle:"italic",color:"var(--text-muted)"},children:""})}),d.jsxs("div",{style:{...I,justifyContent:"flex-end",gap:"0.25rem"},children:[d.jsx("button",{onClick:M=>{M.stopPropagation(),t.name,l(e)},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Edit",children:""}),d.jsx("button",{onClick:M=>{M.stopPropagation(),h()},disabled:!p,style:{background:"transparent",border:"none",cursor:p?"pointer":"default",opacity:p?.6:.2,fontSize:"0.9rem",padding:"0.25rem"},title:"Move up",children:""}),d.jsx("button",{onClick:M=>{M.stopPropagation(),f()},disabled:!g,style:{background:"transparent",border:"none",cursor:g?"pointer":"default",opacity:g?.6:.2,fontSize:"0.9rem",padding:"0.25rem"},title:"Move down",children:""})]})]})}function x1({group:t,categories:e,categoryGroups:n,categoryBalances:r,loadingBalances:i,editingCategoryId:o,createForGroupId:l,setEditingCategoryId:u,setCreateForGroupId:h,handleUpdateCategory:f,handleDeleteCategory:p,handleMoveCategory:g,handleCreateCategory:b,isMobile:_,isUngrouped:w,startRowIndex:x=0,canMoveGroupUp:S,canMoveGroupDown:C,onEditGroup:T,onDeleteGroup:I,onMoveGroupUp:M,onMoveGroupDown:U}){const H=R.useMemo(()=>[...e].sort((V,$)=>V[1].sort_order-$[1].sort_order),[e]),O=H.reduce((V,[$])=>{const A=r[$];return V+(A?.current||0)},0),P=x===0,N={padding:"0.6rem 0.5rem",marginTop:P?0:"1.25rem",borderTop:"1px solid var(--border-medium)",borderBottom:qa,background:"var(--row-alt-bg)",display:"flex",alignItems:"center",fontSize:"0.9rem",fontWeight:600,minWidth:0,overflow:"visible"};return d.jsxs("div",{style:{display:"contents"},children:[!_&&d.jsxs(d.Fragment,{children:[d.jsx("div",{style:{...N,opacity:w?.7:1},children:d.jsxs("span",{style:{whiteSpace:"nowrap"},children:[d.jsx("span",{children:t.name}),d.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",H.length,")"]})]})}),d.jsx("div",{style:N}),d.jsx("div",{style:{...N,justifyContent:"flex-end",color:hn(O)},children:an.showGroupTotals}),d.jsx("div",{style:{...N,justifyContent:"flex-end",color:hn(H.reduce((V,[$])=>{const A=r[$];return V+(A?.total||0)},0))},children:an.showGroupTotals}),d.jsx("div",{style:N}),d.jsx("div",{style:{...N,justifyContent:"flex-end",gap:"0.25rem"},children:!w&&d.jsxs(d.Fragment,{children:[d.jsx(qe,{variant:"small",actionName:`Open Add Category Form (${t.name})`,onClick:()=>h(t.id),disabled:l!==null,children:"+ Category"}),d.jsx("button",{onClick:()=>{t.name,T()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Edit group",children:""}),d.jsx("button",{onClick:()=>{t.name,I()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Delete group",children:""}),d.jsxs("div",{style:Hf,children:[d.jsx("button",{onClick:M,disabled:!S,style:{...Ca,opacity:S?.6:.2,cursor:S?"pointer":"default"},title:"Move group up","aria-label":"Move group up",children:""}),d.jsx("button",{onClick:U,disabled:!C,style:{...Ca,opacity:C?.6:.2,cursor:C?"pointer":"default"},title:"Move group down","aria-label":"Move group down",children:""})]})]})})]}),_&&d.jsxs("div",{style:{gridColumn:"1 / -1",padding:"0.6rem 0.5rem",marginTop:P?0:"1.25rem",borderTop:"1px solid var(--border-medium)",borderBottom:qa,background:"var(--row-alt-bg)"},children:[d.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"},children:[d.jsxs("span",{style:{fontWeight:600,opacity:w?.7:1,whiteSpace:"nowrap"},children:[t.name,d.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",H.length,")"]})]}),an.showGroupTotals]}),!w&&d.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center",flexWrap:"wrap"},children:[d.jsx(qe,{variant:"small",actionName:`Open Add Category Form (${t.name})`,onClick:()=>h(t.id),disabled:l!==null,children:"+ Category"}),d.jsx("button",{onClick:()=>{t.name,T()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Edit group",children:""}),d.jsx("button",{onClick:()=>{t.name,I()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Delete group",children:""}),d.jsxs("div",{style:Hf,children:[d.jsx("button",{onClick:M,disabled:!S,style:{...Ca,opacity:S?.6:.2,cursor:S?"pointer":"default"},title:"Move group up","aria-label":"Move group up",children:""}),d.jsx("button",{onClick:U,disabled:!C,style:{...Ca,opacity:C?.6:.2,cursor:C?"pointer":"default"},title:"Move group down","aria-label":"Move group down",children:""})]})]})]}),H.map(([V,$],A)=>{const k=x+A;return d.jsx(OL,{category:$,catId:V,categoryIndex:k,totalCategories:H.length,categoryGroups:n,categoryBalances:r,loadingBalances:i,onEdit:u,onDelete:p,onMoveUp:()=>g(V,"up"),onMoveDown:()=>g(V,"down"),canMoveUp:A>0,canMoveDown:A<H.length-1,editingCategoryId:o,setEditingCategoryId:u,onUpdateCategory:f,isMobile:_},V)}),l===t.id&&d.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"0.5rem"},children:d.jsx(y_,{initialData:{name:"",category_group_id:t.id},onSubmit:V=>b(V,t.id),onCancel:()=>h(null),submitLabel:"Create",categoryGroups:n})})]})}function NL({onBudgetTotal:t,allocated:e,unallocated:n,relationshipMismatch:r,calculationMismatch:i}){return d.jsx("div",{style:{gridColumn:"1 / -1",marginLeft:"calc(-1 * var(--page-padding, 2rem))",marginRight:"calc(-1 * var(--page-padding, 2rem))",paddingLeft:"var(--page-padding, 2rem)",paddingRight:"var(--page-padding, 2rem)",paddingTop:"0.5rem",paddingBottom:"0.5rem"},children:d.jsx("div",{style:{display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingBottom:"0.5rem",borderBottom:"1px solid var(--border-medium)"},children:d.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[d.jsx("span",{style:{fontWeight:600},children:"Categories:"}),d.jsxs("span",{children:[d.jsx("span",{style:{opacity:.6},children:"On Budget: "}),d.jsx("span",{style:{color:et(t),fontWeight:600},children:Ft(t)})]}),d.jsx("span",{style:{opacity:r?1:.5,color:r?"var(--color-error)":void 0,fontWeight:r?700:void 0},children:r?"":"="}),d.jsxs("span",{children:[d.jsx("span",{style:{opacity:.6},children:"Allocated: "}),d.jsx("span",{style:{color:Na(e),fontWeight:600},children:Ft(e)})]}),d.jsx("span",{style:{opacity:r?1:.5,color:r?"var(--color-error)":void 0,fontWeight:r?700:void 0},children:"+"}),d.jsxs("span",{children:[d.jsx("span",{style:{opacity:.6},children:"Unallocated: "}),d.jsx("span",{style:{color:et(n),fontWeight:600},children:Ft(n)})]}),d.jsx("span",{style:{opacity:.6},children:"Use  buttons to reorder categories."})]})})})}function PL(){const{isLoading:t,isFetching:e,totalAvailable:n}=Dn(),{currentBudget:r,categories:i,categoryGroups:o,categoriesByGroup:l,hiddenCategories:u,sortedGroups:h,categoryBalances:f,isLoading:p,loadingBalances:g,error:b,setError:_,getOnBudgetTotal:w,handleCreateCategory:x,handleUpdateCategory:S,handleDeleteCategory:C,handleMoveCategory:T,handleCreateGroup:I,handleUpdateGroup:M,handleDeleteGroup:U,handleMoveGroup:H}=AB(),O=Li(),{addLoadingHold:P,removeLoadingHold:N}=In(),V=t||p||e||!r;o_(!V&&!!r),R.useEffect(()=>(V?P("categories","Loading categories..."):N("categories"),()=>N("categories")),[V,P,N]);const[$,A]=R.useState(null),[k,D]=R.useState(null),[K,X]=R.useState(null),[G,te]=R.useState(!1),Q=R.useMemo(()=>h.filter(ae=>ae.id!==Xt),[h]),se=R.useMemo(()=>({id:Xt,name:"Uncategorized",sort_order:Q.length}),[Q.length]),B=(l[Xt]||[]).sort((ae,fe)=>ae[1].sort_order-fe[1].sort_order);R.useEffect(()=>{b&&(console.error("[Settings/Categories] Error:",b),qn.add({type:"error",message:"Failed to update categories. See console for details.",autoDismissMs:0}),_(null))},[b,_]);const q=R.useMemo(()=>w(),[w]),{allocated:ee,unallocated:ne,calculationMismatch:le,relationshipMismatch:he}=jB({categories:i,categoryBalances:f,totalAvailable:n,onBudgetTotal:q,isDataLoading:V,loadingBalances:g,currentBudget:r});if(V||!r)return V?null:d.jsx("p",{children:"No budget found. Please log in."});const Ee={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",paddingTop:"0.75rem",paddingBottom:"0.5rem",paddingLeft:"0.5rem",paddingRight:"0.5rem",borderBottom:"2px solid var(--border-medium)"};return d.jsxs("div",{children:[d.jsxs("div",{style:{display:"grid",gridTemplateColumns:O?"1fr":"2fr 1fr 1fr 1fr 2fr 1fr",marginBottom:"1.5rem"},children:[d.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:50,backgroundColor:"var(--sticky-header-bg)",display:O?"block":"grid",gridTemplateColumns:O?void 0:"subgrid"},children:[d.jsx(NL,{onBudgetTotal:q,allocated:ee,unallocated:ne,relationshipMismatch:he,calculationMismatch:le}),!O&&d.jsxs(d.Fragment,{children:[d.jsx("div",{style:Ee,children:"Category"}),d.jsx("div",{style:{...Ee,textAlign:"right"},children:"Default"}),d.jsx("div",{style:{...Ee,textAlign:"right"},children:"Available Now"}),d.jsx("div",{style:{...Ee,textAlign:"right"},children:"Total Allocated"}),d.jsx("div",{style:Ee,children:"Description"}),d.jsx("div",{style:{...Ee,textAlign:"right"},children:"Actions"})]})]}),Object.keys(i).length===0&&o.length===0&&d.jsx("p",{style:{gridColumn:"1 / -1",opacity:.7,textAlign:"center",padding:"2rem"},children:"No categories yet. Create a group first, then add categories!"}),(()=>{const ae={};let fe=0;return Q.forEach(Me=>{const Ne=(l[Me.id]||[]).sort((tt,Ue)=>tt[1].sort_order-Ue[1].sort_order);ae[Me.id]=fe,fe+=Ne.length}),Q.map((Me,Ne)=>{const tt=(l[Me.id]||[]).sort((Ue,L)=>Ue[1].sort_order-L[1].sort_order);return tt.length===0&&K!==Me.id&&k!==Me.id?null:K===Me.id?d.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"1rem"},children:d.jsx(v1,{initialData:{name:Me.name},onSubmit:Ue=>{M(Me.id,Ue),X(null)},onCancel:()=>X(null),submitLabel:"Save"})},Me.id):d.jsx(x1,{group:Me,categories:tt,categoryGroups:o,categoryBalances:f,loadingBalances:g,editingCategoryId:$,createForGroupId:k,setEditingCategoryId:A,setCreateForGroupId:D,handleUpdateCategory:S,handleDeleteCategory:C,handleMoveCategory:T,handleCreateCategory:x,isMobile:O,canMoveGroupUp:Ne>0,canMoveGroupDown:Ne<Q.length-1,onEditGroup:()=>X(Me.id),onDeleteGroup:()=>U(Me.id),onMoveGroupUp:()=>H(Me.id,"up"),onMoveGroupDown:()=>H(Me.id,"down"),startRowIndex:ae[Me.id]??0},Me.id)})})(),(B.length>0||k==="ungrouped")&&(()=>{const ae=Q.reduce((fe,Me)=>{const Ne=(l[Me.id]||[]).sort((tt,Ue)=>tt[1].sort_order-Ue[1].sort_order);return fe+Ne.length},0);return d.jsx(x1,{group:se,categories:B,categoryGroups:o,categoryBalances:f,loadingBalances:g,editingCategoryId:$,createForGroupId:k,setEditingCategoryId:A,setCreateForGroupId:D,handleUpdateCategory:S,handleDeleteCategory:C,handleMoveCategory:T,handleCreateCategory:x,isMobile:O,isUngrouped:!0,canMoveGroupUp:!1,canMoveGroupDown:!1,onEditGroup:()=>{},onDeleteGroup:()=>{},onMoveGroupUp:()=>{},onMoveGroupDown:()=>{},startRowIndex:ae})})(),d.jsx("div",{style:{gridColumn:"1 / -1",height:"1rem"}})]}),u.length>0&&d.jsx("div",{style:{marginBottom:"2rem"},children:d.jsxs(d_,{title:"Hidden Categories",count:u.length,children:[d.jsxs("div",{style:{padding:"0.75rem",marginBottom:"1rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",fontSize:"0.85rem"},children:[d.jsxs("p",{style:{margin:"0 0 0.5rem 0",opacity:.8},children:[d.jsx("strong",{children:" Hidden categories"})," are excluded from dropdowns and balance displays. They're useful for historical categories that you want to keep for record-keeping but don't need in everyday use."]}),d.jsx("p",{style:{margin:0,opacity:.6},children:'To unhide a category, click it to edit and uncheck "Hidden category".'})]}),d.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:u.map(([ae,fe])=>$===ae?d.jsx(y_,{initialData:{name:fe.name,description:fe.description,category_group_id:fe.category_group_id,default_monthly_amount:fe.default_monthly_amount,default_monthly_type:fe.default_monthly_type,is_hidden:fe.is_hidden},onSubmit:Me=>{S(ae,Me),A(null)},onCancel:()=>A(null),submitLabel:"Save",categoryGroups:o,showGroupSelector:!0},ae):d.jsxs("div",{onClick:()=>A(ae),style:{padding:"0.75rem 1rem",background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"8px",cursor:"pointer",display:"flex",justifyContent:"space-between",alignItems:"center",opacity:.7},children:[d.jsx("span",{children:fe.name}),d.jsx("span",{style:{color:et(fe.balance),fontWeight:500},children:Ft(fe.balance)})]},ae))})]})}),G?d.jsx(v1,{onSubmit:ae=>{I(ae),te(!1)},onCancel:()=>te(!1),submitLabel:"Create Group"}):d.jsx(qe,{variant:"primary-large",actionName:"Open Add Category Group Form",onClick:()=>te(!0),children:"+ Add Category Group"})]})}function BL(){const{selectedBudgetId:t,currentUserId:e}=Ye(),{addLoadingHold:n,removeLoadingHold:r}=In(),{budget:i,budgetUserIds:o,acceptedUserIds:l,isLoading:u}=Dn();R.useEffect(()=>(u||!i?n("users","Loading users..."):r("users"),()=>r("users")),[u,i,n,r]);const{inviteUser:h}=xL(),{revokeUser:f}=wL(),[p,g]=R.useState(""),[b,_]=R.useState(!1),[w,x]=R.useState(null),[S,C]=R.useState(null);if(u)return null;if(!i)return d.jsx("p",{children:"No budget found."});async function T(H){if(H.preventDefault(),!(!p.trim()||!i||!t)){_(!0),x(null),C(null);try{await h.mutateAsync({budgetId:t,userId:p.trim()}),g(""),C("Invite sent! The user can now accept the invitation from their account.")}catch(O){x(O instanceof Error?O.message:"Failed to invite user")}finally{_(!1)}}}async function I(H){if(!i||!t)return;if(H===i.owner_id){x("Cannot revoke the budget owner");return}if(H===e){x("Cannot revoke yourself from the budget");return}const O=l.includes(H);if(confirm(O?"Are you sure you want to revoke this user's access? They will lose access to this budget.":"Are you sure you want to cancel this invitation?")){x(null),C(null);try{await f.mutateAsync({budgetId:t,userId:H}),C(O?"User access revoked.":"Invitation cancelled.")}catch(N){x(N instanceof Error?N.message:"Failed to revoke user")}}}const M=o.filter(H=>l.includes(H)),U=o.filter(H=>!l.includes(H));return d.jsxs("div",{children:[d.jsx("h2",{style:{marginTop:0},children:"Budget Users"}),d.jsx("p",{style:{opacity:.7,marginBottom:"1.5rem"},children:"Invite users to access this budget. They must accept the invitation before they can access it."}),w&&d.jsxs("div",{style:{background:"var(--color-error-bg)",border:"1px solid var(--color-error-border)",color:"var(--color-error)",padding:"0.75rem 1rem",borderRadius:"8px",marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[d.jsx("span",{children:w}),d.jsx("button",{onClick:()=>x(null),style:{background:"transparent",border:"none",color:"var(--color-error)",cursor:"pointer",fontSize:"1.2rem",padding:"0 0.25rem",lineHeight:1},children:""})]}),S&&d.jsxs("div",{style:{background:"var(--color-success-bg)",border:"1px solid var(--color-success-border)",color:"var(--color-success)",padding:"0.75rem 1rem",borderRadius:"8px",marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[d.jsx("span",{children:S}),d.jsx("button",{onClick:()=>C(null),style:{background:"transparent",border:"none",color:"var(--color-success)",cursor:"pointer",fontSize:"1.2rem",padding:"0 0.25rem",lineHeight:1},children:""})]}),d.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px",marginBottom:"1.5rem"},children:[d.jsxs("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem"},children:["Active Users (",M.length,")"]}),M.length===0?d.jsx("p",{style:{opacity:.6,margin:0},children:"No users have accepted invitations yet."}):d.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:M.map(H=>{const O=H===i.owner_id,P=H===e;return d.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 8%, transparent)",padding:"0.75rem 1rem",borderRadius:"6px",display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem"},children:[d.jsx("div",{style:{flex:1,minWidth:0},children:d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flexWrap:"wrap"},children:[d.jsx("code",{style:{fontSize:"0.85rem",background:"color-mix(in srgb, currentColor 10%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",wordBreak:"break-all"},children:H}),O&&d.jsx("span",{style:{background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.7rem",textTransform:"uppercase",fontWeight:600},children:"Owner"}),P&&d.jsx("span",{style:{background:"color-mix(in srgb, var(--color-success) 20%, transparent)",color:"var(--color-success)",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.7rem",textTransform:"uppercase",fontWeight:600},children:"You"})]})}),!O&&!P&&d.jsx("button",{onClick:()=>I(H),style:{background:"transparent",border:"1px solid var(--color-error-border)",color:"var(--color-error)",padding:"0.4rem 0.75rem",borderRadius:"6px",cursor:"pointer",fontSize:"0.8rem",whiteSpace:"nowrap"},children:"Revoke Access"})]},H)})})]}),U.length>0&&d.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px",marginBottom:"1.5rem"},children:[d.jsxs("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem"},children:["Pending Invitations (",U.length,")"]}),d.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:U.map(H=>d.jsxs("div",{style:{background:"color-mix(in srgb, var(--color-warning) 10%, transparent)",border:"1px solid color-mix(in srgb, var(--color-warning) 30%, transparent)",padding:"0.75rem 1rem",borderRadius:"6px",display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem"},children:[d.jsx("div",{style:{flex:1,minWidth:0},children:d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flexWrap:"wrap"},children:[d.jsx("code",{style:{fontSize:"0.85rem",background:"color-mix(in srgb, currentColor 10%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",wordBreak:"break-all"},children:H}),d.jsx("span",{style:{background:"color-mix(in srgb, var(--color-warning) 20%, transparent)",color:"var(--color-warning)",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.7rem",textTransform:"uppercase",fontWeight:600},children:"Pending"})]})}),d.jsx("button",{onClick:()=>I(H),style:{background:"transparent",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)",color:"inherit",padding:"0.4rem 0.75rem",borderRadius:"6px",cursor:"pointer",fontSize:"0.8rem",whiteSpace:"nowrap",opacity:.8},children:"Cancel Invite"})]},H))})]}),d.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px"},children:[d.jsx("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem"},children:"Invite User"}),d.jsxs("form",{onSubmit:T,style:{display:"flex",gap:"0.75rem"},children:[d.jsx("input",{type:"text",value:p,onChange:H=>g(H.target.value),placeholder:"Enter Firebase User ID",style:{flex:1,padding:"0.6rem 0.8rem",borderRadius:"6px",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"0.95rem",color:"inherit"}}),d.jsx("button",{type:"submit",disabled:b||!p.trim(),style:{background:"var(--color-primary)",color:"white",border:"none",padding:"0.6rem 1.25rem",borderRadius:"6px",cursor:b||!p.trim()?"not-allowed":"pointer",fontWeight:500,opacity:b||!p.trim()?.7:1,whiteSpace:"nowrap"},children:b?"Inviting...":"Send Invite"})]}),d.jsx("p",{style:{margin:"1rem 0 0 0",fontSize:"0.85rem",opacity:.6},children:" The invited user will need to accept the invitation from their Account page using this budget's ID:"}),d.jsx("code",{style:{display:"block",marginTop:"0.5rem",padding:"0.5rem 0.75rem",background:"color-mix(in srgb, currentColor 10%, transparent)",borderRadius:"6px",fontSize:"0.85rem",wordBreak:"break-all"},children:i.id})]})]})}const zL=["budget","feedback","migration","tests"];function LL(){const{isAdmin:t,isTest:e,lastAdminTab:n,setLastAdminTab:r,setPageTitle:i}=Ye(),l=zi().get_current_firebase_user(),u=VT(l?.uid||null,l?.email||null);R.useLayoutEffect(()=>{i("Budget Admin")},[i]);const h=tr(),f=h.pathname==="/budget/admin",p=R.useMemo(()=>{const w=h.pathname;return w.includes("/admin/budget")?"budget":w.includes("/admin/feedback")?"feedback":w.includes("/admin/migration")?"migration":w.includes("/admin/tests")?"tests":"budget"},[h.pathname]),g=p==="tests";R.useEffect(()=>{f||r(p)},[p,f,r]);function b(){return!zL.includes(n)||n==="tests"&&!e?"budget":n}const _=R.useMemo(()=>[{id:"budget",label:"Budget",icon:""},{id:"feedback",label:"Feedback",icon:""},{id:"migration",label:"Migration",icon:""},{id:"tests",label:"Tests",icon:"",hidden:!e}],[e]);return u.isLoading||u.isFetching?null:t?!e&&g?d.jsxs("div",{children:[d.jsx("h1",{children:"Access Denied"}),d.jsx("p",{style:{opacity:.7},children:"Only test users can access this section."}),d.jsx("p",{style:{marginTop:"1rem"},children:d.jsx(jn,{to:"/budget/admin/budget",children:"Go to Admin "})})]}):d.jsxs("div",{children:[d.jsx(Wf,{mode:"link",linkPrefix:"/budget/admin",tabs:_,activeTab:p}),f?d.jsx(Kf,{to:`/budget/admin/${b()}`,replace:!0}):d.jsx(Yf,{})]}):d.jsxs("div",{children:[d.jsx("h1",{children:"Access Denied"}),d.jsx("p",{style:{opacity:.7},children:"Only administrators can access this section."}),d.jsx("p",{style:{marginTop:"1rem"},children:d.jsx(jn,{to:"/budget",children:"Go to Budget "})})]})}function UL(){const{addLoadingHold:t,removeLoadingHold:e}=In(),{isAdmin:n}=Ye(),{budget:r,accounts:i,accountGroups:o,categories:l,categoryGroups:u,isOwner:h,isLoading:f}=Dn();return R.useEffect(()=>(f?t("settings-budget","Loading budget info..."):e("settings-budget"),()=>e("settings-budget")),[f,t,e]),f?null:r?d.jsxs("div",{children:[d.jsx("h2",{style:{marginTop:0},children:"Budget Summary"}),d.jsx("p",{style:{opacity:.7,marginBottom:"1.5rem"},children:"Information about the currently selected budget."}),d.jsx("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px",marginBottom:"1.5rem"},children:d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem",fontSize:"0.95rem"},children:[d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[d.jsx("span",{children:""}),d.jsx("span",{style:{opacity:.7,minWidth:"80px"},children:"Name:"}),d.jsx("strong",{children:r.name})]}),d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[d.jsx("span",{children:""}),d.jsx("span",{style:{opacity:.7,minWidth:"80px"},children:"ID:"}),d.jsx("code",{style:{background:"color-mix(in srgb, currentColor 10%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",fontSize:"0.85rem"},children:r.id})]}),d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[d.jsx("span",{children:""}),d.jsx("span",{style:{opacity:.7,minWidth:"80px"},children:"Owner:"}),d.jsx("strong",{children:r.owner_email||r.owner_id})]}),d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[d.jsx("span",{children:""}),d.jsx("span",{style:{opacity:.7,minWidth:"80px"},children:"Users:"}),d.jsxs("span",{children:[r.user_ids.length," user",r.user_ids.length!==1?"s":"",d.jsxs("span",{style:{opacity:.7},children:["  ",h?"You are the owner":"Shared with you"]})]})]})]})}),n&&d.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px"},children:[d.jsx("h3",{style:{margin:"0 0 0.75rem 0",fontSize:"1rem"},children:"Admin Tools"}),d.jsx("button",{onClick:()=>{const p={...r,accounts:i,account_groups:o,categories:l,category_groups:u,_meta:{downloaded_at:new Date().toISOString()}},g=new Blob([JSON.stringify(p,null,2)],{type:"application/json"}),b=URL.createObjectURL(g),_=document.createElement("a");_.href=b,_.download=`budget_${r.id}.json`,document.body.appendChild(_),_.click(),document.body.removeChild(_),URL.revokeObjectURL(b)},style:{display:"inline-flex",alignItems:"center",gap:"0.5rem",background:"color-mix(in srgb, currentColor 10%, transparent)",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",borderRadius:"6px",padding:"0.5rem 0.75rem",cursor:"pointer",fontSize:"0.85rem",color:"inherit",transition:"background 0.15s"},title:"Download budget document as JSON (for debugging)",children:" Download Budget JSON"})]})]}):d.jsx("p",{style:{opacity:.7},children:"No budget selected."})}function w1({selectedType:t,onSelect:e}){return d.jsx("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"0.75rem",paddingBottom:"1rem",flexWrap:"wrap"},children:["critical_bug","bug","new_feature","core_feature","qol"].map(n=>{const r=sd[n],i=t==="feature"?"new_feature":t,o=i===n||!i&&n==="bug";return d.jsxs("button",{type:"button",onClick:()=>{r.label,e(n)},style:{flex:1,padding:"0.6rem 0.75rem",border:`2px solid ${r.color}`,borderRadius:"0.5rem",background:o?r.bgColor:"transparent",color:o?r.color:"var(--text-muted)",cursor:"pointer",fontWeight:o?600:400,fontSize:"0.85rem",transition:"all 0.15s ease",opacity:o?1:.5,boxShadow:o?`0 0 12px ${r.bgColor}`:"none",position:"relative"},children:[r.label,o&&d.jsx("span",{style:{position:"absolute",bottom:"-14px",left:"10%",right:"10%",height:"3px",background:"white",borderRadius:"2px"}})]},n)})})}function FL(){const[t,e]=R.useState(null),[n,r]=R.useState(null),[i,o]=R.useState(!1),[l,u]=R.useState(""),[h,f]=R.useState("bug"),[p,g]=R.useState(null),[b,_]=R.useState(!1),[w,x]=R.useState(null),S=R.useContext(Cd),T=zi().get_current_firebase_user(),I=Rt(),M=IP(),{submitFeedback:U}=mA(),{toggleFeedback:H}=J3(),{updateSortOrder:O}=ez(),P=M.data?.items||[],N=Li(),{addLoadingHold:V,removeLoadingHold:$}=In();R.useEffect(()=>(M.isLoading?V("settings-feedback","Loading feedback..."):$("settings-feedback"),()=>$("settings-feedback")),[M.isLoading,V,$]);function A(ae){ae.preventDefault(),!(!l.trim()||!S.username||!T)&&(U.mutate({userId:T.uid,userEmail:S.username,text:l.trim(),feedbackType:h,currentPath:"/settings/feedback"}),u(""),f("bug"),o(!1))}function k(ae){ae.is_done?D(ae):g(ae)}async function D(ae){try{await H.mutateAsync({item:ae})}catch(fe){console.error("[Feedback] Error updating feedback:",fe),qn.add({type:"error",message:"Failed to update feedback",autoDismissMs:5e3})}}function K(){p&&(D(p),g(null))}async function X(){_(!1);const ae="mark-all-feedback-complete";V(ae,`Marking ${Q.length} item${Q.length!==1?"s":""} as complete...`);try{const fe=new Date().toISOString(),Me=new Set(Q.map(de=>de.id)),Ne=new Map;for(const de of Q)Ne.has(de.doc_id)||Ne.set(de.doc_id,[]),Ne.get(de.doc_id).push(de);const tt=[];for(const[de,_e]of Ne){const J=(async()=>{const oe=(await fA(de,"mark all feedback complete")).items.map(Se=>Me.has(Se.id)?{...Se,is_done:!0,completed_at:fe}:Se);await u_({docId:de,items:oe,description:`marking ${_e.length} feedback item${_e.length!==1?"s":""} as complete`})})();tt.push(J)}await Promise.all(tt);const Ue=Ce.feedback(),L=I.getQueryData(Ue);L&&I.setQueryData(Ue,{items:L.items.map(de=>Me.has(de.id)?{...de,is_done:!0,completed_at:fe}:de)}),await I.invalidateQueries({queryKey:Ue}),qn.add({type:"success",message:`Marked ${Q.length} item${Q.length!==1?"s":""} as complete`,autoDismissMs:3e3})}catch(fe){console.error("[Feedback] Error marking all as complete:",fe),qn.add({type:"error",message:"Failed to mark all items as complete",autoDismissMs:5e3}),await I.invalidateQueries({queryKey:Ce.feedback()})}finally{$(ae)}}function G(){X()}async function te(ae){if(w){try{const Me=P.filter(Ne=>Ne.doc_id===w.doc_id).map(Ne=>({id:Ne.id,text:Ne.text,created_at:Ne.created_at,is_done:Ne.is_done,completed_at:Ne.completed_at,sort_order:Ne.sort_order,feedback_type:Ne.id===w.id?ae:Ne.feedback_type}));await O.mutateAsync({docId:w.doc_id,items:Me})}catch(fe){console.error("[Feedback] Error updating feedback type:",fe),qn.add({type:"error",message:"Failed to update feedback type",autoDismissMs:5e3})}x(null)}}const Q=P.filter(ae=>!ae.is_done).sort((ae,fe)=>ae.sort_order-fe.sort_order),se=P.filter(ae=>ae.is_done).sort((ae,fe)=>new Date(fe.completed_at||0).getTime()-new Date(ae.completed_at||0).getTime());function B(ae,fe){e(fe),ae.dataTransfer.effectAllowed="move"}function q(ae,fe){ae.preventDefault(),fe!==t&&r(fe)}function ee(){r(null)}function ne(){e(null),r(null)}async function le(ae,fe){if(ae.preventDefault(),!t||t===fe){ne();return}const Me=Q.findIndex(de=>de.id===t),Ne=[...Q],[tt]=Ne.splice(Me,1);if(fe==="__end__")Ne.push(tt);else{const de=Ne.findIndex(_e=>_e.id===fe);Ne.splice(de,0,tt)}const Ue=Ne.map((de,_e)=>({...de,sort_order:_e}));ne();const L=new Map;for(const de of Ue)L.has(de.doc_id)||L.set(de.doc_id,[]),L.get(de.doc_id).push({id:de.id,text:de.text,created_at:de.created_at,is_done:de.is_done,completed_at:de.completed_at,sort_order:de.sort_order,feedback_type:de.feedback_type});for(const de of se)L.has(de.doc_id)||L.set(de.doc_id,[]),L.get(de.doc_id).push({id:de.id,text:de.text,created_at:de.created_at,is_done:de.is_done,completed_at:de.completed_at,sort_order:de.sort_order,feedback_type:de.feedback_type});try{for(const[de,_e]of L)await O.mutateAsync({docId:de,items:_e})}catch(de){console.error("[Feedback] Error saving order:",de),qn.add({type:"error",message:"Failed to save order",autoDismissMs:5e3})}}function he(){const ae=Ee(Q),fe=new Blob([ae],{type:"text/markdown"}),Me=URL.createObjectURL(fe),Ne=document.createElement("a");Ne.href=Me,Ne.download=`feedback-${new Date().toISOString().split("T")[0]}.md`,document.body.appendChild(Ne),Ne.click(),document.body.removeChild(Ne),URL.revokeObjectURL(Me)}function Ee(ae){let fe=`# Feedback Export

`;return fe+=`Generated: ${new Date().toISOString()}

`,ae.length>0&&(fe+=`## Pending

`,ae.forEach((Me,Ne)=>{const tt=Me.feedback_type?sd[Me.feedback_type]?.label||Me.feedback_type:"Unknown";fe+=`### ${Ne+1}. [${tt}] ${Me.text.split(`
`)[0].substring(0,60)}${Me.text.split(`
`)[0].length>60?"...":""}

`,fe+=`- **Type:** ${tt}
`,fe+=`- **Created:** ${Me.created_at}
`,fe+=`- **User:** ${Me.user_email||Me.doc_id}
`,fe+=`- **ID:** ${Me.id}

`,fe+=`${Me.text}

`,fe+=`---

`})),fe}return M.isLoading?null:d.jsxs("div",{children:[d.jsxs("div",{style:{display:"flex",flexDirection:N?"column":"row",justifyContent:"space-between",alignItems:N?"stretch":"flex-start",gap:N?"0.75rem":"1rem",marginTop:"1.5rem",marginBottom:"0.5rem"},children:[d.jsxs("div",{children:[d.jsx("h2",{style:{marginTop:0},children:"Feedback"}),d.jsx("p",{style:{...QT,fontSize:"0.9rem"},children:"View and manage user feedback. Drag to reorder pending items."})]}),d.jsxs("div",{style:{display:"flex",gap:"0.75rem",flexDirection:N?"column":"row"},children:[d.jsx(qe,{variant:"secondary",actionName:"Download Feedback as Markdown",onClick:he,disabled:Q.length===0,style:N?{width:"100%"}:void 0,children:"Download Markdown"}),d.jsx(qe,{variant:"secondary",actionName:"Mark All Complete",onClick:()=>_(!0),disabled:Q.length===0,style:N?{width:"100%"}:void 0,children:"Mark All Complete"})]})]}),d.jsxs("div",{style:GS,children:[Q.length===0&&!i&&d.jsx("p",{style:{opacity:.7},children:"No pending feedback."}),Q.map(ae=>d.jsx(Pz,{item:ae,isDragging:t===ae.id,isDragOver:n===ae.id,onDragStart:fe=>B(fe,ae.id),onDragOver:fe=>q(fe,ae.id),onDragLeave:ee,onDragEnd:ne,onDrop:fe=>le(fe,ae.id),onToggleDone:()=>k(ae),onTypeClick:()=>x(ae)},ae.id)),t&&Q.length>0&&d.jsx(X3,{isActive:n==="__end__",onDragOver:ae=>q(ae,"__end__"),onDragLeave:ee,onDrop:ae=>le(ae,"__end__")})]}),i?d.jsxs(Ni,{actionName:"Add Feedback",onSubmit:A,children:[d.jsx(w1,{selectedType:h,onSelect:f}),d.jsx(a_,{value:l,onChange:ae=>u(ae.target.value),placeholder:"Enter your feedback, bug report, or feature request...",autoFocus:!0,required:!0}),d.jsxs(Ya,{children:[d.jsx(qe,{type:"submit",actionName:"Add Feedback",disabled:!l.trim(),children:"Add Feedback"}),d.jsx(qe,{type:"button",variant:"secondary",actionName:"Cancel Add Feedback",onClick:()=>{o(!1),u(""),f("bug")},children:"Cancel"})]})]}):d.jsx(qe,{variant:"primary-large",actionName:"Open Add Feedback Form",onClick:()=>o(!0),children:"+ Add Feedback"}),se.length>0&&d.jsx(d_,{title:"Completed",count:se.length,children:d.jsx("div",{style:{...GS,marginTop:"0.5rem"},children:se.map(ae=>d.jsx(Bz,{item:ae,onToggleDone:()=>k(ae),onTypeClick:()=>x(ae)},ae.id))})}),d.jsxs(Ks,{isOpen:p!==null,onClose:()=>g(null),title:"Mark as Complete",children:[d.jsx("p",{style:{margin:"0 0 1.5rem 0"},children:"Are you sure you want to mark this feedback item as complete?"}),p&&d.jsxs("p",{style:{margin:"0 0 1.5rem 0",padding:"0.75rem",background:"var(--row-alt-bg)",borderRadius:"0.5rem",fontSize:"0.9rem"},children:['"',p.text,'"']}),d.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[d.jsx(qe,{variant:"secondary",actionName:"Cancel Mark Complete",onClick:()=>g(null),children:"Cancel"}),d.jsx(qe,{variant:"primary",actionName:"Confirm Mark Complete",onClick:K,children:"Mark Complete"})]})]}),d.jsxs(Ks,{isOpen:b,onClose:()=>_(!1),title:"Mark All as Complete",children:[d.jsxs("p",{style:{margin:"0 0 1.5rem 0"},children:["Are you sure you want to mark all ",Q.length," pending feedback item",Q.length!==1?"s":""," as complete?"]}),d.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[d.jsx(qe,{variant:"secondary",actionName:"Cancel Mark All Complete",onClick:()=>_(!1),children:"Cancel"}),d.jsx(qe,{variant:"primary",actionName:"Confirm Mark All Complete",onClick:G,children:"Mark All Complete"})]})]}),d.jsxs(Ks,{isOpen:w!==null,onClose:()=>x(null),title:"Change Feedback Type",children:[d.jsx("p",{style:{margin:"0 0 1rem 0",fontSize:"0.9rem",opacity:.8},children:"Select a new type for this feedback:"}),d.jsx(w1,{selectedType:w?.feedback_type||"bug",onSelect:te}),d.jsx(qe,{variant:"secondary",actionName:"Cancel Change Feedback Type",onClick:()=>x(null),style:{width:"100%"},children:"Cancel"})]})]})}function VL(){ze.clear(),window.location.reload()}function $L(){const e=zi().get_current_firebase_user(),{selectedBudgetId:n}=Ye(),r=D3({currentUser:e}),i=O3({currentUser:e}),o=B3({currentUser:e}),l=j3({currentUser:e}),u=c3({currentUser:e}),h=i3({currentUser:e}),f=p3({currentUser:e}),p=YB({currentUser:e}),g=U3({currentUser:e}),b=$3({currentUser:e}),_=G3({currentUser:e,budgetId:n}),w=Y3({currentUser:e}),x=qB({currentUser:e}),S=HB({currentUser:e}),C=r.isScanning||i.isScanning||o.isScanning||l.isScanning||u.isScanning||h.isScanning||f.isScanning||p.isScanning||g.isScanning||b.isScanning||x.isScanning||S.isScanning,T=r.isRunning||i.isRunning||o.isRunning||u.isRunning||h.isRunning||f.isRunning||p.isRunning||g.isRunning||b.isRunning||x.isDeleting||S.isDeleting||_.isDownloading||w.isUploading,I=async()=>{await Promise.all([r.scanStatus(),i.scanStatus(),o.scanStatus(),l.scan(),u.scanStatus(),h.scanStatus(),f.scanStatus(),p.scan(),g.scanStatus(),b.scanStatus(),x.scanStatus(),S.scanStatus()])};return d.jsxs("div",{children:[d.jsx("style",{children:"@keyframes spin { to { transform: rotate(360deg); } }"}),d.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"},children:[d.jsx("h2",{style:{margin:0},children:"Data Migrations"}),d.jsxs("button",{onClick:I,disabled:C||T,style:{background:"var(--color-primary)",color:"white",border:"none",padding:"0.5rem 1rem",borderRadius:"6px",cursor:C||T?"not-allowed":"pointer",fontWeight:500,opacity:C||T?.7:1,display:"flex",alignItems:"center",gap:"0.4rem",minWidth:"130px",minHeight:"36px"},children:[d.jsx("span",{style:{width:"18px",height:"18px",display:"inline-flex",justifyContent:"center",alignItems:"center",flexShrink:0},children:C?d.jsx(Hn,{noMargin:!0}):""}),"Refresh All"]})]}),d.jsx("p",{style:{opacity:.7,marginBottom:"1.5rem"},children:'Run migrations to validate and fix your database. Click "Refresh All" to scan Firestore directly.'}),d.jsx(Jz,{disabled:!e,onDownloadBackup:_.downloadBudget,isDownloadingBackup:_.isDownloading,removeTotalFieldsMigration:{status:r.status,hasData:!!r.status,needsMigration:r.needsMigration,totalItemsToFix:r.totalItemsToFix,isScanning:r.isScanning,isRunning:r.isRunning,result:r.result,scanStatus:r.scanStatus,runMigration:r.runMigration},removePreviousMonthIncomeMigration:{status:i.status,hasData:!!i.status,needsMigration:i.needsMigration,totalItemsToFix:i.totalItemsToFix,isScanning:i.isScanning,isRunning:i.isRunning,result:i.result,scanStatus:i.scanStatus,runMigration:i.runMigration},percentageIncomeMonthsBackMigration:{status:o.status,hasData:!!o.status,needsMigration:o.needsMigration,totalItemsToFix:o.totalItemsToFix,isScanning:o.isScanning,isRunning:o.isRunning,result:o.result,scanStatus:o.scanStatus,runMigration:o.runMigration}}),d.jsx(i4,{disabled:!e,onDownloadBackup:_.downloadBudget,isDownloadingBackup:_.isDownloading,accountCategoryValidation:{status:l.status,hasData:!!l.status,hasViolations:l.hasViolations,violationCount:l.violationCount,isScanning:l.isScanning,report:l.report,scan:l.scan},orphanedIdCleanup:{status:u.status,hasData:!!u.status,hasItemsToFix:u.hasItemsToFix,totalOrphaned:u.status?u.status.orphanedCategoryIds+u.status.orphanedAccountIds:0,isScanning:u.isScanning,isRunning:u.isRunning,result:u.result,scanStatus:u.scanStatus,runMigration:u.runMigration},expenseToAdjustment:{status:h.status,hasData:!!h.status,hasItemsToMigrate:h.hasItemsToMigrate,totalToMigrate:h.status?.expensesToMigrate??0,isScanning:h.isScanning,isRunning:h.isRunning,result:h.result,scanStatus:h.scanStatus,runMigration:h.runMigration},adjustmentsToTransfers:{status:f.status,hasData:!!f.status,hasPairsToConvert:f.hasPairsToConvert,totalPairs:f.status?.pairsFound??0,isScanning:f.isScanning,isRunning:f.isRunning,result:f.result,scanStatus:f.scanStatus,runMigration:f.runMigration},precisionCleanup:{status:p.status,hasData:p.hasData,hasIssues:p.hasIssues,totalIssues:p.totalIssues,isScanning:p.isScanning,isRunning:p.isRunning,result:p.result,scan:p.scan,runCleanup:p.runCleanup},recalculateStartBalances:{status:g.status,hasData:!!g.status,needsMigration:g.needsMigration,totalItemsToFix:g.totalItemsToFix,isScanning:g.isScanning,isRunning:g.isRunning,result:g.result,scanStatus:g.scanStatus,runMigration:g.runMigration},repairMonthMap:{status:b.status,hasData:!!b.status,needsMigration:b.needsMigration,totalItemsToFix:b.totalItemsToFix,isScanning:b.isScanning,isRunning:b.isRunning,result:b.result,scanStatus:b.scanStatus,runMigration:b.runMigration}}),d.jsx(u4,{disabled:!e,onDownloadBackup:_.downloadBudget,isDownloadingBackup:_.isDownloading,budgetDownloadUpload:{isDownloading:_.isDownloading,downloadProgress:_.progress,downloadError:_.error,downloadBudget:_.downloadBudget,isScanning:w.isScanning,isUploading:w.isUploading,uploadStatus:w.status,uploadProgress:w.progress,uploadError:w.error,uploadResult:w.result,scanZipFile:w.scanZipFile,uploadBudget:w.uploadBudget},deleteAllMonths:{status:x.status,hasData:!!x.status,monthsCount:x.status?.monthsCount??0,budgetCount:x.status?.budgetCount??0,isScanning:x.isScanning,isDeleting:x.isDeleting,deleteResult:x.deleteResult,deleteProgress:x.deleteProgress,scanStatus:x.scanStatus,deleteAllMonths:x.deleteAllMonths},deleteSampleUserBudget:{status:S.status,hasData:!!S.status,totalBudgets:S.status?.totalBudgets??0,totalMonths:S.status?.totalMonths??0,isScanning:S.isScanning,isDeleting:S.isDeleting,deleteResult:S.deleteResult,deleteProgress:S.deleteProgress,scanStatus:S.scanStatus,deleteSampleUserBudget:S.deleteSampleUserBudget},onClearCache:VL}),d.jsx("div",{style:{background:"color-mix(in srgb, currentColor 3%, transparent)",padding:"1rem",borderRadius:"8px",fontSize:"0.85rem"},children:d.jsxs("p",{style:{margin:0,opacity:.7},children:[d.jsx("strong",{children:"Note:"})," These migrations will process ",d.jsx("strong",{children:"all budgets and months"})," in the system, not just the ones you own or are invited to."]})}),d.jsx(vA,{})]})}function ql({name:t,description:e,expectedBehavior:n,result:r,onRun:i,disabled:o,expectedToSucceed:l}){const u=r?.status==="passed"?me.success:r?.status==="failed"?me.danger:r?.status==="running"?me.warning:"inherit";return d.jsxs("div",{style:{...n_,display:"flex",flexDirection:"column",gap:"0.5rem"},children:[d.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",gap:"1rem"},children:[d.jsxs("div",{style:{flex:1},children:[d.jsx("h4",{style:{margin:0,fontSize:"0.95rem"},children:t}),d.jsx("p",{style:{margin:"0.25rem 0 0",opacity:.7,fontSize:"0.85rem"},children:e}),d.jsxs("p",{style:{margin:"0.25rem 0 0",fontSize:"0.8rem",color:l?me.success:me.warning},children:["Expected: ",n]})]}),d.jsx(qe,{onClick:i,disabled:o,variant:"secondary",style:{flexShrink:0},children:r?.status==="running"?"":"Run"})]}),r&&r.status!=="pending"&&d.jsx("div",{style:{padding:"0.5rem 0.75rem",borderRadius:"6px",background:`color-mix(in srgb, ${u} 15%, transparent)`,border:`1px solid color-mix(in srgb, ${u} 30%, transparent)`,fontSize:"0.85rem",color:u},children:r.message})]})}function qL({totalCount:t,passedCount:e,failedCount:n}){return d.jsxs("div",{style:{display:"flex",gap:"1rem",padding:"0.75rem 1rem",borderRadius:"8px",background:"color-mix(in srgb, currentColor 5%, transparent)",marginBottom:"1rem"},children:[d.jsxs("span",{children:["Total: ",d.jsx("strong",{children:t})]}),d.jsxs("span",{style:{color:me.success},children:["Passed: ",d.jsx("strong",{children:e})]}),d.jsxs("span",{style:{color:me.danger},children:["Failed: ",d.jsx("strong",{children:n})]})]})}const S1=[{name:"Read unauthorized budget",expectedToFail:!0},{name:"Read another user's document",expectedToFail:!0},{name:"Read unauthorized budget month",expectedToFail:!0},{name:"Toggle is_admin in own permission_flags",expectedToFail:!0},{name:"Toggle is_test in own permission_flags",expectedToFail:!0},{name:"Read own user document",expectedToFail:!1}];function HL(){const{currentUserId:t}=Ye(),[e,n]=R.useState([]),[r,i]=R.useState(!1);function o(_,w){n(x=>x.map(S=>S.name===_?{...S,...w}:S))}async function l(_,w,x){o(_,{status:"running",message:"Running..."});try{const S=await w();x?o(_,{status:"failed",message:` ${S}`}):o(_,{status:"passed",message:` ${S}`})}catch(S){const C=S instanceof Error?S.message:"Unknown error";x?o(_,{status:"passed",message:` Blocked as expected: ${C}`}):o(_,{status:"failed",message:` ${C}`})}}async function u(){i(!0),n(S1.map(_=>({..._,status:"pending",message:""})));for(const _ of S1)await h(_.name);i(!1)}async function h(_){switch(_){case"Read unauthorized budget":await l(_,async()=>(await At("budgets","unauthorized_budget_test_12345","security test: attempting unauthorized budget read"),"Was able to read budget (unexpected)"),!0);break;case"Read another user's document":await l(_,async()=>(await At("users","another_user_test_12345","security test: attempting unauthorized user read"),"Was able to read user document (unexpected)"),!0);break;case"Read unauthorized budget month":await l(_,async()=>(await At("months","unauthorized_budget_test_12345_2024_01","security test: attempting unauthorized month read"),"Was able to read month document for unauthorized budget (unexpected)"),!0);break;case"Toggle is_admin in own permission_flags":await l(_,async()=>{if(!t)throw new Error("Not authenticated");const{data:w}=await At("users",t,"security test: reading own user to get current is_admin value"),x=w?.permission_flags?.is_admin??!1;return await Oi("users",t,{"permission_flags.is_admin":!x},"security test: attempting to toggle is_admin (should fail)"),`Was able to change is_admin from ${x} to ${!x} (SECURITY ISSUE!)`},!0);break;case"Toggle is_test in own permission_flags":await l(_,async()=>{if(!t)throw new Error("Not authenticated");const{data:w}=await At("users",t,"security test: reading own user to get current is_test value"),x=w?.permission_flags?.is_test??!1;return await Oi("users",t,{"permission_flags.is_test":!x},"security test: attempting to toggle is_test (should fail)"),`Was able to change is_test from ${x} to ${!x} (SECURITY ISSUE!)`},!0);break;case"Read own user document":await l(_,async()=>{if(!t)throw new Error("Not authenticated");const{exists:w}=await At("users",t,"security test: reading own user document (should succeed)");if(w)return"Successfully read own document";throw new Error("Document does not exist")},!1);break}}async function f(_){e.find(x=>x.name===_)||n(x=>[...x,{name:_,status:"pending",message:"",expectedToFail:!0}]),i(!0),await h(_),i(!1)}const p=e.filter(_=>_.status==="passed").length,g=e.filter(_=>_.status==="failed").length,b=e.length;return d.jsxs("div",{children:[d.jsx("p",{style:QT,children:'Run security tests to verify Firestore rules are working correctly. Tests that are expected to fail (blocked by security rules) should show as "passed".'}),d.jsx("div",{style:{marginBottom:"1.5rem"},children:d.jsx(qe,{onClick:u,disabled:r,variant:"primary",children:r?"Running Tests...":"Run All Tests"})}),e.length>0&&d.jsx(qL,{totalCount:b,passedCount:p,failedCount:g}),d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:[d.jsx("h3",{style:{margin:"0.5rem 0"},children:"Individual Tests"}),d.jsx(ql,{name:"Read unauthorized budget",description:"Try to read a budget the user doesn't have access to",expectedBehavior:"Should be blocked by Firestore rules",result:e.find(_=>_.name==="Read unauthorized budget"),onRun:()=>f("Read unauthorized budget"),disabled:r}),d.jsx(ql,{name:"Read another user's document",description:"Try to read another user's profile document",expectedBehavior:"Should be blocked by Firestore rules",result:e.find(_=>_.name==="Read another user's document"),onRun:()=>f("Read another user's document"),disabled:r}),d.jsx(ql,{name:"Read unauthorized budget month",description:"Try to read a month document for a budget you don't have access to",expectedBehavior:"Should be blocked - months inherit budget access",result:e.find(_=>_.name==="Read unauthorized budget month"),onRun:()=>f("Read unauthorized budget month"),disabled:r}),d.jsx(ql,{name:"Toggle is_admin in own permission_flags",description:"Try to change your admin privileges (toggles current value)",expectedBehavior:"Should be blocked - permission_flags is protected",result:e.find(_=>_.name==="Toggle is_admin in own permission_flags"),onRun:()=>f("Toggle is_admin in own permission_flags"),disabled:r}),d.jsx(ql,{name:"Toggle is_test in own permission_flags",description:"Try to change your test privileges (toggles current value)",expectedBehavior:"Should be blocked - permission_flags is protected",result:e.find(_=>_.name==="Toggle is_test in own permission_flags"),onRun:()=>f("Toggle is_test in own permission_flags"),disabled:r}),d.jsx(ql,{name:"Read own user document",description:"Read your own user profile document",expectedBehavior:"Should succeed - users can read their own data",result:e.find(_=>_.name==="Read own user document"),onRun:()=>f("Read own user document"),disabled:r,expectedToSucceed:!0})]}),g>0&&d.jsxs(s_,{style:{marginTop:"1.5rem"},children:[" ",g," test(s) failed! This may indicate a security vulnerability in your Firestore rules."]})]})}function GL({children:t}){const{addLoadingHold:e,removeLoadingHold:n}=In(),r=R.useContext(Cd),i=tr();return R.useEffect(()=>(r.is_auth_checked?n("protected-route"):e("protected-route","Checking authentication..."),()=>n("protected-route")),[r.is_auth_checked,e,n]),r.is_auth_checked?r.is_logged_in?t?d.jsx(d.Fragment,{children:t}):d.jsx(Yf,{}):d.jsx(Kf,{to:"/account",state:{from:i.pathname},replace:!0}):null}function WL(){const{addLoadingHold:t,removeLoadingHold:e}=In(),{isInitialized:n,pageTitle:r}=Ye(),{isLoading:i,error:o}=Dn();return R.useEffect(()=>{n?e("budget-init"):t("budget-init",i?"Fetching data from server...":"Loading budget...")},[n,i,t,e]),R.useEffect(()=>()=>e("budget-init"),[e]),o?(console.error("[BudgetLayout] Error:",o),d.jsx("div",{style:qf,children:d.jsxs("p",{style:{color:"var(--color-error)"},children:["Error: ",o.message]})})):d.jsx("div",{style:{...qf,paddingBottom:"5rem"},children:d.jsxs(gA,{children:[d.jsx(iz,{title:r}),n&&d.jsx(Yf,{})]})})}const QL={is_logged_in:!1,is_auth_checked:!1,username:"",set_user_context:()=>{}};function KL(){const{isLoading:t,loadingMessage:e}=In();return t?d.jsx(d4,{message:e}):null}function YL(){const[t,e]=R.useState(null);return R.useEffect(()=>qn.subscribe(e),[]),t?d.jsx(oz,{item:t,onDismiss:n=>qn.remove(n)}):null}function XL(){return Pn(),d.jsxs(d.Fragment,{children:[d.jsxs(uI,{children:[d.jsx(vn,{path:"/",element:d.jsx(h4,{})}),d.jsx(vn,{path:"/account",element:d.jsx(f4,{})}),d.jsx(vn,{path:"/budget",element:d.jsx(GL,{}),children:d.jsxs(vn,{element:d.jsx(WL,{}),children:[d.jsx(vn,{index:!0,element:d.jsx(p1,{})}),d.jsx(vn,{path:":year/:month/:tab/:view?",element:d.jsx(p1,{})}),d.jsx(vn,{path:"analytics",element:d.jsx(_L,{})}),d.jsx(vn,{path:"my-budgets",element:d.jsx(AL,{})}),d.jsxs(vn,{path:"settings",element:d.jsx(RL,{}),children:[d.jsx(vn,{index:!0,element:d.jsx(Kf,{to:"general",replace:!0})}),d.jsx(vn,{path:"general",element:d.jsx(IL,{})}),d.jsx(vn,{path:"accounts",element:d.jsx(ML,{})}),d.jsx(vn,{path:"categories",element:d.jsx(PL,{})}),d.jsx(vn,{path:"users",element:d.jsx(BL,{})})]}),d.jsxs(vn,{path:"admin",element:d.jsx(LL,{}),children:[d.jsx(vn,{path:"budget",element:d.jsx(UL,{})}),d.jsx(vn,{path:"feedback",element:d.jsx(FL,{})}),d.jsx(vn,{path:"migration",element:d.jsx($L,{})}),d.jsx(vn,{path:"tests",element:d.jsx(HL,{})})]})]})})]}),d.jsx(nz,{}),d.jsx(vA,{}),d.jsx(YL,{})]})}function ZL(){const[t,e]=R.useState(QL),n=zi(),r=R.useRef(!1),{addLoadingHold:i,removeLoadingHold:o}=In();return R.useEffect(function(){r.current||(r.current=!0,n.set_user_listener(l=>{e({is_logged_in:l!=null,is_auth_checked:!0,username:l?.email??"",set_user_context:e})}))},[n]),R.useEffect(()=>{t.is_auth_checked?o("auth"):i("auth","Authenticating...")},[t.is_auth_checked,i,o]),t.is_auth_checked?d.jsx(Cd.Provider,{value:t,children:d.jsx(RM,{children:d.jsx(Mz,{children:d.jsx(FB,{children:d.jsx(NI,{children:d.jsx(XL,{})})})})})}):null}function JL(){return d.jsxs(GI,{children:[d.jsx(KL,{}),d.jsx(ZL,{})]})}uR.createRoot(document.getElementById("root")).render(d.jsx(R.StrictMode,{children:d.jsx(JL,{})}));
