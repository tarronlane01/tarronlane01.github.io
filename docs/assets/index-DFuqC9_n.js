(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function n(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(s){if(s.ep)return;s.ep=!0;const o=n(s);fetch(s.href,o)}})();var Lh=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Z5(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var vg={exports:{}},gu={};var vx;function J5(){if(vx)return gu;vx=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function n(r,s,o){var l=null;if(o!==void 0&&(l=""+o),s.key!==void 0&&(l=""+s.key),"key"in s){o={};for(var d in s)d!=="key"&&(o[d]=s[d])}else o=s;return s=o.ref,{$$typeof:t,type:r,key:l,ref:s!==void 0?s:null,props:o}}return gu.Fragment=e,gu.jsx=n,gu.jsxs=n,gu}var xx;function e2(){return xx||(xx=1,vg.exports=J5()),vg.exports}var u=e2(),xg={exports:{}},tt={};var wx;function t2(){if(wx)return tt;wx=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),o=Symbol.for("react.consumer"),l=Symbol.for("react.context"),d=Symbol.for("react.forward_ref"),h=Symbol.for("react.suspense"),m=Symbol.for("react.memo"),p=Symbol.for("react.lazy"),g=Symbol.for("react.activity"),v=Symbol.iterator;function _(P){return P===null||typeof P!="object"?null:(P=v&&P[v]||P["@@iterator"],typeof P=="function"?P:null)}var S={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},x=Object.assign,E={};function C(P,$,te){this.props=P,this.context=$,this.refs=E,this.updater=te||S}C.prototype.isReactComponent={},C.prototype.setState=function(P,$){if(typeof P!="object"&&typeof P!="function"&&P!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,P,$,"setState")},C.prototype.forceUpdate=function(P){this.updater.enqueueForceUpdate(this,P,"forceUpdate")};function T(){}T.prototype=C.prototype;function A(P,$,te){this.props=P,this.context=$,this.refs=E,this.updater=te||S}var B=A.prototype=new T;B.constructor=A,x(B,C.prototype),B.isPureReactComponent=!0;var U=Array.isArray;function G(){}var k={H:null,A:null,T:null,S:null},D=Object.prototype.hasOwnProperty;function N(P,$,te){var se=te.ref;return{$$typeof:t,type:P,key:$,ref:se!==void 0?se:null,props:te}}function F(P,$){return N(P.type,$,P.props)}function H(P){return typeof P=="object"&&P!==null&&P.$$typeof===t}function j(P){var $={"=":"=0",":":"=2"};return"$"+P.replace(/[=:]/g,function(te){return $[te]})}var M=/\/+/g;function R(P,$){return typeof P=="object"&&P!==null&&P.key!=null?j(""+P.key):$.toString(36)}function K(P){switch(P.status){case"fulfilled":return P.value;case"rejected":throw P.reason;default:switch(typeof P.status=="string"?P.then(G,G):(P.status="pending",P.then(function($){P.status==="pending"&&(P.status="fulfilled",P.value=$)},function($){P.status==="pending"&&(P.status="rejected",P.reason=$)})),P.status){case"fulfilled":return P.value;case"rejected":throw P.reason}}throw P}function W(P,$,te,se,ae){var ye=typeof P;(ye==="undefined"||ye==="boolean")&&(P=null);var Ie=!1;if(P===null)Ie=!0;else switch(ye){case"bigint":case"string":case"number":Ie=!0;break;case"object":switch(P.$$typeof){case t:case e:Ie=!0;break;case p:return Ie=P._init,W(Ie(P._payload),$,te,se,ae)}}if(Ie)return ae=ae(P),Ie=se===""?"."+R(P,0):se,U(ae)?(te="",Ie!=null&&(te=Ie.replace(M,"$&/")+"/"),W(ae,$,te,"",function(pe){return pe})):ae!=null&&(H(ae)&&(ae=F(ae,te+(ae.key==null||P&&P.key===ae.key?"":(""+ae.key).replace(M,"$&/")+"/")+Ie)),$.push(ae)),1;Ie=0;var Ee=se===""?".":se+":";if(U(P))for(var Ce=0;Ce<P.length;Ce++)se=P[Ce],ye=Ee+R(se,Ce),Ie+=W(se,$,te,ye,ae);else if(Ce=_(P),typeof Ce=="function")for(P=Ce.call(P),Ce=0;!(se=P.next()).done;)se=se.value,ye=Ee+R(se,Ce++),Ie+=W(se,$,te,ye,ae);else if(ye==="object"){if(typeof P.then=="function")return W(K(P),$,te,se,ae);throw $=String(P),Error("Objects are not valid as a React child (found: "+($==="[object Object]"?"object with keys {"+Object.keys(P).join(", ")+"}":$)+"). If you meant to render a collection of children, use an array instead.")}return Ie}function q(P,$,te){if(P==null)return P;var se=[],ae=0;return W(P,se,"","",function(ye){return $.call(te,ye,ae++)}),se}function J(P){if(P._status===-1){var $=P._result;$=$(),$.then(function(te){(P._status===0||P._status===-1)&&(P._status=1,P._result=te)},function(te){(P._status===0||P._status===-1)&&(P._status=2,P._result=te)}),P._status===-1&&(P._status=0,P._result=$)}if(P._status===1)return P._result.default;throw P._result}var Z=typeof reportError=="function"?reportError:function(P){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var $=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof P=="object"&&P!==null&&typeof P.message=="string"?String(P.message):String(P),error:P});if(!window.dispatchEvent($))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",P);return}console.error(P)},re={map:q,forEach:function(P,$,te){q(P,function(){$.apply(this,arguments)},te)},count:function(P){var $=0;return q(P,function(){$++}),$},toArray:function(P){return q(P,function($){return $})||[]},only:function(P){if(!H(P))throw Error("React.Children.only expected to receive a single React element child.");return P}};return tt.Activity=g,tt.Children=re,tt.Component=C,tt.Fragment=n,tt.Profiler=s,tt.PureComponent=A,tt.StrictMode=r,tt.Suspense=h,tt.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=k,tt.__COMPILER_RUNTIME={__proto__:null,c:function(P){return k.H.useMemoCache(P)}},tt.cache=function(P){return function(){return P.apply(null,arguments)}},tt.cacheSignal=function(){return null},tt.cloneElement=function(P,$,te){if(P==null)throw Error("The argument must be a React element, but you passed "+P+".");var se=x({},P.props),ae=P.key;if($!=null)for(ye in $.key!==void 0&&(ae=""+$.key),$)!D.call($,ye)||ye==="key"||ye==="__self"||ye==="__source"||ye==="ref"&&$.ref===void 0||(se[ye]=$[ye]);var ye=arguments.length-2;if(ye===1)se.children=te;else if(1<ye){for(var Ie=Array(ye),Ee=0;Ee<ye;Ee++)Ie[Ee]=arguments[Ee+2];se.children=Ie}return N(P.type,ae,se)},tt.createContext=function(P){return P={$$typeof:l,_currentValue:P,_currentValue2:P,_threadCount:0,Provider:null,Consumer:null},P.Provider=P,P.Consumer={$$typeof:o,_context:P},P},tt.createElement=function(P,$,te){var se,ae={},ye=null;if($!=null)for(se in $.key!==void 0&&(ye=""+$.key),$)D.call($,se)&&se!=="key"&&se!=="__self"&&se!=="__source"&&(ae[se]=$[se]);var Ie=arguments.length-2;if(Ie===1)ae.children=te;else if(1<Ie){for(var Ee=Array(Ie),Ce=0;Ce<Ie;Ce++)Ee[Ce]=arguments[Ce+2];ae.children=Ee}if(P&&P.defaultProps)for(se in Ie=P.defaultProps,Ie)ae[se]===void 0&&(ae[se]=Ie[se]);return N(P,ye,ae)},tt.createRef=function(){return{current:null}},tt.forwardRef=function(P){return{$$typeof:d,render:P}},tt.isValidElement=H,tt.lazy=function(P){return{$$typeof:p,_payload:{_status:-1,_result:P},_init:J}},tt.memo=function(P,$){return{$$typeof:m,type:P,compare:$===void 0?null:$}},tt.startTransition=function(P){var $=k.T,te={};k.T=te;try{var se=P(),ae=k.S;ae!==null&&ae(te,se),typeof se=="object"&&se!==null&&typeof se.then=="function"&&se.then(G,Z)}catch(ye){Z(ye)}finally{$!==null&&te.types!==null&&($.types=te.types),k.T=$}},tt.unstable_useCacheRefresh=function(){return k.H.useCacheRefresh()},tt.use=function(P){return k.H.use(P)},tt.useActionState=function(P,$,te){return k.H.useActionState(P,$,te)},tt.useCallback=function(P,$){return k.H.useCallback(P,$)},tt.useContext=function(P){return k.H.useContext(P)},tt.useDebugValue=function(){},tt.useDeferredValue=function(P,$){return k.H.useDeferredValue(P,$)},tt.useEffect=function(P,$){return k.H.useEffect(P,$)},tt.useEffectEvent=function(P){return k.H.useEffectEvent(P)},tt.useId=function(){return k.H.useId()},tt.useImperativeHandle=function(P,$,te){return k.H.useImperativeHandle(P,$,te)},tt.useInsertionEffect=function(P,$){return k.H.useInsertionEffect(P,$)},tt.useLayoutEffect=function(P,$){return k.H.useLayoutEffect(P,$)},tt.useMemo=function(P,$){return k.H.useMemo(P,$)},tt.useOptimistic=function(P,$){return k.H.useOptimistic(P,$)},tt.useReducer=function(P,$,te){return k.H.useReducer(P,$,te)},tt.useRef=function(P){return k.H.useRef(P)},tt.useState=function(P){return k.H.useState(P)},tt.useSyncExternalStore=function(P,$,te){return k.H.useSyncExternalStore(P,$,te)},tt.useTransition=function(){return k.H.useTransition()},tt.version="19.2.3",tt}var Sx;function Py(){return Sx||(Sx=1,xg.exports=t2()),xg.exports}var O=Py(),wg={exports:{}},yu={},Sg={exports:{}},Eg={};var Ex;function n2(){return Ex||(Ex=1,(function(t){function e(W,q){var J=W.length;W.push(q);e:for(;0<J;){var Z=J-1>>>1,re=W[Z];if(0<s(re,q))W[Z]=q,W[J]=re,J=Z;else break e}}function n(W){return W.length===0?null:W[0]}function r(W){if(W.length===0)return null;var q=W[0],J=W.pop();if(J!==q){W[0]=J;e:for(var Z=0,re=W.length,P=re>>>1;Z<P;){var $=2*(Z+1)-1,te=W[$],se=$+1,ae=W[se];if(0>s(te,J))se<re&&0>s(ae,te)?(W[Z]=ae,W[se]=J,Z=se):(W[Z]=te,W[$]=J,Z=$);else if(se<re&&0>s(ae,J))W[Z]=ae,W[se]=J,Z=se;else break e}}return q}function s(W,q){var J=W.sortIndex-q.sortIndex;return J!==0?J:W.id-q.id}if(t.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var o=performance;t.unstable_now=function(){return o.now()}}else{var l=Date,d=l.now();t.unstable_now=function(){return l.now()-d}}var h=[],m=[],p=1,g=null,v=3,_=!1,S=!1,x=!1,E=!1,C=typeof setTimeout=="function"?setTimeout:null,T=typeof clearTimeout=="function"?clearTimeout:null,A=typeof setImmediate<"u"?setImmediate:null;function B(W){for(var q=n(m);q!==null;){if(q.callback===null)r(m);else if(q.startTime<=W)r(m),q.sortIndex=q.expirationTime,e(h,q);else break;q=n(m)}}function U(W){if(x=!1,B(W),!S)if(n(h)!==null)S=!0,G||(G=!0,j());else{var q=n(m);q!==null&&K(U,q.startTime-W)}}var G=!1,k=-1,D=5,N=-1;function F(){return E?!0:!(t.unstable_now()-N<D)}function H(){if(E=!1,G){var W=t.unstable_now();N=W;var q=!0;try{e:{S=!1,x&&(x=!1,T(k),k=-1),_=!0;var J=v;try{t:{for(B(W),g=n(h);g!==null&&!(g.expirationTime>W&&F());){var Z=g.callback;if(typeof Z=="function"){g.callback=null,v=g.priorityLevel;var re=Z(g.expirationTime<=W);if(W=t.unstable_now(),typeof re=="function"){g.callback=re,B(W),q=!0;break t}g===n(h)&&r(h),B(W)}else r(h);g=n(h)}if(g!==null)q=!0;else{var P=n(m);P!==null&&K(U,P.startTime-W),q=!1}}break e}finally{g=null,v=J,_=!1}q=void 0}}finally{q?j():G=!1}}}var j;if(typeof A=="function")j=function(){A(H)};else if(typeof MessageChannel<"u"){var M=new MessageChannel,R=M.port2;M.port1.onmessage=H,j=function(){R.postMessage(null)}}else j=function(){C(H,0)};function K(W,q){k=C(function(){W(t.unstable_now())},q)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(W){W.callback=null},t.unstable_forceFrameRate=function(W){0>W||125<W?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):D=0<W?Math.floor(1e3/W):5},t.unstable_getCurrentPriorityLevel=function(){return v},t.unstable_next=function(W){switch(v){case 1:case 2:case 3:var q=3;break;default:q=v}var J=v;v=q;try{return W()}finally{v=J}},t.unstable_requestPaint=function(){E=!0},t.unstable_runWithPriority=function(W,q){switch(W){case 1:case 2:case 3:case 4:case 5:break;default:W=3}var J=v;v=W;try{return q()}finally{v=J}},t.unstable_scheduleCallback=function(W,q,J){var Z=t.unstable_now();switch(typeof J=="object"&&J!==null?(J=J.delay,J=typeof J=="number"&&0<J?Z+J:Z):J=Z,W){case 1:var re=-1;break;case 2:re=250;break;case 5:re=1073741823;break;case 4:re=1e4;break;default:re=5e3}return re=J+re,W={id:p++,callback:q,priorityLevel:W,startTime:J,expirationTime:re,sortIndex:-1},J>Z?(W.sortIndex=J,e(m,W),n(h)===null&&W===n(m)&&(x?(T(k),k=-1):x=!0,K(U,J-Z))):(W.sortIndex=re,e(h,W),S||_||(S=!0,G||(G=!0,j()))),W},t.unstable_shouldYield=F,t.unstable_wrapCallback=function(W){var q=v;return function(){var J=v;v=q;try{return W.apply(this,arguments)}finally{v=J}}}})(Eg)),Eg}var Cx;function r2(){return Cx||(Cx=1,Sg.exports=n2()),Sg.exports}var Cg={exports:{}},Gn={};var Tx;function i2(){if(Tx)return Gn;Tx=1;var t=Py();function e(h){var m="https://react.dev/errors/"+h;if(1<arguments.length){m+="?args[]="+encodeURIComponent(arguments[1]);for(var p=2;p<arguments.length;p++)m+="&args[]="+encodeURIComponent(arguments[p])}return"Minified React error #"+h+"; visit "+m+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function n(){}var r={d:{f:n,r:function(){throw Error(e(522))},D:n,C:n,L:n,m:n,X:n,S:n,M:n},p:0,findDOMNode:null},s=Symbol.for("react.portal");function o(h,m,p){var g=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:s,key:g==null?null:""+g,children:h,containerInfo:m,implementation:p}}var l=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function d(h,m){if(h==="font")return"";if(typeof m=="string")return m==="use-credentials"?m:""}return Gn.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=r,Gn.createPortal=function(h,m){var p=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!m||m.nodeType!==1&&m.nodeType!==9&&m.nodeType!==11)throw Error(e(299));return o(h,m,null,p)},Gn.flushSync=function(h){var m=l.T,p=r.p;try{if(l.T=null,r.p=2,h)return h()}finally{l.T=m,r.p=p,r.d.f()}},Gn.preconnect=function(h,m){typeof h=="string"&&(m?(m=m.crossOrigin,m=typeof m=="string"?m==="use-credentials"?m:"":void 0):m=null,r.d.C(h,m))},Gn.prefetchDNS=function(h){typeof h=="string"&&r.d.D(h)},Gn.preinit=function(h,m){if(typeof h=="string"&&m&&typeof m.as=="string"){var p=m.as,g=d(p,m.crossOrigin),v=typeof m.integrity=="string"?m.integrity:void 0,_=typeof m.fetchPriority=="string"?m.fetchPriority:void 0;p==="style"?r.d.S(h,typeof m.precedence=="string"?m.precedence:void 0,{crossOrigin:g,integrity:v,fetchPriority:_}):p==="script"&&r.d.X(h,{crossOrigin:g,integrity:v,fetchPriority:_,nonce:typeof m.nonce=="string"?m.nonce:void 0})}},Gn.preinitModule=function(h,m){if(typeof h=="string")if(typeof m=="object"&&m!==null){if(m.as==null||m.as==="script"){var p=d(m.as,m.crossOrigin);r.d.M(h,{crossOrigin:p,integrity:typeof m.integrity=="string"?m.integrity:void 0,nonce:typeof m.nonce=="string"?m.nonce:void 0})}}else m==null&&r.d.M(h)},Gn.preload=function(h,m){if(typeof h=="string"&&typeof m=="object"&&m!==null&&typeof m.as=="string"){var p=m.as,g=d(p,m.crossOrigin);r.d.L(h,p,{crossOrigin:g,integrity:typeof m.integrity=="string"?m.integrity:void 0,nonce:typeof m.nonce=="string"?m.nonce:void 0,type:typeof m.type=="string"?m.type:void 0,fetchPriority:typeof m.fetchPriority=="string"?m.fetchPriority:void 0,referrerPolicy:typeof m.referrerPolicy=="string"?m.referrerPolicy:void 0,imageSrcSet:typeof m.imageSrcSet=="string"?m.imageSrcSet:void 0,imageSizes:typeof m.imageSizes=="string"?m.imageSizes:void 0,media:typeof m.media=="string"?m.media:void 0})}},Gn.preloadModule=function(h,m){if(typeof h=="string")if(m){var p=d(m.as,m.crossOrigin);r.d.m(h,{as:typeof m.as=="string"&&m.as!=="script"?m.as:void 0,crossOrigin:p,integrity:typeof m.integrity=="string"?m.integrity:void 0})}else r.d.m(h)},Gn.requestFormReset=function(h){r.d.r(h)},Gn.unstable_batchedUpdates=function(h,m){return h(m)},Gn.useFormState=function(h,m,p){return l.H.useFormState(h,m,p)},Gn.useFormStatus=function(){return l.H.useHostTransitionStatus()},Gn.version="19.2.3",Gn}var Ax;function s2(){if(Ax)return Cg.exports;Ax=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),Cg.exports=i2(),Cg.exports}var jx;function a2(){if(jx)return yu;jx=1;var t=r2(),e=Py(),n=s2();function r(i){var a="https://react.dev/errors/"+i;if(1<arguments.length){a+="?args[]="+encodeURIComponent(arguments[1]);for(var c=2;c<arguments.length;c++)a+="&args[]="+encodeURIComponent(arguments[c])}return"Minified React error #"+i+"; visit "+a+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11)}function o(i){var a=i,c=i;if(i.alternate)for(;a.return;)a=a.return;else{i=a;do a=i,(a.flags&4098)!==0&&(c=a.return),i=a.return;while(i)}return a.tag===3?c:null}function l(i){if(i.tag===13){var a=i.memoizedState;if(a===null&&(i=i.alternate,i!==null&&(a=i.memoizedState)),a!==null)return a.dehydrated}return null}function d(i){if(i.tag===31){var a=i.memoizedState;if(a===null&&(i=i.alternate,i!==null&&(a=i.memoizedState)),a!==null)return a.dehydrated}return null}function h(i){if(o(i)!==i)throw Error(r(188))}function m(i){var a=i.alternate;if(!a){if(a=o(i),a===null)throw Error(r(188));return a!==i?null:i}for(var c=i,f=a;;){var b=c.return;if(b===null)break;var w=b.alternate;if(w===null){if(f=b.return,f!==null){c=f;continue}break}if(b.child===w.child){for(w=b.child;w;){if(w===c)return h(b),i;if(w===f)return h(b),a;w=w.sibling}throw Error(r(188))}if(c.return!==f.return)c=b,f=w;else{for(var z=!1,Q=b.child;Q;){if(Q===c){z=!0,c=b,f=w;break}if(Q===f){z=!0,f=b,c=w;break}Q=Q.sibling}if(!z){for(Q=w.child;Q;){if(Q===c){z=!0,c=w,f=b;break}if(Q===f){z=!0,f=w,c=b;break}Q=Q.sibling}if(!z)throw Error(r(189))}}if(c.alternate!==f)throw Error(r(190))}if(c.tag!==3)throw Error(r(188));return c.stateNode.current===c?i:a}function p(i){var a=i.tag;if(a===5||a===26||a===27||a===6)return i;for(i=i.child;i!==null;){if(a=p(i),a!==null)return a;i=i.sibling}return null}var g=Object.assign,v=Symbol.for("react.element"),_=Symbol.for("react.transitional.element"),S=Symbol.for("react.portal"),x=Symbol.for("react.fragment"),E=Symbol.for("react.strict_mode"),C=Symbol.for("react.profiler"),T=Symbol.for("react.consumer"),A=Symbol.for("react.context"),B=Symbol.for("react.forward_ref"),U=Symbol.for("react.suspense"),G=Symbol.for("react.suspense_list"),k=Symbol.for("react.memo"),D=Symbol.for("react.lazy"),N=Symbol.for("react.activity"),F=Symbol.for("react.memo_cache_sentinel"),H=Symbol.iterator;function j(i){return i===null||typeof i!="object"?null:(i=H&&i[H]||i["@@iterator"],typeof i=="function"?i:null)}var M=Symbol.for("react.client.reference");function R(i){if(i==null)return null;if(typeof i=="function")return i.$$typeof===M?null:i.displayName||i.name||null;if(typeof i=="string")return i;switch(i){case x:return"Fragment";case C:return"Profiler";case E:return"StrictMode";case U:return"Suspense";case G:return"SuspenseList";case N:return"Activity"}if(typeof i=="object")switch(i.$$typeof){case S:return"Portal";case A:return i.displayName||"Context";case T:return(i._context.displayName||"Context")+".Consumer";case B:var a=i.render;return i=i.displayName,i||(i=a.displayName||a.name||"",i=i!==""?"ForwardRef("+i+")":"ForwardRef"),i;case k:return a=i.displayName||null,a!==null?a:R(i.type)||"Memo";case D:a=i._payload,i=i._init;try{return R(i(a))}catch{}}return null}var K=Array.isArray,W=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,q=n.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,J={pending:!1,data:null,method:null,action:null},Z=[],re=-1;function P(i){return{current:i}}function $(i){0>re||(i.current=Z[re],Z[re]=null,re--)}function te(i,a){re++,Z[re]=i.current,i.current=a}var se=P(null),ae=P(null),ye=P(null),Ie=P(null);function Ee(i,a){switch(te(ye,a),te(ae,i),te(se,null),a.nodeType){case 9:case 11:i=(i=a.documentElement)&&(i=i.namespaceURI)?$v(i):0;break;default:if(i=a.tagName,a=a.namespaceURI)a=$v(a),i=Hv(a,i);else switch(i){case"svg":i=1;break;case"math":i=2;break;default:i=0}}$(se),te(se,i)}function Ce(){$(se),$(ae),$(ye)}function pe(i){i.memoizedState!==null&&te(Ie,i);var a=se.current,c=Hv(a,i.type);a!==c&&(te(ae,i),te(se,c))}function Ue(i){ae.current===i&&($(se),$(ae)),Ie.current===i&&($(Ie),hu._currentValue=J)}var He,Me;function L(i){if(He===void 0)try{throw Error()}catch(c){var a=c.stack.trim().match(/\n( *(at )?)/);He=a&&a[1]||"",Me=-1<c.stack.indexOf(`
    at`)?" (<anonymous>)":-1<c.stack.indexOf("@")?"@unknown:0:0":""}return`
`+He+i+Me}var be=!1;function me(i,a){if(!i||be)return"";be=!0;var c=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var f={DetermineComponentFrameRoot:function(){try{if(a){var Re=function(){throw Error()};if(Object.defineProperty(Re.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Re,[])}catch(ve){var ge=ve}Reflect.construct(i,[],Re)}else{try{Re.call()}catch(ve){ge=ve}i.call(Re.prototype)}}else{try{throw Error()}catch(ve){ge=ve}(Re=i())&&typeof Re.catch=="function"&&Re.catch(function(){})}}catch(ve){if(ve&&ge&&typeof ve.stack=="string")return[ve.stack,ge.stack]}return[null,null]}};f.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var b=Object.getOwnPropertyDescriptor(f.DetermineComponentFrameRoot,"name");b&&b.configurable&&Object.defineProperty(f.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var w=f.DetermineComponentFrameRoot(),z=w[0],Q=w[1];if(z&&Q){var ne=z.split(`
`),fe=Q.split(`
`);for(b=f=0;f<ne.length&&!ne[f].includes("DetermineComponentFrameRoot");)f++;for(;b<fe.length&&!fe[b].includes("DetermineComponentFrameRoot");)b++;if(f===ne.length||b===fe.length)for(f=ne.length-1,b=fe.length-1;1<=f&&0<=b&&ne[f]!==fe[b];)b--;for(;1<=f&&0<=b;f--,b--)if(ne[f]!==fe[b]){if(f!==1||b!==1)do if(f--,b--,0>b||ne[f]!==fe[b]){var Se=`
`+ne[f].replace(" at new "," at ");return i.displayName&&Se.includes("<anonymous>")&&(Se=Se.replace("<anonymous>",i.displayName)),Se}while(1<=f&&0<=b);break}}}finally{be=!1,Error.prepareStackTrace=c}return(c=i?i.displayName||i.name:"")?L(c):""}function ee(i,a){switch(i.tag){case 26:case 27:case 5:return L(i.type);case 16:return L("Lazy");case 13:return i.child!==a&&a!==null?L("Suspense Fallback"):L("Suspense");case 19:return L("SuspenseList");case 0:case 15:return me(i.type,!1);case 11:return me(i.type.render,!1);case 1:return me(i.type,!0);case 31:return L("Activity");default:return""}}function X(i){try{var a="",c=null;do a+=ee(i,c),c=i,i=i.return;while(i);return a}catch(f){return`
Error generating stack: `+f.message+`
`+f.stack}}var ie=Object.prototype.hasOwnProperty,we=t.unstable_scheduleCallback,xe=t.unstable_cancelCallback,oe=t.unstable_shouldYield,Ae=t.unstable_requestPaint,Ne=t.unstable_now,ke=t.unstable_getCurrentPriorityLevel,qe=t.unstable_ImmediatePriority,vt=t.unstable_UserBlockingPriority,rt=t.unstable_NormalPriority,Hn=t.unstable_LowPriority,ui=t.unstable_IdlePriority,Xn=t.log,di=t.unstable_setDisableYieldValue,_t=null,Zt=null;function qn(i){if(typeof Xn=="function"&&di(i),Zt&&typeof Zt.setStrictMode=="function")try{Zt.setStrictMode(_t,i)}catch{}}var St=Math.clz32?Math.clz32:Po,za=Math.log,js=Math.LN2;function Po(i){return i>>>=0,i===0?32:31-(za(i)/js|0)|0}var Tr=256,hi=262144,Bt=4194304;function Zn(i){var a=i&42;if(a!==0)return a;switch(i&-i){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return i&261888;case 262144:case 524288:case 1048576:case 2097152:return i&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return i&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return i}}function fi(i,a,c){var f=i.pendingLanes;if(f===0)return 0;var b=0,w=i.suspendedLanes,z=i.pingedLanes;i=i.warmLanes;var Q=f&134217727;return Q!==0?(f=Q&~w,f!==0?b=Zn(f):(z&=Q,z!==0?b=Zn(z):c||(c=Q&~i,c!==0&&(b=Zn(c))))):(Q=f&~w,Q!==0?b=Zn(Q):z!==0?b=Zn(z):c||(c=f&~i,c!==0&&(b=Zn(c)))),b===0?0:a!==0&&a!==b&&(a&w)===0&&(w=b&-b,c=a&-a,w>=c||w===32&&(c&4194048)!==0)?a:b}function Hr(i,a){return(i.pendingLanes&~(i.suspendedLanes&~i.pingedLanes)&a)===0}function Em(i,a){switch(i){case 1:case 2:case 4:case 8:case 64:return a+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function gd(){var i=Bt;return Bt<<=1,(Bt&62914560)===0&&(Bt=4194304),i}function mi(i){for(var a=[],c=0;31>c;c++)a.push(i);return a}function Ba(i,a){i.pendingLanes|=a,a!==268435456&&(i.suspendedLanes=0,i.pingedLanes=0,i.warmLanes=0)}function Cm(i,a,c,f,b,w){var z=i.pendingLanes;i.pendingLanes=c,i.suspendedLanes=0,i.pingedLanes=0,i.warmLanes=0,i.expiredLanes&=c,i.entangledLanes&=c,i.errorRecoveryDisabledLanes&=c,i.shellSuspendCounter=0;var Q=i.entanglements,ne=i.expirationTimes,fe=i.hiddenUpdates;for(c=z&~c;0<c;){var Se=31-St(c),Re=1<<Se;Q[Se]=0,ne[Se]=-1;var ge=fe[Se];if(ge!==null)for(fe[Se]=null,Se=0;Se<ge.length;Se++){var ve=ge[Se];ve!==null&&(ve.lane&=-536870913)}c&=~Re}f!==0&&La(i,f,0),w!==0&&b===0&&i.tag!==0&&(i.suspendedLanes|=w&~(z&~a))}function La(i,a,c){i.pendingLanes|=a,i.suspendedLanes&=~a;var f=31-St(a);i.entangledLanes|=a,i.entanglements[f]=i.entanglements[f]|1073741824|c&261930}function yc(i,a){var c=i.entangledLanes|=a;for(i=i.entanglements;c;){var f=31-St(c),b=1<<f;b&a|i[f]&a&&(i[f]|=a),c&=~b}}function _c(i,a){var c=a&-a;return c=(c&42)!==0?1:Ua(c),(c&(i.suspendedLanes|a))!==0?0:c}function Ua(i){switch(i){case 2:i=1;break;case 8:i=4;break;case 32:i=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:i=128;break;case 268435456:i=134217728;break;default:i=0}return i}function Wi(i){return i&=-i,2<i?8<i?(i&134217727)!==0?32:268435456:8:2}function yd(){var i=q.p;return i!==0?i:(i=window.event,i===void 0?32:fx(i.type))}function qr(i,a){var c=q.p;try{return q.p=i,a()}finally{q.p=c}}var Gr=Math.random().toString(36).slice(2),cn="__reactFiber$"+Gr,jn="__reactProps$"+Gr,pi="__reactContainer$"+Gr,zo="__reactEvents$"+Gr,Tm="__reactListeners$"+Gr,_d="__reactHandles$"+Gr,bd="__reactResources$"+Gr,gi="__reactMarker$"+Gr;function Bo(i){delete i[cn],delete i[jn],delete i[zo],delete i[Tm],delete i[_d]}function yi(i){var a=i[cn];if(a)return a;for(var c=i.parentNode;c;){if(a=c[pi]||c[cn]){if(c=a.alternate,a.child!==null||c!==null&&c.child!==null)for(i=Xv(i);i!==null;){if(c=i[cn])return c;i=Xv(i)}return a}i=c,c=i.parentNode}return null}function Ar(i){if(i=i[cn]||i[pi]){var a=i.tag;if(a===5||a===6||a===13||a===31||a===26||a===27||a===3)return i}return null}function mr(i){var a=i.tag;if(a===5||a===26||a===27||a===6)return i.stateNode;throw Error(r(33))}function _i(i){var a=i[bd];return a||(a=i[bd]={hoistableStyles:new Map,hoistableScripts:new Map}),a}function un(i){i[gi]=!0}var bc=new Set,vc={};function bi(i,a){vi(i,a),vi(i+"Capture",a)}function vi(i,a){for(vc[i]=a,i=0;i<a.length;i++)bc.add(a[i])}var xc=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),wc={},Sc={};function vd(i){return ie.call(Sc,i)?!0:ie.call(wc,i)?!1:xc.test(i)?Sc[i]=!0:(wc[i]=!0,!1)}function Lo(i,a,c){if(vd(a))if(c===null)i.removeAttribute(a);else{switch(typeof c){case"undefined":case"function":case"symbol":i.removeAttribute(a);return;case"boolean":var f=a.toLowerCase().slice(0,5);if(f!=="data-"&&f!=="aria-"){i.removeAttribute(a);return}}i.setAttribute(a,""+c)}}function pr(i,a,c){if(c===null)i.removeAttribute(a);else{switch(typeof c){case"undefined":case"function":case"symbol":case"boolean":i.removeAttribute(a);return}i.setAttribute(a,""+c)}}function dn(i,a,c,f){if(f===null)i.removeAttribute(c);else{switch(typeof f){case"undefined":case"function":case"symbol":case"boolean":i.removeAttribute(c);return}i.setAttributeNS(a,c,""+f)}}function Rn(i){switch(typeof i){case"bigint":case"boolean":case"number":case"string":case"undefined":return i;case"object":return i;default:return""}}function Rs(i){var a=i.type;return(i=i.nodeName)&&i.toLowerCase()==="input"&&(a==="checkbox"||a==="radio")}function Ec(i,a,c){var f=Object.getOwnPropertyDescriptor(i.constructor.prototype,a);if(!i.hasOwnProperty(a)&&typeof f<"u"&&typeof f.get=="function"&&typeof f.set=="function"){var b=f.get,w=f.set;return Object.defineProperty(i,a,{configurable:!0,get:function(){return b.call(this)},set:function(z){c=""+z,w.call(this,z)}}),Object.defineProperty(i,a,{enumerable:f.enumerable}),{getValue:function(){return c},setValue:function(z){c=""+z},stopTracking:function(){i._valueTracker=null,delete i[a]}}}}function At(i){if(!i._valueTracker){var a=Rs(i)?"checked":"value";i._valueTracker=Ec(i,a,""+i[a])}}function Fa(i){if(!i)return!1;var a=i._valueTracker;if(!a)return!0;var c=a.getValue(),f="";return i&&(f=Rs(i)?i.checked?"true":"false":i.value),i=f,i!==c?(a.setValue(i),!0):!1}function xi(i){if(i=i||(typeof document<"u"?document:void 0),typeof i>"u")return null;try{return i.activeElement||i.body}catch{return i.body}}var Va=/[\n"\\]/g;function rr(i){return i.replace(Va,function(a){return"\\"+a.charCodeAt(0).toString(16)+" "})}function Uo(i,a,c,f,b,w,z,Q){i.name="",z!=null&&typeof z!="function"&&typeof z!="symbol"&&typeof z!="boolean"?i.type=z:i.removeAttribute("type"),a!=null?z==="number"?(a===0&&i.value===""||i.value!=a)&&(i.value=""+Rn(a)):i.value!==""+Rn(a)&&(i.value=""+Rn(a)):z!=="submit"&&z!=="reset"||i.removeAttribute("value"),a!=null?Cc(i,z,Rn(a)):c!=null?Cc(i,z,Rn(c)):f!=null&&i.removeAttribute("value"),b==null&&w!=null&&(i.defaultChecked=!!w),b!=null&&(i.checked=b&&typeof b!="function"&&typeof b!="symbol"),Q!=null&&typeof Q!="function"&&typeof Q!="symbol"&&typeof Q!="boolean"?i.name=""+Rn(Q):i.removeAttribute("name")}function xd(i,a,c,f,b,w,z,Q){if(w!=null&&typeof w!="function"&&typeof w!="symbol"&&typeof w!="boolean"&&(i.type=w),a!=null||c!=null){if(!(w!=="submit"&&w!=="reset"||a!=null)){At(i);return}c=c!=null?""+Rn(c):"",a=a!=null?""+Rn(a):c,Q||a===i.value||(i.value=a),i.defaultValue=a}f=f??b,f=typeof f!="function"&&typeof f!="symbol"&&!!f,i.checked=Q?i.checked:!!f,i.defaultChecked=!!f,z!=null&&typeof z!="function"&&typeof z!="symbol"&&typeof z!="boolean"&&(i.name=z),At(i)}function Cc(i,a,c){a==="number"&&xi(i.ownerDocument)===i||i.defaultValue===""+c||(i.defaultValue=""+c)}function Is(i,a,c,f){if(i=i.options,a){a={};for(var b=0;b<c.length;b++)a["$"+c[b]]=!0;for(c=0;c<i.length;c++)b=a.hasOwnProperty("$"+i[c].value),i[c].selected!==b&&(i[c].selected=b),b&&f&&(i[c].defaultSelected=!0)}else{for(c=""+Rn(c),a=null,b=0;b<i.length;b++){if(i[b].value===c){i[b].selected=!0,f&&(i[b].defaultSelected=!0);return}a!==null||i[b].disabled||(a=i[b])}a!==null&&(a.selected=!0)}}function wd(i,a,c){if(a!=null&&(a=""+Rn(a),a!==i.value&&(i.value=a),c==null)){i.defaultValue!==a&&(i.defaultValue=a);return}i.defaultValue=c!=null?""+Rn(c):""}function Ds(i,a,c,f){if(a==null){if(f!=null){if(c!=null)throw Error(r(92));if(K(f)){if(1<f.length)throw Error(r(93));f=f[0]}c=f}c==null&&(c=""),a=c}c=Rn(a),i.defaultValue=c,f=i.textContent,f===c&&f!==""&&f!==null&&(i.value=f),At(i)}function ir(i,a){if(a){var c=i.firstChild;if(c&&c===i.lastChild&&c.nodeType===3){c.nodeValue=a;return}}i.textContent=a}var Sd=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Tc(i,a,c){var f=a.indexOf("--")===0;c==null||typeof c=="boolean"||c===""?f?i.setProperty(a,""):a==="float"?i.cssFloat="":i[a]="":f?i.setProperty(a,c):typeof c!="number"||c===0||Sd.has(a)?a==="float"?i.cssFloat=c:i[a]=(""+c).trim():i[a]=c+"px"}function Ac(i,a,c){if(a!=null&&typeof a!="object")throw Error(r(62));if(i=i.style,c!=null){for(var f in c)!c.hasOwnProperty(f)||a!=null&&a.hasOwnProperty(f)||(f.indexOf("--")===0?i.setProperty(f,""):f==="float"?i.cssFloat="":i[f]="");for(var b in a)f=a[b],a.hasOwnProperty(b)&&c[b]!==f&&Tc(i,b,f)}else for(var w in a)a.hasOwnProperty(w)&&Tc(i,w,a[w])}function Fo(i){if(i.indexOf("-")===-1)return!1;switch(i){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Ed=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),ks=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Vo(i){return ks.test(""+i)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":i}function Wr(){}var jc=null;function jr(i){return i=i.target||i.srcElement||window,i.correspondingUseElement&&(i=i.correspondingUseElement),i.nodeType===3?i.parentNode:i}var Os=null,wi=null;function $a(i){var a=Ar(i);if(a&&(i=a.stateNode)){var c=i[jn]||null;e:switch(i=a.stateNode,a.type){case"input":if(Uo(i,c.value,c.defaultValue,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name),a=c.name,c.type==="radio"&&a!=null){for(c=i;c.parentNode;)c=c.parentNode;for(c=c.querySelectorAll('input[name="'+rr(""+a)+'"][type="radio"]'),a=0;a<c.length;a++){var f=c[a];if(f!==i&&f.form===i.form){var b=f[jn]||null;if(!b)throw Error(r(90));Uo(f,b.value,b.defaultValue,b.defaultValue,b.checked,b.defaultChecked,b.type,b.name)}}for(a=0;a<c.length;a++)f=c[a],f.form===i.form&&Fa(f)}break e;case"textarea":wd(i,c.value,c.defaultValue);break e;case"select":a=c.value,a!=null&&Is(i,!!c.multiple,a,!1)}}}var $o=!1;function Ms(i,a,c){if($o)return i(a,c);$o=!0;try{var f=i(a);return f}finally{if($o=!1,(Os!==null||wi!==null)&&(yh(),Os&&(a=Os,i=wi,wi=Os=null,$a(a),i)))for(a=0;a<i.length;a++)$a(i[a])}}function Qr(i,a){var c=i.stateNode;if(c===null)return null;var f=c[jn]||null;if(f===null)return null;c=f[a];e:switch(a){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(f=!f.disabled)||(i=i.type,f=!(i==="button"||i==="input"||i==="select"||i==="textarea")),i=!f;break e;default:i=!1}if(i)return null;if(c&&typeof c!="function")throw Error(r(231,a,typeof c));return c}var Rr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Ha=!1;if(Rr)try{var It={};Object.defineProperty(It,"passive",{get:function(){Ha=!0}}),window.addEventListener("test",It,It),window.removeEventListener("test",It,It)}catch{Ha=!1}var Si=null,Rc=null,qa=null;function Ic(){if(qa)return qa;var i,a=Rc,c=a.length,f,b="value"in Si?Si.value:Si.textContent,w=b.length;for(i=0;i<c&&a[i]===b[i];i++);var z=c-i;for(f=1;f<=z&&a[c-f]===b[w-f];f++);return qa=b.slice(i,1<f?1-f:void 0)}function Ga(i){var a=i.keyCode;return"charCode"in i?(i=i.charCode,i===0&&a===13&&(i=13)):i=a,i===10&&(i=13),32<=i||i===13?i:0}function Qi(){return!0}function Kr(){return!1}function kn(i){function a(c,f,b,w,z){this._reactName=c,this._targetInst=b,this.type=f,this.nativeEvent=w,this.target=z,this.currentTarget=null;for(var Q in i)i.hasOwnProperty(Q)&&(c=i[Q],this[Q]=c?c(w):w[Q]);return this.isDefaultPrevented=(w.defaultPrevented!=null?w.defaultPrevented:w.returnValue===!1)?Qi:Kr,this.isPropagationStopped=Kr,this}return g(a.prototype,{preventDefault:function(){this.defaultPrevented=!0;var c=this.nativeEvent;c&&(c.preventDefault?c.preventDefault():typeof c.returnValue!="unknown"&&(c.returnValue=!1),this.isDefaultPrevented=Qi)},stopPropagation:function(){var c=this.nativeEvent;c&&(c.stopPropagation?c.stopPropagation():typeof c.cancelBubble!="unknown"&&(c.cancelBubble=!0),this.isPropagationStopped=Qi)},persist:function(){},isPersistent:Qi}),a}var Ki={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(i){return i.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Ei=kn(Ki),Ns=g({},Ki,{view:0,detail:0}),Dc=kn(Ns),Ps,Ho,Ci,qo=g({},Ns,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:zs,button:0,buttons:0,relatedTarget:function(i){return i.relatedTarget===void 0?i.fromElement===i.srcElement?i.toElement:i.fromElement:i.relatedTarget},movementX:function(i){return"movementX"in i?i.movementX:(i!==Ci&&(Ci&&i.type==="mousemove"?(Ps=i.screenX-Ci.screenX,Ho=i.screenY-Ci.screenY):Ho=Ps=0,Ci=i),Ps)},movementY:function(i){return"movementY"in i?i.movementY:Ho}}),kc=kn(qo),Wa=g({},qo,{dataTransfer:0}),Cd=kn(Wa),Td=g({},Ns,{relatedTarget:0}),Qa=kn(Td),Oc=g({},Ki,{animationName:0,elapsedTime:0,pseudoElement:0}),Ad=kn(Oc),Go=g({},Ki,{clipboardData:function(i){return"clipboardData"in i?i.clipboardData:window.clipboardData}}),jd=kn(Go),Rd=g({},Ki,{data:0}),Ti=kn(Rd),Id={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Dd={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},kd={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Od(i){var a=this.nativeEvent;return a.getModifierState?a.getModifierState(i):(i=kd[i])?!!a[i]:!1}function zs(){return Od}var Jn=g({},Ns,{key:function(i){if(i.key){var a=Id[i.key]||i.key;if(a!=="Unidentified")return a}return i.type==="keypress"?(i=Ga(i),i===13?"Enter":String.fromCharCode(i)):i.type==="keydown"||i.type==="keyup"?Dd[i.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:zs,charCode:function(i){return i.type==="keypress"?Ga(i):0},keyCode:function(i){return i.type==="keydown"||i.type==="keyup"?i.keyCode:0},which:function(i){return i.type==="keypress"?Ga(i):i.type==="keydown"||i.type==="keyup"?i.keyCode:0}}),Md=kn(Jn),Nd=g({},qo,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Yi=kn(Nd),y=g({},Ns,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:zs}),I=kn(y),V=g({},Ki,{propertyName:0,elapsedTime:0,pseudoElement:0}),Y=kn(V),de=g({},qo,{deltaX:function(i){return"deltaX"in i?i.deltaX:"wheelDeltaX"in i?-i.wheelDeltaX:0},deltaY:function(i){return"deltaY"in i?i.deltaY:"wheelDeltaY"in i?-i.wheelDeltaY:"wheelDelta"in i?-i.wheelDelta:0},deltaZ:0,deltaMode:0}),_e=kn(de),ze=g({},Ki,{newState:0,oldState:0}),st=kn(ze),nn=[9,13,27,32],Et=Rr&&"CompositionEvent"in window,Gt=null;Rr&&"documentMode"in document&&(Gt=document.documentMode);var Ir=Rr&&"TextEvent"in window&&!Gt,Ai=Rr&&(!Et||Gt&&8<Gt&&11>=Gt),Yr=" ",Xr=!1;function Ka(i,a){switch(i){case"keyup":return nn.indexOf(a.keyCode)!==-1;case"keydown":return a.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Wo(i){return i=i.detail,typeof i=="object"&&"data"in i?i.data:null}var Qo=!1;function wA(i,a){switch(i){case"compositionend":return Wo(a);case"keypress":return a.which!==32?null:(Xr=!0,Yr);case"textInput":return i=a.data,i===Yr&&Xr?null:i;default:return null}}function SA(i,a){if(Qo)return i==="compositionend"||!Et&&Ka(i,a)?(i=Ic(),qa=Rc=Si=null,Qo=!1,i):null;switch(i){case"paste":return null;case"keypress":if(!(a.ctrlKey||a.altKey||a.metaKey)||a.ctrlKey&&a.altKey){if(a.char&&1<a.char.length)return a.char;if(a.which)return String.fromCharCode(a.which)}return null;case"compositionend":return Ai&&a.locale!=="ko"?null:a.data;default:return null}}var EA={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function e_(i){var a=i&&i.nodeName&&i.nodeName.toLowerCase();return a==="input"?!!EA[i.type]:a==="textarea"}function t_(i,a,c,f){Os?wi?wi.push(f):wi=[f]:Os=f,a=Eh(a,"onChange"),0<a.length&&(c=new Ei("onChange","change",null,c,f),i.push({event:c,listeners:a}))}var Mc=null,Nc=null;function CA(i){zv(i,0)}function Pd(i){var a=mr(i);if(Fa(a))return i}function n_(i,a){if(i==="change")return a}var r_=!1;if(Rr){var Am;if(Rr){var jm="oninput"in document;if(!jm){var i_=document.createElement("div");i_.setAttribute("oninput","return;"),jm=typeof i_.oninput=="function"}Am=jm}else Am=!1;r_=Am&&(!document.documentMode||9<document.documentMode)}function s_(){Mc&&(Mc.detachEvent("onpropertychange",a_),Nc=Mc=null)}function a_(i){if(i.propertyName==="value"&&Pd(Nc)){var a=[];t_(a,Nc,i,jr(i)),Ms(CA,a)}}function TA(i,a,c){i==="focusin"?(s_(),Mc=a,Nc=c,Mc.attachEvent("onpropertychange",a_)):i==="focusout"&&s_()}function AA(i){if(i==="selectionchange"||i==="keyup"||i==="keydown")return Pd(Nc)}function jA(i,a){if(i==="click")return Pd(a)}function RA(i,a){if(i==="input"||i==="change")return Pd(a)}function IA(i,a){return i===a&&(i!==0||1/i===1/a)||i!==i&&a!==a}var gr=typeof Object.is=="function"?Object.is:IA;function Pc(i,a){if(gr(i,a))return!0;if(typeof i!="object"||i===null||typeof a!="object"||a===null)return!1;var c=Object.keys(i),f=Object.keys(a);if(c.length!==f.length)return!1;for(f=0;f<c.length;f++){var b=c[f];if(!ie.call(a,b)||!gr(i[b],a[b]))return!1}return!0}function o_(i){for(;i&&i.firstChild;)i=i.firstChild;return i}function l_(i,a){var c=o_(i);i=0;for(var f;c;){if(c.nodeType===3){if(f=i+c.textContent.length,i<=a&&f>=a)return{node:c,offset:a-i};i=f}e:{for(;c;){if(c.nextSibling){c=c.nextSibling;break e}c=c.parentNode}c=void 0}c=o_(c)}}function c_(i,a){return i&&a?i===a?!0:i&&i.nodeType===3?!1:a&&a.nodeType===3?c_(i,a.parentNode):"contains"in i?i.contains(a):i.compareDocumentPosition?!!(i.compareDocumentPosition(a)&16):!1:!1}function u_(i){i=i!=null&&i.ownerDocument!=null&&i.ownerDocument.defaultView!=null?i.ownerDocument.defaultView:window;for(var a=xi(i.document);a instanceof i.HTMLIFrameElement;){try{var c=typeof a.contentWindow.location.href=="string"}catch{c=!1}if(c)i=a.contentWindow;else break;a=xi(i.document)}return a}function Rm(i){var a=i&&i.nodeName&&i.nodeName.toLowerCase();return a&&(a==="input"&&(i.type==="text"||i.type==="search"||i.type==="tel"||i.type==="url"||i.type==="password")||a==="textarea"||i.contentEditable==="true")}var DA=Rr&&"documentMode"in document&&11>=document.documentMode,Ko=null,Im=null,zc=null,Dm=!1;function d_(i,a,c){var f=c.window===c?c.document:c.nodeType===9?c:c.ownerDocument;Dm||Ko==null||Ko!==xi(f)||(f=Ko,"selectionStart"in f&&Rm(f)?f={start:f.selectionStart,end:f.selectionEnd}:(f=(f.ownerDocument&&f.ownerDocument.defaultView||window).getSelection(),f={anchorNode:f.anchorNode,anchorOffset:f.anchorOffset,focusNode:f.focusNode,focusOffset:f.focusOffset}),zc&&Pc(zc,f)||(zc=f,f=Eh(Im,"onSelect"),0<f.length&&(a=new Ei("onSelect","select",null,a,c),i.push({event:a,listeners:f}),a.target=Ko)))}function Ya(i,a){var c={};return c[i.toLowerCase()]=a.toLowerCase(),c["Webkit"+i]="webkit"+a,c["Moz"+i]="moz"+a,c}var Yo={animationend:Ya("Animation","AnimationEnd"),animationiteration:Ya("Animation","AnimationIteration"),animationstart:Ya("Animation","AnimationStart"),transitionrun:Ya("Transition","TransitionRun"),transitionstart:Ya("Transition","TransitionStart"),transitioncancel:Ya("Transition","TransitionCancel"),transitionend:Ya("Transition","TransitionEnd")},km={},h_={};Rr&&(h_=document.createElement("div").style,"AnimationEvent"in window||(delete Yo.animationend.animation,delete Yo.animationiteration.animation,delete Yo.animationstart.animation),"TransitionEvent"in window||delete Yo.transitionend.transition);function Xa(i){if(km[i])return km[i];if(!Yo[i])return i;var a=Yo[i],c;for(c in a)if(a.hasOwnProperty(c)&&c in h_)return km[i]=a[c];return i}var f_=Xa("animationend"),m_=Xa("animationiteration"),p_=Xa("animationstart"),kA=Xa("transitionrun"),OA=Xa("transitionstart"),MA=Xa("transitioncancel"),g_=Xa("transitionend"),y_=new Map,Om="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Om.push("scrollEnd");function Zr(i,a){y_.set(i,a),bi(a,[i])}var zd=typeof reportError=="function"?reportError:function(i){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var a=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof i=="object"&&i!==null&&typeof i.message=="string"?String(i.message):String(i),error:i});if(!window.dispatchEvent(a))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",i);return}console.error(i)},Dr=[],Xo=0,Mm=0;function Bd(){for(var i=Xo,a=Mm=Xo=0;a<i;){var c=Dr[a];Dr[a++]=null;var f=Dr[a];Dr[a++]=null;var b=Dr[a];Dr[a++]=null;var w=Dr[a];if(Dr[a++]=null,f!==null&&b!==null){var z=f.pending;z===null?b.next=b:(b.next=z.next,z.next=b),f.pending=b}w!==0&&__(c,b,w)}}function Ld(i,a,c,f){Dr[Xo++]=i,Dr[Xo++]=a,Dr[Xo++]=c,Dr[Xo++]=f,Mm|=f,i.lanes|=f,i=i.alternate,i!==null&&(i.lanes|=f)}function Nm(i,a,c,f){return Ld(i,a,c,f),Ud(i)}function Za(i,a){return Ld(i,null,null,a),Ud(i)}function __(i,a,c){i.lanes|=c;var f=i.alternate;f!==null&&(f.lanes|=c);for(var b=!1,w=i.return;w!==null;)w.childLanes|=c,f=w.alternate,f!==null&&(f.childLanes|=c),w.tag===22&&(i=w.stateNode,i===null||i._visibility&1||(b=!0)),i=w,w=w.return;return i.tag===3?(w=i.stateNode,b&&a!==null&&(b=31-St(c),i=w.hiddenUpdates,f=i[b],f===null?i[b]=[a]:f.push(a),a.lane=c|536870912),w):null}function Ud(i){if(50<su)throw su=0,Hp=null,Error(r(185));for(var a=i.return;a!==null;)i=a,a=i.return;return i.tag===3?i.stateNode:null}var Zo={};function NA(i,a,c,f){this.tag=i,this.key=c,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=a,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=f,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function yr(i,a,c,f){return new NA(i,a,c,f)}function Pm(i){return i=i.prototype,!(!i||!i.isReactComponent)}function Xi(i,a){var c=i.alternate;return c===null?(c=yr(i.tag,a,i.key,i.mode),c.elementType=i.elementType,c.type=i.type,c.stateNode=i.stateNode,c.alternate=i,i.alternate=c):(c.pendingProps=a,c.type=i.type,c.flags=0,c.subtreeFlags=0,c.deletions=null),c.flags=i.flags&65011712,c.childLanes=i.childLanes,c.lanes=i.lanes,c.child=i.child,c.memoizedProps=i.memoizedProps,c.memoizedState=i.memoizedState,c.updateQueue=i.updateQueue,a=i.dependencies,c.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext},c.sibling=i.sibling,c.index=i.index,c.ref=i.ref,c.refCleanup=i.refCleanup,c}function b_(i,a){i.flags&=65011714;var c=i.alternate;return c===null?(i.childLanes=0,i.lanes=a,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=c.childLanes,i.lanes=c.lanes,i.child=c.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=c.memoizedProps,i.memoizedState=c.memoizedState,i.updateQueue=c.updateQueue,i.type=c.type,a=c.dependencies,i.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext}),i}function Fd(i,a,c,f,b,w){var z=0;if(f=i,typeof i=="function")Pm(i)&&(z=1);else if(typeof i=="string")z=U5(i,c,se.current)?26:i==="html"||i==="head"||i==="body"?27:5;else e:switch(i){case N:return i=yr(31,c,a,b),i.elementType=N,i.lanes=w,i;case x:return Ja(c.children,b,w,a);case E:z=8,b|=24;break;case C:return i=yr(12,c,a,b|2),i.elementType=C,i.lanes=w,i;case U:return i=yr(13,c,a,b),i.elementType=U,i.lanes=w,i;case G:return i=yr(19,c,a,b),i.elementType=G,i.lanes=w,i;default:if(typeof i=="object"&&i!==null)switch(i.$$typeof){case A:z=10;break e;case T:z=9;break e;case B:z=11;break e;case k:z=14;break e;case D:z=16,f=null;break e}z=29,c=Error(r(130,i===null?"null":typeof i,"")),f=null}return a=yr(z,c,a,b),a.elementType=i,a.type=f,a.lanes=w,a}function Ja(i,a,c,f){return i=yr(7,i,f,a),i.lanes=c,i}function zm(i,a,c){return i=yr(6,i,null,a),i.lanes=c,i}function v_(i){var a=yr(18,null,null,0);return a.stateNode=i,a}function Bm(i,a,c){return a=yr(4,i.children!==null?i.children:[],i.key,a),a.lanes=c,a.stateNode={containerInfo:i.containerInfo,pendingChildren:null,implementation:i.implementation},a}var x_=new WeakMap;function kr(i,a){if(typeof i=="object"&&i!==null){var c=x_.get(i);return c!==void 0?c:(a={value:i,source:a,stack:X(a)},x_.set(i,a),a)}return{value:i,source:a,stack:X(a)}}var Jo=[],el=0,Vd=null,Bc=0,Or=[],Mr=0,Bs=null,ji=1,Ri="";function Zi(i,a){Jo[el++]=Bc,Jo[el++]=Vd,Vd=i,Bc=a}function w_(i,a,c){Or[Mr++]=ji,Or[Mr++]=Ri,Or[Mr++]=Bs,Bs=i;var f=ji;i=Ri;var b=32-St(f)-1;f&=~(1<<b),c+=1;var w=32-St(a)+b;if(30<w){var z=b-b%5;w=(f&(1<<z)-1).toString(32),f>>=z,b-=z,ji=1<<32-St(a)+b|c<<b|f,Ri=w+i}else ji=1<<w|c<<b|f,Ri=i}function Lm(i){i.return!==null&&(Zi(i,1),w_(i,1,0))}function Um(i){for(;i===Vd;)Vd=Jo[--el],Jo[el]=null,Bc=Jo[--el],Jo[el]=null;for(;i===Bs;)Bs=Or[--Mr],Or[Mr]=null,Ri=Or[--Mr],Or[Mr]=null,ji=Or[--Mr],Or[Mr]=null}function S_(i,a){Or[Mr++]=ji,Or[Mr++]=Ri,Or[Mr++]=Bs,ji=a.id,Ri=a.overflow,Bs=i}var On=null,Ut=null,gt=!1,Ls=null,Nr=!1,Fm=Error(r(519));function Us(i){var a=Error(r(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Lc(kr(a,i)),Fm}function E_(i){var a=i.stateNode,c=i.type,f=i.memoizedProps;switch(a[cn]=i,a[jn]=f,c){case"dialog":ct("cancel",a),ct("close",a);break;case"iframe":case"object":case"embed":ct("load",a);break;case"video":case"audio":for(c=0;c<ou.length;c++)ct(ou[c],a);break;case"source":ct("error",a);break;case"img":case"image":case"link":ct("error",a),ct("load",a);break;case"details":ct("toggle",a);break;case"input":ct("invalid",a),xd(a,f.value,f.defaultValue,f.checked,f.defaultChecked,f.type,f.name,!0);break;case"select":ct("invalid",a);break;case"textarea":ct("invalid",a),Ds(a,f.value,f.defaultValue,f.children)}c=f.children,typeof c!="string"&&typeof c!="number"&&typeof c!="bigint"||a.textContent===""+c||f.suppressHydrationWarning===!0||Fv(a.textContent,c)?(f.popover!=null&&(ct("beforetoggle",a),ct("toggle",a)),f.onScroll!=null&&ct("scroll",a),f.onScrollEnd!=null&&ct("scrollend",a),f.onClick!=null&&(a.onclick=Wr),a=!0):a=!1,a||Us(i,!0)}function C_(i){for(On=i.return;On;)switch(On.tag){case 5:case 31:case 13:Nr=!1;return;case 27:case 3:Nr=!0;return;default:On=On.return}}function tl(i){if(i!==On)return!1;if(!gt)return C_(i),gt=!0,!1;var a=i.tag,c;if((c=a!==3&&a!==27)&&((c=a===5)&&(c=i.type,c=!(c!=="form"&&c!=="button")||sg(i.type,i.memoizedProps)),c=!c),c&&Ut&&Us(i),C_(i),a===13){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(r(317));Ut=Yv(i)}else if(a===31){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(r(317));Ut=Yv(i)}else a===27?(a=Ut,ea(i.type)?(i=ug,ug=null,Ut=i):Ut=a):Ut=On?zr(i.stateNode.nextSibling):null;return!0}function eo(){Ut=On=null,gt=!1}function Vm(){var i=Ls;return i!==null&&(lr===null?lr=i:lr.push.apply(lr,i),Ls=null),i}function Lc(i){Ls===null?Ls=[i]:Ls.push(i)}var $m=P(null),to=null,Ji=null;function Fs(i,a,c){te($m,a._currentValue),a._currentValue=c}function es(i){i._currentValue=$m.current,$($m)}function Hm(i,a,c){for(;i!==null;){var f=i.alternate;if((i.childLanes&a)!==a?(i.childLanes|=a,f!==null&&(f.childLanes|=a)):f!==null&&(f.childLanes&a)!==a&&(f.childLanes|=a),i===c)break;i=i.return}}function qm(i,a,c,f){var b=i.child;for(b!==null&&(b.return=i);b!==null;){var w=b.dependencies;if(w!==null){var z=b.child;w=w.firstContext;e:for(;w!==null;){var Q=w;w=b;for(var ne=0;ne<a.length;ne++)if(Q.context===a[ne]){w.lanes|=c,Q=w.alternate,Q!==null&&(Q.lanes|=c),Hm(w.return,c,i),f||(z=null);break e}w=Q.next}}else if(b.tag===18){if(z=b.return,z===null)throw Error(r(341));z.lanes|=c,w=z.alternate,w!==null&&(w.lanes|=c),Hm(z,c,i),z=null}else z=b.child;if(z!==null)z.return=b;else for(z=b;z!==null;){if(z===i){z=null;break}if(b=z.sibling,b!==null){b.return=z.return,z=b;break}z=z.return}b=z}}function nl(i,a,c,f){i=null;for(var b=a,w=!1;b!==null;){if(!w){if((b.flags&524288)!==0)w=!0;else if((b.flags&262144)!==0)break}if(b.tag===10){var z=b.alternate;if(z===null)throw Error(r(387));if(z=z.memoizedProps,z!==null){var Q=b.type;gr(b.pendingProps.value,z.value)||(i!==null?i.push(Q):i=[Q])}}else if(b===Ie.current){if(z=b.alternate,z===null)throw Error(r(387));z.memoizedState.memoizedState!==b.memoizedState.memoizedState&&(i!==null?i.push(hu):i=[hu])}b=b.return}i!==null&&qm(a,i,c,f),a.flags|=262144}function $d(i){for(i=i.firstContext;i!==null;){if(!gr(i.context._currentValue,i.memoizedValue))return!0;i=i.next}return!1}function no(i){to=i,Ji=null,i=i.dependencies,i!==null&&(i.firstContext=null)}function Mn(i){return T_(to,i)}function Hd(i,a){return to===null&&no(i),T_(i,a)}function T_(i,a){var c=a._currentValue;if(a={context:a,memoizedValue:c,next:null},Ji===null){if(i===null)throw Error(r(308));Ji=a,i.dependencies={lanes:0,firstContext:a},i.flags|=524288}else Ji=Ji.next=a;return c}var PA=typeof AbortController<"u"?AbortController:function(){var i=[],a=this.signal={aborted:!1,addEventListener:function(c,f){i.push(f)}};this.abort=function(){a.aborted=!0,i.forEach(function(c){return c()})}},zA=t.unstable_scheduleCallback,BA=t.unstable_NormalPriority,hn={$$typeof:A,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Gm(){return{controller:new PA,data:new Map,refCount:0}}function Uc(i){i.refCount--,i.refCount===0&&zA(BA,function(){i.controller.abort()})}var Fc=null,Wm=0,rl=0,il=null;function LA(i,a){if(Fc===null){var c=Fc=[];Wm=0,rl=Yp(),il={status:"pending",value:void 0,then:function(f){c.push(f)}}}return Wm++,a.then(A_,A_),a}function A_(){if(--Wm===0&&Fc!==null){il!==null&&(il.status="fulfilled");var i=Fc;Fc=null,rl=0,il=null;for(var a=0;a<i.length;a++)(0,i[a])()}}function UA(i,a){var c=[],f={status:"pending",value:null,reason:null,then:function(b){c.push(b)}};return i.then(function(){f.status="fulfilled",f.value=a;for(var b=0;b<c.length;b++)(0,c[b])(a)},function(b){for(f.status="rejected",f.reason=b,b=0;b<c.length;b++)(0,c[b])(void 0)}),f}var j_=W.S;W.S=function(i,a){dv=Ne(),typeof a=="object"&&a!==null&&typeof a.then=="function"&&LA(i,a),j_!==null&&j_(i,a)};var ro=P(null);function Qm(){var i=ro.current;return i!==null?i:Nt.pooledCache}function qd(i,a){a===null?te(ro,ro.current):te(ro,a.pool)}function R_(){var i=Qm();return i===null?null:{parent:hn._currentValue,pool:i}}var sl=Error(r(460)),Km=Error(r(474)),Gd=Error(r(542)),Wd={then:function(){}};function I_(i){return i=i.status,i==="fulfilled"||i==="rejected"}function D_(i,a,c){switch(c=i[c],c===void 0?i.push(a):c!==a&&(a.then(Wr,Wr),a=c),a.status){case"fulfilled":return a.value;case"rejected":throw i=a.reason,O_(i),i;default:if(typeof a.status=="string")a.then(Wr,Wr);else{if(i=Nt,i!==null&&100<i.shellSuspendCounter)throw Error(r(482));i=a,i.status="pending",i.then(function(f){if(a.status==="pending"){var b=a;b.status="fulfilled",b.value=f}},function(f){if(a.status==="pending"){var b=a;b.status="rejected",b.reason=f}})}switch(a.status){case"fulfilled":return a.value;case"rejected":throw i=a.reason,O_(i),i}throw so=a,sl}}function io(i){try{var a=i._init;return a(i._payload)}catch(c){throw c!==null&&typeof c=="object"&&typeof c.then=="function"?(so=c,sl):c}}var so=null;function k_(){if(so===null)throw Error(r(459));var i=so;return so=null,i}function O_(i){if(i===sl||i===Gd)throw Error(r(483))}var al=null,Vc=0;function Qd(i){var a=Vc;return Vc+=1,al===null&&(al=[]),D_(al,i,a)}function $c(i,a){a=a.props.ref,i.ref=a!==void 0?a:null}function Kd(i,a){throw a.$$typeof===v?Error(r(525)):(i=Object.prototype.toString.call(a),Error(r(31,i==="[object Object]"?"object with keys {"+Object.keys(a).join(", ")+"}":i)))}function M_(i){function a(ue,le){if(i){var he=ue.deletions;he===null?(ue.deletions=[le],ue.flags|=16):he.push(le)}}function c(ue,le){if(!i)return null;for(;le!==null;)a(ue,le),le=le.sibling;return null}function f(ue){for(var le=new Map;ue!==null;)ue.key!==null?le.set(ue.key,ue):le.set(ue.index,ue),ue=ue.sibling;return le}function b(ue,le){return ue=Xi(ue,le),ue.index=0,ue.sibling=null,ue}function w(ue,le,he){return ue.index=he,i?(he=ue.alternate,he!==null?(he=he.index,he<le?(ue.flags|=67108866,le):he):(ue.flags|=67108866,le)):(ue.flags|=1048576,le)}function z(ue){return i&&ue.alternate===null&&(ue.flags|=67108866),ue}function Q(ue,le,he,Te){return le===null||le.tag!==6?(le=zm(he,ue.mode,Te),le.return=ue,le):(le=b(le,he),le.return=ue,le)}function ne(ue,le,he,Te){var Ge=he.type;return Ge===x?Se(ue,le,he.props.children,Te,he.key):le!==null&&(le.elementType===Ge||typeof Ge=="object"&&Ge!==null&&Ge.$$typeof===D&&io(Ge)===le.type)?(le=b(le,he.props),$c(le,he),le.return=ue,le):(le=Fd(he.type,he.key,he.props,null,ue.mode,Te),$c(le,he),le.return=ue,le)}function fe(ue,le,he,Te){return le===null||le.tag!==4||le.stateNode.containerInfo!==he.containerInfo||le.stateNode.implementation!==he.implementation?(le=Bm(he,ue.mode,Te),le.return=ue,le):(le=b(le,he.children||[]),le.return=ue,le)}function Se(ue,le,he,Te,Ge){return le===null||le.tag!==7?(le=Ja(he,ue.mode,Te,Ge),le.return=ue,le):(le=b(le,he),le.return=ue,le)}function Re(ue,le,he){if(typeof le=="string"&&le!==""||typeof le=="number"||typeof le=="bigint")return le=zm(""+le,ue.mode,he),le.return=ue,le;if(typeof le=="object"&&le!==null){switch(le.$$typeof){case _:return he=Fd(le.type,le.key,le.props,null,ue.mode,he),$c(he,le),he.return=ue,he;case S:return le=Bm(le,ue.mode,he),le.return=ue,le;case D:return le=io(le),Re(ue,le,he)}if(K(le)||j(le))return le=Ja(le,ue.mode,he,null),le.return=ue,le;if(typeof le.then=="function")return Re(ue,Qd(le),he);if(le.$$typeof===A)return Re(ue,Hd(ue,le),he);Kd(ue,le)}return null}function ge(ue,le,he,Te){var Ge=le!==null?le.key:null;if(typeof he=="string"&&he!==""||typeof he=="number"||typeof he=="bigint")return Ge!==null?null:Q(ue,le,""+he,Te);if(typeof he=="object"&&he!==null){switch(he.$$typeof){case _:return he.key===Ge?ne(ue,le,he,Te):null;case S:return he.key===Ge?fe(ue,le,he,Te):null;case D:return he=io(he),ge(ue,le,he,Te)}if(K(he)||j(he))return Ge!==null?null:Se(ue,le,he,Te,null);if(typeof he.then=="function")return ge(ue,le,Qd(he),Te);if(he.$$typeof===A)return ge(ue,le,Hd(ue,he),Te);Kd(ue,he)}return null}function ve(ue,le,he,Te,Ge){if(typeof Te=="string"&&Te!==""||typeof Te=="number"||typeof Te=="bigint")return ue=ue.get(he)||null,Q(le,ue,""+Te,Ge);if(typeof Te=="object"&&Te!==null){switch(Te.$$typeof){case _:return ue=ue.get(Te.key===null?he:Te.key)||null,ne(le,ue,Te,Ge);case S:return ue=ue.get(Te.key===null?he:Te.key)||null,fe(le,ue,Te,Ge);case D:return Te=io(Te),ve(ue,le,he,Te,Ge)}if(K(Te)||j(Te))return ue=ue.get(he)||null,Se(le,ue,Te,Ge,null);if(typeof Te.then=="function")return ve(ue,le,he,Qd(Te),Ge);if(Te.$$typeof===A)return ve(ue,le,he,Hd(le,Te),Ge);Kd(le,Te)}return null}function Fe(ue,le,he,Te){for(var Ge=null,xt=null,$e=le,ot=le=0,ht=null;$e!==null&&ot<he.length;ot++){$e.index>ot?(ht=$e,$e=null):ht=$e.sibling;var wt=ge(ue,$e,he[ot],Te);if(wt===null){$e===null&&($e=ht);break}i&&$e&&wt.alternate===null&&a(ue,$e),le=w(wt,le,ot),xt===null?Ge=wt:xt.sibling=wt,xt=wt,$e=ht}if(ot===he.length)return c(ue,$e),gt&&Zi(ue,ot),Ge;if($e===null){for(;ot<he.length;ot++)$e=Re(ue,he[ot],Te),$e!==null&&(le=w($e,le,ot),xt===null?Ge=$e:xt.sibling=$e,xt=$e);return gt&&Zi(ue,ot),Ge}for($e=f($e);ot<he.length;ot++)ht=ve($e,ue,ot,he[ot],Te),ht!==null&&(i&&ht.alternate!==null&&$e.delete(ht.key===null?ot:ht.key),le=w(ht,le,ot),xt===null?Ge=ht:xt.sibling=ht,xt=ht);return i&&$e.forEach(function(sa){return a(ue,sa)}),gt&&Zi(ue,ot),Ge}function Ke(ue,le,he,Te){if(he==null)throw Error(r(151));for(var Ge=null,xt=null,$e=le,ot=le=0,ht=null,wt=he.next();$e!==null&&!wt.done;ot++,wt=he.next()){$e.index>ot?(ht=$e,$e=null):ht=$e.sibling;var sa=ge(ue,$e,wt.value,Te);if(sa===null){$e===null&&($e=ht);break}i&&$e&&sa.alternate===null&&a(ue,$e),le=w(sa,le,ot),xt===null?Ge=sa:xt.sibling=sa,xt=sa,$e=ht}if(wt.done)return c(ue,$e),gt&&Zi(ue,ot),Ge;if($e===null){for(;!wt.done;ot++,wt=he.next())wt=Re(ue,wt.value,Te),wt!==null&&(le=w(wt,le,ot),xt===null?Ge=wt:xt.sibling=wt,xt=wt);return gt&&Zi(ue,ot),Ge}for($e=f($e);!wt.done;ot++,wt=he.next())wt=ve($e,ue,ot,wt.value,Te),wt!==null&&(i&&wt.alternate!==null&&$e.delete(wt.key===null?ot:wt.key),le=w(wt,le,ot),xt===null?Ge=wt:xt.sibling=wt,xt=wt);return i&&$e.forEach(function(X5){return a(ue,X5)}),gt&&Zi(ue,ot),Ge}function Ot(ue,le,he,Te){if(typeof he=="object"&&he!==null&&he.type===x&&he.key===null&&(he=he.props.children),typeof he=="object"&&he!==null){switch(he.$$typeof){case _:e:{for(var Ge=he.key;le!==null;){if(le.key===Ge){if(Ge=he.type,Ge===x){if(le.tag===7){c(ue,le.sibling),Te=b(le,he.props.children),Te.return=ue,ue=Te;break e}}else if(le.elementType===Ge||typeof Ge=="object"&&Ge!==null&&Ge.$$typeof===D&&io(Ge)===le.type){c(ue,le.sibling),Te=b(le,he.props),$c(Te,he),Te.return=ue,ue=Te;break e}c(ue,le);break}else a(ue,le);le=le.sibling}he.type===x?(Te=Ja(he.props.children,ue.mode,Te,he.key),Te.return=ue,ue=Te):(Te=Fd(he.type,he.key,he.props,null,ue.mode,Te),$c(Te,he),Te.return=ue,ue=Te)}return z(ue);case S:e:{for(Ge=he.key;le!==null;){if(le.key===Ge)if(le.tag===4&&le.stateNode.containerInfo===he.containerInfo&&le.stateNode.implementation===he.implementation){c(ue,le.sibling),Te=b(le,he.children||[]),Te.return=ue,ue=Te;break e}else{c(ue,le);break}else a(ue,le);le=le.sibling}Te=Bm(he,ue.mode,Te),Te.return=ue,ue=Te}return z(ue);case D:return he=io(he),Ot(ue,le,he,Te)}if(K(he))return Fe(ue,le,he,Te);if(j(he)){if(Ge=j(he),typeof Ge!="function")throw Error(r(150));return he=Ge.call(he),Ke(ue,le,he,Te)}if(typeof he.then=="function")return Ot(ue,le,Qd(he),Te);if(he.$$typeof===A)return Ot(ue,le,Hd(ue,he),Te);Kd(ue,he)}return typeof he=="string"&&he!==""||typeof he=="number"||typeof he=="bigint"?(he=""+he,le!==null&&le.tag===6?(c(ue,le.sibling),Te=b(le,he),Te.return=ue,ue=Te):(c(ue,le),Te=zm(he,ue.mode,Te),Te.return=ue,ue=Te),z(ue)):c(ue,le)}return function(ue,le,he,Te){try{Vc=0;var Ge=Ot(ue,le,he,Te);return al=null,Ge}catch($e){if($e===sl||$e===Gd)throw $e;var xt=yr(29,$e,null,ue.mode);return xt.lanes=Te,xt.return=ue,xt}}}var ao=M_(!0),N_=M_(!1),Vs=!1;function Ym(i){i.updateQueue={baseState:i.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Xm(i,a){i=i.updateQueue,a.updateQueue===i&&(a.updateQueue={baseState:i.baseState,firstBaseUpdate:i.firstBaseUpdate,lastBaseUpdate:i.lastBaseUpdate,shared:i.shared,callbacks:null})}function $s(i){return{lane:i,tag:0,payload:null,callback:null,next:null}}function Hs(i,a,c){var f=i.updateQueue;if(f===null)return null;if(f=f.shared,(Ct&2)!==0){var b=f.pending;return b===null?a.next=a:(a.next=b.next,b.next=a),f.pending=a,a=Ud(i),__(i,null,c),a}return Ld(i,f,a,c),Ud(i)}function Hc(i,a,c){if(a=a.updateQueue,a!==null&&(a=a.shared,(c&4194048)!==0)){var f=a.lanes;f&=i.pendingLanes,c|=f,a.lanes=c,yc(i,c)}}function Zm(i,a){var c=i.updateQueue,f=i.alternate;if(f!==null&&(f=f.updateQueue,c===f)){var b=null,w=null;if(c=c.firstBaseUpdate,c!==null){do{var z={lane:c.lane,tag:c.tag,payload:c.payload,callback:null,next:null};w===null?b=w=z:w=w.next=z,c=c.next}while(c!==null);w===null?b=w=a:w=w.next=a}else b=w=a;c={baseState:f.baseState,firstBaseUpdate:b,lastBaseUpdate:w,shared:f.shared,callbacks:f.callbacks},i.updateQueue=c;return}i=c.lastBaseUpdate,i===null?c.firstBaseUpdate=a:i.next=a,c.lastBaseUpdate=a}var Jm=!1;function qc(){if(Jm){var i=il;if(i!==null)throw i}}function Gc(i,a,c,f){Jm=!1;var b=i.updateQueue;Vs=!1;var w=b.firstBaseUpdate,z=b.lastBaseUpdate,Q=b.shared.pending;if(Q!==null){b.shared.pending=null;var ne=Q,fe=ne.next;ne.next=null,z===null?w=fe:z.next=fe,z=ne;var Se=i.alternate;Se!==null&&(Se=Se.updateQueue,Q=Se.lastBaseUpdate,Q!==z&&(Q===null?Se.firstBaseUpdate=fe:Q.next=fe,Se.lastBaseUpdate=ne))}if(w!==null){var Re=b.baseState;z=0,Se=fe=ne=null,Q=w;do{var ge=Q.lane&-536870913,ve=ge!==Q.lane;if(ve?(dt&ge)===ge:(f&ge)===ge){ge!==0&&ge===rl&&(Jm=!0),Se!==null&&(Se=Se.next={lane:0,tag:Q.tag,payload:Q.payload,callback:null,next:null});e:{var Fe=i,Ke=Q;ge=a;var Ot=c;switch(Ke.tag){case 1:if(Fe=Ke.payload,typeof Fe=="function"){Re=Fe.call(Ot,Re,ge);break e}Re=Fe;break e;case 3:Fe.flags=Fe.flags&-65537|128;case 0:if(Fe=Ke.payload,ge=typeof Fe=="function"?Fe.call(Ot,Re,ge):Fe,ge==null)break e;Re=g({},Re,ge);break e;case 2:Vs=!0}}ge=Q.callback,ge!==null&&(i.flags|=64,ve&&(i.flags|=8192),ve=b.callbacks,ve===null?b.callbacks=[ge]:ve.push(ge))}else ve={lane:ge,tag:Q.tag,payload:Q.payload,callback:Q.callback,next:null},Se===null?(fe=Se=ve,ne=Re):Se=Se.next=ve,z|=ge;if(Q=Q.next,Q===null){if(Q=b.shared.pending,Q===null)break;ve=Q,Q=ve.next,ve.next=null,b.lastBaseUpdate=ve,b.shared.pending=null}}while(!0);Se===null&&(ne=Re),b.baseState=ne,b.firstBaseUpdate=fe,b.lastBaseUpdate=Se,w===null&&(b.shared.lanes=0),Ks|=z,i.lanes=z,i.memoizedState=Re}}function P_(i,a){if(typeof i!="function")throw Error(r(191,i));i.call(a)}function z_(i,a){var c=i.callbacks;if(c!==null)for(i.callbacks=null,i=0;i<c.length;i++)P_(c[i],a)}var ol=P(null),Yd=P(0);function B_(i,a){i=cs,te(Yd,i),te(ol,a),cs=i|a.baseLanes}function ep(){te(Yd,cs),te(ol,ol.current)}function tp(){cs=Yd.current,$(ol),$(Yd)}var _r=P(null),Pr=null;function qs(i){var a=i.alternate;te(rn,rn.current&1),te(_r,i),Pr===null&&(a===null||ol.current!==null||a.memoizedState!==null)&&(Pr=i)}function np(i){te(rn,rn.current),te(_r,i),Pr===null&&(Pr=i)}function L_(i){i.tag===22?(te(rn,rn.current),te(_r,i),Pr===null&&(Pr=i)):Gs()}function Gs(){te(rn,rn.current),te(_r,_r.current)}function br(i){$(_r),Pr===i&&(Pr=null),$(rn)}var rn=P(0);function Xd(i){for(var a=i;a!==null;){if(a.tag===13){var c=a.memoizedState;if(c!==null&&(c=c.dehydrated,c===null||lg(c)||cg(c)))return a}else if(a.tag===19&&(a.memoizedProps.revealOrder==="forwards"||a.memoizedProps.revealOrder==="backwards"||a.memoizedProps.revealOrder==="unstable_legacy-backwards"||a.memoizedProps.revealOrder==="together")){if((a.flags&128)!==0)return a}else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===i)break;for(;a.sibling===null;){if(a.return===null||a.return===i)return null;a=a.return}a.sibling.return=a.return,a=a.sibling}return null}var ts=0,at=null,Dt=null,fn=null,Zd=!1,ll=!1,oo=!1,Jd=0,Wc=0,cl=null,FA=0;function Jt(){throw Error(r(321))}function rp(i,a){if(a===null)return!1;for(var c=0;c<a.length&&c<i.length;c++)if(!gr(i[c],a[c]))return!1;return!0}function ip(i,a,c,f,b,w){return ts=w,at=a,a.memoizedState=null,a.updateQueue=null,a.lanes=0,W.H=i===null||i.memoizedState===null?wb:bp,oo=!1,w=c(f,b),oo=!1,ll&&(w=F_(a,c,f,b)),U_(i),w}function U_(i){W.H=Yc;var a=Dt!==null&&Dt.next!==null;if(ts=0,fn=Dt=at=null,Zd=!1,Wc=0,cl=null,a)throw Error(r(300));i===null||mn||(i=i.dependencies,i!==null&&$d(i)&&(mn=!0))}function F_(i,a,c,f){at=i;var b=0;do{if(ll&&(cl=null),Wc=0,ll=!1,25<=b)throw Error(r(301));if(b+=1,fn=Dt=null,i.updateQueue!=null){var w=i.updateQueue;w.lastEffect=null,w.events=null,w.stores=null,w.memoCache!=null&&(w.memoCache.index=0)}W.H=Sb,w=a(c,f)}while(ll);return w}function VA(){var i=W.H,a=i.useState()[0];return a=typeof a.then=="function"?Qc(a):a,i=i.useState()[0],(Dt!==null?Dt.memoizedState:null)!==i&&(at.flags|=1024),a}function sp(){var i=Jd!==0;return Jd=0,i}function ap(i,a,c){a.updateQueue=i.updateQueue,a.flags&=-2053,i.lanes&=~c}function op(i){if(Zd){for(i=i.memoizedState;i!==null;){var a=i.queue;a!==null&&(a.pending=null),i=i.next}Zd=!1}ts=0,fn=Dt=at=null,ll=!1,Wc=Jd=0,cl=null}function er(){var i={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return fn===null?at.memoizedState=fn=i:fn=fn.next=i,fn}function sn(){if(Dt===null){var i=at.alternate;i=i!==null?i.memoizedState:null}else i=Dt.next;var a=fn===null?at.memoizedState:fn.next;if(a!==null)fn=a,Dt=i;else{if(i===null)throw at.alternate===null?Error(r(467)):Error(r(310));Dt=i,i={memoizedState:Dt.memoizedState,baseState:Dt.baseState,baseQueue:Dt.baseQueue,queue:Dt.queue,next:null},fn===null?at.memoizedState=fn=i:fn=fn.next=i}return fn}function eh(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Qc(i){var a=Wc;return Wc+=1,cl===null&&(cl=[]),i=D_(cl,i,a),a=at,(fn===null?a.memoizedState:fn.next)===null&&(a=a.alternate,W.H=a===null||a.memoizedState===null?wb:bp),i}function th(i){if(i!==null&&typeof i=="object"){if(typeof i.then=="function")return Qc(i);if(i.$$typeof===A)return Mn(i)}throw Error(r(438,String(i)))}function lp(i){var a=null,c=at.updateQueue;if(c!==null&&(a=c.memoCache),a==null){var f=at.alternate;f!==null&&(f=f.updateQueue,f!==null&&(f=f.memoCache,f!=null&&(a={data:f.data.map(function(b){return b.slice()}),index:0})))}if(a==null&&(a={data:[],index:0}),c===null&&(c=eh(),at.updateQueue=c),c.memoCache=a,c=a.data[a.index],c===void 0)for(c=a.data[a.index]=Array(i),f=0;f<i;f++)c[f]=F;return a.index++,c}function ns(i,a){return typeof a=="function"?a(i):a}function nh(i){var a=sn();return cp(a,Dt,i)}function cp(i,a,c){var f=i.queue;if(f===null)throw Error(r(311));f.lastRenderedReducer=c;var b=i.baseQueue,w=f.pending;if(w!==null){if(b!==null){var z=b.next;b.next=w.next,w.next=z}a.baseQueue=b=w,f.pending=null}if(w=i.baseState,b===null)i.memoizedState=w;else{a=b.next;var Q=z=null,ne=null,fe=a,Se=!1;do{var Re=fe.lane&-536870913;if(Re!==fe.lane?(dt&Re)===Re:(ts&Re)===Re){var ge=fe.revertLane;if(ge===0)ne!==null&&(ne=ne.next={lane:0,revertLane:0,gesture:null,action:fe.action,hasEagerState:fe.hasEagerState,eagerState:fe.eagerState,next:null}),Re===rl&&(Se=!0);else if((ts&ge)===ge){fe=fe.next,ge===rl&&(Se=!0);continue}else Re={lane:0,revertLane:fe.revertLane,gesture:null,action:fe.action,hasEagerState:fe.hasEagerState,eagerState:fe.eagerState,next:null},ne===null?(Q=ne=Re,z=w):ne=ne.next=Re,at.lanes|=ge,Ks|=ge;Re=fe.action,oo&&c(w,Re),w=fe.hasEagerState?fe.eagerState:c(w,Re)}else ge={lane:Re,revertLane:fe.revertLane,gesture:fe.gesture,action:fe.action,hasEagerState:fe.hasEagerState,eagerState:fe.eagerState,next:null},ne===null?(Q=ne=ge,z=w):ne=ne.next=ge,at.lanes|=Re,Ks|=Re;fe=fe.next}while(fe!==null&&fe!==a);if(ne===null?z=w:ne.next=Q,!gr(w,i.memoizedState)&&(mn=!0,Se&&(c=il,c!==null)))throw c;i.memoizedState=w,i.baseState=z,i.baseQueue=ne,f.lastRenderedState=w}return b===null&&(f.lanes=0),[i.memoizedState,f.dispatch]}function up(i){var a=sn(),c=a.queue;if(c===null)throw Error(r(311));c.lastRenderedReducer=i;var f=c.dispatch,b=c.pending,w=a.memoizedState;if(b!==null){c.pending=null;var z=b=b.next;do w=i(w,z.action),z=z.next;while(z!==b);gr(w,a.memoizedState)||(mn=!0),a.memoizedState=w,a.baseQueue===null&&(a.baseState=w),c.lastRenderedState=w}return[w,f]}function V_(i,a,c){var f=at,b=sn(),w=gt;if(w){if(c===void 0)throw Error(r(407));c=c()}else c=a();var z=!gr((Dt||b).memoizedState,c);if(z&&(b.memoizedState=c,mn=!0),b=b.queue,fp(q_.bind(null,f,b,i),[i]),b.getSnapshot!==a||z||fn!==null&&fn.memoizedState.tag&1){if(f.flags|=2048,ul(9,{destroy:void 0},H_.bind(null,f,b,c,a),null),Nt===null)throw Error(r(349));w||(ts&127)!==0||$_(f,a,c)}return c}function $_(i,a,c){i.flags|=16384,i={getSnapshot:a,value:c},a=at.updateQueue,a===null?(a=eh(),at.updateQueue=a,a.stores=[i]):(c=a.stores,c===null?a.stores=[i]:c.push(i))}function H_(i,a,c,f){a.value=c,a.getSnapshot=f,G_(a)&&W_(i)}function q_(i,a,c){return c(function(){G_(a)&&W_(i)})}function G_(i){var a=i.getSnapshot;i=i.value;try{var c=a();return!gr(i,c)}catch{return!0}}function W_(i){var a=Za(i,2);a!==null&&cr(a,i,2)}function dp(i){var a=er();if(typeof i=="function"){var c=i;if(i=c(),oo){qn(!0);try{c()}finally{qn(!1)}}}return a.memoizedState=a.baseState=i,a.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ns,lastRenderedState:i},a}function Q_(i,a,c,f){return i.baseState=c,cp(i,Dt,typeof f=="function"?f:ns)}function $A(i,a,c,f,b){if(sh(i))throw Error(r(485));if(i=a.action,i!==null){var w={payload:b,action:i,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(z){w.listeners.push(z)}};W.T!==null?c(!0):w.isTransition=!1,f(w),c=a.pending,c===null?(w.next=a.pending=w,K_(a,w)):(w.next=c.next,a.pending=c.next=w)}}function K_(i,a){var c=a.action,f=a.payload,b=i.state;if(a.isTransition){var w=W.T,z={};W.T=z;try{var Q=c(b,f),ne=W.S;ne!==null&&ne(z,Q),Y_(i,a,Q)}catch(fe){hp(i,a,fe)}finally{w!==null&&z.types!==null&&(w.types=z.types),W.T=w}}else try{w=c(b,f),Y_(i,a,w)}catch(fe){hp(i,a,fe)}}function Y_(i,a,c){c!==null&&typeof c=="object"&&typeof c.then=="function"?c.then(function(f){X_(i,a,f)},function(f){return hp(i,a,f)}):X_(i,a,c)}function X_(i,a,c){a.status="fulfilled",a.value=c,Z_(a),i.state=c,a=i.pending,a!==null&&(c=a.next,c===a?i.pending=null:(c=c.next,a.next=c,K_(i,c)))}function hp(i,a,c){var f=i.pending;if(i.pending=null,f!==null){f=f.next;do a.status="rejected",a.reason=c,Z_(a),a=a.next;while(a!==f)}i.action=null}function Z_(i){i=i.listeners;for(var a=0;a<i.length;a++)(0,i[a])()}function J_(i,a){return a}function eb(i,a){if(gt){var c=Nt.formState;if(c!==null){e:{var f=at;if(gt){if(Ut){t:{for(var b=Ut,w=Nr;b.nodeType!==8;){if(!w){b=null;break t}if(b=zr(b.nextSibling),b===null){b=null;break t}}w=b.data,b=w==="F!"||w==="F"?b:null}if(b){Ut=zr(b.nextSibling),f=b.data==="F!";break e}}Us(f)}f=!1}f&&(a=c[0])}}return c=er(),c.memoizedState=c.baseState=a,f={pending:null,lanes:0,dispatch:null,lastRenderedReducer:J_,lastRenderedState:a},c.queue=f,c=bb.bind(null,at,f),f.dispatch=c,f=dp(!1),w=_p.bind(null,at,!1,f.queue),f=er(),b={state:a,dispatch:null,action:i,pending:null},f.queue=b,c=$A.bind(null,at,b,w,c),b.dispatch=c,f.memoizedState=i,[a,c,!1]}function tb(i){var a=sn();return nb(a,Dt,i)}function nb(i,a,c){if(a=cp(i,a,J_)[0],i=nh(ns)[0],typeof a=="object"&&a!==null&&typeof a.then=="function")try{var f=Qc(a)}catch(z){throw z===sl?Gd:z}else f=a;a=sn();var b=a.queue,w=b.dispatch;return c!==a.memoizedState&&(at.flags|=2048,ul(9,{destroy:void 0},HA.bind(null,b,c),null)),[f,w,i]}function HA(i,a){i.action=a}function rb(i){var a=sn(),c=Dt;if(c!==null)return nb(a,c,i);sn(),a=a.memoizedState,c=sn();var f=c.queue.dispatch;return c.memoizedState=i,[a,f,!1]}function ul(i,a,c,f){return i={tag:i,create:c,deps:f,inst:a,next:null},a=at.updateQueue,a===null&&(a=eh(),at.updateQueue=a),c=a.lastEffect,c===null?a.lastEffect=i.next=i:(f=c.next,c.next=i,i.next=f,a.lastEffect=i),i}function ib(){return sn().memoizedState}function rh(i,a,c,f){var b=er();at.flags|=i,b.memoizedState=ul(1|a,{destroy:void 0},c,f===void 0?null:f)}function ih(i,a,c,f){var b=sn();f=f===void 0?null:f;var w=b.memoizedState.inst;Dt!==null&&f!==null&&rp(f,Dt.memoizedState.deps)?b.memoizedState=ul(a,w,c,f):(at.flags|=i,b.memoizedState=ul(1|a,w,c,f))}function sb(i,a){rh(8390656,8,i,a)}function fp(i,a){ih(2048,8,i,a)}function qA(i){at.flags|=4;var a=at.updateQueue;if(a===null)a=eh(),at.updateQueue=a,a.events=[i];else{var c=a.events;c===null?a.events=[i]:c.push(i)}}function ab(i){var a=sn().memoizedState;return qA({ref:a,nextImpl:i}),function(){if((Ct&2)!==0)throw Error(r(440));return a.impl.apply(void 0,arguments)}}function ob(i,a){return ih(4,2,i,a)}function lb(i,a){return ih(4,4,i,a)}function cb(i,a){if(typeof a=="function"){i=i();var c=a(i);return function(){typeof c=="function"?c():a(null)}}if(a!=null)return i=i(),a.current=i,function(){a.current=null}}function ub(i,a,c){c=c!=null?c.concat([i]):null,ih(4,4,cb.bind(null,a,i),c)}function mp(){}function db(i,a){var c=sn();a=a===void 0?null:a;var f=c.memoizedState;return a!==null&&rp(a,f[1])?f[0]:(c.memoizedState=[i,a],i)}function hb(i,a){var c=sn();a=a===void 0?null:a;var f=c.memoizedState;if(a!==null&&rp(a,f[1]))return f[0];if(f=i(),oo){qn(!0);try{i()}finally{qn(!1)}}return c.memoizedState=[f,a],f}function pp(i,a,c){return c===void 0||(ts&1073741824)!==0&&(dt&261930)===0?i.memoizedState=a:(i.memoizedState=c,i=fv(),at.lanes|=i,Ks|=i,c)}function fb(i,a,c,f){return gr(c,a)?c:ol.current!==null?(i=pp(i,c,f),gr(i,a)||(mn=!0),i):(ts&42)===0||(ts&1073741824)!==0&&(dt&261930)===0?(mn=!0,i.memoizedState=c):(i=fv(),at.lanes|=i,Ks|=i,a)}function mb(i,a,c,f,b){var w=q.p;q.p=w!==0&&8>w?w:8;var z=W.T,Q={};W.T=Q,_p(i,!1,a,c);try{var ne=b(),fe=W.S;if(fe!==null&&fe(Q,ne),ne!==null&&typeof ne=="object"&&typeof ne.then=="function"){var Se=UA(ne,f);Kc(i,a,Se,wr(i))}else Kc(i,a,f,wr(i))}catch(Re){Kc(i,a,{then:function(){},status:"rejected",reason:Re},wr())}finally{q.p=w,z!==null&&Q.types!==null&&(z.types=Q.types),W.T=z}}function GA(){}function gp(i,a,c,f){if(i.tag!==5)throw Error(r(476));var b=pb(i).queue;mb(i,b,a,J,c===null?GA:function(){return gb(i),c(f)})}function pb(i){var a=i.memoizedState;if(a!==null)return a;a={memoizedState:J,baseState:J,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ns,lastRenderedState:J},next:null};var c={};return a.next={memoizedState:c,baseState:c,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ns,lastRenderedState:c},next:null},i.memoizedState=a,i=i.alternate,i!==null&&(i.memoizedState=a),a}function gb(i){var a=pb(i);a.next===null&&(a=i.alternate.memoizedState),Kc(i,a.next.queue,{},wr())}function yp(){return Mn(hu)}function yb(){return sn().memoizedState}function _b(){return sn().memoizedState}function WA(i){for(var a=i.return;a!==null;){switch(a.tag){case 24:case 3:var c=wr();i=$s(c);var f=Hs(a,i,c);f!==null&&(cr(f,a,c),Hc(f,a,c)),a={cache:Gm()},i.payload=a;return}a=a.return}}function QA(i,a,c){var f=wr();c={lane:f,revertLane:0,gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null},sh(i)?vb(a,c):(c=Nm(i,a,c,f),c!==null&&(cr(c,i,f),xb(c,a,f)))}function bb(i,a,c){var f=wr();Kc(i,a,c,f)}function Kc(i,a,c,f){var b={lane:f,revertLane:0,gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null};if(sh(i))vb(a,b);else{var w=i.alternate;if(i.lanes===0&&(w===null||w.lanes===0)&&(w=a.lastRenderedReducer,w!==null))try{var z=a.lastRenderedState,Q=w(z,c);if(b.hasEagerState=!0,b.eagerState=Q,gr(Q,z))return Ld(i,a,b,0),Nt===null&&Bd(),!1}catch{}if(c=Nm(i,a,b,f),c!==null)return cr(c,i,f),xb(c,a,f),!0}return!1}function _p(i,a,c,f){if(f={lane:2,revertLane:Yp(),gesture:null,action:f,hasEagerState:!1,eagerState:null,next:null},sh(i)){if(a)throw Error(r(479))}else a=Nm(i,c,f,2),a!==null&&cr(a,i,2)}function sh(i){var a=i.alternate;return i===at||a!==null&&a===at}function vb(i,a){ll=Zd=!0;var c=i.pending;c===null?a.next=a:(a.next=c.next,c.next=a),i.pending=a}function xb(i,a,c){if((c&4194048)!==0){var f=a.lanes;f&=i.pendingLanes,c|=f,a.lanes=c,yc(i,c)}}var Yc={readContext:Mn,use:th,useCallback:Jt,useContext:Jt,useEffect:Jt,useImperativeHandle:Jt,useLayoutEffect:Jt,useInsertionEffect:Jt,useMemo:Jt,useReducer:Jt,useRef:Jt,useState:Jt,useDebugValue:Jt,useDeferredValue:Jt,useTransition:Jt,useSyncExternalStore:Jt,useId:Jt,useHostTransitionStatus:Jt,useFormState:Jt,useActionState:Jt,useOptimistic:Jt,useMemoCache:Jt,useCacheRefresh:Jt};Yc.useEffectEvent=Jt;var wb={readContext:Mn,use:th,useCallback:function(i,a){return er().memoizedState=[i,a===void 0?null:a],i},useContext:Mn,useEffect:sb,useImperativeHandle:function(i,a,c){c=c!=null?c.concat([i]):null,rh(4194308,4,cb.bind(null,a,i),c)},useLayoutEffect:function(i,a){return rh(4194308,4,i,a)},useInsertionEffect:function(i,a){rh(4,2,i,a)},useMemo:function(i,a){var c=er();a=a===void 0?null:a;var f=i();if(oo){qn(!0);try{i()}finally{qn(!1)}}return c.memoizedState=[f,a],f},useReducer:function(i,a,c){var f=er();if(c!==void 0){var b=c(a);if(oo){qn(!0);try{c(a)}finally{qn(!1)}}}else b=a;return f.memoizedState=f.baseState=b,i={pending:null,lanes:0,dispatch:null,lastRenderedReducer:i,lastRenderedState:b},f.queue=i,i=i.dispatch=QA.bind(null,at,i),[f.memoizedState,i]},useRef:function(i){var a=er();return i={current:i},a.memoizedState=i},useState:function(i){i=dp(i);var a=i.queue,c=bb.bind(null,at,a);return a.dispatch=c,[i.memoizedState,c]},useDebugValue:mp,useDeferredValue:function(i,a){var c=er();return pp(c,i,a)},useTransition:function(){var i=dp(!1);return i=mb.bind(null,at,i.queue,!0,!1),er().memoizedState=i,[!1,i]},useSyncExternalStore:function(i,a,c){var f=at,b=er();if(gt){if(c===void 0)throw Error(r(407));c=c()}else{if(c=a(),Nt===null)throw Error(r(349));(dt&127)!==0||$_(f,a,c)}b.memoizedState=c;var w={value:c,getSnapshot:a};return b.queue=w,sb(q_.bind(null,f,w,i),[i]),f.flags|=2048,ul(9,{destroy:void 0},H_.bind(null,f,w,c,a),null),c},useId:function(){var i=er(),a=Nt.identifierPrefix;if(gt){var c=Ri,f=ji;c=(f&~(1<<32-St(f)-1)).toString(32)+c,a="_"+a+"R_"+c,c=Jd++,0<c&&(a+="H"+c.toString(32)),a+="_"}else c=FA++,a="_"+a+"r_"+c.toString(32)+"_";return i.memoizedState=a},useHostTransitionStatus:yp,useFormState:eb,useActionState:eb,useOptimistic:function(i){var a=er();a.memoizedState=a.baseState=i;var c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return a.queue=c,a=_p.bind(null,at,!0,c),c.dispatch=a,[i,a]},useMemoCache:lp,useCacheRefresh:function(){return er().memoizedState=WA.bind(null,at)},useEffectEvent:function(i){var a=er(),c={impl:i};return a.memoizedState=c,function(){if((Ct&2)!==0)throw Error(r(440));return c.impl.apply(void 0,arguments)}}},bp={readContext:Mn,use:th,useCallback:db,useContext:Mn,useEffect:fp,useImperativeHandle:ub,useInsertionEffect:ob,useLayoutEffect:lb,useMemo:hb,useReducer:nh,useRef:ib,useState:function(){return nh(ns)},useDebugValue:mp,useDeferredValue:function(i,a){var c=sn();return fb(c,Dt.memoizedState,i,a)},useTransition:function(){var i=nh(ns)[0],a=sn().memoizedState;return[typeof i=="boolean"?i:Qc(i),a]},useSyncExternalStore:V_,useId:yb,useHostTransitionStatus:yp,useFormState:tb,useActionState:tb,useOptimistic:function(i,a){var c=sn();return Q_(c,Dt,i,a)},useMemoCache:lp,useCacheRefresh:_b};bp.useEffectEvent=ab;var Sb={readContext:Mn,use:th,useCallback:db,useContext:Mn,useEffect:fp,useImperativeHandle:ub,useInsertionEffect:ob,useLayoutEffect:lb,useMemo:hb,useReducer:up,useRef:ib,useState:function(){return up(ns)},useDebugValue:mp,useDeferredValue:function(i,a){var c=sn();return Dt===null?pp(c,i,a):fb(c,Dt.memoizedState,i,a)},useTransition:function(){var i=up(ns)[0],a=sn().memoizedState;return[typeof i=="boolean"?i:Qc(i),a]},useSyncExternalStore:V_,useId:yb,useHostTransitionStatus:yp,useFormState:rb,useActionState:rb,useOptimistic:function(i,a){var c=sn();return Dt!==null?Q_(c,Dt,i,a):(c.baseState=i,[i,c.queue.dispatch])},useMemoCache:lp,useCacheRefresh:_b};Sb.useEffectEvent=ab;function vp(i,a,c,f){a=i.memoizedState,c=c(f,a),c=c==null?a:g({},a,c),i.memoizedState=c,i.lanes===0&&(i.updateQueue.baseState=c)}var xp={enqueueSetState:function(i,a,c){i=i._reactInternals;var f=wr(),b=$s(f);b.payload=a,c!=null&&(b.callback=c),a=Hs(i,b,f),a!==null&&(cr(a,i,f),Hc(a,i,f))},enqueueReplaceState:function(i,a,c){i=i._reactInternals;var f=wr(),b=$s(f);b.tag=1,b.payload=a,c!=null&&(b.callback=c),a=Hs(i,b,f),a!==null&&(cr(a,i,f),Hc(a,i,f))},enqueueForceUpdate:function(i,a){i=i._reactInternals;var c=wr(),f=$s(c);f.tag=2,a!=null&&(f.callback=a),a=Hs(i,f,c),a!==null&&(cr(a,i,c),Hc(a,i,c))}};function Eb(i,a,c,f,b,w,z){return i=i.stateNode,typeof i.shouldComponentUpdate=="function"?i.shouldComponentUpdate(f,w,z):a.prototype&&a.prototype.isPureReactComponent?!Pc(c,f)||!Pc(b,w):!0}function Cb(i,a,c,f){i=a.state,typeof a.componentWillReceiveProps=="function"&&a.componentWillReceiveProps(c,f),typeof a.UNSAFE_componentWillReceiveProps=="function"&&a.UNSAFE_componentWillReceiveProps(c,f),a.state!==i&&xp.enqueueReplaceState(a,a.state,null)}function lo(i,a){var c=a;if("ref"in a){c={};for(var f in a)f!=="ref"&&(c[f]=a[f])}if(i=i.defaultProps){c===a&&(c=g({},c));for(var b in i)c[b]===void 0&&(c[b]=i[b])}return c}function Tb(i){zd(i)}function Ab(i){console.error(i)}function jb(i){zd(i)}function ah(i,a){try{var c=i.onUncaughtError;c(a.value,{componentStack:a.stack})}catch(f){setTimeout(function(){throw f})}}function Rb(i,a,c){try{var f=i.onCaughtError;f(c.value,{componentStack:c.stack,errorBoundary:a.tag===1?a.stateNode:null})}catch(b){setTimeout(function(){throw b})}}function wp(i,a,c){return c=$s(c),c.tag=3,c.payload={element:null},c.callback=function(){ah(i,a)},c}function Ib(i){return i=$s(i),i.tag=3,i}function Db(i,a,c,f){var b=c.type.getDerivedStateFromError;if(typeof b=="function"){var w=f.value;i.payload=function(){return b(w)},i.callback=function(){Rb(a,c,f)}}var z=c.stateNode;z!==null&&typeof z.componentDidCatch=="function"&&(i.callback=function(){Rb(a,c,f),typeof b!="function"&&(Ys===null?Ys=new Set([this]):Ys.add(this));var Q=f.stack;this.componentDidCatch(f.value,{componentStack:Q!==null?Q:""})})}function KA(i,a,c,f,b){if(c.flags|=32768,f!==null&&typeof f=="object"&&typeof f.then=="function"){if(a=c.alternate,a!==null&&nl(a,c,b,!0),c=_r.current,c!==null){switch(c.tag){case 31:case 13:return Pr===null?_h():c.alternate===null&&en===0&&(en=3),c.flags&=-257,c.flags|=65536,c.lanes=b,f===Wd?c.flags|=16384:(a=c.updateQueue,a===null?c.updateQueue=new Set([f]):a.add(f),Wp(i,f,b)),!1;case 22:return c.flags|=65536,f===Wd?c.flags|=16384:(a=c.updateQueue,a===null?(a={transitions:null,markerInstances:null,retryQueue:new Set([f])},c.updateQueue=a):(c=a.retryQueue,c===null?a.retryQueue=new Set([f]):c.add(f)),Wp(i,f,b)),!1}throw Error(r(435,c.tag))}return Wp(i,f,b),_h(),!1}if(gt)return a=_r.current,a!==null?((a.flags&65536)===0&&(a.flags|=256),a.flags|=65536,a.lanes=b,f!==Fm&&(i=Error(r(422),{cause:f}),Lc(kr(i,c)))):(f!==Fm&&(a=Error(r(423),{cause:f}),Lc(kr(a,c))),i=i.current.alternate,i.flags|=65536,b&=-b,i.lanes|=b,f=kr(f,c),b=wp(i.stateNode,f,b),Zm(i,b),en!==4&&(en=2)),!1;var w=Error(r(520),{cause:f});if(w=kr(w,c),iu===null?iu=[w]:iu.push(w),en!==4&&(en=2),a===null)return!0;f=kr(f,c),c=a;do{switch(c.tag){case 3:return c.flags|=65536,i=b&-b,c.lanes|=i,i=wp(c.stateNode,f,i),Zm(c,i),!1;case 1:if(a=c.type,w=c.stateNode,(c.flags&128)===0&&(typeof a.getDerivedStateFromError=="function"||w!==null&&typeof w.componentDidCatch=="function"&&(Ys===null||!Ys.has(w))))return c.flags|=65536,b&=-b,c.lanes|=b,b=Ib(b),Db(b,i,c,f),Zm(c,b),!1}c=c.return}while(c!==null);return!1}var Sp=Error(r(461)),mn=!1;function Nn(i,a,c,f){a.child=i===null?N_(a,null,c,f):ao(a,i.child,c,f)}function kb(i,a,c,f,b){c=c.render;var w=a.ref;if("ref"in f){var z={};for(var Q in f)Q!=="ref"&&(z[Q]=f[Q])}else z=f;return no(a),f=ip(i,a,c,z,w,b),Q=sp(),i!==null&&!mn?(ap(i,a,b),rs(i,a,b)):(gt&&Q&&Lm(a),a.flags|=1,Nn(i,a,f,b),a.child)}function Ob(i,a,c,f,b){if(i===null){var w=c.type;return typeof w=="function"&&!Pm(w)&&w.defaultProps===void 0&&c.compare===null?(a.tag=15,a.type=w,Mb(i,a,w,f,b)):(i=Fd(c.type,null,f,a,a.mode,b),i.ref=a.ref,i.return=a,a.child=i)}if(w=i.child,!Dp(i,b)){var z=w.memoizedProps;if(c=c.compare,c=c!==null?c:Pc,c(z,f)&&i.ref===a.ref)return rs(i,a,b)}return a.flags|=1,i=Xi(w,f),i.ref=a.ref,i.return=a,a.child=i}function Mb(i,a,c,f,b){if(i!==null){var w=i.memoizedProps;if(Pc(w,f)&&i.ref===a.ref)if(mn=!1,a.pendingProps=f=w,Dp(i,b))(i.flags&131072)!==0&&(mn=!0);else return a.lanes=i.lanes,rs(i,a,b)}return Ep(i,a,c,f,b)}function Nb(i,a,c,f){var b=f.children,w=i!==null?i.memoizedState:null;if(i===null&&a.stateNode===null&&(a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),f.mode==="hidden"){if((a.flags&128)!==0){if(w=w!==null?w.baseLanes|c:c,i!==null){for(f=a.child=i.child,b=0;f!==null;)b=b|f.lanes|f.childLanes,f=f.sibling;f=b&~w}else f=0,a.child=null;return Pb(i,a,w,c,f)}if((c&536870912)!==0)a.memoizedState={baseLanes:0,cachePool:null},i!==null&&qd(a,w!==null?w.cachePool:null),w!==null?B_(a,w):ep(),L_(a);else return f=a.lanes=536870912,Pb(i,a,w!==null?w.baseLanes|c:c,c,f)}else w!==null?(qd(a,w.cachePool),B_(a,w),Gs(),a.memoizedState=null):(i!==null&&qd(a,null),ep(),Gs());return Nn(i,a,b,c),a.child}function Xc(i,a){return i!==null&&i.tag===22||a.stateNode!==null||(a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),a.sibling}function Pb(i,a,c,f,b){var w=Qm();return w=w===null?null:{parent:hn._currentValue,pool:w},a.memoizedState={baseLanes:c,cachePool:w},i!==null&&qd(a,null),ep(),L_(a),i!==null&&nl(i,a,f,!0),a.childLanes=b,null}function oh(i,a){return a=ch({mode:a.mode,children:a.children},i.mode),a.ref=i.ref,i.child=a,a.return=i,a}function zb(i,a,c){return ao(a,i.child,null,c),i=oh(a,a.pendingProps),i.flags|=2,br(a),a.memoizedState=null,i}function YA(i,a,c){var f=a.pendingProps,b=(a.flags&128)!==0;if(a.flags&=-129,i===null){if(gt){if(f.mode==="hidden")return i=oh(a,f),a.lanes=536870912,Xc(null,i);if(np(a),(i=Ut)?(i=Kv(i,Nr),i=i!==null&&i.data==="&"?i:null,i!==null&&(a.memoizedState={dehydrated:i,treeContext:Bs!==null?{id:ji,overflow:Ri}:null,retryLane:536870912,hydrationErrors:null},c=v_(i),c.return=a,a.child=c,On=a,Ut=null)):i=null,i===null)throw Us(a);return a.lanes=536870912,null}return oh(a,f)}var w=i.memoizedState;if(w!==null){var z=w.dehydrated;if(np(a),b)if(a.flags&256)a.flags&=-257,a=zb(i,a,c);else if(a.memoizedState!==null)a.child=i.child,a.flags|=128,a=null;else throw Error(r(558));else if(mn||nl(i,a,c,!1),b=(c&i.childLanes)!==0,mn||b){if(f=Nt,f!==null&&(z=_c(f,c),z!==0&&z!==w.retryLane))throw w.retryLane=z,Za(i,z),cr(f,i,z),Sp;_h(),a=zb(i,a,c)}else i=w.treeContext,Ut=zr(z.nextSibling),On=a,gt=!0,Ls=null,Nr=!1,i!==null&&S_(a,i),a=oh(a,f),a.flags|=4096;return a}return i=Xi(i.child,{mode:f.mode,children:f.children}),i.ref=a.ref,a.child=i,i.return=a,i}function lh(i,a){var c=a.ref;if(c===null)i!==null&&i.ref!==null&&(a.flags|=4194816);else{if(typeof c!="function"&&typeof c!="object")throw Error(r(284));(i===null||i.ref!==c)&&(a.flags|=4194816)}}function Ep(i,a,c,f,b){return no(a),c=ip(i,a,c,f,void 0,b),f=sp(),i!==null&&!mn?(ap(i,a,b),rs(i,a,b)):(gt&&f&&Lm(a),a.flags|=1,Nn(i,a,c,b),a.child)}function Bb(i,a,c,f,b,w){return no(a),a.updateQueue=null,c=F_(a,f,c,b),U_(i),f=sp(),i!==null&&!mn?(ap(i,a,w),rs(i,a,w)):(gt&&f&&Lm(a),a.flags|=1,Nn(i,a,c,w),a.child)}function Lb(i,a,c,f,b){if(no(a),a.stateNode===null){var w=Zo,z=c.contextType;typeof z=="object"&&z!==null&&(w=Mn(z)),w=new c(f,w),a.memoizedState=w.state!==null&&w.state!==void 0?w.state:null,w.updater=xp,a.stateNode=w,w._reactInternals=a,w=a.stateNode,w.props=f,w.state=a.memoizedState,w.refs={},Ym(a),z=c.contextType,w.context=typeof z=="object"&&z!==null?Mn(z):Zo,w.state=a.memoizedState,z=c.getDerivedStateFromProps,typeof z=="function"&&(vp(a,c,z,f),w.state=a.memoizedState),typeof c.getDerivedStateFromProps=="function"||typeof w.getSnapshotBeforeUpdate=="function"||typeof w.UNSAFE_componentWillMount!="function"&&typeof w.componentWillMount!="function"||(z=w.state,typeof w.componentWillMount=="function"&&w.componentWillMount(),typeof w.UNSAFE_componentWillMount=="function"&&w.UNSAFE_componentWillMount(),z!==w.state&&xp.enqueueReplaceState(w,w.state,null),Gc(a,f,w,b),qc(),w.state=a.memoizedState),typeof w.componentDidMount=="function"&&(a.flags|=4194308),f=!0}else if(i===null){w=a.stateNode;var Q=a.memoizedProps,ne=lo(c,Q);w.props=ne;var fe=w.context,Se=c.contextType;z=Zo,typeof Se=="object"&&Se!==null&&(z=Mn(Se));var Re=c.getDerivedStateFromProps;Se=typeof Re=="function"||typeof w.getSnapshotBeforeUpdate=="function",Q=a.pendingProps!==Q,Se||typeof w.UNSAFE_componentWillReceiveProps!="function"&&typeof w.componentWillReceiveProps!="function"||(Q||fe!==z)&&Cb(a,w,f,z),Vs=!1;var ge=a.memoizedState;w.state=ge,Gc(a,f,w,b),qc(),fe=a.memoizedState,Q||ge!==fe||Vs?(typeof Re=="function"&&(vp(a,c,Re,f),fe=a.memoizedState),(ne=Vs||Eb(a,c,ne,f,ge,fe,z))?(Se||typeof w.UNSAFE_componentWillMount!="function"&&typeof w.componentWillMount!="function"||(typeof w.componentWillMount=="function"&&w.componentWillMount(),typeof w.UNSAFE_componentWillMount=="function"&&w.UNSAFE_componentWillMount()),typeof w.componentDidMount=="function"&&(a.flags|=4194308)):(typeof w.componentDidMount=="function"&&(a.flags|=4194308),a.memoizedProps=f,a.memoizedState=fe),w.props=f,w.state=fe,w.context=z,f=ne):(typeof w.componentDidMount=="function"&&(a.flags|=4194308),f=!1)}else{w=a.stateNode,Xm(i,a),z=a.memoizedProps,Se=lo(c,z),w.props=Se,Re=a.pendingProps,ge=w.context,fe=c.contextType,ne=Zo,typeof fe=="object"&&fe!==null&&(ne=Mn(fe)),Q=c.getDerivedStateFromProps,(fe=typeof Q=="function"||typeof w.getSnapshotBeforeUpdate=="function")||typeof w.UNSAFE_componentWillReceiveProps!="function"&&typeof w.componentWillReceiveProps!="function"||(z!==Re||ge!==ne)&&Cb(a,w,f,ne),Vs=!1,ge=a.memoizedState,w.state=ge,Gc(a,f,w,b),qc();var ve=a.memoizedState;z!==Re||ge!==ve||Vs||i!==null&&i.dependencies!==null&&$d(i.dependencies)?(typeof Q=="function"&&(vp(a,c,Q,f),ve=a.memoizedState),(Se=Vs||Eb(a,c,Se,f,ge,ve,ne)||i!==null&&i.dependencies!==null&&$d(i.dependencies))?(fe||typeof w.UNSAFE_componentWillUpdate!="function"&&typeof w.componentWillUpdate!="function"||(typeof w.componentWillUpdate=="function"&&w.componentWillUpdate(f,ve,ne),typeof w.UNSAFE_componentWillUpdate=="function"&&w.UNSAFE_componentWillUpdate(f,ve,ne)),typeof w.componentDidUpdate=="function"&&(a.flags|=4),typeof w.getSnapshotBeforeUpdate=="function"&&(a.flags|=1024)):(typeof w.componentDidUpdate!="function"||z===i.memoizedProps&&ge===i.memoizedState||(a.flags|=4),typeof w.getSnapshotBeforeUpdate!="function"||z===i.memoizedProps&&ge===i.memoizedState||(a.flags|=1024),a.memoizedProps=f,a.memoizedState=ve),w.props=f,w.state=ve,w.context=ne,f=Se):(typeof w.componentDidUpdate!="function"||z===i.memoizedProps&&ge===i.memoizedState||(a.flags|=4),typeof w.getSnapshotBeforeUpdate!="function"||z===i.memoizedProps&&ge===i.memoizedState||(a.flags|=1024),f=!1)}return w=f,lh(i,a),f=(a.flags&128)!==0,w||f?(w=a.stateNode,c=f&&typeof c.getDerivedStateFromError!="function"?null:w.render(),a.flags|=1,i!==null&&f?(a.child=ao(a,i.child,null,b),a.child=ao(a,null,c,b)):Nn(i,a,c,b),a.memoizedState=w.state,i=a.child):i=rs(i,a,b),i}function Ub(i,a,c,f){return eo(),a.flags|=256,Nn(i,a,c,f),a.child}var Cp={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Tp(i){return{baseLanes:i,cachePool:R_()}}function Ap(i,a,c){return i=i!==null?i.childLanes&~c:0,a&&(i|=xr),i}function Fb(i,a,c){var f=a.pendingProps,b=!1,w=(a.flags&128)!==0,z;if((z=w)||(z=i!==null&&i.memoizedState===null?!1:(rn.current&2)!==0),z&&(b=!0,a.flags&=-129),z=(a.flags&32)!==0,a.flags&=-33,i===null){if(gt){if(b?qs(a):Gs(),(i=Ut)?(i=Kv(i,Nr),i=i!==null&&i.data!=="&"?i:null,i!==null&&(a.memoizedState={dehydrated:i,treeContext:Bs!==null?{id:ji,overflow:Ri}:null,retryLane:536870912,hydrationErrors:null},c=v_(i),c.return=a,a.child=c,On=a,Ut=null)):i=null,i===null)throw Us(a);return cg(i)?a.lanes=32:a.lanes=536870912,null}var Q=f.children;return f=f.fallback,b?(Gs(),b=a.mode,Q=ch({mode:"hidden",children:Q},b),f=Ja(f,b,c,null),Q.return=a,f.return=a,Q.sibling=f,a.child=Q,f=a.child,f.memoizedState=Tp(c),f.childLanes=Ap(i,z,c),a.memoizedState=Cp,Xc(null,f)):(qs(a),jp(a,Q))}var ne=i.memoizedState;if(ne!==null&&(Q=ne.dehydrated,Q!==null)){if(w)a.flags&256?(qs(a),a.flags&=-257,a=Rp(i,a,c)):a.memoizedState!==null?(Gs(),a.child=i.child,a.flags|=128,a=null):(Gs(),Q=f.fallback,b=a.mode,f=ch({mode:"visible",children:f.children},b),Q=Ja(Q,b,c,null),Q.flags|=2,f.return=a,Q.return=a,f.sibling=Q,a.child=f,ao(a,i.child,null,c),f=a.child,f.memoizedState=Tp(c),f.childLanes=Ap(i,z,c),a.memoizedState=Cp,a=Xc(null,f));else if(qs(a),cg(Q)){if(z=Q.nextSibling&&Q.nextSibling.dataset,z)var fe=z.dgst;z=fe,f=Error(r(419)),f.stack="",f.digest=z,Lc({value:f,source:null,stack:null}),a=Rp(i,a,c)}else if(mn||nl(i,a,c,!1),z=(c&i.childLanes)!==0,mn||z){if(z=Nt,z!==null&&(f=_c(z,c),f!==0&&f!==ne.retryLane))throw ne.retryLane=f,Za(i,f),cr(z,i,f),Sp;lg(Q)||_h(),a=Rp(i,a,c)}else lg(Q)?(a.flags|=192,a.child=i.child,a=null):(i=ne.treeContext,Ut=zr(Q.nextSibling),On=a,gt=!0,Ls=null,Nr=!1,i!==null&&S_(a,i),a=jp(a,f.children),a.flags|=4096);return a}return b?(Gs(),Q=f.fallback,b=a.mode,ne=i.child,fe=ne.sibling,f=Xi(ne,{mode:"hidden",children:f.children}),f.subtreeFlags=ne.subtreeFlags&65011712,fe!==null?Q=Xi(fe,Q):(Q=Ja(Q,b,c,null),Q.flags|=2),Q.return=a,f.return=a,f.sibling=Q,a.child=f,Xc(null,f),f=a.child,Q=i.child.memoizedState,Q===null?Q=Tp(c):(b=Q.cachePool,b!==null?(ne=hn._currentValue,b=b.parent!==ne?{parent:ne,pool:ne}:b):b=R_(),Q={baseLanes:Q.baseLanes|c,cachePool:b}),f.memoizedState=Q,f.childLanes=Ap(i,z,c),a.memoizedState=Cp,Xc(i.child,f)):(qs(a),c=i.child,i=c.sibling,c=Xi(c,{mode:"visible",children:f.children}),c.return=a,c.sibling=null,i!==null&&(z=a.deletions,z===null?(a.deletions=[i],a.flags|=16):z.push(i)),a.child=c,a.memoizedState=null,c)}function jp(i,a){return a=ch({mode:"visible",children:a},i.mode),a.return=i,i.child=a}function ch(i,a){return i=yr(22,i,null,a),i.lanes=0,i}function Rp(i,a,c){return ao(a,i.child,null,c),i=jp(a,a.pendingProps.children),i.flags|=2,a.memoizedState=null,i}function Vb(i,a,c){i.lanes|=a;var f=i.alternate;f!==null&&(f.lanes|=a),Hm(i.return,a,c)}function Ip(i,a,c,f,b,w){var z=i.memoizedState;z===null?i.memoizedState={isBackwards:a,rendering:null,renderingStartTime:0,last:f,tail:c,tailMode:b,treeForkCount:w}:(z.isBackwards=a,z.rendering=null,z.renderingStartTime=0,z.last=f,z.tail=c,z.tailMode=b,z.treeForkCount=w)}function $b(i,a,c){var f=a.pendingProps,b=f.revealOrder,w=f.tail;f=f.children;var z=rn.current,Q=(z&2)!==0;if(Q?(z=z&1|2,a.flags|=128):z&=1,te(rn,z),Nn(i,a,f,c),f=gt?Bc:0,!Q&&i!==null&&(i.flags&128)!==0)e:for(i=a.child;i!==null;){if(i.tag===13)i.memoizedState!==null&&Vb(i,c,a);else if(i.tag===19)Vb(i,c,a);else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===a)break e;for(;i.sibling===null;){if(i.return===null||i.return===a)break e;i=i.return}i.sibling.return=i.return,i=i.sibling}switch(b){case"forwards":for(c=a.child,b=null;c!==null;)i=c.alternate,i!==null&&Xd(i)===null&&(b=c),c=c.sibling;c=b,c===null?(b=a.child,a.child=null):(b=c.sibling,c.sibling=null),Ip(a,!1,b,c,w,f);break;case"backwards":case"unstable_legacy-backwards":for(c=null,b=a.child,a.child=null;b!==null;){if(i=b.alternate,i!==null&&Xd(i)===null){a.child=b;break}i=b.sibling,b.sibling=c,c=b,b=i}Ip(a,!0,c,null,w,f);break;case"together":Ip(a,!1,null,null,void 0,f);break;default:a.memoizedState=null}return a.child}function rs(i,a,c){if(i!==null&&(a.dependencies=i.dependencies),Ks|=a.lanes,(c&a.childLanes)===0)if(i!==null){if(nl(i,a,c,!1),(c&a.childLanes)===0)return null}else return null;if(i!==null&&a.child!==i.child)throw Error(r(153));if(a.child!==null){for(i=a.child,c=Xi(i,i.pendingProps),a.child=c,c.return=a;i.sibling!==null;)i=i.sibling,c=c.sibling=Xi(i,i.pendingProps),c.return=a;c.sibling=null}return a.child}function Dp(i,a){return(i.lanes&a)!==0?!0:(i=i.dependencies,!!(i!==null&&$d(i)))}function XA(i,a,c){switch(a.tag){case 3:Ee(a,a.stateNode.containerInfo),Fs(a,hn,i.memoizedState.cache),eo();break;case 27:case 5:pe(a);break;case 4:Ee(a,a.stateNode.containerInfo);break;case 10:Fs(a,a.type,a.memoizedProps.value);break;case 31:if(a.memoizedState!==null)return a.flags|=128,np(a),null;break;case 13:var f=a.memoizedState;if(f!==null)return f.dehydrated!==null?(qs(a),a.flags|=128,null):(c&a.child.childLanes)!==0?Fb(i,a,c):(qs(a),i=rs(i,a,c),i!==null?i.sibling:null);qs(a);break;case 19:var b=(i.flags&128)!==0;if(f=(c&a.childLanes)!==0,f||(nl(i,a,c,!1),f=(c&a.childLanes)!==0),b){if(f)return $b(i,a,c);a.flags|=128}if(b=a.memoizedState,b!==null&&(b.rendering=null,b.tail=null,b.lastEffect=null),te(rn,rn.current),f)break;return null;case 22:return a.lanes=0,Nb(i,a,c,a.pendingProps);case 24:Fs(a,hn,i.memoizedState.cache)}return rs(i,a,c)}function Hb(i,a,c){if(i!==null)if(i.memoizedProps!==a.pendingProps)mn=!0;else{if(!Dp(i,c)&&(a.flags&128)===0)return mn=!1,XA(i,a,c);mn=(i.flags&131072)!==0}else mn=!1,gt&&(a.flags&1048576)!==0&&w_(a,Bc,a.index);switch(a.lanes=0,a.tag){case 16:e:{var f=a.pendingProps;if(i=io(a.elementType),a.type=i,typeof i=="function")Pm(i)?(f=lo(i,f),a.tag=1,a=Lb(null,a,i,f,c)):(a.tag=0,a=Ep(null,a,i,f,c));else{if(i!=null){var b=i.$$typeof;if(b===B){a.tag=11,a=kb(null,a,i,f,c);break e}else if(b===k){a.tag=14,a=Ob(null,a,i,f,c);break e}}throw a=R(i)||i,Error(r(306,a,""))}}return a;case 0:return Ep(i,a,a.type,a.pendingProps,c);case 1:return f=a.type,b=lo(f,a.pendingProps),Lb(i,a,f,b,c);case 3:e:{if(Ee(a,a.stateNode.containerInfo),i===null)throw Error(r(387));f=a.pendingProps;var w=a.memoizedState;b=w.element,Xm(i,a),Gc(a,f,null,c);var z=a.memoizedState;if(f=z.cache,Fs(a,hn,f),f!==w.cache&&qm(a,[hn],c,!0),qc(),f=z.element,w.isDehydrated)if(w={element:f,isDehydrated:!1,cache:z.cache},a.updateQueue.baseState=w,a.memoizedState=w,a.flags&256){a=Ub(i,a,f,c);break e}else if(f!==b){b=kr(Error(r(424)),a),Lc(b),a=Ub(i,a,f,c);break e}else for(i=a.stateNode.containerInfo,i.nodeType===9?i=i.body:i=i.nodeName==="HTML"?i.ownerDocument.body:i,Ut=zr(i.firstChild),On=a,gt=!0,Ls=null,Nr=!0,c=N_(a,null,f,c),a.child=c;c;)c.flags=c.flags&-3|4096,c=c.sibling;else{if(eo(),f===b){a=rs(i,a,c);break e}Nn(i,a,f,c)}a=a.child}return a;case 26:return lh(i,a),i===null?(c=tx(a.type,null,a.pendingProps,null))?a.memoizedState=c:gt||(c=a.type,i=a.pendingProps,f=Ch(ye.current).createElement(c),f[cn]=a,f[jn]=i,Pn(f,c,i),un(f),a.stateNode=f):a.memoizedState=tx(a.type,i.memoizedProps,a.pendingProps,i.memoizedState),null;case 27:return pe(a),i===null&&gt&&(f=a.stateNode=Zv(a.type,a.pendingProps,ye.current),On=a,Nr=!0,b=Ut,ea(a.type)?(ug=b,Ut=zr(f.firstChild)):Ut=b),Nn(i,a,a.pendingProps.children,c),lh(i,a),i===null&&(a.flags|=4194304),a.child;case 5:return i===null&&gt&&((b=f=Ut)&&(f=A5(f,a.type,a.pendingProps,Nr),f!==null?(a.stateNode=f,On=a,Ut=zr(f.firstChild),Nr=!1,b=!0):b=!1),b||Us(a)),pe(a),b=a.type,w=a.pendingProps,z=i!==null?i.memoizedProps:null,f=w.children,sg(b,w)?f=null:z!==null&&sg(b,z)&&(a.flags|=32),a.memoizedState!==null&&(b=ip(i,a,VA,null,null,c),hu._currentValue=b),lh(i,a),Nn(i,a,f,c),a.child;case 6:return i===null&&gt&&((i=c=Ut)&&(c=j5(c,a.pendingProps,Nr),c!==null?(a.stateNode=c,On=a,Ut=null,i=!0):i=!1),i||Us(a)),null;case 13:return Fb(i,a,c);case 4:return Ee(a,a.stateNode.containerInfo),f=a.pendingProps,i===null?a.child=ao(a,null,f,c):Nn(i,a,f,c),a.child;case 11:return kb(i,a,a.type,a.pendingProps,c);case 7:return Nn(i,a,a.pendingProps,c),a.child;case 8:return Nn(i,a,a.pendingProps.children,c),a.child;case 12:return Nn(i,a,a.pendingProps.children,c),a.child;case 10:return f=a.pendingProps,Fs(a,a.type,f.value),Nn(i,a,f.children,c),a.child;case 9:return b=a.type._context,f=a.pendingProps.children,no(a),b=Mn(b),f=f(b),a.flags|=1,Nn(i,a,f,c),a.child;case 14:return Ob(i,a,a.type,a.pendingProps,c);case 15:return Mb(i,a,a.type,a.pendingProps,c);case 19:return $b(i,a,c);case 31:return YA(i,a,c);case 22:return Nb(i,a,c,a.pendingProps);case 24:return no(a),f=Mn(hn),i===null?(b=Qm(),b===null&&(b=Nt,w=Gm(),b.pooledCache=w,w.refCount++,w!==null&&(b.pooledCacheLanes|=c),b=w),a.memoizedState={parent:f,cache:b},Ym(a),Fs(a,hn,b)):((i.lanes&c)!==0&&(Xm(i,a),Gc(a,null,null,c),qc()),b=i.memoizedState,w=a.memoizedState,b.parent!==f?(b={parent:f,cache:f},a.memoizedState=b,a.lanes===0&&(a.memoizedState=a.updateQueue.baseState=b),Fs(a,hn,f)):(f=w.cache,Fs(a,hn,f),f!==b.cache&&qm(a,[hn],c,!0))),Nn(i,a,a.pendingProps.children,c),a.child;case 29:throw a.pendingProps}throw Error(r(156,a.tag))}function is(i){i.flags|=4}function kp(i,a,c,f,b){if((a=(i.mode&32)!==0)&&(a=!1),a){if(i.flags|=16777216,(b&335544128)===b)if(i.stateNode.complete)i.flags|=8192;else if(yv())i.flags|=8192;else throw so=Wd,Km}else i.flags&=-16777217}function qb(i,a){if(a.type!=="stylesheet"||(a.state.loading&4)!==0)i.flags&=-16777217;else if(i.flags|=16777216,!ax(a))if(yv())i.flags|=8192;else throw so=Wd,Km}function uh(i,a){a!==null&&(i.flags|=4),i.flags&16384&&(a=i.tag!==22?gd():536870912,i.lanes|=a,ml|=a)}function Zc(i,a){if(!gt)switch(i.tailMode){case"hidden":a=i.tail;for(var c=null;a!==null;)a.alternate!==null&&(c=a),a=a.sibling;c===null?i.tail=null:c.sibling=null;break;case"collapsed":c=i.tail;for(var f=null;c!==null;)c.alternate!==null&&(f=c),c=c.sibling;f===null?a||i.tail===null?i.tail=null:i.tail.sibling=null:f.sibling=null}}function Ft(i){var a=i.alternate!==null&&i.alternate.child===i.child,c=0,f=0;if(a)for(var b=i.child;b!==null;)c|=b.lanes|b.childLanes,f|=b.subtreeFlags&65011712,f|=b.flags&65011712,b.return=i,b=b.sibling;else for(b=i.child;b!==null;)c|=b.lanes|b.childLanes,f|=b.subtreeFlags,f|=b.flags,b.return=i,b=b.sibling;return i.subtreeFlags|=f,i.childLanes=c,a}function ZA(i,a,c){var f=a.pendingProps;switch(Um(a),a.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ft(a),null;case 1:return Ft(a),null;case 3:return c=a.stateNode,f=null,i!==null&&(f=i.memoizedState.cache),a.memoizedState.cache!==f&&(a.flags|=2048),es(hn),Ce(),c.pendingContext&&(c.context=c.pendingContext,c.pendingContext=null),(i===null||i.child===null)&&(tl(a)?is(a):i===null||i.memoizedState.isDehydrated&&(a.flags&256)===0||(a.flags|=1024,Vm())),Ft(a),null;case 26:var b=a.type,w=a.memoizedState;return i===null?(is(a),w!==null?(Ft(a),qb(a,w)):(Ft(a),kp(a,b,null,f,c))):w?w!==i.memoizedState?(is(a),Ft(a),qb(a,w)):(Ft(a),a.flags&=-16777217):(i=i.memoizedProps,i!==f&&is(a),Ft(a),kp(a,b,i,f,c)),null;case 27:if(Ue(a),c=ye.current,b=a.type,i!==null&&a.stateNode!=null)i.memoizedProps!==f&&is(a);else{if(!f){if(a.stateNode===null)throw Error(r(166));return Ft(a),null}i=se.current,tl(a)?E_(a):(i=Zv(b,f,c),a.stateNode=i,is(a))}return Ft(a),null;case 5:if(Ue(a),b=a.type,i!==null&&a.stateNode!=null)i.memoizedProps!==f&&is(a);else{if(!f){if(a.stateNode===null)throw Error(r(166));return Ft(a),null}if(w=se.current,tl(a))E_(a);else{var z=Ch(ye.current);switch(w){case 1:w=z.createElementNS("http://www.w3.org/2000/svg",b);break;case 2:w=z.createElementNS("http://www.w3.org/1998/Math/MathML",b);break;default:switch(b){case"svg":w=z.createElementNS("http://www.w3.org/2000/svg",b);break;case"math":w=z.createElementNS("http://www.w3.org/1998/Math/MathML",b);break;case"script":w=z.createElement("div"),w.innerHTML="<script><\/script>",w=w.removeChild(w.firstChild);break;case"select":w=typeof f.is=="string"?z.createElement("select",{is:f.is}):z.createElement("select"),f.multiple?w.multiple=!0:f.size&&(w.size=f.size);break;default:w=typeof f.is=="string"?z.createElement(b,{is:f.is}):z.createElement(b)}}w[cn]=a,w[jn]=f;e:for(z=a.child;z!==null;){if(z.tag===5||z.tag===6)w.appendChild(z.stateNode);else if(z.tag!==4&&z.tag!==27&&z.child!==null){z.child.return=z,z=z.child;continue}if(z===a)break e;for(;z.sibling===null;){if(z.return===null||z.return===a)break e;z=z.return}z.sibling.return=z.return,z=z.sibling}a.stateNode=w;e:switch(Pn(w,b,f),b){case"button":case"input":case"select":case"textarea":f=!!f.autoFocus;break e;case"img":f=!0;break e;default:f=!1}f&&is(a)}}return Ft(a),kp(a,a.type,i===null?null:i.memoizedProps,a.pendingProps,c),null;case 6:if(i&&a.stateNode!=null)i.memoizedProps!==f&&is(a);else{if(typeof f!="string"&&a.stateNode===null)throw Error(r(166));if(i=ye.current,tl(a)){if(i=a.stateNode,c=a.memoizedProps,f=null,b=On,b!==null)switch(b.tag){case 27:case 5:f=b.memoizedProps}i[cn]=a,i=!!(i.nodeValue===c||f!==null&&f.suppressHydrationWarning===!0||Fv(i.nodeValue,c)),i||Us(a,!0)}else i=Ch(i).createTextNode(f),i[cn]=a,a.stateNode=i}return Ft(a),null;case 31:if(c=a.memoizedState,i===null||i.memoizedState!==null){if(f=tl(a),c!==null){if(i===null){if(!f)throw Error(r(318));if(i=a.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(r(557));i[cn]=a}else eo(),(a.flags&128)===0&&(a.memoizedState=null),a.flags|=4;Ft(a),i=!1}else c=Vm(),i!==null&&i.memoizedState!==null&&(i.memoizedState.hydrationErrors=c),i=!0;if(!i)return a.flags&256?(br(a),a):(br(a),null);if((a.flags&128)!==0)throw Error(r(558))}return Ft(a),null;case 13:if(f=a.memoizedState,i===null||i.memoizedState!==null&&i.memoizedState.dehydrated!==null){if(b=tl(a),f!==null&&f.dehydrated!==null){if(i===null){if(!b)throw Error(r(318));if(b=a.memoizedState,b=b!==null?b.dehydrated:null,!b)throw Error(r(317));b[cn]=a}else eo(),(a.flags&128)===0&&(a.memoizedState=null),a.flags|=4;Ft(a),b=!1}else b=Vm(),i!==null&&i.memoizedState!==null&&(i.memoizedState.hydrationErrors=b),b=!0;if(!b)return a.flags&256?(br(a),a):(br(a),null)}return br(a),(a.flags&128)!==0?(a.lanes=c,a):(c=f!==null,i=i!==null&&i.memoizedState!==null,c&&(f=a.child,b=null,f.alternate!==null&&f.alternate.memoizedState!==null&&f.alternate.memoizedState.cachePool!==null&&(b=f.alternate.memoizedState.cachePool.pool),w=null,f.memoizedState!==null&&f.memoizedState.cachePool!==null&&(w=f.memoizedState.cachePool.pool),w!==b&&(f.flags|=2048)),c!==i&&c&&(a.child.flags|=8192),uh(a,a.updateQueue),Ft(a),null);case 4:return Ce(),i===null&&eg(a.stateNode.containerInfo),Ft(a),null;case 10:return es(a.type),Ft(a),null;case 19:if($(rn),f=a.memoizedState,f===null)return Ft(a),null;if(b=(a.flags&128)!==0,w=f.rendering,w===null)if(b)Zc(f,!1);else{if(en!==0||i!==null&&(i.flags&128)!==0)for(i=a.child;i!==null;){if(w=Xd(i),w!==null){for(a.flags|=128,Zc(f,!1),i=w.updateQueue,a.updateQueue=i,uh(a,i),a.subtreeFlags=0,i=c,c=a.child;c!==null;)b_(c,i),c=c.sibling;return te(rn,rn.current&1|2),gt&&Zi(a,f.treeForkCount),a.child}i=i.sibling}f.tail!==null&&Ne()>ph&&(a.flags|=128,b=!0,Zc(f,!1),a.lanes=4194304)}else{if(!b)if(i=Xd(w),i!==null){if(a.flags|=128,b=!0,i=i.updateQueue,a.updateQueue=i,uh(a,i),Zc(f,!0),f.tail===null&&f.tailMode==="hidden"&&!w.alternate&&!gt)return Ft(a),null}else 2*Ne()-f.renderingStartTime>ph&&c!==536870912&&(a.flags|=128,b=!0,Zc(f,!1),a.lanes=4194304);f.isBackwards?(w.sibling=a.child,a.child=w):(i=f.last,i!==null?i.sibling=w:a.child=w,f.last=w)}return f.tail!==null?(i=f.tail,f.rendering=i,f.tail=i.sibling,f.renderingStartTime=Ne(),i.sibling=null,c=rn.current,te(rn,b?c&1|2:c&1),gt&&Zi(a,f.treeForkCount),i):(Ft(a),null);case 22:case 23:return br(a),tp(),f=a.memoizedState!==null,i!==null?i.memoizedState!==null!==f&&(a.flags|=8192):f&&(a.flags|=8192),f?(c&536870912)!==0&&(a.flags&128)===0&&(Ft(a),a.subtreeFlags&6&&(a.flags|=8192)):Ft(a),c=a.updateQueue,c!==null&&uh(a,c.retryQueue),c=null,i!==null&&i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(c=i.memoizedState.cachePool.pool),f=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(f=a.memoizedState.cachePool.pool),f!==c&&(a.flags|=2048),i!==null&&$(ro),null;case 24:return c=null,i!==null&&(c=i.memoizedState.cache),a.memoizedState.cache!==c&&(a.flags|=2048),es(hn),Ft(a),null;case 25:return null;case 30:return null}throw Error(r(156,a.tag))}function JA(i,a){switch(Um(a),a.tag){case 1:return i=a.flags,i&65536?(a.flags=i&-65537|128,a):null;case 3:return es(hn),Ce(),i=a.flags,(i&65536)!==0&&(i&128)===0?(a.flags=i&-65537|128,a):null;case 26:case 27:case 5:return Ue(a),null;case 31:if(a.memoizedState!==null){if(br(a),a.alternate===null)throw Error(r(340));eo()}return i=a.flags,i&65536?(a.flags=i&-65537|128,a):null;case 13:if(br(a),i=a.memoizedState,i!==null&&i.dehydrated!==null){if(a.alternate===null)throw Error(r(340));eo()}return i=a.flags,i&65536?(a.flags=i&-65537|128,a):null;case 19:return $(rn),null;case 4:return Ce(),null;case 10:return es(a.type),null;case 22:case 23:return br(a),tp(),i!==null&&$(ro),i=a.flags,i&65536?(a.flags=i&-65537|128,a):null;case 24:return es(hn),null;case 25:return null;default:return null}}function Gb(i,a){switch(Um(a),a.tag){case 3:es(hn),Ce();break;case 26:case 27:case 5:Ue(a);break;case 4:Ce();break;case 31:a.memoizedState!==null&&br(a);break;case 13:br(a);break;case 19:$(rn);break;case 10:es(a.type);break;case 22:case 23:br(a),tp(),i!==null&&$(ro);break;case 24:es(hn)}}function Jc(i,a){try{var c=a.updateQueue,f=c!==null?c.lastEffect:null;if(f!==null){var b=f.next;c=b;do{if((c.tag&i)===i){f=void 0;var w=c.create,z=c.inst;f=w(),z.destroy=f}c=c.next}while(c!==b)}}catch(Q){Rt(a,a.return,Q)}}function Ws(i,a,c){try{var f=a.updateQueue,b=f!==null?f.lastEffect:null;if(b!==null){var w=b.next;f=w;do{if((f.tag&i)===i){var z=f.inst,Q=z.destroy;if(Q!==void 0){z.destroy=void 0,b=a;var ne=c,fe=Q;try{fe()}catch(Se){Rt(b,ne,Se)}}}f=f.next}while(f!==w)}}catch(Se){Rt(a,a.return,Se)}}function Wb(i){var a=i.updateQueue;if(a!==null){var c=i.stateNode;try{z_(a,c)}catch(f){Rt(i,i.return,f)}}}function Qb(i,a,c){c.props=lo(i.type,i.memoizedProps),c.state=i.memoizedState;try{c.componentWillUnmount()}catch(f){Rt(i,a,f)}}function eu(i,a){try{var c=i.ref;if(c!==null){switch(i.tag){case 26:case 27:case 5:var f=i.stateNode;break;case 30:f=i.stateNode;break;default:f=i.stateNode}typeof c=="function"?i.refCleanup=c(f):c.current=f}}catch(b){Rt(i,a,b)}}function Ii(i,a){var c=i.ref,f=i.refCleanup;if(c!==null)if(typeof f=="function")try{f()}catch(b){Rt(i,a,b)}finally{i.refCleanup=null,i=i.alternate,i!=null&&(i.refCleanup=null)}else if(typeof c=="function")try{c(null)}catch(b){Rt(i,a,b)}else c.current=null}function Kb(i){var a=i.type,c=i.memoizedProps,f=i.stateNode;try{e:switch(a){case"button":case"input":case"select":case"textarea":c.autoFocus&&f.focus();break e;case"img":c.src?f.src=c.src:c.srcSet&&(f.srcset=c.srcSet)}}catch(b){Rt(i,i.return,b)}}function Op(i,a,c){try{var f=i.stateNode;x5(f,i.type,c,a),f[jn]=a}catch(b){Rt(i,i.return,b)}}function Yb(i){return i.tag===5||i.tag===3||i.tag===26||i.tag===27&&ea(i.type)||i.tag===4}function Mp(i){e:for(;;){for(;i.sibling===null;){if(i.return===null||Yb(i.return))return null;i=i.return}for(i.sibling.return=i.return,i=i.sibling;i.tag!==5&&i.tag!==6&&i.tag!==18;){if(i.tag===27&&ea(i.type)||i.flags&2||i.child===null||i.tag===4)continue e;i.child.return=i,i=i.child}if(!(i.flags&2))return i.stateNode}}function Np(i,a,c){var f=i.tag;if(f===5||f===6)i=i.stateNode,a?(c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c).insertBefore(i,a):(a=c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c,a.appendChild(i),c=c._reactRootContainer,c!=null||a.onclick!==null||(a.onclick=Wr));else if(f!==4&&(f===27&&ea(i.type)&&(c=i.stateNode,a=null),i=i.child,i!==null))for(Np(i,a,c),i=i.sibling;i!==null;)Np(i,a,c),i=i.sibling}function dh(i,a,c){var f=i.tag;if(f===5||f===6)i=i.stateNode,a?c.insertBefore(i,a):c.appendChild(i);else if(f!==4&&(f===27&&ea(i.type)&&(c=i.stateNode),i=i.child,i!==null))for(dh(i,a,c),i=i.sibling;i!==null;)dh(i,a,c),i=i.sibling}function Xb(i){var a=i.stateNode,c=i.memoizedProps;try{for(var f=i.type,b=a.attributes;b.length;)a.removeAttributeNode(b[0]);Pn(a,f,c),a[cn]=i,a[jn]=c}catch(w){Rt(i,i.return,w)}}var ss=!1,pn=!1,Pp=!1,Zb=typeof WeakSet=="function"?WeakSet:Set,In=null;function e5(i,a){if(i=i.containerInfo,rg=kh,i=u_(i),Rm(i)){if("selectionStart"in i)var c={start:i.selectionStart,end:i.selectionEnd};else e:{c=(c=i.ownerDocument)&&c.defaultView||window;var f=c.getSelection&&c.getSelection();if(f&&f.rangeCount!==0){c=f.anchorNode;var b=f.anchorOffset,w=f.focusNode;f=f.focusOffset;try{c.nodeType,w.nodeType}catch{c=null;break e}var z=0,Q=-1,ne=-1,fe=0,Se=0,Re=i,ge=null;t:for(;;){for(var ve;Re!==c||b!==0&&Re.nodeType!==3||(Q=z+b),Re!==w||f!==0&&Re.nodeType!==3||(ne=z+f),Re.nodeType===3&&(z+=Re.nodeValue.length),(ve=Re.firstChild)!==null;)ge=Re,Re=ve;for(;;){if(Re===i)break t;if(ge===c&&++fe===b&&(Q=z),ge===w&&++Se===f&&(ne=z),(ve=Re.nextSibling)!==null)break;Re=ge,ge=Re.parentNode}Re=ve}c=Q===-1||ne===-1?null:{start:Q,end:ne}}else c=null}c=c||{start:0,end:0}}else c=null;for(ig={focusedElem:i,selectionRange:c},kh=!1,In=a;In!==null;)if(a=In,i=a.child,(a.subtreeFlags&1028)!==0&&i!==null)i.return=a,In=i;else for(;In!==null;){switch(a=In,w=a.alternate,i=a.flags,a.tag){case 0:if((i&4)!==0&&(i=a.updateQueue,i=i!==null?i.events:null,i!==null))for(c=0;c<i.length;c++)b=i[c],b.ref.impl=b.nextImpl;break;case 11:case 15:break;case 1:if((i&1024)!==0&&w!==null){i=void 0,c=a,b=w.memoizedProps,w=w.memoizedState,f=c.stateNode;try{var Fe=lo(c.type,b);i=f.getSnapshotBeforeUpdate(Fe,w),f.__reactInternalSnapshotBeforeUpdate=i}catch(Ke){Rt(c,c.return,Ke)}}break;case 3:if((i&1024)!==0){if(i=a.stateNode.containerInfo,c=i.nodeType,c===9)og(i);else if(c===1)switch(i.nodeName){case"HEAD":case"HTML":case"BODY":og(i);break;default:i.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((i&1024)!==0)throw Error(r(163))}if(i=a.sibling,i!==null){i.return=a.return,In=i;break}In=a.return}}function Jb(i,a,c){var f=c.flags;switch(c.tag){case 0:case 11:case 15:os(i,c),f&4&&Jc(5,c);break;case 1:if(os(i,c),f&4)if(i=c.stateNode,a===null)try{i.componentDidMount()}catch(z){Rt(c,c.return,z)}else{var b=lo(c.type,a.memoizedProps);a=a.memoizedState;try{i.componentDidUpdate(b,a,i.__reactInternalSnapshotBeforeUpdate)}catch(z){Rt(c,c.return,z)}}f&64&&Wb(c),f&512&&eu(c,c.return);break;case 3:if(os(i,c),f&64&&(i=c.updateQueue,i!==null)){if(a=null,c.child!==null)switch(c.child.tag){case 27:case 5:a=c.child.stateNode;break;case 1:a=c.child.stateNode}try{z_(i,a)}catch(z){Rt(c,c.return,z)}}break;case 27:a===null&&f&4&&Xb(c);case 26:case 5:os(i,c),a===null&&f&4&&Kb(c),f&512&&eu(c,c.return);break;case 12:os(i,c);break;case 31:os(i,c),f&4&&nv(i,c);break;case 13:os(i,c),f&4&&rv(i,c),f&64&&(i=c.memoizedState,i!==null&&(i=i.dehydrated,i!==null&&(c=c5.bind(null,c),R5(i,c))));break;case 22:if(f=c.memoizedState!==null||ss,!f){a=a!==null&&a.memoizedState!==null||pn,b=ss;var w=pn;ss=f,(pn=a)&&!w?ls(i,c,(c.subtreeFlags&8772)!==0):os(i,c),ss=b,pn=w}break;case 30:break;default:os(i,c)}}function ev(i){var a=i.alternate;a!==null&&(i.alternate=null,ev(a)),i.child=null,i.deletions=null,i.sibling=null,i.tag===5&&(a=i.stateNode,a!==null&&Bo(a)),i.stateNode=null,i.return=null,i.dependencies=null,i.memoizedProps=null,i.memoizedState=null,i.pendingProps=null,i.stateNode=null,i.updateQueue=null}var Wt=null,sr=!1;function as(i,a,c){for(c=c.child;c!==null;)tv(i,a,c),c=c.sibling}function tv(i,a,c){if(Zt&&typeof Zt.onCommitFiberUnmount=="function")try{Zt.onCommitFiberUnmount(_t,c)}catch{}switch(c.tag){case 26:pn||Ii(c,a),as(i,a,c),c.memoizedState?c.memoizedState.count--:c.stateNode&&(c=c.stateNode,c.parentNode.removeChild(c));break;case 27:pn||Ii(c,a);var f=Wt,b=sr;ea(c.type)&&(Wt=c.stateNode,sr=!1),as(i,a,c),cu(c.stateNode),Wt=f,sr=b;break;case 5:pn||Ii(c,a);case 6:if(f=Wt,b=sr,Wt=null,as(i,a,c),Wt=f,sr=b,Wt!==null)if(sr)try{(Wt.nodeType===9?Wt.body:Wt.nodeName==="HTML"?Wt.ownerDocument.body:Wt).removeChild(c.stateNode)}catch(w){Rt(c,a,w)}else try{Wt.removeChild(c.stateNode)}catch(w){Rt(c,a,w)}break;case 18:Wt!==null&&(sr?(i=Wt,Wv(i.nodeType===9?i.body:i.nodeName==="HTML"?i.ownerDocument.body:i,c.stateNode),wl(i)):Wv(Wt,c.stateNode));break;case 4:f=Wt,b=sr,Wt=c.stateNode.containerInfo,sr=!0,as(i,a,c),Wt=f,sr=b;break;case 0:case 11:case 14:case 15:Ws(2,c,a),pn||Ws(4,c,a),as(i,a,c);break;case 1:pn||(Ii(c,a),f=c.stateNode,typeof f.componentWillUnmount=="function"&&Qb(c,a,f)),as(i,a,c);break;case 21:as(i,a,c);break;case 22:pn=(f=pn)||c.memoizedState!==null,as(i,a,c),pn=f;break;default:as(i,a,c)}}function nv(i,a){if(a.memoizedState===null&&(i=a.alternate,i!==null&&(i=i.memoizedState,i!==null))){i=i.dehydrated;try{wl(i)}catch(c){Rt(a,a.return,c)}}}function rv(i,a){if(a.memoizedState===null&&(i=a.alternate,i!==null&&(i=i.memoizedState,i!==null&&(i=i.dehydrated,i!==null))))try{wl(i)}catch(c){Rt(a,a.return,c)}}function t5(i){switch(i.tag){case 31:case 13:case 19:var a=i.stateNode;return a===null&&(a=i.stateNode=new Zb),a;case 22:return i=i.stateNode,a=i._retryCache,a===null&&(a=i._retryCache=new Zb),a;default:throw Error(r(435,i.tag))}}function hh(i,a){var c=t5(i);a.forEach(function(f){if(!c.has(f)){c.add(f);var b=u5.bind(null,i,f);f.then(b,b)}})}function ar(i,a){var c=a.deletions;if(c!==null)for(var f=0;f<c.length;f++){var b=c[f],w=i,z=a,Q=z;e:for(;Q!==null;){switch(Q.tag){case 27:if(ea(Q.type)){Wt=Q.stateNode,sr=!1;break e}break;case 5:Wt=Q.stateNode,sr=!1;break e;case 3:case 4:Wt=Q.stateNode.containerInfo,sr=!0;break e}Q=Q.return}if(Wt===null)throw Error(r(160));tv(w,z,b),Wt=null,sr=!1,w=b.alternate,w!==null&&(w.return=null),b.return=null}if(a.subtreeFlags&13886)for(a=a.child;a!==null;)iv(a,i),a=a.sibling}var Jr=null;function iv(i,a){var c=i.alternate,f=i.flags;switch(i.tag){case 0:case 11:case 14:case 15:ar(a,i),or(i),f&4&&(Ws(3,i,i.return),Jc(3,i),Ws(5,i,i.return));break;case 1:ar(a,i),or(i),f&512&&(pn||c===null||Ii(c,c.return)),f&64&&ss&&(i=i.updateQueue,i!==null&&(f=i.callbacks,f!==null&&(c=i.shared.hiddenCallbacks,i.shared.hiddenCallbacks=c===null?f:c.concat(f))));break;case 26:var b=Jr;if(ar(a,i),or(i),f&512&&(pn||c===null||Ii(c,c.return)),f&4){var w=c!==null?c.memoizedState:null;if(f=i.memoizedState,c===null)if(f===null)if(i.stateNode===null){e:{f=i.type,c=i.memoizedProps,b=b.ownerDocument||b;t:switch(f){case"title":w=b.getElementsByTagName("title")[0],(!w||w[gi]||w[cn]||w.namespaceURI==="http://www.w3.org/2000/svg"||w.hasAttribute("itemprop"))&&(w=b.createElement(f),b.head.insertBefore(w,b.querySelector("head > title"))),Pn(w,f,c),w[cn]=i,un(w),f=w;break e;case"link":var z=ix("link","href",b).get(f+(c.href||""));if(z){for(var Q=0;Q<z.length;Q++)if(w=z[Q],w.getAttribute("href")===(c.href==null||c.href===""?null:c.href)&&w.getAttribute("rel")===(c.rel==null?null:c.rel)&&w.getAttribute("title")===(c.title==null?null:c.title)&&w.getAttribute("crossorigin")===(c.crossOrigin==null?null:c.crossOrigin)){z.splice(Q,1);break t}}w=b.createElement(f),Pn(w,f,c),b.head.appendChild(w);break;case"meta":if(z=ix("meta","content",b).get(f+(c.content||""))){for(Q=0;Q<z.length;Q++)if(w=z[Q],w.getAttribute("content")===(c.content==null?null:""+c.content)&&w.getAttribute("name")===(c.name==null?null:c.name)&&w.getAttribute("property")===(c.property==null?null:c.property)&&w.getAttribute("http-equiv")===(c.httpEquiv==null?null:c.httpEquiv)&&w.getAttribute("charset")===(c.charSet==null?null:c.charSet)){z.splice(Q,1);break t}}w=b.createElement(f),Pn(w,f,c),b.head.appendChild(w);break;default:throw Error(r(468,f))}w[cn]=i,un(w),f=w}i.stateNode=f}else sx(b,i.type,i.stateNode);else i.stateNode=rx(b,f,i.memoizedProps);else w!==f?(w===null?c.stateNode!==null&&(c=c.stateNode,c.parentNode.removeChild(c)):w.count--,f===null?sx(b,i.type,i.stateNode):rx(b,f,i.memoizedProps)):f===null&&i.stateNode!==null&&Op(i,i.memoizedProps,c.memoizedProps)}break;case 27:ar(a,i),or(i),f&512&&(pn||c===null||Ii(c,c.return)),c!==null&&f&4&&Op(i,i.memoizedProps,c.memoizedProps);break;case 5:if(ar(a,i),or(i),f&512&&(pn||c===null||Ii(c,c.return)),i.flags&32){b=i.stateNode;try{ir(b,"")}catch(Fe){Rt(i,i.return,Fe)}}f&4&&i.stateNode!=null&&(b=i.memoizedProps,Op(i,b,c!==null?c.memoizedProps:b)),f&1024&&(Pp=!0);break;case 6:if(ar(a,i),or(i),f&4){if(i.stateNode===null)throw Error(r(162));f=i.memoizedProps,c=i.stateNode;try{c.nodeValue=f}catch(Fe){Rt(i,i.return,Fe)}}break;case 3:if(jh=null,b=Jr,Jr=Th(a.containerInfo),ar(a,i),Jr=b,or(i),f&4&&c!==null&&c.memoizedState.isDehydrated)try{wl(a.containerInfo)}catch(Fe){Rt(i,i.return,Fe)}Pp&&(Pp=!1,sv(i));break;case 4:f=Jr,Jr=Th(i.stateNode.containerInfo),ar(a,i),or(i),Jr=f;break;case 12:ar(a,i),or(i);break;case 31:ar(a,i),or(i),f&4&&(f=i.updateQueue,f!==null&&(i.updateQueue=null,hh(i,f)));break;case 13:ar(a,i),or(i),i.child.flags&8192&&i.memoizedState!==null!=(c!==null&&c.memoizedState!==null)&&(mh=Ne()),f&4&&(f=i.updateQueue,f!==null&&(i.updateQueue=null,hh(i,f)));break;case 22:b=i.memoizedState!==null;var ne=c!==null&&c.memoizedState!==null,fe=ss,Se=pn;if(ss=fe||b,pn=Se||ne,ar(a,i),pn=Se,ss=fe,or(i),f&8192)e:for(a=i.stateNode,a._visibility=b?a._visibility&-2:a._visibility|1,b&&(c===null||ne||ss||pn||co(i)),c=null,a=i;;){if(a.tag===5||a.tag===26){if(c===null){ne=c=a;try{if(w=ne.stateNode,b)z=w.style,typeof z.setProperty=="function"?z.setProperty("display","none","important"):z.display="none";else{Q=ne.stateNode;var Re=ne.memoizedProps.style,ge=Re!=null&&Re.hasOwnProperty("display")?Re.display:null;Q.style.display=ge==null||typeof ge=="boolean"?"":(""+ge).trim()}}catch(Fe){Rt(ne,ne.return,Fe)}}}else if(a.tag===6){if(c===null){ne=a;try{ne.stateNode.nodeValue=b?"":ne.memoizedProps}catch(Fe){Rt(ne,ne.return,Fe)}}}else if(a.tag===18){if(c===null){ne=a;try{var ve=ne.stateNode;b?Qv(ve,!0):Qv(ne.stateNode,!1)}catch(Fe){Rt(ne,ne.return,Fe)}}}else if((a.tag!==22&&a.tag!==23||a.memoizedState===null||a===i)&&a.child!==null){a.child.return=a,a=a.child;continue}if(a===i)break e;for(;a.sibling===null;){if(a.return===null||a.return===i)break e;c===a&&(c=null),a=a.return}c===a&&(c=null),a.sibling.return=a.return,a=a.sibling}f&4&&(f=i.updateQueue,f!==null&&(c=f.retryQueue,c!==null&&(f.retryQueue=null,hh(i,c))));break;case 19:ar(a,i),or(i),f&4&&(f=i.updateQueue,f!==null&&(i.updateQueue=null,hh(i,f)));break;case 30:break;case 21:break;default:ar(a,i),or(i)}}function or(i){var a=i.flags;if(a&2){try{for(var c,f=i.return;f!==null;){if(Yb(f)){c=f;break}f=f.return}if(c==null)throw Error(r(160));switch(c.tag){case 27:var b=c.stateNode,w=Mp(i);dh(i,w,b);break;case 5:var z=c.stateNode;c.flags&32&&(ir(z,""),c.flags&=-33);var Q=Mp(i);dh(i,Q,z);break;case 3:case 4:var ne=c.stateNode.containerInfo,fe=Mp(i);Np(i,fe,ne);break;default:throw Error(r(161))}}catch(Se){Rt(i,i.return,Se)}i.flags&=-3}a&4096&&(i.flags&=-4097)}function sv(i){if(i.subtreeFlags&1024)for(i=i.child;i!==null;){var a=i;sv(a),a.tag===5&&a.flags&1024&&a.stateNode.reset(),i=i.sibling}}function os(i,a){if(a.subtreeFlags&8772)for(a=a.child;a!==null;)Jb(i,a.alternate,a),a=a.sibling}function co(i){for(i=i.child;i!==null;){var a=i;switch(a.tag){case 0:case 11:case 14:case 15:Ws(4,a,a.return),co(a);break;case 1:Ii(a,a.return);var c=a.stateNode;typeof c.componentWillUnmount=="function"&&Qb(a,a.return,c),co(a);break;case 27:cu(a.stateNode);case 26:case 5:Ii(a,a.return),co(a);break;case 22:a.memoizedState===null&&co(a);break;case 30:co(a);break;default:co(a)}i=i.sibling}}function ls(i,a,c){for(c=c&&(a.subtreeFlags&8772)!==0,a=a.child;a!==null;){var f=a.alternate,b=i,w=a,z=w.flags;switch(w.tag){case 0:case 11:case 15:ls(b,w,c),Jc(4,w);break;case 1:if(ls(b,w,c),f=w,b=f.stateNode,typeof b.componentDidMount=="function")try{b.componentDidMount()}catch(fe){Rt(f,f.return,fe)}if(f=w,b=f.updateQueue,b!==null){var Q=f.stateNode;try{var ne=b.shared.hiddenCallbacks;if(ne!==null)for(b.shared.hiddenCallbacks=null,b=0;b<ne.length;b++)P_(ne[b],Q)}catch(fe){Rt(f,f.return,fe)}}c&&z&64&&Wb(w),eu(w,w.return);break;case 27:Xb(w);case 26:case 5:ls(b,w,c),c&&f===null&&z&4&&Kb(w),eu(w,w.return);break;case 12:ls(b,w,c);break;case 31:ls(b,w,c),c&&z&4&&nv(b,w);break;case 13:ls(b,w,c),c&&z&4&&rv(b,w);break;case 22:w.memoizedState===null&&ls(b,w,c),eu(w,w.return);break;case 30:break;default:ls(b,w,c)}a=a.sibling}}function zp(i,a){var c=null;i!==null&&i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(c=i.memoizedState.cachePool.pool),i=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(i=a.memoizedState.cachePool.pool),i!==c&&(i!=null&&i.refCount++,c!=null&&Uc(c))}function Bp(i,a){i=null,a.alternate!==null&&(i=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==i&&(a.refCount++,i!=null&&Uc(i))}function ei(i,a,c,f){if(a.subtreeFlags&10256)for(a=a.child;a!==null;)av(i,a,c,f),a=a.sibling}function av(i,a,c,f){var b=a.flags;switch(a.tag){case 0:case 11:case 15:ei(i,a,c,f),b&2048&&Jc(9,a);break;case 1:ei(i,a,c,f);break;case 3:ei(i,a,c,f),b&2048&&(i=null,a.alternate!==null&&(i=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==i&&(a.refCount++,i!=null&&Uc(i)));break;case 12:if(b&2048){ei(i,a,c,f),i=a.stateNode;try{var w=a.memoizedProps,z=w.id,Q=w.onPostCommit;typeof Q=="function"&&Q(z,a.alternate===null?"mount":"update",i.passiveEffectDuration,-0)}catch(ne){Rt(a,a.return,ne)}}else ei(i,a,c,f);break;case 31:ei(i,a,c,f);break;case 13:ei(i,a,c,f);break;case 23:break;case 22:w=a.stateNode,z=a.alternate,a.memoizedState!==null?w._visibility&2?ei(i,a,c,f):tu(i,a):w._visibility&2?ei(i,a,c,f):(w._visibility|=2,dl(i,a,c,f,(a.subtreeFlags&10256)!==0||!1)),b&2048&&zp(z,a);break;case 24:ei(i,a,c,f),b&2048&&Bp(a.alternate,a);break;default:ei(i,a,c,f)}}function dl(i,a,c,f,b){for(b=b&&((a.subtreeFlags&10256)!==0||!1),a=a.child;a!==null;){var w=i,z=a,Q=c,ne=f,fe=z.flags;switch(z.tag){case 0:case 11:case 15:dl(w,z,Q,ne,b),Jc(8,z);break;case 23:break;case 22:var Se=z.stateNode;z.memoizedState!==null?Se._visibility&2?dl(w,z,Q,ne,b):tu(w,z):(Se._visibility|=2,dl(w,z,Q,ne,b)),b&&fe&2048&&zp(z.alternate,z);break;case 24:dl(w,z,Q,ne,b),b&&fe&2048&&Bp(z.alternate,z);break;default:dl(w,z,Q,ne,b)}a=a.sibling}}function tu(i,a){if(a.subtreeFlags&10256)for(a=a.child;a!==null;){var c=i,f=a,b=f.flags;switch(f.tag){case 22:tu(c,f),b&2048&&zp(f.alternate,f);break;case 24:tu(c,f),b&2048&&Bp(f.alternate,f);break;default:tu(c,f)}a=a.sibling}}var nu=8192;function hl(i,a,c){if(i.subtreeFlags&nu)for(i=i.child;i!==null;)ov(i,a,c),i=i.sibling}function ov(i,a,c){switch(i.tag){case 26:hl(i,a,c),i.flags&nu&&i.memoizedState!==null&&F5(c,Jr,i.memoizedState,i.memoizedProps);break;case 5:hl(i,a,c);break;case 3:case 4:var f=Jr;Jr=Th(i.stateNode.containerInfo),hl(i,a,c),Jr=f;break;case 22:i.memoizedState===null&&(f=i.alternate,f!==null&&f.memoizedState!==null?(f=nu,nu=16777216,hl(i,a,c),nu=f):hl(i,a,c));break;default:hl(i,a,c)}}function lv(i){var a=i.alternate;if(a!==null&&(i=a.child,i!==null)){a.child=null;do a=i.sibling,i.sibling=null,i=a;while(i!==null)}}function ru(i){var a=i.deletions;if((i.flags&16)!==0){if(a!==null)for(var c=0;c<a.length;c++){var f=a[c];In=f,uv(f,i)}lv(i)}if(i.subtreeFlags&10256)for(i=i.child;i!==null;)cv(i),i=i.sibling}function cv(i){switch(i.tag){case 0:case 11:case 15:ru(i),i.flags&2048&&Ws(9,i,i.return);break;case 3:ru(i);break;case 12:ru(i);break;case 22:var a=i.stateNode;i.memoizedState!==null&&a._visibility&2&&(i.return===null||i.return.tag!==13)?(a._visibility&=-3,fh(i)):ru(i);break;default:ru(i)}}function fh(i){var a=i.deletions;if((i.flags&16)!==0){if(a!==null)for(var c=0;c<a.length;c++){var f=a[c];In=f,uv(f,i)}lv(i)}for(i=i.child;i!==null;){switch(a=i,a.tag){case 0:case 11:case 15:Ws(8,a,a.return),fh(a);break;case 22:c=a.stateNode,c._visibility&2&&(c._visibility&=-3,fh(a));break;default:fh(a)}i=i.sibling}}function uv(i,a){for(;In!==null;){var c=In;switch(c.tag){case 0:case 11:case 15:Ws(8,c,a);break;case 23:case 22:if(c.memoizedState!==null&&c.memoizedState.cachePool!==null){var f=c.memoizedState.cachePool.pool;f!=null&&f.refCount++}break;case 24:Uc(c.memoizedState.cache)}if(f=c.child,f!==null)f.return=c,In=f;else e:for(c=i;In!==null;){f=In;var b=f.sibling,w=f.return;if(ev(f),f===c){In=null;break e}if(b!==null){b.return=w,In=b;break e}In=w}}}var n5={getCacheForType:function(i){var a=Mn(hn),c=a.data.get(i);return c===void 0&&(c=i(),a.data.set(i,c)),c},cacheSignal:function(){return Mn(hn).controller.signal}},r5=typeof WeakMap=="function"?WeakMap:Map,Ct=0,Nt=null,lt=null,dt=0,jt=0,vr=null,Qs=!1,fl=!1,Lp=!1,cs=0,en=0,Ks=0,uo=0,Up=0,xr=0,ml=0,iu=null,lr=null,Fp=!1,mh=0,dv=0,ph=1/0,gh=null,Ys=null,vn=0,Xs=null,pl=null,us=0,Vp=0,$p=null,hv=null,su=0,Hp=null;function wr(){return(Ct&2)!==0&&dt!==0?dt&-dt:W.T!==null?Yp():yd()}function fv(){if(xr===0)if((dt&536870912)===0||gt){var i=hi;hi<<=1,(hi&3932160)===0&&(hi=262144),xr=i}else xr=536870912;return i=_r.current,i!==null&&(i.flags|=32),xr}function cr(i,a,c){(i===Nt&&(jt===2||jt===9)||i.cancelPendingCommit!==null)&&(gl(i,0),Zs(i,dt,xr,!1)),Ba(i,c),((Ct&2)===0||i!==Nt)&&(i===Nt&&((Ct&2)===0&&(uo|=c),en===4&&Zs(i,dt,xr,!1)),Di(i))}function mv(i,a,c){if((Ct&6)!==0)throw Error(r(327));var f=!c&&(a&127)===0&&(a&i.expiredLanes)===0||Hr(i,a),b=f?a5(i,a):Gp(i,a,!0),w=f;do{if(b===0){fl&&!f&&Zs(i,a,0,!1);break}else{if(c=i.current.alternate,w&&!i5(c)){b=Gp(i,a,!1),w=!1;continue}if(b===2){if(w=a,i.errorRecoveryDisabledLanes&w)var z=0;else z=i.pendingLanes&-536870913,z=z!==0?z:z&536870912?536870912:0;if(z!==0){a=z;e:{var Q=i;b=iu;var ne=Q.current.memoizedState.isDehydrated;if(ne&&(gl(Q,z).flags|=256),z=Gp(Q,z,!1),z!==2){if(Lp&&!ne){Q.errorRecoveryDisabledLanes|=w,uo|=w,b=4;break e}w=lr,lr=b,w!==null&&(lr===null?lr=w:lr.push.apply(lr,w))}b=z}if(w=!1,b!==2)continue}}if(b===1){gl(i,0),Zs(i,a,0,!0);break}e:{switch(f=i,w=b,w){case 0:case 1:throw Error(r(345));case 4:if((a&4194048)!==a)break;case 6:Zs(f,a,xr,!Qs);break e;case 2:lr=null;break;case 3:case 5:break;default:throw Error(r(329))}if((a&62914560)===a&&(b=mh+300-Ne(),10<b)){if(Zs(f,a,xr,!Qs),fi(f,0,!0)!==0)break e;us=a,f.timeoutHandle=qv(pv.bind(null,f,c,lr,gh,Fp,a,xr,uo,ml,Qs,w,"Throttled",-0,0),b);break e}pv(f,c,lr,gh,Fp,a,xr,uo,ml,Qs,w,null,-0,0)}}break}while(!0);Di(i)}function pv(i,a,c,f,b,w,z,Q,ne,fe,Se,Re,ge,ve){if(i.timeoutHandle=-1,Re=a.subtreeFlags,Re&8192||(Re&16785408)===16785408){Re={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Wr},ov(a,w,Re);var Fe=(w&62914560)===w?mh-Ne():(w&4194048)===w?dv-Ne():0;if(Fe=V5(Re,Fe),Fe!==null){us=w,i.cancelPendingCommit=Fe(Sv.bind(null,i,a,w,c,f,b,z,Q,ne,Se,Re,null,ge,ve)),Zs(i,w,z,!fe);return}}Sv(i,a,w,c,f,b,z,Q,ne)}function i5(i){for(var a=i;;){var c=a.tag;if((c===0||c===11||c===15)&&a.flags&16384&&(c=a.updateQueue,c!==null&&(c=c.stores,c!==null)))for(var f=0;f<c.length;f++){var b=c[f],w=b.getSnapshot;b=b.value;try{if(!gr(w(),b))return!1}catch{return!1}}if(c=a.child,a.subtreeFlags&16384&&c!==null)c.return=a,a=c;else{if(a===i)break;for(;a.sibling===null;){if(a.return===null||a.return===i)return!0;a=a.return}a.sibling.return=a.return,a=a.sibling}}return!0}function Zs(i,a,c,f){a&=~Up,a&=~uo,i.suspendedLanes|=a,i.pingedLanes&=~a,f&&(i.warmLanes|=a),f=i.expirationTimes;for(var b=a;0<b;){var w=31-St(b),z=1<<w;f[w]=-1,b&=~z}c!==0&&La(i,c,a)}function yh(){return(Ct&6)===0?(au(0),!1):!0}function qp(){if(lt!==null){if(jt===0)var i=lt.return;else i=lt,Ji=to=null,op(i),al=null,Vc=0,i=lt;for(;i!==null;)Gb(i.alternate,i),i=i.return;lt=null}}function gl(i,a){var c=i.timeoutHandle;c!==-1&&(i.timeoutHandle=-1,E5(c)),c=i.cancelPendingCommit,c!==null&&(i.cancelPendingCommit=null,c()),us=0,qp(),Nt=i,lt=c=Xi(i.current,null),dt=a,jt=0,vr=null,Qs=!1,fl=Hr(i,a),Lp=!1,ml=xr=Up=uo=Ks=en=0,lr=iu=null,Fp=!1,(a&8)!==0&&(a|=a&32);var f=i.entangledLanes;if(f!==0)for(i=i.entanglements,f&=a;0<f;){var b=31-St(f),w=1<<b;a|=i[b],f&=~w}return cs=a,Bd(),c}function gv(i,a){at=null,W.H=Yc,a===sl||a===Gd?(a=k_(),jt=3):a===Km?(a=k_(),jt=4):jt=a===Sp?8:a!==null&&typeof a=="object"&&typeof a.then=="function"?6:1,vr=a,lt===null&&(en=1,ah(i,kr(a,i.current)))}function yv(){var i=_r.current;return i===null?!0:(dt&4194048)===dt?Pr===null:(dt&62914560)===dt||(dt&536870912)!==0?i===Pr:!1}function _v(){var i=W.H;return W.H=Yc,i===null?Yc:i}function bv(){var i=W.A;return W.A=n5,i}function _h(){en=4,Qs||(dt&4194048)!==dt&&_r.current!==null||(fl=!0),(Ks&134217727)===0&&(uo&134217727)===0||Nt===null||Zs(Nt,dt,xr,!1)}function Gp(i,a,c){var f=Ct;Ct|=2;var b=_v(),w=bv();(Nt!==i||dt!==a)&&(gh=null,gl(i,a)),a=!1;var z=en;e:do try{if(jt!==0&&lt!==null){var Q=lt,ne=vr;switch(jt){case 8:qp(),z=6;break e;case 3:case 2:case 9:case 6:_r.current===null&&(a=!0);var fe=jt;if(jt=0,vr=null,yl(i,Q,ne,fe),c&&fl){z=0;break e}break;default:fe=jt,jt=0,vr=null,yl(i,Q,ne,fe)}}s5(),z=en;break}catch(Se){gv(i,Se)}while(!0);return a&&i.shellSuspendCounter++,Ji=to=null,Ct=f,W.H=b,W.A=w,lt===null&&(Nt=null,dt=0,Bd()),z}function s5(){for(;lt!==null;)vv(lt)}function a5(i,a){var c=Ct;Ct|=2;var f=_v(),b=bv();Nt!==i||dt!==a?(gh=null,ph=Ne()+500,gl(i,a)):fl=Hr(i,a);e:do try{if(jt!==0&&lt!==null){a=lt;var w=vr;t:switch(jt){case 1:jt=0,vr=null,yl(i,a,w,1);break;case 2:case 9:if(I_(w)){jt=0,vr=null,xv(a);break}a=function(){jt!==2&&jt!==9||Nt!==i||(jt=7),Di(i)},w.then(a,a);break e;case 3:jt=7;break e;case 4:jt=5;break e;case 7:I_(w)?(jt=0,vr=null,xv(a)):(jt=0,vr=null,yl(i,a,w,7));break;case 5:var z=null;switch(lt.tag){case 26:z=lt.memoizedState;case 5:case 27:var Q=lt;if(z?ax(z):Q.stateNode.complete){jt=0,vr=null;var ne=Q.sibling;if(ne!==null)lt=ne;else{var fe=Q.return;fe!==null?(lt=fe,bh(fe)):lt=null}break t}}jt=0,vr=null,yl(i,a,w,5);break;case 6:jt=0,vr=null,yl(i,a,w,6);break;case 8:qp(),en=6;break e;default:throw Error(r(462))}}o5();break}catch(Se){gv(i,Se)}while(!0);return Ji=to=null,W.H=f,W.A=b,Ct=c,lt!==null?0:(Nt=null,dt=0,Bd(),en)}function o5(){for(;lt!==null&&!oe();)vv(lt)}function vv(i){var a=Hb(i.alternate,i,cs);i.memoizedProps=i.pendingProps,a===null?bh(i):lt=a}function xv(i){var a=i,c=a.alternate;switch(a.tag){case 15:case 0:a=Bb(c,a,a.pendingProps,a.type,void 0,dt);break;case 11:a=Bb(c,a,a.pendingProps,a.type.render,a.ref,dt);break;case 5:op(a);default:Gb(c,a),a=lt=b_(a,cs),a=Hb(c,a,cs)}i.memoizedProps=i.pendingProps,a===null?bh(i):lt=a}function yl(i,a,c,f){Ji=to=null,op(a),al=null,Vc=0;var b=a.return;try{if(KA(i,b,a,c,dt)){en=1,ah(i,kr(c,i.current)),lt=null;return}}catch(w){if(b!==null)throw lt=b,w;en=1,ah(i,kr(c,i.current)),lt=null;return}a.flags&32768?(gt||f===1?i=!0:fl||(dt&536870912)!==0?i=!1:(Qs=i=!0,(f===2||f===9||f===3||f===6)&&(f=_r.current,f!==null&&f.tag===13&&(f.flags|=16384))),wv(a,i)):bh(a)}function bh(i){var a=i;do{if((a.flags&32768)!==0){wv(a,Qs);return}i=a.return;var c=ZA(a.alternate,a,cs);if(c!==null){lt=c;return}if(a=a.sibling,a!==null){lt=a;return}lt=a=i}while(a!==null);en===0&&(en=5)}function wv(i,a){do{var c=JA(i.alternate,i);if(c!==null){c.flags&=32767,lt=c;return}if(c=i.return,c!==null&&(c.flags|=32768,c.subtreeFlags=0,c.deletions=null),!a&&(i=i.sibling,i!==null)){lt=i;return}lt=i=c}while(i!==null);en=6,lt=null}function Sv(i,a,c,f,b,w,z,Q,ne){i.cancelPendingCommit=null;do vh();while(vn!==0);if((Ct&6)!==0)throw Error(r(327));if(a!==null){if(a===i.current)throw Error(r(177));if(w=a.lanes|a.childLanes,w|=Mm,Cm(i,c,w,z,Q,ne),i===Nt&&(lt=Nt=null,dt=0),pl=a,Xs=i,us=c,Vp=w,$p=b,hv=f,(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?(i.callbackNode=null,i.callbackPriority=0,d5(rt,function(){return jv(),null})):(i.callbackNode=null,i.callbackPriority=0),f=(a.flags&13878)!==0,(a.subtreeFlags&13878)!==0||f){f=W.T,W.T=null,b=q.p,q.p=2,z=Ct,Ct|=4;try{e5(i,a,c)}finally{Ct=z,q.p=b,W.T=f}}vn=1,Ev(),Cv(),Tv()}}function Ev(){if(vn===1){vn=0;var i=Xs,a=pl,c=(a.flags&13878)!==0;if((a.subtreeFlags&13878)!==0||c){c=W.T,W.T=null;var f=q.p;q.p=2;var b=Ct;Ct|=4;try{iv(a,i);var w=ig,z=u_(i.containerInfo),Q=w.focusedElem,ne=w.selectionRange;if(z!==Q&&Q&&Q.ownerDocument&&c_(Q.ownerDocument.documentElement,Q)){if(ne!==null&&Rm(Q)){var fe=ne.start,Se=ne.end;if(Se===void 0&&(Se=fe),"selectionStart"in Q)Q.selectionStart=fe,Q.selectionEnd=Math.min(Se,Q.value.length);else{var Re=Q.ownerDocument||document,ge=Re&&Re.defaultView||window;if(ge.getSelection){var ve=ge.getSelection(),Fe=Q.textContent.length,Ke=Math.min(ne.start,Fe),Ot=ne.end===void 0?Ke:Math.min(ne.end,Fe);!ve.extend&&Ke>Ot&&(z=Ot,Ot=Ke,Ke=z);var ue=l_(Q,Ke),le=l_(Q,Ot);if(ue&&le&&(ve.rangeCount!==1||ve.anchorNode!==ue.node||ve.anchorOffset!==ue.offset||ve.focusNode!==le.node||ve.focusOffset!==le.offset)){var he=Re.createRange();he.setStart(ue.node,ue.offset),ve.removeAllRanges(),Ke>Ot?(ve.addRange(he),ve.extend(le.node,le.offset)):(he.setEnd(le.node,le.offset),ve.addRange(he))}}}}for(Re=[],ve=Q;ve=ve.parentNode;)ve.nodeType===1&&Re.push({element:ve,left:ve.scrollLeft,top:ve.scrollTop});for(typeof Q.focus=="function"&&Q.focus(),Q=0;Q<Re.length;Q++){var Te=Re[Q];Te.element.scrollLeft=Te.left,Te.element.scrollTop=Te.top}}kh=!!rg,ig=rg=null}finally{Ct=b,q.p=f,W.T=c}}i.current=a,vn=2}}function Cv(){if(vn===2){vn=0;var i=Xs,a=pl,c=(a.flags&8772)!==0;if((a.subtreeFlags&8772)!==0||c){c=W.T,W.T=null;var f=q.p;q.p=2;var b=Ct;Ct|=4;try{Jb(i,a.alternate,a)}finally{Ct=b,q.p=f,W.T=c}}vn=3}}function Tv(){if(vn===4||vn===3){vn=0,Ae();var i=Xs,a=pl,c=us,f=hv;(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?vn=5:(vn=0,pl=Xs=null,Av(i,i.pendingLanes));var b=i.pendingLanes;if(b===0&&(Ys=null),Wi(c),a=a.stateNode,Zt&&typeof Zt.onCommitFiberRoot=="function")try{Zt.onCommitFiberRoot(_t,a,void 0,(a.current.flags&128)===128)}catch{}if(f!==null){a=W.T,b=q.p,q.p=2,W.T=null;try{for(var w=i.onRecoverableError,z=0;z<f.length;z++){var Q=f[z];w(Q.value,{componentStack:Q.stack})}}finally{W.T=a,q.p=b}}(us&3)!==0&&vh(),Di(i),b=i.pendingLanes,(c&261930)!==0&&(b&42)!==0?i===Hp?su++:(su=0,Hp=i):su=0,au(0)}}function Av(i,a){(i.pooledCacheLanes&=a)===0&&(a=i.pooledCache,a!=null&&(i.pooledCache=null,Uc(a)))}function vh(){return Ev(),Cv(),Tv(),jv()}function jv(){if(vn!==5)return!1;var i=Xs,a=Vp;Vp=0;var c=Wi(us),f=W.T,b=q.p;try{q.p=32>c?32:c,W.T=null,c=$p,$p=null;var w=Xs,z=us;if(vn=0,pl=Xs=null,us=0,(Ct&6)!==0)throw Error(r(331));var Q=Ct;if(Ct|=4,cv(w.current),av(w,w.current,z,c),Ct=Q,au(0,!1),Zt&&typeof Zt.onPostCommitFiberRoot=="function")try{Zt.onPostCommitFiberRoot(_t,w)}catch{}return!0}finally{q.p=b,W.T=f,Av(i,a)}}function Rv(i,a,c){a=kr(c,a),a=wp(i.stateNode,a,2),i=Hs(i,a,2),i!==null&&(Ba(i,2),Di(i))}function Rt(i,a,c){if(i.tag===3)Rv(i,i,c);else for(;a!==null;){if(a.tag===3){Rv(a,i,c);break}else if(a.tag===1){var f=a.stateNode;if(typeof a.type.getDerivedStateFromError=="function"||typeof f.componentDidCatch=="function"&&(Ys===null||!Ys.has(f))){i=kr(c,i),c=Ib(2),f=Hs(a,c,2),f!==null&&(Db(c,f,a,i),Ba(f,2),Di(f));break}}a=a.return}}function Wp(i,a,c){var f=i.pingCache;if(f===null){f=i.pingCache=new r5;var b=new Set;f.set(a,b)}else b=f.get(a),b===void 0&&(b=new Set,f.set(a,b));b.has(c)||(Lp=!0,b.add(c),i=l5.bind(null,i,a,c),a.then(i,i))}function l5(i,a,c){var f=i.pingCache;f!==null&&f.delete(a),i.pingedLanes|=i.suspendedLanes&c,i.warmLanes&=~c,Nt===i&&(dt&c)===c&&(en===4||en===3&&(dt&62914560)===dt&&300>Ne()-mh?(Ct&2)===0&&gl(i,0):Up|=c,ml===dt&&(ml=0)),Di(i)}function Iv(i,a){a===0&&(a=gd()),i=Za(i,a),i!==null&&(Ba(i,a),Di(i))}function c5(i){var a=i.memoizedState,c=0;a!==null&&(c=a.retryLane),Iv(i,c)}function u5(i,a){var c=0;switch(i.tag){case 31:case 13:var f=i.stateNode,b=i.memoizedState;b!==null&&(c=b.retryLane);break;case 19:f=i.stateNode;break;case 22:f=i.stateNode._retryCache;break;default:throw Error(r(314))}f!==null&&f.delete(a),Iv(i,c)}function d5(i,a){return we(i,a)}var xh=null,_l=null,Qp=!1,wh=!1,Kp=!1,Js=0;function Di(i){i!==_l&&i.next===null&&(_l===null?xh=_l=i:_l=_l.next=i),wh=!0,Qp||(Qp=!0,f5())}function au(i,a){if(!Kp&&wh){Kp=!0;do for(var c=!1,f=xh;f!==null;){if(i!==0){var b=f.pendingLanes;if(b===0)var w=0;else{var z=f.suspendedLanes,Q=f.pingedLanes;w=(1<<31-St(42|i)+1)-1,w&=b&~(z&~Q),w=w&201326741?w&201326741|1:w?w|2:0}w!==0&&(c=!0,Mv(f,w))}else w=dt,w=fi(f,f===Nt?w:0,f.cancelPendingCommit!==null||f.timeoutHandle!==-1),(w&3)===0||Hr(f,w)||(c=!0,Mv(f,w));f=f.next}while(c);Kp=!1}}function h5(){Dv()}function Dv(){wh=Qp=!1;var i=0;Js!==0&&S5()&&(i=Js);for(var a=Ne(),c=null,f=xh;f!==null;){var b=f.next,w=kv(f,a);w===0?(f.next=null,c===null?xh=b:c.next=b,b===null&&(_l=c)):(c=f,(i!==0||(w&3)!==0)&&(wh=!0)),f=b}vn!==0&&vn!==5||au(i),Js!==0&&(Js=0)}function kv(i,a){for(var c=i.suspendedLanes,f=i.pingedLanes,b=i.expirationTimes,w=i.pendingLanes&-62914561;0<w;){var z=31-St(w),Q=1<<z,ne=b[z];ne===-1?((Q&c)===0||(Q&f)!==0)&&(b[z]=Em(Q,a)):ne<=a&&(i.expiredLanes|=Q),w&=~Q}if(a=Nt,c=dt,c=fi(i,i===a?c:0,i.cancelPendingCommit!==null||i.timeoutHandle!==-1),f=i.callbackNode,c===0||i===a&&(jt===2||jt===9)||i.cancelPendingCommit!==null)return f!==null&&f!==null&&xe(f),i.callbackNode=null,i.callbackPriority=0;if((c&3)===0||Hr(i,c)){if(a=c&-c,a===i.callbackPriority)return a;switch(f!==null&&xe(f),Wi(c)){case 2:case 8:c=vt;break;case 32:c=rt;break;case 268435456:c=ui;break;default:c=rt}return f=Ov.bind(null,i),c=we(c,f),i.callbackPriority=a,i.callbackNode=c,a}return f!==null&&f!==null&&xe(f),i.callbackPriority=2,i.callbackNode=null,2}function Ov(i,a){if(vn!==0&&vn!==5)return i.callbackNode=null,i.callbackPriority=0,null;var c=i.callbackNode;if(vh()&&i.callbackNode!==c)return null;var f=dt;return f=fi(i,i===Nt?f:0,i.cancelPendingCommit!==null||i.timeoutHandle!==-1),f===0?null:(mv(i,f,a),kv(i,Ne()),i.callbackNode!=null&&i.callbackNode===c?Ov.bind(null,i):null)}function Mv(i,a){if(vh())return null;mv(i,a,!0)}function f5(){C5(function(){(Ct&6)!==0?we(qe,h5):Dv()})}function Yp(){if(Js===0){var i=rl;i===0&&(i=Tr,Tr<<=1,(Tr&261888)===0&&(Tr=256)),Js=i}return Js}function Nv(i){return i==null||typeof i=="symbol"||typeof i=="boolean"?null:typeof i=="function"?i:Vo(""+i)}function Pv(i,a){var c=a.ownerDocument.createElement("input");return c.name=a.name,c.value=a.value,i.id&&c.setAttribute("form",i.id),a.parentNode.insertBefore(c,a),i=new FormData(i),c.parentNode.removeChild(c),i}function m5(i,a,c,f,b){if(a==="submit"&&c&&c.stateNode===b){var w=Nv((b[jn]||null).action),z=f.submitter;z&&(a=(a=z[jn]||null)?Nv(a.formAction):z.getAttribute("formAction"),a!==null&&(w=a,z=null));var Q=new Ei("action","action",null,f,b);i.push({event:Q,listeners:[{instance:null,listener:function(){if(f.defaultPrevented){if(Js!==0){var ne=z?Pv(b,z):new FormData(b);gp(c,{pending:!0,data:ne,method:b.method,action:w},null,ne)}}else typeof w=="function"&&(Q.preventDefault(),ne=z?Pv(b,z):new FormData(b),gp(c,{pending:!0,data:ne,method:b.method,action:w},w,ne))},currentTarget:b}]})}}for(var Xp=0;Xp<Om.length;Xp++){var Zp=Om[Xp],p5=Zp.toLowerCase(),g5=Zp[0].toUpperCase()+Zp.slice(1);Zr(p5,"on"+g5)}Zr(f_,"onAnimationEnd"),Zr(m_,"onAnimationIteration"),Zr(p_,"onAnimationStart"),Zr("dblclick","onDoubleClick"),Zr("focusin","onFocus"),Zr("focusout","onBlur"),Zr(kA,"onTransitionRun"),Zr(OA,"onTransitionStart"),Zr(MA,"onTransitionCancel"),Zr(g_,"onTransitionEnd"),vi("onMouseEnter",["mouseout","mouseover"]),vi("onMouseLeave",["mouseout","mouseover"]),vi("onPointerEnter",["pointerout","pointerover"]),vi("onPointerLeave",["pointerout","pointerover"]),bi("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),bi("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),bi("onBeforeInput",["compositionend","keypress","textInput","paste"]),bi("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),bi("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),bi("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ou="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),y5=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(ou));function zv(i,a){a=(a&4)!==0;for(var c=0;c<i.length;c++){var f=i[c],b=f.event;f=f.listeners;e:{var w=void 0;if(a)for(var z=f.length-1;0<=z;z--){var Q=f[z],ne=Q.instance,fe=Q.currentTarget;if(Q=Q.listener,ne!==w&&b.isPropagationStopped())break e;w=Q,b.currentTarget=fe;try{w(b)}catch(Se){zd(Se)}b.currentTarget=null,w=ne}else for(z=0;z<f.length;z++){if(Q=f[z],ne=Q.instance,fe=Q.currentTarget,Q=Q.listener,ne!==w&&b.isPropagationStopped())break e;w=Q,b.currentTarget=fe;try{w(b)}catch(Se){zd(Se)}b.currentTarget=null,w=ne}}}}function ct(i,a){var c=a[zo];c===void 0&&(c=a[zo]=new Set);var f=i+"__bubble";c.has(f)||(Bv(a,i,2,!1),c.add(f))}function Jp(i,a,c){var f=0;a&&(f|=4),Bv(c,i,f,a)}var Sh="_reactListening"+Math.random().toString(36).slice(2);function eg(i){if(!i[Sh]){i[Sh]=!0,bc.forEach(function(c){c!=="selectionchange"&&(y5.has(c)||Jp(c,!1,i),Jp(c,!0,i))});var a=i.nodeType===9?i:i.ownerDocument;a===null||a[Sh]||(a[Sh]=!0,Jp("selectionchange",!1,a))}}function Bv(i,a,c,f){switch(fx(a)){case 2:var b=q5;break;case 8:b=G5;break;default:b=pg}c=b.bind(null,a,c,i),b=void 0,!Ha||a!=="touchstart"&&a!=="touchmove"&&a!=="wheel"||(b=!0),f?b!==void 0?i.addEventListener(a,c,{capture:!0,passive:b}):i.addEventListener(a,c,!0):b!==void 0?i.addEventListener(a,c,{passive:b}):i.addEventListener(a,c,!1)}function tg(i,a,c,f,b){var w=f;if((a&1)===0&&(a&2)===0&&f!==null)e:for(;;){if(f===null)return;var z=f.tag;if(z===3||z===4){var Q=f.stateNode.containerInfo;if(Q===b)break;if(z===4)for(z=f.return;z!==null;){var ne=z.tag;if((ne===3||ne===4)&&z.stateNode.containerInfo===b)return;z=z.return}for(;Q!==null;){if(z=yi(Q),z===null)return;if(ne=z.tag,ne===5||ne===6||ne===26||ne===27){f=w=z;continue e}Q=Q.parentNode}}f=f.return}Ms(function(){var fe=w,Se=jr(c),Re=[];e:{var ge=y_.get(i);if(ge!==void 0){var ve=Ei,Fe=i;switch(i){case"keypress":if(Ga(c)===0)break e;case"keydown":case"keyup":ve=Md;break;case"focusin":Fe="focus",ve=Qa;break;case"focusout":Fe="blur",ve=Qa;break;case"beforeblur":case"afterblur":ve=Qa;break;case"click":if(c.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ve=kc;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ve=Cd;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ve=I;break;case f_:case m_:case p_:ve=Ad;break;case g_:ve=Y;break;case"scroll":case"scrollend":ve=Dc;break;case"wheel":ve=_e;break;case"copy":case"cut":case"paste":ve=jd;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ve=Yi;break;case"toggle":case"beforetoggle":ve=st}var Ke=(a&4)!==0,Ot=!Ke&&(i==="scroll"||i==="scrollend"),ue=Ke?ge!==null?ge+"Capture":null:ge;Ke=[];for(var le=fe,he;le!==null;){var Te=le;if(he=Te.stateNode,Te=Te.tag,Te!==5&&Te!==26&&Te!==27||he===null||ue===null||(Te=Qr(le,ue),Te!=null&&Ke.push(lu(le,Te,he))),Ot)break;le=le.return}0<Ke.length&&(ge=new ve(ge,Fe,null,c,Se),Re.push({event:ge,listeners:Ke}))}}if((a&7)===0){e:{if(ge=i==="mouseover"||i==="pointerover",ve=i==="mouseout"||i==="pointerout",ge&&c!==jc&&(Fe=c.relatedTarget||c.fromElement)&&(yi(Fe)||Fe[pi]))break e;if((ve||ge)&&(ge=Se.window===Se?Se:(ge=Se.ownerDocument)?ge.defaultView||ge.parentWindow:window,ve?(Fe=c.relatedTarget||c.toElement,ve=fe,Fe=Fe?yi(Fe):null,Fe!==null&&(Ot=o(Fe),Ke=Fe.tag,Fe!==Ot||Ke!==5&&Ke!==27&&Ke!==6)&&(Fe=null)):(ve=null,Fe=fe),ve!==Fe)){if(Ke=kc,Te="onMouseLeave",ue="onMouseEnter",le="mouse",(i==="pointerout"||i==="pointerover")&&(Ke=Yi,Te="onPointerLeave",ue="onPointerEnter",le="pointer"),Ot=ve==null?ge:mr(ve),he=Fe==null?ge:mr(Fe),ge=new Ke(Te,le+"leave",ve,c,Se),ge.target=Ot,ge.relatedTarget=he,Te=null,yi(Se)===fe&&(Ke=new Ke(ue,le+"enter",Fe,c,Se),Ke.target=he,Ke.relatedTarget=Ot,Te=Ke),Ot=Te,ve&&Fe)t:{for(Ke=_5,ue=ve,le=Fe,he=0,Te=ue;Te;Te=Ke(Te))he++;Te=0;for(var Ge=le;Ge;Ge=Ke(Ge))Te++;for(;0<he-Te;)ue=Ke(ue),he--;for(;0<Te-he;)le=Ke(le),Te--;for(;he--;){if(ue===le||le!==null&&ue===le.alternate){Ke=ue;break t}ue=Ke(ue),le=Ke(le)}Ke=null}else Ke=null;ve!==null&&Lv(Re,ge,ve,Ke,!1),Fe!==null&&Ot!==null&&Lv(Re,Ot,Fe,Ke,!0)}}e:{if(ge=fe?mr(fe):window,ve=ge.nodeName&&ge.nodeName.toLowerCase(),ve==="select"||ve==="input"&&ge.type==="file")var xt=n_;else if(e_(ge))if(r_)xt=RA;else{xt=AA;var $e=TA}else ve=ge.nodeName,!ve||ve.toLowerCase()!=="input"||ge.type!=="checkbox"&&ge.type!=="radio"?fe&&Fo(fe.elementType)&&(xt=n_):xt=jA;if(xt&&(xt=xt(i,fe))){t_(Re,xt,c,Se);break e}$e&&$e(i,ge,fe),i==="focusout"&&fe&&ge.type==="number"&&fe.memoizedProps.value!=null&&Cc(ge,"number",ge.value)}switch($e=fe?mr(fe):window,i){case"focusin":(e_($e)||$e.contentEditable==="true")&&(Ko=$e,Im=fe,zc=null);break;case"focusout":zc=Im=Ko=null;break;case"mousedown":Dm=!0;break;case"contextmenu":case"mouseup":case"dragend":Dm=!1,d_(Re,c,Se);break;case"selectionchange":if(DA)break;case"keydown":case"keyup":d_(Re,c,Se)}var ot;if(Et)e:{switch(i){case"compositionstart":var ht="onCompositionStart";break e;case"compositionend":ht="onCompositionEnd";break e;case"compositionupdate":ht="onCompositionUpdate";break e}ht=void 0}else Qo?Ka(i,c)&&(ht="onCompositionEnd"):i==="keydown"&&c.keyCode===229&&(ht="onCompositionStart");ht&&(Ai&&c.locale!=="ko"&&(Qo||ht!=="onCompositionStart"?ht==="onCompositionEnd"&&Qo&&(ot=Ic()):(Si=Se,Rc="value"in Si?Si.value:Si.textContent,Qo=!0)),$e=Eh(fe,ht),0<$e.length&&(ht=new Ti(ht,i,null,c,Se),Re.push({event:ht,listeners:$e}),ot?ht.data=ot:(ot=Wo(c),ot!==null&&(ht.data=ot)))),(ot=Ir?wA(i,c):SA(i,c))&&(ht=Eh(fe,"onBeforeInput"),0<ht.length&&($e=new Ti("onBeforeInput","beforeinput",null,c,Se),Re.push({event:$e,listeners:ht}),$e.data=ot)),m5(Re,i,fe,c,Se)}zv(Re,a)})}function lu(i,a,c){return{instance:i,listener:a,currentTarget:c}}function Eh(i,a){for(var c=a+"Capture",f=[];i!==null;){var b=i,w=b.stateNode;if(b=b.tag,b!==5&&b!==26&&b!==27||w===null||(b=Qr(i,c),b!=null&&f.unshift(lu(i,b,w)),b=Qr(i,a),b!=null&&f.push(lu(i,b,w))),i.tag===3)return f;i=i.return}return[]}function _5(i){if(i===null)return null;do i=i.return;while(i&&i.tag!==5&&i.tag!==27);return i||null}function Lv(i,a,c,f,b){for(var w=a._reactName,z=[];c!==null&&c!==f;){var Q=c,ne=Q.alternate,fe=Q.stateNode;if(Q=Q.tag,ne!==null&&ne===f)break;Q!==5&&Q!==26&&Q!==27||fe===null||(ne=fe,b?(fe=Qr(c,w),fe!=null&&z.unshift(lu(c,fe,ne))):b||(fe=Qr(c,w),fe!=null&&z.push(lu(c,fe,ne)))),c=c.return}z.length!==0&&i.push({event:a,listeners:z})}var b5=/\r\n?/g,v5=/\u0000|\uFFFD/g;function Uv(i){return(typeof i=="string"?i:""+i).replace(b5,`
`).replace(v5,"")}function Fv(i,a){return a=Uv(a),Uv(i)===a}function kt(i,a,c,f,b,w){switch(c){case"children":typeof f=="string"?a==="body"||a==="textarea"&&f===""||ir(i,f):(typeof f=="number"||typeof f=="bigint")&&a!=="body"&&ir(i,""+f);break;case"className":pr(i,"class",f);break;case"tabIndex":pr(i,"tabindex",f);break;case"dir":case"role":case"viewBox":case"width":case"height":pr(i,c,f);break;case"style":Ac(i,f,w);break;case"data":if(a!=="object"){pr(i,"data",f);break}case"src":case"href":if(f===""&&(a!=="a"||c!=="href")){i.removeAttribute(c);break}if(f==null||typeof f=="function"||typeof f=="symbol"||typeof f=="boolean"){i.removeAttribute(c);break}f=Vo(""+f),i.setAttribute(c,f);break;case"action":case"formAction":if(typeof f=="function"){i.setAttribute(c,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof w=="function"&&(c==="formAction"?(a!=="input"&&kt(i,a,"name",b.name,b,null),kt(i,a,"formEncType",b.formEncType,b,null),kt(i,a,"formMethod",b.formMethod,b,null),kt(i,a,"formTarget",b.formTarget,b,null)):(kt(i,a,"encType",b.encType,b,null),kt(i,a,"method",b.method,b,null),kt(i,a,"target",b.target,b,null)));if(f==null||typeof f=="symbol"||typeof f=="boolean"){i.removeAttribute(c);break}f=Vo(""+f),i.setAttribute(c,f);break;case"onClick":f!=null&&(i.onclick=Wr);break;case"onScroll":f!=null&&ct("scroll",i);break;case"onScrollEnd":f!=null&&ct("scrollend",i);break;case"dangerouslySetInnerHTML":if(f!=null){if(typeof f!="object"||!("__html"in f))throw Error(r(61));if(c=f.__html,c!=null){if(b.children!=null)throw Error(r(60));i.innerHTML=c}}break;case"multiple":i.multiple=f&&typeof f!="function"&&typeof f!="symbol";break;case"muted":i.muted=f&&typeof f!="function"&&typeof f!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(f==null||typeof f=="function"||typeof f=="boolean"||typeof f=="symbol"){i.removeAttribute("xlink:href");break}c=Vo(""+f),i.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",c);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":f!=null&&typeof f!="function"&&typeof f!="symbol"?i.setAttribute(c,""+f):i.removeAttribute(c);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":f&&typeof f!="function"&&typeof f!="symbol"?i.setAttribute(c,""):i.removeAttribute(c);break;case"capture":case"download":f===!0?i.setAttribute(c,""):f!==!1&&f!=null&&typeof f!="function"&&typeof f!="symbol"?i.setAttribute(c,f):i.removeAttribute(c);break;case"cols":case"rows":case"size":case"span":f!=null&&typeof f!="function"&&typeof f!="symbol"&&!isNaN(f)&&1<=f?i.setAttribute(c,f):i.removeAttribute(c);break;case"rowSpan":case"start":f==null||typeof f=="function"||typeof f=="symbol"||isNaN(f)?i.removeAttribute(c):i.setAttribute(c,f);break;case"popover":ct("beforetoggle",i),ct("toggle",i),Lo(i,"popover",f);break;case"xlinkActuate":dn(i,"http://www.w3.org/1999/xlink","xlink:actuate",f);break;case"xlinkArcrole":dn(i,"http://www.w3.org/1999/xlink","xlink:arcrole",f);break;case"xlinkRole":dn(i,"http://www.w3.org/1999/xlink","xlink:role",f);break;case"xlinkShow":dn(i,"http://www.w3.org/1999/xlink","xlink:show",f);break;case"xlinkTitle":dn(i,"http://www.w3.org/1999/xlink","xlink:title",f);break;case"xlinkType":dn(i,"http://www.w3.org/1999/xlink","xlink:type",f);break;case"xmlBase":dn(i,"http://www.w3.org/XML/1998/namespace","xml:base",f);break;case"xmlLang":dn(i,"http://www.w3.org/XML/1998/namespace","xml:lang",f);break;case"xmlSpace":dn(i,"http://www.w3.org/XML/1998/namespace","xml:space",f);break;case"is":Lo(i,"is",f);break;case"innerText":case"textContent":break;default:(!(2<c.length)||c[0]!=="o"&&c[0]!=="O"||c[1]!=="n"&&c[1]!=="N")&&(c=Ed.get(c)||c,Lo(i,c,f))}}function ng(i,a,c,f,b,w){switch(c){case"style":Ac(i,f,w);break;case"dangerouslySetInnerHTML":if(f!=null){if(typeof f!="object"||!("__html"in f))throw Error(r(61));if(c=f.__html,c!=null){if(b.children!=null)throw Error(r(60));i.innerHTML=c}}break;case"children":typeof f=="string"?ir(i,f):(typeof f=="number"||typeof f=="bigint")&&ir(i,""+f);break;case"onScroll":f!=null&&ct("scroll",i);break;case"onScrollEnd":f!=null&&ct("scrollend",i);break;case"onClick":f!=null&&(i.onclick=Wr);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!vc.hasOwnProperty(c))e:{if(c[0]==="o"&&c[1]==="n"&&(b=c.endsWith("Capture"),a=c.slice(2,b?c.length-7:void 0),w=i[jn]||null,w=w!=null?w[c]:null,typeof w=="function"&&i.removeEventListener(a,w,b),typeof f=="function")){typeof w!="function"&&w!==null&&(c in i?i[c]=null:i.hasAttribute(c)&&i.removeAttribute(c)),i.addEventListener(a,f,b);break e}c in i?i[c]=f:f===!0?i.setAttribute(c,""):Lo(i,c,f)}}}function Pn(i,a,c){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":ct("error",i),ct("load",i);var f=!1,b=!1,w;for(w in c)if(c.hasOwnProperty(w)){var z=c[w];if(z!=null)switch(w){case"src":f=!0;break;case"srcSet":b=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(r(137,a));default:kt(i,a,w,z,c,null)}}b&&kt(i,a,"srcSet",c.srcSet,c,null),f&&kt(i,a,"src",c.src,c,null);return;case"input":ct("invalid",i);var Q=w=z=b=null,ne=null,fe=null;for(f in c)if(c.hasOwnProperty(f)){var Se=c[f];if(Se!=null)switch(f){case"name":b=Se;break;case"type":z=Se;break;case"checked":ne=Se;break;case"defaultChecked":fe=Se;break;case"value":w=Se;break;case"defaultValue":Q=Se;break;case"children":case"dangerouslySetInnerHTML":if(Se!=null)throw Error(r(137,a));break;default:kt(i,a,f,Se,c,null)}}xd(i,w,Q,ne,fe,z,b,!1);return;case"select":ct("invalid",i),f=z=w=null;for(b in c)if(c.hasOwnProperty(b)&&(Q=c[b],Q!=null))switch(b){case"value":w=Q;break;case"defaultValue":z=Q;break;case"multiple":f=Q;default:kt(i,a,b,Q,c,null)}a=w,c=z,i.multiple=!!f,a!=null?Is(i,!!f,a,!1):c!=null&&Is(i,!!f,c,!0);return;case"textarea":ct("invalid",i),w=b=f=null;for(z in c)if(c.hasOwnProperty(z)&&(Q=c[z],Q!=null))switch(z){case"value":f=Q;break;case"defaultValue":b=Q;break;case"children":w=Q;break;case"dangerouslySetInnerHTML":if(Q!=null)throw Error(r(91));break;default:kt(i,a,z,Q,c,null)}Ds(i,f,b,w);return;case"option":for(ne in c)c.hasOwnProperty(ne)&&(f=c[ne],f!=null)&&(ne==="selected"?i.selected=f&&typeof f!="function"&&typeof f!="symbol":kt(i,a,ne,f,c,null));return;case"dialog":ct("beforetoggle",i),ct("toggle",i),ct("cancel",i),ct("close",i);break;case"iframe":case"object":ct("load",i);break;case"video":case"audio":for(f=0;f<ou.length;f++)ct(ou[f],i);break;case"image":ct("error",i),ct("load",i);break;case"details":ct("toggle",i);break;case"embed":case"source":case"link":ct("error",i),ct("load",i);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(fe in c)if(c.hasOwnProperty(fe)&&(f=c[fe],f!=null))switch(fe){case"children":case"dangerouslySetInnerHTML":throw Error(r(137,a));default:kt(i,a,fe,f,c,null)}return;default:if(Fo(a)){for(Se in c)c.hasOwnProperty(Se)&&(f=c[Se],f!==void 0&&ng(i,a,Se,f,c,void 0));return}}for(Q in c)c.hasOwnProperty(Q)&&(f=c[Q],f!=null&&kt(i,a,Q,f,c,null))}function x5(i,a,c,f){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var b=null,w=null,z=null,Q=null,ne=null,fe=null,Se=null;for(ve in c){var Re=c[ve];if(c.hasOwnProperty(ve)&&Re!=null)switch(ve){case"checked":break;case"value":break;case"defaultValue":ne=Re;default:f.hasOwnProperty(ve)||kt(i,a,ve,null,f,Re)}}for(var ge in f){var ve=f[ge];if(Re=c[ge],f.hasOwnProperty(ge)&&(ve!=null||Re!=null))switch(ge){case"type":w=ve;break;case"name":b=ve;break;case"checked":fe=ve;break;case"defaultChecked":Se=ve;break;case"value":z=ve;break;case"defaultValue":Q=ve;break;case"children":case"dangerouslySetInnerHTML":if(ve!=null)throw Error(r(137,a));break;default:ve!==Re&&kt(i,a,ge,ve,f,Re)}}Uo(i,z,Q,ne,fe,Se,w,b);return;case"select":ve=z=Q=ge=null;for(w in c)if(ne=c[w],c.hasOwnProperty(w)&&ne!=null)switch(w){case"value":break;case"multiple":ve=ne;default:f.hasOwnProperty(w)||kt(i,a,w,null,f,ne)}for(b in f)if(w=f[b],ne=c[b],f.hasOwnProperty(b)&&(w!=null||ne!=null))switch(b){case"value":ge=w;break;case"defaultValue":Q=w;break;case"multiple":z=w;default:w!==ne&&kt(i,a,b,w,f,ne)}a=Q,c=z,f=ve,ge!=null?Is(i,!!c,ge,!1):!!f!=!!c&&(a!=null?Is(i,!!c,a,!0):Is(i,!!c,c?[]:"",!1));return;case"textarea":ve=ge=null;for(Q in c)if(b=c[Q],c.hasOwnProperty(Q)&&b!=null&&!f.hasOwnProperty(Q))switch(Q){case"value":break;case"children":break;default:kt(i,a,Q,null,f,b)}for(z in f)if(b=f[z],w=c[z],f.hasOwnProperty(z)&&(b!=null||w!=null))switch(z){case"value":ge=b;break;case"defaultValue":ve=b;break;case"children":break;case"dangerouslySetInnerHTML":if(b!=null)throw Error(r(91));break;default:b!==w&&kt(i,a,z,b,f,w)}wd(i,ge,ve);return;case"option":for(var Fe in c)ge=c[Fe],c.hasOwnProperty(Fe)&&ge!=null&&!f.hasOwnProperty(Fe)&&(Fe==="selected"?i.selected=!1:kt(i,a,Fe,null,f,ge));for(ne in f)ge=f[ne],ve=c[ne],f.hasOwnProperty(ne)&&ge!==ve&&(ge!=null||ve!=null)&&(ne==="selected"?i.selected=ge&&typeof ge!="function"&&typeof ge!="symbol":kt(i,a,ne,ge,f,ve));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Ke in c)ge=c[Ke],c.hasOwnProperty(Ke)&&ge!=null&&!f.hasOwnProperty(Ke)&&kt(i,a,Ke,null,f,ge);for(fe in f)if(ge=f[fe],ve=c[fe],f.hasOwnProperty(fe)&&ge!==ve&&(ge!=null||ve!=null))switch(fe){case"children":case"dangerouslySetInnerHTML":if(ge!=null)throw Error(r(137,a));break;default:kt(i,a,fe,ge,f,ve)}return;default:if(Fo(a)){for(var Ot in c)ge=c[Ot],c.hasOwnProperty(Ot)&&ge!==void 0&&!f.hasOwnProperty(Ot)&&ng(i,a,Ot,void 0,f,ge);for(Se in f)ge=f[Se],ve=c[Se],!f.hasOwnProperty(Se)||ge===ve||ge===void 0&&ve===void 0||ng(i,a,Se,ge,f,ve);return}}for(var ue in c)ge=c[ue],c.hasOwnProperty(ue)&&ge!=null&&!f.hasOwnProperty(ue)&&kt(i,a,ue,null,f,ge);for(Re in f)ge=f[Re],ve=c[Re],!f.hasOwnProperty(Re)||ge===ve||ge==null&&ve==null||kt(i,a,Re,ge,f,ve)}function Vv(i){switch(i){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function w5(){if(typeof performance.getEntriesByType=="function"){for(var i=0,a=0,c=performance.getEntriesByType("resource"),f=0;f<c.length;f++){var b=c[f],w=b.transferSize,z=b.initiatorType,Q=b.duration;if(w&&Q&&Vv(z)){for(z=0,Q=b.responseEnd,f+=1;f<c.length;f++){var ne=c[f],fe=ne.startTime;if(fe>Q)break;var Se=ne.transferSize,Re=ne.initiatorType;Se&&Vv(Re)&&(ne=ne.responseEnd,z+=Se*(ne<Q?1:(Q-fe)/(ne-fe)))}if(--f,a+=8*(w+z)/(b.duration/1e3),i++,10<i)break}}if(0<i)return a/i/1e6}return navigator.connection&&(i=navigator.connection.downlink,typeof i=="number")?i:5}var rg=null,ig=null;function Ch(i){return i.nodeType===9?i:i.ownerDocument}function $v(i){switch(i){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Hv(i,a){if(i===0)switch(a){case"svg":return 1;case"math":return 2;default:return 0}return i===1&&a==="foreignObject"?0:i}function sg(i,a){return i==="textarea"||i==="noscript"||typeof a.children=="string"||typeof a.children=="number"||typeof a.children=="bigint"||typeof a.dangerouslySetInnerHTML=="object"&&a.dangerouslySetInnerHTML!==null&&a.dangerouslySetInnerHTML.__html!=null}var ag=null;function S5(){var i=window.event;return i&&i.type==="popstate"?i===ag?!1:(ag=i,!0):(ag=null,!1)}var qv=typeof setTimeout=="function"?setTimeout:void 0,E5=typeof clearTimeout=="function"?clearTimeout:void 0,Gv=typeof Promise=="function"?Promise:void 0,C5=typeof queueMicrotask=="function"?queueMicrotask:typeof Gv<"u"?function(i){return Gv.resolve(null).then(i).catch(T5)}:qv;function T5(i){setTimeout(function(){throw i})}function ea(i){return i==="head"}function Wv(i,a){var c=a,f=0;do{var b=c.nextSibling;if(i.removeChild(c),b&&b.nodeType===8)if(c=b.data,c==="/$"||c==="/&"){if(f===0){i.removeChild(b),wl(a);return}f--}else if(c==="$"||c==="$?"||c==="$~"||c==="$!"||c==="&")f++;else if(c==="html")cu(i.ownerDocument.documentElement);else if(c==="head"){c=i.ownerDocument.head,cu(c);for(var w=c.firstChild;w;){var z=w.nextSibling,Q=w.nodeName;w[gi]||Q==="SCRIPT"||Q==="STYLE"||Q==="LINK"&&w.rel.toLowerCase()==="stylesheet"||c.removeChild(w),w=z}}else c==="body"&&cu(i.ownerDocument.body);c=b}while(c);wl(a)}function Qv(i,a){var c=i;i=0;do{var f=c.nextSibling;if(c.nodeType===1?a?(c._stashedDisplay=c.style.display,c.style.display="none"):(c.style.display=c._stashedDisplay||"",c.getAttribute("style")===""&&c.removeAttribute("style")):c.nodeType===3&&(a?(c._stashedText=c.nodeValue,c.nodeValue=""):c.nodeValue=c._stashedText||""),f&&f.nodeType===8)if(c=f.data,c==="/$"){if(i===0)break;i--}else c!=="$"&&c!=="$?"&&c!=="$~"&&c!=="$!"||i++;c=f}while(c)}function og(i){var a=i.firstChild;for(a&&a.nodeType===10&&(a=a.nextSibling);a;){var c=a;switch(a=a.nextSibling,c.nodeName){case"HTML":case"HEAD":case"BODY":og(c),Bo(c);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(c.rel.toLowerCase()==="stylesheet")continue}i.removeChild(c)}}function A5(i,a,c,f){for(;i.nodeType===1;){var b=c;if(i.nodeName.toLowerCase()!==a.toLowerCase()){if(!f&&(i.nodeName!=="INPUT"||i.type!=="hidden"))break}else if(f){if(!i[gi])switch(a){case"meta":if(!i.hasAttribute("itemprop"))break;return i;case"link":if(w=i.getAttribute("rel"),w==="stylesheet"&&i.hasAttribute("data-precedence"))break;if(w!==b.rel||i.getAttribute("href")!==(b.href==null||b.href===""?null:b.href)||i.getAttribute("crossorigin")!==(b.crossOrigin==null?null:b.crossOrigin)||i.getAttribute("title")!==(b.title==null?null:b.title))break;return i;case"style":if(i.hasAttribute("data-precedence"))break;return i;case"script":if(w=i.getAttribute("src"),(w!==(b.src==null?null:b.src)||i.getAttribute("type")!==(b.type==null?null:b.type)||i.getAttribute("crossorigin")!==(b.crossOrigin==null?null:b.crossOrigin))&&w&&i.hasAttribute("async")&&!i.hasAttribute("itemprop"))break;return i;default:return i}}else if(a==="input"&&i.type==="hidden"){var w=b.name==null?null:""+b.name;if(b.type==="hidden"&&i.getAttribute("name")===w)return i}else return i;if(i=zr(i.nextSibling),i===null)break}return null}function j5(i,a,c){if(a==="")return null;for(;i.nodeType!==3;)if((i.nodeType!==1||i.nodeName!=="INPUT"||i.type!=="hidden")&&!c||(i=zr(i.nextSibling),i===null))return null;return i}function Kv(i,a){for(;i.nodeType!==8;)if((i.nodeType!==1||i.nodeName!=="INPUT"||i.type!=="hidden")&&!a||(i=zr(i.nextSibling),i===null))return null;return i}function lg(i){return i.data==="$?"||i.data==="$~"}function cg(i){return i.data==="$!"||i.data==="$?"&&i.ownerDocument.readyState!=="loading"}function R5(i,a){var c=i.ownerDocument;if(i.data==="$~")i._reactRetry=a;else if(i.data!=="$?"||c.readyState!=="loading")a();else{var f=function(){a(),c.removeEventListener("DOMContentLoaded",f)};c.addEventListener("DOMContentLoaded",f),i._reactRetry=f}}function zr(i){for(;i!=null;i=i.nextSibling){var a=i.nodeType;if(a===1||a===3)break;if(a===8){if(a=i.data,a==="$"||a==="$!"||a==="$?"||a==="$~"||a==="&"||a==="F!"||a==="F")break;if(a==="/$"||a==="/&")return null}}return i}var ug=null;function Yv(i){i=i.nextSibling;for(var a=0;i;){if(i.nodeType===8){var c=i.data;if(c==="/$"||c==="/&"){if(a===0)return zr(i.nextSibling);a--}else c!=="$"&&c!=="$!"&&c!=="$?"&&c!=="$~"&&c!=="&"||a++}i=i.nextSibling}return null}function Xv(i){i=i.previousSibling;for(var a=0;i;){if(i.nodeType===8){var c=i.data;if(c==="$"||c==="$!"||c==="$?"||c==="$~"||c==="&"){if(a===0)return i;a--}else c!=="/$"&&c!=="/&"||a++}i=i.previousSibling}return null}function Zv(i,a,c){switch(a=Ch(c),i){case"html":if(i=a.documentElement,!i)throw Error(r(452));return i;case"head":if(i=a.head,!i)throw Error(r(453));return i;case"body":if(i=a.body,!i)throw Error(r(454));return i;default:throw Error(r(451))}}function cu(i){for(var a=i.attributes;a.length;)i.removeAttributeNode(a[0]);Bo(i)}var Br=new Map,Jv=new Set;function Th(i){return typeof i.getRootNode=="function"?i.getRootNode():i.nodeType===9?i:i.ownerDocument}var ds=q.d;q.d={f:I5,r:D5,D:k5,C:O5,L:M5,m:N5,X:z5,S:P5,M:B5};function I5(){var i=ds.f(),a=yh();return i||a}function D5(i){var a=Ar(i);a!==null&&a.tag===5&&a.type==="form"?gb(a):ds.r(i)}var bl=typeof document>"u"?null:document;function ex(i,a,c){var f=bl;if(f&&typeof a=="string"&&a){var b=rr(a);b='link[rel="'+i+'"][href="'+b+'"]',typeof c=="string"&&(b+='[crossorigin="'+c+'"]'),Jv.has(b)||(Jv.add(b),i={rel:i,crossOrigin:c,href:a},f.querySelector(b)===null&&(a=f.createElement("link"),Pn(a,"link",i),un(a),f.head.appendChild(a)))}}function k5(i){ds.D(i),ex("dns-prefetch",i,null)}function O5(i,a){ds.C(i,a),ex("preconnect",i,a)}function M5(i,a,c){ds.L(i,a,c);var f=bl;if(f&&i&&a){var b='link[rel="preload"][as="'+rr(a)+'"]';a==="image"&&c&&c.imageSrcSet?(b+='[imagesrcset="'+rr(c.imageSrcSet)+'"]',typeof c.imageSizes=="string"&&(b+='[imagesizes="'+rr(c.imageSizes)+'"]')):b+='[href="'+rr(i)+'"]';var w=b;switch(a){case"style":w=vl(i);break;case"script":w=xl(i)}Br.has(w)||(i=g({rel:"preload",href:a==="image"&&c&&c.imageSrcSet?void 0:i,as:a},c),Br.set(w,i),f.querySelector(b)!==null||a==="style"&&f.querySelector(uu(w))||a==="script"&&f.querySelector(du(w))||(a=f.createElement("link"),Pn(a,"link",i),un(a),f.head.appendChild(a)))}}function N5(i,a){ds.m(i,a);var c=bl;if(c&&i){var f=a&&typeof a.as=="string"?a.as:"script",b='link[rel="modulepreload"][as="'+rr(f)+'"][href="'+rr(i)+'"]',w=b;switch(f){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":w=xl(i)}if(!Br.has(w)&&(i=g({rel:"modulepreload",href:i},a),Br.set(w,i),c.querySelector(b)===null)){switch(f){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(c.querySelector(du(w)))return}f=c.createElement("link"),Pn(f,"link",i),un(f),c.head.appendChild(f)}}}function P5(i,a,c){ds.S(i,a,c);var f=bl;if(f&&i){var b=_i(f).hoistableStyles,w=vl(i);a=a||"default";var z=b.get(w);if(!z){var Q={loading:0,preload:null};if(z=f.querySelector(uu(w)))Q.loading=5;else{i=g({rel:"stylesheet",href:i,"data-precedence":a},c),(c=Br.get(w))&&dg(i,c);var ne=z=f.createElement("link");un(ne),Pn(ne,"link",i),ne._p=new Promise(function(fe,Se){ne.onload=fe,ne.onerror=Se}),ne.addEventListener("load",function(){Q.loading|=1}),ne.addEventListener("error",function(){Q.loading|=2}),Q.loading|=4,Ah(z,a,f)}z={type:"stylesheet",instance:z,count:1,state:Q},b.set(w,z)}}}function z5(i,a){ds.X(i,a);var c=bl;if(c&&i){var f=_i(c).hoistableScripts,b=xl(i),w=f.get(b);w||(w=c.querySelector(du(b)),w||(i=g({src:i,async:!0},a),(a=Br.get(b))&&hg(i,a),w=c.createElement("script"),un(w),Pn(w,"link",i),c.head.appendChild(w)),w={type:"script",instance:w,count:1,state:null},f.set(b,w))}}function B5(i,a){ds.M(i,a);var c=bl;if(c&&i){var f=_i(c).hoistableScripts,b=xl(i),w=f.get(b);w||(w=c.querySelector(du(b)),w||(i=g({src:i,async:!0,type:"module"},a),(a=Br.get(b))&&hg(i,a),w=c.createElement("script"),un(w),Pn(w,"link",i),c.head.appendChild(w)),w={type:"script",instance:w,count:1,state:null},f.set(b,w))}}function tx(i,a,c,f){var b=(b=ye.current)?Th(b):null;if(!b)throw Error(r(446));switch(i){case"meta":case"title":return null;case"style":return typeof c.precedence=="string"&&typeof c.href=="string"?(a=vl(c.href),c=_i(b).hoistableStyles,f=c.get(a),f||(f={type:"style",instance:null,count:0,state:null},c.set(a,f)),f):{type:"void",instance:null,count:0,state:null};case"link":if(c.rel==="stylesheet"&&typeof c.href=="string"&&typeof c.precedence=="string"){i=vl(c.href);var w=_i(b).hoistableStyles,z=w.get(i);if(z||(b=b.ownerDocument||b,z={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},w.set(i,z),(w=b.querySelector(uu(i)))&&!w._p&&(z.instance=w,z.state.loading=5),Br.has(i)||(c={rel:"preload",as:"style",href:c.href,crossOrigin:c.crossOrigin,integrity:c.integrity,media:c.media,hrefLang:c.hrefLang,referrerPolicy:c.referrerPolicy},Br.set(i,c),w||L5(b,i,c,z.state))),a&&f===null)throw Error(r(528,""));return z}if(a&&f!==null)throw Error(r(529,""));return null;case"script":return a=c.async,c=c.src,typeof c=="string"&&a&&typeof a!="function"&&typeof a!="symbol"?(a=xl(c),c=_i(b).hoistableScripts,f=c.get(a),f||(f={type:"script",instance:null,count:0,state:null},c.set(a,f)),f):{type:"void",instance:null,count:0,state:null};default:throw Error(r(444,i))}}function vl(i){return'href="'+rr(i)+'"'}function uu(i){return'link[rel="stylesheet"]['+i+"]"}function nx(i){return g({},i,{"data-precedence":i.precedence,precedence:null})}function L5(i,a,c,f){i.querySelector('link[rel="preload"][as="style"]['+a+"]")?f.loading=1:(a=i.createElement("link"),f.preload=a,a.addEventListener("load",function(){return f.loading|=1}),a.addEventListener("error",function(){return f.loading|=2}),Pn(a,"link",c),un(a),i.head.appendChild(a))}function xl(i){return'[src="'+rr(i)+'"]'}function du(i){return"script[async]"+i}function rx(i,a,c){if(a.count++,a.instance===null)switch(a.type){case"style":var f=i.querySelector('style[data-href~="'+rr(c.href)+'"]');if(f)return a.instance=f,un(f),f;var b=g({},c,{"data-href":c.href,"data-precedence":c.precedence,href:null,precedence:null});return f=(i.ownerDocument||i).createElement("style"),un(f),Pn(f,"style",b),Ah(f,c.precedence,i),a.instance=f;case"stylesheet":b=vl(c.href);var w=i.querySelector(uu(b));if(w)return a.state.loading|=4,a.instance=w,un(w),w;f=nx(c),(b=Br.get(b))&&dg(f,b),w=(i.ownerDocument||i).createElement("link"),un(w);var z=w;return z._p=new Promise(function(Q,ne){z.onload=Q,z.onerror=ne}),Pn(w,"link",f),a.state.loading|=4,Ah(w,c.precedence,i),a.instance=w;case"script":return w=xl(c.src),(b=i.querySelector(du(w)))?(a.instance=b,un(b),b):(f=c,(b=Br.get(w))&&(f=g({},c),hg(f,b)),i=i.ownerDocument||i,b=i.createElement("script"),un(b),Pn(b,"link",f),i.head.appendChild(b),a.instance=b);case"void":return null;default:throw Error(r(443,a.type))}else a.type==="stylesheet"&&(a.state.loading&4)===0&&(f=a.instance,a.state.loading|=4,Ah(f,c.precedence,i));return a.instance}function Ah(i,a,c){for(var f=c.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),b=f.length?f[f.length-1]:null,w=b,z=0;z<f.length;z++){var Q=f[z];if(Q.dataset.precedence===a)w=Q;else if(w!==b)break}w?w.parentNode.insertBefore(i,w.nextSibling):(a=c.nodeType===9?c.head:c,a.insertBefore(i,a.firstChild))}function dg(i,a){i.crossOrigin==null&&(i.crossOrigin=a.crossOrigin),i.referrerPolicy==null&&(i.referrerPolicy=a.referrerPolicy),i.title==null&&(i.title=a.title)}function hg(i,a){i.crossOrigin==null&&(i.crossOrigin=a.crossOrigin),i.referrerPolicy==null&&(i.referrerPolicy=a.referrerPolicy),i.integrity==null&&(i.integrity=a.integrity)}var jh=null;function ix(i,a,c){if(jh===null){var f=new Map,b=jh=new Map;b.set(c,f)}else b=jh,f=b.get(c),f||(f=new Map,b.set(c,f));if(f.has(i))return f;for(f.set(i,null),c=c.getElementsByTagName(i),b=0;b<c.length;b++){var w=c[b];if(!(w[gi]||w[cn]||i==="link"&&w.getAttribute("rel")==="stylesheet")&&w.namespaceURI!=="http://www.w3.org/2000/svg"){var z=w.getAttribute(a)||"";z=i+z;var Q=f.get(z);Q?Q.push(w):f.set(z,[w])}}return f}function sx(i,a,c){i=i.ownerDocument||i,i.head.insertBefore(c,a==="title"?i.querySelector("head > title"):null)}function U5(i,a,c){if(c===1||a.itemProp!=null)return!1;switch(i){case"meta":case"title":return!0;case"style":if(typeof a.precedence!="string"||typeof a.href!="string"||a.href==="")break;return!0;case"link":if(typeof a.rel!="string"||typeof a.href!="string"||a.href===""||a.onLoad||a.onError)break;return a.rel==="stylesheet"?(i=a.disabled,typeof a.precedence=="string"&&i==null):!0;case"script":if(a.async&&typeof a.async!="function"&&typeof a.async!="symbol"&&!a.onLoad&&!a.onError&&a.src&&typeof a.src=="string")return!0}return!1}function ax(i){return!(i.type==="stylesheet"&&(i.state.loading&3)===0)}function F5(i,a,c,f){if(c.type==="stylesheet"&&(typeof f.media!="string"||matchMedia(f.media).matches!==!1)&&(c.state.loading&4)===0){if(c.instance===null){var b=vl(f.href),w=a.querySelector(uu(b));if(w){a=w._p,a!==null&&typeof a=="object"&&typeof a.then=="function"&&(i.count++,i=Rh.bind(i),a.then(i,i)),c.state.loading|=4,c.instance=w,un(w);return}w=a.ownerDocument||a,f=nx(f),(b=Br.get(b))&&dg(f,b),w=w.createElement("link"),un(w);var z=w;z._p=new Promise(function(Q,ne){z.onload=Q,z.onerror=ne}),Pn(w,"link",f),c.instance=w}i.stylesheets===null&&(i.stylesheets=new Map),i.stylesheets.set(c,a),(a=c.state.preload)&&(c.state.loading&3)===0&&(i.count++,c=Rh.bind(i),a.addEventListener("load",c),a.addEventListener("error",c))}}var fg=0;function V5(i,a){return i.stylesheets&&i.count===0&&Dh(i,i.stylesheets),0<i.count||0<i.imgCount?function(c){var f=setTimeout(function(){if(i.stylesheets&&Dh(i,i.stylesheets),i.unsuspend){var w=i.unsuspend;i.unsuspend=null,w()}},6e4+a);0<i.imgBytes&&fg===0&&(fg=62500*w5());var b=setTimeout(function(){if(i.waitingForImages=!1,i.count===0&&(i.stylesheets&&Dh(i,i.stylesheets),i.unsuspend)){var w=i.unsuspend;i.unsuspend=null,w()}},(i.imgBytes>fg?50:800)+a);return i.unsuspend=c,function(){i.unsuspend=null,clearTimeout(f),clearTimeout(b)}}:null}function Rh(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)Dh(this,this.stylesheets);else if(this.unsuspend){var i=this.unsuspend;this.unsuspend=null,i()}}}var Ih=null;function Dh(i,a){i.stylesheets=null,i.unsuspend!==null&&(i.count++,Ih=new Map,a.forEach($5,i),Ih=null,Rh.call(i))}function $5(i,a){if(!(a.state.loading&4)){var c=Ih.get(i);if(c)var f=c.get(null);else{c=new Map,Ih.set(i,c);for(var b=i.querySelectorAll("link[data-precedence],style[data-precedence]"),w=0;w<b.length;w++){var z=b[w];(z.nodeName==="LINK"||z.getAttribute("media")!=="not all")&&(c.set(z.dataset.precedence,z),f=z)}f&&c.set(null,f)}b=a.instance,z=b.getAttribute("data-precedence"),w=c.get(z)||f,w===f&&c.set(null,b),c.set(z,b),this.count++,f=Rh.bind(this),b.addEventListener("load",f),b.addEventListener("error",f),w?w.parentNode.insertBefore(b,w.nextSibling):(i=i.nodeType===9?i.head:i,i.insertBefore(b,i.firstChild)),a.state.loading|=4}}var hu={$$typeof:A,Provider:null,Consumer:null,_currentValue:J,_currentValue2:J,_threadCount:0};function H5(i,a,c,f,b,w,z,Q,ne){this.tag=1,this.containerInfo=i,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=mi(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=mi(0),this.hiddenUpdates=mi(null),this.identifierPrefix=f,this.onUncaughtError=b,this.onCaughtError=w,this.onRecoverableError=z,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=ne,this.incompleteTransitions=new Map}function ox(i,a,c,f,b,w,z,Q,ne,fe,Se,Re){return i=new H5(i,a,c,z,ne,fe,Se,Re,Q),a=1,w===!0&&(a|=24),w=yr(3,null,null,a),i.current=w,w.stateNode=i,a=Gm(),a.refCount++,i.pooledCache=a,a.refCount++,w.memoizedState={element:f,isDehydrated:c,cache:a},Ym(w),i}function lx(i){return i?(i=Zo,i):Zo}function cx(i,a,c,f,b,w){b=lx(b),f.context===null?f.context=b:f.pendingContext=b,f=$s(a),f.payload={element:c},w=w===void 0?null:w,w!==null&&(f.callback=w),c=Hs(i,f,a),c!==null&&(cr(c,i,a),Hc(c,i,a))}function ux(i,a){if(i=i.memoizedState,i!==null&&i.dehydrated!==null){var c=i.retryLane;i.retryLane=c!==0&&c<a?c:a}}function mg(i,a){ux(i,a),(i=i.alternate)&&ux(i,a)}function dx(i){if(i.tag===13||i.tag===31){var a=Za(i,67108864);a!==null&&cr(a,i,67108864),mg(i,67108864)}}function hx(i){if(i.tag===13||i.tag===31){var a=wr();a=Ua(a);var c=Za(i,a);c!==null&&cr(c,i,a),mg(i,a)}}var kh=!0;function q5(i,a,c,f){var b=W.T;W.T=null;var w=q.p;try{q.p=2,pg(i,a,c,f)}finally{q.p=w,W.T=b}}function G5(i,a,c,f){var b=W.T;W.T=null;var w=q.p;try{q.p=8,pg(i,a,c,f)}finally{q.p=w,W.T=b}}function pg(i,a,c,f){if(kh){var b=gg(f);if(b===null)tg(i,a,f,Oh,c),mx(i,f);else if(Q5(b,i,a,c,f))f.stopPropagation();else if(mx(i,f),a&4&&-1<W5.indexOf(i)){for(;b!==null;){var w=Ar(b);if(w!==null)switch(w.tag){case 3:if(w=w.stateNode,w.current.memoizedState.isDehydrated){var z=Zn(w.pendingLanes);if(z!==0){var Q=w;for(Q.pendingLanes|=2,Q.entangledLanes|=2;z;){var ne=1<<31-St(z);Q.entanglements[1]|=ne,z&=~ne}Di(w),(Ct&6)===0&&(ph=Ne()+500,au(0))}}break;case 31:case 13:Q=Za(w,2),Q!==null&&cr(Q,w,2),yh(),mg(w,2)}if(w=gg(f),w===null&&tg(i,a,f,Oh,c),w===b)break;b=w}b!==null&&f.stopPropagation()}else tg(i,a,f,null,c)}}function gg(i){return i=jr(i),yg(i)}var Oh=null;function yg(i){if(Oh=null,i=yi(i),i!==null){var a=o(i);if(a===null)i=null;else{var c=a.tag;if(c===13){if(i=l(a),i!==null)return i;i=null}else if(c===31){if(i=d(a),i!==null)return i;i=null}else if(c===3){if(a.stateNode.current.memoizedState.isDehydrated)return a.tag===3?a.stateNode.containerInfo:null;i=null}else a!==i&&(i=null)}}return Oh=i,null}function fx(i){switch(i){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(ke()){case qe:return 2;case vt:return 8;case rt:case Hn:return 32;case ui:return 268435456;default:return 32}default:return 32}}var _g=!1,ta=null,na=null,ra=null,fu=new Map,mu=new Map,ia=[],W5="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function mx(i,a){switch(i){case"focusin":case"focusout":ta=null;break;case"dragenter":case"dragleave":na=null;break;case"mouseover":case"mouseout":ra=null;break;case"pointerover":case"pointerout":fu.delete(a.pointerId);break;case"gotpointercapture":case"lostpointercapture":mu.delete(a.pointerId)}}function pu(i,a,c,f,b,w){return i===null||i.nativeEvent!==w?(i={blockedOn:a,domEventName:c,eventSystemFlags:f,nativeEvent:w,targetContainers:[b]},a!==null&&(a=Ar(a),a!==null&&dx(a)),i):(i.eventSystemFlags|=f,a=i.targetContainers,b!==null&&a.indexOf(b)===-1&&a.push(b),i)}function Q5(i,a,c,f,b){switch(a){case"focusin":return ta=pu(ta,i,a,c,f,b),!0;case"dragenter":return na=pu(na,i,a,c,f,b),!0;case"mouseover":return ra=pu(ra,i,a,c,f,b),!0;case"pointerover":var w=b.pointerId;return fu.set(w,pu(fu.get(w)||null,i,a,c,f,b)),!0;case"gotpointercapture":return w=b.pointerId,mu.set(w,pu(mu.get(w)||null,i,a,c,f,b)),!0}return!1}function px(i){var a=yi(i.target);if(a!==null){var c=o(a);if(c!==null){if(a=c.tag,a===13){if(a=l(c),a!==null){i.blockedOn=a,qr(i.priority,function(){hx(c)});return}}else if(a===31){if(a=d(c),a!==null){i.blockedOn=a,qr(i.priority,function(){hx(c)});return}}else if(a===3&&c.stateNode.current.memoizedState.isDehydrated){i.blockedOn=c.tag===3?c.stateNode.containerInfo:null;return}}}i.blockedOn=null}function Mh(i){if(i.blockedOn!==null)return!1;for(var a=i.targetContainers;0<a.length;){var c=gg(i.nativeEvent);if(c===null){c=i.nativeEvent;var f=new c.constructor(c.type,c);jc=f,c.target.dispatchEvent(f),jc=null}else return a=Ar(c),a!==null&&dx(a),i.blockedOn=c,!1;a.shift()}return!0}function gx(i,a,c){Mh(i)&&c.delete(a)}function K5(){_g=!1,ta!==null&&Mh(ta)&&(ta=null),na!==null&&Mh(na)&&(na=null),ra!==null&&Mh(ra)&&(ra=null),fu.forEach(gx),mu.forEach(gx)}function Nh(i,a){i.blockedOn===a&&(i.blockedOn=null,_g||(_g=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,K5)))}var Ph=null;function yx(i){Ph!==i&&(Ph=i,t.unstable_scheduleCallback(t.unstable_NormalPriority,function(){Ph===i&&(Ph=null);for(var a=0;a<i.length;a+=3){var c=i[a],f=i[a+1],b=i[a+2];if(typeof f!="function"){if(yg(f||c)===null)continue;break}var w=Ar(c);w!==null&&(i.splice(a,3),a-=3,gp(w,{pending:!0,data:b,method:c.method,action:f},f,b))}}))}function wl(i){function a(ne){return Nh(ne,i)}ta!==null&&Nh(ta,i),na!==null&&Nh(na,i),ra!==null&&Nh(ra,i),fu.forEach(a),mu.forEach(a);for(var c=0;c<ia.length;c++){var f=ia[c];f.blockedOn===i&&(f.blockedOn=null)}for(;0<ia.length&&(c=ia[0],c.blockedOn===null);)px(c),c.blockedOn===null&&ia.shift();if(c=(i.ownerDocument||i).$$reactFormReplay,c!=null)for(f=0;f<c.length;f+=3){var b=c[f],w=c[f+1],z=b[jn]||null;if(typeof w=="function")z||yx(c);else if(z){var Q=null;if(w&&w.hasAttribute("formAction")){if(b=w,z=w[jn]||null)Q=z.formAction;else if(yg(b)!==null)continue}else Q=z.action;typeof Q=="function"?c[f+1]=Q:(c.splice(f,3),f-=3),yx(c)}}}function _x(){function i(w){w.canIntercept&&w.info==="react-transition"&&w.intercept({handler:function(){return new Promise(function(z){return b=z})},focusReset:"manual",scroll:"manual"})}function a(){b!==null&&(b(),b=null),f||setTimeout(c,20)}function c(){if(!f&&!navigation.transition){var w=navigation.currentEntry;w&&w.url!=null&&navigation.navigate(w.url,{state:w.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var f=!1,b=null;return navigation.addEventListener("navigate",i),navigation.addEventListener("navigatesuccess",a),navigation.addEventListener("navigateerror",a),setTimeout(c,100),function(){f=!0,navigation.removeEventListener("navigate",i),navigation.removeEventListener("navigatesuccess",a),navigation.removeEventListener("navigateerror",a),b!==null&&(b(),b=null)}}}function bg(i){this._internalRoot=i}zh.prototype.render=bg.prototype.render=function(i){var a=this._internalRoot;if(a===null)throw Error(r(409));var c=a.current,f=wr();cx(c,f,i,a,null,null)},zh.prototype.unmount=bg.prototype.unmount=function(){var i=this._internalRoot;if(i!==null){this._internalRoot=null;var a=i.containerInfo;cx(i.current,2,null,i,null,null),yh(),a[pi]=null}};function zh(i){this._internalRoot=i}zh.prototype.unstable_scheduleHydration=function(i){if(i){var a=yd();i={blockedOn:null,target:i,priority:a};for(var c=0;c<ia.length&&a!==0&&a<ia[c].priority;c++);ia.splice(c,0,i),c===0&&px(i)}};var bx=e.version;if(bx!=="19.2.3")throw Error(r(527,bx,"19.2.3"));q.findDOMNode=function(i){var a=i._reactInternals;if(a===void 0)throw typeof i.render=="function"?Error(r(188)):(i=Object.keys(i).join(","),Error(r(268,i)));return i=m(a),i=i!==null?p(i):null,i=i===null?null:i.stateNode,i};var Y5={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:W,reconcilerVersion:"19.2.3"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Bh=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Bh.isDisabled&&Bh.supportsFiber)try{_t=Bh.inject(Y5),Zt=Bh}catch{}}return yu.createRoot=function(i,a){if(!s(i))throw Error(r(299));var c=!1,f="",b=Tb,w=Ab,z=jb;return a!=null&&(a.unstable_strictMode===!0&&(c=!0),a.identifierPrefix!==void 0&&(f=a.identifierPrefix),a.onUncaughtError!==void 0&&(b=a.onUncaughtError),a.onCaughtError!==void 0&&(w=a.onCaughtError),a.onRecoverableError!==void 0&&(z=a.onRecoverableError)),a=ox(i,1,!1,null,null,c,f,null,b,w,z,_x),i[pi]=a.current,eg(i),new bg(a)},yu.hydrateRoot=function(i,a,c){if(!s(i))throw Error(r(299));var f=!1,b="",w=Tb,z=Ab,Q=jb,ne=null;return c!=null&&(c.unstable_strictMode===!0&&(f=!0),c.identifierPrefix!==void 0&&(b=c.identifierPrefix),c.onUncaughtError!==void 0&&(w=c.onUncaughtError),c.onCaughtError!==void 0&&(z=c.onCaughtError),c.onRecoverableError!==void 0&&(Q=c.onRecoverableError),c.formState!==void 0&&(ne=c.formState)),a=ox(i,1,!0,a,c??null,f,b,ne,w,z,Q,_x),a.context=lx(null),c=a.current,f=wr(),f=Ua(f),b=$s(f),b.callback=null,Hs(c,b,f),c=f,a.current.lanes=c,Ba(a,c),Di(a),i[pi]=a.current,eg(i),new zh(a)},yu.version="19.2.3",yu}var Rx;function o2(){if(Rx)return wg.exports;Rx=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),wg.exports=a2(),wg.exports}var l2=o2();var Ix="popstate";function c2(t={}){function e(r,s){let{pathname:o,search:l,hash:d}=r.location;return Yg("",{pathname:o,search:l,hash:d},s.state&&s.state.usr||null,s.state&&s.state.key||"default")}function n(r,s){return typeof s=="string"?s:Du(s)}return d2(e,n,null,t)}function Kt(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function Er(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function u2(){return Math.random().toString(36).substring(2,10)}function Dx(t,e){return{usr:t.state,key:t.key,idx:e}}function Yg(t,e,n=null,r){return{pathname:typeof t=="string"?t:t.pathname,search:"",hash:"",...typeof e=="string"?Zl(e):e,state:n,key:e&&e.key||r||u2()}}function Du({pathname:t="/",search:e="",hash:n=""}){return e&&e!=="?"&&(t+=e.charAt(0)==="?"?e:"?"+e),n&&n!=="#"&&(t+=n.charAt(0)==="#"?n:"#"+n),t}function Zl(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substring(n),t=t.substring(0,n));let r=t.indexOf("?");r>=0&&(e.search=t.substring(r),t=t.substring(0,r)),t&&(e.pathname=t)}return e}function d2(t,e,n,r={}){let{window:s=document.defaultView,v5Compat:o=!1}=r,l=s.history,d="POP",h=null,m=p();m==null&&(m=0,l.replaceState({...l.state,idx:m},""));function p(){return(l.state||{idx:null}).idx}function g(){d="POP";let E=p(),C=E==null?null:E-m;m=E,h&&h({action:d,location:x.location,delta:C})}function v(E,C){d="PUSH";let T=Yg(x.location,E,C);m=p()+1;let A=Dx(T,m),B=x.createHref(T);try{l.pushState(A,"",B)}catch(U){if(U instanceof DOMException&&U.name==="DataCloneError")throw U;s.location.assign(B)}o&&h&&h({action:d,location:x.location,delta:1})}function _(E,C){d="REPLACE";let T=Yg(x.location,E,C);m=p();let A=Dx(T,m),B=x.createHref(T);l.replaceState(A,"",B),o&&h&&h({action:d,location:x.location,delta:0})}function S(E){return h2(E)}let x={get action(){return d},get location(){return t(s,l)},listen(E){if(h)throw new Error("A history only accepts one active listener");return s.addEventListener(Ix,g),h=E,()=>{s.removeEventListener(Ix,g),h=null}},createHref(E){return e(s,E)},createURL:S,encodeLocation(E){let C=S(E);return{pathname:C.pathname,search:C.search,hash:C.hash}},push:v,replace:_,go(E){return l.go(E)}};return x}function h2(t,e=!1){let n="http://localhost";typeof window<"u"&&(n=window.location.origin!=="null"?window.location.origin:window.location.href),Kt(n,"No window.location.(origin|href) available to create URL");let r=typeof t=="string"?t:Du(t);return r=r.replace(/ $/,"%20"),!e&&r.startsWith("//")&&(r=n+r),new URL(r,n)}function a1(t,e,n="/"){return f2(t,e,n,!1)}function f2(t,e,n,r){let s=typeof e=="string"?Zl(e):e,o=_s(s.pathname||"/",n);if(o==null)return null;let l=o1(t);m2(l);let d=null;for(let h=0;d==null&&h<l.length;++h){let m=C2(o);d=S2(l[h],m,r)}return d}function o1(t,e=[],n=[],r="",s=!1){let o=(l,d,h=s,m)=>{let p={relativePath:m===void 0?l.path||"":m,caseSensitive:l.caseSensitive===!0,childrenIndex:d,route:l};if(p.relativePath.startsWith("/")){if(!p.relativePath.startsWith(r)&&h)return;Kt(p.relativePath.startsWith(r),`Absolute route path "${p.relativePath}" nested under path "${r}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),p.relativePath=p.relativePath.slice(r.length)}let g=gs([r,p.relativePath]),v=n.concat(p);l.children&&l.children.length>0&&(Kt(l.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${g}".`),o1(l.children,e,v,g,h)),!(l.path==null&&!l.index)&&e.push({path:g,score:x2(g,l.index),routesMeta:v})};return t.forEach((l,d)=>{if(l.path===""||!l.path?.includes("?"))o(l,d);else for(let h of l1(l.path))o(l,d,!0,h)}),e}function l1(t){let e=t.split("/");if(e.length===0)return[];let[n,...r]=e,s=n.endsWith("?"),o=n.replace(/\?$/,"");if(r.length===0)return s?[o,""]:[o];let l=l1(r.join("/")),d=[];return d.push(...l.map(h=>h===""?o:[o,h].join("/"))),s&&d.push(...l),d.map(h=>t.startsWith("/")&&h===""?"/":h)}function m2(t){t.sort((e,n)=>e.score!==n.score?n.score-e.score:w2(e.routesMeta.map(r=>r.childrenIndex),n.routesMeta.map(r=>r.childrenIndex)))}var p2=/^:[\w-]+$/,g2=3,y2=2,_2=1,b2=10,v2=-2,kx=t=>t==="*";function x2(t,e){let n=t.split("/"),r=n.length;return n.some(kx)&&(r+=v2),e&&(r+=y2),n.filter(s=>!kx(s)).reduce((s,o)=>s+(p2.test(o)?g2:o===""?_2:b2),r)}function w2(t,e){return t.length===e.length&&t.slice(0,-1).every((r,s)=>r===e[s])?t[t.length-1]-e[e.length-1]:0}function S2(t,e,n=!1){let{routesMeta:r}=t,s={},o="/",l=[];for(let d=0;d<r.length;++d){let h=r[d],m=d===r.length-1,p=o==="/"?e:e.slice(o.length)||"/",g=uf({path:h.relativePath,caseSensitive:h.caseSensitive,end:m},p),v=h.route;if(!g&&m&&n&&!r[r.length-1].route.index&&(g=uf({path:h.relativePath,caseSensitive:h.caseSensitive,end:!1},p)),!g)return null;Object.assign(s,g.params),l.push({params:s,pathname:gs([o,g.pathname]),pathnameBase:R2(gs([o,g.pathnameBase])),route:v}),g.pathnameBase!=="/"&&(o=gs([o,g.pathnameBase]))}return l}function uf(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,r]=E2(t.path,t.caseSensitive,t.end),s=e.match(n);if(!s)return null;let o=s[0],l=o.replace(/(.)\/+$/,"$1"),d=s.slice(1);return{params:r.reduce((m,{paramName:p,isOptional:g},v)=>{if(p==="*"){let S=d[v]||"";l=o.slice(0,o.length-S.length).replace(/(.)\/+$/,"$1")}const _=d[v];return g&&!_?m[p]=void 0:m[p]=(_||"").replace(/%2F/g,"/"),m},{}),pathname:o,pathnameBase:l,pattern:t}}function E2(t,e=!1,n=!0){Er(t==="*"||!t.endsWith("*")||t.endsWith("/*"),`Route path "${t}" will be treated as if it were "${t.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${t.replace(/\*$/,"/*")}".`);let r=[],s="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(l,d,h)=>(r.push({paramName:d,isOptional:h!=null}),h?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return t.endsWith("*")?(r.push({paramName:"*"}),s+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?s+="\\/*$":t!==""&&t!=="/"&&(s+="(?:(?=\\/|$))"),[new RegExp(s,e?void 0:"i"),r]}function C2(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return Er(!1,`The URL path "${t}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),t}}function _s(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,r=t.charAt(n);return r&&r!=="/"?null:t.slice(n)||"/"}var c1=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,T2=t=>c1.test(t);function A2(t,e="/"){let{pathname:n,search:r="",hash:s=""}=typeof t=="string"?Zl(t):t,o;if(n)if(T2(n))o=n;else{if(n.includes("//")){let l=n;n=n.replace(/\/\/+/g,"/"),Er(!1,`Pathnames cannot have embedded double slashes - normalizing ${l} -> ${n}`)}n.startsWith("/")?o=Ox(n.substring(1),"/"):o=Ox(n,e)}else o=e;return{pathname:o,search:I2(r),hash:D2(s)}}function Ox(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(s=>{s===".."?n.length>1&&n.pop():s!=="."&&n.push(s)}),n.length>1?n.join("/"):"/"}function Tg(t,e,n,r){return`Cannot include a '${t}' character in a manually specified \`to.${e}\` field [${JSON.stringify(r)}].  Please separate it out to the \`to.${n}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function j2(t){return t.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function zy(t){let e=j2(t);return e.map((n,r)=>r===e.length-1?n.pathname:n.pathnameBase)}function By(t,e,n,r=!1){let s;typeof t=="string"?s=Zl(t):(s={...t},Kt(!s.pathname||!s.pathname.includes("?"),Tg("?","pathname","search",s)),Kt(!s.pathname||!s.pathname.includes("#"),Tg("#","pathname","hash",s)),Kt(!s.search||!s.search.includes("#"),Tg("#","search","hash",s)));let o=t===""||s.pathname==="",l=o?"/":s.pathname,d;if(l==null)d=n;else{let g=e.length-1;if(!r&&l.startsWith("..")){let v=l.split("/");for(;v[0]==="..";)v.shift(),g-=1;s.pathname=v.join("/")}d=g>=0?e[g]:"/"}let h=A2(s,d),m=l&&l!=="/"&&l.endsWith("/"),p=(o||l===".")&&n.endsWith("/");return!h.pathname.endsWith("/")&&(m||p)&&(h.pathname+="/"),h}var gs=t=>t.join("/").replace(/\/\/+/g,"/"),R2=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),I2=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,D2=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t,k2=class{constructor(t,e,n,r=!1){this.status=t,this.statusText=e||"",this.internal=r,n instanceof Error?(this.data=n.toString(),this.error=n):this.data=n}};function O2(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}function M2(t){return t.map(e=>e.route.path).filter(Boolean).join("/").replace(/\/\/*/g,"/")||"/"}var u1=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function d1(t,e){let n=t;if(typeof n!="string"||!c1.test(n))return{absoluteURL:void 0,isExternal:!1,to:n};let r=n,s=!1;if(u1)try{let o=new URL(window.location.href),l=n.startsWith("//")?new URL(o.protocol+n):new URL(n),d=_s(l.pathname,e);l.origin===o.origin&&d!=null?n=d+l.search+l.hash:s=!0}catch{Er(!1,`<Link to="${n}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}return{absoluteURL:r,isExternal:s,to:n}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var h1=["POST","PUT","PATCH","DELETE"];new Set(h1);var N2=["GET",...h1];new Set(N2);var Jl=O.createContext(null);Jl.displayName="DataRouter";var Ff=O.createContext(null);Ff.displayName="DataRouterState";var P2=O.createContext(!1),f1=O.createContext({isTransitioning:!1});f1.displayName="ViewTransition";var z2=O.createContext(new Map);z2.displayName="Fetchers";var B2=O.createContext(null);B2.displayName="Await";var Cr=O.createContext(null);Cr.displayName="Navigation";var Qu=O.createContext(null);Qu.displayName="Location";var Vr=O.createContext({outlet:null,matches:[],isDataRoute:!1});Vr.displayName="Route";var Ly=O.createContext(null);Ly.displayName="RouteError";var m1="REACT_ROUTER_ERROR",L2="REDIRECT",U2="ROUTE_ERROR_RESPONSE";function F2(t){if(t.startsWith(`${m1}:${L2}:{`))try{let e=JSON.parse(t.slice(28));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.location=="string"&&typeof e.reloadDocument=="boolean"&&typeof e.replace=="boolean")return e}catch{}}function V2(t){if(t.startsWith(`${m1}:${U2}:{`))try{let e=JSON.parse(t.slice(40));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string")return new k2(e.status,e.statusText,e.data)}catch{}}function $2(t,{relative:e}={}){Kt(ec(),"useHref() may be used only in the context of a <Router> component.");let{basename:n,navigator:r}=O.useContext(Cr),{hash:s,pathname:o,search:l}=Yu(t,{relative:e}),d=o;return n!=="/"&&(d=o==="/"?n:gs([n,o])),r.createHref({pathname:d,search:l,hash:s})}function ec(){return O.useContext(Qu)!=null}function Vn(){return Kt(ec(),"useLocation() may be used only in the context of a <Router> component."),O.useContext(Qu).location}var p1="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function g1(t){O.useContext(Cr).static||O.useLayoutEffect(t)}function Ku(){let{isDataRoute:t}=O.useContext(Vr);return t?sj():H2()}function H2(){Kt(ec(),"useNavigate() may be used only in the context of a <Router> component.");let t=O.useContext(Jl),{basename:e,navigator:n}=O.useContext(Cr),{matches:r}=O.useContext(Vr),{pathname:s}=Vn(),o=JSON.stringify(zy(r)),l=O.useRef(!1);return g1(()=>{l.current=!0}),O.useCallback((h,m={})=>{if(Er(l.current,p1),!l.current)return;if(typeof h=="number"){n.go(h);return}let p=By(h,JSON.parse(o),s,m.relative==="path");t==null&&e!=="/"&&(p.pathname=p.pathname==="/"?e:gs([e,p.pathname])),(m.replace?n.replace:n.push)(p,m.state,m)},[e,n,o,s,t])}var q2=O.createContext(null);function G2(t){let e=O.useContext(Vr).outlet;return O.useMemo(()=>e&&O.createElement(q2.Provider,{value:t},e),[e,t])}function W2(){let{matches:t}=O.useContext(Vr),e=t[t.length-1];return e?e.params:{}}function Yu(t,{relative:e}={}){let{matches:n}=O.useContext(Vr),{pathname:r}=Vn(),s=JSON.stringify(zy(n));return O.useMemo(()=>By(t,JSON.parse(s),r,e==="path"),[t,s,r,e])}function Q2(t,e){return y1(t,e)}function y1(t,e,n,r,s){Kt(ec(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:o}=O.useContext(Cr),{matches:l}=O.useContext(Vr),d=l[l.length-1],h=d?d.params:{},m=d?d.pathname:"/",p=d?d.pathnameBase:"/",g=d&&d.route;{let T=g&&g.path||"";b1(m,!g||T.endsWith("*")||T.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${m}" (under <Route path="${T}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${T}"> to <Route path="${T==="/"?"*":`${T}/*`}">.`)}let v=Vn(),_;if(e){let T=typeof e=="string"?Zl(e):e;Kt(p==="/"||T.pathname?.startsWith(p),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${p}" but pathname "${T.pathname}" was given in the \`location\` prop.`),_=T}else _=v;let S=_.pathname||"/",x=S;if(p!=="/"){let T=p.replace(/^\//,"").split("/");x="/"+S.replace(/^\//,"").split("/").slice(T.length).join("/")}let E=a1(t,{pathname:x});Er(g||E!=null,`No routes matched location "${_.pathname}${_.search}${_.hash}" `),Er(E==null||E[E.length-1].route.element!==void 0||E[E.length-1].route.Component!==void 0||E[E.length-1].route.lazy!==void 0,`Matched leaf route at location "${_.pathname}${_.search}${_.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let C=J2(E&&E.map(T=>Object.assign({},T,{params:Object.assign({},h,T.params),pathname:gs([p,o.encodeLocation?o.encodeLocation(T.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:T.pathname]),pathnameBase:T.pathnameBase==="/"?p:gs([p,o.encodeLocation?o.encodeLocation(T.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:T.pathnameBase])})),l,n,r,s);return e&&C?O.createElement(Qu.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",..._},navigationType:"POP"}},C):C}function K2(){let t=ij(),e=O2(t)?`${t.status} ${t.statusText}`:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,r="rgba(200,200,200, 0.5)",s={padding:"0.5rem",backgroundColor:r},o={padding:"2px 4px",backgroundColor:r},l=null;return console.error("Error handled by React Router default ErrorBoundary:",t),l=O.createElement(O.Fragment,null,O.createElement("p",null," Hey developer "),O.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",O.createElement("code",{style:o},"ErrorBoundary")," or"," ",O.createElement("code",{style:o},"errorElement")," prop on your route.")),O.createElement(O.Fragment,null,O.createElement("h2",null,"Unexpected Application Error!"),O.createElement("h3",{style:{fontStyle:"italic"}},e),n?O.createElement("pre",{style:s},n):null,l)}var Y2=O.createElement(K2,null),_1=class extends O.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,e){return e.location!==t.location||e.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:e.error,location:e.location,revalidation:t.revalidation||e.revalidation}}componentDidCatch(t,e){this.props.onError?this.props.onError(t,e):console.error("React Router caught the following error during render",t)}render(){let t=this.state.error;if(this.context&&typeof t=="object"&&t&&"digest"in t&&typeof t.digest=="string"){const n=V2(t.digest);n&&(t=n)}let e=t!==void 0?O.createElement(Vr.Provider,{value:this.props.routeContext},O.createElement(Ly.Provider,{value:t,children:this.props.component})):this.props.children;return this.context?O.createElement(X2,{error:t},e):e}};_1.contextType=P2;var Ag=new WeakMap;function X2({children:t,error:e}){let{basename:n}=O.useContext(Cr);if(typeof e=="object"&&e&&"digest"in e&&typeof e.digest=="string"){let r=F2(e.digest);if(r){let s=Ag.get(e);if(s)throw s;let o=d1(r.location,n);if(u1&&!Ag.get(e))if(o.isExternal||r.reloadDocument)window.location.href=o.absoluteURL||o.to;else{const l=Promise.resolve().then(()=>window.__reactRouterDataRouter.navigate(o.to,{replace:r.replace}));throw Ag.set(e,l),l}return O.createElement("meta",{httpEquiv:"refresh",content:`0;url=${o.absoluteURL||o.to}`})}}return t}function Z2({routeContext:t,match:e,children:n}){let r=O.useContext(Jl);return r&&r.static&&r.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=e.route.id),O.createElement(Vr.Provider,{value:t},n)}function J2(t,e=[],n=null,r=null,s=null){if(t==null){if(!n)return null;if(n.errors)t=n.matches;else if(e.length===0&&!n.initialized&&n.matches.length>0)t=n.matches;else return null}let o=t,l=n?.errors;if(l!=null){let p=o.findIndex(g=>g.route.id&&l?.[g.route.id]!==void 0);Kt(p>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(l).join(",")}`),o=o.slice(0,Math.min(o.length,p+1))}let d=!1,h=-1;if(n)for(let p=0;p<o.length;p++){let g=o[p];if((g.route.HydrateFallback||g.route.hydrateFallbackElement)&&(h=p),g.route.id){let{loaderData:v,errors:_}=n,S=g.route.loader&&!v.hasOwnProperty(g.route.id)&&(!_||_[g.route.id]===void 0);if(g.route.lazy||S){d=!0,h>=0?o=o.slice(0,h+1):o=[o[0]];break}}}let m=n&&r?(p,g)=>{r(p,{location:n.location,params:n.matches?.[0]?.params??{},unstable_pattern:M2(n.matches),errorInfo:g})}:void 0;return o.reduceRight((p,g,v)=>{let _,S=!1,x=null,E=null;n&&(_=l&&g.route.id?l[g.route.id]:void 0,x=g.route.errorElement||Y2,d&&(h<0&&v===0?(b1("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),S=!0,E=null):h===v&&(S=!0,E=g.route.hydrateFallbackElement||null)));let C=e.concat(o.slice(0,v+1)),T=()=>{let A;return _?A=x:S?A=E:g.route.Component?A=O.createElement(g.route.Component,null):g.route.element?A=g.route.element:A=p,O.createElement(Z2,{match:g,routeContext:{outlet:p,matches:C,isDataRoute:n!=null},children:A})};return n&&(g.route.ErrorBoundary||g.route.errorElement||v===0)?O.createElement(_1,{location:n.location,revalidation:n.revalidation,component:x,error:_,children:T(),routeContext:{outlet:null,matches:C,isDataRoute:!0},onError:m}):T()},null)}function Uy(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function ej(t){let e=O.useContext(Jl);return Kt(e,Uy(t)),e}function tj(t){let e=O.useContext(Ff);return Kt(e,Uy(t)),e}function nj(t){let e=O.useContext(Vr);return Kt(e,Uy(t)),e}function Fy(t){let e=nj(t),n=e.matches[e.matches.length-1];return Kt(n.route.id,`${t} can only be used on routes that contain a unique "id"`),n.route.id}function rj(){return Fy("useRouteId")}function ij(){let t=O.useContext(Ly),e=tj("useRouteError"),n=Fy("useRouteError");return t!==void 0?t:e.errors?.[n]}function sj(){let{router:t}=ej("useNavigate"),e=Fy("useNavigate"),n=O.useRef(!1);return g1(()=>{n.current=!0}),O.useCallback(async(s,o={})=>{Er(n.current,p1),n.current&&(typeof s=="number"?await t.navigate(s):await t.navigate(s,{fromRouteId:e,...o}))},[t,e])}var Mx={};function b1(t,e,n){!e&&!Mx[t]&&(Mx[t]=!0,Er(!1,n))}O.memo(aj);function aj({routes:t,future:e,state:n,onError:r}){return y1(t,void 0,n,r,e)}function Vf({to:t,replace:e,state:n,relative:r}){Kt(ec(),"<Navigate> may be used only in the context of a <Router> component.");let{static:s}=O.useContext(Cr);Er(!s,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:o}=O.useContext(Vr),{pathname:l}=Vn(),d=Ku(),h=By(t,zy(o),l,r==="path"),m=JSON.stringify(h);return O.useEffect(()=>{d(JSON.parse(m),{replace:e,state:n,relative:r})},[d,m,r,e,n]),null}function $f(t){return G2(t.context)}function xn(t){Kt(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function oj({basename:t="/",children:e=null,location:n,navigationType:r="POP",navigator:s,static:o=!1,unstable_useTransitions:l}){Kt(!ec(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let d=t.replace(/^\/*/,"/"),h=O.useMemo(()=>({basename:d,navigator:s,static:o,unstable_useTransitions:l,future:{}}),[d,s,o,l]);typeof n=="string"&&(n=Zl(n));let{pathname:m="/",search:p="",hash:g="",state:v=null,key:_="default"}=n,S=O.useMemo(()=>{let x=_s(m,d);return x==null?null:{location:{pathname:x,search:p,hash:g,state:v,key:_},navigationType:r}},[d,m,p,g,v,_,r]);return Er(S!=null,`<Router basename="${d}"> is not able to match the URL "${m}${p}${g}" because it does not start with the basename, so the <Router> won't render anything.`),S==null?null:O.createElement(Cr.Provider,{value:h},O.createElement(Qu.Provider,{children:e,value:S}))}function lj({children:t,location:e}){return Q2(Xg(t),e)}function Xg(t,e=[]){let n=[];return O.Children.forEach(t,(r,s)=>{if(!O.isValidElement(r))return;let o=[...e,s];if(r.type===O.Fragment){n.push.apply(n,Xg(r.props.children,o));return}Kt(r.type===xn,`[${typeof r.type=="string"?r.type:r.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),Kt(!r.props.index||!r.props.children,"An index route cannot have child routes.");let l={id:r.props.id||o.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,middleware:r.props.middleware,loader:r.props.loader,action:r.props.action,hydrateFallbackElement:r.props.hydrateFallbackElement,HydrateFallback:r.props.HydrateFallback,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.hasErrorBoundary===!0||r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(l.children=Xg(r.props.children,o)),n.push(l)}),n}var Yh="get",Xh="application/x-www-form-urlencoded";function Hf(t){return typeof HTMLElement<"u"&&t instanceof HTMLElement}function cj(t){return Hf(t)&&t.tagName.toLowerCase()==="button"}function uj(t){return Hf(t)&&t.tagName.toLowerCase()==="form"}function dj(t){return Hf(t)&&t.tagName.toLowerCase()==="input"}function hj(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function fj(t,e){return t.button===0&&(!e||e==="_self")&&!hj(t)}function Zg(t=""){return new URLSearchParams(typeof t=="string"||Array.isArray(t)||t instanceof URLSearchParams?t:Object.keys(t).reduce((e,n)=>{let r=t[n];return e.concat(Array.isArray(r)?r.map(s=>[n,s]):[[n,r]])},[]))}function mj(t,e){let n=Zg(t);return e&&e.forEach((r,s)=>{n.has(s)||e.getAll(s).forEach(o=>{n.append(s,o)})}),n}var Uh=null;function pj(){if(Uh===null)try{new FormData(document.createElement("form"),0),Uh=!1}catch{Uh=!0}return Uh}var gj=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function jg(t){return t!=null&&!gj.has(t)?(Er(!1,`"${t}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${Xh}"`),null):t}function yj(t,e){let n,r,s,o,l;if(uj(t)){let d=t.getAttribute("action");r=d?_s(d,e):null,n=t.getAttribute("method")||Yh,s=jg(t.getAttribute("enctype"))||Xh,o=new FormData(t)}else if(cj(t)||dj(t)&&(t.type==="submit"||t.type==="image")){let d=t.form;if(d==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let h=t.getAttribute("formaction")||d.getAttribute("action");if(r=h?_s(h,e):null,n=t.getAttribute("formmethod")||d.getAttribute("method")||Yh,s=jg(t.getAttribute("formenctype"))||jg(d.getAttribute("enctype"))||Xh,o=new FormData(d,t),!pj()){let{name:m,type:p,value:g}=t;if(p==="image"){let v=m?`${m}.`:"";o.append(`${v}x`,"0"),o.append(`${v}y`,"0")}else m&&o.append(m,g)}}else{if(Hf(t))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');n=Yh,r=null,s=Xh,l=t}return o&&s==="text/plain"&&(l=o,o=void 0),{action:r,method:n.toLowerCase(),encType:s,formData:o,body:l}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function Vy(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function _j(t,e,n){let r=typeof t=="string"?new URL(t,typeof window>"u"?"server://singlefetch/":window.location.origin):t;return r.pathname==="/"?r.pathname=`_root.${n}`:e&&_s(r.pathname,e)==="/"?r.pathname=`${e.replace(/\/$/,"")}/_root.${n}`:r.pathname=`${r.pathname.replace(/\/$/,"")}.${n}`,r}async function bj(t,e){if(t.id in e)return e[t.id];try{let n=await import(t.module);return e[t.id]=n,n}catch(n){return console.error(`Error loading route module \`${t.module}\`, reloading page...`),console.error(n),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function vj(t){return t==null?!1:t.href==null?t.rel==="preload"&&typeof t.imageSrcSet=="string"&&typeof t.imageSizes=="string":typeof t.rel=="string"&&typeof t.href=="string"}async function xj(t,e,n){let r=await Promise.all(t.map(async s=>{let o=e.routes[s.route.id];if(o){let l=await bj(o,n);return l.links?l.links():[]}return[]}));return Cj(r.flat(1).filter(vj).filter(s=>s.rel==="stylesheet"||s.rel==="preload").map(s=>s.rel==="stylesheet"?{...s,rel:"prefetch",as:"style"}:{...s,rel:"prefetch"}))}function Nx(t,e,n,r,s,o){let l=(h,m)=>n[m]?h.route.id!==n[m].route.id:!0,d=(h,m)=>n[m].pathname!==h.pathname||n[m].route.path?.endsWith("*")&&n[m].params["*"]!==h.params["*"];return o==="assets"?e.filter((h,m)=>l(h,m)||d(h,m)):o==="data"?e.filter((h,m)=>{let p=r.routes[h.route.id];if(!p||!p.hasLoader)return!1;if(l(h,m)||d(h,m))return!0;if(h.route.shouldRevalidate){let g=h.route.shouldRevalidate({currentUrl:new URL(s.pathname+s.search+s.hash,window.origin),currentParams:n[0]?.params||{},nextUrl:new URL(t,window.origin),nextParams:h.params,defaultShouldRevalidate:!0});if(typeof g=="boolean")return g}return!0}):[]}function wj(t,e,{includeHydrateFallback:n}={}){return Sj(t.map(r=>{let s=e.routes[r.route.id];if(!s)return[];let o=[s.module];return s.clientActionModule&&(o=o.concat(s.clientActionModule)),s.clientLoaderModule&&(o=o.concat(s.clientLoaderModule)),n&&s.hydrateFallbackModule&&(o=o.concat(s.hydrateFallbackModule)),s.imports&&(o=o.concat(s.imports)),o}).flat(1))}function Sj(t){return[...new Set(t)]}function Ej(t){let e={},n=Object.keys(t).sort();for(let r of n)e[r]=t[r];return e}function Cj(t,e){let n=new Set;return new Set(e),t.reduce((r,s)=>{let o=JSON.stringify(Ej(s));return n.has(o)||(n.add(o),r.push({key:o,link:s})),r},[])}function v1(){let t=O.useContext(Jl);return Vy(t,"You must render this element inside a <DataRouterContext.Provider> element"),t}function Tj(){let t=O.useContext(Ff);return Vy(t,"You must render this element inside a <DataRouterStateContext.Provider> element"),t}var $y=O.createContext(void 0);$y.displayName="FrameworkContext";function x1(){let t=O.useContext($y);return Vy(t,"You must render this element inside a <HydratedRouter> element"),t}function Aj(t,e){let n=O.useContext($y),[r,s]=O.useState(!1),[o,l]=O.useState(!1),{onFocus:d,onBlur:h,onMouseEnter:m,onMouseLeave:p,onTouchStart:g}=e,v=O.useRef(null);O.useEffect(()=>{if(t==="render"&&l(!0),t==="viewport"){let x=C=>{C.forEach(T=>{l(T.isIntersecting)})},E=new IntersectionObserver(x,{threshold:.5});return v.current&&E.observe(v.current),()=>{E.disconnect()}}},[t]),O.useEffect(()=>{if(r){let x=setTimeout(()=>{l(!0)},100);return()=>{clearTimeout(x)}}},[r]);let _=()=>{s(!0)},S=()=>{s(!1),l(!1)};return n?t!=="intent"?[o,v,{}]:[o,v,{onFocus:_u(d,_),onBlur:_u(h,S),onMouseEnter:_u(m,_),onMouseLeave:_u(p,S),onTouchStart:_u(g,_)}]:[!1,v,{}]}function _u(t,e){return n=>{t&&t(n),n.defaultPrevented||e(n)}}function jj({page:t,...e}){let{router:n}=v1(),r=O.useMemo(()=>a1(n.routes,t,n.basename),[n.routes,t,n.basename]);return r?O.createElement(Ij,{page:t,matches:r,...e}):null}function Rj(t){let{manifest:e,routeModules:n}=x1(),[r,s]=O.useState([]);return O.useEffect(()=>{let o=!1;return xj(t,e,n).then(l=>{o||s(l)}),()=>{o=!0}},[t,e,n]),r}function Ij({page:t,matches:e,...n}){let r=Vn(),{manifest:s,routeModules:o}=x1(),{basename:l}=v1(),{loaderData:d,matches:h}=Tj(),m=O.useMemo(()=>Nx(t,e,h,s,r,"data"),[t,e,h,s,r]),p=O.useMemo(()=>Nx(t,e,h,s,r,"assets"),[t,e,h,s,r]),g=O.useMemo(()=>{if(t===r.pathname+r.search+r.hash)return[];let S=new Set,x=!1;if(e.forEach(C=>{let T=s.routes[C.route.id];!T||!T.hasLoader||(!m.some(A=>A.route.id===C.route.id)&&C.route.id in d&&o[C.route.id]?.shouldRevalidate||T.hasClientLoader?x=!0:S.add(C.route.id))}),S.size===0)return[];let E=_j(t,l,"data");return x&&S.size>0&&E.searchParams.set("_routes",e.filter(C=>S.has(C.route.id)).map(C=>C.route.id).join(",")),[E.pathname+E.search]},[l,d,r,s,m,e,t,o]),v=O.useMemo(()=>wj(p,s),[p,s]),_=Rj(p);return O.createElement(O.Fragment,null,g.map(S=>O.createElement("link",{key:S,rel:"prefetch",as:"fetch",href:S,...n})),v.map(S=>O.createElement("link",{key:S,rel:"modulepreload",href:S,...n})),_.map(({key:S,link:x})=>O.createElement("link",{key:S,nonce:n.nonce,...x})))}function Dj(...t){return e=>{t.forEach(n=>{typeof n=="function"?n(e):n!=null&&(n.current=e)})}}var kj=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{kj&&(window.__reactRouterVersion="7.11.0")}catch{}function Oj({basename:t,children:e,unstable_useTransitions:n,window:r}){let s=O.useRef();s.current==null&&(s.current=c2({window:r,v5Compat:!0}));let o=s.current,[l,d]=O.useState({action:o.action,location:o.location}),h=O.useCallback(m=>{n===!1?d(m):O.startTransition(()=>d(m))},[n]);return O.useLayoutEffect(()=>o.listen(h),[o,h]),O.createElement(oj,{basename:t,children:e,location:l.location,navigationType:l.action,navigator:o,unstable_useTransitions:n})}var w1=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Cn=O.forwardRef(function({onClick:e,discover:n="render",prefetch:r="none",relative:s,reloadDocument:o,replace:l,state:d,target:h,to:m,preventScrollReset:p,viewTransition:g,unstable_defaultShouldRevalidate:v,..._},S){let{basename:x,unstable_useTransitions:E}=O.useContext(Cr),C=typeof m=="string"&&w1.test(m),T=d1(m,x);m=T.to;let A=$2(m,{relative:s}),[B,U,G]=Aj(r,_),k=zj(m,{replace:l,state:d,target:h,preventScrollReset:p,relative:s,viewTransition:g,unstable_defaultShouldRevalidate:v,unstable_useTransitions:E});function D(F){e&&e(F),F.defaultPrevented||k(F)}let N=O.createElement("a",{..._,...G,href:T.absoluteURL||A,onClick:T.isExternal||o?e:D,ref:Dj(S,U),target:h,"data-discover":!C&&n==="render"?"true":void 0});return B&&!C?O.createElement(O.Fragment,null,N,O.createElement(jj,{page:A})):N});Cn.displayName="Link";var Mj=O.forwardRef(function({"aria-current":e="page",caseSensitive:n=!1,className:r="",end:s=!1,style:o,to:l,viewTransition:d,children:h,...m},p){let g=Yu(l,{relative:m.relative}),v=Vn(),_=O.useContext(Ff),{navigator:S,basename:x}=O.useContext(Cr),E=_!=null&&Vj(g)&&d===!0,C=S.encodeLocation?S.encodeLocation(g).pathname:g.pathname,T=v.pathname,A=_&&_.navigation&&_.navigation.location?_.navigation.location.pathname:null;n||(T=T.toLowerCase(),A=A?A.toLowerCase():null,C=C.toLowerCase()),A&&x&&(A=_s(A,x)||A);const B=C!=="/"&&C.endsWith("/")?C.length-1:C.length;let U=T===C||!s&&T.startsWith(C)&&T.charAt(B)==="/",G=A!=null&&(A===C||!s&&A.startsWith(C)&&A.charAt(C.length)==="/"),k={isActive:U,isPending:G,isTransitioning:E},D=U?e:void 0,N;typeof r=="function"?N=r(k):N=[r,U?"active":null,G?"pending":null,E?"transitioning":null].filter(Boolean).join(" ");let F=typeof o=="function"?o(k):o;return O.createElement(Cn,{...m,"aria-current":D,className:N,ref:p,style:F,to:l,viewTransition:d},typeof h=="function"?h(k):h)});Mj.displayName="NavLink";var Nj=O.forwardRef(({discover:t="render",fetcherKey:e,navigate:n,reloadDocument:r,replace:s,state:o,method:l=Yh,action:d,onSubmit:h,relative:m,preventScrollReset:p,viewTransition:g,unstable_defaultShouldRevalidate:v,..._},S)=>{let{unstable_useTransitions:x}=O.useContext(Cr),E=Uj(),C=Fj(d,{relative:m}),T=l.toLowerCase()==="get"?"get":"post",A=typeof d=="string"&&w1.test(d),B=U=>{if(h&&h(U),U.defaultPrevented)return;U.preventDefault();let G=U.nativeEvent.submitter,k=G?.getAttribute("formmethod")||l,D=()=>E(G||U.currentTarget,{fetcherKey:e,method:k,navigate:n,replace:s,state:o,relative:m,preventScrollReset:p,viewTransition:g,unstable_defaultShouldRevalidate:v});x&&n!==!1?O.startTransition(()=>D()):D()};return O.createElement("form",{ref:S,method:T,action:C,onSubmit:r?h:B,..._,"data-discover":!A&&t==="render"?"true":void 0})});Nj.displayName="Form";function Pj(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function S1(t){let e=O.useContext(Jl);return Kt(e,Pj(t)),e}function zj(t,{target:e,replace:n,state:r,preventScrollReset:s,relative:o,viewTransition:l,unstable_defaultShouldRevalidate:d,unstable_useTransitions:h}={}){let m=Ku(),p=Vn(),g=Yu(t,{relative:o});return O.useCallback(v=>{if(fj(v,e)){v.preventDefault();let _=n!==void 0?n:Du(p)===Du(g),S=()=>m(t,{replace:_,state:r,preventScrollReset:s,relative:o,viewTransition:l,unstable_defaultShouldRevalidate:d});h?O.startTransition(()=>S()):S()}},[p,m,g,n,r,e,t,s,o,l,d,h])}function E1(t){Er(typeof URLSearchParams<"u","You cannot use the `useSearchParams` hook in a browser that does not support the URLSearchParams API. If you need to support Internet Explorer 11, we recommend you load a polyfill such as https://github.com/ungap/url-search-params.");let e=O.useRef(Zg(t)),n=O.useRef(!1),r=Vn(),s=O.useMemo(()=>mj(r.search,n.current?null:e.current),[r.search]),o=Ku(),l=O.useCallback((d,h)=>{const m=Zg(typeof d=="function"?d(new URLSearchParams(s)):d);n.current=!0,o("?"+m,h)},[o,s]);return[s,l]}var Bj=0,Lj=()=>`__${String(++Bj)}__`;function Uj(){let{router:t}=S1("useSubmit"),{basename:e}=O.useContext(Cr),n=rj(),r=t.fetch,s=t.navigate;return O.useCallback(async(o,l={})=>{let{action:d,method:h,encType:m,formData:p,body:g}=yj(o,e);if(l.navigate===!1){let v=l.fetcherKey||Lj();await r(v,n,l.action||d,{unstable_defaultShouldRevalidate:l.unstable_defaultShouldRevalidate,preventScrollReset:l.preventScrollReset,formData:p,body:g,formMethod:l.method||h,formEncType:l.encType||m,flushSync:l.flushSync})}else await s(l.action||d,{unstable_defaultShouldRevalidate:l.unstable_defaultShouldRevalidate,preventScrollReset:l.preventScrollReset,formData:p,body:g,formMethod:l.method||h,formEncType:l.encType||m,replace:l.replace,state:l.state,fromRouteId:n,flushSync:l.flushSync,viewTransition:l.viewTransition})},[r,s,e,n])}function Fj(t,{relative:e}={}){let{basename:n}=O.useContext(Cr),r=O.useContext(Vr);Kt(r,"useFormAction must be used inside a RouteContext");let[s]=r.matches.slice(-1),o={...Yu(t||".",{relative:e})},l=Vn();if(t==null){o.search=l.search;let d=new URLSearchParams(o.search),h=d.getAll("index");if(h.some(p=>p==="")){d.delete("index"),h.filter(g=>g).forEach(g=>d.append("index",g));let p=d.toString();o.search=p?`?${p}`:""}}return(!t||t===".")&&s.route.index&&(o.search=o.search?o.search.replace(/^\?/,"?index&"):"?index"),n!=="/"&&(o.pathname=o.pathname==="/"?n:gs([n,o.pathname])),Du(o)}function Vj(t,{relative:e}={}){let n=O.useContext(f1);Kt(n!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:r}=S1("useViewTransitionState"),s=Yu(t,{relative:e});if(!n.isTransitioning)return!1;let o=_s(n.currentLocation.pathname,r)||n.currentLocation.pathname,l=_s(n.nextLocation.pathname,r)||n.nextLocation.pathname;return uf(s.pathname,l)!=null||uf(s.pathname,o)!=null}const $j={isLoading:!1,loadingMessage:"Loading...",addLoadingHold:()=>{},removeLoadingHold:()=>{}},C1=O.createContext($j);function Hj({children:t}){const[e,n]=O.useState(new Map),r=O.useCallback((h,m)=>{n(p=>new Map(p).set(h,m))},[]),s=O.useCallback(h=>{n(m=>{const p=new Map(m);return p.delete(h),p})},[]),o=e.size>0,l=e.size>0&&Array.from(e.values()).pop()||"Loading...",d={isLoading:o,loadingMessage:l,addLoadingHold:r,removeLoadingHold:s};return u.jsx(C1.Provider,{value:d,children:t})}function nr(){const t=O.useContext(C1);if(!t)throw new Error("useApp must be used within an AppProvider");return t}const qj=()=>{};var Px={};const T1=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let s=t.charCodeAt(r);s<128?e[n++]=s:s<2048?(e[n++]=s>>6|192,e[n++]=s&63|128):(s&64512)===55296&&r+1<t.length&&(t.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(t.charCodeAt(++r)&1023),e[n++]=s>>18|240,e[n++]=s>>12&63|128,e[n++]=s>>6&63|128,e[n++]=s&63|128):(e[n++]=s>>12|224,e[n++]=s>>6&63|128,e[n++]=s&63|128)}return e},Gj=function(t){const e=[];let n=0,r=0;for(;n<t.length;){const s=t[n++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const o=t[n++];e[r++]=String.fromCharCode((s&31)<<6|o&63)}else if(s>239&&s<365){const o=t[n++],l=t[n++],d=t[n++],h=((s&7)<<18|(o&63)<<12|(l&63)<<6|d&63)-65536;e[r++]=String.fromCharCode(55296+(h>>10)),e[r++]=String.fromCharCode(56320+(h&1023))}else{const o=t[n++],l=t[n++];e[r++]=String.fromCharCode((s&15)<<12|(o&63)<<6|l&63)}}return e.join("")},A1={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<t.length;s+=3){const o=t[s],l=s+1<t.length,d=l?t[s+1]:0,h=s+2<t.length,m=h?t[s+2]:0,p=o>>2,g=(o&3)<<4|d>>4;let v=(d&15)<<2|m>>6,_=m&63;h||(_=64,l||(v=64)),r.push(n[p],n[g],n[v],n[_])}return r.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(T1(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):Gj(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<t.length;){const o=n[t.charAt(s++)],d=s<t.length?n[t.charAt(s)]:0;++s;const m=s<t.length?n[t.charAt(s)]:64;++s;const g=s<t.length?n[t.charAt(s)]:64;if(++s,o==null||d==null||m==null||g==null)throw new Wj;const v=o<<2|d>>4;if(r.push(v),m!==64){const _=d<<4&240|m>>2;if(r.push(_),g!==64){const S=m<<6&192|g;r.push(S)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class Wj extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Qj=function(t){const e=T1(t);return A1.encodeByteArray(e,!0)},df=function(t){return Qj(t).replace(/\./g,"")},j1=function(t){try{return A1.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function Kj(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const Yj=()=>Kj().__FIREBASE_DEFAULTS__,Xj=()=>{if(typeof process>"u"||typeof Px>"u")return;const t=Px.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},Zj=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&j1(t[1]);return e&&JSON.parse(e)},qf=()=>{try{return qj()||Yj()||Xj()||Zj()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},R1=t=>qf()?.emulatorHosts?.[t],Jj=t=>{const e=R1(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(n+1),10);return e[0]==="["?[e.substring(1,n-1),r]:[e.substring(0,n),r]},I1=()=>qf()?.config,D1=t=>qf()?.[`_${t}`];class eR{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,r)=>{n?this.reject(n):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,r))}}}function tc(t){try{return(t.startsWith("http://")||t.startsWith("https://")?new URL(t).hostname:t).endsWith(".cloudworkstations.dev")}catch{return!1}}async function k1(t){return(await fetch(t,{credentials:"include"})).ok}function tR(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n={alg:"none",type:"JWT"},r=e||"demo-project",s=t.iat||0,o=t.sub||t.user_id;if(!o)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const l={iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:o,user_id:o,firebase:{sign_in_provider:"custom",identities:{}},...t};return[df(JSON.stringify(n)),df(JSON.stringify(l)),""].join(".")}const Cu={};function nR(){const t={prod:[],emulator:[]};for(const e of Object.keys(Cu))Cu[e]?t.emulator.push(e):t.prod.push(e);return t}function rR(t){let e=document.getElementById(t),n=!1;return e||(e=document.createElement("div"),e.setAttribute("id",t),n=!0),{created:n,element:e}}let zx=!1;function O1(t,e){if(typeof window>"u"||typeof document>"u"||!tc(window.location.host)||Cu[t]===e||Cu[t]||zx)return;Cu[t]=e;function n(v){return`__firebase__banner__${v}`}const r="__firebase__banner",o=nR().prod.length>0;function l(){const v=document.getElementById(r);v&&v.remove()}function d(v){v.style.display="flex",v.style.background="#7faaf0",v.style.position="fixed",v.style.bottom="5px",v.style.left="5px",v.style.padding=".5em",v.style.borderRadius="5px",v.style.alignItems="center"}function h(v,_){v.setAttribute("width","24"),v.setAttribute("id",_),v.setAttribute("height","24"),v.setAttribute("viewBox","0 0 24 24"),v.setAttribute("fill","none"),v.style.marginLeft="-6px"}function m(){const v=document.createElement("span");return v.style.cursor="pointer",v.style.marginLeft="16px",v.style.fontSize="24px",v.innerHTML=" &times;",v.onclick=()=>{zx=!0,l()},v}function p(v,_){v.setAttribute("id",_),v.innerText="Learn more",v.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",v.setAttribute("target","__blank"),v.style.paddingLeft="5px",v.style.textDecoration="underline"}function g(){const v=rR(r),_=n("text"),S=document.getElementById(_)||document.createElement("span"),x=n("learnmore"),E=document.getElementById(x)||document.createElement("a"),C=n("preprendIcon"),T=document.getElementById(C)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(v.created){const A=v.element;d(A),p(E,x);const B=m();h(T,C),A.append(T,S,E,B),document.body.appendChild(A)}o?(S.innerText="Preview backend disconnected.",T.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(T.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,S.innerText="Preview backend running in this workspace."),S.setAttribute("id",_)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",g):g()}function Yn(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function iR(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Yn())}function sR(){const t=qf()?.forceEnvironment;if(t==="node")return!0;if(t==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function aR(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function oR(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function lR(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function cR(){const t=Yn();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function uR(){return!sR()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function dR(){try{return typeof indexedDB=="object"}catch{return!1}}function hR(){return new Promise((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},s.onupgradeneeded=()=>{n=!1},s.onerror=()=>{e(s.error?.message||"")}}catch(n){e(n)}})}const fR="FirebaseError";class Ts extends Error{constructor(e,n,r){super(n),this.code=e,this.customData=r,this.name=fR,Object.setPrototypeOf(this,Ts.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Xu.prototype.create)}}class Xu{constructor(e,n,r){this.service=e,this.serviceName=n,this.errors=r}create(e,...n){const r=n[0]||{},s=`${this.service}/${e}`,o=this.errors[e],l=o?mR(o,r):"Error",d=`${this.serviceName}: ${l} (${s}).`;return new Ts(s,d,r)}}function mR(t,e){return t.replace(pR,(n,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const pR=/\{\$([^}]+)}/g;function gR(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function bs(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const s of n){if(!r.includes(s))return!1;const o=t[s],l=e[s];if(Bx(o)&&Bx(l)){if(!bs(o,l))return!1}else if(o!==l)return!1}for(const s of r)if(!n.includes(s))return!1;return!0}function Bx(t){return t!==null&&typeof t=="object"}function Zu(t){const e=[];for(const[n,r]of Object.entries(t))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function bu(t){const e={};return t.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[s,o]=r.split("=");e[decodeURIComponent(s)]=decodeURIComponent(o)}}),e}function vu(t){const e=t.indexOf("?");if(!e)return"";const n=t.indexOf("#",e);return t.substring(e,n>0?n:void 0)}function yR(t,e){const n=new _R(t,e);return n.subscribe.bind(n)}class _R{constructor(e,n){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(n=>{n.next(e)})}error(e){this.forEachObserver(n=>{n.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,n,r){let s;if(e===void 0&&n===void 0&&r===void 0)throw new Error("Missing Observer.");bR(e,["next","error","complete"])?s=e:s={next:e,error:n,complete:r},s.next===void 0&&(s.next=Rg),s.error===void 0&&(s.error=Rg),s.complete===void 0&&(s.complete=Rg);const o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),o}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let n=0;n<this.observers.length;n++)this.sendOne(n,e)}sendOne(e,n){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{n(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function bR(t,e){if(typeof t!="object"||t===null)return!1;for(const n of e)if(n in t&&typeof t[n]=="function")return!0;return!1}function Rg(){}function bn(t){return t&&t._delegate?t._delegate:t}class bo{constructor(e,n,r){this.name=e,this.instanceFactory=n,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const mo="[DEFAULT]";class vR{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){const r=new eR;if(this.instancesDeferred.set(n,r),this.isInitialized(n)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:n});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){const n=this.normalizeInstanceIdentifier(e?.identifier),r=e?.optional??!1;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(s){if(r)return null;throw s}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(wR(e))try{this.getOrInitializeService({instanceIdentifier:mo})}catch{}for(const[n,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(n);try{const o=this.getOrInitializeService({instanceIdentifier:s});r.resolve(o)}catch{}}}}clearInstance(e=mo){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=mo){return this.instances.has(e)}getOptions(e=mo){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:n={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:n});for(const[o,l]of this.instancesDeferred.entries()){const d=this.normalizeInstanceIdentifier(o);r===d&&l.resolve(s)}return s}onInit(e,n){const r=this.normalizeInstanceIdentifier(n),s=this.onInitCallbacks.get(r)??new Set;s.add(e),this.onInitCallbacks.set(r,s);const o=this.instances.get(r);return o&&e(o,r),()=>{s.delete(e)}}invokeOnInitCallbacks(e,n){const r=this.onInitCallbacks.get(n);if(r)for(const s of r)try{s(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:xR(e),options:n}),this.instances.set(e,r),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=mo){return this.component?this.component.multipleInstances?e:mo:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function xR(t){return t===mo?void 0:t}function wR(t){return t.instantiationMode==="EAGER"}class SR{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const n=new vR(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}}var ft;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(ft||(ft={}));const ER={debug:ft.DEBUG,verbose:ft.VERBOSE,info:ft.INFO,warn:ft.WARN,error:ft.ERROR,silent:ft.SILENT},CR=ft.INFO,TR={[ft.DEBUG]:"log",[ft.VERBOSE]:"log",[ft.INFO]:"info",[ft.WARN]:"warn",[ft.ERROR]:"error"},AR=(t,e,...n)=>{if(e<t.logLevel)return;const r=new Date().toISOString(),s=TR[e];if(s)console[s](`[${r}]  ${t.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Hy{constructor(e){this.name=e,this._logLevel=CR,this._logHandler=AR,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in ft))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?ER[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,ft.DEBUG,...e),this._logHandler(this,ft.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,ft.VERBOSE,...e),this._logHandler(this,ft.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,ft.INFO,...e),this._logHandler(this,ft.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,ft.WARN,...e),this._logHandler(this,ft.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,ft.ERROR,...e),this._logHandler(this,ft.ERROR,...e)}}const jR=(t,e)=>e.some(n=>t instanceof n);let Lx,Ux;function RR(){return Lx||(Lx=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function IR(){return Ux||(Ux=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const M1=new WeakMap,Jg=new WeakMap,N1=new WeakMap,Ig=new WeakMap,qy=new WeakMap;function DR(t){const e=new Promise((n,r)=>{const s=()=>{t.removeEventListener("success",o),t.removeEventListener("error",l)},o=()=>{n(pa(t.result)),s()},l=()=>{r(t.error),s()};t.addEventListener("success",o),t.addEventListener("error",l)});return e.then(n=>{n instanceof IDBCursor&&M1.set(n,t)}).catch(()=>{}),qy.set(e,t),e}function kR(t){if(Jg.has(t))return;const e=new Promise((n,r)=>{const s=()=>{t.removeEventListener("complete",o),t.removeEventListener("error",l),t.removeEventListener("abort",l)},o=()=>{n(),s()},l=()=>{r(t.error||new DOMException("AbortError","AbortError")),s()};t.addEventListener("complete",o),t.addEventListener("error",l),t.addEventListener("abort",l)});Jg.set(t,e)}let ey={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return Jg.get(t);if(e==="objectStoreNames")return t.objectStoreNames||N1.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return pa(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function OR(t){ey=t(ey)}function MR(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const r=t.call(Dg(this),e,...n);return N1.set(r,e.sort?e.sort():[e]),pa(r)}:IR().includes(t)?function(...e){return t.apply(Dg(this),e),pa(M1.get(this))}:function(...e){return pa(t.apply(Dg(this),e))}}function NR(t){return typeof t=="function"?MR(t):(t instanceof IDBTransaction&&kR(t),jR(t,RR())?new Proxy(t,ey):t)}function pa(t){if(t instanceof IDBRequest)return DR(t);if(Ig.has(t))return Ig.get(t);const e=NR(t);return e!==t&&(Ig.set(t,e),qy.set(e,t)),e}const Dg=t=>qy.get(t);function PR(t,e,{blocked:n,upgrade:r,blocking:s,terminated:o}={}){const l=indexedDB.open(t,e),d=pa(l);return r&&l.addEventListener("upgradeneeded",h=>{r(pa(l.result),h.oldVersion,h.newVersion,pa(l.transaction),h)}),n&&l.addEventListener("blocked",h=>n(h.oldVersion,h.newVersion,h)),d.then(h=>{o&&h.addEventListener("close",()=>o()),s&&h.addEventListener("versionchange",m=>s(m.oldVersion,m.newVersion,m))}).catch(()=>{}),d}const zR=["get","getKey","getAll","getAllKeys","count"],BR=["put","add","delete","clear"],kg=new Map;function Fx(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(kg.get(e))return kg.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,s=BR.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(s||zR.includes(n)))return;const o=async function(l,...d){const h=this.transaction(l,s?"readwrite":"readonly");let m=h.store;return r&&(m=m.index(d.shift())),(await Promise.all([m[n](...d),s&&h.done]))[0]};return kg.set(e,o),o}OR(t=>({...t,get:(e,n,r)=>Fx(e,n)||t.get(e,n,r),has:(e,n)=>!!Fx(e,n)||t.has(e,n)}));class LR{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(UR(n)){const r=n.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(n=>n).join(" ")}}function UR(t){return t.getComponent()?.type==="VERSION"}const ty="@firebase/app",Vx="0.14.6";const vs=new Hy("@firebase/app"),FR="@firebase/app-compat",VR="@firebase/analytics-compat",$R="@firebase/analytics",HR="@firebase/app-check-compat",qR="@firebase/app-check",GR="@firebase/auth",WR="@firebase/auth-compat",QR="@firebase/database",KR="@firebase/data-connect",YR="@firebase/database-compat",XR="@firebase/functions",ZR="@firebase/functions-compat",JR="@firebase/installations",eI="@firebase/installations-compat",tI="@firebase/messaging",nI="@firebase/messaging-compat",rI="@firebase/performance",iI="@firebase/performance-compat",sI="@firebase/remote-config",aI="@firebase/remote-config-compat",oI="@firebase/storage",lI="@firebase/storage-compat",cI="@firebase/firestore",uI="@firebase/ai",dI="@firebase/firestore-compat",hI="firebase",fI="12.6.0";const ny="[DEFAULT]",mI={[ty]:"fire-core",[FR]:"fire-core-compat",[$R]:"fire-analytics",[VR]:"fire-analytics-compat",[qR]:"fire-app-check",[HR]:"fire-app-check-compat",[GR]:"fire-auth",[WR]:"fire-auth-compat",[QR]:"fire-rtdb",[KR]:"fire-data-connect",[YR]:"fire-rtdb-compat",[XR]:"fire-fn",[ZR]:"fire-fn-compat",[JR]:"fire-iid",[eI]:"fire-iid-compat",[tI]:"fire-fcm",[nI]:"fire-fcm-compat",[rI]:"fire-perf",[iI]:"fire-perf-compat",[sI]:"fire-rc",[aI]:"fire-rc-compat",[oI]:"fire-gcs",[lI]:"fire-gcs-compat",[cI]:"fire-fst",[dI]:"fire-fst-compat",[uI]:"fire-vertex","fire-js":"fire-js",[hI]:"fire-js-all"};const hf=new Map,pI=new Map,ry=new Map;function $x(t,e){try{t.container.addComponent(e)}catch(n){vs.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function Bl(t){const e=t.name;if(ry.has(e))return vs.debug(`There were multiple attempts to register component ${e}.`),!1;ry.set(e,t);for(const n of hf.values())$x(n,t);for(const n of pI.values())$x(n,t);return!0}function Gy(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function ti(t){return t==null?!1:t.settings!==void 0}const gI={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},ga=new Xu("app","Firebase",gI);class yI{constructor(e,n,r){this._isDeleted=!1,this._options={...e},this._config={...n},this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new bo("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw ga.create("app-deleted",{appName:this._name})}}const nc=fI;function P1(t,e={}){let n=t;typeof e!="object"&&(e={name:e});const r={name:ny,automaticDataCollectionEnabled:!0,...e},s=r.name;if(typeof s!="string"||!s)throw ga.create("bad-app-name",{appName:String(s)});if(n||(n=I1()),!n)throw ga.create("no-options");const o=hf.get(s);if(o){if(bs(n,o.options)&&bs(r,o.config))return o;throw ga.create("duplicate-app",{appName:s})}const l=new SR(s);for(const h of ry.values())l.addComponent(h);const d=new yI(n,r,l);return hf.set(s,d),d}function z1(t=ny){const e=hf.get(t);if(!e&&t===ny&&I1())return P1();if(!e)throw ga.create("no-app",{appName:t});return e}function ya(t,e,n){let r=mI[t]??t;n&&(r+=`-${n}`);const s=r.match(/\s|\//),o=e.match(/\s|\//);if(s||o){const l=[`Unable to register library "${r}" with version "${e}":`];s&&l.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&o&&l.push("and"),o&&l.push(`version name "${e}" contains illegal characters (whitespace or "/")`),vs.warn(l.join(" "));return}Bl(new bo(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}const _I="firebase-heartbeat-database",bI=1,ku="firebase-heartbeat-store";let Og=null;function B1(){return Og||(Og=PR(_I,bI,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(ku)}catch(n){console.warn(n)}}}}).catch(t=>{throw ga.create("idb-open",{originalErrorMessage:t.message})})),Og}async function vI(t){try{const n=(await B1()).transaction(ku),r=await n.objectStore(ku).get(L1(t));return await n.done,r}catch(e){if(e instanceof Ts)vs.warn(e.message);else{const n=ga.create("idb-get",{originalErrorMessage:e?.message});vs.warn(n.message)}}}async function Hx(t,e){try{const r=(await B1()).transaction(ku,"readwrite");await r.objectStore(ku).put(e,L1(t)),await r.done}catch(n){if(n instanceof Ts)vs.warn(n.message);else{const r=ga.create("idb-set",{originalErrorMessage:n?.message});vs.warn(r.message)}}}function L1(t){return`${t.name}!${t.options.appId}`}const xI=1024,wI=30;class SI{constructor(e){this.container=e,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new CI(n),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){try{const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=qx();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(s=>s.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:n}),this._heartbeatsCache.heartbeats.length>wI){const s=TI(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(s,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){vs.warn(e)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const e=qx(),{heartbeatsToSend:n,unsentEntries:r}=EI(this._heartbeatsCache.heartbeats),s=df(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(e){return vs.warn(e),""}}}function qx(){return new Date().toISOString().substring(0,10)}function EI(t,e=xI){const n=[];let r=t.slice();for(const s of t){const o=n.find(l=>l.agent===s.agent);if(o){if(o.dates.push(s.date),Gx(n)>e){o.dates.pop();break}}else if(n.push({agent:s.agent,dates:[s.date]}),Gx(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}class CI{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return dR()?hR().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const n=await vI(this.app);return n?.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return Hx(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return Hx(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function Gx(t){return df(JSON.stringify({version:2,heartbeats:t})).length}function TI(t){if(t.length===0)return-1;let e=0,n=t[0].date;for(let r=1;r<t.length;r++)t[r].date<n&&(n=t[r].date,e=r);return e}function AI(t){Bl(new bo("platform-logger",e=>new LR(e),"PRIVATE")),Bl(new bo("heartbeat",e=>new SI(e),"PRIVATE")),ya(ty,Vx,t),ya(ty,Vx,"esm2020"),ya("fire-js","")}AI("");function U1(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const jI=U1,F1=new Xu("auth","Firebase",U1());const ff=new Hy("@firebase/auth");function RI(t,...e){ff.logLevel<=ft.WARN&&ff.warn(`Auth (${nc}): ${t}`,...e)}function Zh(t,...e){ff.logLevel<=ft.ERROR&&ff.error(`Auth (${nc}): ${t}`,...e)}function si(t,...e){throw Wy(t,...e)}function zi(t,...e){return Wy(t,...e)}function V1(t,e,n){const r={...jI(),[e]:n};return new Xu("auth","Firebase",r).create(e,{appName:t.name})}function _a(t){return V1(t,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Wy(t,...e){if(typeof t!="string"){const n=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=t.name),t._errorFactory.create(n,...r)}return F1.create(t,...e)}function Ye(t,e,...n){if(!t)throw Wy(e,...n)}function fs(t){const e="INTERNAL ASSERTION FAILED: "+t;throw Zh(e),new Error(e)}function xs(t,e){t||fs(e)}function iy(){return typeof self<"u"&&self.location?.href||""}function II(){return Wx()==="http:"||Wx()==="https:"}function Wx(){return typeof self<"u"&&self.location?.protocol||null}function DI(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(II()||oR()||"connection"in navigator)?navigator.onLine:!0}function kI(){if(typeof navigator>"u")return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}class Ju{constructor(e,n){this.shortDelay=e,this.longDelay=n,xs(n>e,"Short delay should be less than long delay!"),this.isMobile=iR()||lR()}get(){return DI()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function Qy(t,e){xs(t.emulator,"Emulator should always be set here");const{url:n}=t.emulator;return e?`${n}${e.startsWith("/")?e.slice(1):e}`:n}class $1{static initialize(e,n,r){this.fetchImpl=e,n&&(this.headersImpl=n),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;fs("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;fs("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;fs("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const OI={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};const MI=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],NI=new Ju(3e4,6e4);function Ao(t,e){return t.tenantId&&!e.tenantId?{...e,tenantId:t.tenantId}:e}async function Ia(t,e,n,r,s={}){return H1(t,s,async()=>{let o={},l={};r&&(e==="GET"?l=r:o={body:JSON.stringify(r)});const d=Zu({key:t.config.apiKey,...l}).slice(1),h=await t._getAdditionalHeaders();h["Content-Type"]="application/json",t.languageCode&&(h["X-Firebase-Locale"]=t.languageCode);const m={method:e,headers:h,...o};return aR()||(m.referrerPolicy="no-referrer"),t.emulatorConfig&&tc(t.emulatorConfig.host)&&(m.credentials="include"),$1.fetch()(await q1(t,t.config.apiHost,n,d),m)})}async function H1(t,e,n){t._canInitEmulator=!1;const r={...OI,...e};try{const s=new zI(t),o=await Promise.race([n(),s.promise]);s.clearNetworkTimeout();const l=await o.json();if("needConfirmation"in l)throw Fh(t,"account-exists-with-different-credential",l);if(o.ok&&!("errorMessage"in l))return l;{const d=o.ok?l.errorMessage:l.error.message,[h,m]=d.split(" : ");if(h==="FEDERATED_USER_ID_ALREADY_LINKED")throw Fh(t,"credential-already-in-use",l);if(h==="EMAIL_EXISTS")throw Fh(t,"email-already-in-use",l);if(h==="USER_DISABLED")throw Fh(t,"user-disabled",l);const p=r[h]||h.toLowerCase().replace(/[_\s]+/g,"-");if(m)throw V1(t,p,m);si(t,p)}}catch(s){if(s instanceof Ts)throw s;si(t,"network-request-failed",{message:String(s)})}}async function Gf(t,e,n,r,s={}){const o=await Ia(t,e,n,r,s);return"mfaPendingCredential"in o&&si(t,"multi-factor-auth-required",{_serverResponse:o}),o}async function q1(t,e,n,r){const s=`${e}${n}?${r}`,o=t,l=o.config.emulator?Qy(t.config,s):`${t.config.apiScheme}://${s}`;return MI.includes(n)&&(await o._persistenceManagerAvailable,o._getPersistenceType()==="COOKIE")?o._getPersistence()._getFinalTarget(l).toString():l}function PI(t){switch(t){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class zI{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((n,r)=>{this.timer=setTimeout(()=>r(zi(this.auth,"network-request-failed")),NI.get())})}}function Fh(t,e,n){const r={appName:t.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const s=zi(t,e,r);return s.customData._tokenResponse=n,s}function Qx(t){return t!==void 0&&t.enterprise!==void 0}class BI{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const n of this.recaptchaEnforcementState)if(n.provider&&n.provider===e)return PI(n.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function LI(t,e){return Ia(t,"GET","/v2/recaptchaConfig",Ao(t,e))}async function UI(t,e){return Ia(t,"POST","/v1/accounts:delete",e)}async function mf(t,e){return Ia(t,"POST","/v1/accounts:lookup",e)}function Tu(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function FI(t,e=!1){const n=bn(t),r=await n.getIdToken(e),s=Ky(r);Ye(s&&s.exp&&s.auth_time&&s.iat,n.auth,"internal-error");const o=typeof s.firebase=="object"?s.firebase:void 0,l=o?.sign_in_provider;return{claims:s,token:r,authTime:Tu(Mg(s.auth_time)),issuedAtTime:Tu(Mg(s.iat)),expirationTime:Tu(Mg(s.exp)),signInProvider:l||null,signInSecondFactor:o?.sign_in_second_factor||null}}function Mg(t){return Number(t)*1e3}function Ky(t){const[e,n,r]=t.split(".");if(e===void 0||n===void 0||r===void 0)return Zh("JWT malformed, contained fewer than 3 sections"),null;try{const s=j1(n);return s?JSON.parse(s):(Zh("Failed to decode base64 JWT payload"),null)}catch(s){return Zh("Caught error parsing JWT payload as JSON",s?.toString()),null}}function Kx(t){const e=Ky(t);return Ye(e,"internal-error"),Ye(typeof e.exp<"u","internal-error"),Ye(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}async function Ou(t,e,n=!1){if(n)return e;try{return await e}catch(r){throw r instanceof Ts&&VI(r)&&t.auth.currentUser===t&&await t.auth.signOut(),r}}function VI({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}class $I{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const n=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),n}else{this.errorBackoff=3e4;const r=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;const n=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},n)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class sy{constructor(e,n){this.createdAt=e,this.lastLoginAt=n,this._initializeTime()}_initializeTime(){this.lastSignInTime=Tu(this.lastLoginAt),this.creationTime=Tu(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function pf(t){const e=t.auth,n=await t.getIdToken(),r=await Ou(t,mf(e,{idToken:n}));Ye(r?.users.length,e,"internal-error");const s=r.users[0];t._notifyReloadListener(s);const o=s.providerUserInfo?.length?G1(s.providerUserInfo):[],l=qI(t.providerData,o),d=t.isAnonymous,h=!(t.email&&s.passwordHash)&&!l?.length,m=d?h:!1,p={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:l,metadata:new sy(s.createdAt,s.lastLoginAt),isAnonymous:m};Object.assign(t,p)}async function HI(t){const e=bn(t);await pf(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function qI(t,e){return[...t.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function G1(t){return t.map(({providerId:e,...n})=>({providerId:e,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}))}async function GI(t,e){const n=await H1(t,{},async()=>{const r=Zu({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:o}=t.config,l=await q1(t,s,"/v1/token",`key=${o}`),d=await t._getAdditionalHeaders();d["Content-Type"]="application/x-www-form-urlencoded";const h={method:"POST",headers:d,body:r};return t.emulatorConfig&&tc(t.emulatorConfig.host)&&(h.credentials="include"),$1.fetch()(l,h)});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}async function WI(t,e){return Ia(t,"POST","/v2/accounts:revokeToken",Ao(t,e))}class kl{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Ye(e.idToken,"internal-error"),Ye(typeof e.idToken<"u","internal-error"),Ye(typeof e.refreshToken<"u","internal-error");const n="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):Kx(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,n)}updateFromIdToken(e){Ye(e.length!==0,"internal-error");const n=Kx(e);this.updateTokensAndExpiration(e,null,n)}async getToken(e,n=!1){return!n&&this.accessToken&&!this.isExpired?this.accessToken:(Ye(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,n){const{accessToken:r,refreshToken:s,expiresIn:o}=await GI(e,n);this.updateTokensAndExpiration(r,s,Number(o))}updateTokensAndExpiration(e,n,r){this.refreshToken=n||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,n){const{refreshToken:r,accessToken:s,expirationTime:o}=n,l=new kl;return r&&(Ye(typeof r=="string","internal-error",{appName:e}),l.refreshToken=r),s&&(Ye(typeof s=="string","internal-error",{appName:e}),l.accessToken=s),o&&(Ye(typeof o=="number","internal-error",{appName:e}),l.expirationTime=o),l}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new kl,this.toJSON())}_performRefresh(){return fs("not implemented")}}function aa(t,e){Ye(typeof t=="string"||typeof t>"u","internal-error",{appName:e})}class ni{constructor({uid:e,auth:n,stsTokenManager:r,...s}){this.providerId="firebase",this.proactiveRefresh=new $I(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new sy(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){const n=await Ou(this,this.stsTokenManager.getToken(this.auth,e));return Ye(n,this.auth,"internal-error"),this.accessToken!==n&&(this.accessToken=n,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),n}getIdTokenResult(e){return FI(this,e)}reload(){return HI(this)}_assign(e){this!==e&&(Ye(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(n=>({...n})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const n=new ni({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return n.metadata._copy(this.metadata),n}_onReload(e){Ye(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,n=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),n&&await pf(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(ti(this.auth.app))return Promise.reject(_a(this.auth));const e=await this.getIdToken();return await Ou(this,UI(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,n){const r=n.displayName??void 0,s=n.email??void 0,o=n.phoneNumber??void 0,l=n.photoURL??void 0,d=n.tenantId??void 0,h=n._redirectEventId??void 0,m=n.createdAt??void 0,p=n.lastLoginAt??void 0,{uid:g,emailVerified:v,isAnonymous:_,providerData:S,stsTokenManager:x}=n;Ye(g&&x,e,"internal-error");const E=kl.fromJSON(this.name,x);Ye(typeof g=="string",e,"internal-error"),aa(r,e.name),aa(s,e.name),Ye(typeof v=="boolean",e,"internal-error"),Ye(typeof _=="boolean",e,"internal-error"),aa(o,e.name),aa(l,e.name),aa(d,e.name),aa(h,e.name),aa(m,e.name),aa(p,e.name);const C=new ni({uid:g,auth:e,email:s,emailVerified:v,displayName:r,isAnonymous:_,photoURL:l,phoneNumber:o,tenantId:d,stsTokenManager:E,createdAt:m,lastLoginAt:p});return S&&Array.isArray(S)&&(C.providerData=S.map(T=>({...T}))),h&&(C._redirectEventId=h),C}static async _fromIdTokenResponse(e,n,r=!1){const s=new kl;s.updateFromServerResponse(n);const o=new ni({uid:n.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await pf(o),o}static async _fromGetAccountInfoResponse(e,n,r){const s=n.users[0];Ye(s.localId!==void 0,"internal-error");const o=s.providerUserInfo!==void 0?G1(s.providerUserInfo):[],l=!(s.email&&s.passwordHash)&&!o?.length,d=new kl;d.updateFromIdToken(r);const h=new ni({uid:s.localId,auth:e,stsTokenManager:d,isAnonymous:l}),m={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:o,metadata:new sy(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!o?.length};return Object.assign(h,m),h}}const Yx=new Map;function ms(t){xs(t instanceof Function,"Expected a class definition");let e=Yx.get(t);return e?(xs(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,Yx.set(t,e),e)}class W1{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,n){this.storage[e]=n}async _get(e){const n=this.storage[e];return n===void 0?null:n}async _remove(e){delete this.storage[e]}_addListener(e,n){}_removeListener(e,n){}}W1.type="NONE";const Xx=W1;function Jh(t,e,n){return`firebase:${t}:${e}:${n}`}class Ol{constructor(e,n,r){this.persistence=e,this.auth=n,this.userKey=r;const{config:s,name:o}=this.auth;this.fullUserKey=Jh(this.userKey,s.apiKey,o),this.fullPersistenceKey=Jh("persistence",s.apiKey,o),this.boundEventHandler=n._onStorageEvent.bind(n),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const n=await mf(this.auth,{idToken:e}).catch(()=>{});return n?ni._fromGetAccountInfoResponse(this.auth,n,e):null}return ni._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const n=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,n)return this.setCurrentUser(n)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,n,r="authUser"){if(!n.length)return new Ol(ms(Xx),e,r);const s=(await Promise.all(n.map(async m=>{if(await m._isAvailable())return m}))).filter(m=>m);let o=s[0]||ms(Xx);const l=Jh(r,e.config.apiKey,e.name);let d=null;for(const m of n)try{const p=await m._get(l);if(p){let g;if(typeof p=="string"){const v=await mf(e,{idToken:p}).catch(()=>{});if(!v)break;g=await ni._fromGetAccountInfoResponse(e,v,p)}else g=ni._fromJSON(e,p);m!==o&&(d=g),o=m;break}}catch{}const h=s.filter(m=>m._shouldAllowMigration);return!o._shouldAllowMigration||!h.length?new Ol(o,e,r):(o=h[0],d&&await o._set(l,d.toJSON()),await Promise.all(n.map(async m=>{if(m!==o)try{await m._remove(l)}catch{}})),new Ol(o,e,r))}}function Zx(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(X1(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(Q1(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(J1(e))return"Blackberry";if(eE(e))return"Webos";if(K1(e))return"Safari";if((e.includes("chrome/")||Y1(e))&&!e.includes("edge/"))return"Chrome";if(Z1(e))return"Android";{const n=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=t.match(n);if(r?.length===2)return r[1]}return"Other"}function Q1(t=Yn()){return/firefox\//i.test(t)}function K1(t=Yn()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function Y1(t=Yn()){return/crios\//i.test(t)}function X1(t=Yn()){return/iemobile/i.test(t)}function Z1(t=Yn()){return/android/i.test(t)}function J1(t=Yn()){return/blackberry/i.test(t)}function eE(t=Yn()){return/webos/i.test(t)}function Yy(t=Yn()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function QI(t=Yn()){return Yy(t)&&!!window.navigator?.standalone}function KI(){return cR()&&document.documentMode===10}function tE(t=Yn()){return Yy(t)||Z1(t)||eE(t)||J1(t)||/windows phone/i.test(t)||X1(t)}function nE(t,e=[]){let n;switch(t){case"Browser":n=Zx(Yn());break;case"Worker":n=`${Zx(Yn())}-${t}`;break;default:n=t}const r=e.length?e.join(","):"FirebaseCore-web";return`${n}/JsCore/${nc}/${r}`}class YI{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,n){const r=o=>new Promise((l,d)=>{try{const h=e(o);l(h)}catch(h){d(h)}});r.onAbort=n,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const n=[];try{for(const r of this.queue)await r(e),r.onAbort&&n.push(r.onAbort)}catch(r){n.reverse();for(const s of n)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r?.message})}}}async function XI(t,e={}){return Ia(t,"GET","/v2/passwordPolicy",Ao(t,e))}const ZI=6;class JI{constructor(e){const n=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=n.minPasswordLength??ZI,n.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=n.maxPasswordLength),n.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=n.containsLowercaseCharacter),n.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=n.containsUppercaseCharacter),n.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=n.containsNumericCharacter),n.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=n.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const n={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,n),this.validatePasswordCharacterOptions(e,n),n.isValid&&(n.isValid=n.meetsMinPasswordLength??!0),n.isValid&&(n.isValid=n.meetsMaxPasswordLength??!0),n.isValid&&(n.isValid=n.containsLowercaseLetter??!0),n.isValid&&(n.isValid=n.containsUppercaseLetter??!0),n.isValid&&(n.isValid=n.containsNumericCharacter??!0),n.isValid&&(n.isValid=n.containsNonAlphanumericCharacter??!0),n}validatePasswordLengthOptions(e,n){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(n.meetsMinPasswordLength=e.length>=r),s&&(n.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,n){this.updatePasswordCharacterOptionsStatuses(n,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(n,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,n,r,s,o){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=n)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=o))}}class eD{constructor(e,n,r,s){this.app=e,this.heartbeatServiceProvider=n,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Jx(this),this.idTokenSubscription=new Jx(this),this.beforeStateQueue=new YI(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=F1,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion,this._persistenceManagerAvailable=new Promise(o=>this._resolvePersistenceManagerAvailable=o)}_initializeWithPersistence(e,n){return n&&(this._popupRedirectResolver=ms(n)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await Ol.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(n),this.lastNotifiedUid=this.currentUser?.uid||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const n=await mf(this,{idToken:e}),r=await ni._fromGetAccountInfoResponse(this,n,e);await this.directlySetCurrentUser(r)}catch(n){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",n),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(ti(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(l=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(l,l))}):this.directlySetCurrentUser(null)}const n=await this.assertedPersistence.getCurrentUser();let r=n,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=this.redirectUser?._redirectEventId,l=r?._redirectEventId,d=await this.tryRedirectSignIn(e);(!o||o===l)&&d?.user&&(r=d.user,s=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(r)}catch(o){r=n,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return Ye(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let n=null;try{n=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return n}async reloadAndSetCurrentUserOrClear(e){try{await pf(e)}catch(n){if(n?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=kI()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(ti(this.app))return Promise.reject(_a(this));const n=e?bn(e):null;return n&&Ye(n.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(n&&n._clone(this))}async _updateCurrentUser(e,n=!1){if(!this._deleted)return e&&Ye(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),n||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return ti(this.app)?Promise.reject(_a(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return ti(this.app)?Promise.reject(_a(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(ms(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const n=this._getPasswordPolicyInternal();return n.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):n.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await XI(this),n=new JI(e);this.tenantId===null?this._projectPasswordPolicy=n:this._tenantPasswordPolicies[this.tenantId]=n}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new Xu("auth","Firebase",e())}onAuthStateChanged(e,n,r){return this.registerStateListener(this.authStateSubscription,e,n,r)}beforeAuthStateChanged(e,n){return this.beforeStateQueue.pushCallback(e,n)}onIdTokenChanged(e,n,r){return this.registerStateListener(this.idTokenSubscription,e,n,r)}authStateReady(){return new Promise((e,n)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},n)}})}async revokeAccessToken(e){if(this.currentUser){const n=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:n};this.tenantId!=null&&(r.tenantId=this.tenantId),await WI(this,r)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,n){const r=await this.getOrInitRedirectPersistenceManager(n);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const n=e&&ms(e)||this._popupRedirectResolver;Ye(n,this,"argument-error"),this.redirectPersistenceManager=await Ol.create(this,[ms(n._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,n,r,s){if(this._deleted)return()=>{};const o=typeof n=="function"?n:n.next.bind(n);let l=!1;const d=this._isInitialized?Promise.resolve():this._initializationPromise;if(Ye(d,this,"internal-error"),d.then(()=>{l||o(this.currentUser)}),typeof n=="function"){const h=e.addObserver(n,r,s);return()=>{l=!0,h()}}else{const h=e.addObserver(n);return()=>{l=!0,h()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Ye(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=nE(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const n=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();n&&(e["X-Firebase-Client"]=n);const r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){if(ti(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&RI(`Error while retrieving App Check token: ${e.error}`),e?.token}}function rc(t){return bn(t)}class Jx{constructor(e){this.auth=e,this.observer=null,this.addObserver=yR(n=>this.observer=n)}get next(){return Ye(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let Wf={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function tD(t){Wf=t}function rE(t){return Wf.loadJS(t)}function nD(){return Wf.recaptchaEnterpriseScript}function rD(){return Wf.gapiScript}function iD(t){return`__${t}${Math.floor(Math.random()*1e6)}`}class sD{constructor(){this.enterprise=new aD}ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}class aD{ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}const oD="recaptcha-enterprise",iE="NO_RECAPTCHA";class lD{constructor(e){this.type=oD,this.auth=rc(e)}async verify(e="verify",n=!1){async function r(o){if(!n){if(o.tenantId==null&&o._agentRecaptchaConfig!=null)return o._agentRecaptchaConfig.siteKey;if(o.tenantId!=null&&o._tenantRecaptchaConfigs[o.tenantId]!==void 0)return o._tenantRecaptchaConfigs[o.tenantId].siteKey}return new Promise(async(l,d)=>{LI(o,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(h=>{if(h.recaptchaKey===void 0)d(new Error("recaptcha Enterprise site key undefined"));else{const m=new BI(h);return o.tenantId==null?o._agentRecaptchaConfig=m:o._tenantRecaptchaConfigs[o.tenantId]=m,l(m.siteKey)}}).catch(h=>{d(h)})})}function s(o,l,d){const h=window.grecaptcha;Qx(h)?h.enterprise.ready(()=>{h.enterprise.execute(o,{action:e}).then(m=>{l(m)}).catch(()=>{l(iE)})}):d(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new sD().execute("siteKey",{action:"verify"}):new Promise((o,l)=>{r(this.auth).then(d=>{if(!n&&Qx(window.grecaptcha))s(d,o,l);else{if(typeof window>"u"){l(new Error("RecaptchaVerifier is only supported in browser"));return}let h=nD();h.length!==0&&(h+=d),rE(h).then(()=>{s(d,o,l)}).catch(m=>{l(m)})}}).catch(d=>{l(d)})})}}async function ew(t,e,n,r=!1,s=!1){const o=new lD(t);let l;if(s)l=iE;else try{l=await o.verify(n)}catch{l=await o.verify(n,!0)}const d={...e};if(n==="mfaSmsEnrollment"||n==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in d){const h=d.phoneEnrollmentInfo.phoneNumber,m=d.phoneEnrollmentInfo.recaptchaToken;Object.assign(d,{phoneEnrollmentInfo:{phoneNumber:h,recaptchaToken:m,captchaResponse:l,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in d){const h=d.phoneSignInInfo.recaptchaToken;Object.assign(d,{phoneSignInInfo:{recaptchaToken:h,captchaResponse:l,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return d}return r?Object.assign(d,{captchaResp:l}):Object.assign(d,{captchaResponse:l}),Object.assign(d,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(d,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),d}async function tw(t,e,n,r,s){if(t._getRecaptchaConfig()?.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const o=await ew(t,e,n,n==="getOobCode");return r(t,o)}else return r(t,e).catch(async o=>{if(o.code==="auth/missing-recaptcha-token"){console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const l=await ew(t,e,n,n==="getOobCode");return r(t,l)}else return Promise.reject(o)})}function cD(t,e){const n=Gy(t,"auth");if(n.isInitialized()){const s=n.getImmediate(),o=n.getOptions();if(bs(o,e??{}))return s;si(s,"already-initialized")}return n.initialize({options:e})}function uD(t,e){const n=e?.persistence||[],r=(Array.isArray(n)?n:[n]).map(ms);e?.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(r,e?.popupRedirectResolver)}function dD(t,e,n){const r=rc(t);Ye(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!1,o=sE(e),{host:l,port:d}=hD(e),h=d===null?"":`:${d}`,m={url:`${o}//${l}${h}/`},p=Object.freeze({host:l,port:d,protocol:o.replace(":",""),options:Object.freeze({disableWarnings:s})});if(!r._canInitEmulator){Ye(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),Ye(bs(m,r.config.emulator)&&bs(p,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=m,r.emulatorConfig=p,r.settings.appVerificationDisabledForTesting=!0,tc(l)?(k1(`${o}//${l}${h}`),O1("Auth",!0)):fD()}function sE(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function hD(t){const e=sE(t),n=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const o=s[1];return{host:o,port:nw(r.substr(o.length+1))}}else{const[o,l]=r.split(":");return{host:o,port:nw(l)}}}function nw(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}function fD(){function t(){const e=document.createElement("p"),n=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",n.position="fixed",n.width="100%",n.backgroundColor="#ffffff",n.border=".1em solid #000000",n.color="#b50000",n.bottom="0px",n.left="0px",n.margin="0px",n.zIndex="10000",n.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",t):t())}class Xy{constructor(e,n){this.providerId=e,this.signInMethod=n}toJSON(){return fs("not implemented")}_getIdTokenResponse(e){return fs("not implemented")}_linkToIdToken(e,n){return fs("not implemented")}_getReauthenticationResolver(e){return fs("not implemented")}}async function mD(t,e){return Ia(t,"POST","/v1/accounts:signUp",e)}async function pD(t,e){return Gf(t,"POST","/v1/accounts:signInWithPassword",Ao(t,e))}async function gD(t,e){return Gf(t,"POST","/v1/accounts:signInWithEmailLink",Ao(t,e))}async function yD(t,e){return Gf(t,"POST","/v1/accounts:signInWithEmailLink",Ao(t,e))}class Mu extends Xy{constructor(e,n,r,s=null){super("password",r),this._email=e,this._password=n,this._tenantId=s}static _fromEmailAndPassword(e,n){return new Mu(e,n,"password")}static _fromEmailAndCode(e,n,r=null){return new Mu(e,n,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e;if(n?.email&&n?.password){if(n.signInMethod==="password")return this._fromEmailAndPassword(n.email,n.password);if(n.signInMethod==="emailLink")return this._fromEmailAndCode(n.email,n.password,n.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const n={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return tw(e,n,"signInWithPassword",pD);case"emailLink":return gD(e,{email:this._email,oobCode:this._password});default:si(e,"internal-error")}}async _linkToIdToken(e,n){switch(this.signInMethod){case"password":const r={idToken:n,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return tw(e,r,"signUpPassword",mD);case"emailLink":return yD(e,{idToken:n,email:this._email,oobCode:this._password});default:si(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function Ml(t,e){return Gf(t,"POST","/v1/accounts:signInWithIdp",Ao(t,e))}const _D="http://localhost";class vo extends Xy{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const n=new vo(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(n.idToken=e.idToken),e.accessToken&&(n.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(n.nonce=e.nonce),e.pendingToken&&(n.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(n.accessToken=e.oauthToken,n.secret=e.oauthTokenSecret):si("argument-error"),n}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s,...o}=n;if(!r||!s)return null;const l=new vo(r,s);return l.idToken=o.idToken||void 0,l.accessToken=o.accessToken||void 0,l.secret=o.secret,l.nonce=o.nonce,l.pendingToken=o.pendingToken||null,l}_getIdTokenResponse(e){const n=this.buildRequest();return Ml(e,n)}_linkToIdToken(e,n){const r=this.buildRequest();return r.idToken=n,Ml(e,r)}_getReauthenticationResolver(e){const n=this.buildRequest();return n.autoCreate=!1,Ml(e,n)}buildRequest(){const e={requestUri:_D,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const n={};this.idToken&&(n.id_token=this.idToken),this.accessToken&&(n.access_token=this.accessToken),this.secret&&(n.oauth_token_secret=this.secret),n.providerId=this.providerId,this.nonce&&!this.pendingToken&&(n.nonce=this.nonce),e.postBody=Zu(n)}return e}}function bD(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function vD(t){const e=bu(vu(t)).link,n=e?bu(vu(e)).deep_link_id:null,r=bu(vu(t)).deep_link_id;return(r?bu(vu(r)).link:null)||r||n||e||t}class Zy{constructor(e){const n=bu(vu(e)),r=n.apiKey??null,s=n.oobCode??null,o=bD(n.mode??null);Ye(r&&s&&o,"argument-error"),this.apiKey=r,this.operation=o,this.code=s,this.continueUrl=n.continueUrl??null,this.languageCode=n.lang??null,this.tenantId=n.tenantId??null}static parseLink(e){const n=vD(e);try{return new Zy(n)}catch{return null}}}class ic{constructor(){this.providerId=ic.PROVIDER_ID}static credential(e,n){return Mu._fromEmailAndPassword(e,n)}static credentialWithLink(e,n){const r=Zy.parseLink(n);return Ye(r,"argument-error"),Mu._fromEmailAndCode(e,r.code,r.tenantId)}}ic.PROVIDER_ID="password";ic.EMAIL_PASSWORD_SIGN_IN_METHOD="password";ic.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class aE{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class ed extends aE{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class ca extends ed{constructor(){super("facebook.com")}static credential(e){return vo._fromParams({providerId:ca.PROVIDER_ID,signInMethod:ca.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return ca.credentialFromTaggedObject(e)}static credentialFromError(e){return ca.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return ca.credential(e.oauthAccessToken)}catch{return null}}}ca.FACEBOOK_SIGN_IN_METHOD="facebook.com";ca.PROVIDER_ID="facebook.com";class ua extends ed{constructor(){super("google.com"),this.addScope("profile")}static credential(e,n){return vo._fromParams({providerId:ua.PROVIDER_ID,signInMethod:ua.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:n})}static credentialFromResult(e){return ua.credentialFromTaggedObject(e)}static credentialFromError(e){return ua.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:n,oauthAccessToken:r}=e;if(!n&&!r)return null;try{return ua.credential(n,r)}catch{return null}}}ua.GOOGLE_SIGN_IN_METHOD="google.com";ua.PROVIDER_ID="google.com";class da extends ed{constructor(){super("github.com")}static credential(e){return vo._fromParams({providerId:da.PROVIDER_ID,signInMethod:da.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return da.credentialFromTaggedObject(e)}static credentialFromError(e){return da.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return da.credential(e.oauthAccessToken)}catch{return null}}}da.GITHUB_SIGN_IN_METHOD="github.com";da.PROVIDER_ID="github.com";class ha extends ed{constructor(){super("twitter.com")}static credential(e,n){return vo._fromParams({providerId:ha.PROVIDER_ID,signInMethod:ha.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:n})}static credentialFromResult(e){return ha.credentialFromTaggedObject(e)}static credentialFromError(e){return ha.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:n,oauthTokenSecret:r}=e;if(!n||!r)return null;try{return ha.credential(n,r)}catch{return null}}}ha.TWITTER_SIGN_IN_METHOD="twitter.com";ha.PROVIDER_ID="twitter.com";class Ll{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,n,r,s=!1){const o=await ni._fromIdTokenResponse(e,r,s),l=rw(r);return new Ll({user:o,providerId:l,_tokenResponse:r,operationType:n})}static async _forOperation(e,n,r){await e._updateTokensIfNecessary(r,!0);const s=rw(r);return new Ll({user:e,providerId:s,_tokenResponse:r,operationType:n})}}function rw(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}class gf extends Ts{constructor(e,n,r,s){super(n.code,n.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,gf.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:n.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,n,r,s){return new gf(e,n,r,s)}}function oE(t,e,n,r){return(e==="reauthenticate"?n._getReauthenticationResolver(t):n._getIdTokenResponse(t)).catch(o=>{throw o.code==="auth/multi-factor-auth-required"?gf._fromErrorAndOperation(t,o,e,r):o})}async function xD(t,e,n=!1){const r=await Ou(t,e._linkToIdToken(t.auth,await t.getIdToken()),n);return Ll._forOperation(t,"link",r)}async function wD(t,e,n=!1){const{auth:r}=t;if(ti(r.app))return Promise.reject(_a(r));const s="reauthenticate";try{const o=await Ou(t,oE(r,s,e,t),n);Ye(o.idToken,r,"internal-error");const l=Ky(o.idToken);Ye(l,r,"internal-error");const{sub:d}=l;return Ye(t.uid===d,r,"user-mismatch"),Ll._forOperation(t,s,o)}catch(o){throw o?.code==="auth/user-not-found"&&si(r,"user-mismatch"),o}}async function lE(t,e,n=!1){if(ti(t.app))return Promise.reject(_a(t));const r="signIn",s=await oE(t,r,e),o=await Ll._fromIdTokenResponse(t,r,s);return n||await t._updateCurrentUser(o.user),o}async function SD(t,e){return lE(rc(t),e)}async function ED(t){const e=rc(t);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}function CD(t,e,n){return ti(t.app)?Promise.reject(_a(t)):SD(bn(t),ic.credential(e,n)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&ED(t),r})}function TD(t,e,n,r){return bn(t).onIdTokenChanged(e,n,r)}function AD(t,e,n){return bn(t).beforeAuthStateChanged(e,n)}function jD(t,e,n,r){return bn(t).onAuthStateChanged(e,n,r)}function RD(t){return bn(t).signOut()}const yf="__sak";class cE{constructor(e,n){this.storageRetriever=e,this.type=n}_isAvailable(){try{return this.storage?(this.storage.setItem(yf,"1"),this.storage.removeItem(yf),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,n){return this.storage.setItem(e,JSON.stringify(n)),Promise.resolve()}_get(e){const n=this.storage.getItem(e);return Promise.resolve(n?JSON.parse(n):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}const ID=1e3,DD=10;class uE extends cE{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,n)=>this.onStorageEvent(e,n),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=tE(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const n of Object.keys(this.listeners)){const r=this.storage.getItem(n),s=this.localCache[n];r!==s&&e(n,s,r)}}onStorageEvent(e,n=!1){if(!e.key){this.forAllChangedKeys((l,d,h)=>{this.notifyListeners(l,h)});return}const r=e.key;n?this.detachListener():this.stopPolling();const s=()=>{const l=this.storage.getItem(r);!n&&this.localCache[r]===l||this.notifyListeners(r,l)},o=this.storage.getItem(r);KI()&&o!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,DD):s()}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(n&&JSON.parse(n))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,n,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:n,newValue:r}),!0)})},ID)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,n){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,n){await super._set(e,n),this.localCache[e]=JSON.stringify(n)}async _get(e){const n=await super._get(e);return this.localCache[e]=JSON.stringify(n),n}async _remove(e){await super._remove(e),delete this.localCache[e]}}uE.type="LOCAL";const kD=uE;class dE extends cE{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,n){}_removeListener(e,n){}}dE.type="SESSION";const hE=dE;function OD(t){return Promise.all(t.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(n){return{fulfilled:!1,reason:n}}}))}class Qf{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const n=this.receivers.find(s=>s.isListeningto(e));if(n)return n;const r=new Qf(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const n=e,{eventId:r,eventType:s,data:o}=n.data,l=this.handlersMap[s];if(!l?.size)return;n.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const d=Array.from(l).map(async m=>m(n.origin,o)),h=await OD(d);n.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:h})}_subscribe(e,n){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(n)}_unsubscribe(e,n){this.handlersMap[e]&&n&&this.handlersMap[e].delete(n),(!n||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Qf.receivers=[];function Jy(t="",e=10){let n="";for(let r=0;r<e;r++)n+=Math.floor(Math.random()*10);return t+n}class MD{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,n,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let o,l;return new Promise((d,h)=>{const m=Jy("",20);s.port1.start();const p=setTimeout(()=>{h(new Error("unsupported_event"))},r);l={messageChannel:s,onMessage(g){const v=g;if(v.data.eventId===m)switch(v.data.status){case"ack":clearTimeout(p),o=setTimeout(()=>{h(new Error("timeout"))},3e3);break;case"done":clearTimeout(o),d(v.data.response);break;default:clearTimeout(p),clearTimeout(o),h(new Error("invalid_response"));break}}},this.handlers.add(l),s.port1.addEventListener("message",l.onMessage),this.target.postMessage({eventType:e,eventId:m,data:n},[s.port2])}).finally(()=>{l&&this.removeMessageHandler(l)})}}function Bi(){return window}function ND(t){Bi().location.href=t}function fE(){return typeof Bi().WorkerGlobalScope<"u"&&typeof Bi().importScripts=="function"}async function PD(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function zD(){return navigator?.serviceWorker?.controller||null}function BD(){return fE()?self:null}const mE="firebaseLocalStorageDb",LD=1,_f="firebaseLocalStorage",pE="fbase_key";class td{constructor(e){this.request=e}toPromise(){return new Promise((e,n)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{n(this.request.error)})})}}function Kf(t,e){return t.transaction([_f],e?"readwrite":"readonly").objectStore(_f)}function UD(){const t=indexedDB.deleteDatabase(mE);return new td(t).toPromise()}function ay(){const t=indexedDB.open(mE,LD);return new Promise((e,n)=>{t.addEventListener("error",()=>{n(t.error)}),t.addEventListener("upgradeneeded",()=>{const r=t.result;try{r.createObjectStore(_f,{keyPath:pE})}catch(s){n(s)}}),t.addEventListener("success",async()=>{const r=t.result;r.objectStoreNames.contains(_f)?e(r):(r.close(),await UD(),e(await ay()))})})}async function iw(t,e,n){const r=Kf(t,!0).put({[pE]:e,value:n});return new td(r).toPromise()}async function FD(t,e){const n=Kf(t,!1).get(e),r=await new td(n).toPromise();return r===void 0?null:r.value}function sw(t,e){const n=Kf(t,!0).delete(e);return new td(n).toPromise()}const VD=800,$D=3;class gE{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await ay(),this.db)}async _withRetries(e){let n=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(n++>$D)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return fE()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Qf._getInstance(BD()),this.receiver._subscribe("keyChanged",async(e,n)=>({keyProcessed:(await this._poll()).includes(n.key)})),this.receiver._subscribe("ping",async(e,n)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await PD(),!this.activeServiceWorker)return;this.sender=new MD(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||zD()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await ay();return await iw(e,yf,"1"),await sw(e,yf),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,n){return this._withPendingWrite(async()=>(await this._withRetries(r=>iw(r,e,n)),this.localCache[e]=n,this.notifyServiceWorker(e)))}async _get(e){const n=await this._withRetries(r=>FD(r,e));return this.localCache[e]=n,n}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(n=>sw(n,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const o=Kf(s,!1).getAll();return new td(o).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const n=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:o}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(o)&&(this.notifyListeners(s,o),n.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),n.push(s));return n}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(n)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),VD)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,n){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}gE.type="LOCAL";const HD=gE;new Ju(3e4,6e4);function qD(t,e){return e?ms(e):(Ye(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}class e0 extends Xy{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Ml(e,this._buildIdpRequest())}_linkToIdToken(e,n){return Ml(e,this._buildIdpRequest(n))}_getReauthenticationResolver(e){return Ml(e,this._buildIdpRequest())}_buildIdpRequest(e){const n={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(n.idToken=e),n}}function GD(t){return lE(t.auth,new e0(t),t.bypassAuthState)}function WD(t){const{auth:e,user:n}=t;return Ye(n,e,"internal-error"),wD(n,new e0(t),t.bypassAuthState)}async function QD(t){const{auth:e,user:n}=t;return Ye(n,e,"internal-error"),xD(n,new e0(t),t.bypassAuthState)}class yE{constructor(e,n,r,s,o=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=o,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(n)?n:[n]}execute(){return new Promise(async(e,n)=>{this.pendingPromise={resolve:e,reject:n};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:n,sessionId:r,postBody:s,tenantId:o,error:l,type:d}=e;if(l){this.reject(l);return}const h={auth:this.auth,requestUri:n,sessionId:r,tenantId:o||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(d)(h))}catch(m){this.reject(m)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return GD;case"linkViaPopup":case"linkViaRedirect":return QD;case"reauthViaPopup":case"reauthViaRedirect":return WD;default:si(this.auth,"internal-error")}}resolve(e){xs(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){xs(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const KD=new Ju(2e3,1e4);class Dl extends yE{constructor(e,n,r,s,o){super(e,n,s,o),this.provider=r,this.authWindow=null,this.pollId=null,Dl.currentPopupAction&&Dl.currentPopupAction.cancel(),Dl.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Ye(e,this.auth,"internal-error"),e}async onExecution(){xs(this.filter.length===1,"Popup operations only handle one event");const e=Jy();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(n=>{this.reject(n)}),this.resolver._isIframeWebStorageSupported(this.auth,n=>{n||this.reject(zi(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(zi(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Dl.currentPopupAction=null}pollUserCancellation(){const e=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(zi(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,KD.get())};e()}}Dl.currentPopupAction=null;const YD="pendingRedirect",ef=new Map;class XD extends yE{constructor(e,n,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],n,void 0,r),this.eventId=null}async execute(){let e=ef.get(this.auth._key());if(!e){try{const r=await ZD(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(n){e=()=>Promise.reject(n)}ef.set(this.auth._key(),e)}return this.bypassAuthState||ef.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const n=await this.auth._redirectUserForId(e.eventId);if(n)return this.user=n,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function ZD(t,e){const n=tk(e),r=ek(t);if(!await r._isAvailable())return!1;const s=await r._get(n)==="true";return await r._remove(n),s}function JD(t,e){ef.set(t._key(),e)}function ek(t){return ms(t._redirectPersistence)}function tk(t){return Jh(YD,t.config.apiKey,t.name)}async function nk(t,e,n=!1){if(ti(t.app))return Promise.reject(_a(t));const r=rc(t),s=qD(r,e),l=await new XD(r,s,n).execute();return l&&!n&&(delete l.user._redirectEventId,await r._persistUserIfCurrent(l.user),await r._setRedirectUser(null,e)),l}const rk=600*1e3;class ik{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let n=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(n=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!sk(e)||(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=e,n=!0)),n}sendToConsumer(e,n){if(e.error&&!_E(e)){const r=e.error.code?.split("auth/")[1]||"internal-error";n.onError(zi(this.auth,r))}else n.onAuthEvent(e)}isEventForConsumer(e,n){const r=n.eventId===null||!!e.eventId&&e.eventId===n.eventId;return n.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=rk&&this.cachedEventUids.clear(),this.cachedEventUids.has(aw(e))}saveEventToCache(e){this.cachedEventUids.add(aw(e)),this.lastProcessedEventTime=Date.now()}}function aw(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(e=>e).join("-")}function _E({type:t,error:e}){return t==="unknown"&&e?.code==="auth/no-auth-event"}function sk(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return _E(t);default:return!1}}async function ak(t,e={}){return Ia(t,"GET","/v1/projects",e)}const ok=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,lk=/^https?/;async function ck(t){if(t.config.emulator)return;const{authorizedDomains:e}=await ak(t);for(const n of e)try{if(uk(n))return}catch{}si(t,"unauthorized-domain")}function uk(t){const e=iy(),{protocol:n,hostname:r}=new URL(e);if(t.startsWith("chrome-extension://")){const l=new URL(t);return l.hostname===""&&r===""?n==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):n==="chrome-extension:"&&l.hostname===r}if(!lk.test(n))return!1;if(ok.test(t))return r===t;const s=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}const dk=new Ju(3e4,6e4);function ow(){const t=Bi().___jsl;if(t?.H){for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let n=0;n<t.CP.length;n++)t.CP[n]=null}}function hk(t){return new Promise((e,n)=>{function r(){ow(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{ow(),n(zi(t,"network-request-failed"))},timeout:dk.get()})}if(Bi().gapi?.iframes?.Iframe)e(gapi.iframes.getContext());else if(Bi().gapi?.load)r();else{const s=iD("iframefcb");return Bi()[s]=()=>{gapi.load?r():n(zi(t,"network-request-failed"))},rE(`${rD()}?onload=${s}`).catch(o=>n(o))}}).catch(e=>{throw tf=null,e})}let tf=null;function fk(t){return tf=tf||hk(t),tf}const mk=new Ju(5e3,15e3),pk="__/auth/iframe",gk="emulator/auth/iframe",yk={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},_k=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function bk(t){const e=t.config;Ye(e.authDomain,t,"auth-domain-config-required");const n=e.emulator?Qy(e,gk):`https://${t.config.authDomain}/${pk}`,r={apiKey:e.apiKey,appName:t.name,v:nc},s=_k.get(t.config.apiHost);s&&(r.eid=s);const o=t._getFrameworks();return o.length&&(r.fw=o.join(",")),`${n}?${Zu(r).slice(1)}`}async function vk(t){const e=await fk(t),n=Bi().gapi;return Ye(n,t,"internal-error"),e.open({where:document.body,url:bk(t),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:yk,dontclear:!0},r=>new Promise(async(s,o)=>{await r.restyle({setHideOnLeave:!1});const l=zi(t,"network-request-failed"),d=Bi().setTimeout(()=>{o(l)},mk.get());function h(){Bi().clearTimeout(d),s(r)}r.ping(h).then(h,()=>{o(l)})}))}const xk={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},wk=500,Sk=600,Ek="_blank",Ck="http://localhost";class lw{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function Tk(t,e,n,r=wk,s=Sk){const o=Math.max((window.screen.availHeight-s)/2,0).toString(),l=Math.max((window.screen.availWidth-r)/2,0).toString();let d="";const h={...xk,width:r.toString(),height:s.toString(),top:o,left:l},m=Yn().toLowerCase();n&&(d=Y1(m)?Ek:n),Q1(m)&&(e=e||Ck,h.scrollbars="yes");const p=Object.entries(h).reduce((v,[_,S])=>`${v}${_}=${S},`,"");if(QI(m)&&d!=="_self")return Ak(e||"",d),new lw(null);const g=window.open(e||"",d,p);Ye(g,t,"popup-blocked");try{g.focus()}catch{}return new lw(g)}function Ak(t,e){const n=document.createElement("a");n.href=t,n.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}const jk="__/auth/handler",Rk="emulator/auth/handler",Ik=encodeURIComponent("fac");async function cw(t,e,n,r,s,o){Ye(t.config.authDomain,t,"auth-domain-config-required"),Ye(t.config.apiKey,t,"invalid-api-key");const l={apiKey:t.config.apiKey,appName:t.name,authType:n,redirectUrl:r,v:nc,eventId:s};if(e instanceof aE){e.setDefaultLanguage(t.languageCode),l.providerId=e.providerId||"",gR(e.getCustomParameters())||(l.customParameters=JSON.stringify(e.getCustomParameters()));for(const[p,g]of Object.entries({}))l[p]=g}if(e instanceof ed){const p=e.getScopes().filter(g=>g!=="");p.length>0&&(l.scopes=p.join(","))}t.tenantId&&(l.tid=t.tenantId);const d=l;for(const p of Object.keys(d))d[p]===void 0&&delete d[p];const h=await t._getAppCheckToken(),m=h?`#${Ik}=${encodeURIComponent(h)}`:"";return`${Dk(t)}?${Zu(d).slice(1)}${m}`}function Dk({config:t}){return t.emulator?Qy(t,Rk):`https://${t.authDomain}/${jk}`}const Ng="webStorageSupport";class kk{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=hE,this._completeRedirectFn=nk,this._overrideRedirectResult=JD}async _openPopup(e,n,r,s){xs(this.eventManagers[e._key()]?.manager,"_initialize() not called before _openPopup()");const o=await cw(e,n,r,iy(),s);return Tk(e,o,Jy())}async _openRedirect(e,n,r,s){await this._originValidation(e);const o=await cw(e,n,r,iy(),s);return ND(o),new Promise(()=>{})}_initialize(e){const n=e._key();if(this.eventManagers[n]){const{manager:s,promise:o}=this.eventManagers[n];return s?Promise.resolve(s):(xs(o,"If manager is not set, promise should be"),o)}const r=this.initAndGetManager(e);return this.eventManagers[n]={promise:r},r.catch(()=>{delete this.eventManagers[n]}),r}async initAndGetManager(e){const n=await vk(e),r=new ik(e);return n.register("authEvent",s=>(Ye(s?.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=n,r}_isIframeWebStorageSupported(e,n){this.iframes[e._key()].send(Ng,{type:Ng},s=>{const o=s?.[0]?.[Ng];o!==void 0&&n(!!o),si(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const n=e._key();return this.originValidationPromises[n]||(this.originValidationPromises[n]=ck(e)),this.originValidationPromises[n]}get _shouldInitProactively(){return tE()||K1()||Yy()}}const Ok=kk;var uw="@firebase/auth",dw="1.12.0";class Mk{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const n=this.auth.onIdTokenChanged(r=>{e(r?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,n),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const n=this.internalListeners.get(e);n&&(this.internalListeners.delete(e),n(),this.updateProactiveRefresh())}assertAuthConfigured(){Ye(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function Nk(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function Pk(t){Bl(new bo("auth",(e,{options:n})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),o=e.getProvider("app-check-internal"),{apiKey:l,authDomain:d}=r.options;Ye(l&&!l.includes(":"),"invalid-api-key",{appName:r.name});const h={apiKey:l,authDomain:d,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:nE(t)},m=new eD(r,s,o,h);return uD(m,n),m},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,n,r)=>{e.getProvider("auth-internal").initialize()})),Bl(new bo("auth-internal",e=>{const n=rc(e.getProvider("auth").getImmediate());return(r=>new Mk(r))(n)},"PRIVATE").setInstantiationMode("EXPLICIT")),ya(uw,dw,Nk(t)),ya(uw,dw,"esm2020")}const zk=300,Bk=D1("authIdTokenMaxAge")||zk;let hw=null;const Lk=t=>async e=>{const n=e&&await e.getIdTokenResult(),r=n&&(new Date().getTime()-Date.parse(n.issuedAtTime))/1e3;if(r&&r>Bk)return;const s=n?.token;hw!==s&&(hw=s,await fetch(t,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function Uk(t=z1()){const e=Gy(t,"auth");if(e.isInitialized())return e.getImmediate();const n=cD(t,{popupRedirectResolver:Ok,persistence:[HD,kD,hE]}),r=D1("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const o=new URL(r,location.origin);if(location.origin===o.origin){const l=Lk(o.toString());AD(n,l,()=>l(n.currentUser)),TD(n,d=>l(d))}}const s=R1("auth");return s&&dD(n,`http://${s}`),n}function Fk(){return document.getElementsByTagName("head")?.[0]??document}tD({loadJS(t){return new Promise((e,n)=>{const r=document.createElement("script");r.setAttribute("src",t),r.onload=e,r.onerror=s=>{const o=zi("internal-error");o.customData=s,n(o)},r.type="text/javascript",r.charset="UTF-8",Fk().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});Pk("Browser");var Vk="firebase",$k="12.7.0";ya(Vk,$k,"app");const Hk={apiKey:"AIzaSyCfvR8bEeW2CXdD31Ec34doRNThnbryXJo",authDomain:"budget-tkl.firebaseapp.com",projectId:"budget-tkl",storageBucket:"budget-tkl.firebasestorage.app",messagingSenderId:"631248313026",appId:"1:631248313026:web:36574d789a42b2d102f95b"},bE=P1(Hk);function Da(){const t=Uk(bE);async function e(){return!1}async function n(h,m){return CD(t,h,m)}function r(){return RD(t)}function s(h){jD(t,m=>{h(m)})}function o(){return t.currentUser}function l(){const h=t.currentUser;if(!h)throw new Error("Not authenticated");if(!h.email)throw new Error("Email is required but not available for this account");return h.email}return{set_user_listener:s,delete_firebase_user:e,login_firebase_user:n,logout_firebase_user:r,get_current_firebase_user:o,requireUserEmail:l}}var sc=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(t){return this.listeners.add(t),this.onSubscribe(),()=>{this.listeners.delete(t),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},qk={setTimeout:(t,e)=>setTimeout(t,e),clearTimeout:t=>clearTimeout(t),setInterval:(t,e)=>setInterval(t,e),clearInterval:t=>clearInterval(t)},Gk=class{#e=qk;#t=!1;setTimeoutProvider(t){this.#e=t}setTimeout(t,e){return this.#e.setTimeout(t,e)}clearTimeout(t){this.#e.clearTimeout(t)}setInterval(t,e){return this.#e.setInterval(t,e)}clearInterval(t){this.#e.clearInterval(t)}},ps=new Gk;function Wk(t){setTimeout(t,0)}var xo=typeof window>"u"||"Deno"in globalThis;function Sn(){}function Qk(t,e){return typeof t=="function"?t(e):t}function oy(t){return typeof t=="number"&&t>=0&&t!==1/0}function vE(t,e){return Math.max(t+(e||0)-Date.now(),0)}function ba(t,e){return typeof t=="function"?t(e):t}function Lr(t,e){return typeof t=="function"?t(e):t}function fw(t,e){const{type:n="all",exact:r,fetchStatus:s,predicate:o,queryKey:l,stale:d}=t;if(l){if(r){if(e.queryHash!==t0(l,e.options))return!1}else if(!Nu(e.queryKey,l))return!1}if(n!=="all"){const h=e.isActive();if(n==="active"&&!h||n==="inactive"&&h)return!1}return!(typeof d=="boolean"&&e.isStale()!==d||s&&s!==e.state.fetchStatus||o&&!o(e))}function mw(t,e){const{exact:n,status:r,predicate:s,mutationKey:o}=t;if(o){if(!e.options.mutationKey)return!1;if(n){if(wo(e.options.mutationKey)!==wo(o))return!1}else if(!Nu(e.options.mutationKey,o))return!1}return!(r&&e.state.status!==r||s&&!s(e))}function t0(t,e){return(e?.queryKeyHashFn||wo)(t)}function wo(t){return JSON.stringify(t,(e,n)=>ly(n)?Object.keys(n).sort().reduce((r,s)=>(r[s]=n[s],r),{}):n)}function Nu(t,e){return t===e?!0:typeof t!=typeof e?!1:t&&e&&typeof t=="object"&&typeof e=="object"?Object.keys(e).every(n=>Nu(t[n],e[n])):!1}var Kk=Object.prototype.hasOwnProperty;function xE(t,e){if(t===e)return t;const n=pw(t)&&pw(e);if(!n&&!(ly(t)&&ly(e)))return e;const s=(n?t:Object.keys(t)).length,o=n?e:Object.keys(e),l=o.length,d=n?new Array(l):{};let h=0;for(let m=0;m<l;m++){const p=n?m:o[m],g=t[p],v=e[p];if(g===v){d[p]=g,(n?m<s:Kk.call(t,p))&&h++;continue}if(g===null||v===null||typeof g!="object"||typeof v!="object"){d[p]=v;continue}const _=xE(g,v);d[p]=_,_===g&&h++}return s===l&&h===s?t:d}function bf(t,e){if(!e||Object.keys(t).length!==Object.keys(e).length)return!1;for(const n in t)if(t[n]!==e[n])return!1;return!0}function pw(t){return Array.isArray(t)&&t.length===Object.keys(t).length}function ly(t){if(!gw(t))return!1;const e=t.constructor;if(e===void 0)return!0;const n=e.prototype;return!(!gw(n)||!n.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(t)!==Object.prototype)}function gw(t){return Object.prototype.toString.call(t)==="[object Object]"}function Yk(t){return new Promise(e=>{ps.setTimeout(e,t)})}function cy(t,e,n){return typeof n.structuralSharing=="function"?n.structuralSharing(t,e):n.structuralSharing!==!1?xE(t,e):e}function Xk(t,e,n=0){const r=[...t,e];return n&&r.length>n?r.slice(1):r}function Zk(t,e,n=0){const r=[e,...t];return n&&r.length>n?r.slice(0,-1):r}var n0=Symbol();function wE(t,e){return!t.queryFn&&e?.initialPromise?()=>e.initialPromise:!t.queryFn||t.queryFn===n0?()=>Promise.reject(new Error(`Missing queryFn: '${t.queryHash}'`)):t.queryFn}function SE(t,e){return typeof t=="function"?t(...e):!!t}var Jk=class extends sc{#e;#t;#n;constructor(){super(),this.#n=t=>{if(!xo&&window.addEventListener){const e=()=>t();return window.addEventListener("visibilitychange",e,!1),()=>{window.removeEventListener("visibilitychange",e)}}}}onSubscribe(){this.#t||this.setEventListener(this.#n)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(t){this.#n=t,this.#t?.(),this.#t=t(e=>{typeof e=="boolean"?this.setFocused(e):this.onFocus()})}setFocused(t){this.#e!==t&&(this.#e=t,this.onFocus())}onFocus(){const t=this.isFocused();this.listeners.forEach(e=>{e(t)})}isFocused(){return typeof this.#e=="boolean"?this.#e:globalThis.document?.visibilityState!=="hidden"}},r0=new Jk;function uy(){let t,e;const n=new Promise((s,o)=>{t=s,e=o});n.status="pending",n.catch(()=>{});function r(s){Object.assign(n,s),delete n.resolve,delete n.reject}return n.resolve=s=>{r({status:"fulfilled",value:s}),t(s)},n.reject=s=>{r({status:"rejected",reason:s}),e(s)},n}function eO(t){let e;if(t.then(n=>(e=n,n),Sn)?.catch(Sn),e!==void 0)return{data:e}}function EE(t){return t}function tO(t){return{mutationKey:t.options.mutationKey,state:t.state,...t.options.scope&&{scope:t.options.scope},...t.meta&&{meta:t.meta}}}function nO(t,e,n){const r=()=>{const s=t.promise?.then(e).catch(o=>n(o)?Promise.reject(new Error("redacted")):Promise.reject(o));return s?.catch(Sn),s};return{dehydratedAt:Date.now(),state:{...t.state,...t.state.data!==void 0&&{data:e(t.state.data)}},queryKey:t.queryKey,queryHash:t.queryHash,...t.state.status==="pending"&&{promise:r()},...t.meta&&{meta:t.meta}}}function rO(t){return t.state.isPaused}function iO(t){return t.state.status==="success"}function sO(t){return!0}function aO(t,e={}){const n=e.shouldDehydrateMutation??t.getDefaultOptions().dehydrate?.shouldDehydrateMutation??rO,r=t.getMutationCache().getAll().flatMap(h=>n(h)?[tO(h)]:[]),s=e.shouldDehydrateQuery??t.getDefaultOptions().dehydrate?.shouldDehydrateQuery??iO,o=e.shouldRedactErrors??t.getDefaultOptions().dehydrate?.shouldRedactErrors??sO,l=e.serializeData??t.getDefaultOptions().dehydrate?.serializeData??EE,d=t.getQueryCache().getAll().flatMap(h=>s(h)?[nO(h,l,o)]:[]);return{mutations:r,queries:d}}function oO(t,e,n){if(typeof e!="object"||e===null)return;const r=t.getMutationCache(),s=t.getQueryCache(),o=n?.defaultOptions?.deserializeData??t.getDefaultOptions().hydrate?.deserializeData??EE,l=e.mutations||[],d=e.queries||[];l.forEach(({state:h,...m})=>{r.build(t,{...t.getDefaultOptions().hydrate?.mutations,...n?.defaultOptions?.mutations,...m},h)}),d.forEach(({queryKey:h,state:m,queryHash:p,meta:g,promise:v,dehydratedAt:_})=>{const S=v?eO(v):void 0,x=m.data===void 0?S?.data:m.data,E=x===void 0?x:o(x);let C=s.get(p);const T=C?.state.status==="pending",A=C?.state.fetchStatus==="fetching";if(C){const B=S&&_!==void 0&&_>C.state.dataUpdatedAt;if(m.dataUpdatedAt>C.state.dataUpdatedAt||B){const{fetchStatus:U,...G}=m;C.setState({...G,data:E})}}else C=s.build(t,{...t.getDefaultOptions().hydrate?.queries,...n?.defaultOptions?.queries,queryKey:h,queryHash:p,meta:g},{...m,data:E,fetchStatus:"idle",status:E!==void 0?"success":m.status});v&&!T&&!A&&(_===void 0||_>C.state.dataUpdatedAt)&&C.fetch(void 0,{initialPromise:Promise.resolve(v).then(o)}).catch(Sn)})}var lO=Wk;function cO(){let t=[],e=0,n=d=>{d()},r=d=>{d()},s=lO;const o=d=>{e?t.push(d):s(()=>{n(d)})},l=()=>{const d=t;t=[],d.length&&s(()=>{r(()=>{d.forEach(h=>{n(h)})})})};return{batch:d=>{let h;e++;try{h=d()}finally{e--,e||l()}return h},batchCalls:d=>(...h)=>{o(()=>{d(...h)})},schedule:o,setNotifyFunction:d=>{n=d},setBatchNotifyFunction:d=>{r=d},setScheduler:d=>{s=d}}}var En=cO(),uO=class extends sc{#e=!0;#t;#n;constructor(){super(),this.#n=t=>{if(!xo&&window.addEventListener){const e=()=>t(!0),n=()=>t(!1);return window.addEventListener("online",e,!1),window.addEventListener("offline",n,!1),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",n)}}}}onSubscribe(){this.#t||this.setEventListener(this.#n)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(t){this.#n=t,this.#t?.(),this.#t=t(this.setOnline.bind(this))}setOnline(t){this.#e!==t&&(this.#e=t,this.listeners.forEach(n=>{n(t)}))}isOnline(){return this.#e}},vf=new uO;function dO(t){return Math.min(1e3*2**t,3e4)}function CE(t){return(t??"online")==="online"?vf.isOnline():!0}var dy=class extends Error{constructor(t){super("CancelledError"),this.revert=t?.revert,this.silent=t?.silent}};function TE(t){let e=!1,n=0,r;const s=uy(),o=()=>s.status!=="pending",l=x=>{if(!o()){const E=new dy(x);v(E),t.onCancel?.(E)}},d=()=>{e=!0},h=()=>{e=!1},m=()=>r0.isFocused()&&(t.networkMode==="always"||vf.isOnline())&&t.canRun(),p=()=>CE(t.networkMode)&&t.canRun(),g=x=>{o()||(r?.(),s.resolve(x))},v=x=>{o()||(r?.(),s.reject(x))},_=()=>new Promise(x=>{r=E=>{(o()||m())&&x(E)},t.onPause?.()}).then(()=>{r=void 0,o()||t.onContinue?.()}),S=()=>{if(o())return;let x;const E=n===0?t.initialPromise:void 0;try{x=E??t.fn()}catch(C){x=Promise.reject(C)}Promise.resolve(x).then(g).catch(C=>{if(o())return;const T=t.retry??(xo?0:3),A=t.retryDelay??dO,B=typeof A=="function"?A(n,C):A,U=T===!0||typeof T=="number"&&n<T||typeof T=="function"&&T(n,C);if(e||!U){v(C);return}n++,t.onFail?.(n,C),Yk(B).then(()=>m()?void 0:_()).then(()=>{e?v(C):S()})})};return{promise:s,status:()=>s.status,cancel:l,continue:()=>(r?.(),s),cancelRetry:d,continueRetry:h,canStart:p,start:()=>(p()?S():_().then(S),s)}}var AE=class{#e;destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),oy(this.gcTime)&&(this.#e=ps.setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(t){this.gcTime=Math.max(this.gcTime||0,t??(xo?1/0:300*1e3))}clearGcTimeout(){this.#e&&(ps.clearTimeout(this.#e),this.#e=void 0)}},hO=class extends AE{#e;#t;#n;#i;#r;#a;#o;constructor(e){super(),this.#o=!1,this.#a=e.defaultOptions,this.setOptions(e.options),this.observers=[],this.#i=e.client,this.#n=this.#i.getQueryCache(),this.queryKey=e.queryKey,this.queryHash=e.queryHash,this.#e=_w(this.options),this.state=e.state??this.#e,this.scheduleGc()}get meta(){return this.options.meta}get promise(){return this.#r?.promise}setOptions(e){if(this.options={...this.#a,...e},this.updateGcTime(this.options.gcTime),this.state&&this.state.data===void 0){const n=_w(this.options);n.data!==void 0&&(this.setState(yw(n.data,n.dataUpdatedAt)),this.#e=n)}}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&this.#n.remove(this)}setData(e,n){const r=cy(this.state.data,e,this.options);return this.#s({data:r,type:"success",dataUpdatedAt:n?.updatedAt,manual:n?.manual}),r}setState(e,n){this.#s({type:"setState",state:e,setStateOptions:n})}cancel(e){const n=this.#r?.promise;return this.#r?.cancel(e),n?n.then(Sn).catch(Sn):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(this.#e)}isActive(){return this.observers.some(e=>Lr(e.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===n0||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(e=>ba(e.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(e=>e.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(e=0){return this.state.data===void 0?!0:e==="static"?!1:this.state.isInvalidated?!0:!vE(this.state.dataUpdatedAt,e)}onFocus(){this.observers.find(n=>n.shouldFetchOnWindowFocus())?.refetch({cancelRefetch:!1}),this.#r?.continue()}onOnline(){this.observers.find(n=>n.shouldFetchOnReconnect())?.refetch({cancelRefetch:!1}),this.#r?.continue()}addObserver(e){this.observers.includes(e)||(this.observers.push(e),this.clearGcTimeout(),this.#n.notify({type:"observerAdded",query:this,observer:e}))}removeObserver(e){this.observers.includes(e)&&(this.observers=this.observers.filter(n=>n!==e),this.observers.length||(this.#r&&(this.#o?this.#r.cancel({revert:!0}):this.#r.cancelRetry()),this.scheduleGc()),this.#n.notify({type:"observerRemoved",query:this,observer:e}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||this.#s({type:"invalidate"})}async fetch(e,n){if(this.state.fetchStatus!=="idle"&&this.#r?.status()!=="rejected"){if(this.state.data!==void 0&&n?.cancelRefetch)this.cancel({silent:!0});else if(this.#r)return this.#r.continueRetry(),this.#r.promise}if(e&&this.setOptions(e),!this.options.queryFn){const h=this.observers.find(m=>m.options.queryFn);h&&this.setOptions(h.options)}const r=new AbortController,s=h=>{Object.defineProperty(h,"signal",{enumerable:!0,get:()=>(this.#o=!0,r.signal)})},o=()=>{const h=wE(this.options,n),p=(()=>{const g={client:this.#i,queryKey:this.queryKey,meta:this.meta};return s(g),g})();return this.#o=!1,this.options.persister?this.options.persister(h,p,this):h(p)},d=(()=>{const h={fetchOptions:n,options:this.options,queryKey:this.queryKey,client:this.#i,state:this.state,fetchFn:o};return s(h),h})();this.options.behavior?.onFetch(d,this),this.#t=this.state,(this.state.fetchStatus==="idle"||this.state.fetchMeta!==d.fetchOptions?.meta)&&this.#s({type:"fetch",meta:d.fetchOptions?.meta}),this.#r=TE({initialPromise:n?.initialPromise,fn:d.fetchFn,onCancel:h=>{h instanceof dy&&h.revert&&this.setState({...this.#t,fetchStatus:"idle"}),r.abort()},onFail:(h,m)=>{this.#s({type:"failed",failureCount:h,error:m})},onPause:()=>{this.#s({type:"pause"})},onContinue:()=>{this.#s({type:"continue"})},retry:d.options.retry,retryDelay:d.options.retryDelay,networkMode:d.options.networkMode,canRun:()=>!0});try{const h=await this.#r.start();if(h===void 0)throw new Error(`${this.queryHash} data is undefined`);return this.setData(h),this.#n.config.onSuccess?.(h,this),this.#n.config.onSettled?.(h,this.state.error,this),h}catch(h){if(h instanceof dy){if(h.silent)return this.#r.promise;if(h.revert){if(this.state.data===void 0)throw h;return this.state.data}}throw this.#s({type:"error",error:h}),this.#n.config.onError?.(h,this),this.#n.config.onSettled?.(this.state.data,h,this),h}finally{this.scheduleGc()}}#s(e){const n=r=>{switch(e.type){case"failed":return{...r,fetchFailureCount:e.failureCount,fetchFailureReason:e.error};case"pause":return{...r,fetchStatus:"paused"};case"continue":return{...r,fetchStatus:"fetching"};case"fetch":return{...r,...jE(r.data,this.options),fetchMeta:e.meta??null};case"success":const s={...r,...yw(e.data,e.dataUpdatedAt),dataUpdateCount:r.dataUpdateCount+1,...!e.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return this.#t=e.manual?s:void 0,s;case"error":const o=e.error;return{...r,error:o,errorUpdateCount:r.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:r.fetchFailureCount+1,fetchFailureReason:o,fetchStatus:"idle",status:"error"};case"invalidate":return{...r,isInvalidated:!0};case"setState":return{...r,...e.state}}};this.state=n(this.state),En.batch(()=>{this.observers.forEach(r=>{r.onQueryUpdate()}),this.#n.notify({query:this,type:"updated",action:e})})}};function jE(t,e){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:CE(e.networkMode)?"fetching":"paused",...t===void 0&&{error:null,status:"pending"}}}function yw(t,e){return{data:t,dataUpdatedAt:e??Date.now(),error:null,isInvalidated:!1,status:"success"}}function _w(t){const e=typeof t.initialData=="function"?t.initialData():t.initialData,n=e!==void 0,r=n?typeof t.initialDataUpdatedAt=="function"?t.initialDataUpdatedAt():t.initialDataUpdatedAt:0;return{data:e,dataUpdateCount:0,dataUpdatedAt:n?r??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:n?"success":"pending",fetchStatus:"idle"}}var fO=class extends sc{constructor(t,e){super(),this.options=e,this.#e=t,this.#s=null,this.#o=uy(),this.bindMethods(),this.setOptions(e)}#e;#t=void 0;#n=void 0;#i=void 0;#r;#a;#o;#s;#p;#h;#f;#c;#u;#l;#m=new Set;bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(this.#t.addObserver(this),bw(this.#t,this.options)?this.#d():this.updateResult(),this.#b())}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return hy(this.#t,this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return hy(this.#t,this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,this.#v(),this.#x(),this.#t.removeObserver(this)}setOptions(t){const e=this.options,n=this.#t;if(this.options=this.#e.defaultQueryOptions(t),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof Lr(this.options.enabled,this.#t)!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");this.#w(),this.#t.setOptions(this.options),e._defaulted&&!bf(this.options,e)&&this.#e.getQueryCache().notify({type:"observerOptionsUpdated",query:this.#t,observer:this});const r=this.hasListeners();r&&vw(this.#t,n,this.options,e)&&this.#d(),this.updateResult(),r&&(this.#t!==n||Lr(this.options.enabled,this.#t)!==Lr(e.enabled,this.#t)||ba(this.options.staleTime,this.#t)!==ba(e.staleTime,this.#t))&&this.#g();const s=this.#y();r&&(this.#t!==n||Lr(this.options.enabled,this.#t)!==Lr(e.enabled,this.#t)||s!==this.#l)&&this.#_(s)}getOptimisticResult(t){const e=this.#e.getQueryCache().build(this.#e,t),n=this.createResult(e,t);return pO(this,n)&&(this.#i=n,this.#a=this.options,this.#r=this.#t.state),n}getCurrentResult(){return this.#i}trackResult(t,e){return new Proxy(t,{get:(n,r)=>(this.trackProp(r),e?.(r),r==="promise"&&(this.trackProp("data"),!this.options.experimental_prefetchInRender&&this.#o.status==="pending"&&this.#o.reject(new Error("experimental_prefetchInRender feature flag is not enabled"))),Reflect.get(n,r))})}trackProp(t){this.#m.add(t)}getCurrentQuery(){return this.#t}refetch({...t}={}){return this.fetch({...t})}fetchOptimistic(t){const e=this.#e.defaultQueryOptions(t),n=this.#e.getQueryCache().build(this.#e,e);return n.fetch().then(()=>this.createResult(n,e))}fetch(t){return this.#d({...t,cancelRefetch:t.cancelRefetch??!0}).then(()=>(this.updateResult(),this.#i))}#d(t){this.#w();let e=this.#t.fetch(this.options,t);return t?.throwOnError||(e=e.catch(Sn)),e}#g(){this.#v();const t=ba(this.options.staleTime,this.#t);if(xo||this.#i.isStale||!oy(t))return;const n=vE(this.#i.dataUpdatedAt,t)+1;this.#c=ps.setTimeout(()=>{this.#i.isStale||this.updateResult()},n)}#y(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(this.#t):this.options.refetchInterval)??!1}#_(t){this.#x(),this.#l=t,!(xo||Lr(this.options.enabled,this.#t)===!1||!oy(this.#l)||this.#l===0)&&(this.#u=ps.setInterval(()=>{(this.options.refetchIntervalInBackground||r0.isFocused())&&this.#d()},this.#l))}#b(){this.#g(),this.#_(this.#y())}#v(){this.#c&&(ps.clearTimeout(this.#c),this.#c=void 0)}#x(){this.#u&&(ps.clearInterval(this.#u),this.#u=void 0)}createResult(t,e){const n=this.#t,r=this.options,s=this.#i,o=this.#r,l=this.#a,h=t!==n?t.state:this.#n,{state:m}=t;let p={...m},g=!1,v;if(e._optimisticResults){const D=this.hasListeners(),N=!D&&bw(t,e),F=D&&vw(t,n,e,r);(N||F)&&(p={...p,...jE(m.data,t.options)}),e._optimisticResults==="isRestoring"&&(p.fetchStatus="idle")}let{error:_,errorUpdatedAt:S,status:x}=p;v=p.data;let E=!1;if(e.placeholderData!==void 0&&v===void 0&&x==="pending"){let D;s?.isPlaceholderData&&e.placeholderData===l?.placeholderData?(D=s.data,E=!0):D=typeof e.placeholderData=="function"?e.placeholderData(this.#f?.state.data,this.#f):e.placeholderData,D!==void 0&&(x="success",v=cy(s?.data,D,e),g=!0)}if(e.select&&v!==void 0&&!E)if(s&&v===o?.data&&e.select===this.#p)v=this.#h;else try{this.#p=e.select,v=e.select(v),v=cy(s?.data,v,e),this.#h=v,this.#s=null}catch(D){this.#s=D}this.#s&&(_=this.#s,v=this.#h,S=Date.now(),x="error");const C=p.fetchStatus==="fetching",T=x==="pending",A=x==="error",B=T&&C,U=v!==void 0,k={status:x,fetchStatus:p.fetchStatus,isPending:T,isSuccess:x==="success",isError:A,isInitialLoading:B,isLoading:B,data:v,dataUpdatedAt:p.dataUpdatedAt,error:_,errorUpdatedAt:S,failureCount:p.fetchFailureCount,failureReason:p.fetchFailureReason,errorUpdateCount:p.errorUpdateCount,isFetched:p.dataUpdateCount>0||p.errorUpdateCount>0,isFetchedAfterMount:p.dataUpdateCount>h.dataUpdateCount||p.errorUpdateCount>h.errorUpdateCount,isFetching:C,isRefetching:C&&!T,isLoadingError:A&&!U,isPaused:p.fetchStatus==="paused",isPlaceholderData:g,isRefetchError:A&&U,isStale:i0(t,e),refetch:this.refetch,promise:this.#o,isEnabled:Lr(e.enabled,t)!==!1};if(this.options.experimental_prefetchInRender){const D=H=>{k.status==="error"?H.reject(k.error):k.data!==void 0&&H.resolve(k.data)},N=()=>{const H=this.#o=k.promise=uy();D(H)},F=this.#o;switch(F.status){case"pending":t.queryHash===n.queryHash&&D(F);break;case"fulfilled":(k.status==="error"||k.data!==F.value)&&N();break;case"rejected":(k.status!=="error"||k.error!==F.reason)&&N();break}}return k}updateResult(){const t=this.#i,e=this.createResult(this.#t,this.options);if(this.#r=this.#t.state,this.#a=this.options,this.#r.data!==void 0&&(this.#f=this.#t),bf(e,t))return;this.#i=e;const n=()=>{if(!t)return!0;const{notifyOnChangeProps:r}=this.options,s=typeof r=="function"?r():r;if(s==="all"||!s&&!this.#m.size)return!0;const o=new Set(s??this.#m);return this.options.throwOnError&&o.add("error"),Object.keys(this.#i).some(l=>{const d=l;return this.#i[d]!==t[d]&&o.has(d)})};this.#S({listeners:n()})}#w(){const t=this.#e.getQueryCache().build(this.#e,this.options);if(t===this.#t)return;const e=this.#t;this.#t=t,this.#n=t.state,this.hasListeners()&&(e?.removeObserver(this),t.addObserver(this))}onQueryUpdate(){this.updateResult(),this.hasListeners()&&this.#b()}#S(t){En.batch(()=>{t.listeners&&this.listeners.forEach(e=>{e(this.#i)}),this.#e.getQueryCache().notify({query:this.#t,type:"observerResultsUpdated"})})}};function mO(t,e){return Lr(e.enabled,t)!==!1&&t.state.data===void 0&&!(t.state.status==="error"&&e.retryOnMount===!1)}function bw(t,e){return mO(t,e)||t.state.data!==void 0&&hy(t,e,e.refetchOnMount)}function hy(t,e,n){if(Lr(e.enabled,t)!==!1&&ba(e.staleTime,t)!=="static"){const r=typeof n=="function"?n(t):n;return r==="always"||r!==!1&&i0(t,e)}return!1}function vw(t,e,n,r){return(t!==e||Lr(r.enabled,t)===!1)&&(!n.suspense||t.state.status!=="error")&&i0(t,n)}function i0(t,e){return Lr(e.enabled,t)!==!1&&t.isStaleByTime(ba(e.staleTime,t))}function pO(t,e){return!bf(t.getCurrentResult(),e)}function xw(t){return{onFetch:(e,n)=>{const r=e.options,s=e.fetchOptions?.meta?.fetchMore?.direction,o=e.state.data?.pages||[],l=e.state.data?.pageParams||[];let d={pages:[],pageParams:[]},h=0;const m=async()=>{let p=!1;const g=S=>{Object.defineProperty(S,"signal",{enumerable:!0,get:()=>(e.signal.aborted?p=!0:e.signal.addEventListener("abort",()=>{p=!0}),e.signal)})},v=wE(e.options,e.fetchOptions),_=async(S,x,E)=>{if(p)return Promise.reject();if(x==null&&S.pages.length)return Promise.resolve(S);const T=(()=>{const G={client:e.client,queryKey:e.queryKey,pageParam:x,direction:E?"backward":"forward",meta:e.options.meta};return g(G),G})(),A=await v(T),{maxPages:B}=e.options,U=E?Zk:Xk;return{pages:U(S.pages,A,B),pageParams:U(S.pageParams,x,B)}};if(s&&o.length){const S=s==="backward",x=S?gO:ww,E={pages:o,pageParams:l},C=x(r,E);d=await _(E,C,S)}else{const S=t??o.length;do{const x=h===0?l[0]??r.initialPageParam:ww(r,d);if(h>0&&x==null)break;d=await _(d,x),h++}while(h<S)}return d};e.options.persister?e.fetchFn=()=>e.options.persister?.(m,{client:e.client,queryKey:e.queryKey,meta:e.options.meta,signal:e.signal},n):e.fetchFn=m}}}function ww(t,{pages:e,pageParams:n}){const r=e.length-1;return e.length>0?t.getNextPageParam(e[r],e,n[r],n):void 0}function gO(t,{pages:e,pageParams:n}){return e.length>0?t.getPreviousPageParam?.(e[0],e,n[0],n):void 0}var yO=class extends AE{#e;#t;#n;#i;constructor(e){super(),this.#e=e.client,this.mutationId=e.mutationId,this.#n=e.mutationCache,this.#t=[],this.state=e.state||RE(),this.setOptions(e.options),this.scheduleGc()}setOptions(e){this.options=e,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(e){this.#t.includes(e)||(this.#t.push(e),this.clearGcTimeout(),this.#n.notify({type:"observerAdded",mutation:this,observer:e}))}removeObserver(e){this.#t=this.#t.filter(n=>n!==e),this.scheduleGc(),this.#n.notify({type:"observerRemoved",mutation:this,observer:e})}optionalRemove(){this.#t.length||(this.state.status==="pending"?this.scheduleGc():this.#n.remove(this))}continue(){return this.#i?.continue()??this.execute(this.state.variables)}async execute(e){const n=()=>{this.#r({type:"continue"})},r={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};this.#i=TE({fn:()=>this.options.mutationFn?this.options.mutationFn(e,r):Promise.reject(new Error("No mutationFn found")),onFail:(l,d)=>{this.#r({type:"failed",failureCount:l,error:d})},onPause:()=>{this.#r({type:"pause"})},onContinue:n,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>this.#n.canRun(this)});const s=this.state.status==="pending",o=!this.#i.canStart();try{if(s)n();else{this.#r({type:"pending",variables:e,isPaused:o}),await this.#n.config.onMutate?.(e,this,r);const d=await this.options.onMutate?.(e,r);d!==this.state.context&&this.#r({type:"pending",context:d,variables:e,isPaused:o})}const l=await this.#i.start();return await this.#n.config.onSuccess?.(l,e,this.state.context,this,r),await this.options.onSuccess?.(l,e,this.state.context,r),await this.#n.config.onSettled?.(l,null,this.state.variables,this.state.context,this,r),await this.options.onSettled?.(l,null,e,this.state.context,r),this.#r({type:"success",data:l}),l}catch(l){try{throw await this.#n.config.onError?.(l,e,this.state.context,this,r),await this.options.onError?.(l,e,this.state.context,r),await this.#n.config.onSettled?.(void 0,l,this.state.variables,this.state.context,this,r),await this.options.onSettled?.(void 0,l,e,this.state.context,r),l}finally{this.#r({type:"error",error:l})}}finally{this.#n.runNext(this)}}#r(e){const n=r=>{switch(e.type){case"failed":return{...r,failureCount:e.failureCount,failureReason:e.error};case"pause":return{...r,isPaused:!0};case"continue":return{...r,isPaused:!1};case"pending":return{...r,context:e.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:e.isPaused,status:"pending",variables:e.variables,submittedAt:Date.now()};case"success":return{...r,data:e.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...r,data:void 0,error:e.error,failureCount:r.failureCount+1,failureReason:e.error,isPaused:!1,status:"error"}}};this.state=n(this.state),En.batch(()=>{this.#t.forEach(r=>{r.onMutationUpdate(e)}),this.#n.notify({mutation:this,type:"updated",action:e})})}};function RE(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var _O=class extends sc{constructor(t={}){super(),this.config=t,this.#e=new Set,this.#t=new Map,this.#n=0}#e;#t;#n;build(t,e,n){const r=new yO({client:t,mutationCache:this,mutationId:++this.#n,options:t.defaultMutationOptions(e),state:n});return this.add(r),r}add(t){this.#e.add(t);const e=Vh(t);if(typeof e=="string"){const n=this.#t.get(e);n?n.push(t):this.#t.set(e,[t])}this.notify({type:"added",mutation:t})}remove(t){if(this.#e.delete(t)){const e=Vh(t);if(typeof e=="string"){const n=this.#t.get(e);if(n)if(n.length>1){const r=n.indexOf(t);r!==-1&&n.splice(r,1)}else n[0]===t&&this.#t.delete(e)}}this.notify({type:"removed",mutation:t})}canRun(t){const e=Vh(t);if(typeof e=="string"){const r=this.#t.get(e)?.find(s=>s.state.status==="pending");return!r||r===t}else return!0}runNext(t){const e=Vh(t);return typeof e=="string"?this.#t.get(e)?.find(r=>r!==t&&r.state.isPaused)?.continue()??Promise.resolve():Promise.resolve()}clear(){En.batch(()=>{this.#e.forEach(t=>{this.notify({type:"removed",mutation:t})}),this.#e.clear(),this.#t.clear()})}getAll(){return Array.from(this.#e)}find(t){const e={exact:!0,...t};return this.getAll().find(n=>mw(e,n))}findAll(t={}){return this.getAll().filter(e=>mw(t,e))}notify(t){En.batch(()=>{this.listeners.forEach(e=>{e(t)})})}resumePausedMutations(){const t=this.getAll().filter(e=>e.state.isPaused);return En.batch(()=>Promise.all(t.map(e=>e.continue().catch(Sn))))}};function Vh(t){return t.options.scope?.id}var bO=class extends sc{#e;#t=void 0;#n;#i;constructor(e,n){super(),this.#e=e,this.setOptions(n),this.bindMethods(),this.#r()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){const n=this.options;this.options=this.#e.defaultMutationOptions(e),bf(this.options,n)||this.#e.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#n,observer:this}),n?.mutationKey&&this.options.mutationKey&&wo(n.mutationKey)!==wo(this.options.mutationKey)?this.reset():this.#n?.state.status==="pending"&&this.#n.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#n?.removeObserver(this)}onMutationUpdate(e){this.#r(),this.#a(e)}getCurrentResult(){return this.#t}reset(){this.#n?.removeObserver(this),this.#n=void 0,this.#r(),this.#a()}mutate(e,n){return this.#i=n,this.#n?.removeObserver(this),this.#n=this.#e.getMutationCache().build(this.#e,this.options),this.#n.addObserver(this),this.#n.execute(e)}#r(){const e=this.#n?.state??RE();this.#t={...e,isPending:e.status==="pending",isSuccess:e.status==="success",isError:e.status==="error",isIdle:e.status==="idle",mutate:this.mutate,reset:this.reset}}#a(e){En.batch(()=>{if(this.#i&&this.hasListeners()){const n=this.#t.variables,r=this.#t.context,s={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};e?.type==="success"?(this.#i.onSuccess?.(e.data,n,r,s),this.#i.onSettled?.(e.data,null,n,r,s)):e?.type==="error"&&(this.#i.onError?.(e.error,n,r,s),this.#i.onSettled?.(void 0,e.error,n,r,s))}this.listeners.forEach(n=>{n(this.#t)})})}},vO=class extends sc{constructor(t={}){super(),this.config=t,this.#e=new Map}#e;build(t,e,n){const r=e.queryKey,s=e.queryHash??t0(r,e);let o=this.get(s);return o||(o=new hO({client:t,queryKey:r,queryHash:s,options:t.defaultQueryOptions(e),state:n,defaultOptions:t.getQueryDefaults(r)}),this.add(o)),o}add(t){this.#e.has(t.queryHash)||(this.#e.set(t.queryHash,t),this.notify({type:"added",query:t}))}remove(t){const e=this.#e.get(t.queryHash);e&&(t.destroy(),e===t&&this.#e.delete(t.queryHash),this.notify({type:"removed",query:t}))}clear(){En.batch(()=>{this.getAll().forEach(t=>{this.remove(t)})})}get(t){return this.#e.get(t)}getAll(){return[...this.#e.values()]}find(t){const e={exact:!0,...t};return this.getAll().find(n=>fw(e,n))}findAll(t={}){const e=this.getAll();return Object.keys(t).length>0?e.filter(n=>fw(t,n)):e}notify(t){En.batch(()=>{this.listeners.forEach(e=>{e(t)})})}onFocus(){En.batch(()=>{this.getAll().forEach(t=>{t.onFocus()})})}onOnline(){En.batch(()=>{this.getAll().forEach(t=>{t.onOnline()})})}},xO=class{#e;#t;#n;#i;#r;#a;#o;#s;constructor(t={}){this.#e=t.queryCache||new vO,this.#t=t.mutationCache||new _O,this.#n=t.defaultOptions||{},this.#i=new Map,this.#r=new Map,this.#a=0}mount(){this.#a++,this.#a===1&&(this.#o=r0.subscribe(async t=>{t&&(await this.resumePausedMutations(),this.#e.onFocus())}),this.#s=vf.subscribe(async t=>{t&&(await this.resumePausedMutations(),this.#e.onOnline())}))}unmount(){this.#a--,this.#a===0&&(this.#o?.(),this.#o=void 0,this.#s?.(),this.#s=void 0)}isFetching(t){return this.#e.findAll({...t,fetchStatus:"fetching"}).length}isMutating(t){return this.#t.findAll({...t,status:"pending"}).length}getQueryData(t){const e=this.defaultQueryOptions({queryKey:t});return this.#e.get(e.queryHash)?.state.data}ensureQueryData(t){const e=this.defaultQueryOptions(t),n=this.#e.build(this,e),r=n.state.data;return r===void 0?this.fetchQuery(t):(t.revalidateIfStale&&n.isStaleByTime(ba(e.staleTime,n))&&this.prefetchQuery(e),Promise.resolve(r))}getQueriesData(t){return this.#e.findAll(t).map(({queryKey:e,state:n})=>{const r=n.data;return[e,r]})}setQueryData(t,e,n){const r=this.defaultQueryOptions({queryKey:t}),o=this.#e.get(r.queryHash)?.state.data,l=Qk(e,o);if(l!==void 0)return this.#e.build(this,r).setData(l,{...n,manual:!0})}setQueriesData(t,e,n){return En.batch(()=>this.#e.findAll(t).map(({queryKey:r})=>[r,this.setQueryData(r,e,n)]))}getQueryState(t){const e=this.defaultQueryOptions({queryKey:t});return this.#e.get(e.queryHash)?.state}removeQueries(t){const e=this.#e;En.batch(()=>{e.findAll(t).forEach(n=>{e.remove(n)})})}resetQueries(t,e){const n=this.#e;return En.batch(()=>(n.findAll(t).forEach(r=>{r.reset()}),this.refetchQueries({type:"active",...t},e)))}cancelQueries(t,e={}){const n={revert:!0,...e},r=En.batch(()=>this.#e.findAll(t).map(s=>s.cancel(n)));return Promise.all(r).then(Sn).catch(Sn)}invalidateQueries(t,e={}){return En.batch(()=>(this.#e.findAll(t).forEach(n=>{n.invalidate()}),t?.refetchType==="none"?Promise.resolve():this.refetchQueries({...t,type:t?.refetchType??t?.type??"active"},e)))}refetchQueries(t,e={}){const n={...e,cancelRefetch:e.cancelRefetch??!0},r=En.batch(()=>this.#e.findAll(t).filter(s=>!s.isDisabled()&&!s.isStatic()).map(s=>{let o=s.fetch(void 0,n);return n.throwOnError||(o=o.catch(Sn)),s.state.fetchStatus==="paused"?Promise.resolve():o}));return Promise.all(r).then(Sn)}fetchQuery(t){const e=this.defaultQueryOptions(t);e.retry===void 0&&(e.retry=!1);const n=this.#e.build(this,e);return n.isStaleByTime(ba(e.staleTime,n))?n.fetch(e):Promise.resolve(n.state.data)}prefetchQuery(t){return this.fetchQuery(t).then(Sn).catch(Sn)}fetchInfiniteQuery(t){return t.behavior=xw(t.pages),this.fetchQuery(t)}prefetchInfiniteQuery(t){return this.fetchInfiniteQuery(t).then(Sn).catch(Sn)}ensureInfiniteQueryData(t){return t.behavior=xw(t.pages),this.ensureQueryData(t)}resumePausedMutations(){return vf.isOnline()?this.#t.resumePausedMutations():Promise.resolve()}getQueryCache(){return this.#e}getMutationCache(){return this.#t}getDefaultOptions(){return this.#n}setDefaultOptions(t){this.#n=t}setQueryDefaults(t,e){this.#i.set(wo(t),{queryKey:t,defaultOptions:e})}getQueryDefaults(t){const e=[...this.#i.values()],n={};return e.forEach(r=>{Nu(t,r.queryKey)&&Object.assign(n,r.defaultOptions)}),n}setMutationDefaults(t,e){this.#r.set(wo(t),{mutationKey:t,defaultOptions:e})}getMutationDefaults(t){const e=[...this.#r.values()],n={};return e.forEach(r=>{Nu(t,r.mutationKey)&&Object.assign(n,r.defaultOptions)}),n}defaultQueryOptions(t){if(t._defaulted)return t;const e={...this.#n.queries,...this.getQueryDefaults(t.queryKey),...t,_defaulted:!0};return e.queryHash||(e.queryHash=t0(e.queryKey,e)),e.refetchOnReconnect===void 0&&(e.refetchOnReconnect=e.networkMode!=="always"),e.throwOnError===void 0&&(e.throwOnError=!!e.suspense),!e.networkMode&&e.persister&&(e.networkMode="offlineFirst"),e.queryFn===n0&&(e.enabled=!1),e}defaultMutationOptions(t){return t?._defaulted?t:{...this.#n.mutations,...t?.mutationKey&&this.getMutationDefaults(t.mutationKey),...t,_defaulted:!0}}clear(){this.#e.clear(),this.#t.clear()}},IE=O.createContext(void 0),ln=t=>{const e=O.useContext(IE);if(!e)throw new Error("No QueryClient set, use QueryClientProvider to set one");return e},DE=({client:t,children:e})=>(O.useEffect(()=>(t.mount(),()=>{t.unmount()}),[t]),u.jsx(IE.Provider,{value:t,children:e})),kE=O.createContext(!1),wO=()=>O.useContext(kE),SO=kE.Provider;function EO(){let t=!1;return{clearReset:()=>{t=!1},reset:()=>{t=!0},isReset:()=>t}}var CO=O.createContext(EO()),TO=()=>O.useContext(CO),AO=(t,e)=>{(t.suspense||t.throwOnError||t.experimental_prefetchInRender)&&(e.isReset()||(t.retryOnMount=!1))},jO=t=>{O.useEffect(()=>{t.clearReset()},[t])},RO=({result:t,errorResetBoundary:e,throwOnError:n,query:r,suspense:s})=>t.isError&&!e.isReset()&&!t.isFetching&&r&&(s&&t.data===void 0||SE(n,[t.error,r])),IO=t=>{if(t.suspense){const n=s=>s==="static"?s:Math.max(s??1e3,1e3),r=t.staleTime;t.staleTime=typeof r=="function"?(...s)=>n(r(...s)):n(r),typeof t.gcTime=="number"&&(t.gcTime=Math.max(t.gcTime,1e3))}},DO=(t,e)=>t.isLoading&&t.isFetching&&!e,kO=(t,e)=>t?.suspense&&e.isPending,Sw=(t,e,n)=>e.fetchOptimistic(t).catch(()=>{n.clearReset()});function OO(t,e,n){const r=wO(),s=TO(),o=ln(),l=o.defaultQueryOptions(t);o.getDefaultOptions().queries?._experimental_beforeQuery?.(l),l._optimisticResults=r?"isRestoring":"optimistic",IO(l),AO(l,s),jO(s);const d=!o.getQueryCache().get(l.queryHash),[h]=O.useState(()=>new e(o,l)),m=h.getOptimisticResult(l),p=!r&&t.subscribed!==!1;if(O.useSyncExternalStore(O.useCallback(g=>{const v=p?h.subscribe(En.batchCalls(g)):Sn;return h.updateResult(),v},[h,p]),()=>h.getCurrentResult(),()=>h.getCurrentResult()),O.useEffect(()=>{h.setOptions(l)},[l,h]),kO(l,m))throw Sw(l,h,s);if(RO({result:m,errorResetBoundary:s,throwOnError:l.throwOnError,query:o.getQueryCache().get(l.queryHash),suspense:l.suspense}))throw m.error;return o.getDefaultOptions().queries?._experimental_afterQuery?.(l,m),l.experimental_prefetchInRender&&!xo&&DO(m,r)&&(d?Sw(l,h,s):o.getQueryCache().get(l.queryHash)?.promise)?.catch(Sn).finally(()=>{h.updateResult()}),l.notifyOnChangeProps?m:h.trackResult(m)}function ac(t,e){return OO(t,fO)}function $n(t,e){const n=ln(),[r]=O.useState(()=>new bO(n,t));O.useEffect(()=>{r.setOptions(t)},[r,t]);const s=O.useSyncExternalStore(O.useCallback(l=>r.subscribe(En.batchCalls(l)),[r]),()=>r.getCurrentResult(),()=>r.getCurrentResult()),o=O.useCallback((l,d)=>{r.mutate(l,d).catch(Sn)},[r]);if(s.error&&SE(r.options.throwOnError,[s.error]))throw s.error;return{...s,mutate:o,mutateAsync:s.mutate}}function fy(){}function MO(t,{interval:e=1e3,onError:n=fy}={}){if(typeof t!="function")throw new Error("argument is not function.");let r=0,s=null,o=!1,l=!1;return async(...d)=>{if(s=d,!l){for(l=!0;o;)await new Promise(h=>ps.setTimeout(h,e));for(;Date.now()<r;)await new Promise(h=>ps.setTimeout(h,r-Date.now()));l=!1,o=!0;try{await t(...s)}catch(h){try{n(h)}catch{}}r=Date.now()+e,o=!1}}}var NO=({storage:t,key:e="REACT_QUERY_OFFLINE_CACHE",throttleTime:n=1e3,serialize:r=JSON.stringify,deserialize:s=JSON.parse,retry:o})=>{if(t){const l=async d=>{try{const h=await r(d);await t.setItem(e,h);return}catch(h){return h}};return{persistClient:MO(async d=>{let h=d,m=await l(h),p=0;for(;m&&h;)p++,h=await o?.({persistedClient:h,error:m,errorCount:p}),h&&(m=await l(h))},{interval:n}),restoreClient:async()=>{const d=await t.getItem(e);if(d)return await s(d)},removeClient:()=>t.removeItem(e)}}return{persistClient:fy,restoreClient:()=>Promise.resolve(void 0),removeClient:fy}};const OE=300*1e3,PO=1800*1e3,Ze=new xO({defaultOptions:{queries:{staleTime:OE,gcTime:PO,refetchOnWindowFocus:!1,refetchOnReconnect:!0,retry:1,refetchOnMount:!0},mutations:{retry:1}}});Ze.getQueryCache().subscribe(t=>{const e=t?.query;if(e&&t.type==="updated"){const{state:n}=e;n.status==="error"&&n.error&&console.error("[RQ] Query FAILED:",e.queryKey,n.error)}});const zO=NO({storage:typeof window<"u"?{getItem:t=>Promise.resolve(localStorage.getItem(t)),setItem:(t,e)=>Promise.resolve(localStorage.setItem(t,e)),removeItem:t=>Promise.resolve(localStorage.removeItem(t))}:void 0,key:"BUDGET_APP_QUERY_CACHE"}),Pe={user:t=>["user",t],budget:t=>["budget",t],month:(t,e,n)=>["month",t,e,n],payees:t=>["payees",t],accessibleBudgets:t=>["accessibleBudgets",t],feedback:()=>["feedback"]};var BO=["added","removed","updated"];function Ew(t){return BO.includes(t)}async function LO({queryClient:t,persister:e,maxAge:n=1e3*60*60*24,buster:r="",hydrateOptions:s}){try{const o=await e.restoreClient();if(o)if(o.timestamp){const l=Date.now()-o.timestamp>n,d=o.buster!==r;if(l||d)return e.removeClient();oO(t,o.clientState,s)}else return e.removeClient()}catch(o){throw await e.removeClient(),o}}async function Cw({queryClient:t,persister:e,buster:n="",dehydrateOptions:r}){const s={buster:n,timestamp:Date.now(),clientState:aO(t,r)};await e.persistClient(s)}function UO(t){const e=t.queryClient.getQueryCache().subscribe(r=>{Ew(r.type)&&Cw(t)}),n=t.queryClient.getMutationCache().subscribe(r=>{Ew(r.type)&&Cw(t)});return()=>{e(),n()}}var FO=({children:t,persistOptions:e,onSuccess:n,onError:r,...s})=>{const[o,l]=O.useState(!0),d=O.useRef({persistOptions:e,onSuccess:n,onError:r}),h=O.useRef(!1);return O.useEffect(()=>{d.current={persistOptions:e,onSuccess:n,onError:r}}),O.useEffect(()=>{const m={...d.current.persistOptions,queryClient:s.client};return h.current||(h.current=!0,LO(m).then(()=>d.current.onSuccess?.()).catch(()=>d.current.onError?.()).finally(()=>{l(!1)})),o?void 0:UO(m)},[s.client,o]),u.jsx(DE,{...s,children:u.jsx(SO,{value:o,children:t})})};function VO(){return typeof window>"u"?!1:new URLSearchParams(window.location.search).get("cacheBust")==="1"}function $O(){if(typeof window>"u")return;const t=new URL(window.location.href);t.searchParams.has("cacheBust")&&(t.searchParams.delete("cacheBust"),window.history.replaceState({},"",t.toString()))}function HO({children:t}){const[e]=O.useState(()=>VO());return O.useEffect(()=>{e&&$O()},[e]),e?u.jsx(DE,{client:Ze,children:t}):u.jsx(FO,{client:Ze,persistOptions:{persister:zO,maxAge:300*1e3,buster:"v3"},children:t})}var Tw=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var va,ME;(function(){var t;function e(k,D){function N(){}N.prototype=D.prototype,k.F=D.prototype,k.prototype=new N,k.prototype.constructor=k,k.D=function(F,H,j){for(var M=Array(arguments.length-2),R=2;R<arguments.length;R++)M[R-2]=arguments[R];return D.prototype[H].apply(F,M)}}function n(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(r,n),r.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(k,D,N){N||(N=0);const F=Array(16);if(typeof D=="string")for(var H=0;H<16;++H)F[H]=D.charCodeAt(N++)|D.charCodeAt(N++)<<8|D.charCodeAt(N++)<<16|D.charCodeAt(N++)<<24;else for(H=0;H<16;++H)F[H]=D[N++]|D[N++]<<8|D[N++]<<16|D[N++]<<24;D=k.g[0],N=k.g[1],H=k.g[2];let j=k.g[3],M;M=D+(j^N&(H^j))+F[0]+3614090360&4294967295,D=N+(M<<7&4294967295|M>>>25),M=j+(H^D&(N^H))+F[1]+3905402710&4294967295,j=D+(M<<12&4294967295|M>>>20),M=H+(N^j&(D^N))+F[2]+606105819&4294967295,H=j+(M<<17&4294967295|M>>>15),M=N+(D^H&(j^D))+F[3]+3250441966&4294967295,N=H+(M<<22&4294967295|M>>>10),M=D+(j^N&(H^j))+F[4]+4118548399&4294967295,D=N+(M<<7&4294967295|M>>>25),M=j+(H^D&(N^H))+F[5]+1200080426&4294967295,j=D+(M<<12&4294967295|M>>>20),M=H+(N^j&(D^N))+F[6]+2821735955&4294967295,H=j+(M<<17&4294967295|M>>>15),M=N+(D^H&(j^D))+F[7]+4249261313&4294967295,N=H+(M<<22&4294967295|M>>>10),M=D+(j^N&(H^j))+F[8]+1770035416&4294967295,D=N+(M<<7&4294967295|M>>>25),M=j+(H^D&(N^H))+F[9]+2336552879&4294967295,j=D+(M<<12&4294967295|M>>>20),M=H+(N^j&(D^N))+F[10]+4294925233&4294967295,H=j+(M<<17&4294967295|M>>>15),M=N+(D^H&(j^D))+F[11]+2304563134&4294967295,N=H+(M<<22&4294967295|M>>>10),M=D+(j^N&(H^j))+F[12]+1804603682&4294967295,D=N+(M<<7&4294967295|M>>>25),M=j+(H^D&(N^H))+F[13]+4254626195&4294967295,j=D+(M<<12&4294967295|M>>>20),M=H+(N^j&(D^N))+F[14]+2792965006&4294967295,H=j+(M<<17&4294967295|M>>>15),M=N+(D^H&(j^D))+F[15]+1236535329&4294967295,N=H+(M<<22&4294967295|M>>>10),M=D+(H^j&(N^H))+F[1]+4129170786&4294967295,D=N+(M<<5&4294967295|M>>>27),M=j+(N^H&(D^N))+F[6]+3225465664&4294967295,j=D+(M<<9&4294967295|M>>>23),M=H+(D^N&(j^D))+F[11]+643717713&4294967295,H=j+(M<<14&4294967295|M>>>18),M=N+(j^D&(H^j))+F[0]+3921069994&4294967295,N=H+(M<<20&4294967295|M>>>12),M=D+(H^j&(N^H))+F[5]+3593408605&4294967295,D=N+(M<<5&4294967295|M>>>27),M=j+(N^H&(D^N))+F[10]+38016083&4294967295,j=D+(M<<9&4294967295|M>>>23),M=H+(D^N&(j^D))+F[15]+3634488961&4294967295,H=j+(M<<14&4294967295|M>>>18),M=N+(j^D&(H^j))+F[4]+3889429448&4294967295,N=H+(M<<20&4294967295|M>>>12),M=D+(H^j&(N^H))+F[9]+568446438&4294967295,D=N+(M<<5&4294967295|M>>>27),M=j+(N^H&(D^N))+F[14]+3275163606&4294967295,j=D+(M<<9&4294967295|M>>>23),M=H+(D^N&(j^D))+F[3]+4107603335&4294967295,H=j+(M<<14&4294967295|M>>>18),M=N+(j^D&(H^j))+F[8]+1163531501&4294967295,N=H+(M<<20&4294967295|M>>>12),M=D+(H^j&(N^H))+F[13]+2850285829&4294967295,D=N+(M<<5&4294967295|M>>>27),M=j+(N^H&(D^N))+F[2]+4243563512&4294967295,j=D+(M<<9&4294967295|M>>>23),M=H+(D^N&(j^D))+F[7]+1735328473&4294967295,H=j+(M<<14&4294967295|M>>>18),M=N+(j^D&(H^j))+F[12]+2368359562&4294967295,N=H+(M<<20&4294967295|M>>>12),M=D+(N^H^j)+F[5]+4294588738&4294967295,D=N+(M<<4&4294967295|M>>>28),M=j+(D^N^H)+F[8]+2272392833&4294967295,j=D+(M<<11&4294967295|M>>>21),M=H+(j^D^N)+F[11]+1839030562&4294967295,H=j+(M<<16&4294967295|M>>>16),M=N+(H^j^D)+F[14]+4259657740&4294967295,N=H+(M<<23&4294967295|M>>>9),M=D+(N^H^j)+F[1]+2763975236&4294967295,D=N+(M<<4&4294967295|M>>>28),M=j+(D^N^H)+F[4]+1272893353&4294967295,j=D+(M<<11&4294967295|M>>>21),M=H+(j^D^N)+F[7]+4139469664&4294967295,H=j+(M<<16&4294967295|M>>>16),M=N+(H^j^D)+F[10]+3200236656&4294967295,N=H+(M<<23&4294967295|M>>>9),M=D+(N^H^j)+F[13]+681279174&4294967295,D=N+(M<<4&4294967295|M>>>28),M=j+(D^N^H)+F[0]+3936430074&4294967295,j=D+(M<<11&4294967295|M>>>21),M=H+(j^D^N)+F[3]+3572445317&4294967295,H=j+(M<<16&4294967295|M>>>16),M=N+(H^j^D)+F[6]+76029189&4294967295,N=H+(M<<23&4294967295|M>>>9),M=D+(N^H^j)+F[9]+3654602809&4294967295,D=N+(M<<4&4294967295|M>>>28),M=j+(D^N^H)+F[12]+3873151461&4294967295,j=D+(M<<11&4294967295|M>>>21),M=H+(j^D^N)+F[15]+530742520&4294967295,H=j+(M<<16&4294967295|M>>>16),M=N+(H^j^D)+F[2]+3299628645&4294967295,N=H+(M<<23&4294967295|M>>>9),M=D+(H^(N|~j))+F[0]+4096336452&4294967295,D=N+(M<<6&4294967295|M>>>26),M=j+(N^(D|~H))+F[7]+1126891415&4294967295,j=D+(M<<10&4294967295|M>>>22),M=H+(D^(j|~N))+F[14]+2878612391&4294967295,H=j+(M<<15&4294967295|M>>>17),M=N+(j^(H|~D))+F[5]+4237533241&4294967295,N=H+(M<<21&4294967295|M>>>11),M=D+(H^(N|~j))+F[12]+1700485571&4294967295,D=N+(M<<6&4294967295|M>>>26),M=j+(N^(D|~H))+F[3]+2399980690&4294967295,j=D+(M<<10&4294967295|M>>>22),M=H+(D^(j|~N))+F[10]+4293915773&4294967295,H=j+(M<<15&4294967295|M>>>17),M=N+(j^(H|~D))+F[1]+2240044497&4294967295,N=H+(M<<21&4294967295|M>>>11),M=D+(H^(N|~j))+F[8]+1873313359&4294967295,D=N+(M<<6&4294967295|M>>>26),M=j+(N^(D|~H))+F[15]+4264355552&4294967295,j=D+(M<<10&4294967295|M>>>22),M=H+(D^(j|~N))+F[6]+2734768916&4294967295,H=j+(M<<15&4294967295|M>>>17),M=N+(j^(H|~D))+F[13]+1309151649&4294967295,N=H+(M<<21&4294967295|M>>>11),M=D+(H^(N|~j))+F[4]+4149444226&4294967295,D=N+(M<<6&4294967295|M>>>26),M=j+(N^(D|~H))+F[11]+3174756917&4294967295,j=D+(M<<10&4294967295|M>>>22),M=H+(D^(j|~N))+F[2]+718787259&4294967295,H=j+(M<<15&4294967295|M>>>17),M=N+(j^(H|~D))+F[9]+3951481745&4294967295,k.g[0]=k.g[0]+D&4294967295,k.g[1]=k.g[1]+(H+(M<<21&4294967295|M>>>11))&4294967295,k.g[2]=k.g[2]+H&4294967295,k.g[3]=k.g[3]+j&4294967295}r.prototype.v=function(k,D){D===void 0&&(D=k.length);const N=D-this.blockSize,F=this.C;let H=this.h,j=0;for(;j<D;){if(H==0)for(;j<=N;)s(this,k,j),j+=this.blockSize;if(typeof k=="string"){for(;j<D;)if(F[H++]=k.charCodeAt(j++),H==this.blockSize){s(this,F),H=0;break}}else for(;j<D;)if(F[H++]=k[j++],H==this.blockSize){s(this,F),H=0;break}}this.h=H,this.o+=D},r.prototype.A=function(){var k=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);k[0]=128;for(var D=1;D<k.length-8;++D)k[D]=0;D=this.o*8;for(var N=k.length-8;N<k.length;++N)k[N]=D&255,D/=256;for(this.v(k),k=Array(16),D=0,N=0;N<4;++N)for(let F=0;F<32;F+=8)k[D++]=this.g[N]>>>F&255;return k};function o(k,D){var N=d;return Object.prototype.hasOwnProperty.call(N,k)?N[k]:N[k]=D(k)}function l(k,D){this.h=D;const N=[];let F=!0;for(let H=k.length-1;H>=0;H--){const j=k[H]|0;F&&j==D||(N[H]=j,F=!1)}this.g=N}var d={};function h(k){return-128<=k&&k<128?o(k,function(D){return new l([D|0],D<0?-1:0)}):new l([k|0],k<0?-1:0)}function m(k){if(isNaN(k)||!isFinite(k))return g;if(k<0)return E(m(-k));const D=[];let N=1;for(let F=0;k>=N;F++)D[F]=k/N|0,N*=4294967296;return new l(D,0)}function p(k,D){if(k.length==0)throw Error("number format error: empty string");if(D=D||10,D<2||36<D)throw Error("radix out of range: "+D);if(k.charAt(0)=="-")return E(p(k.substring(1),D));if(k.indexOf("-")>=0)throw Error('number format error: interior "-" character');const N=m(Math.pow(D,8));let F=g;for(let j=0;j<k.length;j+=8){var H=Math.min(8,k.length-j);const M=parseInt(k.substring(j,j+H),D);H<8?(H=m(Math.pow(D,H)),F=F.j(H).add(m(M))):(F=F.j(N),F=F.add(m(M)))}return F}var g=h(0),v=h(1),_=h(16777216);t=l.prototype,t.m=function(){if(x(this))return-E(this).m();let k=0,D=1;for(let N=0;N<this.g.length;N++){const F=this.i(N);k+=(F>=0?F:4294967296+F)*D,D*=4294967296}return k},t.toString=function(k){if(k=k||10,k<2||36<k)throw Error("radix out of range: "+k);if(S(this))return"0";if(x(this))return"-"+E(this).toString(k);const D=m(Math.pow(k,6));var N=this;let F="";for(;;){const H=B(N,D).g;N=C(N,H.j(D));let j=((N.g.length>0?N.g[0]:N.h)>>>0).toString(k);if(N=H,S(N))return j+F;for(;j.length<6;)j="0"+j;F=j+F}},t.i=function(k){return k<0?0:k<this.g.length?this.g[k]:this.h};function S(k){if(k.h!=0)return!1;for(let D=0;D<k.g.length;D++)if(k.g[D]!=0)return!1;return!0}function x(k){return k.h==-1}t.l=function(k){return k=C(this,k),x(k)?-1:S(k)?0:1};function E(k){const D=k.g.length,N=[];for(let F=0;F<D;F++)N[F]=~k.g[F];return new l(N,~k.h).add(v)}t.abs=function(){return x(this)?E(this):this},t.add=function(k){const D=Math.max(this.g.length,k.g.length),N=[];let F=0;for(let H=0;H<=D;H++){let j=F+(this.i(H)&65535)+(k.i(H)&65535),M=(j>>>16)+(this.i(H)>>>16)+(k.i(H)>>>16);F=M>>>16,j&=65535,M&=65535,N[H]=M<<16|j}return new l(N,N[N.length-1]&-2147483648?-1:0)};function C(k,D){return k.add(E(D))}t.j=function(k){if(S(this)||S(k))return g;if(x(this))return x(k)?E(this).j(E(k)):E(E(this).j(k));if(x(k))return E(this.j(E(k)));if(this.l(_)<0&&k.l(_)<0)return m(this.m()*k.m());const D=this.g.length+k.g.length,N=[];for(var F=0;F<2*D;F++)N[F]=0;for(F=0;F<this.g.length;F++)for(let H=0;H<k.g.length;H++){const j=this.i(F)>>>16,M=this.i(F)&65535,R=k.i(H)>>>16,K=k.i(H)&65535;N[2*F+2*H]+=M*K,T(N,2*F+2*H),N[2*F+2*H+1]+=j*K,T(N,2*F+2*H+1),N[2*F+2*H+1]+=M*R,T(N,2*F+2*H+1),N[2*F+2*H+2]+=j*R,T(N,2*F+2*H+2)}for(k=0;k<D;k++)N[k]=N[2*k+1]<<16|N[2*k];for(k=D;k<2*D;k++)N[k]=0;return new l(N,0)};function T(k,D){for(;(k[D]&65535)!=k[D];)k[D+1]+=k[D]>>>16,k[D]&=65535,D++}function A(k,D){this.g=k,this.h=D}function B(k,D){if(S(D))throw Error("division by zero");if(S(k))return new A(g,g);if(x(k))return D=B(E(k),D),new A(E(D.g),E(D.h));if(x(D))return D=B(k,E(D)),new A(E(D.g),D.h);if(k.g.length>30){if(x(k)||x(D))throw Error("slowDivide_ only works with positive integers.");for(var N=v,F=D;F.l(k)<=0;)N=U(N),F=U(F);var H=G(N,1),j=G(F,1);for(F=G(F,2),N=G(N,2);!S(F);){var M=j.add(F);M.l(k)<=0&&(H=H.add(N),j=M),F=G(F,1),N=G(N,1)}return D=C(k,H.j(D)),new A(H,D)}for(H=g;k.l(D)>=0;){for(N=Math.max(1,Math.floor(k.m()/D.m())),F=Math.ceil(Math.log(N)/Math.LN2),F=F<=48?1:Math.pow(2,F-48),j=m(N),M=j.j(D);x(M)||M.l(k)>0;)N-=F,j=m(N),M=j.j(D);S(j)&&(j=v),H=H.add(j),k=C(k,M)}return new A(H,k)}t.B=function(k){return B(this,k).h},t.and=function(k){const D=Math.max(this.g.length,k.g.length),N=[];for(let F=0;F<D;F++)N[F]=this.i(F)&k.i(F);return new l(N,this.h&k.h)},t.or=function(k){const D=Math.max(this.g.length,k.g.length),N=[];for(let F=0;F<D;F++)N[F]=this.i(F)|k.i(F);return new l(N,this.h|k.h)},t.xor=function(k){const D=Math.max(this.g.length,k.g.length),N=[];for(let F=0;F<D;F++)N[F]=this.i(F)^k.i(F);return new l(N,this.h^k.h)};function U(k){const D=k.g.length+1,N=[];for(let F=0;F<D;F++)N[F]=k.i(F)<<1|k.i(F-1)>>>31;return new l(N,k.h)}function G(k,D){const N=D>>5;D%=32;const F=k.g.length-N,H=[];for(let j=0;j<F;j++)H[j]=D>0?k.i(j+N)>>>D|k.i(j+N+1)<<32-D:k.i(j+N);return new l(H,k.h)}r.prototype.digest=r.prototype.A,r.prototype.reset=r.prototype.u,r.prototype.update=r.prototype.v,ME=r,l.prototype.add=l.prototype.add,l.prototype.multiply=l.prototype.j,l.prototype.modulo=l.prototype.B,l.prototype.compare=l.prototype.l,l.prototype.toNumber=l.prototype.m,l.prototype.toString=l.prototype.toString,l.prototype.getBits=l.prototype.i,l.fromNumber=m,l.fromString=p,va=l}).apply(typeof Tw<"u"?Tw:typeof self<"u"?self:typeof window<"u"?window:{});var $h=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var NE,xu,PE,nf,my,zE,BE,LE;(function(){var t,e=Object.defineProperty;function n(y){y=[typeof globalThis=="object"&&globalThis,y,typeof window=="object"&&window,typeof self=="object"&&self,typeof $h=="object"&&$h];for(var I=0;I<y.length;++I){var V=y[I];if(V&&V.Math==Math)return V}throw Error("Cannot find global object")}var r=n(this);function s(y,I){if(I)e:{var V=r;y=y.split(".");for(var Y=0;Y<y.length-1;Y++){var de=y[Y];if(!(de in V))break e;V=V[de]}y=y[y.length-1],Y=V[y],I=I(Y),I!=Y&&I!=null&&e(V,y,{configurable:!0,writable:!0,value:I})}}s("Symbol.dispose",function(y){return y||Symbol("Symbol.dispose")}),s("Array.prototype.values",function(y){return y||function(){return this[Symbol.iterator]()}}),s("Object.entries",function(y){return y||function(I){var V=[],Y;for(Y in I)Object.prototype.hasOwnProperty.call(I,Y)&&V.push([Y,I[Y]]);return V}});var o=o||{},l=this||self;function d(y){var I=typeof y;return I=="object"&&y!=null||I=="function"}function h(y,I,V){return y.call.apply(y.bind,arguments)}function m(y,I,V){return m=h,m.apply(null,arguments)}function p(y,I){var V=Array.prototype.slice.call(arguments,1);return function(){var Y=V.slice();return Y.push.apply(Y,arguments),y.apply(this,Y)}}function g(y,I){function V(){}V.prototype=I.prototype,y.Z=I.prototype,y.prototype=new V,y.prototype.constructor=y,y.Ob=function(Y,de,_e){for(var ze=Array(arguments.length-2),st=2;st<arguments.length;st++)ze[st-2]=arguments[st];return I.prototype[de].apply(Y,ze)}}var v=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?y=>y&&AsyncContext.Snapshot.wrap(y):y=>y;function _(y){const I=y.length;if(I>0){const V=Array(I);for(let Y=0;Y<I;Y++)V[Y]=y[Y];return V}return[]}function S(y,I){for(let Y=1;Y<arguments.length;Y++){const de=arguments[Y];var V=typeof de;if(V=V!="object"?V:de?Array.isArray(de)?"array":V:"null",V=="array"||V=="object"&&typeof de.length=="number"){V=y.length||0;const _e=de.length||0;y.length=V+_e;for(let ze=0;ze<_e;ze++)y[V+ze]=de[ze]}else y.push(de)}}class x{constructor(I,V){this.i=I,this.j=V,this.h=0,this.g=null}get(){let I;return this.h>0?(this.h--,I=this.g,this.g=I.next,I.next=null):I=this.i(),I}}function E(y){l.setTimeout(()=>{throw y},0)}function C(){var y=k;let I=null;return y.g&&(I=y.g,y.g=y.g.next,y.g||(y.h=null),I.next=null),I}class T{constructor(){this.h=this.g=null}add(I,V){const Y=A.get();Y.set(I,V),this.h?this.h.next=Y:this.g=Y,this.h=Y}}var A=new x(()=>new B,y=>y.reset());class B{constructor(){this.next=this.g=this.h=null}set(I,V){this.h=I,this.g=V,this.next=null}reset(){this.next=this.g=this.h=null}}let U,G=!1,k=new T,D=()=>{const y=Promise.resolve(void 0);U=()=>{y.then(N)}};function N(){for(var y;y=C();){try{y.h.call(y.g)}catch(V){E(V)}var I=A;I.j(y),I.h<100&&(I.h++,y.next=I.g,I.g=y)}G=!1}function F(){this.u=this.u,this.C=this.C}F.prototype.u=!1,F.prototype.dispose=function(){this.u||(this.u=!0,this.N())},F.prototype[Symbol.dispose]=function(){this.dispose()},F.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function H(y,I){this.type=y,this.g=this.target=I,this.defaultPrevented=!1}H.prototype.h=function(){this.defaultPrevented=!0};var j=(function(){if(!l.addEventListener||!Object.defineProperty)return!1;var y=!1,I=Object.defineProperty({},"passive",{get:function(){y=!0}});try{const V=()=>{};l.addEventListener("test",V,I),l.removeEventListener("test",V,I)}catch{}return y})();function M(y){return/^[\s\xa0]*$/.test(y)}function R(y,I){H.call(this,y?y.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,y&&this.init(y,I)}g(R,H),R.prototype.init=function(y,I){const V=this.type=y.type,Y=y.changedTouches&&y.changedTouches.length?y.changedTouches[0]:null;this.target=y.target||y.srcElement,this.g=I,I=y.relatedTarget,I||(V=="mouseover"?I=y.fromElement:V=="mouseout"&&(I=y.toElement)),this.relatedTarget=I,Y?(this.clientX=Y.clientX!==void 0?Y.clientX:Y.pageX,this.clientY=Y.clientY!==void 0?Y.clientY:Y.pageY,this.screenX=Y.screenX||0,this.screenY=Y.screenY||0):(this.clientX=y.clientX!==void 0?y.clientX:y.pageX,this.clientY=y.clientY!==void 0?y.clientY:y.pageY,this.screenX=y.screenX||0,this.screenY=y.screenY||0),this.button=y.button,this.key=y.key||"",this.ctrlKey=y.ctrlKey,this.altKey=y.altKey,this.shiftKey=y.shiftKey,this.metaKey=y.metaKey,this.pointerId=y.pointerId||0,this.pointerType=y.pointerType,this.state=y.state,this.i=y,y.defaultPrevented&&R.Z.h.call(this)},R.prototype.h=function(){R.Z.h.call(this);const y=this.i;y.preventDefault?y.preventDefault():y.returnValue=!1};var K="closure_listenable_"+(Math.random()*1e6|0),W=0;function q(y,I,V,Y,de){this.listener=y,this.proxy=null,this.src=I,this.type=V,this.capture=!!Y,this.ha=de,this.key=++W,this.da=this.fa=!1}function J(y){y.da=!0,y.listener=null,y.proxy=null,y.src=null,y.ha=null}function Z(y,I,V){for(const Y in y)I.call(V,y[Y],Y,y)}function re(y,I){for(const V in y)I.call(void 0,y[V],V,y)}function P(y){const I={};for(const V in y)I[V]=y[V];return I}const $="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function te(y,I){let V,Y;for(let de=1;de<arguments.length;de++){Y=arguments[de];for(V in Y)y[V]=Y[V];for(let _e=0;_e<$.length;_e++)V=$[_e],Object.prototype.hasOwnProperty.call(Y,V)&&(y[V]=Y[V])}}function se(y){this.src=y,this.g={},this.h=0}se.prototype.add=function(y,I,V,Y,de){const _e=y.toString();y=this.g[_e],y||(y=this.g[_e]=[],this.h++);const ze=ye(y,I,Y,de);return ze>-1?(I=y[ze],V||(I.fa=!1)):(I=new q(I,this.src,_e,!!Y,de),I.fa=V,y.push(I)),I};function ae(y,I){const V=I.type;if(V in y.g){var Y=y.g[V],de=Array.prototype.indexOf.call(Y,I,void 0),_e;(_e=de>=0)&&Array.prototype.splice.call(Y,de,1),_e&&(J(I),y.g[V].length==0&&(delete y.g[V],y.h--))}}function ye(y,I,V,Y){for(let de=0;de<y.length;++de){const _e=y[de];if(!_e.da&&_e.listener==I&&_e.capture==!!V&&_e.ha==Y)return de}return-1}var Ie="closure_lm_"+(Math.random()*1e6|0),Ee={};function Ce(y,I,V,Y,de){if(Array.isArray(I)){for(let _e=0;_e<I.length;_e++)Ce(y,I[_e],V,Y,de);return null}return V=X(V),y&&y[K]?y.J(I,V,d(Y)?!!Y.capture:!1,de):pe(y,I,V,!1,Y,de)}function pe(y,I,V,Y,de,_e){if(!I)throw Error("Invalid event type");const ze=d(de)?!!de.capture:!!de;let st=me(y);if(st||(y[Ie]=st=new se(y)),V=st.add(I,V,Y,ze,_e),V.proxy)return V;if(Y=Ue(),V.proxy=Y,Y.src=y,Y.listener=V,y.addEventListener)j||(de=ze),de===void 0&&(de=!1),y.addEventListener(I.toString(),Y,de);else if(y.attachEvent)y.attachEvent(L(I.toString()),Y);else if(y.addListener&&y.removeListener)y.addListener(Y);else throw Error("addEventListener and attachEvent are unavailable.");return V}function Ue(){function y(V){return I.call(y.src,y.listener,V)}const I=be;return y}function He(y,I,V,Y,de){if(Array.isArray(I))for(var _e=0;_e<I.length;_e++)He(y,I[_e],V,Y,de);else Y=d(Y)?!!Y.capture:!!Y,V=X(V),y&&y[K]?(y=y.i,_e=String(I).toString(),_e in y.g&&(I=y.g[_e],V=ye(I,V,Y,de),V>-1&&(J(I[V]),Array.prototype.splice.call(I,V,1),I.length==0&&(delete y.g[_e],y.h--)))):y&&(y=me(y))&&(I=y.g[I.toString()],y=-1,I&&(y=ye(I,V,Y,de)),(V=y>-1?I[y]:null)&&Me(V))}function Me(y){if(typeof y!="number"&&y&&!y.da){var I=y.src;if(I&&I[K])ae(I.i,y);else{var V=y.type,Y=y.proxy;I.removeEventListener?I.removeEventListener(V,Y,y.capture):I.detachEvent?I.detachEvent(L(V),Y):I.addListener&&I.removeListener&&I.removeListener(Y),(V=me(I))?(ae(V,y),V.h==0&&(V.src=null,I[Ie]=null)):J(y)}}}function L(y){return y in Ee?Ee[y]:Ee[y]="on"+y}function be(y,I){if(y.da)y=!0;else{I=new R(I,this);const V=y.listener,Y=y.ha||y.src;y.fa&&Me(y),y=V.call(Y,I)}return y}function me(y){return y=y[Ie],y instanceof se?y:null}var ee="__closure_events_fn_"+(Math.random()*1e9>>>0);function X(y){return typeof y=="function"?y:(y[ee]||(y[ee]=function(I){return y.handleEvent(I)}),y[ee])}function ie(){F.call(this),this.i=new se(this),this.M=this,this.G=null}g(ie,F),ie.prototype[K]=!0,ie.prototype.removeEventListener=function(y,I,V,Y){He(this,y,I,V,Y)};function we(y,I){var V,Y=y.G;if(Y)for(V=[];Y;Y=Y.G)V.push(Y);if(y=y.M,Y=I.type||I,typeof I=="string")I=new H(I,y);else if(I instanceof H)I.target=I.target||y;else{var de=I;I=new H(Y,y),te(I,de)}de=!0;let _e,ze;if(V)for(ze=V.length-1;ze>=0;ze--)_e=I.g=V[ze],de=xe(_e,Y,!0,I)&&de;if(_e=I.g=y,de=xe(_e,Y,!0,I)&&de,de=xe(_e,Y,!1,I)&&de,V)for(ze=0;ze<V.length;ze++)_e=I.g=V[ze],de=xe(_e,Y,!1,I)&&de}ie.prototype.N=function(){if(ie.Z.N.call(this),this.i){var y=this.i;for(const I in y.g){const V=y.g[I];for(let Y=0;Y<V.length;Y++)J(V[Y]);delete y.g[I],y.h--}}this.G=null},ie.prototype.J=function(y,I,V,Y){return this.i.add(String(y),I,!1,V,Y)},ie.prototype.K=function(y,I,V,Y){return this.i.add(String(y),I,!0,V,Y)};function xe(y,I,V,Y){if(I=y.i.g[String(I)],!I)return!0;I=I.concat();let de=!0;for(let _e=0;_e<I.length;++_e){const ze=I[_e];if(ze&&!ze.da&&ze.capture==V){const st=ze.listener,nn=ze.ha||ze.src;ze.fa&&ae(y.i,ze),de=st.call(nn,Y)!==!1&&de}}return de&&!Y.defaultPrevented}function oe(y,I){if(typeof y!="function")if(y&&typeof y.handleEvent=="function")y=m(y.handleEvent,y);else throw Error("Invalid listener argument");return Number(I)>2147483647?-1:l.setTimeout(y,I||0)}function Ae(y){y.g=oe(()=>{y.g=null,y.i&&(y.i=!1,Ae(y))},y.l);const I=y.h;y.h=null,y.m.apply(null,I)}class Ne extends F{constructor(I,V){super(),this.m=I,this.l=V,this.h=null,this.i=!1,this.g=null}j(I){this.h=arguments,this.g?this.i=!0:Ae(this)}N(){super.N(),this.g&&(l.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ke(y){F.call(this),this.h=y,this.g={}}g(ke,F);var qe=[];function vt(y){Z(y.g,function(I,V){this.g.hasOwnProperty(V)&&Me(I)},y),y.g={}}ke.prototype.N=function(){ke.Z.N.call(this),vt(this)},ke.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var rt=l.JSON.stringify,Hn=l.JSON.parse,ui=class{stringify(y){return l.JSON.stringify(y,void 0)}parse(y){return l.JSON.parse(y,void 0)}};function Xn(){}function di(){}var _t={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function Zt(){H.call(this,"d")}g(Zt,H);function qn(){H.call(this,"c")}g(qn,H);var St={},za=null;function js(){return za=za||new ie}St.Ia="serverreachability";function Po(y){H.call(this,St.Ia,y)}g(Po,H);function Tr(y){const I=js();we(I,new Po(I))}St.STAT_EVENT="statevent";function hi(y,I){H.call(this,St.STAT_EVENT,y),this.stat=I}g(hi,H);function Bt(y){const I=js();we(I,new hi(I,y))}St.Ja="timingevent";function Zn(y,I){H.call(this,St.Ja,y),this.size=I}g(Zn,H);function fi(y,I){if(typeof y!="function")throw Error("Fn must not be null and must be a function");return l.setTimeout(function(){y()},I)}function Hr(){this.g=!0}Hr.prototype.ua=function(){this.g=!1};function Em(y,I,V,Y,de,_e){y.info(function(){if(y.g)if(_e){var ze="",st=_e.split("&");for(let Et=0;Et<st.length;Et++){var nn=st[Et].split("=");if(nn.length>1){const Gt=nn[0];nn=nn[1];const Ir=Gt.split("_");ze=Ir.length>=2&&Ir[1]=="type"?ze+(Gt+"="+nn+"&"):ze+(Gt+"=redacted&")}}}else ze=null;else ze=_e;return"XMLHTTP REQ ("+Y+") [attempt "+de+"]: "+I+`
`+V+`
`+ze})}function gd(y,I,V,Y,de,_e,ze){y.info(function(){return"XMLHTTP RESP ("+Y+") [ attempt "+de+"]: "+I+`
`+V+`
`+_e+" "+ze})}function mi(y,I,V,Y){y.info(function(){return"XMLHTTP TEXT ("+I+"): "+Cm(y,V)+(Y?" "+Y:"")})}function Ba(y,I){y.info(function(){return"TIMEOUT: "+I})}Hr.prototype.info=function(){};function Cm(y,I){if(!y.g)return I;if(!I)return null;try{const _e=JSON.parse(I);if(_e){for(y=0;y<_e.length;y++)if(Array.isArray(_e[y])){var V=_e[y];if(!(V.length<2)){var Y=V[1];if(Array.isArray(Y)&&!(Y.length<1)){var de=Y[0];if(de!="noop"&&de!="stop"&&de!="close")for(let ze=1;ze<Y.length;ze++)Y[ze]=""}}}}return rt(_e)}catch{return I}}var La={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},yc={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},_c;function Ua(){}g(Ua,Xn),Ua.prototype.g=function(){return new XMLHttpRequest},_c=new Ua;function Wi(y){return encodeURIComponent(String(y))}function yd(y){var I=1;y=y.split(":");const V=[];for(;I>0&&y.length;)V.push(y.shift()),I--;return y.length&&V.push(y.join(":")),V}function qr(y,I,V,Y){this.j=y,this.i=I,this.l=V,this.S=Y||1,this.V=new ke(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new Gr}function Gr(){this.i=null,this.g="",this.h=!1}var cn={},jn={};function pi(y,I,V){y.M=1,y.A=Fa(dn(I)),y.u=V,y.R=!0,zo(y,null)}function zo(y,I){y.F=Date.now(),gi(y),y.B=dn(y.A);var V=y.B,Y=y.S;Array.isArray(Y)||(Y=[String(Y)]),Fo(V.i,"t",Y),y.C=0,V=y.j.L,y.h=new Gr,y.g=kd(y.j,V?I:null,!y.u),y.P>0&&(y.O=new Ne(m(y.Y,y,y.g),y.P)),I=y.V,V=y.g,Y=y.ba;var de="readystatechange";Array.isArray(de)||(de&&(qe[0]=de.toString()),de=qe);for(let _e=0;_e<de.length;_e++){const ze=Ce(V,de[_e],Y||I.handleEvent,!1,I.h||I);if(!ze)break;I.g[ze.key]=ze}I=y.J?P(y.J):{},y.u?(y.v||(y.v="POST"),I["Content-Type"]="application/x-www-form-urlencoded",y.g.ea(y.B,y.v,y.u,I)):(y.v="GET",y.g.ea(y.B,y.v,null,I)),Tr(),Em(y.i,y.v,y.B,y.l,y.S,y.u)}qr.prototype.ba=function(y){y=y.target;const I=this.O;I&&Kr(y)==3?I.j():this.Y(y)},qr.prototype.Y=function(y){try{if(y==this.g)e:{const st=Kr(this.g),nn=this.g.ya(),Et=this.g.ca();if(!(st<3)&&(st!=3||this.g&&(this.h.h||this.g.la()||kn(this.g)))){this.K||st!=4||nn==7||(nn==8||Et<=0?Tr(3):Tr(2)),yi(this);var I=this.g.ca();this.X=I;var V=Tm(this);if(this.o=I==200,gd(this.i,this.v,this.B,this.l,this.S,st,I),this.o){if(this.U&&!this.L){t:{if(this.g){var Y,de=this.g;if((Y=de.g?de.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!M(Y)){var _e=Y;break t}}_e=null}if(y=_e)mi(this.i,this.l,y,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,_i(this,y);else{this.o=!1,this.m=3,Bt(12),mr(this),Ar(this);break e}}if(this.R){y=!0;let Gt;for(;!this.K&&this.C<V.length;)if(Gt=bd(this,V),Gt==jn){st==4&&(this.m=4,Bt(14),y=!1),mi(this.i,this.l,null,"[Incomplete Response]");break}else if(Gt==cn){this.m=4,Bt(15),mi(this.i,this.l,V,"[Invalid Chunk]"),y=!1;break}else mi(this.i,this.l,Gt,null),_i(this,Gt);if(_d(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),st!=4||V.length!=0||this.h.h||(this.m=1,Bt(16),y=!1),this.o=this.o&&y,!y)mi(this.i,this.l,V,"[Invalid Chunked Response]"),mr(this),Ar(this);else if(V.length>0&&!this.W){this.W=!0;var ze=this.j;ze.g==this&&ze.aa&&!ze.P&&(ze.j.info("Great, no buffering proxy detected. Bytes received: "+V.length),Oc(ze),ze.P=!0,Bt(11))}}else mi(this.i,this.l,V,null),_i(this,V);st==4&&mr(this),this.o&&!this.K&&(st==4?jd(this.j,this):(this.o=!1,gi(this)))}else Ki(this.g),I==400&&V.indexOf("Unknown SID")>0?(this.m=3,Bt(12)):(this.m=0,Bt(13)),mr(this),Ar(this)}}}catch{}};function Tm(y){if(!_d(y))return y.g.la();const I=kn(y.g);if(I==="")return"";let V="";const Y=I.length,de=Kr(y.g)==4;if(!y.h.i){if(typeof TextDecoder>"u")return mr(y),Ar(y),"";y.h.i=new l.TextDecoder}for(let _e=0;_e<Y;_e++)y.h.h=!0,V+=y.h.i.decode(I[_e],{stream:!(de&&_e==Y-1)});return I.length=0,y.h.g+=V,y.C=0,y.h.g}function _d(y){return y.g?y.v=="GET"&&y.M!=2&&y.j.Aa:!1}function bd(y,I){var V=y.C,Y=I.indexOf(`
`,V);return Y==-1?jn:(V=Number(I.substring(V,Y)),isNaN(V)?cn:(Y+=1,Y+V>I.length?jn:(I=I.slice(Y,Y+V),y.C=Y+V,I)))}qr.prototype.cancel=function(){this.K=!0,mr(this)};function gi(y){y.T=Date.now()+y.H,Bo(y,y.H)}function Bo(y,I){if(y.D!=null)throw Error("WatchDog timer not null");y.D=fi(m(y.aa,y),I)}function yi(y){y.D&&(l.clearTimeout(y.D),y.D=null)}qr.prototype.aa=function(){this.D=null;const y=Date.now();y-this.T>=0?(Ba(this.i,this.B),this.M!=2&&(Tr(),Bt(17)),mr(this),this.m=2,Ar(this)):Bo(this,this.T-y)};function Ar(y){y.j.I==0||y.K||jd(y.j,y)}function mr(y){yi(y);var I=y.O;I&&typeof I.dispose=="function"&&I.dispose(),y.O=null,vt(y.V),y.g&&(I=y.g,y.g=null,I.abort(),I.dispose())}function _i(y,I){try{var V=y.j;if(V.I!=0&&(V.g==y||vi(V.h,y))){if(!y.L&&vi(V.h,y)&&V.I==3){try{var Y=V.Ba.g.parse(I)}catch{Y=null}if(Array.isArray(Y)&&Y.length==3){var de=Y;if(de[0]==0){e:if(!V.v){if(V.g)if(V.g.F+3e3<y.F)Go(V),Ps(V);else break e;Qa(V),Bt(18)}}else V.xa=de[1],0<V.xa-V.K&&de[2]<37500&&V.F&&V.A==0&&!V.C&&(V.C=fi(m(V.Va,V),6e3));bi(V.h)<=1&&V.ta&&(V.ta=void 0)}else Ti(V,11)}else if((y.L||V.g==y)&&Go(V),!M(I))for(de=V.Ba.g.parse(I),I=0;I<de.length;I++){let Et=de[I];const Gt=Et[0];if(!(Gt<=V.K))if(V.K=Gt,Et=Et[1],V.I==2)if(Et[0]=="c"){V.M=Et[1],V.ba=Et[2];const Ir=Et[3];Ir!=null&&(V.ka=Ir,V.j.info("VER="+V.ka));const Ai=Et[4];Ai!=null&&(V.za=Ai,V.j.info("SVER="+V.za));const Yr=Et[5];Yr!=null&&typeof Yr=="number"&&Yr>0&&(Y=1.5*Yr,V.O=Y,V.j.info("backChannelRequestTimeoutMs_="+Y)),Y=V;const Xr=y.g;if(Xr){const Ka=Xr.g?Xr.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Ka){var _e=Y.h;_e.g||Ka.indexOf("spdy")==-1&&Ka.indexOf("quic")==-1&&Ka.indexOf("h2")==-1||(_e.j=_e.l,_e.g=new Set,_e.h&&(xc(_e,_e.h),_e.h=null))}if(Y.G){const Wo=Xr.g?Xr.g.getResponseHeader("X-HTTP-Session-Id"):null;Wo&&(Y.wa=Wo,At(Y.J,Y.G,Wo))}}V.I=3,V.l&&V.l.ra(),V.aa&&(V.T=Date.now()-y.F,V.j.info("Handshake RTT: "+V.T+"ms")),Y=V;var ze=y;if(Y.na=Dd(Y,Y.L?Y.ba:null,Y.W),ze.L){wc(Y.h,ze);var st=ze,nn=Y.O;nn&&(st.H=nn),st.D&&(yi(st),gi(st)),Y.g=ze}else Td(Y);V.i.length>0&&Ci(V)}else Et[0]!="stop"&&Et[0]!="close"||Ti(V,7);else V.I==3&&(Et[0]=="stop"||Et[0]=="close"?Et[0]=="stop"?Ti(V,7):Dc(V):Et[0]!="noop"&&V.l&&V.l.qa(Et),V.A=0)}}Tr(4)}catch{}}var un=class{constructor(y,I){this.g=y,this.map=I}};function bc(y){this.l=y||10,l.PerformanceNavigationTiming?(y=l.performance.getEntriesByType("navigation"),y=y.length>0&&(y[0].nextHopProtocol=="hq"||y[0].nextHopProtocol=="h2")):y=!!(l.chrome&&l.chrome.loadTimes&&l.chrome.loadTimes()&&l.chrome.loadTimes().wasFetchedViaSpdy),this.j=y?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function vc(y){return y.h?!0:y.g?y.g.size>=y.j:!1}function bi(y){return y.h?1:y.g?y.g.size:0}function vi(y,I){return y.h?y.h==I:y.g?y.g.has(I):!1}function xc(y,I){y.g?y.g.add(I):y.h=I}function wc(y,I){y.h&&y.h==I?y.h=null:y.g&&y.g.has(I)&&y.g.delete(I)}bc.prototype.cancel=function(){if(this.i=Sc(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const y of this.g.values())y.cancel();this.g.clear()}};function Sc(y){if(y.h!=null)return y.i.concat(y.h.G);if(y.g!=null&&y.g.size!==0){let I=y.i;for(const V of y.g.values())I=I.concat(V.G);return I}return _(y.i)}var vd=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Lo(y,I){if(y){y=y.split("&");for(let V=0;V<y.length;V++){const Y=y[V].indexOf("=");let de,_e=null;Y>=0?(de=y[V].substring(0,Y),_e=y[V].substring(Y+1)):de=y[V],I(de,_e?decodeURIComponent(_e.replace(/\+/g," ")):"")}}}function pr(y){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let I;y instanceof pr?(this.l=y.l,Rn(this,y.j),this.o=y.o,this.g=y.g,Rs(this,y.u),this.h=y.h,Ec(this,Ed(y.i)),this.m=y.m):y&&(I=String(y).match(vd))?(this.l=!1,Rn(this,I[1]||"",!0),this.o=xi(I[2]||""),this.g=xi(I[3]||"",!0),Rs(this,I[4]),this.h=xi(I[5]||"",!0),Ec(this,I[6]||"",!0),this.m=xi(I[7]||"")):(this.l=!1,this.i=new Ds(null,this.l))}pr.prototype.toString=function(){const y=[];var I=this.j;I&&y.push(Va(I,Uo,!0),":");var V=this.g;return(V||I=="file")&&(y.push("//"),(I=this.o)&&y.push(Va(I,Uo,!0),"@"),y.push(Wi(V).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),V=this.u,V!=null&&y.push(":",String(V))),(V=this.h)&&(this.g&&V.charAt(0)!="/"&&y.push("/"),y.push(Va(V,V.charAt(0)=="/"?Cc:xd,!0))),(V=this.i.toString())&&y.push("?",V),(V=this.m)&&y.push("#",Va(V,wd)),y.join("")},pr.prototype.resolve=function(y){const I=dn(this);let V=!!y.j;V?Rn(I,y.j):V=!!y.o,V?I.o=y.o:V=!!y.g,V?I.g=y.g:V=y.u!=null;var Y=y.h;if(V)Rs(I,y.u);else if(V=!!y.h){if(Y.charAt(0)!="/")if(this.g&&!this.h)Y="/"+Y;else{var de=I.h.lastIndexOf("/");de!=-1&&(Y=I.h.slice(0,de+1)+Y)}if(de=Y,de==".."||de==".")Y="";else if(de.indexOf("./")!=-1||de.indexOf("/.")!=-1){Y=de.lastIndexOf("/",0)==0,de=de.split("/");const _e=[];for(let ze=0;ze<de.length;){const st=de[ze++];st=="."?Y&&ze==de.length&&_e.push(""):st==".."?((_e.length>1||_e.length==1&&_e[0]!="")&&_e.pop(),Y&&ze==de.length&&_e.push("")):(_e.push(st),Y=!0)}Y=_e.join("/")}else Y=de}return V?I.h=Y:V=y.i.toString()!=="",V?Ec(I,Ed(y.i)):V=!!y.m,V&&(I.m=y.m),I};function dn(y){return new pr(y)}function Rn(y,I,V){y.j=V?xi(I,!0):I,y.j&&(y.j=y.j.replace(/:$/,""))}function Rs(y,I){if(I){if(I=Number(I),isNaN(I)||I<0)throw Error("Bad port number "+I);y.u=I}else y.u=null}function Ec(y,I,V){I instanceof Ds?(y.i=I,Vo(y.i,y.l)):(V||(I=Va(I,Is)),y.i=new Ds(I,y.l))}function At(y,I,V){y.i.set(I,V)}function Fa(y){return At(y,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),y}function xi(y,I){return y?I?decodeURI(y.replace(/%25/g,"%2525")):decodeURIComponent(y):""}function Va(y,I,V){return typeof y=="string"?(y=encodeURI(y).replace(I,rr),V&&(y=y.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),y):null}function rr(y){return y=y.charCodeAt(0),"%"+(y>>4&15).toString(16)+(y&15).toString(16)}var Uo=/[#\/\?@]/g,xd=/[#\?:]/g,Cc=/[#\?]/g,Is=/[#\?@]/g,wd=/#/g;function Ds(y,I){this.h=this.g=null,this.i=y||null,this.j=!!I}function ir(y){y.g||(y.g=new Map,y.h=0,y.i&&Lo(y.i,function(I,V){y.add(decodeURIComponent(I.replace(/\+/g," ")),V)}))}t=Ds.prototype,t.add=function(y,I){ir(this),this.i=null,y=ks(this,y);let V=this.g.get(y);return V||this.g.set(y,V=[]),V.push(I),this.h+=1,this};function Sd(y,I){ir(y),I=ks(y,I),y.g.has(I)&&(y.i=null,y.h-=y.g.get(I).length,y.g.delete(I))}function Tc(y,I){return ir(y),I=ks(y,I),y.g.has(I)}t.forEach=function(y,I){ir(this),this.g.forEach(function(V,Y){V.forEach(function(de){y.call(I,de,Y,this)},this)},this)};function Ac(y,I){ir(y);let V=[];if(typeof I=="string")Tc(y,I)&&(V=V.concat(y.g.get(ks(y,I))));else for(y=Array.from(y.g.values()),I=0;I<y.length;I++)V=V.concat(y[I]);return V}t.set=function(y,I){return ir(this),this.i=null,y=ks(this,y),Tc(this,y)&&(this.h-=this.g.get(y).length),this.g.set(y,[I]),this.h+=1,this},t.get=function(y,I){return y?(y=Ac(this,y),y.length>0?String(y[0]):I):I};function Fo(y,I,V){Sd(y,I),V.length>0&&(y.i=null,y.g.set(ks(y,I),_(V)),y.h+=V.length)}t.toString=function(){if(this.i)return this.i;if(!this.g)return"";const y=[],I=Array.from(this.g.keys());for(let Y=0;Y<I.length;Y++){var V=I[Y];const de=Wi(V);V=Ac(this,V);for(let _e=0;_e<V.length;_e++){let ze=de;V[_e]!==""&&(ze+="="+Wi(V[_e])),y.push(ze)}}return this.i=y.join("&")};function Ed(y){const I=new Ds;return I.i=y.i,y.g&&(I.g=new Map(y.g),I.h=y.h),I}function ks(y,I){return I=String(I),y.j&&(I=I.toLowerCase()),I}function Vo(y,I){I&&!y.j&&(ir(y),y.i=null,y.g.forEach(function(V,Y){const de=Y.toLowerCase();Y!=de&&(Sd(this,Y),Fo(this,de,V))},y)),y.j=I}function Wr(y,I){const V=new Hr;if(l.Image){const Y=new Image;Y.onload=p(jr,V,"TestLoadImage: loaded",!0,I,Y),Y.onerror=p(jr,V,"TestLoadImage: error",!1,I,Y),Y.onabort=p(jr,V,"TestLoadImage: abort",!1,I,Y),Y.ontimeout=p(jr,V,"TestLoadImage: timeout",!1,I,Y),l.setTimeout(function(){Y.ontimeout&&Y.ontimeout()},1e4),Y.src=y}else I(!1)}function jc(y,I){const V=new Hr,Y=new AbortController,de=setTimeout(()=>{Y.abort(),jr(V,"TestPingServer: timeout",!1,I)},1e4);fetch(y,{signal:Y.signal}).then(_e=>{clearTimeout(de),_e.ok?jr(V,"TestPingServer: ok",!0,I):jr(V,"TestPingServer: server error",!1,I)}).catch(()=>{clearTimeout(de),jr(V,"TestPingServer: error",!1,I)})}function jr(y,I,V,Y,de){try{de&&(de.onload=null,de.onerror=null,de.onabort=null,de.ontimeout=null),Y(V)}catch{}}function Os(){this.g=new ui}function wi(y){this.i=y.Sb||null,this.h=y.ab||!1}g(wi,Xn),wi.prototype.g=function(){return new $a(this.i,this.h)};function $a(y,I){ie.call(this),this.H=y,this.o=I,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}g($a,ie),t=$a.prototype,t.open=function(y,I){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=y,this.D=I,this.readyState=1,Qr(this)},t.send=function(y){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const I={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};y&&(I.body=y),(this.H||l).fetch(new Request(this.D,I)).then(this.Pa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,Ms(this)),this.readyState=0},t.Pa=function(y){if(this.g&&(this.l=y,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=y.headers,this.readyState=2,Qr(this)),this.g&&(this.readyState=3,Qr(this),this.g)))if(this.responseType==="arraybuffer")y.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof l.ReadableStream<"u"&&"body"in y){if(this.j=y.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;$o(this)}else y.text().then(this.Oa.bind(this),this.ga.bind(this))};function $o(y){y.j.read().then(y.Ma.bind(y)).catch(y.ga.bind(y))}t.Ma=function(y){if(this.g){if(this.o&&y.value)this.response.push(y.value);else if(!this.o){var I=y.value?y.value:new Uint8Array(0);(I=this.B.decode(I,{stream:!y.done}))&&(this.response=this.responseText+=I)}y.done?Ms(this):Qr(this),this.readyState==3&&$o(this)}},t.Oa=function(y){this.g&&(this.response=this.responseText=y,Ms(this))},t.Na=function(y){this.g&&(this.response=y,Ms(this))},t.ga=function(){this.g&&Ms(this)};function Ms(y){y.readyState=4,y.l=null,y.j=null,y.B=null,Qr(y)}t.setRequestHeader=function(y,I){this.A.append(y,I)},t.getResponseHeader=function(y){return this.h&&this.h.get(y.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";const y=[],I=this.h.entries();for(var V=I.next();!V.done;)V=V.value,y.push(V[0]+": "+V[1]),V=I.next();return y.join(`\r
`)};function Qr(y){y.onreadystatechange&&y.onreadystatechange.call(y)}Object.defineProperty($a.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(y){this.m=y?"include":"same-origin"}});function Rr(y){let I="";return Z(y,function(V,Y){I+=Y,I+=":",I+=V,I+=`\r
`}),I}function Ha(y,I,V){e:{for(Y in V){var Y=!1;break e}Y=!0}Y||(V=Rr(V),typeof y=="string"?V!=null&&Wi(V):At(y,I,V))}function It(y){ie.call(this),this.headers=new Map,this.L=y||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}g(It,ie);var Si=/^https?$/i,Rc=["POST","PUT"];t=It.prototype,t.Fa=function(y){this.H=y},t.ea=function(y,I,V,Y){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+y);I=I?I.toUpperCase():"GET",this.D=y,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():_c.g(),this.g.onreadystatechange=v(m(this.Ca,this));try{this.B=!0,this.g.open(I,String(y),!0),this.B=!1}catch(_e){qa(this,_e);return}if(y=V||"",V=new Map(this.headers),Y)if(Object.getPrototypeOf(Y)===Object.prototype)for(var de in Y)V.set(de,Y[de]);else if(typeof Y.keys=="function"&&typeof Y.get=="function")for(const _e of Y.keys())V.set(_e,Y.get(_e));else throw Error("Unknown input type for opt_headers: "+String(Y));Y=Array.from(V.keys()).find(_e=>_e.toLowerCase()=="content-type"),de=l.FormData&&y instanceof l.FormData,!(Array.prototype.indexOf.call(Rc,I,void 0)>=0)||Y||de||V.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[_e,ze]of V)this.g.setRequestHeader(_e,ze);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(y),this.v=!1}catch(_e){qa(this,_e)}};function qa(y,I){y.h=!1,y.g&&(y.j=!0,y.g.abort(),y.j=!1),y.l=I,y.o=5,Ic(y),Qi(y)}function Ic(y){y.A||(y.A=!0,we(y,"complete"),we(y,"error"))}t.abort=function(y){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=y||7,we(this,"complete"),we(this,"abort"),Qi(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Qi(this,!0)),It.Z.N.call(this)},t.Ca=function(){this.u||(this.B||this.v||this.j?Ga(this):this.Xa())},t.Xa=function(){Ga(this)};function Ga(y){if(y.h&&typeof o<"u"){if(y.v&&Kr(y)==4)setTimeout(y.Ca.bind(y),0);else if(we(y,"readystatechange"),Kr(y)==4){y.h=!1;try{const _e=y.ca();e:switch(_e){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var I=!0;break e;default:I=!1}var V;if(!(V=I)){var Y;if(Y=_e===0){let ze=String(y.D).match(vd)[1]||null;!ze&&l.self&&l.self.location&&(ze=l.self.location.protocol.slice(0,-1)),Y=!Si.test(ze?ze.toLowerCase():"")}V=Y}if(V)we(y,"complete"),we(y,"success");else{y.o=6;try{var de=Kr(y)>2?y.g.statusText:""}catch{de=""}y.l=de+" ["+y.ca()+"]",Ic(y)}}finally{Qi(y)}}}}function Qi(y,I){if(y.g){y.m&&(clearTimeout(y.m),y.m=null);const V=y.g;y.g=null,I||we(y,"ready");try{V.onreadystatechange=null}catch{}}}t.isActive=function(){return!!this.g};function Kr(y){return y.g?y.g.readyState:0}t.ca=function(){try{return Kr(this)>2?this.g.status:-1}catch{return-1}},t.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},t.La=function(y){if(this.g){var I=this.g.responseText;return y&&I.indexOf(y)==0&&(I=I.substring(y.length)),Hn(I)}};function kn(y){try{if(!y.g)return null;if("response"in y.g)return y.g.response;switch(y.F){case"":case"text":return y.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in y.g)return y.g.mozResponseArrayBuffer}return null}catch{return null}}function Ki(y){const I={};y=(y.g&&Kr(y)>=2&&y.g.getAllResponseHeaders()||"").split(`\r
`);for(let Y=0;Y<y.length;Y++){if(M(y[Y]))continue;var V=yd(y[Y]);const de=V[0];if(V=V[1],typeof V!="string")continue;V=V.trim();const _e=I[de]||[];I[de]=_e,_e.push(V)}re(I,function(Y){return Y.join(", ")})}t.ya=function(){return this.o},t.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function Ei(y,I,V){return V&&V.internalChannelParams&&V.internalChannelParams[y]||I}function Ns(y){this.za=0,this.i=[],this.j=new Hr,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=Ei("failFast",!1,y),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=Ei("baseRetryDelayMs",5e3,y),this.Za=Ei("retryDelaySeedMs",1e4,y),this.Ta=Ei("forwardChannelMaxRetries",2,y),this.va=Ei("forwardChannelRequestTimeoutMs",2e4,y),this.ma=y&&y.xmlHttpFactory||void 0,this.Ua=y&&y.Rb||void 0,this.Aa=y&&y.useFetchStreams||!1,this.O=void 0,this.L=y&&y.supportsCrossDomainXhr||!1,this.M="",this.h=new bc(y&&y.concurrentRequestLimit),this.Ba=new Os,this.S=y&&y.fastHandshake||!1,this.R=y&&y.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=y&&y.Pb||!1,y&&y.ua&&this.j.ua(),y&&y.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&y&&y.detectBufferingProxy||!1,this.ia=void 0,y&&y.longPollingTimeout&&y.longPollingTimeout>0&&(this.ia=y.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}t=Ns.prototype,t.ka=8,t.I=1,t.connect=function(y,I,V,Y){Bt(0),this.W=y,this.H=I||{},V&&Y!==void 0&&(this.H.OSID=V,this.H.OAID=Y),this.F=this.X,this.J=Dd(this,null,this.W),Ci(this)};function Dc(y){if(Ho(y),y.I==3){var I=y.V++,V=dn(y.J);if(At(V,"SID",y.M),At(V,"RID",I),At(V,"TYPE","terminate"),Wa(y,V),I=new qr(y,y.j,I),I.M=2,I.A=Fa(dn(V)),V=!1,l.navigator&&l.navigator.sendBeacon)try{V=l.navigator.sendBeacon(I.A.toString(),"")}catch{}!V&&l.Image&&(new Image().src=I.A,V=!0),V||(I.g=kd(I.j,null),I.g.ea(I.A)),I.F=Date.now(),gi(I)}Id(y)}function Ps(y){y.g&&(Oc(y),y.g.cancel(),y.g=null)}function Ho(y){Ps(y),y.v&&(l.clearTimeout(y.v),y.v=null),Go(y),y.h.cancel(),y.m&&(typeof y.m=="number"&&l.clearTimeout(y.m),y.m=null)}function Ci(y){if(!vc(y.h)&&!y.m){y.m=!0;var I=y.Ea;U||D(),G||(U(),G=!0),k.add(I,y),y.D=0}}function qo(y,I){return bi(y.h)>=y.h.j-(y.m?1:0)?!1:y.m?(y.i=I.G.concat(y.i),!0):y.I==1||y.I==2||y.D>=(y.Sa?0:y.Ta)?!1:(y.m=fi(m(y.Ea,y,I),Rd(y,y.D)),y.D++,!0)}t.Ea=function(y){if(this.m)if(this.m=null,this.I==1){if(!y){this.V=Math.floor(Math.random()*1e5),y=this.V++;const de=new qr(this,this.j,y);let _e=this.o;if(this.U&&(_e?(_e=P(_e),te(_e,this.U)):_e=this.U),this.u!==null||this.R||(de.J=_e,_e=null),this.S)e:{for(var I=0,V=0;V<this.i.length;V++){t:{var Y=this.i[V];if("__data__"in Y.map&&(Y=Y.map.__data__,typeof Y=="string")){Y=Y.length;break t}Y=void 0}if(Y===void 0)break;if(I+=Y,I>4096){I=V;break e}if(I===4096||V===this.i.length-1){I=V+1;break e}}I=1e3}else I=1e3;I=Cd(this,de,I),V=dn(this.J),At(V,"RID",y),At(V,"CVER",22),this.G&&At(V,"X-HTTP-Session-Id",this.G),Wa(this,V),_e&&(this.R?I="headers="+Wi(Rr(_e))+"&"+I:this.u&&Ha(V,this.u,_e)),xc(this.h,de),this.Ra&&At(V,"TYPE","init"),this.S?(At(V,"$req",I),At(V,"SID","null"),de.U=!0,pi(de,V,null)):pi(de,V,I),this.I=2}}else this.I==3&&(y?kc(this,y):this.i.length==0||vc(this.h)||kc(this))};function kc(y,I){var V;I?V=I.l:V=y.V++;const Y=dn(y.J);At(Y,"SID",y.M),At(Y,"RID",V),At(Y,"AID",y.K),Wa(y,Y),y.u&&y.o&&Ha(Y,y.u,y.o),V=new qr(y,y.j,V,y.D+1),y.u===null&&(V.J=y.o),I&&(y.i=I.G.concat(y.i)),I=Cd(y,V,1e3),V.H=Math.round(y.va*.5)+Math.round(y.va*.5*Math.random()),xc(y.h,V),pi(V,Y,I)}function Wa(y,I){y.H&&Z(y.H,function(V,Y){At(I,Y,V)}),y.l&&Z({},function(V,Y){At(I,Y,V)})}function Cd(y,I,V){V=Math.min(y.i.length,V);const Y=y.l?m(y.l.Ka,y.l,y):null;e:{var de=y.i;let st=-1;for(;;){const nn=["count="+V];st==-1?V>0?(st=de[0].g,nn.push("ofs="+st)):st=0:nn.push("ofs="+st);let Et=!0;for(let Gt=0;Gt<V;Gt++){var _e=de[Gt].g;const Ir=de[Gt].map;if(_e-=st,_e<0)st=Math.max(0,de[Gt].g-100),Et=!1;else try{_e="req"+_e+"_"||"";try{var ze=Ir instanceof Map?Ir:Object.entries(Ir);for(const[Ai,Yr]of ze){let Xr=Yr;d(Yr)&&(Xr=rt(Yr)),nn.push(_e+Ai+"="+encodeURIComponent(Xr))}}catch(Ai){throw nn.push(_e+"type="+encodeURIComponent("_badmap")),Ai}}catch{Y&&Y(Ir)}}if(Et){ze=nn.join("&");break e}}ze=void 0}return y=y.i.splice(0,V),I.G=y,ze}function Td(y){if(!y.g&&!y.v){y.Y=1;var I=y.Da;U||D(),G||(U(),G=!0),k.add(I,y),y.A=0}}function Qa(y){return y.g||y.v||y.A>=3?!1:(y.Y++,y.v=fi(m(y.Da,y),Rd(y,y.A)),y.A++,!0)}t.Da=function(){if(this.v=null,Ad(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var y=4*this.T;this.j.info("BP detection timer enabled: "+y),this.B=fi(m(this.Wa,this),y)}},t.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,Bt(10),Ps(this),Ad(this))};function Oc(y){y.B!=null&&(l.clearTimeout(y.B),y.B=null)}function Ad(y){y.g=new qr(y,y.j,"rpc",y.Y),y.u===null&&(y.g.J=y.o),y.g.P=0;var I=dn(y.na);At(I,"RID","rpc"),At(I,"SID",y.M),At(I,"AID",y.K),At(I,"CI",y.F?"0":"1"),!y.F&&y.ia&&At(I,"TO",y.ia),At(I,"TYPE","xmlhttp"),Wa(y,I),y.u&&y.o&&Ha(I,y.u,y.o),y.O&&(y.g.H=y.O);var V=y.g;y=y.ba,V.M=1,V.A=Fa(dn(I)),V.u=null,V.R=!0,zo(V,y)}t.Va=function(){this.C!=null&&(this.C=null,Ps(this),Qa(this),Bt(19))};function Go(y){y.C!=null&&(l.clearTimeout(y.C),y.C=null)}function jd(y,I){var V=null;if(y.g==I){Go(y),Oc(y),y.g=null;var Y=2}else if(vi(y.h,I))V=I.G,wc(y.h,I),Y=1;else return;if(y.I!=0){if(I.o)if(Y==1){V=I.u?I.u.length:0,I=Date.now()-I.F;var de=y.D;Y=js(),we(Y,new Zn(Y,V)),Ci(y)}else Td(y);else if(de=I.m,de==3||de==0&&I.X>0||!(Y==1&&qo(y,I)||Y==2&&Qa(y)))switch(V&&V.length>0&&(I=y.h,I.i=I.i.concat(V)),de){case 1:Ti(y,5);break;case 4:Ti(y,10);break;case 3:Ti(y,6);break;default:Ti(y,2)}}}function Rd(y,I){let V=y.Qa+Math.floor(Math.random()*y.Za);return y.isActive()||(V*=2),V*I}function Ti(y,I){if(y.j.info("Error code "+I),I==2){var V=m(y.bb,y),Y=y.Ua;const de=!Y;Y=new pr(Y||"//www.google.com/images/cleardot.gif"),l.location&&l.location.protocol=="http"||Rn(Y,"https"),Fa(Y),de?Wr(Y.toString(),V):jc(Y.toString(),V)}else Bt(2);y.I=0,y.l&&y.l.pa(I),Id(y),Ho(y)}t.bb=function(y){y?(this.j.info("Successfully pinged google.com"),Bt(2)):(this.j.info("Failed to ping google.com"),Bt(1))};function Id(y){if(y.I=0,y.ja=[],y.l){const I=Sc(y.h);(I.length!=0||y.i.length!=0)&&(S(y.ja,I),S(y.ja,y.i),y.h.i.length=0,_(y.i),y.i.length=0),y.l.oa()}}function Dd(y,I,V){var Y=V instanceof pr?dn(V):new pr(V);if(Y.g!="")I&&(Y.g=I+"."+Y.g),Rs(Y,Y.u);else{var de=l.location;Y=de.protocol,I=I?I+"."+de.hostname:de.hostname,de=+de.port;const _e=new pr(null);Y&&Rn(_e,Y),I&&(_e.g=I),de&&Rs(_e,de),V&&(_e.h=V),Y=_e}return V=y.G,I=y.wa,V&&I&&At(Y,V,I),At(Y,"VER",y.ka),Wa(y,Y),Y}function kd(y,I,V){if(I&&!y.L)throw Error("Can't create secondary domain capable XhrIo object.");return I=y.Aa&&!y.ma?new It(new wi({ab:V})):new It(y.ma),I.Fa(y.L),I}t.isActive=function(){return!!this.l&&this.l.isActive(this)};function Od(){}t=Od.prototype,t.ra=function(){},t.qa=function(){},t.pa=function(){},t.oa=function(){},t.isActive=function(){return!0},t.Ka=function(){};function zs(){}zs.prototype.g=function(y,I){return new Jn(y,I)};function Jn(y,I){ie.call(this),this.g=new Ns(I),this.l=y,this.h=I&&I.messageUrlParams||null,y=I&&I.messageHeaders||null,I&&I.clientProtocolHeaderRequired&&(y?y["X-Client-Protocol"]="webchannel":y={"X-Client-Protocol":"webchannel"}),this.g.o=y,y=I&&I.initMessageHeaders||null,I&&I.messageContentType&&(y?y["X-WebChannel-Content-Type"]=I.messageContentType:y={"X-WebChannel-Content-Type":I.messageContentType}),I&&I.sa&&(y?y["X-WebChannel-Client-Profile"]=I.sa:y={"X-WebChannel-Client-Profile":I.sa}),this.g.U=y,(y=I&&I.Qb)&&!M(y)&&(this.g.u=y),this.A=I&&I.supportsCrossDomainXhr||!1,this.v=I&&I.sendRawJson||!1,(I=I&&I.httpSessionIdParam)&&!M(I)&&(this.g.G=I,y=this.h,y!==null&&I in y&&(y=this.h,I in y&&delete y[I])),this.j=new Yi(this)}g(Jn,ie),Jn.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},Jn.prototype.close=function(){Dc(this.g)},Jn.prototype.o=function(y){var I=this.g;if(typeof y=="string"){var V={};V.__data__=y,y=V}else this.v&&(V={},V.__data__=rt(y),y=V);I.i.push(new un(I.Ya++,y)),I.I==3&&Ci(I)},Jn.prototype.N=function(){this.g.l=null,delete this.j,Dc(this.g),delete this.g,Jn.Z.N.call(this)};function Md(y){Zt.call(this),y.__headers__&&(this.headers=y.__headers__,this.statusCode=y.__status__,delete y.__headers__,delete y.__status__);var I=y.__sm__;if(I){e:{for(const V in I){y=V;break e}y=void 0}(this.i=y)&&(y=this.i,I=I!==null&&y in I?I[y]:void 0),this.data=I}else this.data=y}g(Md,Zt);function Nd(){qn.call(this),this.status=1}g(Nd,qn);function Yi(y){this.g=y}g(Yi,Od),Yi.prototype.ra=function(){we(this.g,"a")},Yi.prototype.qa=function(y){we(this.g,new Md(y))},Yi.prototype.pa=function(y){we(this.g,new Nd)},Yi.prototype.oa=function(){we(this.g,"b")},zs.prototype.createWebChannel=zs.prototype.g,Jn.prototype.send=Jn.prototype.o,Jn.prototype.open=Jn.prototype.m,Jn.prototype.close=Jn.prototype.close,LE=function(){return new zs},BE=function(){return js()},zE=St,my={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},La.NO_ERROR=0,La.TIMEOUT=8,La.HTTP_ERROR=6,nf=La,yc.COMPLETE="complete",PE=yc,di.EventType=_t,_t.OPEN="a",_t.CLOSE="b",_t.ERROR="c",_t.MESSAGE="d",ie.prototype.listen=ie.prototype.J,xu=di,It.prototype.listenOnce=It.prototype.K,It.prototype.getLastError=It.prototype.Ha,It.prototype.getLastErrorCode=It.prototype.ya,It.prototype.getStatus=It.prototype.ca,It.prototype.getResponseJson=It.prototype.La,It.prototype.getResponseText=It.prototype.la,It.prototype.send=It.prototype.ea,It.prototype.setWithCredentials=It.prototype.Fa,NE=It}).apply(typeof $h<"u"?$h:typeof self<"u"?self:typeof window<"u"?window:{});const Aw="@firebase/firestore",jw="4.9.3";class Qn{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Qn.UNAUTHENTICATED=new Qn(null),Qn.GOOGLE_CREDENTIALS=new Qn("google-credentials-uid"),Qn.FIRST_PARTY=new Qn("first-party-uid"),Qn.MOCK_USER=new Qn("mock-user");let oc="12.7.0";const So=new Hy("@firebase/firestore");function Al(){return So.logLevel}function Le(t,...e){if(So.logLevel<=ft.DEBUG){const n=e.map(s0);So.debug(`Firestore (${oc}): ${t}`,...n)}}function ws(t,...e){if(So.logLevel<=ft.ERROR){const n=e.map(s0);So.error(`Firestore (${oc}): ${t}`,...n)}}function Ul(t,...e){if(So.logLevel<=ft.WARN){const n=e.map(s0);So.warn(`Firestore (${oc}): ${t}`,...n)}}function s0(t){if(typeof t=="string")return t;try{return(function(n){return JSON.stringify(n)})(t)}catch{return t}}function Xe(t,e,n){let r="Unexpected state";typeof e=="string"?r=e:n=e,UE(t,r,n)}function UE(t,e,n){let r=`FIRESTORE (${oc}) INTERNAL ASSERTION FAILED: ${e} (ID: ${t.toString(16)})`;if(n!==void 0)try{r+=" CONTEXT: "+JSON.stringify(n)}catch{r+=" CONTEXT: "+n}throw ws(r),new Error(r)}function Tt(t,e,n,r){let s="Unexpected state";typeof n=="string"?s=n:r=n,t||UE(e,s,r)}function nt(t,e){return t}const je={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Be extends Ts{constructor(e,n){super(e,n),this.code=e,this.message=n,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class ys{constructor(){this.promise=new Promise(((e,n)=>{this.resolve=e,this.reject=n}))}}class FE{constructor(e,n){this.user=n,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class qO{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,n){e.enqueueRetryable((()=>n(Qn.UNAUTHENTICATED)))}shutdown(){}}class GO{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,n){this.changeListener=n,e.enqueueRetryable((()=>n(this.token.user)))}shutdown(){this.changeListener=null}}class WO{constructor(e){this.t=e,this.currentUser=Qn.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,n){Tt(this.o===void 0,42304);let r=this.i;const s=h=>this.i!==r?(r=this.i,n(h)):Promise.resolve();let o=new ys;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new ys,e.enqueueRetryable((()=>s(this.currentUser)))};const l=()=>{const h=o;e.enqueueRetryable((async()=>{await h.promise,await s(this.currentUser)}))},d=h=>{Le("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=h,this.o&&(this.auth.addAuthTokenListener(this.o),l())};this.t.onInit((h=>d(h))),setTimeout((()=>{if(!this.auth){const h=this.t.getImmediate({optional:!0});h?d(h):(Le("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new ys)}}),0),l()}getToken(){const e=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then((r=>this.i!==e?(Le("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(Tt(typeof r.accessToken=="string",31837,{l:r}),new FE(r.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Tt(e===null||typeof e=="string",2055,{h:e}),new Qn(e)}}class QO{constructor(e,n,r){this.P=e,this.T=n,this.I=r,this.type="FirstParty",this.user=Qn.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class KO{constructor(e,n,r){this.P=e,this.T=n,this.I=r}getToken(){return Promise.resolve(new QO(this.P,this.T,this.I))}start(e,n){e.enqueueRetryable((()=>n(Qn.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class Rw{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class YO{constructor(e,n){this.V=n,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,ti(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,n){Tt(this.o===void 0,3512);const r=o=>{o.error!=null&&Le("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${o.error.message}`);const l=o.token!==this.m;return this.m=o.token,Le("FirebaseAppCheckTokenProvider",`Received ${l?"new":"existing"} token.`),l?n(o.token):Promise.resolve()};this.o=o=>{e.enqueueRetryable((()=>r(o)))};const s=o=>{Le("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=o,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((o=>s(o))),setTimeout((()=>{if(!this.appCheck){const o=this.V.getImmediate({optional:!0});o?s(o):Le("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new Rw(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((n=>n?(Tt(typeof n.token=="string",44558,{tokenResult:n}),this.m=n.token,new Rw(n.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function XO(t){const e=typeof self<"u"&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(n);else for(let r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}class a0{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const s=XO(40);for(let o=0;o<s.length;++o)r.length<20&&s[o]<n&&(r+=e.charAt(s[o]%62))}return r}}function mt(t,e){return t<e?-1:t>e?1:0}function py(t,e){const n=Math.min(t.length,e.length);for(let r=0;r<n;r++){const s=t.charAt(r),o=e.charAt(r);if(s!==o)return Pg(s)===Pg(o)?mt(s,o):Pg(s)?1:-1}return mt(t.length,e.length)}const ZO=55296,JO=57343;function Pg(t){const e=t.charCodeAt(0);return e>=ZO&&e<=JO}function Fl(t,e,n){return t.length===e.length&&t.every(((r,s)=>n(r,e[s])))}const Iw="__name__";class Oi{constructor(e,n,r){n===void 0?n=0:n>e.length&&Xe(637,{offset:n,range:e.length}),r===void 0?r=e.length-n:r>e.length-n&&Xe(1746,{length:r,range:e.length-n}),this.segments=e,this.offset=n,this.len=r}get length(){return this.len}isEqual(e){return Oi.comparator(this,e)===0}child(e){const n=this.segments.slice(this.offset,this.limit());return e instanceof Oi?e.forEach((r=>{n.push(r)})):n.push(e),this.construct(n)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}forEach(e){for(let n=this.offset,r=this.limit();n<r;n++)e(this.segments[n])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,n){const r=Math.min(e.length,n.length);for(let s=0;s<r;s++){const o=Oi.compareSegments(e.get(s),n.get(s));if(o!==0)return o}return mt(e.length,n.length)}static compareSegments(e,n){const r=Oi.isNumericId(e),s=Oi.isNumericId(n);return r&&!s?-1:!r&&s?1:r&&s?Oi.extractNumericId(e).compare(Oi.extractNumericId(n)):py(e,n)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return va.fromString(e.substring(4,e.length-2))}}class Lt extends Oi{construct(e,n,r){return new Lt(e,n,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const n=[];for(const r of e){if(r.indexOf("//")>=0)throw new Be(je.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);n.push(...r.split("/").filter((s=>s.length>0)))}return new Lt(n)}static emptyPath(){return new Lt([])}}const eM=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Bn extends Oi{construct(e,n,r){return new Bn(e,n,r)}static isValidIdentifier(e){return eM.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Bn.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===Iw}static keyField(){return new Bn([Iw])}static fromServerFormat(e){const n=[];let r="",s=0;const o=()=>{if(r.length===0)throw new Be(je.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);n.push(r),r=""};let l=!1;for(;s<e.length;){const d=e[s];if(d==="\\"){if(s+1===e.length)throw new Be(je.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const h=e[s+1];if(h!=="\\"&&h!=="."&&h!=="`")throw new Be(je.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=h,s+=2}else d==="`"?(l=!l,s++):d!=="."||l?(r+=d,s++):(o(),s++)}if(o(),l)throw new Be(je.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Bn(n)}static emptyPath(){return new Bn([])}}class We{constructor(e){this.path=e}static fromPath(e){return new We(Lt.fromString(e))}static fromName(e){return new We(Lt.fromString(e).popFirst(5))}static empty(){return new We(Lt.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Lt.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,n){return Lt.comparator(e.path,n.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new We(new Lt(e.slice()))}}function VE(t,e,n){if(!n)throw new Be(je.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function tM(t,e,n,r){if(e===!0&&r===!0)throw new Be(je.INVALID_ARGUMENT,`${t} and ${n} cannot be used together.`)}function Dw(t){if(!We.isDocumentKey(t))throw new Be(je.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function kw(t){if(We.isDocumentKey(t))throw new Be(je.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function $E(t){return typeof t=="object"&&t!==null&&(Object.getPrototypeOf(t)===Object.prototype||Object.getPrototypeOf(t)===null)}function Yf(t){if(t===void 0)return"undefined";if(t===null)return"null";if(typeof t=="string")return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if(typeof t=="number"||typeof t=="boolean")return""+t;if(typeof t=="object"){if(t instanceof Array)return"an array";{const e=(function(r){return r.constructor?r.constructor.name:null})(t);return e?`a custom ${e} object`:"an object"}}return typeof t=="function"?"a function":Xe(12329,{type:typeof t})}function ai(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new Be(je.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=Yf(t);throw new Be(je.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}function _n(t,e){const n={typeString:t};return e&&(n.value=e),n}function nd(t,e){if(!$E(t))throw new Be(je.INVALID_ARGUMENT,"JSON must be an object");let n;for(const r in e)if(e[r]){const s=e[r].typeString,o="value"in e[r]?{value:e[r].value}:void 0;if(!(r in t)){n=`JSON missing required field: '${r}'`;break}const l=t[r];if(s&&typeof l!==s){n=`JSON field '${r}' must be a ${s}.`;break}if(o!==void 0&&l!==o.value){n=`Expected '${r}' field to equal '${o.value}'`;break}}if(n)throw new Be(je.INVALID_ARGUMENT,n);return!0}const Ow=-62135596800,Mw=1e6;class $t{static now(){return $t.fromMillis(Date.now())}static fromDate(e){return $t.fromMillis(e.getTime())}static fromMillis(e){const n=Math.floor(e/1e3),r=Math.floor((e-1e3*n)*Mw);return new $t(n,r)}constructor(e,n){if(this.seconds=e,this.nanoseconds=n,n<0)throw new Be(je.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new Be(je.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(e<Ow)throw new Be(je.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Be(je.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/Mw}_compareTo(e){return this.seconds===e.seconds?mt(this.nanoseconds,e.nanoseconds):mt(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:$t._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(nd(e,$t._jsonSchema))return new $t(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-Ow;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}$t._jsonSchemaVersion="firestore/timestamp/1.0",$t._jsonSchema={type:_n("string",$t._jsonSchemaVersion),seconds:_n("number"),nanoseconds:_n("number")};class et{static fromTimestamp(e){return new et(e)}static min(){return new et(new $t(0,0))}static max(){return new et(new $t(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const Pu=-1;function nM(t,e){const n=t.toTimestamp().seconds,r=t.toTimestamp().nanoseconds+1,s=et.fromTimestamp(r===1e9?new $t(n+1,0):new $t(n,r));return new wa(s,We.empty(),e)}function rM(t){return new wa(t.readTime,t.key,Pu)}class wa{constructor(e,n,r){this.readTime=e,this.documentKey=n,this.largestBatchId=r}static min(){return new wa(et.min(),We.empty(),Pu)}static max(){return new wa(et.max(),We.empty(),Pu)}}function iM(t,e){let n=t.readTime.compareTo(e.readTime);return n!==0?n:(n=We.comparator(t.documentKey,e.documentKey),n!==0?n:mt(t.largestBatchId,e.largestBatchId))}const sM="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class aM{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function lc(t){if(t.code!==je.FAILED_PRECONDITION||t.message!==sM)throw t;Le("LocalStore","Unexpectedly lost primary lease")}class De{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((n=>{this.isDone=!0,this.result=n,this.nextCallback&&this.nextCallback(n)}),(n=>{this.isDone=!0,this.error=n,this.catchCallback&&this.catchCallback(n)}))}catch(e){return this.next(void 0,e)}next(e,n){return this.callbackAttached&&Xe(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new De(((r,s)=>{this.nextCallback=o=>{this.wrapSuccess(e,o).next(r,s)},this.catchCallback=o=>{this.wrapFailure(n,o).next(r,s)}}))}toPromise(){return new Promise(((e,n)=>{this.next(e,n)}))}wrapUserFunction(e){try{const n=e();return n instanceof De?n:De.resolve(n)}catch(n){return De.reject(n)}}wrapSuccess(e,n){return e?this.wrapUserFunction((()=>e(n))):De.resolve(n)}wrapFailure(e,n){return e?this.wrapUserFunction((()=>e(n))):De.reject(n)}static resolve(e){return new De(((n,r)=>{n(e)}))}static reject(e){return new De(((n,r)=>{r(e)}))}static waitFor(e){return new De(((n,r)=>{let s=0,o=0,l=!1;e.forEach((d=>{++s,d.next((()=>{++o,l&&o===s&&n()}),(h=>r(h)))})),l=!0,o===s&&n()}))}static or(e){let n=De.resolve(!1);for(const r of e)n=n.next((s=>s?De.resolve(s):r()));return n}static forEach(e,n){const r=[];return e.forEach(((s,o)=>{r.push(n.call(this,s,o))})),this.waitFor(r)}static mapArray(e,n){return new De(((r,s)=>{const o=e.length,l=new Array(o);let d=0;for(let h=0;h<o;h++){const m=h;n(e[m]).next((p=>{l[m]=p,++d,d===o&&r(l)}),(p=>s(p)))}}))}static doWhile(e,n){return new De(((r,s)=>{const o=()=>{e()===!0?n().next((()=>{o()}),s):r()};o()}))}}function oM(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}function cc(t){return t.name==="IndexedDbTransactionError"}class Xf{constructor(e,n){this.previousValue=e,n&&(n.sequenceNumberHandler=r=>this.ae(r),this.ue=r=>n.writeSequenceNumber(r))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}Xf.ce=-1;const o0=-1;function Zf(t){return t==null}function xf(t){return t===0&&1/t==-1/0}function lM(t){return typeof t=="number"&&Number.isInteger(t)&&!xf(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}const HE="";function cM(t){let e="";for(let n=0;n<t.length;n++)e.length>0&&(e=Nw(e)),e=uM(t.get(n),e);return Nw(e)}function uM(t,e){let n=e;const r=t.length;for(let s=0;s<r;s++){const o=t.charAt(s);switch(o){case"\0":n+="";break;case HE:n+="";break;default:n+=o}}return n}function Nw(t){return t+HE+""}function Pw(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function ka(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function qE(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}class Xt{constructor(e,n){this.comparator=e,this.root=n||zn.EMPTY}insert(e,n){return new Xt(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,zn.BLACK,null,null))}remove(e){return new Xt(this.comparator,this.root.remove(e,this.comparator).copy(null,null,zn.BLACK,null,null))}get(e){let n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(r===0)return n.value;r<0?n=n.left:r>0&&(n=n.right)}return null}indexOf(e){let n=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return n+r.left.size;s<0?r=r.left:(n+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((n,r)=>(e(n,r),!1)))}toString(){const e=[];return this.inorderTraversal(((n,r)=>(e.push(`${n}:${r}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Hh(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Hh(this.root,e,this.comparator,!1)}getReverseIterator(){return new Hh(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Hh(this.root,e,this.comparator,!0)}}class Hh{constructor(e,n,r,s){this.isReverse=s,this.nodeStack=[];let o=1;for(;!e.isEmpty();)if(o=n?r(e.key,n):1,n&&s&&(o*=-1),o<0)e=this.isReverse?e.left:e.right;else{if(o===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const n={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return n}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class zn{constructor(e,n,r,s,o){this.key=e,this.value=n,this.color=r??zn.RED,this.left=s??zn.EMPTY,this.right=o??zn.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,n,r,s,o){return new zn(e??this.key,n??this.value,r??this.color,s??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,r){let s=this;const o=r(e,s.key);return s=o<0?s.copy(null,null,null,s.left.insert(e,n,r),null):o===0?s.copy(null,n,null,null,null):s.copy(null,null,null,null,s.right.insert(e,n,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return zn.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,n){let r,s=this;if(n(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,n),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),n(e,s.key)===0){if(s.right.isEmpty())return zn.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,n))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,zn.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,zn.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Xe(43730,{key:this.key,value:this.value});if(this.right.isRed())throw Xe(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw Xe(27949);return e+(this.isRed()?0:1)}}zn.EMPTY=null,zn.RED=!0,zn.BLACK=!1;zn.EMPTY=new class{constructor(){this.size=0}get key(){throw Xe(57766)}get value(){throw Xe(16141)}get color(){throw Xe(16727)}get left(){throw Xe(29726)}get right(){throw Xe(36894)}copy(e,n,r,s,o){return this}insert(e,n,r){return new zn(e,n)}remove(e,n){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Tn{constructor(e){this.comparator=e,this.data=new Xt(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((n,r)=>(e(n),!1)))}forEachInRange(e,n){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;n(s.key)}}forEachWhile(e,n){let r;for(r=n!==void 0?this.data.getIteratorFrom(n):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const n=this.data.getIteratorFrom(e);return n.hasNext()?n.getNext().key:null}getIterator(){return new zw(this.data.getIterator())}getIteratorFrom(e){return new zw(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let n=this;return n.size<e.size&&(n=e,e=this),e.forEach((r=>{n=n.add(r)})),n}isEqual(e){if(!(e instanceof Tn)||this.size!==e.size)return!1;const n=this.data.getIterator(),r=e.data.getIterator();for(;n.hasNext();){const s=n.getNext().key,o=r.getNext().key;if(this.comparator(s,o)!==0)return!1}return!0}toArray(){const e=[];return this.forEach((n=>{e.push(n)})),e}toString(){const e=[];return this.forEach((n=>e.push(n))),"SortedSet("+e.toString()+")"}copy(e){const n=new Tn(this.comparator);return n.data=e,n}}class zw{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class Sr{constructor(e){this.fields=e,e.sort(Bn.comparator)}static empty(){return new Sr([])}unionWith(e){let n=new Tn(Bn.comparator);for(const r of this.fields)n=n.add(r);for(const r of e)n=n.add(r);return new Sr(n.toArray())}covers(e){for(const n of this.fields)if(n.isPrefixOf(e))return!0;return!1}isEqual(e){return Fl(this.fields,e.fields,((n,r)=>n.isEqual(r)))}}class GE extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Fn{constructor(e){this.binaryString=e}static fromBase64String(e){const n=(function(s){try{return atob(s)}catch(o){throw typeof DOMException<"u"&&o instanceof DOMException?new GE("Invalid base64 string: "+o):o}})(e);return new Fn(n)}static fromUint8Array(e){const n=(function(s){let o="";for(let l=0;l<s.length;++l)o+=String.fromCharCode(s[l]);return o})(e);return new Fn(n)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(n){return btoa(n)})(this.binaryString)}toUint8Array(){return(function(n){const r=new Uint8Array(n.length);for(let s=0;s<n.length;s++)r[s]=n.charCodeAt(s);return r})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return mt(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Fn.EMPTY_BYTE_STRING=new Fn("");const dM=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Sa(t){if(Tt(!!t,39018),typeof t=="string"){let e=0;const n=dM.exec(t);if(Tt(!!n,46558,{timestamp:t}),n[1]){let s=n[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:an(t.seconds),nanos:an(t.nanos)}}function an(t){return typeof t=="number"?t:typeof t=="string"?Number(t):0}function Ea(t){return typeof t=="string"?Fn.fromBase64String(t):Fn.fromUint8Array(t)}const WE="server_timestamp",QE="__type__",KE="__previous_value__",YE="__local_write_time__";function l0(t){return(t?.mapValue?.fields||{})[QE]?.stringValue===WE}function Jf(t){const e=t.mapValue.fields[KE];return l0(e)?Jf(e):e}function zu(t){const e=Sa(t.mapValue.fields[YE].timestampValue);return new $t(e.seconds,e.nanos)}class hM{constructor(e,n,r,s,o,l,d,h,m,p){this.databaseId=e,this.appId=n,this.persistenceKey=r,this.host=s,this.ssl=o,this.forceLongPolling=l,this.autoDetectLongPolling=d,this.longPollingOptions=h,this.useFetchStreams=m,this.isUsingEmulator=p}}const wf="(default)";class Bu{constructor(e,n){this.projectId=e,this.database=n||wf}static empty(){return new Bu("","")}get isDefaultDatabase(){return this.database===wf}isEqual(e){return e instanceof Bu&&e.projectId===this.projectId&&e.database===this.database}}const XE="__type__",fM="__max__",qh={mapValue:{}},ZE="__vector__",Sf="value";function Ca(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?l0(t)?4:pM(t)?9007199254740991:mM(t)?10:11:Xe(28295,{value:t})}function $i(t,e){if(t===e)return!0;const n=Ca(t);if(n!==Ca(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return zu(t).isEqual(zu(e));case 3:return(function(s,o){if(typeof s.timestampValue=="string"&&typeof o.timestampValue=="string"&&s.timestampValue.length===o.timestampValue.length)return s.timestampValue===o.timestampValue;const l=Sa(s.timestampValue),d=Sa(o.timestampValue);return l.seconds===d.seconds&&l.nanos===d.nanos})(t,e);case 5:return t.stringValue===e.stringValue;case 6:return(function(s,o){return Ea(s.bytesValue).isEqual(Ea(o.bytesValue))})(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return(function(s,o){return an(s.geoPointValue.latitude)===an(o.geoPointValue.latitude)&&an(s.geoPointValue.longitude)===an(o.geoPointValue.longitude)})(t,e);case 2:return(function(s,o){if("integerValue"in s&&"integerValue"in o)return an(s.integerValue)===an(o.integerValue);if("doubleValue"in s&&"doubleValue"in o){const l=an(s.doubleValue),d=an(o.doubleValue);return l===d?xf(l)===xf(d):isNaN(l)&&isNaN(d)}return!1})(t,e);case 9:return Fl(t.arrayValue.values||[],e.arrayValue.values||[],$i);case 10:case 11:return(function(s,o){const l=s.mapValue.fields||{},d=o.mapValue.fields||{};if(Pw(l)!==Pw(d))return!1;for(const h in l)if(l.hasOwnProperty(h)&&(d[h]===void 0||!$i(l[h],d[h])))return!1;return!0})(t,e);default:return Xe(52216,{left:t})}}function Lu(t,e){return(t.values||[]).find((n=>$i(n,e)))!==void 0}function Vl(t,e){if(t===e)return 0;const n=Ca(t),r=Ca(e);if(n!==r)return mt(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return mt(t.booleanValue,e.booleanValue);case 2:return(function(o,l){const d=an(o.integerValue||o.doubleValue),h=an(l.integerValue||l.doubleValue);return d<h?-1:d>h?1:d===h?0:isNaN(d)?isNaN(h)?0:-1:1})(t,e);case 3:return Bw(t.timestampValue,e.timestampValue);case 4:return Bw(zu(t),zu(e));case 5:return py(t.stringValue,e.stringValue);case 6:return(function(o,l){const d=Ea(o),h=Ea(l);return d.compareTo(h)})(t.bytesValue,e.bytesValue);case 7:return(function(o,l){const d=o.split("/"),h=l.split("/");for(let m=0;m<d.length&&m<h.length;m++){const p=mt(d[m],h[m]);if(p!==0)return p}return mt(d.length,h.length)})(t.referenceValue,e.referenceValue);case 8:return(function(o,l){const d=mt(an(o.latitude),an(l.latitude));return d!==0?d:mt(an(o.longitude),an(l.longitude))})(t.geoPointValue,e.geoPointValue);case 9:return Lw(t.arrayValue,e.arrayValue);case 10:return(function(o,l){const d=o.fields||{},h=l.fields||{},m=d[Sf]?.arrayValue,p=h[Sf]?.arrayValue,g=mt(m?.values?.length||0,p?.values?.length||0);return g!==0?g:Lw(m,p)})(t.mapValue,e.mapValue);case 11:return(function(o,l){if(o===qh.mapValue&&l===qh.mapValue)return 0;if(o===qh.mapValue)return 1;if(l===qh.mapValue)return-1;const d=o.fields||{},h=Object.keys(d),m=l.fields||{},p=Object.keys(m);h.sort(),p.sort();for(let g=0;g<h.length&&g<p.length;++g){const v=py(h[g],p[g]);if(v!==0)return v;const _=Vl(d[h[g]],m[p[g]]);if(_!==0)return _}return mt(h.length,p.length)})(t.mapValue,e.mapValue);default:throw Xe(23264,{he:n})}}function Bw(t,e){if(typeof t=="string"&&typeof e=="string"&&t.length===e.length)return mt(t,e);const n=Sa(t),r=Sa(e),s=mt(n.seconds,r.seconds);return s!==0?s:mt(n.nanos,r.nanos)}function Lw(t,e){const n=t.values||[],r=e.values||[];for(let s=0;s<n.length&&s<r.length;++s){const o=Vl(n[s],r[s]);if(o)return o}return mt(n.length,r.length)}function $l(t){return gy(t)}function gy(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?(function(n){const r=Sa(n);return`time(${r.seconds},${r.nanos})`})(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?(function(n){return Ea(n).toBase64()})(t.bytesValue):"referenceValue"in t?(function(n){return We.fromName(n).toString()})(t.referenceValue):"geoPointValue"in t?(function(n){return`geo(${n.latitude},${n.longitude})`})(t.geoPointValue):"arrayValue"in t?(function(n){let r="[",s=!0;for(const o of n.values||[])s?s=!1:r+=",",r+=gy(o);return r+"]"})(t.arrayValue):"mapValue"in t?(function(n){const r=Object.keys(n.fields||{}).sort();let s="{",o=!0;for(const l of r)o?o=!1:s+=",",s+=`${l}:${gy(n.fields[l])}`;return s+"}"})(t.mapValue):Xe(61005,{value:t})}function rf(t){switch(Ca(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=Jf(t);return e?16+rf(e):16;case 5:return 2*t.stringValue.length;case 6:return Ea(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return(function(r){return(r.values||[]).reduce(((s,o)=>s+rf(o)),0)})(t.arrayValue);case 10:case 11:return(function(r){let s=0;return ka(r.fields,((o,l)=>{s+=o.length+rf(l)})),s})(t.mapValue);default:throw Xe(13486,{value:t})}}function Uw(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function yy(t){return!!t&&"integerValue"in t}function c0(t){return!!t&&"arrayValue"in t}function Fw(t){return!!t&&"nullValue"in t}function Vw(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function sf(t){return!!t&&"mapValue"in t}function mM(t){return(t?.mapValue?.fields||{})[XE]?.stringValue===ZE}function Au(t){if(t.geoPointValue)return{geoPointValue:{...t.geoPointValue}};if(t.timestampValue&&typeof t.timestampValue=="object")return{timestampValue:{...t.timestampValue}};if(t.mapValue){const e={mapValue:{fields:{}}};return ka(t.mapValue.fields,((n,r)=>e.mapValue.fields[n]=Au(r))),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=Au(t.arrayValue.values[n]);return e}return{...t}}function pM(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue===fM}class dr{constructor(e){this.value=e}static empty(){return new dr({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let n=this.value;for(let r=0;r<e.length-1;++r)if(n=(n.mapValue.fields||{})[e.get(r)],!sf(n))return null;return n=(n.mapValue.fields||{})[e.lastSegment()],n||null}}set(e,n){this.getFieldsMap(e.popLast())[e.lastSegment()]=Au(n)}setAll(e){let n=Bn.emptyPath(),r={},s=[];e.forEach(((l,d)=>{if(!n.isImmediateParentOf(d)){const h=this.getFieldsMap(n);this.applyChanges(h,r,s),r={},s=[],n=d.popLast()}l?r[d.lastSegment()]=Au(l):s.push(d.lastSegment())}));const o=this.getFieldsMap(n);this.applyChanges(o,r,s)}delete(e){const n=this.field(e.popLast());sf(n)&&n.mapValue.fields&&delete n.mapValue.fields[e.lastSegment()]}isEqual(e){return $i(this.value,e.value)}getFieldsMap(e){let n=this.value;n.mapValue.fields||(n.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=n.mapValue.fields[e.get(r)];sf(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},n.mapValue.fields[e.get(r)]=s),n=s}return n.mapValue.fields}applyChanges(e,n,r){ka(n,((s,o)=>e[s]=o));for(const s of r)delete e[s]}clone(){return new dr(Au(this.value))}}function JE(t){const e=[];return ka(t.fields,((n,r)=>{const s=new Bn([n]);if(sf(r)){const o=JE(r.mapValue).fields;if(o.length===0)e.push(s);else for(const l of o)e.push(s.child(l))}else e.push(s)})),new Sr(e)}class Kn{constructor(e,n,r,s,o,l,d){this.key=e,this.documentType=n,this.version=r,this.readTime=s,this.createTime=o,this.data=l,this.documentState=d}static newInvalidDocument(e){return new Kn(e,0,et.min(),et.min(),et.min(),dr.empty(),0)}static newFoundDocument(e,n,r,s){return new Kn(e,1,n,et.min(),r,s,0)}static newNoDocument(e,n){return new Kn(e,2,n,et.min(),et.min(),dr.empty(),0)}static newUnknownDocument(e,n){return new Kn(e,3,n,et.min(),et.min(),dr.empty(),2)}convertToFoundDocument(e,n){return!this.createTime.isEqual(et.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=n,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=dr.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=dr.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=et.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Kn&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Kn(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Ef{constructor(e,n){this.position=e,this.inclusive=n}}function $w(t,e,n){let r=0;for(let s=0;s<t.position.length;s++){const o=e[s],l=t.position[s];if(o.field.isKeyField()?r=We.comparator(We.fromName(l.referenceValue),n.key):r=Vl(l,n.data.field(o.field)),o.dir==="desc"&&(r*=-1),r!==0)break}return r}function Hw(t,e){if(t===null)return e===null;if(e===null||t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!$i(t.position[n],e.position[n]))return!1;return!0}class Cf{constructor(e,n="asc"){this.field=e,this.dir=n}}function gM(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}class eC{}class yn extends eC{constructor(e,n,r){super(),this.field=e,this.op=n,this.value=r}static create(e,n,r){return e.isKeyField()?n==="in"||n==="not-in"?this.createKeyFieldInFilter(e,n,r):new _M(e,n,r):n==="array-contains"?new xM(e,r):n==="in"?new wM(e,r):n==="not-in"?new SM(e,r):n==="array-contains-any"?new EM(e,r):new yn(e,n,r)}static createKeyFieldInFilter(e,n,r){return n==="in"?new bM(e,r):new vM(e,r)}matches(e){const n=e.data.field(this.field);return this.op==="!="?n!==null&&n.nullValue===void 0&&this.matchesComparison(Vl(n,this.value)):n!==null&&Ca(this.value)===Ca(n)&&this.matchesComparison(Vl(n,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Xe(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class oi extends eC{constructor(e,n){super(),this.filters=e,this.op=n,this.Pe=null}static create(e,n){return new oi(e,n)}matches(e){return tC(this)?this.filters.find((n=>!n.matches(e)))===void 0:this.filters.find((n=>n.matches(e)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((e,n)=>e.concat(n.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function tC(t){return t.op==="and"}function nC(t){return yM(t)&&tC(t)}function yM(t){for(const e of t.filters)if(e instanceof oi)return!1;return!0}function _y(t){if(t instanceof yn)return t.field.canonicalString()+t.op.toString()+$l(t.value);if(nC(t))return t.filters.map((e=>_y(e))).join(",");{const e=t.filters.map((n=>_y(n))).join(",");return`${t.op}(${e})`}}function rC(t,e){return t instanceof yn?(function(r,s){return s instanceof yn&&r.op===s.op&&r.field.isEqual(s.field)&&$i(r.value,s.value)})(t,e):t instanceof oi?(function(r,s){return s instanceof oi&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce(((o,l,d)=>o&&rC(l,s.filters[d])),!0):!1})(t,e):void Xe(19439)}function iC(t){return t instanceof yn?(function(n){return`${n.field.canonicalString()} ${n.op} ${$l(n.value)}`})(t):t instanceof oi?(function(n){return n.op.toString()+" {"+n.getFilters().map(iC).join(" ,")+"}"})(t):"Filter"}class _M extends yn{constructor(e,n,r){super(e,n,r),this.key=We.fromName(r.referenceValue)}matches(e){const n=We.comparator(e.key,this.key);return this.matchesComparison(n)}}class bM extends yn{constructor(e,n){super(e,"in",n),this.keys=sC("in",n)}matches(e){return this.keys.some((n=>n.isEqual(e.key)))}}class vM extends yn{constructor(e,n){super(e,"not-in",n),this.keys=sC("not-in",n)}matches(e){return!this.keys.some((n=>n.isEqual(e.key)))}}function sC(t,e){return(e.arrayValue?.values||[]).map((n=>We.fromName(n.referenceValue)))}class xM extends yn{constructor(e,n){super(e,"array-contains",n)}matches(e){const n=e.data.field(this.field);return c0(n)&&Lu(n.arrayValue,this.value)}}class wM extends yn{constructor(e,n){super(e,"in",n)}matches(e){const n=e.data.field(this.field);return n!==null&&Lu(this.value.arrayValue,n)}}class SM extends yn{constructor(e,n){super(e,"not-in",n)}matches(e){if(Lu(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const n=e.data.field(this.field);return n!==null&&n.nullValue===void 0&&!Lu(this.value.arrayValue,n)}}class EM extends yn{constructor(e,n){super(e,"array-contains-any",n)}matches(e){const n=e.data.field(this.field);return!(!c0(n)||!n.arrayValue.values)&&n.arrayValue.values.some((r=>Lu(this.value.arrayValue,r)))}}class CM{constructor(e,n=null,r=[],s=[],o=null,l=null,d=null){this.path=e,this.collectionGroup=n,this.orderBy=r,this.filters=s,this.limit=o,this.startAt=l,this.endAt=d,this.Te=null}}function qw(t,e=null,n=[],r=[],s=null,o=null,l=null){return new CM(t,e,n,r,s,o,l)}function u0(t){const e=nt(t);if(e.Te===null){let n=e.path.canonicalString();e.collectionGroup!==null&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map((r=>_y(r))).join(","),n+="|ob:",n+=e.orderBy.map((r=>(function(o){return o.field.canonicalString()+o.dir})(r))).join(","),Zf(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map((r=>$l(r))).join(",")),e.endAt&&(n+="|ub:",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map((r=>$l(r))).join(",")),e.Te=n}return e.Te}function d0(t,e){if(t.limit!==e.limit||t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!gM(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!rC(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!Hw(t.startAt,e.startAt)&&Hw(t.endAt,e.endAt)}function by(t){return We.isDocumentKey(t.path)&&t.collectionGroup===null&&t.filters.length===0}class rd{constructor(e,n=null,r=[],s=[],o=null,l="F",d=null,h=null){this.path=e,this.collectionGroup=n,this.explicitOrderBy=r,this.filters=s,this.limit=o,this.limitType=l,this.startAt=d,this.endAt=h,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function TM(t,e,n,r,s,o,l,d){return new rd(t,e,n,r,s,o,l,d)}function h0(t){return new rd(t)}function Gw(t){return t.filters.length===0&&t.limit===null&&t.startAt==null&&t.endAt==null&&(t.explicitOrderBy.length===0||t.explicitOrderBy.length===1&&t.explicitOrderBy[0].field.isKeyField())}function aC(t){return t.collectionGroup!==null}function ju(t){const e=nt(t);if(e.Ie===null){e.Ie=[];const n=new Set;for(const o of e.explicitOrderBy)e.Ie.push(o),n.add(o.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(l){let d=new Tn(Bn.comparator);return l.filters.forEach((h=>{h.getFlattenedFilters().forEach((m=>{m.isInequality()&&(d=d.add(m.field))}))})),d})(e).forEach((o=>{n.has(o.canonicalString())||o.isKeyField()||e.Ie.push(new Cf(o,r))})),n.has(Bn.keyField().canonicalString())||e.Ie.push(new Cf(Bn.keyField(),r))}return e.Ie}function Li(t){const e=nt(t);return e.Ee||(e.Ee=AM(e,ju(t))),e.Ee}function AM(t,e){if(t.limitType==="F")return qw(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map((s=>{const o=s.dir==="desc"?"asc":"desc";return new Cf(s.field,o)}));const n=t.endAt?new Ef(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new Ef(t.startAt.position,t.startAt.inclusive):null;return qw(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}}function vy(t,e){const n=t.filters.concat([e]);return new rd(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}function xy(t,e,n){return new rd(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function em(t,e){return d0(Li(t),Li(e))&&t.limitType===e.limitType}function oC(t){return`${u0(Li(t))}|lt:${t.limitType}`}function jl(t){return`Query(target=${(function(n){let r=n.path.canonicalString();return n.collectionGroup!==null&&(r+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(r+=`, filters: [${n.filters.map((s=>iC(s))).join(", ")}]`),Zf(n.limit)||(r+=", limit: "+n.limit),n.orderBy.length>0&&(r+=`, orderBy: [${n.orderBy.map((s=>(function(l){return`${l.field.canonicalString()} (${l.dir})`})(s))).join(", ")}]`),n.startAt&&(r+=", startAt: ",r+=n.startAt.inclusive?"b:":"a:",r+=n.startAt.position.map((s=>$l(s))).join(",")),n.endAt&&(r+=", endAt: ",r+=n.endAt.inclusive?"a:":"b:",r+=n.endAt.position.map((s=>$l(s))).join(",")),`Target(${r})`})(Li(t))}; limitType=${t.limitType})`}function tm(t,e){return e.isFoundDocument()&&(function(r,s){const o=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(o):We.isDocumentKey(r.path)?r.path.isEqual(o):r.path.isImmediateParentOf(o)})(t,e)&&(function(r,s){for(const o of ju(r))if(!o.field.isKeyField()&&s.data.field(o.field)===null)return!1;return!0})(t,e)&&(function(r,s){for(const o of r.filters)if(!o.matches(s))return!1;return!0})(t,e)&&(function(r,s){return!(r.startAt&&!(function(l,d,h){const m=$w(l,d,h);return l.inclusive?m<=0:m<0})(r.startAt,ju(r),s)||r.endAt&&!(function(l,d,h){const m=$w(l,d,h);return l.inclusive?m>=0:m>0})(r.endAt,ju(r),s))})(t,e)}function jM(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function lC(t){return(e,n)=>{let r=!1;for(const s of ju(t)){const o=RM(s,e,n);if(o!==0)return o;r=r||s.field.isKeyField()}return 0}}function RM(t,e,n){const r=t.field.isKeyField()?We.comparator(e.key,n.key):(function(o,l,d){const h=l.data.field(o),m=d.data.field(o);return h!==null&&m!==null?Vl(h,m):Xe(42886)})(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return Xe(19790,{direction:t.dir})}}class jo{constructor(e,n){this.mapKeyFn=e,this.equalsFn=n,this.inner={},this.innerSize=0}get(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r!==void 0){for(const[s,o]of r)if(this.equalsFn(s,e))return o}}has(e){return this.get(e)!==void 0}set(e,n){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,n]],void this.innerSize++;for(let o=0;o<s.length;o++)if(this.equalsFn(s[o][0],e))return void(s[o]=[e,n]);s.push([e,n]),this.innerSize++}delete(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[n]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){ka(this.inner,((n,r)=>{for(const[s,o]of r)e(s,o)}))}isEmpty(){return qE(this.inner)}size(){return this.innerSize}}const IM=new Xt(We.comparator);function Ss(){return IM}const cC=new Xt(We.comparator);function wu(...t){let e=cC;for(const n of t)e=e.insert(n.key,n);return e}function uC(t){let e=cC;return t.forEach(((n,r)=>e=e.insert(n,r.overlayedDocument))),e}function go(){return Ru()}function dC(){return Ru()}function Ru(){return new jo((t=>t.toString()),((t,e)=>t.isEqual(e)))}const DM=new Xt(We.comparator),kM=new Tn(We.comparator);function pt(...t){let e=kM;for(const n of t)e=e.add(n);return e}const OM=new Tn(mt);function MM(){return OM}function f0(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:xf(e)?"-0":e}}function hC(t){return{integerValue:""+t}}function NM(t,e){return lM(e)?hC(e):f0(t,e)}class nm{constructor(){this._=void 0}}function PM(t,e,n){return t instanceof Tf?(function(s,o){const l={fields:{[QE]:{stringValue:WE},[YE]:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return o&&l0(o)&&(o=Jf(o)),o&&(l.fields[KE]=o),{mapValue:l}})(n,e):t instanceof Hl?mC(t,e):t instanceof ql?pC(t,e):(function(s,o){const l=fC(s,o),d=Ww(l)+Ww(s.Ae);return yy(l)&&yy(s.Ae)?hC(d):f0(s.serializer,d)})(t,e)}function zM(t,e,n){return t instanceof Hl?mC(t,e):t instanceof ql?pC(t,e):n}function fC(t,e){return t instanceof Af?(function(r){return yy(r)||(function(o){return!!o&&"doubleValue"in o})(r)})(e)?e:{integerValue:0}:null}class Tf extends nm{}class Hl extends nm{constructor(e){super(),this.elements=e}}function mC(t,e){const n=gC(e);for(const r of t.elements)n.some((s=>$i(s,r)))||n.push(r);return{arrayValue:{values:n}}}class ql extends nm{constructor(e){super(),this.elements=e}}function pC(t,e){let n=gC(e);for(const r of t.elements)n=n.filter((s=>!$i(s,r)));return{arrayValue:{values:n}}}class Af extends nm{constructor(e,n){super(),this.serializer=e,this.Ae=n}}function Ww(t){return an(t.integerValue||t.doubleValue)}function gC(t){return c0(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}class yC{constructor(e,n){this.field=e,this.transform=n}}function BM(t,e){return t.field.isEqual(e.field)&&(function(r,s){return r instanceof Hl&&s instanceof Hl||r instanceof ql&&s instanceof ql?Fl(r.elements,s.elements,$i):r instanceof Af&&s instanceof Af?$i(r.Ae,s.Ae):r instanceof Tf&&s instanceof Tf})(t.transform,e.transform)}class LM{constructor(e,n){this.version=e,this.transformResults=n}}class hr{constructor(e,n){this.updateTime=e,this.exists=n}static none(){return new hr}static exists(e){return new hr(void 0,e)}static updateTime(e){return new hr(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function af(t,e){return t.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(t.updateTime):t.exists===void 0||t.exists===e.isFoundDocument()}class rm{}function _C(t,e){if(!t.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return t.isNoDocument()?new im(t.key,hr.none()):new id(t.key,t.data,hr.none());{const n=t.data,r=dr.empty();let s=new Tn(Bn.comparator);for(let o of e.fields)if(!s.has(o)){let l=n.field(o);l===null&&o.length>1&&(o=o.popLast(),l=n.field(o)),l===null?r.delete(o):r.set(o,l),s=s.add(o)}return new Oa(t.key,r,new Sr(s.toArray()),hr.none())}}function UM(t,e,n){t instanceof id?(function(s,o,l){const d=s.value.clone(),h=Kw(s.fieldTransforms,o,l.transformResults);d.setAll(h),o.convertToFoundDocument(l.version,d).setHasCommittedMutations()})(t,e,n):t instanceof Oa?(function(s,o,l){if(!af(s.precondition,o))return void o.convertToUnknownDocument(l.version);const d=Kw(s.fieldTransforms,o,l.transformResults),h=o.data;h.setAll(bC(s)),h.setAll(d),o.convertToFoundDocument(l.version,h).setHasCommittedMutations()})(t,e,n):(function(s,o,l){o.convertToNoDocument(l.version).setHasCommittedMutations()})(0,e,n)}function Iu(t,e,n,r){return t instanceof id?(function(o,l,d,h){if(!af(o.precondition,l))return d;const m=o.value.clone(),p=Yw(o.fieldTransforms,h,l);return m.setAll(p),l.convertToFoundDocument(l.version,m).setHasLocalMutations(),null})(t,e,n,r):t instanceof Oa?(function(o,l,d,h){if(!af(o.precondition,l))return d;const m=Yw(o.fieldTransforms,h,l),p=l.data;return p.setAll(bC(o)),p.setAll(m),l.convertToFoundDocument(l.version,p).setHasLocalMutations(),d===null?null:d.unionWith(o.fieldMask.fields).unionWith(o.fieldTransforms.map((g=>g.field)))})(t,e,n,r):(function(o,l,d){return af(o.precondition,l)?(l.convertToNoDocument(l.version).setHasLocalMutations(),null):d})(t,e,n)}function FM(t,e){let n=null;for(const r of t.fieldTransforms){const s=e.data.field(r.field),o=fC(r.transform,s||null);o!=null&&(n===null&&(n=dr.empty()),n.set(r.field,o))}return n||null}function Qw(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!(function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&Fl(r,s,((o,l)=>BM(o,l)))})(t.fieldTransforms,e.fieldTransforms)&&(t.type===0?t.value.isEqual(e.value):t.type!==1||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class id extends rm{constructor(e,n,r,s=[]){super(),this.key=e,this.value=n,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class Oa extends rm{constructor(e,n,r,s,o=[]){super(),this.key=e,this.data=n,this.fieldMask=r,this.precondition=s,this.fieldTransforms=o,this.type=1}getFieldMask(){return this.fieldMask}}function bC(t){const e=new Map;return t.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const r=t.data.field(n);e.set(n,r)}})),e}function Kw(t,e,n){const r=new Map;Tt(t.length===n.length,32656,{Re:n.length,Ve:t.length});for(let s=0;s<n.length;s++){const o=t[s],l=o.transform,d=e.data.field(o.field);r.set(o.field,zM(l,d,n[s]))}return r}function Yw(t,e,n){const r=new Map;for(const s of t){const o=s.transform,l=n.data.field(s.field);r.set(s.field,PM(o,l,e))}return r}class im extends rm{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class VM extends rm{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class $M{constructor(e,n,r,s){this.batchId=e,this.localWriteTime=n,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,n){const r=n.mutationResults;for(let s=0;s<this.mutations.length;s++){const o=this.mutations[s];o.key.isEqual(e.key)&&UM(o,e,r[s])}}applyToLocalView(e,n){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(n=Iu(r,e,n,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(n=Iu(r,e,n,this.localWriteTime));return n}applyToLocalDocumentSet(e,n){const r=dC();return this.mutations.forEach((s=>{const o=e.get(s.key),l=o.overlayedDocument;let d=this.applyToLocalView(l,o.mutatedFields);d=n.has(s.key)?null:d;const h=_C(l,d);h!==null&&r.set(s.key,h),l.isValidDocument()||l.convertToNoDocument(et.min())})),r}keys(){return this.mutations.reduce(((e,n)=>e.add(n.key)),pt())}isEqual(e){return this.batchId===e.batchId&&Fl(this.mutations,e.mutations,((n,r)=>Qw(n,r)))&&Fl(this.baseMutations,e.baseMutations,((n,r)=>Qw(n,r)))}}class m0{constructor(e,n,r,s){this.batch=e,this.commitVersion=n,this.mutationResults=r,this.docVersions=s}static from(e,n,r){Tt(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let s=(function(){return DM})();const o=e.mutations;for(let l=0;l<o.length;l++)s=s.insert(o[l].key,r[l].version);return new m0(e,n,r,s)}}class HM{constructor(e,n){this.largestBatchId=e,this.mutation=n}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class qM{constructor(e,n){this.count=e,this.unchangedNames=n}}var gn,yt;function GM(t){switch(t){case je.OK:return Xe(64938);case je.CANCELLED:case je.UNKNOWN:case je.DEADLINE_EXCEEDED:case je.RESOURCE_EXHAUSTED:case je.INTERNAL:case je.UNAVAILABLE:case je.UNAUTHENTICATED:return!1;case je.INVALID_ARGUMENT:case je.NOT_FOUND:case je.ALREADY_EXISTS:case je.PERMISSION_DENIED:case je.FAILED_PRECONDITION:case je.ABORTED:case je.OUT_OF_RANGE:case je.UNIMPLEMENTED:case je.DATA_LOSS:return!0;default:return Xe(15467,{code:t})}}function vC(t){if(t===void 0)return ws("GRPC error has no .code"),je.UNKNOWN;switch(t){case gn.OK:return je.OK;case gn.CANCELLED:return je.CANCELLED;case gn.UNKNOWN:return je.UNKNOWN;case gn.DEADLINE_EXCEEDED:return je.DEADLINE_EXCEEDED;case gn.RESOURCE_EXHAUSTED:return je.RESOURCE_EXHAUSTED;case gn.INTERNAL:return je.INTERNAL;case gn.UNAVAILABLE:return je.UNAVAILABLE;case gn.UNAUTHENTICATED:return je.UNAUTHENTICATED;case gn.INVALID_ARGUMENT:return je.INVALID_ARGUMENT;case gn.NOT_FOUND:return je.NOT_FOUND;case gn.ALREADY_EXISTS:return je.ALREADY_EXISTS;case gn.PERMISSION_DENIED:return je.PERMISSION_DENIED;case gn.FAILED_PRECONDITION:return je.FAILED_PRECONDITION;case gn.ABORTED:return je.ABORTED;case gn.OUT_OF_RANGE:return je.OUT_OF_RANGE;case gn.UNIMPLEMENTED:return je.UNIMPLEMENTED;case gn.DATA_LOSS:return je.DATA_LOSS;default:return Xe(39323,{code:t})}}(yt=gn||(gn={}))[yt.OK=0]="OK",yt[yt.CANCELLED=1]="CANCELLED",yt[yt.UNKNOWN=2]="UNKNOWN",yt[yt.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",yt[yt.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",yt[yt.NOT_FOUND=5]="NOT_FOUND",yt[yt.ALREADY_EXISTS=6]="ALREADY_EXISTS",yt[yt.PERMISSION_DENIED=7]="PERMISSION_DENIED",yt[yt.UNAUTHENTICATED=16]="UNAUTHENTICATED",yt[yt.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",yt[yt.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",yt[yt.ABORTED=10]="ABORTED",yt[yt.OUT_OF_RANGE=11]="OUT_OF_RANGE",yt[yt.UNIMPLEMENTED=12]="UNIMPLEMENTED",yt[yt.INTERNAL=13]="INTERNAL",yt[yt.UNAVAILABLE=14]="UNAVAILABLE",yt[yt.DATA_LOSS=15]="DATA_LOSS";function WM(){return new TextEncoder}const QM=new va([4294967295,4294967295],0);function Xw(t){const e=WM().encode(t),n=new ME;return n.update(e),new Uint8Array(n.digest())}function Zw(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),o=e.getUint32(12,!0);return[new va([n,r],0),new va([s,o],0)]}class p0{constructor(e,n,r){if(this.bitmap=e,this.padding=n,this.hashCount=r,n<0||n>=8)throw new Su(`Invalid padding: ${n}`);if(r<0)throw new Su(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Su(`Invalid hash count: ${r}`);if(e.length===0&&n!==0)throw new Su(`Invalid padding when bitmap length is 0: ${n}`);this.ge=8*e.length-n,this.pe=va.fromNumber(this.ge)}ye(e,n,r){let s=e.add(n.multiply(va.fromNumber(r)));return s.compare(QM)===1&&(s=new va([s.getBits(0),s.getBits(1)],0)),s.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const n=Xw(e),[r,s]=Zw(n);for(let o=0;o<this.hashCount;o++){const l=this.ye(r,s,o);if(!this.we(l))return!1}return!0}static create(e,n,r){const s=e%8==0?0:8-e%8,o=new Uint8Array(Math.ceil(e/8)),l=new p0(o,s,n);return r.forEach((d=>l.insert(d))),l}insert(e){if(this.ge===0)return;const n=Xw(e),[r,s]=Zw(n);for(let o=0;o<this.hashCount;o++){const l=this.ye(r,s,o);this.Se(l)}}Se(e){const n=Math.floor(e/8),r=e%8;this.bitmap[n]|=1<<r}}class Su extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class sm{constructor(e,n,r,s,o){this.snapshotVersion=e,this.targetChanges=n,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=o}static createSynthesizedRemoteEventForCurrentChange(e,n,r){const s=new Map;return s.set(e,sd.createSynthesizedTargetChangeForCurrentChange(e,n,r)),new sm(et.min(),s,new Xt(mt),Ss(),pt())}}class sd{constructor(e,n,r,s,o){this.resumeToken=e,this.current=n,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=o}static createSynthesizedTargetChangeForCurrentChange(e,n,r){return new sd(r,n,pt(),pt(),pt())}}class of{constructor(e,n,r,s){this.be=e,this.removedTargetIds=n,this.key=r,this.De=s}}class xC{constructor(e,n){this.targetId=e,this.Ce=n}}class wC{constructor(e,n,r=Fn.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=n,this.resumeToken=r,this.cause=s}}class Jw{constructor(){this.ve=0,this.Fe=eS(),this.Me=Fn.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=pt(),n=pt(),r=pt();return this.Fe.forEach(((s,o)=>{switch(o){case 0:e=e.add(s);break;case 2:n=n.add(s);break;case 1:r=r.add(s);break;default:Xe(38017,{changeType:o})}})),new sd(this.Me,this.xe,e,n,r)}qe(){this.Oe=!1,this.Fe=eS()}Qe(e,n){this.Oe=!0,this.Fe=this.Fe.insert(e,n)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,Tt(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class KM{constructor(e){this.Ge=e,this.ze=new Map,this.je=Ss(),this.Je=Gh(),this.He=Gh(),this.Ye=new Xt(mt)}Ze(e){for(const n of e.be)e.De&&e.De.isFoundDocument()?this.Xe(n,e.De):this.et(n,e.key,e.De);for(const n of e.removedTargetIds)this.et(n,e.key,e.De)}tt(e){this.forEachTarget(e,(n=>{const r=this.nt(n);switch(e.state){case 0:this.rt(n)&&r.Le(e.resumeToken);break;case 1:r.Ke(),r.Ne||r.qe(),r.Le(e.resumeToken);break;case 2:r.Ke(),r.Ne||this.removeTarget(n);break;case 3:this.rt(n)&&(r.We(),r.Le(e.resumeToken));break;case 4:this.rt(n)&&(this.it(n),r.Le(e.resumeToken));break;default:Xe(56790,{state:e.state})}}))}forEachTarget(e,n){e.targetIds.length>0?e.targetIds.forEach(n):this.ze.forEach(((r,s)=>{this.rt(s)&&n(s)}))}st(e){const n=e.targetId,r=e.Ce.count,s=this.ot(n);if(s){const o=s.target;if(by(o))if(r===0){const l=new We(o.path);this.et(n,l,Kn.newNoDocument(l,et.min()))}else Tt(r===1,20013,{expectedCount:r});else{const l=this._t(n);if(l!==r){const d=this.ut(e),h=d?this.ct(d,e,l):1;if(h!==0){this.it(n);const m=h===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(n,m)}}}}}ut(e){const n=e.Ce.unchangedNames;if(!n||!n.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:o=0}=n;let l,d;try{l=Ea(r).toUint8Array()}catch(h){if(h instanceof GE)return Ul("Decoding the base64 bloom filter in existence filter failed ("+h.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw h}try{d=new p0(l,s,o)}catch(h){return Ul(h instanceof Su?"BloomFilter error: ":"Applying bloom filter failed: ",h),null}return d.ge===0?null:d}ct(e,n,r){return n.Ce.count===r-this.Pt(e,n.targetId)?0:2}Pt(e,n){const r=this.Ge.getRemoteKeysForTarget(n);let s=0;return r.forEach((o=>{const l=this.Ge.ht(),d=`projects/${l.projectId}/databases/${l.database}/documents/${o.path.canonicalString()}`;e.mightContain(d)||(this.et(n,o,null),s++)})),s}Tt(e){const n=new Map;this.ze.forEach(((o,l)=>{const d=this.ot(l);if(d){if(o.current&&by(d.target)){const h=new We(d.target.path);this.It(h).has(l)||this.Et(l,h)||this.et(l,h,Kn.newNoDocument(h,e))}o.Be&&(n.set(l,o.ke()),o.qe())}}));let r=pt();this.He.forEach(((o,l)=>{let d=!0;l.forEachWhile((h=>{const m=this.ot(h);return!m||m.purpose==="TargetPurposeLimboResolution"||(d=!1,!1)})),d&&(r=r.add(o))})),this.je.forEach(((o,l)=>l.setReadTime(e)));const s=new sm(e,n,this.Ye,this.je,r);return this.je=Ss(),this.Je=Gh(),this.He=Gh(),this.Ye=new Xt(mt),s}Xe(e,n){if(!this.rt(e))return;const r=this.Et(e,n.key)?2:0;this.nt(e).Qe(n.key,r),this.je=this.je.insert(n.key,n),this.Je=this.Je.insert(n.key,this.It(n.key).add(e)),this.He=this.He.insert(n.key,this.dt(n.key).add(e))}et(e,n,r){if(!this.rt(e))return;const s=this.nt(e);this.Et(e,n)?s.Qe(n,1):s.$e(n),this.He=this.He.insert(n,this.dt(n).delete(e)),this.He=this.He.insert(n,this.dt(n).add(e)),r&&(this.je=this.je.insert(n,r))}removeTarget(e){this.ze.delete(e)}_t(e){const n=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+n.addedDocuments.size-n.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let n=this.ze.get(e);return n||(n=new Jw,this.ze.set(e,n)),n}dt(e){let n=this.He.get(e);return n||(n=new Tn(mt),this.He=this.He.insert(e,n)),n}It(e){let n=this.Je.get(e);return n||(n=new Tn(mt),this.Je=this.Je.insert(e,n)),n}rt(e){const n=this.ot(e)!==null;return n||Le("WatchChangeAggregator","Detected inactive target",e),n}ot(e){const n=this.ze.get(e);return n&&n.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new Jw),this.Ge.getRemoteKeysForTarget(e).forEach((n=>{this.et(e,n,null)}))}Et(e,n){return this.Ge.getRemoteKeysForTarget(e).has(n)}}function Gh(){return new Xt(We.comparator)}function eS(){return new Xt(We.comparator)}const YM={asc:"ASCENDING",desc:"DESCENDING"},XM={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},ZM={and:"AND",or:"OR"};class JM{constructor(e,n){this.databaseId=e,this.useProto3Json=n}}function wy(t,e){return t.useProto3Json||Zf(e)?e:{value:e}}function jf(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function SC(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function eN(t,e){return jf(t,e.toTimestamp())}function Ui(t){return Tt(!!t,49232),et.fromTimestamp((function(n){const r=Sa(n);return new $t(r.seconds,r.nanos)})(t))}function g0(t,e){return Sy(t,e).canonicalString()}function Sy(t,e){const n=(function(s){return new Lt(["projects",s.projectId,"databases",s.database])})(t).child("documents");return e===void 0?n:n.child(e)}function EC(t){const e=Lt.fromString(t);return Tt(RC(e),10190,{key:e.toString()}),e}function Ey(t,e){return g0(t.databaseId,e.path)}function zg(t,e){const n=EC(e);if(n.get(1)!==t.databaseId.projectId)throw new Be(je.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new Be(je.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new We(TC(n))}function CC(t,e){return g0(t.databaseId,e)}function tN(t){const e=EC(t);return e.length===4?Lt.emptyPath():TC(e)}function Cy(t){return new Lt(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function TC(t){return Tt(t.length>4&&t.get(4)==="documents",29091,{key:t.toString()}),t.popFirst(5)}function tS(t,e,n){return{name:Ey(t,e),fields:n.value.mapValue.fields}}function nN(t,e){let n;if("targetChange"in e){e.targetChange;const r=(function(m){return m==="NO_CHANGE"?0:m==="ADD"?1:m==="REMOVE"?2:m==="CURRENT"?3:m==="RESET"?4:Xe(39313,{state:m})})(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],o=(function(m,p){return m.useProto3Json?(Tt(p===void 0||typeof p=="string",58123),Fn.fromBase64String(p||"")):(Tt(p===void 0||p instanceof Buffer||p instanceof Uint8Array,16193),Fn.fromUint8Array(p||new Uint8Array))})(t,e.targetChange.resumeToken),l=e.targetChange.cause,d=l&&(function(m){const p=m.code===void 0?je.UNKNOWN:vC(m.code);return new Be(p,m.message||"")})(l);n=new wC(r,s,o,d||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=zg(t,r.document.name),o=Ui(r.document.updateTime),l=r.document.createTime?Ui(r.document.createTime):et.min(),d=new dr({mapValue:{fields:r.document.fields}}),h=Kn.newFoundDocument(s,o,l,d),m=r.targetIds||[],p=r.removedTargetIds||[];n=new of(m,p,h.key,h)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=zg(t,r.document),o=r.readTime?Ui(r.readTime):et.min(),l=Kn.newNoDocument(s,o),d=r.removedTargetIds||[];n=new of([],d,l.key,l)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=zg(t,r.document),o=r.removedTargetIds||[];n=new of([],o,s,null)}else{if(!("filter"in e))return Xe(11601,{Rt:e});{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:o}=r,l=new qM(s,o),d=r.targetId;n=new xC(d,l)}}return n}function rN(t,e){let n;if(e instanceof id)n={update:tS(t,e.key,e.value)};else if(e instanceof im)n={delete:Ey(t,e.key)};else if(e instanceof Oa)n={update:tS(t,e.key,e.data),updateMask:hN(e.fieldMask)};else{if(!(e instanceof VM))return Xe(16599,{Vt:e.type});n={verify:Ey(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map((r=>(function(o,l){const d=l.transform;if(d instanceof Tf)return{fieldPath:l.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(d instanceof Hl)return{fieldPath:l.field.canonicalString(),appendMissingElements:{values:d.elements}};if(d instanceof ql)return{fieldPath:l.field.canonicalString(),removeAllFromArray:{values:d.elements}};if(d instanceof Af)return{fieldPath:l.field.canonicalString(),increment:d.Ae};throw Xe(20930,{transform:l.transform})})(0,r)))),e.precondition.isNone||(n.currentDocument=(function(s,o){return o.updateTime!==void 0?{updateTime:eN(s,o.updateTime)}:o.exists!==void 0?{exists:o.exists}:Xe(27497)})(t,e.precondition)),n}function iN(t,e){return t&&t.length>0?(Tt(e!==void 0,14353),t.map((n=>(function(s,o){let l=s.updateTime?Ui(s.updateTime):Ui(o);return l.isEqual(et.min())&&(l=Ui(o)),new LM(l,s.transformResults||[])})(n,e)))):[]}function sN(t,e){return{documents:[CC(t,e.path)]}}function aN(t,e){const n={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=CC(t,s);const o=(function(m){if(m.length!==0)return jC(oi.create(m,"and"))})(e.filters);o&&(n.structuredQuery.where=o);const l=(function(m){if(m.length!==0)return m.map((p=>(function(v){return{field:Rl(v.field),direction:cN(v.dir)}})(p)))})(e.orderBy);l&&(n.structuredQuery.orderBy=l);const d=wy(t,e.limit);return d!==null&&(n.structuredQuery.limit=d),e.startAt&&(n.structuredQuery.startAt=(function(m){return{before:m.inclusive,values:m.position}})(e.startAt)),e.endAt&&(n.structuredQuery.endAt=(function(m){return{before:!m.inclusive,values:m.position}})(e.endAt)),{ft:n,parent:s}}function oN(t){let e=tN(t.parent);const n=t.structuredQuery,r=n.from?n.from.length:0;let s=null;if(r>0){Tt(r===1,65062);const p=n.from[0];p.allDescendants?s=p.collectionId:e=e.child(p.collectionId)}let o=[];n.where&&(o=(function(g){const v=AC(g);return v instanceof oi&&nC(v)?v.getFilters():[v]})(n.where));let l=[];n.orderBy&&(l=(function(g){return g.map((v=>(function(S){return new Cf(Il(S.field),(function(E){switch(E){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(S.direction))})(v)))})(n.orderBy));let d=null;n.limit&&(d=(function(g){let v;return v=typeof g=="object"?g.value:g,Zf(v)?null:v})(n.limit));let h=null;n.startAt&&(h=(function(g){const v=!!g.before,_=g.values||[];return new Ef(_,v)})(n.startAt));let m=null;return n.endAt&&(m=(function(g){const v=!g.before,_=g.values||[];return new Ef(_,v)})(n.endAt)),TM(e,s,l,o,d,"F",h,m)}function lN(t,e){const n=(function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Xe(28987,{purpose:s})}})(e.purpose);return n==null?null:{"goog-listen-tags":n}}function AC(t){return t.unaryFilter!==void 0?(function(n){switch(n.unaryFilter.op){case"IS_NAN":const r=Il(n.unaryFilter.field);return yn.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=Il(n.unaryFilter.field);return yn.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const o=Il(n.unaryFilter.field);return yn.create(o,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const l=Il(n.unaryFilter.field);return yn.create(l,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return Xe(61313);default:return Xe(60726)}})(t):t.fieldFilter!==void 0?(function(n){return yn.create(Il(n.fieldFilter.field),(function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return Xe(58110);default:return Xe(50506)}})(n.fieldFilter.op),n.fieldFilter.value)})(t):t.compositeFilter!==void 0?(function(n){return oi.create(n.compositeFilter.filters.map((r=>AC(r))),(function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return Xe(1026)}})(n.compositeFilter.op))})(t):Xe(30097,{filter:t})}function cN(t){return YM[t]}function uN(t){return XM[t]}function dN(t){return ZM[t]}function Rl(t){return{fieldPath:t.canonicalString()}}function Il(t){return Bn.fromServerFormat(t.fieldPath)}function jC(t){return t instanceof yn?(function(n){if(n.op==="=="){if(Vw(n.value))return{unaryFilter:{field:Rl(n.field),op:"IS_NAN"}};if(Fw(n.value))return{unaryFilter:{field:Rl(n.field),op:"IS_NULL"}}}else if(n.op==="!="){if(Vw(n.value))return{unaryFilter:{field:Rl(n.field),op:"IS_NOT_NAN"}};if(Fw(n.value))return{unaryFilter:{field:Rl(n.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Rl(n.field),op:uN(n.op),value:n.value}}})(t):t instanceof oi?(function(n){const r=n.getFilters().map((s=>jC(s)));return r.length===1?r[0]:{compositeFilter:{op:dN(n.op),filters:r}}})(t):Xe(54877,{filter:t})}function hN(t){const e=[];return t.fields.forEach((n=>e.push(n.canonicalString()))),{fieldPaths:e}}function RC(t){return t.length>=4&&t.get(0)==="projects"&&t.get(2)==="databases"}class fa{constructor(e,n,r,s,o=et.min(),l=et.min(),d=Fn.EMPTY_BYTE_STRING,h=null){this.target=e,this.targetId=n,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=o,this.lastLimboFreeSnapshotVersion=l,this.resumeToken=d,this.expectedCount=h}withSequenceNumber(e){return new fa(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,n){return new fa(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new fa(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new fa(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class fN{constructor(e){this.yt=e}}function mN(t){const e=oN({parent:t.parent,structuredQuery:t.structuredQuery});return t.limitType==="LAST"?xy(e,e.limit,"L"):e}class pN{constructor(){this.Cn=new gN}addToCollectionParentIndex(e,n){return this.Cn.add(n),De.resolve()}getCollectionParents(e,n){return De.resolve(this.Cn.getEntries(n))}addFieldIndex(e,n){return De.resolve()}deleteFieldIndex(e,n){return De.resolve()}deleteAllFieldIndexes(e){return De.resolve()}createTargetIndexes(e,n){return De.resolve()}getDocumentsMatchingTarget(e,n){return De.resolve(null)}getIndexType(e,n){return De.resolve(0)}getFieldIndexes(e,n){return De.resolve([])}getNextCollectionGroupToUpdate(e){return De.resolve(null)}getMinOffset(e,n){return De.resolve(wa.min())}getMinOffsetFromCollectionGroup(e,n){return De.resolve(wa.min())}updateCollectionGroup(e,n,r){return De.resolve()}updateIndexEntries(e,n){return De.resolve()}}class gN{constructor(){this.index={}}add(e){const n=e.lastSegment(),r=e.popLast(),s=this.index[n]||new Tn(Lt.comparator),o=!s.has(r);return this.index[n]=s.add(r),o}has(e){const n=e.lastSegment(),r=e.popLast(),s=this.index[n];return s&&s.has(r)}getEntries(e){return(this.index[e]||new Tn(Lt.comparator)).toArray()}}const nS={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},IC=41943040;class ur{static withCacheSize(e){return new ur(e,ur.DEFAULT_COLLECTION_PERCENTILE,ur.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,n,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=n,this.maximumSequenceNumbersToCollect=r}}ur.DEFAULT_COLLECTION_PERCENTILE=10,ur.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,ur.DEFAULT=new ur(IC,ur.DEFAULT_COLLECTION_PERCENTILE,ur.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),ur.DISABLED=new ur(-1,0,0);class Gl{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new Gl(0)}static cr(){return new Gl(-1)}}const rS="LruGarbageCollector",yN=1048576;function iS([t,e],[n,r]){const s=mt(t,n);return s===0?mt(e,r):s}class _N{constructor(e){this.Ir=e,this.buffer=new Tn(iS),this.Er=0}dr(){return++this.Er}Ar(e){const n=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(n);else{const r=this.buffer.last();iS(n,r)<0&&(this.buffer=this.buffer.delete(r).add(n))}}get maxValue(){return this.buffer.last()[0]}}class bN{constructor(e,n,r){this.garbageCollector=e,this.asyncQueue=n,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){Le(rS,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(n){cc(n)?Le(rS,"Ignoring IndexedDB error during garbage collection: ",n):await lc(n)}await this.Vr(3e5)}))}}class vN{constructor(e,n){this.mr=e,this.params=n}calculateTargetCount(e,n){return this.mr.gr(e).next((r=>Math.floor(n/100*r)))}nthSequenceNumber(e,n){if(n===0)return De.resolve(Xf.ce);const r=new _N(n);return this.mr.forEachTarget(e,(s=>r.Ar(s.sequenceNumber))).next((()=>this.mr.pr(e,(s=>r.Ar(s))))).next((()=>r.maxValue))}removeTargets(e,n,r){return this.mr.removeTargets(e,n,r)}removeOrphanedDocuments(e,n){return this.mr.removeOrphanedDocuments(e,n)}collect(e,n){return this.params.cacheSizeCollectionThreshold===-1?(Le("LruGarbageCollector","Garbage collection skipped; disabled"),De.resolve(nS)):this.getCacheSize(e).next((r=>r<this.params.cacheSizeCollectionThreshold?(Le("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),nS):this.yr(e,n)))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,n){let r,s,o,l,d,h,m;const p=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((g=>(g>this.params.maximumSequenceNumbersToCollect?(Le("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${g}`),s=this.params.maximumSequenceNumbersToCollect):s=g,l=Date.now(),this.nthSequenceNumber(e,s)))).next((g=>(r=g,d=Date.now(),this.removeTargets(e,r,n)))).next((g=>(o=g,h=Date.now(),this.removeOrphanedDocuments(e,r)))).next((g=>(m=Date.now(),Al()<=ft.DEBUG&&Le("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${l-p}ms
	Determined least recently used ${s} in `+(d-l)+`ms
	Removed ${o} targets in `+(h-d)+`ms
	Removed ${g} documents in `+(m-h)+`ms
Total Duration: ${m-p}ms`),De.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:o,documentsRemoved:g}))))}}function xN(t,e){return new vN(t,e)}class wN{constructor(){this.changes=new jo((e=>e.toString()),((e,n)=>e.isEqual(n))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,n){this.assertNotApplied(),this.changes.set(e,Kn.newInvalidDocument(e).setReadTime(n))}getEntry(e,n){this.assertNotApplied();const r=this.changes.get(n);return r!==void 0?De.resolve(r):this.getFromCache(e,n)}getEntries(e,n){return this.getAllFromCache(e,n)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class SN{constructor(e,n){this.overlayedDocument=e,this.mutatedFields=n}}class EN{constructor(e,n,r,s){this.remoteDocumentCache=e,this.mutationQueue=n,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,n){let r=null;return this.documentOverlayCache.getOverlay(e,n).next((s=>(r=s,this.remoteDocumentCache.getEntry(e,n)))).next((s=>(r!==null&&Iu(r.mutation,s,Sr.empty(),$t.now()),s)))}getDocuments(e,n){return this.remoteDocumentCache.getEntries(e,n).next((r=>this.getLocalViewOfDocuments(e,r,pt()).next((()=>r))))}getLocalViewOfDocuments(e,n,r=pt()){const s=go();return this.populateOverlays(e,s,n).next((()=>this.computeViews(e,n,s,r).next((o=>{let l=wu();return o.forEach(((d,h)=>{l=l.insert(d,h.overlayedDocument)})),l}))))}getOverlayedDocuments(e,n){const r=go();return this.populateOverlays(e,r,n).next((()=>this.computeViews(e,n,r,pt())))}populateOverlays(e,n,r){const s=[];return r.forEach((o=>{n.has(o)||s.push(o)})),this.documentOverlayCache.getOverlays(e,s).next((o=>{o.forEach(((l,d)=>{n.set(l,d)}))}))}computeViews(e,n,r,s){let o=Ss();const l=Ru(),d=(function(){return Ru()})();return n.forEach(((h,m)=>{const p=r.get(m.key);s.has(m.key)&&(p===void 0||p.mutation instanceof Oa)?o=o.insert(m.key,m):p!==void 0?(l.set(m.key,p.mutation.getFieldMask()),Iu(p.mutation,m,p.mutation.getFieldMask(),$t.now())):l.set(m.key,Sr.empty())})),this.recalculateAndSaveOverlays(e,o).next((h=>(h.forEach(((m,p)=>l.set(m,p))),n.forEach(((m,p)=>d.set(m,new SN(p,l.get(m)??null)))),d)))}recalculateAndSaveOverlays(e,n){const r=Ru();let s=new Xt(((l,d)=>l-d)),o=pt();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,n).next((l=>{for(const d of l)d.keys().forEach((h=>{const m=n.get(h);if(m===null)return;let p=r.get(h)||Sr.empty();p=d.applyToLocalView(m,p),r.set(h,p);const g=(s.get(d.batchId)||pt()).add(h);s=s.insert(d.batchId,g)}))})).next((()=>{const l=[],d=s.getReverseIterator();for(;d.hasNext();){const h=d.getNext(),m=h.key,p=h.value,g=dC();p.forEach((v=>{if(!o.has(v)){const _=_C(n.get(v),r.get(v));_!==null&&g.set(v,_),o=o.add(v)}})),l.push(this.documentOverlayCache.saveOverlays(e,m,g))}return De.waitFor(l)})).next((()=>r))}recalculateAndSaveOverlaysForDocumentKeys(e,n){return this.remoteDocumentCache.getEntries(e,n).next((r=>this.recalculateAndSaveOverlays(e,r)))}getDocumentsMatchingQuery(e,n,r,s){return(function(l){return We.isDocumentKey(l.path)&&l.collectionGroup===null&&l.filters.length===0})(n)?this.getDocumentsMatchingDocumentQuery(e,n.path):aC(n)?this.getDocumentsMatchingCollectionGroupQuery(e,n,r,s):this.getDocumentsMatchingCollectionQuery(e,n,r,s)}getNextDocuments(e,n,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,n,r,s).next((o=>{const l=s-o.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,n,r.largestBatchId,s-o.size):De.resolve(go());let d=Pu,h=o;return l.next((m=>De.forEach(m,((p,g)=>(d<g.largestBatchId&&(d=g.largestBatchId),o.get(p)?De.resolve():this.remoteDocumentCache.getEntry(e,p).next((v=>{h=h.insert(p,v)}))))).next((()=>this.populateOverlays(e,m,o))).next((()=>this.computeViews(e,h,m,pt()))).next((p=>({batchId:d,changes:uC(p)})))))}))}getDocumentsMatchingDocumentQuery(e,n){return this.getDocument(e,new We(n)).next((r=>{let s=wu();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s}))}getDocumentsMatchingCollectionGroupQuery(e,n,r,s){const o=n.collectionGroup;let l=wu();return this.indexManager.getCollectionParents(e,o).next((d=>De.forEach(d,(h=>{const m=(function(g,v){return new rd(v,null,g.explicitOrderBy.slice(),g.filters.slice(),g.limit,g.limitType,g.startAt,g.endAt)})(n,h.child(o));return this.getDocumentsMatchingCollectionQuery(e,m,r,s).next((p=>{p.forEach(((g,v)=>{l=l.insert(g,v)}))}))})).next((()=>l))))}getDocumentsMatchingCollectionQuery(e,n,r,s){let o;return this.documentOverlayCache.getOverlaysForCollection(e,n.path,r.largestBatchId).next((l=>(o=l,this.remoteDocumentCache.getDocumentsMatchingQuery(e,n,r,o,s)))).next((l=>{o.forEach(((h,m)=>{const p=m.getKey();l.get(p)===null&&(l=l.insert(p,Kn.newInvalidDocument(p)))}));let d=wu();return l.forEach(((h,m)=>{const p=o.get(h);p!==void 0&&Iu(p.mutation,m,Sr.empty(),$t.now()),tm(n,m)&&(d=d.insert(h,m))})),d}))}}class CN{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,n){return De.resolve(this.Lr.get(n))}saveBundleMetadata(e,n){return this.Lr.set(n.id,(function(s){return{id:s.id,version:s.version,createTime:Ui(s.createTime)}})(n)),De.resolve()}getNamedQuery(e,n){return De.resolve(this.kr.get(n))}saveNamedQuery(e,n){return this.kr.set(n.name,(function(s){return{name:s.name,query:mN(s.bundledQuery),readTime:Ui(s.readTime)}})(n)),De.resolve()}}class TN{constructor(){this.overlays=new Xt(We.comparator),this.qr=new Map}getOverlay(e,n){return De.resolve(this.overlays.get(n))}getOverlays(e,n){const r=go();return De.forEach(n,(s=>this.getOverlay(e,s).next((o=>{o!==null&&r.set(s,o)})))).next((()=>r))}saveOverlays(e,n,r){return r.forEach(((s,o)=>{this.St(e,n,o)})),De.resolve()}removeOverlaysForBatchId(e,n,r){const s=this.qr.get(r);return s!==void 0&&(s.forEach((o=>this.overlays=this.overlays.remove(o))),this.qr.delete(r)),De.resolve()}getOverlaysForCollection(e,n,r){const s=go(),o=n.length+1,l=new We(n.child("")),d=this.overlays.getIteratorFrom(l);for(;d.hasNext();){const h=d.getNext().value,m=h.getKey();if(!n.isPrefixOf(m.path))break;m.path.length===o&&h.largestBatchId>r&&s.set(h.getKey(),h)}return De.resolve(s)}getOverlaysForCollectionGroup(e,n,r,s){let o=new Xt(((m,p)=>m-p));const l=this.overlays.getIterator();for(;l.hasNext();){const m=l.getNext().value;if(m.getKey().getCollectionGroup()===n&&m.largestBatchId>r){let p=o.get(m.largestBatchId);p===null&&(p=go(),o=o.insert(m.largestBatchId,p)),p.set(m.getKey(),m)}}const d=go(),h=o.getIterator();for(;h.hasNext()&&(h.getNext().value.forEach(((m,p)=>d.set(m,p))),!(d.size()>=s)););return De.resolve(d)}St(e,n,r){const s=this.overlays.get(r.key);if(s!==null){const l=this.qr.get(s.largestBatchId).delete(r.key);this.qr.set(s.largestBatchId,l)}this.overlays=this.overlays.insert(r.key,new HM(n,r));let o=this.qr.get(n);o===void 0&&(o=pt(),this.qr.set(n,o)),this.qr.set(n,o.add(r.key))}}class AN{constructor(){this.sessionToken=Fn.EMPTY_BYTE_STRING}getSessionToken(e){return De.resolve(this.sessionToken)}setSessionToken(e,n){return this.sessionToken=n,De.resolve()}}class y0{constructor(){this.Qr=new Tn(Dn.$r),this.Ur=new Tn(Dn.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,n){const r=new Dn(e,n);this.Qr=this.Qr.add(r),this.Ur=this.Ur.add(r)}Wr(e,n){e.forEach((r=>this.addReference(r,n)))}removeReference(e,n){this.Gr(new Dn(e,n))}zr(e,n){e.forEach((r=>this.removeReference(r,n)))}jr(e){const n=new We(new Lt([])),r=new Dn(n,e),s=new Dn(n,e+1),o=[];return this.Ur.forEachInRange([r,s],(l=>{this.Gr(l),o.push(l.key)})),o}Jr(){this.Qr.forEach((e=>this.Gr(e)))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const n=new We(new Lt([])),r=new Dn(n,e),s=new Dn(n,e+1);let o=pt();return this.Ur.forEachInRange([r,s],(l=>{o=o.add(l.key)})),o}containsKey(e){const n=new Dn(e,0),r=this.Qr.firstAfterOrEqual(n);return r!==null&&e.isEqual(r.key)}}class Dn{constructor(e,n){this.key=e,this.Yr=n}static $r(e,n){return We.comparator(e.key,n.key)||mt(e.Yr,n.Yr)}static Kr(e,n){return mt(e.Yr,n.Yr)||We.comparator(e.key,n.key)}}class jN{constructor(e,n){this.indexManager=e,this.referenceDelegate=n,this.mutationQueue=[],this.tr=1,this.Zr=new Tn(Dn.$r)}checkEmpty(e){return De.resolve(this.mutationQueue.length===0)}addMutationBatch(e,n,r,s){const o=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const l=new $M(o,n,r,s);this.mutationQueue.push(l);for(const d of s)this.Zr=this.Zr.add(new Dn(d.key,o)),this.indexManager.addToCollectionParentIndex(e,d.key.path.popLast());return De.resolve(l)}lookupMutationBatch(e,n){return De.resolve(this.Xr(n))}getNextMutationBatchAfterBatchId(e,n){const r=n+1,s=this.ei(r),o=s<0?0:s;return De.resolve(this.mutationQueue.length>o?this.mutationQueue[o]:null)}getHighestUnacknowledgedBatchId(){return De.resolve(this.mutationQueue.length===0?o0:this.tr-1)}getAllMutationBatches(e){return De.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,n){const r=new Dn(n,0),s=new Dn(n,Number.POSITIVE_INFINITY),o=[];return this.Zr.forEachInRange([r,s],(l=>{const d=this.Xr(l.Yr);o.push(d)})),De.resolve(o)}getAllMutationBatchesAffectingDocumentKeys(e,n){let r=new Tn(mt);return n.forEach((s=>{const o=new Dn(s,0),l=new Dn(s,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([o,l],(d=>{r=r.add(d.Yr)}))})),De.resolve(this.ti(r))}getAllMutationBatchesAffectingQuery(e,n){const r=n.path,s=r.length+1;let o=r;We.isDocumentKey(o)||(o=o.child(""));const l=new Dn(new We(o),0);let d=new Tn(mt);return this.Zr.forEachWhile((h=>{const m=h.key.path;return!!r.isPrefixOf(m)&&(m.length===s&&(d=d.add(h.Yr)),!0)}),l),De.resolve(this.ti(d))}ti(e){const n=[];return e.forEach((r=>{const s=this.Xr(r);s!==null&&n.push(s)})),n}removeMutationBatch(e,n){Tt(this.ni(n.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Zr;return De.forEach(n.mutations,(s=>{const o=new Dn(s.key,n.batchId);return r=r.delete(o),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)})).next((()=>{this.Zr=r}))}ir(e){}containsKey(e,n){const r=new Dn(n,0),s=this.Zr.firstAfterOrEqual(r);return De.resolve(n.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,De.resolve()}ni(e,n){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const n=this.ei(e);return n<0||n>=this.mutationQueue.length?null:this.mutationQueue[n]}}class RN{constructor(e){this.ri=e,this.docs=(function(){return new Xt(We.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,n){const r=n.key,s=this.docs.get(r),o=s?s.size:0,l=this.ri(n);return this.docs=this.docs.insert(r,{document:n.mutableCopy(),size:l}),this.size+=l-o,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const n=this.docs.get(e);n&&(this.docs=this.docs.remove(e),this.size-=n.size)}getEntry(e,n){const r=this.docs.get(n);return De.resolve(r?r.document.mutableCopy():Kn.newInvalidDocument(n))}getEntries(e,n){let r=Ss();return n.forEach((s=>{const o=this.docs.get(s);r=r.insert(s,o?o.document.mutableCopy():Kn.newInvalidDocument(s))})),De.resolve(r)}getDocumentsMatchingQuery(e,n,r,s){let o=Ss();const l=n.path,d=new We(l.child("__id-9223372036854775808__")),h=this.docs.getIteratorFrom(d);for(;h.hasNext();){const{key:m,value:{document:p}}=h.getNext();if(!l.isPrefixOf(m.path))break;m.path.length>l.length+1||iM(rM(p),r)<=0||(s.has(p.key)||tm(n,p))&&(o=o.insert(p.key,p.mutableCopy()))}return De.resolve(o)}getAllFromCollectionGroup(e,n,r,s){Xe(9500)}ii(e,n){return De.forEach(this.docs,(r=>n(r)))}newChangeBuffer(e){return new IN(this)}getSize(e){return De.resolve(this.size)}}class IN extends wN{constructor(e){super(),this.Nr=e}applyChanges(e){const n=[];return this.changes.forEach(((r,s)=>{s.isValidDocument()?n.push(this.Nr.addEntry(e,s)):this.Nr.removeEntry(r)})),De.waitFor(n)}getFromCache(e,n){return this.Nr.getEntry(e,n)}getAllFromCache(e,n){return this.Nr.getEntries(e,n)}}class DN{constructor(e){this.persistence=e,this.si=new jo((n=>u0(n)),d0),this.lastRemoteSnapshotVersion=et.min(),this.highestTargetId=0,this.oi=0,this._i=new y0,this.targetCount=0,this.ai=Gl.ur()}forEachTarget(e,n){return this.si.forEach(((r,s)=>n(s))),De.resolve()}getLastRemoteSnapshotVersion(e){return De.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return De.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),De.resolve(this.highestTargetId)}setTargetsMetadata(e,n,r){return r&&(this.lastRemoteSnapshotVersion=r),n>this.oi&&(this.oi=n),De.resolve()}Pr(e){this.si.set(e.target,e);const n=e.targetId;n>this.highestTargetId&&(this.ai=new Gl(n),this.highestTargetId=n),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,n){return this.Pr(n),this.targetCount+=1,De.resolve()}updateTargetData(e,n){return this.Pr(n),De.resolve()}removeTargetData(e,n){return this.si.delete(n.target),this._i.jr(n.targetId),this.targetCount-=1,De.resolve()}removeTargets(e,n,r){let s=0;const o=[];return this.si.forEach(((l,d)=>{d.sequenceNumber<=n&&r.get(d.targetId)===null&&(this.si.delete(l),o.push(this.removeMatchingKeysForTargetId(e,d.targetId)),s++)})),De.waitFor(o).next((()=>s))}getTargetCount(e){return De.resolve(this.targetCount)}getTargetData(e,n){const r=this.si.get(n)||null;return De.resolve(r)}addMatchingKeys(e,n,r){return this._i.Wr(n,r),De.resolve()}removeMatchingKeys(e,n,r){this._i.zr(n,r);const s=this.persistence.referenceDelegate,o=[];return s&&n.forEach((l=>{o.push(s.markPotentiallyOrphaned(e,l))})),De.waitFor(o)}removeMatchingKeysForTargetId(e,n){return this._i.jr(n),De.resolve()}getMatchingKeysForTargetId(e,n){const r=this._i.Hr(n);return De.resolve(r)}containsKey(e,n){return De.resolve(this._i.containsKey(n))}}class DC{constructor(e,n){this.ui={},this.overlays={},this.ci=new Xf(0),this.li=!1,this.li=!0,this.hi=new AN,this.referenceDelegate=e(this),this.Pi=new DN(this),this.indexManager=new pN,this.remoteDocumentCache=(function(s){return new RN(s)})((r=>this.referenceDelegate.Ti(r))),this.serializer=new fN(n),this.Ii=new CN(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let n=this.overlays[e.toKey()];return n||(n=new TN,this.overlays[e.toKey()]=n),n}getMutationQueue(e,n){let r=this.ui[e.toKey()];return r||(r=new jN(n,this.referenceDelegate),this.ui[e.toKey()]=r),r}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,n,r){Le("MemoryPersistence","Starting transaction:",e);const s=new kN(this.ci.next());return this.referenceDelegate.Ei(),r(s).next((o=>this.referenceDelegate.di(s).next((()=>o)))).toPromise().then((o=>(s.raiseOnCommittedEvent(),o)))}Ai(e,n){return De.or(Object.values(this.ui).map((r=>()=>r.containsKey(e,n))))}}class kN extends aM{constructor(e){super(),this.currentSequenceNumber=e}}class _0{constructor(e){this.persistence=e,this.Ri=new y0,this.Vi=null}static mi(e){return new _0(e)}get fi(){if(this.Vi)return this.Vi;throw Xe(60996)}addReference(e,n,r){return this.Ri.addReference(r,n),this.fi.delete(r.toString()),De.resolve()}removeReference(e,n,r){return this.Ri.removeReference(r,n),this.fi.add(r.toString()),De.resolve()}markPotentiallyOrphaned(e,n){return this.fi.add(n.toString()),De.resolve()}removeTarget(e,n){this.Ri.jr(n.targetId).forEach((s=>this.fi.add(s.toString())));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,n.targetId).next((s=>{s.forEach((o=>this.fi.add(o.toString())))})).next((()=>r.removeTargetData(e,n)))}Ei(){this.Vi=new Set}di(e){const n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return De.forEach(this.fi,(r=>{const s=We.fromPath(r);return this.gi(e,s).next((o=>{o||n.removeEntry(s,et.min())}))})).next((()=>(this.Vi=null,n.apply(e))))}updateLimboDocument(e,n){return this.gi(e,n).next((r=>{r?this.fi.delete(n.toString()):this.fi.add(n.toString())}))}Ti(e){return 0}gi(e,n){return De.or([()=>De.resolve(this.Ri.containsKey(n)),()=>this.persistence.getTargetCache().containsKey(e,n),()=>this.persistence.Ai(e,n)])}}class Rf{constructor(e,n){this.persistence=e,this.pi=new jo((r=>cM(r.path)),((r,s)=>r.isEqual(s))),this.garbageCollector=xN(this,n)}static mi(e,n){return new Rf(e,n)}Ei(){}di(e){return De.resolve()}forEachTarget(e,n){return this.persistence.getTargetCache().forEachTarget(e,n)}gr(e){const n=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next((r=>n.next((s=>r+s))))}wr(e){let n=0;return this.pr(e,(r=>{n++})).next((()=>n))}pr(e,n){return De.forEach(this.pi,((r,s)=>this.br(e,r,s).next((o=>o?De.resolve():n(s)))))}removeTargets(e,n,r){return this.persistence.getTargetCache().removeTargets(e,n,r)}removeOrphanedDocuments(e,n){let r=0;const s=this.persistence.getRemoteDocumentCache(),o=s.newChangeBuffer();return s.ii(e,(l=>this.br(e,l,n).next((d=>{d||(r++,o.removeEntry(l,et.min()))})))).next((()=>o.apply(e))).next((()=>r))}markPotentiallyOrphaned(e,n){return this.pi.set(n,e.currentSequenceNumber),De.resolve()}removeTarget(e,n){const r=n.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,n,r){return this.pi.set(r,e.currentSequenceNumber),De.resolve()}removeReference(e,n,r){return this.pi.set(r,e.currentSequenceNumber),De.resolve()}updateLimboDocument(e,n){return this.pi.set(n,e.currentSequenceNumber),De.resolve()}Ti(e){let n=e.key.toString().length;return e.isFoundDocument()&&(n+=rf(e.data.value)),n}br(e,n,r){return De.or([()=>this.persistence.Ai(e,n),()=>this.persistence.getTargetCache().containsKey(e,n),()=>{const s=this.pi.get(n);return De.resolve(s!==void 0&&s>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class b0{constructor(e,n,r,s){this.targetId=e,this.fromCache=n,this.Es=r,this.ds=s}static As(e,n){let r=pt(),s=pt();for(const o of n.docChanges)switch(o.type){case 0:r=r.add(o.doc.key);break;case 1:s=s.add(o.doc.key)}return new b0(e,n.fromCache,r,s)}}class ON{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class MN{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(function(){return uR()?8:oM(Yn())>0?6:4})()}initialize(e,n){this.ps=e,this.indexManager=n,this.Rs=!0}getDocumentsMatchingQuery(e,n,r,s){const o={result:null};return this.ys(e,n).next((l=>{o.result=l})).next((()=>{if(!o.result)return this.ws(e,n,s,r).next((l=>{o.result=l}))})).next((()=>{if(o.result)return;const l=new ON;return this.Ss(e,n,l).next((d=>{if(o.result=d,this.Vs)return this.bs(e,n,l,d.size)}))})).next((()=>o.result))}bs(e,n,r,s){return r.documentReadCount<this.fs?(Al()<=ft.DEBUG&&Le("QueryEngine","SDK will not create cache indexes for query:",jl(n),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),De.resolve()):(Al()<=ft.DEBUG&&Le("QueryEngine","Query:",jl(n),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.gs*s?(Al()<=ft.DEBUG&&Le("QueryEngine","The SDK decides to create cache indexes for query:",jl(n),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Li(n))):De.resolve())}ys(e,n){if(Gw(n))return De.resolve(null);let r=Li(n);return this.indexManager.getIndexType(e,r).next((s=>s===0?null:(n.limit!==null&&s===1&&(n=xy(n,null,"F"),r=Li(n)),this.indexManager.getDocumentsMatchingTarget(e,r).next((o=>{const l=pt(...o);return this.ps.getDocuments(e,l).next((d=>this.indexManager.getMinOffset(e,r).next((h=>{const m=this.Ds(n,d);return this.Cs(n,m,l,h.readTime)?this.ys(e,xy(n,null,"F")):this.vs(e,m,n,h)}))))})))))}ws(e,n,r,s){return Gw(n)||s.isEqual(et.min())?De.resolve(null):this.ps.getDocuments(e,r).next((o=>{const l=this.Ds(n,o);return this.Cs(n,l,r,s)?De.resolve(null):(Al()<=ft.DEBUG&&Le("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),jl(n)),this.vs(e,l,n,nM(s,Pu)).next((d=>d)))}))}Ds(e,n){let r=new Tn(lC(e));return n.forEach(((s,o)=>{tm(e,o)&&(r=r.add(o))})),r}Cs(e,n,r,s){if(e.limit===null)return!1;if(r.size!==n.size)return!0;const o=e.limitType==="F"?n.last():n.first();return!!o&&(o.hasPendingWrites||o.version.compareTo(s)>0)}Ss(e,n,r){return Al()<=ft.DEBUG&&Le("QueryEngine","Using full collection scan to execute query:",jl(n)),this.ps.getDocumentsMatchingQuery(e,n,wa.min(),r)}vs(e,n,r,s){return this.ps.getDocumentsMatchingQuery(e,r,s).next((o=>(n.forEach((l=>{o=o.insert(l.key,l)})),o)))}}const v0="LocalStore",NN=3e8;class PN{constructor(e,n,r,s){this.persistence=e,this.Fs=n,this.serializer=s,this.Ms=new Xt(mt),this.xs=new jo((o=>u0(o)),d0),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(r)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new EN(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(n=>e.collect(n,this.Ms)))}}function zN(t,e,n,r){return new PN(t,e,n,r)}async function kC(t,e){const n=nt(t);return await n.persistence.runTransaction("Handle user change","readonly",(r=>{let s;return n.mutationQueue.getAllMutationBatches(r).next((o=>(s=o,n.Bs(e),n.mutationQueue.getAllMutationBatches(r)))).next((o=>{const l=[],d=[];let h=pt();for(const m of s){l.push(m.batchId);for(const p of m.mutations)h=h.add(p.key)}for(const m of o){d.push(m.batchId);for(const p of m.mutations)h=h.add(p.key)}return n.localDocuments.getDocuments(r,h).next((m=>({Ls:m,removedBatchIds:l,addedBatchIds:d})))}))}))}function BN(t,e){const n=nt(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(r=>{const s=e.batch.keys(),o=n.Ns.newChangeBuffer({trackRemovals:!0});return(function(d,h,m,p){const g=m.batch,v=g.keys();let _=De.resolve();return v.forEach((S=>{_=_.next((()=>p.getEntry(h,S))).next((x=>{const E=m.docVersions.get(S);Tt(E!==null,48541),x.version.compareTo(E)<0&&(g.applyToRemoteDocument(x,m),x.isValidDocument()&&(x.setReadTime(m.commitVersion),p.addEntry(x)))}))})),_.next((()=>d.mutationQueue.removeMutationBatch(h,g)))})(n,r,e,o).next((()=>o.apply(r))).next((()=>n.mutationQueue.performConsistencyCheck(r))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,(function(d){let h=pt();for(let m=0;m<d.mutationResults.length;++m)d.mutationResults[m].transformResults.length>0&&(h=h.add(d.batch.mutations[m].key));return h})(e)))).next((()=>n.localDocuments.getDocuments(r,s)))}))}function OC(t){const e=nt(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(n=>e.Pi.getLastRemoteSnapshotVersion(n)))}function LN(t,e){const n=nt(t),r=e.snapshotVersion;let s=n.Ms;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(o=>{const l=n.Ns.newChangeBuffer({trackRemovals:!0});s=n.Ms;const d=[];e.targetChanges.forEach(((p,g)=>{const v=s.get(g);if(!v)return;d.push(n.Pi.removeMatchingKeys(o,p.removedDocuments,g).next((()=>n.Pi.addMatchingKeys(o,p.addedDocuments,g))));let _=v.withSequenceNumber(o.currentSequenceNumber);e.targetMismatches.get(g)!==null?_=_.withResumeToken(Fn.EMPTY_BYTE_STRING,et.min()).withLastLimboFreeSnapshotVersion(et.min()):p.resumeToken.approximateByteSize()>0&&(_=_.withResumeToken(p.resumeToken,r)),s=s.insert(g,_),(function(x,E,C){return x.resumeToken.approximateByteSize()===0||E.snapshotVersion.toMicroseconds()-x.snapshotVersion.toMicroseconds()>=NN?!0:C.addedDocuments.size+C.modifiedDocuments.size+C.removedDocuments.size>0})(v,_,p)&&d.push(n.Pi.updateTargetData(o,_))}));let h=Ss(),m=pt();if(e.documentUpdates.forEach((p=>{e.resolvedLimboDocuments.has(p)&&d.push(n.persistence.referenceDelegate.updateLimboDocument(o,p))})),d.push(UN(o,l,e.documentUpdates).next((p=>{h=p.ks,m=p.qs}))),!r.isEqual(et.min())){const p=n.Pi.getLastRemoteSnapshotVersion(o).next((g=>n.Pi.setTargetsMetadata(o,o.currentSequenceNumber,r)));d.push(p)}return De.waitFor(d).next((()=>l.apply(o))).next((()=>n.localDocuments.getLocalViewOfDocuments(o,h,m))).next((()=>h))})).then((o=>(n.Ms=s,o)))}function UN(t,e,n){let r=pt(),s=pt();return n.forEach((o=>r=r.add(o))),e.getEntries(t,r).next((o=>{let l=Ss();return n.forEach(((d,h)=>{const m=o.get(d);h.isFoundDocument()!==m.isFoundDocument()&&(s=s.add(d)),h.isNoDocument()&&h.version.isEqual(et.min())?(e.removeEntry(d,h.readTime),l=l.insert(d,h)):!m.isValidDocument()||h.version.compareTo(m.version)>0||h.version.compareTo(m.version)===0&&m.hasPendingWrites?(e.addEntry(h),l=l.insert(d,h)):Le(v0,"Ignoring outdated watch update for ",d,". Current version:",m.version," Watch version:",h.version)})),{ks:l,qs:s}}))}function FN(t,e){const n=nt(t);return n.persistence.runTransaction("Get next mutation batch","readonly",(r=>(e===void 0&&(e=o0),n.mutationQueue.getNextMutationBatchAfterBatchId(r,e))))}function VN(t,e){const n=nt(t);return n.persistence.runTransaction("Allocate target","readwrite",(r=>{let s;return n.Pi.getTargetData(r,e).next((o=>o?(s=o,De.resolve(s)):n.Pi.allocateTargetId(r).next((l=>(s=new fa(e,l,"TargetPurposeListen",r.currentSequenceNumber),n.Pi.addTargetData(r,s).next((()=>s)))))))})).then((r=>{const s=n.Ms.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(n.Ms=n.Ms.insert(r.targetId,r),n.xs.set(e,r.targetId)),r}))}async function Ty(t,e,n){const r=nt(t),s=r.Ms.get(e),o=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",o,(l=>r.persistence.referenceDelegate.removeTarget(l,s)))}catch(l){if(!cc(l))throw l;Le(v0,`Failed to update sequence numbers for target ${e}: ${l}`)}r.Ms=r.Ms.remove(e),r.xs.delete(s.target)}function sS(t,e,n){const r=nt(t);let s=et.min(),o=pt();return r.persistence.runTransaction("Execute query","readwrite",(l=>(function(h,m,p){const g=nt(h),v=g.xs.get(p);return v!==void 0?De.resolve(g.Ms.get(v)):g.Pi.getTargetData(m,p)})(r,l,Li(e)).next((d=>{if(d)return s=d.lastLimboFreeSnapshotVersion,r.Pi.getMatchingKeysForTargetId(l,d.targetId).next((h=>{o=h}))})).next((()=>r.Fs.getDocumentsMatchingQuery(l,e,n?s:et.min(),n?o:pt()))).next((d=>($N(r,jM(e),d),{documents:d,Qs:o})))))}function $N(t,e,n){let r=t.Os.get(e)||et.min();n.forEach(((s,o)=>{o.readTime.compareTo(r)>0&&(r=o.readTime)})),t.Os.set(e,r)}class aS{constructor(){this.activeTargetIds=MM()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class HN{constructor(){this.Mo=new aS,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,n,r){}addLocalQueryTarget(e,n=!0){return n&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,n,r){this.xo[e]=n}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new aS,Promise.resolve()}handleUserChange(e,n,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class qN{Oo(e){}shutdown(){}}const oS="ConnectivityMonitor";class lS{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){Le(oS,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){Le(oS,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}let Wh=null;function Ay(){return Wh===null?Wh=(function(){return 268435456+Math.round(2147483648*Math.random())})():Wh++,"0x"+Wh.toString(16)}const Bg="RestConnection",GN={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class WN{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const n=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Uo=n+"://"+e.host,this.Ko=`projects/${r}/databases/${s}`,this.Wo=this.databaseId.database===wf?`project_id=${r}`:`project_id=${r}&database_id=${s}`}Go(e,n,r,s,o){const l=Ay(),d=this.zo(e,n.toUriEncodedString());Le(Bg,`Sending RPC '${e}' ${l}:`,d,r);const h={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(h,s,o);const{host:m}=new URL(d),p=tc(m);return this.Jo(e,d,h,r,p).then((g=>(Le(Bg,`Received RPC '${e}' ${l}: `,g),g)),(g=>{throw Ul(Bg,`RPC '${e}' ${l} failed with error: `,g,"url: ",d,"request:",r),g}))}Ho(e,n,r,s,o,l){return this.Go(e,n,r,s,o)}jo(e,n,r){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+oc})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach(((s,o)=>e[o]=s)),r&&r.headers.forEach(((s,o)=>e[o]=s))}zo(e,n){const r=GN[e];return`${this.Uo}/v1/${n}:${r}`}terminate(){}}class QN{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}const Wn="WebChannelConnection";class KN extends WN{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,n,r,s,o){const l=Ay();return new Promise(((d,h)=>{const m=new NE;m.setWithCredentials(!0),m.listenOnce(PE.COMPLETE,(()=>{try{switch(m.getLastErrorCode()){case nf.NO_ERROR:const g=m.getResponseJson();Le(Wn,`XHR for RPC '${e}' ${l} received:`,JSON.stringify(g)),d(g);break;case nf.TIMEOUT:Le(Wn,`RPC '${e}' ${l} timed out`),h(new Be(je.DEADLINE_EXCEEDED,"Request time out"));break;case nf.HTTP_ERROR:const v=m.getStatus();if(Le(Wn,`RPC '${e}' ${l} failed with status:`,v,"response text:",m.getResponseText()),v>0){let _=m.getResponseJson();Array.isArray(_)&&(_=_[0]);const S=_?.error;if(S&&S.status&&S.message){const x=(function(C){const T=C.toLowerCase().replace(/_/g,"-");return Object.values(je).indexOf(T)>=0?T:je.UNKNOWN})(S.status);h(new Be(x,S.message))}else h(new Be(je.UNKNOWN,"Server responded with status "+m.getStatus()))}else h(new Be(je.UNAVAILABLE,"Connection failed."));break;default:Xe(9055,{l_:e,streamId:l,h_:m.getLastErrorCode(),P_:m.getLastError()})}}finally{Le(Wn,`RPC '${e}' ${l} completed.`)}}));const p=JSON.stringify(s);Le(Wn,`RPC '${e}' ${l} sending request:`,s),m.send(n,"POST",p,r,15)}))}T_(e,n,r){const s=Ay(),o=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],l=LE(),d=BE(),h={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},m=this.longPollingOptions.timeoutSeconds;m!==void 0&&(h.longPollingTimeout=Math.round(1e3*m)),this.useFetchStreams&&(h.useFetchStreams=!0),this.jo(h.initMessageHeaders,n,r),h.encodeInitMessageHeaders=!0;const p=o.join("");Le(Wn,`Creating RPC '${e}' stream ${s}: ${p}`,h);const g=l.createWebChannel(p,h);this.I_(g);let v=!1,_=!1;const S=new QN({Yo:E=>{_?Le(Wn,`Not sending because RPC '${e}' stream ${s} is closed:`,E):(v||(Le(Wn,`Opening RPC '${e}' stream ${s} transport.`),g.open(),v=!0),Le(Wn,`RPC '${e}' stream ${s} sending:`,E),g.send(E))},Zo:()=>g.close()}),x=(E,C,T)=>{E.listen(C,(A=>{try{T(A)}catch(B){setTimeout((()=>{throw B}),0)}}))};return x(g,xu.EventType.OPEN,(()=>{_||(Le(Wn,`RPC '${e}' stream ${s} transport opened.`),S.o_())})),x(g,xu.EventType.CLOSE,(()=>{_||(_=!0,Le(Wn,`RPC '${e}' stream ${s} transport closed`),S.a_(),this.E_(g))})),x(g,xu.EventType.ERROR,(E=>{_||(_=!0,Ul(Wn,`RPC '${e}' stream ${s} transport errored. Name:`,E.name,"Message:",E.message),S.a_(new Be(je.UNAVAILABLE,"The operation could not be completed")))})),x(g,xu.EventType.MESSAGE,(E=>{if(!_){const C=E.data[0];Tt(!!C,16349);const T=C,A=T?.error||T[0]?.error;if(A){Le(Wn,`RPC '${e}' stream ${s} received error:`,A);const B=A.status;let U=(function(D){const N=gn[D];if(N!==void 0)return vC(N)})(B),G=A.message;U===void 0&&(U=je.INTERNAL,G="Unknown error status: "+B+" with message "+A.message),_=!0,S.a_(new Be(U,G)),g.close()}else Le(Wn,`RPC '${e}' stream ${s} received:`,C),S.u_(C)}})),x(d,zE.STAT_EVENT,(E=>{E.stat===my.PROXY?Le(Wn,`RPC '${e}' stream ${s} detected buffering proxy`):E.stat===my.NOPROXY&&Le(Wn,`RPC '${e}' stream ${s} detected no buffering proxy`)})),setTimeout((()=>{S.__()}),0),S}terminate(){this.c_.forEach((e=>e.close())),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter((n=>n===e))}}function Lg(){return typeof document<"u"?document:null}function am(t){return new JM(t,!0)}class MC{constructor(e,n,r=1e3,s=1.5,o=6e4){this.Mi=e,this.timerId=n,this.d_=r,this.A_=s,this.R_=o,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const n=Math.floor(this.V_+this.y_()),r=Math.max(0,Date.now()-this.f_),s=Math.max(0,n-r);s>0&&Le("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.V_} ms, delay with jitter: ${n} ms, last attempt: ${r} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,s,(()=>(this.f_=Date.now(),e()))),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}const cS="PersistentStream";class NC{constructor(e,n,r,s,o,l,d,h){this.Mi=e,this.S_=r,this.b_=s,this.connection=o,this.authCredentialsProvider=l,this.appCheckCredentialsProvider=d,this.listener=h,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new MC(e,n)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,(()=>this.k_())))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,n){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():n&&n.code===je.RESOURCE_EXHAUSTED?(ws(n.toString()),ws("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):n&&n.code===je.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(n)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),n=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([r,s])=>{this.D_===n&&this.G_(r,s)}),(r=>{e((()=>{const s=new Be(je.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(s)}))}))}G_(e,n){const r=this.W_(this.D_);this.stream=this.j_(e,n),this.stream.Xo((()=>{r((()=>this.listener.Xo()))})),this.stream.t_((()=>{r((()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.t_())))})),this.stream.r_((s=>{r((()=>this.z_(s)))})),this.stream.onMessage((s=>{r((()=>++this.F_==1?this.J_(s):this.onNext(s)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(e){return Le(cS,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return n=>{this.Mi.enqueueAndForget((()=>this.D_===e?n():(Le(cS,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class YN extends NC{constructor(e,n,r,s,o,l){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",n,r,s,l),this.serializer=o}j_(e,n){return this.connection.T_("Listen",e,n)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const n=nN(this.serializer,e),r=(function(o){if(!("targetChange"in o))return et.min();const l=o.targetChange;return l.targetIds&&l.targetIds.length?et.min():l.readTime?Ui(l.readTime):et.min()})(e);return this.listener.H_(n,r)}Y_(e){const n={};n.database=Cy(this.serializer),n.addTarget=(function(o,l){let d;const h=l.target;if(d=by(h)?{documents:sN(o,h)}:{query:aN(o,h).ft},d.targetId=l.targetId,l.resumeToken.approximateByteSize()>0){d.resumeToken=SC(o,l.resumeToken);const m=wy(o,l.expectedCount);m!==null&&(d.expectedCount=m)}else if(l.snapshotVersion.compareTo(et.min())>0){d.readTime=jf(o,l.snapshotVersion.toTimestamp());const m=wy(o,l.expectedCount);m!==null&&(d.expectedCount=m)}return d})(this.serializer,e);const r=lN(this.serializer,e);r&&(n.labels=r),this.q_(n)}Z_(e){const n={};n.database=Cy(this.serializer),n.removeTarget=e,this.q_(n)}}class XN extends NC{constructor(e,n,r,s,o,l){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",n,r,s,l),this.serializer=o}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,n){return this.connection.T_("Write",e,n)}J_(e){return Tt(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,Tt(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){Tt(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const n=iN(e.writeResults,e.commitTime),r=Ui(e.commitTime);return this.listener.na(r,n)}ra(){const e={};e.database=Cy(this.serializer),this.q_(e)}ea(e){const n={streamToken:this.lastStreamToken,writes:e.map((r=>rN(this.serializer,r)))};this.q_(n)}}class ZN{}class JN extends ZN{constructor(e,n,r,s){super(),this.authCredentials=e,this.appCheckCredentials=n,this.connection=r,this.serializer=s,this.ia=!1}sa(){if(this.ia)throw new Be(je.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,n,r,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([o,l])=>this.connection.Go(e,Sy(n,r),s,o,l))).catch((o=>{throw o.name==="FirebaseError"?(o.code===je.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new Be(je.UNKNOWN,o.toString())}))}Ho(e,n,r,s,o){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([l,d])=>this.connection.Ho(e,Sy(n,r),s,l,d,o))).catch((l=>{throw l.name==="FirebaseError"?(l.code===je.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),l):new Be(je.UNKNOWN,l.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}class e4{constructor(e,n){this.asyncQueue=e,this.onlineStateHandler=n,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const n=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(ws(n),this.aa=!1):Le("OnlineStateTracker",n)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}const Eo="RemoteStore";class t4{constructor(e,n,r,s,o){this.localStore=e,this.datastore=n,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=o,this.Aa.Oo((l=>{r.enqueueAndForget((async()=>{Ro(this)&&(Le(Eo,"Restarting streams for network reachability change."),await(async function(h){const m=nt(h);m.Ea.add(4),await ad(m),m.Ra.set("Unknown"),m.Ea.delete(4),await om(m)})(this))}))})),this.Ra=new e4(r,s)}}async function om(t){if(Ro(t))for(const e of t.da)await e(!0)}async function ad(t){for(const e of t.da)await e(!1)}function PC(t,e){const n=nt(t);n.Ia.has(e.targetId)||(n.Ia.set(e.targetId,e),E0(n)?S0(n):uc(n).O_()&&w0(n,e))}function x0(t,e){const n=nt(t),r=uc(n);n.Ia.delete(e),r.O_()&&zC(n,e),n.Ia.size===0&&(r.O_()?r.L_():Ro(n)&&n.Ra.set("Unknown"))}function w0(t,e){if(t.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(et.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}uc(t).Y_(e)}function zC(t,e){t.Va.Ue(e),uc(t).Z_(e)}function S0(t){t.Va=new KM({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),At:e=>t.Ia.get(e)||null,ht:()=>t.datastore.serializer.databaseId}),uc(t).start(),t.Ra.ua()}function E0(t){return Ro(t)&&!uc(t).x_()&&t.Ia.size>0}function Ro(t){return nt(t).Ea.size===0}function BC(t){t.Va=void 0}async function n4(t){t.Ra.set("Online")}async function r4(t){t.Ia.forEach(((e,n)=>{w0(t,e)}))}async function i4(t,e){BC(t),E0(t)?(t.Ra.ha(e),S0(t)):t.Ra.set("Unknown")}async function s4(t,e,n){if(t.Ra.set("Online"),e instanceof wC&&e.state===2&&e.cause)try{await(async function(s,o){const l=o.cause;for(const d of o.targetIds)s.Ia.has(d)&&(await s.remoteSyncer.rejectListen(d,l),s.Ia.delete(d),s.Va.removeTarget(d))})(t,e)}catch(r){Le(Eo,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await If(t,r)}else if(e instanceof of?t.Va.Ze(e):e instanceof xC?t.Va.st(e):t.Va.tt(e),!n.isEqual(et.min()))try{const r=await OC(t.localStore);n.compareTo(r)>=0&&await(function(o,l){const d=o.Va.Tt(l);return d.targetChanges.forEach(((h,m)=>{if(h.resumeToken.approximateByteSize()>0){const p=o.Ia.get(m);p&&o.Ia.set(m,p.withResumeToken(h.resumeToken,l))}})),d.targetMismatches.forEach(((h,m)=>{const p=o.Ia.get(h);if(!p)return;o.Ia.set(h,p.withResumeToken(Fn.EMPTY_BYTE_STRING,p.snapshotVersion)),zC(o,h);const g=new fa(p.target,h,m,p.sequenceNumber);w0(o,g)})),o.remoteSyncer.applyRemoteEvent(d)})(t,n)}catch(r){Le(Eo,"Failed to raise snapshot:",r),await If(t,r)}}async function If(t,e,n){if(!cc(e))throw e;t.Ea.add(1),await ad(t),t.Ra.set("Offline"),n||(n=()=>OC(t.localStore)),t.asyncQueue.enqueueRetryable((async()=>{Le(Eo,"Retrying IndexedDB access"),await n(),t.Ea.delete(1),await om(t)}))}function LC(t,e){return e().catch((n=>If(t,n,e)))}async function lm(t){const e=nt(t),n=Ta(e);let r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:o0;for(;a4(e);)try{const s=await FN(e.localStore,r);if(s===null){e.Ta.length===0&&n.L_();break}r=s.batchId,o4(e,s)}catch(s){await If(e,s)}UC(e)&&FC(e)}function a4(t){return Ro(t)&&t.Ta.length<10}function o4(t,e){t.Ta.push(e);const n=Ta(t);n.O_()&&n.X_&&n.ea(e.mutations)}function UC(t){return Ro(t)&&!Ta(t).x_()&&t.Ta.length>0}function FC(t){Ta(t).start()}async function l4(t){Ta(t).ra()}async function c4(t){const e=Ta(t);for(const n of t.Ta)e.ea(n.mutations)}async function u4(t,e,n){const r=t.Ta.shift(),s=m0.from(r,e,n);await LC(t,(()=>t.remoteSyncer.applySuccessfulWrite(s))),await lm(t)}async function d4(t,e){e&&Ta(t).X_&&await(async function(r,s){if((function(l){return GM(l)&&l!==je.ABORTED})(s.code)){const o=r.Ta.shift();Ta(r).B_(),await LC(r,(()=>r.remoteSyncer.rejectFailedWrite(o.batchId,s))),await lm(r)}})(t,e),UC(t)&&FC(t)}async function uS(t,e){const n=nt(t);n.asyncQueue.verifyOperationInProgress(),Le(Eo,"RemoteStore received new credentials");const r=Ro(n);n.Ea.add(3),await ad(n),r&&n.Ra.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.Ea.delete(3),await om(n)}async function h4(t,e){const n=nt(t);e?(n.Ea.delete(2),await om(n)):e||(n.Ea.add(2),await ad(n),n.Ra.set("Unknown"))}function uc(t){return t.ma||(t.ma=(function(n,r,s){const o=nt(n);return o.sa(),new YN(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,s)})(t.datastore,t.asyncQueue,{Xo:n4.bind(null,t),t_:r4.bind(null,t),r_:i4.bind(null,t),H_:s4.bind(null,t)}),t.da.push((async e=>{e?(t.ma.B_(),E0(t)?S0(t):t.Ra.set("Unknown")):(await t.ma.stop(),BC(t))}))),t.ma}function Ta(t){return t.fa||(t.fa=(function(n,r,s){const o=nt(n);return o.sa(),new XN(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,s)})(t.datastore,t.asyncQueue,{Xo:()=>Promise.resolve(),t_:l4.bind(null,t),r_:d4.bind(null,t),ta:c4.bind(null,t),na:u4.bind(null,t)}),t.da.push((async e=>{e?(t.fa.B_(),await lm(t)):(await t.fa.stop(),t.Ta.length>0&&(Le(Eo,`Stopping write stream with ${t.Ta.length} pending writes`),t.Ta=[]))}))),t.fa}class C0{constructor(e,n,r,s,o){this.asyncQueue=e,this.timerId=n,this.targetTimeMs=r,this.op=s,this.removalCallback=o,this.deferred=new ys,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((l=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,n,r,s,o){const l=Date.now()+r,d=new C0(e,n,l,s,o);return d.start(r),d}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Be(je.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function T0(t,e){if(ws("AsyncQueue",`${e}: ${t}`),cc(t))return new Be(je.UNAVAILABLE,`${e}: ${t}`);throw t}class Nl{static emptySet(e){return new Nl(e.comparator)}constructor(e){this.comparator=e?(n,r)=>e(n,r)||We.comparator(n.key,r.key):(n,r)=>We.comparator(n.key,r.key),this.keyedMap=wu(),this.sortedSet=new Xt(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const n=this.keyedMap.get(e);return n?this.sortedSet.indexOf(n):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((n,r)=>(e(n),!1)))}add(e){const n=this.delete(e.key);return n.copy(n.keyedMap.insert(e.key,e),n.sortedSet.insert(e,null))}delete(e){const n=this.get(e);return n?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(n)):this}isEqual(e){if(!(e instanceof Nl)||this.size!==e.size)return!1;const n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;n.hasNext();){const s=n.getNext().key,o=r.getNext().key;if(!s.isEqual(o))return!1}return!0}toString(){const e=[];return this.forEach((n=>{e.push(n.toString())})),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,n){const r=new Nl;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r}}class dS{constructor(){this.ga=new Xt(We.comparator)}track(e){const n=e.doc.key,r=this.ga.get(n);r?e.type!==0&&r.type===3?this.ga=this.ga.insert(n,e):e.type===3&&r.type!==1?this.ga=this.ga.insert(n,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.ga=this.ga.insert(n,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.ga=this.ga.insert(n,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.ga=this.ga.remove(n):e.type===1&&r.type===2?this.ga=this.ga.insert(n,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.ga=this.ga.insert(n,{type:2,doc:e.doc}):Xe(63341,{Rt:e,pa:r}):this.ga=this.ga.insert(n,e)}ya(){const e=[];return this.ga.inorderTraversal(((n,r)=>{e.push(r)})),e}}class Wl{constructor(e,n,r,s,o,l,d,h,m){this.query=e,this.docs=n,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=o,this.fromCache=l,this.syncStateChanged=d,this.excludesMetadataChanges=h,this.hasCachedResults=m}static fromInitialDocuments(e,n,r,s,o){const l=[];return n.forEach((d=>{l.push({type:0,doc:d})})),new Wl(e,n,Nl.emptySet(n),l,r,s,!0,!1,o)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&em(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const n=this.docChanges,r=e.docChanges;if(n.length!==r.length)return!1;for(let s=0;s<n.length;s++)if(n[s].type!==r[s].type||!n[s].doc.isEqual(r[s].doc))return!1;return!0}}class f4{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some((e=>e.Da()))}}class m4{constructor(){this.queries=hS(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(n,r){const s=nt(n),o=s.queries;s.queries=hS(),o.forEach(((l,d)=>{for(const h of d.Sa)h.onError(r)}))})(this,new Be(je.ABORTED,"Firestore shutting down"))}}function hS(){return new jo((t=>oC(t)),em)}async function VC(t,e){const n=nt(t);let r=3;const s=e.query;let o=n.queries.get(s);o?!o.ba()&&e.Da()&&(r=2):(o=new f4,r=e.Da()?0:1);try{switch(r){case 0:o.wa=await n.onListen(s,!0);break;case 1:o.wa=await n.onListen(s,!1);break;case 2:await n.onFirstRemoteStoreListen(s)}}catch(l){const d=T0(l,`Initialization of query '${jl(e.query)}' failed`);return void e.onError(d)}n.queries.set(s,o),o.Sa.push(e),e.va(n.onlineState),o.wa&&e.Fa(o.wa)&&A0(n)}async function $C(t,e){const n=nt(t),r=e.query;let s=3;const o=n.queries.get(r);if(o){const l=o.Sa.indexOf(e);l>=0&&(o.Sa.splice(l,1),o.Sa.length===0?s=e.Da()?0:1:!o.ba()&&e.Da()&&(s=2))}switch(s){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}}function p4(t,e){const n=nt(t);let r=!1;for(const s of e){const o=s.query,l=n.queries.get(o);if(l){for(const d of l.Sa)d.Fa(s)&&(r=!0);l.wa=s}}r&&A0(n)}function g4(t,e,n){const r=nt(t),s=r.queries.get(e);if(s)for(const o of s.Sa)o.onError(n);r.queries.delete(e)}function A0(t){t.Ca.forEach((e=>{e.next()}))}var jy,fS;(fS=jy||(jy={})).Ma="default",fS.Cache="cache";class HC{constructor(e,n,r){this.query=e,this.xa=n,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new Wl(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let n=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),n=!0):this.La(e,this.onlineState)&&(this.ka(e),n=!0),this.Na=e,n}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let n=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),n=!0),n}La(e,n){if(!e.fromCache||!this.Da())return!0;const r=n!=="Offline";return(!this.options.qa||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||n==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const n=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!n)&&this.options.includeMetadataChanges===!0}ka(e){e=Wl.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==jy.Cache}}class qC{constructor(e){this.key=e}}class GC{constructor(e){this.key=e}}class y4{constructor(e,n){this.query=e,this.Ya=n,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=pt(),this.mutatedKeys=pt(),this.eu=lC(e),this.tu=new Nl(this.eu)}get nu(){return this.Ya}ru(e,n){const r=n?n.iu:new dS,s=n?n.tu:this.tu;let o=n?n.mutatedKeys:this.mutatedKeys,l=s,d=!1;const h=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,m=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal(((p,g)=>{const v=s.get(p),_=tm(this.query,g)?g:null,S=!!v&&this.mutatedKeys.has(v.key),x=!!_&&(_.hasLocalMutations||this.mutatedKeys.has(_.key)&&_.hasCommittedMutations);let E=!1;v&&_?v.data.isEqual(_.data)?S!==x&&(r.track({type:3,doc:_}),E=!0):this.su(v,_)||(r.track({type:2,doc:_}),E=!0,(h&&this.eu(_,h)>0||m&&this.eu(_,m)<0)&&(d=!0)):!v&&_?(r.track({type:0,doc:_}),E=!0):v&&!_&&(r.track({type:1,doc:v}),E=!0,(h||m)&&(d=!0)),E&&(_?(l=l.add(_),o=x?o.add(p):o.delete(p)):(l=l.delete(p),o=o.delete(p)))})),this.query.limit!==null)for(;l.size>this.query.limit;){const p=this.query.limitType==="F"?l.last():l.first();l=l.delete(p.key),o=o.delete(p.key),r.track({type:1,doc:p})}return{tu:l,iu:r,Cs:d,mutatedKeys:o}}su(e,n){return e.hasLocalMutations&&n.hasCommittedMutations&&!n.hasLocalMutations}applyChanges(e,n,r,s){const o=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const l=e.iu.ya();l.sort(((p,g)=>(function(_,S){const x=E=>{switch(E){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Xe(20277,{Rt:E})}};return x(_)-x(S)})(p.type,g.type)||this.eu(p.doc,g.doc))),this.ou(r),s=s??!1;const d=n&&!s?this._u():[],h=this.Xa.size===0&&this.current&&!s?1:0,m=h!==this.Za;return this.Za=h,l.length!==0||m?{snapshot:new Wl(this.query,e.tu,o,l,e.mutatedKeys,h===0,m,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:d}:{au:d}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new dS,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach((n=>this.Ya=this.Ya.add(n))),e.modifiedDocuments.forEach((n=>{})),e.removedDocuments.forEach((n=>this.Ya=this.Ya.delete(n))),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=pt(),this.tu.forEach((r=>{this.uu(r.key)&&(this.Xa=this.Xa.add(r.key))}));const n=[];return e.forEach((r=>{this.Xa.has(r)||n.push(new GC(r))})),this.Xa.forEach((r=>{e.has(r)||n.push(new qC(r))})),n}cu(e){this.Ya=e.Qs,this.Xa=pt();const n=this.ru(e.documents);return this.applyChanges(n,!0)}lu(){return Wl.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const j0="SyncEngine";class _4{constructor(e,n,r){this.query=e,this.targetId=n,this.view=r}}class b4{constructor(e){this.key=e,this.hu=!1}}class v4{constructor(e,n,r,s,o,l){this.localStore=e,this.remoteStore=n,this.eventManager=r,this.sharedClientState=s,this.currentUser=o,this.maxConcurrentLimboResolutions=l,this.Pu={},this.Tu=new jo((d=>oC(d)),em),this.Iu=new Map,this.Eu=new Set,this.du=new Xt(We.comparator),this.Au=new Map,this.Ru=new y0,this.Vu={},this.mu=new Map,this.fu=Gl.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function x4(t,e,n=!0){const r=ZC(t);let s;const o=r.Tu.get(e);return o?(r.sharedClientState.addLocalQueryTarget(o.targetId),s=o.view.lu()):s=await WC(r,e,n,!0),s}async function w4(t,e){const n=ZC(t);await WC(n,e,!0,!1)}async function WC(t,e,n,r){const s=await VN(t.localStore,Li(e)),o=s.targetId,l=t.sharedClientState.addLocalQueryTarget(o,n);let d;return r&&(d=await S4(t,e,o,l==="current",s.resumeToken)),t.isPrimaryClient&&n&&PC(t.remoteStore,s),d}async function S4(t,e,n,r,s){t.pu=(g,v,_)=>(async function(x,E,C,T){let A=E.view.ru(C);A.Cs&&(A=await sS(x.localStore,E.query,!1).then((({documents:k})=>E.view.ru(k,A))));const B=T&&T.targetChanges.get(E.targetId),U=T&&T.targetMismatches.get(E.targetId)!=null,G=E.view.applyChanges(A,x.isPrimaryClient,B,U);return pS(x,E.targetId,G.au),G.snapshot})(t,g,v,_);const o=await sS(t.localStore,e,!0),l=new y4(e,o.Qs),d=l.ru(o.documents),h=sd.createSynthesizedTargetChangeForCurrentChange(n,r&&t.onlineState!=="Offline",s),m=l.applyChanges(d,t.isPrimaryClient,h);pS(t,n,m.au);const p=new _4(e,n,l);return t.Tu.set(e,p),t.Iu.has(n)?t.Iu.get(n).push(e):t.Iu.set(n,[e]),m.snapshot}async function E4(t,e,n){const r=nt(t),s=r.Tu.get(e),o=r.Iu.get(s.targetId);if(o.length>1)return r.Iu.set(s.targetId,o.filter((l=>!em(l,e)))),void r.Tu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await Ty(r.localStore,s.targetId,!1).then((()=>{r.sharedClientState.clearQueryState(s.targetId),n&&x0(r.remoteStore,s.targetId),Ry(r,s.targetId)})).catch(lc)):(Ry(r,s.targetId),await Ty(r.localStore,s.targetId,!0))}async function C4(t,e){const n=nt(t),r=n.Tu.get(e),s=n.Iu.get(r.targetId);n.isPrimaryClient&&s.length===1&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),x0(n.remoteStore,r.targetId))}async function T4(t,e,n){const r=O4(t);try{const s=await(function(l,d){const h=nt(l),m=$t.now(),p=d.reduce(((_,S)=>_.add(S.key)),pt());let g,v;return h.persistence.runTransaction("Locally write mutations","readwrite",(_=>{let S=Ss(),x=pt();return h.Ns.getEntries(_,p).next((E=>{S=E,S.forEach(((C,T)=>{T.isValidDocument()||(x=x.add(C))}))})).next((()=>h.localDocuments.getOverlayedDocuments(_,S))).next((E=>{g=E;const C=[];for(const T of d){const A=FM(T,g.get(T.key).overlayedDocument);A!=null&&C.push(new Oa(T.key,A,JE(A.value.mapValue),hr.exists(!0)))}return h.mutationQueue.addMutationBatch(_,m,C,d)})).next((E=>{v=E;const C=E.applyToLocalDocumentSet(g,x);return h.documentOverlayCache.saveOverlays(_,E.batchId,C)}))})).then((()=>({batchId:v.batchId,changes:uC(g)})))})(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),(function(l,d,h){let m=l.Vu[l.currentUser.toKey()];m||(m=new Xt(mt)),m=m.insert(d,h),l.Vu[l.currentUser.toKey()]=m})(r,s.batchId,n),await od(r,s.changes),await lm(r.remoteStore)}catch(s){const o=T0(s,"Failed to persist write");n.reject(o)}}async function QC(t,e){const n=nt(t);try{const r=await LN(n.localStore,e);e.targetChanges.forEach(((s,o)=>{const l=n.Au.get(o);l&&(Tt(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1,22616),s.addedDocuments.size>0?l.hu=!0:s.modifiedDocuments.size>0?Tt(l.hu,14607):s.removedDocuments.size>0&&(Tt(l.hu,42227),l.hu=!1))})),await od(n,r,e)}catch(r){await lc(r)}}function mS(t,e,n){const r=nt(t);if(r.isPrimaryClient&&n===0||!r.isPrimaryClient&&n===1){const s=[];r.Tu.forEach(((o,l)=>{const d=l.view.va(e);d.snapshot&&s.push(d.snapshot)})),(function(l,d){const h=nt(l);h.onlineState=d;let m=!1;h.queries.forEach(((p,g)=>{for(const v of g.Sa)v.va(d)&&(m=!0)})),m&&A0(h)})(r.eventManager,e),s.length&&r.Pu.H_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function A4(t,e,n){const r=nt(t);r.sharedClientState.updateQueryState(e,"rejected",n);const s=r.Au.get(e),o=s&&s.key;if(o){let l=new Xt(We.comparator);l=l.insert(o,Kn.newNoDocument(o,et.min()));const d=pt().add(o),h=new sm(et.min(),new Map,new Xt(mt),l,d);await QC(r,h),r.du=r.du.remove(o),r.Au.delete(e),R0(r)}else await Ty(r.localStore,e,!1).then((()=>Ry(r,e,n))).catch(lc)}async function j4(t,e){const n=nt(t),r=e.batch.batchId;try{const s=await BN(n.localStore,e);YC(n,r,null),KC(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await od(n,s)}catch(s){await lc(s)}}async function R4(t,e,n){const r=nt(t);try{const s=await(function(l,d){const h=nt(l);return h.persistence.runTransaction("Reject batch","readwrite-primary",(m=>{let p;return h.mutationQueue.lookupMutationBatch(m,d).next((g=>(Tt(g!==null,37113),p=g.keys(),h.mutationQueue.removeMutationBatch(m,g)))).next((()=>h.mutationQueue.performConsistencyCheck(m))).next((()=>h.documentOverlayCache.removeOverlaysForBatchId(m,p,d))).next((()=>h.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(m,p))).next((()=>h.localDocuments.getDocuments(m,p)))}))})(r.localStore,e);YC(r,e,n),KC(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),await od(r,s)}catch(s){await lc(s)}}function KC(t,e){(t.mu.get(e)||[]).forEach((n=>{n.resolve()})),t.mu.delete(e)}function YC(t,e,n){const r=nt(t);let s=r.Vu[r.currentUser.toKey()];if(s){const o=s.get(e);o&&(n?o.reject(n):o.resolve(),s=s.remove(e)),r.Vu[r.currentUser.toKey()]=s}}function Ry(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.Iu.get(e))t.Tu.delete(r),n&&t.Pu.yu(r,n);t.Iu.delete(e),t.isPrimaryClient&&t.Ru.jr(e).forEach((r=>{t.Ru.containsKey(r)||XC(t,r)}))}function XC(t,e){t.Eu.delete(e.path.canonicalString());const n=t.du.get(e);n!==null&&(x0(t.remoteStore,n),t.du=t.du.remove(e),t.Au.delete(n),R0(t))}function pS(t,e,n){for(const r of n)r instanceof qC?(t.Ru.addReference(r.key,e),I4(t,r)):r instanceof GC?(Le(j0,"Document no longer in limbo: "+r.key),t.Ru.removeReference(r.key,e),t.Ru.containsKey(r.key)||XC(t,r.key)):Xe(19791,{wu:r})}function I4(t,e){const n=e.key,r=n.path.canonicalString();t.du.get(n)||t.Eu.has(r)||(Le(j0,"New document in limbo: "+n),t.Eu.add(r),R0(t))}function R0(t){for(;t.Eu.size>0&&t.du.size<t.maxConcurrentLimboResolutions;){const e=t.Eu.values().next().value;t.Eu.delete(e);const n=new We(Lt.fromString(e)),r=t.fu.next();t.Au.set(r,new b4(n)),t.du=t.du.insert(n,r),PC(t.remoteStore,new fa(Li(h0(n.path)),r,"TargetPurposeLimboResolution",Xf.ce))}}async function od(t,e,n){const r=nt(t),s=[],o=[],l=[];r.Tu.isEmpty()||(r.Tu.forEach(((d,h)=>{l.push(r.pu(h,e,n).then((m=>{if((m||n)&&r.isPrimaryClient){const p=m?!m.fromCache:n?.targetChanges.get(h.targetId)?.current;r.sharedClientState.updateQueryState(h.targetId,p?"current":"not-current")}if(m){s.push(m);const p=b0.As(h.targetId,m);o.push(p)}})))})),await Promise.all(l),r.Pu.H_(s),await(async function(h,m){const p=nt(h);try{await p.persistence.runTransaction("notifyLocalViewChanges","readwrite",(g=>De.forEach(m,(v=>De.forEach(v.Es,(_=>p.persistence.referenceDelegate.addReference(g,v.targetId,_))).next((()=>De.forEach(v.ds,(_=>p.persistence.referenceDelegate.removeReference(g,v.targetId,_)))))))))}catch(g){if(!cc(g))throw g;Le(v0,"Failed to update sequence numbers: "+g)}for(const g of m){const v=g.targetId;if(!g.fromCache){const _=p.Ms.get(v),S=_.snapshotVersion,x=_.withLastLimboFreeSnapshotVersion(S);p.Ms=p.Ms.insert(v,x)}}})(r.localStore,o))}async function D4(t,e){const n=nt(t);if(!n.currentUser.isEqual(e)){Le(j0,"User change. New user:",e.toKey());const r=await kC(n.localStore,e);n.currentUser=e,(function(o,l){o.mu.forEach((d=>{d.forEach((h=>{h.reject(new Be(je.CANCELLED,l))}))})),o.mu.clear()})(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await od(n,r.Ls)}}function k4(t,e){const n=nt(t),r=n.Au.get(e);if(r&&r.hu)return pt().add(r.key);{let s=pt();const o=n.Iu.get(e);if(!o)return s;for(const l of o){const d=n.Tu.get(l);s=s.unionWith(d.view.nu)}return s}}function ZC(t){const e=nt(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=QC.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=k4.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=A4.bind(null,e),e.Pu.H_=p4.bind(null,e.eventManager),e.Pu.yu=g4.bind(null,e.eventManager),e}function O4(t){const e=nt(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=j4.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=R4.bind(null,e),e}class Df{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=am(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,n){return null}Mu(e,n){return null}vu(e){return zN(this.persistence,new MN,e.initialUser,this.serializer)}Cu(e){return new DC(_0.mi,this.serializer)}Du(e){return new HN}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Df.provider={build:()=>new Df};class M4 extends Df{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,n){Tt(this.persistence.referenceDelegate instanceof Rf,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new bN(r,e.asyncQueue,n)}Cu(e){const n=this.cacheSizeBytes!==void 0?ur.withCacheSize(this.cacheSizeBytes):ur.DEFAULT;return new DC((r=>Rf.mi(r,n)),this.serializer)}}class Iy{async initialize(e,n){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>mS(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=D4.bind(null,this.syncEngine),await h4(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new m4})()}createDatastore(e){const n=am(e.databaseInfo.databaseId),r=(function(o){return new KN(o)})(e.databaseInfo);return(function(o,l,d,h){return new JN(o,l,d,h)})(e.authCredentials,e.appCheckCredentials,r,n)}createRemoteStore(e){return(function(r,s,o,l,d){return new t4(r,s,o,l,d)})(this.localStore,this.datastore,e.asyncQueue,(n=>mS(this.syncEngine,n,0)),(function(){return lS.v()?new lS:new qN})())}createSyncEngine(e,n){return(function(s,o,l,d,h,m,p){const g=new v4(s,o,l,d,h,m);return p&&(g.gu=!0),g})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,n)}async terminate(){await(async function(n){const r=nt(n);Le(Eo,"RemoteStore shutting down."),r.Ea.add(5),await ad(r),r.Aa.shutdown(),r.Ra.set("Unknown")})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}Iy.provider={build:()=>new Iy};class JC{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):ws("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,n){setTimeout((()=>{this.muted||e(n)}),0)}}const Aa="FirestoreClient";class N4{constructor(e,n,r,s,o){this.authCredentials=e,this.appCheckCredentials=n,this.asyncQueue=r,this.databaseInfo=s,this.user=Qn.UNAUTHENTICATED,this.clientId=a0.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=o,this.authCredentials.start(r,(async l=>{Le(Aa,"Received user=",l.uid),await this.authCredentialListener(l),this.user=l})),this.appCheckCredentials.start(r,(l=>(Le(Aa,"Received new app check token=",l),this.appCheckCredentialListener(l,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new ys;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){const r=T0(n,"Failed to shutdown persistence");e.reject(r)}})),e.promise}}async function Ug(t,e){t.asyncQueue.verifyOperationInProgress(),Le(Aa,"Initializing OfflineComponentProvider");const n=t.configuration;await e.initialize(n);let r=n.initialUser;t.setCredentialChangeListener((async s=>{r.isEqual(s)||(await kC(e.localStore,s),r=s)})),e.persistence.setDatabaseDeletedListener((()=>t.terminate())),t._offlineComponents=e}async function gS(t,e){t.asyncQueue.verifyOperationInProgress();const n=await P4(t);Le(Aa,"Initializing OnlineComponentProvider"),await e.initialize(n,t.configuration),t.setCredentialChangeListener((r=>uS(e.remoteStore,r))),t.setAppCheckTokenChangeListener(((r,s)=>uS(e.remoteStore,s))),t._onlineComponents=e}async function P4(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){Le(Aa,"Using user provided OfflineComponentProvider");try{await Ug(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!(function(s){return s.name==="FirebaseError"?s.code===je.FAILED_PRECONDITION||s.code===je.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11})(n))throw n;Ul("Error using user provided cache. Falling back to memory cache: "+n),await Ug(t,new Df)}}else Le(Aa,"Using default OfflineComponentProvider"),await Ug(t,new M4(void 0));return t._offlineComponents}async function eT(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(Le(Aa,"Using user provided OnlineComponentProvider"),await gS(t,t._uninitializedComponentsProvider._online)):(Le(Aa,"Using default OnlineComponentProvider"),await gS(t,new Iy))),t._onlineComponents}function z4(t){return eT(t).then((e=>e.syncEngine))}async function tT(t){const e=await eT(t),n=e.eventManager;return n.onListen=x4.bind(null,e.syncEngine),n.onUnlisten=E4.bind(null,e.syncEngine),n.onFirstRemoteStoreListen=w4.bind(null,e.syncEngine),n.onLastRemoteStoreUnlisten=C4.bind(null,e.syncEngine),n}function B4(t,e,n={}){const r=new ys;return t.asyncQueue.enqueueAndForget((async()=>(function(o,l,d,h,m){const p=new JC({next:v=>{p.Nu(),l.enqueueAndForget((()=>$C(o,g)));const _=v.docs.has(d);!_&&v.fromCache?m.reject(new Be(je.UNAVAILABLE,"Failed to get document because the client is offline.")):_&&v.fromCache&&h&&h.source==="server"?m.reject(new Be(je.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):m.resolve(v)},error:v=>m.reject(v)}),g=new HC(h0(d.path),p,{includeMetadataChanges:!0,qa:!0});return VC(o,g)})(await tT(t),t.asyncQueue,e,n,r))),r.promise}function L4(t,e,n={}){const r=new ys;return t.asyncQueue.enqueueAndForget((async()=>(function(o,l,d,h,m){const p=new JC({next:v=>{p.Nu(),l.enqueueAndForget((()=>$C(o,g))),v.fromCache&&h.source==="server"?m.reject(new Be(je.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):m.resolve(v)},error:v=>m.reject(v)}),g=new HC(d,p,{includeMetadataChanges:!0,qa:!0});return VC(o,g)})(await tT(t),t.asyncQueue,e,n,r))),r.promise}function nT(t){const e={};return t.timeoutSeconds!==void 0&&(e.timeoutSeconds=t.timeoutSeconds),e}const yS=new Map;const rT="firestore.googleapis.com",_S=!0;class bS{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new Be(je.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=rT,this.ssl=_S}else this.host=e.host,this.ssl=e.ssl??_S;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=IC;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<yN)throw new Be(je.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}tM("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=nT(e.experimentalLongPollingOptions??{}),(function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new Be(je.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new Be(je.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new Be(je.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(r,s){return r.timeoutSeconds===s.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class cm{constructor(e,n,r,s){this._authCredentials=e,this._appCheckCredentials=n,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new bS({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Be(je.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new Be(je.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new bS(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(r){if(!r)return new qO;switch(r.type){case"firstParty":return new KO(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new Be(je.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(n){const r=yS.get(n);r&&(Le("ComponentProvider","Removing Datastore"),yS.delete(n),r.terminate())})(this),Promise.resolve()}}function U4(t,e,n,r={}){t=ai(t,cm);const s=tc(e),o=t._getSettings(),l={...o,emulatorOptions:t._getEmulatorOptions()},d=`${e}:${n}`;s&&(k1(`https://${d}`),O1("Firestore",!0)),o.host!==rT&&o.host!==d&&Ul("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const h={...o,host:d,ssl:s,emulatorOptions:r};if(!bs(h,l)&&(t._setSettings(h),r.mockUserToken)){let m,p;if(typeof r.mockUserToken=="string")m=r.mockUserToken,p=Qn.MOCK_USER;else{m=tR(r.mockUserToken,t._app?.options.projectId);const g=r.mockUserToken.sub||r.mockUserToken.user_id;if(!g)throw new Be(je.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");p=new Qn(g)}t._authCredentials=new GO(new FE(m,p))}}class dc{constructor(e,n,r){this.converter=n,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new dc(this.firestore,e,this._query)}}class on{constructor(e,n,r){this.converter=n,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new xa(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new on(this.firestore,e,this._key)}toJSON(){return{type:on._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,n,r){if(nd(n,on._jsonSchema))return new on(e,r||null,new We(Lt.fromString(n.referencePath)))}}on._jsonSchemaVersion="firestore/documentReference/1.0",on._jsonSchema={type:_n("string",on._jsonSchemaVersion),referencePath:_n("string")};class xa extends dc{constructor(e,n,r){super(e,n,h0(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new on(this.firestore,null,new We(e))}withConverter(e){return new xa(this.firestore,e,this._path)}}function F4(t,e,...n){if(t=bn(t),VE("collection","path",e),t instanceof cm){const r=Lt.fromString(e,...n);return kw(r),new xa(t,null,r)}{if(!(t instanceof on||t instanceof xa))throw new Be(je.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(Lt.fromString(e,...n));return kw(r),new xa(t.firestore,null,r)}}function hc(t,e,...n){if(t=bn(t),arguments.length===1&&(e=a0.newId()),VE("doc","path",e),t instanceof cm){const r=Lt.fromString(e,...n);return Dw(r),new on(t,null,new We(r))}{if(!(t instanceof on||t instanceof xa))throw new Be(je.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(Lt.fromString(e,...n));return Dw(r),new on(t.firestore,t instanceof xa?t.converter:null,new We(r))}}const vS="AsyncQueue";class xS{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new MC(this,"async_queue_retry"),this._c=()=>{const r=Lg();r&&Le(vS,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=e;const n=Lg();n&&typeof n.addEventListener=="function"&&n.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const n=Lg();n&&typeof n.removeEventListener=="function"&&n.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise((()=>{}));const n=new ys;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(e().then(n.resolve,n.reject),n.promise))).then((()=>n.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Xu.push(e),this.lc())))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!cc(e))throw e;Le(vS,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_((()=>this.lc()))}}cc(e){const n=this.ac.then((()=>(this.rc=!0,e().catch((r=>{throw this.nc=r,this.rc=!1,ws("INTERNAL UNHANDLED ERROR: ",wS(r)),r})).then((r=>(this.rc=!1,r))))));return this.ac=n,n}enqueueAfterDelay(e,n,r){this.uc(),this.oc.indexOf(e)>-1&&(n=0);const s=C0.createAndSchedule(this,e,n,r,(o=>this.hc(o)));return this.tc.push(s),s}uc(){this.nc&&Xe(47125,{Pc:wS(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const n of this.tc)if(n.timerId===e)return!0;return!1}Ec(e){return this.Tc().then((()=>{this.tc.sort(((n,r)=>n.targetTimeMs-r.targetTimeMs));for(const n of this.tc)if(n.skipDelay(),e!=="all"&&n.timerId===e)break;return this.Tc()}))}dc(e){this.oc.push(e)}hc(e){const n=this.tc.indexOf(e);this.tc.splice(n,1)}}function wS(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+`
`+t.stack),e}class Io extends cm{constructor(e,n,r,s){super(e,n,r,s),this.type="firestore",this._queue=new xS,this._persistenceKey=s?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new xS(e),this._firestoreClient=void 0,await e}}}function V4(t,e){const n=typeof t=="object"?t:z1(),r=typeof t=="string"?t:wf,s=Gy(n,"firestore").getImmediate({identifier:r});if(!s._initialized){const o=Jj("firestore");o&&U4(s,...o)}return s}function um(t){if(t._terminated)throw new Be(je.FAILED_PRECONDITION,"The client has already been terminated.");return t._firestoreClient||$4(t),t._firestoreClient}function $4(t){const e=t._freezeSettings(),n=(function(s,o,l,d){return new hM(s,o,l,d.host,d.ssl,d.experimentalForceLongPolling,d.experimentalAutoDetectLongPolling,nT(d.experimentalLongPollingOptions),d.useFetchStreams,d.isUsingEmulator)})(t._databaseId,t._app?.options.appId||"",t._persistenceKey,e);t._componentsProvider||e.localCache?._offlineComponentProvider&&e.localCache?._onlineComponentProvider&&(t._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),t._firestoreClient=new N4(t._authCredentials,t._appCheckCredentials,t._queue,n,t._componentsProvider&&(function(s){const o=s?._online.build();return{_offline:s?._offline.build(o),_online:o}})(t._componentsProvider))}class Fr{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Fr(Fn.fromBase64String(e))}catch(n){throw new Be(je.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+n)}}static fromUint8Array(e){return new Fr(Fn.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:Fr._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(nd(e,Fr._jsonSchema))return Fr.fromBase64String(e.bytes)}}Fr._jsonSchemaVersion="firestore/bytes/1.0",Fr._jsonSchema={type:_n("string",Fr._jsonSchemaVersion),bytes:_n("string")};class ld{constructor(...e){for(let n=0;n<e.length;++n)if(e[n].length===0)throw new Be(je.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Bn(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class cd{constructor(e){this._methodName=e}}class Fi{constructor(e,n){if(!isFinite(e)||e<-90||e>90)throw new Be(je.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(n)||n<-180||n>180)throw new Be(je.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=e,this._long=n}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return mt(this._lat,e._lat)||mt(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Fi._jsonSchemaVersion}}static fromJSON(e){if(nd(e,Fi._jsonSchema))return new Fi(e.latitude,e.longitude)}}Fi._jsonSchemaVersion="firestore/geoPoint/1.0",Fi._jsonSchema={type:_n("string",Fi._jsonSchemaVersion),latitude:_n("number"),longitude:_n("number")};class Vi{constructor(e){this._values=(e||[]).map((n=>n))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(r,s){if(r.length!==s.length)return!1;for(let o=0;o<r.length;++o)if(r[o]!==s[o])return!1;return!0})(this._values,e._values)}toJSON(){return{type:Vi._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(nd(e,Vi._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every((n=>typeof n=="number")))return new Vi(e.vectorValues);throw new Be(je.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Vi._jsonSchemaVersion="firestore/vectorValue/1.0",Vi._jsonSchema={type:_n("string",Vi._jsonSchemaVersion),vectorValues:_n("object")};const H4=/^__.*__$/;class q4{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return this.fieldMask!==null?new Oa(e,this.data,this.fieldMask,n,this.fieldTransforms):new id(e,this.data,n,this.fieldTransforms)}}class iT{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return new Oa(e,this.data,this.fieldMask,n,this.fieldTransforms)}}function sT(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Xe(40011,{Ac:t})}}class dm{constructor(e,n,r,s,o,l){this.settings=e,this.databaseId=n,this.serializer=r,this.ignoreUndefinedProperties=s,o===void 0&&this.Rc(),this.fieldTransforms=o||[],this.fieldMask=l||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new dm({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){const n=this.path?.child(e),r=this.Vc({path:n,fc:!1});return r.gc(e),r}yc(e){const n=this.path?.child(e),r=this.Vc({path:n,fc:!1});return r.Rc(),r}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return kf(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find((n=>e.isPrefixOf(n)))!==void 0||this.fieldTransforms.find((n=>e.isPrefixOf(n.field)))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(sT(this.Ac)&&H4.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class G4{constructor(e,n,r){this.databaseId=e,this.ignoreUndefinedProperties=n,this.serializer=r||am(e)}Cc(e,n,r,s=!1){return new dm({Ac:e,methodName:n,Dc:r,path:Bn.emptyPath(),fc:!1,bc:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function hm(t){const e=t._freezeSettings(),n=am(t._databaseId);return new G4(t._databaseId,!!e.ignoreUndefinedProperties,n)}function aT(t,e,n,r,s,o={}){const l=t.Cc(o.merge||o.mergeFields?2:0,e,n,s);k0("Data must be an object, but it was:",l,r);const d=uT(r,l);let h,m;if(o.merge)h=new Sr(l.fieldMask),m=l.fieldTransforms;else if(o.mergeFields){const p=[];for(const g of o.mergeFields){const v=Dy(e,g,n);if(!l.contains(v))throw new Be(je.INVALID_ARGUMENT,`Field '${v}' is specified in your field mask but missing from your input data.`);hT(p,v)||p.push(v)}h=new Sr(p),m=l.fieldTransforms.filter((g=>h.covers(g.field)))}else h=null,m=l.fieldTransforms;return new q4(new dr(d),h,m)}class ud extends cd{_toFieldTransform(e){if(e.Ac!==2)throw e.Ac===1?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof ud}}function oT(t,e,n){return new dm({Ac:3,Dc:e.settings.Dc,methodName:t._methodName,fc:n},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class I0 extends cd{constructor(e,n){super(e),this.vc=n}_toFieldTransform(e){const n=oT(this,e,!0),r=this.vc.map((o=>Do(o,n))),s=new Hl(r);return new yC(e.path,s)}isEqual(e){return e instanceof I0&&bs(this.vc,e.vc)}}class D0 extends cd{constructor(e,n){super(e),this.vc=n}_toFieldTransform(e){const n=oT(this,e,!0),r=this.vc.map((o=>Do(o,n))),s=new ql(r);return new yC(e.path,s)}isEqual(e){return e instanceof D0&&bs(this.vc,e.vc)}}function lT(t,e,n,r){const s=t.Cc(1,e,n);k0("Data must be an object, but it was:",s,r);const o=[],l=dr.empty();ka(r,((h,m)=>{const p=O0(e,h,n);m=bn(m);const g=s.yc(p);if(m instanceof ud)o.push(p);else{const v=Do(m,g);v!=null&&(o.push(p),l.set(p,v))}}));const d=new Sr(o);return new iT(l,d,s.fieldTransforms)}function cT(t,e,n,r,s,o){const l=t.Cc(1,e,n),d=[Dy(e,r,n)],h=[s];if(o.length%2!=0)throw new Be(je.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let v=0;v<o.length;v+=2)d.push(Dy(e,o[v])),h.push(o[v+1]);const m=[],p=dr.empty();for(let v=d.length-1;v>=0;--v)if(!hT(m,d[v])){const _=d[v];let S=h[v];S=bn(S);const x=l.yc(_);if(S instanceof ud)m.push(_);else{const E=Do(S,x);E!=null&&(m.push(_),p.set(_,E))}}const g=new Sr(m);return new iT(p,g,l.fieldTransforms)}function W4(t,e,n,r=!1){return Do(n,t.Cc(r?4:3,e))}function Do(t,e){if(dT(t=bn(t)))return k0("Unsupported field value:",e,t),uT(t,e);if(t instanceof cd)return(function(r,s){if(!sT(s.Ac))throw s.Sc(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Sc(`${r._methodName}() is not currently supported inside arrays`);const o=r._toFieldTransform(s);o&&s.fieldTransforms.push(o)})(t,e),null;if(t===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return(function(r,s){const o=[];let l=0;for(const d of r){let h=Do(d,s.wc(l));h==null&&(h={nullValue:"NULL_VALUE"}),o.push(h),l++}return{arrayValue:{values:o}}})(t,e)}return(function(r,s){if((r=bn(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return NM(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const o=$t.fromDate(r);return{timestampValue:jf(s.serializer,o)}}if(r instanceof $t){const o=new $t(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:jf(s.serializer,o)}}if(r instanceof Fi)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Fr)return{bytesValue:SC(s.serializer,r._byteString)};if(r instanceof on){const o=s.databaseId,l=r.firestore._databaseId;if(!l.isEqual(o))throw s.Sc(`Document reference is for database ${l.projectId}/${l.database} but should be for database ${o.projectId}/${o.database}`);return{referenceValue:g0(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof Vi)return(function(l,d){return{mapValue:{fields:{[XE]:{stringValue:ZE},[Sf]:{arrayValue:{values:l.toArray().map((m=>{if(typeof m!="number")throw d.Sc("VectorValues must only contain numeric values.");return f0(d.serializer,m)}))}}}}}})(r,s);throw s.Sc(`Unsupported field value: ${Yf(r)}`)})(t,e)}function uT(t,e){const n={};return qE(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):ka(t,((r,s)=>{const o=Do(s,e.mc(r));o!=null&&(n[r]=o)})),{mapValue:{fields:n}}}function dT(t){return!(typeof t!="object"||t===null||t instanceof Array||t instanceof Date||t instanceof $t||t instanceof Fi||t instanceof Fr||t instanceof on||t instanceof cd||t instanceof Vi)}function k0(t,e,n){if(!dT(n)||!$E(n)){const r=Yf(n);throw r==="an object"?e.Sc(t+" a custom object"):e.Sc(t+" "+r)}}function Dy(t,e,n){if((e=bn(e))instanceof ld)return e._internalPath;if(typeof e=="string")return O0(t,e);throw kf("Field path arguments must be of type string or ",t,!1,void 0,n)}const Q4=new RegExp("[~\\*/\\[\\]]");function O0(t,e,n){if(e.search(Q4)>=0)throw kf(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new ld(...e.split("."))._internalPath}catch{throw kf(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function kf(t,e,n,r,s){const o=r&&!r.isEmpty(),l=s!==void 0;let d=`Function ${e}() called with invalid data`;n&&(d+=" (via `toFirestore()`)"),d+=". ";let h="";return(o||l)&&(h+=" (found",o&&(h+=` in field ${r}`),l&&(h+=` in document ${s}`),h+=")"),new Be(je.INVALID_ARGUMENT,d+t+h)}function hT(t,e){return t.some((n=>n.isEqual(e)))}class fT{constructor(e,n,r,s,o){this._firestore=e,this._userDataWriter=n,this._key=r,this._document=s,this._converter=o}get id(){return this._key.path.lastSegment()}get ref(){return new on(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new K4(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const n=this._document.data.field(M0("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n)}}}class K4 extends fT{data(){return super.data()}}function M0(t,e){return typeof e=="string"?O0(t,e):e instanceof ld?e._internalPath:e._delegate._internalPath}function Y4(t){if(t.limitType==="L"&&t.explicitOrderBy.length===0)throw new Be(je.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class N0{}class X4 extends N0{}function Z4(t,e,...n){let r=[];e instanceof N0&&r.push(e),r=r.concat(n),(function(o){const l=o.filter((h=>h instanceof P0)).length,d=o.filter((h=>h instanceof fm)).length;if(l>1||l>0&&d>0)throw new Be(je.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")})(r);for(const s of r)t=s._apply(t);return t}class fm extends X4{constructor(e,n,r){super(),this._field=e,this._op=n,this._value=r,this.type="where"}static _create(e,n,r){return new fm(e,n,r)}_apply(e){const n=this._parse(e);return mT(e._query,n),new dc(e.firestore,e.converter,vy(e._query,n))}_parse(e){const n=hm(e.firestore);return(function(o,l,d,h,m,p,g){let v;if(m.isKeyField()){if(p==="array-contains"||p==="array-contains-any")throw new Be(je.INVALID_ARGUMENT,`Invalid Query. You can't perform '${p}' queries on documentId().`);if(p==="in"||p==="not-in"){ES(g,p);const S=[];for(const x of g)S.push(SS(h,o,x));v={arrayValue:{values:S}}}else v=SS(h,o,g)}else p!=="in"&&p!=="not-in"&&p!=="array-contains-any"||ES(g,p),v=W4(d,l,g,p==="in"||p==="not-in");return yn.create(m,p,v)})(e._query,"where",n,e.firestore._databaseId,this._field,this._op,this._value)}}function J4(t,e,n){const r=e,s=M0("where",t);return fm._create(s,r,n)}class P0 extends N0{constructor(e,n){super(),this.type=e,this._queryConstraints=n}static _create(e,n){return new P0(e,n)}_parse(e){const n=this._queryConstraints.map((r=>r._parse(e))).filter((r=>r.getFilters().length>0));return n.length===1?n[0]:oi.create(n,this._getOperator())}_apply(e){const n=this._parse(e);return n.getFilters().length===0?e:((function(s,o){let l=s;const d=o.getFlattenedFilters();for(const h of d)mT(l,h),l=vy(l,h)})(e._query,n),new dc(e.firestore,e.converter,vy(e._query,n)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function SS(t,e,n){if(typeof(n=bn(n))=="string"){if(n==="")throw new Be(je.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!aC(e)&&n.indexOf("/")!==-1)throw new Be(je.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=e.path.child(Lt.fromString(n));if(!We.isDocumentKey(r))throw new Be(je.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Uw(t,new We(r))}if(n instanceof on)return Uw(t,n._key);throw new Be(je.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Yf(n)}.`)}function ES(t,e){if(!Array.isArray(t)||t.length===0)throw new Be(je.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function mT(t,e){const n=(function(s,o){for(const l of s)for(const d of l.getFlattenedFilters())if(o.indexOf(d.op)>=0)return d.op;return null})(t.filters,(function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(e.op));if(n!==null)throw n===e.op?new Be(je.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new Be(je.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}class e6{convertValue(e,n="none"){switch(Ca(e)){case 0:return null;case 1:return e.booleanValue;case 2:return an(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,n);case 5:return e.stringValue;case 6:return this.convertBytes(Ea(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,n);case 11:return this.convertObject(e.mapValue,n);case 10:return this.convertVectorValue(e.mapValue);default:throw Xe(62114,{value:e})}}convertObject(e,n){return this.convertObjectMap(e.fields,n)}convertObjectMap(e,n="none"){const r={};return ka(e,((s,o)=>{r[s]=this.convertValue(o,n)})),r}convertVectorValue(e){const n=e.fields?.[Sf].arrayValue?.values?.map((r=>an(r.doubleValue)));return new Vi(n)}convertGeoPoint(e){return new Fi(an(e.latitude),an(e.longitude))}convertArray(e,n){return(e.values||[]).map((r=>this.convertValue(r,n)))}convertServerTimestamp(e,n){switch(n){case"previous":const r=Jf(e);return r==null?null:this.convertValue(r,n);case"estimate":return this.convertTimestamp(zu(e));default:return null}}convertTimestamp(e){const n=Sa(e);return new $t(n.seconds,n.nanos)}convertDocumentKey(e,n){const r=Lt.fromString(e);Tt(RC(r),9688,{name:e});const s=new Bu(r.get(1),r.get(3)),o=new We(r.popFirst(5));return s.isEqual(n)||ws(`Document ${o} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${n.projectId}/${n.database}) instead.`),o}}function pT(t,e,n){let r;return r=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,r}class Eu{constructor(e,n){this.hasPendingWrites=e,this.fromCache=n}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class _o extends fT{constructor(e,n,r,s,o,l){super(e,n,r,s,l),this._firestore=e,this._firestoreImpl=e,this.metadata=o}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const n=new lf(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(n,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,n={}){if(this._document){const r=this._document.data.field(M0("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,n.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new Be(je.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,n={};return n.type=_o._jsonSchemaVersion,n.bundle="",n.bundleSource="DocumentSnapshot",n.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?n:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),n.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),n)}}_o._jsonSchemaVersion="firestore/documentSnapshot/1.0",_o._jsonSchema={type:_n("string",_o._jsonSchemaVersion),bundleSource:_n("string","DocumentSnapshot"),bundleName:_n("string"),bundle:_n("string")};class lf extends _o{data(e={}){return super.data(e)}}class Pl{constructor(e,n,r,s){this._firestore=e,this._userDataWriter=n,this._snapshot=s,this.metadata=new Eu(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach((n=>e.push(n))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,n){this._snapshot.docs.forEach((r=>{e.call(n,new lf(this._firestore,this._userDataWriter,r.key,r,new Eu(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const n=!!e.includeMetadataChanges;if(n&&this._snapshot.excludesMetadataChanges)throw new Be(je.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===n||(this._cachedChanges=(function(s,o){if(s._snapshot.oldDocs.isEmpty()){let l=0;return s._snapshot.docChanges.map((d=>{const h=new lf(s._firestore,s._userDataWriter,d.doc.key,d.doc,new Eu(s._snapshot.mutatedKeys.has(d.doc.key),s._snapshot.fromCache),s.query.converter);return d.doc,{type:"added",doc:h,oldIndex:-1,newIndex:l++}}))}{let l=s._snapshot.oldDocs;return s._snapshot.docChanges.filter((d=>o||d.type!==3)).map((d=>{const h=new lf(s._firestore,s._userDataWriter,d.doc.key,d.doc,new Eu(s._snapshot.mutatedKeys.has(d.doc.key),s._snapshot.fromCache),s.query.converter);let m=-1,p=-1;return d.type!==0&&(m=l.indexOf(d.doc.key),l=l.delete(d.doc.key)),d.type!==1&&(l=l.add(d.doc),p=l.indexOf(d.doc.key)),{type:t6(d.type),doc:h,oldIndex:m,newIndex:p}}))}})(this,n),this._cachedChangesIncludeMetadataChanges=n),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new Be(je.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=Pl._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=a0.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const n=[],r=[],s=[];return this.docs.forEach((o=>{o._document!==null&&(n.push(o._document),r.push(this._userDataWriter.convertObjectMap(o._document.data.value.mapValue.fields,"previous")),s.push(o.ref.path))})),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function t6(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Xe(61501,{type:t})}}function n6(t){t=ai(t,on);const e=ai(t.firestore,Io);return B4(um(e),t._key).then((n=>o6(e,t,n)))}Pl._jsonSchemaVersion="firestore/querySnapshot/1.0",Pl._jsonSchema={type:_n("string",Pl._jsonSchemaVersion),bundleSource:_n("string","QuerySnapshot"),bundleName:_n("string"),bundle:_n("string")};class gT extends e6{constructor(e){super(),this.firestore=e}convertBytes(e){return new Fr(e)}convertReference(e){const n=this.convertDocumentKey(e,this.firestore._databaseId);return new on(this.firestore,null,n)}}function r6(t){t=ai(t,dc);const e=ai(t.firestore,Io),n=um(e),r=new gT(e);return Y4(t._query),L4(n,t._query).then((s=>new Pl(e,r,t,s)))}function i6(t,e,n){t=ai(t,on);const r=ai(t.firestore,Io),s=pT(t.converter,e,n);return mm(r,[aT(hm(r),"setDoc",t._key,s,t.converter!==null,n).toMutation(t._key,hr.none())])}function s6(t,e,n,...r){t=ai(t,on);const s=ai(t.firestore,Io),o=hm(s);let l;return l=typeof(e=bn(e))=="string"||e instanceof ld?cT(o,"updateDoc",t._key,e,n,r):lT(o,"updateDoc",t._key,e),mm(s,[l.toMutation(t._key,hr.exists(!0))])}function a6(t){return mm(ai(t.firestore,Io),[new im(t._key,hr.none())])}function mm(t,e){return(function(r,s){const o=new ys;return r.asyncQueue.enqueueAndForget((async()=>T4(await z4(r),s,o))),o.promise})(um(t),e)}function o6(t,e,n){const r=n.docs.get(e._key),s=new gT(t);return new _o(t,s,e._key,r,new Eu(n.hasPendingWrites,n.fromCache),e.converter)}class l6{constructor(e,n){this._firestore=e,this._commitHandler=n,this._mutations=[],this._committed=!1,this._dataReader=hm(e)}set(e,n,r){this._verifyNotCommitted();const s=Fg(e,this._firestore),o=pT(s.converter,n,r),l=aT(this._dataReader,"WriteBatch.set",s._key,o,s.converter!==null,r);return this._mutations.push(l.toMutation(s._key,hr.none())),this}update(e,n,r,...s){this._verifyNotCommitted();const o=Fg(e,this._firestore);let l;return l=typeof(n=bn(n))=="string"||n instanceof ld?cT(this._dataReader,"WriteBatch.update",o._key,n,r,s):lT(this._dataReader,"WriteBatch.update",o._key,n),this._mutations.push(l.toMutation(o._key,hr.exists(!0))),this}delete(e){this._verifyNotCommitted();const n=Fg(e,this._firestore);return this._mutations=this._mutations.concat(new im(n._key,hr.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new Be(je.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Fg(t,e){if((t=bn(t)).firestore!==e)throw new Be(je.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}function CS(){return new ud("deleteField")}function Uu(...t){return new I0("arrayUnion",t)}function TS(...t){return new D0("arrayRemove",t)}function yT(t){return um(t=ai(t,Io)),new l6(t,(e=>mm(t,e)))}(function(e,n=!0){(function(s){oc=s})(nc),Bl(new bo("firestore",((r,{instanceIdentifier:s,options:o})=>{const l=r.getProvider("app").getImmediate(),d=new Io(new WO(r.getProvider("auth-internal")),new YO(l,r.getProvider("app-check-internal")),(function(m,p){if(!Object.prototype.hasOwnProperty.apply(m.options,["projectId"]))throw new Be(je.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Bu(m.options.projectId,p)})(l,s),l);return o={useFetchStreams:n,...o},d._setSettings(o),d}),"PUBLIC").setMultipleInstances(!0)),ya(Aw,jw,e),ya(Aw,jw,"esm2020")})();function ko(){return V4(bE)}const wn={showGroupTotals:!1};function Oo(t,e,n,r=1,s,o){let l=e;if(e.startsWith("budgets/"))l="budgets";else if(e.startsWith("months/")){const p=e.replace("months/","").split("_");if(p.length>=2){const g=p[p.length-1];l=`months/${p[p.length-2]}/${g}`}}const d=s===!1?" [NOT FOUND]":"",h=`  ${n}`;console.log(`[Firebase] ${t}(${r}): ${l}${d}${h}`)}async function bt(t,e,n){const r=hc(ko(),t,e),s=`${t}/${e}`,o=await n6(r),l=o.exists(),d=l?o.data():null;return Oo("READ",s,n,1,l),{exists:l,data:d,ref:r}}async function Ht(t,e,n){const r=ko(),s=F4(r,t);let o;if(n&&n.length>0){const m=n.map(p=>J4(p.field,p.op,p.value));o=Z4(s,...m)}else o=s;const l=await r6(o),d=l.docs.map(m=>({id:m.id,data:m.data()}));let h=t;if(n&&n.length>0){const m=n.map(p=>`${p.field} ${p.op} ${JSON.stringify(p.value)}`).join(", ");h+=` WHERE ${m}`}return Oo("QUERY",h,e,l.docs.length,void 0),{docs:d}}async function tn(t,e,n,r,s){const o=hc(ko(),t,e),l=`${t}/${e}`;return Oo("WRITE",l,r,1,void 0),i6(o,n,s??{})}async function pm(t,e){const r=ko();for(let s=0;s<t.length;s+=500){const o=t.slice(s,s+500),l=yT(r);for(const{collectionPath:d,docId:h,data:m}of o){const p=hc(r,d,h);l.set(p,m)}Oo("BATCH_WRITE",`${o.length} docs`,e,o.length,void 0);try{await l.commit()}catch(d){throw console.error(`[Firebase] BATCH_WRITE ERROR in ${e}:`,d),console.error("[Firebase] Failed batch details:",{batchIndex:Math.floor(s/500)+1,totalBatches:Math.ceil(t.length/500),docsInBatch:o.length,firstDoc:o[0]?`${o[0].collectionPath}/${o[0].docId}`:"none"}),d}}}async function Ql(t,e,n,r){const s=hc(ko(),t,e),o=`${t}/${e}`;return Oo("UPDATE",o,r,1,void 0),s6(s,n)}async function Fu(t,e,n){const r=hc(ko(),t,e),s=`${t}/${e}`;return Oo("DELETE",s,n),a6(r)}async function _T(t,e,n){const s=ko();for(let o=0;o<t.length;o+=500){const l=t.slice(o,o+500),d=yT(s);for(const{collectionPath:h,docId:m}of l){const p=hc(s,h,m);d.delete(p)}Oo("BATCH_DELETE",`${l.length} docs`,e,l.length),await d.commit(),n?.(o+l.length)}}function c6(t={}){const e={};return Object.entries(t).forEach(([n,r])=>{e[n]={nickname:r.nickname??"",description:r.description??"",balance:r.balance??0,account_group_id:r.account_group_id??null,sort_order:r.sort_order??0,is_income_account:r.is_income_account??!1,is_income_default:r.is_income_default??!1,is_outgo_account:r.is_outgo_account??!1,is_outgo_default:r.is_outgo_default??!1,on_budget:r.on_budget??!0,is_active:r.is_active??!0}}),e}function u6(t={}){const e={};return Object.entries(t).forEach(([n,r])=>{e[n]={name:r.name,sort_order:r.sort_order??0,expected_balance:r.expected_balance??"positive",on_budget:r.on_budget,is_active:r.is_active}}),e}function d6(t={}){const e={};return Object.entries(t).forEach(([n,r])=>{e[n]={name:r.name,description:r.description,category_group_id:r.category_group_id??null,sort_order:r.sort_order??0,default_monthly_amount:r.default_monthly_amount,default_monthly_type:r.default_monthly_type,balance:r.balance??0}}),e}function h6(t=[]){const e=t.map(n=>({id:n.id,name:n.name,sort_order:n.sort_order??0}));return e.sort((n,r)=>n.sort_order-r.sort_order),e}function f6(t={}){const e={};return Object.entries(t).forEach(([n,r])=>{e[n]={needs_recalculation:r?.needs_recalculation??!1}}),e}async function m6(t){const{exists:e,data:n}=await bt("budgets",t,"loading budget data (cache miss or stale)");if(!e||!n)throw new Error(`Budget ${t} not found`);const r=c6(n.accounts),s=u6(n.account_groups),o=d6(n.categories),l=h6(n.category_groups),d=n.total_available??0,h=f6(n.month_map),m=n.is_needs_recalculation??!1;return{budget:{id:t,name:n.name,user_ids:n.user_ids||[],accepted_user_ids:n.accepted_user_ids||[],owner_id:n.owner_id||n.user_ids?.[0]||"",owner_email:n.owner_email||"",accounts:r,account_groups:s,categories:o,category_groups:l,total_available:d,is_needs_recalculation:m,month_map:h},accounts:r,accountGroups:s,categories:o,categoryGroups:l,isNeedsRecalculation:m,monthMap:h}}function p6(t,e){return ac({queryKey:t?Pe.budget(t):["budget","none"],queryFn:()=>m6(t),enabled:!!t&&e?.enabled!==!1})}function li(t,e,n){const r=n.toString().padStart(2,"0");return`${t}_${e}_${r}`}function Of(t,e){return e===1?{year:t-1,month:12}:{year:t,month:e-1}}function g6(t,e){return e===12?{year:t+1,month:1}:{year:t,month:e+1}}function Yt(t,e){return`${t}${e.toString().padStart(2,"0")}`}function ky(t){return new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit"})}function gm(t,e){const n=new Date,r=n.getFullYear(),s=n.getMonth()+1;if(t===r&&e===s){const o=n.getDate();return`${r}-${String(s).padStart(2,"0")}-${String(o).padStart(2,"0")}`}return`${t}-${String(e).padStart(2,"0")}-01`}function ym(t){const[e,n]=t.split("-").map(Number);return{year:e,month:n}}function Oe(t){return Math.round((t+Number.EPSILON)*100)/100}function ut(t){if(t==null||isNaN(t))return!1;const e=t*100;return Math.abs(e-Math.round(e))>1e-9}function Co(t){if(t==null)return t;if(Array.isArray(t))return t.map(e=>Co(e));if(typeof t=="object"){const e={};for(const[n,r]of Object.entries(t))r!==void 0&&(e[n]=Co(r));return e}return t}function y6(t,e,n,r){return{budget_id:e,year_month_ordinal:t.year_month_ordinal??Yt(n,r),year:t.year??n,month:t.month??r,income:t.income||[],total_income:t.total_income??0,previous_month_income:t.previous_month_income??0,expenses:t.expenses||[],total_expenses:t.total_expenses??0,transfers:t.transfers||[],adjustments:t.adjustments||[],account_balances:t.account_balances||[],category_balances:t.category_balances||[],are_allocations_finalized:t.are_allocations_finalized??!1,created_at:t.created_at,updated_at:t.updated_at}}async function $r(t,e,n,r){const s=li(t,e,n);return(await Ze.fetchQuery({queryKey:Pe.month(t,e,n),queryFn:async()=>{const{exists:l,data:d}=await bt("months",s,r?.description??`reading month ${e}/${n}`);return!l||!d?null:{month:y6(d,t,e,n)}},staleTime:OE}))?.month??null}async function _6(t,e,n){const r=Yt(e,n);return(await Ht("months","getFutureMonths: querying months after specified month",[{field:"budget_id",op:"==",value:t},{field:"year_month_ordinal",op:">",value:r}])).docs.map(l=>({id:l.id,...l.data})).sort((l,d)=>l.year!==d.year?l.year-d.year:l.month-d.month)}function b6(t){const e={},n={};return t.category_balances&&t.category_balances.forEach(r=>{e[r.category_id]=r.end_balance}),t.account_balances&&t.account_balances.forEach(r=>{n[r.account_id]=r.end_balance}),{categoryEndBalances:e,accountEndBalances:n}}const po={mobile:640,tablet:768,wide:1200},v6=po.mobile,Kl=["January","February","March","April","May","June","July","August","September","October","November","December"],Vu=3,Mf=3;function x6(){const t=new Date,e=t.getFullYear(),n=t.getMonth()+1,r=[];for(let s=Mf;s>0;s--){let o=e,l=n-s;for(;l<1;)l+=12,o-=1;r.push(Yt(o,l))}r.push(Yt(e,n));for(let s=1;s<=Vu;s++){let o=e,l=n+s;for(;l>12;)l-=12,o+=1;r.push(Yt(o,l))}return r}function w6(t,e){const n=Pe.budget(t),r=Ze.getQueryData(n);if(!r?.monthMap)return!1;for(const[s,o]of Object.entries(r.monthMap))if(s>=e&&!o.needs_recalculation)return!1;return!0}function S6(t,e,n){const r=Pe.budget(t),s=Ze.getQueryData(r);s&&Ze.setQueryData(r,{...s,isNeedsRecalculation:!0,monthMap:n,budget:{...s.budget,is_needs_recalculation:!0,month_map:n}})}function E6(t,e){const n=Pe.budget(t),r=Ze.getQueryData(n);r&&Ze.setQueryData(n,{...r,monthMap:e,budget:{...r.budget,month_map:e}})}async function C6(t,e,n,r){const{bypassDateLimit:s=!1}={},o=new Date,l=o.getFullYear(),d=o.getMonth()+1,h=(e-l)*12+(n-d);if(!s&&h>Vu){const D=`[createMonth] Refusing to create month ${e}/${n} - it's ${h} months in the future (max allowed: ${Vu}). This likely indicates a bug in month navigation.`;throw console.error(D),new Error(D)}if(!s&&h<-Mf){const D=`[createMonth] Refusing to create month ${e}/${n} - it's ${Math.abs(h)} months in the past (max allowed: ${Mf}). Existing months can still be viewed, but new months cannot be created this far back.`;throw console.error(D),new Error(D)}const{exists:m,data:p}=await bt("budgets",t,"validating budget exists before creating month");if(!m||!p){Ze.removeQueries({queryKey:Pe.budget(t)}),localStorage.removeItem("BUDGET_APP_QUERY_CACHE");const D=`[createMonth] Budget ${t} does not exist. It may have been deleted. Please refresh the page.`;throw console.error(D),new Error(D)}const g=o.toISOString(),v=li(t,e,n);let _=0,S={},x={};if(n>1||e>new Date().getFullYear()-10){const{year:D,month:N}=Of(e,n),F=li(t,D,N);try{const{exists:H,data:j}=await bt("months",F,"fetching previous month to create start balances for new month");if(H&&j){const M={budget_id:t,year_month_ordinal:j.year_month_ordinal??Yt(D,N),year:j.year??D,month:j.month??N,income:j.income||[],total_income:j.total_income??0,previous_month_income:j.previous_month_income??0,expenses:j.expenses||[],total_expenses:j.total_expenses??0,transfers:j.transfers||[],adjustments:j.adjustments||[],account_balances:j.account_balances||[],category_balances:j.category_balances||[],are_allocations_finalized:j.are_allocations_finalized??!1,created_at:j.created_at,updated_at:j.updated_at};_=M.total_income;const{categoryEndBalances:R,accountEndBalances:K}=b6(M);S=R,x=K}}catch(H){if(H instanceof Error&&H.message.includes("Missing or insufficient permissions"))console.warn(`[createMonth] Permission error reading previous month ${D}/${N}, starting with zero balances`);else throw H}}const E=Object.entries(S).map(([D,N])=>({category_id:D,start_balance:N,allocated:0,spent:0,transfers:0,adjustments:0,end_balance:N})),C=Object.entries(x).map(([D,N])=>({account_id:D,start_balance:N,income:0,expenses:0,transfers:0,adjustments:0,net_change:0,end_balance:N})),T={budget_id:t,year_month_ordinal:Yt(e,n),year:e,month:n,income:[],total_income:0,previous_month_income:_,expenses:[],total_expenses:0,transfers:[],adjustments:[],account_balances:C,category_balances:E,are_allocations_finalized:!1,created_at:g,updated_at:g},A={budget_id:t,year_month_ordinal:Yt(e,n),year:e,month:n,income:[],total_income:0,previous_month_income:_,expenses:[],total_expenses:0,transfers:[],adjustments:[],account_balances:C,category_balances:E,are_allocations_finalized:!1,created_at:g,updated_at:g};await tn("months",v,A,"creating new month document (first time viewing this month)"),Ze.setQueryData(Pe.month(t,e,n),{month:T});const B=Yt(e,n),G={...p.month_map||{},[B]:{needs_recalculation:!1}},k=G;return E6(t,k),await Ql("budgets",t,{month_map:k,updated_at:g},`adding month ${e}/${n} to budget month_map`),T}function T6(t,e,n,r){return{budget_id:e,year_month_ordinal:t.year_month_ordinal??Yt(n,r),year:t.year??n,month:t.month??r,income:t.income||[],total_income:t.total_income??0,previous_month_income:t.previous_month_income??0,expenses:t.expenses||[],total_expenses:t.total_expenses??0,transfers:t.transfers||[],adjustments:t.adjustments||[],account_balances:t.account_balances||[],category_balances:t.category_balances||[],are_allocations_finalized:t.are_allocations_finalized??!1,created_at:t.created_at,updated_at:t.updated_at}}async function A6(t,e,n){const r=li(t,e,n);try{const{exists:s,data:o}=await bt("months",r,`loading month ${e}/${n}`);return!s||!o?null:T6(o,t,e,n)}catch(s){if(s instanceof Error&&s.message.includes("Missing or insufficient permissions"))return console.warn(`[readMonthDirect] Permission error reading month ${e}/${n}, treating as not found`),null;throw s}}async function j6(t,e,n){const r=await A6(t,e,n);return r||C6(t,e,n)}function R6(t,e,n,r){const s=!!t&&r?.enabled!==!1;return ac({queryKey:t?Pe.month(t,e,n):["month","none"],queryFn:async()=>({month:await j6(t,e,n)}),enabled:s})}async function I6(t){const{exists:e,data:n}=await bt("payees",t,"loading payees for autocomplete (cache miss or stale)");return e&&n?n.payees||[]:[]}function z0(t,e){return ac({queryKey:t?Pe.payees(t):["payees","none"],queryFn:()=>I6(t),enabled:!!t&&e?.enabled!==!1})}async function D6(t,e){const{exists:n,data:r}=await bt("users",t,"loading user profile (cache miss or stale)");if(n&&r)return r;const s={uid:t,email:e,budget_ids:[],created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return await tn("users",t,s,"creating new user document (first login)"),s}function k6(t,e,n){return ac({queryKey:t?Pe.user(t):["user","none"],queryFn:()=>D6(t,e),enabled:!!t&&n?.enabled!==!1})}async function O6(t,e){const n=await Ht("budgets","loading budgets user has access to (cache miss or stale)",[{field:"user_ids",op:"array-contains",value:t}]),r=[],s=[];for(const o of n.docs){const l=o.data;l.accepted_user_ids?.includes(t)||e?.budget_ids?.includes(o.id)?r.push({id:o.id,name:l.name||"Unnamed Budget",ownerEmail:l.owner_email||null,isOwner:l.owner_id===t,isPending:!1}):s.push({budgetId:o.id,budgetName:l.name||"Unnamed Budget",ownerEmail:l.owner_email||null})}return{budgets:r,pendingInvites:s}}function M6(t,e,n){return ac({queryKey:t?Pe.accessibleBudgets(t):["accessibleBudgets","none"],queryFn:async()=>t?O6(t,e):{budgets:[],pendingInvites:[]},enabled:!!t&&n?.enabled!==!1,staleTime:60*1e3})}function N6(t){if(Array.isArray(t))return t;if(t&&typeof t=="object"&&!Array.isArray(t)){const e=t;if(e._methodName==="arrayUnion"&&Array.isArray(e.vc))return console.warn("[fetchFeedback] Found corrupted arrayUnion in feedback document - extracting items from vc"),e.vc}return[]}async function P6(){const t=await Ht("feedback","admin loading all feedback (cache miss or stale)"),e=[];for(const n of t.docs){const r=N6(n.data.items),s=n.data.user_email||n.id;r.forEach(o=>{e.push({...o,doc_id:n.id,user_email:s})})}return{items:e}}function z6(t){return ac({queryKey:Pe.feedback(),queryFn:P6,enabled:t?.enabled!==!1})}const Qt="__NO_CATEGORY__",To="No Category";function it(t){return t===Qt}const Vt="__NO_ACCOUNT__",ja="No Account";function Qe(t){return t===Vt}const bT={categoryEndBalances:{},accountEndBalances:{},totalIncome:0};function vT(t,e){const n=t.income||[],r=t.expenses||[],s=Oe(n.reduce((g,v)=>g+v.amount,0)),o=Oe(r.reduce((g,v)=>g+v.amount,0)),l=B6(t),{transfersMap:d,adjustmentsMap:h}=L6(t),m=U6(t.category_balances,e.categoryEndBalances,l,d,h),p=F6(t,e.accountEndBalances);return{...t,total_income:s,total_expenses:o,previous_month_income:e.totalIncome,category_balances:m,account_balances:p,updated_at:new Date().toISOString()}}function B6(t){const e={};for(const n of t.transfers||[])it(n.from_category_id)||(e[n.from_category_id]=(e[n.from_category_id]||0)-n.amount),it(n.to_category_id)||(e[n.to_category_id]=(e[n.to_category_id]||0)+n.amount);for(const n of t.adjustments||[])it(n.category_id)||(e[n.category_id]=(e[n.category_id]||0)+n.amount);for(const n of Object.keys(e))e[n]=Oe(e[n]);return e}function L6(t){const e={},n={};for(const r of t.transfers||[])it(r.from_category_id)||(e[r.from_category_id]=(e[r.from_category_id]||0)-r.amount),it(r.to_category_id)||(e[r.to_category_id]=(e[r.to_category_id]||0)+r.amount);for(const r of t.adjustments||[])it(r.category_id)||(n[r.category_id]=(n[r.category_id]||0)+r.amount);for(const r of Object.keys(e))e[r]=Oe(e[r]);for(const r of Object.keys(n))n[r]=Oe(n[r]);return{transfersMap:e,adjustmentsMap:n}}function U6(t,e,n,r,s){const o=new Map;for(const h of t)it(h.category_id)||o.set(h.category_id,h);const l=new Set;for(const h of t)it(h.category_id)||l.add(h.category_id);for(const h of Object.keys(e))it(h)||l.add(h);for(const h of Object.keys(n))it(h)||l.add(h);const d=[];for(const h of l){const m=o.get(h),p=Oe(e[h]??0),g=Oe(m?.allocated??0),v=Oe(m?.spent??0),_=Oe(r[h]??0),S=Oe(s[h]??0);d.push({category_id:h,start_balance:p,allocated:g,spent:v,transfers:_,adjustments:S,end_balance:Oe(p+g+v+_+S)})}return d}function F6(t,e){const n=new Set;for(const s of t.income||[])Qe(s.account_id)||n.add(s.account_id);for(const s of t.expenses||[])Qe(s.account_id)||n.add(s.account_id);for(const s of t.transfers||[])Qe(s.from_account_id)||n.add(s.from_account_id),Qe(s.to_account_id)||n.add(s.to_account_id);for(const s of t.adjustments||[])Qe(s.account_id)||n.add(s.account_id);for(const s of Object.keys(e))Qe(s)||n.add(s);for(const s of t.account_balances||[])Qe(s.account_id)||n.add(s.account_id);const r=[];for(const s of n){const o=Oe(e[s]??0),l=Oe((t.income||[]).filter(_=>_.account_id===s).reduce((_,S)=>_+S.amount,0)),d=Oe((t.expenses||[]).filter(_=>_.account_id===s).reduce((_,S)=>_+S.amount,0)),h=Oe((t.transfers||[]).filter(_=>_.from_account_id===s).reduce((_,S)=>_-S.amount,0)),m=Oe((t.transfers||[]).filter(_=>_.to_account_id===s).reduce((_,S)=>_+S.amount,0)),p=Oe(m+h),g=Oe((t.adjustments||[]).filter(_=>_.account_id===s).reduce((_,S)=>_+S.amount,0)),v=Oe(l+d+p+g);r.push({account_id:s,start_balance:o,income:l,expenses:d,transfers:p,adjustments:g,net_change:v,end_balance:Oe(o+v)})}return r}function Oy(t){const e={},n={};for(const r of t.category_balances||[])it(r.category_id)||(e[r.category_id]=Oe(r.end_balance));for(const r of t.account_balances||[])Qe(r.account_id)||(n[r.account_id]=Oe(r.end_balance));return{categoryEndBalances:e,accountEndBalances:n,totalIncome:Oe(t.total_income)}}const V6=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function $6(t){return{year:parseInt(t.slice(0,4),10),month:parseInt(t.slice(4,6),10)}}function xT(t={}){const e={};return Object.entries(t).forEach(([n,r])=>{e[n]={needs_recalculation:r?.needs_recalculation??!1}}),e}function wT(t){return Object.entries(t).filter(([,e])=>e.needs_recalculation).map(([e])=>e).sort()}function H6(t){return Object.keys(t).sort()}async function q6(t,e){const{year:n,month:r}=$6(e),s=li(t,n,r),{exists:o,data:l}=await bt("months",s,`[recalc] fetching month ${n}/${r}`);return!o||!l?null:{id:s,budget_id:t,year_month_ordinal:l.year_month_ordinal??Yt(n,r),year:l.year??n,month:l.month??r,income:l.income||[],total_income:l.total_income??0,previous_month_income:l.previous_month_income??0,expenses:l.expenses||[],total_expenses:l.total_expenses??0,transfers:l.transfers||[],adjustments:l.adjustments||[],account_balances:l.account_balances||[],category_balances:l.category_balances||[],are_allocations_finalized:l.are_allocations_finalized??!1,created_at:l.created_at,updated_at:l.updated_at}}async function G6(t,e,n){n?.(0,e.length);const r=await Promise.all(e.map(s=>q6(t,s)));return n?.(e.length,e.length),r.filter(s=>s!==null)}function B0(t){const e={};for(const n of Object.keys(t))e[n]={needs_recalculation:!1};return e}function ST(t,e,n){const r=Object.entries(t).reduce((o,[,l])=>{const d=l.account_group_id?n[l.account_group_id]:void 0,h=d?.on_budget!==void 0?d.on_budget:l.on_budget!==!1,m=d?.is_active!==void 0?d.is_active:l.is_active!==!1;return h&&m?o+(l.balance??0):o},0),s=Object.values(e).reduce((o,l)=>{const d=l.balance??0;return o+(d>0?d:0)},0);return Oe(r-s)}async function ET(t,e,n,r){const{exists:s,data:o}=await bt("budgets",t,"[recalc] reading budget for balance update");if(!s||!o)return;const l={...o.accounts};for(const[p,g]of Object.entries(e))l[p]&&(l[p]={...l[p],balance:Oe(g)});const d={...o.categories};for(const[p,g]of Object.entries(n))d[p]&&(d[p]={...d[p],balance:Oe(g)});const h=B0(r),m=ST(l,d,o.account_groups||{});await tn("budgets",t,{...o,accounts:l,categories:d,total_available:m,is_needs_recalculation:!1,month_map:h,updated_at:new Date().toISOString()},"[recalc] saving balances and clearing flags"),Q6(t,l,d,m,h)}function W6(t,e){const n=Ze.getQueryData(Pe.budget(t));n&&Ze.setQueryData(Pe.budget(t),{...n,isNeedsRecalculation:!1,monthMap:e,budget:{...n.budget,is_needs_recalculation:!1,month_map:e}})}function Q6(t,e,n,r,s){const o=Ze.getQueryData(Pe.budget(t));if(o){const l={};for(const[h,m]of Object.entries(o.accounts)){const p=e[h];l[h]=p?{...m,balance:p.balance??m.balance}:m}const d={};for(const[h,m]of Object.entries(o.categories)){const p=n[h];d[h]=p?{...m,balance:p.balance??m.balance}:m}Ze.setQueryData(Pe.budget(t),{...o,accounts:l,categories:d,isNeedsRecalculation:!1,monthMap:s,budget:{...o.budget,accounts:e,categories:n,total_available:r,is_needs_recalculation:!1,month_map:s}})}}async function AS(t,e){const{exists:n,data:r}=await bt("budgets",t,"[recalc] reading budget to clear flags");if(!n||!r)return;const s=B0(e);await tn("budgets",t,{...r,total_available:ST(r.accounts||{},r.categories||{},r.account_groups||{}),is_needs_recalculation:!1,month_map:s,updated_at:new Date().toISOString()},"[recalc] clearing flags"),W6(t,s)}const Vg=new Map;async function L0(t,e={}){const n=Vg.get(t);if(n)return n;const r=K6(t,e);Vg.set(t,r);try{return await r}finally{Vg.delete(t)}}async function K6(t,e={}){const{onProgress:n}=e;n?.({phase:"reading-budget",monthsProcessed:0,totalMonths:0,percentComplete:5});const{exists:r,data:s}=await bt("budgets",t,"[recalc] reading budget for month_map");if(!r||!s)return n?.({phase:"complete",monthsProcessed:0,totalMonths:0,percentComplete:100}),{monthsRecalculated:0,budgetUpdated:!1};const o=xT(s.month_map),l=wT(o);if(l.length===0&&!s.is_needs_recalculation)return n?.({phase:"complete",monthsProcessed:0,totalMonths:0,percentComplete:100}),{monthsRecalculated:0,budgetUpdated:!1};const d=H6(o),h=l.length>0?l[0]:null;if(!h)return await AS(t,o),n?.({phase:"complete",monthsProcessed:0,totalMonths:0,percentComplete:100}),{monthsRecalculated:0,budgetUpdated:!0};const m=d.indexOf(h),p=m>0,g=p?d.slice(m-1):d.slice(m),v=p?g.length-1:g.length;n?.({phase:"fetching-months",monthsFetched:0,totalMonthsToFetch:g.length,monthsProcessed:0,totalMonths:v,percentComplete:10});const _=await G6(t,g,(k,D)=>{n?.({phase:"fetching-months",monthsFetched:k,totalMonthsToFetch:D,monthsProcessed:0,totalMonths:v,percentComplete:k===0?10:30})});if(_.length===0)return await AS(t,o),n?.({phase:"complete",monthsProcessed:0,totalMonths:0,percentComplete:100}),{monthsRecalculated:0,budgetUpdated:!0};const S=p?1:0,x=_.length-1,E=x-S+1;let C=bT;p&&_.length>0&&(C=Oy(_[0]));const T=[];let A=0;for(let k=S;k<=x;k++){const D=_[k],N=`${V6[D.month-1]} ${D.year}`;n?.({phase:"recalculating",currentMonth:N,monthsProcessed:A,totalMonths:E,percentComplete:Math.round(30+A/E*40)});const F=vT(D,C);T.push(F),C=Oy(F),A++}n?.({phase:"saving",monthsProcessed:A,totalMonths:E,percentComplete:75});const B=T.map(k=>({collectionPath:"months",docId:li(t,k.year,k.month),data:k}));await pm(B,`[recalc] batch write ${T.length} months`);for(const k of T)Ze.setQueryData(Pe.month(t,k.year,k.month),{month:k});n?.({phase:"saving",monthsProcessed:A,totalMonths:E,percentComplete:92});const U=C.accountEndBalances,G=C.categoryEndBalances;return await ET(t,U,G,o),n?.({phase:"complete",monthsProcessed:A,totalMonths:E,percentComplete:100}),{monthsRecalculated:A,budgetUpdated:!0,finalAccountBalances:U}}async function Y6(t,e,n){const r=Yt(e,n);if(w6(t,r))return{markedCount:0,budgetUpdated:!1};const{exists:s,data:o}=await bt("budgets",t,"reading budget for month_map update");if(!s||!o)return console.warn(`[markMonthsNeedRecalculation] Budget ${t} not found`),{markedCount:0,budgetUpdated:!1};const d={...o.month_map||{}},h=x6();for(const v of h)d[v]||(d[v]={needs_recalculation:!1});let m=0;for(const v of h)v>=r&&(d[v]?.needs_recalculation||(d[v]={needs_recalculation:!0},m++));const p=o.is_needs_recalculation===!0;if(m===0&&p)return{markedCount:0,budgetUpdated:!1};const g=d;return S6(t,r,g),await Ql("budgets",t,{is_needs_recalculation:!0,month_map:g,updated_at:new Date().toISOString()},`marking budget and ${m} future months as needing recalculation`),{markedCount:m,budgetUpdated:!0}}async function X6(t,e){return Ze.fetchQuery({queryKey:["budgetInvite",t,e],queryFn:async()=>{const{exists:n,data:r}=await bt("budgets",t,"checking if user has pending invite for budget");return!n||!r?null:{isInvited:r.user_ids?.includes(e)??!1,hasAccepted:r.accepted_user_ids?.includes(e)??!1,budgetName:r.name||"Unnamed Budget",ownerEmail:r.owner_email||null}},staleTime:60*1e3})}async function My(t,e,n){const r=await $r(t,e,n,{description:`fetching month for balance calculation (walking ${e}/${n})`});return r?{year:r.year,month:r.month,category_balances:r.category_balances,are_allocations_finalized:r.are_allocations_finalized,expenses:r.expenses}:null}async function Z6(t,e,n,r){const s={};e.forEach(v=>{s[v]=0});const o=await My(t,n,r);if(o?.category_balances){for(const v of o.category_balances)e.includes(v.category_id)&&(s[v.category_id]=v.end_balance);return s}const l={};e.forEach(v=>{l[v]=0});const d=[];o&&d.push(o);let h=n,m=r,p=!1;const g=120;for(let v=0;v<g&&!p;v++){const _=Of(h,m);h=_.year,m=_.month;const S=await My(t,h,m);if(!S)p=!0;else if(S.category_balances){p=!0;for(const x of S.category_balances)e.includes(x.category_id)&&(l[x.category_id]=x.end_balance)}else d.push(S)}d.reverse(),Object.assign(s,l);for(const v of d){if(v.are_allocations_finalized&&v.category_balances)for(const _ of v.category_balances)e.includes(_.category_id)&&(s[_.category_id]=(s[_.category_id]||0)+_.allocated);if(v.expenses)for(const _ of v.expenses)e.includes(_.category_id)&&(s[_.category_id]=(s[_.category_id]||0)-_.amount)}return s}async function J6(t,e,n,r,s){const o={...n};let l=r,d=s;const h=24;for(let m=0;m<h;m++){const p=g6(l,d);l=p.year,d=p.month;const g=await My(t,l,d);if(!g)break;if(g.are_allocations_finalized&&g.category_balances)for(const v of g.category_balances)e.includes(v.category_id)&&(o[v.category_id]=(o[v.category_id]||0)+v.allocated);if(g.expenses)for(const v of g.expenses)e.includes(v.category_id)&&(o[v.category_id]=(o[v.category_id]||0)-v.amount)}return o}async function jS(t,e,n,r){const s=await Z6(t,e,n,r),o=await J6(t,e,s,n,r);return{current:s,total:o}}async function CT(t,e,n){const r=li(t,e.year,e.month);await tn("months",r,e,`writeMonthData: ${n}`)}async function TT(t,e,n){await Y6(t,e,n)}async function dd(t){const{budgetId:e,month:n,description:r,cascadeRecalculation:s=!0}=t;await CT(e,n,r||`${n.year}/${n.month}`),Ze.setQueryData(Pe.month(e,n.year,n.month),{month:n}),s&&await TT(e,n.year,n.month)}function ci(){const t=ln();return{writeData:$n({mutationFn:async({budgetId:n,month:r,description:s,cascadeRecalculation:o=!0})=>(await CT(n,r,s||`${r.year}/${r.month}`),{budgetId:n,year:r.year,month:r.month,cascadeRecalculation:o}),onMutate:async({budgetId:n,month:r})=>{const s=Pe.month(n,r.year,r.month);await t.cancelQueries({queryKey:s});const o=t.getQueryData(s);return t.setQueryData(s,{month:r}),{oldMonthQueryData:o,monthKey:s}},onSuccess:async({budgetId:n,year:r,month:s,cascadeRecalculation:o})=>{o&&await TT(n,r,s)},onError:(n,r,s)=>{s?.oldMonthQueryData&&t.setQueryData(s.monthKey,s.oldMonthQueryData)}})}}function e3(t,e,n,r){const s={};t.category_balances&&t.category_balances.forEach(h=>{s[h.category_id]=h});const o=t.expenses??[],l={};for(const h of t.transfers||[])it(h.from_category_id)||(l[h.from_category_id]=(l[h.from_category_id]||0)-h.amount),it(h.to_category_id)||(l[h.to_category_id]=(l[h.to_category_id]||0)+h.amount);const d={};for(const h of t.adjustments||[])it(h.category_id)||(d[h.category_id]=(d[h.category_id]||0)+h.amount);return e.map(h=>{const m=s[h],p=Oe(m?.start_balance??0),g=Oe(n[h]??0),v=Oe(o.filter(x=>x.category_id===h).reduce((x,E)=>x+E.amount,0)),_=Oe(l[h]??0),S=Oe(d[h]??0);return{category_id:h,start_balance:p,allocated:g,spent:v,transfers:_,adjustments:S,end_balance:Oe(p+g+v+_+S)}})}function t3(){const{writeData:t}=ci();return{saveDraftAllocations:async(n,r,s,o)=>{const l=await $r(n,r,s);if(!l)throw new Error(`Month not found: ${r}/${s}`);const d=l.category_balances.map(m=>({...m,allocated:o[m.category_id]??m.allocated})),h={...l,category_balances:d,updated_at:new Date().toISOString()};return await t.mutateAsync({budgetId:n,month:h,cascadeRecalculation:!1}),{updatedMonth:h}},isPending:t.isPending,isError:t.isError,error:t.error}}function n3(){const{writeData:t}=ci();return{finalizeAllocations:async n=>{const{budgetId:r,year:s,month:o,allocations:l,onProgress:d}=n;d?.({phase:"saving",message:"Saving allocations..."});const h=await $r(r,s,o);if(!h)throw new Error(`Month not found: ${s}/${o}`);const m=h.category_balances?.map(_=>_.category_id)??[],p=m.length>0?m:Object.keys(l),g=p.length>0?e3(h,p,l):h.category_balances,v={...h,category_balances:g,are_allocations_finalized:!0,updated_at:new Date().toISOString()};return await t.mutateAsync({budgetId:r,month:v,description:"finalize allocations"}),d?.({phase:"recalculating",message:"Recalculating month balances..."}),await L0(r,{triggeringMonthOrdinal:`${s}${String(o).padStart(2,"0")}`,onProgress:_=>{let S="Recalculating balances...";_.phase==="fetching-months"?S=`Loading month data (${_.monthsFetched}/${_.totalMonthsToFetch})...`:_.phase==="recalculating"&&_.currentMonth?S=`Recalculating ${_.currentMonth}...`:_.phase==="saving"&&(S="Saving recalculated balances..."),d?.({phase:"recalculating",message:S,recalcProgress:_})}}),await Ze.refetchQueries({queryKey:Pe.month(r,s,o)}),await Ze.refetchQueries({queryKey:Pe.budget(r)}),d?.({phase:"complete",message:"Allocations applied!"}),{updatedMonth:v}},isPending:t.isPending,isError:t.isError,error:t.error}}function AT(){const{writeData:t}=ci();return{deleteAllocations:async n=>{const{budgetId:r,year:s,month:o,onProgress:l}=n;l?.({phase:"saving",message:"Deleting allocations..."});const d=await $r(r,s,o);if(!d)throw new Error(`Month not found: ${s}/${o}`);const h=d.category_balances.map(p=>({...p,allocated:0,end_balance:p.start_balance-p.spent})),m={...d,category_balances:h,are_allocations_finalized:!1,updated_at:new Date().toISOString()};return await t.mutateAsync({budgetId:r,month:m,description:"delete allocations"}),l?.({phase:"recalculating",message:"Recalculating month balances..."}),await L0(r,{triggeringMonthOrdinal:`${s}${String(o).padStart(2,"0")}`,onProgress:p=>{let g="Recalculating balances...";p.phase==="fetching-months"?g=`Loading month data (${p.monthsFetched}/${p.totalMonthsToFetch})...`:p.phase==="recalculating"&&p.currentMonth?g=`Recalculating ${p.currentMonth}...`:p.phase==="saving"&&(g="Saving recalculated balances..."),l?.({phase:"recalculating",message:g,recalcProgress:p})}}),await Ze.refetchQueries({queryKey:Pe.month(r,s,o)}),await Ze.refetchQueries({queryKey:Pe.budget(r)}),l?.({phase:"complete",message:"Allocations deleted!"}),{updatedMonth:m}},isPending:t.isPending,isError:t.isError,error:t.error}}async function _m(t,e,n){const r=e.trim();if(!r||n.includes(r))return null;const s=[...n,r].sort((o,l)=>o.toLowerCase().localeCompare(l.toLowerCase()));return await tn("payees",t,{budget_id:t,payees:s,updated_at:new Date().toISOString()},`adding new payee "${r}" to autocomplete list`),s}function fr(t){const e=t.income||[],n=t.expenses||[],r=Oe(e.reduce((d,h)=>d+h.amount,0)),s=Oe(n.reduce((d,h)=>d+h.amount,0)),o=r3(t),l=i3(t);return{...t,total_income:r,total_expenses:s,account_balances:o,category_balances:l}}function r3(t){const e=t.income||[],n=t.expenses||[],r=t.transfers||[],s=t.adjustments||[],o=t.account_balances||[],l=new Map;for(const m of o)Qe(m.account_id)||l.set(m.account_id,m);const d=new Set;for(const m of e)Qe(m.account_id)||d.add(m.account_id);for(const m of n)Qe(m.account_id)||d.add(m.account_id);for(const m of r)Qe(m.from_account_id)||d.add(m.from_account_id),Qe(m.to_account_id)||d.add(m.to_account_id);for(const m of s)Qe(m.account_id)||d.add(m.account_id);for(const m of o)Qe(m.account_id)||d.add(m.account_id);const h=[];for(const m of d){const p=l.get(m),g=Oe(p?.start_balance??0),v=Oe(e.filter(A=>A.account_id===m).reduce((A,B)=>A+B.amount,0)),_=Oe(n.filter(A=>A.account_id===m).reduce((A,B)=>A+B.amount,0)),S=Oe(r.filter(A=>A.from_account_id===m).reduce((A,B)=>A-B.amount,0)),x=Oe(r.filter(A=>A.to_account_id===m).reduce((A,B)=>A+B.amount,0)),E=Oe(x+S),C=Oe(s.filter(A=>A.account_id===m).reduce((A,B)=>A+B.amount,0)),T=Oe(v+_+E+C);h.push({account_id:m,start_balance:g,income:v,expenses:_,transfers:E,adjustments:C,net_change:T,end_balance:Oe(g+T)})}return h}function i3(t){const e=t.expenses||[],n=t.transfers||[],r=t.adjustments||[],s=t.category_balances||[],o=new Map;for(const g of s)it(g.category_id)||o.set(g.category_id,g);const l=new Map;for(const g of e){if(it(g.category_id))continue;const v=l.get(g.category_id)||0;l.set(g.category_id,v+g.amount)}const d=new Map;for(const g of n){if(!it(g.from_category_id)){const v=d.get(g.from_category_id)||0;d.set(g.from_category_id,v-g.amount)}if(!it(g.to_category_id)){const v=d.get(g.to_category_id)||0;d.set(g.to_category_id,v+g.amount)}}const h=new Map;for(const g of r)if(!it(g.category_id)){const v=h.get(g.category_id)||0;h.set(g.category_id,v+g.amount)}const m=new Set;for(const g of s)it(g.category_id)||m.add(g.category_id);for(const g of e)it(g.category_id)||m.add(g.category_id);for(const g of n)it(g.from_category_id)||m.add(g.from_category_id),it(g.to_category_id)||m.add(g.to_category_id);for(const g of r)it(g.category_id)||m.add(g.category_id);const p=[];for(const g of m){const v=o.get(g),_=Oe(l.get(g)??0),S=Oe(d.get(g)??0),x=Oe(h.get(g)??0);if(v){const E=Oe(v.start_balance),C=Oe(v.allocated);p.push({category_id:g,start_balance:E,allocated:C,spent:_,transfers:S,adjustments:x,end_balance:Oe(E+C+_+S+x)})}else p.push({category_id:g,start_balance:0,allocated:0,spent:_,transfers:S,adjustments:x,end_balance:Oe(_+S+x)})}return p}function s3(t,e){let n=0;for(const{accountId:r,delta:s}of e){const o=t.accounts[r];if(!o)continue;const l=o.account_group_id?t.accountGroups[o.account_group_id]:void 0,d=l?.on_budget!==void 0?l.on_budget:o.on_budget!==!1,h=l?.is_active!==void 0?l.is_active:o.is_active!==!1;d&&h&&(n+=s)}return n}async function tr(t,e){if(e.length===0)return;const n=e.filter(d=>d.delta!==0);if(n.length===0)return;const r=Ze.getQueryData(Pe.budget(t));if(!r)return;const s=s3(r,n),o={...r.accounts};for(const{accountId:d,delta:h}of n)o[d]&&(o[d]={...o[d],balance:o[d].balance+h});const l=r.budget?{...r.budget,total_available:r.budget.total_available+s}:r.budget;Ze.setQueryData(Pe.budget(t),{...r,accounts:o,budget:l})}function a3(t,e){const n={id:e,amount:t.amount,account_id:t.accountId,date:t.date,created_at:new Date().toISOString()};return t.payee?.trim()&&(n.payee=t.payee.trim()),t.description&&(n.description=t.description),n}function o3(){const t=ln(),e=$n({onMutate:async r=>{const{budgetId:s,year:o,month:l}=r,d=Pe.month(s,o,l);await t.cancelQueries({queryKey:d});const h=t.getQueryData(d),m=`income_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,p=a3(r,m);if(h?.month){const g=fr({...h.month,income:[...h.month.income||[],p],updated_at:new Date().toISOString()});t.setQueryData(d,{month:g})}return{previousData:h,incomeId:m,newIncome:p}},mutationFn:async r=>{const{budgetId:s,year:o,month:l,accountId:d,payee:h,amount:m}=r,p=Pe.month(s,o,l),g=t.getQueryData(p);if(!g?.month)throw new Error("No month data in cache after optimistic update");const v=g.month;if(await dd({budgetId:s,month:v,description:"add income"}),await tr(s,[{accountId:d,delta:m}]),h?.trim()){const S=t.getQueryData(Pe.payees(s))||[],x=await _m(s,h,S);x&&t.setQueryData(Pe.payees(s),x)}const _=v.income?.[v.income.length-1];if(!_)throw new Error("Could not find new income in updated month");return{updatedMonth:v,newIncome:_}},onError:(r,s,o)=>{if(o?.previousData){const{budgetId:l,year:d,month:h}=s;t.setQueryData(Pe.month(l,d,h),o.previousData)}}});return{addIncome:async(r,s,o,l,d,h,m,p)=>e.mutateAsync({budgetId:r,year:s,month:o,amount:l,accountId:d,date:h,payee:m,description:p}),isPending:e.isPending,isError:e.isError,error:e.error}}function l3(t,e,n,r,s,o){if(!t)return!0;const l=t.payee||void 0,d=s?.trim()||void 0,h=t.description||void 0,m=o||void 0;return e!==t.amount||n!==t.account_id||r!==t.date||d!==l||m!==h}function c3(){const t=ln(),{writeData:e}=ci();return{updateIncome:async(r,s,o,l,d,h,m,p,g)=>{const v=await $r(r,s,o);if(!v)throw new Error(`Month not found: ${s}/${o}`);const _=(v.income||[]).find(A=>A.id===l);if(!l3(_,d,h,m,p,g))return{updatedMonth:v,noOp:!0};const S=_?.amount??0,x=_?.account_id??h,E={id:l,amount:d,account_id:h,date:m,created_at:(v.income||[]).find(A=>A.id===l)?.created_at||new Date().toISOString()};p?.trim()&&(E.payee=p.trim()),g&&(E.description=g);const C=(v.income||[]).map(A=>A.id===l?E:A),T=fr({...v,income:C,updated_at:new Date().toISOString()});if(await e.mutateAsync({budgetId:r,month:T,description:"update income"}),x===h?await tr(r,[{accountId:h,delta:d-S}]):await tr(r,[{accountId:x,delta:-S},{accountId:h,delta:d}]),p?.trim()){const A=t.getQueryData(Pe.payees(r))||[],B=await _m(r,p,A);B&&t.setQueryData(Pe.payees(r),B)}return{updatedMonth:T}},isPending:e.isPending,isError:e.isError,error:e.error}}function u3(){const{writeData:t}=ci();return{deleteIncome:async(n,r,s,o)=>{const l=await $r(n,r,s);if(!l)throw new Error(`Month not found: ${r}/${s}`);const d=(l.income||[]).find(v=>v.id===o),h=d?.amount??0,m=d?.account_id,p=(l.income||[]).filter(v=>v.id!==o),g=fr({...l,income:p,updated_at:new Date().toISOString()});return await t.mutateAsync({budgetId:n,month:g,description:"delete income"}),m&&h>0&&await tr(n,[{accountId:m,delta:-h}]),{updatedMonth:g}},isPending:t.isPending,isError:t.isError,error:t.error}}function d3(t,e){const n={id:e,amount:t.amount,category_id:t.categoryId,account_id:t.accountId,date:t.date,created_at:new Date().toISOString()};return t.payee?.trim()&&(n.payee=t.payee.trim()),t.description&&(n.description=t.description),t.cleared!==void 0&&(n.cleared=t.cleared),n}function h3(){const t=ln(),e=$n({onMutate:async r=>{const{budgetId:s,year:o,month:l}=r,d=Pe.month(s,o,l);await t.cancelQueries({queryKey:d});const h=t.getQueryData(d),m=`expense_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,p=d3(r,m);if(h?.month){const g=fr({...h.month,expenses:[...h.month.expenses||[],p],updated_at:new Date().toISOString()});t.setQueryData(d,{month:g})}return{previousData:h,expenseId:m,newExpense:p}},mutationFn:async r=>{const{budgetId:s,year:o,month:l,accountId:d,payee:h,amount:m}=r,p=Pe.month(s,o,l),g=t.getQueryData(p);if(!g?.month)throw new Error("No month data in cache after optimistic update");const v=g.month;if(await dd({budgetId:s,month:v,description:"add expense"}),await tr(s,[{accountId:d,delta:m}]),h?.trim()){const S=t.getQueryData(Pe.payees(s))||[],x=await _m(s,h,S);x&&t.setQueryData(Pe.payees(s),x)}const _=v.expenses?.[v.expenses.length-1];if(!_)throw new Error("Could not find new expense in updated month");return{updatedMonth:v,newExpense:_}},onError:(r,s,o)=>{if(o?.previousData){const{budgetId:l,year:d,month:h}=s;t.setQueryData(Pe.month(l,d,h),o.previousData)}}});return{addExpense:async(r,s,o,l,d,h,m,p,g,v)=>e.mutateAsync({budgetId:r,year:s,month:o,amount:l,categoryId:d,accountId:h,date:m,payee:p,description:g,cleared:v}),isPending:e.isPending,isError:e.isError,error:e.error}}function f3(t,e,n,r,s,o,l,d){if(!t)return!0;const h=t.payee||void 0,m=o?.trim()||void 0,p=t.description||void 0,g=l||void 0;return e!==t.amount||n!==t.category_id||r!==t.account_id||s!==t.date||m!==h||g!==p||d!==t.cleared}function m3(){const t=ln(),{writeData:e}=ci();return{updateExpense:async(r,s,o,l,d,h,m,p,g,v,_)=>{const S=await $r(r,s,o);if(!S)throw new Error(`Month not found: ${s}/${o}`);const x=(S.expenses||[]).find(U=>U.id===l);if(!f3(x,d,h,m,p,g,v,_))return{updatedMonth:S,noOp:!0};const E=x?.amount??0,C=x?.account_id??m,T={id:l,amount:d,category_id:h,account_id:m,date:p,created_at:S.expenses?.find(U=>U.id===l)?.created_at||new Date().toISOString()};g?.trim()&&(T.payee=g.trim()),v&&(T.description=v),_!==void 0&&(T.cleared=_);const A=(S.expenses||[]).map(U=>U.id===l?T:U),B=fr({...S,expenses:A,updated_at:new Date().toISOString()});if(await e.mutateAsync({budgetId:r,month:B,description:"update expense"}),C===m?await tr(r,[{accountId:m,delta:d-E}]):await tr(r,[{accountId:C,delta:-E},{accountId:m,delta:d}]),g?.trim()){const U=t.getQueryData(Pe.payees(r))||[],G=await _m(r,g,U);G&&t.setQueryData(Pe.payees(r),G)}return{updatedMonth:B}},isPending:e.isPending,isError:e.isError,error:e.error}}function p3(){const{writeData:t}=ci();return{deleteExpense:async(n,r,s,o)=>{const l=await $r(n,r,s);if(!l)throw new Error(`Month not found: ${r}/${s}`);const d=(l.expenses||[]).find(v=>v.id===o),h=d?.amount??0,m=d?.account_id,p=(l.expenses||[]).filter(v=>v.id!==o),g=fr({...l,expenses:p,updated_at:new Date().toISOString()});return await t.mutateAsync({budgetId:n,month:g,description:"delete expense"}),m&&h!==0&&await tr(n,[{accountId:m,delta:-h}]),{updatedMonth:g}},isPending:t.isPending,isError:t.isError,error:t.error}}function g3(t,e){const n={id:e,amount:t.amount,from_account_id:t.fromAccountId,to_account_id:t.toAccountId,from_category_id:t.fromCategoryId,to_category_id:t.toCategoryId,date:t.date,created_at:new Date().toISOString()};return t.description&&(n.description=t.description),t.cleared!==void 0&&(n.cleared=t.cleared),n}function y3(){const t=ln(),e=$n({onMutate:async r=>{const{budgetId:s,year:o,month:l}=r,d=Pe.month(s,o,l);await t.cancelQueries({queryKey:d});const h=t.getQueryData(d),m=`transfer_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,p=g3(r,m);if(h?.month){const g=fr({...h.month,transfers:[...h.month.transfers||[],p],updated_at:new Date().toISOString()});t.setQueryData(d,{month:g})}return{previousData:h,transferId:m,newTransfer:p}},mutationFn:async r=>{const{budgetId:s,year:o,month:l,fromAccountId:d,toAccountId:h,amount:m}=r,p=Pe.month(s,o,l),g=t.getQueryData(p);if(!g?.month)throw new Error("No month data in cache after optimistic update");const v=g.month;await dd({budgetId:s,month:v,description:"add transfer"});const _=[];Qe(d)||_.push({accountId:d,delta:-m}),Qe(h)||_.push({accountId:h,delta:m}),_.length>0&&await tr(s,_);const S=v.transfers?.[v.transfers.length-1];if(!S)throw new Error("Could not find new transfer in updated month");return{updatedMonth:v,newTransfer:S}},onError:(r,s,o)=>{if(o?.previousData){const{budgetId:l,year:d,month:h}=s;t.setQueryData(Pe.month(l,d,h),o.previousData)}}});return{addTransfer:async(r,s,o,l,d,h,m,p,g,v,_)=>e.mutateAsync({budgetId:r,year:s,month:o,amount:l,fromAccountId:d,toAccountId:h,fromCategoryId:m,toCategoryId:p,date:g,description:v,cleared:_}),isPending:e.isPending,isError:e.isError,error:e.error}}function _3(t,e,n,r,s,o,l,d,h){if(!t)return!0;const m=t.description||void 0,p=d||void 0;return e!==t.amount||n!==t.from_account_id||r!==t.to_account_id||s!==t.from_category_id||o!==t.to_category_id||l!==t.date||p!==m||h!==t.cleared}function b3(){const{writeData:t}=ci();return{updateTransfer:async(n,r,s,o,l,d,h,m,p,g,v,_)=>{const S=await $r(n,r,s);if(!S)throw new Error(`Month not found: ${r}/${s}`);const x=(S.transfers||[]).find(k=>k.id===o);if(!_3(x,l,d,h,m,p,g,v,_))return{updatedMonth:S,noOp:!0};const E=x?.amount??0,C=x?.from_account_id??d,T=x?.to_account_id??h,A={id:o,amount:l,from_account_id:d,to_account_id:h,from_category_id:m,to_category_id:p,date:g,created_at:S.transfers?.find(k=>k.id===o)?.created_at||new Date().toISOString()};v&&(A.description=v),_!==void 0&&(A.cleared=_);const B=(S.transfers||[]).map(k=>k.id===o?A:k),U=fr({...S,transfers:B,updated_at:new Date().toISOString()});await t.mutateAsync({budgetId:n,month:U,description:"update transfer"});const G=[];return Qe(C)||G.push({accountId:C,delta:E}),Qe(T)||G.push({accountId:T,delta:-E}),Qe(d)||G.push({accountId:d,delta:-l}),Qe(h)||G.push({accountId:h,delta:l}),G.length>0&&await tr(n,G),{updatedMonth:U}},isPending:t.isPending,isError:t.isError,error:t.error}}function v3(){const{writeData:t}=ci();return{deleteTransfer:async(n,r,s,o)=>{const l=await $r(n,r,s);if(!l)throw new Error(`Month not found: ${r}/${s}`);const d=(l.transfers||[]).find(S=>S.id===o),h=d?.amount??0,m=d?.from_account_id,p=d?.to_account_id,g=(l.transfers||[]).filter(S=>S.id!==o),v=fr({...l,transfers:g,updated_at:new Date().toISOString()});await t.mutateAsync({budgetId:n,month:v,description:"delete transfer"});const _=[];return m&&!Qe(m)&&h!==0&&_.push({accountId:m,delta:h}),p&&!Qe(p)&&h!==0&&_.push({accountId:p,delta:-h}),_.length>0&&await tr(n,_),{updatedMonth:v}},isPending:t.isPending,isError:t.isError,error:t.error}}function x3(t,e){const n={id:e,amount:t.amount,account_id:t.accountId,category_id:t.categoryId,date:t.date,created_at:new Date().toISOString()};return t.payee?.trim()&&(n.payee=t.payee.trim()),t.description&&(n.description=t.description),t.cleared!==void 0&&(n.cleared=t.cleared),n}function w3(){const t=ln(),e=$n({onMutate:async r=>{const{budgetId:s,year:o,month:l}=r,d=Pe.month(s,o,l);await t.cancelQueries({queryKey:d});const h=t.getQueryData(d),m=`adjustment_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,p=x3(r,m);if(h?.month){const g=fr({...h.month,adjustments:[...h.month.adjustments||[],p],updated_at:new Date().toISOString()});t.setQueryData(d,{month:g})}return{previousData:h,adjustmentId:m,newAdjustment:p}},mutationFn:async r=>{const{budgetId:s,year:o,month:l,accountId:d,amount:h}=r,m=Pe.month(s,o,l),p=t.getQueryData(m);if(!p?.month)throw new Error("No month data in cache after optimistic update");const g=p.month;await dd({budgetId:s,month:g,description:"add adjustment"}),Qe(d)||await tr(s,[{accountId:d,delta:h}]);const v=g.adjustments?.[g.adjustments.length-1];if(!v)throw new Error("Could not find new adjustment in updated month");return{updatedMonth:g,newAdjustment:v}},onError:(r,s,o)=>{if(o?.previousData){const{budgetId:l,year:d,month:h}=s;t.setQueryData(Pe.month(l,d,h),o.previousData)}}});return{addAdjustment:async(r,s,o,l,d,h,m,p,g,v)=>e.mutateAsync({budgetId:r,year:s,month:o,amount:l,accountId:d,categoryId:h,date:m,payee:p,description:g,cleared:v}),isPending:e.isPending,isError:e.isError,error:e.error}}function S3(t,e,n,r,s,o,l,d){if(!t)return!0;const h=t.payee||void 0,m=o?.trim()||void 0,p=t.description||void 0,g=l||void 0;return e!==t.amount||n!==t.account_id||r!==t.category_id||s!==t.date||m!==h||g!==p||d!==t.cleared}function E3(){const{writeData:t}=ci();return{updateAdjustment:async(n,r,s,o,l,d,h,m,p,g,v)=>{const _=await $r(n,r,s);if(!_)throw new Error(`Month not found: ${r}/${s}`);const S=(_.adjustments||[]).find(B=>B.id===o);if(!S3(S,l,d,h,m,p,g,v))return{updatedMonth:_,noOp:!0};const x=S?.amount??0,E=S?.account_id??d,C={id:o,amount:l,account_id:d,category_id:h,date:m,created_at:_.adjustments?.find(B=>B.id===o)?.created_at||new Date().toISOString()};p?.trim()&&(C.payee=p.trim()),g&&(C.description=g),v!==void 0&&(C.cleared=v);const T=(_.adjustments||[]).map(B=>B.id===o?C:B),A=fr({..._,adjustments:T,updated_at:new Date().toISOString()});if(await t.mutateAsync({budgetId:n,month:A,description:"update adjustment"}),!Qe(E)&&E===d)await tr(n,[{accountId:d,delta:l-x}]);else{const B=[];Qe(E)||B.push({accountId:E,delta:-x}),Qe(d)||B.push({accountId:d,delta:l}),B.length>0&&await tr(n,B)}return{updatedMonth:A}},isPending:t.isPending,isError:t.isError,error:t.error}}function C3(){const{writeData:t}=ci();return{deleteAdjustment:async(n,r,s,o)=>{const l=await $r(n,r,s);if(!l)throw new Error(`Month not found: ${r}/${s}`);const d=(l.adjustments||[]).find(v=>v.id===o),h=d?.amount??0,m=d?.account_id,p=(l.adjustments||[]).filter(v=>v.id!==o),g=fr({...l,adjustments:p,updated_at:new Date().toISOString()});return await t.mutateAsync({budgetId:n,month:g,description:"delete adjustment"}),m&&!Qe(m)&&h!==0&&await tr(n,[{accountId:m,delta:-h}]),{updatedMonth:g}},isPending:t.isPending,isError:t.isError,error:t.error}}const T3={currentUserId:null,selectedBudgetId:null,currentYear:new Date().getFullYear(),currentMonthNumber:new Date().getMonth()+1,lastActiveTab:"categories",lastSettingsTab:"categories",lastAdminTab:"budget",setSelectedBudgetId:()=>{},setCurrentYear:()=>{},setCurrentMonthNumber:()=>{},setLastActiveTab:()=>{},setLastSettingsTab:()=>{},setLastAdminTab:()=>{},pageTitle:"Budget",setPageTitle:()=>{},isInitialized:!1,needsFirstBudget:!1,goToPreviousMonth:()=>{},goToNextMonth:()=>{},pendingInvites:[],hasPendingInvites:!1,accessibleBudgets:[],isAdmin:!1,isTest:!1,loadAccessibleBudgets:async()=>{},switchToBudget:()=>{},checkBudgetInvite:async()=>null,clearCache:()=>{}},jT=O.createContext(T3);function A3({children:t}){const n=Da().get_current_firebase_user(),[r,s]=O.useState(null),[o,l]=O.useState(new Date().getFullYear()),[d,h]=O.useState(new Date().getMonth()+1),[m,p]=O.useState("categories"),[g,v]=O.useState("categories"),[_,S]=O.useState("budget"),[x,E]=O.useState("Budget"),C=O.useCallback(P=>{E($=>$===P?$:P)},[]),[T,A]=O.useState(!1),[B,U]=O.useState(!1),G=k6(n?.uid||null,n?.email||null),k=G.data&&G.data.budget_ids.length===0,D=M6(n?.uid||null,G.data||null,{enabled:!!n?.uid&&!!G.data&&k}),N=G.data?.permission_flags?.is_admin===!0,F=G.data?.permission_flags?.is_test===!0,H=D.data?.pendingInvites||[],j=D.data?.budgets||[],M=H.length>0;O.useEffect(()=>{if(!n||T||G.isLoading)return;const P=G.data;if(!(!P&&!G.isError))if(P&&P.budget_ids.length>0)s(P.budget_ids[0]),U(!1),A(!0);else{if(D.isLoading)return;const $=D.data;$?.pendingInvites&&$.pendingInvites.length>0?U(!1):U(!0),A(!0)}},[n,T,G.data,G.isLoading,G.isError,D.data,D.isLoading]);const R=O.useCallback(()=>{d===1?(l(P=>P-1),h(12)):h(P=>P-1)},[d]),K=O.useCallback(()=>{d===12?(l(P=>P+1),h(1)):h(P=>P+1)},[d]),W=O.useCallback(async P=>{(P?.force||!D.data)&&await D.refetch()},[D]),q=O.useCallback(P=>{s(P),U(!1)},[]),J=O.useCallback(async P=>{if(!n)return null;try{const $=await X6(P,n.uid);return $&&$.isInvited&&!$.hasAccepted?{budgetId:P,budgetName:$.budgetName,ownerEmail:$.ownerEmail}:null}catch($){return console.error("[BudgetContext] Error checking budget invite:",$),null}},[n]),Z=O.useCallback(()=>{localStorage.removeItem("BUDGET_APP_QUERY_CACHE")},[]),re={currentUserId:n?.uid||null,selectedBudgetId:r,currentYear:o,currentMonthNumber:d,lastActiveTab:m,lastSettingsTab:g,lastAdminTab:_,setSelectedBudgetId:s,setCurrentYear:l,setCurrentMonthNumber:h,setLastActiveTab:p,setLastSettingsTab:v,setLastAdminTab:S,pageTitle:x,setPageTitle:C,isInitialized:T,needsFirstBudget:B,goToPreviousMonth:R,goToNextMonth:K,pendingInvites:H,hasPendingInvites:M,accessibleBudgets:j,isAdmin:N,isTest:F,loadAccessibleBudgets:W,switchToBudget:q,checkBudgetInvite:J,clearCache:Z};return u.jsx(jT.Provider,{value:re,children:t})}function zt(){const t=O.useContext(jT);if(!t)throw new Error("useBudget must be used within a BudgetProvider");return t}const j3=function(){},R3={is_logged_in:!1,is_auth_checked:!1,username:"",set_user_context:j3},hd=O.createContext(R3);function qi(t=v6){const[e,n]=O.useState(()=>typeof window>"u"?!1:window.innerWidth<t);return O.useEffect(()=>{const r=window.matchMedia(`(max-width: ${t-1}px)`);function s(l){n(l.matches)}s(r),r.addEventListener("change",s);function o(){n(window.innerWidth<t)}return window.addEventListener("resize",o),()=>{r.removeEventListener("change",s),window.removeEventListener("resize",o)}},[t]),e}function RT(){const[t,e]=O.useState(()=>typeof window>"u"?1200:window.innerWidth);return O.useEffect(()=>{function n(){e(window.innerWidth)}return window.addEventListener("resize",n),n(),()=>window.removeEventListener("resize",n)},[]),{width:t,isWide:t>=po.wide,isMedium:t>=po.tablet&&t<po.wide,isNarrowMedium:t>=po.mobile&&t<po.tablet,isMobile:t<po.mobile}}function An(){const{selectedBudgetId:t,currentUserId:e}=zt(),n=p6(t),r=n.data,s=r?.budget||null,o=O.useMemo(()=>r?.accounts||{},[r?.accounts]),l=O.useMemo(()=>r?.accountGroups||{},[r?.accountGroups]),d=O.useMemo(()=>r?.categories||{},[r?.categories]),h=O.useMemo(()=>r?.categoryGroups||[],[r?.categoryGroups]),m=s?.owner_id===e,p=O.useMemo(()=>s?.user_ids||[],[s?.user_ids]),g=O.useMemo(()=>s?.accepted_user_ids||[],[s?.accepted_user_ids]),v=s?.total_available??0,_=O.useMemo(()=>r?.monthMap||{},[r?.monthMap]),S=O.useCallback(B=>{if(!t)return;const U=Ze.getQueryData(Pe.budget(t));U&&Ze.setQueryData(Pe.budget(t),{...U,accounts:B})},[t]),x=O.useCallback(B=>{if(!t)return;const U=Ze.getQueryData(Pe.budget(t));U&&Ze.setQueryData(Pe.budget(t),{...U,accountGroups:B})},[t]),E=O.useCallback(B=>{if(!t)return;const U=Ze.getQueryData(Pe.budget(t));U&&Ze.setQueryData(Pe.budget(t),{...U,categories:B})},[t]),C=O.useCallback(B=>{if(!t)return;const U=Ze.getQueryData(Pe.budget(t));U&&Ze.setQueryData(Pe.budget(t),{...U,categoryGroups:B})},[t]),T=O.useCallback(async()=>{t&&await Ze.invalidateQueries({queryKey:Pe.budget(t)})},[t]),A=O.useCallback(()=>Object.entries(o).filter(([,B])=>{const U=B.account_group_id?l[B.account_group_id]:void 0,G=U?.on_budget!==void 0?U.on_budget:B.on_budget!==!1,k=U?.is_active!==void 0?U.is_active:B.is_active!==!1;return G&&k}).reduce((B,[,U])=>B+U.balance,0),[o,l]);return{isLoading:n.isLoading,isFetching:n.isFetching,error:n.error,budget:s,accounts:o,accountGroups:l,categories:d,categoryGroups:h,isOwner:m,budgetUserIds:p,acceptedUserIds:g,totalAvailable:v,monthMap:_,setAccountsOptimistic:S,setAccountGroupsOptimistic:x,setCategoriesOptimistic:E,setCategoryGroupsOptimistic:C,refreshBudget:T,getOnBudgetTotal:A}}function As(t,e,n){const{addLoadingHold:r,removeLoadingHold:s}=nr(),o=R6(t,e,n,{enabled:!!t});O.useEffect(()=>(o.isLoading?r("month-query","Loading month data..."):s("month-query"),()=>s("month-query")),[o.isLoading,r,s]);const l=o.data?.month||null,d=O.useMemo(()=>l?.income||[],[l?.income]),h=O.useMemo(()=>l?.expenses||[],[l?.expenses]),m=O.useMemo(()=>l?.transfers||[],[l?.transfers]),p=O.useMemo(()=>l?.adjustments||[],[l?.adjustments]),g=O.useMemo(()=>l?.category_balances||[],[l?.category_balances]),v=O.useMemo(()=>l?.account_balances||[],[l?.account_balances]),_=l?.total_income||0,S=l?.total_expenses||0,x=l?.are_allocations_finalized||!1,E=l?.previous_month_income??0;return{isLoading:o.isLoading,isFetching:o.isFetching,error:o.error,month:l,income:d,expenses:h,transfers:m,adjustments:p,categoryBalances:g,accountBalances:v,totalIncome:_,totalExpenses:S,areAllocationsFinalized:x,previousMonthIncome:E}}async function Mo(t){const{budgetId:e,updates:n,description:r}=t,s={...n,updated_at:new Date().toISOString()};await tn("budgets",e,s,r,{merge:!0});const o=Ze.getQueryData(Pe.budget(e));o&&Ze.setQueryData(Pe.budget(e),{...o,budget:{...o.budget,...n}})}function IT(){const t=ln(),e=$n({onMutate:async r=>{const{budgetId:s,accounts:o}=r,l=Pe.budget(s);await t.cancelQueries({queryKey:l});const d=t.getQueryData(l);return d&&t.setQueryData(l,{...d,accounts:o}),{previousData:d}},mutationFn:async r=>{const{budgetId:s,accounts:o}=r;return await Mo({budgetId:s,updates:{accounts:o},description:"saving updated accounts (user edited account settings)"}),{accounts:o}},onError:(r,s,o)=>{o?.previousData&&t.setQueryData(Pe.budget(s.budgetId),o.previousData)}});return{updateAccounts:{mutate:r=>e.mutate(r),mutateAsync:r=>e.mutateAsync(r),isPending:e.isPending,isError:e.isError,error:e.error,reset:e.reset}}}function I3(t){const e={};return Object.entries(t).forEach(([n,r])=>{e[n]={name:r.name,sort_order:r.sort_order},r.expected_balance!==void 0&&(e[n].expected_balance=r.expected_balance),r.on_budget!==void 0&&(e[n].on_budget=r.on_budget),r.is_active!==void 0&&(e[n].is_active=r.is_active)}),e}function D3(){const t=ln(),e=$n({onMutate:async r=>{const{budgetId:s,accountGroups:o}=r,l=Pe.budget(s);await t.cancelQueries({queryKey:l});const d=t.getQueryData(l);return d&&t.setQueryData(l,{...d,accountGroups:o}),{previousData:d}},mutationFn:async r=>{const{budgetId:s,accountGroups:o}=r,l=I3(o);return await Mo({budgetId:s,updates:{account_groups:l},description:"saving updated account groups (user edited group settings)"}),{accountGroups:o}},onError:(r,s,o)=>{o?.previousData&&t.setQueryData(Pe.budget(s.budgetId),o.previousData)}});return{updateAccountGroups:{mutate:r=>e.mutate(r),mutateAsync:r=>e.mutateAsync(r),isPending:e.isPending,isError:e.isError,error:e.error,reset:e.reset}}}function k3(t){const e={};return Object.entries(t).forEach(([n,r])=>{e[n]={name:r.name,category_group_id:r.category_group_id??null,sort_order:r.sort_order,balance:r.balance??0},r.description!==void 0&&(e[n].description=r.description),r.default_monthly_amount!==void 0&&(e[n].default_monthly_amount=r.default_monthly_amount),r.default_monthly_type!==void 0&&(e[n].default_monthly_type=r.default_monthly_type),r.is_hidden!==void 0&&(e[n].is_hidden=r.is_hidden)}),e}function DT(){const t=ln(),e=$n({onMutate:async r=>{const{budgetId:s,categories:o}=r,l=Pe.budget(s);await t.cancelQueries({queryKey:l});const d=t.getQueryData(l);return d&&t.setQueryData(l,{...d,categories:o}),{previousData:d}},mutationFn:async r=>{const{budgetId:s,categories:o}=r,l=k3(o);return await Mo({budgetId:s,updates:{categories:l},description:"saving updated categories (user edited category settings)"}),{categories:o}},onError:(r,s,o)=>{o?.previousData&&t.setQueryData(Pe.budget(s.budgetId),o.previousData)}});return{updateCategories:{mutate:r=>e.mutate(r),mutateAsync:r=>e.mutateAsync(r),isPending:e.isPending,isError:e.isError,error:e.error,reset:e.reset}}}function O3(){const t=ln(),e=$n({onMutate:async r=>{const{budgetId:s,categoryGroups:o}=r,l=Pe.budget(s);await t.cancelQueries({queryKey:l});const d=t.getQueryData(l);return d&&t.setQueryData(l,{...d,categoryGroups:o}),{previousData:d}},mutationFn:async r=>{const{budgetId:s,categoryGroups:o}=r;return await Mo({budgetId:s,updates:{category_groups:o},description:"saving updated category groups (user edited group settings)"}),{categoryGroups:o}},onError:(r,s,o)=>{o?.previousData&&t.setQueryData(Pe.budget(s.budgetId),o.previousData)}});return{updateCategoryGroups:{mutate:r=>e.mutate(r),mutateAsync:r=>e.mutateAsync(r),isPending:e.isPending,isError:e.isError,error:e.error,reset:e.reset}}}function M3(){const t=ln(),e=$n({onMutate:async r=>{const{budgetId:s,newName:o}=r,l=Pe.budget(s);await t.cancelQueries({queryKey:l});const d=t.getQueryData(l);return d&&t.setQueryData(l,{...d,budget:{...d.budget,name:o.trim()}}),{previousData:d}},mutationFn:async r=>{const{budgetId:s,newName:o}=r,l=o.trim();return await Mo({budgetId:s,updates:{name:l},description:`renaming budget to "${l}"`}),{newName:l}},onError:(r,s,o)=>{o?.previousData&&t.setQueryData(Pe.budget(s.budgetId),o.previousData)}});return{renameBudget:{mutate:r=>e.mutate(r),mutateAsync:r=>e.mutateAsync(r),isPending:e.isPending,isError:e.isError,error:e.error,reset:e.reset}}}function N3({currentBudget:t,accounts:e,accountGroups:n,setAccountsOptimistic:r,setAccountGroupsOptimistic:s,saveAccounts:o,saveAccountGroups:l,setError:d}){const h=O.useCallback(async(p,g,v)=>{const _=e[p];if(!_)return;const S=v==="ungrouped"?null:v,x=Object.entries(e).filter(([,T])=>(T.account_group_id||"ungrouped")===v),E={};Object.entries(e).forEach(([T,A])=>{T!==p&&(E[T]={...A})});let C;if(g==="__group_end__"||x.length===0||!x.find(([T])=>T===g))C=(x.length>0?Math.max(...x.filter(([A])=>A!==p).map(([,A])=>A.sort_order)):-1)+1;else{const T=x.find(([A])=>A===g);if(T){const[,A]=T;C=A.sort_order,Object.entries(E).forEach(([B,U])=>{(U.account_group_id||"ungrouped")===v&&U.sort_order>=C&&(E[B]={...U,sort_order:U.sort_order+1})})}else C=0}if(E[p]={..._,account_group_id:S,sort_order:C},r(E),!!t)try{await o(E)}catch(T){d(T instanceof Error?T.message:"Failed to save changes")}},[t,e,r,o,d]),m=O.useCallback(async(p,g)=>{if(p===g)return;const v=Object.entries(n).sort(([,C],[,T])=>C.sort_order-T.sort_order),_=v.findIndex(([C])=>C===p),S=[...v],[x]=S.splice(_,1);if(g==="__end__")S.push(x);else{const C=S.findIndex(([T])=>T===g);S.splice(C,0,x)}const E={};if(S.forEach(([C,T],A)=>{E[C]={...T,sort_order:A}}),s(E),!!t)try{await l(E)}catch(C){d(C instanceof Error?C.message:"Failed to save new order")}},[t,n,s,l,d]);return{reorderAccountsInGroup:h,reorderGroups:m}}function P3(){const{selectedBudgetId:t}=zt(),{budget:e,accounts:n,accountGroups:r,setAccountsOptimistic:s,setAccountGroupsOptimistic:o}=An(),{updateAccounts:l}=IT(),{updateAccountGroups:d}=D3(),[h,m]=O.useState(null),p=O.useCallback(async F=>{if(!t)throw new Error("No budget selected");await l.mutateAsync({budgetId:t,accounts:F})},[t,l]),g=O.useCallback(async F=>{if(!t)throw new Error("No budget selected");await d.mutateAsync({budgetId:t,accountGroups:F})},[t,d]),v=O.useCallback(async(F,H)=>{if(!t)throw new Error("No budget selected");await Promise.all([l.mutateAsync({budgetId:t,accounts:F}),d.mutateAsync({budgetId:t,accountGroups:H})])},[t,l,d]),_=O.useMemo(()=>Object.entries(n).filter(([,F])=>!F.is_hidden).reduce((F,[H,j])=>{const M=j.account_group_id||"ungrouped";return F[M]||(F[M]=[]),F[M].push({...j,id:H}),F},{}),[n]),S=O.useMemo(()=>Object.entries(n).filter(([,F])=>F.is_hidden).map(([F,H])=>({...H,id:F})).sort((F,H)=>F.sort_order-H.sort_order),[n]),x=O.useMemo(()=>Object.entries(r).sort(([,F],[,H])=>F.sort_order-H.sort_order).map(([F,H])=>({...H,id:F})),[r]),E=O.useCallback((F,H)=>{if(!e)return;const j=Object.values(n).filter(q=>H==="ungrouped"?!q.account_group_id:q.account_group_id===H),M=j.length>0?Math.max(...j.map(q=>q.sort_order)):-1,R=`account_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,K={nickname:F.nickname,description:"",balance:0,account_group_id:H==="ungrouped"?null:H,sort_order:M+1,is_income_account:F.is_income_account??!1,is_income_default:F.is_income_default??!1,is_outgo_account:F.is_outgo_account??!1,is_outgo_default:F.is_outgo_default??!1,on_budget:F.on_budget!==!1,is_active:F.is_active!==!1,is_hidden:F.is_hidden??!1},W={...n};F.is_income_default&&Object.keys(W).forEach(q=>{W[q]={...W[q],is_income_default:!1}}),F.is_outgo_default&&Object.keys(W).forEach(q=>{W[q]={...W[q],is_outgo_default:!1}}),W[R]=K,s(W),p(W).catch(q=>m(q instanceof Error?q.message:"Failed to create account."))},[e,n,s,p]),C=O.useCallback((F,H)=>{if(!e)return;const j=n[F];if(!j)return;const M=j.account_group_id||"ungrouped",R=H.account_group_id;let K=j.sort_order;if(M!==(R||"ungrouped")){const q=Object.values(n).filter(J=>(J.account_group_id||"ungrouped")===(R||"ungrouped"));K=q.length>0?Math.max(...q.map(J=>J.sort_order))+1:0}const W={};Object.entries(n).forEach(([q,J])=>{q===F?W[q]={...J,nickname:H.nickname,account_group_id:R,sort_order:K,is_income_account:H.is_income_account??!1,is_income_default:H.is_income_default??!1,is_outgo_account:H.is_outgo_account??!1,is_outgo_default:H.is_outgo_default??!1,on_budget:H.on_budget!==!1,is_active:H.is_active!==!1,is_hidden:H.is_hidden??!1}:(W[q]={...J},H.is_income_default&&!j.is_income_default&&(W[q].is_income_default=!1),H.is_outgo_default&&!j.is_outgo_default&&(W[q].is_outgo_default=!1))}),s(W),p(W).catch(q=>m(q instanceof Error?q.message:"Failed to save account."))},[e,n,s,p]),T=O.useCallback(F=>{if(!confirm("Are you sure you want to delete this account?")||!e)return;const{[F]:H,...j}=n;s(j),p(j).catch(M=>m(M instanceof Error?M.message:"Failed to delete account."))},[e,n,s,p]),A=O.useCallback(async(F,H)=>{const j=n[F];if(!j)return;const M=j.account_group_id||"ungrouped",R=Object.entries(n).filter(([,re])=>(re.account_group_id||"ungrouped")===M).sort(([,re],[,P])=>re.sort_order-P.sort_order),K=R.findIndex(([re])=>re===F),W=H==="up"?K-1:K+1;if(W<0||W>=R.length)return;const[q,J]=R[W],Z={};if(Object.entries(n).forEach(([re,P])=>{re===F?Z[re]={...P,sort_order:J.sort_order}:re===q?Z[re]={...P,sort_order:j.sort_order}:Z[re]={...P}}),s(Z),!!e)try{await p(Z)}catch(re){s(n),m(re instanceof Error?re.message:"Failed to move account")}},[e,n,s,p]),B=O.useCallback(F=>{if(!e)return;const H=Object.values(r).map(W=>W.sort_order),j=H.length>0?Math.max(...H):-1,M=`account_group_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,R={name:F.name,sort_order:j+1,expected_balance:F.expected_balance,on_budget:F.on_budget,is_active:F.is_active},K={...r,[M]:R};o(K),g(K).catch(W=>m(W instanceof Error?W.message:"Failed to create account type."))},[e,r,o,g]),U=O.useCallback((F,H)=>{if(!e)return;const j={...r,[F]:{...r[F],name:H.name,expected_balance:H.expected_balance,on_budget:H.on_budget,is_active:H.is_active}};o(j),g(j).catch(M=>m(M instanceof Error?M.message:"Failed to update account type."))},[e,r,o,g]),G=O.useCallback(F=>{if(!confirm("Are you sure you want to delete this account type? Accounts in this type will move to Ungrouped.")||!e)return;const H={};Object.entries(n).forEach(([R,K])=>{H[R]=K.account_group_id===F?{...K,account_group_id:null}:K});const{[F]:j,...M}=r;s(H),o(M),v(H,M).catch(R=>m(R instanceof Error?R.message:"Failed to delete account type."))},[e,n,r,s,o,v]),k=O.useCallback(async(F,H)=>{const j=Object.entries(r).sort(([,q],[,J])=>q.sort_order-J.sort_order),M=j.findIndex(([q])=>q===F),R=H==="up"?M-1:M+1;if(R<0||R>=j.length)return;const[K]=j.splice(M,1);j.splice(R,0,K);const W={};if(j.forEach(([q,J],Z)=>{W[q]={...J,sort_order:Z}}),o(W),!!e)try{await g(W)}catch(q){o(r),m(q instanceof Error?q.message:"Failed to move account type")}},[e,r,o,g]),{reorderAccountsInGroup:D,reorderGroups:N}=N3({currentBudget:e,accounts:n,accountGroups:r,setAccountsOptimistic:s,setAccountGroupsOptimistic:o,saveAccounts:p,saveAccountGroups:g,setError:m});return{accounts:n,accountGroups:r,accountsByGroup:_,hiddenAccounts:S,sortedGroups:x,currentBudget:e,error:h,setError:m,handleCreateAccount:E,handleUpdateAccount:C,handleDeleteAccount:T,handleMoveAccount:A,handleCreateGroup:B,handleUpdateGroup:U,handleDeleteGroup:G,handleMoveGroup:k,reorderAccountsInGroup:D,reorderGroups:N}}function RS(t,e){if(!t)return{};const n={};return Object.entries(e).forEach(([r,s])=>{if(s.default_monthly_type==="percentage")return;const o=t.category_balances?.find(l=>l.category_id===r);o&&o.allocated>0?n[r]=o.allocated.toString():s.default_monthly_amount!==void 0&&s.default_monthly_amount>0?n[r]=s.default_monthly_amount.toString():n[r]=""}),n}function z3(){const{addLoadingHold:t,removeLoadingHold:e}=nr(),{selectedBudgetId:n,currentYear:r,currentMonthNumber:s}=zt(),{categories:o,getOnBudgetTotal:l,totalAvailable:d}=An(),{month:h,isLoading:m,previousMonthIncome:p,areAllocationsFinalized:g}=As(n,r,s),v=O.useMemo(()=>h?.income?h.income.reduce((P,$)=>P+$.amount,0):0,[h]),{saveDraftAllocations:_}=t3(),{finalizeAllocations:S}=n3(),{deleteAllocations:x}=AT(),E=O.useMemo(()=>RS(h,o),[h,o]),[C,T]=O.useState(E),[A,B]=O.useState(!1),[U,G]=O.useState(null),k=O.useRef(null);O.useMemo(()=>Object.values(o).reduce((P,$)=>P+($.balance??0),0),[o]),O.useEffect(()=>{if(!h)return;const P=`${h.year}-${h.month}`;k.current!==P&&(B(!1),T(RS(h,o)),k.current=P)},[h,o]);const D=O.useCallback((P,$)=>{if($.default_monthly_type==="percentage"&&$.default_monthly_amount!==void 0)return Oe($.default_monthly_amount/100*p);const te=C[P],se=parseFloat(te||"0");return isNaN(se)?0:Oe(se)},[C,p]),N=O.useMemo(()=>Object.entries(o).reduce((P,[$,te])=>{const se=D($,te),ae=te.balance??0;if(ae<0){const ye=Math.abs(ae),Ie=Math.max(0,se-ye);return P+Ie}return P+se},0),[o,D]),F=l(),H=g?(h?.category_balances||[]).reduce((P,$)=>{const te=o[$.category_id]?.balance??0,se=$.allocated,ae=te-se;if(ae<0){const ye=Math.abs(ae);return P+Math.max(0,se-ye)}return P+se},0):0,j=A?d+H:d,M=O.useMemo(()=>A?j-N:j-N+H,[j,N,H,A]),R=O.useCallback((P,$)=>{T(te=>({...te,[P]:$}))},[]),K=O.useCallback(()=>{if(!h)return;const P={};Object.entries(o).forEach(([$,te])=>{if(te.default_monthly_type==="percentage")return;const se=h.category_balances?.find(ae=>ae.category_id===$);se&&se.allocated>0?P[$]=se.allocated.toString():te.default_monthly_amount!==void 0&&te.default_monthly_amount>0?P[$]=te.default_monthly_amount.toString():P[$]=""}),T(P),B(!1)},[h,o]),W=O.useCallback(()=>{const P={};return Object.entries(o).forEach(([$,te])=>{const se=D($,te);se>0&&(P[$]=se)}),P},[o,D]),q=O.useCallback(async()=>{if(n){G(null),t("allocations-save","Saving allocations...");try{await _(n,r,s,W()),B(!1)}catch(P){G(P instanceof Error?P.message:"Failed to save allocations")}finally{e("allocations-save")}}},[n,r,s,_,W,t,e]),J=O.useCallback(async()=>{if(n){G(null),t("allocations-finalize","Applying allocations...");try{await S({budgetId:n,year:r,month:s,allocations:W(),onProgress:P=>{t("allocations-finalize",P.message)}}),B(!1)}catch(P){G(P instanceof Error?P.message:"Failed to finalize allocations")}finally{e("allocations-finalize")}}},[n,r,s,S,W,t,e]),Z=O.useCallback(async()=>{if(n){G(null),t("allocations-delete","Deleting allocations...");try{await x({budgetId:n,year:r,month:s,onProgress:$=>{t("allocations-delete",$.message)}});const P={};Object.entries(o).forEach(([$,te])=>{te.default_monthly_type!=="percentage"&&(te.default_monthly_amount!==void 0&&te.default_monthly_amount>0?P[$]=te.default_monthly_amount.toString():P[$]="")}),T(P),B(!1)}catch(P){G(P instanceof Error?P.message:"Failed to delete allocations")}finally{e("allocations-delete")}}},[n,r,s,x,o,t,e]),re=N-H;return{localAllocations:C,isEditingAppliedAllocations:A,error:U,monthLoading:m,onBudgetTotal:F,availableNow:j,currentDraftTotal:N,draftChangeAmount:re,availableAfterApply:M,previousMonthIncome:p,currentMonthIncome:v,allocationsFinalized:g,getAllocationAmount:D,handleAllocationChange:R,resetAllocationsToSaved:K,handleSaveAllocations:q,handleFinalizeAllocations:J,handleDeleteAllocations:Z,setIsEditingAppliedAllocations:B,setError:G}}function B3({budgetId:t,categories:e,currentYear:n,currentMonth:r,updateCategoriesWithBalances:s}){const o=O.useMemo(()=>{const v={};return Object.entries(e).forEach(([_,S])=>{v[_]={current:S.balance??0,total:S.balance??0}}),v},[e]),[l,d]=O.useState(!1),[h,m]=O.useState(null),p=O.useCallback(async()=>{if(!t||Object.keys(e).length===0)return null;const v=Object.keys(e),{total:_}=await jS(t,v,n,r),S={};Object.entries(e).forEach(([E,C])=>{const T=C.balance,A=_[E]??0;Math.abs(T-A)>.01&&(S[E]={stored:T,calculated:A})});const x=Object.keys(S).length>0?S:null;return m(x),x},[t,e,n,r]),g=O.useCallback(async()=>{if(!(!t||Object.keys(e).length===0)){d(!0);try{const v=Object.keys(e),{total:_}=await jS(t,v,n,r),S={};Object.entries(e).forEach(([x,E])=>{S[x]={...E,balance:_[x]??0}}),await s(S),m(null)}finally{d(!1)}}},[t,e,s,n,r]);return{categoryBalances:o,loadingBalances:l,categoryBalanceMismatch:h,checkCategoryBalanceMismatch:p,recalculateAndSaveCategoryBalances:g}}function L3({categories:t,categoryGroups:e,currentBudget:n,setCategoriesOptimistic:r,setCategoryGroupsOptimistic:s,saveCategories:o,saveCategoryGroups:l,setError:d}){const[h,m]=O.useState(null),[p,g]=O.useState(null),[v,_]=O.useState(null),[S,x]=O.useState(null);function E(F,H){m("category"),g(H),F.dataTransfer.effectAllowed="move"}function C(F,H,j){F.preventDefault(),h==="category"&&(H!==p&&_(H),x(j))}function T(F,H){F.preventDefault(),h==="category"?(x(H),_(null)):h==="group"&&H!==p&&_(H)}function A(){_(null)}function B(){x(null)}function U(){m(null),g(null),_(null),x(null)}async function G(F,H,j){if(F.preventDefault(),F.stopPropagation(),!p||h!=="category"){U();return}const M=t[p];if(!M)return;const R=j==="ungrouped"?null:j,K=Object.entries(t).filter(([,J])=>(J.category_group_id||"ungrouped")===j),W={};Object.entries(t).forEach(([J,Z])=>{J!==p&&(W[J]=Z)});let q;if(H==="__group_end__"||K.length===0||!K.find(([J])=>J===H))q=(K.length>0?Math.max(...K.filter(([Z])=>Z!==p).map(([,Z])=>Z.sort_order)):-1)+1;else{const J=K.find(([Z])=>Z===H);J?(q=J[1].sort_order,Object.entries(W).forEach(([Z,re])=>{(re.category_group_id||"ungrouped")===j&&re.sort_order>=q&&(W[Z]={...re,sort_order:re.sort_order+1})})):q=0}if(W[p]={...M,category_group_id:R,sort_order:q},r(W),U(),!!n)try{await o(W)}catch(J){d(J instanceof Error?J.message:"Failed to save changes")}}async function k(F,H){F.preventDefault(),h==="category"?await G(F,"__group_end__",H):h==="group"&&await N(F,H)}function D(F,H){F.stopPropagation(),m("group"),g(H),F.dataTransfer.effectAllowed="move"}async function N(F,H){if(F.preventDefault(),!p||h!=="group"||p===H){U();return}const j=e.findIndex(W=>W.id===p),M=[...e],[R]=M.splice(j,1);if(H==="__end__")M.push(R);else{const W=M.findIndex(q=>q.id===H);M.splice(W,0,R)}const K=M.map((W,q)=>({...W,sort_order:q}));if(s(K),U(),!!n)try{await l(K)}catch(W){d(W instanceof Error?W.message:"Failed to save new order")}}return{dragType:h,draggedId:p,dragOverId:v,dragOverGroupId:S,setDragOverId:_,setDragOverGroupId:x,handleCategoryDragStart:E,handleCategoryDragOver:C,handleDragOverGroup:T,handleDragLeave:A,handleDragLeaveGroup:B,handleDragEnd:U,handleCategoryDrop:G,handleDropOnGroup:k,handleGroupDragStart:D,handleGroupDrop:N}}function U3(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n}=zt(),{budget:r,categories:s,categoryGroups:o,isLoading:l,setCategoriesOptimistic:d,setCategoryGroupsOptimistic:h,getOnBudgetTotal:m}=An(),{updateCategories:p}=DT(),{updateCategoryGroups:g}=O3(),[v,_]=O.useState(null),S=O.useCallback(async J=>{if(!t)throw new Error("No budget selected");await p.mutateAsync({budgetId:t,categories:J})},[t,p]),x=O.useCallback(async J=>{if(!t)throw new Error("No budget selected");await g.mutateAsync({budgetId:t,categoryGroups:J})},[t,g]),E=O.useCallback(async(J,Z)=>{if(!t)throw new Error("No budget selected");await Promise.all([p.mutateAsync({budgetId:t,categories:J}),g.mutateAsync({budgetId:t,categoryGroups:Z})])},[t,p,g]),{categoryBalances:C,loadingBalances:T,categoryBalanceMismatch:A,checkCategoryBalanceMismatch:B,recalculateAndSaveCategoryBalances:U}=B3({budgetId:t,categories:s,currentYear:e,currentMonth:n,updateCategoriesWithBalances:S}),G=L3({categories:s,categoryGroups:o,currentBudget:r,setCategoriesOptimistic:d,setCategoryGroupsOptimistic:h,saveCategories:S,saveCategoryGroups:x,setError:_});async function k(J,Z){if(!r)return;const re=Z==="ungrouped"?null:Z,P=Object.values(s).filter(ye=>Z==="ungrouped"?!ye.category_group_id:ye.category_group_id===Z),$=P.length>0?Math.max(...P.map(ye=>ye.sort_order)):-1,te=`category_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,se={name:J.name,description:J.description??"",category_group_id:re,sort_order:$+1,default_monthly_amount:J.default_monthly_amount??0,default_monthly_type:J.default_monthly_type??"fixed",balance:0,is_hidden:J.is_hidden??!1},ae={...s,[te]:se};d(ae);try{await S(ae)}catch(ye){d(s),_(ye instanceof Error?ye.message:"Failed to create category")}}async function D(J,Z){if(r)try{const re=s[J];if(!re)return;const P=re.category_group_id||"ungrouped",$=Z.category_group_id;let te=re.sort_order;if(P!==($||"ungrouped")){const ae=Object.values(s).filter(ye=>(ye.category_group_id||"ungrouped")===($||"ungrouped")).filter((ye,Ie,Ee)=>s[J]!==Ee[Ie]);te=ae.length>0?Math.max(...ae.map(ye=>ye.sort_order))+1:0}const se={...s,[J]:{...re,name:Z.name,description:Z.description??"",category_group_id:$,sort_order:te,default_monthly_amount:Z.default_monthly_amount??0,default_monthly_type:Z.default_monthly_type??"fixed",is_hidden:Z.is_hidden??!1}};d(se),await S(se)}catch(re){_(re instanceof Error?re.message:"Failed to update category")}}async function N(J){if(confirm("Are you sure you want to delete this category?")&&r)try{const{[J]:Z,...re}=s;d(re),await S(re)}catch(Z){_(Z instanceof Error?Z.message:"Failed to delete category")}}async function F(J,Z){const re=s[J];if(!re)return;const P=re.category_group_id||"ungrouped",$=Object.entries(s).filter(([,Ee])=>(Ee.category_group_id||"ungrouped")===P).sort((Ee,Ce)=>Ee[1].sort_order-Ce[1].sort_order),te=$.findIndex(([Ee])=>Ee===J),se=Z==="up"?te-1:te+1;if(se<0||se>=$.length)return;const[ae,ye]=$[se],Ie={};if(Object.entries(s).forEach(([Ee,Ce])=>{Ee===J?Ie[Ee]={...Ce,sort_order:ye.sort_order}:Ee===ae?Ie[Ee]={...Ce,sort_order:re.sort_order}:Ie[Ee]=Ce}),d(Ie),!!r)try{await S(Ie)}catch(Ee){d(s),_(Ee instanceof Error?Ee.message:"Failed to move category")}}async function H(J){if(r)try{const Z=o.length>0?Math.max(...o.map($=>$.sort_order)):-1,re={id:`category_group_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,name:J.name,sort_order:Z+1},P=[...o,re];h(P),await x(P)}catch(Z){_(Z instanceof Error?Z.message:"Failed to create group")}}async function j(J,Z){if(r)try{const re=o.map(P=>P.id===J?{...P,name:Z.name}:P);h(re),await x(re)}catch(re){_(re instanceof Error?re.message:"Failed to update group")}}async function M(J){if(confirm("Are you sure you want to delete this group? Categories in this group will move to Uncategorized.")&&r)try{const Z={};Object.entries(s).forEach(([P,$])=>{Z[P]=$.category_group_id===J?{...$,category_group_id:null}:$});const re=o.filter(P=>P.id!==J);d(Z),h(re),await E(Z,re)}catch(Z){_(Z instanceof Error?Z.message:"Failed to delete group")}}async function R(J,Z){const re=[...o].sort((ae,ye)=>ae.sort_order-ye.sort_order),P=re.findIndex(ae=>ae.id===J),$=Z==="up"?P-1:P+1;if($<0||$>=re.length)return;const[te]=re.splice(P,1);re.splice($,0,te);const se=re.map((ae,ye)=>({...ae,sort_order:ye}));if(h(se),!!r)try{await x(se)}catch(ae){h(o),_(ae instanceof Error?ae.message:"Failed to move group")}}const K=Object.entries(s).filter(([,J])=>!J.is_hidden).reduce((J,[Z,re])=>{const P=re.category_group_id||"ungrouped";return J[P]||(J[P]=[]),J[P].push([Z,re]),J},{}),W=Object.entries(s).filter(([,J])=>J.is_hidden).map(([J,Z])=>[J,Z]).sort((J,Z)=>J[1].sort_order-Z[1].sort_order),q=[...o].sort((J,Z)=>J.sort_order-Z.sort_order);return{currentBudget:r,categories:s,categoryGroups:o,categoriesByGroup:K,hiddenCategories:W,sortedGroups:q,categoryBalances:C,isLoading:l,loadingBalances:T,error:v,setError:_,getOnBudgetTotal:m,categoryBalanceMismatch:A,checkCategoryBalanceMismatch:B,recalculateAndSaveCategoryBalances:U,handleCreateCategory:k,handleUpdateCategory:D,handleDeleteCategory:N,handleMoveCategory:F,handleCreateGroup:H,handleUpdateGroup:j,handleDeleteGroup:M,handleMoveGroup:R,dragType:G.dragType,draggedId:G.draggedId,dragOverId:G.dragOverId,dragOverGroupId:G.dragOverGroupId,setDragOverId:G.setDragOverId,setDragOverGroupId:G.setDragOverGroupId,handleCategoryDragStart:G.handleCategoryDragStart,handleCategoryDragOver:G.handleCategoryDragOver,handleDragOverGroup:G.handleDragOverGroup,handleDragLeave:G.handleDragLeave,handleDragLeaveGroup:G.handleDragLeaveGroup,handleDragEnd:G.handleDragEnd,handleCategoryDrop:G.handleCategoryDrop,handleDropOnGroup:G.handleDropOnGroup,handleGroupDragStart:G.handleGroupDragStart,handleGroupDrop:G.handleGroupDrop}}function F3(t){switch(t.phase){case"reading-budget":return"Reading budget data...";case"fetching-months":return t.totalMonthsToFetch?`Loading ${t.totalMonthsToFetch} months...`:"Loading months...";case"recalculating":return t.currentMonth?`Recalculating ${t.currentMonth}...`:"Recalculating balances...";case"saving":return t.totalMonths?`Saving ${t.totalMonths} months...`:"Saving results...";case"complete":return"Recalculation complete!";default:return"Recalculating..."}}function fd({budgetId:t,year:e,month:n,monthMap:r,checkAnyMonth:s=!1,requireMonthLoaded:o=!1,currentMonth:l,additionalCondition:d=!0,onProgress:h,onError:m,logPrefix:p="[AutoRecalc]"}){const[g,v]=O.useState(null),_=O.useRef(!1),S=O.useRef(null),x=O.useRef(null),E=Vn(),C=O.useRef(null),{addLoadingHold:T,removeLoadingHold:A}=nr();return O.useEffect(()=>{if(!t||!d||o&&!l)return;let B;const U=E.pathname;if(s){C.current!==U&&(S.current=null,C.current=U);const D=wT(r);if(D.length===0||_.current||(B=`any-${D[0]}`,S.current===B))return}else{if(e===void 0||n===void 0){console.warn(`${p} year and month are required when checkAnyMonth is false`);return}const D=Yt(e,n),N=r[D]?.needs_recalculation===!0;if(B=`${e}-${n}`,(C.current!==U||x.current!==B)&&(S.current=null,C.current=U,x.current=B),S.current===B)return;if(!N||_.current){S.current=B;return}`${e}${String(n).padStart(2,"0")}`}_.current=!0,S.current=B;const G=`recalc-${t}`;T(G,"Recalculating balances..."),L0(t,{onProgress:D=>{v(D);const N=F3(D);T(G,N),h?.(D)}}).then(()=>{Ze.invalidateQueries({queryKey:["month",t]})}).catch(D=>{const N=D instanceof Error?D:new Error(String(D));m?m(N):console.error(`${p} Recalculation failed:`,N)}).finally(()=>{_.current=!1,v(null),A(G)})},[t,e,n,r,s,o,l,d,h,m,p,E.pathname,T,A]),{recalcProgress:g,isRecalculating:g!==null}}function Ra(){Ze.removeQueries({queryKey:["budget"]}),Ze.removeQueries({queryKey:["month"]}),Ze.removeQueries({queryKey:["accessibleBudgets"]}),Ze.removeQueries({queryKey:["payees"]}),Ze.removeQueries({queryKey:["user"]});try{localStorage.removeItem("BUDGET_APP_QUERY_CACHE")}catch{}console.log("[Migration] All caches cleared")}async function fc(t){try{const e=await t();return Ra(),e}catch(e){throw Ra(),e}}const kT=O.createContext(null),IS={isOpen:!1,migrationName:"",stage:"",progress:null,currentItem:null,details:null,isComplete:!1,error:null};function V3({children:t}){const[e,n]=O.useState(IS),r=O.useCallback(()=>({setStage:d=>{n(h=>({...h,stage:d}))},setProgress:d=>{n(h=>({...h,progress:d}))},setCurrentItem:d=>{n(h=>({...h,currentItem:d}))},setDetails:d=>{n(h=>({...h,details:d}))},updateItemProgress:(d,h,m)=>{const p=h>0?Math.round(d/h*100):0;n(g=>({...g,progress:p,currentItem:m||`Item ${d} of ${h}`,details:`${d} / ${h} complete`}))}}),[]),s=O.useCallback(async(d,h)=>{n({isOpen:!0,migrationName:d,stage:"Starting migration...",progress:null,currentItem:null,details:null,isComplete:!1,error:null});const m=r();try{const p=await h(m);return Ra(),n(g=>({...g,isComplete:!0,stage:"Migration complete",progress:100,details:p.errors.length>0?`Completed with ${p.errors.length} error(s)`:"All operations successful"})),p}catch(p){Ra();const g=p instanceof Error?p.message:"Unknown error occurred";throw n(v=>({...v,isComplete:!0,error:g,stage:"Migration failed",progress:null})),p}},[r]),o=O.useCallback(()=>{n(d=>d.isComplete?IS:(console.warn("[MigrationProgress] Cannot close modal while migration is running"),d))},[]),l={state:e,runMigrationWithProgress:s,closeModal:o};return u.jsx(kT.Provider,{value:l,children:t})}function OT(){const t=O.useContext(kT);if(!t)throw new Error("useMigrationProgress must be used within MigrationProgressProvider");return t}async function $3(t){return(await Ht("budgets",`${t}: batch reading all budgets`)).docs.map(n=>({id:n.id,data:n.data}))}async function MT(t,e){return(await Ht("months",`${e}: batch reading months for budget ${t}`,[{field:"budget_id",op:"==",value:t}])).docs.map(s=>({id:s.id,data:s.data,budgetId:s.data.budget_id,year:s.data.year,month:s.data.month})).sort((s,o)=>s.year!==o.year?s.year-o.year:s.month-o.month)}async function Gi(t){const e=await $3(t),n=await Ht("months",`${t}: batch reading all months`),r=new Map;for(const s of n.docs){const o=s.data.budget_id,l={id:s.id,data:s.data,budgetId:o,year:s.data.year,month:s.data.month};r.has(o)||r.set(o,[]),r.get(o).push(l)}for(const s of r.values())s.sort((o,l)=>o.year!==l.year?o.year-l.year:o.month-l.month);return{budgets:e,monthsByBudget:r}}async function md(t,e){if(t.length===0)return;const n=t.map(r=>({collectionPath:"months",docId:li(r.budgetId,r.year,r.month),data:Co({...r.data,updated_at:new Date().toISOString()})}));await pm(n,`${e}: batch writing ${t.length} months`)}async function U0(t,e){if(t.length===0)return;const n=t.map(r=>({collectionPath:"budgets",docId:r.budgetId,data:Co({...r.data,updated_at:new Date().toISOString()})}));await pm(n,`${e}: batch writing ${t.length} budgets`)}async function NT(t,e,n){if(e.length===0)return;let r=bT;const s=[];for(const p of e){const g=vT(p,r);s.push(g),r=Oy(g)}const o=s.map(p=>({budgetId:t,year:p.year,month:p.month,data:p}));await md(o,n);const l=r.accountEndBalances,d=r.categoryEndBalances,{exists:h,data:m}=await bt("budgets",t,`${n}: reading budget for final update`);if(h&&m){const p=xT(m.month_map||{}),g=B0(p),v={...d},_=m.categories||{};for(const S of Object.keys(_))S in v||(v[S]=0);await ET(t,l,v,g)}}async function PT(t,e){if(t.length===0)return;const n=new Map;for(const r of t)n.has(r.budgetId)||n.set(r.budgetId,[]),n.get(r.budgetId).push(r);for(const[r,s]of n){s.sort((d,h)=>d.year!==h.year?d.year-h.year:d.month-h.month),await md(s,e);const l=(await MT(r,e)).map(d=>d.data);await NT(r,l,e)}}function zT(t){return t.nickname===void 0||t.description===void 0||t.balance===void 0||t.sort_order===void 0||t.is_income_account===void 0||t.is_income_default===void 0||t.is_outgo_account===void 0||t.is_outgo_default===void 0||t.on_budget===void 0||t.is_active===void 0}function BT(t){return t.name===void 0||t.description===void 0||t.sort_order===void 0||t.default_monthly_amount===void 0||t.default_monthly_type===void 0||t.balance===void 0}function LT(t){return t.name===void 0||t.sort_order===void 0}function UT(t){return t.budget_id===void 0||t.year_month_ordinal===void 0||t.year===void 0||t.month===void 0||!Array.isArray(t.income)||t.total_income===void 0||t.previous_month_income===void 0||!Array.isArray(t.expenses)||t.total_expenses===void 0||!Array.isArray(t.account_balances)||!Array.isArray(t.category_balances)||t.are_allocations_finalized===void 0||t.created_at===void 0||t.updated_at===void 0}function FT(){const t=new Date,e=t.getFullYear();let r=t.getMonth()+1+Vu,s=e;for(;r>12;)r-=12,s+=1;return{year:s,month:r}}function VT(t,e,n){return t>n.year||t===n.year&&e>n.month}async function H3(){const t=await Ht("budgets","database cleanup: scanning all budgets");let e=0,n=0,r=0,s=0,o=0,l=0,d=0,h=0,m=0;const p=new Set;for(const T of t.docs){const A=T.data;if(Array.isArray(A.accounts)||Array.isArray(A.categories)||Array.isArray(A.account_groups)){e++;continue}p.add(T.id),A.month_map===void 0&&h++,A.earliest_month!==void 0&&m++;const B=A.accounts;if(B&&typeof B=="object"){let k=!1;for(const D of Object.values(B))zT(D)&&(o++,k=!0);k&&n++}const U=A.categories;if(U&&typeof U=="object"){let k=!1;for(const D of Object.values(U))BT(D)&&(l++,k=!0);k&&r++}const G=A.account_groups;if(G&&typeof G=="object"){let k=!1;for(const D of Object.values(G))LT(D)&&(d++,k=!0);k&&s++}}const g=await Ht("months","database cleanup: scanning all months"),v=FT(),_=[];let S=0,x=0;for(const T of g.docs){const A=T.data,B=A.year,U=A.month;B&&U&&VT(B,U,v)&&_.push({docId:T.id,budgetId:A.budget_id,year:B,month:U}),UT(A)&&S++,A.is_needs_recalculation!==void 0&&x++}_.sort((T,A)=>T.year!==A.year?T.year-A.year:T.month-A.month);const E=await Ht("data_mappings","database cleanup: scanning all data mappings");let C=0;for(const T of E.docs)T.data.budget_id===void 0&&C++;return{totalBudgets:t.docs.length,budgetsWithArrays:e,budgetsWithMissingAccountDefaults:n,budgetsWithMissingCategoryDefaults:r,budgetsWithMissingGroupDefaults:s,accountsNeedingDefaults:o,categoriesNeedingDefaults:l,groupsNeedingDefaults:d,budgetsNeedingMonthMapUpdate:h,budgetsWithDeprecatedEarliestMonth:m,totalMonths:g.docs.length,futureMonthsToDelete:_,monthsWithSchemaIssues:S,monthsWithOldRecalcField:x,totalDataMappings:E.docs.length,dataMappingsMissingBudgetId:C}}function DS(t){return{nickname:t.nickname??"",description:t.description??"",balance:t.balance??0,account_group_id:t.account_group_id??null,sort_order:t.sort_order??0,is_income_account:t.is_income_account??!1,is_income_default:t.is_income_default??!1,is_outgo_account:t.is_outgo_account??!1,is_outgo_default:t.is_outgo_default??!1,on_budget:t.on_budget??!0,is_active:t.is_active??!0,is_hidden:t.is_hidden??!1}}function kS(t){return{name:t.name??"",description:t.description??"",category_group_id:t.category_group_id??null,sort_order:t.sort_order??0,default_monthly_amount:t.default_monthly_amount??0,default_monthly_type:t.default_monthly_type??"fixed",balance:t.balance??0,is_hidden:t.is_hidden??!1}}function OS(t){return{name:t.name??"",sort_order:t.sort_order??0,...t.expected_balance!==void 0&&{expected_balance:t.expected_balance},...t.on_budget!==void 0&&{on_budget:t.on_budget},...t.is_active!==void 0&&{is_active:t.is_active}}}function q3(t,e){const n=e.match(/_(\d{4})(\d{2})$/),r=n?parseInt(n[1]):new Date().getFullYear(),s=n?parseInt(n[2]):new Date().getMonth()+1,o=`${r}${String(s).padStart(2,"0")}`;return{budget_id:t.budget_id??"",year_month_ordinal:t.year_month_ordinal??o,year:t.year??r,month:t.month??s,income:Array.isArray(t.income)?t.income:[],total_income:t.total_income??0,previous_month_income:t.previous_month_income??0,expenses:Array.isArray(t.expenses)?t.expenses:[],total_expenses:t.total_expenses??0,transfers:Array.isArray(t.transfers)?t.transfers:[],adjustments:Array.isArray(t.adjustments)?t.adjustments:[],account_balances:Array.isArray(t.account_balances)?t.account_balances:[],category_balances:Array.isArray(t.category_balances)?t.category_balances:[],are_allocations_finalized:t.are_allocations_finalized??!1,created_at:t.created_at??new Date().toISOString(),updated_at:t.updated_at??new Date().toISOString()}}async function G3(t){const e={},n=await Ht("months",`database cleanup: querying all months for budget ${t}`,[{field:"budget_id",op:"==",value:t}]);for(const r of n.docs){const s=r.data;if(s.year&&s.month){const o=Yt(s.year,s.month);e[o]={needs_recalculation:!1}}}return e}async function W3(){const t=[];let e=0,n=0,r=0,s=0,o=0,l=0,d=0,h=0,m=0,p=0;const g=await Ht("budgets","database cleanup: reading all budgets to fix");for(const E of g.docs)try{const{exists:C,data:T}=await bt("budgets",E.id,"database cleanup: reading budget for update");if(!C||!T)continue;let A=!1;const B={...T};if(Array.isArray(T.accounts)){const U=T.accounts,G={};for(const k of U){const D=k.id||`account_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;G[D]=DS(k),n++}B.accounts=G,A=!0,o++}if(Array.isArray(T.categories)){const U=T.categories,G={};for(const k of U){const D=k.id||`category_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;G[D]=kS(k),r++}B.categories=G,A=!0,o++}if(Array.isArray(T.account_groups)){const U=T.account_groups,G={};for(const k of U){const D=k.id||`group_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;G[D]=OS(k),s++}B.account_groups=G,A=!0,o++}if(!Array.isArray(T.accounts)&&T.accounts&&typeof T.accounts=="object"){const U=T.accounts,G={};for(const[k,D]of Object.entries(U))zT(D)?(G[k]=DS(D),n++,A=!0):G[k]=D;A&&(B.accounts=G)}if(!Array.isArray(T.categories)&&T.categories&&typeof T.categories=="object"){const U=T.categories,G={};let k=!1;for(const[D,N]of Object.entries(U))BT(N)?(G[D]=kS(N),r++,k=!0):G[D]=N;k&&(B.categories=G,A=!0)}if(!Array.isArray(T.account_groups)&&T.account_groups&&typeof T.account_groups=="object"){const U=T.account_groups,G={};let k=!1;for(const[D,N]of Object.entries(U))LT(N)?(G[D]=OS(N),s++,k=!0):G[D]=N;k&&(B.account_groups=G,A=!0)}if(T.month_map===void 0){const U=await G3(E.id);B.month_map=U,A=!0,l++}delete B.category_balances,delete B.allocations,delete B.allocations_finalized,delete B.is_needs_recalculation,delete B.earliest_month,A&&(await tn("budgets",E.id,B,"database cleanup: saving fixed budget"),e++),T.earliest_month!==void 0&&(await Ql("budgets",E.id,{earliest_month:CS(),updated_at:new Date().toISOString()},`database cleanup: removing deprecated earliest_month from budget ${E.id}`),d++)}catch(C){t.push(`Budget ${E.id}: ${C instanceof Error?C.message:"Unknown error"}`)}const v=await Ht("months","database cleanup: reading all months"),_=FT();for(const E of v.docs)try{const C=E.data,T=C.year,A=C.month;if(T&&A&&VT(T,A,_)){await Fu("months",E.id,`database cleanup: deleting future month ${T}-${A}`),h++;continue}if(UT(C)){const B=q3(C,E.id);await tn("months",E.id,B,"database cleanup: saving fixed month"),m++}C.is_needs_recalculation!==void 0&&(await Ql("months",E.id,{is_needs_recalculation:CS(),updated_at:new Date().toISOString()},`database cleanup: removing is_needs_recalculation from month ${T}/${A}`),p++)}catch(C){t.push(`Month ${E.id}: ${C instanceof Error?C.message:"Unknown error"}`)}let S=0;const x=await Ht("data_mappings","database cleanup: reading all data mappings");for(const E of x.docs)try{const C=E.data;if(C.budget_id!==void 0)continue;const T=E.id,A=T.lastIndexOf("_import_data_map");if(A===-1){t.push(`Data mapping ${T}: Cannot extract budget_id from document ID (unexpected format)`);continue}const B=T.substring(0,A),{exists:U}=await bt("budgets",B,`database cleanup: verifying budget exists for data mapping ${T}`);if(!U){t.push(`Data mapping ${T}: Referenced budget ${B} does not exist`);continue}await tn("data_mappings",T,{...C,budget_id:B},`database cleanup: adding budget_id to data mapping ${T}`),S++}catch(C){t.push(`Data mapping ${E.id}: ${C instanceof Error?C.message:"Unknown error"}`)}return{budgetsProcessed:e,accountsFixed:n,categoriesFixed:r,groupsFixed:s,arraysConverted:o,monthMapsUpdated:l,deprecatedFieldsRemoved:d,futureMonthsDeleted:h,monthsFixed:m,oldRecalcFieldsRemoved:p,dataMappingsFixed:S,errors:t}}function Q3({currentUser:t,onComplete:e}){const[n,r]=O.useState(!1),[s,o]=O.useState(!1),[l,d]=O.useState(null),[h,m]=O.useState(null);async function p(){if(t){r(!0);try{const S=await H3();d(S)}catch(S){console.error("Failed to scan database:",S)}finally{r(!1)}}}async function g(){if(t){o(!0),m(null);try{const S=await fc(()=>W3());m(S),e?.()}catch(S){m({budgetsProcessed:0,accountsFixed:0,categoriesFixed:0,groupsFixed:0,arraysConverted:0,monthMapsUpdated:0,deprecatedFieldsRemoved:0,futureMonthsDeleted:0,monthsFixed:0,oldRecalcFieldsRemoved:0,dataMappingsFixed:0,errors:[S instanceof Error?S.message:"Unknown error"]})}finally{o(!1)}}}const v=l!==null&&(l.budgetsWithArrays>0||l.accountsNeedingDefaults>0||l.categoriesNeedingDefaults>0||l.groupsNeedingDefaults>0||l.budgetsNeedingMonthMapUpdate>0||l.budgetsWithDeprecatedEarliestMonth>0||l.futureMonthsToDelete.length>0||l.monthsWithSchemaIssues>0||l.monthsWithOldRecalcField>0||l.dataMappingsMissingBudgetId>0),_=l!==null?l.budgetsWithArrays+l.accountsNeedingDefaults+l.categoriesNeedingDefaults+l.groupsNeedingDefaults+l.budgetsNeedingMonthMapUpdate+l.budgetsWithDeprecatedEarliestMonth+l.futureMonthsToDelete.length+l.monthsWithSchemaIssues+l.monthsWithOldRecalcField+l.dataMappingsMissingBudgetId:0;return{status:l,isScanning:n,scanStatus:p,hasIssues:v,totalIssues:_,isRunning:s,result:h,runCleanup:g}}function $g(t){return t.includes("@")?!1:!!(/_[a-z0-9]+_(com|org|net|edu|io|co|uk|gov|mil|biz|info)$/i.test(t)&&(t.match(/_/g)||[]).length>=2||/_[a-z0-9]+\.(com|org|net|edu|io|co|uk|gov|mil|biz|info)$/i.test(t)&&(t.match(/_/g)||[]).length>=1)}function K3(t){let e=t;const n=/^(.+)_(gmail|yahoo|hotmail|outlook|icloud|aol|proton|protonmail)\.(.+)$/i,r=e.match(n);return r?`${r[1]}@${r[2]}.${r[3]}`:(e=e.replace(/_com$/,".com").replace(/_net$/,".net").replace(/_org$/,".org").replace(/_edu$/,".edu").replace(/_io$/,".io"),e=e.replace(/_gmail_/,"@gmail.").replace(/_yahoo_/,"@yahoo.").replace(/_hotmail_/,"@hotmail.").replace(/_outlook_/,"@outlook.").replace(/_icloud_/,"@icloud."),e)}function cf(t){if(t===null||typeof t!="object"||Array.isArray(t))return!1;const e=t;return e._methodName==="arrayUnion"&&Array.isArray(e.vc)}function $T(t){return t.vc||[]}function MS(t){return Array.isArray(t.items)?t.items:cf(t.items)?$T(t.items):[]}function Y3({currentUser:t}){const[e,n]=O.useState(!1),[r,s]=O.useState(!1),[o,l]=O.useState(null),[d,h]=O.useState(null);async function m(){if(!t)return;n(!0);const g={documentsFound:0,sanitizedDocuments:[],corruptedDocuments:[],isHealthy:!0};try{const v=await Ht("feedback","feedback migration: scanning for issues");g.documentsFound=v.docs.length;for(const _ of v.docs)$g(_.id)&&g.sanitizedDocuments.push(_.id),cf(_.data.items)&&g.corruptedDocuments.push(_.id);g.isHealthy=g.sanitizedDocuments.length===0&&g.corruptedDocuments.length===0,l(g)}catch(v){console.error("Failed to scan feedback:",v)}finally{n(!1)}}async function p(){if(t){s(!0);try{const g=await fc(async()=>{const v={documentsFound:0,sanitizedDocuments:[],corruptedDocuments:[],mergedItems:0,deletedDocuments:0,fixedDocuments:0,errors:[]},_=await Ht("feedback","feedback migration: listing all documents");v.documentsFound=_.docs.length;for(const S of _.docs){const x=$g(S.id);if(cf(S.data.items)&&!x){v.corruptedDocuments.push(S.id);const C=$T(S.data.items);try{await tn("feedback",S.id,{items:C,user_email:S.data.user_email||S.id,created_at:S.data.created_at||new Date().toISOString(),updated_at:new Date().toISOString()},`feedback migration: fixing corrupted arrayUnion in ${S.id}`),v.fixedDocuments++}catch(T){v.errors.push(`Failed to fix ${S.id}: ${T instanceof Error?T.message:"Unknown error"}`)}}}for(const S of _.docs)if($g(S.id)){v.sanitizedDocuments.push(S.id);const x=S.id,E=K3(x),C=MS(S.data),{exists:T,data:A}=await bt("feedback",E,`feedback migration: checking if ${E} exists`);if(T&&A){const B=MS(A),U=new Set(B.map(k=>k.id)),G=C.filter(k=>!U.has(k.id));if(G.length>0||cf(A.items)){const k=[...B,...G];await tn("feedback",E,{...A,items:k,updated_at:new Date().toISOString()},`feedback migration: merging ${G.length} items from ${x}`),v.mergedItems+=G.length}}else C.length>0&&(await tn("feedback",E,{items:C,user_email:E,created_at:S.data.created_at||new Date().toISOString(),updated_at:new Date().toISOString()},`feedback migration: creating ${E} from ${x}`),v.mergedItems+=C.length);try{await Fu("feedback",x,`feedback migration: deleting sanitized document ${x}`),v.deletedDocuments++}catch(B){v.errors.push(`Failed to delete ${x}: ${B instanceof Error?B.message:"Unknown error"}`)}}return v});h(g)}catch(g){h({documentsFound:0,sanitizedDocuments:[],corruptedDocuments:[],mergedItems:0,deletedDocuments:0,fixedDocuments:0,errors:[g instanceof Error?g.message:"Migration failed"]})}finally{s(!1)}}}return{status:o,isScanning:e,scanStatus:m,isMigratingFeedback:r,feedbackMigrationResult:d,migrateFeedbackDocuments:p}}async function X3(t){const{exists:e,data:n}=await bt("budgets",t,`[delete all months] reading budget ${t} for reset`);if(!e||!n)return;const r={...n.accounts};for(const o of Object.keys(r))r[o]&&typeof r[o]=="object"&&(r[o]={...r[o],balance:0});const s={...n.categories};for(const o of Object.keys(s))s[o]&&typeof s[o]=="object"&&(s[o]={...s[o],balance:0});await tn("budgets",t,{...n,accounts:r,categories:s,month_map:{},total_available:0,is_needs_recalculation:!1,updated_at:new Date().toISOString()},`[delete all months] resetting budget ${t} balances to zero`)}function Z3({currentUser:t,onComplete:e}){const[n,r]=O.useState(!1),[s,o]=O.useState(!1),[l,d]=O.useState(null),[h,m]=O.useState(null),[p,g]=O.useState(null);async function v(){if(t){r(!0);try{const S=await Ht("months","delete all months: scanning for all months"),x=[],E=new Set;for(const C of S.docs){const{budget_id:T,year:A,month:B}=C.data;E.add(T),x.push({docId:C.id,budgetId:T,year:A,month:B})}x.sort((C,T)=>C.budgetId!==T.budgetId?C.budgetId.localeCompare(T.budgetId):C.year!==T.year?C.year-T.year:C.month-T.month),d({monthsToDelete:x,monthsCount:x.length,budgetCount:E.size})}catch{}finally{r(!1)}}}async function _(){if(!t||!l||l.monthsToDelete.length===0)return;o(!0),m(null);const S=l.monthsToDelete.length,x=new Set,E=[];for(const U of l.monthsToDelete)x.add(U.budgetId);g({phase:"deleting",deleted:0,total:S,currentMonth:null,budgetsRecalculated:0,totalBudgets:l.budgetCount,percentComplete:0});const C=l.monthsToDelete.map(U=>({collectionPath:"months",docId:U.docId}));let T=0;try{await _T(C,"delete all months: batch deleting all month documents",U=>{T=U,g({phase:"deleting",deleted:U,total:S,currentMonth:`Batch ${Math.ceil(U/500)} of ${Math.ceil(S/500)}`,budgetsRecalculated:0,totalBudgets:l.budgetCount,percentComplete:Math.round(U/S*70)})}),T=S}catch(U){E.push(`Batch delete failed: ${U instanceof Error?U.message:"Unknown error"}`)}const A=Array.from(x);let B=0;for(const U of A){g({phase:"resetting-budgets",deleted:T,total:S,currentMonth:`Budget ${B+1}/${A.length}`,budgetsRecalculated:B,totalBudgets:A.length,percentComplete:70+Math.round(B/A.length*25)});try{await X3(U),B++}catch{B++}}g({phase:"clearing-cache",deleted:T,total:S,currentMonth:null,budgetsRecalculated:B,totalBudgets:A.length,percentComplete:95}),Ra(),g({phase:"complete",deleted:T,total:S,currentMonth:null,budgetsRecalculated:B,totalBudgets:A.length,percentComplete:100}),m({deleted:T,errors:E,budgetsRecalculated:B}),o(!1),g(null),E.length===0&&(d({monthsToDelete:[],monthsCount:0,budgetCount:0}),e?.())}return{status:l,isScanning:n,scanStatus:v,isDeleting:s,deleteResult:h,deleteProgress:p,deleteAllMonths:_}}const Hg="sample@sample.com",ho="budget_1767746876726_xuj7nzl4l";function J3({currentUser:t,onComplete:e}){const[n,r]=O.useState(!1),[s,o]=O.useState(!1),[l,d]=O.useState(null),[h,m]=O.useState(null),[p,g]=O.useState(null);async function v(){if(t){r(!0);try{let x=(await Ht("budgets","delete sample user budget: scanning for sample user budgets",[{field:"owner_email",op:"==",value:Hg}])).docs;if(x.length===0){console.log("delete sample user budget: no budgets found by owner_email, checking fallback budget ID");const U=await bt("budgets",ho,"delete sample user budget: checking fallback budget ID");U.exists&&U.data&&(console.log("delete sample user budget: found fallback budget",ho),x=[{id:ho,data:U.data}])}const E=[];let C=0,T=!1;for(const U of x){const G=U.id,k=U.data.name,N=(await Ht("months",`delete sample user budget: counting months for budget ${G}`,[{field:"budget_id",op:"==",value:G}])).docs.length;C+=N,E.push({budgetId:G,budgetName:k,monthCount:N}),(await Ht("payees",`delete sample user budget: checking payees for budget ${G}`,[{field:"budget_id",op:"==",value:G}])).docs.length>0&&(T=!0)}const A=[],B=await Ht("users","delete sample user budget: finding sample user document",[{field:"email",op:"==",value:Hg}]);B.docs.length>0&&B.docs[0].data.budget_ids?.includes(ho)&&(E.some(D=>D.budgetId===ho)||(console.log("delete sample user budget: found stale budget reference in sample user document",ho),A.push(ho))),d({budgets:E,totalBudgets:E.length,totalMonths:C,hasPayees:T,staleBudgetIds:A})}catch(S){console.error("Error scanning for sample user budgets:",S)}finally{r(!1)}}}async function _(){if(!t||!l||l.budgets.length===0&&l.staleBudgetIds.length===0)return;o(!0),m(null);const S=[];let x=0,E=0,C=0;const T=l.totalMonths,A=l.totalBudgets;g({phase:"deleting-months",monthsDeleted:0,totalMonths:T,budgetsDeleted:0,totalBudgets:A,percentComplete:0});for(const U of l.budgets)try{const k=(await Ht("months",`delete sample user budget: fetching month IDs for budget ${U.budgetId}`)).docs.filter(D=>D.data.budget_id===U.budgetId).map(D=>({collectionPath:"months",docId:D.id}));k.length>0&&(await _T(k,`delete sample user budget: deleting ${k.length} months for budget ${U.budgetId}`,D=>{x=D,g({phase:"deleting-months",monthsDeleted:x,totalMonths:T,budgetsDeleted:E,totalBudgets:A,percentComplete:Math.round(x/Math.max(T,1)*60)})}),x=k.length)}catch(G){S.push(`Failed to delete months for budget ${U.budgetId}: ${G instanceof Error?G.message:"Unknown error"}`)}g({phase:"deleting-payees",monthsDeleted:x,totalMonths:T,budgetsDeleted:E,totalBudgets:A,percentComplete:60});for(const U of l.budgets)try{await Fu("payees",U.budgetId,`delete sample user budget: deleting payees for budget ${U.budgetId}`),C++}catch{}g({phase:"deleting-budgets",monthsDeleted:x,totalMonths:T,budgetsDeleted:E,totalBudgets:A,percentComplete:70});for(const U of l.budgets)try{await Fu("budgets",U.budgetId,`delete sample user budget: deleting budget ${U.budgetId}`),E++,g({phase:"deleting-budgets",monthsDeleted:x,totalMonths:T,budgetsDeleted:E,totalBudgets:A,percentComplete:70+Math.round(E/A*10)})}catch(G){S.push(`Failed to delete budget ${U.budgetId}: ${G instanceof Error?G.message:"Unknown error"}`)}g({phase:"updating-user",monthsDeleted:x,totalMonths:T,budgetsDeleted:E,totalBudgets:A,percentComplete:80});const B=[...l.budgets.map(U=>U.budgetId),...l.staleBudgetIds];try{const U=await Ht("users","delete sample user budget: finding sample user document to remove budget references",[{field:"email",op:"==",value:Hg}]);if(U.docs.length>0){const G=U.docs[0],k=G.id,D=G.data,N=(D.budget_ids||[]).filter(F=>!B.includes(F));await tn("users",k,{...D,budget_ids:N,updated_at:new Date().toISOString()},"delete sample user budget: removing deleted budget IDs from sample user document"),console.log(`delete sample user budget: removed ${B.length} budget IDs from sample user document`)}else console.log("delete sample user budget: no sample user document found, skipping user update")}catch(U){S.push(`Failed to update sample user document: ${U instanceof Error?U.message:"Unknown error"}`)}g({phase:"clearing-cache",monthsDeleted:x,totalMonths:T,budgetsDeleted:E,totalBudgets:A,percentComplete:95}),Ra(),g({phase:"complete",monthsDeleted:x,totalMonths:T,budgetsDeleted:E,totalBudgets:A,percentComplete:100}),m({budgetsDeleted:E,monthsDeleted:x,payeesDeleted:C,errors:S}),o(!1),g(null),S.length===0&&(d({budgets:[],totalBudgets:0,totalMonths:0,hasPayees:!1,staleBudgetIds:[]}),e?.())}return{status:l,isScanning:n,scanStatus:v,isDeleting:s,deleteResult:h,deleteProgress:p,deleteSampleUserBudget:_}}function NS(t){if(!t)return 0;let e=0;for(const n of t)ut(n.start_balance??0)&&e++,ut(n.end_balance??0)&&e++,ut(n.allocated??0)&&e++,ut(n.spent??0)&&e++,ut(n.income??0)&&e++,ut(n.expenses??0)&&e++,ut(n.net_change??0)&&e++;return e}function PS(t){if(!t)return 0;let e=0;for(const n of t)ut(n.amount??0)&&e++;return e}async function zS(){const t=await Ht("budgets","precision cleanup: scanning all budgets");let e=0,n=0,r=0,s=0;for(const g of t.docs){const v=g.data;let _=!1;ut(v.total_available??0)&&(s++,_=!0);const S=v.accounts;if(S&&typeof S=="object")for(const E of Object.values(S))ut(E.balance??0)&&(n++,_=!0);const x=v.categories;if(x&&typeof x=="object")for(const E of Object.values(x))ut(E.balance??0)&&(r++,_=!0),ut(E.default_monthly_amount??0)&&(r++,_=!0);_&&e++}const o=await Ht("months","precision cleanup: scanning all months");let l=0,d=0,h=0,m=0,p=0;for(const g of o.docs){const v=g.data;let _=!1;(ut(v.total_income??0)||ut(v.total_expenses??0)||ut(v.previous_month_income??0))&&(_=!0);const S=PS(v.income);S>0&&(d+=S,_=!0);const x=PS(v.expenses);x>0&&(h+=x,_=!0);const E=NS(v.category_balances);E>0&&(m+=E,_=!0);const C=NS(v.account_balances);C>0&&(p+=C,_=!0),_&&l++}return{totalBudgets:t.docs.length,budgetsWithPrecisionIssues:e,accountsWithPrecisionIssues:n,categoriesWithPrecisionIssues:r,totalAvailableWithPrecisionIssues:s,totalMonths:o.docs.length,monthsWithPrecisionIssues:l,incomeValuesWithPrecisionIssues:d,expenseValuesWithPrecisionIssues:h,categoryBalancesWithPrecisionIssues:m,accountBalancesWithPrecisionIssues:p}}function BS(t){const e={...t};return e.start_balance!==void 0&&(e.start_balance=Oe(e.start_balance)),e.end_balance!==void 0&&(e.end_balance=Oe(e.end_balance)),e.allocated!==void 0&&(e.allocated=Oe(e.allocated)),e.spent!==void 0&&(e.spent=Oe(e.spent)),e.income!==void 0&&(e.income=Oe(e.income)),e.expenses!==void 0&&(e.expenses=Oe(e.expenses)),e.transfers!==void 0&&(e.transfers=Oe(e.transfers)),e.adjustments!==void 0&&(e.adjustments=Oe(e.adjustments)),e.net_change!==void 0&&(e.net_change=Oe(e.net_change)),e}function eP(t,e){let n=!1;ut(t.total_available??0)&&(t.total_available=Oe(t.total_available??0),e.totalAvailableFixed++,n=!0);const r=t.accounts;if(r&&typeof r=="object")for(const[o,l]of Object.entries(r)){const d=l;ut(d.balance??0)&&(r[o].balance=Oe(d.balance??0),e.accountsFixed++,n=!0)}const s=t.categories;if(s&&typeof s=="object")for(const[o,l]of Object.entries(s)){const d=l;ut(d.balance??0)&&(s[o].balance=Oe(d.balance??0),e.categoriesFixed++,n=!0),ut(d.default_monthly_amount??0)&&(s[o].default_monthly_amount=Oe(d.default_monthly_amount??0),e.categoriesFixed++,n=!0)}return{fixed:n,data:t}}function tP(t,e){let n=!1;if(ut(t.total_income??0)&&(t.total_income=Oe(t.total_income??0),n=!0),ut(t.total_expenses??0)&&(t.total_expenses=Oe(t.total_expenses??0),n=!0),ut(t.previous_month_income??0)&&(t.previous_month_income=Oe(t.previous_month_income??0),n=!0),t.income&&Array.isArray(t.income)){const r=[];for(const s of t.income)ut(s.amount??0)?(r.push({...s,amount:Oe(s.amount??0)}),e.incomeValuesFixed++,n=!0):r.push(s);t.income=r}if(t.expenses&&Array.isArray(t.expenses)){const r=[];for(const s of t.expenses)ut(s.amount??0)?(r.push({...s,amount:Oe(s.amount??0)}),e.expenseValuesFixed++,n=!0):r.push(s);t.expenses=r}if(t.category_balances&&Array.isArray(t.category_balances)){const r=[];for(const s of t.category_balances)ut(s.start_balance??0)||ut(s.end_balance??0)||ut(s.allocated??0)||ut(s.spent??0)||ut(s.transfers??0)||ut(s.adjustments??0)?(r.push(BS(s)),e.categoryBalancesFixed++,n=!0):r.push(s);t.category_balances=r}if(t.account_balances&&Array.isArray(t.account_balances)){const r=[];for(const s of t.account_balances)ut(s.start_balance??0)||ut(s.end_balance??0)||ut(s.income??0)||ut(s.expenses??0)||ut(s.transfers??0)||ut(s.adjustments??0)||ut(s.net_change??0)?(r.push(BS(s)),e.accountBalancesFixed++,n=!0):r.push(s);t.account_balances=r}return{fixed:n,data:t}}function nP(t,e,n){const r={...t.data},{fixed:s,data:o}=eP(r,n),l=s?{budgetId:t.id,data:o}:null;s&&n.budgetsProcessed++;const d=[];let h=!1;for(const m of e){const p={...m.data},{fixed:g,data:v}=tP(p,n);g&&(n.monthsProcessed++,h=!0),d.push(v)}return{budgetUpdate:l,fixedMonths:d,hasMonthFixes:h}}async function rP(){const t={budgetsProcessed:0,accountsFixed:0,categoriesFixed:0,totalAvailableFixed:0,monthsProcessed:0,incomeValuesFixed:0,expenseValuesFixed:0,categoryBalancesFixed:0,accountBalancesFixed:0,errors:[]},{budgets:e,monthsByBudget:n}=await Gi("precision cleanup"),r=[],s=[];for(const o of e)try{const l=n.get(o.id)||[],{budgetUpdate:d,fixedMonths:h,hasMonthFixes:m}=nP(o,l,t);d&&r.push(d),(m||h.length>0)&&s.push({budgetId:o.id,months:h})}catch(l){t.errors.push(`Budget ${o.id}: ${l instanceof Error?l.message:String(l)}`)}if(r.length>0)try{await U0(r,"precision cleanup")}catch(o){t.errors.push(`Budget batch write: ${o instanceof Error?o.message:String(o)}`)}for(const{budgetId:o,months:l}of s)try{await NT(o,l,"precision cleanup")}catch(d){t.errors.push(`Budget ${o} recalc: ${d instanceof Error?d.message:String(d)}`)}return t}function iP({currentUser:t,onComplete:e}){const[n,r]=O.useState(null),[s,o]=O.useState(!1),[l,d]=O.useState(!1),[h,m]=O.useState(null),[p,g]=O.useState(null),v=n?n.accountsWithPrecisionIssues+n.categoriesWithPrecisionIssues+n.totalAvailableWithPrecisionIssues+n.incomeValuesWithPrecisionIssues+n.expenseValuesWithPrecisionIssues+n.categoryBalancesWithPrecisionIssues+n.accountBalancesWithPrecisionIssues:0,_=v>0,S=O.useCallback(async()=>{if(t){o(!0),g(null);try{const E=await zS();r(E),m(null)}catch(E){g(E instanceof Error?E.message:"Failed to scan for precision issues")}finally{o(!1)}}},[t]),x=O.useCallback(async()=>{if(!(!t||!_)){d(!0),g(null);try{const E=await fc(()=>rP());m(E);const C=await zS();r(C),e?.()}catch(E){g(E instanceof Error?E.message:"Failed to run precision cleanup")}finally{d(!1)}}},[t,_,e]);return O.useEffect(()=>{t&&!n&&!s&&S()},[t,n,s,S]),{status:n,isScanning:s,isRunning:l,result:h,error:p,totalIssues:v,hasIssues:_,hasData:n!==null,scan:S,runCleanup:x}}const sP=["unknown","Unknown","UNKNOWN","","null","undefined","N/A","n/a"],aP=["unknown","Unknown","UNKNOWN","","null","undefined","N/A","n/a"];function bm(t){return!t||Qe(t)?!0:sP.includes(t)}function vm(t){return!t||it(t)?!0:aP.includes(t)}function HT(t){return bm(t.account_id)||vm(t.category_id)}function oP(t){return{id:t.id.replace("expense_","adjustment_"),amount:t.amount,account_id:bm(t.account_id)?Vt:t.account_id,category_id:vm(t.category_id)?Qt:t.category_id,date:t.date,description:t.description||t.payee,cleared:t.cleared,created_at:t.created_at}}function lP(t){const e=t.data,n=e.expenses||[],r=e.adjustments||[],s=[],o=[];let l=0,d=0;for(const m of n)HT(m)?(bm(m.account_id)&&!Qe(m.account_id)&&l++,vm(m.category_id)&&!it(m.category_id)&&d++,o.push(oP(m))):s.push(m);return o.length===0?{needsUpdate:!1,updatedMonth:null,stats:{expensesMigrated:0,invalidAccountsFixed:0,invalidCategoriesFixed:0}}:{needsUpdate:!0,updatedMonth:fr({...e,expenses:s,adjustments:[...r,...o],transfers:e.transfers||[],updated_at:new Date().toISOString()}),stats:{expensesMigrated:o.length,invalidAccountsFixed:l,invalidCategoriesFixed:d}}}async function cP(){const{budgets:t,monthsByBudget:e}=await Gi("expense-to-adjustment-scan");let n=0,r=0,s=0,o=0;for(const l of t){const d=e.get(l.id)||[];n+=d.length;for(const h of d){const p=h.data.expenses||[];for(const g of p)HT(g)&&(r++,bm(g.account_id)&&!Qe(g.account_id)&&s++,vm(g.category_id)&&!it(g.category_id)&&o++)}}return{totalBudgets:t.length,totalMonths:n,expensesToMigrate:r,invalidAccountsToFix:s,invalidCategoriesToFix:o}}async function uP(){const{budgets:t,monthsByBudget:e}=await Gi("expense-to-adjustment-migration"),n=[];let r=0,s=0,o=0;const l=[];for(const d of t){const h=e.get(d.id)||[];for(const m of h)try{const{needsUpdate:p,updatedMonth:g,stats:v}=lP(m);p&&g&&(n.push({budgetId:d.id,year:m.year,month:m.month,data:g}),r+=v.expensesMigrated,s+=v.invalidAccountsFixed,o+=v.invalidCategoriesFixed)}catch(p){l.push(`Month ${m.year}/${m.month} in budget ${d.id}: ${p instanceof Error?p.message:String(p)}`)}}return n.length>0&&await md(n,"expense-to-adjustment-migration"),{budgetsProcessed:t.length,monthsProcessed:n.length,expensesMigrated:r,invalidAccountsFixed:s,invalidCategoriesFixed:o,errors:l}}function dP({currentUser:t,onComplete:e}){const[n,r]=O.useState(!1),[s,o]=O.useState(!1),[l,d]=O.useState(null),[h,m]=O.useState(null);async function p(){if(t){r(!0);try{const _=await cP();d(_)}catch(_){console.error("Failed to scan for expense to adjustment migration:",_)}finally{r(!1)}}}async function g(){if(t){o(!0),m(null);try{const _=await fc(()=>uP());m(_),e?.()}catch(_){m({budgetsProcessed:0,monthsProcessed:0,expensesMigrated:0,invalidAccountsFixed:0,invalidCategoriesFixed:0,errors:[_ instanceof Error?_.message:"Unknown error"]})}finally{o(!1)}}}const v=l!==null&&l.expensesToMigrate>0;return{status:l,isScanning:n,scanStatus:p,hasItemsToMigrate:v,isRunning:s,result:h,runMigration:g}}function qT(t){const e=new Set,n=new Set,r=t.categories;if(r)for(const o of Object.keys(r))e.add(o);const s=t.accounts;if(s)for(const o of Object.keys(s))n.add(o);return{categoryIds:e,accountIds:n}}function ma(t,e){return!t||it(t)?!1:!e.has(t)}function Mi(t,e){return!t||Qe(t)?!1:!e.has(t)}function hP(t,e){const n=t.data;let r=0,s=0,o=0,l=0,d=0,h=0,m=!1;const p=(n.expenses||[]).map(x=>{const E={...x};let C=!1;return ma(x.category_id,e.categoryIds)&&(E.category_id=Qt,r++,C=!0),Mi(x.account_id,e.accountIds)&&(E.account_id=Vt,s++,C=!0),C&&(o++,m=!0),E}),g=(n.income||[]).map(x=>{const E={...x};let C=!1;return Mi(x.account_id,e.accountIds)&&(E.account_id=Vt,s++,C=!0),C&&(l++,m=!0),E}),v=(n.transfers||[]).map(x=>{const E={...x};let C=!1;return ma(x.from_category_id,e.categoryIds)&&(E.from_category_id=Qt,r++,C=!0),ma(x.to_category_id,e.categoryIds)&&(E.to_category_id=Qt,r++,C=!0),Mi(x.from_account_id,e.accountIds)&&(E.from_account_id=Vt,s++,C=!0),Mi(x.to_account_id,e.accountIds)&&(E.to_account_id=Vt,s++,C=!0),C&&(d++,m=!0),E}),_=(n.adjustments||[]).map(x=>{const E={...x};let C=!1;return ma(x.category_id,e.categoryIds)&&(E.category_id=Qt,r++,C=!0),Mi(x.account_id,e.accountIds)&&(E.account_id=Vt,s++,C=!0),C&&(h++,m=!0),E});return m?{needsUpdate:!0,updatedMonth:{...n,expenses:p,income:g,transfers:v,adjustments:_,updated_at:new Date().toISOString()},stats:{categoryIdsFixed:r,accountIdsFixed:s,affectedExpenses:o,affectedIncome:l,affectedTransfers:d,affectedAdjustments:h}}:{needsUpdate:!1,updatedMonth:null,stats:{categoryIdsFixed:0,accountIdsFixed:0,affectedExpenses:0,affectedIncome:0,affectedTransfers:0,affectedAdjustments:0}}}async function fP(){const{budgets:t,monthsByBudget:e}=await Gi("orphaned-id-scan");let n=0,r=0,s=0,o=0,l=0,d=0,h=0;for(const m of t){const p=qT(m.data),g=e.get(m.id)||[];n+=g.length;for(const v of g){const _=v.data;for(const S of _.expenses||[]){let x=!1;ma(S.category_id,p.categoryIds)&&(r++,x=!0),Mi(S.account_id,p.accountIds)&&(s++,x=!0),x&&o++}for(const S of _.income||[])Mi(S.account_id,p.accountIds)&&(s++,l++);for(const S of _.transfers||[]){let x=!1;ma(S.from_category_id,p.categoryIds)&&(r++,x=!0),ma(S.to_category_id,p.categoryIds)&&(r++,x=!0),Mi(S.from_account_id,p.accountIds)&&(s++,x=!0),Mi(S.to_account_id,p.accountIds)&&(s++,x=!0),x&&d++}for(const S of _.adjustments||[]){let x=!1;ma(S.category_id,p.categoryIds)&&(r++,x=!0),Mi(S.account_id,p.accountIds)&&(s++,x=!0),x&&h++}}}return{totalBudgets:t.length,totalMonths:n,orphanedCategoryIds:r,orphanedAccountIds:s,affectedExpenses:o,affectedIncome:l,affectedTransfers:d,affectedAdjustments:h}}async function mP(){const{budgets:t,monthsByBudget:e}=await Gi("orphaned-id-cleanup"),n=[];let r=0,s=0;const o=[];for(const l of t){const d=qT(l.data),h=e.get(l.id)||[];for(const m of h)try{const{needsUpdate:p,updatedMonth:g,stats:v}=hP(m,d);p&&g&&(n.push({budgetId:l.id,year:m.year,month:m.month,data:g}),r+=v.categoryIdsFixed,s+=v.accountIdsFixed)}catch(p){o.push(`Month ${m.year}/${m.month} in budget ${l.id}: ${p instanceof Error?p.message:String(p)}`)}}return n.length>0&&await md(n,"orphaned-id-cleanup"),{budgetsProcessed:t.length,monthsProcessed:n.length,categoryIdsFixed:r,accountIdsFixed:s,errors:o}}function pP({currentUser:t,onComplete:e}){const[n,r]=O.useState(!1),[s,o]=O.useState(!1),[l,d]=O.useState(null),[h,m]=O.useState(null);async function p(){if(t){r(!0);try{const _=await fP();d(_)}catch(_){console.error("Failed to scan for orphaned IDs:",_)}finally{r(!1)}}}async function g(){if(t){o(!0),m(null);try{const _=await fc(()=>mP());m(_),e?.()}catch(_){m({budgetsProcessed:0,monthsProcessed:0,categoryIdsFixed:0,accountIdsFixed:0,errors:[_ instanceof Error?_.message:"Unknown error"]})}finally{o(!1)}}}const v=l!==null&&(l.orphanedCategoryIds>0||l.orphanedAccountIds>0);return{status:l,isScanning:n,scanStatus:p,hasItemsToFix:v,isRunning:s,result:h,runMigration:g}}function gP(t,e){if(t.date!==e.date||Math.abs(t.amount+e.amount)>.001)return null;const n=t.amount<0?t:e,r=t.amount<0?e:t,s=it(t.category_id)&&it(e.category_id),o=!Qe(t.account_id)&&!Qe(e.account_id),l=t.account_id!==e.account_id;if(s&&o&&l)return{negative:n,positive:r,type:"account"};const d=Qe(t.account_id)&&Qe(e.account_id),h=!it(t.category_id)&&!it(e.category_id),m=t.category_id!==e.category_id;return d&&h&&m?{negative:n,positive:r,type:"category"}:null}function GT(t){const e=[],n=new Set;for(let r=0;r<t.length;r++)if(!n.has(t[r].id))for(let s=r+1;s<t.length;s++){if(n.has(t[s].id))continue;const o=gP(t[r],t[s]);if(o){e.push(o),n.add(t[r].id),n.add(t[s].id);break}}return e}function yP(t){const{negative:e,positive:n,type:r}=t;return r==="account"?{id:`transfer_from_adj_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,amount:Math.abs(e.amount),from_account_id:e.account_id,to_account_id:n.account_id,from_category_id:Qt,to_category_id:Qt,date:e.date,description:e.description||n.description||"Transfer",cleared:e.cleared&&n.cleared,created_at:new Date().toISOString()}:{id:`transfer_from_adj_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,amount:Math.abs(e.amount),from_account_id:Vt,to_account_id:Vt,from_category_id:e.category_id,to_category_id:n.category_id,date:e.date,description:e.description||n.description||"Transfer",cleared:e.cleared&&n.cleared,created_at:new Date().toISOString()}}function _P(t){const e=t.data,n=e.adjustments||[],r=e.transfers||[],s=GT(n);if(s.length===0)return{needsUpdate:!1,updatedMonth:null,stats:{pairsConverted:0,adjustmentsRemoved:0}};const o=s.map(yP),l=new Set;for(const m of s)l.add(m.negative.id),l.add(m.positive.id);const d=n.filter(m=>!l.has(m.id));return{needsUpdate:!0,updatedMonth:{...e,adjustments:d,transfers:[...r,...o],updated_at:new Date().toISOString()},stats:{pairsConverted:s.length,adjustmentsRemoved:l.size}}}async function bP(){const{budgets:t,monthsByBudget:e}=await Gi("adjustments-to-transfers-scan");let n=0,r=0,s=0,o=0;for(const l of t){const d=e.get(l.id)||[];n+=d.length;for(const h of d){const p=h.data.adjustments||[],g=GT(p);r+=g.length;for(const v of g)v.type==="account"?s++:o++}}return{totalBudgets:t.length,totalMonths:n,pairsFound:r,accountTransferPairs:s,categoryTransferPairs:o}}async function vP(){const{budgets:t,monthsByBudget:e}=await Gi("adjustments-to-transfers-migration"),n=[];let r=0,s=0;const o=[];for(const l of t){const d=e.get(l.id)||[];for(const h of d)try{const{needsUpdate:m,updatedMonth:p,stats:g}=_P(h);m&&p&&(n.push({budgetId:l.id,year:h.year,month:h.month,data:p}),r+=g.pairsConverted,s+=g.adjustmentsRemoved)}catch(m){o.push(`Month ${h.year}/${h.month} in budget ${l.id}: ${m instanceof Error?m.message:String(m)}`)}}return n.length>0&&await md(n,"adjustments-to-transfers-migration"),{budgetsProcessed:t.length,monthsProcessed:n.length,transfersCreated:r,adjustmentsRemoved:s,errors:o}}function xP({currentUser:t,onComplete:e}){const[n,r]=O.useState(!1),[s,o]=O.useState(!1),[l,d]=O.useState(null),[h,m]=O.useState(null);async function p(){if(t){r(!0);try{const _=await bP();d(_)}catch(_){console.error("Failed to scan for adjustment pairs:",_)}finally{r(!1)}}}async function g(){if(t){o(!0),m(null);try{const _=await fc(()=>vP());m(_),e?.()}catch(_){m({budgetsProcessed:0,monthsProcessed:0,transfersCreated:0,adjustmentsRemoved:0,errors:[_ instanceof Error?_.message:"Unknown error"]})}finally{o(!1)}}}const v=l!==null&&l.pairsFound>0;return{status:l,isScanning:n,scanStatus:p,hasPairsToConvert:v,isRunning:s,result:h,runMigration:g}}function wP(t){const e=[];let n="",r=!1;for(let s=0;s<t.length;s++){const o=t[s];o==='"'?r=!r:o===","&&!r?(e.push(n.trim()),n=""):n+=o}return e.push(n.trim()),e}function SP(t){if(!t)return 0;let e=t.replace(/[$\s]/g,"");const n=e.startsWith("(")||e.startsWith("-");e=e.replace(/[()]/g,"").replace("-",""),e=e.replace(/,/g,"");const r=parseFloat(e);return isNaN(r)?0:n?-r:r}function EP(t){if(!t)return null;const e=t.split("/");if(e.length!==3)return null;const n=parseInt(e[0],10),r=parseInt(e[1],10),s=parseInt(e[2],10);return isNaN(n)||isNaN(r)||isNaN(s)||n<1||n>12||r<1||r>31?null:{year:s,month:n,day:r}}function CP(t){if(!t)return!1;const e=t.toLowerCase().trim();return e==="true"||e==="1"||e==="yes"}function TP(t,e){return e.toLowerCase()==="income"?"income":t.toLowerCase()==="budget allocation"?"allocation":"spend"}function AP(t){const e=t.split(`
`).filter(r=>r.trim()),n=[];for(const r of e){const s=wP(r);if(s.length<5)continue;const[o,l,d,h,m,p,g]=s;if(o.toLowerCase()==="cash flow"||o.toLowerCase()==="date")continue;const v=EP(o);if(!v)continue;const _=TP(l,d),S=SP(m),x=CP(g||"");n.push({recordType:_,date:o,year:v.year,month:v.month,day:v.day,payee:l,category:d,account:h,amount:S,description:p||"",cleared:x,rawLine:r})}return n}function jP(t){return!t.account_id||t.account_id.trim()===""?"Missing account_id (empty or undefined)":null}function RP(t){const e=[];return(!t.account_id||t.account_id.trim()==="")&&e.push("missing account_id"),(!t.category_id||t.category_id.trim()==="")&&e.push("missing category_id"),e.length>0?e.join(", "):null}function IP(t){const e=Qe(t.account_id)||!t.account_id||t.account_id.trim()==="",n=it(t.category_id)||!t.category_id||t.category_id.trim()==="";return e&&n?"Both account_id and category_id are missing/NO_* (must have at least one real ID)":null}function DP(t){const e=[];if((!t.from_account_id||t.from_account_id.trim()==="")&&e.push("missing from_account_id"),(!t.to_account_id||t.to_account_id.trim()==="")&&e.push("missing to_account_id"),(!t.from_category_id||t.from_category_id.trim()==="")&&e.push("missing from_category_id"),(!t.to_category_id||t.to_category_id.trim()==="")&&e.push("missing to_category_id"),e.length>0)return e.join(", ");const n=t.from_account_id===t.to_account_id,r=t.from_category_id===t.to_category_id;if(n&&r)return"Transfer has same from/to on both account and category (nothing would transfer)";const s=Qe(t.from_account_id),o=Qe(t.to_account_id),l=it(t.from_category_id),d=it(t.to_category_id);return s&&o&&l&&d?"All from/to account and category IDs are NO_* (must involve at least one real entity)":s&&o&&r?"Both accounts are NO_ACCOUNT and categories are the same (nothing transfers)":l&&d&&n?"Both categories are NO_CATEGORY and accounts are the same (nothing transfers)":null}function Qh(t,e,n,r,s){return t.filter(o=>{const[l,d,h]=e.split("-").map(Number);return o.year!==l||o.month!==d||o.day!==h||Math.abs(Math.abs(o.amount)-Math.abs(n))>.01?!1:(r&&o.payee&&o.payee.toLowerCase()===r.toLowerCase()||s&&o.description&&o.description.toLowerCase().includes(s.toLowerCase()),!0)})}async function kP(t){const e=[];let n=0,r=0,s=0,o=0;const l=t?AP(t):[],{budgets:d,monthsByBudget:h}=await Gi("account-category-validation");for(const m of d){const p=h.get(m.id)||[];for(const g of p){const v=g.data,_=`${v.year}-${String(v.month).padStart(2,"0")}`,S=v.income||[];n+=S.length;for(const T of S){const A=jP(T);A&&e.push({budgetId:m.id,monthKey:_,transactionType:"income",transactionId:T.id,violation:A,transactionDetails:{date:T.date,amount:T.amount,payee:T.payee,description:T.description,accountId:T.account_id},potentialSeedMatches:Qh(l,T.date,T.amount,T.payee,T.description)})}const x=v.expenses||[];r+=x.length;for(const T of x){const A=RP(T);A&&e.push({budgetId:m.id,monthKey:_,transactionType:"expense",transactionId:T.id,violation:A,transactionDetails:{date:T.date,amount:T.amount,payee:T.payee,description:T.description,accountId:T.account_id,categoryId:T.category_id},potentialSeedMatches:Qh(l,T.date,T.amount,T.payee,T.description)})}const E=v.adjustments||[];s+=E.length;for(const T of E){const A=IP(T);A&&e.push({budgetId:m.id,monthKey:_,transactionType:"adjustment",transactionId:T.id,violation:A,transactionDetails:{date:T.date,amount:T.amount,description:T.description,accountId:T.account_id,categoryId:T.category_id},potentialSeedMatches:Qh(l,T.date,T.amount,void 0,T.description)})}const C=v.transfers||[];o+=C.length;for(const T of C){const A=DP(T);A&&e.push({budgetId:m.id,monthKey:_,transactionType:"transfer",transactionId:T.id,violation:A,transactionDetails:{date:T.date,amount:T.amount,description:T.description,fromAccountId:T.from_account_id,toAccountId:T.to_account_id,fromCategoryId:T.from_category_id,toCategoryId:T.to_category_id},potentialSeedMatches:Qh(l,T.date,T.amount,void 0,T.description)})}}}return e.sort((m,p)=>{const g=m.monthKey.localeCompare(p.monthKey);return g!==0?g:m.transactionType.localeCompare(p.transactionType)}),{totalBudgets:d.length,totalMonths:Array.from(h.values()).reduce((m,p)=>m+p.length,0),totalIncome:n,totalExpenses:r,totalAdjustments:s,totalTransfers:o,violations:e,scannedAt:new Date().toISOString()}}function OP(t){const e=[];if(e.push("=".repeat(80),"ACCOUNT/CATEGORY VALIDATION REPORT",`Scanned at: ${t.scannedAt}`,"=".repeat(80),"","SUMMARY:"),e.push(`  Budgets scanned: ${t.totalBudgets}`,`  Months scanned: ${t.totalMonths}`,`  Income transactions: ${t.totalIncome}`,`  Expense transactions: ${t.totalExpenses}`,`  Adjustment transactions: ${t.totalAdjustments}`,`  Transfer transactions: ${t.totalTransfers}`,`  VIOLATIONS FOUND: ${t.violations.length}`,""),t.violations.length===0)return e.push(" No violations found!"),e.join(`
`);const n=new Map;for(const r of t.violations)n.has(r.transactionType)||n.set(r.transactionType,[]),n.get(r.transactionType).push(r);e.push("-".repeat(80),"VIOLATIONS BY TYPE:","-".repeat(80));for(const[r,s]of n){e.push("",`## ${r.toUpperCase()} (${s.length} violations)`,"");for(const o of s){if(e.push(`  [${o.monthKey}] ID: ${o.transactionId}`,`    Violation: ${o.violation}`,`    Date: ${o.transactionDetails.date}`,`    Amount: ${o.transactionDetails.amount}`),o.transactionDetails.payee&&e.push(`    Payee: ${o.transactionDetails.payee}`),o.transactionDetails.description&&e.push(`    Description: ${o.transactionDetails.description}`),o.transactionDetails.accountId!==void 0&&e.push(`    Account ID: ${o.transactionDetails.accountId||"(empty)"}`),o.transactionDetails.categoryId!==void 0&&e.push(`    Category ID: ${o.transactionDetails.categoryId||"(empty)"}`),o.transactionDetails.fromAccountId!==void 0&&e.push(`    From Account: ${o.transactionDetails.fromAccountId||"(empty)"}`,`    To Account: ${o.transactionDetails.toAccountId||"(empty)"}`,`    From Category: ${o.transactionDetails.fromCategoryId||"(empty)"}`,`    To Category: ${o.transactionDetails.toCategoryId||"(empty)"}`),o.potentialSeedMatches.length>0){e.push(`    POTENTIAL SEED MATCHES (${o.potentialSeedMatches.length}):`);for(const l of o.potentialSeedMatches.slice(0,5))e.push(`      - Line: ${l.rawLine}`,`        Type: ${l.recordType}, Date: ${l.date}, Payee: ${l.payee}`,`        Category: ${l.category}, Account: ${l.account}`);o.potentialSeedMatches.length>5&&e.push(`      ... and ${o.potentialSeedMatches.length-5} more matches`)}else e.push("    No seed matches found");e.push("")}}return e.join(`
`)}function MP({currentUser:t}){const[e,n]=O.useState(!1),[r,s]=O.useState(null),[o,l]=O.useState(null);async function d(h){if(t){n(!0),s(null),l(null);try{const m=await kP(h);s(m),l(OP(m))}catch(m){console.error("Failed to scan transactions:",m),l(`Error scanning: ${m instanceof Error?m.message:"Unknown error"}`)}finally{n(!1)}}}return{isScanning:e,status:r,report:o,scan:d,hasViolations:r!==null&&r.violations.length>0,violationCount:r?.violations.length??0}}const NP=[{id:"adjustment_import_1767473622525_qzkq34i7r",amount:14877.86,date:"2020-08-23",description:"Starting Balance on app switchover",targetAccount:"Alerus 401K Eide Bailly",targetCategory:null},{id:"adjustment_import_1767473622530_nj6pnwlb2",amount:-2e3,date:"2022-03-01",description:"Transfer",targetAccount:null,targetCategory:"House"}];async function PP(){const{budgets:t,monthsByBudget:e}=await Gi("hidden-field-migration-scan");let n=0,r=0,s=0,o=0;const l=[];for(const d of t){const h=d.data,m=h.accounts;if(m&&typeof m=="object")for(const v of Object.values(m))v.is_hidden===void 0&&n++;const p=h.categories;if(p&&typeof p=="object")for(const v of Object.values(p))v.is_hidden===void 0&&r++;const g=e.get(d.id)||[];o+=g.length;for(const v of g){const _=v.data,S=`${_.year}-${String(_.month).padStart(2,"0")}`;for(const x of _.adjustments||[]){const E=Qe(x.account_id)||!x.account_id,C=it(x.category_id)||!x.category_id;E&&C&&(s++,l.push({monthKey:S,id:x.id,description:x.description||"",amount:x.amount,accountId:x.account_id,categoryId:x.category_id}))}}}return{totalBudgets:t.length,totalMonths:o,accountsNeedingField:n,categoriesNeedingField:r,adjustmentsToFix:s,adjustmentDetails:l}}async function zP(t){const e={budgetsProcessed:0,accountsUpdated:0,categoriesUpdated:0,hiddenAccountsCreated:0,hiddenCategoriesCreated:0,adjustmentsFixed:0,errors:[]};t.setStage("Reading all budgets and months..."),t.setProgress(null);const{budgets:n,monthsByBudget:r}=await Gi("hidden-field-migration");t.setDetails(`Found ${n.length} budget(s) to process`);const s=[],o=[];t.setStage("Processing budgets...");for(let l=0;l<n.length;l++){const d=n[l];t.updateItemProgress(l+1,n.length,`Budget: ${d.data.name||d.id}`);try{const h={...d.data};let m=!1;const p={...h.accounts||{}},g={...h.categories||{}};for(const[C,T]of Object.entries(p))T.is_hidden===void 0&&(p[C]={...T,is_hidden:!1},e.accountsUpdated++,m=!0);for(const[C,T]of Object.entries(g))T.is_hidden===void 0&&(g[C]={...T,is_hidden:!1},e.categoriesUpdated++,m=!0);let v=null;const _="Alerus 401K Eide Bailly";for(const[C,T]of Object.entries(p))if(T.nickname?.toLowerCase()===_.toLowerCase()){v=C;break}if(v)p[v].is_hidden||(p[v]={...p[v],is_hidden:!0},m=!0);else{v=`account_hidden_${Date.now()}_alerus`;const C=Math.max(0,...Object.values(p).map(T=>T.sort_order||0));p[v]={nickname:_,description:"Historical 401K account (hidden)",balance:0,account_group_id:null,sort_order:C+1,is_income_account:!1,is_income_default:!1,is_outgo_account:!1,is_outgo_default:!1,on_budget:!1,is_active:!0,is_hidden:!0},e.hiddenAccountsCreated++,m=!0}let S=null;const x="House";for(const[C,T]of Object.entries(g))if(T.name?.toLowerCase()===x.toLowerCase()){S=C;break}if(S)g[S].is_hidden||(g[S]={...g[S],is_hidden:!0},m=!0);else{S=`category_hidden_${Date.now()}_house`;const C=Math.max(0,...Object.values(g).map(T=>T.sort_order||0));g[S]={name:x,description:"Historical house-related transactions (hidden)",category_group_id:null,sort_order:C+1,default_monthly_amount:0,default_monthly_type:"fixed",balance:0,is_hidden:!0},e.hiddenCategoriesCreated++,m=!0}const E=r.get(d.id)||[];for(const C of E){const T=C.data;let A=!1;const B=(T.adjustments||[]).map(U=>{const G=Qe(U.account_id)||!U.account_id,k=it(U.category_id)||!U.category_id;if(G&&k){const D=NP.find(N=>N.id===U.id||Math.abs(N.amount-U.amount)<.01&&N.date===U.date&&N.description.toLowerCase()===(U.description||"").toLowerCase());if(D){const N={...U};return D.targetAccount&&(N.account_id=v),D.targetCategory&&(N.category_id=S),e.adjustmentsFixed++,A=!0,N}}return U});A&&o.push({budgetId:d.id,year:T.year,month:T.month,data:{...T,adjustments:B}})}m&&(s.push({budgetId:d.id,data:{...h,accounts:p,categories:g,updated_at:new Date().toISOString()}}),e.budgetsProcessed++)}catch(h){e.errors.push(`Budget ${d.id}: ${h instanceof Error?h.message:String(h)}`)}}return s.length>0&&(t.setStage("Writing budget updates..."),t.setProgress(null),t.setCurrentItem(`${s.length} budget(s) to update`),await U0(s,"hidden-field-migration")),o.length>0&&(t.setStage("Writing month updates and recalculating..."),t.setCurrentItem(`${o.length} month(s) to update`),await PT(o,"hidden-field-migration")),t.setStage("Migration complete"),t.setProgress(100),e}function BP({currentUser:t}){const[e,n]=O.useState(!1),[r,s]=O.useState(!1),[o,l]=O.useState(null),[d,h]=O.useState(null),{runMigrationWithProgress:m}=OT();async function p(){if(t){n(!0);try{const S=await PP();l(S)}catch(S){console.error("Failed to scan hidden field status:",S)}finally{n(!1)}}}async function g(){if(t){s(!0),h(null);try{const S=await m("Hidden Field Migration",x=>zP(x));h(S)}catch(S){h({budgetsProcessed:0,accountsUpdated:0,categoriesUpdated:0,hiddenAccountsCreated:0,hiddenCategoriesCreated:0,adjustmentsFixed:0,errors:[S instanceof Error?S.message:"Unknown error"]})}finally{s(!1)}}}const v=o!==null&&(o.accountsNeedingField>0||o.categoriesNeedingField>0||o.adjustmentsToFix>0),_=o!==null?o.accountsNeedingField+o.categoriesNeedingField+o.adjustmentsToFix:0;return{isScanning:e,isRunning:r,status:o,result:d,scanStatus:p,runMigration:g,needsMigration:v,totalItemsToFix:_}}function Kh(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var qg={exports:{}};var LS;function LP(){return LS||(LS=1,(function(t,e){(function(n){t.exports=n()})(function(){return(function n(r,s,o){function l(m,p){if(!s[m]){if(!r[m]){var g=typeof Kh=="function"&&Kh;if(!p&&g)return g(m,!0);if(d)return d(m,!0);var v=new Error("Cannot find module '"+m+"'");throw v.code="MODULE_NOT_FOUND",v}var _=s[m]={exports:{}};r[m][0].call(_.exports,function(S){var x=r[m][1][S];return l(x||S)},_,_.exports,n,r,s,o)}return s[m].exports}for(var d=typeof Kh=="function"&&Kh,h=0;h<o.length;h++)l(o[h]);return l})({1:[function(n,r,s){var o=n("./utils"),l=n("./support"),d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";s.encode=function(h){for(var m,p,g,v,_,S,x,E=[],C=0,T=h.length,A=T,B=o.getTypeOf(h)!=="string";C<h.length;)A=T-C,g=B?(m=h[C++],p=C<T?h[C++]:0,C<T?h[C++]:0):(m=h.charCodeAt(C++),p=C<T?h.charCodeAt(C++):0,C<T?h.charCodeAt(C++):0),v=m>>2,_=(3&m)<<4|p>>4,S=1<A?(15&p)<<2|g>>6:64,x=2<A?63&g:64,E.push(d.charAt(v)+d.charAt(_)+d.charAt(S)+d.charAt(x));return E.join("")},s.decode=function(h){var m,p,g,v,_,S,x=0,E=0,C="data:";if(h.substr(0,C.length)===C)throw new Error("Invalid base64 input, it looks like a data url.");var T,A=3*(h=h.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(h.charAt(h.length-1)===d.charAt(64)&&A--,h.charAt(h.length-2)===d.charAt(64)&&A--,A%1!=0)throw new Error("Invalid base64 input, bad content length.");for(T=l.uint8array?new Uint8Array(0|A):new Array(0|A);x<h.length;)m=d.indexOf(h.charAt(x++))<<2|(v=d.indexOf(h.charAt(x++)))>>4,p=(15&v)<<4|(_=d.indexOf(h.charAt(x++)))>>2,g=(3&_)<<6|(S=d.indexOf(h.charAt(x++))),T[E++]=m,_!==64&&(T[E++]=p),S!==64&&(T[E++]=g);return T}},{"./support":30,"./utils":32}],2:[function(n,r,s){var o=n("./external"),l=n("./stream/DataWorker"),d=n("./stream/Crc32Probe"),h=n("./stream/DataLengthProbe");function m(p,g,v,_,S){this.compressedSize=p,this.uncompressedSize=g,this.crc32=v,this.compression=_,this.compressedContent=S}m.prototype={getContentWorker:function(){var p=new l(o.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new h("data_length")),g=this;return p.on("end",function(){if(this.streamInfo.data_length!==g.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),p},getCompressedWorker:function(){return new l(o.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},m.createWorkerFrom=function(p,g,v){return p.pipe(new d).pipe(new h("uncompressedSize")).pipe(g.compressWorker(v)).pipe(new h("compressedSize")).withStreamInfo("compression",g)},r.exports=m},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(n,r,s){var o=n("./stream/GenericWorker");s.STORE={magic:"\0\0",compressWorker:function(){return new o("STORE compression")},uncompressWorker:function(){return new o("STORE decompression")}},s.DEFLATE=n("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(n,r,s){var o=n("./utils"),l=(function(){for(var d,h=[],m=0;m<256;m++){d=m;for(var p=0;p<8;p++)d=1&d?3988292384^d>>>1:d>>>1;h[m]=d}return h})();r.exports=function(d,h){return d!==void 0&&d.length?o.getTypeOf(d)!=="string"?(function(m,p,g,v){var _=l,S=v+g;m^=-1;for(var x=v;x<S;x++)m=m>>>8^_[255&(m^p[x])];return-1^m})(0|h,d,d.length,0):(function(m,p,g,v){var _=l,S=v+g;m^=-1;for(var x=v;x<S;x++)m=m>>>8^_[255&(m^p.charCodeAt(x))];return-1^m})(0|h,d,d.length,0):0}},{"./utils":32}],5:[function(n,r,s){s.base64=!1,s.binary=!1,s.dir=!1,s.createFolders=!0,s.date=null,s.compression=null,s.compressionOptions=null,s.comment=null,s.unixPermissions=null,s.dosPermissions=null},{}],6:[function(n,r,s){var o=null;o=typeof Promise<"u"?Promise:n("lie"),r.exports={Promise:o}},{lie:37}],7:[function(n,r,s){var o=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",l=n("pako"),d=n("./utils"),h=n("./stream/GenericWorker"),m=o?"uint8array":"array";function p(g,v){h.call(this,"FlateWorker/"+g),this._pako=null,this._pakoAction=g,this._pakoOptions=v,this.meta={}}s.magic="\b\0",d.inherits(p,h),p.prototype.processChunk=function(g){this.meta=g.meta,this._pako===null&&this._createPako(),this._pako.push(d.transformTo(m,g.data),!1)},p.prototype.flush=function(){h.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},p.prototype.cleanUp=function(){h.prototype.cleanUp.call(this),this._pako=null},p.prototype._createPako=function(){this._pako=new l[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var g=this;this._pako.onData=function(v){g.push({data:v,meta:g.meta})}},s.compressWorker=function(g){return new p("Deflate",g)},s.uncompressWorker=function(){return new p("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(n,r,s){function o(_,S){var x,E="";for(x=0;x<S;x++)E+=String.fromCharCode(255&_),_>>>=8;return E}function l(_,S,x,E,C,T){var A,B,U=_.file,G=_.compression,k=T!==m.utf8encode,D=d.transformTo("string",T(U.name)),N=d.transformTo("string",m.utf8encode(U.name)),F=U.comment,H=d.transformTo("string",T(F)),j=d.transformTo("string",m.utf8encode(F)),M=N.length!==U.name.length,R=j.length!==F.length,K="",W="",q="",J=U.dir,Z=U.date,re={crc32:0,compressedSize:0,uncompressedSize:0};S&&!x||(re.crc32=_.crc32,re.compressedSize=_.compressedSize,re.uncompressedSize=_.uncompressedSize);var P=0;S&&(P|=8),k||!M&&!R||(P|=2048);var $=0,te=0;J&&($|=16),C==="UNIX"?(te=798,$|=(function(ae,ye){var Ie=ae;return ae||(Ie=ye?16893:33204),(65535&Ie)<<16})(U.unixPermissions,J)):(te=20,$|=(function(ae){return 63&(ae||0)})(U.dosPermissions)),A=Z.getUTCHours(),A<<=6,A|=Z.getUTCMinutes(),A<<=5,A|=Z.getUTCSeconds()/2,B=Z.getUTCFullYear()-1980,B<<=4,B|=Z.getUTCMonth()+1,B<<=5,B|=Z.getUTCDate(),M&&(W=o(1,1)+o(p(D),4)+N,K+="up"+o(W.length,2)+W),R&&(q=o(1,1)+o(p(H),4)+j,K+="uc"+o(q.length,2)+q);var se="";return se+=`
\0`,se+=o(P,2),se+=G.magic,se+=o(A,2),se+=o(B,2),se+=o(re.crc32,4),se+=o(re.compressedSize,4),se+=o(re.uncompressedSize,4),se+=o(D.length,2),se+=o(K.length,2),{fileRecord:g.LOCAL_FILE_HEADER+se+D+K,dirRecord:g.CENTRAL_FILE_HEADER+o(te,2)+se+o(H.length,2)+"\0\0\0\0"+o($,4)+o(E,4)+D+K+H}}var d=n("../utils"),h=n("../stream/GenericWorker"),m=n("../utf8"),p=n("../crc32"),g=n("../signature");function v(_,S,x,E){h.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=S,this.zipPlatform=x,this.encodeFileName=E,this.streamFiles=_,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}d.inherits(v,h),v.prototype.push=function(_){var S=_.meta.percent||0,x=this.entriesCount,E=this._sources.length;this.accumulate?this.contentBuffer.push(_):(this.bytesWritten+=_.data.length,h.prototype.push.call(this,{data:_.data,meta:{currentFile:this.currentFile,percent:x?(S+100*(x-E-1))/x:100}}))},v.prototype.openedSource=function(_){this.currentSourceOffset=this.bytesWritten,this.currentFile=_.file.name;var S=this.streamFiles&&!_.file.dir;if(S){var x=l(_,S,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:x.fileRecord,meta:{percent:0}})}else this.accumulate=!0},v.prototype.closedSource=function(_){this.accumulate=!1;var S=this.streamFiles&&!_.file.dir,x=l(_,S,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(x.dirRecord),S)this.push({data:(function(E){return g.DATA_DESCRIPTOR+o(E.crc32,4)+o(E.compressedSize,4)+o(E.uncompressedSize,4)})(_),meta:{percent:100}});else for(this.push({data:x.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},v.prototype.flush=function(){for(var _=this.bytesWritten,S=0;S<this.dirRecords.length;S++)this.push({data:this.dirRecords[S],meta:{percent:100}});var x=this.bytesWritten-_,E=(function(C,T,A,B,U){var G=d.transformTo("string",U(B));return g.CENTRAL_DIRECTORY_END+"\0\0\0\0"+o(C,2)+o(C,2)+o(T,4)+o(A,4)+o(G.length,2)+G})(this.dirRecords.length,x,_,this.zipComment,this.encodeFileName);this.push({data:E,meta:{percent:100}})},v.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},v.prototype.registerPrevious=function(_){this._sources.push(_);var S=this;return _.on("data",function(x){S.processChunk(x)}),_.on("end",function(){S.closedSource(S.previous.streamInfo),S._sources.length?S.prepareNextSource():S.end()}),_.on("error",function(x){S.error(x)}),this},v.prototype.resume=function(){return!!h.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},v.prototype.error=function(_){var S=this._sources;if(!h.prototype.error.call(this,_))return!1;for(var x=0;x<S.length;x++)try{S[x].error(_)}catch{}return!0},v.prototype.lock=function(){h.prototype.lock.call(this);for(var _=this._sources,S=0;S<_.length;S++)_[S].lock()},r.exports=v},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(n,r,s){var o=n("../compressions"),l=n("./ZipFileWorker");s.generateWorker=function(d,h,m){var p=new l(h.streamFiles,m,h.platform,h.encodeFileName),g=0;try{d.forEach(function(v,_){g++;var S=(function(T,A){var B=T||A,U=o[B];if(!U)throw new Error(B+" is not a valid compression method !");return U})(_.options.compression,h.compression),x=_.options.compressionOptions||h.compressionOptions||{},E=_.dir,C=_.date;_._compressWorker(S,x).withStreamInfo("file",{name:v,dir:E,date:C,comment:_.comment||"",unixPermissions:_.unixPermissions,dosPermissions:_.dosPermissions}).pipe(p)}),p.entriesCount=g}catch(v){p.error(v)}return p}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(n,r,s){function o(){if(!(this instanceof o))return new o;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var l=new o;for(var d in this)typeof this[d]!="function"&&(l[d]=this[d]);return l}}(o.prototype=n("./object")).loadAsync=n("./load"),o.support=n("./support"),o.defaults=n("./defaults"),o.version="3.10.1",o.loadAsync=function(l,d){return new o().loadAsync(l,d)},o.external=n("./external"),r.exports=o},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(n,r,s){var o=n("./utils"),l=n("./external"),d=n("./utf8"),h=n("./zipEntries"),m=n("./stream/Crc32Probe"),p=n("./nodejsUtils");function g(v){return new l.Promise(function(_,S){var x=v.decompressed.getContentWorker().pipe(new m);x.on("error",function(E){S(E)}).on("end",function(){x.streamInfo.crc32!==v.decompressed.crc32?S(new Error("Corrupted zip : CRC32 mismatch")):_()}).resume()})}r.exports=function(v,_){var S=this;return _=o.extend(_||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:d.utf8decode}),p.isNode&&p.isStream(v)?l.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):o.prepareContent("the loaded zip file",v,!0,_.optimizedBinaryString,_.base64).then(function(x){var E=new h(_);return E.load(x),E}).then(function(x){var E=[l.Promise.resolve(x)],C=x.files;if(_.checkCRC32)for(var T=0;T<C.length;T++)E.push(g(C[T]));return l.Promise.all(E)}).then(function(x){for(var E=x.shift(),C=E.files,T=0;T<C.length;T++){var A=C[T],B=A.fileNameStr,U=o.resolve(A.fileNameStr);S.file(U,A.decompressed,{binary:!0,optimizedBinaryString:!0,date:A.date,dir:A.dir,comment:A.fileCommentStr.length?A.fileCommentStr:null,unixPermissions:A.unixPermissions,dosPermissions:A.dosPermissions,createFolders:_.createFolders}),A.dir||(S.file(U).unsafeOriginalName=B)}return E.zipComment.length&&(S.comment=E.zipComment),S})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(n,r,s){var o=n("../utils"),l=n("../stream/GenericWorker");function d(h,m){l.call(this,"Nodejs stream input adapter for "+h),this._upstreamEnded=!1,this._bindStream(m)}o.inherits(d,l),d.prototype._bindStream=function(h){var m=this;(this._stream=h).pause(),h.on("data",function(p){m.push({data:p,meta:{percent:0}})}).on("error",function(p){m.isPaused?this.generatedError=p:m.error(p)}).on("end",function(){m.isPaused?m._upstreamEnded=!0:m.end()})},d.prototype.pause=function(){return!!l.prototype.pause.call(this)&&(this._stream.pause(),!0)},d.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},r.exports=d},{"../stream/GenericWorker":28,"../utils":32}],13:[function(n,r,s){var o=n("readable-stream").Readable;function l(d,h,m){o.call(this,h),this._helper=d;var p=this;d.on("data",function(g,v){p.push(g)||p._helper.pause(),m&&m(v)}).on("error",function(g){p.emit("error",g)}).on("end",function(){p.push(null)})}n("../utils").inherits(l,o),l.prototype._read=function(){this._helper.resume()},r.exports=l},{"../utils":32,"readable-stream":16}],14:[function(n,r,s){r.exports={isNode:typeof Buffer<"u",newBufferFrom:function(o,l){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(o,l);if(typeof o=="number")throw new Error('The "data" argument must not be a number');return new Buffer(o,l)},allocBuffer:function(o){if(Buffer.alloc)return Buffer.alloc(o);var l=new Buffer(o);return l.fill(0),l},isBuffer:function(o){return Buffer.isBuffer(o)},isStream:function(o){return o&&typeof o.on=="function"&&typeof o.pause=="function"&&typeof o.resume=="function"}}},{}],15:[function(n,r,s){function o(U,G,k){var D,N=d.getTypeOf(G),F=d.extend(k||{},p);F.date=F.date||new Date,F.compression!==null&&(F.compression=F.compression.toUpperCase()),typeof F.unixPermissions=="string"&&(F.unixPermissions=parseInt(F.unixPermissions,8)),F.unixPermissions&&16384&F.unixPermissions&&(F.dir=!0),F.dosPermissions&&16&F.dosPermissions&&(F.dir=!0),F.dir&&(U=C(U)),F.createFolders&&(D=E(U))&&T.call(this,D,!0);var H=N==="string"&&F.binary===!1&&F.base64===!1;k&&k.binary!==void 0||(F.binary=!H),(G instanceof g&&G.uncompressedSize===0||F.dir||!G||G.length===0)&&(F.base64=!1,F.binary=!0,G="",F.compression="STORE",N="string");var j=null;j=G instanceof g||G instanceof h?G:S.isNode&&S.isStream(G)?new x(U,G):d.prepareContent(U,G,F.binary,F.optimizedBinaryString,F.base64);var M=new v(U,j,F);this.files[U]=M}var l=n("./utf8"),d=n("./utils"),h=n("./stream/GenericWorker"),m=n("./stream/StreamHelper"),p=n("./defaults"),g=n("./compressedObject"),v=n("./zipObject"),_=n("./generate"),S=n("./nodejsUtils"),x=n("./nodejs/NodejsStreamInputAdapter"),E=function(U){U.slice(-1)==="/"&&(U=U.substring(0,U.length-1));var G=U.lastIndexOf("/");return 0<G?U.substring(0,G):""},C=function(U){return U.slice(-1)!=="/"&&(U+="/"),U},T=function(U,G){return G=G!==void 0?G:p.createFolders,U=C(U),this.files[U]||o.call(this,U,null,{dir:!0,createFolders:G}),this.files[U]};function A(U){return Object.prototype.toString.call(U)==="[object RegExp]"}var B={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(U){var G,k,D;for(G in this.files)D=this.files[G],(k=G.slice(this.root.length,G.length))&&G.slice(0,this.root.length)===this.root&&U(k,D)},filter:function(U){var G=[];return this.forEach(function(k,D){U(k,D)&&G.push(D)}),G},file:function(U,G,k){if(arguments.length!==1)return U=this.root+U,o.call(this,U,G,k),this;if(A(U)){var D=U;return this.filter(function(F,H){return!H.dir&&D.test(F)})}var N=this.files[this.root+U];return N&&!N.dir?N:null},folder:function(U){if(!U)return this;if(A(U))return this.filter(function(N,F){return F.dir&&U.test(N)});var G=this.root+U,k=T.call(this,G),D=this.clone();return D.root=k.name,D},remove:function(U){U=this.root+U;var G=this.files[U];if(G||(U.slice(-1)!=="/"&&(U+="/"),G=this.files[U]),G&&!G.dir)delete this.files[U];else for(var k=this.filter(function(N,F){return F.name.slice(0,U.length)===U}),D=0;D<k.length;D++)delete this.files[k[D].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(U){var G,k={};try{if((k=d.extend(U||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:l.utf8encode})).type=k.type.toLowerCase(),k.compression=k.compression.toUpperCase(),k.type==="binarystring"&&(k.type="string"),!k.type)throw new Error("No output type specified.");d.checkSupport(k.type),k.platform!=="darwin"&&k.platform!=="freebsd"&&k.platform!=="linux"&&k.platform!=="sunos"||(k.platform="UNIX"),k.platform==="win32"&&(k.platform="DOS");var D=k.comment||this.comment||"";G=_.generateWorker(this,k,D)}catch(N){(G=new h("error")).error(N)}return new m(G,k.type||"string",k.mimeType)},generateAsync:function(U,G){return this.generateInternalStream(U).accumulate(G)},generateNodeStream:function(U,G){return(U=U||{}).type||(U.type="nodebuffer"),this.generateInternalStream(U).toNodejsStream(G)}};r.exports=B},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(n,r,s){r.exports=n("stream")},{stream:void 0}],17:[function(n,r,s){var o=n("./DataReader");function l(d){o.call(this,d);for(var h=0;h<this.data.length;h++)d[h]=255&d[h]}n("../utils").inherits(l,o),l.prototype.byteAt=function(d){return this.data[this.zero+d]},l.prototype.lastIndexOfSignature=function(d){for(var h=d.charCodeAt(0),m=d.charCodeAt(1),p=d.charCodeAt(2),g=d.charCodeAt(3),v=this.length-4;0<=v;--v)if(this.data[v]===h&&this.data[v+1]===m&&this.data[v+2]===p&&this.data[v+3]===g)return v-this.zero;return-1},l.prototype.readAndCheckSignature=function(d){var h=d.charCodeAt(0),m=d.charCodeAt(1),p=d.charCodeAt(2),g=d.charCodeAt(3),v=this.readData(4);return h===v[0]&&m===v[1]&&p===v[2]&&g===v[3]},l.prototype.readData=function(d){if(this.checkOffset(d),d===0)return[];var h=this.data.slice(this.zero+this.index,this.zero+this.index+d);return this.index+=d,h},r.exports=l},{"../utils":32,"./DataReader":18}],18:[function(n,r,s){var o=n("../utils");function l(d){this.data=d,this.length=d.length,this.index=0,this.zero=0}l.prototype={checkOffset:function(d){this.checkIndex(this.index+d)},checkIndex:function(d){if(this.length<this.zero+d||d<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+d+"). Corrupted zip ?")},setIndex:function(d){this.checkIndex(d),this.index=d},skip:function(d){this.setIndex(this.index+d)},byteAt:function(){},readInt:function(d){var h,m=0;for(this.checkOffset(d),h=this.index+d-1;h>=this.index;h--)m=(m<<8)+this.byteAt(h);return this.index+=d,m},readString:function(d){return o.transformTo("string",this.readData(d))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var d=this.readInt(4);return new Date(Date.UTC(1980+(d>>25&127),(d>>21&15)-1,d>>16&31,d>>11&31,d>>5&63,(31&d)<<1))}},r.exports=l},{"../utils":32}],19:[function(n,r,s){var o=n("./Uint8ArrayReader");function l(d){o.call(this,d)}n("../utils").inherits(l,o),l.prototype.readData=function(d){this.checkOffset(d);var h=this.data.slice(this.zero+this.index,this.zero+this.index+d);return this.index+=d,h},r.exports=l},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(n,r,s){var o=n("./DataReader");function l(d){o.call(this,d)}n("../utils").inherits(l,o),l.prototype.byteAt=function(d){return this.data.charCodeAt(this.zero+d)},l.prototype.lastIndexOfSignature=function(d){return this.data.lastIndexOf(d)-this.zero},l.prototype.readAndCheckSignature=function(d){return d===this.readData(4)},l.prototype.readData=function(d){this.checkOffset(d);var h=this.data.slice(this.zero+this.index,this.zero+this.index+d);return this.index+=d,h},r.exports=l},{"../utils":32,"./DataReader":18}],21:[function(n,r,s){var o=n("./ArrayReader");function l(d){o.call(this,d)}n("../utils").inherits(l,o),l.prototype.readData=function(d){if(this.checkOffset(d),d===0)return new Uint8Array(0);var h=this.data.subarray(this.zero+this.index,this.zero+this.index+d);return this.index+=d,h},r.exports=l},{"../utils":32,"./ArrayReader":17}],22:[function(n,r,s){var o=n("../utils"),l=n("../support"),d=n("./ArrayReader"),h=n("./StringReader"),m=n("./NodeBufferReader"),p=n("./Uint8ArrayReader");r.exports=function(g){var v=o.getTypeOf(g);return o.checkSupport(v),v!=="string"||l.uint8array?v==="nodebuffer"?new m(g):l.uint8array?new p(o.transformTo("uint8array",g)):new d(o.transformTo("array",g)):new h(g)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(n,r,s){s.LOCAL_FILE_HEADER="PK",s.CENTRAL_FILE_HEADER="PK",s.CENTRAL_DIRECTORY_END="PK",s.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",s.ZIP64_CENTRAL_DIRECTORY_END="PK",s.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(n,r,s){var o=n("./GenericWorker"),l=n("../utils");function d(h){o.call(this,"ConvertWorker to "+h),this.destType=h}l.inherits(d,o),d.prototype.processChunk=function(h){this.push({data:l.transformTo(this.destType,h.data),meta:h.meta})},r.exports=d},{"../utils":32,"./GenericWorker":28}],25:[function(n,r,s){var o=n("./GenericWorker"),l=n("../crc32");function d(){o.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}n("../utils").inherits(d,o),d.prototype.processChunk=function(h){this.streamInfo.crc32=l(h.data,this.streamInfo.crc32||0),this.push(h)},r.exports=d},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(n,r,s){var o=n("../utils"),l=n("./GenericWorker");function d(h){l.call(this,"DataLengthProbe for "+h),this.propName=h,this.withStreamInfo(h,0)}o.inherits(d,l),d.prototype.processChunk=function(h){if(h){var m=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=m+h.data.length}l.prototype.processChunk.call(this,h)},r.exports=d},{"../utils":32,"./GenericWorker":28}],27:[function(n,r,s){var o=n("../utils"),l=n("./GenericWorker");function d(h){l.call(this,"DataWorker");var m=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,h.then(function(p){m.dataIsReady=!0,m.data=p,m.max=p&&p.length||0,m.type=o.getTypeOf(p),m.isPaused||m._tickAndRepeat()},function(p){m.error(p)})}o.inherits(d,l),d.prototype.cleanUp=function(){l.prototype.cleanUp.call(this),this.data=null},d.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,o.delay(this._tickAndRepeat,[],this)),!0)},d.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(o.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},d.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var h=null,m=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":h=this.data.substring(this.index,m);break;case"uint8array":h=this.data.subarray(this.index,m);break;case"array":case"nodebuffer":h=this.data.slice(this.index,m)}return this.index=m,this.push({data:h,meta:{percent:this.max?this.index/this.max*100:0}})},r.exports=d},{"../utils":32,"./GenericWorker":28}],28:[function(n,r,s){function o(l){this.name=l||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}o.prototype={push:function(l){this.emit("data",l)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(l){this.emit("error",l)}return!0},error:function(l){return!this.isFinished&&(this.isPaused?this.generatedError=l:(this.isFinished=!0,this.emit("error",l),this.previous&&this.previous.error(l),this.cleanUp()),!0)},on:function(l,d){return this._listeners[l].push(d),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(l,d){if(this._listeners[l])for(var h=0;h<this._listeners[l].length;h++)this._listeners[l][h].call(this,d)},pipe:function(l){return l.registerPrevious(this)},registerPrevious:function(l){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=l.streamInfo,this.mergeStreamInfo(),this.previous=l;var d=this;return l.on("data",function(h){d.processChunk(h)}),l.on("end",function(){d.end()}),l.on("error",function(h){d.error(h)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var l=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),l=!0),this.previous&&this.previous.resume(),!l},flush:function(){},processChunk:function(l){this.push(l)},withStreamInfo:function(l,d){return this.extraStreamInfo[l]=d,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var l in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,l)&&(this.streamInfo[l]=this.extraStreamInfo[l])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var l="Worker "+this.name;return this.previous?this.previous+" -> "+l:l}},r.exports=o},{}],29:[function(n,r,s){var o=n("../utils"),l=n("./ConvertWorker"),d=n("./GenericWorker"),h=n("../base64"),m=n("../support"),p=n("../external"),g=null;if(m.nodestream)try{g=n("../nodejs/NodejsStreamOutputAdapter")}catch{}function v(S,x){return new p.Promise(function(E,C){var T=[],A=S._internalType,B=S._outputType,U=S._mimeType;S.on("data",function(G,k){T.push(G),x&&x(k)}).on("error",function(G){T=[],C(G)}).on("end",function(){try{var G=(function(k,D,N){switch(k){case"blob":return o.newBlob(o.transformTo("arraybuffer",D),N);case"base64":return h.encode(D);default:return o.transformTo(k,D)}})(B,(function(k,D){var N,F=0,H=null,j=0;for(N=0;N<D.length;N++)j+=D[N].length;switch(k){case"string":return D.join("");case"array":return Array.prototype.concat.apply([],D);case"uint8array":for(H=new Uint8Array(j),N=0;N<D.length;N++)H.set(D[N],F),F+=D[N].length;return H;case"nodebuffer":return Buffer.concat(D);default:throw new Error("concat : unsupported type '"+k+"'")}})(A,T),U);E(G)}catch(k){C(k)}T=[]}).resume()})}function _(S,x,E){var C=x;switch(x){case"blob":case"arraybuffer":C="uint8array";break;case"base64":C="string"}try{this._internalType=C,this._outputType=x,this._mimeType=E,o.checkSupport(C),this._worker=S.pipe(new l(C)),S.lock()}catch(T){this._worker=new d("error"),this._worker.error(T)}}_.prototype={accumulate:function(S){return v(this,S)},on:function(S,x){var E=this;return S==="data"?this._worker.on(S,function(C){x.call(E,C.data,C.meta)}):this._worker.on(S,function(){o.delay(x,arguments,E)}),this},resume:function(){return o.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(S){if(o.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new g(this,{objectMode:this._outputType!=="nodebuffer"},S)}},r.exports=_},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(n,r,s){if(s.base64=!0,s.array=!0,s.string=!0,s.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",s.nodebuffer=typeof Buffer<"u",s.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")s.blob=!1;else{var o=new ArrayBuffer(0);try{s.blob=new Blob([o],{type:"application/zip"}).size===0}catch{try{var l=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);l.append(o),s.blob=l.getBlob("application/zip").size===0}catch{s.blob=!1}}}try{s.nodestream=!!n("readable-stream").Readable}catch{s.nodestream=!1}},{"readable-stream":16}],31:[function(n,r,s){for(var o=n("./utils"),l=n("./support"),d=n("./nodejsUtils"),h=n("./stream/GenericWorker"),m=new Array(256),p=0;p<256;p++)m[p]=252<=p?6:248<=p?5:240<=p?4:224<=p?3:192<=p?2:1;m[254]=m[254]=1;function g(){h.call(this,"utf-8 decode"),this.leftOver=null}function v(){h.call(this,"utf-8 encode")}s.utf8encode=function(_){return l.nodebuffer?d.newBufferFrom(_,"utf-8"):(function(S){var x,E,C,T,A,B=S.length,U=0;for(T=0;T<B;T++)(64512&(E=S.charCodeAt(T)))==55296&&T+1<B&&(64512&(C=S.charCodeAt(T+1)))==56320&&(E=65536+(E-55296<<10)+(C-56320),T++),U+=E<128?1:E<2048?2:E<65536?3:4;for(x=l.uint8array?new Uint8Array(U):new Array(U),T=A=0;A<U;T++)(64512&(E=S.charCodeAt(T)))==55296&&T+1<B&&(64512&(C=S.charCodeAt(T+1)))==56320&&(E=65536+(E-55296<<10)+(C-56320),T++),E<128?x[A++]=E:(E<2048?x[A++]=192|E>>>6:(E<65536?x[A++]=224|E>>>12:(x[A++]=240|E>>>18,x[A++]=128|E>>>12&63),x[A++]=128|E>>>6&63),x[A++]=128|63&E);return x})(_)},s.utf8decode=function(_){return l.nodebuffer?o.transformTo("nodebuffer",_).toString("utf-8"):(function(S){var x,E,C,T,A=S.length,B=new Array(2*A);for(x=E=0;x<A;)if((C=S[x++])<128)B[E++]=C;else if(4<(T=m[C]))B[E++]=65533,x+=T-1;else{for(C&=T===2?31:T===3?15:7;1<T&&x<A;)C=C<<6|63&S[x++],T--;1<T?B[E++]=65533:C<65536?B[E++]=C:(C-=65536,B[E++]=55296|C>>10&1023,B[E++]=56320|1023&C)}return B.length!==E&&(B.subarray?B=B.subarray(0,E):B.length=E),o.applyFromCharCode(B)})(_=o.transformTo(l.uint8array?"uint8array":"array",_))},o.inherits(g,h),g.prototype.processChunk=function(_){var S=o.transformTo(l.uint8array?"uint8array":"array",_.data);if(this.leftOver&&this.leftOver.length){if(l.uint8array){var x=S;(S=new Uint8Array(x.length+this.leftOver.length)).set(this.leftOver,0),S.set(x,this.leftOver.length)}else S=this.leftOver.concat(S);this.leftOver=null}var E=(function(T,A){var B;for((A=A||T.length)>T.length&&(A=T.length),B=A-1;0<=B&&(192&T[B])==128;)B--;return B<0||B===0?A:B+m[T[B]]>A?B:A})(S),C=S;E!==S.length&&(l.uint8array?(C=S.subarray(0,E),this.leftOver=S.subarray(E,S.length)):(C=S.slice(0,E),this.leftOver=S.slice(E,S.length))),this.push({data:s.utf8decode(C),meta:_.meta})},g.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:s.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},s.Utf8DecodeWorker=g,o.inherits(v,h),v.prototype.processChunk=function(_){this.push({data:s.utf8encode(_.data),meta:_.meta})},s.Utf8EncodeWorker=v},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(n,r,s){var o=n("./support"),l=n("./base64"),d=n("./nodejsUtils"),h=n("./external");function m(x){return x}function p(x,E){for(var C=0;C<x.length;++C)E[C]=255&x.charCodeAt(C);return E}n("setimmediate"),s.newBlob=function(x,E){s.checkSupport("blob");try{return new Blob([x],{type:E})}catch{try{var C=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return C.append(x),C.getBlob(E)}catch{throw new Error("Bug : can't construct the Blob.")}}};var g={stringifyByChunk:function(x,E,C){var T=[],A=0,B=x.length;if(B<=C)return String.fromCharCode.apply(null,x);for(;A<B;)E==="array"||E==="nodebuffer"?T.push(String.fromCharCode.apply(null,x.slice(A,Math.min(A+C,B)))):T.push(String.fromCharCode.apply(null,x.subarray(A,Math.min(A+C,B)))),A+=C;return T.join("")},stringifyByChar:function(x){for(var E="",C=0;C<x.length;C++)E+=String.fromCharCode(x[C]);return E},applyCanBeUsed:{uint8array:(function(){try{return o.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}})(),nodebuffer:(function(){try{return o.nodebuffer&&String.fromCharCode.apply(null,d.allocBuffer(1)).length===1}catch{return!1}})()}};function v(x){var E=65536,C=s.getTypeOf(x),T=!0;if(C==="uint8array"?T=g.applyCanBeUsed.uint8array:C==="nodebuffer"&&(T=g.applyCanBeUsed.nodebuffer),T)for(;1<E;)try{return g.stringifyByChunk(x,C,E)}catch{E=Math.floor(E/2)}return g.stringifyByChar(x)}function _(x,E){for(var C=0;C<x.length;C++)E[C]=x[C];return E}s.applyFromCharCode=v;var S={};S.string={string:m,array:function(x){return p(x,new Array(x.length))},arraybuffer:function(x){return S.string.uint8array(x).buffer},uint8array:function(x){return p(x,new Uint8Array(x.length))},nodebuffer:function(x){return p(x,d.allocBuffer(x.length))}},S.array={string:v,array:m,arraybuffer:function(x){return new Uint8Array(x).buffer},uint8array:function(x){return new Uint8Array(x)},nodebuffer:function(x){return d.newBufferFrom(x)}},S.arraybuffer={string:function(x){return v(new Uint8Array(x))},array:function(x){return _(new Uint8Array(x),new Array(x.byteLength))},arraybuffer:m,uint8array:function(x){return new Uint8Array(x)},nodebuffer:function(x){return d.newBufferFrom(new Uint8Array(x))}},S.uint8array={string:v,array:function(x){return _(x,new Array(x.length))},arraybuffer:function(x){return x.buffer},uint8array:m,nodebuffer:function(x){return d.newBufferFrom(x)}},S.nodebuffer={string:v,array:function(x){return _(x,new Array(x.length))},arraybuffer:function(x){return S.nodebuffer.uint8array(x).buffer},uint8array:function(x){return _(x,new Uint8Array(x.length))},nodebuffer:m},s.transformTo=function(x,E){if(E=E||"",!x)return E;s.checkSupport(x);var C=s.getTypeOf(E);return S[C][x](E)},s.resolve=function(x){for(var E=x.split("/"),C=[],T=0;T<E.length;T++){var A=E[T];A==="."||A===""&&T!==0&&T!==E.length-1||(A===".."?C.pop():C.push(A))}return C.join("/")},s.getTypeOf=function(x){return typeof x=="string"?"string":Object.prototype.toString.call(x)==="[object Array]"?"array":o.nodebuffer&&d.isBuffer(x)?"nodebuffer":o.uint8array&&x instanceof Uint8Array?"uint8array":o.arraybuffer&&x instanceof ArrayBuffer?"arraybuffer":void 0},s.checkSupport=function(x){if(!o[x.toLowerCase()])throw new Error(x+" is not supported by this platform")},s.MAX_VALUE_16BITS=65535,s.MAX_VALUE_32BITS=-1,s.pretty=function(x){var E,C,T="";for(C=0;C<(x||"").length;C++)T+="\\x"+((E=x.charCodeAt(C))<16?"0":"")+E.toString(16).toUpperCase();return T},s.delay=function(x,E,C){setImmediate(function(){x.apply(C||null,E||[])})},s.inherits=function(x,E){function C(){}C.prototype=E.prototype,x.prototype=new C},s.extend=function(){var x,E,C={};for(x=0;x<arguments.length;x++)for(E in arguments[x])Object.prototype.hasOwnProperty.call(arguments[x],E)&&C[E]===void 0&&(C[E]=arguments[x][E]);return C},s.prepareContent=function(x,E,C,T,A){return h.Promise.resolve(E).then(function(B){return o.blob&&(B instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(B))!==-1)&&typeof FileReader<"u"?new h.Promise(function(U,G){var k=new FileReader;k.onload=function(D){U(D.target.result)},k.onerror=function(D){G(D.target.error)},k.readAsArrayBuffer(B)}):B}).then(function(B){var U=s.getTypeOf(B);return U?(U==="arraybuffer"?B=s.transformTo("uint8array",B):U==="string"&&(A?B=l.decode(B):C&&T!==!0&&(B=(function(G){return p(G,o.uint8array?new Uint8Array(G.length):new Array(G.length))})(B))),B):h.Promise.reject(new Error("Can't read the data of '"+x+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(n,r,s){var o=n("./reader/readerFor"),l=n("./utils"),d=n("./signature"),h=n("./zipEntry"),m=n("./support");function p(g){this.files=[],this.loadOptions=g}p.prototype={checkSignature:function(g){if(!this.reader.readAndCheckSignature(g)){this.reader.index-=4;var v=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+l.pretty(v)+", expected "+l.pretty(g)+")")}},isSignature:function(g,v){var _=this.reader.index;this.reader.setIndex(g);var S=this.reader.readString(4)===v;return this.reader.setIndex(_),S},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var g=this.reader.readData(this.zipCommentLength),v=m.uint8array?"uint8array":"array",_=l.transformTo(v,g);this.zipComment=this.loadOptions.decodeFileName(_)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var g,v,_,S=this.zip64EndOfCentralSize-44;0<S;)g=this.reader.readInt(2),v=this.reader.readInt(4),_=this.reader.readData(v),this.zip64ExtensibleData[g]={id:g,length:v,value:_}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var g,v;for(g=0;g<this.files.length;g++)v=this.files[g],this.reader.setIndex(v.localHeaderOffset),this.checkSignature(d.LOCAL_FILE_HEADER),v.readLocalPart(this.reader),v.handleUTF8(),v.processAttributes()},readCentralDir:function(){var g;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(d.CENTRAL_FILE_HEADER);)(g=new h({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(g);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var g=this.reader.lastIndexOfSignature(d.CENTRAL_DIRECTORY_END);if(g<0)throw this.isSignature(0,d.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(g);var v=g;if(this.checkSignature(d.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===l.MAX_VALUE_16BITS||this.diskWithCentralDirStart===l.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===l.MAX_VALUE_16BITS||this.centralDirRecords===l.MAX_VALUE_16BITS||this.centralDirSize===l.MAX_VALUE_32BITS||this.centralDirOffset===l.MAX_VALUE_32BITS){if(this.zip64=!0,(g=this.reader.lastIndexOfSignature(d.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(g),this.checkSignature(d.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,d.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(d.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(d.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var _=this.centralDirOffset+this.centralDirSize;this.zip64&&(_+=20,_+=12+this.zip64EndOfCentralSize);var S=v-_;if(0<S)this.isSignature(v,d.CENTRAL_FILE_HEADER)||(this.reader.zero=S);else if(S<0)throw new Error("Corrupted zip: missing "+Math.abs(S)+" bytes.")},prepareReader:function(g){this.reader=o(g)},load:function(g){this.prepareReader(g),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},r.exports=p},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(n,r,s){var o=n("./reader/readerFor"),l=n("./utils"),d=n("./compressedObject"),h=n("./crc32"),m=n("./utf8"),p=n("./compressions"),g=n("./support");function v(_,S){this.options=_,this.loadOptions=S}v.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(_){var S,x;if(_.skip(22),this.fileNameLength=_.readInt(2),x=_.readInt(2),this.fileName=_.readData(this.fileNameLength),_.skip(x),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((S=(function(E){for(var C in p)if(Object.prototype.hasOwnProperty.call(p,C)&&p[C].magic===E)return p[C];return null})(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+l.pretty(this.compressionMethod)+" unknown (inner file : "+l.transformTo("string",this.fileName)+")");this.decompressed=new d(this.compressedSize,this.uncompressedSize,this.crc32,S,_.readData(this.compressedSize))},readCentralPart:function(_){this.versionMadeBy=_.readInt(2),_.skip(2),this.bitFlag=_.readInt(2),this.compressionMethod=_.readString(2),this.date=_.readDate(),this.crc32=_.readInt(4),this.compressedSize=_.readInt(4),this.uncompressedSize=_.readInt(4);var S=_.readInt(2);if(this.extraFieldsLength=_.readInt(2),this.fileCommentLength=_.readInt(2),this.diskNumberStart=_.readInt(2),this.internalFileAttributes=_.readInt(2),this.externalFileAttributes=_.readInt(4),this.localHeaderOffset=_.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");_.skip(S),this.readExtraFields(_),this.parseZIP64ExtraField(_),this.fileComment=_.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var _=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),_==0&&(this.dosPermissions=63&this.externalFileAttributes),_==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var _=o(this.extraFields[1].value);this.uncompressedSize===l.MAX_VALUE_32BITS&&(this.uncompressedSize=_.readInt(8)),this.compressedSize===l.MAX_VALUE_32BITS&&(this.compressedSize=_.readInt(8)),this.localHeaderOffset===l.MAX_VALUE_32BITS&&(this.localHeaderOffset=_.readInt(8)),this.diskNumberStart===l.MAX_VALUE_32BITS&&(this.diskNumberStart=_.readInt(4))}},readExtraFields:function(_){var S,x,E,C=_.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});_.index+4<C;)S=_.readInt(2),x=_.readInt(2),E=_.readData(x),this.extraFields[S]={id:S,length:x,value:E};_.setIndex(C)},handleUTF8:function(){var _=g.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=m.utf8decode(this.fileName),this.fileCommentStr=m.utf8decode(this.fileComment);else{var S=this.findExtraFieldUnicodePath();if(S!==null)this.fileNameStr=S;else{var x=l.transformTo(_,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(x)}var E=this.findExtraFieldUnicodeComment();if(E!==null)this.fileCommentStr=E;else{var C=l.transformTo(_,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(C)}}},findExtraFieldUnicodePath:function(){var _=this.extraFields[28789];if(_){var S=o(_.value);return S.readInt(1)!==1||h(this.fileName)!==S.readInt(4)?null:m.utf8decode(S.readData(_.length-5))}return null},findExtraFieldUnicodeComment:function(){var _=this.extraFields[25461];if(_){var S=o(_.value);return S.readInt(1)!==1||h(this.fileComment)!==S.readInt(4)?null:m.utf8decode(S.readData(_.length-5))}return null}},r.exports=v},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(n,r,s){function o(S,x,E){this.name=S,this.dir=E.dir,this.date=E.date,this.comment=E.comment,this.unixPermissions=E.unixPermissions,this.dosPermissions=E.dosPermissions,this._data=x,this._dataBinary=E.binary,this.options={compression:E.compression,compressionOptions:E.compressionOptions}}var l=n("./stream/StreamHelper"),d=n("./stream/DataWorker"),h=n("./utf8"),m=n("./compressedObject"),p=n("./stream/GenericWorker");o.prototype={internalStream:function(S){var x=null,E="string";try{if(!S)throw new Error("No output type specified.");var C=(E=S.toLowerCase())==="string"||E==="text";E!=="binarystring"&&E!=="text"||(E="string"),x=this._decompressWorker();var T=!this._dataBinary;T&&!C&&(x=x.pipe(new h.Utf8EncodeWorker)),!T&&C&&(x=x.pipe(new h.Utf8DecodeWorker))}catch(A){(x=new p("error")).error(A)}return new l(x,E,"")},async:function(S,x){return this.internalStream(S).accumulate(x)},nodeStream:function(S,x){return this.internalStream(S||"nodebuffer").toNodejsStream(x)},_compressWorker:function(S,x){if(this._data instanceof m&&this._data.compression.magic===S.magic)return this._data.getCompressedWorker();var E=this._decompressWorker();return this._dataBinary||(E=E.pipe(new h.Utf8EncodeWorker)),m.createWorkerFrom(E,S,x)},_decompressWorker:function(){return this._data instanceof m?this._data.getContentWorker():this._data instanceof p?this._data:new d(this._data)}};for(var g=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],v=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},_=0;_<g.length;_++)o.prototype[g[_]]=v;r.exports=o},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(n,r,s){(function(o){var l,d,h=o.MutationObserver||o.WebKitMutationObserver;if(h){var m=0,p=new h(S),g=o.document.createTextNode("");p.observe(g,{characterData:!0}),l=function(){g.data=m=++m%2}}else if(o.setImmediate||o.MessageChannel===void 0)l="document"in o&&"onreadystatechange"in o.document.createElement("script")?function(){var x=o.document.createElement("script");x.onreadystatechange=function(){S(),x.onreadystatechange=null,x.parentNode.removeChild(x),x=null},o.document.documentElement.appendChild(x)}:function(){setTimeout(S,0)};else{var v=new o.MessageChannel;v.port1.onmessage=S,l=function(){v.port2.postMessage(0)}}var _=[];function S(){var x,E;d=!0;for(var C=_.length;C;){for(E=_,_=[],x=-1;++x<C;)E[x]();C=_.length}d=!1}r.exports=function(x){_.push(x)!==1||d||l()}}).call(this,typeof Lh<"u"?Lh:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(n,r,s){var o=n("immediate");function l(){}var d={},h=["REJECTED"],m=["FULFILLED"],p=["PENDING"];function g(C){if(typeof C!="function")throw new TypeError("resolver must be a function");this.state=p,this.queue=[],this.outcome=void 0,C!==l&&x(this,C)}function v(C,T,A){this.promise=C,typeof T=="function"&&(this.onFulfilled=T,this.callFulfilled=this.otherCallFulfilled),typeof A=="function"&&(this.onRejected=A,this.callRejected=this.otherCallRejected)}function _(C,T,A){o(function(){var B;try{B=T(A)}catch(U){return d.reject(C,U)}B===C?d.reject(C,new TypeError("Cannot resolve promise with itself")):d.resolve(C,B)})}function S(C){var T=C&&C.then;if(C&&(typeof C=="object"||typeof C=="function")&&typeof T=="function")return function(){T.apply(C,arguments)}}function x(C,T){var A=!1;function B(k){A||(A=!0,d.reject(C,k))}function U(k){A||(A=!0,d.resolve(C,k))}var G=E(function(){T(U,B)});G.status==="error"&&B(G.value)}function E(C,T){var A={};try{A.value=C(T),A.status="success"}catch(B){A.status="error",A.value=B}return A}(r.exports=g).prototype.finally=function(C){if(typeof C!="function")return this;var T=this.constructor;return this.then(function(A){return T.resolve(C()).then(function(){return A})},function(A){return T.resolve(C()).then(function(){throw A})})},g.prototype.catch=function(C){return this.then(null,C)},g.prototype.then=function(C,T){if(typeof C!="function"&&this.state===m||typeof T!="function"&&this.state===h)return this;var A=new this.constructor(l);return this.state!==p?_(A,this.state===m?C:T,this.outcome):this.queue.push(new v(A,C,T)),A},v.prototype.callFulfilled=function(C){d.resolve(this.promise,C)},v.prototype.otherCallFulfilled=function(C){_(this.promise,this.onFulfilled,C)},v.prototype.callRejected=function(C){d.reject(this.promise,C)},v.prototype.otherCallRejected=function(C){_(this.promise,this.onRejected,C)},d.resolve=function(C,T){var A=E(S,T);if(A.status==="error")return d.reject(C,A.value);var B=A.value;if(B)x(C,B);else{C.state=m,C.outcome=T;for(var U=-1,G=C.queue.length;++U<G;)C.queue[U].callFulfilled(T)}return C},d.reject=function(C,T){C.state=h,C.outcome=T;for(var A=-1,B=C.queue.length;++A<B;)C.queue[A].callRejected(T);return C},g.resolve=function(C){return C instanceof this?C:d.resolve(new this(l),C)},g.reject=function(C){var T=new this(l);return d.reject(T,C)},g.all=function(C){var T=this;if(Object.prototype.toString.call(C)!=="[object Array]")return this.reject(new TypeError("must be an array"));var A=C.length,B=!1;if(!A)return this.resolve([]);for(var U=new Array(A),G=0,k=-1,D=new this(l);++k<A;)N(C[k],k);return D;function N(F,H){T.resolve(F).then(function(j){U[H]=j,++G!==A||B||(B=!0,d.resolve(D,U))},function(j){B||(B=!0,d.reject(D,j))})}},g.race=function(C){var T=this;if(Object.prototype.toString.call(C)!=="[object Array]")return this.reject(new TypeError("must be an array"));var A=C.length,B=!1;if(!A)return this.resolve([]);for(var U=-1,G=new this(l);++U<A;)k=C[U],T.resolve(k).then(function(D){B||(B=!0,d.resolve(G,D))},function(D){B||(B=!0,d.reject(G,D))});var k;return G}},{immediate:36}],38:[function(n,r,s){var o={};(0,n("./lib/utils/common").assign)(o,n("./lib/deflate"),n("./lib/inflate"),n("./lib/zlib/constants")),r.exports=o},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(n,r,s){var o=n("./zlib/deflate"),l=n("./utils/common"),d=n("./utils/strings"),h=n("./zlib/messages"),m=n("./zlib/zstream"),p=Object.prototype.toString,g=0,v=-1,_=0,S=8;function x(C){if(!(this instanceof x))return new x(C);this.options=l.assign({level:v,method:S,chunkSize:16384,windowBits:15,memLevel:8,strategy:_,to:""},C||{});var T=this.options;T.raw&&0<T.windowBits?T.windowBits=-T.windowBits:T.gzip&&0<T.windowBits&&T.windowBits<16&&(T.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new m,this.strm.avail_out=0;var A=o.deflateInit2(this.strm,T.level,T.method,T.windowBits,T.memLevel,T.strategy);if(A!==g)throw new Error(h[A]);if(T.header&&o.deflateSetHeader(this.strm,T.header),T.dictionary){var B;if(B=typeof T.dictionary=="string"?d.string2buf(T.dictionary):p.call(T.dictionary)==="[object ArrayBuffer]"?new Uint8Array(T.dictionary):T.dictionary,(A=o.deflateSetDictionary(this.strm,B))!==g)throw new Error(h[A]);this._dict_set=!0}}function E(C,T){var A=new x(T);if(A.push(C,!0),A.err)throw A.msg||h[A.err];return A.result}x.prototype.push=function(C,T){var A,B,U=this.strm,G=this.options.chunkSize;if(this.ended)return!1;B=T===~~T?T:T===!0?4:0,typeof C=="string"?U.input=d.string2buf(C):p.call(C)==="[object ArrayBuffer]"?U.input=new Uint8Array(C):U.input=C,U.next_in=0,U.avail_in=U.input.length;do{if(U.avail_out===0&&(U.output=new l.Buf8(G),U.next_out=0,U.avail_out=G),(A=o.deflate(U,B))!==1&&A!==g)return this.onEnd(A),!(this.ended=!0);U.avail_out!==0&&(U.avail_in!==0||B!==4&&B!==2)||(this.options.to==="string"?this.onData(d.buf2binstring(l.shrinkBuf(U.output,U.next_out))):this.onData(l.shrinkBuf(U.output,U.next_out)))}while((0<U.avail_in||U.avail_out===0)&&A!==1);return B===4?(A=o.deflateEnd(this.strm),this.onEnd(A),this.ended=!0,A===g):B!==2||(this.onEnd(g),!(U.avail_out=0))},x.prototype.onData=function(C){this.chunks.push(C)},x.prototype.onEnd=function(C){C===g&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=l.flattenChunks(this.chunks)),this.chunks=[],this.err=C,this.msg=this.strm.msg},s.Deflate=x,s.deflate=E,s.deflateRaw=function(C,T){return(T=T||{}).raw=!0,E(C,T)},s.gzip=function(C,T){return(T=T||{}).gzip=!0,E(C,T)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(n,r,s){var o=n("./zlib/inflate"),l=n("./utils/common"),d=n("./utils/strings"),h=n("./zlib/constants"),m=n("./zlib/messages"),p=n("./zlib/zstream"),g=n("./zlib/gzheader"),v=Object.prototype.toString;function _(x){if(!(this instanceof _))return new _(x);this.options=l.assign({chunkSize:16384,windowBits:0,to:""},x||{});var E=this.options;E.raw&&0<=E.windowBits&&E.windowBits<16&&(E.windowBits=-E.windowBits,E.windowBits===0&&(E.windowBits=-15)),!(0<=E.windowBits&&E.windowBits<16)||x&&x.windowBits||(E.windowBits+=32),15<E.windowBits&&E.windowBits<48&&(15&E.windowBits)==0&&(E.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new p,this.strm.avail_out=0;var C=o.inflateInit2(this.strm,E.windowBits);if(C!==h.Z_OK)throw new Error(m[C]);this.header=new g,o.inflateGetHeader(this.strm,this.header)}function S(x,E){var C=new _(E);if(C.push(x,!0),C.err)throw C.msg||m[C.err];return C.result}_.prototype.push=function(x,E){var C,T,A,B,U,G,k=this.strm,D=this.options.chunkSize,N=this.options.dictionary,F=!1;if(this.ended)return!1;T=E===~~E?E:E===!0?h.Z_FINISH:h.Z_NO_FLUSH,typeof x=="string"?k.input=d.binstring2buf(x):v.call(x)==="[object ArrayBuffer]"?k.input=new Uint8Array(x):k.input=x,k.next_in=0,k.avail_in=k.input.length;do{if(k.avail_out===0&&(k.output=new l.Buf8(D),k.next_out=0,k.avail_out=D),(C=o.inflate(k,h.Z_NO_FLUSH))===h.Z_NEED_DICT&&N&&(G=typeof N=="string"?d.string2buf(N):v.call(N)==="[object ArrayBuffer]"?new Uint8Array(N):N,C=o.inflateSetDictionary(this.strm,G)),C===h.Z_BUF_ERROR&&F===!0&&(C=h.Z_OK,F=!1),C!==h.Z_STREAM_END&&C!==h.Z_OK)return this.onEnd(C),!(this.ended=!0);k.next_out&&(k.avail_out!==0&&C!==h.Z_STREAM_END&&(k.avail_in!==0||T!==h.Z_FINISH&&T!==h.Z_SYNC_FLUSH)||(this.options.to==="string"?(A=d.utf8border(k.output,k.next_out),B=k.next_out-A,U=d.buf2string(k.output,A),k.next_out=B,k.avail_out=D-B,B&&l.arraySet(k.output,k.output,A,B,0),this.onData(U)):this.onData(l.shrinkBuf(k.output,k.next_out)))),k.avail_in===0&&k.avail_out===0&&(F=!0)}while((0<k.avail_in||k.avail_out===0)&&C!==h.Z_STREAM_END);return C===h.Z_STREAM_END&&(T=h.Z_FINISH),T===h.Z_FINISH?(C=o.inflateEnd(this.strm),this.onEnd(C),this.ended=!0,C===h.Z_OK):T!==h.Z_SYNC_FLUSH||(this.onEnd(h.Z_OK),!(k.avail_out=0))},_.prototype.onData=function(x){this.chunks.push(x)},_.prototype.onEnd=function(x){x===h.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=l.flattenChunks(this.chunks)),this.chunks=[],this.err=x,this.msg=this.strm.msg},s.Inflate=_,s.inflate=S,s.inflateRaw=function(x,E){return(E=E||{}).raw=!0,S(x,E)},s.ungzip=S},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(n,r,s){var o=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";s.assign=function(h){for(var m=Array.prototype.slice.call(arguments,1);m.length;){var p=m.shift();if(p){if(typeof p!="object")throw new TypeError(p+"must be non-object");for(var g in p)p.hasOwnProperty(g)&&(h[g]=p[g])}}return h},s.shrinkBuf=function(h,m){return h.length===m?h:h.subarray?h.subarray(0,m):(h.length=m,h)};var l={arraySet:function(h,m,p,g,v){if(m.subarray&&h.subarray)h.set(m.subarray(p,p+g),v);else for(var _=0;_<g;_++)h[v+_]=m[p+_]},flattenChunks:function(h){var m,p,g,v,_,S;for(m=g=0,p=h.length;m<p;m++)g+=h[m].length;for(S=new Uint8Array(g),m=v=0,p=h.length;m<p;m++)_=h[m],S.set(_,v),v+=_.length;return S}},d={arraySet:function(h,m,p,g,v){for(var _=0;_<g;_++)h[v+_]=m[p+_]},flattenChunks:function(h){return[].concat.apply([],h)}};s.setTyped=function(h){h?(s.Buf8=Uint8Array,s.Buf16=Uint16Array,s.Buf32=Int32Array,s.assign(s,l)):(s.Buf8=Array,s.Buf16=Array,s.Buf32=Array,s.assign(s,d))},s.setTyped(o)},{}],42:[function(n,r,s){var o=n("./common"),l=!0,d=!0;try{String.fromCharCode.apply(null,[0])}catch{l=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{d=!1}for(var h=new o.Buf8(256),m=0;m<256;m++)h[m]=252<=m?6:248<=m?5:240<=m?4:224<=m?3:192<=m?2:1;function p(g,v){if(v<65537&&(g.subarray&&d||!g.subarray&&l))return String.fromCharCode.apply(null,o.shrinkBuf(g,v));for(var _="",S=0;S<v;S++)_+=String.fromCharCode(g[S]);return _}h[254]=h[254]=1,s.string2buf=function(g){var v,_,S,x,E,C=g.length,T=0;for(x=0;x<C;x++)(64512&(_=g.charCodeAt(x)))==55296&&x+1<C&&(64512&(S=g.charCodeAt(x+1)))==56320&&(_=65536+(_-55296<<10)+(S-56320),x++),T+=_<128?1:_<2048?2:_<65536?3:4;for(v=new o.Buf8(T),x=E=0;E<T;x++)(64512&(_=g.charCodeAt(x)))==55296&&x+1<C&&(64512&(S=g.charCodeAt(x+1)))==56320&&(_=65536+(_-55296<<10)+(S-56320),x++),_<128?v[E++]=_:(_<2048?v[E++]=192|_>>>6:(_<65536?v[E++]=224|_>>>12:(v[E++]=240|_>>>18,v[E++]=128|_>>>12&63),v[E++]=128|_>>>6&63),v[E++]=128|63&_);return v},s.buf2binstring=function(g){return p(g,g.length)},s.binstring2buf=function(g){for(var v=new o.Buf8(g.length),_=0,S=v.length;_<S;_++)v[_]=g.charCodeAt(_);return v},s.buf2string=function(g,v){var _,S,x,E,C=v||g.length,T=new Array(2*C);for(_=S=0;_<C;)if((x=g[_++])<128)T[S++]=x;else if(4<(E=h[x]))T[S++]=65533,_+=E-1;else{for(x&=E===2?31:E===3?15:7;1<E&&_<C;)x=x<<6|63&g[_++],E--;1<E?T[S++]=65533:x<65536?T[S++]=x:(x-=65536,T[S++]=55296|x>>10&1023,T[S++]=56320|1023&x)}return p(T,S)},s.utf8border=function(g,v){var _;for((v=v||g.length)>g.length&&(v=g.length),_=v-1;0<=_&&(192&g[_])==128;)_--;return _<0||_===0?v:_+h[g[_]]>v?_:v}},{"./common":41}],43:[function(n,r,s){r.exports=function(o,l,d,h){for(var m=65535&o|0,p=o>>>16&65535|0,g=0;d!==0;){for(d-=g=2e3<d?2e3:d;p=p+(m=m+l[h++]|0)|0,--g;);m%=65521,p%=65521}return m|p<<16|0}},{}],44:[function(n,r,s){r.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(n,r,s){var o=(function(){for(var l,d=[],h=0;h<256;h++){l=h;for(var m=0;m<8;m++)l=1&l?3988292384^l>>>1:l>>>1;d[h]=l}return d})();r.exports=function(l,d,h,m){var p=o,g=m+h;l^=-1;for(var v=m;v<g;v++)l=l>>>8^p[255&(l^d[v])];return-1^l}},{}],46:[function(n,r,s){var o,l=n("../utils/common"),d=n("./trees"),h=n("./adler32"),m=n("./crc32"),p=n("./messages"),g=0,v=4,_=0,S=-2,x=-1,E=4,C=2,T=8,A=9,B=286,U=30,G=19,k=2*B+1,D=15,N=3,F=258,H=F+N+1,j=42,M=113,R=1,K=2,W=3,q=4;function J(L,be){return L.msg=p[be],be}function Z(L){return(L<<1)-(4<L?9:0)}function re(L){for(var be=L.length;0<=--be;)L[be]=0}function P(L){var be=L.state,me=be.pending;me>L.avail_out&&(me=L.avail_out),me!==0&&(l.arraySet(L.output,be.pending_buf,be.pending_out,me,L.next_out),L.next_out+=me,be.pending_out+=me,L.total_out+=me,L.avail_out-=me,be.pending-=me,be.pending===0&&(be.pending_out=0))}function $(L,be){d._tr_flush_block(L,0<=L.block_start?L.block_start:-1,L.strstart-L.block_start,be),L.block_start=L.strstart,P(L.strm)}function te(L,be){L.pending_buf[L.pending++]=be}function se(L,be){L.pending_buf[L.pending++]=be>>>8&255,L.pending_buf[L.pending++]=255&be}function ae(L,be){var me,ee,X=L.max_chain_length,ie=L.strstart,we=L.prev_length,xe=L.nice_match,oe=L.strstart>L.w_size-H?L.strstart-(L.w_size-H):0,Ae=L.window,Ne=L.w_mask,ke=L.prev,qe=L.strstart+F,vt=Ae[ie+we-1],rt=Ae[ie+we];L.prev_length>=L.good_match&&(X>>=2),xe>L.lookahead&&(xe=L.lookahead);do if(Ae[(me=be)+we]===rt&&Ae[me+we-1]===vt&&Ae[me]===Ae[ie]&&Ae[++me]===Ae[ie+1]){ie+=2,me++;do;while(Ae[++ie]===Ae[++me]&&Ae[++ie]===Ae[++me]&&Ae[++ie]===Ae[++me]&&Ae[++ie]===Ae[++me]&&Ae[++ie]===Ae[++me]&&Ae[++ie]===Ae[++me]&&Ae[++ie]===Ae[++me]&&Ae[++ie]===Ae[++me]&&ie<qe);if(ee=F-(qe-ie),ie=qe-F,we<ee){if(L.match_start=be,xe<=(we=ee))break;vt=Ae[ie+we-1],rt=Ae[ie+we]}}while((be=ke[be&Ne])>oe&&--X!=0);return we<=L.lookahead?we:L.lookahead}function ye(L){var be,me,ee,X,ie,we,xe,oe,Ae,Ne,ke=L.w_size;do{if(X=L.window_size-L.lookahead-L.strstart,L.strstart>=ke+(ke-H)){for(l.arraySet(L.window,L.window,ke,ke,0),L.match_start-=ke,L.strstart-=ke,L.block_start-=ke,be=me=L.hash_size;ee=L.head[--be],L.head[be]=ke<=ee?ee-ke:0,--me;);for(be=me=ke;ee=L.prev[--be],L.prev[be]=ke<=ee?ee-ke:0,--me;);X+=ke}if(L.strm.avail_in===0)break;if(we=L.strm,xe=L.window,oe=L.strstart+L.lookahead,Ae=X,Ne=void 0,Ne=we.avail_in,Ae<Ne&&(Ne=Ae),me=Ne===0?0:(we.avail_in-=Ne,l.arraySet(xe,we.input,we.next_in,Ne,oe),we.state.wrap===1?we.adler=h(we.adler,xe,Ne,oe):we.state.wrap===2&&(we.adler=m(we.adler,xe,Ne,oe)),we.next_in+=Ne,we.total_in+=Ne,Ne),L.lookahead+=me,L.lookahead+L.insert>=N)for(ie=L.strstart-L.insert,L.ins_h=L.window[ie],L.ins_h=(L.ins_h<<L.hash_shift^L.window[ie+1])&L.hash_mask;L.insert&&(L.ins_h=(L.ins_h<<L.hash_shift^L.window[ie+N-1])&L.hash_mask,L.prev[ie&L.w_mask]=L.head[L.ins_h],L.head[L.ins_h]=ie,ie++,L.insert--,!(L.lookahead+L.insert<N)););}while(L.lookahead<H&&L.strm.avail_in!==0)}function Ie(L,be){for(var me,ee;;){if(L.lookahead<H){if(ye(L),L.lookahead<H&&be===g)return R;if(L.lookahead===0)break}if(me=0,L.lookahead>=N&&(L.ins_h=(L.ins_h<<L.hash_shift^L.window[L.strstart+N-1])&L.hash_mask,me=L.prev[L.strstart&L.w_mask]=L.head[L.ins_h],L.head[L.ins_h]=L.strstart),me!==0&&L.strstart-me<=L.w_size-H&&(L.match_length=ae(L,me)),L.match_length>=N)if(ee=d._tr_tally(L,L.strstart-L.match_start,L.match_length-N),L.lookahead-=L.match_length,L.match_length<=L.max_lazy_match&&L.lookahead>=N){for(L.match_length--;L.strstart++,L.ins_h=(L.ins_h<<L.hash_shift^L.window[L.strstart+N-1])&L.hash_mask,me=L.prev[L.strstart&L.w_mask]=L.head[L.ins_h],L.head[L.ins_h]=L.strstart,--L.match_length!=0;);L.strstart++}else L.strstart+=L.match_length,L.match_length=0,L.ins_h=L.window[L.strstart],L.ins_h=(L.ins_h<<L.hash_shift^L.window[L.strstart+1])&L.hash_mask;else ee=d._tr_tally(L,0,L.window[L.strstart]),L.lookahead--,L.strstart++;if(ee&&($(L,!1),L.strm.avail_out===0))return R}return L.insert=L.strstart<N-1?L.strstart:N-1,be===v?($(L,!0),L.strm.avail_out===0?W:q):L.last_lit&&($(L,!1),L.strm.avail_out===0)?R:K}function Ee(L,be){for(var me,ee,X;;){if(L.lookahead<H){if(ye(L),L.lookahead<H&&be===g)return R;if(L.lookahead===0)break}if(me=0,L.lookahead>=N&&(L.ins_h=(L.ins_h<<L.hash_shift^L.window[L.strstart+N-1])&L.hash_mask,me=L.prev[L.strstart&L.w_mask]=L.head[L.ins_h],L.head[L.ins_h]=L.strstart),L.prev_length=L.match_length,L.prev_match=L.match_start,L.match_length=N-1,me!==0&&L.prev_length<L.max_lazy_match&&L.strstart-me<=L.w_size-H&&(L.match_length=ae(L,me),L.match_length<=5&&(L.strategy===1||L.match_length===N&&4096<L.strstart-L.match_start)&&(L.match_length=N-1)),L.prev_length>=N&&L.match_length<=L.prev_length){for(X=L.strstart+L.lookahead-N,ee=d._tr_tally(L,L.strstart-1-L.prev_match,L.prev_length-N),L.lookahead-=L.prev_length-1,L.prev_length-=2;++L.strstart<=X&&(L.ins_h=(L.ins_h<<L.hash_shift^L.window[L.strstart+N-1])&L.hash_mask,me=L.prev[L.strstart&L.w_mask]=L.head[L.ins_h],L.head[L.ins_h]=L.strstart),--L.prev_length!=0;);if(L.match_available=0,L.match_length=N-1,L.strstart++,ee&&($(L,!1),L.strm.avail_out===0))return R}else if(L.match_available){if((ee=d._tr_tally(L,0,L.window[L.strstart-1]))&&$(L,!1),L.strstart++,L.lookahead--,L.strm.avail_out===0)return R}else L.match_available=1,L.strstart++,L.lookahead--}return L.match_available&&(ee=d._tr_tally(L,0,L.window[L.strstart-1]),L.match_available=0),L.insert=L.strstart<N-1?L.strstart:N-1,be===v?($(L,!0),L.strm.avail_out===0?W:q):L.last_lit&&($(L,!1),L.strm.avail_out===0)?R:K}function Ce(L,be,me,ee,X){this.good_length=L,this.max_lazy=be,this.nice_length=me,this.max_chain=ee,this.func=X}function pe(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=T,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new l.Buf16(2*k),this.dyn_dtree=new l.Buf16(2*(2*U+1)),this.bl_tree=new l.Buf16(2*(2*G+1)),re(this.dyn_ltree),re(this.dyn_dtree),re(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new l.Buf16(D+1),this.heap=new l.Buf16(2*B+1),re(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new l.Buf16(2*B+1),re(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Ue(L){var be;return L&&L.state?(L.total_in=L.total_out=0,L.data_type=C,(be=L.state).pending=0,be.pending_out=0,be.wrap<0&&(be.wrap=-be.wrap),be.status=be.wrap?j:M,L.adler=be.wrap===2?0:1,be.last_flush=g,d._tr_init(be),_):J(L,S)}function He(L){var be=Ue(L);return be===_&&(function(me){me.window_size=2*me.w_size,re(me.head),me.max_lazy_match=o[me.level].max_lazy,me.good_match=o[me.level].good_length,me.nice_match=o[me.level].nice_length,me.max_chain_length=o[me.level].max_chain,me.strstart=0,me.block_start=0,me.lookahead=0,me.insert=0,me.match_length=me.prev_length=N-1,me.match_available=0,me.ins_h=0})(L.state),be}function Me(L,be,me,ee,X,ie){if(!L)return S;var we=1;if(be===x&&(be=6),ee<0?(we=0,ee=-ee):15<ee&&(we=2,ee-=16),X<1||A<X||me!==T||ee<8||15<ee||be<0||9<be||ie<0||E<ie)return J(L,S);ee===8&&(ee=9);var xe=new pe;return(L.state=xe).strm=L,xe.wrap=we,xe.gzhead=null,xe.w_bits=ee,xe.w_size=1<<xe.w_bits,xe.w_mask=xe.w_size-1,xe.hash_bits=X+7,xe.hash_size=1<<xe.hash_bits,xe.hash_mask=xe.hash_size-1,xe.hash_shift=~~((xe.hash_bits+N-1)/N),xe.window=new l.Buf8(2*xe.w_size),xe.head=new l.Buf16(xe.hash_size),xe.prev=new l.Buf16(xe.w_size),xe.lit_bufsize=1<<X+6,xe.pending_buf_size=4*xe.lit_bufsize,xe.pending_buf=new l.Buf8(xe.pending_buf_size),xe.d_buf=1*xe.lit_bufsize,xe.l_buf=3*xe.lit_bufsize,xe.level=be,xe.strategy=ie,xe.method=me,He(L)}o=[new Ce(0,0,0,0,function(L,be){var me=65535;for(me>L.pending_buf_size-5&&(me=L.pending_buf_size-5);;){if(L.lookahead<=1){if(ye(L),L.lookahead===0&&be===g)return R;if(L.lookahead===0)break}L.strstart+=L.lookahead,L.lookahead=0;var ee=L.block_start+me;if((L.strstart===0||L.strstart>=ee)&&(L.lookahead=L.strstart-ee,L.strstart=ee,$(L,!1),L.strm.avail_out===0)||L.strstart-L.block_start>=L.w_size-H&&($(L,!1),L.strm.avail_out===0))return R}return L.insert=0,be===v?($(L,!0),L.strm.avail_out===0?W:q):(L.strstart>L.block_start&&($(L,!1),L.strm.avail_out),R)}),new Ce(4,4,8,4,Ie),new Ce(4,5,16,8,Ie),new Ce(4,6,32,32,Ie),new Ce(4,4,16,16,Ee),new Ce(8,16,32,32,Ee),new Ce(8,16,128,128,Ee),new Ce(8,32,128,256,Ee),new Ce(32,128,258,1024,Ee),new Ce(32,258,258,4096,Ee)],s.deflateInit=function(L,be){return Me(L,be,T,15,8,0)},s.deflateInit2=Me,s.deflateReset=He,s.deflateResetKeep=Ue,s.deflateSetHeader=function(L,be){return L&&L.state?L.state.wrap!==2?S:(L.state.gzhead=be,_):S},s.deflate=function(L,be){var me,ee,X,ie;if(!L||!L.state||5<be||be<0)return L?J(L,S):S;if(ee=L.state,!L.output||!L.input&&L.avail_in!==0||ee.status===666&&be!==v)return J(L,L.avail_out===0?-5:S);if(ee.strm=L,me=ee.last_flush,ee.last_flush=be,ee.status===j)if(ee.wrap===2)L.adler=0,te(ee,31),te(ee,139),te(ee,8),ee.gzhead?(te(ee,(ee.gzhead.text?1:0)+(ee.gzhead.hcrc?2:0)+(ee.gzhead.extra?4:0)+(ee.gzhead.name?8:0)+(ee.gzhead.comment?16:0)),te(ee,255&ee.gzhead.time),te(ee,ee.gzhead.time>>8&255),te(ee,ee.gzhead.time>>16&255),te(ee,ee.gzhead.time>>24&255),te(ee,ee.level===9?2:2<=ee.strategy||ee.level<2?4:0),te(ee,255&ee.gzhead.os),ee.gzhead.extra&&ee.gzhead.extra.length&&(te(ee,255&ee.gzhead.extra.length),te(ee,ee.gzhead.extra.length>>8&255)),ee.gzhead.hcrc&&(L.adler=m(L.adler,ee.pending_buf,ee.pending,0)),ee.gzindex=0,ee.status=69):(te(ee,0),te(ee,0),te(ee,0),te(ee,0),te(ee,0),te(ee,ee.level===9?2:2<=ee.strategy||ee.level<2?4:0),te(ee,3),ee.status=M);else{var we=T+(ee.w_bits-8<<4)<<8;we|=(2<=ee.strategy||ee.level<2?0:ee.level<6?1:ee.level===6?2:3)<<6,ee.strstart!==0&&(we|=32),we+=31-we%31,ee.status=M,se(ee,we),ee.strstart!==0&&(se(ee,L.adler>>>16),se(ee,65535&L.adler)),L.adler=1}if(ee.status===69)if(ee.gzhead.extra){for(X=ee.pending;ee.gzindex<(65535&ee.gzhead.extra.length)&&(ee.pending!==ee.pending_buf_size||(ee.gzhead.hcrc&&ee.pending>X&&(L.adler=m(L.adler,ee.pending_buf,ee.pending-X,X)),P(L),X=ee.pending,ee.pending!==ee.pending_buf_size));)te(ee,255&ee.gzhead.extra[ee.gzindex]),ee.gzindex++;ee.gzhead.hcrc&&ee.pending>X&&(L.adler=m(L.adler,ee.pending_buf,ee.pending-X,X)),ee.gzindex===ee.gzhead.extra.length&&(ee.gzindex=0,ee.status=73)}else ee.status=73;if(ee.status===73)if(ee.gzhead.name){X=ee.pending;do{if(ee.pending===ee.pending_buf_size&&(ee.gzhead.hcrc&&ee.pending>X&&(L.adler=m(L.adler,ee.pending_buf,ee.pending-X,X)),P(L),X=ee.pending,ee.pending===ee.pending_buf_size)){ie=1;break}ie=ee.gzindex<ee.gzhead.name.length?255&ee.gzhead.name.charCodeAt(ee.gzindex++):0,te(ee,ie)}while(ie!==0);ee.gzhead.hcrc&&ee.pending>X&&(L.adler=m(L.adler,ee.pending_buf,ee.pending-X,X)),ie===0&&(ee.gzindex=0,ee.status=91)}else ee.status=91;if(ee.status===91)if(ee.gzhead.comment){X=ee.pending;do{if(ee.pending===ee.pending_buf_size&&(ee.gzhead.hcrc&&ee.pending>X&&(L.adler=m(L.adler,ee.pending_buf,ee.pending-X,X)),P(L),X=ee.pending,ee.pending===ee.pending_buf_size)){ie=1;break}ie=ee.gzindex<ee.gzhead.comment.length?255&ee.gzhead.comment.charCodeAt(ee.gzindex++):0,te(ee,ie)}while(ie!==0);ee.gzhead.hcrc&&ee.pending>X&&(L.adler=m(L.adler,ee.pending_buf,ee.pending-X,X)),ie===0&&(ee.status=103)}else ee.status=103;if(ee.status===103&&(ee.gzhead.hcrc?(ee.pending+2>ee.pending_buf_size&&P(L),ee.pending+2<=ee.pending_buf_size&&(te(ee,255&L.adler),te(ee,L.adler>>8&255),L.adler=0,ee.status=M)):ee.status=M),ee.pending!==0){if(P(L),L.avail_out===0)return ee.last_flush=-1,_}else if(L.avail_in===0&&Z(be)<=Z(me)&&be!==v)return J(L,-5);if(ee.status===666&&L.avail_in!==0)return J(L,-5);if(L.avail_in!==0||ee.lookahead!==0||be!==g&&ee.status!==666){var xe=ee.strategy===2?(function(oe,Ae){for(var Ne;;){if(oe.lookahead===0&&(ye(oe),oe.lookahead===0)){if(Ae===g)return R;break}if(oe.match_length=0,Ne=d._tr_tally(oe,0,oe.window[oe.strstart]),oe.lookahead--,oe.strstart++,Ne&&($(oe,!1),oe.strm.avail_out===0))return R}return oe.insert=0,Ae===v?($(oe,!0),oe.strm.avail_out===0?W:q):oe.last_lit&&($(oe,!1),oe.strm.avail_out===0)?R:K})(ee,be):ee.strategy===3?(function(oe,Ae){for(var Ne,ke,qe,vt,rt=oe.window;;){if(oe.lookahead<=F){if(ye(oe),oe.lookahead<=F&&Ae===g)return R;if(oe.lookahead===0)break}if(oe.match_length=0,oe.lookahead>=N&&0<oe.strstart&&(ke=rt[qe=oe.strstart-1])===rt[++qe]&&ke===rt[++qe]&&ke===rt[++qe]){vt=oe.strstart+F;do;while(ke===rt[++qe]&&ke===rt[++qe]&&ke===rt[++qe]&&ke===rt[++qe]&&ke===rt[++qe]&&ke===rt[++qe]&&ke===rt[++qe]&&ke===rt[++qe]&&qe<vt);oe.match_length=F-(vt-qe),oe.match_length>oe.lookahead&&(oe.match_length=oe.lookahead)}if(oe.match_length>=N?(Ne=d._tr_tally(oe,1,oe.match_length-N),oe.lookahead-=oe.match_length,oe.strstart+=oe.match_length,oe.match_length=0):(Ne=d._tr_tally(oe,0,oe.window[oe.strstart]),oe.lookahead--,oe.strstart++),Ne&&($(oe,!1),oe.strm.avail_out===0))return R}return oe.insert=0,Ae===v?($(oe,!0),oe.strm.avail_out===0?W:q):oe.last_lit&&($(oe,!1),oe.strm.avail_out===0)?R:K})(ee,be):o[ee.level].func(ee,be);if(xe!==W&&xe!==q||(ee.status=666),xe===R||xe===W)return L.avail_out===0&&(ee.last_flush=-1),_;if(xe===K&&(be===1?d._tr_align(ee):be!==5&&(d._tr_stored_block(ee,0,0,!1),be===3&&(re(ee.head),ee.lookahead===0&&(ee.strstart=0,ee.block_start=0,ee.insert=0))),P(L),L.avail_out===0))return ee.last_flush=-1,_}return be!==v?_:ee.wrap<=0?1:(ee.wrap===2?(te(ee,255&L.adler),te(ee,L.adler>>8&255),te(ee,L.adler>>16&255),te(ee,L.adler>>24&255),te(ee,255&L.total_in),te(ee,L.total_in>>8&255),te(ee,L.total_in>>16&255),te(ee,L.total_in>>24&255)):(se(ee,L.adler>>>16),se(ee,65535&L.adler)),P(L),0<ee.wrap&&(ee.wrap=-ee.wrap),ee.pending!==0?_:1)},s.deflateEnd=function(L){var be;return L&&L.state?(be=L.state.status)!==j&&be!==69&&be!==73&&be!==91&&be!==103&&be!==M&&be!==666?J(L,S):(L.state=null,be===M?J(L,-3):_):S},s.deflateSetDictionary=function(L,be){var me,ee,X,ie,we,xe,oe,Ae,Ne=be.length;if(!L||!L.state||(ie=(me=L.state).wrap)===2||ie===1&&me.status!==j||me.lookahead)return S;for(ie===1&&(L.adler=h(L.adler,be,Ne,0)),me.wrap=0,Ne>=me.w_size&&(ie===0&&(re(me.head),me.strstart=0,me.block_start=0,me.insert=0),Ae=new l.Buf8(me.w_size),l.arraySet(Ae,be,Ne-me.w_size,me.w_size,0),be=Ae,Ne=me.w_size),we=L.avail_in,xe=L.next_in,oe=L.input,L.avail_in=Ne,L.next_in=0,L.input=be,ye(me);me.lookahead>=N;){for(ee=me.strstart,X=me.lookahead-(N-1);me.ins_h=(me.ins_h<<me.hash_shift^me.window[ee+N-1])&me.hash_mask,me.prev[ee&me.w_mask]=me.head[me.ins_h],me.head[me.ins_h]=ee,ee++,--X;);me.strstart=ee,me.lookahead=N-1,ye(me)}return me.strstart+=me.lookahead,me.block_start=me.strstart,me.insert=me.lookahead,me.lookahead=0,me.match_length=me.prev_length=N-1,me.match_available=0,L.next_in=xe,L.input=oe,L.avail_in=we,me.wrap=ie,_},s.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(n,r,s){r.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(n,r,s){r.exports=function(o,l){var d,h,m,p,g,v,_,S,x,E,C,T,A,B,U,G,k,D,N,F,H,j,M,R,K;d=o.state,h=o.next_in,R=o.input,m=h+(o.avail_in-5),p=o.next_out,K=o.output,g=p-(l-o.avail_out),v=p+(o.avail_out-257),_=d.dmax,S=d.wsize,x=d.whave,E=d.wnext,C=d.window,T=d.hold,A=d.bits,B=d.lencode,U=d.distcode,G=(1<<d.lenbits)-1,k=(1<<d.distbits)-1;e:do{A<15&&(T+=R[h++]<<A,A+=8,T+=R[h++]<<A,A+=8),D=B[T&G];t:for(;;){if(T>>>=N=D>>>24,A-=N,(N=D>>>16&255)===0)K[p++]=65535&D;else{if(!(16&N)){if((64&N)==0){D=B[(65535&D)+(T&(1<<N)-1)];continue t}if(32&N){d.mode=12;break e}o.msg="invalid literal/length code",d.mode=30;break e}F=65535&D,(N&=15)&&(A<N&&(T+=R[h++]<<A,A+=8),F+=T&(1<<N)-1,T>>>=N,A-=N),A<15&&(T+=R[h++]<<A,A+=8,T+=R[h++]<<A,A+=8),D=U[T&k];n:for(;;){if(T>>>=N=D>>>24,A-=N,!(16&(N=D>>>16&255))){if((64&N)==0){D=U[(65535&D)+(T&(1<<N)-1)];continue n}o.msg="invalid distance code",d.mode=30;break e}if(H=65535&D,A<(N&=15)&&(T+=R[h++]<<A,(A+=8)<N&&(T+=R[h++]<<A,A+=8)),_<(H+=T&(1<<N)-1)){o.msg="invalid distance too far back",d.mode=30;break e}if(T>>>=N,A-=N,(N=p-g)<H){if(x<(N=H-N)&&d.sane){o.msg="invalid distance too far back",d.mode=30;break e}if(M=C,(j=0)===E){if(j+=S-N,N<F){for(F-=N;K[p++]=C[j++],--N;);j=p-H,M=K}}else if(E<N){if(j+=S+E-N,(N-=E)<F){for(F-=N;K[p++]=C[j++],--N;);if(j=0,E<F){for(F-=N=E;K[p++]=C[j++],--N;);j=p-H,M=K}}}else if(j+=E-N,N<F){for(F-=N;K[p++]=C[j++],--N;);j=p-H,M=K}for(;2<F;)K[p++]=M[j++],K[p++]=M[j++],K[p++]=M[j++],F-=3;F&&(K[p++]=M[j++],1<F&&(K[p++]=M[j++]))}else{for(j=p-H;K[p++]=K[j++],K[p++]=K[j++],K[p++]=K[j++],2<(F-=3););F&&(K[p++]=K[j++],1<F&&(K[p++]=K[j++]))}break}}break}}while(h<m&&p<v);h-=F=A>>3,T&=(1<<(A-=F<<3))-1,o.next_in=h,o.next_out=p,o.avail_in=h<m?m-h+5:5-(h-m),o.avail_out=p<v?v-p+257:257-(p-v),d.hold=T,d.bits=A}},{}],49:[function(n,r,s){var o=n("../utils/common"),l=n("./adler32"),d=n("./crc32"),h=n("./inffast"),m=n("./inftrees"),p=1,g=2,v=0,_=-2,S=1,x=852,E=592;function C(j){return(j>>>24&255)+(j>>>8&65280)+((65280&j)<<8)+((255&j)<<24)}function T(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new o.Buf16(320),this.work=new o.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function A(j){var M;return j&&j.state?(M=j.state,j.total_in=j.total_out=M.total=0,j.msg="",M.wrap&&(j.adler=1&M.wrap),M.mode=S,M.last=0,M.havedict=0,M.dmax=32768,M.head=null,M.hold=0,M.bits=0,M.lencode=M.lendyn=new o.Buf32(x),M.distcode=M.distdyn=new o.Buf32(E),M.sane=1,M.back=-1,v):_}function B(j){var M;return j&&j.state?((M=j.state).wsize=0,M.whave=0,M.wnext=0,A(j)):_}function U(j,M){var R,K;return j&&j.state?(K=j.state,M<0?(R=0,M=-M):(R=1+(M>>4),M<48&&(M&=15)),M&&(M<8||15<M)?_:(K.window!==null&&K.wbits!==M&&(K.window=null),K.wrap=R,K.wbits=M,B(j))):_}function G(j,M){var R,K;return j?(K=new T,(j.state=K).window=null,(R=U(j,M))!==v&&(j.state=null),R):_}var k,D,N=!0;function F(j){if(N){var M;for(k=new o.Buf32(512),D=new o.Buf32(32),M=0;M<144;)j.lens[M++]=8;for(;M<256;)j.lens[M++]=9;for(;M<280;)j.lens[M++]=7;for(;M<288;)j.lens[M++]=8;for(m(p,j.lens,0,288,k,0,j.work,{bits:9}),M=0;M<32;)j.lens[M++]=5;m(g,j.lens,0,32,D,0,j.work,{bits:5}),N=!1}j.lencode=k,j.lenbits=9,j.distcode=D,j.distbits=5}function H(j,M,R,K){var W,q=j.state;return q.window===null&&(q.wsize=1<<q.wbits,q.wnext=0,q.whave=0,q.window=new o.Buf8(q.wsize)),K>=q.wsize?(o.arraySet(q.window,M,R-q.wsize,q.wsize,0),q.wnext=0,q.whave=q.wsize):(K<(W=q.wsize-q.wnext)&&(W=K),o.arraySet(q.window,M,R-K,W,q.wnext),(K-=W)?(o.arraySet(q.window,M,R-K,K,0),q.wnext=K,q.whave=q.wsize):(q.wnext+=W,q.wnext===q.wsize&&(q.wnext=0),q.whave<q.wsize&&(q.whave+=W))),0}s.inflateReset=B,s.inflateReset2=U,s.inflateResetKeep=A,s.inflateInit=function(j){return G(j,15)},s.inflateInit2=G,s.inflate=function(j,M){var R,K,W,q,J,Z,re,P,$,te,se,ae,ye,Ie,Ee,Ce,pe,Ue,He,Me,L,be,me,ee,X=0,ie=new o.Buf8(4),we=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!j||!j.state||!j.output||!j.input&&j.avail_in!==0)return _;(R=j.state).mode===12&&(R.mode=13),J=j.next_out,W=j.output,re=j.avail_out,q=j.next_in,K=j.input,Z=j.avail_in,P=R.hold,$=R.bits,te=Z,se=re,be=v;e:for(;;)switch(R.mode){case S:if(R.wrap===0){R.mode=13;break}for(;$<16;){if(Z===0)break e;Z--,P+=K[q++]<<$,$+=8}if(2&R.wrap&&P===35615){ie[R.check=0]=255&P,ie[1]=P>>>8&255,R.check=d(R.check,ie,2,0),$=P=0,R.mode=2;break}if(R.flags=0,R.head&&(R.head.done=!1),!(1&R.wrap)||(((255&P)<<8)+(P>>8))%31){j.msg="incorrect header check",R.mode=30;break}if((15&P)!=8){j.msg="unknown compression method",R.mode=30;break}if($-=4,L=8+(15&(P>>>=4)),R.wbits===0)R.wbits=L;else if(L>R.wbits){j.msg="invalid window size",R.mode=30;break}R.dmax=1<<L,j.adler=R.check=1,R.mode=512&P?10:12,$=P=0;break;case 2:for(;$<16;){if(Z===0)break e;Z--,P+=K[q++]<<$,$+=8}if(R.flags=P,(255&R.flags)!=8){j.msg="unknown compression method",R.mode=30;break}if(57344&R.flags){j.msg="unknown header flags set",R.mode=30;break}R.head&&(R.head.text=P>>8&1),512&R.flags&&(ie[0]=255&P,ie[1]=P>>>8&255,R.check=d(R.check,ie,2,0)),$=P=0,R.mode=3;case 3:for(;$<32;){if(Z===0)break e;Z--,P+=K[q++]<<$,$+=8}R.head&&(R.head.time=P),512&R.flags&&(ie[0]=255&P,ie[1]=P>>>8&255,ie[2]=P>>>16&255,ie[3]=P>>>24&255,R.check=d(R.check,ie,4,0)),$=P=0,R.mode=4;case 4:for(;$<16;){if(Z===0)break e;Z--,P+=K[q++]<<$,$+=8}R.head&&(R.head.xflags=255&P,R.head.os=P>>8),512&R.flags&&(ie[0]=255&P,ie[1]=P>>>8&255,R.check=d(R.check,ie,2,0)),$=P=0,R.mode=5;case 5:if(1024&R.flags){for(;$<16;){if(Z===0)break e;Z--,P+=K[q++]<<$,$+=8}R.length=P,R.head&&(R.head.extra_len=P),512&R.flags&&(ie[0]=255&P,ie[1]=P>>>8&255,R.check=d(R.check,ie,2,0)),$=P=0}else R.head&&(R.head.extra=null);R.mode=6;case 6:if(1024&R.flags&&(Z<(ae=R.length)&&(ae=Z),ae&&(R.head&&(L=R.head.extra_len-R.length,R.head.extra||(R.head.extra=new Array(R.head.extra_len)),o.arraySet(R.head.extra,K,q,ae,L)),512&R.flags&&(R.check=d(R.check,K,ae,q)),Z-=ae,q+=ae,R.length-=ae),R.length))break e;R.length=0,R.mode=7;case 7:if(2048&R.flags){if(Z===0)break e;for(ae=0;L=K[q+ae++],R.head&&L&&R.length<65536&&(R.head.name+=String.fromCharCode(L)),L&&ae<Z;);if(512&R.flags&&(R.check=d(R.check,K,ae,q)),Z-=ae,q+=ae,L)break e}else R.head&&(R.head.name=null);R.length=0,R.mode=8;case 8:if(4096&R.flags){if(Z===0)break e;for(ae=0;L=K[q+ae++],R.head&&L&&R.length<65536&&(R.head.comment+=String.fromCharCode(L)),L&&ae<Z;);if(512&R.flags&&(R.check=d(R.check,K,ae,q)),Z-=ae,q+=ae,L)break e}else R.head&&(R.head.comment=null);R.mode=9;case 9:if(512&R.flags){for(;$<16;){if(Z===0)break e;Z--,P+=K[q++]<<$,$+=8}if(P!==(65535&R.check)){j.msg="header crc mismatch",R.mode=30;break}$=P=0}R.head&&(R.head.hcrc=R.flags>>9&1,R.head.done=!0),j.adler=R.check=0,R.mode=12;break;case 10:for(;$<32;){if(Z===0)break e;Z--,P+=K[q++]<<$,$+=8}j.adler=R.check=C(P),$=P=0,R.mode=11;case 11:if(R.havedict===0)return j.next_out=J,j.avail_out=re,j.next_in=q,j.avail_in=Z,R.hold=P,R.bits=$,2;j.adler=R.check=1,R.mode=12;case 12:if(M===5||M===6)break e;case 13:if(R.last){P>>>=7&$,$-=7&$,R.mode=27;break}for(;$<3;){if(Z===0)break e;Z--,P+=K[q++]<<$,$+=8}switch(R.last=1&P,$-=1,3&(P>>>=1)){case 0:R.mode=14;break;case 1:if(F(R),R.mode=20,M!==6)break;P>>>=2,$-=2;break e;case 2:R.mode=17;break;case 3:j.msg="invalid block type",R.mode=30}P>>>=2,$-=2;break;case 14:for(P>>>=7&$,$-=7&$;$<32;){if(Z===0)break e;Z--,P+=K[q++]<<$,$+=8}if((65535&P)!=(P>>>16^65535)){j.msg="invalid stored block lengths",R.mode=30;break}if(R.length=65535&P,$=P=0,R.mode=15,M===6)break e;case 15:R.mode=16;case 16:if(ae=R.length){if(Z<ae&&(ae=Z),re<ae&&(ae=re),ae===0)break e;o.arraySet(W,K,q,ae,J),Z-=ae,q+=ae,re-=ae,J+=ae,R.length-=ae;break}R.mode=12;break;case 17:for(;$<14;){if(Z===0)break e;Z--,P+=K[q++]<<$,$+=8}if(R.nlen=257+(31&P),P>>>=5,$-=5,R.ndist=1+(31&P),P>>>=5,$-=5,R.ncode=4+(15&P),P>>>=4,$-=4,286<R.nlen||30<R.ndist){j.msg="too many length or distance symbols",R.mode=30;break}R.have=0,R.mode=18;case 18:for(;R.have<R.ncode;){for(;$<3;){if(Z===0)break e;Z--,P+=K[q++]<<$,$+=8}R.lens[we[R.have++]]=7&P,P>>>=3,$-=3}for(;R.have<19;)R.lens[we[R.have++]]=0;if(R.lencode=R.lendyn,R.lenbits=7,me={bits:R.lenbits},be=m(0,R.lens,0,19,R.lencode,0,R.work,me),R.lenbits=me.bits,be){j.msg="invalid code lengths set",R.mode=30;break}R.have=0,R.mode=19;case 19:for(;R.have<R.nlen+R.ndist;){for(;Ce=(X=R.lencode[P&(1<<R.lenbits)-1])>>>16&255,pe=65535&X,!((Ee=X>>>24)<=$);){if(Z===0)break e;Z--,P+=K[q++]<<$,$+=8}if(pe<16)P>>>=Ee,$-=Ee,R.lens[R.have++]=pe;else{if(pe===16){for(ee=Ee+2;$<ee;){if(Z===0)break e;Z--,P+=K[q++]<<$,$+=8}if(P>>>=Ee,$-=Ee,R.have===0){j.msg="invalid bit length repeat",R.mode=30;break}L=R.lens[R.have-1],ae=3+(3&P),P>>>=2,$-=2}else if(pe===17){for(ee=Ee+3;$<ee;){if(Z===0)break e;Z--,P+=K[q++]<<$,$+=8}$-=Ee,L=0,ae=3+(7&(P>>>=Ee)),P>>>=3,$-=3}else{for(ee=Ee+7;$<ee;){if(Z===0)break e;Z--,P+=K[q++]<<$,$+=8}$-=Ee,L=0,ae=11+(127&(P>>>=Ee)),P>>>=7,$-=7}if(R.have+ae>R.nlen+R.ndist){j.msg="invalid bit length repeat",R.mode=30;break}for(;ae--;)R.lens[R.have++]=L}}if(R.mode===30)break;if(R.lens[256]===0){j.msg="invalid code -- missing end-of-block",R.mode=30;break}if(R.lenbits=9,me={bits:R.lenbits},be=m(p,R.lens,0,R.nlen,R.lencode,0,R.work,me),R.lenbits=me.bits,be){j.msg="invalid literal/lengths set",R.mode=30;break}if(R.distbits=6,R.distcode=R.distdyn,me={bits:R.distbits},be=m(g,R.lens,R.nlen,R.ndist,R.distcode,0,R.work,me),R.distbits=me.bits,be){j.msg="invalid distances set",R.mode=30;break}if(R.mode=20,M===6)break e;case 20:R.mode=21;case 21:if(6<=Z&&258<=re){j.next_out=J,j.avail_out=re,j.next_in=q,j.avail_in=Z,R.hold=P,R.bits=$,h(j,se),J=j.next_out,W=j.output,re=j.avail_out,q=j.next_in,K=j.input,Z=j.avail_in,P=R.hold,$=R.bits,R.mode===12&&(R.back=-1);break}for(R.back=0;Ce=(X=R.lencode[P&(1<<R.lenbits)-1])>>>16&255,pe=65535&X,!((Ee=X>>>24)<=$);){if(Z===0)break e;Z--,P+=K[q++]<<$,$+=8}if(Ce&&(240&Ce)==0){for(Ue=Ee,He=Ce,Me=pe;Ce=(X=R.lencode[Me+((P&(1<<Ue+He)-1)>>Ue)])>>>16&255,pe=65535&X,!(Ue+(Ee=X>>>24)<=$);){if(Z===0)break e;Z--,P+=K[q++]<<$,$+=8}P>>>=Ue,$-=Ue,R.back+=Ue}if(P>>>=Ee,$-=Ee,R.back+=Ee,R.length=pe,Ce===0){R.mode=26;break}if(32&Ce){R.back=-1,R.mode=12;break}if(64&Ce){j.msg="invalid literal/length code",R.mode=30;break}R.extra=15&Ce,R.mode=22;case 22:if(R.extra){for(ee=R.extra;$<ee;){if(Z===0)break e;Z--,P+=K[q++]<<$,$+=8}R.length+=P&(1<<R.extra)-1,P>>>=R.extra,$-=R.extra,R.back+=R.extra}R.was=R.length,R.mode=23;case 23:for(;Ce=(X=R.distcode[P&(1<<R.distbits)-1])>>>16&255,pe=65535&X,!((Ee=X>>>24)<=$);){if(Z===0)break e;Z--,P+=K[q++]<<$,$+=8}if((240&Ce)==0){for(Ue=Ee,He=Ce,Me=pe;Ce=(X=R.distcode[Me+((P&(1<<Ue+He)-1)>>Ue)])>>>16&255,pe=65535&X,!(Ue+(Ee=X>>>24)<=$);){if(Z===0)break e;Z--,P+=K[q++]<<$,$+=8}P>>>=Ue,$-=Ue,R.back+=Ue}if(P>>>=Ee,$-=Ee,R.back+=Ee,64&Ce){j.msg="invalid distance code",R.mode=30;break}R.offset=pe,R.extra=15&Ce,R.mode=24;case 24:if(R.extra){for(ee=R.extra;$<ee;){if(Z===0)break e;Z--,P+=K[q++]<<$,$+=8}R.offset+=P&(1<<R.extra)-1,P>>>=R.extra,$-=R.extra,R.back+=R.extra}if(R.offset>R.dmax){j.msg="invalid distance too far back",R.mode=30;break}R.mode=25;case 25:if(re===0)break e;if(ae=se-re,R.offset>ae){if((ae=R.offset-ae)>R.whave&&R.sane){j.msg="invalid distance too far back",R.mode=30;break}ye=ae>R.wnext?(ae-=R.wnext,R.wsize-ae):R.wnext-ae,ae>R.length&&(ae=R.length),Ie=R.window}else Ie=W,ye=J-R.offset,ae=R.length;for(re<ae&&(ae=re),re-=ae,R.length-=ae;W[J++]=Ie[ye++],--ae;);R.length===0&&(R.mode=21);break;case 26:if(re===0)break e;W[J++]=R.length,re--,R.mode=21;break;case 27:if(R.wrap){for(;$<32;){if(Z===0)break e;Z--,P|=K[q++]<<$,$+=8}if(se-=re,j.total_out+=se,R.total+=se,se&&(j.adler=R.check=R.flags?d(R.check,W,se,J-se):l(R.check,W,se,J-se)),se=re,(R.flags?P:C(P))!==R.check){j.msg="incorrect data check",R.mode=30;break}$=P=0}R.mode=28;case 28:if(R.wrap&&R.flags){for(;$<32;){if(Z===0)break e;Z--,P+=K[q++]<<$,$+=8}if(P!==(4294967295&R.total)){j.msg="incorrect length check",R.mode=30;break}$=P=0}R.mode=29;case 29:be=1;break e;case 30:be=-3;break e;case 31:return-4;default:return _}return j.next_out=J,j.avail_out=re,j.next_in=q,j.avail_in=Z,R.hold=P,R.bits=$,(R.wsize||se!==j.avail_out&&R.mode<30&&(R.mode<27||M!==4))&&H(j,j.output,j.next_out,se-j.avail_out)?(R.mode=31,-4):(te-=j.avail_in,se-=j.avail_out,j.total_in+=te,j.total_out+=se,R.total+=se,R.wrap&&se&&(j.adler=R.check=R.flags?d(R.check,W,se,j.next_out-se):l(R.check,W,se,j.next_out-se)),j.data_type=R.bits+(R.last?64:0)+(R.mode===12?128:0)+(R.mode===20||R.mode===15?256:0),(te==0&&se===0||M===4)&&be===v&&(be=-5),be)},s.inflateEnd=function(j){if(!j||!j.state)return _;var M=j.state;return M.window&&(M.window=null),j.state=null,v},s.inflateGetHeader=function(j,M){var R;return j&&j.state?(2&(R=j.state).wrap)==0?_:((R.head=M).done=!1,v):_},s.inflateSetDictionary=function(j,M){var R,K=M.length;return j&&j.state?(R=j.state).wrap!==0&&R.mode!==11?_:R.mode===11&&l(1,M,K,0)!==R.check?-3:H(j,M,K,K)?(R.mode=31,-4):(R.havedict=1,v):_},s.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(n,r,s){var o=n("../utils/common"),l=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],d=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],h=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],m=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];r.exports=function(p,g,v,_,S,x,E,C){var T,A,B,U,G,k,D,N,F,H=C.bits,j=0,M=0,R=0,K=0,W=0,q=0,J=0,Z=0,re=0,P=0,$=null,te=0,se=new o.Buf16(16),ae=new o.Buf16(16),ye=null,Ie=0;for(j=0;j<=15;j++)se[j]=0;for(M=0;M<_;M++)se[g[v+M]]++;for(W=H,K=15;1<=K&&se[K]===0;K--);if(K<W&&(W=K),K===0)return S[x++]=20971520,S[x++]=20971520,C.bits=1,0;for(R=1;R<K&&se[R]===0;R++);for(W<R&&(W=R),j=Z=1;j<=15;j++)if(Z<<=1,(Z-=se[j])<0)return-1;if(0<Z&&(p===0||K!==1))return-1;for(ae[1]=0,j=1;j<15;j++)ae[j+1]=ae[j]+se[j];for(M=0;M<_;M++)g[v+M]!==0&&(E[ae[g[v+M]]++]=M);if(k=p===0?($=ye=E,19):p===1?($=l,te-=257,ye=d,Ie-=257,256):($=h,ye=m,-1),j=R,G=x,J=M=P=0,B=-1,U=(re=1<<(q=W))-1,p===1&&852<re||p===2&&592<re)return 1;for(;;){for(D=j-J,F=E[M]<k?(N=0,E[M]):E[M]>k?(N=ye[Ie+E[M]],$[te+E[M]]):(N=96,0),T=1<<j-J,R=A=1<<q;S[G+(P>>J)+(A-=T)]=D<<24|N<<16|F|0,A!==0;);for(T=1<<j-1;P&T;)T>>=1;if(T!==0?(P&=T-1,P+=T):P=0,M++,--se[j]==0){if(j===K)break;j=g[v+E[M]]}if(W<j&&(P&U)!==B){for(J===0&&(J=W),G+=R,Z=1<<(q=j-J);q+J<K&&!((Z-=se[q+J])<=0);)q++,Z<<=1;if(re+=1<<q,p===1&&852<re||p===2&&592<re)return 1;S[B=P&U]=W<<24|q<<16|G-x|0}}return P!==0&&(S[G+P]=j-J<<24|64<<16|0),C.bits=W,0}},{"../utils/common":41}],51:[function(n,r,s){r.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(n,r,s){var o=n("../utils/common"),l=0,d=1;function h(X){for(var ie=X.length;0<=--ie;)X[ie]=0}var m=0,p=29,g=256,v=g+1+p,_=30,S=19,x=2*v+1,E=15,C=16,T=7,A=256,B=16,U=17,G=18,k=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],D=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],N=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],F=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],H=new Array(2*(v+2));h(H);var j=new Array(2*_);h(j);var M=new Array(512);h(M);var R=new Array(256);h(R);var K=new Array(p);h(K);var W,q,J,Z=new Array(_);function re(X,ie,we,xe,oe){this.static_tree=X,this.extra_bits=ie,this.extra_base=we,this.elems=xe,this.max_length=oe,this.has_stree=X&&X.length}function P(X,ie){this.dyn_tree=X,this.max_code=0,this.stat_desc=ie}function $(X){return X<256?M[X]:M[256+(X>>>7)]}function te(X,ie){X.pending_buf[X.pending++]=255&ie,X.pending_buf[X.pending++]=ie>>>8&255}function se(X,ie,we){X.bi_valid>C-we?(X.bi_buf|=ie<<X.bi_valid&65535,te(X,X.bi_buf),X.bi_buf=ie>>C-X.bi_valid,X.bi_valid+=we-C):(X.bi_buf|=ie<<X.bi_valid&65535,X.bi_valid+=we)}function ae(X,ie,we){se(X,we[2*ie],we[2*ie+1])}function ye(X,ie){for(var we=0;we|=1&X,X>>>=1,we<<=1,0<--ie;);return we>>>1}function Ie(X,ie,we){var xe,oe,Ae=new Array(E+1),Ne=0;for(xe=1;xe<=E;xe++)Ae[xe]=Ne=Ne+we[xe-1]<<1;for(oe=0;oe<=ie;oe++){var ke=X[2*oe+1];ke!==0&&(X[2*oe]=ye(Ae[ke]++,ke))}}function Ee(X){var ie;for(ie=0;ie<v;ie++)X.dyn_ltree[2*ie]=0;for(ie=0;ie<_;ie++)X.dyn_dtree[2*ie]=0;for(ie=0;ie<S;ie++)X.bl_tree[2*ie]=0;X.dyn_ltree[2*A]=1,X.opt_len=X.static_len=0,X.last_lit=X.matches=0}function Ce(X){8<X.bi_valid?te(X,X.bi_buf):0<X.bi_valid&&(X.pending_buf[X.pending++]=X.bi_buf),X.bi_buf=0,X.bi_valid=0}function pe(X,ie,we,xe){var oe=2*ie,Ae=2*we;return X[oe]<X[Ae]||X[oe]===X[Ae]&&xe[ie]<=xe[we]}function Ue(X,ie,we){for(var xe=X.heap[we],oe=we<<1;oe<=X.heap_len&&(oe<X.heap_len&&pe(ie,X.heap[oe+1],X.heap[oe],X.depth)&&oe++,!pe(ie,xe,X.heap[oe],X.depth));)X.heap[we]=X.heap[oe],we=oe,oe<<=1;X.heap[we]=xe}function He(X,ie,we){var xe,oe,Ae,Ne,ke=0;if(X.last_lit!==0)for(;xe=X.pending_buf[X.d_buf+2*ke]<<8|X.pending_buf[X.d_buf+2*ke+1],oe=X.pending_buf[X.l_buf+ke],ke++,xe===0?ae(X,oe,ie):(ae(X,(Ae=R[oe])+g+1,ie),(Ne=k[Ae])!==0&&se(X,oe-=K[Ae],Ne),ae(X,Ae=$(--xe),we),(Ne=D[Ae])!==0&&se(X,xe-=Z[Ae],Ne)),ke<X.last_lit;);ae(X,A,ie)}function Me(X,ie){var we,xe,oe,Ae=ie.dyn_tree,Ne=ie.stat_desc.static_tree,ke=ie.stat_desc.has_stree,qe=ie.stat_desc.elems,vt=-1;for(X.heap_len=0,X.heap_max=x,we=0;we<qe;we++)Ae[2*we]!==0?(X.heap[++X.heap_len]=vt=we,X.depth[we]=0):Ae[2*we+1]=0;for(;X.heap_len<2;)Ae[2*(oe=X.heap[++X.heap_len]=vt<2?++vt:0)]=1,X.depth[oe]=0,X.opt_len--,ke&&(X.static_len-=Ne[2*oe+1]);for(ie.max_code=vt,we=X.heap_len>>1;1<=we;we--)Ue(X,Ae,we);for(oe=qe;we=X.heap[1],X.heap[1]=X.heap[X.heap_len--],Ue(X,Ae,1),xe=X.heap[1],X.heap[--X.heap_max]=we,X.heap[--X.heap_max]=xe,Ae[2*oe]=Ae[2*we]+Ae[2*xe],X.depth[oe]=(X.depth[we]>=X.depth[xe]?X.depth[we]:X.depth[xe])+1,Ae[2*we+1]=Ae[2*xe+1]=oe,X.heap[1]=oe++,Ue(X,Ae,1),2<=X.heap_len;);X.heap[--X.heap_max]=X.heap[1],(function(rt,Hn){var ui,Xn,di,_t,Zt,qn,St=Hn.dyn_tree,za=Hn.max_code,js=Hn.stat_desc.static_tree,Po=Hn.stat_desc.has_stree,Tr=Hn.stat_desc.extra_bits,hi=Hn.stat_desc.extra_base,Bt=Hn.stat_desc.max_length,Zn=0;for(_t=0;_t<=E;_t++)rt.bl_count[_t]=0;for(St[2*rt.heap[rt.heap_max]+1]=0,ui=rt.heap_max+1;ui<x;ui++)Bt<(_t=St[2*St[2*(Xn=rt.heap[ui])+1]+1]+1)&&(_t=Bt,Zn++),St[2*Xn+1]=_t,za<Xn||(rt.bl_count[_t]++,Zt=0,hi<=Xn&&(Zt=Tr[Xn-hi]),qn=St[2*Xn],rt.opt_len+=qn*(_t+Zt),Po&&(rt.static_len+=qn*(js[2*Xn+1]+Zt)));if(Zn!==0){do{for(_t=Bt-1;rt.bl_count[_t]===0;)_t--;rt.bl_count[_t]--,rt.bl_count[_t+1]+=2,rt.bl_count[Bt]--,Zn-=2}while(0<Zn);for(_t=Bt;_t!==0;_t--)for(Xn=rt.bl_count[_t];Xn!==0;)za<(di=rt.heap[--ui])||(St[2*di+1]!==_t&&(rt.opt_len+=(_t-St[2*di+1])*St[2*di],St[2*di+1]=_t),Xn--)}})(X,ie),Ie(Ae,vt,X.bl_count)}function L(X,ie,we){var xe,oe,Ae=-1,Ne=ie[1],ke=0,qe=7,vt=4;for(Ne===0&&(qe=138,vt=3),ie[2*(we+1)+1]=65535,xe=0;xe<=we;xe++)oe=Ne,Ne=ie[2*(xe+1)+1],++ke<qe&&oe===Ne||(ke<vt?X.bl_tree[2*oe]+=ke:oe!==0?(oe!==Ae&&X.bl_tree[2*oe]++,X.bl_tree[2*B]++):ke<=10?X.bl_tree[2*U]++:X.bl_tree[2*G]++,Ae=oe,vt=(ke=0)===Ne?(qe=138,3):oe===Ne?(qe=6,3):(qe=7,4))}function be(X,ie,we){var xe,oe,Ae=-1,Ne=ie[1],ke=0,qe=7,vt=4;for(Ne===0&&(qe=138,vt=3),xe=0;xe<=we;xe++)if(oe=Ne,Ne=ie[2*(xe+1)+1],!(++ke<qe&&oe===Ne)){if(ke<vt)for(;ae(X,oe,X.bl_tree),--ke!=0;);else oe!==0?(oe!==Ae&&(ae(X,oe,X.bl_tree),ke--),ae(X,B,X.bl_tree),se(X,ke-3,2)):ke<=10?(ae(X,U,X.bl_tree),se(X,ke-3,3)):(ae(X,G,X.bl_tree),se(X,ke-11,7));Ae=oe,vt=(ke=0)===Ne?(qe=138,3):oe===Ne?(qe=6,3):(qe=7,4)}}h(Z);var me=!1;function ee(X,ie,we,xe){se(X,(m<<1)+(xe?1:0),3),(function(oe,Ae,Ne,ke){Ce(oe),te(oe,Ne),te(oe,~Ne),o.arraySet(oe.pending_buf,oe.window,Ae,Ne,oe.pending),oe.pending+=Ne})(X,ie,we)}s._tr_init=function(X){me||((function(){var ie,we,xe,oe,Ae,Ne=new Array(E+1);for(oe=xe=0;oe<p-1;oe++)for(K[oe]=xe,ie=0;ie<1<<k[oe];ie++)R[xe++]=oe;for(R[xe-1]=oe,oe=Ae=0;oe<16;oe++)for(Z[oe]=Ae,ie=0;ie<1<<D[oe];ie++)M[Ae++]=oe;for(Ae>>=7;oe<_;oe++)for(Z[oe]=Ae<<7,ie=0;ie<1<<D[oe]-7;ie++)M[256+Ae++]=oe;for(we=0;we<=E;we++)Ne[we]=0;for(ie=0;ie<=143;)H[2*ie+1]=8,ie++,Ne[8]++;for(;ie<=255;)H[2*ie+1]=9,ie++,Ne[9]++;for(;ie<=279;)H[2*ie+1]=7,ie++,Ne[7]++;for(;ie<=287;)H[2*ie+1]=8,ie++,Ne[8]++;for(Ie(H,v+1,Ne),ie=0;ie<_;ie++)j[2*ie+1]=5,j[2*ie]=ye(ie,5);W=new re(H,k,g+1,v,E),q=new re(j,D,0,_,E),J=new re(new Array(0),N,0,S,T)})(),me=!0),X.l_desc=new P(X.dyn_ltree,W),X.d_desc=new P(X.dyn_dtree,q),X.bl_desc=new P(X.bl_tree,J),X.bi_buf=0,X.bi_valid=0,Ee(X)},s._tr_stored_block=ee,s._tr_flush_block=function(X,ie,we,xe){var oe,Ae,Ne=0;0<X.level?(X.strm.data_type===2&&(X.strm.data_type=(function(ke){var qe,vt=4093624447;for(qe=0;qe<=31;qe++,vt>>>=1)if(1&vt&&ke.dyn_ltree[2*qe]!==0)return l;if(ke.dyn_ltree[18]!==0||ke.dyn_ltree[20]!==0||ke.dyn_ltree[26]!==0)return d;for(qe=32;qe<g;qe++)if(ke.dyn_ltree[2*qe]!==0)return d;return l})(X)),Me(X,X.l_desc),Me(X,X.d_desc),Ne=(function(ke){var qe;for(L(ke,ke.dyn_ltree,ke.l_desc.max_code),L(ke,ke.dyn_dtree,ke.d_desc.max_code),Me(ke,ke.bl_desc),qe=S-1;3<=qe&&ke.bl_tree[2*F[qe]+1]===0;qe--);return ke.opt_len+=3*(qe+1)+5+5+4,qe})(X),oe=X.opt_len+3+7>>>3,(Ae=X.static_len+3+7>>>3)<=oe&&(oe=Ae)):oe=Ae=we+5,we+4<=oe&&ie!==-1?ee(X,ie,we,xe):X.strategy===4||Ae===oe?(se(X,2+(xe?1:0),3),He(X,H,j)):(se(X,4+(xe?1:0),3),(function(ke,qe,vt,rt){var Hn;for(se(ke,qe-257,5),se(ke,vt-1,5),se(ke,rt-4,4),Hn=0;Hn<rt;Hn++)se(ke,ke.bl_tree[2*F[Hn]+1],3);be(ke,ke.dyn_ltree,qe-1),be(ke,ke.dyn_dtree,vt-1)})(X,X.l_desc.max_code+1,X.d_desc.max_code+1,Ne+1),He(X,X.dyn_ltree,X.dyn_dtree)),Ee(X),xe&&Ce(X)},s._tr_tally=function(X,ie,we){return X.pending_buf[X.d_buf+2*X.last_lit]=ie>>>8&255,X.pending_buf[X.d_buf+2*X.last_lit+1]=255&ie,X.pending_buf[X.l_buf+X.last_lit]=255&we,X.last_lit++,ie===0?X.dyn_ltree[2*we]++:(X.matches++,ie--,X.dyn_ltree[2*(R[we]+g+1)]++,X.dyn_dtree[2*$(ie)]++),X.last_lit===X.lit_bufsize-1},s._tr_align=function(X){se(X,2,3),ae(X,A,H),(function(ie){ie.bi_valid===16?(te(ie,ie.bi_buf),ie.bi_buf=0,ie.bi_valid=0):8<=ie.bi_valid&&(ie.pending_buf[ie.pending++]=255&ie.bi_buf,ie.bi_buf>>=8,ie.bi_valid-=8)})(X)}},{"../utils/common":41}],53:[function(n,r,s){r.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(n,r,s){(function(o){(function(l,d){if(!l.setImmediate){var h,m,p,g,v=1,_={},S=!1,x=l.document,E=Object.getPrototypeOf&&Object.getPrototypeOf(l);E=E&&E.setTimeout?E:l,h={}.toString.call(l.process)==="[object process]"?function(B){process.nextTick(function(){T(B)})}:(function(){if(l.postMessage&&!l.importScripts){var B=!0,U=l.onmessage;return l.onmessage=function(){B=!1},l.postMessage("","*"),l.onmessage=U,B}})()?(g="setImmediate$"+Math.random()+"$",l.addEventListener?l.addEventListener("message",A,!1):l.attachEvent("onmessage",A),function(B){l.postMessage(g+B,"*")}):l.MessageChannel?((p=new MessageChannel).port1.onmessage=function(B){T(B.data)},function(B){p.port2.postMessage(B)}):x&&"onreadystatechange"in x.createElement("script")?(m=x.documentElement,function(B){var U=x.createElement("script");U.onreadystatechange=function(){T(B),U.onreadystatechange=null,m.removeChild(U),U=null},m.appendChild(U)}):function(B){setTimeout(T,0,B)},E.setImmediate=function(B){typeof B!="function"&&(B=new Function(""+B));for(var U=new Array(arguments.length-1),G=0;G<U.length;G++)U[G]=arguments[G+1];var k={callback:B,args:U};return _[v]=k,h(v),v++},E.clearImmediate=C}function C(B){delete _[B]}function T(B){if(S)setTimeout(T,0,B);else{var U=_[B];if(U){S=!0;try{(function(G){var k=G.callback,D=G.args;switch(D.length){case 0:k();break;case 1:k(D[0]);break;case 2:k(D[0],D[1]);break;case 3:k(D[0],D[1],D[2]);break;default:k.apply(d,D)}})(U)}finally{C(B),S=!1}}}}function A(B){B.source===l&&typeof B.data=="string"&&B.data.indexOf(g)===0&&T(+B.data.slice(g.length))}})(typeof self>"u"?o===void 0?this:o:self)}).call(this,typeof Lh<"u"?Lh:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(qg)),qg.exports}var UP=LP();const xm=Z5(UP);function FP({currentUser:t,budgetId:e}){const[n,r]=O.useState(!1),[s,o]=O.useState(null),[l,d]=O.useState(null);async function h(){if(!t){d("Must be logged in to download budget");return}if(!e){d("No budget selected");return}r(!0),d(null),o({phase:"reading",current:0,total:1,percentComplete:0});try{o({phase:"reading",current:0,total:1,percentComplete:10});const{exists:m,data:p}=await bt("budgets",e,`downloading budget ${e}`);if(!m||!p){d(`Budget ${e} not found`);return}const g=await MT(e,"download-budget");let v=null;try{const{exists:j,data:M}=await bt("payees",e,`downloading payees for budget ${e}`);j&&M&&(v=M)}catch(j){console.warn(`Could not read payees for budget ${e}:`,j)}o({phase:"processing",current:0,total:g.length+1,percentComplete:20});const _=new xm,S=new Date,x=S.toISOString().split("T")[0],E=`budget_${e}`,{accounts:C,account_groups:T,categories:A,category_groups:B,...U}=p;_.file(`${E}/budget.json`,JSON.stringify(U,null,2)),_.file(`${E}/accounts.json`,JSON.stringify(C||{},null,2)),_.file(`${E}/account_groups.json`,JSON.stringify(T||{},null,2)),_.file(`${E}/categories.json`,JSON.stringify(A||{},null,2)),_.file(`${E}/category_groups.json`,JSON.stringify(B||[],null,2)),v&&_.file(`${E}/payees.json`,JSON.stringify(v,null,2));let G=0;for(const j of g){const M=j.data,R=`${E}/months/month_${M.year}_${String(M.month).padStart(2,"0")}`,K={};if(M.are_allocations_finalized&&M.category_balances)for(const W of M.category_balances)W.allocated!==void 0&&(K[W.category_id]=W.allocated);_.file(`${R}/metadata.json`,JSON.stringify({budget_id:M.budget_id,year_month_ordinal:M.year_month_ordinal,year:M.year,month:M.month,total_income:M.total_income,previous_month_income:M.previous_month_income,total_expenses:M.total_expenses,are_allocations_finalized:M.are_allocations_finalized,created_at:M.created_at,updated_at:M.updated_at,...M.are_allocations_finalized&&{allocations:K},downloaded_at:S.toISOString()},null,2)),_.file(`${R}/income.json`,JSON.stringify(M.income||[],null,2)),_.file(`${R}/expenses.json`,JSON.stringify(M.expenses||[],null,2)),_.file(`${R}/transfers.json`,JSON.stringify(M.transfers||[],null,2)),_.file(`${R}/adjustments.json`,JSON.stringify(M.adjustments||[],null,2)),_.file(`${R}/account_balances.json`,JSON.stringify(M.account_balances||[],null,2)),_.file(`${R}/category_balances.json`,JSON.stringify(M.category_balances||[],null,2)),G++,o({phase:"processing",current:G,total:g.length,percentComplete:20+Math.round(G/g.length*60)})}o({phase:"zipping",current:0,total:1,percentComplete:80});const k=await _.generateAsync({type:"blob"});o({phase:"complete",current:1,total:1,percentComplete:100});const N=(p.name||"budget").replace(/[^a-z0-9]/gi,"_").toLowerCase(),F=URL.createObjectURL(k),H=document.createElement("a");H.href=F,H.download=`${x}_${N}_${e}.zip`,document.body.appendChild(H),H.click(),document.body.removeChild(H),URL.revokeObjectURL(F)}catch(m){d(m instanceof Error?m.message:"Unknown error during download")}finally{r(!1),o(null)}}return{isDownloading:n,progress:s,error:l,downloadBudget:h}}async function VP(t){const n=await new xm().loadAsync(t),r=new Set,s=new Set;for(const[o]of Object.entries(n.files)){const l=o.match(/^budget_([^/]+)\//);if(l){const d=l[1];r.add(d),o.match(/^budget_([^/]+)\/months\/month_\d{4}_\d{2}\//)&&s.add(o.split("/months/")[1].split("/")[0])}}return{budgetsFound:r.size,monthsFound:s.size,payeesFound:r.size,budgetsToRestore:Array.from(r)}}async function $P(t,e,n){const s=`${`${e}/months/`}${n}/`,o=`${s}metadata.json`,l=t.files[o];if(!l)return null;const d=await l.async("string"),h=JSON.parse(d),{downloaded_at:m,allocations:p,...g}=h,v=async E=>{const C=`${s}${E}`,T=t.files[C];if(T){const A=await T.async("string");return JSON.parse(A)}return[]},_={budget_id:g.budget_id,year:g.year,month:g.month,year_month_ordinal:g.year_month_ordinal,total_income:0,previous_month_income:0,total_expenses:0,are_allocations_finalized:g.are_allocations_finalized??!1,created_at:g.created_at||new Date().toISOString(),updated_at:new Date().toISOString(),income:await v("income.json"),expenses:await v("expenses.json"),transfers:await v("transfers.json"),adjustments:await v("adjustments.json"),account_balances:[],category_balances:[]},S=Co(_);let x=fr(S);if(h.are_allocations_finalized&&p!==void 0){const E=new Map;for(const A of x.category_balances)E.set(A.category_id,A);const C=[],T=new Set;for(const A of x.category_balances){const B=p[A.category_id];if(B!==void 0){const U=Oe(B);C.push({...A,allocated:U,end_balance:Oe(A.start_balance+U+A.spent+A.transfers+A.adjustments)})}else C.push(A);T.add(A.category_id)}for(const[A,B]of Object.entries(p))if(!T.has(A)){const U=Oe(B);C.push({category_id:A,start_balance:0,allocated:U,spent:0,transfers:0,adjustments:0,end_balance:U})}x={...x,category_balances:C}}return{budgetId:g.budget_id,year:g.year,month:g.month,data:x}}async function HP(t,e){const n=`budget_${e}`,r=async G=>{const k=t.files[G];if(k){const D=await k.async("string");return JSON.parse(D)}return null},s=`${n}/budget.json`,o=`${n}/accounts.json`,l=`${n}/account_groups.json`,d=`${n}/categories.json`,h=`${n}/category_groups.json`,m=await r(s);if(!m)throw new Error("Missing required file budget.json");const p=await r(o)||{},g=await r(l)||{},v=await r(d)||{},_=await r(h)||[],S=Co({...m,accounts:p,account_groups:g,categories:v,category_groups:_}),x={budgetId:e,data:S},E=`${n}/payees.json`,C=await r(E);let T=null;if(C){const G={...C,budget_id:e,updated_at:new Date().toISOString()};T={collectionPath:"payees",docId:e,data:Co(G)}}const A=`${n}/months/`,B=new Set;for(const G of Object.keys(t.files))if(G.startsWith(A)&&G.includes("/metadata.json")){const k=G.split("/months/")[1].split("/")[0];B.add(k)}const U=[];for(const G of B){const k=await $P(t,n,G);k&&U.push(k)}return{budgetUpdate:x,monthUpdates:U,payeeWrite:T}}function qP({currentUser:t}){const[e,n]=O.useState(!1),[r,s]=O.useState(!1),[o,l]=O.useState(null),[d,h]=O.useState(null),[m,p]=O.useState(null),[g,v]=O.useState(null);async function _(x){if(!t){p("Must be logged in to upload budget");return}n(!0),p(null),l(null),v(null);try{const E=await VP(x);l(E)}catch(E){p(E instanceof Error?E.message:"Failed to parse zip file")}finally{n(!1)}}async function S(x){if(!t){p("Must be logged in to upload budget");return}if(!o){p("Must scan file first");return}s(!0),p(null),h({phase:"parsing",current:0,total:1,percentComplete:0});const E=[];let C=0,T=0,A=0;try{h({phase:"parsing",current:0,total:1,percentComplete:10});const U=await new xm().loadAsync(x);h({phase:"validating",current:0,total:1,percentComplete:20}),h({phase:"uploading",current:0,total:o.budgetsToRestore.length,percentComplete:30});const G=[],k=[],D=[];for(let N=0;N<o.budgetsToRestore.length;N++){const F=o.budgetsToRestore[N];try{const{budgetUpdate:H,monthUpdates:j,payeeWrite:M}=await HP(U,F);G.push(H),k.push(...j),M&&D.push(M),h({phase:"uploading",current:N+1,total:o.budgetsToRestore.length,percentComplete:30+Math.round((N+1)/o.budgetsToRestore.length*50)})}catch(H){E.push(`Budget ${F}: ${H instanceof Error?H.message:String(H)}`)}}if(h({phase:"uploading",current:o.budgetsToRestore.length,total:o.budgetsToRestore.length,percentComplete:80}),G.length>0)try{console.log(`[Upload] Writing ${G.length} budget(s)...`),await U0(G,"upload-budget"),C=G.length,console.log(`[Upload] Successfully wrote ${C} budget(s)`)}catch(N){const F=`Failed to write budgets: ${N instanceof Error?N.message:String(N)}`;throw console.error(`[Upload] ${F}`,N),E.push(F),N}if(D.length>0)try{console.log(`[Upload] Writing ${D.length} payee doc(s)...`),await pm(D,"upload-budget: writing payees"),A=D.length,console.log(`[Upload] Successfully wrote ${A} payee doc(s)`)}catch(N){const F=`Failed to write payees: ${N instanceof Error?N.message:String(N)}`;throw console.error(`[Upload] ${F}`,N),E.push(F),N}if(k.length>0)try{console.log(`[Upload] Writing ${k.length} month(s) and recalculating...`),await PT(k,"upload-budget"),T=k.length,console.log(`[Upload] Successfully wrote ${T} month(s)`)}catch(N){const F=`Failed to write months: ${N instanceof Error?N.message:String(N)}`;throw console.error(`[Upload] ${F}`,N),E.push(F),N}h({phase:"complete",current:1,total:1,percentComplete:100}),v({success:E.length===0,budgetsRestored:C,monthsRestored:T,payeesRestored:A,errors:E}),console.log("[Upload] Clearing all caches after upload..."),Ra()}catch(B){const U=B instanceof Error?B.message:"Unknown error during upload";console.error("[Upload] Upload failed with error:",B),console.error("[Upload] Error details:",{errorMessage:U,budgetsRestored:C,monthsRestored:T,payeesRestored:A,errorsSoFar:E}),p(U),v({success:!1,budgetsRestored:C,monthsRestored:T,payeesRestored:A,errors:[...E,U]}),console.log("[Upload] Clearing all caches after failed upload (partial writes possible)..."),Ra()}finally{s(!1),h(null)}}return{isScanning:e,isUploading:r,status:o,progress:d,error:m,result:g,scanZipFile:_,uploadBudget:S}}function US({budget:t,isCurrent:e,isAccepting:n,isSwitching:r,isEditing:s,editName:o,isRenaming:l,onAccept:d,onSwitch:h,onStartEdit:m,onCancelEdit:p,onEditNameChange:g,onSaveEdit:v}){const _=e&&t.isOwner;return u.jsx("div",{style:{background:e?"color-mix(in srgb, #646cff 15%, transparent)":"color-mix(in srgb, currentColor 8%, transparent)",border:e?"2px solid color-mix(in srgb, #646cff 50%, transparent)":"1px solid transparent",padding:"1rem",borderRadius:"8px"},children:s?u.jsxs("form",{onSubmit:v,children:[u.jsx("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"0.5rem"},children:u.jsx("input",{type:"text",value:o,onChange:S=>g(S.target.value),placeholder:"Budget name",autoFocus:!0,style:{flex:1,padding:"0.5rem 0.75rem",borderRadius:"6px",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"1rem",fontWeight:600,color:"inherit"}})}),u.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[u.jsx("button",{type:"submit",disabled:l||!o.trim(),style:{background:"#22c55e",color:"white",border:"none",padding:"0.4rem 0.75rem",borderRadius:"6px",cursor:l||!o.trim()?"not-allowed":"pointer",fontWeight:500,opacity:l||!o.trim()?.7:1,fontSize:"0.8rem"},children:l?"Saving...":"Save"}),u.jsx("button",{type:"button",onClick:p,disabled:l,style:{background:"transparent",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)",padding:"0.4rem 0.75rem",borderRadius:"6px",cursor:l?"not-allowed":"pointer",fontWeight:500,opacity:l?.7:.8,fontSize:"0.8rem"},children:"Cancel"})]})]}):u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem",flexWrap:"wrap"},children:[u.jsxs("div",{style:{flex:1,minWidth:"200px"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flexWrap:"wrap",marginBottom:"0.25rem"},children:[u.jsx("span",{style:{fontWeight:600},children:t.name}),t.isOwner&&u.jsx("span",{style:{background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.65rem",textTransform:"uppercase",fontWeight:600},children:"Owner"}),e&&u.jsx("span",{style:{background:"color-mix(in srgb, #22c55e 20%, transparent)",color:"#4ade80",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.65rem",textTransform:"uppercase",fontWeight:600},children:"Active"}),t.isPending&&u.jsx("span",{style:{background:"color-mix(in srgb, #f59e0b 20%, transparent)",color:"#fbbf24",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.65rem",textTransform:"uppercase",fontWeight:600},children:"Pending"}),_&&u.jsx("button",{onClick:m,style:{background:"transparent",border:"none",padding:"0.15rem",cursor:"pointer",opacity:.5,fontSize:"0.8rem",lineHeight:1},title:"Rename budget",children:""})]}),u.jsx("p",{style:{margin:0,fontSize:"0.8rem",opacity:.6},children:t.ownerEmail?`Owner: ${t.ownerEmail}`:`ID: ${t.id}`})]}),u.jsx("div",{style:{display:"flex",gap:"0.5rem"},children:t.isPending?u.jsx("button",{onClick:d,disabled:n,style:{background:"#22c55e",color:"white",border:"none",padding:"0.5rem 1rem",borderRadius:"6px",cursor:n?"not-allowed":"pointer",fontWeight:500,opacity:n?.7:1,fontSize:"0.85rem"},children:n?"Accepting...":"Accept"}):e?null:u.jsx("button",{onClick:h,disabled:r,style:{background:"#646cff",color:"white",border:"none",padding:"0.5rem 1rem",borderRadius:"6px",cursor:r?"not-allowed":"pointer",fontWeight:500,opacity:r?.7:1,fontSize:"0.85rem"},children:r?"Switching...":"Switch"})})]})})}const ce={primary:"#646cff",error:"#f87171",errorBg:"rgba(220, 38, 38, 0.1)",errorBorder:"rgba(220, 38, 38, 0.3)",success:"#4ade80",danger:"#f87171",warning:"#facc15",debt:"#fb923c",zero:"rgba(255, 255, 255, 0.4)"},ri={textDecoration:"underline",textDecorationStyle:"dotted",textUnderlineOffset:"3px"},Nf="1px solid color-mix(in srgb, currentColor 20%, transparent)",Pf={maxWidth:"var(--page-max-width, 85rem)",margin:"0 auto",padding:"var(--page-padding, 2rem)"},pd={background:"color-mix(in srgb, currentColor 8%, transparent)",padding:"1rem 1.25rem",borderRadius:"8px",display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem"},GP={...pd,padding:"0.6rem 0.875rem",gap:"0.5rem"},WP={background:"color-mix(in srgb, currentColor 8%, transparent)",padding:"1.25rem",borderRadius:"8px",display:"flex",flexDirection:"column",gap:"1rem"},QP={display:"flex",flexDirection:"column",gap:"0.5rem"},KP={fontSize:"0.9rem",fontWeight:500},Ma={padding:"0.6rem 0.8rem",borderRadius:"6px",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"1rem",color:"inherit",width:"100%",boxSizing:"border-box"},YP={...Ma,cursor:"pointer"},F0={padding:"0.6rem 1.25rem",borderRadius:"6px",cursor:"pointer",fontWeight:500,fontSize:"0.9rem",transition:"opacity 0.15s"},WT={...F0,background:ce.primary,color:"white",border:"none"},XP={...WT,padding:"0.75rem 1.5rem",borderRadius:"8px"},ZP={...F0,background:"transparent",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)"},JP={...F0,background:"transparent",border:`1px solid ${ce.errorBorder}`,color:ce.error},ez={background:"transparent",border:"1px solid color-mix(in srgb, currentColor 25%, transparent)",padding:"0.35rem 0.75rem",borderRadius:"6px",cursor:"pointer",fontSize:"0.8rem",opacity:.8,transition:"opacity 0.15s"},tz={display:"flex",gap:"0.5rem"},nz={display:"flex",gap:"0.25rem"},QT={background:"transparent",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",padding:"0.35rem",borderRadius:"6px",cursor:"pointer",fontSize:"0.9rem",lineHeight:1,display:"flex",alignItems:"center",justifyContent:"center",minWidth:"2rem",minHeight:"2rem",transition:"opacity 0.15s, border-color 0.15s"},rz={...QT,borderColor:ce.errorBorder,color:ce.error},Yl={background:"transparent",border:"1px solid color-mix(in srgb, currentColor 15%, transparent)",padding:"0.25rem 0.35rem",borderRadius:"4px",cursor:"pointer",fontSize:"0.75rem",lineHeight:1,display:"flex",alignItems:"center",justifyContent:"center",opacity:.6,transition:"opacity 0.15s, background 0.15s"},V0={display:"flex",flexDirection:"column",gap:"2px"},iz={display:"flex",gap:"0.75rem",marginTop:"0.5rem"},KT={opacity:.4,cursor:"grab"},YT={position:"absolute",top:"-4px",left:0,right:0,height:"3px",background:ce.primary,borderRadius:"2px",transition:"opacity 0.15s"},sz={position:"relative",height:"2rem",marginTop:"-0.25rem"},az={position:"absolute",top:"50%",left:0,right:0,height:"3px",background:ce.primary,borderRadius:"2px",transition:"opacity 0.15s"},oz={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"0.75rem",opacity:.7,background:"var(--background, #1a1a1a)",padding:"0 0.5rem",whiteSpace:"nowrap"},lz={background:ce.errorBg,border:`1px solid ${ce.errorBorder}`,color:ce.error,padding:"0.75rem 1rem",borderRadius:"8px",marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem"},cz={background:"transparent",border:"none",color:ce.error,cursor:"pointer",fontSize:"1.2rem",padding:"0 0.25rem",lineHeight:1},XT={opacity:.7,marginBottom:"1.5rem"},wm={margin:0,fontSize:"0.85rem",textTransform:"uppercase",letterSpacing:"0.5px",opacity:.6},$0={fontWeight:500,fontSize:"1.1rem"},Xl={display:"flex",flexDirection:"column",gap:"0.5rem",marginBottom:"1.5rem"},Ny={critical_bug:{label:"Critical Bug",color:"#ff4757",bgColor:"rgba(255, 71, 87, 0.15)"},bug:{label:"Bug",color:"#ffa502",bgColor:"rgba(255, 165, 2, 0.15)"},new_feature:{label:"New Feature",color:"#2ed573",bgColor:"rgba(46, 213, 115, 0.15)"},core_feature:{label:"Core Feature",color:"#1e90ff",bgColor:"rgba(30, 144, 255, 0.15)"},qol:{label:"QOL",color:"#a55eea",bgColor:"rgba(165, 94, 234, 0.15)"}};function ZT({type:t,onClick:e}){const n=t==="feature"?"new_feature":t,r=n&&n in Ny?n:"bug",s=Ny[r];return u.jsx("button",{type:"button",onClick:e,style:{padding:"0.25rem 0.5rem",borderRadius:"0.25rem",background:s.bgColor,color:s.color,fontSize:"0.7rem",fontWeight:600,textTransform:"uppercase",letterSpacing:"0.025em",flexShrink:0,border:"none",cursor:"pointer",transition:"opacity 0.15s, transform 0.15s"},onMouseEnter:o=>{o.currentTarget.style.opacity="0.8",o.currentTarget.style.transform="scale(1.05)"},onMouseLeave:o=>{o.currentTarget.style.opacity="1",o.currentTarget.style.transform="scale(1)"},title:"Click to change type",children:s.label})}function uz({item:t,isDragging:e,isDragOver:n,onDragStart:r,onDragOver:s,onDragLeave:o,onDragEnd:l,onDrop:d,onToggleDone:h,onTypeClick:m}){return u.jsxs("div",{onDragOver:p=>{p.stopPropagation(),s(p)},onDragLeave:p=>{p.stopPropagation(),o()},onDrop:p=>{p.stopPropagation(),d(p)},style:{position:"relative"},children:[u.jsx("div",{style:{...YT,opacity:n?1:0,boxShadow:n?"0 0 8px rgba(100, 108, 255, 0.6)":"none"}}),u.jsxs("div",{draggable:!0,onDragStart:r,onDragEnd:l,style:{...pd,cursor:"grab",opacity:e?.5:1,flexDirection:"column",alignItems:"stretch",gap:"0.5rem"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[u.jsx("span",{style:{...KT},children:""}),u.jsx("input",{type:"checkbox",checked:t.is_done,onChange:h,style:{width:"1.25rem",height:"1.25rem",cursor:"pointer",accentColor:ce.primary,flexShrink:0}}),u.jsx(ZT,{type:t.feedback_type,onClick:m})]}),u.jsxs("div",{style:{marginLeft:"3.25rem"},children:[u.jsx("p",{style:{margin:0,lineHeight:1.5},children:t.text}),u.jsxs("p",{style:{margin:"0.5rem 0 0 0",fontSize:"0.8rem",opacity:.6},children:[t.user_email,"  ",ky(t.created_at)]})]})]})]})}function dz({item:t,onToggleDone:e,onTypeClick:n}){return u.jsxs("div",{style:{...pd,opacity:.6,flexDirection:"column",alignItems:"stretch",gap:"0.5rem"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[u.jsx("input",{type:"checkbox",checked:t.is_done,onChange:e,style:{width:"1.25rem",height:"1.25rem",cursor:"pointer",accentColor:ce.primary,flexShrink:0}}),u.jsx(ZT,{type:t.feedback_type,onClick:n})]}),u.jsxs("div",{style:{marginLeft:"2rem"},children:[u.jsx("p",{style:{margin:0,lineHeight:1.5,textDecoration:"line-through"},children:t.text}),u.jsxs("p",{style:{margin:"0.5rem 0 0 0",fontSize:"0.8rem",opacity:.8},children:[t.user_email,"  Created: ",ky(t.created_at)]}),t.completed_at&&u.jsxs("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.8rem",color:ce.success},children:[" Completed: ",ky(t.completed_at)]})]})]})}function Ln({noMargin:t}={}){return u.jsx("span",{style:{display:"inline-block",width:"14px",height:"14px",border:"2px solid rgba(255, 255, 255, 0.3)",borderTopColor:"white",borderRadius:"50%",animation:"spin 0.8s linear infinite",marginRight:t?0:"0.5rem",verticalAlign:"middle"}})}function JT(){const{state:t,closeModal:e}=OT();if(!t.isOpen)return null;const n=t.isComplete;return u.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0, 0, 0, 0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1002,padding:"1rem"},onClick:n?e:void 0,children:u.jsxs("div",{style:{background:"#1a1a1a",color:"rgba(255, 255, 255, 0.87)",borderRadius:"16px",padding:"2rem",width:"32rem",maxWidth:"calc(100vw - 2rem)",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.5)"},onClick:r=>r.stopPropagation(),children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1.5rem"},children:[u.jsxs("h2",{style:{margin:0,fontSize:"1.25rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[!t.isComplete&&u.jsx(Ln,{noMargin:!0}),t.migrationName]}),n&&u.jsx("button",{onClick:e,style:{background:"transparent",border:"none",color:"inherit",cursor:"pointer",fontSize:"1.5rem",opacity:.6,lineHeight:1,padding:"0.25rem"},title:"Close",children:""})]}),u.jsxs("div",{style:{fontSize:"1rem",fontWeight:500,marginBottom:"1rem",color:t.error?"#ef4444":t.isComplete?"#22c55e":"inherit"},children:[t.error?" ":t.isComplete?" ":"",t.stage]}),u.jsx("div",{style:{background:"rgba(255, 255, 255, 0.1)",borderRadius:"8px",height:"12px",overflow:"hidden",marginBottom:"1rem"},children:t.progress!==null?u.jsx("div",{style:{background:t.error?"#ef4444":t.isComplete?"#22c55e":"#646cff",height:"100%",width:`${t.progress}%`,transition:"width 0.3s ease-out",borderRadius:"8px"}}):u.jsx("div",{style:{background:t.error?"#ef4444":"#646cff",height:"100%",width:"30%",borderRadius:"8px",animation:"progressIndeterminate 1.5s ease-in-out infinite"}})}),t.currentItem&&u.jsx("div",{style:{fontSize:"0.9rem",opacity:.8,marginBottom:"0.5rem",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:t.currentItem}),t.details&&u.jsx("div",{style:{fontSize:"0.85rem",opacity:.6,marginBottom:t.error?"1rem":0},children:t.details}),t.error&&u.jsx("div",{style:{background:"rgba(239, 68, 68, 0.1)",border:"1px solid rgba(239, 68, 68, 0.3)",borderRadius:"8px",padding:"0.75rem 1rem",fontSize:"0.9rem",color:"#ef4444"},children:t.error}),t.isComplete&&u.jsx("button",{onClick:e,style:{marginTop:"1.5rem",width:"100%",background:t.error?"rgba(239, 68, 68, 0.2)":"#646cff",color:"white",border:"none",padding:"0.75rem 1.5rem",borderRadius:"8px",cursor:"pointer",fontWeight:500,fontSize:"1rem"},children:t.error?"Close":"Done"}),!t.isComplete&&u.jsx("div",{style:{marginTop:"1rem",fontSize:"0.85rem",opacity:.5,textAlign:"center"},children:"Please wait  do not close this window"}),u.jsx("style",{children:`
            @keyframes progressIndeterminate {
              0% { transform: translateX(-100%); }
              100% { transform: translateX(400%); }
            }
          `})]})})}function No({message:t,children:e,onDismiss:n,style:r}){return u.jsxs("div",{style:{...lz,...r},children:[u.jsx("span",{children:e??t}),n&&u.jsx("button",{onClick:n,style:cz,children:""})]})}const hz={primary:WT,"primary-large":XP,secondary:ZP,danger:JP,small:ez},fz={position:"absolute",bottom:"100%",left:"50%",transform:"translateX(-50%)",background:ce.warning,color:"#1a1a1a",padding:"0.5rem 0.75rem",borderRadius:"6px",fontSize:"0.8rem",fontWeight:500,whiteSpace:"nowrap",marginBottom:"0.5rem",zIndex:100,boxShadow:"0 2px 8px rgba(0,0,0,0.3)",animation:"tooltipFadeIn 0.15s ease-out"},mz={position:"absolute",top:"100%",left:"50%",transform:"translateX(-50%)",width:0,height:0,borderLeft:"6px solid transparent",borderRight:"6px solid transparent",borderTop:`6px solid ${ce.warning}`};function Ve({variant:t="primary",isLoading:e,loadingText:n="Saving...",children:r,disabled:s,style:o,actionName:l,disabledReason:d,onClick:h,...m}){const p=hz[t],g=s||e,[v,_]=O.useState(!1);function S(C){h?.(C)}function x(C){g&&d&&(C.preventDefault(),C.stopPropagation(),_(!0),setTimeout(()=>_(!1),3e3))}const E=g?{cursor:"not-allowed",opacity:.35,filter:"grayscale(50%)"}:{};return u.jsxs("div",{style:{position:"relative",display:"inline-block"},onClick:x,children:[v&&d&&u.jsxs("div",{style:fz,children:[d,u.jsx("div",{style:mz})]}),u.jsx("button",{disabled:g,style:{...p,cursor:g?"not-allowed":"pointer",...E,...o},onClick:S,...m,children:e?n:r})]})}function eA(t,e){const n=t.toLowerCase(),r=e.toLowerCase();if(r.includes(n)){const d=r.indexOf(n);return{match:!0,score:d===0||/\s/.test(r[d-1])?100:90}}let s=0,o=0,l=0;for(let d=0;d<r.length&&s<n.length;d++)r[d]===n[s]?(s++,l++,o+=l*2):l=0;return s===n.length?{match:!0,score:o}:{match:!1,score:0}}function tA(t){return[...t].sort((e,n)=>!e.groupId&&n.groupId?1:e.groupId&&!n.groupId?-1:!e.groupId&&!n.groupId?e.sortOrder-n.sortOrder:e.groupSortOrder!==n.groupSortOrder?e.groupSortOrder-n.groupSortOrder:e.sortOrder-n.sortOrder)}function nA(t){const e=tA(t),n=[];let r="__initial__";return e.forEach(s=>{s.groupId!==r&&(r=s.groupId,n.push({groupId:s.groupId,groupName:s.groupName,groupSortOrder:s.groupSortOrder,items:[]})),n[n.length-1].items.push(s)}),n}function rA(t,e,n){return e.trim()?t.map(s=>{const o=n(s);let l=0,d=!1;for(const h of o){const m=eA(e,h);m.match&&(d=!0,l=Math.max(l,m.score))}return{item:s,score:l,hasMatch:d}}).filter(({hasMatch:s})=>s).sort((s,o)=>o.score!==s.score?o.score-s.score:!s.item.groupId&&o.item.groupId?1:s.item.groupId&&!o.item.groupId?-1:s.item.groupSortOrder!==o.item.groupSortOrder?s.item.groupSortOrder-o.item.groupSortOrder:s.item.sortOrder-o.item.sortOrder).map(({item:s})=>s):tA(t)}const H0={position:"absolute",top:"100%",left:0,right:0,marginTop:"4px",background:"var(--background, #1a1a1a)",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",borderRadius:"6px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",zIndex:1e3},$u={padding:"0.6rem 0.8rem",cursor:"pointer",transition:"background 0.1s"};function FS({id:t,value:e,onChange:n,payees:r,placeholder:s="Enter payee name",autoFocus:o}){const[l,d]=O.useState(!1),[h,m]=O.useState(-1),p=O.useRef(null),g=O.useRef(null),v=e.trim()?r.map(x=>({payee:x,...eA(e,x)})).filter(x=>x.match).sort((x,E)=>E.score-x.score).slice(0,8).map(x=>x.payee):[];O.useEffect(()=>{function x(E){p.current&&!p.current.contains(E.target)&&d(!1)}return document.addEventListener("mousedown",x),()=>document.removeEventListener("mousedown",x)},[]);function _(x){!l||v.length===0||(x.key==="ArrowDown"?(x.preventDefault(),m(E=>Math.min(E+1,v.length-1))):x.key==="ArrowUp"?(x.preventDefault(),m(E=>Math.max(E-1,-1))):x.key==="Enter"&&h>=0?(x.preventDefault(),n(v[h]),d(!1),m(-1)):x.key==="Escape"&&(d(!1),m(-1)))}function S(x){n(x),d(!1),m(-1),g.current?.focus()}return u.jsxs("div",{ref:p,style:{position:"relative"},children:[u.jsx("input",{ref:g,id:t,type:"text",value:e,onChange:x=>{n(x.target.value),d(!0),m(-1)},onFocus:()=>d(!0),onKeyDown:_,placeholder:s,autoComplete:"off",autoFocus:o,style:Ma}),l&&v.length>0&&u.jsx("div",{style:{...H0,maxHeight:"200px",overflowY:"auto"},children:v.map((x,E)=>u.jsx("div",{onClick:()=>S(x),style:{...$u,background:E===h?`color-mix(in srgb, ${ce.primary} 20%, transparent)`:"transparent",borderBottom:E<v.length-1?"1px solid color-mix(in srgb, currentColor 10%, transparent)":"none"},onMouseEnter:()=>m(E),children:x},x))})]})}function iA({id:t,value:e,onChange:n,categories:r,categoryGroups:s,placeholder:o="Search categories...",required:l,showNoCategoryOption:d=!1,showHiddenCategories:h=!1}){const m=Object.fromEntries(s.map(q=>[q.id,q.name])),p=Object.fromEntries(s.map(q=>[q.id,q.sort_order])),g=h?r:Object.fromEntries(Object.entries(r).filter(([,q])=>!q.is_hidden)),v=Object.entries(g).map(([q,J])=>({id:q,name:J.name,groupId:J.category_group_id,groupName:J.category_group_id&&m[J.category_group_id]||null,sortOrder:J.sort_order,groupSortOrder:J.category_group_id?p[J.category_group_id]??999:999})),_=e===Qt,S=_?null:e?r[e]:null,x=_?"":S?.name||"",[E,C]=O.useState(x),[T,A]=O.useState(!1),[B,U]=O.useState(-1),G=O.useRef(null),k=O.useRef(null);O.useEffect(()=>{if(e===Qt)C("");else if(e){const q=r[e];C(q?.name||"")}},[e,r]);const D=rA(v,E,q=>[q.name]),N=nA(D);O.useEffect(()=>{function q(J){if(G.current&&!G.current.contains(J.target))if(A(!1),e===Qt)C("");else{const Z=e?r[e]:null;C(Z?.name||"")}}return document.addEventListener("mousedown",q),()=>document.removeEventListener("mousedown",q)},[e,r]);function F(q){if(q.key==="ArrowDown")q.preventDefault(),T?U(J=>Math.min(J+1,D.length-1)):(A(!0),U(0));else if(q.key==="ArrowUp")q.preventDefault(),U(J=>Math.max(J-1,0));else if(q.key==="Enter")q.preventDefault(),T&&B>=0&&D[B]&&H(D[B]);else if(q.key==="Escape")if(A(!1),U(-1),e===Qt)C("");else{const J=e?r[e]:null;C(J?.name||"")}else if(q.key==="Tab")if(T&&B>=0&&D[B])H(D[B]);else if(A(!1),U(-1),e===Qt)C("");else{const J=e?r[e]:null;C(J?.name||"")}}function H(q){n(q.id),C(q.id===Qt?"":q.name),A(!1),U(-1)}function j(){n(Qt),C(""),A(!1),U(-1)}function M(q){const J=q.target.value;C(J),A(!0),U(J.trim()?0:-1),J!==x&&(d&&J.trim()===""?n(Qt):n(""))}function R(){A(!0),d&&(e===Qt||E.trim()==="")?U(-1):D.length>0&&U(0)}let K=-1;const W=()=>++K;return u.jsxs("div",{ref:G,style:{position:"relative"},children:[u.jsx("input",{ref:k,id:t,type:"text",value:E,onChange:M,onFocus:R,onKeyDown:F,placeholder:o,autoComplete:"off",required:l&&!d,style:{...Ma,borderColor:l&&!e?ce.error:void 0}}),T&&u.jsxs("div",{style:{...H0,maxHeight:"250px",overflowY:"auto"},children:[d&&u.jsx("div",{onClick:j,onMouseEnter:()=>U(-1),style:{...$u,opacity:.7,fontStyle:"italic",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)",background:B===-1?`color-mix(in srgb, ${ce.primary} 20%, transparent)`:"transparent"},children:To}),N.map((q,J)=>u.jsxs("div",{children:[q.groupName&&u.jsx("div",{style:{padding:"0.4rem 0.8rem",fontSize:"0.75rem",textTransform:"uppercase",letterSpacing:"0.5px",opacity:.6,background:"color-mix(in srgb, currentColor 5%, transparent)",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},children:q.groupName}),q.items.map(Z=>{const re=W();return u.jsx("div",{onClick:()=>H(Z),style:{...$u,paddingLeft:q.groupName?"1.2rem":"0.8rem",background:re===B?`color-mix(in srgb, ${ce.primary} 20%, transparent)`:"transparent",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},onMouseEnter:()=>U(re),children:Z.name},Z.id)})]},`group-${J}`)),D.length===0&&E.trim()&&!d&&u.jsx("div",{style:{padding:"0.6rem 0.8rem",opacity:.6,fontStyle:"italic"},children:"No matching categories"})]})]})}function sA({id:t,value:e,onChange:n,accounts:r,accountGroups:s,placeholder:o="Search accounts...",required:l,showNoAccountOption:d=!1,showHiddenAccounts:h=!1}){const p=(h?r:r.filter(([,K])=>!K.is_hidden)).map(([K,W])=>({id:K,name:W.nickname,groupId:W.account_group_id,groupName:W.account_group_id&&s[W.account_group_id]?.name||null,sortOrder:W.sort_order,groupSortOrder:W.account_group_id?s[W.account_group_id]?.sort_order??999:999})),g=e===Vt,v=g?null:r.find(([K])=>K===e)?.[1],_=g?"":v?.nickname||"",[S,x]=O.useState(_),[E,C]=O.useState(!1),[T,A]=O.useState(-1),B=O.useRef(null),U=O.useRef(null);O.useEffect(()=>{if(e===Vt)x("");else if(e){const K=r.find(([W])=>W===e)?.[1];x(K?.nickname||"")}},[e,r]);const G=rA(p,S,K=>[K.name]),k=nA(G);O.useEffect(()=>{function K(W){if(B.current&&!B.current.contains(W.target))if(C(!1),e===Vt)x("");else{const q=r.find(([J])=>J===e)?.[1];x(q?.nickname||"")}}return document.addEventListener("mousedown",K),()=>document.removeEventListener("mousedown",K)},[e,r]);function D(K){if(K.key==="ArrowDown")K.preventDefault(),E?A(W=>Math.min(W+1,G.length-1)):(C(!0),A(0));else if(K.key==="ArrowUp")K.preventDefault(),A(W=>Math.max(W-1,0));else if(K.key==="Enter")K.preventDefault(),E&&T>=0&&G[T]&&N(G[T]);else if(K.key==="Escape")if(C(!1),A(-1),e===Vt)x("");else{const W=r.find(([q])=>q===e)?.[1];x(W?.nickname||"")}else if(K.key==="Tab")if(E&&T>=0&&G[T])N(G[T]);else if(C(!1),A(-1),e===Vt)x("");else{const W=r.find(([q])=>q===e)?.[1];x(W?.nickname||"")}}function N(K){n(K.id),x(K.id===Vt?"":K.name),C(!1),A(-1)}function F(){n(Vt),x(""),C(!1),A(-1)}function H(K){const W=K.target.value;x(W),C(!0),A(W.trim()?0:-1),W!==_&&(d&&W.trim()===""?n(Vt):n(""))}function j(){C(!0),d&&(e===Vt||S.trim()==="")?A(-1):G.length>0&&A(0)}let M=-1;const R=()=>++M;return u.jsxs("div",{ref:B,style:{position:"relative"},children:[u.jsx("input",{ref:U,id:t,type:"text",value:S,onChange:H,onFocus:j,onKeyDown:D,placeholder:o,autoComplete:"off",required:l&&!d,style:{...Ma,borderColor:l&&!e?ce.error:void 0}}),E&&u.jsxs("div",{style:{...H0,maxHeight:"250px",overflowY:"auto"},children:[d&&u.jsx("div",{onClick:F,onMouseEnter:()=>A(-1),style:{...$u,opacity:.7,fontStyle:"italic",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)",background:T===-1?`color-mix(in srgb, ${ce.primary} 20%, transparent)`:"transparent"},children:ja}),k.map((K,W)=>u.jsxs("div",{children:[K.groupName&&u.jsx("div",{style:{padding:"0.4rem 0.8rem",fontSize:"0.75rem",textTransform:"uppercase",letterSpacing:"0.5px",opacity:.6,background:"color-mix(in srgb, currentColor 5%, transparent)",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},children:K.groupName}),K.items.map(q=>{const J=R();return u.jsx("div",{onClick:()=>N(q),style:{...$u,paddingLeft:K.groupName?"1.2rem":"0.8rem",background:J===T?`color-mix(in srgb, ${ce.primary} 20%, transparent)`:"transparent",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},onMouseEnter:()=>A(J),children:q.name},q.id)})]},`group-${W}`)),G.length===0&&S.trim()&&!d&&u.jsx("div",{style:{padding:"0.6rem 0.8rem",opacity:.6,fontStyle:"italic"},children:"No matching accounts"})]})]})}function Es({children:t,onSubmit:e,actionName:n}){function r(s){e(s)}return u.jsx("form",{onSubmit:r,style:WP,children:t})}function Mt({label:t,htmlFor:e,children:n,hint:r,style:s}){return u.jsxs("div",{style:{...QP,...s},children:[u.jsx("label",{htmlFor:e,style:KP,children:t}),n,r&&u.jsx("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.85rem",opacity:.6},children:r})]})}function Cs(t){return u.jsx("input",{style:Ma,...t})}function pz(t){if(!t)return"";try{return new Date(t+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"})}catch{return t}}function zf({value:t,onChange:e,style:n,autoFocus:r,...s}){const o=O.useRef(null),l=O.useRef(null),d=pz(t);O.useEffect(()=>{r&&l.current?.focus()},[r]);function h(){o.current?.showPicker?.()}function m(p){p.key==="Enter"&&(p.preventDefault(),o.current?.showPicker?.())}return u.jsxs("div",{style:{position:"relative"},children:[u.jsx("input",{ref:o,type:"date",value:t||"",onChange:e,style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",opacity:0,pointerEvents:"none"},...s}),u.jsx("div",{ref:l,tabIndex:0,onClick:h,onKeyDown:m,style:{...Ma,cursor:"pointer",display:"flex",alignItems:"center",fontSize:"0.85rem",fontFamily:"monospace",color:t?"inherit":"color-mix(in srgb, currentColor 50%, transparent)",...n},children:d||"Select date"})]})}function Hu({children:t,...e}){return u.jsx("select",{style:YP,...e,children:t})}function q0({minHeight:t="6rem",style:e,...n}){return u.jsx("textarea",{style:{...Ma,width:"100%",minHeight:t,resize:"vertical",fontFamily:"inherit",boxSizing:"border-box",...e},...n})}function Na({children:t}){return u.jsx("div",{style:iz,children:t})}function Gg(t){const n=t.replace(/[^\d.]/g,"").split("."),r=n[0]||"",s=n[1],o=r.replace(/\B(?=(\d{3})+(?!\d))/g,",");return s!==void 0?`$${o}.${s.slice(0,2)}`:o?`$${o}`:""}function gz(t){return t.replace(/[$,]/g,"")}function yo({id:t,value:e,onChange:n,placeholder:r="$0.00",required:s,autoFocus:o,style:l}){const[d,h]=O.useState(()=>Gg(e)),m=O.useRef(null);O.useEffect(()=>{const g=Gg(e);gz(d)!==e&&h(g)},[e]);function p(g){const v=g.target.value;if(!v||v==="$"){h(""),n("");return}const S=v.replace(/[^\d.]/g,"").split(".");let x=S[0];S.length>1&&(x+="."+S.slice(1).join("").slice(0,2));const E=Gg(x);h(E),n(x)}return u.jsx("input",{ref:m,id:t,type:"text",inputMode:"decimal",value:d,onChange:p,placeholder:r,required:s,autoFocus:o,style:{...Ma,...l}})}function Sm({children:t,isDragging:e,isDragOver:n,onDragStart:r,onDragOver:s,onDragLeave:o,onDragEnd:l,onDrop:d,onEdit:h,onDelete:m,onMoveUp:p,onMoveDown:g,canMoveUp:v=!0,canMoveDown:_=!0,itemName:S}){const x=qi(),E=p||g;return u.jsxs("div",{onDragOver:C=>{C.stopPropagation(),s(C)},onDragLeave:C=>{C.stopPropagation(),o()},onDrop:C=>{C.stopPropagation(),d(C)},style:{position:"relative"},children:[u.jsx("div",{style:{...YT,opacity:n?1:0,boxShadow:n?"0 0 8px rgba(100, 108, 255, 0.6)":"none"}}),u.jsxs("div",{style:{...x?GP:pd,opacity:e?.5:1},children:[u.jsxs("div",{style:{flex:1,display:"flex",alignItems:"center",gap:x?"0.5rem":"0.75rem",minWidth:0},children:[u.jsx("span",{draggable:!0,onDragStart:C=>{r(C)},onDragEnd:()=>{l()},style:{...KT,fontSize:x?"0.9rem":void 0,cursor:"grab",padding:"0.25rem",margin:"-0.25rem",borderRadius:"4px",userSelect:"none"},title:"Drag to reorder",children:""}),u.jsx("div",{style:{flex:1,minWidth:0,overflow:"hidden",textOverflow:"ellipsis"},children:t})]}),u.jsxs("div",{style:x?nz:tz,children:[x?u.jsxs(u.Fragment,{children:[u.jsx("button",{onClick:()=>{h()},style:QT,title:"Edit","aria-label":"Edit",children:""}),u.jsx("button",{onClick:()=>{m()},style:rz,title:"Delete","aria-label":"Delete",children:""})]}):u.jsxs(u.Fragment,{children:[u.jsx(Ve,{variant:"secondary",actionName:`Edit ${S||"Item"}`,onClick:h,children:"Edit"}),u.jsx(Ve,{variant:"danger",actionName:`Delete ${S||"Item"}`,onClick:m,children:"Delete"})]}),E&&u.jsxs("div",{style:V0,children:[u.jsx("button",{onClick:C=>{C.stopPropagation(),p?.()},disabled:!v,style:{...Yl,opacity:v?.6:.2,cursor:v?"pointer":"default"},title:"Move up","aria-label":"Move up",children:""}),u.jsx("button",{onClick:C=>{C.stopPropagation(),g?.()},disabled:!_,style:{...Yl,opacity:_?.6:.2,cursor:_?"pointer":"default"},title:"Move down","aria-label":"Move down",children:""})]})]})]})]})}function G0({isActive:t,onDragOver:e,onDragLeave:n,onDrop:r,label:s="Move to end"}){return u.jsxs("div",{onDragOver:e,onDragLeave:n,onDrop:r,style:sz,children:[u.jsx("div",{style:{...az,opacity:t?1:.3,boxShadow:t?"0 0 8px rgba(100, 108, 255, 0.6)":"none"}}),t&&u.jsx("span",{style:oz,children:s})]})}function Je(t){return`$${Math.abs(t).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`}function ii(t){return t<0?`-$${Math.abs(t).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`:`$${t.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`}function Pa(t){return t===0?"$0.00":`${t>0?"+":"-"}${Je(t)}`}function qt(t){return`${t>=0?"+":"-"}${Je(t)}`}function Pt(t){return t===0?ce.zero:t>0?ce.success:ce.danger}function Un(t){return t===0?ce.zero:t>0?ce.success:ce.debt}function mc(t){return t===0?ce.zero:t<0?ce.error:ce.success}function pc(t){return t===0?ce.zero:t>0?ce.success:ce.error}async function yz(t,e){const{exists:n,data:r}=await bt("feedback",t,`VALIDATION-READ: ${e}`);if(!n||!r)throw new Error(`Feedback document not found: ${t}`);return{items:r.items||[],user_email:r.user_email,created_at:r.created_at,updated_at:r.updated_at}}async function aA(t){const{docId:e,items:n,description:r}=t;await tn("feedback",e,{items:n,updated_at:new Date().toISOString()},r,{merge:!0})}async function _z(t,e,n,r){const{exists:s}=await bt("feedback",t,"checking if user has existing feedback document");s?await tn("feedback",t,{items:Uu(e),user_email:n,updated_at:new Date().toISOString()},r,{merge:!0}):await tn("feedback",t,{items:[e],user_email:n,created_at:new Date().toISOString(),updated_at:new Date().toISOString()},r)}function oA(){const t=ln(),e=$n({onMutate:async r=>{const{userId:s,userEmail:o,text:l,feedbackType:d,currentPath:h}=r,m=o||s,p=Pe.feedback();await t.cancelQueries({queryKey:p});const g=t.getQueryData(p),v=`feedback_optimistic_${Date.now()}`,_={id:v,text:`${l}

(Submitted from: ${h})`,created_at:new Date().toISOString(),is_done:!1,completed_at:null,sort_order:Date.now(),feedback_type:d,doc_id:m,user_email:o};return g&&t.setQueryData(p,{items:[...g.items,_]}),{previousData:g,optimisticId:v}},mutationFn:async r=>{const{userId:s,userEmail:o,text:l,feedbackType:d,currentPath:h}=r,m=o||s,p={id:`feedback_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,text:`${l}

(Submitted from: ${h})`,created_at:new Date().toISOString(),is_done:!1,completed_at:null,sort_order:Date.now(),feedback_type:d};return await _z(m,p,o,"submitting new feedback"),{feedbackItem:p,docId:m}},onSuccess:(r,s,o)=>{if(!o?.optimisticId)return;const l=t.getQueryData(Pe.feedback());l&&t.setQueryData(Pe.feedback(),{items:l.items.map(d=>d.id===o.optimisticId?{...r.feedbackItem,doc_id:r.docId,user_email:s.userEmail}:d)})},onError:(r,s,o)=>{o?.previousData&&t.setQueryData(Pe.feedback(),o.previousData)}});return{submitFeedback:{mutate:r=>e.mutate(r),mutateAsync:r=>e.mutateAsync(r),isPending:e.isPending,isError:e.isError,error:e.error,reset:e.reset}}}function bz(){const t=ln(),e=$n({onMutate:async r=>{const{item:s}=r,o=Pe.feedback(),l=!s.is_done,d=l?new Date().toISOString():null;await t.cancelQueries({queryKey:o});const h=t.getQueryData(o);return h&&t.setQueryData(o,{items:h.items.map(m=>m.id===s.id?{...m,is_done:l,completed_at:d}:m)}),{previousData:h}},mutationFn:async r=>{const{item:s}=r,o=!s.is_done,l=o?new Date().toISOString():null,d=await yz(s.doc_id,"toggle feedback");let h=!1;const m=d.items.map(p=>p.id===s.id?(h=!0,{...p,is_done:o,completed_at:l}):p);if(!h)throw console.error("[toggleFeedback] Item not found in document",{searchingFor:s.id,inDocument:s.doc_id,availableIds:d.items.map(p=>p.id)}),new Error(`Feedback item not found in document. Item ID: ${s.id}, Doc ID: ${s.doc_id}`);return await aA({docId:s.doc_id,items:m,description:`marking feedback item as ${o?"done":"not done"}`}),{itemId:s.id,isDone:o,completedAt:l}},onError:(r,s,o)=>{o?.previousData&&t.setQueryData(Pe.feedback(),o.previousData)}});return{toggleFeedback:{mutate:r=>e.mutate(r),mutateAsync:r=>e.mutateAsync(r),isPending:e.isPending,isError:e.isError,error:e.error,reset:e.reset}}}function vz(){const t=ln(),e=$n({onMutate:async r=>{const{docId:s,items:o}=r,l=Pe.feedback();await t.cancelQueries({queryKey:l});const d=t.getQueryData(l),h=new Map;return o.forEach(m=>{h.set(m.id,m.sort_order)}),d&&t.setQueryData(l,{items:d.items.map(m=>m.doc_id===s&&h.has(m.id)?{...m,sort_order:h.get(m.id)}:m)}),{previousData:d}},mutationFn:async r=>{const{docId:s,items:o}=r;return await aA({docId:s,items:o,description:"saving reordered feedback items"}),{docId:s,items:o}},onError:(r,s,o)=>{o?.previousData&&t.setQueryData(Pe.feedback(),o.previousData)}});return{updateSortOrder:{mutate:r=>e.mutate(r),mutateAsync:r=>e.mutateAsync(r),isPending:e.isPending,isError:e.isError,error:e.error,reset:e.reset}}}function Hi({isOpen:t,onClose:e,title:n,children:r,width:s="28rem"}){if(!t)return null;function o(){e()}return u.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0, 0, 0, 0.6)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1001,padding:"1rem"},onClick:o,children:u.jsxs("div",{style:{background:"#1a1a1a",color:"rgba(255, 255, 255, 0.87)",borderRadius:"12px",padding:"1.5rem",width:s,maxWidth:"calc(100vw - 2rem)",flexShrink:0,boxSizing:"border-box",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.5)"},onClick:l=>l.stopPropagation(),children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[u.jsx("h2",{style:{margin:0,fontSize:"1.25rem"},children:n}),u.jsx("button",{onClick:o,style:{background:"transparent",border:"none",color:"inherit",cursor:"pointer",fontSize:"1.5rem",opacity:.6,lineHeight:1},children:""})]}),r]})})}const xz=2e3,wz={critical_bug:{label:"Critical Bug",color:"#ff4757",bgColor:"rgba(255, 71, 87, 0.15)"},bug:{label:"Bug",color:"#ffa502",bgColor:"rgba(255, 165, 2, 0.15)"},new_feature:{label:"New Feature",color:"#2ed573",bgColor:"rgba(46, 213, 115, 0.15)"},core_feature:{label:"Core Feature",color:"#1e90ff",bgColor:"rgba(30, 144, 255, 0.15)"},qol:{label:"QOL",color:"#a55eea",bgColor:"rgba(165, 94, 234, 0.15)"}};function Sz(){const[t,e]=O.useState(!1),[n,r]=O.useState(""),[s,o]=O.useState("bug"),[l,d]=O.useState(!1),h=O.useContext(hd),p=Da().get_current_firebase_user(),g=Vn(),{submitFeedback:v}=oA();if(O.useEffect(()=>{if(l){const x=setTimeout(()=>d(!1),xz);return()=>clearTimeout(x)}},[l]),g.pathname.includes("/admin/feedback")||!h.is_logged_in)return null;function S(x){x.preventDefault(),!(!n.trim()||!h.username||!p)&&(v.mutate({userId:p.uid,userEmail:h.username,text:n.trim(),feedbackType:s,currentPath:g.pathname}),r(""),o("bug"),e(!1),d(!0))}return u.jsxs(u.Fragment,{children:[l&&u.jsxs("div",{style:{position:"fixed",bottom:"5rem",right:"1.5rem",background:"rgba(46, 213, 115, 0.95)",color:"white",padding:"0.75rem 1rem",borderRadius:"0.5rem",fontSize:"0.9rem",fontWeight:500,boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",zIndex:1001,display:"flex",alignItems:"center",gap:"0.5rem",animation:"fadeInUp 0.2s ease-out"},children:[u.jsx("span",{children:""}),u.jsx("span",{children:"Feedback submitted!"})]}),u.jsx("button",{onClick:()=>{e(!0)},style:{position:"fixed",bottom:"1.5rem",right:"1.5rem",width:"3rem",height:"3rem",borderRadius:"50%",background:ce.primary,color:"white",border:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1.25rem",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",transition:"transform 0.15s, box-shadow 0.15s",zIndex:1e3},title:"Send Feedback",onMouseEnter:x=>{x.currentTarget.style.transform="scale(1.1)",x.currentTarget.style.boxShadow="0 6px 16px rgba(0, 0, 0, 0.4)"},onMouseLeave:x=>{x.currentTarget.style.transform="scale(1)",x.currentTarget.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.3)"},children:""}),u.jsx(Hi,{isOpen:t,onClose:()=>{e(!1),o("bug")},title:"Send Feedback",children:u.jsxs("form",{onSubmit:S,children:[u.jsx("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"0.75rem",paddingBottom:"1rem",flexWrap:"wrap"},children:["critical_bug","bug","new_feature","core_feature","qol"].map(x=>{const E=wz[x],C=s===x;return u.jsxs("button",{type:"button",onClick:()=>{E.label,o(x)},style:{flex:1,padding:"0.6rem 0.5rem",border:`2px solid ${E.color}`,borderRadius:"0.5rem",background:C?E.bgColor:"transparent",color:C?E.color:"rgba(255,255,255,0.5)",cursor:"pointer",fontWeight:C?600:400,fontSize:"0.8rem",transition:"all 0.15s ease",opacity:C?1:.5,boxShadow:C?`0 0 12px ${E.bgColor}`:"none",position:"relative"},children:[E.label,C&&u.jsx("span",{style:{position:"absolute",bottom:"-14px",left:"10%",right:"10%",height:"3px",background:"white",borderRadius:"2px"}})]},x)})}),u.jsx(q0,{value:n,onChange:x=>r(x.target.value),placeholder:"Share your feedback, bug reports, or feature requests...",minHeight:"8rem",autoFocus:!0,required:!0}),u.jsxs(Na,{children:[u.jsx(Ve,{type:"button",variant:"secondary",actionName:"Cancel Feedback",onClick:()=>{e(!1),o("bug")},children:"Cancel"}),u.jsx(Ve,{type:"submit",actionName:"Submit Feedback",disabled:!n.trim(),children:"Submit"})]})]})})]})}const Ez=1500;function Cz(){console.info("[CacheInvalidate] Starting full cache invalidation..."),Ze.cancelQueries(),Ze.clear(),console.info("[CacheInvalidate] Cleared in-memory cache");try{localStorage.removeItem("BUDGET_APP_QUERY_CACHE"),console.info("[CacheInvalidate] Cleared localStorage cache")}catch(e){console.warn("[CacheInvalidate] Failed to clear localStorage:",e)}const t=new URL(window.location.href);t.searchParams.set("cacheBust","1"),console.info("[CacheInvalidate] Reloading with cache bust..."),window.location.href=t.toString()}function Tz(){const[t,e]=O.useState(!1),{isAdmin:n}=zt();if(O.useEffect(()=>{if(t){const s=setTimeout(()=>e(!1),Ez);return()=>clearTimeout(s)}},[t]),!n)return null;function r(){e(!0),Cz()}return u.jsxs(u.Fragment,{children:[t&&u.jsxs("div",{style:{position:"fixed",bottom:"5rem",right:"5.5rem",background:"rgba(100, 108, 255, 0.95)",color:"white",padding:"0.75rem 1rem",borderRadius:"0.5rem",fontSize:"0.9rem",fontWeight:500,boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",zIndex:1001,display:"flex",alignItems:"center",gap:"0.5rem",animation:"fadeInUp 0.2s ease-out"},children:[u.jsx("span",{children:""}),u.jsx("span",{children:"Cache cleared & refetching..."})]}),u.jsx("button",{onClick:r,style:{position:"fixed",bottom:"1.5rem",right:"5.25rem",width:"3rem",height:"3rem",borderRadius:"50%",background:"#4a4a4a",color:"white",border:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1.5rem",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",transition:"transform 0.15s, box-shadow 0.15s",zIndex:1e3},title:"Clear Cache & Reload",onMouseEnter:s=>{s.currentTarget.style.transform="scale(1.1)",s.currentTarget.style.boxShadow="0 6px 16px rgba(0, 0, 0, 0.4)"},onMouseLeave:s=>{s.currentTarget.style.transform="scale(1)",s.currentTarget.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.3)"},children:""})]})}function Ur({children:t,labelStyle:e,...n}){return u.jsxs("label",{style:{display:"flex",alignItems:"flex-start",gap:"0.75rem",flex:1,cursor:"pointer",...e},children:[u.jsx("input",{type:"checkbox",style:{width:"1.25rem",height:"1.25rem",marginTop:"0.1rem",cursor:"pointer",accentColor:ce.primary},...n}),t]})}function W0({title:t,count:e,children:n,defaultExpanded:r=!1}){const[s,o]=O.useState(r);return u.jsxs("div",{style:{marginTop:"2rem"},children:[u.jsxs("button",{onClick:()=>o(!s),style:{background:"transparent",border:"none",color:"inherit",cursor:"pointer",display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 0",fontSize:"0.9rem",opacity:.7},children:[u.jsx("span",{style:{transition:"transform 0.2s",transform:s?"rotate(90deg)":"rotate(0deg)"},children:""}),t,e!==void 0&&` (${e})`]}),s&&n]})}const Az=t=>{switch(t){case 2:return 220;case 3:return 320;case 4:return 420;case 5:return 520;case 6:return 620;default:return t*100+20}},jz=t=>t<=4?2:t<=6?3:Math.ceil(t/2);function Bf(t){const{tabs:e,activeTab:n,variant:r="primary"}=t,s=e.filter(E=>!E.hidden),o=s.length,l=Az(o),d=jz(o),h=Math.floor(100/d),m=`tab-nav-${o}-${r}`,p=r==="primary",g=r==="secondary",v=r==="segmented",_=E=>{const C="color-mix(in srgb, currentColor 10%, transparent)",T="color-mix(in srgb, currentColor 3%, transparent)";return v?{flex:"1 1 0",padding:"0.75rem 1rem",border:"none",borderRadius:0,background:E?C:T,cursor:"pointer",fontWeight:E?600:400,fontSize:"0.95rem",color:"inherit",opacity:E?1:.55,transition:"all 0.15s",textDecoration:"none",display:"inline-flex",alignItems:"center",justifyContent:"center",gap:"0.25rem",position:"relative",boxSizing:"border-box",outline:"none",borderBottom:E?"2px solid currentColor":"2px solid transparent"}:g?{flex:"none",minWidth:"8.5rem",padding:"0.55rem 1rem 0.65rem",border:"none",borderRadius:"10px 10px 0 0",background:"transparent",cursor:"pointer",fontWeight:600,fontSize:"0.85rem",color:E?"inherit":"color-mix(in srgb, currentColor 55%, transparent)",transition:"color 0.15s",textDecoration:"none",display:"inline-flex",alignItems:"center",justifyContent:"center",gap:"0.25rem",position:"relative",boxSizing:"border-box",outline:"none",marginBottom:E?"-1px":"0"}:{flex:"1 1 0",padding:"0.7rem 0.75rem",border:"none",borderRadius:0,background:"transparent",cursor:"pointer",fontWeight:E?600:400,fontSize:"1rem",letterSpacing:"0.01em",color:"inherit",opacity:E?1:.6,transition:"all 0.15s",textDecoration:"none",display:"inline-flex",alignItems:"center",justifyContent:"center",gap:"0.25rem",position:"relative",boxSizing:"border-box",outline:"none"}},S=(E,C)=>u.jsxs(u.Fragment,{children:[u.jsx("span",{children:E.label}),E.checkmark&&u.jsx("span",{style:{color:ce.success,fontWeight:600},children:""}),p&&C&&u.jsx("span",{style:{position:"absolute",bottom:"-1px",left:"10%",right:"10%",height:"3px",background:"white",borderRadius:"2px"}})]}),x=()=>v?`
        .${m} {
          display: flex;
          margin-bottom: 0.75rem;
          border-bottom: 1px solid color-mix(in srgb, currentColor 15%, transparent);
        }
      `:g?`
        .${m} {
          display: flex;
          flex-wrap: nowrap;
          margin-bottom: 1rem;
          border-bottom: 1px solid color-mix(in srgb, currentColor 10%, transparent);
          justify-content: flex-start;
          padding-left: 0.75rem;
          position: relative;
        }
        .${m} > button,
        .${m} > a {
          margin-right: -8px;
          isolation: isolate;
        }
        .${m} > button:last-child,
        .${m} > a:last-child {
          margin-right: 0;
        }
        .${m} > button::before,
        .${m} > a::before {
          content: '';
          position: absolute;
          inset: 0;
          background: var(--tab-bg);
          border-radius: 10px 10px 0 0;
          z-index: -1;
          transform: perspective(50px) rotateX(5deg);
          transform-origin: bottom center;
          transition: background 0.15s;
          box-shadow: -1px 0 0 #242424, 1px 0 0 #242424;
        }
        .${m} > button:nth-child(1),
        .${m} > a:nth-child(1) {
          z-index: 4;
        }
        .${m} > button:nth-child(2),
        .${m} > a:nth-child(2) {
          z-index: 3;
        }
        .${m} > button:nth-child(3),
        .${m} > a:nth-child(3) {
          z-index: 2;
        }
        .${m} > button:nth-child(4),
        .${m} > a:nth-child(4) {
          z-index: 1;
        }
        .${m} > button.tab-active,
        .${m} > a.tab-active {
          z-index: 10;
        }
        .${m} > button.tab-active::before,
        .${m} > a.tab-active::before {
          background: var(--tab-bg-active);
        }
        .${m} > button:not(.tab-active):hover,
        .${m} > a:not(.tab-active):hover {
          color: color-mix(in srgb, currentColor 80%, transparent);
        }
        .${m} > button:not(.tab-active):hover::before,
        .${m} > a:not(.tab-active):hover::before {
          background: var(--tab-bg-hover);
        }
        @media (max-width: 480px) {
          .${m} {
            padding-left: 0;
            padding-right: 0;
          }
          .${m} > button,
          .${m} > a {
            flex: 0 0 27% !important;
            min-width: 27% !important;
            padding: 0.55rem 0.5rem 0.65rem !important;
            font-size: 0.8rem !important;
          }
        }
      `:`
      .${m} {
        display: flex;
        flex-wrap: wrap;
        margin-bottom: 0;
        border-bottom: 1px solid color-mix(in srgb, currentColor 25%, transparent);
      }
      @media (max-width: ${l}px) {
        .${m} > * {
          flex: 1 1 ${h}% !important;
          min-width: ${h}% !important;
        }
      }
    `;return u.jsxs(u.Fragment,{children:[u.jsx("style",{children:`
        ${x()}
        .${m} > button,
        .${m} > a {
          border: none !important;
          border-radius: 0 !important;
          outline: none !important;
        }
        .${m} > button:hover,
        .${m} > button:focus,
        .${m} > a:hover,
        .${m} > a:focus {
          border: none !important;
          border-color: transparent !important;
          ${p?"opacity: 0.85;":""}
          ${v?"background: color-mix(in srgb, currentColor 7%, transparent);":""}
        }
      `}),u.jsx("div",{className:m,children:s.map(E=>{const C=n===E.id;return t.mode==="link"?u.jsx(Cn,{to:`${t.linkPrefix}/${E.id}`,onClick:()=>(`${E.label}`,void 0),style:_(C),className:C?"tab-active":"",children:S(E,C)},E.id):u.jsx("button",{onClick:()=>{`${E.label}`,t.onTabChange(E.id)},style:_(C),className:C?"tab-active":"",children:S(E,C)},E.id)})})]})}function lA({items:t}){const[e,n]=O.useState(!1),r=O.useRef(null),o=Vn().pathname;O.useEffect(()=>{function d(h){r.current&&!r.current.contains(h.target)&&n(!1)}if(e)return document.addEventListener("mousedown",d),()=>document.removeEventListener("mousedown",d)},[e]),O.useEffect(()=>{function d(h){h.key==="Escape"&&n(!1)}if(e)return document.addEventListener("keydown",d),()=>document.removeEventListener("keydown",d)},[e]);const l=t.filter(d=>d.hidden?!1:d.to?d.to==="/budget"?!(o==="/budget"||/^\/budget\/\d{4}\/\d{1,2}\/\w+$/.test(o)):d.to==="/account"||d.to==="/"?o!==d.to:!o.startsWith(d.to):!0);return u.jsxs("div",{ref:r,style:{position:"relative"},children:[u.jsx("button",{onClick:()=>{n(!e)},style:{display:"flex",alignItems:"center",justifyContent:"center",width:"2.5rem",height:"2.5rem",borderRadius:"8px",background:e?"color-mix(in srgb, currentColor 15%, transparent)":"color-mix(in srgb, currentColor 8%, transparent)",border:"none",cursor:"pointer",fontSize:"1.25rem",color:"inherit",transition:"background 0.15s",lineHeight:1},title:"Menu","aria-expanded":e,"aria-haspopup":"true",children:""}),e&&u.jsx("div",{style:{position:"absolute",top:"100%",right:0,marginTop:"0.5rem",minWidth:"180px",background:"#1a1a2e",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",borderRadius:"8px",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.3)",zIndex:1e3,overflow:"hidden"},children:l.map((d,h)=>{if(d.divider)return u.jsx("div",{style:{height:"1px",background:"color-mix(in srgb, currentColor 15%, transparent)",margin:"0.25rem 0"}},h);const m=u.jsxs(u.Fragment,{children:[d.icon&&u.jsx("span",{style:{width:"1.5rem",textAlign:"center"},children:d.icon}),u.jsx("span",{children:d.label})]}),p={display:"flex",alignItems:"center",gap:"0.75rem",padding:"0.75rem 1rem",fontSize:"0.95rem",color:"inherit",textDecoration:"none",cursor:"pointer",transition:"background 0.15s",background:"transparent",border:"none",width:"100%",textAlign:"left"},g={background:"color-mix(in srgb, currentColor 10%, transparent)"};return d.to?u.jsx(Cn,{to:d.to,style:p,onMouseEnter:v=>Object.assign(v.currentTarget.style,g),onMouseLeave:v=>v.currentTarget.style.background="transparent",onClick:()=>{`${d.label}`,n(!1)},children:m},h):u.jsx("button",{onClick:()=>{`${d.label}`,d.onClick?.(),n(!1)},style:p,onMouseEnter:v=>Object.assign(v.currentTarget.style,g),onMouseLeave:v=>v.currentTarget.style.background="transparent",children:m},h)})})]})}function Rz({title:t,showBackArrow:e=!1,hideMenu:n=!1}){const{isAdmin:r}=zt(),s=Vn(),l=[...s.pathname==="/budget"||s.pathname.startsWith("/budget/")&&!s.pathname.startsWith("/budget/settings")&&!s.pathname.startsWith("/budget/admin")&&!s.pathname.startsWith("/budget/analytics")&&!s.pathname.startsWith("/budget/my-budgets")?[]:[{label:"Budget",icon:"",to:"/budget"}],{label:"Budget Settings",icon:"",to:"/budget/settings"},{label:"Analytics",icon:"",to:"/budget/analytics"},...r?[{label:"Admin",icon:"",to:"/budget/admin"}]:[],{label:"Switch Budgets",icon:"",to:"/budget/my-budgets"},{divider:!0,label:""},{label:"Exit Budget App",icon:"",to:"/"}];return u.jsxs("nav",{style:{marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%"},children:[u.jsx("div",{style:{flex:"0 0 auto"},children:e?u.jsx(Cn,{to:"/",onClick:()=>void 0,style:{opacity:.6,fontSize:"1.5rem",textDecoration:"none"},title:"Back to Home",children:""}):u.jsx(Cn,{to:"/budget",onClick:()=>void 0,title:"Budget Home",children:u.jsx("img",{src:"/budget-icon.svg",alt:"Budget",style:{width:"1.5rem",height:"1.5rem"}})})}),u.jsx("span",{style:{fontWeight:600,fontSize:"1.1rem",textAlign:"center",flex:"1 1 auto"},children:t}),u.jsx("div",{style:{flex:"0 0 auto"},children:n?u.jsx("div",{style:{width:"1.5rem"}}):u.jsx(lA,{items:l})})]})}function cA({children:t,style:e}){return u.jsx("div",{style:{width:"100%",maxWidth:"var(--content-max-width, 900px)",marginLeft:"auto",marginRight:"auto",...e},children:t})}function qu({message:t,linkText:e,linkTo:n}){return u.jsx("div",{style:{gridColumn:"1 / -1",background:`color-mix(in srgb, ${ce.warning} 12%, transparent)`,border:`2px solid ${ce.warning}`,borderRadius:"8px",padding:"1rem 1.25rem",margin:"0.75rem 0",animation:"warningPulse 2s ease-in-out infinite"},children:u.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"0.75rem",flexWrap:"wrap"},children:[u.jsx("span",{style:{fontSize:"1.25rem",lineHeight:1.3},children:""}),u.jsxs("div",{style:{flex:1,minWidth:"200px"},children:[u.jsx("p",{style:{margin:0,fontWeight:500,color:ce.warning,fontSize:"0.95rem"},children:t}),u.jsxs(Cn,{to:n,style:{display:"inline-flex",alignItems:"center",gap:"0.35rem",marginTop:"0.5rem",color:ce.warning,fontWeight:600,fontSize:"0.9rem",textDecoration:"underline",textUnderlineOffset:"3px"},children:[e," "]})]})]})})}function Ni({isOpen:t,onClose:e,onConfirm:n,migrationName:r,isDestructive:s=!1,onDownloadBackup:o,isDownloading:l=!1}){const[d,h]=O.useState(!1),m=O.useCallback(async()=>{o&&(await o(),h(!0))},[o]),p=O.useCallback(()=>{n(d?"downloaded":"already-have")},[d,n]),g=O.useCallback(()=>{n("cancelled"),e()},[n,e]);return u.jsxs(Hi,{isOpen:t,onClose:g,title:" Backup Recommended",children:[u.jsx("div",{style:{background:s?"color-mix(in srgb, #ef4444 15%, transparent)":"color-mix(in srgb, #f59e0b 15%, transparent)",border:`1px solid ${s?"color-mix(in srgb, #ef4444 40%, transparent)":"color-mix(in srgb, #f59e0b 40%, transparent)"}`,borderRadius:"8px",padding:"1rem",marginBottom:"1rem"},children:u.jsx("p",{style:{margin:0,color:s?"#fca5a5":"#fcd34d",fontWeight:500,fontSize:"0.95rem"},children:s?" This migration modifies your data. A backup is strongly recommended!":" Before running migrations, we recommend having a recent backup."})}),u.jsxs("p",{style:{margin:"0 0 0.75rem",opacity:.9},children:["You are about to run: ",u.jsx("strong",{children:r})]}),u.jsx("p",{style:{margin:"0 0 1rem",opacity:.8,fontSize:"0.9rem"},children:"Please ensure you have a recent backup of your data. You can download a diagnostic backup that includes all your budget and month data."}),o&&u.jsx("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",padding:"1rem",marginBottom:"1rem"},children:u.jsx(Ve,{variant:"secondary",onClick:m,disabled:l,actionName:"Download Backup Before Migration",style:{width:"100%"},children:l?u.jsxs(u.Fragment,{children:[u.jsx(Ln,{noMargin:!0})," Downloading Backup..."]}):d?" Backup Downloaded":" Download Backup Now"})}),u.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[u.jsx(Ve,{variant:"secondary",actionName:"Cancel Migration",onClick:g,children:"Cancel"}),u.jsx(Ve,{variant:s?"danger":"primary",actionName:`Proceed with ${r}`,onClick:p,disabled:l,children:d?" Proceed with Migration":" I Have a Backup - Proceed"})]})]})}function Pi({migrationName:t,isDestructive:e=!1,onDownloadBackup:n}){const[r,s]=O.useState(!1),[o,l]=O.useState(!1),[d,h]=O.useState(null),m=O.useCallback(_=>{h(()=>_),s(!0)},[]),p=O.useCallback(_=>{_!=="cancelled"&&d&&d(),h(null),s(!1)},[d]),g=O.useCallback(()=>{h(null),s(!1)},[]),v=O.useCallback(async()=>{if(n){l(!0);try{await n()}finally{l(!1)}}},[n]);return{promptBeforeAction:m,promptProps:{isOpen:r,onClose:g,onConfirm:p,migrationName:t,isDestructive:e,onDownloadBackup:n?v:void 0,isDownloading:o}}}const Iz={onetime:{borderColor:"color-mix(in srgb, #a855f7 30%, transparent)",iconBg:"color-mix(in srgb, #a855f7 15%, transparent)"},maintenance:{borderColor:"color-mix(in srgb, #3b82f6 30%, transparent)",iconBg:"color-mix(in srgb, #3b82f6 15%, transparent)"},utility:{borderColor:"color-mix(in srgb, #22c55e 30%, transparent)",iconBg:"color-mix(in srgb, #22c55e 15%, transparent)"}};function Q0({title:t,icon:e,description:n,type:r,children:s,onValidateAll:o,isValidating:l=!1,isAnyRunning:d=!1}){const h=Iz[r],m=l||d,p=()=>{o&&!m&&o()};return u.jsxs("section",{style:{background:"color-mix(in srgb, currentColor 3%, transparent)",border:`1px solid ${h.borderColor}`,borderRadius:"12px",marginBottom:"1.5rem",overflow:"hidden"},children:[u.jsxs("div",{style:{padding:"1rem 1.25rem",borderBottom:`1px solid ${h.borderColor}`,display:"flex",justifyContent:"space-between",alignItems:"flex-start",gap:"1rem"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"0.75rem",flex:1},children:[u.jsx("span",{style:{fontSize:"1.5rem",background:h.iconBg,padding:"0.5rem",borderRadius:"8px",lineHeight:1},children:e}),u.jsxs("div",{children:[u.jsx("h3",{style:{margin:"0 0 0.25rem 0",fontSize:"1.1rem"},children:t}),u.jsx("p",{style:{margin:0,opacity:.7,fontSize:"0.85rem"},children:n})]})]}),o&&u.jsx("button",{onClick:p,disabled:m,style:{background:"color-mix(in srgb, #3b82f6 20%, transparent)",color:"#60a5fa",border:"1px solid color-mix(in srgb, #3b82f6 40%, transparent)",padding:"0.5rem 1rem",borderRadius:"6px",cursor:m?"not-allowed":"pointer",fontWeight:500,fontSize:"0.85rem",opacity:m?.6:1,display:"flex",alignItems:"center",gap:"0.4rem",flexShrink:0},children:l?u.jsxs(u.Fragment,{children:[u.jsx(Ln,{noMargin:!0})," Validating..."]}):" Validate All"})]}),u.jsx("div",{style:{padding:"0.5rem"},children:s})]})}const Dz={unknown:{color:"#9ca3af",icon:"",text:"Unknown"},clean:{color:"#22c55e",icon:"",text:"Clean"},"needs-action":{color:"#f59e0b",icon:"",text:"Needs Action"},running:{color:"#60a5fa",icon:"",text:"Running"},complete:{color:"#22c55e",icon:"",text:"Complete"},error:{color:"#ef4444",icon:"",text:"Error"}};function gc({name:t,description:e,status:n,statusText:r,onCheck:s,isChecking:o,onRun:l,isRunning:d=!1,actionText:h="Run",disabled:m=!1,itemCount:p,details:g,isDestructive:v=!1}){const[_,S]=O.useState(!1),x=Dz[n],E=r||x.text,C=m||d||o,T=()=>{s()},A=()=>{l&&l()},B=()=>{g&&S(!_)};return u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"8px",margin:"0.25rem 0",overflow:"hidden"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"0.75rem 1rem",gap:"1rem"},children:[u.jsx("div",{style:{width:"28px",height:"28px",borderRadius:"50%",background:`color-mix(in srgb, ${x.color} 20%, transparent)`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.85rem",flexShrink:0},children:d||o?u.jsx(Ln,{noMargin:!0}):x.icon}),u.jsxs("div",{style:{flex:1,minWidth:0},children:[u.jsx("div",{style:{fontWeight:500,fontSize:"0.95rem",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:t}),u.jsx("div",{style:{fontSize:"0.8rem",opacity:.6,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:e})]}),u.jsxs("div",{style:{color:x.color,fontSize:"0.8rem",fontWeight:500,display:"flex",alignItems:"center",gap:"0.25rem",flexShrink:0},children:[E,p!==void 0&&p>0&&u.jsx("span",{style:{background:`color-mix(in srgb, ${x.color} 20%, transparent)`,padding:"0.15rem 0.4rem",borderRadius:"4px",fontSize:"0.75rem"},children:p})]}),u.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:[u.jsx("button",{onClick:T,disabled:C,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",padding:"0.35rem 0.6rem",borderRadius:"4px",cursor:C?"not-allowed":"pointer",fontSize:"0.8rem",opacity:C?.5:1,display:"flex",alignItems:"center",gap:"0.25rem"},title:"Check status",children:o?u.jsx(Ln,{noMargin:!0}):""}),l&&n==="needs-action"&&u.jsx("button",{onClick:A,disabled:C,style:{background:v?"#ef4444":"#646cff",color:"white",border:"none",padding:"0.35rem 0.75rem",borderRadius:"4px",cursor:C?"not-allowed":"pointer",fontSize:"0.8rem",fontWeight:500,opacity:C?.6:1,display:"flex",alignItems:"center",gap:"0.25rem"},children:d?u.jsx(Ln,{noMargin:!0}):h}),g&&u.jsx("button",{onClick:B,style:{background:"transparent",color:"inherit",border:"none",padding:"0.35rem",borderRadius:"4px",cursor:"pointer",fontSize:"0.9rem",opacity:.6},title:_?"Collapse details":"Expand details",children:_?"":""})]})]}),_&&g&&u.jsx("div",{style:{borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)",padding:"1rem",background:"color-mix(in srgb, currentColor 2%, transparent)"},children:g})]})}function kz({name:t,description:e,onAction:n,actionText:r,actionIcon:s,isRunning:o=!1,disabled:l=!1,progress:d,error:h,isDestructive:m=!1}){const p=l||o,g=()=>{n()};return u.jsx("div",{style:{background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"8px",margin:"0.25rem 0",padding:"0.75rem 1rem"},children:u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},children:[u.jsxs("div",{style:{flex:1,minWidth:0},children:[u.jsx("div",{style:{fontWeight:500,fontSize:"0.95rem",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:t}),u.jsx("div",{style:{fontSize:"0.8rem",opacity:.6,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:e}),h&&u.jsx("div",{style:{fontSize:"0.8rem",color:"#ef4444",marginTop:"0.25rem"},children:h})]}),d!==void 0&&o&&u.jsxs("div",{style:{width:"100px",flexShrink:0},children:[u.jsx("div",{style:{background:"rgba(255, 255, 255, 0.1)",borderRadius:"4px",height:"6px",overflow:"hidden"},children:u.jsx("div",{style:{background:m?"#ef4444":"#646cff",height:"100%",width:`${d}%`,transition:"width 0.3s"}})}),u.jsxs("div",{style:{fontSize:"0.7rem",opacity:.6,textAlign:"center",marginTop:"0.15rem"},children:[d,"%"]})]}),u.jsx("button",{onClick:g,disabled:p,style:{background:m?"#ef4444":"#646cff",color:"white",border:"none",padding:"0.5rem 1rem",borderRadius:"6px",cursor:p?"not-allowed":"pointer",fontSize:"0.85rem",fontWeight:500,opacity:p?.6:1,display:"flex",alignItems:"center",gap:"0.4rem",flexShrink:0},children:o?u.jsxs(u.Fragment,{children:[u.jsx(Ln,{noMargin:!0})," Running..."]}):u.jsxs(u.Fragment,{children:[s&&u.jsx("span",{children:s}),r]})})]})})}function Oz({status:t,hasData:e,hasIssues:n,totalIssues:r,isChecking:s,isRunning:o,result:l,onCheck:d,onRun:h,disabled:m}){const p=()=>o?"running":e?l&&l.errors.length===0?"complete":l&&l.errors.length>0?"error":n?"needs-action":"clean":"unknown",g=()=>{if(l&&l.errors.length===0){const _=l.accountsFixed+l.categoriesFixed+l.groupsFixed+l.monthMapsUpdated+l.deprecatedFieldsRemoved+l.futureMonthsDeleted+l.monthsFixed+l.oldRecalcFieldsRemoved+l.dataMappingsFixed;return _>0?`Fixed ${_}`:"Complete"}},v=()=>l?u.jsxs("div",{style:{fontSize:"0.85rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem",fontWeight:500},children:l.errors.length>0?" Completed with errors":" Cleanup complete"}),u.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[l.budgetsProcessed>0&&u.jsxs("li",{children:[l.budgetsProcessed," budget(s) processed"]}),l.arraysConverted>0&&u.jsxs("li",{children:[l.arraysConverted," array(s) converted to maps"]}),l.accountsFixed>0&&u.jsxs("li",{children:[l.accountsFixed," account(s) fixed"]}),l.categoriesFixed>0&&u.jsxs("li",{children:[l.categoriesFixed," categor(ies) fixed"]}),l.groupsFixed>0&&u.jsxs("li",{children:[l.groupsFixed," group(s) fixed"]}),l.monthMapsUpdated>0&&u.jsxs("li",{children:[l.monthMapsUpdated," month_map(s) updated"]}),l.deprecatedFieldsRemoved>0&&u.jsxs("li",{children:[l.deprecatedFieldsRemoved," deprecated field(s) removed"]}),l.futureMonthsDeleted>0&&u.jsxs("li",{children:[l.futureMonthsDeleted," future month(s) deleted"]}),l.monthsFixed>0&&u.jsxs("li",{children:[l.monthsFixed," month schema(s) fixed"]}),l.oldRecalcFieldsRemoved>0&&u.jsxs("li",{children:[l.oldRecalcFieldsRemoved," old recalc field(s) removed"]}),l.dataMappingsFixed>0&&u.jsxs("li",{children:[l.dataMappingsFixed," data mapping(s) fixed"]})]}),l.errors.length>0&&u.jsxs("div",{style:{marginTop:"0.5rem",color:"#ef4444"},children:[u.jsxs("div",{children:["Errors (",l.errors.length,"):"]}),u.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1.25rem"},children:[l.errors.slice(0,3).map((_,S)=>u.jsx("li",{children:_},S)),l.errors.length>3&&u.jsxs("li",{children:["...and ",l.errors.length-3," more"]})]})]})]}):e?n?u.jsxs("div",{style:{fontSize:"0.85rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem",color:"#fbbf24"},children:"Issues found:"}),u.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[t.budgetsWithArrays>0&&u.jsxs("li",{children:[t.budgetsWithArrays," budget(s) using legacy array format"]}),t.accountsNeedingDefaults>0&&u.jsxs("li",{children:[t.accountsNeedingDefaults," account(s) missing defaults"]}),t.categoriesNeedingDefaults>0&&u.jsxs("li",{children:[t.categoriesNeedingDefaults," categor(ies) missing defaults"]}),t.groupsNeedingDefaults>0&&u.jsxs("li",{children:[t.groupsNeedingDefaults," group(s) missing defaults"]}),t.budgetsNeedingMonthMapUpdate>0&&u.jsxs("li",{children:[t.budgetsNeedingMonthMapUpdate," budget(s) missing month_map"]}),t.budgetsWithDeprecatedEarliestMonth>0&&u.jsxs("li",{children:[t.budgetsWithDeprecatedEarliestMonth," deprecated earliest_month field(s)"]}),t.futureMonthsToDelete.length>0&&u.jsxs("li",{children:[t.futureMonthsToDelete.length," future month(s) to delete",u.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1rem",opacity:.8},children:[t.futureMonthsToDelete.slice(0,2).map(_=>u.jsxs("li",{children:[Kl[_.month-1]," ",_.year]},_.docId)),t.futureMonthsToDelete.length>2&&u.jsxs("li",{children:["...and ",t.futureMonthsToDelete.length-2," more"]})]})]}),t.monthsWithSchemaIssues>0&&u.jsxs("li",{children:[t.monthsWithSchemaIssues," month(s) with schema issues"]}),t.monthsWithOldRecalcField>0&&u.jsxs("li",{children:[t.monthsWithOldRecalcField," month(s) with old recalc field"]}),t.dataMappingsMissingBudgetId>0&&u.jsxs("li",{children:[t.dataMappingsMissingBudgetId," data mapping(s) missing budget_id"]})]}),u.jsxs("div",{style:{marginTop:"0.5rem",opacity:.6},children:["Scanned ",t.totalBudgets," budgets, ",t.totalMonths," months, ",t.totalDataMappings," data mappings."]})]}):u.jsxs("div",{style:{fontSize:"0.85rem"},children:[" All ",t.totalBudgets," budgets, ",t.totalMonths," months, and ",t.totalDataMappings," data mappings are clean."]}):u.jsx("div",{style:{fontSize:"0.85rem",opacity:.7},children:"Click check to scan for issues."});return u.jsx(gc,{name:"Database Cleanup",description:"Validates and fixes schema for budgets, months, and data mappings",status:p(),statusText:g(),onCheck:d,isChecking:s,onRun:h,isRunning:o,actionText:`Fix ${r}`,disabled:m,itemCount:n?r:void 0,details:v(),isDestructive:!0})}function Mz({status:t,hasData:e,needsMigration:n,totalItemsToFix:r,isChecking:s,isRunning:o,result:l,onCheck:d,onRun:h,disabled:m}){const p=()=>o?"running":e?l&&l.errors.length===0?"complete":l&&l.errors.length>0?"error":n?"needs-action":"clean":"unknown",g=()=>{if(l&&l.errors.length===0){const _=l.accountsUpdated+l.categoriesUpdated+l.hiddenAccountsCreated+l.hiddenCategoriesCreated+l.adjustmentsFixed;return _>0?`Fixed ${_}`:"Complete"}},v=()=>{if(l){const _=l.accountsUpdated+l.categoriesUpdated+l.hiddenAccountsCreated+l.hiddenCategoriesCreated+l.adjustmentsFixed;return u.jsxs("div",{style:{fontSize:"0.85rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem",fontWeight:500},children:l.errors.length>0?" Completed with errors":" Migration complete"}),u.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[l.budgetsProcessed>0&&u.jsxs("li",{children:[l.budgetsProcessed," budget(s) updated"]}),l.accountsUpdated>0&&u.jsxs("li",{children:[l.accountsUpdated," account(s) got is_hidden field"]}),l.categoriesUpdated>0&&u.jsxs("li",{children:[l.categoriesUpdated," categor(ies) got is_hidden field"]}),l.hiddenAccountsCreated>0&&u.jsxs("li",{children:[l.hiddenAccountsCreated," hidden account(s) created"]}),l.hiddenCategoriesCreated>0&&u.jsxs("li",{children:[l.hiddenCategoriesCreated," hidden categor(ies) created"]}),l.adjustmentsFixed>0&&u.jsxs("li",{children:[l.adjustmentsFixed," adjustment(s) fixed"]}),_===0&&u.jsx("li",{children:"No changes needed"})]}),l.errors.length>0&&u.jsxs("div",{style:{marginTop:"0.5rem",color:"#ef4444"},children:[u.jsxs("div",{children:["Errors (",l.errors.length,"):"]}),u.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1.25rem"},children:[l.errors.slice(0,3).map((S,x)=>u.jsx("li",{children:S},x)),l.errors.length>3&&u.jsxs("li",{children:["...and ",l.errors.length-3," more"]})]})]})]})}return e?n?u.jsxs("div",{style:{fontSize:"0.85rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem",color:"#fbbf24"},children:"Items to migrate:"}),u.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[t.accountsNeedingField>0&&u.jsxs("li",{children:[t.accountsNeedingField," account(s) need is_hidden field"]}),t.categoriesNeedingField>0&&u.jsxs("li",{children:[t.categoriesNeedingField," categor(ies) need is_hidden field"]}),t.adjustmentsToFix>0&&u.jsxs("li",{children:[t.adjustmentsToFix," adjustment(s) with missing account/category"]})]}),t.adjustmentDetails.length>0&&u.jsxs("div",{style:{marginTop:"0.5rem",opacity:.8},children:[u.jsx("div",{style:{fontWeight:500,marginBottom:"0.25rem"},children:"Adjustments to fix:"}),u.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[t.adjustmentDetails.slice(0,3).map((_,S)=>u.jsxs("li",{children:["[",_.monthKey,"] $",_.amount.toFixed(2)," - ",_.description||"(no description)"]},S)),t.adjustmentDetails.length>3&&u.jsxs("li",{style:{opacity:.7},children:["...and ",t.adjustmentDetails.length-3," more"]})]})]}),u.jsxs("div",{style:{marginTop:"0.5rem",opacity:.6},children:["Scanned ",t.totalBudgets," budget(s) and ",t.totalMonths," month(s)."]})]}):u.jsxs("div",{style:{fontSize:"0.85rem"},children:[" All accounts and categories have is_hidden field. No adjustments with missing account/category.",u.jsxs("div",{style:{marginTop:"0.25rem",opacity:.6},children:["Scanned ",t.totalBudgets," budget(s) and ",t.totalMonths," month(s)."]})]}):u.jsx("div",{style:{fontSize:"0.85rem",opacity:.7},children:"Click check to scan for items needing is_hidden field."})};return u.jsx(gc,{name:"Hidden Field Migration",description:"Adds is_hidden field to accounts/categories and fixes missing references",status:p(),statusText:g(),onCheck:d,isChecking:s,onRun:h,isRunning:o,actionText:`Fix ${r}`,disabled:m,itemCount:n?r:void 0,details:v(),isDestructive:!0})}function Nz({status:t,hasData:e,hasIssues:n,totalIssues:r,isChecking:s,isRunning:o,result:l,onCheck:d,onRun:h,disabled:m}){const p=()=>o?"running":e?l&&l.errors.length===0?"complete":l&&l.errors.length>0?"error":n?"needs-action":"clean":"unknown",g=()=>{if(l&&l.errors.length===0){const _=l.fixedDocuments+l.deletedDocuments;return _>0?`Fixed ${_}`:"Complete"}},v=()=>l?u.jsxs("div",{style:{fontSize:"0.85rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem",fontWeight:500},children:l.errors.length>0?" Completed with errors":" Migration complete"}),u.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[l.fixedDocuments>0&&u.jsxs("li",{children:[l.fixedDocuments," corrupted document(s) fixed"]}),l.deletedDocuments>0&&u.jsxs("li",{children:[l.deletedDocuments," sanitized document(s) merged & deleted"]}),l.mergedItems>0&&u.jsxs("li",{children:[l.mergedItems," feedback item(s) merged"]}),l.fixedDocuments===0&&l.deletedDocuments===0&&u.jsx("li",{children:"No changes needed"})]}),l.errors.length>0&&u.jsxs("div",{style:{marginTop:"0.5rem",color:"#ef4444"},children:[u.jsxs("div",{children:["Errors (",l.errors.length,"):"]}),u.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1.25rem"},children:[l.errors.slice(0,3).map((_,S)=>u.jsx("li",{children:_},S)),l.errors.length>3&&u.jsxs("li",{children:["...and ",l.errors.length-3," more"]})]})]})]}):e?n?u.jsxs("div",{style:{fontSize:"0.85rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem",color:"#fbbf24"},children:"Issues found:"}),u.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[t.corruptedDocuments.length>0&&u.jsxs("li",{children:[t.corruptedDocuments.length," corrupted document(s):",u.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1rem",opacity:.8},children:[t.corruptedDocuments.slice(0,3).map(_=>u.jsxs("li",{children:[_," (broken arrayUnion)"]},_)),t.corruptedDocuments.length>3&&u.jsxs("li",{children:["...and ",t.corruptedDocuments.length-3," more"]})]})]}),t.sanitizedDocuments.length>0&&u.jsxs("li",{children:[t.sanitizedDocuments.length," sanitized document(s) to merge:",u.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1rem",opacity:.8},children:[t.sanitizedDocuments.slice(0,3).map(_=>u.jsx("li",{children:_},_)),t.sanitizedDocuments.length>3&&u.jsxs("li",{children:["...and ",t.sanitizedDocuments.length-3," more"]})]})]})]}),u.jsxs("div",{style:{marginTop:"0.5rem",opacity:.6},children:["Found ",t.documentsFound," total document(s)."]})]}):u.jsxs("div",{style:{fontSize:"0.85rem"},children:[" All ",t.documentsFound," feedback document(s) are healthy."]}):u.jsx("div",{style:{fontSize:"0.85rem",opacity:.7},children:"Click check to scan feedback documents."});return u.jsx(gc,{name:"Feedback Consolidation",description:"Fixes corrupted feedback data and merges sanitized document IDs",status:p(),statusText:g(),onCheck:d,isChecking:s,onRun:h,isRunning:o,actionText:`Fix ${r}`,disabled:m,itemCount:n?r:void 0,details:v(),isDestructive:!0})}function Pz({disabled:t,onDownloadBackup:e,isDownloadingBackup:n,databaseCleanup:r,hiddenField:s,feedback:o}){const l=r.isRunning||s.isRunning||o.isMigrating,d=Pi({migrationName:"Database Cleanup",isDestructive:!0,onDownloadBackup:e}),h=Pi({migrationName:"Hidden Field Migration",isDestructive:!0,onDownloadBackup:e}),m=Pi({migrationName:"Feedback Consolidation",isDestructive:!0,onDownloadBackup:e});return u.jsxs(u.Fragment,{children:[u.jsxs(Q0,{title:"One-Time Migrations",icon:"",description:"Migrations that typically only need to be run once. Check status first, then apply if needed.",type:"onetime",isAnyRunning:l,children:[u.jsx(Oz,{status:r.status,hasData:r.hasData,hasIssues:r.hasIssues,totalIssues:r.totalIssues,isChecking:r.isScanning,isRunning:r.isRunning,result:r.result,onCheck:r.scanStatus,onRun:()=>d.promptBeforeAction(r.runCleanup),disabled:t}),u.jsx(Mz,{status:s.status,hasData:s.hasData,needsMigration:s.needsMigration,totalItemsToFix:s.totalItemsToFix,isChecking:s.isScanning,isRunning:s.isRunning,result:s.result,onCheck:s.scanStatus,onRun:()=>h.promptBeforeAction(s.runMigration),disabled:t}),u.jsx(Nz,{status:o.status,hasData:o.hasData,hasIssues:o.hasIssues,totalIssues:o.totalIssues,isChecking:o.isScanning,isRunning:o.isMigrating,result:o.result,onCheck:o.scanStatus,onRun:()=>m.promptBeforeAction(o.migrateFeedbackDocuments),disabled:t})]}),u.jsx(Ni,{...d.promptProps,isDownloading:n}),u.jsx(Ni,{...h.promptProps,isDownloading:n}),u.jsx(Ni,{...m.promptProps,isDownloading:n})]})}const uA={unknown:{color:"#9ca3af",icon:""},clean:{color:"#22c55e",icon:""},"needs-action":{color:"#f59e0b",icon:""},running:{color:"#60a5fa",icon:""},complete:{color:"#22c55e",icon:""},error:{color:"#ef4444",icon:""}};function zz({check:t,disabled:e}){const n=uA[t.status],r=e||t.isRunning||t.isChecking;return u.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"0.5rem 0.75rem",gap:"0.75rem",borderRadius:"6px",background:"color-mix(in srgb, currentColor 3%, transparent)",marginBottom:"0.25rem"},children:[u.jsx("div",{style:{width:"20px",height:"20px",borderRadius:"50%",background:`color-mix(in srgb, ${n.color} 20%, transparent)`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.7rem",flexShrink:0},children:t.isRunning||t.isChecking?u.jsx(Ln,{noMargin:!0}):n.icon}),u.jsxs("div",{style:{flex:1,minWidth:0},children:[u.jsxs("div",{style:{fontWeight:500,fontSize:"0.85rem"},children:[t.name,t.issueCount>0&&u.jsxs("span",{style:{marginLeft:"0.5rem",color:n.color,fontSize:"0.75rem"},children:["(",t.issueCount,")"]})]}),u.jsx("div",{style:{fontSize:"0.75rem",opacity:.6},children:t.description}),t.details]}),u.jsxs("div",{style:{display:"flex",gap:"0.35rem",flexShrink:0},children:[u.jsx("button",{onClick:()=>{`${t.name}`,t.onCheck()},disabled:r,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",padding:"0.25rem 0.4rem",borderRadius:"4px",cursor:r?"not-allowed":"pointer",fontSize:"0.7rem",opacity:r?.5:1},title:"Check",children:t.isChecking?u.jsx(Ln,{noMargin:!0}):""}),t.canFix&&t.onFix&&u.jsx("button",{onClick:()=>{`${t.name}`,t.onFix()},disabled:r,style:{background:"#646cff",color:"white",border:"none",padding:"0.25rem 0.5rem",borderRadius:"4px",cursor:r?"not-allowed":"pointer",fontSize:"0.7rem",fontWeight:500,opacity:r?.6:1},children:t.isRunning?u.jsx(Ln,{noMargin:!0}):"Fix"})]})]})}function Bz({accountCategoryValidation:t,orphanedIdCleanup:e,expenseToAdjustment:n,adjustmentsToTransfers:r,needsAction:s,totalIssues:o,isScanning:l,isRunning:d,disabled:h,onRunOrphaned:m,onRunExpense:p,onRunTransfers:g}){const[v,_]=O.useState(!1),x=d?"running":t.hasData&&e.hasData&&n.hasData&&r.hasData?s?"needs-action":"clean":"unknown",E=uA[x],C=[{id:"validation",name:"Account/Category Validation",status:t.isScanning?"running":t.hasData?t.hasViolations?"needs-action":"clean":"unknown",issueCount:t.violationCount,description:"Validates all transactions have proper account/category combinations",canFix:!1,onCheck:()=>t.scan(),isChecking:t.isScanning,isRunning:!1,details:t.hasViolations&&t.status&&u.jsxs("div",{style:{fontSize:"0.8rem",opacity:.8},children:[t.status.violations.filter(B=>B.transactionType==="income").length>0&&u.jsxs("span",{children:["Income: ",t.status.violations.filter(B=>B.transactionType==="income").length," "]}),t.status.violations.filter(B=>B.transactionType==="expense").length>0&&u.jsxs("span",{children:["Expenses: ",t.status.violations.filter(B=>B.transactionType==="expense").length," "]}),t.status.violations.filter(B=>B.transactionType==="adjustment").length>0&&u.jsxs("span",{children:["Adjustments: ",t.status.violations.filter(B=>B.transactionType==="adjustment").length," "]}),t.status.violations.filter(B=>B.transactionType==="transfer").length>0&&u.jsxs("span",{children:["Transfers: ",t.status.violations.filter(B=>B.transactionType==="transfer").length]})]})},{id:"orphaned",name:"Orphaned ID Cleanup",status:Wg(e),issueCount:e.totalOrphaned,description:"Finds transactions with deleted/invalid account/category IDs",canFix:e.hasItemsToFix,onCheck:e.scanStatus,onFix:m,isChecking:e.isScanning,isRunning:e.isRunning,details:e.hasItemsToFix&&e.status&&u.jsxs("div",{style:{fontSize:"0.8rem",opacity:.8},children:[e.status.orphanedCategoryIds>0&&u.jsxs("span",{children:["Categories: ",e.status.orphanedCategoryIds," "]}),e.status.orphanedAccountIds>0&&u.jsxs("span",{children:["Accounts: ",e.status.orphanedAccountIds]})]})},{id:"expense",name:"Expense  Adjustment",status:Wg(n,"hasItemsToMigrate"),issueCount:n.totalToMigrate,description:"Moves expenses without account/category to adjustments",canFix:n.hasItemsToMigrate,onCheck:n.scanStatus,onFix:p,isChecking:n.isScanning,isRunning:n.isRunning,details:n.hasItemsToMigrate&&n.status&&u.jsxs("div",{style:{fontSize:"0.8rem",opacity:.8},children:[n.status.expensesToMigrate," expense(s) with No Account or No Category"]})},{id:"transfers",name:"Adjustment  Transfers",status:Wg(r,"hasPairsToConvert"),issueCount:r.totalPairs,description:"Converts opposite adjustment pairs to transfers",canFix:r.hasPairsToConvert,onCheck:r.scanStatus,onFix:g,isChecking:r.isScanning,isRunning:r.isRunning,details:r.hasPairsToConvert&&r.status&&u.jsxs("div",{style:{fontSize:"0.8rem",opacity:.8},children:[r.status.accountTransferPairs>0&&u.jsxs("span",{children:["Account transfers: ",r.status.accountTransferPairs," "]}),r.status.categoryTransferPairs>0&&u.jsxs("span",{children:["Category transfers: ",r.status.categoryTransferPairs]})]})}],T=h||d||l,A=()=>{C.forEach(B=>B.onCheck())};return u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"8px",margin:"0.25rem 0",overflow:"hidden"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"0.75rem 1rem",gap:"1rem"},children:[u.jsx("div",{style:{width:"28px",height:"28px",borderRadius:"50%",background:`color-mix(in srgb, ${E.color} 20%, transparent)`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.85rem",flexShrink:0},children:d||l?u.jsx(Ln,{noMargin:!0}):E.icon}),u.jsxs("div",{style:{flex:1,minWidth:0},children:[u.jsx("div",{style:{fontWeight:500,fontSize:"0.95rem",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:"Transaction Type Audit"}),u.jsx("div",{style:{fontSize:"0.8rem",opacity:.6,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:"Validates account/category assignments and fixes invalid transactions"})]}),u.jsxs("div",{style:{color:E.color,fontSize:"0.8rem",fontWeight:500,display:"flex",alignItems:"center",gap:"0.25rem",flexShrink:0},children:[x==="unknown"?"Unknown":x==="clean"?"Clean":x==="running"?"Running":"Needs Action",o>0&&u.jsx("span",{style:{background:`color-mix(in srgb, ${E.color} 20%, transparent)`,padding:"0.15rem 0.4rem",borderRadius:"4px",fontSize:"0.75rem"},children:o})]}),u.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:[u.jsx("button",{onClick:A,disabled:T,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",padding:"0.35rem 0.6rem",borderRadius:"4px",cursor:T?"not-allowed":"pointer",fontSize:"0.8rem",opacity:T?.5:1,display:"flex",alignItems:"center",gap:"0.25rem"},title:"Check all",children:l?u.jsx(Ln,{noMargin:!0}):""}),u.jsx("button",{onClick:()=>_(!v),style:{background:"transparent",color:"inherit",border:"none",padding:"0.35rem",borderRadius:"4px",cursor:"pointer",fontSize:"0.9rem",opacity:.6},title:v?"Collapse":"Expand",children:v?"":""})]})]}),v&&u.jsx("div",{style:{borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)",padding:"0.5rem",background:"color-mix(in srgb, currentColor 2%, transparent)"},children:C.map(B=>u.jsx(zz,{check:B,disabled:h},B.id))})]})}function Wg(t,e="hasItemsToFix"){return t.isRunning?"running":t.result&&t.result.errors.length===0?"complete":t.isScanning?"running":t.hasData?t[e]?"needs-action":"clean":"unknown"}function Lz({status:t,hasData:e,hasIssues:n,totalIssues:r,isChecking:s,isRunning:o,result:l,onCheck:d,onRun:h,disabled:m}){const p=()=>o?"running":e?l&&l.errors.length===0?"complete":l&&l.errors.length>0?"error":n?"needs-action":"clean":"unknown",g=()=>{if(l&&l.errors.length===0){const _=l.accountsFixed+l.categoriesFixed+l.totalAvailableFixed+l.incomeValuesFixed+l.expenseValuesFixed+l.categoryBalancesFixed+l.accountBalancesFixed;return _>0?`Fixed ${_}`:"Complete"}},v=()=>{if(l){const _=l.accountsFixed+l.categoriesFixed+l.totalAvailableFixed+l.incomeValuesFixed+l.expenseValuesFixed+l.categoryBalancesFixed+l.accountBalancesFixed;return u.jsxs("div",{style:{fontSize:"0.85rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem",fontWeight:500},children:l.errors.length>0?" Completed with errors":" Cleanup complete"}),u.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[l.budgetsProcessed>0&&u.jsxs("li",{children:[l.budgetsProcessed," budget(s) updated"]}),l.accountsFixed>0&&u.jsxs("li",{children:[l.accountsFixed," account balance(s) fixed"]}),l.categoriesFixed>0&&u.jsxs("li",{children:[l.categoriesFixed," category value(s) fixed"]}),l.totalAvailableFixed>0&&u.jsxs("li",{children:[l.totalAvailableFixed," total_available value(s) fixed"]}),l.monthsProcessed>0&&u.jsxs("li",{children:[l.monthsProcessed," month(s) updated"]}),l.incomeValuesFixed>0&&u.jsxs("li",{children:[l.incomeValuesFixed," income amount(s) fixed"]}),l.expenseValuesFixed>0&&u.jsxs("li",{children:[l.expenseValuesFixed," expense amount(s) fixed"]}),l.categoryBalancesFixed>0&&u.jsxs("li",{children:[l.categoryBalancesFixed," category balance(s) fixed"]}),l.accountBalancesFixed>0&&u.jsxs("li",{children:[l.accountBalancesFixed," account balance(s) fixed"]}),_===0&&u.jsx("li",{children:"No changes needed"})]}),l.errors.length>0&&u.jsxs("div",{style:{marginTop:"0.5rem",color:"#ef4444"},children:[u.jsxs("div",{children:["Errors (",l.errors.length,"):"]}),u.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1.25rem"},children:[l.errors.slice(0,3).map((S,x)=>u.jsx("li",{children:S},x)),l.errors.length>3&&u.jsxs("li",{children:["...and ",l.errors.length-3," more"]})]})]})]})}return e?n?u.jsxs("div",{style:{fontSize:"0.85rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem",color:"#fbbf24"},children:"Precision issues found:"}),u.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[t.budgetsWithPrecisionIssues>0&&u.jsxs("li",{children:[t.budgetsWithPrecisionIssues," budget(s) with issues:",u.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1rem",opacity:.8},children:[t.accountsWithPrecisionIssues>0&&u.jsxs("li",{children:[t.accountsWithPrecisionIssues," account balance(s)"]}),t.categoriesWithPrecisionIssues>0&&u.jsxs("li",{children:[t.categoriesWithPrecisionIssues," category value(s)"]}),t.totalAvailableWithPrecisionIssues>0&&u.jsxs("li",{children:[t.totalAvailableWithPrecisionIssues," total_available value(s)"]})]})]}),t.monthsWithPrecisionIssues>0&&u.jsxs("li",{children:[t.monthsWithPrecisionIssues," month(s) with issues:",u.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1rem",opacity:.8},children:[t.incomeValuesWithPrecisionIssues>0&&u.jsxs("li",{children:[t.incomeValuesWithPrecisionIssues," income amount(s)"]}),t.expenseValuesWithPrecisionIssues>0&&u.jsxs("li",{children:[t.expenseValuesWithPrecisionIssues," expense amount(s)"]}),t.categoryBalancesWithPrecisionIssues>0&&u.jsxs("li",{children:[t.categoryBalancesWithPrecisionIssues," category balance(s)"]}),t.accountBalancesWithPrecisionIssues>0&&u.jsxs("li",{children:[t.accountBalancesWithPrecisionIssues," account balance(s)"]})]})]})]}),u.jsxs("div",{style:{marginTop:"0.5rem",opacity:.6},children:["Scanned ",t.totalBudgets," budget(s) and ",t.totalMonths," month(s)."]})]}):u.jsxs("div",{style:{fontSize:"0.85rem"},children:[" All currency values have proper precision (2 decimal places).",u.jsxs("div",{style:{marginTop:"0.25rem",opacity:.6},children:["Scanned ",t.totalBudgets," budget(s) and ",t.totalMonths," month(s)."]})]}):u.jsx("div",{style:{fontSize:"0.85rem",opacity:.7},children:"Click check to scan for precision issues."})};return u.jsx(gc,{name:"Currency Precision",description:"Fixes floating-point precision by rounding all values to 2 decimal places",status:p(),statusText:g(),onCheck:d,isChecking:s,onRun:h,isRunning:o,actionText:`Fix ${r}`,disabled:m,itemCount:n?r:void 0,details:v(),isDestructive:!0})}function Uz({disabled:t,onDownloadBackup:e,isDownloadingBackup:n,accountCategoryValidation:r,orphanedIdCleanup:s,expenseToAdjustment:o,adjustmentsToTransfers:l,precisionCleanup:d}){const h=r.isScanning||s.isScanning||o.isScanning||l.isScanning||d.isScanning,m=s.isRunning||o.isRunning||l.isRunning||d.isRunning,p=async()=>{await Promise.all([r.scan(),s.scanStatus(),o.scanStatus(),l.scanStatus(),d.scan()])},g=Pi({migrationName:"Orphaned ID Cleanup",isDestructive:!0,onDownloadBackup:e}),v=Pi({migrationName:"Expense to Adjustment Migration",isDestructive:!0,onDownloadBackup:e}),_=Pi({migrationName:"Adjustments to Transfers Migration",isDestructive:!0,onDownloadBackup:e}),S=Pi({migrationName:"Currency Precision Cleanup",isDestructive:!0,onDownloadBackup:e}),x=r.hasViolations||s.hasItemsToFix||o.hasItemsToMigrate||l.hasPairsToConvert,E=(r.violationCount||0)+(s.totalOrphaned||0)+(o.totalToMigrate||0)+(l.totalPairs||0);return u.jsxs(u.Fragment,{children:[u.jsxs(Q0,{title:"Maintenance",icon:"",description:"Re-runnable database validation scripts. Validate all to see which need resolution.",type:"maintenance",onValidateAll:p,isValidating:h,isAnyRunning:m,children:[u.jsx(Bz,{accountCategoryValidation:r,orphanedIdCleanup:s,expenseToAdjustment:o,adjustmentsToTransfers:l,needsAction:x,totalIssues:E,isScanning:r.isScanning||s.isScanning||o.isScanning||l.isScanning,isRunning:s.isRunning||o.isRunning||l.isRunning,disabled:t,onRunOrphaned:()=>g.promptBeforeAction(s.runMigration),onRunExpense:()=>v.promptBeforeAction(o.runMigration),onRunTransfers:()=>_.promptBeforeAction(l.runMigration)}),u.jsx(Lz,{status:d.status,hasData:d.hasData,hasIssues:d.hasIssues,totalIssues:d.totalIssues,isChecking:d.isScanning,isRunning:d.isRunning,result:d.result,onCheck:d.scan,onRun:()=>S.promptBeforeAction(d.runCleanup),disabled:t})]}),u.jsx(Ni,{...g.promptProps,isDownloading:n}),u.jsx(Ni,{...v.promptProps,isDownloading:n}),u.jsx(Ni,{..._.promptProps,isDownloading:n}),u.jsx(Ni,{...S.promptProps,isDownloading:n})]})}function Fz({isDownloading:t,downloadProgress:e,downloadError:n,onDownload:r,isScanning:s,isUploading:o,uploadStatus:l,uploadProgress:d,uploadError:h,uploadResult:m,onScan:p,onUpload:g,disabled:v}){const _=O.useRef(null),[S,x]=O.useState(null),[E,C]=O.useState(!1),T=async H=>{const j=H.target.files?.[0];j&&(x(j),await p(j))},A=l!==null,B=A&&(l.budgetsFound>0||l.monthsFound>0),U=v||t||s||o,G=m?.success?"#22c55e":B?"#f59e0b":A?"#22c55e":"#9ca3af",k=m?.success?"":o||s||t?"":B?"":A?"":"",D=m?.success?"Uploaded":o?"Uploading":s?"Scanning":t?"Downloading":B?`${l.budgetsFound} budget(s), ${l.monthsFound} month(s) ready`:A?"Nothing to upload":"Select file",N=t?e?.percentComplete:d?.percentComplete,F=n||h;return u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"8px",margin:"0.25rem 0",overflow:"hidden"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"0.75rem 1rem",gap:"1rem"},children:[u.jsx("div",{style:{width:"28px",height:"28px",borderRadius:"50%",background:`color-mix(in srgb, ${G} 20%, transparent)`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.85rem",flexShrink:0},children:o||s||t?u.jsx(Ln,{noMargin:!0}):k}),u.jsxs("div",{style:{flex:1,minWidth:0},children:[u.jsx("div",{style:{fontWeight:500,fontSize:"0.95rem",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:" Budget Backup & Restore"}),u.jsx("div",{style:{fontSize:"0.8rem",opacity:.6,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:"Download selected budget as zip or restore from zip file"})]}),u.jsx("div",{style:{color:G,fontSize:"0.8rem",fontWeight:500,flexShrink:0},children:D}),u.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:[u.jsx("button",{onClick:()=>{r()},disabled:U,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",padding:"0.35rem 0.6rem",borderRadius:"4px",cursor:U?"not-allowed":"pointer",fontSize:"0.8rem",opacity:U?.5:1,display:"flex",alignItems:"center",gap:"0.25rem"},title:"Download all budgets as zip",children:t?u.jsx(Ln,{noMargin:!0}):""}),u.jsx("input",{ref:_,type:"file",accept:".zip",onChange:T,style:{display:"none"}}),u.jsx("button",{onClick:()=>_.current?.click(),disabled:U,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",padding:"0.35rem 0.6rem",borderRadius:"4px",cursor:U?"not-allowed":"pointer",fontSize:"0.8rem",opacity:U?.5:1,display:"flex",alignItems:"center",gap:"0.25rem"},title:"Select zip file to restore",children:s?u.jsx(Ln,{noMargin:!0}):""}),B&&S&&u.jsx("button",{onClick:async()=>{await g(S)},disabled:U,style:{background:"#646cff",color:"white",border:"none",padding:"0.35rem 0.75rem",borderRadius:"4px",cursor:U?"not-allowed":"pointer",fontSize:"0.8rem",fontWeight:500,opacity:U?.6:1,display:"flex",alignItems:"center",gap:"0.25rem"},children:o?u.jsx(Ln,{noMargin:!0}):"Upload"}),(A||m||F)&&u.jsx("button",{onClick:()=>C(!E),style:{background:"transparent",color:"inherit",border:"none",padding:"0.35rem",borderRadius:"4px",cursor:"pointer",fontSize:"0.9rem",opacity:.6},title:E?"Collapse":"Expand",children:E?"":""})]})]}),(t||o)&&N!==void 0&&u.jsxs("div",{style:{padding:"0 1rem 0.5rem 1rem"},children:[u.jsx("div",{style:{width:"100%",height:"4px",background:"color-mix(in srgb, currentColor 10%, transparent)",borderRadius:"2px",overflow:"hidden"},children:u.jsx("div",{style:{width:`${N}%`,height:"100%",background:"#646cff",transition:"width 0.3s ease"}})}),u.jsxs("div",{style:{fontSize:"0.75rem",opacity:.6,marginTop:"0.25rem",textAlign:"center"},children:[t?e?.phase:d?.phase,": ",N,"%"]})]}),E&&(A||m||F)&&u.jsxs("div",{style:{borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)",padding:"1rem",background:"color-mix(in srgb, currentColor 2%, transparent)",fontSize:"0.85rem"},children:[F&&u.jsxs("div",{style:{marginBottom:"0.75rem",color:"#ef4444"},children:[" Error: ",F]}),m&&u.jsx("div",{style:{marginBottom:l?"0.75rem":0,color:m.success?"#22c55e":"#ef4444"},children:m.success?u.jsxs(u.Fragment,{children:[" Restored ",m.budgetsRestored," budget(s), ",m.monthsRestored," month(s), ",m.payeesRestored," payee doc(s)"]}):u.jsxs(u.Fragment,{children:[" Upload failed: ",m.errors.join(", ")]})}),l&&u.jsxs(u.Fragment,{children:[u.jsxs("div",{style:{marginBottom:"0.25rem"},children:[u.jsx("strong",{children:"Found in zip:"})," ",l.budgetsFound," budget(s), ",l.monthsFound," month(s), ",l.payeesFound," payee doc(s)"]}),l.budgetsToRestore.length>0&&u.jsxs("div",{children:[u.jsx("strong",{children:"Budgets to restore:"})," ",l.budgetsToRestore.join(", ")]})]})]})]})}function Vz({hasData:t,monthsCount:e,budgetCount:n,isChecking:r,isDeleting:s,deleteResult:o,onCheck:l,onDelete:d,disabled:h}){const[m,p]=O.useState(!1),g=()=>s?"running":t?o&&o.errors.length===0?"complete":e===0?"clean":"needs-action":"unknown",v=()=>o&&o.errors.length===0?`Deleted ${o.deleted}`:e===0?"No months":`${e} months`,_=()=>{p(!0)},S=()=>{p(!1),d()},x=()=>o?u.jsxs("div",{style:{fontSize:"0.85rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem",fontWeight:500},children:o.errors.length>0?" Completed with errors":" Deletion complete"}),u.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[u.jsxs("li",{children:[o.deleted," month(s) deleted"]}),o.budgetsRecalculated>0&&u.jsxs("li",{children:[o.budgetsRecalculated," budget(s) reset"]})]}),o.errors.length>0&&u.jsxs("div",{style:{marginTop:"0.5rem",color:"#ef4444"},children:[u.jsxs("div",{children:["Errors (",o.errors.length,"):"]}),u.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1.25rem"},children:[o.errors.slice(0,3).map((E,C)=>u.jsx("li",{children:E},C)),o.errors.length>3&&u.jsxs("li",{children:["...and ",o.errors.length-3," more"]})]})]})]}):t?e===0?u.jsx("div",{style:{fontSize:"0.85rem"},children:" No month documents found in Firebase."}):u.jsxs("div",{style:{fontSize:"0.85rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem",color:"#ef4444"},children:" DESTRUCTIVE ACTION"}),u.jsxs("div",{children:["Found ",e," month(s) across ",n," budget(s)."]}),u.jsx("div",{style:{marginTop:"0.5rem",opacity:.7},children:"This will permanently delete ALL month documents and reset all budgets."})]}):u.jsx("div",{style:{fontSize:"0.85rem",opacity:.7},children:"Click check to scan for months."});return u.jsxs(u.Fragment,{children:[u.jsx(gc,{name:"Delete ALL Months",description:"DESTRUCTIVE: Deletes all month documents from all budgets",status:g(),statusText:v(),onCheck:l,isChecking:r,onRun:e>0?_:void 0,isRunning:s,actionText:"Delete",disabled:h,itemCount:e>0?e:void 0,details:x(),isDestructive:!0}),u.jsxs(Hi,{isOpen:m,onClose:()=>p(!1),title:" Delete All Months?",children:[u.jsx("div",{style:{background:"color-mix(in srgb, #ef4444 15%, transparent)",border:"1px solid color-mix(in srgb, #ef4444 40%, transparent)",borderRadius:"8px",padding:"1rem",marginBottom:"1rem"},children:u.jsx("p",{style:{margin:0,color:"#fca5a5",fontWeight:500,fontSize:"0.95rem"},children:" This is a destructive operation that cannot be undone!"})}),u.jsxs("p",{style:{margin:"0 0 0.75rem",opacity:.9},children:["This will permanently delete ",u.jsxs("strong",{style:{color:"#ef4444"},children:[e," month(s)"]})," across"," ",u.jsxs("strong",{style:{color:"#ef4444"},children:[n," budget(s)"]}),"."]}),u.jsxs("ul",{style:{margin:"0 0 1.5rem",paddingLeft:"1.5rem",opacity:.8,fontSize:"0.9rem"},children:[u.jsx("li",{children:"All account balances  $0"}),u.jsx("li",{children:"All category balances  $0"}),u.jsx("li",{children:"Month history cleared"})]}),u.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[u.jsx(Ve,{variant:"secondary",actionName:"Cancel Delete All Months",onClick:()=>p(!1),children:"Cancel"}),u.jsxs(Ve,{variant:"danger",actionName:"Confirm Delete All Months",onClick:S,children:[" Delete All ",e," Months"]})]})]})]})}function $z({status:t,hasData:e,totalBudgets:n,totalMonths:r,isChecking:s,isDeleting:o,deleteResult:l,onCheck:d,onDelete:h,disabled:m}){const[p,g]=O.useState(!1),v=t?.staleBudgetIds??[],_=v.length>0,S=()=>o?"running":e?l&&l.errors.length===0?"complete":n===0&&!_?"clean":"needs-action":"unknown",x=()=>l&&l.errors.length===0?`Deleted ${l.budgetsDeleted}`:n===0&&!_?"Clean":_?`${v.length} stale ref(s)`:`${n} budget(s)`,E=()=>{g(!0)},C=()=>{g(!1),h()},T=()=>l?u.jsxs("div",{style:{fontSize:"0.85rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem",fontWeight:500},children:l.errors.length>0?" Completed with errors":" Deletion complete"}),u.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[l.budgetsDeleted>0&&u.jsxs("li",{children:[l.budgetsDeleted," budget(s) deleted"]}),l.monthsDeleted>0&&u.jsxs("li",{children:[l.monthsDeleted," month(s) deleted"]}),l.payeesDeleted>0&&u.jsxs("li",{children:[l.payeesDeleted," payee doc(s) deleted"]})]}),l.errors.length>0&&u.jsxs("div",{style:{marginTop:"0.5rem",color:"#ef4444"},children:[u.jsxs("div",{children:["Errors (",l.errors.length,"):"]}),u.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1.25rem"},children:[l.errors.slice(0,3).map((B,U)=>u.jsx("li",{children:B},U)),l.errors.length>3&&u.jsxs("li",{children:["...and ",l.errors.length-3," more"]})]})]})]}):e?n===0&&!_?u.jsx("div",{style:{fontSize:"0.85rem"},children:' No budget found for sample@sample.com  user is in "new user" state.'}):_?u.jsxs("div",{style:{fontSize:"0.85rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem",color:"#f59e0b"},children:" Found stale budget references:"}),u.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[v.slice(0,3).map(B=>u.jsx("li",{style:{opacity:.8},children:B},B)),v.length>3&&u.jsxs("li",{style:{opacity:.6},children:["...and ",v.length-3," more"]})]})]}):u.jsxs("div",{style:{fontSize:"0.85rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem",color:"#f59e0b"},children:" Sample user budget found:"}),u.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[u.jsxs("li",{children:[n," budget(s)"]}),u.jsxs("li",{children:[r," month(s)"]})]}),u.jsx("div",{style:{marginTop:"0.5rem",opacity:.7},children:"Deleting will reset sample@sample.com to a new user state."})]}):u.jsx("div",{style:{fontSize:"0.85rem",opacity:.7},children:"Click check to scan for sample user budget."}),A=n>0||_;return u.jsxs(u.Fragment,{children:[u.jsx(gc,{name:"Delete Sample User Budget",description:"Reset sample@sample.com to new user state",status:S(),statusText:x(),onCheck:d,isChecking:s,onRun:A?E:void 0,isRunning:o,actionText:"Delete",disabled:m,itemCount:A?n||v.length:void 0,details:T(),isDestructive:!0}),u.jsxs(Hi,{isOpen:p,onClose:()=>g(!1),title:" Delete Sample User Budget?",children:[u.jsx("div",{style:{background:"color-mix(in srgb, #f59e0b 15%, transparent)",border:"1px solid color-mix(in srgb, #f59e0b 40%, transparent)",borderRadius:"8px",padding:"1rem",marginBottom:"1rem"},children:u.jsx("p",{style:{margin:0,color:"#fcd34d",fontWeight:500,fontSize:"0.95rem"},children:" This will delete all data for sample@sample.com!"})}),n>0&&u.jsxs("p",{style:{margin:"0 0 0.75rem",opacity:.9},children:["This will permanently delete ",u.jsxs("strong",{style:{color:"#f59e0b"},children:[n," budget(s)"]})," and"," ",u.jsxs("strong",{style:{color:"#f59e0b"},children:[r," month(s)"]}),"."]}),_&&u.jsxs("p",{style:{margin:"0 0 0.75rem",opacity:.9},children:["This will remove ",u.jsxs("strong",{style:{color:"#f59e0b"},children:[v.length," stale reference(s)"]})," from the user document."]}),u.jsxs("ul",{style:{margin:"0 0 1.5rem",paddingLeft:"1.5rem",opacity:.8,fontSize:"0.9rem"},children:[u.jsx("li",{children:"Budget document deleted"}),u.jsx("li",{children:"All month documents deleted"}),u.jsx("li",{children:"Payees document deleted"}),u.jsx("li",{children:"User will see onboarding flow"})]}),u.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[u.jsx(Ve,{variant:"secondary",actionName:"Cancel Delete Sample User Budget",onClick:()=>g(!1),children:"Cancel"}),u.jsx(Ve,{variant:"danger",actionName:"Confirm Delete Sample User Budget",onClick:C,children:" Delete Sample User Data"})]})]})]})}function Hz({onClearCache:t,disabled:e}){const[n,r]=O.useState(!1),s=()=>{r(!0)},o=()=>{r(!1),t()};return u.jsxs(u.Fragment,{children:[u.jsx(kz,{name:"Clear All Caches",description:"Clear cached data and reload to fetch fresh data from Firestore",onAction:s,actionText:"Clear & Reload",actionIcon:"",disabled:e,isDestructive:!0}),u.jsxs(Hi,{isOpen:n,onClose:()=>r(!1),title:"Clear Caches & Reload?",children:[u.jsx("p",{style:{margin:"0 0 1rem 0",opacity:.8},children:"This will clear all cached data from localStorage and reload the page. The app will fetch fresh data from Firestore for everything."}),u.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[u.jsx(Ve,{variant:"secondary",actionName:"Cancel Clear Caches",onClick:()=>r(!1),children:"Cancel"}),u.jsx(Ve,{variant:"danger",actionName:"Confirm Clear Caches & Reload",onClick:o,children:"Clear & Reload"})]})]})]})}function qz({disabled:t,onDownloadBackup:e,isDownloadingBackup:n,budgetDownloadUpload:r,deleteAllMonths:s,deleteSampleUserBudget:o,onClearCache:l}){const d=r.isDownloading||r.isUploading||s.isDeleting||o.isDeleting,h=Pi({migrationName:"Delete All Months",isDestructive:!0,onDownloadBackup:e}),m=Pi({migrationName:"Delete Sample User Budget",isDestructive:!0,onDownloadBackup:e}),p=Pi({migrationName:"Upload Budget",isDestructive:!0,onDownloadBackup:e});return u.jsxs(u.Fragment,{children:[u.jsxs(Q0,{title:"Utilities",icon:"",description:"Administrative utilities for data management, downloads, and cache control.",type:"utility",isAnyRunning:d,children:[u.jsx(Fz,{isDownloading:r.isDownloading,downloadProgress:r.downloadProgress,downloadError:r.downloadError,onDownload:r.downloadBudget,isScanning:r.isScanning,isUploading:r.isUploading,uploadStatus:r.uploadStatus,uploadProgress:r.uploadProgress,uploadError:r.uploadError,uploadResult:r.uploadResult,onScan:r.scanZipFile,onUpload:async g=>{p.promptBeforeAction(()=>{r.uploadBudget(g).catch(v=>console.error("Upload failed:",v))})},disabled:t}),u.jsxs("div",{style:{marginTop:"0.75rem",paddingTop:"0.75rem",borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},children:[u.jsx("div",{style:{fontSize:"0.75rem",opacity:.5,textTransform:"uppercase",letterSpacing:"0.05em",marginBottom:"0.5rem",paddingLeft:"0.5rem"},children:"Destructive Actions"}),u.jsx(Vz,{status:s.status,hasData:s.hasData,monthsCount:s.monthsCount,budgetCount:s.budgetCount,isChecking:s.isScanning,isDeleting:s.isDeleting,deleteResult:s.deleteResult,deleteProgress:s.deleteProgress,onCheck:s.scanStatus,onDelete:()=>h.promptBeforeAction(s.deleteAllMonths),disabled:t}),u.jsx($z,{status:o.status,hasData:o.hasData,totalBudgets:o.totalBudgets,totalMonths:o.totalMonths,isChecking:o.isScanning,isDeleting:o.isDeleting,deleteResult:o.deleteResult,deleteProgress:o.deleteProgress,onCheck:o.scanStatus,onDelete:()=>m.promptBeforeAction(o.deleteSampleUserBudget),disabled:t}),u.jsx(Hz,{onClearCache:l,disabled:t})]})]}),u.jsx(Ni,{...h.promptProps,isDownloading:n}),u.jsx(Ni,{...m.promptProps,isDownloading:n}),u.jsx(Ni,{...p.promptProps,isDownloading:n})]})}function K0({message:t="Loading...",spinnerColor:e=ce.primary,children:n,spinnerSize:r=4}){return u.jsxs("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(15, 15, 20, 0.95)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",zIndex:9999,gap:"1.5rem",backdropFilter:"blur(4px)"},children:[u.jsx("div",{style:{width:`${r}rem`,height:`${r}rem`,border:"3px solid rgba(255, 255, 255, 0.15)",borderTopColor:e,borderRadius:"50%",animation:"loadingOverlaySpin 0.8s linear infinite"}}),u.jsx("p",{style:{color:"rgba(255, 255, 255, 0.95)",fontSize:"1.2rem",fontWeight:600,letterSpacing:"0.02em",margin:0},children:t}),n,u.jsx("style",{children:`
        @keyframes loadingOverlaySpin {
          to { transform: rotate(360deg); }
        }
      `})]})}function dA({percent:t,gradient:e="linear-gradient(90deg, #646cff, #8b5cf6)",width:n=300}){return u.jsx("div",{style:{width:`${n}px`,height:"8px",background:"rgba(255, 255, 255, 0.1)",borderRadius:"4px",overflow:"hidden"},children:u.jsx("div",{style:{width:`${t}%`,height:"100%",background:e,borderRadius:"4px",transition:"width 0.3s ease-out"}})})}function Lf({value:t,label:e,color:n="#646cff"}){return u.jsxs("div",{style:{textAlign:"center"},children:[u.jsx("p",{style:{color:n,fontSize:"1.5rem",fontWeight:700,margin:0},children:t}),u.jsx("p",{style:{color:"rgba(255, 255, 255, 0.6)",fontSize:"0.8rem",margin:"0.25rem 0 0",textTransform:"uppercase",letterSpacing:"0.05em"},children:e})]})}function hA({percent:t}){return u.jsxs("p",{style:{color:"rgba(255, 255, 255, 0.5)",fontSize:"0.9rem",margin:0},children:[t,"% complete"]})}function Gz(){return u.jsxs("div",{style:Pf,children:[u.jsx("nav",{style:{marginBottom:"1rem",display:"flex",alignItems:"center"},children:u.jsx(Cn,{to:"/",style:{display:"flex",alignItems:"center"},title:"Tarron Lane Home",children:u.jsx("img",{src:"/t-icon.svg",alt:"Tarron Lane Home",style:{width:"2rem",height:"2rem"}})})}),u.jsx("h1",{children:"Tarron Lane Homepage"}),u.jsx("nav",{children:u.jsxs("ul",{children:[u.jsx("li",{children:u.jsx(Cn,{to:"/sql-test",children:"SQL Test"})}),u.jsx("li",{children:u.jsx(Cn,{to:"/budget",children:"Budget"})}),u.jsx("li",{children:u.jsx(Cn,{to:"/account",children:"Account"})})]})})]})}function Wz(){const t=O.useContext(hd),e=Da(),[n,r]=O.useState(!1),s=Vn(),o=Ku(),l=s.state?.from||"/";O.useEffect(()=>{t.is_logged_in&&l!=="/"&&o(l,{replace:!0})},[t.is_logged_in,l,o]);function d(){r(!0),e.logout_firebase_user().then(function(){Ze.clear(),localStorage.removeItem("BUDGET_APP_QUERY_CACHE"),window.location.href="/"})}return u.jsxs("div",{style:Pf,children:[u.jsxs("nav",{style:{marginBottom:"1rem",display:"grid",gridTemplateColumns:"1fr auto 1fr",alignItems:"center"},children:[u.jsx("div",{style:{display:"flex",alignItems:"center"},children:u.jsx(Cn,{to:"/",style:{opacity:.6,fontSize:"1.5rem",textDecoration:"none",padding:"0.25rem 0.5rem"},title:"Back to Home",children:""})}),u.jsxs(Cn,{to:"/",style:{display:"flex",alignItems:"center",gap:"0.5rem",textDecoration:"none",color:"inherit"},title:"Tarron Lane Home",children:[u.jsx("img",{src:"/t-icon.svg",alt:"Tarron Lane",style:{width:"1.5rem",height:"1.5rem"}}),u.jsx("span",{style:{fontWeight:600,fontSize:"1.1rem"},children:"Account"})]}),u.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:u.jsx(lA,{items:[{label:"Budget",icon:"",to:"/budget"},{label:"Account",icon:"",to:"/account"}]})})]}),u.jsx("h1",{children:"Account"}),t.is_logged_in?n?u.jsx("p",{children:"Logging Out..."}):u.jsxs(u.Fragment,{children:[u.jsxs("p",{children:["You are logged in as ",t.username]}),u.jsx("button",{onClick:d,style:{marginTop:"1rem"},children:"Logout"})]}):u.jsx(Qz,{})]})}function Qz(){const t=Da(),[e,n]=O.useState(""),[r,s]=O.useState(""),[o,l]=O.useState(!1),[d,h]=O.useState(!1),[m,p]=O.useState("");function g(S){n(S.target.value)}function v(S){s(S.target.value)}function _(S){S.preventDefault(),h(!0),p(""),Ze.clear(),localStorage.removeItem("BUDGET_APP_QUERY_CACHE"),t.login_firebase_user(e,r).then(function(){}).catch(function(){p("Incorrect login credentials")}).finally(function(){h(!1)})}return u.jsxs("form",{onSubmit:_,children:[u.jsxs("div",{children:[u.jsx("label",{htmlFor:"username",children:"Email: "}),u.jsx("input",{id:"username",type:"email",value:e,onChange:g})]}),u.jsxs("div",{children:[u.jsx("label",{htmlFor:"password",children:"Password: "}),u.jsxs("div",{style:{display:"inline-flex",alignItems:"center",position:"relative"},children:[u.jsx("input",{id:"password",type:o?"text":"password",value:r,onChange:v,style:{paddingRight:"2rem"}}),u.jsx("button",{type:"button",onClick:()=>l(!o),style:{position:"absolute",right:"0.25rem",background:"none",border:"none",cursor:"pointer",padding:"0.25rem",opacity:.6,fontSize:"1rem"},title:o?"Hide password":"Show password",children:o?"":""})]})]}),d?u.jsx("p",{children:"Logging in..."}):u.jsx("button",{children:"Login"}),m&&u.jsx("p",{style:{color:"red"},children:m})]})}const Kz={categories:"balances",accounts:"balances",income:"transactions",spend:"transactions",transfers:"transactions",adjustments:"transactions"},Yz={balances:"categories",transactions:"income"};function Xz({activeTab:t,setActiveTab:e,allocationsFinalized:n}){const r=Kz[t],s=O.useMemo(()=>[{id:"balances",label:"Balances"},{id:"transactions",label:"Transactions"}],[]),o=O.useMemo(()=>[{id:"categories",label:"Categories",checkmark:n},{id:"accounts",label:"Accounts"}],[n]),l=O.useMemo(()=>[{id:"income",label:"Income"},{id:"spend",label:"Spend"},{id:"transfers",label:"Transfers"},{id:"adjustments",label:"Adjustments"}],[]),d=m=>{e(Yz[m])},h=r==="balances"?o:l;return u.jsxs("div",{children:[u.jsx(Bf,{mode:"button",tabs:s,activeTab:r,onTabChange:d,variant:"segmented"}),u.jsx(Bf,{mode:"button",tabs:h,activeTab:t,onTabChange:m=>e(m),variant:"secondary"})]})}function Zz({isOpen:t,onClose:e,onProceed:n,results:r}){const[s,o]=O.useState("from_current"),l=!r||r.status==="confirming",d=r&&!["confirming","done","error"].includes(r.status),h=l||r?.status==="done"||r?.status==="error";function m(){h&&(e(),o("from_current"))}function p(){n(s)}return u.jsx(Hi,{isOpen:t,onClose:m,title:"Recalculate Balances",width:"540px",children:u.jsxs("div",{style:{padding:"0.5rem 0"},children:[l&&u.jsxs(u.Fragment,{children:[u.jsx("p",{style:{margin:"0 0 1rem 0",fontSize:"0.95rem",lineHeight:1.5},children:"Choose what to recalculate:"}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem",marginBottom:"1.5rem"},children:[u.jsx($S,{selected:s==="from_current",onClick:()=>o("from_current"),title:"From current month forward",description:"Recalculate from this month onward. Use for quick fixes."}),u.jsx($S,{selected:s==="all_months",onClick:()=>o("all_months"),title:"All months from beginning",description:"Recalculate entire history. Use after migrations or data repairs.",recommended:!0})]}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem",marginBottom:"1.5rem"},children:[u.jsx(Sl,{status:"waiting",label:"Find all months to process"}),u.jsx(Sl,{status:"waiting",label:"Process months"}),u.jsx(Sl,{status:"waiting",label:"Update budget totals"})]}),u.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[u.jsx(Ve,{variant:"secondary",actionName:"Cancel Recalculation",onClick:e,children:"Cancel"}),u.jsx(Ve,{actionName:"Proceed with Recalculation",onClick:p,children:"Proceed"})]})]}),!l&&u.jsxs(u.Fragment,{children:[u.jsx("p",{style:{margin:"0 0 1.5rem 0",fontSize:"0.9rem",opacity:.7},children:"Recalculating category balances and account balances..."}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:[u.jsx(Sl,{status:r?.status==="pending"?"waiting":"complete",label:"Find all months to process",detail:r&&r.status!=="pending"?`Found ${r.monthsFound||0} month${r.monthsFound!==1?"s":""}`:void 0}),u.jsx(Sl,{status:VS(r?.status,["pending","finding_months"],"processing_months"),label:"Process months",detail:r?.status==="processing_months"?`Processing: ${r.currentMonthLabel} (${(r.currentMonthIndex||0)+1}/${r.monthsFound||0})`:r?.monthsProcessed!==void 0?`Processed ${r.monthsProcessed} month${r.monthsProcessed!==1?"s":""}`:void 0}),u.jsx(Sl,{status:r?.status==="error"?"error":VS(r?.status,["pending","finding_months","processing_months"],"updating_budget"),label:"Update budget totals",detail:r?.status==="error"?r.error:void 0,isError:r?.status==="error"})]}),r?.status==="done"&&u.jsxs("div",{style:{marginTop:"1.5rem",padding:"1rem",background:`color-mix(in srgb, ${ce.success} 10%, transparent)`,border:`1px solid ${ce.success}`,borderRadius:"8px",textAlign:"center"},children:[u.jsx("p",{style:{margin:0,fontWeight:600,color:ce.success},children:" Recalculation complete!"}),u.jsxs("p",{style:{margin:"0.5rem 0 0 0",fontSize:"0.9rem",opacity:.8},children:[r.monthsProcessed," month",r.monthsProcessed!==1?"s":""," processed",u.jsx("br",{}),"Total Income: ",Je(r.totalIncomeRecalculated||0),u.jsx("br",{}),"Total Expenses: ",Je(r.totalExpensesRecalculated||0)]})]}),(r?.status==="done"||r?.status==="error")&&u.jsx("div",{style:{marginTop:"1.5rem",display:"flex",justifyContent:"center"},children:u.jsx(Ve,{actionName:"Close Recalculation Modal",onClick:e,children:"Done"})}),d&&u.jsx("p",{style:{marginTop:"1.5rem",textAlign:"center",fontSize:"0.85rem",opacity:.6},children:"Please wait, do not close this window..."})]})]})})}function VS(t,e,n){return!t||e.includes(t)?t===n?"active":"waiting":t===n?"active":"complete"}function Sl({status:t,label:e,detail:n,isError:r}){const s=t==="waiting"?"":t==="active"?"":t==="error"?"":"";return u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[u.jsx("span",{style:{fontSize:"1.1rem",width:"1.5rem",textAlign:"center"},children:s}),u.jsxs("div",{style:{flex:1},children:[u.jsx("p",{style:{margin:0,fontWeight:500},children:e}),n&&u.jsx("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.85rem",opacity:r?1:.6,color:r?ce.error:"inherit"},children:n})]})]})}function $S({selected:t,onClick:e,title:n,description:r,recommended:s}){return u.jsxs("button",{type:"button",onClick:e,style:{display:"flex",alignItems:"flex-start",gap:"0.75rem",padding:"0.75rem 1rem",background:t?"color-mix(in srgb, #646cff 15%, transparent)":"color-mix(in srgb, currentColor 5%, transparent)",border:t?"2px solid #646cff":"2px solid transparent",borderRadius:"8px",cursor:"pointer",textAlign:"left",width:"100%",transition:"all 0.15s ease"},children:[u.jsx("span",{style:{width:"20px",height:"20px",borderRadius:"50%",border:t?"6px solid #646cff":"2px solid rgba(128,128,128,0.5)",flexShrink:0,marginTop:"2px",background:t?"white":"transparent"}}),u.jsxs("div",{style:{flex:1},children:[u.jsxs("p",{style:{margin:0,fontWeight:600,fontSize:"0.95rem"},children:[n,s&&u.jsx("span",{style:{marginLeft:"0.5rem",padding:"0.15rem 0.5rem",background:ce.success,color:"white",borderRadius:"4px",fontSize:"0.7rem",fontWeight:500,verticalAlign:"middle"},children:"RECOMMENDED"})]}),u.jsx("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.85rem",opacity:.7},children:r})]})]})}function Qg(t){return t==="no_category"||t==="NO_CATEGORY"}function Jz(t,e){const n={};for(const r of t)Qg(r.from_category_id)||(n[r.from_category_id]=(n[r.from_category_id]||0)-r.amount),Qg(r.to_category_id)||(n[r.to_category_id]=(n[r.to_category_id]||0)+r.amount);for(const r of e)Qg(r.category_id)||(n[r.category_id]=(n[r.category_id]||0)+r.amount);for(const r of Object.keys(n))n[r]=Oe(n[r]);return n}async function eB(t,e,n,r,s,o,l){const d=li(t,e.year,e.month),{exists:h,data:m}=await bt("months",d,"recalculate: reading full month data");if(!h||!m)return null;const p=m.income||[],g=m.expenses||[],v=m.transfers||[],_=m.adjustments||[],S=m.are_allocations_finalized||!1,x=Oe(p.reduce((D,N)=>D+N.amount,0)),E=Oe(g.reduce((D,N)=>D+N.amount,0)),C={};if(m.category_balances)for(const D of m.category_balances)C[D.category_id]={allocated:D.allocated??0};const T=Jz(v,_),A=n.map(D=>{const N=Oe(s[D]??0);let F=0;S&&C[D]&&(F=Oe(C[D].allocated));let H=0;g.length>0&&(H=Oe(g.filter(W=>W.category_id===D).reduce((W,q)=>W+q.amount,0)));const j=T[D]??0,M=Oe(v.filter(W=>W.from_category_id===D||W.to_category_id===D).reduce((W,q)=>q.from_category_id===D?W-q.amount:q.to_category_id===D?W+q.amount:W,0)),R=Oe(_.filter(W=>W.category_id===D).reduce((W,q)=>W+q.amount,0)),K=Oe(N+F+H+j);return{category_id:D,start_balance:N,allocated:F,spent:H,transfers:M,adjustments:R,end_balance:K}});A.forEach(D=>{s[D.category_id]=D.end_balance});const B=Object.keys(r),U={},G=B.map(D=>{const N=Oe(p.filter(q=>q.account_id===D).reduce((q,J)=>q+J.amount,0)),F=Oe(g.filter(q=>q.account_id===D).reduce((q,J)=>q+J.amount,0)),H=Oe(v.filter(q=>q.from_account_id===D).reduce((q,J)=>q-J.amount,0)),j=Oe(v.filter(q=>q.to_account_id===D).reduce((q,J)=>q+J.amount,0)),M=Oe(_.filter(q=>q.account_id===D).reduce((q,J)=>q+J.amount,0)),R=Oe(N+F+H+j+M);U[D]=R;const K=Oe(o[D]??0),W=Oe(H+j);return{account_id:D,start_balance:K,income:N,expenses:F,transfers:W,adjustments:M,net_change:R,end_balance:Oe(K+R)}});for(const D of G)o[D.account_id]=D.end_balance;return{updatedMonth:{budget_id:t,year_month_ordinal:Yt(e.year,e.month),year:e.year,month:e.month,income:p,total_income:x,previous_month_income:l,expenses:g,total_expenses:E,transfers:v,adjustments:_,account_balances:G,category_balances:A,are_allocations_finalized:S,created_at:m.created_at||new Date().toISOString(),updated_at:new Date().toISOString()},totalIncome:x,totalExpenses:E,accountNetChanges:U}}function Y0({isDisabled:t,onCloseMenu:e}){const{selectedBudgetId:n,currentYear:r,currentMonthNumber:s}=zt(),{categories:o,accounts:l}=An(),{updateAccounts:d}=IT(),{updateCategories:h}=DT(),[m,p]=O.useState(!1),[g,v]=O.useState(!1),[_,S]=O.useState(null);function x(){v(!0),S({status:"confirming"})}async function E(T){if(n){p(!0),S({status:"pending"});try{S({status:"finding_months"});let A;if(T==="all_months")A=(await Ht("months","recalculate: querying all months for full recalculation",[{field:"budget_id",op:"==",value:n}])).docs.map(M=>({year:M.data.year,month:M.data.month})).sort((M,R)=>M.year!==R.year?M.year-R.year:M.month-R.month);else{const j=new Date,M=r||j.getFullYear(),R=s||j.getMonth()+1,{year:K,month:W}=Of(M,R);A=await _6(n,K,W)}const B=Object.keys(o);S({status:"finding_months",monthsFound:A.length}),await new Promise(j=>setTimeout(j,100));const U={},G={};if(T==="from_current"){const j=new Date,M=r||j.getFullYear(),R=s||j.getMonth()+1,{year:K,month:W}=Of(M,R),q=li(n,K,W),{exists:J,data:Z}=await bt("months",q,"recalculate: reading previous month for starting balances");if(J&&Z?.category_balances)for(const re of Z.category_balances)U[re.category_id]=re.end_balance??0;if(J&&Z?.account_balances)for(const re of Z.account_balances)G[re.account_id]=re.end_balance??0}B.forEach(j=>{U[j]===void 0&&(U[j]=0)}),Object.keys(l).forEach(j=>{G[j]===void 0&&(G[j]=0)});let k=0,D=0,N=0;for(let j=0;j<A.length;j++){const M=A[j],R=`${Kl[M.month-1]} ${M.year}`;S({status:"processing_months",monthsFound:A.length,currentMonthIndex:j,currentMonthLabel:R});const K=await eB(n,M,B,l,U,G,N);K&&(k+=K.totalIncome,D+=K.totalExpenses,N=K.totalIncome,await dd({budgetId:n,month:K.updatedMonth,description:"recalculate all months"}),await new Promise(W=>setTimeout(W,50)))}const F={};Object.entries(l).forEach(([j,M])=>{F[j]={...M,balance:G[j]??0}}),await d.mutateAsync({budgetId:n,accounts:F}),S({status:"updating_budget",monthsFound:A.length,monthsProcessed:A.length,totalIncomeRecalculated:k,totalExpensesRecalculated:D});const H={};Object.entries(o).forEach(([j,M])=>{H[j]={...M,balance:U[j]??0}}),await h.mutateAsync({budgetId:n,categories:H});for(const j of A)Ze.invalidateQueries({queryKey:Pe.month(n,j.year,j.month)});S({status:"done",monthsFound:A.length,monthsProcessed:A.length,totalIncomeRecalculated:k,totalExpensesRecalculated:D})}catch(A){console.error("Recalculate error:",A),S({status:"error",error:A instanceof Error?A.message:"Failed to recalculate"})}finally{p(!1)}}}function C(){v(!1),S(null),e?.()}return u.jsxs(u.Fragment,{children:[u.jsxs("button",{onClick:x,disabled:t||m,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",border:"none",borderRadius:"8px",padding:"0.5rem",cursor:t||m?"not-allowed":"pointer",opacity:t||m?.5:1,fontSize:"1rem",display:"flex",alignItems:"center",justifyContent:"center"},title:"Recalculate balances from this month forward",children:[m?"":""," Recalculate"]}),u.jsx(Zz,{isOpen:g,onClose:C,onProceed:E,results:_})]})}function HS({direction:t,isDisabled:e,isLoading:n,disabledReason:r,onNavigate:s}){const[o,l]=O.useState(!1),d=n||e,h=t==="prev"?"":"",m=t==="prev"?"Previous month":"Next month",p=()=>{n||(e?(l(!0),setTimeout(()=>l(!1),2e3)):s())};return u.jsxs("div",{style:{position:"relative"},children:[u.jsx("button",{onClick:p,onMouseEnter:()=>e&&l(!0),onMouseLeave:()=>l(!1),style:{background:"color-mix(in srgb, currentColor 10%, transparent)",border:"none",borderRadius:"8px",padding:"0.75rem 1rem",cursor:d?"not-allowed":"pointer",fontSize:"1.25rem",opacity:d?.5:1,transition:"opacity 0.15s, background 0.15s"},title:e?void 0:m,children:h}),o&&e&&u.jsx("div",{style:{position:"absolute",top:"100%",...t==="prev"?{left:0}:{right:0},marginTop:"0.5rem",padding:"0.5rem 0.75rem",background:ce.warning,color:"#000",borderRadius:"6px",fontSize:"0.75rem",fontWeight:500,width:"max-content",maxWidth:"min(300px, 50vw)",textAlign:"center",zIndex:20,boxShadow:"0 2px 8px rgba(0,0,0,0.3)"},children:r})]})}function tB({pickerYear:t,pickerMonth:e,currentYear:n,currentMonthNumber:r,minOrdinal:s,maxOrdinal:o,minAllowed:l,maxAllowed:d,onYearChange:h,onMonthChange:m,onGo:p}){const g=t>l.year,v=t<d.year,_=Number(Yt(t,e)),S=_>=s&&_<=o;return u.jsxs("div",{style:{padding:"0.75rem",borderTop:"1px solid color-mix(in srgb, currentColor 15%, transparent)",marginTop:"0.25rem"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.5rem"},children:[u.jsx("button",{onClick:()=>h(t-1),disabled:!g,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",border:"none",borderRadius:"4px",padding:"0.25rem 0.5rem",cursor:g?"pointer":"not-allowed",fontSize:"0.8rem",opacity:g?1:.3},title:g?"Previous year":"Cannot go further back",children:""}),u.jsx("span",{style:{flex:1,textAlign:"center",fontSize:"0.9rem",fontWeight:500},children:t}),u.jsx("button",{onClick:()=>h(t+1),disabled:!v,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",border:"none",borderRadius:"4px",padding:"0.25rem 0.5rem",cursor:v?"pointer":"not-allowed",fontSize:"0.8rem",opacity:v?1:.3},title:v?"Next year":"Cannot go further ahead",children:""})]}),u.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"0.25rem",marginBottom:"0.5rem"},children:Kl.map((x,E)=>{const C=E+1,T=C===e,A=t===n&&C===r,B=Number(Yt(t,C)),U=B<s,G=B>o,k=U||G;let D=x;return U?D="Too far in the past":G&&(D="Too far in the future"),u.jsx("button",{onClick:()=>m(C),disabled:k,style:{background:T?ce.primary:"color-mix(in srgb, currentColor 8%, transparent)",border:A?`1px solid ${ce.primary}`:"1px solid transparent",borderRadius:"4px",padding:"0.35rem 0.25rem",cursor:k?"not-allowed":"pointer",fontSize:"0.7rem",color:T?"#fff":"inherit",opacity:k?.3:1,transition:"background 0.15s"},title:D,children:x.slice(0,3)},C)})}),u.jsxs("button",{onClick:p,disabled:!S,style:{width:"100%",background:S?ce.primary:"color-mix(in srgb, currentColor 20%, transparent)",border:"none",borderRadius:"6px",padding:"0.5rem",cursor:S?"pointer":"not-allowed",fontSize:"0.85rem",color:S?"#fff":"inherit",fontWeight:500,opacity:S?1:.5},children:["Go to ",Kl[e-1]," ",t]})]})}function nB({isOpen:t,onClose:e,year:n,month:r,isDeleting:s,onConfirm:o}){return u.jsxs(Hi,{isOpen:t,onClose:e,title:" Delete Month?",children:[u.jsx("div",{style:{background:"color-mix(in srgb, #ef4444 15%, transparent)",border:"1px solid color-mix(in srgb, #ef4444 40%, transparent)",borderRadius:"8px",padding:"1rem",marginBottom:"1rem"},children:u.jsxs("p",{style:{margin:0,color:"#fca5a5",fontWeight:500,fontSize:"0.95rem"},children:[" This will permanently delete ",Kl[r-1]," ",n,"!"]})}),u.jsx("p",{style:{margin:"0 0 0.75rem",opacity:.9},children:"This month document and all its data (income, expenses, allocations) will be permanently deleted."}),u.jsx("p",{style:{margin:"0 0 1rem",opacity:.8,fontSize:"0.9rem"},children:"After deletion, you will be navigated to the previous month."}),u.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[u.jsx(Ve,{variant:"secondary",actionName:"Cancel Delete Month",onClick:e,disabled:s,children:"Cancel"}),u.jsx(Ve,{variant:"danger",actionName:"Confirm Delete Month",onClick:o,disabled:s,children:s?"Deleting...":" Delete Month"})]})]})}function rB(){const t=new Date;let e=t.getFullYear(),n=t.getMonth()+1+Vu;for(;n>12;)n-=12,e+=1;return{year:e,month:n}}function iB(){const t=new Date;let e=t.getFullYear(),n=t.getMonth()+1-Mf;for(;n<1;)n+=12,e-=1;return{year:e,month:n}}function sB(t){return Object.keys(t).sort()[0]}function aB(t){const e=parseInt(t.slice(0,4),10),n=parseInt(t.slice(4,6),10);return{year:e,month:n}}function oB(t){const e=iB(),n=sB(t);if(!n)return e;const r=Yt(e.year,e.month);return n<r?aB(n):e}function qS(t,e){return e===1?{year:t-1,month:12}:{year:t,month:e-1}}function lB(t,e){return e===12?{year:t+1,month:1}:{year:t,month:e+1}}function cB({onPreviousMonth:t,onNextMonth:e}){const{isLoading:n}=nr(),{currentYear:r,currentMonthNumber:s,isAdmin:o,selectedBudgetId:l,setCurrentYear:d,setCurrentMonthNumber:h}=zt(),{budget:m,monthMap:p}=An(),{month:g}=As(l,r,s),v=qS(r,s),_=lB(r,s),S=oB(p),x=rB(),E=Number(Yt(S.year,S.month)),C=Number(Yt(x.year,x.month)),T=Number(Yt(v.year,v.month)),A=Number(Yt(_.year,_.month)),B=T<E,U=A>C,[G,k]=O.useState(!1),[D,N]=O.useState(!1),[F,H]=O.useState(r),[j,M]=O.useState(s),[R,K]=O.useState(!1),[W,q]=O.useState(!1),J=O.useRef(null),Z=(()=>{if(!p||Object.keys(p).length===0)return!1;const se=Yt(r,s),ae=Math.max(...Object.keys(p).map(Number));return Number(se)===ae})();async function re(){if(l){q(!0);try{const se=li(l,r,s);await Fu("months",se,`deleting month ${r}/${s}`),`${r}${s}`,Ze.removeQueries({queryKey:Pe.month(l,r,s)}),Ze.invalidateQueries({queryKey:Pe.budget(l)}),localStorage.removeItem("BUDGET_APP_QUERY_CACHE");const ae=qS(r,s);K(!1),k(!1),window.location.href=`/budget/${ae.year}/${ae.month}/categories`}catch(se){console.error("Failed to delete month:",se),alert(`Failed to delete month: ${se instanceof Error?se.message:"Unknown error"}`)}finally{q(!1)}}}O.useEffect(()=>{if(!G)return;function se(ae){J.current&&!J.current.contains(ae.target)&&(k(!1),N(!1))}return document.addEventListener("mousedown",se),()=>document.removeEventListener("mousedown",se)},[G]);function P(){D||(H(r),M(s)),N(!D)}function $(){d(F),h(j),N(!1),k(!1)}async function te(){if(!g||!m)return;const se=new Date,ye=`${se.toISOString().split("T")[0]}_month_${r}_${String(s).padStart(2,"0")}`,Ie=new xm,Ee=[{name:`${ye}_income.json`,data:g.income||[]},{name:`${ye}_expenses.json`,data:g.expenses||[]},{name:`${ye}_transfers.json`,data:g.transfers||[]},{name:`${ye}_adjustments.json`,data:g.adjustments||[]},{name:`${ye}_account_balances.json`,data:g.account_balances||[]},{name:`${ye}_category_balances.json`,data:g.category_balances||[]}],Ce={budget_id:m.id,budget_name:m.name,year_month_ordinal:g.year_month_ordinal,year:g.year,month:g.month,total_income:g.total_income,previous_month_income:g.previous_month_income,total_expenses:g.total_expenses,are_allocations_finalized:g.are_allocations_finalized,created_at:g.created_at,updated_at:g.updated_at,downloaded_at:se.toISOString()};Ee.push({name:`${ye}_metadata.json`,data:Ce});for(const Me of Ee)Ie.file(Me.name,JSON.stringify(Me.data,null,2));const pe=await Ie.generateAsync({type:"blob"}),Ue=URL.createObjectURL(pe),He=document.createElement("a");He.href=Ue,He.download=`${ye}.zip`,document.body.appendChild(He),He.click(),document.body.removeChild(He),URL.revokeObjectURL(Ue),k(!1)}return u.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"1rem",marginBottom:"1.5rem",padding:"1rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"12px"},children:[u.jsx(HS,{direction:"prev",isDisabled:B,isLoading:n,disabledReason:"Cannot create months more than 3 months into the past",onNavigate:t}),u.jsxs("div",{ref:J,style:{textAlign:"center",minWidth:"180px",position:"relative"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"flex-start",justifyContent:"center",gap:"0.25rem"},children:[u.jsxs("h2",{style:{margin:0,fontSize:"1.5rem"},children:[Kl[s-1]," ",r]}),u.jsx("button",{onClick:()=>k(!G),style:{background:"transparent",border:"none",cursor:"pointer",fontSize:"0.5rem",opacity:.4,padding:"0.15rem",borderRadius:"4px",transition:"opacity 0.15s, transform 0.15s",transform:G?"rotate(180deg)":"rotate(0deg)",marginTop:"0.25rem"},title:"Month options",children:""})]}),n&&u.jsxs(u.Fragment,{children:[u.jsx("style",{children:"@keyframes spin { to { transform: rotate(360deg); } }"}),u.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0.4rem",marginTop:"0.35rem"},children:[u.jsx("span",{style:{display:"inline-block",width:"14px",height:"14px",border:"2px solid color-mix(in srgb, currentColor 20%, transparent)",borderTopColor:ce.primary,borderRadius:"50%",animation:"spin 0.8s linear infinite"}}),u.jsx("span",{style:{fontSize:"0.8rem",opacity:.6},children:"Loading..."})]})]}),G&&u.jsxs("div",{style:{position:"absolute",top:"100%",left:"50%",transform:"translateX(-50%)",marginTop:"0.5rem",background:"var(--background, #242424)",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",borderRadius:"8px",padding:"0.25rem",zIndex:100,minWidth:"160px",boxShadow:"0 4px 12px rgba(0,0,0,0.3)"},children:[u.jsx(Y0,{isDisabled:n,onCloseMenu:()=>k(!1)}),u.jsx("button",{onClick:P,style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%",background:"transparent",border:"none",borderRadius:"6px",padding:"0.5rem 0.75rem",cursor:"pointer",fontSize:"0.85rem",color:"inherit",textAlign:"left",transition:"background 0.15s"},title:"Jump to a specific month",children:" Go to Month"}),D&&u.jsx(tB,{pickerYear:F,pickerMonth:j,currentYear:r,currentMonthNumber:s,minOrdinal:E,maxOrdinal:C,minAllowed:S,maxAllowed:x,onYearChange:H,onMonthChange:M,onGo:$}),o&&g&&u.jsx("button",{onClick:()=>{te()},style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%",background:"transparent",border:"none",borderRadius:"6px",padding:"0.5rem 0.75rem",cursor:"pointer",fontSize:"0.85rem",color:"inherit",textAlign:"left",transition:"background 0.15s"},title:"Download month document as JSON (for debugging)",children:" Download JSON"}),o&&g&&Z&&u.jsx("button",{onClick:()=>K(!0),style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%",background:"transparent",border:"none",borderRadius:"6px",padding:"0.5rem 0.75rem",cursor:"pointer",fontSize:"0.85rem",color:"#ef4444",textAlign:"left",transition:"background 0.15s"},title:"Delete this month (last month only)",children:" Delete Month"})]})]}),u.jsx(HS,{direction:"next",isDisabled:U,isLoading:n,disabledReason:"Cannot create months more than 3 months into the future",onNavigate:e}),u.jsx(nB,{isOpen:R,onClose:()=>K(!1),year:r,month:s,isDeleting:W,onConfirm:re})]})}const X0={cursor:"pointer",fontSize:"0.9rem",padding:"0.35rem 0.5rem",borderRadius:"4px"},uB={...X0,background:ce.primary,border:"none",color:"white"},dB={...X0,background:"transparent",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)"},hB={...X0,background:"transparent",border:`1px solid ${ce.errorBorder}`,color:ce.error},GS=t=>({display:"flex",alignItems:"center",justifyContent:"center",width:"2.25rem",height:"100%",minHeight:"2.25rem",background:t?`color-mix(in srgb, ${ce.error} 15%, transparent)`:`color-mix(in srgb, ${ce.success} 15%, transparent)`,border:`1px solid ${t?ce.errorBorder:"rgba(74, 222, 128, 0.4)"}`,borderRadius:"4px 0 0 4px",cursor:"pointer",fontSize:"1rem",fontWeight:600,color:t?ce.error:ce.success,transition:"all 0.15s ease",flexShrink:0});function Z0({accounts:t,accountGroups:e,categories:n,categoryGroups:r,payees:s,initialData:o,defaultAccountId:l,defaultDate:d,config:h,onSubmit:m,onCancel:p,onDelete:g,extraContent:v}){const{isWide:_}=RT(),{showCategory:S=!1,showCleared:x=!1,showSignToggle:E=!1,accountLabel:C="Account",payeePlaceholder:T="Payee name",descriptionPlaceholder:A="Optional note",submitLabel:B}=h,U=new Date().toISOString().split("T")[0],[G,k]=O.useState(o?.date||d||U),[D,N]=O.useState(o?.payee||""),[F,H]=O.useState(o?.categoryId||(h.showNoCategoryOption?Qt:"")),[j,M]=O.useState(o?.accountId||l||(h.showNoAccountOption?Vt:t[0]?t[0][0]:"")),R=o?.amount!==void 0?Math.abs(o.amount):void 0,[K,W]=O.useState(R?.toString()||""),[q,J]=O.useState(o?.description||""),[Z,re]=O.useState(o?.cleared||!1),[P,$]=O.useState(()=>E?o?.amount!==void 0?o.amount<0:!1:!0),[te,se]=O.useState(!1),ae={},ye=[];t.forEach(([xe,oe])=>{oe.account_group_id?(ae[oe.account_group_id]||(ae[oe.account_group_id]=[]),ae[oe.account_group_id].push([xe,oe])):ye.push([xe,oe])});function Ie(xe){xe.preventDefault();const oe=parseFloat(K);if(isNaN(oe)||oe<=0||S&&!F||!j||!G)return;if(F===Qt&&j===Vt){se(!0);return}se(!1);const ke=E&&P?-oe:oe;m({date:G,payee:D.trim()||void 0,categoryId:S?F:void 0,accountId:j,amount:ke,description:q.trim()||void 0,cleared:x?Z:void 0})}!(F===Qt&&j===Vt)&&te&&se(!1);const Ue=h.showNoAccountOption?u.jsx(sA,{id:"txn-account",value:j,onChange:M,accounts:t,accountGroups:e,placeholder:ja,required:!0,showNoAccountOption:!0}):u.jsxs(Hu,{id:"txn-account",value:j,onChange:xe=>M(xe.target.value),required:!0,style:{fontSize:"0.85rem",padding:"0.5rem"},children:[Object.entries(e).map(([xe,oe])=>{const Ae=ae[xe];return Ae?.length?u.jsx("optgroup",{label:oe.name,children:Ae.map(([Ne,ke])=>u.jsx("option",{value:Ne,children:ke.nickname},Ne))},xe):null}),ye.length>0&&u.jsx("optgroup",{label:"Other",children:ye.map(([xe,oe])=>u.jsx("option",{value:xe,children:oe.nickname},xe))})]}),He=S&&n&&r?u.jsx(Mt,{label:"Category",htmlFor:"txn-category",children:u.jsx(iA,{id:"txn-category",value:F,onChange:H,categories:n,categoryGroups:r,placeholder:h.showNoCategoryOption?To:"Search...",required:!0,showNoCategoryOption:h.showNoCategoryOption})}):null,Me=x?u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.25rem",paddingBottom:"0.35rem"},children:[u.jsx("label",{htmlFor:"txn-cleared",style:{fontSize:"0.75rem",opacity:.7,fontWeight:500},children:"Clr"}),u.jsx(Ur,{id:"txn-cleared",checked:Z,onChange:xe=>re(xe.target.checked)})]}):null,L=u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.25rem",paddingBottom:"0.1rem"},children:[u.jsx("span",{style:{fontSize:"0.75rem",opacity:.7,fontWeight:500},children:""}),u.jsxs("div",{style:{display:"flex",gap:"0.25rem"},children:[u.jsx("button",{type:"submit",title:B,style:uB,children:""}),u.jsx("button",{type:"button",onClick:()=>{p()},title:"Cancel",style:dB,children:""}),g&&u.jsx("button",{type:"button",onClick:()=>{g()},title:"Delete",style:hB,children:""})]})]}),be=te?u.jsx("div",{style:{background:`color-mix(in srgb, ${ce.error} 15%, transparent)`,border:`1px solid ${ce.errorBorder}`,borderRadius:"6px",padding:"0.5rem 0.75rem",fontSize:"0.85rem",color:ce.error},children:'Cannot select both "No Category" and "No Account"  at least one must be a real category or account.'}):null,me=u.jsxs(Na,{children:[u.jsx(Ve,{type:"submit",actionName:B,children:B}),u.jsx(Ve,{type:"button",variant:"secondary",actionName:"Cancel Transaction Form",onClick:p,children:"Cancel"}),g&&u.jsx(Ve,{type:"button",variant:"danger",actionName:"Delete Transaction",onClick:g,children:" Delete"})]}),ee=S&&n&&r,X={fontSize:"0.85rem",padding:"0.5rem"};if(!_)return u.jsxs(Es,{actionName:B,onSubmit:Ie,children:[u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:[u.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[u.jsx(Mt,{label:"Date",htmlFor:"txn-date",children:u.jsx(zf,{id:"txn-date",value:G,onChange:xe=>k(xe.target.value),required:!0,autoFocus:!0})}),u.jsx(Mt,{label:E?P?"Amount (Expense)":"Amount (Refund)":"Amount",htmlFor:"txn-amount",children:E?u.jsxs("div",{className:"currency-with-sign",style:{display:"flex",alignItems:"stretch"},children:[u.jsx("button",{type:"button",onClick:()=>$(!P),style:GS(P),title:P?"Click to make this a refund (+)":"Click to make this an expense (-)",children:P?"":"+"}),u.jsx("div",{style:{flex:1},children:u.jsx(yo,{id:"txn-amount",value:K,onChange:W,placeholder:"$0.00",required:!0,style:{borderTopLeftRadius:0,borderBottomLeftRadius:0,borderLeft:"none",color:P?ce.error:ce.success}})})]}):u.jsx(yo,{id:"txn-amount",value:K,onChange:W,placeholder:"$0.00",required:!0})})]}),u.jsx(Mt,{label:"Payee",htmlFor:"txn-payee",children:u.jsx(FS,{id:"txn-payee",value:D,onChange:N,payees:s,placeholder:T})}),He,u.jsx(Mt,{label:C,htmlFor:"txn-account",children:Ue}),u.jsx(Mt,{label:"Description (optional)",htmlFor:"txn-description",children:u.jsx(Cs,{id:"txn-description",value:q,onChange:xe=>J(xe.target.value),placeholder:A})}),x&&u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx(Ur,{id:"txn-cleared-stacked",checked:Z,onChange:xe=>re(xe.target.checked)}),u.jsx("label",{htmlFor:"txn-cleared-stacked",style:{fontSize:"0.9rem",cursor:"pointer"},children:"Cleared (appeared in bank account)"})]}),be,v]}),me]});const ie=E?"8.25rem":"6rem",we=ee?x?`6rem minmax(8rem, 1fr) minmax(8rem, 1fr) minmax(8rem, 1fr) ${ie} minmax(10rem, 2fr) auto auto`:`6rem minmax(8rem, 1fr) minmax(8rem, 1fr) minmax(8rem, 1fr) ${ie} minmax(10rem, 2fr) auto`:x?`6rem minmax(10rem, 1fr) minmax(10rem, 1fr) ${ie} minmax(12rem, 2fr) auto auto`:`6rem minmax(10rem, 1fr) minmax(10rem, 1fr) ${ie} minmax(12rem, 2fr) auto`;return u.jsxs(Es,{actionName:B,onSubmit:Ie,children:[u.jsxs("div",{style:{display:"grid",gridTemplateColumns:we,gap:"1rem",alignItems:"end"},children:[u.jsx(Mt,{label:"Date",htmlFor:"txn-date",children:u.jsx(zf,{id:"txn-date",value:G,onChange:xe=>k(xe.target.value),required:!0,style:X,autoFocus:!0})}),u.jsx(Mt,{label:"Payee",htmlFor:"txn-payee",children:u.jsx(FS,{id:"txn-payee",value:D,onChange:N,payees:s,placeholder:T})}),He,u.jsx(Mt,{label:C,htmlFor:"txn-account",children:Ue}),u.jsx(Mt,{label:E?P?"Amount ()":"Amount (+)":"Amount",htmlFor:"txn-amount",children:E?u.jsxs("div",{className:"currency-with-sign",style:{display:"flex",alignItems:"stretch"},children:[u.jsx("button",{type:"button",onClick:()=>$(!P),style:GS(P),title:P?"Click to make this a refund (+)":"Click to make this an expense (-)",children:P?"":"+"}),u.jsx("div",{style:{flex:1},children:u.jsx(yo,{id:"txn-amount",value:K,onChange:W,placeholder:"$0.00",required:!0,style:{borderTopLeftRadius:0,borderBottomLeftRadius:0,borderLeft:"none",color:P?ce.error:ce.success}})})]}):u.jsx(yo,{id:"txn-amount",value:K,onChange:W,placeholder:"$0.00",required:!0})}),u.jsx(Mt,{label:"Description",htmlFor:"txn-description",children:u.jsx(Cs,{id:"txn-description",value:q,onChange:xe=>J(xe.target.value),placeholder:A,style:X})}),Me,L]}),be,v]})}function WS({accounts:t,accountGroups:e,payees:n,initialData:r,defaultAccountId:s,defaultDate:o,onSubmit:l,onCancel:d,onDelete:h,submitLabel:m}){function p(g){l(g.amount,g.accountId,g.date,g.payee,g.description)}return u.jsx(Z0,{accounts:t,accountGroups:e,payees:n,initialData:r?{date:r.date,payee:r.payee,accountId:r.account_id,amount:r.amount,description:r.description}:void 0,defaultAccountId:s,defaultDate:o,config:{showCategory:!1,showCleared:!1,accountLabel:"Deposit To",payeePlaceholder:"e.g., Employer, Client name",descriptionPlaceholder:"e.g., January paycheck",submitLabel:m},onSubmit:p,onCancel:d,onDelete:h})}function fB({income:t,accountName:e,accountGroupName:n,onEdit:r,onDelete:s,isMobile:o,isEvenRow:l}){const d=t.date?new Date(t.date+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"}):"",h=n?`${n} / ${e}`:e,m=l?"transparent":"rgba(255,255,255,0.04)";if(o)return u.jsxs("div",{onClick:r,style:{gridColumn:"1 / -1",display:"grid",gridTemplateColumns:"1fr auto",gap:"0.5rem",padding:"0.75rem 1rem",background:m,cursor:"pointer",transition:"background 0.15s"},children:[u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{style:{fontSize:"0.75rem",opacity:.5,fontFamily:"monospace",minWidth:"3rem"},children:d}),u.jsx("span",{style:{fontWeight:500,fontSize:"0.9rem"},children:t.payee||""})]}),u.jsxs("span",{style:{fontSize:"0.75rem",opacity:.6},children:[" ",h]})]}),u.jsx("div",{style:{display:"flex",alignItems:"center"},children:u.jsxs("span",{style:{fontWeight:600,color:ce.success,fontFamily:"monospace"},children:["+",Je(t.amount)]})})]});const p={padding:"0.6rem 0.5rem",background:m,display:"flex",alignItems:"center",fontSize:"0.9rem"};return u.jsxs("div",{style:{display:"contents"},children:[u.jsx("div",{style:{...p,fontSize:"0.85rem",fontFamily:"monospace"},children:u.jsx("span",{style:{opacity:.6},children:d})}),u.jsx("div",{style:{...p,fontWeight:500,overflow:"hidden"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.payee||""})}),u.jsx("div",{style:{...p,overflow:"hidden"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.85rem",opacity:.7},children:h})}),u.jsxs("div",{style:{...p,justifyContent:"flex-end",fontWeight:600,color:ce.success,fontFamily:"monospace"},children:["+",Je(t.amount)]}),u.jsx("div",{style:{...p,paddingLeft:"0.5rem",overflow:"hidden"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.8rem",opacity:.6},children:t.description||""})}),u.jsxs("div",{style:{...p,justifyContent:"flex-end",gap:"0.25rem"},children:[u.jsx("button",{onClick:r,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:g=>g.currentTarget.style.opacity="1",onMouseLeave:g=>g.currentTarget.style.opacity="0.5",title:"Edit",children:""}),u.jsx("button",{onClick:s,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:g=>g.currentTarget.style.opacity="1",onMouseLeave:g=>g.currentTarget.style.opacity="0.5",title:"Delete",children:""})]})]})}const El={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderTop:"1px solid rgba(255,255,255,0.1)"};function mB(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n,setCurrentYear:r,setCurrentMonthNumber:s}=zt(),{accounts:o,accountGroups:l}=An(),{month:d,isLoading:h}=As(t,e,n),{addIncome:m}=o3(),{updateIncome:p}=c3(),{deleteIncome:g}=u3(),v=qi(),[_,S]=O.useState(null),[x,E]=O.useState(!1),[C,T]=O.useState(null),U=z0(t,{enabled:x||C!==null}).data||[];function G(q){const J=q.account_group_id?l[q.account_group_id]:void 0;return J?.is_active!==void 0?J.is_active:q.is_active!==!1}function k(q){const J=q.account_group_id?l[q.account_group_id]:void 0;return J?.on_budget!==void 0?J.on_budget:q.on_budget!==!1}const D=Object.entries(o).filter(([,q])=>G(q)&&k(q)),N=D.filter(([,q])=>q.is_income_account),F=N.length>0?N:D,H=D.find(([,q])=>q.is_income_default),j=H?H[0]:void 0,M=d?.income.reduce((q,J)=>q+J.amount,0)||0;function R(q,J,Z,re,P){if(!t)return;S(null),E(!1);const{year:$,month:te}=ym(Z);($!==e||te!==n)&&(r($),s(te)),m(t,$,te,q,J,Z,re,P).catch(se=>{S(se instanceof Error?se.message:"Failed to add income")})}function K(q,J,Z,re,P,$){t&&(S(null),T(null),p(t,e,n,q,J,Z,re,P,$).catch(te=>{S(te instanceof Error?te.message:"Failed to update income")}))}function W(q){t&&confirm("Are you sure you want to delete this income entry?")&&(S(null),g(t,e,n,q).catch(J=>{S(J instanceof Error?J.message:"Failed to delete income")}))}return u.jsxs("div",{style:{opacity:h?.5:1,transition:"opacity 0.15s ease-out",pointerEvents:h?"none":"auto"},children:[_&&u.jsx("div",{style:{background:`color-mix(in srgb, ${ce.error} 15%, transparent)`,border:`1px solid ${ce.error}`,borderRadius:"8px",padding:"0.75rem",marginBottom:"1rem",color:ce.error},children:_}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:v?"1fr":"5rem 1.5fr 2fr 7rem 1.5fr 3rem"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"#242424",borderBottom:"1px solid rgba(255,255,255,0.15)",display:v?"block":"grid",gridTemplateColumns:v?void 0:"subgrid"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem"},children:[u.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[u.jsx("span",{style:{fontWeight:600},children:"Income:"}),u.jsx("span",{style:{opacity:.6,fontSize:"0.8rem"},children:"Incoming money that should be factored into income calculations"}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"Total: "}),u.jsx("span",{style:{color:Pt(M),fontWeight:600},children:Je(M)})]})]}),u.jsx("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:!x&&u.jsx(Ve,{actionName:"Open Add Income Form",onClick:()=>E(!0),disabled:F.length===0,disabledReason:Object.keys(o).length===0?"Create an account first":"Set up an income account first",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:"+ Add Income"})})]}),!v&&u.jsxs(u.Fragment,{children:[u.jsx("div",{style:El,children:"Date"}),u.jsx("div",{style:El,children:"Payee"}),u.jsx("div",{style:El,children:"Account"}),u.jsx("div",{style:{...El,textAlign:"right"},children:"Amount"}),u.jsx("div",{style:El,children:"Description"}),u.jsx("div",{style:El})]})]}),u.jsx("div",{style:{gridColumn:"1 / -1",fontSize:"0.8rem",opacity:.55,fontStyle:"italic",padding:"0.5rem 0"},children:" All income entries on this page count towards the tithing owed calculation."}),F.length===0&&u.jsx(qu,{message:Object.keys(o).length===0?"You need to create at least one account before adding income.":'No accounts are set up for income deposits. Edit an account and enable "Show in income deposit list".',linkText:"Manage accounts",linkTo:"/budget/settings/accounts"}),x&&u.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"1rem"},children:u.jsx(WS,{accounts:F,accountGroups:l,payees:U,defaultAccountId:j,defaultDate:gm(e,n),onSubmit:R,onCancel:()=>E(!1),submitLabel:"Add Income",isMobile:v})}),d?.income.slice().sort((q,J)=>(q.date||"").localeCompare(J.date||"")).map((q,J)=>C===q.id?u.jsx("div",{style:{gridColumn:"1 / -1",padding:"0.5rem"},children:u.jsx(WS,{accounts:F,accountGroups:l,payees:U,initialData:q,onSubmit:(Z,re,P,$,te)=>K(q.id,Z,re,P,$,te),onCancel:()=>T(null),onDelete:()=>W(q.id),submitLabel:"Save",isMobile:v})},q.id):u.jsx(fB,{income:q,accountName:Qe(q.account_id)?ja:o[q.account_id]?.nickname||"Unknown Account",accountGroupName:Qe(q.account_id)?void 0:o[q.account_id]?.account_group_id?l[o[q.account_id].account_group_id]?.name:void 0,onEdit:()=>{q.payee||`${q.amount}`,T(q.id)},onDelete:()=>W(q.id),isMobile:v,isEvenRow:J%2===0},q.id)),(!d?.income||d.income.length===0)&&!x&&u.jsx("p",{style:{gridColumn:"1 / -1",opacity:.5,fontSize:"0.9rem",textAlign:"center",padding:"1.5rem"},children:"No income recorded for this month"}),u.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]})]})}function QS({accounts:t,accountGroups:e,categories:n,categoryGroups:r,payees:s,initialData:o,defaultAccountId:l,defaultDate:d,onSubmit:h,onCancel:m,onDelete:p,submitLabel:g}){function v(_){h(_.amount,_.categoryId,_.accountId,_.date,_.payee,_.description,_.cleared)}return u.jsx(Z0,{accounts:t,accountGroups:e,categories:n,categoryGroups:r,payees:s,initialData:o?{date:o.date,payee:o.payee,categoryId:o.category_id,accountId:o.account_id,amount:o.amount,description:o.description,cleared:o.cleared}:void 0,defaultAccountId:l,defaultDate:d,config:{showCategory:!0,showCleared:!0,showNoCategoryOption:!1,showNoAccountOption:!1,showSignToggle:!0,accountLabel:"Pay From",payeePlaceholder:"e.g., Grocery Store",descriptionPlaceholder:"e.g., Weekly groceries",submitLabel:g},onSubmit:v,onCancel:m,onDelete:p})}function pB({expense:t,categoryName:e,accountName:n,accountGroupName:r,onEdit:s,onDelete:o,isMobile:l,isEvenRow:d}){const h=t.date?new Date(t.date+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"}):"",m=r?`${r} / ${n}`:n,p=d?"transparent":"rgba(255,255,255,0.04)";if(l)return u.jsxs("div",{onClick:s,style:{gridColumn:"1 / -1",display:"grid",gridTemplateColumns:"1fr auto",gap:"0.5rem",padding:"0.75rem 1rem",background:p,cursor:"pointer",transition:"background 0.15s"},children:[u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{style:{fontSize:"0.75rem",opacity:.5,fontFamily:"monospace",minWidth:"3rem"},children:h}),u.jsx("span",{style:{fontWeight:500,fontSize:"0.9rem"},children:t.payee||""}),t.cleared&&u.jsx("span",{style:{fontSize:"0.7rem",color:ce.success},title:"Cleared",children:""})]}),u.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap"},children:[u.jsx("span",{style:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px"},children:e}),u.jsxs("span",{style:{fontSize:"0.75rem",opacity:.6},children:[" ",m]})]})]}),u.jsx("div",{style:{display:"flex",alignItems:"center"},children:u.jsx("span",{style:{fontWeight:600,color:Pt(t.amount),fontFamily:"monospace"},children:qt(t.amount)})})]});const g={padding:"0.6rem 0.5rem",background:p,display:"flex",alignItems:"center",fontSize:"0.9rem"};return u.jsxs("div",{style:{display:"contents"},children:[u.jsx("div",{style:{...g,fontSize:"0.85rem",fontFamily:"monospace"},children:u.jsx("span",{style:{opacity:.6},children:h})}),u.jsx("div",{style:{...g,fontWeight:500,overflow:"hidden"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.payee||""})}),u.jsx("div",{style:{...g,justifyContent:"center"},children:u.jsx("span",{style:{fontSize:"0.8rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e})}),u.jsx("div",{style:{...g,overflow:"hidden"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.85rem",opacity:.7},children:m})}),u.jsx("div",{style:{...g,justifyContent:"flex-end",fontWeight:600,color:Pt(t.amount),fontFamily:"monospace"},children:qt(t.amount)}),u.jsx("div",{style:{...g,paddingLeft:"0.5rem",overflow:"hidden"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.8rem",opacity:.6},children:t.description||""})}),u.jsx("div",{style:{...g,justifyContent:"center",color:t.cleared?ce.success:"inherit",opacity:t.cleared?1:.3,fontSize:"1rem"},children:t.cleared?"":""}),u.jsxs("div",{style:{...g,justifyContent:"flex-end",gap:"0.25rem"},children:[u.jsx("button",{onClick:s,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:v=>v.currentTarget.style.opacity="1",onMouseLeave:v=>v.currentTarget.style.opacity="0.5",title:"Edit",children:""}),u.jsx("button",{onClick:o,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:v=>v.currentTarget.style.opacity="1",onMouseLeave:v=>v.currentTarget.style.opacity="0.5",title:"Delete",children:""})]})]})}const oa={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderTop:"1px solid rgba(255,255,255,0.1)"};function gB(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n,setCurrentYear:r,setCurrentMonthNumber:s}=zt(),{accounts:o,accountGroups:l,categories:d,categoryGroups:h}=An(),{month:m,isLoading:p}=As(t,e,n),{addExpense:g}=h3(),{updateExpense:v}=m3(),{deleteExpense:_}=p3(),S=qi(),[x,E]=O.useState(null),[C,T]=O.useState(!1),[A,B]=O.useState(null),k=z0(t,{enabled:C||A!==null}).data||[];function D(Z){const re=Z.account_group_id?l[Z.account_group_id]:void 0;return re?.is_active!==void 0?re.is_active:Z.is_active!==!1}function N(Z){const re=Z.account_group_id?l[Z.account_group_id]:void 0;return re?.on_budget!==void 0?re.on_budget:Z.on_budget!==!1}const F=Object.entries(o).filter(([,Z])=>D(Z)&&N(Z)),H=F.filter(([,Z])=>Z.is_outgo_account),j=H.length>0?H:F,M=F.find(([,Z])=>Z.is_outgo_default),R=M?M[0]:void 0,K=m?.expenses?.reduce((Z,re)=>Z+re.amount,0)||0;function W(Z,re,P,$,te,se,ae){if(!t)return;E(null),T(!1);const{year:ye,month:Ie}=ym($);(ye!==e||Ie!==n)&&(r(ye),s(Ie)),g(t,ye,Ie,Z,re,P,$,te,se,ae).catch(Ee=>{E(Ee instanceof Error?Ee.message:"Failed to add expense")})}function q(Z,re,P,$,te,se,ae,ye){t&&(E(null),B(null),v(t,e,n,Z,re,P,$,te,se,ae,ye).catch(Ie=>{E(Ie instanceof Error?Ie.message:"Failed to update expense")}))}function J(Z){t&&confirm("Are you sure you want to delete this expense?")&&(E(null),_(t,e,n,Z).catch(re=>{E(re instanceof Error?re.message:"Failed to delete expense")}))}return u.jsxs("div",{style:{opacity:p?.5:1,transition:"opacity 0.15s ease-out",pointerEvents:p?"none":"auto"},children:[x&&u.jsx("div",{style:{background:`color-mix(in srgb, ${ce.error} 15%, transparent)`,border:`1px solid ${ce.error}`,borderRadius:"8px",padding:"0.75rem",marginBottom:"1rem",color:ce.error},children:x}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:S?"1fr":"5rem 1.5fr 7rem 1fr 6rem 1fr 3rem 4rem"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"#242424",borderBottom:"1px solid rgba(255,255,255,0.15)",display:S?"block":"grid",gridTemplateColumns:S?void 0:"subgrid"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem"},children:[u.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[u.jsx("span",{style:{fontWeight:600},children:"Expenses:"}),u.jsx("span",{style:{opacity:.6,fontSize:"0.8rem"},children:"Transactions that should be factored into spend calculations"}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"Total: "}),u.jsx("span",{style:{color:Pt(K),fontWeight:600},children:qt(K)})]})]}),u.jsx("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:!C&&u.jsx(Ve,{actionName:"Open Add Expense Form",onClick:()=>T(!0),disabled:j.length===0||Object.keys(d).length===0,disabledReason:j.length===0&&Object.keys(d).length===0?"Create accounts and categories first":j.length===0?"Create an expense account first":"Create a category first",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:"+ Add Expense"})})]}),!S&&u.jsxs(u.Fragment,{children:[u.jsx("div",{style:oa,children:"Date"}),u.jsx("div",{style:oa,children:"Payee"}),u.jsx("div",{style:{...oa,textAlign:"center"},children:"Category"}),u.jsx("div",{style:oa,children:"Account"}),u.jsx("div",{style:{...oa,textAlign:"right"},children:"Amount"}),u.jsx("div",{style:oa,children:"Description"}),u.jsx("div",{style:{...oa,textAlign:"center"},children:"Clr"}),u.jsx("div",{style:oa})]})]}),j.length===0&&u.jsx(qu,{message:Object.keys(o).length===0?"You need to create at least one account before adding expenses.":'No accounts are set up for expenses. Edit an account and enable "Show in expense list".',linkText:"Manage accounts",linkTo:"/budget/settings/accounts"}),Object.keys(d).length===0&&u.jsx(qu,{message:"You need to create at least one category before adding expenses.",linkText:"Create categories",linkTo:"/budget/settings/categories"}),C&&u.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"1rem"},children:u.jsx(QS,{accounts:j,accountGroups:l,categories:d,categoryGroups:h,payees:k,defaultAccountId:R,defaultDate:gm(e,n),onSubmit:W,onCancel:()=>T(!1),submitLabel:"Add Expense",isMobile:S})}),m?.expenses?.slice().sort((Z,re)=>(Z.date||"").localeCompare(re.date||"")).map((Z,re)=>A===Z.id?u.jsx("div",{style:{gridColumn:"1 / -1",padding:"0.5rem"},children:u.jsx(QS,{accounts:j,accountGroups:l,categories:d,categoryGroups:h,payees:k,initialData:Z,onSubmit:(P,$,te,se,ae,ye,Ie)=>q(Z.id,P,$,te,se,ae,ye,Ie),onCancel:()=>B(null),onDelete:()=>J(Z.id),submitLabel:"Save",isMobile:S})},Z.id):u.jsx(pB,{expense:Z,categoryName:it(Z.category_id)?To:d[Z.category_id]?.name||"Unknown Category",accountName:Qe(Z.account_id)?ja:o[Z.account_id]?.nickname||"Unknown Account",accountGroupName:Qe(Z.account_id)?void 0:o[Z.account_id]?.account_group_id?l[o[Z.account_id].account_group_id]?.name:void 0,onEdit:()=>{Z.payee||`${Z.amount}`,B(Z.id)},onDelete:()=>J(Z.id),isMobile:S,isEvenRow:re%2===0},Z.id)),(!m?.expenses||m.expenses.length===0)&&!C&&u.jsx("p",{style:{gridColumn:"1 / -1",opacity:.5,fontSize:"0.9rem",textAlign:"center",padding:"1.5rem"},children:"No expenses recorded for this month"}),u.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]})]})}const yB={background:ce.primary,border:"none",cursor:"pointer",fontSize:"0.9rem",padding:"0.35rem 0.5rem",borderRadius:"4px",color:"white"},_B={background:"transparent",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)",cursor:"pointer",fontSize:"0.9rem",padding:"0.35rem 0.5rem",borderRadius:"4px"},bB={background:"transparent",border:`1px solid ${ce.errorBorder}`,color:ce.error,cursor:"pointer",fontSize:"0.9rem",padding:"0.35rem 0.5rem",borderRadius:"4px"};function KS({accounts:t,accountGroups:e,categories:n,categoryGroups:r,initialData:s,defaultDate:o,onSubmit:l,onCancel:d,onDelete:h,submitLabel:m}){const{isWide:p}=RT(),g=new Date().toISOString().split("T")[0],[v,_]=O.useState(s?.date||o||g),[S,x]=O.useState(s?.amount?.toString()||""),[E,C]=O.useState(s?.from_account_id||Vt),[T,A]=O.useState(s?.to_account_id||Vt),[B,U]=O.useState(s?.from_category_id||Qt),[G,k]=O.useState(s?.to_category_id||Qt),[D,N]=O.useState(s?.description||""),[F,H]=O.useState(s?.cleared||!1),[j,M]=O.useState(null),R=B===Qt,K=G===Qt,W=E===Vt,q=T===Vt;function J(){return R&&K&&(W&&q)?'A transfer must move between real categories or real accounts  not all "No" options.':W!==q?'Both accounts must be real accounts, or both must be "No Account". Cannot transfer from a real account to nothing.':R!==K?'Both categories must be real categories, or both must be "No Category". Cannot transfer from a real category to nothing.':null}J()===null&&j!==null&&M(null);function re(Ee){Ee.preventDefault();const Ce=parseFloat(S);if(isNaN(Ce)||Ce<=0||!E||!T||!B||!G||!v)return;const pe=J();if(pe){M(pe);return}M(null),l(Ce,E,T,B,G,v,D.trim()||void 0,F)}const P=j?u.jsx("div",{style:{background:`color-mix(in srgb, ${ce.error} 15%, transparent)`,border:`1px solid ${ce.errorBorder}`,borderRadius:"6px",padding:"0.5rem 0.75rem",fontSize:"0.85rem",color:ce.error,marginTop:"0.5rem"},children:j}):null,$=(Ee,Ce,pe,Ue)=>u.jsx(Mt,{label:Ue,htmlFor:Ee,children:u.jsx(sA,{id:Ee,value:Ce,onChange:pe,accounts:t,accountGroups:e,placeholder:ja,required:!0,showNoAccountOption:!0})}),te=(Ee,Ce,pe,Ue)=>u.jsx(Mt,{label:Ue,htmlFor:Ee,children:u.jsx(iA,{id:Ee,value:Ce,onChange:pe,categories:n,categoryGroups:r,placeholder:To,required:!0,showNoCategoryOption:!0})}),se=u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.25rem",paddingBottom:"0.35rem"},children:[u.jsx("label",{htmlFor:"transfer-cleared",style:{fontSize:"0.75rem",opacity:.7,fontWeight:500},children:"Clr"}),u.jsx(Ur,{id:"transfer-cleared",checked:F,onChange:Ee=>H(Ee.target.checked)})]}),ae=u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.25rem",paddingBottom:"0.1rem"},children:[u.jsx("span",{style:{fontSize:"0.75rem",opacity:.7,fontWeight:500},children:""}),u.jsxs("div",{style:{display:"flex",gap:"0.25rem"},children:[u.jsx("button",{type:"submit",title:m,style:yB,children:""}),u.jsx("button",{type:"button",onClick:()=>{d()},title:"Cancel",style:_B,children:""}),h&&u.jsx("button",{type:"button",onClick:()=>{h()},title:"Delete",style:bB,children:""})]})]}),ye=u.jsxs(Na,{children:[u.jsx(Ve,{type:"submit",actionName:m,children:m}),u.jsx(Ve,{type:"button",variant:"secondary",actionName:"Cancel Transfer Form",onClick:d,children:"Cancel"}),h&&u.jsx(Ve,{type:"button",variant:"danger",actionName:"Delete Transfer",onClick:h,children:" Delete"})]}),Ie={fontSize:"0.85rem",padding:"0.5rem"};return p?u.jsx(Es,{actionName:m,onSubmit:re,children:u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[u.jsxs("div",{style:{display:"grid",gridTemplateColumns:"5.5rem 5.5rem 1fr 1fr 1.5fr",gap:"0.75rem",alignItems:"end"},children:[u.jsx(Mt,{label:"Date",htmlFor:"transfer-date",children:u.jsx(zf,{id:"transfer-date",value:v,onChange:Ee=>_(Ee.target.value),required:!0,style:Ie,autoFocus:!0})}),u.jsx(Mt,{label:"Amount",htmlFor:"transfer-amount",children:u.jsx(yo,{id:"transfer-amount",value:S,onChange:x,placeholder:"$0.00",required:!0})}),te("from-category",B,U,"From Category"),$("from-account",E,C,"From Account"),u.jsx(Mt,{label:"Description",htmlFor:"transfer-description",children:u.jsx(Cs,{id:"transfer-description",value:D,onChange:Ee=>N(Ee.target.value),placeholder:"e.g., Transfer",style:Ie})})]}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:"5.5rem 5.5rem 1fr 1fr 1.5fr",gap:"0.75rem",alignItems:"end"},children:[u.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1.2rem",opacity:.5,paddingBottom:"0.5rem"},children:""}),u.jsx("div",{}),te("to-category",G,k,"To Category"),$("to-account",T,A,"To Account"),u.jsxs("div",{style:{display:"flex",gap:"0.75rem",alignItems:"end",paddingBottom:"0.25rem"},children:[se,ae]})]}),P]})}):u.jsxs(Es,{actionName:m,onSubmit:re,children:[u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:[u.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[u.jsx(Mt,{label:"Date",htmlFor:"transfer-date",children:u.jsx(zf,{id:"transfer-date",value:v,onChange:Ee=>_(Ee.target.value),required:!0,autoFocus:!0})}),u.jsx(Mt,{label:"Amount",htmlFor:"transfer-amount",children:u.jsx(yo,{id:"transfer-amount",value:S,onChange:x,placeholder:"$0.00",required:!0})})]}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem",background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1rem",borderRadius:"8px"},children:[u.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"0.75rem",alignItems:"end"},children:[te("from-category",B,U,"From Cat."),$("from-account",E,C,"From Acct.")]}),u.jsx("div",{style:{display:"flex",justifyContent:"center",fontSize:"1.5rem",opacity:.5},children:""}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"0.75rem",alignItems:"end"},children:[te("to-category",G,k,"To Cat."),$("to-account",T,A,"To Acct.")]})]}),u.jsx(Mt,{label:"Description (optional)",htmlFor:"transfer-description",children:u.jsx(Cs,{id:"transfer-description",value:D,onChange:Ee=>N(Ee.target.value),placeholder:"e.g., Transfer to savings"})}),u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx(Ur,{id:"transfer-cleared-stacked",checked:F,onChange:Ee=>H(Ee.target.checked)}),u.jsx("label",{htmlFor:"transfer-cleared-stacked",style:{fontSize:"0.9rem",cursor:"pointer"},children:"Cleared (appeared in bank account)"})]}),P]}),ye]})}function vB({transfer:t,fromCategoryName:e,toCategoryName:n,fromAccountName:r,toAccountName:s,fromAccountGroupName:o,toAccountGroupName:l,isFromCategoryNo:d,isToCategoryNo:h,isFromAccountNo:m,isToAccountNo:p,onEdit:g,onDelete:v,isMobile:_,isEvenRow:S}){const x=t.date?new Date(t.date+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"}):"",E=S?"transparent":"rgba(255,255,255,0.04)";if(_)return u.jsxs("div",{onClick:g,style:{gridColumn:"1 / -1",display:"flex",flexDirection:"column",gap:"0.5rem",padding:"0.75rem 1rem",background:E,cursor:"pointer",transition:"background 0.15s"},children:[u.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{style:{fontSize:"0.75rem",opacity:.5,fontFamily:"monospace",minWidth:"3rem"},children:x}),u.jsx("span",{style:{fontWeight:600,opacity:.8,fontFamily:"monospace"},children:Je(t.amount)}),t.cleared&&u.jsx("span",{style:{fontSize:"0.7rem",color:ce.success},title:"Cleared",children:""})]})}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto 1fr",gap:"0.5rem",alignItems:"center"},children:[u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[u.jsx("span",{style:d?{fontSize:"0.7rem",opacity:.4}:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px",display:"inline-block",width:"fit-content"},children:e}),m?u.jsx("span",{style:{fontSize:"0.75rem",opacity:.4},children:r}):u.jsxs("div",{style:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px",display:"inline-flex",flexDirection:"column",gap:"0.1rem",width:"fit-content"},children:[o&&u.jsx("span",{style:{fontSize:"0.65rem",opacity:.6},children:o}),u.jsx("span",{children:r})]})]}),u.jsx("span",{style:{opacity:.5},children:""}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[u.jsx("span",{style:h?{fontSize:"0.7rem",opacity:.4}:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px",display:"inline-block",width:"fit-content"},children:n}),p?u.jsx("span",{style:{fontSize:"0.75rem",opacity:.4},children:s}):u.jsxs("div",{style:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px",display:"inline-flex",flexDirection:"column",gap:"0.1rem",width:"fit-content"},children:[l&&u.jsx("span",{style:{fontSize:"0.65rem",opacity:.6},children:l}),u.jsx("span",{children:s})]})]})]}),t.description&&u.jsx("div",{style:{fontSize:"0.75rem",opacity:.6},children:t.description})]});const C={padding:"0.6rem 0.5rem",background:E,display:"flex",alignItems:"center",fontSize:"0.9rem"};return u.jsxs("div",{style:{display:"contents"},children:[u.jsx("div",{style:{...C,fontSize:"0.85rem",fontFamily:"monospace"},children:u.jsx("span",{style:{opacity:.6},children:x})}),u.jsx("div",{style:{...C,justifyContent:"flex-end",fontWeight:600,opacity:.8,fontFamily:"monospace"},children:Je(t.amount)}),u.jsx("div",{style:{...C,justifyContent:"center"},children:u.jsx("span",{style:d?{fontSize:"0.8rem",opacity:.4}:{fontSize:"0.8rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e})}),u.jsx("div",{style:{...C,overflow:"hidden"},children:m?u.jsx("span",{style:{opacity:.4,fontSize:"0.85rem"},children:r}):u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.1rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden"},children:[o&&u.jsx("span",{style:{fontSize:"0.7rem",opacity:.6,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:o}),u.jsx("span",{style:{fontSize:"0.8rem",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:r})]})}),u.jsx("div",{style:{...C,justifyContent:"center",fontSize:"1rem"},children:u.jsx("span",{style:{opacity:.5},children:""})}),u.jsx("div",{style:{...C,justifyContent:"center"},children:u.jsx("span",{style:h?{fontSize:"0.8rem",opacity:.4}:{fontSize:"0.8rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:n})}),u.jsx("div",{style:{...C,overflow:"hidden"},children:p?u.jsx("span",{style:{opacity:.4,fontSize:"0.85rem"},children:s}):u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.1rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden"},children:[l&&u.jsx("span",{style:{fontSize:"0.7rem",opacity:.6,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:l}),u.jsx("span",{style:{fontSize:"0.8rem",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:s})]})}),u.jsx("div",{style:{...C,paddingLeft:"0.5rem",overflow:"hidden"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.8rem",opacity:.6},children:t.description||""})}),u.jsx("div",{style:{...C,justifyContent:"center",color:t.cleared?ce.success:"inherit",opacity:t.cleared?1:.3,fontSize:"1rem"},children:t.cleared?"":""}),u.jsxs("div",{style:{...C,justifyContent:"flex-end",gap:"0.25rem"},children:[u.jsx("button",{onClick:g,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:T=>T.currentTarget.style.opacity="1",onMouseLeave:T=>T.currentTarget.style.opacity="0.5",title:"Edit",children:""}),u.jsx("button",{onClick:v,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:T=>T.currentTarget.style.opacity="1",onMouseLeave:T=>T.currentTarget.style.opacity="0.5",title:"Delete",children:""})]})]})}const ki={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderTop:"1px solid rgba(255,255,255,0.1)"};function xB(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n,setCurrentYear:r,setCurrentMonthNumber:s}=zt(),{accounts:o,accountGroups:l,categories:d,categoryGroups:h}=An(),{month:m,isLoading:p}=As(t,e,n),{addTransfer:g}=y3(),{updateTransfer:v}=b3(),{deleteTransfer:_}=v3(),S=qi(),[x,E]=O.useState(null),[C,T]=O.useState(!1),[A,B]=O.useState(null);function U(j){const M=j.account_group_id?l[j.account_group_id]:void 0;return M?.is_active!==void 0?M.is_active:j.is_active!==!1}function G(j){const M=j.account_group_id?l[j.account_group_id]:void 0;return M?.on_budget!==void 0?M.on_budget:j.on_budget!==!1}const k=Object.entries(o).filter(([,j])=>U(j)&&G(j));function D(j,M,R,K,W,q,J,Z){if(!t)return;E(null),T(!1);const{year:re,month:P}=ym(q);(re!==e||P!==n)&&(r(re),s(P)),g(t,re,P,j,M,R,K,W,q,J,Z).catch($=>{E($ instanceof Error?$.message:"Failed to add transfer")})}function N(j,M,R,K,W,q,J,Z,re){t&&(E(null),B(null),v(t,e,n,j,M,R,K,W,q,J,Z,re).catch(P=>{E(P instanceof Error?P.message:"Failed to update transfer")}))}function F(j){t&&confirm("Are you sure you want to delete this transfer?")&&(E(null),_(t,e,n,j).catch(M=>{E(M instanceof Error?M.message:"Failed to delete transfer")}))}const H=k.length>=1&&Object.keys(d).length>=1;return u.jsxs("div",{style:{opacity:p?.5:1,transition:"opacity 0.15s ease-out",pointerEvents:p?"none":"auto"},children:[x&&u.jsx("div",{style:{background:`color-mix(in srgb, ${ce.error} 15%, transparent)`,border:`1px solid ${ce.error}`,borderRadius:"8px",padding:"0.75rem",marginBottom:"1rem",color:ce.error},children:x}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:S?"1fr":"5rem 6rem 1fr 1fr 2rem 1fr 1fr 1fr 3rem 4rem"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"#242424",borderBottom:"1px solid rgba(255,255,255,0.15)",display:S?"block":"grid",gridTemplateColumns:S?void 0:"subgrid"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem"},children:[u.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[u.jsx("span",{style:{fontWeight:600},children:"Transfers:"}),u.jsx("span",{style:{opacity:.6,fontSize:"0.8rem"},children:"Moving money between accounts and categories within the budget"})]}),u.jsx("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:!C&&u.jsx(Ve,{actionName:"Open Add Transfer Form",onClick:()=>T(!0),disabled:!H,disabledReason:k.length===0&&Object.keys(d).length===0?"Create accounts and categories first":k.length===0?"Create an account first":"Create a category first",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:"+ Add Transfer"})})]}),!S&&u.jsxs(u.Fragment,{children:[u.jsx("div",{style:ki,children:"Date"}),u.jsx("div",{style:{...ki,textAlign:"right"},children:"Amount"}),u.jsx("div",{style:{...ki,textAlign:"center"},children:"From Cat"}),u.jsx("div",{style:ki,children:"From Acct"}),u.jsx("div",{style:ki}),u.jsx("div",{style:{...ki,textAlign:"center"},children:"To Cat"}),u.jsx("div",{style:ki,children:"To Acct"}),u.jsx("div",{style:ki,children:"Description"}),u.jsx("div",{style:{...ki,textAlign:"center"},children:"Clr"}),u.jsx("div",{style:ki})]})]}),!H&&u.jsx(qu,{message:"You need at least one account and one category before adding transfers.",linkText:"Manage accounts",linkTo:"/budget/settings/accounts"}),C&&u.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"1rem"},children:u.jsx(KS,{accounts:k,accountGroups:l,categories:d,categoryGroups:h,defaultDate:gm(e,n),onSubmit:D,onCancel:()=>T(!1),submitLabel:"Add Transfer"})}),m?.transfers?.slice().sort((j,M)=>(j.date||"").localeCompare(M.date||"")).map((j,M)=>A===j.id?u.jsx("div",{style:{gridColumn:"1 / -1",padding:"0.5rem"},children:u.jsx(KS,{accounts:k,accountGroups:l,categories:d,categoryGroups:h,initialData:j,onSubmit:(R,K,W,q,J,Z,re,P)=>N(j.id,R,K,W,q,J,Z,re,P),onCancel:()=>B(null),onDelete:()=>F(j.id),submitLabel:"Save"})},j.id):u.jsx(vB,{transfer:j,fromCategoryName:it(j.from_category_id)?To:d[j.from_category_id]?.name||"Unknown",toCategoryName:it(j.to_category_id)?To:d[j.to_category_id]?.name||"Unknown",fromAccountName:Qe(j.from_account_id)?ja:o[j.from_account_id]?.nickname||"Unknown",toAccountName:Qe(j.to_account_id)?ja:o[j.to_account_id]?.nickname||"Unknown",fromAccountGroupName:Qe(j.from_account_id)?void 0:o[j.from_account_id]?.account_group_id?l[o[j.from_account_id].account_group_id]?.name:void 0,toAccountGroupName:Qe(j.to_account_id)?void 0:o[j.to_account_id]?.account_group_id?l[o[j.to_account_id].account_group_id]?.name:void 0,isFromCategoryNo:it(j.from_category_id),isToCategoryNo:it(j.to_category_id),isFromAccountNo:Qe(j.from_account_id),isToAccountNo:Qe(j.to_account_id),onEdit:()=>{j.description||`${j.amount}`,B(j.id)},onDelete:()=>F(j.id),isMobile:S,isEvenRow:M%2===0},j.id)),(!m?.transfers||m.transfers.length===0)&&!C&&u.jsx("p",{style:{gridColumn:"1 / -1",opacity:.5,fontSize:"0.9rem",textAlign:"center",padding:"1.5rem"},children:"No transfers recorded for this month"}),u.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]})]})}function YS({accounts:t,accountGroups:e,categories:n,categoryGroups:r,payees:s,initialData:o,defaultAccountId:l,defaultDate:d,onSubmit:h,onCancel:m,onDelete:p,submitLabel:g}){function v(_){h(_.amount,_.accountId,_.categoryId,_.date,_.payee,_.description,_.cleared)}return u.jsx(Z0,{accounts:t,accountGroups:e,categories:n,categoryGroups:r,payees:s,initialData:o?{date:o.date,payee:o.payee,categoryId:o.category_id,accountId:o.account_id,amount:o.amount,description:o.description,cleared:o.cleared}:void 0,defaultAccountId:l,defaultDate:d,config:{showCategory:!0,showCleared:!0,showNoCategoryOption:!0,showNoAccountOption:!0,showSignToggle:!0,accountLabel:"Account",payeePlaceholder:"e.g., Bank, Interest source",descriptionPlaceholder:"e.g., Starting balance, Correction",submitLabel:g},onSubmit:v,onCancel:m,onDelete:p})}function wB({adjustment:t,categoryName:e,accountName:n,accountGroupName:r,onEdit:s,onDelete:o,isMobile:l,isEvenRow:d}){const h=t.date?new Date(t.date+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"}):"",m=r?`${r} / ${n}`:n,p=d?"transparent":"rgba(255,255,255,0.04)";if(l)return u.jsxs("div",{onClick:s,style:{gridColumn:"1 / -1",display:"flex",flexDirection:"column",gap:"0.25rem",padding:"0.75rem 1rem",background:p,cursor:"pointer",transition:"background 0.15s"},children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{style:{fontSize:"0.75rem",opacity:.5,fontFamily:"monospace"},children:h}),t.cleared&&u.jsx("span",{style:{fontSize:"0.7rem",color:ce.success},title:"Cleared",children:""})]}),u.jsx("span",{style:{fontWeight:600,color:Pt(t.amount),fontFamily:"monospace"},children:qt(t.amount)})]}),u.jsx("div",{style:{fontWeight:500,fontSize:"0.9rem"},children:t.description||"Adjustment"}),u.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap",alignItems:"center"},children:[u.jsx("span",{style:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px"},children:e}),u.jsx("span",{style:{fontSize:"0.75rem",opacity:.6},children:m})]})]});const g={padding:"0.6rem 0.5rem",background:p,display:"flex",alignItems:"center",fontSize:"0.9rem"};return u.jsxs("div",{style:{display:"contents"},children:[u.jsx("div",{style:{...g,fontSize:"0.85rem",fontFamily:"monospace"},children:u.jsx("span",{style:{opacity:.6},children:h})}),u.jsx("div",{style:{...g,justifyContent:"center"},children:u.jsx("span",{style:{fontSize:"0.8rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e})}),u.jsx("div",{style:{...g,overflow:"hidden"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.85rem",opacity:.7},children:m})}),u.jsx("div",{style:{...g,justifyContent:"flex-end",fontWeight:600,color:Pt(t.amount),fontFamily:"monospace"},children:qt(t.amount)}),u.jsx("div",{style:{...g,paddingLeft:"0.5rem",overflow:"hidden"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.8rem",opacity:.6},children:t.description||""})}),u.jsx("div",{style:{...g,justifyContent:"center",color:t.cleared?ce.success:"inherit",opacity:t.cleared?1:.3,fontSize:"1rem"},children:t.cleared?"":""}),u.jsxs("div",{style:{...g,justifyContent:"flex-end",gap:"0.25rem"},children:[u.jsx("button",{onClick:s,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:v=>v.currentTarget.style.opacity="1",onMouseLeave:v=>v.currentTarget.style.opacity="0.5",title:"Edit",children:""}),u.jsx("button",{onClick:o,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:v=>v.currentTarget.style.opacity="1",onMouseLeave:v=>v.currentTarget.style.opacity="0.5",title:"Delete",children:""})]})]})}const fo={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderTop:"1px solid rgba(255,255,255,0.1)"};function SB(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n,setCurrentYear:r,setCurrentMonthNumber:s}=zt(),{accounts:o,accountGroups:l,categories:d,categoryGroups:h}=An(),{month:m,isLoading:p}=As(t,e,n),{addAdjustment:g}=w3(),{updateAdjustment:v}=E3(),{deleteAdjustment:_}=C3(),S=qi(),[x,E]=O.useState(null),[C,T]=O.useState(!1),[A,B]=O.useState(null),k=z0(t,{enabled:C||A!==null}).data||[];function D(R){const K=R.account_group_id?l[R.account_group_id]:void 0;return K?.is_active!==void 0?K.is_active:R.is_active!==!1}function N(R){const K=R.account_group_id?l[R.account_group_id]:void 0;return K?.on_budget!==void 0?K.on_budget:R.on_budget!==!1}const F=Object.entries(o).filter(([,R])=>D(R)&&N(R));function H(R,K,W,q,J,Z,re){if(!t)return;E(null),T(!1);const{year:P,month:$}=ym(q);(P!==e||$!==n)&&(r(P),s($)),g(t,P,$,R,K,W,q,J,Z,re).catch(te=>{E(te instanceof Error?te.message:"Failed to add adjustment")})}function j(R,K,W,q,J,Z,re,P){t&&(E(null),B(null),v(t,e,n,R,K,W,q,J,Z,re,P).catch($=>{E($ instanceof Error?$.message:"Failed to update adjustment")}))}function M(R){t&&confirm("Are you sure you want to delete this adjustment?")&&(E(null),_(t,e,n,R).catch(K=>{E(K instanceof Error?K.message:"Failed to delete adjustment")}))}return u.jsxs("div",{style:{opacity:p?.5:1,transition:"opacity 0.15s ease-out",pointerEvents:p?"none":"auto"},children:[x&&u.jsx("div",{style:{background:`color-mix(in srgb, ${ce.error} 15%, transparent)`,border:`1px solid ${ce.error}`,borderRadius:"8px",padding:"0.75rem",marginBottom:"1rem",color:ce.error},children:x}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:S?"1fr":"5rem 1fr 1fr 6rem 1.5fr 3rem 4rem"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"#242424",borderBottom:"1px solid rgba(255,255,255,0.15)",display:S?"block":"grid",gridTemplateColumns:S?void 0:"subgrid"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem"},children:[u.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[u.jsx("span",{style:{fontWeight:600},children:"Adjustments:"}),u.jsx("span",{style:{opacity:.6,fontSize:"0.8rem"},children:"Incoming or outgoing transactions that should bypass income and spend calculations"})]}),u.jsx("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:!C&&u.jsx(Ve,{actionName:"Open Add Adjustment Form",onClick:()=>T(!0),disabled:Object.keys(d).length===0&&F.length===0,disabledReason:"Create an account or category first",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:"+ Add Adjustment"})})]}),!S&&u.jsxs(u.Fragment,{children:[u.jsx("div",{style:fo,children:"Date"}),u.jsx("div",{style:{...fo,textAlign:"center"},children:"Category"}),u.jsx("div",{style:fo,children:"Account"}),u.jsx("div",{style:{...fo,textAlign:"right"},children:"Amount"}),u.jsx("div",{style:fo,children:"Description"}),u.jsx("div",{style:{...fo,textAlign:"center"},children:"Clr"}),u.jsx("div",{style:fo})]})]}),F.length===0&&Object.keys(d).length===0&&u.jsx(qu,{message:"You need to create at least one account or category before adding adjustments.",linkText:"Manage accounts",linkTo:"/budget/settings/accounts"}),C&&u.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"1rem"},children:u.jsx(YS,{accounts:F,accountGroups:l,categories:d,categoryGroups:h,payees:k,defaultDate:gm(e,n),onSubmit:H,onCancel:()=>T(!1),submitLabel:"Add Adjustment"})}),m?.adjustments?.slice().sort((R,K)=>(R.date||"").localeCompare(K.date||"")).map((R,K)=>A===R.id?u.jsx("div",{style:{gridColumn:"1 / -1",padding:"0.5rem"},children:u.jsx(YS,{accounts:F,accountGroups:l,categories:d,categoryGroups:h,payees:k,initialData:R,onSubmit:(W,q,J,Z,re,P,$)=>j(R.id,W,q,J,Z,re,P,$),onCancel:()=>B(null),onDelete:()=>M(R.id),submitLabel:"Save"})},R.id):u.jsx(wB,{adjustment:R,categoryName:it(R.category_id)?To:d[R.category_id]?.name||"Unknown Category",accountName:Qe(R.account_id)?ja:o[R.account_id]?.nickname||"Unknown Account",accountGroupName:Qe(R.account_id)?void 0:o[R.account_id]?.account_group_id?l[o[R.account_id].account_group_id]?.name:void 0,onEdit:()=>{R.description||`${R.amount}`,B(R.id)},onDelete:()=>M(R.id),isMobile:S,isEvenRow:K%2===0},R.id)),(!m?.adjustments||m.adjustments.length===0)&&!C&&u.jsx("p",{style:{gridColumn:"1 / -1",opacity:.5,fontSize:"0.9rem",textAlign:"center",padding:"1.5rem"},children:"No adjustments recorded for this month"}),u.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]})]})}function EB({isOpen:t,onClose:e,onDeleted:n}){const{addLoadingHold:r,removeLoadingHold:s}=nr(),{selectedBudgetId:o,currentYear:l,currentMonthNumber:d}=zt(),{deleteAllocations:h}=AT(),[m,p]=O.useState(null),g=async()=>{if(o){p(null),r("allocations-delete","Deleting allocations...");try{await h({budgetId:o,year:l,month:d}),e(),n?.()}catch(v){p(v instanceof Error?v.message:"Failed to delete allocations")}finally{s("allocations-delete")}}};return u.jsxs(Hi,{isOpen:t,onClose:e,title:"Delete Allocations",children:[m&&u.jsx(No,{message:m,onDismiss:()=>p(null)}),u.jsx("p",{style:{margin:"0 0 1.5rem 0"},children:"Are you sure you want to delete all allocations for this month? This will remove all allocated amounts and reset the month to unfinalized."}),u.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[u.jsx(Ve,{actionName:"Cancel Delete Allocations",variant:"secondary",onClick:e,children:"Cancel"}),u.jsx(Ve,{actionName:"Confirm Delete Allocations",variant:"danger",onClick:g,children:"Delete Allocations"})]})]})}function fA({isDraftMode:t,isEditingAppliedAllocations:e,availableNow:n,currentMonthIncome:r,balanceTotals:s,draftChangeAmount:o,availableAfterApply:l,currentDraftTotal:d}){const h=t&&d!==void 0?d:s.allocated;return u.jsxs(u.Fragment,{children:[u.jsx("span",{style:{fontWeight:600,marginRight:"0.25rem"},children:t||e?"Allocations Worksheet:":"Month Summary:"}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:t?"Avail: ":"Inc: "}),t?u.jsx("span",{style:{color:Pt(n),fontWeight:600},children:Je(n)}):u.jsxs("span",{style:{color:ce.success,fontWeight:600},children:["+",Je(r)]})]}),u.jsxs("span",{children:[t&&u.jsx("span",{style:{opacity:.6},children:" "}),u.jsx("span",{style:{opacity:.6},children:t?"Draft: ":"Alloc: "}),u.jsxs("span",{style:{color:pc(t?h:s.allocated),fontWeight:600,...t?ri:{}},children:[t?"":"+",Je(t?h:s.allocated)]}),e&&o!==0&&u.jsxs("span",{style:{fontSize:"0.85em",color:o>0?ce.warning:ce.success,marginLeft:"0.25rem"},children:["(",qt(o),")"]})]}),!t&&u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"Spent: "}),u.jsx("span",{style:{color:mc(s.spent),fontWeight:600},children:Pa(s.spent)})]}),u.jsxs("span",{children:[t&&u.jsx("span",{style:{opacity:.6},children:"= "}),u.jsx("span",{style:{opacity:.6},children:t?"Remaining: ":"Net: "}),t?u.jsx("span",{style:{color:Pt(l),fontWeight:600,...ri},children:Je(l)}):u.jsx("span",{style:{color:Pt(s.allocated+s.spent),fontWeight:600},children:Je(s.allocated+s.spent)})]})]})}function CB({totals:t}){return u.jsxs(u.Fragment,{children:[u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"Start: "}),u.jsx("span",{style:{color:Pt(t.start),fontWeight:600},children:Je(t.start)})]}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"Inc: "}),u.jsxs("span",{style:{color:ce.success,fontWeight:600},children:["+",Je(t.income)]})]}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"Exp: "}),u.jsx("span",{style:{color:mc(t.expenses),fontWeight:600},children:Pa(t.expenses)})]}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"End: "}),u.jsx("span",{style:{color:Pt(t.end),fontWeight:600},children:Je(t.end)})]})]})}function J0({isDraftMode:t,isEditingAppliedAllocations:e,allocationsFinalized:n,onSave:r,onApply:s,onEdit:o,onCancel:l,onDelete:d}){return u.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:[t&&!e&&u.jsxs(u.Fragment,{children:[u.jsx(Ve,{actionName:"Save Draft Allocations",onClick:r,variant:"secondary",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:" Save"}),u.jsx(Ve,{actionName:"Apply Allocations",onClick:s,variant:"secondary",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:" Apply"})]}),!t&&n&&u.jsx(Ve,{actionName:"Edit Allocations",onClick:o,variant:"secondary",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:" Edit Allocations"}),e&&u.jsxs(u.Fragment,{children:[u.jsx(Ve,{actionName:"Apply Allocations",onClick:s,variant:"secondary",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:" Apply"}),u.jsx(Ve,{actionName:"Cancel Edit Allocations",onClick:l,variant:"secondary",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:""}),u.jsx(Ve,{actionName:"Open Delete Allocations Modal",onClick:d,variant:"secondary",style:{fontSize:"0.8rem",padding:"0.4em 0.8em",color:ce.error},children:""})]})]})}function XS(t){return t===0?ce.zero:t>0?ce.success:ce.error}function TB({category:t,balance:e,localAllocation:n,previousMonthIncome:r,isDraftMode:s,onAllocationChange:o,projectedAllTime:l}){const d=t.default_monthly_type==="percentage"&&t.default_monthly_amount!==void 0&&t.default_monthly_amount>0,h=d?t.default_monthly_amount/100*r:0,m=d?h.toFixed(2):n,p=s&&!d,g=s?l:t.balance??0,v=t.balance??0,_=v<0,S=_?Math.abs(v):0,x=d?h:parseFloat(n)||0,E=_?Math.min(x,S):0,C=_?Math.max(0,x-S):0,T=_&&x>0&&C>0;return u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",padding:"0.75rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem"},children:u.jsx("span",{style:{fontWeight:500},children:t.name})}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr 1fr 1fr",gap:"0.25rem",fontSize:"0.75rem"},children:[u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:"Start"}),u.jsx("span",{style:{color:Un(e.start_balance)},children:ii(e.start_balance)})]}),u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:"Alloc"}),p?u.jsxs(u.Fragment,{children:[u.jsx("input",{type:"text",inputMode:"decimal",value:m?`$${m}`:"",onChange:A=>{const B=A.target.value.replace(/[^\d.]/g,"");o(B)},placeholder:"$0",style:{width:"100%",maxWidth:"80px",padding:"0.25rem 0.35rem",borderRadius:"4px",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",background:"color-mix(in srgb, currentColor 8%, transparent)",fontSize:"0.8rem",color:"inherit",boxSizing:"border-box"}}),_&&x>0&&u.jsxs("div",{style:{fontSize:"0.65rem",marginTop:"0.15rem",lineHeight:1.3},children:[u.jsxs("span",{style:{color:ce.debt,display:"block"},children:[Je(E),"  debt"]}),T&&u.jsxs("span",{style:{color:ce.success,display:"block"},children:[Je(C),"  balance"]})]})]}):u.jsx("span",{style:{color:pc(e.allocated)},children:qt(e.allocated)})]}),u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:"Spent"}),u.jsx("span",{style:{color:mc(e.spent)},children:Pa(e.spent)})]}),u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:"End"}),u.jsx("span",{style:{color:Un(e.end_balance),...s&&!d?ri:{}},children:ii(e.end_balance)})]}),u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:s?"Proj. All-Time":"All-Time"}),u.jsx("span",{style:{color:Un(g),...s&&!d?ri:{}},children:ii(g)})]})]}),(e.transfers!==0||e.adjustments!==0)&&u.jsxs("div",{style:{marginTop:"0.5rem",paddingTop:"0.5rem",borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)",display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",fontSize:"0.7rem",opacity:.7},children:[e.transfers!==0&&u.jsxs("span",{style:{color:XS(e.transfers)},children:[qt(e.transfers)," transfers"]}),e.adjustments!==0&&u.jsxs("span",{style:{color:XS(e.adjustments)},children:[qt(e.adjustments)," adjust"]})]}),s&&d&&u.jsx("div",{style:{marginTop:"0.5rem"},children:u.jsxs("span",{style:{fontSize:"0.8rem"},children:[u.jsxs("span",{style:{opacity:.6},children:[Je(r),"  "]}),u.jsxs("span",{style:{color:ce.success},children:[t.default_monthly_amount,"%"]}),u.jsx("span",{style:{opacity:.6},children:" = "}),u.jsx("span",{style:{color:ce.success},children:Je(h)})]})})]})}function Uf(t){return t===0?ce.zero:t>0?ce.success:ce.error}function ZS({name:t,categories:e,groupTotals:n,getCategoryBalance:r,localAllocations:s,savedAllocations:o,previousMonthIncome:l,isDraftMode:d,onAllocationChange:h,isMobile:m,isUngrouped:p,getAllocationAmount:g}){const v={paddingTop:"0.6rem",paddingBottom:"0.6rem",paddingLeft:"0.5rem",paddingRight:"0.5rem",marginTop:"1.25rem",borderTop:"1px solid rgba(255,255,255,0.2)",borderBottom:Nf,background:"rgba(255,255,255,0.04)",display:"flex",alignItems:"center",fontSize:"0.9rem",fontWeight:600},_=n.allocated+n.spent+n.transfers+n.adjustments,S=e.reduce((x,[E,C])=>{const T=C.balance??0;if(d){const A=g(E,C),B=o[E]??0,U=A-B;return x+T+U}return x+T},0);return u.jsxs("div",{style:{display:"contents"},children:[!m&&u.jsxs(u.Fragment,{children:[u.jsxs("div",{style:{...v,paddingLeft:"0.5rem",opacity:p?.7:1},children:[u.jsx("span",{children:t}),u.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",e.length,")"]})]}),u.jsx("div",{style:{...v,justifyContent:"flex-end",color:Un(n.start)},children:wn.showGroupTotals}),u.jsx("div",{style:{...v,justifyContent:d?"center":"flex-end",color:pc(n.allocated)},children:wn.showGroupTotals}),u.jsx("div",{style:{...v,justifyContent:"flex-end",color:mc(n.spent)},children:wn.showGroupTotals}),u.jsx("div",{style:{...v,justifyContent:"flex-end",color:Uf(n.transfers)},children:wn.showGroupTotals}),u.jsx("div",{style:{...v,justifyContent:"flex-end",color:Uf(n.adjustments)},children:wn.showGroupTotals}),u.jsx("div",{style:{...v,justifyContent:"flex-end",color:Un(_)},children:wn.showGroupTotals}),u.jsx("div",{style:{...v,justifyContent:"flex-end",color:Un(n.end),paddingRight:"1rem",borderRight:"2px solid rgba(128, 128, 128, 0.4)"},children:wn.showGroupTotals}),u.jsx("div",{style:{...v,justifyContent:"flex-end",color:Un(S)},children:wn.showGroupTotals})]}),!d&&m&&u.jsxs("div",{style:{gridColumn:"1 / -1",paddingTop:"0.6rem",paddingBottom:"0.6rem",paddingLeft:"0.5rem",paddingRight:"0.5rem",marginTop:"1.25rem",borderTop:"1px solid rgba(255,255,255,0.2)",borderBottom:Nf,background:"rgba(255,255,255,0.04)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[u.jsxs("span",{style:{fontWeight:600,opacity:p?.7:1},children:[t,u.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",e.length,")"]})]}),wn.showGroupTotals]}),e.map(([x,E],C)=>{const T=r(x);if(!T)return null;const A=E.balance??0;let B=A;if(d){const U=g(x,E),G=o[x]??0,k=U-G;B=A+k}return m?u.jsx("div",{style:{gridColumn:"1 / -1"},children:u.jsx(TB,{category:E,balance:T,localAllocation:s[x]||"",previousMonthIncome:l,isDraftMode:d,onAllocationChange:U=>h(x,U),projectedAllTime:B})},x):u.jsx(AB,{category:E,balance:T,localAllocation:s[x]||"",previousMonthIncome:l,isDraftMode:d,onAllocationChange:U=>h(x,U),allTimeBalance:B,isEvenRow:C%2===0},x)})]})}function AB({category:t,balance:e,localAllocation:n,previousMonthIncome:r,isDraftMode:s,onAllocationChange:o,allTimeBalance:l,isEvenRow:d}){const h=t.default_monthly_type==="percentage"&&t.default_monthly_amount!==void 0&&t.default_monthly_amount>0,m=h?t.default_monthly_amount/100*r:0,p=h?m.toFixed(2):n,g=t.balance??0,v=g<0,_=v?Math.abs(g):0,S=h?m:parseFloat(n)||0,x=v?Math.min(S,_):0,E=v?Math.max(0,S-_):0,C=v&&S>0&&E>0,T=d?"transparent":"rgba(255,255,255,0.04)",A={paddingTop:"0.6rem",paddingBottom:"0.6rem",paddingLeft:"0.5rem",paddingRight:"0.5rem",background:T,display:"flex",alignItems:"center",fontSize:"0.9rem",minHeight:"2.4rem",boxSizing:"border-box"},B=e.allocated+e.spent+e.transfers+e.adjustments;return u.jsxs("div",{style:{display:"contents"},children:[u.jsx("div",{style:{paddingTop:"0.6rem",paddingBottom:"0.6rem",paddingRight:"0.5rem",paddingLeft:"1.5rem",background:T,display:"flex",alignItems:"center",fontSize:"0.9rem",fontWeight:500,overflow:"hidden",borderLeft:"2px solid rgba(255,255,255,0.1)",minHeight:"2.4rem",boxSizing:"border-box"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.name})}),u.jsx("div",{style:{...A,justifyContent:"flex-end",color:Un(e.start_balance)},children:ii(e.start_balance)}),s?u.jsx("div",{style:{...A,justifyContent:"center",flexDirection:"column",gap:"0.1rem",paddingTop:"0.35rem",paddingBottom:"0.35rem"},children:h?u.jsxs("span",{style:{fontSize:"0.85rem"},children:[u.jsxs("span",{style:{color:ce.success},children:[t.default_monthly_amount,"%"]}),u.jsx("span",{style:{opacity:.5},children:" = "}),u.jsx("span",{style:{color:ce.success},children:Je(m)})]}):u.jsxs(u.Fragment,{children:[u.jsx("input",{type:"text",inputMode:"decimal",value:p?`$${p}`:"",onChange:U=>{const G=U.target.value.replace(/[^\d.]/g,"");o(G)},placeholder:"$0.00",style:{width:"100px",padding:"0.2rem 0.5rem",borderRadius:"4px",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"0.9rem",lineHeight:1,color:"inherit",boxSizing:"border-box"}}),v&&S>0&&u.jsxs("div",{style:{fontSize:"0.6rem",whiteSpace:"nowrap",textAlign:"center",lineHeight:1.3,display:"flex",flexDirection:"column",alignItems:"center"},children:[u.jsxs("span",{style:{color:ce.debt},children:[Je(x),"  debt"]}),C&&u.jsxs("span",{style:{color:ce.success},children:[Je(E),"  bal"]})]})]})}):(()=>{const U=e.start_balance<0,G=U?Math.abs(e.start_balance):0,k=U?Math.min(e.allocated,G):0,D=U?Math.max(0,e.allocated-G):0,N=U&&e.allocated>0;return u.jsxs("div",{style:{...A,justifyContent:"flex-end",flexDirection:"column",alignItems:"flex-end",gap:"0.1rem",color:pc(e.allocated)},children:[u.jsxs("span",{children:["+",Je(e.allocated)]}),N&&u.jsxs("div",{style:{fontSize:"0.6rem",whiteSpace:"nowrap",textAlign:"right",lineHeight:1.3,display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[u.jsxs("span",{style:{color:ce.debt},children:[Je(k),"  debt"]}),D>0&&u.jsxs("span",{style:{color:ce.success},children:[Je(D),"  bal"]})]})]})})(),u.jsx("div",{style:{...A,justifyContent:"flex-end",color:mc(e.spent)},children:Pa(e.spent)}),u.jsx("div",{style:{...A,justifyContent:"flex-end",color:Uf(e.transfers)},children:qt(e.transfers)}),u.jsx("div",{style:{...A,justifyContent:"flex-end",color:Uf(e.adjustments)},children:qt(e.adjustments)}),u.jsx("div",{style:{...A,justifyContent:"flex-end",color:Un(B),...s&&!h?ri:{}},children:qt(B)}),u.jsx("div",{style:{...A,justifyContent:"flex-end",fontWeight:600,color:Un(e.end_balance),paddingRight:"1rem",borderRight:"2px solid rgba(128, 128, 128, 0.4)",...s&&!h?ri:{}},children:ii(e.end_balance)}),u.jsx("div",{style:{...A,justifyContent:"flex-end",color:Un(l),...s&&!h?ri:{}},children:ii(l)})]})}function jB(t,e){const{includeHidden:n=!1}={},r=Object.entries(t).filter(([,s])=>n||!s.is_hidden).reduce((s,[o,l])=>{const d=l.category_group_id||"ungrouped";return s[d]||(s[d]=[]),s[d].push([o,l]),s},{});return Object.keys(r).forEach(s=>{r[s].sort((o,l)=>o[1].sort_order-l[1].sort_order)}),r}function RB(t,e,n,r,s){const o={};t?.category_balances&&t.category_balances.forEach(d=>{o[d.category_id]=d});const l={};return Object.entries(e).forEach(([d,h])=>{const m=o[d],p=m?.start_balance??0,g=m?.spent??0;let v=0;n?v=s(d,h):r&&m&&(v=m.allocated);let _=0;t?.transfers&&t.transfers.forEach(x=>{x.to_category_id===d&&(_+=x.amount),x.from_category_id===d&&(_-=x.amount)});let S=0;t?.adjustments&&(S=t.adjustments.filter(x=>x.category_id===d).reduce((x,E)=>x+E.amount,0)),l[d]={category_id:d,start_balance:p,allocated:v,spent:g,transfers:_,adjustments:S,end_balance:p+v+g+_+S}}),l}function IB(t,e){const n={};t?.account_balances&&t.account_balances.forEach(s=>{n[s.account_id]=s});const r={};return Object.entries(e).forEach(([s,o])=>{const d=n[s]?.start_balance??o.balance;let h=0;t?.income&&(h=t.income.filter(_=>_.account_id===s).reduce((_,S)=>_+S.amount,0));let m=0;t?.expenses&&(m=t.expenses.filter(_=>_.account_id===s).reduce((_,S)=>_+S.amount,0));let p=0;t?.transfers&&t.transfers.forEach(_=>{_.to_account_id===s&&(p+=_.amount),_.from_account_id===s&&(p-=_.amount)});let g=0;t?.adjustments&&(g=t.adjustments.filter(_=>_.account_id===s).reduce((_,S)=>_+S.amount,0));const v=h+m+p+g;r[s]={account_id:s,start_balance:d,income:h,expenses:m,transfers:p,adjustments:g,net_change:v,end_balance:d+v}}),r}function DB(t){return Object.values(t).reduce((e,n)=>({start:e.start+n.start_balance,income:e.income+n.income,expenses:e.expenses+n.expenses,transfers:e.transfers+n.transfers,adjustments:e.adjustments+n.adjustments,netChange:e.netChange+n.net_change,end:e.end+n.end_balance}),{start:0,income:0,expenses:0,transfers:0,adjustments:0,netChange:0,end:0})}function kB(t){return Object.values(t).reduce((e,n)=>({start:e.start+n.start_balance,allocated:e.allocated+n.allocated,spent:e.spent+n.spent,transfers:e.transfers+n.transfers,adjustments:e.adjustments+n.adjustments,end:e.end+n.end_balance}),{start:0,allocated:0,spent:0,transfers:0,adjustments:0,end:0})}function JS(t){return t===0?ce.zero:t>0?ce.success:ce.error}function OB({isDraftMode:t,allocationsFinalized:e,balanceTotals:n,grandAllTime:r,onSave:s,onApply:o,onEdit:l,onCancel:d,onDelete:h}){const m={paddingTop:"0.6rem",paddingBottom:"0.6rem",paddingLeft:"0.5rem",paddingRight:"0.5rem",borderTop:"2px solid rgba(255,255,255,0.3)",borderBottom:"2px solid rgba(255,255,255,0.3)",fontWeight:600,display:"flex",alignItems:"center",fontSize:"0.9rem"},p=n.allocated+n.spent+n.transfers+n.adjustments;return u.jsxs(u.Fragment,{children:[u.jsxs("div",{style:{...m,gap:"0.75rem"},children:["Grand Totals",!t&&u.jsx(J0,{isDraftMode:!1,isEditingAppliedAllocations:!1,allocationsFinalized:e,onSave:s,onApply:o,onEdit:l,onCancel:d,onDelete:h})]}),u.jsx("div",{style:{...m,justifyContent:"flex-end",color:Un(n.start)},children:ii(n.start)}),u.jsxs("div",{style:{...m,justifyContent:t?"center":"flex-end",color:pc(n.allocated),...t?ri:{}},children:["+",Je(n.allocated)]}),u.jsx("div",{style:{...m,justifyContent:"flex-end",color:mc(n.spent)},children:Pa(n.spent)}),u.jsx("div",{style:{...m,justifyContent:"flex-end",color:JS(n.transfers)},children:qt(n.transfers)}),u.jsx("div",{style:{...m,justifyContent:"flex-end",color:JS(n.adjustments)},children:qt(n.adjustments)}),u.jsx("div",{style:{...m,justifyContent:"flex-end",color:Un(p),...t?ri:{}},children:qt(p)}),u.jsx("div",{style:{...m,justifyContent:"flex-end",color:Un(n.end),paddingRight:"1rem",borderRight:"2px solid rgba(128, 128, 128, 0.4)",...t?ri:{}},children:ii(n.end)}),u.jsx("div",{style:{...m,justifyContent:"flex-end",color:Un(r),...t?ri:{}},children:ii(r)})]})}function MB({allocationsFinalized:t,availableNow:e,currentMonthIncome:n,balanceTotals:r,draftChangeAmount:s,availableAfterApply:o,currentDraftTotal:l,onSave:d,onApply:h,onEdit:m,onCancel:p,onDelete:g}){return u.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem",borderTop:"2px solid rgba(255,255,255,0.3)",borderBottom:"2px solid rgba(255,255,255,0.3)"},children:[u.jsx("span",{style:{fontWeight:600},children:"Grand Totals:"}),u.jsx(fA,{isDraftMode:!1,isEditingAppliedAllocations:!1,availableNow:e,currentMonthIncome:n,balanceTotals:r,draftChangeAmount:s,availableAfterApply:o,currentDraftTotal:l}),u.jsx(J0,{isDraftMode:!1,isEditingAppliedAllocations:!1,allocationsFinalized:t,onSave:d,onApply:h,onEdit:m,onCancel:p,onDelete:g})]})}const hs={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderBottom:"2px solid rgba(255,255,255,0.2)"};function NB(t){if(!t)return"";switch(t.phase){case"reading-budget":return"Reading budget data...";case"fetching-months":return"Fetching months...";case"recalculating":return t.currentMonth?`Recalculating ${t.currentMonth}...`:"Recalculating...";case"saving":return"Saving results...";case"complete":return"Recalculation complete!";default:return"Recalculating balances..."}}function PB(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n}=zt(),{categories:r,categoryGroups:s,monthMap:o}=An(),{month:l}=As(t,e,n),d=qi(),[h,m]=O.useState(null);fd({budgetId:t,year:e,month:n,monthMap:o,requireMonthLoaded:!0,currentMonth:l,onProgress:$=>m($),logPrefix:"[MonthCategories]"});const[p,g]=O.useState(!1),{localAllocations:v,isEditingAppliedAllocations:_,error:S,availableNow:x,currentDraftTotal:E,draftChangeAmount:C,availableAfterApply:T,previousMonthIncome:A,currentMonthIncome:B,allocationsFinalized:U,getAllocationAmount:G,handleAllocationChange:k,resetAllocationsToSaved:D,handleSaveAllocations:N,handleFinalizeAllocations:F,setIsEditingAppliedAllocations:H,setError:j}=z3(),M=[...s].sort(($,te)=>$.sort_order-te.sort_order),R=O.useMemo(()=>jB(r),[r]),K=!U||_,W=O.useMemo(()=>RB(l,r,K,U,G),[l,r,K,U,G]),q=$=>W[$],J=O.useMemo(()=>kB(W),[W]),Z=O.useMemo(()=>{const $={};if(l?.category_balances)for(const te of l.category_balances)$[te.category_id]=te.allocated;return $},[l]),re=O.useMemo(()=>Object.entries(r).reduce(($,[te,se])=>{const ae=se.balance??0;if(K){const ye=G(te,se),Ie=Z[te]??0,Ee=ye-Ie;return $+ae+Ee}return $+ae},0),[r,K,G,Z]),P={onSave:N,onApply:F,onEdit:()=>H(!0),onCancel:D,onDelete:()=>g(!0)};return u.jsxs(u.Fragment,{children:[h&&u.jsxs(K0,{message:NB(h),spinnerColor:"#22c55e",children:[u.jsx(dA,{percent:h.percentComplete,gradient:"linear-gradient(90deg, #22c55e, #10b981)"}),u.jsxs("div",{style:{display:"flex",gap:"2rem",justifyContent:"center",flexWrap:"wrap"},children:[(h.totalMonthsToFetch??0)>0&&u.jsx(Lf,{value:`${h.monthsFetched||0}/${h.totalMonthsToFetch}`,label:"Months Loaded",color:h.phase==="fetching-months"?"#22c55e":"#6b7280"}),(h.totalMonths??0)>0&&u.jsx(Lf,{value:`${h.monthsProcessed}/${h.totalMonths}`,label:"Months Recalculated",color:h.phase==="recalculating"?"#22c55e":"#6b7280"})]}),u.jsx(hA,{percent:h.percentComplete})]}),S&&u.jsx(No,{message:S,onDismiss:()=>j(null)}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:d?"1fr":K?"2fr 1fr 200px 1fr 1fr 1fr 1fr 1fr 120px":"2fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 120px"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"#242424",display:d?"block":"grid",gridTemplateColumns:d?void 0:"subgrid"},children:[K&&u.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexDirection:d?"column":"row",flexWrap:"wrap",alignItems:d?"stretch":"center",gap:d?"0.5rem":"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:d?"0.5rem":"0.25rem"},children:[u.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:d?void 0:1,alignItems:"center"},children:u.jsx(fA,{isDraftMode:K,isEditingAppliedAllocations:_,availableNow:x,currentMonthIncome:B,balanceTotals:J,draftChangeAmount:C,availableAfterApply:T,currentDraftTotal:E})}),u.jsx(J0,{isDraftMode:K,isEditingAppliedAllocations:_,allocationsFinalized:U,...P})]}),!d&&u.jsxs(u.Fragment,{children:[u.jsx("div",{style:hs,children:"Category"}),u.jsx("div",{style:{...hs,textAlign:"right"},children:"Start"}),u.jsx("div",{style:{...hs,textAlign:K?"center":"right"},children:"Allocated"}),u.jsx("div",{style:{...hs,textAlign:"right"},children:"Spent"}),u.jsx("div",{style:{...hs,textAlign:"right"},children:"Transfers"}),u.jsx("div",{style:{...hs,textAlign:"right"},children:"Adjust"}),u.jsx("div",{style:{...hs,textAlign:"right"},children:"Net Change"}),u.jsx("div",{style:{...hs,textAlign:"right",paddingRight:"1rem",borderRight:"2px solid rgba(128, 128, 128, 0.4)"},children:"End"}),u.jsx("div",{style:{...hs,textAlign:"right"},children:"All-Time"})]}),!d&&u.jsx(OB,{isDraftMode:K,allocationsFinalized:U,balanceTotals:J,grandAllTime:re,...P}),!K&&d&&u.jsx(MB,{allocationsFinalized:U,availableNow:x,currentMonthIncome:B,balanceTotals:J,draftChangeAmount:C,availableAfterApply:T,currentDraftTotal:E,...P})]}),Object.keys(r).length===0&&u.jsxs("p",{style:{gridColumn:"1 / -1",opacity:.6,textAlign:"center",padding:"2rem"},children:["No categories yet. ",u.jsx(Cn,{to:"/budget/settings/categories",style:{opacity:1},children:"Create categories "})]}),M.map($=>{const te=R[$.id]||[];if(te.length===0)return null;const se=te.reduce((ae,[ye])=>{const Ie=q(ye);return Ie?{start:ae.start+Ie.start_balance,allocated:ae.allocated+Ie.allocated,spent:ae.spent+Ie.spent,transfers:ae.transfers+Ie.transfers,adjustments:ae.adjustments+Ie.adjustments,end:ae.end+Ie.end_balance}:ae},{start:0,allocated:0,spent:0,transfers:0,adjustments:0,end:0});return u.jsx(ZS,{name:$.name,categories:te,groupTotals:se,getCategoryBalance:q,localAllocations:v,savedAllocations:Z,previousMonthIncome:A,isDraftMode:K,onAllocationChange:k,isMobile:d,getAllocationAmount:G},$.id)}),R.ungrouped?.length>0&&(()=>{const $=R.ungrouped,te=$.reduce((se,[ae])=>{const ye=q(ae);return ye?{start:se.start+ye.start_balance,allocated:se.allocated+ye.allocated,spent:se.spent+ye.spent,transfers:se.transfers+ye.transfers,adjustments:se.adjustments+ye.adjustments,end:se.end+ye.end_balance}:se},{start:0,allocated:0,spent:0,transfers:0,adjustments:0,end:0});return u.jsx(ZS,{name:"Uncategorized",categories:$,groupTotals:te,getCategoryBalance:q,localAllocations:v,savedAllocations:Z,previousMonthIncome:A,isDraftMode:K,onAllocationChange:k,isMobile:d,isUngrouped:!0,getAllocationAmount:G},"ungrouped")})(),u.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]}),u.jsx(EB,{isOpen:p,onClose:()=>g(!1),onDeleted:()=>H(!1)})]})}function mA(t){return t===0?ce.zero:t>0?ce.success:ce.error}function pA(t){return t===0?ce.zero:t<0?ce.error:ce.success}function zl(t){return t===0?ce.zero:t>0?ce.success:ce.error}function e1({name:t,accounts:e,groupTotals:n,accountBalances:r,isMobile:s,isUngrouped:o}){const l={padding:"0.6rem 0.5rem",marginTop:"1.25rem",borderTop:"1px solid rgba(255,255,255,0.2)",borderBottom:Nf,background:"rgba(255,255,255,0.04)",display:"flex",alignItems:"center",fontSize:"0.9rem",fontWeight:600};return u.jsxs("div",{style:{display:"contents"},children:[!s&&u.jsxs(u.Fragment,{children:[u.jsxs("div",{style:{...l,opacity:o?.7:1},children:[u.jsx("span",{children:t}),u.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",e.length,")"]})]}),u.jsx("div",{style:{...l,justifyContent:"flex-end",color:Pt(n.start)},children:wn.showGroupTotals}),u.jsx("div",{style:{...l,justifyContent:"flex-end",color:mA(n.income)},children:wn.showGroupTotals}),u.jsx("div",{style:{...l,justifyContent:"flex-end",color:pA(n.expenses)},children:wn.showGroupTotals}),u.jsx("div",{style:{...l,justifyContent:"flex-end",color:zl(n.transfers)},children:wn.showGroupTotals}),u.jsx("div",{style:{...l,justifyContent:"flex-end",color:zl(n.adjustments)},children:wn.showGroupTotals}),u.jsx("div",{style:{...l,justifyContent:"flex-end",color:zl(n.netChange)},children:wn.showGroupTotals}),u.jsx("div",{style:{...l,justifyContent:"flex-end",color:Pt(n.end)},children:wn.showGroupTotals})]}),s&&u.jsxs("div",{style:{gridColumn:"1 / -1",padding:"0.6rem 0.5rem",marginTop:"1.25rem",borderTop:"1px solid rgba(255,255,255,0.2)",borderBottom:Nf,background:"rgba(255,255,255,0.04)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[u.jsxs("span",{style:{fontWeight:600,opacity:o?.7:1},children:[t,u.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",e.length,")"]})]}),wn.showGroupTotals]}),e.map(([d,h],m)=>{const p=r[d];return p?s?u.jsx("div",{style:{gridColumn:"1 / -1"},children:u.jsx(BB,{account:h,balance:p})},d):u.jsx(zB,{account:h,balance:p,isEvenRow:m%2===0},d):null})]})}function zB({account:t,balance:e,isEvenRow:n}){const s={padding:"0.5rem 0.5rem",background:n?"transparent":"rgba(255,255,255,0.04)",display:"flex",alignItems:"center",fontSize:"0.9rem"};return u.jsxs("div",{style:{display:"contents"},children:[u.jsx("div",{style:{...s,fontWeight:500,overflow:"hidden",paddingLeft:"1.5rem",borderLeft:"2px solid rgba(255,255,255,0.1)"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.nickname})}),u.jsx("div",{style:{...s,justifyContent:"flex-end",color:Pt(e.start_balance)},children:Je(e.start_balance)}),u.jsxs("div",{style:{...s,justifyContent:"flex-end",color:mA(e.income)},children:["+",Je(e.income)]}),u.jsx("div",{style:{...s,justifyContent:"flex-end",color:pA(e.expenses)},children:Pa(e.expenses)}),u.jsx("div",{style:{...s,justifyContent:"flex-end",color:zl(e.transfers)},children:qt(e.transfers)}),u.jsx("div",{style:{...s,justifyContent:"flex-end",color:zl(e.adjustments)},children:qt(e.adjustments)}),u.jsx("div",{style:{...s,justifyContent:"flex-end",color:zl(e.net_change)},children:qt(e.net_change)}),u.jsx("div",{style:{...s,justifyContent:"flex-end",fontWeight:600,color:Pt(e.end_balance)},children:Je(e.end_balance)})]})}function BB({account:t,balance:e}){return u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",padding:"0.75rem",marginBottom:"0.25rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem"},children:u.jsx("span",{style:{fontWeight:500},children:t.nickname})}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"0.25rem",fontSize:"0.75rem"},children:[u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:"Start"}),u.jsx("span",{children:Je(e.start_balance)})]}),u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:"Net Change"}),u.jsx("span",{style:{color:Pt(e.net_change)},children:qt(e.net_change)})]}),u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:"End"}),u.jsx("span",{style:{color:Pt(e.end_balance)},children:Je(e.end_balance)})]})]}),(e.income!==0||e.expenses!==0||e.transfers!==0||e.adjustments!==0)&&u.jsxs("div",{style:{marginTop:"0.5rem",paddingTop:"0.5rem",borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)",display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",fontSize:"0.7rem",opacity:.7},children:[e.income!==0&&u.jsxs("span",{children:[qt(e.income)," income"]}),e.expenses!==0&&u.jsxs("span",{children:[Pa(e.expenses)," expenses"]}),e.transfers!==0&&u.jsxs("span",{children:[qt(e.transfers)," transfers"]}),e.adjustments!==0&&u.jsxs("span",{children:[qt(e.adjustments)," adjust"]})]})]})}const la={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderBottom:"2px solid rgba(255,255,255,0.2)"};function LB(t){return t===0?ce.zero:t>0?ce.success:ce.error}function UB(t){return t===0?ce.zero:t<0?ce.error:ce.success}function Kg(t){return t===0?ce.zero:t>0?ce.success:ce.error}function FB(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n}=zt(),{accounts:r,accountGroups:s,monthMap:o}=An(),{month:l}=As(t,e,n),d=qi(),[h,m]=O.useState(null);fd({budgetId:t,year:e,month:n,monthMap:o,requireMonthLoaded:!0,currentMonth:l,onProgress:T=>m(T),logPrefix:"[MonthAccounts]"});const p=O.useMemo(()=>Object.entries(s).map(([T,A])=>({id:T,...A})).sort((T,A)=>T.sort_order-A.sort_order),[s]),g=O.useMemo(()=>{const T={};return Object.entries(r).filter(([,A])=>!A.is_hidden).forEach(([A,B])=>{const U=B.account_group_id||"ungrouped";T[U]||(T[U]=[]),T[U].push([A,B])}),Object.keys(T).forEach(A=>{T[A].sort((B,U)=>B[1].sort_order-U[1].sort_order)}),T},[r]),v=O.useMemo(()=>IB(l,r),[l,r]),_=O.useMemo(()=>DB(v),[v]),S=_.income+_.expenses,E={...{padding:"0.6rem 0.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem"},borderTop:"2px solid rgba(255,255,255,0.3)",borderBottom:"2px solid rgba(255,255,255,0.3)",fontWeight:600},C=()=>{if(!h)return"";switch(h.phase){case"reading-budget":return"Reading budget data...";case"fetching-months":return"Fetching months...";case"recalculating":return h.currentMonth?`Recalculating ${h.currentMonth}...`:"Recalculating...";case"saving":return"Saving results...";case"complete":return"Recalculation complete!";default:return"Recalculating balances..."}};return u.jsxs(u.Fragment,{children:[h&&u.jsxs(K0,{message:C(),spinnerColor:"#22c55e",children:[u.jsx(dA,{percent:h.percentComplete,gradient:"linear-gradient(90deg, #22c55e, #10b981)"}),u.jsxs("div",{style:{display:"flex",gap:"2rem",justifyContent:"center",flexWrap:"wrap"},children:[(h.totalMonthsToFetch??0)>0&&u.jsx(Lf,{value:`${h.monthsFetched||0}/${h.totalMonthsToFetch}`,label:"Months Loaded",color:h.phase==="fetching-months"?"#22c55e":"#6b7280"}),(h.totalMonths??0)>0&&u.jsx(Lf,{value:`${h.monthsProcessed}/${h.totalMonths}`,label:"Months Recalculated",color:h.phase==="recalculating"?"#22c55e":"#6b7280"})]}),u.jsx(hA,{percent:h.percentComplete})]}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:d?"1fr":"2fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"#242424",display:d?"block":"grid",gridTemplateColumns:d?void 0:"subgrid"},children:[!d&&u.jsxs(u.Fragment,{children:[u.jsx("div",{style:la,children:"Account"}),u.jsx("div",{style:{...la,textAlign:"right"},children:"Start"}),u.jsx("div",{style:{...la,textAlign:"right"},children:"Income"}),u.jsx("div",{style:{...la,textAlign:"right"},children:"Expenses"}),u.jsx("div",{style:{...la,textAlign:"right"},children:"Transfers"}),u.jsx("div",{style:{...la,textAlign:"right"},children:"Adjust"}),u.jsx("div",{style:{...la,textAlign:"right"},children:"Net Change"}),u.jsx("div",{style:{...la,textAlign:"right"},children:"End"})]}),d?u.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem",borderTop:"2px solid rgba(255,255,255,0.3)",borderBottom:"2px solid rgba(255,255,255,0.3)"},children:[u.jsx("span",{style:{fontWeight:600},children:"Grand Totals:"}),u.jsx(CB,{totals:_})]}):u.jsxs(u.Fragment,{children:[u.jsx("div",{style:{...E},children:"Grand Totals"}),u.jsx("div",{style:{...E,justifyContent:"flex-end",color:Pt(_.start)},children:Je(_.start)}),u.jsxs("div",{style:{...E,justifyContent:"flex-end",color:LB(_.income)},children:["+",Je(_.income)]}),u.jsx("div",{style:{...E,justifyContent:"flex-end",color:UB(_.expenses)},children:Pa(_.expenses)}),u.jsx("div",{style:{...E,justifyContent:"flex-end",color:Kg(_.transfers)},children:qt(_.transfers)}),u.jsx("div",{style:{...E,justifyContent:"flex-end",color:Kg(_.adjustments)},children:qt(_.adjustments)}),u.jsx("div",{style:{...E,justifyContent:"flex-end",color:Kg(S)},children:qt(S)}),u.jsx("div",{style:{...E,justifyContent:"flex-end",color:Pt(_.end)},children:Je(_.end)})]})]}),Object.keys(r).length===0&&u.jsxs("p",{style:{gridColumn:"1 / -1",opacity:.6,textAlign:"center",padding:"2rem"},children:["No accounts yet."," ",u.jsx(Cn,{to:"/budget/settings/accounts",style:{opacity:1},children:"Add accounts "})]}),p.map(T=>{const A=g[T.id]||[];if(A.length===0)return null;const B=A.reduce((U,[G])=>{const k=v[G];return k?{start:U.start+k.start_balance,income:U.income+k.income,expenses:U.expenses+k.expenses,transfers:U.transfers+k.transfers,adjustments:U.adjustments+k.adjustments,netChange:U.netChange+k.net_change,end:U.end+k.end_balance}:U},{start:0,income:0,expenses:0,transfers:0,adjustments:0,netChange:0,end:0});return u.jsx(e1,{name:T.name,accounts:A,groupTotals:B,accountBalances:v,isMobile:d},T.id)}),g.ungrouped?.length>0&&(()=>{const T=g.ungrouped,A=T.reduce((B,[U])=>{const G=v[U];return G?{start:B.start+G.start_balance,income:B.income+G.income,expenses:B.expenses+G.expenses,transfers:B.transfers+G.transfers,adjustments:B.adjustments+G.adjustments,netChange:B.netChange+G.net_change,end:B.end+G.end_balance}:B},{start:0,income:0,expenses:0,transfers:0,adjustments:0,netChange:0,end:0});return u.jsx(e1,{name:"Ungrouped",accounts:T,groupTotals:A,accountBalances:v,isMobile:d,isUngrouped:!0},"ungrouped")})(),u.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]})]})}const VB=["income","categories","accounts","spend","transfers","adjustments"];function t1(t){const e=t.year?parseInt(t.year,10):null,n=t.month?parseInt(t.month,10):null,r=t.tab&&VB.includes(t.tab)?t.tab:null;return{year:e&&!isNaN(e)&&e>=2e3&&e<=2100?e:null,month:n&&!isNaN(n)&&n>=1&&n<=12?n:null,tab:r}}function $B(){const t=new Date;return{year:t.getFullYear(),month:t.getMonth()+1}}function n1(){const t=W2(),e=Ku(),[n,r]=E1(),{addLoadingHold:s,removeLoadingHold:o}=nr(),{selectedBudgetId:l,setSelectedBudgetId:d,currentYear:h,currentMonthNumber:m,lastActiveTab:p,setCurrentYear:g,setCurrentMonthNumber:v,setLastActiveTab:_,setPageTitle:S,goToPreviousMonth:x,goToNextMonth:E,hasPendingInvites:C,needsFirstBudget:T}=zt(),{budget:A,isLoading:B,monthMap:U}=An(),G=!B,[k,D]=O.useState(!1);O.useEffect(()=>(G||s("budget-data","Loading budget data..."),()=>o("budget-data")),[G,s,o]);const N=O.useRef(!1),F=n.get("error"),[H,j]=O.useState(F);O.useEffect(()=>{F&&(n.delete("error"),r(n,{replace:!0}))},[F,n,r]);const[M,R]=O.useState(()=>{const{tab:P}=t1(t);return P??p}),K=P=>{R(P),_(P)};O.useEffect(()=>{if(N.current)return;const{year:P,month:$}=t1(t);P&&g(P),$&&v($),N.current=!0},[t,g,v]),O.useEffect(()=>{if(!N.current)return;const P=`/budget/${h}/${m}/${M}`,$=`/budget/${t.year}/${t.month}/${t.tab}`;P!==$&&e(P,{replace:!0})},[h,m,M,e,t]);const{month:W,error:q,isLoading:J}=As(G?l:null,h,m);if(O.useEffect(()=>{if(!q||k)return;const P=q.message||"";if(P.includes("Budget")&&P.includes("does not exist")){queueMicrotask(()=>{d(null),e("/budget/my-budgets?context=budget-not-found",{replace:!0})});return}(P.includes("months in the past")||P.includes("Refusing to create month"))&&queueMicrotask(()=>{s("month-redirect","Redirecting to current month..."),D(!0);const{year:$,month:te}=$B();j(`Cannot create month ${h}/${m} - it's too far in the past. Redirected to current month.`),g($),v(te)})},[q,k,h,m,g,v,s,d,e]),O.useEffect(()=>{k&&W&&!J&&queueMicrotask(()=>{D(!1),o("month-redirect")})},[k,W,J,o]),O.useLayoutEffect(()=>{S(A?.name||"Budget")},[A?.name,S]),O.useEffect(()=>{if(G&&!k){if(!A&&!l){e("/budget/my-budgets",{replace:!0});return}if(!A&&C){e("/budget/my-budgets",{replace:!0});return}if(T){e("/budget/my-budgets",{replace:!0});return}}},[G,k,A,l,C,T,e]),fd({budgetId:l,year:h,month:m,monthMap:U,additionalCondition:G&&!!A,logPrefix:"[Budget]"}),!G||k||!A)return null;function Z(){j(null),x()}function re(){j(null),E()}return u.jsxs(u.Fragment,{children:[H&&u.jsx(No,{message:H,onDismiss:()=>j(null)}),u.jsx(cB,{onPreviousMonth:Z,onNextMonth:re}),u.jsx(Xz,{activeTab:M,setActiveTab:K,allocationsFinalized:W?.are_allocations_finalized}),M==="income"&&u.jsx(mB,{},`${h}-${m}`),M==="categories"&&u.jsx(PB,{},`${h}-${m}`),M==="accounts"&&u.jsx(FB,{},`${h}-${m}`),M==="spend"&&u.jsx(gB,{},`${h}-${m}`),M==="transfers"&&u.jsx(xB,{},`${h}-${m}`),M==="adjustments"&&u.jsx(SB,{},`${h}-${m}`)]})}function HB(){const{setPageTitle:t}=zt();return O.useLayoutEffect(()=>{t("Analytics")},[t]),u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"50vh",textAlign:"center",gap:"1.5rem"},children:[u.jsx("div",{style:{fontSize:"4rem",opacity:.8},children:""}),u.jsx("h1",{style:{margin:0,fontSize:"2rem",fontWeight:600},children:"Analytics"}),u.jsx("p",{style:{margin:0,fontSize:"1.25rem",opacity:.6,maxWidth:"400px"},children:"Coming Soon"}),u.jsx("p",{style:{margin:0,fontSize:"0.95rem",opacity:.5,maxWidth:"500px",lineHeight:1.6},children:"Track spending trends, category breakdowns, and insights about your budget over time."}),u.jsx(Cn,{to:"/budget",style:{marginTop:"1rem",padding:"0.75rem 1.5rem",background:ce.primary,color:"white",borderRadius:"8px",textDecoration:"none",fontWeight:500,transition:"opacity 0.15s"},children:"Back to Budget"})]})}function qB(){const t=ln();return{createBudget:$n({mutationFn:async({name:n,userId:r,userEmail:s})=>{const o=`budget_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,l=new Date().toISOString(),d={name:n.trim()||"My Budget",user_ids:[r],accepted_user_ids:[r],owner_id:r,owner_email:s,accounts:{},account_groups:{},categories:{},category_groups:[],total_available:0,is_needs_recalculation:!1,month_map:{},created_at:l,updated_at:l};return await tn("budgets",o,d,"creating new budget document"),await tn("users",r,{uid:r,email:s,budget_ids:Uu(o),updated_at:l},"adding new budget to user's budget list",{merge:!0}),{budgetId:o,budget:{id:o,...d}}},onSuccess:(n,{userId:r})=>{t.invalidateQueries({queryKey:Pe.user(r)}),t.invalidateQueries({queryKey:Pe.accessibleBudgets(r)})}})}}function GB(){const t=ln();return{acceptInvite:$n({mutationFn:async({budgetId:n,userId:r})=>{const s=new Date().toISOString(),{exists:o,data:l}=await bt("budgets",n,"validating user was invited to this budget");if(!o||!l)throw new Error("Budget not found");if(!l.user_ids?.includes(r))throw new Error("You have not been invited to this budget");if(l.accepted_user_ids?.includes(r))throw new Error("You have already accepted this invite");return await tn("users",r,{uid:r,budget_ids:Uu(n),updated_at:s},"adding accepted budget to user's budget list",{merge:!0}),await tn("budgets",n,{accepted_user_ids:Uu(r),updated_at:s},"marking user as accepted in budget's accepted_user_ids",{merge:!0}),{budgetId:n}},onSuccess:(n,{userId:r})=>{t.invalidateQueries({queryKey:Pe.user(r)}),t.invalidateQueries({queryKey:Pe.accessibleBudgets(r)}),t.invalidateQueries({queryKey:Pe.budget(n.budgetId)})}})}}function WB(){const t=ln(),e=$n({onMutate:async r=>{const{budgetId:s,userId:o}=r,l=Pe.budget(s);await t.cancelQueries({queryKey:l});const d=t.getQueryData(l);return d&&t.setQueryData(l,{...d,budget:{...d.budget,user_ids:[...d.budget.user_ids,o]}}),{previousData:d}},mutationFn:async r=>{const{budgetId:s,userId:o}=r,{exists:l,data:d}=await bt("budgets",s,"validating user is not already invited");if(!l||!d)throw new Error("Budget not found");if(d.user_ids?.includes(o))throw new Error("User is already invited");return await Mo({budgetId:s,updates:{user_ids:Uu(o)},description:"adding user to budget's invited users list"}),{budgetId:s}},onError:(r,s,o)=>{o?.previousData&&t.setQueryData(Pe.budget(s.budgetId),o.previousData)}});return{inviteUser:{mutate:r=>e.mutate(r),mutateAsync:r=>e.mutateAsync(r),isPending:e.isPending,isError:e.isError,error:e.error,reset:e.reset}}}function QB(){const t=ln(),e=$n({onMutate:async r=>{const{budgetId:s,userId:o}=r,l=Pe.budget(s);await t.cancelQueries({queryKey:l});const d=t.getQueryData(l);return d&&t.setQueryData(l,{...d,budget:{...d.budget,user_ids:d.budget.user_ids.filter(h=>h!==o),accepted_user_ids:d.budget.accepted_user_ids.filter(h=>h!==o)}}),{previousData:d}},mutationFn:async r=>{const{budgetId:s,userId:o}=r;return await Mo({budgetId:s,updates:{user_ids:TS(o),accepted_user_ids:TS(o)},description:"removing user from budget's access lists"}),{budgetId:s}},onError:(r,s,o)=>{o?.previousData&&t.setQueryData(Pe.budget(s.budgetId),o.previousData)}});return{revokeUser:{mutate:r=>e.mutate(r),mutateAsync:r=>e.mutateAsync(r),isPending:e.isPending,isError:e.isError,error:e.error,reset:e.reset}}}function KB({message:t,onDismiss:e}){return u.jsxs("div",{style:{background:"rgba(220, 38, 38, 0.1)",border:"1px solid rgba(220, 38, 38, 0.3)",color:"#f87171",padding:"0.75rem 1rem",borderRadius:"8px",marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[u.jsx("span",{children:t}),u.jsx("button",{onClick:e,style:{background:"transparent",border:"none",color:"#f87171",cursor:"pointer",fontSize:"1.2rem",padding:"0 0.25rem",lineHeight:1},children:""})]})}function YB({message:t,onDismiss:e}){return u.jsxs("div",{style:{background:"rgba(34, 197, 94, 0.1)",border:"1px solid rgba(34, 197, 94, 0.3)",color:"#4ade80",padding:"0.75rem 1rem",borderRadius:"8px",marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[u.jsx("span",{children:t}),u.jsx("button",{onClick:e,style:{background:"transparent",border:"none",color:"#4ade80",cursor:"pointer",fontSize:"1.2rem",padding:"0 0.25rem",lineHeight:1},children:""})]})}function XB({budgetIdInput:t,setBudgetIdInput:e,isCheckingManual:n,manualInvite:r,isAccepting:s,onCheckInvite:o,onAcceptInvite:l,onCancel:d}){return u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px"},children:[u.jsxs("h3",{style:{margin:"0 0 0.75rem 0",fontSize:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{children:""})," Join Budget by ID"]}),u.jsx("p",{style:{margin:"0 0 1rem 0",fontSize:"0.9rem",opacity:.7},children:"If someone shared a budget ID with you, enter it below to accept the invitation:"}),r?u.jsxs("div",{style:{background:"color-mix(in srgb, #22c55e 10%, transparent)",border:"1px solid color-mix(in srgb, #22c55e 30%, transparent)",padding:"1rem",borderRadius:"8px"},children:[u.jsx("p",{style:{margin:"0 0 0.75rem 0",fontWeight:500},children:" You've been invited to join:"}),u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 8%, transparent)",padding:"0.75rem 1rem",borderRadius:"6px",marginBottom:"1rem"},children:[u.jsx("p",{style:{margin:"0 0 0.25rem 0",fontWeight:600,fontSize:"1.1rem"},children:r.budgetName}),r.ownerEmail&&u.jsxs("p",{style:{margin:0,fontSize:"0.9rem",opacity:.7},children:["Owner: ",r.ownerEmail]})]}),u.jsxs("div",{style:{display:"flex",gap:"0.75rem"},children:[u.jsx("button",{onClick:l,disabled:s===r.budgetId,style:{background:"#22c55e",color:"white",border:"none",padding:"0.6rem 1.25rem",borderRadius:"6px",cursor:s===r.budgetId?"not-allowed":"pointer",fontWeight:500,opacity:s===r.budgetId?.7:1},children:s===r.budgetId?"Accepting...":"Accept Invitation"}),u.jsx("button",{onClick:d,disabled:s===r.budgetId,style:{background:"transparent",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)",padding:"0.6rem 1.25rem",borderRadius:"6px",cursor:s===r.budgetId?"not-allowed":"pointer",fontWeight:500,opacity:s===r.budgetId?.7:.8},children:"Cancel"})]})]}):u.jsxs("form",{onSubmit:o,style:{display:"flex",gap:"0.75rem"},children:[u.jsx("input",{type:"text",value:t,onChange:h=>e(h.target.value),placeholder:"Enter Budget ID",style:{flex:1,padding:"0.6rem 0.8rem",borderRadius:"6px",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"0.95rem",color:"inherit"}}),u.jsx("button",{type:"submit",disabled:n||!t.trim(),style:{background:"#646cff",color:"white",border:"none",padding:"0.6rem 1.25rem",borderRadius:"6px",cursor:n||!t.trim()?"not-allowed":"pointer",fontWeight:500,opacity:n||!t.trim()?.7:1,whiteSpace:"nowrap"},children:n?"Checking...":"Check Invite"})]})]})}function ZB({currentUserId:t}){return u.jsxs("div",{style:{marginTop:"1.5rem",padding:"1rem",background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"6px",fontSize:"0.85rem",opacity:.7},children:[u.jsx("p",{style:{margin:"0 0 0.5rem 0"},children:" Share your User ID with budget owners so they can invite you:"}),u.jsx("code",{style:{display:"block",padding:"0.5rem 0.75rem",background:"color-mix(in srgb, currentColor 8%, transparent)",borderRadius:"4px",fontSize:"0.8rem",wordBreak:"break-all"},children:t})]})}function JB(){const{addLoadingHold:t,removeLoadingHold:e}=nr(),{selectedBudgetId:n,currentUserId:r,accessibleBudgets:s,loadAccessibleBudgets:o,switchToBudget:l,checkBudgetInvite:d,isInitialized:h,setPageTitle:m,needsFirstBudget:p}=zt(),{requireUserEmail:g}=Da(),v=O.useRef(!1),[_,S]=E1(),x=_.get("context");O.useEffect(()=>{x&&(_.delete("context"),S(_,{replace:!0}))},[x,_,S]);const E=x==="budget-not-found",C=p&&s.length===0;O.useLayoutEffect(()=>{m("My Budgets")},[m]),O.useEffect(()=>{h&&!v.current&&(v.current=!0,o())},[h,o]);const{budget:T,isLoading:A}=An(),{renameBudget:B}=M3(),{acceptInvite:U}=GB(),{createBudget:G}=qB(),[k,D]=O.useState(null),[N,F]=O.useState(null),[H,j]=O.useState(null),[M,R]=O.useState(null),[K,W]=O.useState(null),[q,J]=O.useState(""),[Z,re]=O.useState(!1),[P,$]=O.useState(""),[te,se]=O.useState(!1),[ae,ye]=O.useState(null),[Ie,Ee]=O.useState(""),[Ce,pe]=O.useState(!1);async function Ue(oe){if(oe!==T?.id){D(oe),j(null),R(null);try{await l(oe),R("Switched to budget successfully!"),await o({force:!0})}catch(Ae){j(Ae instanceof Error?Ae.message:"Failed to switch budget")}finally{D(null)}}}async function He(oe){if(r){F(oe),j(null),R(null);try{await U.mutateAsync({budgetId:oe,userId:r}),R("Invitation accepted! You now have access to this budget."),await o({force:!0})}catch(Ae){j(Ae instanceof Error?Ae.message:"Failed to accept invitation")}finally{F(null)}}}async function Me(oe){if(oe.preventDefault(),!!P.trim()){se(!0),j(null),ye(null);try{const Ae=await d(P.trim());Ae?ye(Ae):j("No pending invitation found for this budget ID. Make sure you've been invited by the budget owner.")}catch(Ae){j(Ae instanceof Error?Ae.message:"Failed to check invitation")}finally{se(!1)}}}async function L(){if(!(!ae||!r)){ae.budgetName,F(ae.budgetId),j(null);try{await U.mutateAsync({budgetId:ae.budgetId,userId:r}),R(`Successfully joined "${ae.budgetName}"!`),ye(null),$(""),await o({force:!0})}catch(oe){j(oe instanceof Error?oe.message:"Failed to accept invitation")}finally{F(null)}}}function be(oe,Ae){J(Ae),W(oe)}async function me(oe){if(oe.preventDefault(),!(!q.trim()||!K||!n)){q.trim(),re(!0),j(null),R(null);try{await B.mutateAsync({budgetId:n,newName:q.trim()}),R("Budget renamed successfully!"),W(null),await o({force:!0})}catch(Ae){j(Ae instanceof Error?Ae.message:"Failed to rename budget")}finally{re(!1)}}}async function ee(oe){if(oe.preventDefault(),!!r){Ie.trim(),pe(!0),j(null),R(null);try{const Ae=await G.mutateAsync({name:Ie.trim()||"My Budget",userId:r,userEmail:g()});await l(Ae.budgetId),R("Budget created successfully!"),Ee(""),await o({force:!0})}catch(Ae){j(Ae instanceof Error?Ae.message:"Failed to create budget")}finally{pe(!1)}}}const X=s.filter(oe=>!oe.isPending),ie=s.filter(oe=>oe.isPending);if(O.useEffect(()=>(A||!h?t("my-budgets","Loading your budgets..."):e("my-budgets"),()=>e("my-budgets")),[A,h,t,e]),A||!h)return null;let we="My Budgets",xe="Switch between budgets, accept invitations, or create a new budget.";return E?(we="Budget Not Found",xe="Your selected budget could not be found. It may have been deleted. Select another budget or create a new one."):C&&(we="Welcome!",xe="Get started by creating your first budget or accepting an invitation."),u.jsxs("div",{children:[u.jsx("h1",{children:we}),u.jsx("p",{style:{opacity:.7,marginBottom:"1.5rem"},children:xe}),H&&u.jsx(KB,{message:H,onDismiss:()=>j(null)}),M&&u.jsx(YB,{message:M,onDismiss:()=>R(null)}),ie.length>0&&u.jsxs("div",{style:{background:"color-mix(in srgb, #f59e0b 10%, transparent)",border:"1px solid color-mix(in srgb, #f59e0b 30%, transparent)",padding:"1.25rem",borderRadius:"8px",marginBottom:"1.5rem"},children:[u.jsxs("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{children:""})," Pending Invitations (",ie.length,")"]}),u.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:ie.map(oe=>u.jsx(US,{budget:oe,isCurrent:!1,isAccepting:N===oe.id,isSwitching:!1,isEditing:!1,editName:"",isRenaming:!1,onAccept:()=>He(oe.id),onSwitch:()=>{},onStartEdit:()=>{},onCancelEdit:()=>{},onEditNameChange:()=>{},onSaveEdit:()=>{}},oe.id))})]}),X.length>0&&u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px",marginBottom:"1.5rem"},children:[u.jsxs("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{children:""})," Your Budgets (",X.length,")"]}),u.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:X.map(oe=>u.jsx(US,{budget:oe,isCurrent:oe.id===n,isAccepting:!1,isSwitching:k===oe.id,isEditing:K===oe.id,editName:K===oe.id?q:"",isRenaming:Z,onAccept:()=>{},onSwitch:()=>Ue(oe.id),onStartEdit:()=>be(oe.id,oe.name),onCancelEdit:()=>{W(null),J("")},onEditNameChange:J,onSaveEdit:me},oe.id))})]}),u.jsxs("div",{style:{background:"color-mix(in srgb, #646cff 8%, transparent)",border:"1px solid color-mix(in srgb, #646cff 25%, transparent)",padding:"1.5rem",borderRadius:"8px",marginBottom:"1.5rem"},children:[u.jsxs("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{children:""})," Create New Budget"]}),u.jsxs("form",{onSubmit:ee,children:[u.jsxs("div",{style:{marginBottom:"1rem"},children:[u.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.9rem",opacity:.8},children:"Budget Name"}),u.jsx("input",{type:"text",value:Ie,onChange:oe=>Ee(oe.target.value),placeholder:"My Budget",style:{width:"100%",padding:"0.6rem 0.8rem",borderRadius:"6px",border:"1px solid color-mix(in srgb, currentColor 25%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"0.95rem",color:"inherit",boxSizing:"border-box"}}),u.jsx("p",{style:{margin:"0.5rem 0 0 0",fontSize:"0.8rem",opacity:.5},children:"You can always rename this later"})]}),u.jsx("button",{type:"submit",disabled:Ce,style:{background:ce.primary,color:"white",border:"none",padding:"0.6rem 1.5rem",borderRadius:"6px",cursor:Ce?"not-allowed":"pointer",fontWeight:500,opacity:Ce?.7:1,fontSize:"0.9rem"},children:Ce?"Creating...":"Create Budget"})]})]}),u.jsx(XB,{budgetIdInput:P,setBudgetIdInput:$,isCheckingManual:te,manualInvite:ae,isAccepting:N,onCheckInvite:Me,onAcceptInvite:L,onCancel:()=>{ye(null),$("")}}),r&&u.jsx(ZB,{currentUserId:r})]})}const eL=["accounts","categories","users"];function tL(){const{addLoadingHold:t,removeLoadingHold:e}=nr(),{lastSettingsTab:n,setLastSettingsTab:r,setPageTitle:s}=zt();O.useLayoutEffect(()=>{s("Budget Settings")},[s]);const{isOwner:o,isLoading:l}=An();O.useEffect(()=>(l?t("settings","Loading settings..."):e("settings"),()=>e("settings")),[l,t,e]);const d=Vn(),h=d.pathname==="/budget/settings",m=O.useMemo(()=>{const S=d.pathname;return S.includes("/settings/accounts")?"accounts":S.includes("/settings/categories")?"categories":S.includes("/settings/users")?"users":"categories"},[d.pathname]),p=m==="users";O.useEffect(()=>{h||r(m)},[m,h,r]);function g(){return!eL.includes(n)||n==="users"&&!o?"categories":n}const v=O.useMemo(()=>[{id:"accounts",label:"Accounts",icon:""},{id:"categories",label:"Categories",icon:""},{id:"users",label:"Users",icon:"",hidden:!o}],[o]);return l?null:!o&&p?u.jsxs("div",{children:[u.jsx("h1",{children:"Access Denied"}),u.jsx("p",{style:{opacity:.7},children:"Only the budget owner can access this section."}),u.jsx("p",{style:{marginTop:"1rem"},children:u.jsx(Cn,{to:"/budget/settings/categories",children:"Go to Categories "})})]}):u.jsxs("div",{children:[u.jsx(Bf,{mode:"link",linkPrefix:"/budget/settings",tabs:v,activeTab:h?g():m}),h?u.jsx(Vf,{to:`/budget/settings/${g()}`,replace:!0}):u.jsx(cA,{children:u.jsx($f,{})})]})}function Gu({initialData:t,onSubmit:e,onCancel:n,submitLabel:r,accountGroups:s,showGroupSelector:o=!1,showIncomeSettings:l=!1,hasExistingIncomeDefault:d=!1,hasExistingOutgoDefault:h=!1,currentGroupId:m}){const[p,g]=O.useState(t||{nickname:"",account_group_id:null,is_income_account:!1,is_income_default:!1,is_outgo_account:!1,is_outgo_default:!1,on_budget:!0,is_active:!0,is_hidden:!1}),v=p.account_group_id||m,_=v?s.find(A=>A.id===v):null,S=_?.is_active!==void 0,x=_?.on_budget!==void 0;function E(A){A.preventDefault(),p.nickname.trim()&&e(p)}function C(A){g({...p,is_income_account:A,is_income_default:A?p.is_income_default:!1})}function T(A){g({...p,is_outgo_account:A,is_outgo_default:A?p.is_outgo_default:!1})}return u.jsxs(Es,{actionName:r==="Create Account"?"Create Account":"Update Account",onSubmit:E,children:[u.jsx(Mt,{label:"Account Nickname",htmlFor:"account-nickname",children:u.jsx(Cs,{id:"account-nickname",type:"text",value:p.nickname,onChange:A=>g({...p,nickname:A.target.value}),placeholder:"e.g., Main Checking, Savings",required:!0,autoFocus:!0})}),o&&u.jsx(Mt,{label:"Account Type",htmlFor:"account-group",children:u.jsxs(Hu,{id:"account-group",value:p.account_group_id||"ungrouped",onChange:A=>g({...p,account_group_id:A.target.value==="ungrouped"?null:A.target.value}),children:[u.jsx("option",{value:"ungrouped",children:"Ungrouped"}),s.map(A=>u.jsx("option",{value:A.id,children:A.name},A.id))]})}),l&&u.jsxs("div",{style:{padding:"0.75rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",display:"flex",flexDirection:"column",gap:"0.75rem"},children:[u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[u.jsx("p",{style:{margin:0,fontSize:"0.85rem",opacity:.7},children:"Account Status"}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[u.jsx(Ur,{id:"is-active",checked:S?_.is_active:p.is_active!==!1,onChange:A=>g({...p,is_active:A.target.checked}),disabled:S,children:u.jsx("span",{style:{opacity:S?.5:1},children:"Active account"})}),S&&u.jsxs("p",{style:{margin:0,fontSize:"0.7rem",opacity:.6,marginLeft:"2rem",color:ce.warning},children:['Set by account type "',_.name,'"']})]}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[u.jsx(Ur,{id:"on-budget",checked:x?_.on_budget:p.on_budget!==!1,onChange:A=>g({...p,on_budget:A.target.checked}),disabled:x,children:u.jsx("span",{style:{opacity:x?.5:1},children:"On budget (affects budget totals)"})}),x&&u.jsxs("p",{style:{margin:0,fontSize:"0.7rem",opacity:.6,marginLeft:"2rem",color:ce.warning},children:['Set by account type "',_.name,'"']})]}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[u.jsx(Ur,{id:"is-hidden",checked:p.is_hidden||!1,onChange:A=>g({...p,is_hidden:A.target.checked}),children:"Hidden account"}),u.jsx("p",{style:{margin:0,fontSize:"0.7rem",opacity:.6,marginLeft:"2rem"},children:"Hidden accounts don't appear in dropdowns or balance displays. Use for historical accounts that aren't actively used."})]})]}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[u.jsx("p",{style:{margin:0,fontSize:"0.85rem",opacity:.7},children:"Income Settings"}),u.jsx(Ur,{id:"is-income-account",checked:p.is_income_account||!1,onChange:A=>C(A.target.checked),children:"Show in income deposit list"}),p.is_income_account&&u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem",marginLeft:"2rem"},children:[u.jsx(Ur,{id:"is-income-default",checked:p.is_income_default||!1,onChange:A=>g({...p,is_income_default:A.target.checked}),disabled:d&&!t?.is_income_default,children:"Default account for new income"}),d&&!t?.is_income_default&&u.jsx("p",{style:{margin:0,fontSize:"0.75rem",opacity:.5},children:"Another account is already set as default"})]})]}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[u.jsx("p",{style:{margin:0,fontSize:"0.85rem",opacity:.7},children:"Expense Settings"}),u.jsx(Ur,{id:"is-outgo-account",checked:p.is_outgo_account||!1,onChange:A=>T(A.target.checked),children:"Show in expense account list"}),p.is_outgo_account&&u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem",marginLeft:"2rem"},children:[u.jsx(Ur,{id:"is-outgo-default",checked:p.is_outgo_default||!1,onChange:A=>g({...p,is_outgo_default:A.target.checked}),disabled:h&&!t?.is_outgo_default,children:"Default account for new expenses"}),h&&!t?.is_outgo_default&&u.jsx("p",{style:{margin:0,fontSize:"0.75rem",opacity:.5},children:"Another account is already set as default"})]})]})]}),u.jsxs(Na,{children:[u.jsx(Ve,{type:"submit",actionName:r,children:r}),u.jsx(Ve,{type:"button",variant:"secondary",actionName:"Cancel Account Form",onClick:n,children:"Cancel"})]})]})}function r1({label:t,value:e,onChange:n,trueLabel:r,falseLabel:s,undefinedLabel:o}){function l(){n(e===void 0?!0:e===!0?!1:void 0)}const d=e===!0?r:e===!1?s:o,h=e===!0?ce.success:e===!1?ce.warning:"inherit",m=e===!0?"":e===!1?"":"";return u.jsxs("button",{type:"button",onClick:l,style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 0.75rem",background:e!==void 0?`color-mix(in srgb, ${h} 15%, transparent)`:"color-mix(in srgb, currentColor 8%, transparent)",border:e!==void 0?`1px solid color-mix(in srgb, ${h} 40%, transparent)`:"1px solid color-mix(in srgb, currentColor 20%, transparent)",borderRadius:"6px",cursor:"pointer",fontSize:"0.85rem",color:"inherit",textAlign:"left",width:"100%"},children:[u.jsx("span",{style:{width:"1.25rem",height:"1.25rem",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"4px",background:e!==void 0?h:"color-mix(in srgb, currentColor 20%, transparent)",color:e!==void 0?"white":"inherit",fontWeight:600,fontSize:"0.75rem"},children:m}),u.jsxs("span",{style:{flex:1},children:[u.jsxs("span",{style:{opacity:.7},children:[t,":"]})," ",u.jsx("span",{style:{fontWeight:500,color:h},children:d})]}),u.jsx("span",{style:{fontSize:"0.7rem",opacity:.5},children:"click to cycle"})]})}function gA({initialData:t,onSubmit:e,onCancel:n,submitLabel:r}){const[s,o]=O.useState(t||{name:"",expected_balance:"positive"});function l(d){d.preventDefault(),s.name.trim()&&e(s)}return u.jsxs(Es,{actionName:r==="Create Account Type"?"Create Account Type":"Update Account Type",onSubmit:l,children:[u.jsx(Mt,{label:"Account Type Name",htmlFor:"group-name",children:u.jsx(Cs,{id:"group-name",type:"text",value:s.name,onChange:d=>o({...s,name:d.target.value}),placeholder:"e.g., Checking, Savings, Credit Cards, Investments",required:!0,autoFocus:!0})}),u.jsx(Mt,{label:"Expected Balance",htmlFor:"expected-balance",children:u.jsxs(Hu,{id:"expected-balance",value:s.expected_balance,onChange:d=>o({...s,expected_balance:d.target.value}),children:[u.jsx("option",{value:"positive",children:"Normally Positive (e.g., Checking, Savings)"}),u.jsx("option",{value:"negative",children:"Normally Negative (e.g., Credit Cards, Loans)"}),u.jsx("option",{value:"any",children:"Either (no warnings)"})]})}),u.jsxs("div",{style:{padding:"0.75rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",display:"flex",flexDirection:"column",gap:"0.5rem"},children:[u.jsxs("p",{style:{margin:0,fontSize:"0.85rem",opacity:.7},children:["Group-Level Overrides ",u.jsx("span",{style:{fontSize:"0.75rem",opacity:.6},children:"(applies to all accounts in this type)"})]}),u.jsx(r1,{label:"Active status",value:s.is_active,onChange:d=>o({...s,is_active:d}),trueLabel:"All active",falseLabel:"All inactive",undefinedLabel:"Per account"}),u.jsx(r1,{label:"Budget status",value:s.on_budget,onChange:d=>o({...s,on_budget:d}),trueLabel:"All on budget",falseLabel:"All off budget",undefinedLabel:"Per account"})]}),u.jsxs(Na,{children:[u.jsx(Ve,{type:"submit",actionName:r,children:r}),u.jsx(Ve,{type:"button",variant:"secondary",actionName:"Cancel Account Type Form",onClick:n,children:"Cancel"})]})]})}function Cl({icon:t,label:e,variant:n,title:r}){const o={success:{background:`color-mix(in srgb, ${ce.success} 20%, transparent)`,border:`1px solid color-mix(in srgb, ${ce.success} 40%, transparent)`,color:ce.success,opacity:1},warning:{background:`color-mix(in srgb, ${ce.warning} 15%, transparent)`,border:`1px solid color-mix(in srgb, ${ce.warning} 35%, transparent)`,color:ce.warning,opacity:1},muted:{background:"color-mix(in srgb, currentColor 12%, transparent)",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",color:"inherit",opacity:.7},income:{background:`color-mix(in srgb, ${ce.success} 10%, transparent)`,border:`1px solid color-mix(in srgb, ${ce.success} 25%, transparent)`,color:ce.success,opacity:.7},expense:{background:`color-mix(in srgb, ${ce.warning} 10%, transparent)`,border:`1px solid color-mix(in srgb, ${ce.warning} 25%, transparent)`,color:ce.warning,opacity:.7}}[n];return u.jsxs("span",{title:r||e,style:{display:"inline-flex",alignItems:"center",gap:"0.25rem",background:o.background,border:o.border,padding:"0.15rem 0.4rem",borderRadius:"4px",fontSize:"0.7rem",fontWeight:500,textTransform:"uppercase",letterSpacing:"0.3px",color:o.color,opacity:o.opacity,whiteSpace:"nowrap"},children:[u.jsx("span",{style:{fontSize:"0.75rem"},children:t}),e]})}function yA({account:t,accountGroups:e}){const n=[],r=t.account_group_id?e.find(l=>l.id===t.account_group_id):null,s=r?.is_active!==void 0?r.is_active:t.is_active!==!1,o=r?.on_budget!==void 0?r.on_budget:t.on_budget!==!1;if(!s){const l=r?.is_active!==void 0;n.push(u.jsx(Cl,{icon:"",label:l?"Inactive (type)":"Inactive",variant:"warning",title:l?`Set by "${r.name}" account type`:"Account is inactive/archived"},"inactive"))}if(!o){const l=r?.on_budget!==void 0;n.push(u.jsx(Cl,{icon:"",label:l?"Off Budget (type)":"Off Budget",variant:"warning",title:l?`Set by "${r.name}" account type`:"Tracking only - not included in budget"},"off-budget"))}return t.is_income_default?n.push(u.jsx(Cl,{icon:"",label:"Income Default",variant:"success",title:"Default income deposit account"},"income-default")):t.is_income_account&&n.push(u.jsx(Cl,{icon:"",label:"Income",variant:"income",title:"Income deposit account"},"income")),t.is_outgo_default?n.push(u.jsx(Cl,{icon:"",label:"Expense Default",variant:"warning",title:"Default expense account"},"outgo-default")):t.is_outgo_account&&n.push(u.jsx(Cl,{icon:"",label:"Expense",variant:"expense",title:"Expense account"},"outgo")),n.length===0?null:u.jsx(u.Fragment,{children:n})}function nL({group:t}){const e=[];return t.is_active===!1?e.push(u.jsx("span",{style:{fontSize:"0.65rem",fontWeight:500,padding:"0.15rem 0.35rem",borderRadius:"4px",background:`color-mix(in srgb, ${ce.warning} 20%, transparent)`,color:ce.warning,whiteSpace:"nowrap"},title:"All accounts in this type are inactive",children:"All Inactive"},"inactive")):t.is_active===!0&&e.push(u.jsx("span",{style:{fontSize:"0.65rem",fontWeight:500,padding:"0.15rem 0.35rem",borderRadius:"4px",background:`color-mix(in srgb, ${ce.success} 20%, transparent)`,color:ce.success,whiteSpace:"nowrap"},title:"All accounts in this type are active",children:"All Active"},"active")),t.on_budget===!1?e.push(u.jsx("span",{style:{fontSize:"0.65rem",fontWeight:500,padding:"0.15rem 0.35rem",borderRadius:"4px",background:`color-mix(in srgb, ${ce.warning} 20%, transparent)`,color:ce.warning,whiteSpace:"nowrap"},title:"All accounts in this type are off budget",children:"All Off Budget"},"off-budget")):t.on_budget===!0&&e.push(u.jsx("span",{style:{fontSize:"0.65rem",fontWeight:500,padding:"0.15rem 0.35rem",borderRadius:"4px",background:`color-mix(in srgb, ${ce.success} 20%, transparent)`,color:ce.success,whiteSpace:"nowrap"},title:"All accounts in this type are on budget",children:"All On Budget"},"on-budget")),e.length===0?null:u.jsx(u.Fragment,{children:e})}function _A({isActive:t,onDragOver:e,onDragLeave:n,onDrop:r}){return u.jsxs("div",{onDragOver:e,onDragLeave:n,onDrop:r,style:{position:"relative",height:"2rem",marginTop:"-0.25rem"},children:[u.jsx("div",{style:{position:"absolute",top:"50%",left:0,right:0,height:"3px",background:ce.primary,borderRadius:"2px",opacity:t?1:.3,transition:"opacity 0.15s",boxShadow:t?"0 0 8px rgba(100, 108, 255, 0.6)":"none"}}),t&&u.jsx("span",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"0.75rem",opacity:.7,background:"var(--background, #1a1a1a)",padding:"0 0.5rem",whiteSpace:"nowrap"},children:"Move to end"})]})}function rL({group:t,accountCount:e,groupTotal:n,canMoveUp:r,canMoveDown:s,isMobile:o,createForGroupId:l,onEdit:d,onDelete:h,onMoveUp:m,onMoveDown:p,onAddAccount:g}){return u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:o?"0.5rem":"0.75rem",paddingBottom:"0.5rem",borderBottom:"1px solid color-mix(in srgb, currentColor 15%, transparent)",gap:"0.5rem",flexWrap:o?"wrap":"nowrap"},children:[u.jsxs("h3",{style:{...wm,margin:0,display:"flex",alignItems:"center",gap:"0.5rem",flex:1,minWidth:0,flexWrap:"wrap"},children:[!o&&u.jsx("span",{style:{cursor:"grab",opacity:.4},children:""}),u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",borderBottom:"2px solid currentColor",paddingBottom:"2px"},children:t.name}),u.jsxs("span",{style:{opacity:.5,fontWeight:400,fontSize:"0.9rem",flexShrink:0},children:["(",e,")"]}),wn.showGroupTotals,u.jsx(nL,{group:t})]}),u.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0,alignItems:"center"},children:[!o&&u.jsx(Ve,{variant:"small",actionName:`Open Add Account Form (${t.name})`,onClick:g,disabled:l!==null,children:"+ Account"}),u.jsx("button",{onClick:()=>{t.name,d()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Edit account type",children:""}),u.jsx("button",{onClick:()=>{t.name,h()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Delete account type",children:""}),u.jsxs("div",{style:V0,children:[u.jsx("button",{onClick:m,disabled:!r,style:{...Yl,opacity:r?.6:.2,cursor:r?"pointer":"default"},title:"Move up","aria-label":"Move up",children:""}),u.jsx("button",{onClick:p,disabled:!s,style:{...Yl,opacity:s?.6:.2,cursor:s?"pointer":"default"},title:"Move down","aria-label":"Move down",children:""})]})]})]})}function iL(t,e){return!e||e==="any"||t===0?!1:e==="positive"&&t<0||e==="negative"&&t>0}function sL(t,e){return!e||e==="any"||t===0?null:e==="positive"&&t<0?"Unexpected negative balance":e==="negative"&&t>0?"Unexpected positive balance (credit owed to you?)":null}function aL({group:t,groupIndex:e,totalGroups:n,accounts:r,allGroups:s,allAccounts:o,editingAccountId:l,editingGroupId:d,createForGroupId:h,setEditingAccountId:m,setEditingGroupId:p,setCreateForGroupId:g,dragType:v,draggedId:_,dragOverId:S,dragOverGroupId:x,setDragOverId:E,setDragOverGroupId:C,onAccountDragStart:T,onAccountDragOver:A,onAccountDrop:B,onGroupDragStart:U,onGroupDragOver:G,onGroupDrop:k,onDragLeave:D,onDragLeaveGroup:N,onDragEnd:F,onDropOnGroup:H,onCreateAccount:j,onUpdateAccount:M,onDeleteAccount:R,onMoveAccount:K,onUpdateGroup:W,onDeleteGroup:q,onMoveGroup:J}){const Z=qi(),re=[...r].sort((pe,Ue)=>pe.sort_order-Ue.sort_order),P=v==="group"&&_===t.id,$=v==="group"&&S===t.id,te=v==="account"&&x===t.id,ae=(_&&v==="account"?o[_]:null)&&Object.entries(o).find(([pe])=>pe===_)?.[1]&&Object.entries(o).find(([pe])=>pe===_)?.[1]?.account_group_id!==t.id,ye=v==="group"&&$&&_!==t.id,Ie=e>0,Ee=e<n-1,Ce=re.reduce((pe,Ue)=>pe+Ue.balance,0);return u.jsxs("div",{children:[v==="group"&&!P&&u.jsxs("div",{onDragOver:pe=>{pe.preventDefault(),E(t.id)},onDragLeave:D,onDrop:pe=>k(pe,t.id),style:{position:"relative",height:ye?"2.5rem":"0.5rem",marginBottom:ye?"-0.5rem":"-0.25rem",transition:"height 0.15s"},children:[u.jsx("div",{style:{position:"absolute",top:"50%",left:0,right:0,height:"3px",background:ce.primary,borderRadius:"2px",opacity:ye?1:0,transition:"opacity 0.15s",boxShadow:ye?"0 0 8px rgba(100, 108, 255, 0.6)":"none"}}),ye&&u.jsx("span",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"0.75rem",opacity:.7,background:"var(--background, #1a1a1a)",padding:"0 0.5rem",whiteSpace:"nowrap"},children:"Drop here"})]}),u.jsx("div",{draggable:d!==t.id,onDragStart:pe=>U(pe,t.id),onDragOver:pe=>G(pe,t.id),onDragLeave:N,onDragEnd:F,onDrop:pe=>H(pe,t.id),style:{background:P?"color-mix(in srgb, currentColor 3%, transparent)":te&&ae?`color-mix(in srgb, ${ce.primary} 10%, transparent)`:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"12px",padding:"1rem",opacity:P?.5:1,border:te&&ae?`2px dashed ${ce.primary}`:"2px solid transparent",cursor:d===t.id?"default":"grab",transition:"all 0.15s"},children:d===t.id?u.jsx(gA,{initialData:{name:t.name,expected_balance:t.expected_balance||"positive",on_budget:t.on_budget,is_active:t.is_active},onSubmit:pe=>W(t.id,pe),onCancel:()=>p(null),submitLabel:"Save"}):u.jsxs(u.Fragment,{children:[u.jsx(rL,{group:t,accountCount:re.length,groupTotal:Ce,canMoveUp:Ie,canMoveDown:Ee,isMobile:Z,createForGroupId:h,onEdit:()=>p(t.id),onDelete:()=>q(t.id),onMoveUp:()=>J(t.id,"up"),onMoveDown:()=>J(t.id,"down"),onAddAccount:()=>g(t.id)}),Z&&u.jsx("div",{style:{marginBottom:"0.5rem"},children:u.jsx(Ve,{variant:"small",actionName:`Open Add Account Form (${t.name})`,onClick:()=>g(t.id),disabled:h!==null,children:"+ Account"})}),u.jsxs("div",{style:Xl,children:[re.map((pe,Ue)=>l===pe.id?u.jsx(Gu,{initialData:{nickname:pe.nickname,account_group_id:pe.account_group_id,is_income_account:pe.is_income_account,is_income_default:pe.is_income_default,is_outgo_account:pe.is_outgo_account,is_outgo_default:pe.is_outgo_default,on_budget:pe.on_budget,is_active:pe.is_active},onSubmit:He=>M(pe.id,He),onCancel:()=>m(null),submitLabel:"Save",accountGroups:s,showGroupSelector:!0,showIncomeSettings:!0,currentGroupId:pe.account_group_id,hasExistingIncomeDefault:Object.entries(o).some(([He,Me])=>Me.is_income_default&&He!==pe.id),hasExistingOutgoDefault:Object.entries(o).some(([He,Me])=>Me.is_outgo_default&&He!==pe.id)},pe.id):u.jsx(Sm,{isDragging:v==="account"&&_===pe.id,isDragOver:S===pe.id,onDragStart:He=>{He.stopPropagation(),T(He,pe.id)},onDragOver:He=>A(He,pe.id,t.id),onDragLeave:D,onDragEnd:F,onDrop:He=>B(He,pe.id,t.id),onEdit:()=>{pe.nickname,m(pe.id)},onDelete:()=>{pe.nickname,R(pe.id)},onMoveUp:()=>K(pe.id,"up"),onMoveDown:()=>K(pe.id,"down"),canMoveUp:Ue>0,canMoveDown:Ue<re.length-1,children:u.jsxs("div",{children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flexWrap:"wrap"},children:[u.jsx("span",{style:$0,children:pe.nickname}),u.jsx(yA,{account:pe,accountGroups:s})]}),u.jsxs("p",{style:{margin:"0.25rem 0 0 0",fontSize:"1.1rem",fontWeight:600,color:Pt(pe.balance)},children:[Je(pe.balance),iL(pe.balance,t.expected_balance)&&u.jsx("span",{title:sL(pe.balance,t.expected_balance)||"",style:{marginLeft:"0.5rem",fontSize:"0.85rem"},children:""})]})]})},pe.id)),re.length===0&&!h&&u.jsx("p",{style:{opacity:.5,fontSize:"0.9rem",margin:"0.5rem 0"},children:"No accounts in this type"}),v==="account"&&re.length>0&&u.jsx(_A,{groupId:t.id,isActive:S===`__end__${t.id}`,onDragOver:pe=>{pe.preventDefault(),pe.stopPropagation(),E(`__end__${t.id}`),C(t.id)},onDragLeave:pe=>{pe.stopPropagation(),E(null)},onDrop:pe=>{pe.stopPropagation(),B(pe,"__group_end__",t.id)}}),h===t.id&&u.jsx(Gu,{initialData:{nickname:"",account_group_id:t.id},onSubmit:pe=>j(pe,t.id),onCancel:()=>g(null),submitLabel:"Create",accountGroups:s,showIncomeSettings:!0,currentGroupId:t.id})]}),h!==t.id&&u.jsx("div",{style:{marginTop:"0.75rem",paddingTop:"0.5rem",borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},children:u.jsx(Ve,{variant:"small",actionName:`Open Add Account Form (${t.name})`,onClick:()=>g(t.id),disabled:h!==null,children:"+ Add Account"})})]})})]})}function oL({accounts:t,allGroups:e,allAccounts:n,hasGroups:r,editingAccountId:s,createForGroupId:o,setEditingAccountId:l,setCreateForGroupId:d,dragType:h,draggedId:m,dragOverId:p,dragOverGroupId:g,setDragOverId:v,setDragOverGroupId:_,onAccountDragStart:S,onAccountDragOver:x,onAccountDrop:E,onDragOverGroup:C,onDropOnGroup:T,onDragLeave:A,onDragLeaveGroup:B,onDragEnd:U,onCreateAccount:G,onUpdateAccount:k,onDeleteAccount:D,onMoveAccount:N}){const F=[...t].sort((R,K)=>R.sort_order-K.sort_order),H=h==="account"&&g==="ungrouped",M=(m&&h==="account"?n[m]:null)&&Object.entries(n).find(([R])=>R===m)?.[1]&&Object.entries(n).find(([R])=>R===m)?.[1]?.account_group_id!==null;return F.length===0&&!o&&r&&h!=="account"?null:(F.reduce((R,K)=>R+K.balance,0),u.jsxs("div",{onDragOver:R=>C(R,"ungrouped"),onDragLeave:B,onDrop:R=>T(R,"ungrouped"),style:{background:H&&M?`color-mix(in srgb, ${ce.primary} 10%, transparent)`:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"12px",padding:"1rem",border:H&&M?`2px dashed ${ce.primary}`:"2px solid transparent",transition:"all 0.15s"},children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.75rem",paddingBottom:"0.5rem",borderBottom:"1px solid color-mix(in srgb, currentColor 15%, transparent)"},children:[u.jsxs("h3",{style:{...wm,margin:0,opacity:.7,display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{style:{borderBottom:"2px solid currentColor",paddingBottom:"2px"},children:"Ungrouped"}),u.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400,fontSize:"0.9rem"},children:["(",F.length,")"]}),wn.showGroupTotals]}),u.jsx(Ve,{variant:"small",actionName:"Open Add Account Form (Ungrouped)",onClick:()=>d("ungrouped"),disabled:o!==null,children:"+ Account"})]}),u.jsxs("div",{style:Xl,children:[F.map((R,K)=>s===R.id?u.jsx(Gu,{initialData:{nickname:R.nickname,account_group_id:R.account_group_id,is_income_account:R.is_income_account,is_income_default:R.is_income_default,is_outgo_account:R.is_outgo_account,is_outgo_default:R.is_outgo_default,on_budget:R.on_budget,is_active:R.is_active},onSubmit:W=>k(R.id,W),onCancel:()=>l(null),submitLabel:"Save",accountGroups:e,showGroupSelector:!0,showIncomeSettings:!0,currentGroupId:null,hasExistingIncomeDefault:Object.entries(n).some(([W,q])=>q.is_income_default&&W!==R.id),hasExistingOutgoDefault:Object.entries(n).some(([W,q])=>q.is_outgo_default&&W!==R.id)},R.id):u.jsx(Sm,{isDragging:h==="account"&&m===R.id,isDragOver:p===R.id,onDragStart:W=>S(W,R.id),onDragOver:W=>x(W,R.id,"ungrouped"),onDragLeave:A,onDragEnd:U,onDrop:W=>E(W,R.id,"ungrouped"),onEdit:()=>{R.nickname,l(R.id)},onDelete:()=>{R.nickname,D(R.id)},onMoveUp:()=>N(R.id,"up"),onMoveDown:()=>N(R.id,"down"),canMoveUp:K>0,canMoveDown:K<F.length-1,children:u.jsxs("div",{children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flexWrap:"wrap"},children:[u.jsx("span",{style:$0,children:R.nickname}),u.jsx(yA,{account:R,accountGroups:e})]}),u.jsx("p",{style:{margin:"0.25rem 0 0 0",fontSize:"1.1rem",fontWeight:600,color:Pt(R.balance)},children:Je(R.balance)})]})},R.id)),F.length===0&&h==="account"&&u.jsx("p",{style:{opacity:.5,fontSize:"0.9rem",margin:"0.5rem 0",textAlign:"center"},children:"Drop here to ungroup"}),h==="account"&&F.length>0&&u.jsx(_A,{groupId:"ungrouped",isActive:p==="__end__ungrouped",onDragOver:R=>{R.preventDefault(),R.stopPropagation(),v("__end__ungrouped"),_("ungrouped")},onDragLeave:R=>{R.stopPropagation(),v(null)},onDrop:R=>{R.stopPropagation(),E(R,"__group_end__","ungrouped")}}),o==="ungrouped"&&u.jsx(Gu,{initialData:{nickname:"",account_group_id:null},onSubmit:R=>G(R,"ungrouped"),onCancel:()=>d(null),submitLabel:"Create",accountGroups:e,showIncomeSettings:!0,currentGroupId:null})]}),o!=="ungrouped"&&u.jsx("div",{style:{marginTop:"0.75rem",paddingTop:"0.5rem",borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},children:u.jsx(Ve,{variant:"small",actionName:"Open Add Account Form (Ungrouped)",onClick:()=>d("ungrouped"),disabled:o!==null,children:"+ Add Account"})})]}))}function lL(){const{selectedBudgetId:t}=zt(),{monthMap:e,isLoading:n}=An(),{accounts:r,accountsByGroup:s,hiddenAccounts:o,sortedGroups:l,currentBudget:d,error:h,setError:m,handleCreateAccount:p,handleUpdateAccount:g,handleDeleteAccount:v,handleMoveAccount:_,handleCreateGroup:S,handleUpdateGroup:x,handleDeleteGroup:E,handleMoveGroup:C,reorderAccountsInGroup:T,reorderGroups:A}=P3(),B=qi();fd({budgetId:t,monthMap:e,checkAnyMonth:!0,additionalCondition:!n&&!!d,logPrefix:"[Settings/Accounts]"});const[U,G]=O.useState(null),[k,D]=O.useState(null),[N,F]=O.useState(null),[H,j]=O.useState(!1),[M,R]=O.useState(null),[K,W]=O.useState(null),[q,J]=O.useState(null),[Z,re]=O.useState(null);function P(Me,L){R("account"),W(L),Me.dataTransfer.effectAllowed="move"}function $(Me,L,be){Me.preventDefault(),M==="account"&&(L!==K&&J(L),re(be))}function te(Me,L){Me.preventDefault(),M==="account"?(re(L),J(null)):M==="group"&&L!==K&&J(L)}function se(){J(null)}function ae(){re(null)}function ye(){R(null),W(null),J(null),re(null)}async function Ie(Me,L,be){if(Me.preventDefault(),Me.stopPropagation(),!K||M!=="account"){ye();return}await T(K,L,be),ye()}async function Ee(Me,L){Me.preventDefault(),M==="account"?await Ie(Me,"__group_end__",L):M==="group"&&await pe(Me,L)}function Ce(Me,L){Me.stopPropagation(),R("group"),W(L),Me.dataTransfer.effectAllowed="move"}async function pe(Me,L){if(Me.preventDefault(),!K||M!=="group"||K===L){ye();return}await A(K,L),ye()}const Ue=O.useMemo(()=>{const Me=Object.values(r),L=Me.reduce((ee,X)=>ee+(X.balance??0),0);let be=0,me=0;for(const ee of Me){const X=l.find(we=>we.id===ee.account_group_id);ee.on_budget===!0||ee.on_budget===void 0&&X?.on_budget!==!1?be+=ee.balance??0:me+=ee.balance??0}return{count:Me.length,groupCount:l.length,totalBalance:L,onBudgetTotal:be,offBudgetTotal:me}},[r,l]);if(!d)return u.jsx("p",{children:"No budget found. Please log in."});const He=s.ungrouped||[];return u.jsxs("div",{children:[h&&u.jsx(No,{message:h,onDismiss:()=>m(null)}),u.jsx("div",{style:{position:"sticky",top:0,zIndex:50,backgroundColor:"#242424",marginLeft:"calc(-1 * var(--page-padding, 2rem))",marginRight:"calc(-1 * var(--page-padding, 2rem))",paddingLeft:"var(--page-padding, 2rem)",paddingRight:"var(--page-padding, 2rem)",paddingTop:"0.5rem",paddingBottom:"0.5rem",borderBottom:"1px solid rgba(255,255,255,0.15)"},children:u.jsxs("div",{style:{display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem"},children:[u.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[u.jsx("span",{style:{fontWeight:600},children:"Accounts:"}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"On-Budget: "}),u.jsx("span",{style:{color:Pt(Ue.onBudgetTotal),fontWeight:600},children:Je(Ue.onBudgetTotal)})]}),Ue.offBudgetTotal!==0&&u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"Off-Budget: "}),u.jsx("span",{style:{fontWeight:600,opacity:.7},children:Je(Ue.offBudgetTotal)})]}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"Total: "}),u.jsx("span",{style:{color:Pt(Ue.totalBalance),fontWeight:600},children:Je(Ue.totalBalance)})]}),u.jsx("span",{style:{opacity:.5,fontSize:"0.8rem"},children:B?"Drag to move.":"Drag between types or use  to reorder."})]}),u.jsx("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:u.jsx(Y0,{})})]})}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem",marginBottom:"1.5rem",paddingTop:"1rem"},children:[Object.keys(r).length===0&&l.length===0&&u.jsx("p",{style:{opacity:.7},children:"No accounts yet. Create an account type first, then add accounts!"}),l.map((Me,L)=>u.jsx(aL,{group:Me,groupIndex:L,totalGroups:l.length,accounts:s[Me.id]||[],allGroups:l,allAccounts:r,editingAccountId:U,editingGroupId:N,createForGroupId:k,setEditingAccountId:G,setEditingGroupId:F,setCreateForGroupId:D,dragType:M,draggedId:K,dragOverId:q,dragOverGroupId:Z,setDragOverId:J,setDragOverGroupId:re,onAccountDragStart:P,onAccountDragOver:$,onAccountDrop:Ie,onGroupDragStart:Ce,onGroupDragOver:te,onGroupDrop:pe,onDragLeave:se,onDragLeaveGroup:ae,onDragEnd:ye,onDropOnGroup:Ee,onCreateAccount:p,onUpdateAccount:(be,me)=>{g(be,me),G(null)},onDeleteAccount:v,onMoveAccount:_,onUpdateGroup:(be,me)=>{x(be,me),F(null)},onDeleteGroup:E,onMoveGroup:C},Me.id)),M==="group"&&l.length>0&&u.jsx(G0,{isActive:q==="__end__",onDragOver:Me=>{Me.preventDefault(),J("__end__")},onDragLeave:se,onDrop:Me=>pe(Me,"__end__"),label:"Move account type to end"}),u.jsx(oL,{accounts:He,allGroups:l,allAccounts:r,hasGroups:l.length>0,editingAccountId:U,createForGroupId:k,setEditingAccountId:G,setCreateForGroupId:D,dragType:M,draggedId:K,dragOverId:q,dragOverGroupId:Z,setDragOverId:J,setDragOverGroupId:re,onAccountDragStart:P,onAccountDragOver:$,onAccountDrop:Ie,onDragOverGroup:te,onDropOnGroup:Ee,onDragLeave:se,onDragLeaveGroup:ae,onDragEnd:ye,onCreateAccount:p,onUpdateAccount:(Me,L)=>{g(Me,L),G(null)},onDeleteAccount:v,onMoveAccount:_})]}),o.length>0&&u.jsx("div",{style:{marginBottom:"2rem"},children:u.jsxs(W0,{title:"Hidden Accounts",count:o.length,children:[u.jsxs("div",{style:{padding:"0.75rem",marginBottom:"1rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",fontSize:"0.85rem"},children:[u.jsxs("p",{style:{margin:"0 0 0.5rem 0",opacity:.8},children:[u.jsx("strong",{children:" Hidden accounts"})," are excluded from dropdowns and balance displays. They're useful for historical accounts (like closed bank accounts or old 401Ks) that you want to keep for record-keeping but don't need in everyday use."]}),u.jsx("p",{style:{margin:0,opacity:.6},children:'To unhide an account, click it to edit and uncheck "Hidden account".'})]}),u.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:o.map(Me=>U===Me.id?u.jsx(Gu,{initialData:{nickname:Me.nickname,account_group_id:Me.account_group_id,is_income_account:Me.is_income_account,is_income_default:Me.is_income_default,is_outgo_account:Me.is_outgo_account,is_outgo_default:Me.is_outgo_default,on_budget:Me.on_budget,is_active:Me.is_active,is_hidden:Me.is_hidden},onSubmit:L=>{g(Me.id,L),G(null)},onCancel:()=>G(null),submitLabel:"Save",accountGroups:l,showGroupSelector:!0,showIncomeSettings:!0,currentGroupId:Me.account_group_id,hasExistingIncomeDefault:Object.entries(r).some(([L,be])=>be.is_income_default&&L!==Me.id),hasExistingOutgoDefault:Object.entries(r).some(([L,be])=>be.is_outgo_default&&L!==Me.id)},Me.id):u.jsxs("div",{onClick:()=>G(Me.id),style:{padding:"0.75rem 1rem",background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"8px",cursor:"pointer",display:"flex",justifyContent:"space-between",alignItems:"center",opacity:.7},children:[u.jsx("span",{children:Me.nickname}),u.jsx("span",{style:{color:Pt(Me.balance),fontWeight:500},children:Je(Me.balance)})]},Me.id))})]})}),H?u.jsx(gA,{onSubmit:Me=>{S(Me),j(!1)},onCancel:()=>j(!1),submitLabel:"Create Account Type"}):u.jsx(Ve,{variant:"primary-large",actionName:"Open Add Account Type Form",onClick:()=>j(!0),children:"+ Add Account Type"})]})}function Wu({initialData:t,onSubmit:e,onCancel:n,submitLabel:r,categoryGroups:s=[],showGroupSelector:o=!1}){const[l,d]=O.useState(t||{name:"",category_group_id:null,is_hidden:!1}),[h,m]=O.useState(t?.default_monthly_amount?.toString()||""),[p,g]=O.useState(t?.default_monthly_type||"fixed"),[v,_]=O.useState(!1);function S(x){if(x.preventDefault(),!l.name.trim())return;_(!0);const E=parseFloat(h),C=!isNaN(E)&&E>0;e({...l,description:l.description?.trim()||void 0,default_monthly_amount:C?E:void 0,default_monthly_type:C?p:void 0})}return u.jsxs(Es,{actionName:r==="Create"?"Create Category":"Update Category",onSubmit:S,children:[u.jsx(Mt,{label:"Category Name",htmlFor:"category-name",children:u.jsx(Cs,{id:"category-name",type:"text",value:l.name,onChange:x=>d({...l,name:x.target.value}),placeholder:"e.g., Groceries, Rent, Gas",required:!0,autoFocus:!0})}),u.jsx(Mt,{label:"Description (optional)",htmlFor:"category-description",children:u.jsx(q0,{id:"category-description",value:l.description||"",onChange:x=>d({...l,description:x.target.value}),placeholder:"What is this category used for?",minHeight:"3rem"})}),o&&u.jsx(Mt,{label:"Category Group",htmlFor:"category-group",children:u.jsxs(Hu,{id:"category-group",value:l.category_group_id||"ungrouped",onChange:x=>d({...l,category_group_id:x.target.value==="ungrouped"?null:x.target.value}),children:[u.jsx("option",{value:"ungrouped",children:"Uncategorized"}),s.map(x=>u.jsx("option",{value:x.id,children:x.name},x.id))]})}),u.jsxs(Mt,{label:"Default Monthly Allocation (optional)",htmlFor:"default-amount",children:[u.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center"},children:[u.jsxs(Hu,{id:"default-type",value:p,onChange:x=>g(x.target.value),style:{width:"auto",flex:"0 0 auto"},children:[u.jsx("option",{value:"fixed",children:"Fixed $"}),u.jsx("option",{value:"percentage",children:"% of Prev Income"})]}),p==="fixed"?u.jsx(yo,{id:"default-amount",value:h,onChange:m,placeholder:"$0.00"}):u.jsx(Cs,{id:"default-amount",type:"number",value:h,onChange:x=>m(x.target.value),placeholder:"0",min:"0",max:"100",step:"0.1",style:{width:"80px"}}),p==="percentage"&&u.jsx("span",{style:{opacity:.6},children:"%"})]}),u.jsx("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.75rem",opacity:.6},children:p==="fixed"?"Suggested fixed amount to allocate each month":"Percentage of previous month's total income"})]}),o&&u.jsxs("div",{style:{padding:"0.75rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px"},children:[u.jsx(Ur,{id:"is-hidden",checked:l.is_hidden||!1,onChange:x=>d({...l,is_hidden:x.target.checked}),children:"Hidden category"}),u.jsx("p",{style:{margin:"0.25rem 0 0 2rem",fontSize:"0.7rem",opacity:.6},children:"Hidden categories don't appear in dropdowns or balance displays. Use for historical categories that aren't actively used."})]}),u.jsxs(Na,{children:[u.jsx(Ve,{type:"submit",actionName:r==="Create"?"Create Category":"Save Category",isLoading:v,children:r}),u.jsx(Ve,{type:"button",variant:"secondary",actionName:"Cancel Category Form",onClick:n,children:"Cancel"})]})]})}function bA({initialData:t,onSubmit:e,onCancel:n,submitLabel:r}){const[s,o]=O.useState(t||{name:""}),[l,d]=O.useState(!1);function h(m){m.preventDefault(),s.name.trim()&&(d(!0),e(s))}return u.jsxs(Es,{actionName:r==="Create Group"?"Create Category Group":"Update Category Group",onSubmit:h,children:[u.jsx(Mt,{label:"Group Name",htmlFor:"group-name",children:u.jsx(Cs,{id:"group-name",type:"text",value:s.name,onChange:m=>o({...s,name:m.target.value}),placeholder:"e.g., Housing, Transportation, Food",required:!0,autoFocus:!0})}),u.jsxs(Na,{children:[u.jsx(Ve,{type:"submit",actionName:r==="Create Group"?"Create Category Group":"Save Category Group",isLoading:l,children:r}),u.jsx(Ve,{type:"button",variant:"secondary",actionName:"Cancel Category Group Form",onClick:n,children:"Cancel"})]})]})}function vA({isActive:t,onDragOver:e,onDragLeave:n,onDrop:r}){return u.jsxs("div",{onDragOver:e,onDragLeave:n,onDrop:r,style:{position:"relative",height:"2rem",marginTop:"-0.25rem"},children:[u.jsx("div",{style:{position:"absolute",top:"50%",left:0,right:0,height:"3px",background:ce.primary,borderRadius:"2px",opacity:t?1:.3,transition:"opacity 0.15s",boxShadow:t?"0 0 8px rgba(100, 108, 255, 0.6)":"none"}}),t&&u.jsx("span",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"0.75rem",opacity:.7,background:"var(--background, #1a1a1a)",padding:"0 0.5rem",whiteSpace:"nowrap"},children:"Move to end"})]})}function xA({category:t,catId:e,categoryBalances:n,loadingBalances:r}){const s=n[e]||{current:0,total:0};return u.jsxs("div",{children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",flexWrap:"wrap"},children:[u.jsx("span",{style:$0,children:t.name}),t.default_monthly_amount!==void 0&&t.default_monthly_amount>0&&u.jsxs("span",{style:{fontSize:"0.75rem",opacity:.8,background:"color-mix(in srgb, currentColor 10%, transparent)",padding:"0.15rem 0.4rem",borderRadius:"4px"},children:["Default: ",t.default_monthly_type==="percentage"?u.jsxs(u.Fragment,{children:[u.jsxs("span",{style:{color:ce.success,fontWeight:500},children:[t.default_monthly_amount,"%"]})," of prev income"]}):u.jsxs(u.Fragment,{children:[u.jsx("span",{style:{color:ce.success,fontWeight:500},children:Je(t.default_monthly_amount)}),"/mo"]})]})]}),t.description&&u.jsx("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.8rem",opacity:.6,lineHeight:1.3},children:t.description}),u.jsxs("div",{style:{marginTop:"0.25rem"},children:[u.jsxs("p",{style:{margin:0,fontSize:"1rem",fontWeight:600,color:Un(s.current)},children:[r?"...":ii(s.current),u.jsx("span",{style:{fontSize:"0.75rem",fontWeight:400,opacity:.6,marginLeft:"0.35rem"},children:"available now"})]}),u.jsxs("p",{style:{margin:"0.15rem 0 0 0",fontSize:"0.85rem",fontWeight:500,color:Un(s.total),opacity:.75},children:[r?"...":ii(s.total),u.jsx("span",{style:{fontSize:"0.7rem",fontWeight:400,opacity:.7,marginLeft:"0.35rem"},children:"total allocated"})]})]})]})}function cL({group:t,categoryCount:e,canMoveUp:n,canMoveDown:r,isMobile:s,createForGroupId:o,onEdit:l,onDelete:d,onMoveUp:h,onMoveDown:m,onAddCategory:p,onDragStart:g,onDragEnd:v}){return u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:s?"0.5rem":"0.75rem",paddingBottom:"0.5rem",borderBottom:"1px solid color-mix(in srgb, currentColor 15%, transparent)",gap:"0.5rem",flexWrap:s?"wrap":"nowrap"},children:[u.jsxs("h3",{style:{...wm,margin:0,display:"flex",alignItems:"center",gap:"0.5rem",flex:1,minWidth:0},children:[!s&&u.jsx("span",{draggable:!0,onDragStart:g,onDragEnd:v,style:{cursor:"grab",opacity:.4,padding:"0.25rem",margin:"-0.25rem",borderRadius:"4px",userSelect:"none"},title:"Drag to reorder group",children:""}),u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.name}),u.jsxs("span",{style:{opacity:.5,fontWeight:400,fontSize:"0.9rem",flexShrink:0},children:["(",e,")"]})]}),u.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0,alignItems:"center"},children:[!s&&u.jsx(Ve,{variant:"small",actionName:`Open Add Category Form (${t.name})`,onClick:p,disabled:o!==null,children:"+ Category"}),u.jsx("button",{onClick:()=>{t.name,l()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Edit group",children:""}),u.jsx("button",{onClick:()=>{t.name,d()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Delete group",children:""}),u.jsxs("div",{style:V0,children:[u.jsx("button",{onClick:h,disabled:!n,style:{...Yl,opacity:n?.6:.2,cursor:n?"pointer":"default"},title:"Move group up","aria-label":"Move group up",children:""}),u.jsx("button",{onClick:m,disabled:!r,style:{...Yl,opacity:r?.6:.2,cursor:r?"pointer":"default"},title:"Move group down","aria-label":"Move group down",children:""})]})]})]})}function uL({group:t,groupIndex:e,groupCategories:n,sortedGroups:r,categoryGroups:s,categoryBalances:o,loadingBalances:l,dragType:d,draggedId:h,dragOverId:m,dragOverGroupId:p,editingCategoryId:g,setEditingCategoryId:v,createForGroupId:_,setCreateForGroupId:S,editingGroupId:x,setEditingGroupId:E,handleCreateCategory:C,handleUpdateCategory:T,handleDeleteCategory:A,handleMoveCategory:B,handleUpdateGroup:U,handleDeleteGroup:G,handleMoveGroup:k,handleCategoryDragStart:D,handleCategoryDragOver:N,handleDragOverGroup:F,handleDragLeave:H,handleDragLeaveGroup:j,handleDragEnd:M,handleCategoryDrop:R,handleDropOnGroup:K,handleGroupDragStart:W,handleGroupDrop:q,setDragOverId:J,setDragOverGroupId:Z,isMobile:re,categories:P}){const $=d==="group"&&h===t.id,te=d==="group"&&m===t.id,se=d==="category"&&p===t.id,ae=h&&d==="category"?P[h]:null,ye=ae&&(ae.category_group_id||"ungrouped")!==t.id,Ie=d==="group"&&te&&h!==t.id,Ee=e>0,Ce=e<r.length-1;return u.jsxs("div",{children:[d==="group"&&!$&&u.jsxs("div",{onDragOver:pe=>{pe.preventDefault(),J(t.id)},onDragLeave:H,onDrop:pe=>q(pe,t.id),style:{position:"relative",height:Ie?"2.5rem":"0.5rem",marginBottom:Ie?"-0.5rem":"-0.25rem",transition:"height 0.15s"},children:[u.jsx("div",{style:{position:"absolute",top:"50%",left:0,right:0,height:"3px",background:ce.primary,borderRadius:"2px",opacity:Ie?1:0,transition:"opacity 0.15s",boxShadow:Ie?"0 0 8px rgba(100, 108, 255, 0.6)":"none"}}),Ie&&u.jsx("span",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"0.75rem",opacity:.7,background:"var(--background, #1a1a1a)",padding:"0 0.5rem",whiteSpace:"nowrap"},children:"Drop here"})]}),u.jsx("div",{onDragOver:pe=>F(pe,t.id),onDragLeave:j,onDrop:pe=>K(pe,t.id),style:{background:$?"color-mix(in srgb, currentColor 3%, transparent)":se&&ye?`color-mix(in srgb, ${ce.primary} 10%, transparent)`:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"12px",padding:"1rem",opacity:$?.5:1,border:se&&ye?`2px dashed ${ce.primary}`:"2px solid transparent",transition:"all 0.15s"},children:x===t.id?u.jsx(bA,{initialData:{name:t.name},onSubmit:pe=>U(t.id,pe),onCancel:()=>E(null),submitLabel:"Save"}):u.jsxs(u.Fragment,{children:[u.jsx(cL,{group:t,categoryCount:n.length,canMoveUp:Ee,canMoveDown:Ce,isMobile:re,createForGroupId:_,onEdit:()=>E(t.id),onDelete:()=>G(t.id),onMoveUp:()=>k(t.id,"up"),onMoveDown:()=>k(t.id,"down"),onAddCategory:()=>S(t.id),onDragStart:pe=>W(pe,t.id),onDragEnd:M}),re&&u.jsx("div",{style:{marginBottom:"0.5rem"},children:u.jsx(Ve,{variant:"small",actionName:`Open Add Category Form (${t.name})`,onClick:()=>S(t.id),disabled:_!==null,children:"+ Category"})}),u.jsxs("div",{style:Xl,children:[n.map(([pe,Ue])=>g===pe?u.jsx(Wu,{initialData:{name:Ue.name,description:Ue.description,category_group_id:Ue.category_group_id,default_monthly_amount:Ue.default_monthly_amount,default_monthly_type:Ue.default_monthly_type,is_hidden:Ue.is_hidden},onSubmit:He=>{T(pe,He),v(null)},onCancel:()=>v(null),submitLabel:"Save",categoryGroups:s,showGroupSelector:!0},pe):u.jsx(Sm,{isDragging:d==="category"&&h===pe,isDragOver:m===pe,onDragStart:He=>{He.stopPropagation(),D(He,pe)},onDragOver:He=>N(He,pe,t.id),onDragLeave:H,onDragEnd:M,onDrop:He=>R(He,pe,t.id),onEdit:()=>{Ue.name,v(pe)},onDelete:()=>{Ue.name,A(pe)},onMoveUp:()=>B(pe,"up"),onMoveDown:()=>B(pe,"down"),canMoveUp:n.findIndex(([He])=>He===pe)>0,canMoveDown:n.findIndex(([He])=>He===pe)<n.length-1,children:u.jsx(xA,{category:Ue,catId:pe,categoryBalances:o,loadingBalances:l})},pe)),n.length===0&&!_&&u.jsx("p",{style:{opacity:.5,fontSize:"0.9rem",margin:"0.5rem 0"},children:"No categories in this group"}),d==="category"&&n.length>0&&u.jsx(vA,{groupId:t.id,isActive:m===`__end__${t.id}`,onDragOver:pe=>{pe.preventDefault(),pe.stopPropagation(),J(`__end__${t.id}`),Z(t.id)},onDragLeave:pe=>{pe.stopPropagation(),J(null)},onDrop:pe=>{pe.stopPropagation(),R(pe,"__group_end__",t.id)}}),_===t.id&&u.jsx(Wu,{initialData:{name:"",category_group_id:t.id},onSubmit:pe=>C(pe,t.id),onCancel:()=>S(null),submitLabel:"Create",categoryGroups:s})]}),_!==t.id&&u.jsx("div",{style:{marginTop:"0.75rem",paddingTop:"0.5rem",borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},children:u.jsx(Ve,{variant:"small",actionName:`Open Add Category Form (${t.name})`,onClick:()=>S(t.id),disabled:_!==null,children:"+ Add Category"})})]})})]})}function dL({ungroupedCategories:t,categoryGroups:e,categoryBalances:n,loadingBalances:r,dragType:s,draggedId:o,dragOverId:l,dragOverGroupId:d,editingCategoryId:h,setEditingCategoryId:m,createForGroupId:p,setCreateForGroupId:g,handleCreateCategory:v,handleUpdateCategory:_,handleDeleteCategory:S,handleMoveCategory:x,handleCategoryDragStart:E,handleCategoryDragOver:C,handleDragOverGroup:T,handleDragLeaveGroup:A,handleDragLeave:B,handleDragEnd:U,handleCategoryDrop:G,handleDropOnGroup:k,setDragOverId:D,setDragOverGroupId:N,categories:F,hasGroups:H}){const j=s==="category"&&d==="ungrouped",M=o&&s==="category"?F[o]:null,R=M&&M.category_group_id!==null;return t.length===0&&!p&&H&&s!=="category"?null:u.jsxs("div",{onDragOver:K=>T(K,"ungrouped"),onDragLeave:A,onDrop:K=>k(K,"ungrouped"),style:{background:j&&R?`color-mix(in srgb, ${ce.primary} 10%, transparent)`:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"12px",padding:"1rem",border:j&&R?`2px dashed ${ce.primary}`:"2px solid transparent",transition:"all 0.15s"},children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.75rem",paddingBottom:"0.5rem",borderBottom:"1px solid color-mix(in srgb, currentColor 15%, transparent)"},children:[u.jsxs("h3",{style:{...wm,margin:0,opacity:.7},children:["Uncategorized",u.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400,fontSize:"0.9rem"},children:["(",t.length,")"]})]}),u.jsx(Ve,{variant:"small",actionName:"Open Add Category Form (Uncategorized)",onClick:()=>g("ungrouped"),disabled:p!==null,children:"+ Category"})]}),u.jsxs("div",{style:Xl,children:[t.map(([K,W])=>h===K?u.jsx(Wu,{initialData:{name:W.name,description:W.description,category_group_id:W.category_group_id,default_monthly_amount:W.default_monthly_amount,default_monthly_type:W.default_monthly_type,is_hidden:W.is_hidden},onSubmit:q=>{_(K,q),m(null)},onCancel:()=>m(null),submitLabel:"Save",categoryGroups:e,showGroupSelector:!0},K):u.jsx(Sm,{isDragging:s==="category"&&o===K,isDragOver:l===K,onDragStart:q=>E(q,K),onDragOver:q=>C(q,K,"ungrouped"),onDragLeave:B,onDragEnd:U,onDrop:q=>G(q,K,"ungrouped"),onEdit:()=>{W.name,m(K)},onDelete:()=>{W.name,S(K)},onMoveUp:()=>x(K,"up"),onMoveDown:()=>x(K,"down"),canMoveUp:t.findIndex(([q])=>q===K)>0,canMoveDown:t.findIndex(([q])=>q===K)<t.length-1,children:u.jsx(xA,{category:W,catId:K,categoryBalances:n,loadingBalances:r})},K)),t.length===0&&s==="category"&&u.jsx("p",{style:{opacity:.5,fontSize:"0.9rem",margin:"0.5rem 0",textAlign:"center"},children:"Drop here to uncategorize"}),s==="category"&&t.length>0&&u.jsx(vA,{groupId:"ungrouped",isActive:l==="__end__ungrouped",onDragOver:K=>{K.preventDefault(),K.stopPropagation(),D("__end__ungrouped"),N("ungrouped")},onDragLeave:K=>{K.stopPropagation(),D(null)},onDrop:K=>{K.stopPropagation(),G(K,"__group_end__","ungrouped")}}),p==="ungrouped"&&u.jsx(Wu,{initialData:{name:"",category_group_id:null},onSubmit:K=>v(K,"ungrouped"),onCancel:()=>g(null),submitLabel:"Create",categoryGroups:e})]}),p!=="ungrouped"&&u.jsx("div",{style:{marginTop:"0.75rem",paddingTop:"0.5rem",borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},children:u.jsx(Ve,{variant:"small",actionName:"Open Add Category Form (Uncategorized)",onClick:()=>g("ungrouped"),disabled:p!==null,children:"+ Add Category"})})]})}function hL(){const{selectedBudgetId:t}=zt(),{monthMap:e,isLoading:n}=An(),{currentBudget:r,categories:s,categoryGroups:o,categoriesByGroup:l,hiddenCategories:d,sortedGroups:h,categoryBalances:m,isLoading:p,loadingBalances:g,error:v,setError:_,getOnBudgetTotal:S,handleCreateCategory:x,handleUpdateCategory:E,handleDeleteCategory:C,handleMoveCategory:T,handleCreateGroup:A,handleUpdateGroup:B,handleDeleteGroup:U,handleMoveGroup:G,dragType:k,draggedId:D,dragOverId:N,dragOverGroupId:F,setDragOverId:H,setDragOverGroupId:j,handleCategoryDragStart:M,handleCategoryDragOver:R,handleDragOverGroup:K,handleDragLeave:W,handleDragLeaveGroup:q,handleDragEnd:J,handleCategoryDrop:Z,handleDropOnGroup:re,handleGroupDragStart:P,handleGroupDrop:$}=U3();fd({budgetId:t,monthMap:e,checkAnyMonth:!0,additionalCondition:!n&&!p&&!!r,logPrefix:"[Settings/Categories]"});const te=qi(),{addLoadingHold:se,removeLoadingHold:ae}=nr();O.useEffect(()=>(p?se("categories","Loading categories..."):ae("categories"),()=>ae("categories")),[p,se,ae]);const[ye,Ie]=O.useState(null),[Ee,Ce]=O.useState(null),[pe,Ue]=O.useState(null),[He,Me]=O.useState(!1);if(!r)return u.jsx("p",{children:"No budget found. Please log in."});const L=Object.values(m).reduce((X,ie)=>X+ie.current,0),be=Object.values(m).reduce((X,ie)=>X+ie.total,0),me=S()-L,ee=Math.abs(be-L)>.01;return p?null:u.jsxs("div",{children:[v&&u.jsx(No,{message:v,onDismiss:()=>_(null)}),u.jsx("div",{style:{position:"sticky",top:0,zIndex:50,backgroundColor:"#242424",marginLeft:"calc(-1 * var(--page-padding, 2rem))",marginRight:"calc(-1 * var(--page-padding, 2rem))",paddingLeft:"var(--page-padding, 2rem)",paddingRight:"var(--page-padding, 2rem)",paddingTop:"0.5rem",paddingBottom:"0.5rem",borderBottom:"1px solid rgba(255,255,255,0.15)"},children:u.jsxs("div",{style:{display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem"},children:[u.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[u.jsx("span",{style:{fontWeight:600},children:"Categories:"}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"On-Budget: "}),u.jsx("span",{style:{color:Pt(S()),fontWeight:600},children:Je(S())})]}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"Allocated: "}),u.jsx("span",{style:{color:pc(L),fontWeight:600},children:g?"...":Je(L)}),ee&&u.jsxs("span",{style:{opacity:.5,fontSize:"0.8rem"},children:[" (",Je(be)," total)"]})]}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"Available: "}),u.jsx("span",{style:{color:Pt(me),fontWeight:600},children:g?"...":Je(me)})]}),u.jsx("span",{style:{opacity:.6},children:te?"Drag to move between groups.":"Drag categories between groups, or use  to reorder."})]}),u.jsx("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:u.jsx(Y0,{})})]})}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem",marginBottom:"1.5rem",paddingTop:"1rem"},children:[Object.keys(s).length===0&&o.length===0&&u.jsx("p",{style:{opacity:.7},children:"No categories yet. Create a group first, then add categories!"}),h.map((X,ie)=>{const we=(l[X.id]||[]).sort((xe,oe)=>xe[1].sort_order-oe[1].sort_order);return u.jsx(uL,{group:X,groupIndex:ie,groupCategories:we,sortedGroups:h,categoryGroups:o,categoryBalances:m,loadingBalances:g,dragType:k,draggedId:D,dragOverId:N,dragOverGroupId:F,editingCategoryId:ye,setEditingCategoryId:Ie,createForGroupId:Ee,setCreateForGroupId:Ce,editingGroupId:pe,setEditingGroupId:Ue,handleCreateCategory:x,handleUpdateCategory:E,handleDeleteCategory:C,handleMoveCategory:T,handleUpdateGroup:B,handleDeleteGroup:U,handleMoveGroup:G,handleCategoryDragStart:M,handleCategoryDragOver:R,handleDragOverGroup:K,handleDragLeave:W,handleDragLeaveGroup:q,handleDragEnd:J,handleCategoryDrop:Z,handleDropOnGroup:re,handleGroupDragStart:P,handleGroupDrop:$,setDragOverId:H,setDragOverGroupId:j,isMobile:te,categories:s},X.id)}),k==="group"&&h.length>0&&u.jsx(G0,{isActive:N==="__end__",onDragOver:X=>{X.preventDefault(),H("__end__")},onDragLeave:W,onDrop:X=>$(X,"__end__"),label:"Move group to end"}),u.jsx(dL,{ungroupedCategories:(l.ungrouped||[]).sort((X,ie)=>X[1].sort_order-ie[1].sort_order),categoryGroups:o,categoryBalances:m,loadingBalances:g,dragType:k,draggedId:D,dragOverId:N,dragOverGroupId:F,editingCategoryId:ye,setEditingCategoryId:Ie,createForGroupId:Ee,setCreateForGroupId:Ce,handleCreateCategory:x,handleUpdateCategory:E,handleDeleteCategory:C,handleMoveCategory:T,handleCategoryDragStart:M,handleCategoryDragOver:R,handleDragOverGroup:K,handleDragLeaveGroup:q,handleDragLeave:W,handleDragEnd:J,handleCategoryDrop:Z,handleDropOnGroup:re,setDragOverId:H,setDragOverGroupId:j,categories:s,hasGroups:o.length>0})]}),d.length>0&&u.jsx("div",{style:{marginBottom:"2rem"},children:u.jsxs(W0,{title:"Hidden Categories",count:d.length,children:[u.jsxs("div",{style:{padding:"0.75rem",marginBottom:"1rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",fontSize:"0.85rem"},children:[u.jsxs("p",{style:{margin:"0 0 0.5rem 0",opacity:.8},children:[u.jsx("strong",{children:" Hidden categories"})," are excluded from dropdowns and balance displays. They're useful for historical categories that you want to keep for record-keeping but don't need in everyday use."]}),u.jsx("p",{style:{margin:0,opacity:.6},children:'To unhide a category, click it to edit and uncheck "Hidden category".'})]}),u.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:d.map(([X,ie])=>ye===X?u.jsx(Wu,{initialData:{name:ie.name,description:ie.description,category_group_id:ie.category_group_id,default_monthly_amount:ie.default_monthly_amount,default_monthly_type:ie.default_monthly_type,is_hidden:ie.is_hidden},onSubmit:we=>{E(X,we),Ie(null)},onCancel:()=>Ie(null),submitLabel:"Save",categoryGroups:o,showGroupSelector:!0},X):u.jsxs("div",{onClick:()=>Ie(X),style:{padding:"0.75rem 1rem",background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"8px",cursor:"pointer",display:"flex",justifyContent:"space-between",alignItems:"center",opacity:.7},children:[u.jsx("span",{children:ie.name}),u.jsx("span",{style:{color:Pt(ie.balance),fontWeight:500},children:Je(ie.balance)})]},X))})]})}),He?u.jsx(bA,{onSubmit:X=>{A(X),Me(!1)},onCancel:()=>Me(!1),submitLabel:"Create Group"}):u.jsx(Ve,{variant:"primary-large",actionName:"Open Add Category Group Form",onClick:()=>Me(!0),children:"+ Add Category Group"})]})}function fL(){const{selectedBudgetId:t,currentUserId:e}=zt(),{budget:n,budgetUserIds:r,acceptedUserIds:s}=An(),{inviteUser:o}=WB(),{revokeUser:l}=QB(),[d,h]=O.useState(""),[m,p]=O.useState(!1),[g,v]=O.useState(null),[_,S]=O.useState(null);if(!n)return u.jsx("p",{children:"No budget found."});async function x(A){if(A.preventDefault(),!(!d.trim()||!n||!t)){p(!0),v(null),S(null);try{await o.mutateAsync({budgetId:t,userId:d.trim()}),h(""),S("Invite sent! The user can now accept the invitation from their account.")}catch(B){v(B instanceof Error?B.message:"Failed to invite user")}finally{p(!1)}}}async function E(A){if(!n||!t)return;if(A===n.owner_id){v("Cannot revoke the budget owner");return}if(A===e){v("Cannot revoke yourself from the budget");return}const B=s.includes(A);if(confirm(B?"Are you sure you want to revoke this user's access? They will lose access to this budget.":"Are you sure you want to cancel this invitation?")){v(null),S(null);try{await l.mutateAsync({budgetId:t,userId:A}),S(B?"User access revoked.":"Invitation cancelled.")}catch(G){v(G instanceof Error?G.message:"Failed to revoke user")}}}const C=r.filter(A=>s.includes(A)),T=r.filter(A=>!s.includes(A));return u.jsxs("div",{children:[u.jsx("h2",{style:{marginTop:0},children:"Budget Users"}),u.jsx("p",{style:{opacity:.7,marginBottom:"1.5rem"},children:"Invite users to access this budget. They must accept the invitation before they can access it."}),g&&u.jsxs("div",{style:{background:"rgba(220, 38, 38, 0.1)",border:"1px solid rgba(220, 38, 38, 0.3)",color:"#f87171",padding:"0.75rem 1rem",borderRadius:"8px",marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[u.jsx("span",{children:g}),u.jsx("button",{onClick:()=>v(null),style:{background:"transparent",border:"none",color:"#f87171",cursor:"pointer",fontSize:"1.2rem",padding:"0 0.25rem",lineHeight:1},children:""})]}),_&&u.jsxs("div",{style:{background:"rgba(34, 197, 94, 0.1)",border:"1px solid rgba(34, 197, 94, 0.3)",color:"#4ade80",padding:"0.75rem 1rem",borderRadius:"8px",marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[u.jsx("span",{children:_}),u.jsx("button",{onClick:()=>S(null),style:{background:"transparent",border:"none",color:"#4ade80",cursor:"pointer",fontSize:"1.2rem",padding:"0 0.25rem",lineHeight:1},children:""})]}),u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px",marginBottom:"1.5rem"},children:[u.jsxs("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem"},children:["Active Users (",C.length,")"]}),C.length===0?u.jsx("p",{style:{opacity:.6,margin:0},children:"No users have accepted invitations yet."}):u.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:C.map(A=>{const B=A===n.owner_id,U=A===e;return u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 8%, transparent)",padding:"0.75rem 1rem",borderRadius:"6px",display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem"},children:[u.jsx("div",{style:{flex:1,minWidth:0},children:u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flexWrap:"wrap"},children:[u.jsx("code",{style:{fontSize:"0.85rem",background:"color-mix(in srgb, currentColor 10%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",wordBreak:"break-all"},children:A}),B&&u.jsx("span",{style:{background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.7rem",textTransform:"uppercase",fontWeight:600},children:"Owner"}),U&&u.jsx("span",{style:{background:"color-mix(in srgb, #22c55e 20%, transparent)",color:"#4ade80",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.7rem",textTransform:"uppercase",fontWeight:600},children:"You"})]})}),!B&&!U&&u.jsx("button",{onClick:()=>E(A),style:{background:"transparent",border:"1px solid rgba(220, 38, 38, 0.4)",color:"#f87171",padding:"0.4rem 0.75rem",borderRadius:"6px",cursor:"pointer",fontSize:"0.8rem",whiteSpace:"nowrap"},children:"Revoke Access"})]},A)})})]}),T.length>0&&u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px",marginBottom:"1.5rem"},children:[u.jsxs("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem"},children:["Pending Invitations (",T.length,")"]}),u.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:T.map(A=>u.jsxs("div",{style:{background:"color-mix(in srgb, #f59e0b 10%, transparent)",border:"1px solid color-mix(in srgb, #f59e0b 30%, transparent)",padding:"0.75rem 1rem",borderRadius:"6px",display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem"},children:[u.jsx("div",{style:{flex:1,minWidth:0},children:u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flexWrap:"wrap"},children:[u.jsx("code",{style:{fontSize:"0.85rem",background:"color-mix(in srgb, currentColor 10%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",wordBreak:"break-all"},children:A}),u.jsx("span",{style:{background:"color-mix(in srgb, #f59e0b 20%, transparent)",color:"#fbbf24",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.7rem",textTransform:"uppercase",fontWeight:600},children:"Pending"})]})}),u.jsx("button",{onClick:()=>E(A),style:{background:"transparent",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)",color:"inherit",padding:"0.4rem 0.75rem",borderRadius:"6px",cursor:"pointer",fontSize:"0.8rem",whiteSpace:"nowrap",opacity:.8},children:"Cancel Invite"})]},A))})]}),u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px"},children:[u.jsx("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem"},children:"Invite User"}),u.jsxs("form",{onSubmit:x,style:{display:"flex",gap:"0.75rem"},children:[u.jsx("input",{type:"text",value:d,onChange:A=>h(A.target.value),placeholder:"Enter Firebase User ID",style:{flex:1,padding:"0.6rem 0.8rem",borderRadius:"6px",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"0.95rem",color:"inherit"}}),u.jsx("button",{type:"submit",disabled:m||!d.trim(),style:{background:"#646cff",color:"white",border:"none",padding:"0.6rem 1.25rem",borderRadius:"6px",cursor:m||!d.trim()?"not-allowed":"pointer",fontWeight:500,opacity:m||!d.trim()?.7:1,whiteSpace:"nowrap"},children:m?"Inviting...":"Send Invite"})]}),u.jsx("p",{style:{margin:"1rem 0 0 0",fontSize:"0.85rem",opacity:.6},children:" The invited user will need to accept the invitation from their Account page using this budget's ID:"}),u.jsx("code",{style:{display:"block",marginTop:"0.5rem",padding:"0.5rem 0.75rem",background:"color-mix(in srgb, currentColor 10%, transparent)",borderRadius:"6px",fontSize:"0.85rem",wordBreak:"break-all"},children:n.id})]})]})}const mL=["budget","feedback","migration","tests"];function pL(){const{isAdmin:t,isTest:e,lastAdminTab:n,setLastAdminTab:r,setPageTitle:s}=zt();O.useLayoutEffect(()=>{s("Budget Admin")},[s]);const o=Vn(),l=o.pathname==="/budget/admin",d=O.useMemo(()=>{const g=o.pathname;return g.includes("/admin/budget")?"budget":g.includes("/admin/feedback")?"feedback":g.includes("/admin/migration")?"migration":g.includes("/admin/tests")?"tests":"budget"},[o.pathname]),h=d==="tests";O.useEffect(()=>{l||r(d)},[d,l,r]);function m(){return!mL.includes(n)||n==="tests"&&!e?"budget":n}const p=O.useMemo(()=>[{id:"budget",label:"Budget",icon:""},{id:"feedback",label:"Feedback",icon:""},{id:"migration",label:"Migration",icon:""},{id:"tests",label:"Tests",icon:"",hidden:!e}],[e]);return t?!e&&h?u.jsxs("div",{children:[u.jsx("h1",{children:"Access Denied"}),u.jsx("p",{style:{opacity:.7},children:"Only test users can access this section."}),u.jsx("p",{style:{marginTop:"1rem"},children:u.jsx(Cn,{to:"/budget/admin/budget",children:"Go to Admin "})})]}):u.jsxs("div",{children:[u.jsx(Bf,{mode:"link",linkPrefix:"/budget/admin",tabs:p,activeTab:d}),l?u.jsx(Vf,{to:`/budget/admin/${m()}`,replace:!0}):u.jsx($f,{})]}):u.jsxs("div",{children:[u.jsx("h1",{children:"Access Denied"}),u.jsx("p",{style:{opacity:.7},children:"Only administrators can access this section."}),u.jsx("p",{style:{marginTop:"1rem"},children:u.jsx(Cn,{to:"/budget",children:"Go to Budget "})})]})}function gL(){const{addLoadingHold:t,removeLoadingHold:e}=nr(),{isAdmin:n}=zt(),{budget:r,accounts:s,accountGroups:o,categories:l,categoryGroups:d,isOwner:h,isLoading:m}=An();return O.useEffect(()=>(m?t("settings-budget","Loading budget info..."):e("settings-budget"),()=>e("settings-budget")),[m,t,e]),m?null:r?u.jsxs("div",{children:[u.jsx("h2",{style:{marginTop:0},children:"Budget Summary"}),u.jsx("p",{style:{opacity:.7,marginBottom:"1.5rem"},children:"Information about the currently selected budget."}),u.jsx("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px",marginBottom:"1.5rem"},children:u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem",fontSize:"0.95rem"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{children:""}),u.jsx("span",{style:{opacity:.7,minWidth:"80px"},children:"Name:"}),u.jsx("strong",{children:r.name})]}),u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{children:""}),u.jsx("span",{style:{opacity:.7,minWidth:"80px"},children:"ID:"}),u.jsx("code",{style:{background:"color-mix(in srgb, currentColor 10%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",fontSize:"0.85rem"},children:r.id})]}),u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{children:""}),u.jsx("span",{style:{opacity:.7,minWidth:"80px"},children:"Owner:"}),u.jsx("strong",{children:r.owner_email||r.owner_id})]}),u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{children:""}),u.jsx("span",{style:{opacity:.7,minWidth:"80px"},children:"Users:"}),u.jsxs("span",{children:[r.user_ids.length," user",r.user_ids.length!==1?"s":"",u.jsxs("span",{style:{opacity:.7},children:["  ",h?"You are the owner":"Shared with you"]})]})]})]})}),n&&u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px"},children:[u.jsx("h3",{style:{margin:"0 0 0.75rem 0",fontSize:"1rem"},children:"Admin Tools"}),u.jsx("button",{onClick:()=>{const p={...r,accounts:s,account_groups:o,categories:l,category_groups:d,_meta:{downloaded_at:new Date().toISOString()}},g=new Blob([JSON.stringify(p,null,2)],{type:"application/json"}),v=URL.createObjectURL(g),_=document.createElement("a");_.href=v,_.download=`budget_${r.id}.json`,document.body.appendChild(_),_.click(),document.body.removeChild(_),URL.revokeObjectURL(v)},style:{display:"inline-flex",alignItems:"center",gap:"0.5rem",background:"color-mix(in srgb, currentColor 10%, transparent)",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",borderRadius:"6px",padding:"0.5rem 0.75rem",cursor:"pointer",fontSize:"0.85rem",color:"inherit",transition:"background 0.15s"},title:"Download budget document as JSON (for debugging)",children:" Download Budget JSON"})]})]}):u.jsx("p",{style:{opacity:.7},children:"No budget selected."})}function i1({selectedType:t,onSelect:e}){return u.jsx("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"0.75rem",paddingBottom:"1rem",flexWrap:"wrap"},children:["critical_bug","bug","new_feature","core_feature","qol"].map(n=>{const r=Ny[n],s=t==="feature"?"new_feature":t,o=s===n||!s&&n==="bug";return u.jsxs("button",{type:"button",onClick:()=>{r.label,e(n)},style:{flex:1,padding:"0.6rem 0.75rem",border:`2px solid ${r.color}`,borderRadius:"0.5rem",background:o?r.bgColor:"transparent",color:o?r.color:"rgba(255,255,255,0.5)",cursor:"pointer",fontWeight:o?600:400,fontSize:"0.85rem",transition:"all 0.15s ease",opacity:o?1:.5,boxShadow:o?`0 0 12px ${r.bgColor}`:"none",position:"relative"},children:[r.label,o&&u.jsx("span",{style:{position:"absolute",bottom:"-14px",left:"10%",right:"10%",height:"3px",background:"white",borderRadius:"2px"}})]},n)})})}function yL(){const[t,e]=O.useState(null),[n,r]=O.useState(null),[s,o]=O.useState(null),[l,d]=O.useState(!1),[h,m]=O.useState(""),[p,g]=O.useState("bug"),[v,_]=O.useState(null),[S,x]=O.useState(null),E=O.useContext(hd),T=Da().get_current_firebase_user(),A=z6(),{submitFeedback:B}=oA(),{toggleFeedback:U}=bz(),{updateSortOrder:G}=vz(),k=A.data?.items||[],{addLoadingHold:D,removeLoadingHold:N}=nr();O.useEffect(()=>(A.isLoading?D("settings-feedback","Loading feedback..."):N("settings-feedback"),()=>N("settings-feedback")),[A.isLoading,D,N]);function F($){$.preventDefault(),!(!h.trim()||!E.username||!T)&&(B.mutate({userId:T.uid,userEmail:E.username,text:h.trim(),feedbackType:p,currentPath:"/settings/feedback"}),m(""),g("bug"),d(!1))}function H($){$.is_done?j($):_($)}async function j($){try{await U.mutateAsync({item:$})}catch(te){e(te instanceof Error?te.message:"Failed to update feedback")}}function M(){v&&(j(v),_(null))}async function R($){if(S){try{const se=k.filter(ae=>ae.doc_id===S.doc_id).map(ae=>({id:ae.id,text:ae.text,created_at:ae.created_at,is_done:ae.is_done,completed_at:ae.completed_at,sort_order:ae.sort_order,feedback_type:ae.id===S.id?$:ae.feedback_type}));await G.mutateAsync({docId:S.doc_id,items:se})}catch(te){e(te instanceof Error?te.message:"Failed to update feedback type")}x(null)}}const K=k.filter($=>!$.is_done).sort(($,te)=>$.sort_order-te.sort_order),W=k.filter($=>$.is_done).sort(($,te)=>new Date(te.completed_at||0).getTime()-new Date($.completed_at||0).getTime());function q($,te){r(te),$.dataTransfer.effectAllowed="move"}function J($,te){$.preventDefault(),te!==n&&o(te)}function Z(){o(null)}function re(){r(null),o(null)}async function P($,te){if($.preventDefault(),!n||n===te){re();return}const se=K.findIndex(Ce=>Ce.id===n),ae=[...K],[ye]=ae.splice(se,1);if(te==="__end__")ae.push(ye);else{const Ce=ae.findIndex(pe=>pe.id===te);ae.splice(Ce,0,ye)}const Ie=ae.map((Ce,pe)=>({...Ce,sort_order:pe}));re();const Ee=new Map;for(const Ce of Ie)Ee.has(Ce.doc_id)||Ee.set(Ce.doc_id,[]),Ee.get(Ce.doc_id).push({id:Ce.id,text:Ce.text,created_at:Ce.created_at,is_done:Ce.is_done,completed_at:Ce.completed_at,sort_order:Ce.sort_order,feedback_type:Ce.feedback_type});for(const Ce of W)Ee.has(Ce.doc_id)||Ee.set(Ce.doc_id,[]),Ee.get(Ce.doc_id).push({id:Ce.id,text:Ce.text,created_at:Ce.created_at,is_done:Ce.is_done,completed_at:Ce.completed_at,sort_order:Ce.sort_order,feedback_type:Ce.feedback_type});try{for(const[Ce,pe]of Ee)await G.mutateAsync({docId:Ce,items:pe})}catch(Ce){e(Ce instanceof Error?Ce.message:"Failed to save order")}}return A.isLoading?null:u.jsxs("div",{children:[u.jsx("h2",{style:{marginTop:0},children:"Feedback"}),u.jsx("p",{style:{...XT,fontSize:"0.9rem"},children:"View and manage user feedback. Drag to reorder pending items."}),t&&u.jsx(No,{message:t,onDismiss:()=>e(null)}),u.jsxs("div",{style:Xl,children:[K.length===0&&!l&&u.jsx("p",{style:{opacity:.7},children:"No pending feedback."}),K.map($=>u.jsx(uz,{item:$,isDragging:n===$.id,isDragOver:s===$.id,onDragStart:te=>q(te,$.id),onDragOver:te=>J(te,$.id),onDragLeave:Z,onDragEnd:re,onDrop:te=>P(te,$.id),onToggleDone:()=>H($),onTypeClick:()=>x($)},$.id)),n&&K.length>0&&u.jsx(G0,{isActive:s==="__end__",onDragOver:$=>J($,"__end__"),onDragLeave:Z,onDrop:$=>P($,"__end__")})]}),l?u.jsxs(Es,{actionName:"Add Feedback",onSubmit:F,children:[u.jsx(i1,{selectedType:p,onSelect:g}),u.jsx(q0,{value:h,onChange:$=>m($.target.value),placeholder:"Enter your feedback, bug report, or feature request...",autoFocus:!0,required:!0}),u.jsxs(Na,{children:[u.jsx(Ve,{type:"submit",actionName:"Add Feedback",disabled:!h.trim(),children:"Add Feedback"}),u.jsx(Ve,{type:"button",variant:"secondary",actionName:"Cancel Add Feedback",onClick:()=>{d(!1),m(""),g("bug")},children:"Cancel"})]})]}):u.jsx(Ve,{variant:"primary-large",actionName:"Open Add Feedback Form",onClick:()=>d(!0),children:"+ Add Feedback"}),W.length>0&&u.jsx(W0,{title:"Completed",count:W.length,children:u.jsx("div",{style:{...Xl,marginTop:"0.5rem"},children:W.map($=>u.jsx(dz,{item:$,onToggleDone:()=>H($),onTypeClick:()=>x($)},$.id))})}),u.jsxs(Hi,{isOpen:v!==null,onClose:()=>_(null),title:"Mark as Complete",children:[u.jsx("p",{style:{margin:"0 0 1.5rem 0"},children:"Are you sure you want to mark this feedback item as complete?"}),v&&u.jsxs("p",{style:{margin:"0 0 1.5rem 0",padding:"0.75rem",background:"rgba(255,255,255,0.05)",borderRadius:"0.5rem",fontSize:"0.9rem"},children:['"',v.text,'"']}),u.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[u.jsx(Ve,{variant:"secondary",actionName:"Cancel Mark Complete",onClick:()=>_(null),children:"Cancel"}),u.jsx(Ve,{variant:"primary",actionName:"Confirm Mark Complete",onClick:M,children:"Mark Complete"})]})]}),u.jsxs(Hi,{isOpen:S!==null,onClose:()=>x(null),title:"Change Feedback Type",children:[u.jsx("p",{style:{margin:"0 0 1rem 0",fontSize:"0.9rem",opacity:.8},children:"Select a new type for this feedback:"}),u.jsx(i1,{selectedType:S?.feedback_type||"bug",onSelect:R}),u.jsx(Ve,{variant:"secondary",actionName:"Cancel Change Feedback Type",onClick:()=>x(null),style:{width:"100%"},children:"Cancel"})]})]})}function _L(){try{localStorage.removeItem("BUDGET_APP_QUERY_CACHE")}catch{}window.location.reload()}function bL(){const e=Da().get_current_firebase_user(),{selectedBudgetId:n}=zt(),r=Q3({currentUser:e}),s=BP({currentUser:e}),o=Y3({currentUser:e}),l=MP({currentUser:e}),d=pP({currentUser:e}),h=dP({currentUser:e}),m=xP({currentUser:e}),p=iP({currentUser:e}),g=FP({currentUser:e,budgetId:n}),v=qP({currentUser:e}),_=Z3({currentUser:e}),S=J3({currentUser:e}),x=r.isScanning||s.isScanning||o.isScanning||l.isScanning||d.isScanning||h.isScanning||m.isScanning||p.isScanning||_.isScanning||S.isScanning,E=r.isRunning||s.isRunning||o.isMigratingFeedback||d.isRunning||h.isRunning||m.isRunning||p.isRunning||_.isDeleting||S.isDeleting||g.isDownloading||v.isUploading,C=async()=>{await Promise.all([r.scanStatus(),s.scanStatus(),o.scanStatus(),l.scan(),d.scanStatus(),h.scanStatus(),m.scanStatus(),p.scan(),_.scanStatus(),S.scanStatus()])},T=o.status&&(o.status.sanitizedDocuments.length>0||o.status.corruptedDocuments.length>0),A=o.status?o.status.sanitizedDocuments.length+o.status.corruptedDocuments.length:0;return u.jsxs("div",{children:[u.jsx("style",{children:"@keyframes spin { to { transform: rotate(360deg); } }"}),u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"},children:[u.jsx("h2",{style:{margin:0},children:"Data Migrations"}),u.jsxs("button",{onClick:C,disabled:x||E,style:{background:"#646cff",color:"white",border:"none",padding:"0.5rem 1rem",borderRadius:"6px",cursor:x||E?"not-allowed":"pointer",fontWeight:500,opacity:x||E?.7:1,display:"flex",alignItems:"center",gap:"0.4rem",minWidth:"130px",minHeight:"36px"},children:[u.jsx("span",{style:{width:"18px",height:"18px",display:"inline-flex",justifyContent:"center",alignItems:"center",flexShrink:0},children:x?u.jsx(Ln,{noMargin:!0}):""}),"Refresh All"]})]}),u.jsx("p",{style:{opacity:.7,marginBottom:"1.5rem"},children:'Run migrations to validate and fix your database. Click "Refresh All" to scan Firestore directly.'}),u.jsx(Pz,{disabled:!e,onDownloadBackup:g.downloadBudget,isDownloadingBackup:g.isDownloading,databaseCleanup:{status:r.status,hasData:!!r.status,hasIssues:r.hasIssues,totalIssues:r.totalIssues,isScanning:r.isScanning,isRunning:r.isRunning,result:r.result,scanStatus:r.scanStatus,runCleanup:r.runCleanup},hiddenField:{status:s.status,hasData:!!s.status,needsMigration:s.needsMigration,totalItemsToFix:s.totalItemsToFix,isScanning:s.isScanning,isRunning:s.isRunning,result:s.result,scanStatus:s.scanStatus,runMigration:s.runMigration},feedback:{status:o.status,hasData:!!o.status,hasIssues:!!T,totalIssues:A,isScanning:o.isScanning,isMigrating:o.isMigratingFeedback,result:o.feedbackMigrationResult,scanStatus:o.scanStatus,migrateFeedbackDocuments:o.migrateFeedbackDocuments}}),u.jsx(Uz,{disabled:!e,onDownloadBackup:g.downloadBudget,isDownloadingBackup:g.isDownloading,accountCategoryValidation:{status:l.status,hasData:!!l.status,hasViolations:l.hasViolations,violationCount:l.violationCount,isScanning:l.isScanning,report:l.report,scan:l.scan},orphanedIdCleanup:{status:d.status,hasData:!!d.status,hasItemsToFix:d.hasItemsToFix,totalOrphaned:d.status?d.status.orphanedCategoryIds+d.status.orphanedAccountIds:0,isScanning:d.isScanning,isRunning:d.isRunning,result:d.result,scanStatus:d.scanStatus,runMigration:d.runMigration},expenseToAdjustment:{status:h.status,hasData:!!h.status,hasItemsToMigrate:h.hasItemsToMigrate,totalToMigrate:h.status?.expensesToMigrate??0,isScanning:h.isScanning,isRunning:h.isRunning,result:h.result,scanStatus:h.scanStatus,runMigration:h.runMigration},adjustmentsToTransfers:{status:m.status,hasData:!!m.status,hasPairsToConvert:m.hasPairsToConvert,totalPairs:m.status?.pairsFound??0,isScanning:m.isScanning,isRunning:m.isRunning,result:m.result,scanStatus:m.scanStatus,runMigration:m.runMigration},precisionCleanup:{status:p.status,hasData:p.hasData,hasIssues:p.hasIssues,totalIssues:p.totalIssues,isScanning:p.isScanning,isRunning:p.isRunning,result:p.result,scan:p.scan,runCleanup:p.runCleanup}}),u.jsx(qz,{disabled:!e,onDownloadBackup:g.downloadBudget,isDownloadingBackup:g.isDownloading,budgetDownloadUpload:{isDownloading:g.isDownloading,downloadProgress:g.progress,downloadError:g.error,downloadBudget:g.downloadBudget,isScanning:v.isScanning,isUploading:v.isUploading,uploadStatus:v.status,uploadProgress:v.progress,uploadError:v.error,uploadResult:v.result,scanZipFile:v.scanZipFile,uploadBudget:v.uploadBudget},deleteAllMonths:{status:_.status,hasData:!!_.status,monthsCount:_.status?.monthsCount??0,budgetCount:_.status?.budgetCount??0,isScanning:_.isScanning,isDeleting:_.isDeleting,deleteResult:_.deleteResult,deleteProgress:_.deleteProgress,scanStatus:_.scanStatus,deleteAllMonths:_.deleteAllMonths},deleteSampleUserBudget:{status:S.status,hasData:!!S.status,totalBudgets:S.status?.totalBudgets??0,totalMonths:S.status?.totalMonths??0,isScanning:S.isScanning,isDeleting:S.isDeleting,deleteResult:S.deleteResult,deleteProgress:S.deleteProgress,scanStatus:S.scanStatus,deleteSampleUserBudget:S.deleteSampleUserBudget},onClearCache:_L}),u.jsx("div",{style:{background:"color-mix(in srgb, currentColor 3%, transparent)",padding:"1rem",borderRadius:"8px",fontSize:"0.85rem"},children:u.jsxs("p",{style:{margin:0,opacity:.7},children:[u.jsx("strong",{children:"Note:"})," These migrations will process ",u.jsx("strong",{children:"all budgets and months"})," in the system, not just the ones you own or are invited to."]})}),u.jsx(JT,{})]})}function Tl({name:t,description:e,expectedBehavior:n,result:r,onRun:s,disabled:o,expectedToSucceed:l}){const d=r?.status==="passed"?ce.success:r?.status==="failed"?ce.danger:r?.status==="running"?ce.warning:"inherit";return u.jsxs("div",{style:{...pd,display:"flex",flexDirection:"column",gap:"0.5rem"},children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",gap:"1rem"},children:[u.jsxs("div",{style:{flex:1},children:[u.jsx("h4",{style:{margin:0,fontSize:"0.95rem"},children:t}),u.jsx("p",{style:{margin:"0.25rem 0 0",opacity:.7,fontSize:"0.85rem"},children:e}),u.jsxs("p",{style:{margin:"0.25rem 0 0",fontSize:"0.8rem",color:l?ce.success:ce.warning},children:["Expected: ",n]})]}),u.jsx(Ve,{onClick:s,disabled:o,variant:"secondary",style:{flexShrink:0},children:r?.status==="running"?"":"Run"})]}),r&&r.status!=="pending"&&u.jsx("div",{style:{padding:"0.5rem 0.75rem",borderRadius:"6px",background:`color-mix(in srgb, ${d} 15%, transparent)`,border:`1px solid color-mix(in srgb, ${d} 30%, transparent)`,fontSize:"0.85rem",color:d},children:r.message})]})}function vL({totalCount:t,passedCount:e,failedCount:n}){return u.jsxs("div",{style:{display:"flex",gap:"1rem",padding:"0.75rem 1rem",borderRadius:"8px",background:"color-mix(in srgb, currentColor 5%, transparent)",marginBottom:"1rem"},children:[u.jsxs("span",{children:["Total: ",u.jsx("strong",{children:t})]}),u.jsxs("span",{style:{color:ce.success},children:["Passed: ",u.jsx("strong",{children:e})]}),u.jsxs("span",{style:{color:ce.danger},children:["Failed: ",u.jsx("strong",{children:n})]})]})}const s1=[{name:"Read unauthorized budget",expectedToFail:!0},{name:"Read another user's document",expectedToFail:!0},{name:"Read unauthorized budget month",expectedToFail:!0},{name:"Toggle is_admin in own permission_flags",expectedToFail:!0},{name:"Toggle is_test in own permission_flags",expectedToFail:!0},{name:"Read own user document",expectedToFail:!1}];function xL(){const{currentUserId:t}=zt(),[e,n]=O.useState([]),[r,s]=O.useState(!1);function o(_,S){n(x=>x.map(E=>E.name===_?{...E,...S}:E))}async function l(_,S,x){o(_,{status:"running",message:"Running..."});try{const E=await S();x?o(_,{status:"failed",message:` ${E}`}):o(_,{status:"passed",message:` ${E}`})}catch(E){const C=E instanceof Error?E.message:"Unknown error";x?o(_,{status:"passed",message:` Blocked as expected: ${C}`}):o(_,{status:"failed",message:` ${C}`})}}async function d(){s(!0),n(s1.map(_=>({..._,status:"pending",message:""})));for(const _ of s1)await h(_.name);s(!1)}async function h(_){switch(_){case"Read unauthorized budget":await l(_,async()=>(await bt("budgets","unauthorized_budget_test_12345","security test: attempting unauthorized budget read"),"Was able to read budget (unexpected)"),!0);break;case"Read another user's document":await l(_,async()=>(await bt("users","another_user_test_12345","security test: attempting unauthorized user read"),"Was able to read user document (unexpected)"),!0);break;case"Read unauthorized budget month":await l(_,async()=>(await bt("months","unauthorized_budget_test_12345_2024_01","security test: attempting unauthorized month read"),"Was able to read month document for unauthorized budget (unexpected)"),!0);break;case"Toggle is_admin in own permission_flags":await l(_,async()=>{if(!t)throw new Error("Not authenticated");const{data:S}=await bt("users",t,"security test: reading own user to get current is_admin value"),x=S?.permission_flags?.is_admin??!1;return await Ql("users",t,{"permission_flags.is_admin":!x},"security test: attempting to toggle is_admin (should fail)"),`Was able to change is_admin from ${x} to ${!x} (SECURITY ISSUE!)`},!0);break;case"Toggle is_test in own permission_flags":await l(_,async()=>{if(!t)throw new Error("Not authenticated");const{data:S}=await bt("users",t,"security test: reading own user to get current is_test value"),x=S?.permission_flags?.is_test??!1;return await Ql("users",t,{"permission_flags.is_test":!x},"security test: attempting to toggle is_test (should fail)"),`Was able to change is_test from ${x} to ${!x} (SECURITY ISSUE!)`},!0);break;case"Read own user document":await l(_,async()=>{if(!t)throw new Error("Not authenticated");const{exists:S}=await bt("users",t,"security test: reading own user document (should succeed)");if(S)return"Successfully read own document";throw new Error("Document does not exist")},!1);break}}async function m(_){e.find(x=>x.name===_)||n(x=>[...x,{name:_,status:"pending",message:"",expectedToFail:!0}]),s(!0),await h(_),s(!1)}const p=e.filter(_=>_.status==="passed").length,g=e.filter(_=>_.status==="failed").length,v=e.length;return u.jsxs("div",{children:[u.jsx("p",{style:XT,children:'Run security tests to verify Firestore rules are working correctly. Tests that are expected to fail (blocked by security rules) should show as "passed".'}),u.jsx("div",{style:{marginBottom:"1.5rem"},children:u.jsx(Ve,{onClick:d,disabled:r,variant:"primary",children:r?"Running Tests...":"Run All Tests"})}),e.length>0&&u.jsx(vL,{totalCount:v,passedCount:p,failedCount:g}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:[u.jsx("h3",{style:{margin:"0.5rem 0"},children:"Individual Tests"}),u.jsx(Tl,{name:"Read unauthorized budget",description:"Try to read a budget the user doesn't have access to",expectedBehavior:"Should be blocked by Firestore rules",result:e.find(_=>_.name==="Read unauthorized budget"),onRun:()=>m("Read unauthorized budget"),disabled:r}),u.jsx(Tl,{name:"Read another user's document",description:"Try to read another user's profile document",expectedBehavior:"Should be blocked by Firestore rules",result:e.find(_=>_.name==="Read another user's document"),onRun:()=>m("Read another user's document"),disabled:r}),u.jsx(Tl,{name:"Read unauthorized budget month",description:"Try to read a month document for a budget you don't have access to",expectedBehavior:"Should be blocked - months inherit budget access",result:e.find(_=>_.name==="Read unauthorized budget month"),onRun:()=>m("Read unauthorized budget month"),disabled:r}),u.jsx(Tl,{name:"Toggle is_admin in own permission_flags",description:"Try to change your admin privileges (toggles current value)",expectedBehavior:"Should be blocked - permission_flags is protected",result:e.find(_=>_.name==="Toggle is_admin in own permission_flags"),onRun:()=>m("Toggle is_admin in own permission_flags"),disabled:r}),u.jsx(Tl,{name:"Toggle is_test in own permission_flags",description:"Try to change your test privileges (toggles current value)",expectedBehavior:"Should be blocked - permission_flags is protected",result:e.find(_=>_.name==="Toggle is_test in own permission_flags"),onRun:()=>m("Toggle is_test in own permission_flags"),disabled:r}),u.jsx(Tl,{name:"Read own user document",description:"Read your own user profile document",expectedBehavior:"Should succeed - users can read their own data",result:e.find(_=>_.name==="Read own user document"),onRun:()=>m("Read own user document"),disabled:r,expectedToSucceed:!0})]}),g>0&&u.jsxs(No,{style:{marginTop:"1.5rem"},children:[" ",g," test(s) failed! This may indicate a security vulnerability in your Firestore rules."]})]})}function wL({children:t}){const{addLoadingHold:e,removeLoadingHold:n}=nr(),r=O.useContext(hd),s=Vn();return O.useEffect(()=>(r.is_auth_checked?n("protected-route"):e("protected-route","Checking authentication..."),()=>n("protected-route")),[r.is_auth_checked,e,n]),r.is_auth_checked?r.is_logged_in?t?u.jsx(u.Fragment,{children:t}):u.jsx($f,{}):u.jsx(Vf,{to:"/account",state:{from:s.pathname},replace:!0}):null}function SL(){const{addLoadingHold:t,removeLoadingHold:e}=nr(),{isInitialized:n,pageTitle:r}=zt(),{isLoading:s,error:o}=An();return O.useEffect(()=>{n?e("budget-init"):t("budget-init",s?"Fetching data from server...":"Loading budget...")},[n,s,t,e]),O.useEffect(()=>()=>e("budget-init"),[e]),o?(console.error("[BudgetLayout] Error:",o),u.jsx("div",{style:Pf,children:u.jsxs("p",{style:{color:"#ef4444"},children:["Error: ",o.message]})})):u.jsx("div",{style:{...Pf,paddingBottom:"5rem"},children:u.jsxs(cA,{children:[u.jsx(Rz,{title:r}),n&&u.jsx($f,{})]})})}const EL={is_logged_in:!1,is_auth_checked:!1,username:"",set_user_context:()=>{}};function CL(){const{isLoading:t,loadingMessage:e}=nr();return t?u.jsx(K0,{message:e}):null}function TL(){const[t,e]=O.useState(EL),n=Da(),r=O.useRef(!1),{addLoadingHold:s,removeLoadingHold:o}=nr();return O.useEffect(function(){r.current||(r.current=!0,n.set_user_listener(l=>{e({is_logged_in:l!=null,is_auth_checked:!0,username:l?.email??"",set_user_context:e})}))},[n]),O.useEffect(()=>{t.is_auth_checked?o("auth"):s("auth","Authenticating...")},[t.is_auth_checked,s,o]),t.is_auth_checked?u.jsx(hd.Provider,{value:t,children:u.jsx(HO,{children:u.jsx(A3,{children:u.jsx(V3,{children:u.jsxs(Oj,{children:[u.jsxs(lj,{children:[u.jsx(xn,{path:"/",element:u.jsx(Gz,{})}),u.jsx(xn,{path:"/account",element:u.jsx(Wz,{})}),u.jsx(xn,{path:"/budget",element:u.jsx(wL,{}),children:u.jsxs(xn,{element:u.jsx(SL,{}),children:[u.jsx(xn,{index:!0,element:u.jsx(n1,{})}),u.jsx(xn,{path:":year/:month/:tab/:view?",element:u.jsx(n1,{})}),u.jsx(xn,{path:"analytics",element:u.jsx(HB,{})}),u.jsx(xn,{path:"my-budgets",element:u.jsx(JB,{})}),u.jsxs(xn,{path:"settings",element:u.jsx(tL,{}),children:[u.jsx(xn,{index:!0,element:u.jsx(Vf,{to:"categories",replace:!0})}),u.jsx(xn,{path:"accounts",element:u.jsx(lL,{})}),u.jsx(xn,{path:"categories",element:u.jsx(hL,{})}),u.jsx(xn,{path:"users",element:u.jsx(fL,{})})]}),u.jsxs(xn,{path:"admin",element:u.jsx(pL,{}),children:[u.jsx(xn,{path:"budget",element:u.jsx(gL,{})}),u.jsx(xn,{path:"feedback",element:u.jsx(yL,{})}),u.jsx(xn,{path:"migration",element:u.jsx(bL,{})}),u.jsx(xn,{path:"tests",element:u.jsx(xL,{})})]})]})})]}),u.jsx(Tz,{}),u.jsx(Sz,{}),u.jsx(JT,{})]})})})})}):null}function AL(){return u.jsxs(Hj,{children:[u.jsx(CL,{}),u.jsx(TL,{})]})}l2.createRoot(document.getElementById("root")).render(u.jsx(O.StrictMode,{children:u.jsx(AL,{})}));
