(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function n(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=n(i);fetch(i.href,o)}})();var Lh=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function V2(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Eg={exports:{}},_u={};var Tx;function $2(){if(Tx)return _u;Tx=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function n(r,i,o){var l=null;if(o!==void 0&&(l=""+o),i.key!==void 0&&(l=""+i.key),"key"in i){o={};for(var d in i)d!=="key"&&(o[d]=i[d])}else o=i;return i=o.ref,{$$typeof:t,type:r,key:l,ref:i!==void 0?i:null,props:o}}return _u.Fragment=e,_u.jsx=n,_u.jsxs=n,_u}var Ax;function q2(){return Ax||(Ax=1,Eg.exports=$2()),Eg.exports}var u=q2(),Tg={exports:{}},tt={};var jx;function H2(){if(jx)return tt;jx=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),o=Symbol.for("react.consumer"),l=Symbol.for("react.context"),d=Symbol.for("react.forward_ref"),h=Symbol.for("react.suspense"),f=Symbol.for("react.memo"),p=Symbol.for("react.lazy"),g=Symbol.for("react.activity"),v=Symbol.iterator;function _(z){return z===null||typeof z!="object"?null:(z=v&&z[v]||z["@@iterator"],typeof z=="function"?z:null)}var C={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},x=Object.assign,w={};function E(z,H,re){this.props=z,this.context=H,this.refs=w,this.updater=re||C}E.prototype.isReactComponent={},E.prototype.setState=function(z,H){if(typeof z!="object"&&typeof z!="function"&&z!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,z,H,"setState")},E.prototype.forceUpdate=function(z){this.updater.enqueueForceUpdate(this,z,"forceUpdate")};function T(){}T.prototype=E.prototype;function R(z,H,re){this.props=z,this.context=H,this.refs=w,this.updater=re||C}var M=R.prototype=new T;M.constructor=R,x(M,E.prototype),M.isPureReactComponent=!0;var V=Array.isArray;function $(){}var I={H:null,A:null,T:null,S:null},D=Object.prototype.hasOwnProperty;function P(z,H,re){var ne=re.ref;return{$$typeof:t,type:z,key:H,ref:ne!==void 0?ne:null,props:re}}function L(z,H){return P(z.type,H,z.props)}function q(z){return typeof z=="object"&&z!==null&&z.$$typeof===t}function A(z){var H={"=":"=0",":":"=2"};return"$"+z.replace(/[=:]/g,function(re){return H[re]})}var O=/\/+/g;function N(z,H){return typeof z=="object"&&z!==null&&z.key!=null?A(""+z.key):H.toString(36)}function J(z){switch(z.status){case"fulfilled":return z.value;case"rejected":throw z.reason;default:switch(typeof z.status=="string"?z.then($,$):(z.status="pending",z.then(function(H){z.status==="pending"&&(z.status="fulfilled",z.value=H)},function(H){z.status==="pending"&&(z.status="rejected",z.reason=H)})),z.status){case"fulfilled":return z.value;case"rejected":throw z.reason}}throw z}function Y(z,H,re,ne,ie){var be=typeof z;(be==="undefined"||be==="boolean")&&(z=null);var Ce=!1;if(z===null)Ce=!0;else switch(be){case"bigint":case"string":case"number":Ce=!0;break;case"object":switch(z.$$typeof){case t:case e:Ce=!0;break;case p:return Ce=z._init,Y(Ce(z._payload),H,re,ne,ie)}}if(Ce)return ie=ie(z),Ce=ne===""?"."+N(z,0):ne,V(ie)?(re="",Ce!=null&&(re=Ce.replace(O,"$&/")+"/"),Y(ie,H,re,"",function(Oe){return Oe})):ie!=null&&(q(ie)&&(ie=L(ie,re+(ie.key==null||z&&z.key===ie.key?"":(""+ie.key).replace(O,"$&/")+"/")+Ce)),H.push(ie)),1;Ce=0;var ce=ne===""?".":ne+":";if(V(z))for(var ge=0;ge<z.length;ge++)ne=z[ge],be=ce+N(ne,ge),Ce+=Y(ne,H,re,be,ie);else if(ge=_(z),typeof ge=="function")for(z=ge.call(z),ge=0;!(ne=z.next()).done;)ne=ne.value,be=ce+N(ne,ge++),Ce+=Y(ne,H,re,be,ie);else if(be==="object"){if(typeof z.then=="function")return Y(J(z),H,re,ne,ie);throw H=String(z),Error("Objects are not valid as a React child (found: "+(H==="[object Object]"?"object with keys {"+Object.keys(z).join(", ")+"}":H)+"). If you meant to render a collection of children, use an array instead.")}return Ce}function G(z,H,re){if(z==null)return z;var ne=[],ie=0;return Y(z,ne,"","",function(be){return H.call(re,be,ie++)}),ne}function Z(z){if(z._status===-1){var H=z._result;H=H(),H.then(function(re){(z._status===0||z._status===-1)&&(z._status=1,z._result=re)},function(re){(z._status===0||z._status===-1)&&(z._status=2,z._result=re)}),z._status===-1&&(z._status=0,z._result=H)}if(z._status===1)return z._result.default;throw z._result}var Q=typeof reportError=="function"?reportError:function(z){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var H=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof z=="object"&&z!==null&&typeof z.message=="string"?String(z.message):String(z),error:z});if(!window.dispatchEvent(H))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",z);return}console.error(z)},te={map:G,forEach:function(z,H,re){G(z,function(){H.apply(this,arguments)},re)},count:function(z){var H=0;return G(z,function(){H++}),H},toArray:function(z){return G(z,function(H){return H})||[]},only:function(z){if(!q(z))throw Error("React.Children.only expected to receive a single React element child.");return z}};return tt.Activity=g,tt.Children=te,tt.Component=E,tt.Fragment=n,tt.Profiler=i,tt.PureComponent=R,tt.StrictMode=r,tt.Suspense=h,tt.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=I,tt.__COMPILER_RUNTIME={__proto__:null,c:function(z){return I.H.useMemoCache(z)}},tt.cache=function(z){return function(){return z.apply(null,arguments)}},tt.cacheSignal=function(){return null},tt.cloneElement=function(z,H,re){if(z==null)throw Error("The argument must be a React element, but you passed "+z+".");var ne=x({},z.props),ie=z.key;if(H!=null)for(be in H.key!==void 0&&(ie=""+H.key),H)!D.call(H,be)||be==="key"||be==="__self"||be==="__source"||be==="ref"&&H.ref===void 0||(ne[be]=H[be]);var be=arguments.length-2;if(be===1)ne.children=re;else if(1<be){for(var Ce=Array(be),ce=0;ce<be;ce++)Ce[ce]=arguments[ce+2];ne.children=Ce}return P(z.type,ie,ne)},tt.createContext=function(z){return z={$$typeof:l,_currentValue:z,_currentValue2:z,_threadCount:0,Provider:null,Consumer:null},z.Provider=z,z.Consumer={$$typeof:o,_context:z},z},tt.createElement=function(z,H,re){var ne,ie={},be=null;if(H!=null)for(ne in H.key!==void 0&&(be=""+H.key),H)D.call(H,ne)&&ne!=="key"&&ne!=="__self"&&ne!=="__source"&&(ie[ne]=H[ne]);var Ce=arguments.length-2;if(Ce===1)ie.children=re;else if(1<Ce){for(var ce=Array(Ce),ge=0;ge<Ce;ge++)ce[ge]=arguments[ge+2];ie.children=ce}if(z&&z.defaultProps)for(ne in Ce=z.defaultProps,Ce)ie[ne]===void 0&&(ie[ne]=Ce[ne]);return P(z,be,ie)},tt.createRef=function(){return{current:null}},tt.forwardRef=function(z){return{$$typeof:d,render:z}},tt.isValidElement=q,tt.lazy=function(z){return{$$typeof:p,_payload:{_status:-1,_result:z},_init:Z}},tt.memo=function(z,H){return{$$typeof:f,type:z,compare:H===void 0?null:H}},tt.startTransition=function(z){var H=I.T,re={};I.T=re;try{var ne=z(),ie=I.S;ie!==null&&ie(re,ne),typeof ne=="object"&&ne!==null&&typeof ne.then=="function"&&ne.then($,Q)}catch(be){Q(be)}finally{H!==null&&re.types!==null&&(H.types=re.types),I.T=H}},tt.unstable_useCacheRefresh=function(){return I.H.useCacheRefresh()},tt.use=function(z){return I.H.use(z)},tt.useActionState=function(z,H,re){return I.H.useActionState(z,H,re)},tt.useCallback=function(z,H){return I.H.useCallback(z,H)},tt.useContext=function(z){return I.H.useContext(z)},tt.useDebugValue=function(){},tt.useDeferredValue=function(z,H){return I.H.useDeferredValue(z,H)},tt.useEffect=function(z,H){return I.H.useEffect(z,H)},tt.useEffectEvent=function(z){return I.H.useEffectEvent(z)},tt.useId=function(){return I.H.useId()},tt.useImperativeHandle=function(z,H,re){return I.H.useImperativeHandle(z,H,re)},tt.useInsertionEffect=function(z,H){return I.H.useInsertionEffect(z,H)},tt.useLayoutEffect=function(z,H){return I.H.useLayoutEffect(z,H)},tt.useMemo=function(z,H){return I.H.useMemo(z,H)},tt.useOptimistic=function(z,H){return I.H.useOptimistic(z,H)},tt.useReducer=function(z,H,re){return I.H.useReducer(z,H,re)},tt.useRef=function(z){return I.H.useRef(z)},tt.useState=function(z){return I.H.useState(z)},tt.useSyncExternalStore=function(z,H,re){return I.H.useSyncExternalStore(z,H,re)},tt.useTransition=function(){return I.H.useTransition()},tt.version="19.2.3",tt}var Rx;function By(){return Rx||(Rx=1,Tg.exports=H2()),Tg.exports}var k=By(),Ag={exports:{}},bu={},jg={exports:{}},Rg={};var Ix;function G2(){return Ix||(Ix=1,(function(t){function e(Y,G){var Z=Y.length;Y.push(G);e:for(;0<Z;){var Q=Z-1>>>1,te=Y[Q];if(0<i(te,G))Y[Q]=G,Y[Z]=te,Z=Q;else break e}}function n(Y){return Y.length===0?null:Y[0]}function r(Y){if(Y.length===0)return null;var G=Y[0],Z=Y.pop();if(Z!==G){Y[0]=Z;e:for(var Q=0,te=Y.length,z=te>>>1;Q<z;){var H=2*(Q+1)-1,re=Y[H],ne=H+1,ie=Y[ne];if(0>i(re,Z))ne<te&&0>i(ie,re)?(Y[Q]=ie,Y[ne]=Z,Q=ne):(Y[Q]=re,Y[H]=Z,Q=H);else if(ne<te&&0>i(ie,Z))Y[Q]=ie,Y[ne]=Z,Q=ne;else break e}}return G}function i(Y,G){var Z=Y.sortIndex-G.sortIndex;return Z!==0?Z:Y.id-G.id}if(t.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var o=performance;t.unstable_now=function(){return o.now()}}else{var l=Date,d=l.now();t.unstable_now=function(){return l.now()-d}}var h=[],f=[],p=1,g=null,v=3,_=!1,C=!1,x=!1,w=!1,E=typeof setTimeout=="function"?setTimeout:null,T=typeof clearTimeout=="function"?clearTimeout:null,R=typeof setImmediate<"u"?setImmediate:null;function M(Y){for(var G=n(f);G!==null;){if(G.callback===null)r(f);else if(G.startTime<=Y)r(f),G.sortIndex=G.expirationTime,e(h,G);else break;G=n(f)}}function V(Y){if(x=!1,M(Y),!C)if(n(h)!==null)C=!0,$||($=!0,A());else{var G=n(f);G!==null&&J(V,G.startTime-Y)}}var $=!1,I=-1,D=5,P=-1;function L(){return w?!0:!(t.unstable_now()-P<D)}function q(){if(w=!1,$){var Y=t.unstable_now();P=Y;var G=!0;try{e:{C=!1,x&&(x=!1,T(I),I=-1),_=!0;var Z=v;try{t:{for(M(Y),g=n(h);g!==null&&!(g.expirationTime>Y&&L());){var Q=g.callback;if(typeof Q=="function"){g.callback=null,v=g.priorityLevel;var te=Q(g.expirationTime<=Y);if(Y=t.unstable_now(),typeof te=="function"){g.callback=te,M(Y),G=!0;break t}g===n(h)&&r(h),M(Y)}else r(h);g=n(h)}if(g!==null)G=!0;else{var z=n(f);z!==null&&J(V,z.startTime-Y),G=!1}}break e}finally{g=null,v=Z,_=!1}G=void 0}}finally{G?A():$=!1}}}var A;if(typeof R=="function")A=function(){R(q)};else if(typeof MessageChannel<"u"){var O=new MessageChannel,N=O.port2;O.port1.onmessage=q,A=function(){N.postMessage(null)}}else A=function(){E(q,0)};function J(Y,G){I=E(function(){Y(t.unstable_now())},G)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(Y){Y.callback=null},t.unstable_forceFrameRate=function(Y){0>Y||125<Y?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):D=0<Y?Math.floor(1e3/Y):5},t.unstable_getCurrentPriorityLevel=function(){return v},t.unstable_next=function(Y){switch(v){case 1:case 2:case 3:var G=3;break;default:G=v}var Z=v;v=G;try{return Y()}finally{v=Z}},t.unstable_requestPaint=function(){w=!0},t.unstable_runWithPriority=function(Y,G){switch(Y){case 1:case 2:case 3:case 4:case 5:break;default:Y=3}var Z=v;v=Y;try{return G()}finally{v=Z}},t.unstable_scheduleCallback=function(Y,G,Z){var Q=t.unstable_now();switch(typeof Z=="object"&&Z!==null?(Z=Z.delay,Z=typeof Z=="number"&&0<Z?Q+Z:Q):Z=Q,Y){case 1:var te=-1;break;case 2:te=250;break;case 5:te=1073741823;break;case 4:te=1e4;break;default:te=5e3}return te=Z+te,Y={id:p++,callback:G,priorityLevel:Y,startTime:Z,expirationTime:te,sortIndex:-1},Z>Q?(Y.sortIndex=Z,e(f,Y),n(h)===null&&Y===n(f)&&(x?(T(I),I=-1):x=!0,J(V,Z-Q))):(Y.sortIndex=te,e(h,Y),C||_||(C=!0,$||($=!0,A()))),Y},t.unstable_shouldYield=L,t.unstable_wrapCallback=function(Y){var G=v;return function(){var Z=v;v=G;try{return Y.apply(this,arguments)}finally{v=Z}}}})(Rg)),Rg}var kx;function W2(){return kx||(kx=1,jg.exports=G2()),jg.exports}var Ig={exports:{}},Yn={};var Dx;function Q2(){if(Dx)return Yn;Dx=1;var t=By();function e(h){var f="https://react.dev/errors/"+h;if(1<arguments.length){f+="?args[]="+encodeURIComponent(arguments[1]);for(var p=2;p<arguments.length;p++)f+="&args[]="+encodeURIComponent(arguments[p])}return"Minified React error #"+h+"; visit "+f+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function n(){}var r={d:{f:n,r:function(){throw Error(e(522))},D:n,C:n,L:n,m:n,X:n,S:n,M:n},p:0,findDOMNode:null},i=Symbol.for("react.portal");function o(h,f,p){var g=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:i,key:g==null?null:""+g,children:h,containerInfo:f,implementation:p}}var l=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function d(h,f){if(h==="font")return"";if(typeof f=="string")return f==="use-credentials"?f:""}return Yn.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=r,Yn.createPortal=function(h,f){var p=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!f||f.nodeType!==1&&f.nodeType!==9&&f.nodeType!==11)throw Error(e(299));return o(h,f,null,p)},Yn.flushSync=function(h){var f=l.T,p=r.p;try{if(l.T=null,r.p=2,h)return h()}finally{l.T=f,r.p=p,r.d.f()}},Yn.preconnect=function(h,f){typeof h=="string"&&(f?(f=f.crossOrigin,f=typeof f=="string"?f==="use-credentials"?f:"":void 0):f=null,r.d.C(h,f))},Yn.prefetchDNS=function(h){typeof h=="string"&&r.d.D(h)},Yn.preinit=function(h,f){if(typeof h=="string"&&f&&typeof f.as=="string"){var p=f.as,g=d(p,f.crossOrigin),v=typeof f.integrity=="string"?f.integrity:void 0,_=typeof f.fetchPriority=="string"?f.fetchPriority:void 0;p==="style"?r.d.S(h,typeof f.precedence=="string"?f.precedence:void 0,{crossOrigin:g,integrity:v,fetchPriority:_}):p==="script"&&r.d.X(h,{crossOrigin:g,integrity:v,fetchPriority:_,nonce:typeof f.nonce=="string"?f.nonce:void 0})}},Yn.preinitModule=function(h,f){if(typeof h=="string")if(typeof f=="object"&&f!==null){if(f.as==null||f.as==="script"){var p=d(f.as,f.crossOrigin);r.d.M(h,{crossOrigin:p,integrity:typeof f.integrity=="string"?f.integrity:void 0,nonce:typeof f.nonce=="string"?f.nonce:void 0})}}else f==null&&r.d.M(h)},Yn.preload=function(h,f){if(typeof h=="string"&&typeof f=="object"&&f!==null&&typeof f.as=="string"){var p=f.as,g=d(p,f.crossOrigin);r.d.L(h,p,{crossOrigin:g,integrity:typeof f.integrity=="string"?f.integrity:void 0,nonce:typeof f.nonce=="string"?f.nonce:void 0,type:typeof f.type=="string"?f.type:void 0,fetchPriority:typeof f.fetchPriority=="string"?f.fetchPriority:void 0,referrerPolicy:typeof f.referrerPolicy=="string"?f.referrerPolicy:void 0,imageSrcSet:typeof f.imageSrcSet=="string"?f.imageSrcSet:void 0,imageSizes:typeof f.imageSizes=="string"?f.imageSizes:void 0,media:typeof f.media=="string"?f.media:void 0})}},Yn.preloadModule=function(h,f){if(typeof h=="string")if(f){var p=d(f.as,f.crossOrigin);r.d.m(h,{as:typeof f.as=="string"&&f.as!=="script"?f.as:void 0,crossOrigin:p,integrity:typeof f.integrity=="string"?f.integrity:void 0})}else r.d.m(h)},Yn.requestFormReset=function(h){r.d.r(h)},Yn.unstable_batchedUpdates=function(h,f){return h(f)},Yn.useFormState=function(h,f,p){return l.H.useFormState(h,f,p)},Yn.useFormStatus=function(){return l.H.useHostTransitionStatus()},Yn.version="19.2.3",Yn}var Mx;function K2(){if(Mx)return Ig.exports;Mx=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),Ig.exports=Q2(),Ig.exports}var Ox;function Y2(){if(Ox)return bu;Ox=1;var t=W2(),e=By(),n=K2();function r(s){var a="https://react.dev/errors/"+s;if(1<arguments.length){a+="?args[]="+encodeURIComponent(arguments[1]);for(var c=2;c<arguments.length;c++)a+="&args[]="+encodeURIComponent(arguments[c])}return"Minified React error #"+s+"; visit "+a+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(s){return!(!s||s.nodeType!==1&&s.nodeType!==9&&s.nodeType!==11)}function o(s){var a=s,c=s;if(s.alternate)for(;a.return;)a=a.return;else{s=a;do a=s,(a.flags&4098)!==0&&(c=a.return),s=a.return;while(s)}return a.tag===3?c:null}function l(s){if(s.tag===13){var a=s.memoizedState;if(a===null&&(s=s.alternate,s!==null&&(a=s.memoizedState)),a!==null)return a.dehydrated}return null}function d(s){if(s.tag===31){var a=s.memoizedState;if(a===null&&(s=s.alternate,s!==null&&(a=s.memoizedState)),a!==null)return a.dehydrated}return null}function h(s){if(o(s)!==s)throw Error(r(188))}function f(s){var a=s.alternate;if(!a){if(a=o(s),a===null)throw Error(r(188));return a!==s?null:s}for(var c=s,m=a;;){var b=c.return;if(b===null)break;var S=b.alternate;if(S===null){if(m=b.return,m!==null){c=m;continue}break}if(b.child===S.child){for(S=b.child;S;){if(S===c)return h(b),s;if(S===m)return h(b),a;S=S.sibling}throw Error(r(188))}if(c.return!==m.return)c=b,m=S;else{for(var B=!1,W=b.child;W;){if(W===c){B=!0,c=b,m=S;break}if(W===m){B=!0,m=b,c=S;break}W=W.sibling}if(!B){for(W=S.child;W;){if(W===c){B=!0,c=S,m=b;break}if(W===m){B=!0,m=S,c=b;break}W=W.sibling}if(!B)throw Error(r(189))}}if(c.alternate!==m)throw Error(r(190))}if(c.tag!==3)throw Error(r(188));return c.stateNode.current===c?s:a}function p(s){var a=s.tag;if(a===5||a===26||a===27||a===6)return s;for(s=s.child;s!==null;){if(a=p(s),a!==null)return a;s=s.sibling}return null}var g=Object.assign,v=Symbol.for("react.element"),_=Symbol.for("react.transitional.element"),C=Symbol.for("react.portal"),x=Symbol.for("react.fragment"),w=Symbol.for("react.strict_mode"),E=Symbol.for("react.profiler"),T=Symbol.for("react.consumer"),R=Symbol.for("react.context"),M=Symbol.for("react.forward_ref"),V=Symbol.for("react.suspense"),$=Symbol.for("react.suspense_list"),I=Symbol.for("react.memo"),D=Symbol.for("react.lazy"),P=Symbol.for("react.activity"),L=Symbol.for("react.memo_cache_sentinel"),q=Symbol.iterator;function A(s){return s===null||typeof s!="object"?null:(s=q&&s[q]||s["@@iterator"],typeof s=="function"?s:null)}var O=Symbol.for("react.client.reference");function N(s){if(s==null)return null;if(typeof s=="function")return s.$$typeof===O?null:s.displayName||s.name||null;if(typeof s=="string")return s;switch(s){case x:return"Fragment";case E:return"Profiler";case w:return"StrictMode";case V:return"Suspense";case $:return"SuspenseList";case P:return"Activity"}if(typeof s=="object")switch(s.$$typeof){case C:return"Portal";case R:return s.displayName||"Context";case T:return(s._context.displayName||"Context")+".Consumer";case M:var a=s.render;return s=s.displayName,s||(s=a.displayName||a.name||"",s=s!==""?"ForwardRef("+s+")":"ForwardRef"),s;case I:return a=s.displayName||null,a!==null?a:N(s.type)||"Memo";case D:a=s._payload,s=s._init;try{return N(s(a))}catch{}}return null}var J=Array.isArray,Y=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,G=n.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Z={pending:!1,data:null,method:null,action:null},Q=[],te=-1;function z(s){return{current:s}}function H(s){0>te||(s.current=Q[te],Q[te]=null,te--)}function re(s,a){te++,Q[te]=s.current,s.current=a}var ne=z(null),ie=z(null),be=z(null),Ce=z(null);function ce(s,a){switch(re(be,a),re(ie,s),re(ne,null),a.nodeType){case 9:case 11:s=(s=a.documentElement)&&(s=s.namespaceURI)?Kv(s):0;break;default:if(s=a.tagName,a=a.namespaceURI)a=Kv(a),s=Yv(a,s);else switch(s){case"svg":s=1;break;case"math":s=2;break;default:s=0}}H(ne),re(ne,s)}function ge(){H(ne),H(ie),H(be)}function Oe(s){s.memoizedState!==null&&re(Ce,s);var a=ne.current,c=Yv(a,s.type);a!==c&&(re(ie,s),re(ne,c))}function ze(s){ie.current===s&&(H(ne),H(ie)),Ce.current===s&&(H(Ce),mu._currentValue=Z)}var ot,st;function U(s){if(ot===void 0)try{throw Error()}catch(c){var a=c.stack.trim().match(/\n( *(at )?)/);ot=a&&a[1]||"",st=-1<c.stack.indexOf(`
    at`)?" (<anonymous>)":-1<c.stack.indexOf("@")?"@unknown:0:0":""}return`
`+ot+s+st}var de=!1;function ye(s,a){if(!s||de)return"";de=!0;var c=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var m={DetermineComponentFrameRoot:function(){try{if(a){var Ie=function(){throw Error()};if(Object.defineProperty(Ie.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Ie,[])}catch(xe){var _e=xe}Reflect.construct(s,[],Ie)}else{try{Ie.call()}catch(xe){_e=xe}s.call(Ie.prototype)}}else{try{throw Error()}catch(xe){_e=xe}(Ie=s())&&typeof Ie.catch=="function"&&Ie.catch(function(){})}}catch(xe){if(xe&&_e&&typeof xe.stack=="string")return[xe.stack,_e.stack]}return[null,null]}};m.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var b=Object.getOwnPropertyDescriptor(m.DetermineComponentFrameRoot,"name");b&&b.configurable&&Object.defineProperty(m.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var S=m.DetermineComponentFrameRoot(),B=S[0],W=S[1];if(B&&W){var se=B.split(`
`),pe=W.split(`
`);for(b=m=0;m<se.length&&!se[m].includes("DetermineComponentFrameRoot");)m++;for(;b<pe.length&&!pe[b].includes("DetermineComponentFrameRoot");)b++;if(m===se.length||b===pe.length)for(m=se.length-1,b=pe.length-1;1<=m&&0<=b&&se[m]!==pe[b];)b--;for(;1<=m&&0<=b;m--,b--)if(se[m]!==pe[b]){if(m!==1||b!==1)do if(m--,b--,0>b||se[m]!==pe[b]){var Ee=`
`+se[m].replace(" at new "," at ");return s.displayName&&Ee.includes("<anonymous>")&&(Ee=Ee.replace("<anonymous>",s.displayName)),Ee}while(1<=m&&0<=b);break}}}finally{de=!1,Error.prepareStackTrace=c}return(c=s?s.displayName||s.name:"")?U(c):""}function ee(s,a){switch(s.tag){case 26:case 27:case 5:return U(s.type);case 16:return U("Lazy");case 13:return s.child!==a&&a!==null?U("Suspense Fallback"):U("Suspense");case 19:return U("SuspenseList");case 0:case 15:return ye(s.type,!1);case 11:return ye(s.type.render,!1);case 1:return ye(s.type,!0);case 31:return U("Activity");default:return""}}function X(s){try{var a="",c=null;do a+=ee(s,c),c=s,s=s.return;while(s);return a}catch(m){return`
Error generating stack: `+m.message+`
`+m.stack}}var oe=Object.prototype.hasOwnProperty,Se=t.unstable_scheduleCallback,we=t.unstable_cancelCallback,ae=t.unstable_shouldYield,je=t.unstable_requestPaint,Ne=t.unstable_now,De=t.unstable_getCurrentPriorityLevel,qe=t.unstable_ImmediatePriority,xt=t.unstable_UserBlockingPriority,rt=t.unstable_NormalPriority,Qn=t.unstable_LowPriority,gs=t.unstable_IdlePriority,nr=t.log,ys=t.unstable_setDisableYieldValue,vt=null,tn=null;function Kn(s){if(typeof nr=="function"&&ys(s),tn&&typeof tn.setStrictMode=="function")try{tn.setStrictMode(vt,s)}catch{}}var Ct=Math.clz32?Math.clz32:qo,qa=Math.log,Di=Math.LN2;function qo(s){return s>>>=0,s===0?32:31-(qa(s)/Di|0)|0}var Mr=256,_s=262144,Ut=4194304;function rr(s){var a=s&42;if(a!==0)return a;switch(s&-s){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return s&261888;case 262144:case 524288:case 1048576:case 2097152:return s&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return s&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return s}}function bs(s,a,c){var m=s.pendingLanes;if(m===0)return 0;var b=0,S=s.suspendedLanes,B=s.pingedLanes;s=s.warmLanes;var W=m&134217727;return W!==0?(m=W&~S,m!==0?b=rr(m):(B&=W,B!==0?b=rr(B):c||(c=W&~s,c!==0&&(b=rr(c))))):(W=m&~S,W!==0?b=rr(W):B!==0?b=rr(B):c||(c=m&~s,c!==0&&(b=rr(c)))),b===0?0:a!==0&&a!==b&&(a&S)===0&&(S=b&-b,c=a&-a,S>=c||S===32&&(c&4194048)!==0)?a:b}function Xr(s,a){return(s.pendingLanes&~(s.suspendedLanes&~s.pingedLanes)&a)===0}function Rm(s,a){switch(s){case 1:case 2:case 4:case 8:case 64:return a+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function gd(){var s=Ut;return Ut<<=1,(Ut&62914560)===0&&(Ut=4194304),s}function vs(s){for(var a=[],c=0;31>c;c++)a.push(s);return a}function Ha(s,a){s.pendingLanes|=a,a!==268435456&&(s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0)}function Im(s,a,c,m,b,S){var B=s.pendingLanes;s.pendingLanes=c,s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0,s.expiredLanes&=c,s.entangledLanes&=c,s.errorRecoveryDisabledLanes&=c,s.shellSuspendCounter=0;var W=s.entanglements,se=s.expirationTimes,pe=s.hiddenUpdates;for(c=B&~c;0<c;){var Ee=31-Ct(c),Ie=1<<Ee;W[Ee]=0,se[Ee]=-1;var _e=pe[Ee];if(_e!==null)for(pe[Ee]=null,Ee=0;Ee<_e.length;Ee++){var xe=_e[Ee];xe!==null&&(xe.lane&=-536870913)}c&=~Ie}m!==0&&Ga(s,m,0),S!==0&&b===0&&s.tag!==0&&(s.suspendedLanes|=S&~(B&~a))}function Ga(s,a,c){s.pendingLanes|=a,s.suspendedLanes&=~a;var m=31-Ct(a);s.entangledLanes|=a,s.entanglements[m]=s.entanglements[m]|1073741824|c&261930}function bc(s,a){var c=s.entangledLanes|=a;for(s=s.entanglements;c;){var m=31-Ct(c),b=1<<m;b&a|s[m]&a&&(s[m]|=a),c&=~b}}function vc(s,a){var c=a&-a;return c=(c&42)!==0?1:Wa(c),(c&(s.suspendedLanes|a))!==0?0:c}function Wa(s){switch(s){case 2:s=1;break;case 8:s=4;break;case 32:s=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:s=128;break;case 268435456:s=134217728;break;default:s=0}return s}function Ys(s){return s&=-s,2<s?8<s?(s&134217727)!==0?32:268435456:8:2}function yd(){var s=G.p;return s!==0?s:(s=window.event,s===void 0?32:bx(s.type))}function Zr(s,a){var c=G.p;try{return G.p=s,a()}finally{G.p=c}}var Jr=Math.random().toString(36).slice(2),hn="__reactFiber$"+Jr,In="__reactProps$"+Jr,xs="__reactContainer$"+Jr,Ho="__reactEvents$"+Jr,km="__reactListeners$"+Jr,_d="__reactHandles$"+Jr,bd="__reactResources$"+Jr,ws="__reactMarker$"+Jr;function Go(s){delete s[hn],delete s[In],delete s[Ho],delete s[km],delete s[_d]}function Ss(s){var a=s[hn];if(a)return a;for(var c=s.parentNode;c;){if(a=c[xs]||c[hn]){if(c=a.alternate,a.child!==null||c!==null&&c.child!==null)for(s=rx(s);s!==null;){if(c=s[hn])return c;s=rx(s)}return a}s=c,c=s.parentNode}return null}function Or(s){if(s=s[hn]||s[xs]){var a=s.tag;if(a===5||a===6||a===13||a===31||a===26||a===27||a===3)return s}return null}function vr(s){var a=s.tag;if(a===5||a===26||a===27||a===6)return s.stateNode;throw Error(r(33))}function Cs(s){var a=s[bd];return a||(a=s[bd]={hoistableStyles:new Map,hoistableScripts:new Map}),a}function fn(s){s[ws]=!0}var xc=new Set,wc={};function Es(s,a){Ts(s,a),Ts(s+"Capture",a)}function Ts(s,a){for(wc[s]=a,s=0;s<a.length;s++)xc.add(a[s])}var Sc=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Cc={},Ec={};function vd(s){return oe.call(Ec,s)?!0:oe.call(Cc,s)?!1:Sc.test(s)?Ec[s]=!0:(Cc[s]=!0,!1)}function Wo(s,a,c){if(vd(a))if(c===null)s.removeAttribute(a);else{switch(typeof c){case"undefined":case"function":case"symbol":s.removeAttribute(a);return;case"boolean":var m=a.toLowerCase().slice(0,5);if(m!=="data-"&&m!=="aria-"){s.removeAttribute(a);return}}s.setAttribute(a,""+c)}}function xr(s,a,c){if(c===null)s.removeAttribute(a);else{switch(typeof c){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(a);return}s.setAttribute(a,""+c)}}function mn(s,a,c,m){if(m===null)s.removeAttribute(c);else{switch(typeof m){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(c);return}s.setAttributeNS(a,c,""+m)}}function kn(s){switch(typeof s){case"bigint":case"boolean":case"number":case"string":case"undefined":return s;case"object":return s;default:return""}}function Mi(s){var a=s.type;return(s=s.nodeName)&&s.toLowerCase()==="input"&&(a==="checkbox"||a==="radio")}function Tc(s,a,c){var m=Object.getOwnPropertyDescriptor(s.constructor.prototype,a);if(!s.hasOwnProperty(a)&&typeof m<"u"&&typeof m.get=="function"&&typeof m.set=="function"){var b=m.get,S=m.set;return Object.defineProperty(s,a,{configurable:!0,get:function(){return b.call(this)},set:function(B){c=""+B,S.call(this,B)}}),Object.defineProperty(s,a,{enumerable:m.enumerable}),{getValue:function(){return c},setValue:function(B){c=""+B},stopTracking:function(){s._valueTracker=null,delete s[a]}}}}function jt(s){if(!s._valueTracker){var a=Mi(s)?"checked":"value";s._valueTracker=Tc(s,a,""+s[a])}}function Qa(s){if(!s)return!1;var a=s._valueTracker;if(!a)return!0;var c=a.getValue(),m="";return s&&(m=Mi(s)?s.checked?"true":"false":s.value),s=m,s!==c?(a.setValue(s),!0):!1}function As(s){if(s=s||(typeof document<"u"?document:void 0),typeof s>"u")return null;try{return s.activeElement||s.body}catch{return s.body}}var Ka=/[\n"\\]/g;function lr(s){return s.replace(Ka,function(a){return"\\"+a.charCodeAt(0).toString(16)+" "})}function Qo(s,a,c,m,b,S,B,W){s.name="",B!=null&&typeof B!="function"&&typeof B!="symbol"&&typeof B!="boolean"?s.type=B:s.removeAttribute("type"),a!=null?B==="number"?(a===0&&s.value===""||s.value!=a)&&(s.value=""+kn(a)):s.value!==""+kn(a)&&(s.value=""+kn(a)):B!=="submit"&&B!=="reset"||s.removeAttribute("value"),a!=null?Ac(s,B,kn(a)):c!=null?Ac(s,B,kn(c)):m!=null&&s.removeAttribute("value"),b==null&&S!=null&&(s.defaultChecked=!!S),b!=null&&(s.checked=b&&typeof b!="function"&&typeof b!="symbol"),W!=null&&typeof W!="function"&&typeof W!="symbol"&&typeof W!="boolean"?s.name=""+kn(W):s.removeAttribute("name")}function xd(s,a,c,m,b,S,B,W){if(S!=null&&typeof S!="function"&&typeof S!="symbol"&&typeof S!="boolean"&&(s.type=S),a!=null||c!=null){if(!(S!=="submit"&&S!=="reset"||a!=null)){jt(s);return}c=c!=null?""+kn(c):"",a=a!=null?""+kn(a):c,W||a===s.value||(s.value=a),s.defaultValue=a}m=m??b,m=typeof m!="function"&&typeof m!="symbol"&&!!m,s.checked=W?s.checked:!!m,s.defaultChecked=!!m,B!=null&&typeof B!="function"&&typeof B!="symbol"&&typeof B!="boolean"&&(s.name=B),jt(s)}function Ac(s,a,c){a==="number"&&As(s.ownerDocument)===s||s.defaultValue===""+c||(s.defaultValue=""+c)}function Oi(s,a,c,m){if(s=s.options,a){a={};for(var b=0;b<c.length;b++)a["$"+c[b]]=!0;for(c=0;c<s.length;c++)b=a.hasOwnProperty("$"+s[c].value),s[c].selected!==b&&(s[c].selected=b),b&&m&&(s[c].defaultSelected=!0)}else{for(c=""+kn(c),a=null,b=0;b<s.length;b++){if(s[b].value===c){s[b].selected=!0,m&&(s[b].defaultSelected=!0);return}a!==null||s[b].disabled||(a=s[b])}a!==null&&(a.selected=!0)}}function wd(s,a,c){if(a!=null&&(a=""+kn(a),a!==s.value&&(s.value=a),c==null)){s.defaultValue!==a&&(s.defaultValue=a);return}s.defaultValue=c!=null?""+kn(c):""}function Ni(s,a,c,m){if(a==null){if(m!=null){if(c!=null)throw Error(r(92));if(J(m)){if(1<m.length)throw Error(r(93));m=m[0]}c=m}c==null&&(c=""),a=c}c=kn(a),s.defaultValue=c,m=s.textContent,m===c&&m!==""&&m!==null&&(s.value=m),jt(s)}function cr(s,a){if(a){var c=s.firstChild;if(c&&c===s.lastChild&&c.nodeType===3){c.nodeValue=a;return}}s.textContent=a}var Sd=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function jc(s,a,c){var m=a.indexOf("--")===0;c==null||typeof c=="boolean"||c===""?m?s.setProperty(a,""):a==="float"?s.cssFloat="":s[a]="":m?s.setProperty(a,c):typeof c!="number"||c===0||Sd.has(a)?a==="float"?s.cssFloat=c:s[a]=(""+c).trim():s[a]=c+"px"}function Rc(s,a,c){if(a!=null&&typeof a!="object")throw Error(r(62));if(s=s.style,c!=null){for(var m in c)!c.hasOwnProperty(m)||a!=null&&a.hasOwnProperty(m)||(m.indexOf("--")===0?s.setProperty(m,""):m==="float"?s.cssFloat="":s[m]="");for(var b in a)m=a[b],a.hasOwnProperty(b)&&c[b]!==m&&jc(s,b,m)}else for(var S in a)a.hasOwnProperty(S)&&jc(s,S,a[S])}function Ko(s){if(s.indexOf("-")===-1)return!1;switch(s){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Cd=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Pi=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Yo(s){return Pi.test(""+s)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":s}function es(){}var Ic=null;function Nr(s){return s=s.target||s.srcElement||window,s.correspondingUseElement&&(s=s.correspondingUseElement),s.nodeType===3?s.parentNode:s}var Bi=null,js=null;function Ya(s){var a=Or(s);if(a&&(s=a.stateNode)){var c=s[In]||null;e:switch(s=a.stateNode,a.type){case"input":if(Qo(s,c.value,c.defaultValue,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name),a=c.name,c.type==="radio"&&a!=null){for(c=s;c.parentNode;)c=c.parentNode;for(c=c.querySelectorAll('input[name="'+lr(""+a)+'"][type="radio"]'),a=0;a<c.length;a++){var m=c[a];if(m!==s&&m.form===s.form){var b=m[In]||null;if(!b)throw Error(r(90));Qo(m,b.value,b.defaultValue,b.defaultValue,b.checked,b.defaultChecked,b.type,b.name)}}for(a=0;a<c.length;a++)m=c[a],m.form===s.form&&Qa(m)}break e;case"textarea":wd(s,c.value,c.defaultValue);break e;case"select":a=c.value,a!=null&&Oi(s,!!c.multiple,a,!1)}}}var Xo=!1;function zi(s,a,c){if(Xo)return s(a,c);Xo=!0;try{var m=s(a);return m}finally{if(Xo=!1,(Bi!==null||js!==null)&&(yh(),Bi&&(a=Bi,s=js,js=Bi=null,Ya(a),s)))for(a=0;a<s.length;a++)Ya(s[a])}}function ts(s,a){var c=s.stateNode;if(c===null)return null;var m=c[In]||null;if(m===null)return null;c=m[a];e:switch(a){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(m=!m.disabled)||(s=s.type,m=!(s==="button"||s==="input"||s==="select"||s==="textarea")),s=!m;break e;default:s=!1}if(s)return null;if(c&&typeof c!="function")throw Error(r(231,a,typeof c));return c}var Pr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Xa=!1;if(Pr)try{var kt={};Object.defineProperty(kt,"passive",{get:function(){Xa=!0}}),window.addEventListener("test",kt,kt),window.removeEventListener("test",kt,kt)}catch{Xa=!1}var Rs=null,kc=null,Za=null;function Dc(){if(Za)return Za;var s,a=kc,c=a.length,m,b="value"in Rs?Rs.value:Rs.textContent,S=b.length;for(s=0;s<c&&a[s]===b[s];s++);var B=c-s;for(m=1;m<=B&&a[c-m]===b[S-m];m++);return Za=b.slice(s,1<m?1-m:void 0)}function Ja(s){var a=s.keyCode;return"charCode"in s?(s=s.charCode,s===0&&a===13&&(s=13)):s=a,s===10&&(s=13),32<=s||s===13?s:0}function Xs(){return!0}function ns(){return!1}function Nn(s){function a(c,m,b,S,B){this._reactName=c,this._targetInst=b,this.type=m,this.nativeEvent=S,this.target=B,this.currentTarget=null;for(var W in s)s.hasOwnProperty(W)&&(c=s[W],this[W]=c?c(S):S[W]);return this.isDefaultPrevented=(S.defaultPrevented!=null?S.defaultPrevented:S.returnValue===!1)?Xs:ns,this.isPropagationStopped=ns,this}return g(a.prototype,{preventDefault:function(){this.defaultPrevented=!0;var c=this.nativeEvent;c&&(c.preventDefault?c.preventDefault():typeof c.returnValue!="unknown"&&(c.returnValue=!1),this.isDefaultPrevented=Xs)},stopPropagation:function(){var c=this.nativeEvent;c&&(c.stopPropagation?c.stopPropagation():typeof c.cancelBubble!="unknown"&&(c.cancelBubble=!0),this.isPropagationStopped=Xs)},persist:function(){},isPersistent:Xs}),a}var Zs={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(s){return s.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Is=Nn(Zs),Li=g({},Zs,{view:0,detail:0}),Mc=Nn(Li),Ui,Zo,ks,Jo=g({},Li,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Fi,button:0,buttons:0,relatedTarget:function(s){return s.relatedTarget===void 0?s.fromElement===s.srcElement?s.toElement:s.fromElement:s.relatedTarget},movementX:function(s){return"movementX"in s?s.movementX:(s!==ks&&(ks&&s.type==="mousemove"?(Ui=s.screenX-ks.screenX,Zo=s.screenY-ks.screenY):Zo=Ui=0,ks=s),Ui)},movementY:function(s){return"movementY"in s?s.movementY:Zo}}),Oc=Nn(Jo),eo=g({},Jo,{dataTransfer:0}),Ed=Nn(eo),Td=g({},Li,{relatedTarget:0}),to=Nn(Td),Nc=g({},Zs,{animationName:0,elapsedTime:0,pseudoElement:0}),Ad=Nn(Nc),el=g({},Zs,{clipboardData:function(s){return"clipboardData"in s?s.clipboardData:window.clipboardData}}),jd=Nn(el),Rd=g({},Zs,{data:0}),Ds=Nn(Rd),Id={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},kd={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Dd={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Md(s){var a=this.nativeEvent;return a.getModifierState?a.getModifierState(s):(s=Dd[s])?!!a[s]:!1}function Fi(){return Md}var sr=g({},Li,{key:function(s){if(s.key){var a=Id[s.key]||s.key;if(a!=="Unidentified")return a}return s.type==="keypress"?(s=Ja(s),s===13?"Enter":String.fromCharCode(s)):s.type==="keydown"||s.type==="keyup"?kd[s.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Fi,charCode:function(s){return s.type==="keypress"?Ja(s):0},keyCode:function(s){return s.type==="keydown"||s.type==="keyup"?s.keyCode:0},which:function(s){return s.type==="keypress"?Ja(s):s.type==="keydown"||s.type==="keyup"?s.keyCode:0}}),Od=Nn(sr),Nd=g({},Jo,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Js=Nn(Nd),y=g({},Li,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Fi}),j=Nn(y),F=g({},Zs,{propertyName:0,elapsedTime:0,pseudoElement:0}),K=Nn(F),he=g({},Jo,{deltaX:function(s){return"deltaX"in s?s.deltaX:"wheelDeltaX"in s?-s.wheelDeltaX:0},deltaY:function(s){return"deltaY"in s?s.deltaY:"wheelDeltaY"in s?-s.wheelDeltaY:"wheelDelta"in s?-s.wheelDelta:0},deltaZ:0,deltaMode:0}),ve=Nn(he),Pe=g({},Zs,{newState:0,oldState:0}),it=Nn(Pe),sn=[9,13,27,32],Et=Pr&&"CompositionEvent"in window,Qt=null;Pr&&"documentMode"in document&&(Qt=document.documentMode);var Br=Pr&&"TextEvent"in window&&!Qt,Ms=Pr&&(!Et||Qt&&8<Qt&&11>=Qt),rs=" ",ss=!1;function no(s,a){switch(s){case"keyup":return sn.indexOf(a.keyCode)!==-1;case"keydown":return a.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function tl(s){return s=s.detail,typeof s=="object"&&"data"in s?s.data:null}var nl=!1;function hA(s,a){switch(s){case"compositionend":return tl(a);case"keypress":return a.which!==32?null:(ss=!0,rs);case"textInput":return s=a.data,s===rs&&ss?null:s;default:return null}}function fA(s,a){if(nl)return s==="compositionend"||!Et&&no(s,a)?(s=Dc(),Za=kc=Rs=null,nl=!1,s):null;switch(s){case"paste":return null;case"keypress":if(!(a.ctrlKey||a.altKey||a.metaKey)||a.ctrlKey&&a.altKey){if(a.char&&1<a.char.length)return a.char;if(a.which)return String.fromCharCode(a.which)}return null;case"compositionend":return Ms&&a.locale!=="ko"?null:a.data;default:return null}}var mA={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function a_(s){var a=s&&s.nodeName&&s.nodeName.toLowerCase();return a==="input"?!!mA[s.type]:a==="textarea"}function o_(s,a,c,m){Bi?js?js.push(m):js=[m]:Bi=m,a=Ch(a,"onChange"),0<a.length&&(c=new Is("onChange","change",null,c,m),s.push({event:c,listeners:a}))}var Pc=null,Bc=null;function pA(s){$v(s,0)}function Pd(s){var a=vr(s);if(Qa(a))return s}function l_(s,a){if(s==="change")return a}var c_=!1;if(Pr){var Dm;if(Pr){var Mm="oninput"in document;if(!Mm){var u_=document.createElement("div");u_.setAttribute("oninput","return;"),Mm=typeof u_.oninput=="function"}Dm=Mm}else Dm=!1;c_=Dm&&(!document.documentMode||9<document.documentMode)}function d_(){Pc&&(Pc.detachEvent("onpropertychange",h_),Bc=Pc=null)}function h_(s){if(s.propertyName==="value"&&Pd(Bc)){var a=[];o_(a,Bc,s,Nr(s)),zi(pA,a)}}function gA(s,a,c){s==="focusin"?(d_(),Pc=a,Bc=c,Pc.attachEvent("onpropertychange",h_)):s==="focusout"&&d_()}function yA(s){if(s==="selectionchange"||s==="keyup"||s==="keydown")return Pd(Bc)}function _A(s,a){if(s==="click")return Pd(a)}function bA(s,a){if(s==="input"||s==="change")return Pd(a)}function vA(s,a){return s===a&&(s!==0||1/s===1/a)||s!==s&&a!==a}var wr=typeof Object.is=="function"?Object.is:vA;function zc(s,a){if(wr(s,a))return!0;if(typeof s!="object"||s===null||typeof a!="object"||a===null)return!1;var c=Object.keys(s),m=Object.keys(a);if(c.length!==m.length)return!1;for(m=0;m<c.length;m++){var b=c[m];if(!oe.call(a,b)||!wr(s[b],a[b]))return!1}return!0}function f_(s){for(;s&&s.firstChild;)s=s.firstChild;return s}function m_(s,a){var c=f_(s);s=0;for(var m;c;){if(c.nodeType===3){if(m=s+c.textContent.length,s<=a&&m>=a)return{node:c,offset:a-s};s=m}e:{for(;c;){if(c.nextSibling){c=c.nextSibling;break e}c=c.parentNode}c=void 0}c=f_(c)}}function p_(s,a){return s&&a?s===a?!0:s&&s.nodeType===3?!1:a&&a.nodeType===3?p_(s,a.parentNode):"contains"in s?s.contains(a):s.compareDocumentPosition?!!(s.compareDocumentPosition(a)&16):!1:!1}function g_(s){s=s!=null&&s.ownerDocument!=null&&s.ownerDocument.defaultView!=null?s.ownerDocument.defaultView:window;for(var a=As(s.document);a instanceof s.HTMLIFrameElement;){try{var c=typeof a.contentWindow.location.href=="string"}catch{c=!1}if(c)s=a.contentWindow;else break;a=As(s.document)}return a}function Om(s){var a=s&&s.nodeName&&s.nodeName.toLowerCase();return a&&(a==="input"&&(s.type==="text"||s.type==="search"||s.type==="tel"||s.type==="url"||s.type==="password")||a==="textarea"||s.contentEditable==="true")}var xA=Pr&&"documentMode"in document&&11>=document.documentMode,rl=null,Nm=null,Lc=null,Pm=!1;function y_(s,a,c){var m=c.window===c?c.document:c.nodeType===9?c:c.ownerDocument;Pm||rl==null||rl!==As(m)||(m=rl,"selectionStart"in m&&Om(m)?m={start:m.selectionStart,end:m.selectionEnd}:(m=(m.ownerDocument&&m.ownerDocument.defaultView||window).getSelection(),m={anchorNode:m.anchorNode,anchorOffset:m.anchorOffset,focusNode:m.focusNode,focusOffset:m.focusOffset}),Lc&&zc(Lc,m)||(Lc=m,m=Ch(Nm,"onSelect"),0<m.length&&(a=new Is("onSelect","select",null,a,c),s.push({event:a,listeners:m}),a.target=rl)))}function ro(s,a){var c={};return c[s.toLowerCase()]=a.toLowerCase(),c["Webkit"+s]="webkit"+a,c["Moz"+s]="moz"+a,c}var sl={animationend:ro("Animation","AnimationEnd"),animationiteration:ro("Animation","AnimationIteration"),animationstart:ro("Animation","AnimationStart"),transitionrun:ro("Transition","TransitionRun"),transitionstart:ro("Transition","TransitionStart"),transitioncancel:ro("Transition","TransitionCancel"),transitionend:ro("Transition","TransitionEnd")},Bm={},__={};Pr&&(__=document.createElement("div").style,"AnimationEvent"in window||(delete sl.animationend.animation,delete sl.animationiteration.animation,delete sl.animationstart.animation),"TransitionEvent"in window||delete sl.transitionend.transition);function so(s){if(Bm[s])return Bm[s];if(!sl[s])return s;var a=sl[s],c;for(c in a)if(a.hasOwnProperty(c)&&c in __)return Bm[s]=a[c];return s}var b_=so("animationend"),v_=so("animationiteration"),x_=so("animationstart"),wA=so("transitionrun"),SA=so("transitionstart"),CA=so("transitioncancel"),w_=so("transitionend"),S_=new Map,zm="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");zm.push("scrollEnd");function is(s,a){S_.set(s,a),Es(a,[s])}var Bd=typeof reportError=="function"?reportError:function(s){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var a=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof s=="object"&&s!==null&&typeof s.message=="string"?String(s.message):String(s),error:s});if(!window.dispatchEvent(a))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",s);return}console.error(s)},zr=[],il=0,Lm=0;function zd(){for(var s=il,a=Lm=il=0;a<s;){var c=zr[a];zr[a++]=null;var m=zr[a];zr[a++]=null;var b=zr[a];zr[a++]=null;var S=zr[a];if(zr[a++]=null,m!==null&&b!==null){var B=m.pending;B===null?b.next=b:(b.next=B.next,B.next=b),m.pending=b}S!==0&&C_(c,b,S)}}function Ld(s,a,c,m){zr[il++]=s,zr[il++]=a,zr[il++]=c,zr[il++]=m,Lm|=m,s.lanes|=m,s=s.alternate,s!==null&&(s.lanes|=m)}function Um(s,a,c,m){return Ld(s,a,c,m),Ud(s)}function io(s,a){return Ld(s,null,null,a),Ud(s)}function C_(s,a,c){s.lanes|=c;var m=s.alternate;m!==null&&(m.lanes|=c);for(var b=!1,S=s.return;S!==null;)S.childLanes|=c,m=S.alternate,m!==null&&(m.childLanes|=c),S.tag===22&&(s=S.stateNode,s===null||s._visibility&1||(b=!0)),s=S,S=S.return;return s.tag===3?(S=s.stateNode,b&&a!==null&&(b=31-Ct(c),s=S.hiddenUpdates,m=s[b],m===null?s[b]=[a]:m.push(a),a.lane=c|536870912),S):null}function Ud(s){if(50<ou)throw ou=0,Kp=null,Error(r(185));for(var a=s.return;a!==null;)s=a,a=s.return;return s.tag===3?s.stateNode:null}var al={};function EA(s,a,c,m){this.tag=s,this.key=c,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=a,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=m,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Sr(s,a,c,m){return new EA(s,a,c,m)}function Fm(s){return s=s.prototype,!(!s||!s.isReactComponent)}function ei(s,a){var c=s.alternate;return c===null?(c=Sr(s.tag,a,s.key,s.mode),c.elementType=s.elementType,c.type=s.type,c.stateNode=s.stateNode,c.alternate=s,s.alternate=c):(c.pendingProps=a,c.type=s.type,c.flags=0,c.subtreeFlags=0,c.deletions=null),c.flags=s.flags&65011712,c.childLanes=s.childLanes,c.lanes=s.lanes,c.child=s.child,c.memoizedProps=s.memoizedProps,c.memoizedState=s.memoizedState,c.updateQueue=s.updateQueue,a=s.dependencies,c.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext},c.sibling=s.sibling,c.index=s.index,c.ref=s.ref,c.refCleanup=s.refCleanup,c}function E_(s,a){s.flags&=65011714;var c=s.alternate;return c===null?(s.childLanes=0,s.lanes=a,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=c.childLanes,s.lanes=c.lanes,s.child=c.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=c.memoizedProps,s.memoizedState=c.memoizedState,s.updateQueue=c.updateQueue,s.type=c.type,a=c.dependencies,s.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext}),s}function Fd(s,a,c,m,b,S){var B=0;if(m=s,typeof s=="function")Fm(s)&&(B=1);else if(typeof s=="string")B=I2(s,c,ne.current)?26:s==="html"||s==="head"||s==="body"?27:5;else e:switch(s){case P:return s=Sr(31,c,a,b),s.elementType=P,s.lanes=S,s;case x:return ao(c.children,b,S,a);case w:B=8,b|=24;break;case E:return s=Sr(12,c,a,b|2),s.elementType=E,s.lanes=S,s;case V:return s=Sr(13,c,a,b),s.elementType=V,s.lanes=S,s;case $:return s=Sr(19,c,a,b),s.elementType=$,s.lanes=S,s;default:if(typeof s=="object"&&s!==null)switch(s.$$typeof){case R:B=10;break e;case T:B=9;break e;case M:B=11;break e;case I:B=14;break e;case D:B=16,m=null;break e}B=29,c=Error(r(130,s===null?"null":typeof s,"")),m=null}return a=Sr(B,c,a,b),a.elementType=s,a.type=m,a.lanes=S,a}function ao(s,a,c,m){return s=Sr(7,s,m,a),s.lanes=c,s}function Vm(s,a,c){return s=Sr(6,s,null,a),s.lanes=c,s}function T_(s){var a=Sr(18,null,null,0);return a.stateNode=s,a}function $m(s,a,c){return a=Sr(4,s.children!==null?s.children:[],s.key,a),a.lanes=c,a.stateNode={containerInfo:s.containerInfo,pendingChildren:null,implementation:s.implementation},a}var A_=new WeakMap;function Lr(s,a){if(typeof s=="object"&&s!==null){var c=A_.get(s);return c!==void 0?c:(a={value:s,source:a,stack:X(a)},A_.set(s,a),a)}return{value:s,source:a,stack:X(a)}}var ol=[],ll=0,Vd=null,Uc=0,Ur=[],Fr=0,Vi=null,Os=1,Ns="";function ti(s,a){ol[ll++]=Uc,ol[ll++]=Vd,Vd=s,Uc=a}function j_(s,a,c){Ur[Fr++]=Os,Ur[Fr++]=Ns,Ur[Fr++]=Vi,Vi=s;var m=Os;s=Ns;var b=32-Ct(m)-1;m&=~(1<<b),c+=1;var S=32-Ct(a)+b;if(30<S){var B=b-b%5;S=(m&(1<<B)-1).toString(32),m>>=B,b-=B,Os=1<<32-Ct(a)+b|c<<b|m,Ns=S+s}else Os=1<<S|c<<b|m,Ns=s}function qm(s){s.return!==null&&(ti(s,1),j_(s,1,0))}function Hm(s){for(;s===Vd;)Vd=ol[--ll],ol[ll]=null,Uc=ol[--ll],ol[ll]=null;for(;s===Vi;)Vi=Ur[--Fr],Ur[Fr]=null,Ns=Ur[--Fr],Ur[Fr]=null,Os=Ur[--Fr],Ur[Fr]=null}function R_(s,a){Ur[Fr++]=Os,Ur[Fr++]=Ns,Ur[Fr++]=Vi,Os=a.id,Ns=a.overflow,Vi=s}var Pn=null,qt=null,_t=!1,$i=null,Vr=!1,Gm=Error(r(519));function qi(s){var a=Error(r(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Fc(Lr(a,s)),Gm}function I_(s){var a=s.stateNode,c=s.type,m=s.memoizedProps;switch(a[hn]=s,a[In]=m,c){case"dialog":dt("cancel",a),dt("close",a);break;case"iframe":case"object":case"embed":dt("load",a);break;case"video":case"audio":for(c=0;c<cu.length;c++)dt(cu[c],a);break;case"source":dt("error",a);break;case"img":case"image":case"link":dt("error",a),dt("load",a);break;case"details":dt("toggle",a);break;case"input":dt("invalid",a),xd(a,m.value,m.defaultValue,m.checked,m.defaultChecked,m.type,m.name,!0);break;case"select":dt("invalid",a);break;case"textarea":dt("invalid",a),Ni(a,m.value,m.defaultValue,m.children)}c=m.children,typeof c!="string"&&typeof c!="number"&&typeof c!="bigint"||a.textContent===""+c||m.suppressHydrationWarning===!0||Wv(a.textContent,c)?(m.popover!=null&&(dt("beforetoggle",a),dt("toggle",a)),m.onScroll!=null&&dt("scroll",a),m.onScrollEnd!=null&&dt("scrollend",a),m.onClick!=null&&(a.onclick=es),a=!0):a=!1,a||qi(s,!0)}function k_(s){for(Pn=s.return;Pn;)switch(Pn.tag){case 5:case 31:case 13:Vr=!1;return;case 27:case 3:Vr=!0;return;default:Pn=Pn.return}}function cl(s){if(s!==Pn)return!1;if(!_t)return k_(s),_t=!0,!1;var a=s.tag,c;if((c=a!==3&&a!==27)&&((c=a===5)&&(c=s.type,c=!(c!=="form"&&c!=="button")||ug(s.type,s.memoizedProps)),c=!c),c&&qt&&qi(s),k_(s),a===13){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(r(317));qt=nx(s)}else if(a===31){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(r(317));qt=nx(s)}else a===27?(a=qt,sa(s.type)?(s=pg,pg=null,qt=s):qt=a):qt=Pn?qr(s.stateNode.nextSibling):null;return!0}function oo(){qt=Pn=null,_t=!1}function Wm(){var s=$i;return s!==null&&(fr===null?fr=s:fr.push.apply(fr,s),$i=null),s}function Fc(s){$i===null?$i=[s]:$i.push(s)}var Qm=z(null),lo=null,ni=null;function Hi(s,a,c){re(Qm,a._currentValue),a._currentValue=c}function ri(s){s._currentValue=Qm.current,H(Qm)}function Km(s,a,c){for(;s!==null;){var m=s.alternate;if((s.childLanes&a)!==a?(s.childLanes|=a,m!==null&&(m.childLanes|=a)):m!==null&&(m.childLanes&a)!==a&&(m.childLanes|=a),s===c)break;s=s.return}}function Ym(s,a,c,m){var b=s.child;for(b!==null&&(b.return=s);b!==null;){var S=b.dependencies;if(S!==null){var B=b.child;S=S.firstContext;e:for(;S!==null;){var W=S;S=b;for(var se=0;se<a.length;se++)if(W.context===a[se]){S.lanes|=c,W=S.alternate,W!==null&&(W.lanes|=c),Km(S.return,c,s),m||(B=null);break e}S=W.next}}else if(b.tag===18){if(B=b.return,B===null)throw Error(r(341));B.lanes|=c,S=B.alternate,S!==null&&(S.lanes|=c),Km(B,c,s),B=null}else B=b.child;if(B!==null)B.return=b;else for(B=b;B!==null;){if(B===s){B=null;break}if(b=B.sibling,b!==null){b.return=B.return,B=b;break}B=B.return}b=B}}function ul(s,a,c,m){s=null;for(var b=a,S=!1;b!==null;){if(!S){if((b.flags&524288)!==0)S=!0;else if((b.flags&262144)!==0)break}if(b.tag===10){var B=b.alternate;if(B===null)throw Error(r(387));if(B=B.memoizedProps,B!==null){var W=b.type;wr(b.pendingProps.value,B.value)||(s!==null?s.push(W):s=[W])}}else if(b===Ce.current){if(B=b.alternate,B===null)throw Error(r(387));B.memoizedState.memoizedState!==b.memoizedState.memoizedState&&(s!==null?s.push(mu):s=[mu])}b=b.return}s!==null&&Ym(a,s,c,m),a.flags|=262144}function $d(s){for(s=s.firstContext;s!==null;){if(!wr(s.context._currentValue,s.memoizedValue))return!0;s=s.next}return!1}function co(s){lo=s,ni=null,s=s.dependencies,s!==null&&(s.firstContext=null)}function Bn(s){return D_(lo,s)}function qd(s,a){return lo===null&&co(s),D_(s,a)}function D_(s,a){var c=a._currentValue;if(a={context:a,memoizedValue:c,next:null},ni===null){if(s===null)throw Error(r(308));ni=a,s.dependencies={lanes:0,firstContext:a},s.flags|=524288}else ni=ni.next=a;return c}var TA=typeof AbortController<"u"?AbortController:function(){var s=[],a=this.signal={aborted:!1,addEventListener:function(c,m){s.push(m)}};this.abort=function(){a.aborted=!0,s.forEach(function(c){return c()})}},AA=t.unstable_scheduleCallback,jA=t.unstable_NormalPriority,pn={$$typeof:R,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Xm(){return{controller:new TA,data:new Map,refCount:0}}function Vc(s){s.refCount--,s.refCount===0&&AA(jA,function(){s.controller.abort()})}var $c=null,Zm=0,dl=0,hl=null;function RA(s,a){if($c===null){var c=$c=[];Zm=0,dl=tg(),hl={status:"pending",value:void 0,then:function(m){c.push(m)}}}return Zm++,a.then(M_,M_),a}function M_(){if(--Zm===0&&$c!==null){hl!==null&&(hl.status="fulfilled");var s=$c;$c=null,dl=0,hl=null;for(var a=0;a<s.length;a++)(0,s[a])()}}function IA(s,a){var c=[],m={status:"pending",value:null,reason:null,then:function(b){c.push(b)}};return s.then(function(){m.status="fulfilled",m.value=a;for(var b=0;b<c.length;b++)(0,c[b])(a)},function(b){for(m.status="rejected",m.reason=b,b=0;b<c.length;b++)(0,c[b])(void 0)}),m}var O_=Y.S;Y.S=function(s,a){yv=Ne(),typeof a=="object"&&a!==null&&typeof a.then=="function"&&RA(s,a),O_!==null&&O_(s,a)};var uo=z(null);function Jm(){var s=uo.current;return s!==null?s:zt.pooledCache}function Hd(s,a){a===null?re(uo,uo.current):re(uo,a.pool)}function N_(){var s=Jm();return s===null?null:{parent:pn._currentValue,pool:s}}var fl=Error(r(460)),ep=Error(r(474)),Gd=Error(r(542)),Wd={then:function(){}};function P_(s){return s=s.status,s==="fulfilled"||s==="rejected"}function B_(s,a,c){switch(c=s[c],c===void 0?s.push(a):c!==a&&(a.then(es,es),a=c),a.status){case"fulfilled":return a.value;case"rejected":throw s=a.reason,L_(s),s;default:if(typeof a.status=="string")a.then(es,es);else{if(s=zt,s!==null&&100<s.shellSuspendCounter)throw Error(r(482));s=a,s.status="pending",s.then(function(m){if(a.status==="pending"){var b=a;b.status="fulfilled",b.value=m}},function(m){if(a.status==="pending"){var b=a;b.status="rejected",b.reason=m}})}switch(a.status){case"fulfilled":return a.value;case"rejected":throw s=a.reason,L_(s),s}throw fo=a,fl}}function ho(s){try{var a=s._init;return a(s._payload)}catch(c){throw c!==null&&typeof c=="object"&&typeof c.then=="function"?(fo=c,fl):c}}var fo=null;function z_(){if(fo===null)throw Error(r(459));var s=fo;return fo=null,s}function L_(s){if(s===fl||s===Gd)throw Error(r(483))}var ml=null,qc=0;function Qd(s){var a=qc;return qc+=1,ml===null&&(ml=[]),B_(ml,s,a)}function Hc(s,a){a=a.props.ref,s.ref=a!==void 0?a:null}function Kd(s,a){throw a.$$typeof===v?Error(r(525)):(s=Object.prototype.toString.call(a),Error(r(31,s==="[object Object]"?"object with keys {"+Object.keys(a).join(", ")+"}":s)))}function U_(s){function a(ue,le){if(s){var me=ue.deletions;me===null?(ue.deletions=[le],ue.flags|=16):me.push(le)}}function c(ue,le){if(!s)return null;for(;le!==null;)a(ue,le),le=le.sibling;return null}function m(ue){for(var le=new Map;ue!==null;)ue.key!==null?le.set(ue.key,ue):le.set(ue.index,ue),ue=ue.sibling;return le}function b(ue,le){return ue=ei(ue,le),ue.index=0,ue.sibling=null,ue}function S(ue,le,me){return ue.index=me,s?(me=ue.alternate,me!==null?(me=me.index,me<le?(ue.flags|=67108866,le):me):(ue.flags|=67108866,le)):(ue.flags|=1048576,le)}function B(ue){return s&&ue.alternate===null&&(ue.flags|=67108866),ue}function W(ue,le,me,Ae){return le===null||le.tag!==6?(le=Vm(me,ue.mode,Ae),le.return=ue,le):(le=b(le,me),le.return=ue,le)}function se(ue,le,me,Ae){var He=me.type;return He===x?Ee(ue,le,me.props.children,Ae,me.key):le!==null&&(le.elementType===He||typeof He=="object"&&He!==null&&He.$$typeof===D&&ho(He)===le.type)?(le=b(le,me.props),Hc(le,me),le.return=ue,le):(le=Fd(me.type,me.key,me.props,null,ue.mode,Ae),Hc(le,me),le.return=ue,le)}function pe(ue,le,me,Ae){return le===null||le.tag!==4||le.stateNode.containerInfo!==me.containerInfo||le.stateNode.implementation!==me.implementation?(le=$m(me,ue.mode,Ae),le.return=ue,le):(le=b(le,me.children||[]),le.return=ue,le)}function Ee(ue,le,me,Ae,He){return le===null||le.tag!==7?(le=ao(me,ue.mode,Ae,He),le.return=ue,le):(le=b(le,me),le.return=ue,le)}function Ie(ue,le,me){if(typeof le=="string"&&le!==""||typeof le=="number"||typeof le=="bigint")return le=Vm(""+le,ue.mode,me),le.return=ue,le;if(typeof le=="object"&&le!==null){switch(le.$$typeof){case _:return me=Fd(le.type,le.key,le.props,null,ue.mode,me),Hc(me,le),me.return=ue,me;case C:return le=$m(le,ue.mode,me),le.return=ue,le;case D:return le=ho(le),Ie(ue,le,me)}if(J(le)||A(le))return le=ao(le,ue.mode,me,null),le.return=ue,le;if(typeof le.then=="function")return Ie(ue,Qd(le),me);if(le.$$typeof===R)return Ie(ue,qd(ue,le),me);Kd(ue,le)}return null}function _e(ue,le,me,Ae){var He=le!==null?le.key:null;if(typeof me=="string"&&me!==""||typeof me=="number"||typeof me=="bigint")return He!==null?null:W(ue,le,""+me,Ae);if(typeof me=="object"&&me!==null){switch(me.$$typeof){case _:return me.key===He?se(ue,le,me,Ae):null;case C:return me.key===He?pe(ue,le,me,Ae):null;case D:return me=ho(me),_e(ue,le,me,Ae)}if(J(me)||A(me))return He!==null?null:Ee(ue,le,me,Ae,null);if(typeof me.then=="function")return _e(ue,le,Qd(me),Ae);if(me.$$typeof===R)return _e(ue,le,qd(ue,me),Ae);Kd(ue,me)}return null}function xe(ue,le,me,Ae,He){if(typeof Ae=="string"&&Ae!==""||typeof Ae=="number"||typeof Ae=="bigint")return ue=ue.get(me)||null,W(le,ue,""+Ae,He);if(typeof Ae=="object"&&Ae!==null){switch(Ae.$$typeof){case _:return ue=ue.get(Ae.key===null?me:Ae.key)||null,se(le,ue,Ae,He);case C:return ue=ue.get(Ae.key===null?me:Ae.key)||null,pe(le,ue,Ae,He);case D:return Ae=ho(Ae),xe(ue,le,me,Ae,He)}if(J(Ae)||A(Ae))return ue=ue.get(me)||null,Ee(le,ue,Ae,He,null);if(typeof Ae.then=="function")return xe(ue,le,me,Qd(Ae),He);if(Ae.$$typeof===R)return xe(ue,le,me,qd(le,Ae),He);Kd(le,Ae)}return null}function Fe(ue,le,me,Ae){for(var He=null,wt=null,$e=le,lt=le=0,mt=null;$e!==null&&lt<me.length;lt++){$e.index>lt?(mt=$e,$e=null):mt=$e.sibling;var St=_e(ue,$e,me[lt],Ae);if(St===null){$e===null&&($e=mt);break}s&&$e&&St.alternate===null&&a(ue,$e),le=S(St,le,lt),wt===null?He=St:wt.sibling=St,wt=St,$e=mt}if(lt===me.length)return c(ue,$e),_t&&ti(ue,lt),He;if($e===null){for(;lt<me.length;lt++)$e=Ie(ue,me[lt],Ae),$e!==null&&(le=S($e,le,lt),wt===null?He=$e:wt.sibling=$e,wt=$e);return _t&&ti(ue,lt),He}for($e=m($e);lt<me.length;lt++)mt=xe($e,ue,lt,me[lt],Ae),mt!==null&&(s&&mt.alternate!==null&&$e.delete(mt.key===null?lt:mt.key),le=S(mt,le,lt),wt===null?He=mt:wt.sibling=mt,wt=mt);return s&&$e.forEach(function(ca){return a(ue,ca)}),_t&&ti(ue,lt),He}function Qe(ue,le,me,Ae){if(me==null)throw Error(r(151));for(var He=null,wt=null,$e=le,lt=le=0,mt=null,St=me.next();$e!==null&&!St.done;lt++,St=me.next()){$e.index>lt?(mt=$e,$e=null):mt=$e.sibling;var ca=_e(ue,$e,St.value,Ae);if(ca===null){$e===null&&($e=mt);break}s&&$e&&ca.alternate===null&&a(ue,$e),le=S(ca,le,lt),wt===null?He=ca:wt.sibling=ca,wt=ca,$e=mt}if(St.done)return c(ue,$e),_t&&ti(ue,lt),He;if($e===null){for(;!St.done;lt++,St=me.next())St=Ie(ue,St.value,Ae),St!==null&&(le=S(St,le,lt),wt===null?He=St:wt.sibling=St,wt=St);return _t&&ti(ue,lt),He}for($e=m($e);!St.done;lt++,St=me.next())St=xe($e,ue,lt,St.value,Ae),St!==null&&(s&&St.alternate!==null&&$e.delete(St.key===null?lt:St.key),le=S(St,le,lt),wt===null?He=St:wt.sibling=St,wt=St);return s&&$e.forEach(function(F2){return a(ue,F2)}),_t&&ti(ue,lt),He}function Ot(ue,le,me,Ae){if(typeof me=="object"&&me!==null&&me.type===x&&me.key===null&&(me=me.props.children),typeof me=="object"&&me!==null){switch(me.$$typeof){case _:e:{for(var He=me.key;le!==null;){if(le.key===He){if(He=me.type,He===x){if(le.tag===7){c(ue,le.sibling),Ae=b(le,me.props.children),Ae.return=ue,ue=Ae;break e}}else if(le.elementType===He||typeof He=="object"&&He!==null&&He.$$typeof===D&&ho(He)===le.type){c(ue,le.sibling),Ae=b(le,me.props),Hc(Ae,me),Ae.return=ue,ue=Ae;break e}c(ue,le);break}else a(ue,le);le=le.sibling}me.type===x?(Ae=ao(me.props.children,ue.mode,Ae,me.key),Ae.return=ue,ue=Ae):(Ae=Fd(me.type,me.key,me.props,null,ue.mode,Ae),Hc(Ae,me),Ae.return=ue,ue=Ae)}return B(ue);case C:e:{for(He=me.key;le!==null;){if(le.key===He)if(le.tag===4&&le.stateNode.containerInfo===me.containerInfo&&le.stateNode.implementation===me.implementation){c(ue,le.sibling),Ae=b(le,me.children||[]),Ae.return=ue,ue=Ae;break e}else{c(ue,le);break}else a(ue,le);le=le.sibling}Ae=$m(me,ue.mode,Ae),Ae.return=ue,ue=Ae}return B(ue);case D:return me=ho(me),Ot(ue,le,me,Ae)}if(J(me))return Fe(ue,le,me,Ae);if(A(me)){if(He=A(me),typeof He!="function")throw Error(r(150));return me=He.call(me),Qe(ue,le,me,Ae)}if(typeof me.then=="function")return Ot(ue,le,Qd(me),Ae);if(me.$$typeof===R)return Ot(ue,le,qd(ue,me),Ae);Kd(ue,me)}return typeof me=="string"&&me!==""||typeof me=="number"||typeof me=="bigint"?(me=""+me,le!==null&&le.tag===6?(c(ue,le.sibling),Ae=b(le,me),Ae.return=ue,ue=Ae):(c(ue,le),Ae=Vm(me,ue.mode,Ae),Ae.return=ue,ue=Ae),B(ue)):c(ue,le)}return function(ue,le,me,Ae){try{qc=0;var He=Ot(ue,le,me,Ae);return ml=null,He}catch($e){if($e===fl||$e===Gd)throw $e;var wt=Sr(29,$e,null,ue.mode);return wt.lanes=Ae,wt.return=ue,wt}}}var mo=U_(!0),F_=U_(!1),Gi=!1;function tp(s){s.updateQueue={baseState:s.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function np(s,a){s=s.updateQueue,a.updateQueue===s&&(a.updateQueue={baseState:s.baseState,firstBaseUpdate:s.firstBaseUpdate,lastBaseUpdate:s.lastBaseUpdate,shared:s.shared,callbacks:null})}function Wi(s){return{lane:s,tag:0,payload:null,callback:null,next:null}}function Qi(s,a,c){var m=s.updateQueue;if(m===null)return null;if(m=m.shared,(Tt&2)!==0){var b=m.pending;return b===null?a.next=a:(a.next=b.next,b.next=a),m.pending=a,a=Ud(s),C_(s,null,c),a}return Ld(s,m,a,c),Ud(s)}function Gc(s,a,c){if(a=a.updateQueue,a!==null&&(a=a.shared,(c&4194048)!==0)){var m=a.lanes;m&=s.pendingLanes,c|=m,a.lanes=c,bc(s,c)}}function rp(s,a){var c=s.updateQueue,m=s.alternate;if(m!==null&&(m=m.updateQueue,c===m)){var b=null,S=null;if(c=c.firstBaseUpdate,c!==null){do{var B={lane:c.lane,tag:c.tag,payload:c.payload,callback:null,next:null};S===null?b=S=B:S=S.next=B,c=c.next}while(c!==null);S===null?b=S=a:S=S.next=a}else b=S=a;c={baseState:m.baseState,firstBaseUpdate:b,lastBaseUpdate:S,shared:m.shared,callbacks:m.callbacks},s.updateQueue=c;return}s=c.lastBaseUpdate,s===null?c.firstBaseUpdate=a:s.next=a,c.lastBaseUpdate=a}var sp=!1;function Wc(){if(sp){var s=hl;if(s!==null)throw s}}function Qc(s,a,c,m){sp=!1;var b=s.updateQueue;Gi=!1;var S=b.firstBaseUpdate,B=b.lastBaseUpdate,W=b.shared.pending;if(W!==null){b.shared.pending=null;var se=W,pe=se.next;se.next=null,B===null?S=pe:B.next=pe,B=se;var Ee=s.alternate;Ee!==null&&(Ee=Ee.updateQueue,W=Ee.lastBaseUpdate,W!==B&&(W===null?Ee.firstBaseUpdate=pe:W.next=pe,Ee.lastBaseUpdate=se))}if(S!==null){var Ie=b.baseState;B=0,Ee=pe=se=null,W=S;do{var _e=W.lane&-536870913,xe=_e!==W.lane;if(xe?(ft&_e)===_e:(m&_e)===_e){_e!==0&&_e===dl&&(sp=!0),Ee!==null&&(Ee=Ee.next={lane:0,tag:W.tag,payload:W.payload,callback:null,next:null});e:{var Fe=s,Qe=W;_e=a;var Ot=c;switch(Qe.tag){case 1:if(Fe=Qe.payload,typeof Fe=="function"){Ie=Fe.call(Ot,Ie,_e);break e}Ie=Fe;break e;case 3:Fe.flags=Fe.flags&-65537|128;case 0:if(Fe=Qe.payload,_e=typeof Fe=="function"?Fe.call(Ot,Ie,_e):Fe,_e==null)break e;Ie=g({},Ie,_e);break e;case 2:Gi=!0}}_e=W.callback,_e!==null&&(s.flags|=64,xe&&(s.flags|=8192),xe=b.callbacks,xe===null?b.callbacks=[_e]:xe.push(_e))}else xe={lane:_e,tag:W.tag,payload:W.payload,callback:W.callback,next:null},Ee===null?(pe=Ee=xe,se=Ie):Ee=Ee.next=xe,B|=_e;if(W=W.next,W===null){if(W=b.shared.pending,W===null)break;xe=W,W=xe.next,xe.next=null,b.lastBaseUpdate=xe,b.shared.pending=null}}while(!0);Ee===null&&(se=Ie),b.baseState=se,b.firstBaseUpdate=pe,b.lastBaseUpdate=Ee,S===null&&(b.shared.lanes=0),Ji|=B,s.lanes=B,s.memoizedState=Ie}}function V_(s,a){if(typeof s!="function")throw Error(r(191,s));s.call(a)}function $_(s,a){var c=s.callbacks;if(c!==null)for(s.callbacks=null,s=0;s<c.length;s++)V_(c[s],a)}var pl=z(null),Yd=z(0);function q_(s,a){s=hi,re(Yd,s),re(pl,a),hi=s|a.baseLanes}function ip(){re(Yd,hi),re(pl,pl.current)}function ap(){hi=Yd.current,H(pl),H(Yd)}var Cr=z(null),$r=null;function Ki(s){var a=s.alternate;re(an,an.current&1),re(Cr,s),$r===null&&(a===null||pl.current!==null||a.memoizedState!==null)&&($r=s)}function op(s){re(an,an.current),re(Cr,s),$r===null&&($r=s)}function H_(s){s.tag===22?(re(an,an.current),re(Cr,s),$r===null&&($r=s)):Yi()}function Yi(){re(an,an.current),re(Cr,Cr.current)}function Er(s){H(Cr),$r===s&&($r=null),H(an)}var an=z(0);function Xd(s){for(var a=s;a!==null;){if(a.tag===13){var c=a.memoizedState;if(c!==null&&(c=c.dehydrated,c===null||fg(c)||mg(c)))return a}else if(a.tag===19&&(a.memoizedProps.revealOrder==="forwards"||a.memoizedProps.revealOrder==="backwards"||a.memoizedProps.revealOrder==="unstable_legacy-backwards"||a.memoizedProps.revealOrder==="together")){if((a.flags&128)!==0)return a}else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===s)break;for(;a.sibling===null;){if(a.return===null||a.return===s)return null;a=a.return}a.sibling.return=a.return,a=a.sibling}return null}var si=0,at=null,Dt=null,gn=null,Zd=!1,gl=!1,po=!1,Jd=0,Kc=0,yl=null,kA=0;function nn(){throw Error(r(321))}function lp(s,a){if(a===null)return!1;for(var c=0;c<a.length&&c<s.length;c++)if(!wr(s[c],a[c]))return!1;return!0}function cp(s,a,c,m,b,S){return si=S,at=a,a.memoizedState=null,a.updateQueue=null,a.lanes=0,Y.H=s===null||s.memoizedState===null?jb:Cp,po=!1,S=c(m,b),po=!1,gl&&(S=W_(a,c,m,b)),G_(s),S}function G_(s){Y.H=Zc;var a=Dt!==null&&Dt.next!==null;if(si=0,gn=Dt=at=null,Zd=!1,Kc=0,yl=null,a)throw Error(r(300));s===null||yn||(s=s.dependencies,s!==null&&$d(s)&&(yn=!0))}function W_(s,a,c,m){at=s;var b=0;do{if(gl&&(yl=null),Kc=0,gl=!1,25<=b)throw Error(r(301));if(b+=1,gn=Dt=null,s.updateQueue!=null){var S=s.updateQueue;S.lastEffect=null,S.events=null,S.stores=null,S.memoCache!=null&&(S.memoCache.index=0)}Y.H=Rb,S=a(c,m)}while(gl);return S}function DA(){var s=Y.H,a=s.useState()[0];return a=typeof a.then=="function"?Yc(a):a,s=s.useState()[0],(Dt!==null?Dt.memoizedState:null)!==s&&(at.flags|=1024),a}function up(){var s=Jd!==0;return Jd=0,s}function dp(s,a,c){a.updateQueue=s.updateQueue,a.flags&=-2053,s.lanes&=~c}function hp(s){if(Zd){for(s=s.memoizedState;s!==null;){var a=s.queue;a!==null&&(a.pending=null),s=s.next}Zd=!1}si=0,gn=Dt=at=null,gl=!1,Kc=Jd=0,yl=null}function ir(){var s={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return gn===null?at.memoizedState=gn=s:gn=gn.next=s,gn}function on(){if(Dt===null){var s=at.alternate;s=s!==null?s.memoizedState:null}else s=Dt.next;var a=gn===null?at.memoizedState:gn.next;if(a!==null)gn=a,Dt=s;else{if(s===null)throw at.alternate===null?Error(r(467)):Error(r(310));Dt=s,s={memoizedState:Dt.memoizedState,baseState:Dt.baseState,baseQueue:Dt.baseQueue,queue:Dt.queue,next:null},gn===null?at.memoizedState=gn=s:gn=gn.next=s}return gn}function eh(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Yc(s){var a=Kc;return Kc+=1,yl===null&&(yl=[]),s=B_(yl,s,a),a=at,(gn===null?a.memoizedState:gn.next)===null&&(a=a.alternate,Y.H=a===null||a.memoizedState===null?jb:Cp),s}function th(s){if(s!==null&&typeof s=="object"){if(typeof s.then=="function")return Yc(s);if(s.$$typeof===R)return Bn(s)}throw Error(r(438,String(s)))}function fp(s){var a=null,c=at.updateQueue;if(c!==null&&(a=c.memoCache),a==null){var m=at.alternate;m!==null&&(m=m.updateQueue,m!==null&&(m=m.memoCache,m!=null&&(a={data:m.data.map(function(b){return b.slice()}),index:0})))}if(a==null&&(a={data:[],index:0}),c===null&&(c=eh(),at.updateQueue=c),c.memoCache=a,c=a.data[a.index],c===void 0)for(c=a.data[a.index]=Array(s),m=0;m<s;m++)c[m]=L;return a.index++,c}function ii(s,a){return typeof a=="function"?a(s):a}function nh(s){var a=on();return mp(a,Dt,s)}function mp(s,a,c){var m=s.queue;if(m===null)throw Error(r(311));m.lastRenderedReducer=c;var b=s.baseQueue,S=m.pending;if(S!==null){if(b!==null){var B=b.next;b.next=S.next,S.next=B}a.baseQueue=b=S,m.pending=null}if(S=s.baseState,b===null)s.memoizedState=S;else{a=b.next;var W=B=null,se=null,pe=a,Ee=!1;do{var Ie=pe.lane&-536870913;if(Ie!==pe.lane?(ft&Ie)===Ie:(si&Ie)===Ie){var _e=pe.revertLane;if(_e===0)se!==null&&(se=se.next={lane:0,revertLane:0,gesture:null,action:pe.action,hasEagerState:pe.hasEagerState,eagerState:pe.eagerState,next:null}),Ie===dl&&(Ee=!0);else if((si&_e)===_e){pe=pe.next,_e===dl&&(Ee=!0);continue}else Ie={lane:0,revertLane:pe.revertLane,gesture:null,action:pe.action,hasEagerState:pe.hasEagerState,eagerState:pe.eagerState,next:null},se===null?(W=se=Ie,B=S):se=se.next=Ie,at.lanes|=_e,Ji|=_e;Ie=pe.action,po&&c(S,Ie),S=pe.hasEagerState?pe.eagerState:c(S,Ie)}else _e={lane:Ie,revertLane:pe.revertLane,gesture:pe.gesture,action:pe.action,hasEagerState:pe.hasEagerState,eagerState:pe.eagerState,next:null},se===null?(W=se=_e,B=S):se=se.next=_e,at.lanes|=Ie,Ji|=Ie;pe=pe.next}while(pe!==null&&pe!==a);if(se===null?B=S:se.next=W,!wr(S,s.memoizedState)&&(yn=!0,Ee&&(c=hl,c!==null)))throw c;s.memoizedState=S,s.baseState=B,s.baseQueue=se,m.lastRenderedState=S}return b===null&&(m.lanes=0),[s.memoizedState,m.dispatch]}function pp(s){var a=on(),c=a.queue;if(c===null)throw Error(r(311));c.lastRenderedReducer=s;var m=c.dispatch,b=c.pending,S=a.memoizedState;if(b!==null){c.pending=null;var B=b=b.next;do S=s(S,B.action),B=B.next;while(B!==b);wr(S,a.memoizedState)||(yn=!0),a.memoizedState=S,a.baseQueue===null&&(a.baseState=S),c.lastRenderedState=S}return[S,m]}function Q_(s,a,c){var m=at,b=on(),S=_t;if(S){if(c===void 0)throw Error(r(407));c=c()}else c=a();var B=!wr((Dt||b).memoizedState,c);if(B&&(b.memoizedState=c,yn=!0),b=b.queue,_p(X_.bind(null,m,b,s),[s]),b.getSnapshot!==a||B||gn!==null&&gn.memoizedState.tag&1){if(m.flags|=2048,_l(9,{destroy:void 0},Y_.bind(null,m,b,c,a),null),zt===null)throw Error(r(349));S||(si&127)!==0||K_(m,a,c)}return c}function K_(s,a,c){s.flags|=16384,s={getSnapshot:a,value:c},a=at.updateQueue,a===null?(a=eh(),at.updateQueue=a,a.stores=[s]):(c=a.stores,c===null?a.stores=[s]:c.push(s))}function Y_(s,a,c,m){a.value=c,a.getSnapshot=m,Z_(a)&&J_(s)}function X_(s,a,c){return c(function(){Z_(a)&&J_(s)})}function Z_(s){var a=s.getSnapshot;s=s.value;try{var c=a();return!wr(s,c)}catch{return!0}}function J_(s){var a=io(s,2);a!==null&&mr(a,s,2)}function gp(s){var a=ir();if(typeof s=="function"){var c=s;if(s=c(),po){Kn(!0);try{c()}finally{Kn(!1)}}}return a.memoizedState=a.baseState=s,a.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ii,lastRenderedState:s},a}function eb(s,a,c,m){return s.baseState=c,mp(s,Dt,typeof m=="function"?m:ii)}function MA(s,a,c,m,b){if(ih(s))throw Error(r(485));if(s=a.action,s!==null){var S={payload:b,action:s,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(B){S.listeners.push(B)}};Y.T!==null?c(!0):S.isTransition=!1,m(S),c=a.pending,c===null?(S.next=a.pending=S,tb(a,S)):(S.next=c.next,a.pending=c.next=S)}}function tb(s,a){var c=a.action,m=a.payload,b=s.state;if(a.isTransition){var S=Y.T,B={};Y.T=B;try{var W=c(b,m),se=Y.S;se!==null&&se(B,W),nb(s,a,W)}catch(pe){yp(s,a,pe)}finally{S!==null&&B.types!==null&&(S.types=B.types),Y.T=S}}else try{S=c(b,m),nb(s,a,S)}catch(pe){yp(s,a,pe)}}function nb(s,a,c){c!==null&&typeof c=="object"&&typeof c.then=="function"?c.then(function(m){rb(s,a,m)},function(m){return yp(s,a,m)}):rb(s,a,c)}function rb(s,a,c){a.status="fulfilled",a.value=c,sb(a),s.state=c,a=s.pending,a!==null&&(c=a.next,c===a?s.pending=null:(c=c.next,a.next=c,tb(s,c)))}function yp(s,a,c){var m=s.pending;if(s.pending=null,m!==null){m=m.next;do a.status="rejected",a.reason=c,sb(a),a=a.next;while(a!==m)}s.action=null}function sb(s){s=s.listeners;for(var a=0;a<s.length;a++)(0,s[a])()}function ib(s,a){return a}function ab(s,a){if(_t){var c=zt.formState;if(c!==null){e:{var m=at;if(_t){if(qt){t:{for(var b=qt,S=Vr;b.nodeType!==8;){if(!S){b=null;break t}if(b=qr(b.nextSibling),b===null){b=null;break t}}S=b.data,b=S==="F!"||S==="F"?b:null}if(b){qt=qr(b.nextSibling),m=b.data==="F!";break e}}qi(m)}m=!1}m&&(a=c[0])}}return c=ir(),c.memoizedState=c.baseState=a,m={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ib,lastRenderedState:a},c.queue=m,c=Eb.bind(null,at,m),m.dispatch=c,m=gp(!1),S=Sp.bind(null,at,!1,m.queue),m=ir(),b={state:a,dispatch:null,action:s,pending:null},m.queue=b,c=MA.bind(null,at,b,S,c),b.dispatch=c,m.memoizedState=s,[a,c,!1]}function ob(s){var a=on();return lb(a,Dt,s)}function lb(s,a,c){if(a=mp(s,a,ib)[0],s=nh(ii)[0],typeof a=="object"&&a!==null&&typeof a.then=="function")try{var m=Yc(a)}catch(B){throw B===fl?Gd:B}else m=a;a=on();var b=a.queue,S=b.dispatch;return c!==a.memoizedState&&(at.flags|=2048,_l(9,{destroy:void 0},OA.bind(null,b,c),null)),[m,S,s]}function OA(s,a){s.action=a}function cb(s){var a=on(),c=Dt;if(c!==null)return lb(a,c,s);on(),a=a.memoizedState,c=on();var m=c.queue.dispatch;return c.memoizedState=s,[a,m,!1]}function _l(s,a,c,m){return s={tag:s,create:c,deps:m,inst:a,next:null},a=at.updateQueue,a===null&&(a=eh(),at.updateQueue=a),c=a.lastEffect,c===null?a.lastEffect=s.next=s:(m=c.next,c.next=s,s.next=m,a.lastEffect=s),s}function ub(){return on().memoizedState}function rh(s,a,c,m){var b=ir();at.flags|=s,b.memoizedState=_l(1|a,{destroy:void 0},c,m===void 0?null:m)}function sh(s,a,c,m){var b=on();m=m===void 0?null:m;var S=b.memoizedState.inst;Dt!==null&&m!==null&&lp(m,Dt.memoizedState.deps)?b.memoizedState=_l(a,S,c,m):(at.flags|=s,b.memoizedState=_l(1|a,S,c,m))}function db(s,a){rh(8390656,8,s,a)}function _p(s,a){sh(2048,8,s,a)}function NA(s){at.flags|=4;var a=at.updateQueue;if(a===null)a=eh(),at.updateQueue=a,a.events=[s];else{var c=a.events;c===null?a.events=[s]:c.push(s)}}function hb(s){var a=on().memoizedState;return NA({ref:a,nextImpl:s}),function(){if((Tt&2)!==0)throw Error(r(440));return a.impl.apply(void 0,arguments)}}function fb(s,a){return sh(4,2,s,a)}function mb(s,a){return sh(4,4,s,a)}function pb(s,a){if(typeof a=="function"){s=s();var c=a(s);return function(){typeof c=="function"?c():a(null)}}if(a!=null)return s=s(),a.current=s,function(){a.current=null}}function gb(s,a,c){c=c!=null?c.concat([s]):null,sh(4,4,pb.bind(null,a,s),c)}function bp(){}function yb(s,a){var c=on();a=a===void 0?null:a;var m=c.memoizedState;return a!==null&&lp(a,m[1])?m[0]:(c.memoizedState=[s,a],s)}function _b(s,a){var c=on();a=a===void 0?null:a;var m=c.memoizedState;if(a!==null&&lp(a,m[1]))return m[0];if(m=s(),po){Kn(!0);try{s()}finally{Kn(!1)}}return c.memoizedState=[m,a],m}function vp(s,a,c){return c===void 0||(si&1073741824)!==0&&(ft&261930)===0?s.memoizedState=a:(s.memoizedState=c,s=bv(),at.lanes|=s,Ji|=s,c)}function bb(s,a,c,m){return wr(c,a)?c:pl.current!==null?(s=vp(s,c,m),wr(s,a)||(yn=!0),s):(si&42)===0||(si&1073741824)!==0&&(ft&261930)===0?(yn=!0,s.memoizedState=c):(s=bv(),at.lanes|=s,Ji|=s,a)}function vb(s,a,c,m,b){var S=G.p;G.p=S!==0&&8>S?S:8;var B=Y.T,W={};Y.T=W,Sp(s,!1,a,c);try{var se=b(),pe=Y.S;if(pe!==null&&pe(W,se),se!==null&&typeof se=="object"&&typeof se.then=="function"){var Ee=IA(se,m);Xc(s,a,Ee,jr(s))}else Xc(s,a,m,jr(s))}catch(Ie){Xc(s,a,{then:function(){},status:"rejected",reason:Ie},jr())}finally{G.p=S,B!==null&&W.types!==null&&(B.types=W.types),Y.T=B}}function PA(){}function xp(s,a,c,m){if(s.tag!==5)throw Error(r(476));var b=xb(s).queue;vb(s,b,a,Z,c===null?PA:function(){return wb(s),c(m)})}function xb(s){var a=s.memoizedState;if(a!==null)return a;a={memoizedState:Z,baseState:Z,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ii,lastRenderedState:Z},next:null};var c={};return a.next={memoizedState:c,baseState:c,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ii,lastRenderedState:c},next:null},s.memoizedState=a,s=s.alternate,s!==null&&(s.memoizedState=a),a}function wb(s){var a=xb(s);a.next===null&&(a=s.alternate.memoizedState),Xc(s,a.next.queue,{},jr())}function wp(){return Bn(mu)}function Sb(){return on().memoizedState}function Cb(){return on().memoizedState}function BA(s){for(var a=s.return;a!==null;){switch(a.tag){case 24:case 3:var c=jr();s=Wi(c);var m=Qi(a,s,c);m!==null&&(mr(m,a,c),Gc(m,a,c)),a={cache:Xm()},s.payload=a;return}a=a.return}}function zA(s,a,c){var m=jr();c={lane:m,revertLane:0,gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null},ih(s)?Tb(a,c):(c=Um(s,a,c,m),c!==null&&(mr(c,s,m),Ab(c,a,m)))}function Eb(s,a,c){var m=jr();Xc(s,a,c,m)}function Xc(s,a,c,m){var b={lane:m,revertLane:0,gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null};if(ih(s))Tb(a,b);else{var S=s.alternate;if(s.lanes===0&&(S===null||S.lanes===0)&&(S=a.lastRenderedReducer,S!==null))try{var B=a.lastRenderedState,W=S(B,c);if(b.hasEagerState=!0,b.eagerState=W,wr(W,B))return Ld(s,a,b,0),zt===null&&zd(),!1}catch{}if(c=Um(s,a,b,m),c!==null)return mr(c,s,m),Ab(c,a,m),!0}return!1}function Sp(s,a,c,m){if(m={lane:2,revertLane:tg(),gesture:null,action:m,hasEagerState:!1,eagerState:null,next:null},ih(s)){if(a)throw Error(r(479))}else a=Um(s,c,m,2),a!==null&&mr(a,s,2)}function ih(s){var a=s.alternate;return s===at||a!==null&&a===at}function Tb(s,a){gl=Zd=!0;var c=s.pending;c===null?a.next=a:(a.next=c.next,c.next=a),s.pending=a}function Ab(s,a,c){if((c&4194048)!==0){var m=a.lanes;m&=s.pendingLanes,c|=m,a.lanes=c,bc(s,c)}}var Zc={readContext:Bn,use:th,useCallback:nn,useContext:nn,useEffect:nn,useImperativeHandle:nn,useLayoutEffect:nn,useInsertionEffect:nn,useMemo:nn,useReducer:nn,useRef:nn,useState:nn,useDebugValue:nn,useDeferredValue:nn,useTransition:nn,useSyncExternalStore:nn,useId:nn,useHostTransitionStatus:nn,useFormState:nn,useActionState:nn,useOptimistic:nn,useMemoCache:nn,useCacheRefresh:nn};Zc.useEffectEvent=nn;var jb={readContext:Bn,use:th,useCallback:function(s,a){return ir().memoizedState=[s,a===void 0?null:a],s},useContext:Bn,useEffect:db,useImperativeHandle:function(s,a,c){c=c!=null?c.concat([s]):null,rh(4194308,4,pb.bind(null,a,s),c)},useLayoutEffect:function(s,a){return rh(4194308,4,s,a)},useInsertionEffect:function(s,a){rh(4,2,s,a)},useMemo:function(s,a){var c=ir();a=a===void 0?null:a;var m=s();if(po){Kn(!0);try{s()}finally{Kn(!1)}}return c.memoizedState=[m,a],m},useReducer:function(s,a,c){var m=ir();if(c!==void 0){var b=c(a);if(po){Kn(!0);try{c(a)}finally{Kn(!1)}}}else b=a;return m.memoizedState=m.baseState=b,s={pending:null,lanes:0,dispatch:null,lastRenderedReducer:s,lastRenderedState:b},m.queue=s,s=s.dispatch=zA.bind(null,at,s),[m.memoizedState,s]},useRef:function(s){var a=ir();return s={current:s},a.memoizedState=s},useState:function(s){s=gp(s);var a=s.queue,c=Eb.bind(null,at,a);return a.dispatch=c,[s.memoizedState,c]},useDebugValue:bp,useDeferredValue:function(s,a){var c=ir();return vp(c,s,a)},useTransition:function(){var s=gp(!1);return s=vb.bind(null,at,s.queue,!0,!1),ir().memoizedState=s,[!1,s]},useSyncExternalStore:function(s,a,c){var m=at,b=ir();if(_t){if(c===void 0)throw Error(r(407));c=c()}else{if(c=a(),zt===null)throw Error(r(349));(ft&127)!==0||K_(m,a,c)}b.memoizedState=c;var S={value:c,getSnapshot:a};return b.queue=S,db(X_.bind(null,m,S,s),[s]),m.flags|=2048,_l(9,{destroy:void 0},Y_.bind(null,m,S,c,a),null),c},useId:function(){var s=ir(),a=zt.identifierPrefix;if(_t){var c=Ns,m=Os;c=(m&~(1<<32-Ct(m)-1)).toString(32)+c,a="_"+a+"R_"+c,c=Jd++,0<c&&(a+="H"+c.toString(32)),a+="_"}else c=kA++,a="_"+a+"r_"+c.toString(32)+"_";return s.memoizedState=a},useHostTransitionStatus:wp,useFormState:ab,useActionState:ab,useOptimistic:function(s){var a=ir();a.memoizedState=a.baseState=s;var c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return a.queue=c,a=Sp.bind(null,at,!0,c),c.dispatch=a,[s,a]},useMemoCache:fp,useCacheRefresh:function(){return ir().memoizedState=BA.bind(null,at)},useEffectEvent:function(s){var a=ir(),c={impl:s};return a.memoizedState=c,function(){if((Tt&2)!==0)throw Error(r(440));return c.impl.apply(void 0,arguments)}}},Cp={readContext:Bn,use:th,useCallback:yb,useContext:Bn,useEffect:_p,useImperativeHandle:gb,useInsertionEffect:fb,useLayoutEffect:mb,useMemo:_b,useReducer:nh,useRef:ub,useState:function(){return nh(ii)},useDebugValue:bp,useDeferredValue:function(s,a){var c=on();return bb(c,Dt.memoizedState,s,a)},useTransition:function(){var s=nh(ii)[0],a=on().memoizedState;return[typeof s=="boolean"?s:Yc(s),a]},useSyncExternalStore:Q_,useId:Sb,useHostTransitionStatus:wp,useFormState:ob,useActionState:ob,useOptimistic:function(s,a){var c=on();return eb(c,Dt,s,a)},useMemoCache:fp,useCacheRefresh:Cb};Cp.useEffectEvent=hb;var Rb={readContext:Bn,use:th,useCallback:yb,useContext:Bn,useEffect:_p,useImperativeHandle:gb,useInsertionEffect:fb,useLayoutEffect:mb,useMemo:_b,useReducer:pp,useRef:ub,useState:function(){return pp(ii)},useDebugValue:bp,useDeferredValue:function(s,a){var c=on();return Dt===null?vp(c,s,a):bb(c,Dt.memoizedState,s,a)},useTransition:function(){var s=pp(ii)[0],a=on().memoizedState;return[typeof s=="boolean"?s:Yc(s),a]},useSyncExternalStore:Q_,useId:Sb,useHostTransitionStatus:wp,useFormState:cb,useActionState:cb,useOptimistic:function(s,a){var c=on();return Dt!==null?eb(c,Dt,s,a):(c.baseState=s,[s,c.queue.dispatch])},useMemoCache:fp,useCacheRefresh:Cb};Rb.useEffectEvent=hb;function Ep(s,a,c,m){a=s.memoizedState,c=c(m,a),c=c==null?a:g({},a,c),s.memoizedState=c,s.lanes===0&&(s.updateQueue.baseState=c)}var Tp={enqueueSetState:function(s,a,c){s=s._reactInternals;var m=jr(),b=Wi(m);b.payload=a,c!=null&&(b.callback=c),a=Qi(s,b,m),a!==null&&(mr(a,s,m),Gc(a,s,m))},enqueueReplaceState:function(s,a,c){s=s._reactInternals;var m=jr(),b=Wi(m);b.tag=1,b.payload=a,c!=null&&(b.callback=c),a=Qi(s,b,m),a!==null&&(mr(a,s,m),Gc(a,s,m))},enqueueForceUpdate:function(s,a){s=s._reactInternals;var c=jr(),m=Wi(c);m.tag=2,a!=null&&(m.callback=a),a=Qi(s,m,c),a!==null&&(mr(a,s,c),Gc(a,s,c))}};function Ib(s,a,c,m,b,S,B){return s=s.stateNode,typeof s.shouldComponentUpdate=="function"?s.shouldComponentUpdate(m,S,B):a.prototype&&a.prototype.isPureReactComponent?!zc(c,m)||!zc(b,S):!0}function kb(s,a,c,m){s=a.state,typeof a.componentWillReceiveProps=="function"&&a.componentWillReceiveProps(c,m),typeof a.UNSAFE_componentWillReceiveProps=="function"&&a.UNSAFE_componentWillReceiveProps(c,m),a.state!==s&&Tp.enqueueReplaceState(a,a.state,null)}function go(s,a){var c=a;if("ref"in a){c={};for(var m in a)m!=="ref"&&(c[m]=a[m])}if(s=s.defaultProps){c===a&&(c=g({},c));for(var b in s)c[b]===void 0&&(c[b]=s[b])}return c}function Db(s){Bd(s)}function Mb(s){console.error(s)}function Ob(s){Bd(s)}function ah(s,a){try{var c=s.onUncaughtError;c(a.value,{componentStack:a.stack})}catch(m){setTimeout(function(){throw m})}}function Nb(s,a,c){try{var m=s.onCaughtError;m(c.value,{componentStack:c.stack,errorBoundary:a.tag===1?a.stateNode:null})}catch(b){setTimeout(function(){throw b})}}function Ap(s,a,c){return c=Wi(c),c.tag=3,c.payload={element:null},c.callback=function(){ah(s,a)},c}function Pb(s){return s=Wi(s),s.tag=3,s}function Bb(s,a,c,m){var b=c.type.getDerivedStateFromError;if(typeof b=="function"){var S=m.value;s.payload=function(){return b(S)},s.callback=function(){Nb(a,c,m)}}var B=c.stateNode;B!==null&&typeof B.componentDidCatch=="function"&&(s.callback=function(){Nb(a,c,m),typeof b!="function"&&(ea===null?ea=new Set([this]):ea.add(this));var W=m.stack;this.componentDidCatch(m.value,{componentStack:W!==null?W:""})})}function LA(s,a,c,m,b){if(c.flags|=32768,m!==null&&typeof m=="object"&&typeof m.then=="function"){if(a=c.alternate,a!==null&&ul(a,c,b,!0),c=Cr.current,c!==null){switch(c.tag){case 31:case 13:return $r===null?_h():c.alternate===null&&rn===0&&(rn=3),c.flags&=-257,c.flags|=65536,c.lanes=b,m===Wd?c.flags|=16384:(a=c.updateQueue,a===null?c.updateQueue=new Set([m]):a.add(m),Zp(s,m,b)),!1;case 22:return c.flags|=65536,m===Wd?c.flags|=16384:(a=c.updateQueue,a===null?(a={transitions:null,markerInstances:null,retryQueue:new Set([m])},c.updateQueue=a):(c=a.retryQueue,c===null?a.retryQueue=new Set([m]):c.add(m)),Zp(s,m,b)),!1}throw Error(r(435,c.tag))}return Zp(s,m,b),_h(),!1}if(_t)return a=Cr.current,a!==null?((a.flags&65536)===0&&(a.flags|=256),a.flags|=65536,a.lanes=b,m!==Gm&&(s=Error(r(422),{cause:m}),Fc(Lr(s,c)))):(m!==Gm&&(a=Error(r(423),{cause:m}),Fc(Lr(a,c))),s=s.current.alternate,s.flags|=65536,b&=-b,s.lanes|=b,m=Lr(m,c),b=Ap(s.stateNode,m,b),rp(s,b),rn!==4&&(rn=2)),!1;var S=Error(r(520),{cause:m});if(S=Lr(S,c),au===null?au=[S]:au.push(S),rn!==4&&(rn=2),a===null)return!0;m=Lr(m,c),c=a;do{switch(c.tag){case 3:return c.flags|=65536,s=b&-b,c.lanes|=s,s=Ap(c.stateNode,m,s),rp(c,s),!1;case 1:if(a=c.type,S=c.stateNode,(c.flags&128)===0&&(typeof a.getDerivedStateFromError=="function"||S!==null&&typeof S.componentDidCatch=="function"&&(ea===null||!ea.has(S))))return c.flags|=65536,b&=-b,c.lanes|=b,b=Pb(b),Bb(b,s,c,m),rp(c,b),!1}c=c.return}while(c!==null);return!1}var jp=Error(r(461)),yn=!1;function zn(s,a,c,m){a.child=s===null?F_(a,null,c,m):mo(a,s.child,c,m)}function zb(s,a,c,m,b){c=c.render;var S=a.ref;if("ref"in m){var B={};for(var W in m)W!=="ref"&&(B[W]=m[W])}else B=m;return co(a),m=cp(s,a,c,B,S,b),W=up(),s!==null&&!yn?(dp(s,a,b),ai(s,a,b)):(_t&&W&&qm(a),a.flags|=1,zn(s,a,m,b),a.child)}function Lb(s,a,c,m,b){if(s===null){var S=c.type;return typeof S=="function"&&!Fm(S)&&S.defaultProps===void 0&&c.compare===null?(a.tag=15,a.type=S,Ub(s,a,S,m,b)):(s=Fd(c.type,null,m,a,a.mode,b),s.ref=a.ref,s.return=a,a.child=s)}if(S=s.child,!Pp(s,b)){var B=S.memoizedProps;if(c=c.compare,c=c!==null?c:zc,c(B,m)&&s.ref===a.ref)return ai(s,a,b)}return a.flags|=1,s=ei(S,m),s.ref=a.ref,s.return=a,a.child=s}function Ub(s,a,c,m,b){if(s!==null){var S=s.memoizedProps;if(zc(S,m)&&s.ref===a.ref)if(yn=!1,a.pendingProps=m=S,Pp(s,b))(s.flags&131072)!==0&&(yn=!0);else return a.lanes=s.lanes,ai(s,a,b)}return Rp(s,a,c,m,b)}function Fb(s,a,c,m){var b=m.children,S=s!==null?s.memoizedState:null;if(s===null&&a.stateNode===null&&(a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),m.mode==="hidden"){if((a.flags&128)!==0){if(S=S!==null?S.baseLanes|c:c,s!==null){for(m=a.child=s.child,b=0;m!==null;)b=b|m.lanes|m.childLanes,m=m.sibling;m=b&~S}else m=0,a.child=null;return Vb(s,a,S,c,m)}if((c&536870912)!==0)a.memoizedState={baseLanes:0,cachePool:null},s!==null&&Hd(a,S!==null?S.cachePool:null),S!==null?q_(a,S):ip(),H_(a);else return m=a.lanes=536870912,Vb(s,a,S!==null?S.baseLanes|c:c,c,m)}else S!==null?(Hd(a,S.cachePool),q_(a,S),Yi(),a.memoizedState=null):(s!==null&&Hd(a,null),ip(),Yi());return zn(s,a,b,c),a.child}function Jc(s,a){return s!==null&&s.tag===22||a.stateNode!==null||(a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),a.sibling}function Vb(s,a,c,m,b){var S=Jm();return S=S===null?null:{parent:pn._currentValue,pool:S},a.memoizedState={baseLanes:c,cachePool:S},s!==null&&Hd(a,null),ip(),H_(a),s!==null&&ul(s,a,m,!0),a.childLanes=b,null}function oh(s,a){return a=ch({mode:a.mode,children:a.children},s.mode),a.ref=s.ref,s.child=a,a.return=s,a}function $b(s,a,c){return mo(a,s.child,null,c),s=oh(a,a.pendingProps),s.flags|=2,Er(a),a.memoizedState=null,s}function UA(s,a,c){var m=a.pendingProps,b=(a.flags&128)!==0;if(a.flags&=-129,s===null){if(_t){if(m.mode==="hidden")return s=oh(a,m),a.lanes=536870912,Jc(null,s);if(op(a),(s=qt)?(s=tx(s,Vr),s=s!==null&&s.data==="&"?s:null,s!==null&&(a.memoizedState={dehydrated:s,treeContext:Vi!==null?{id:Os,overflow:Ns}:null,retryLane:536870912,hydrationErrors:null},c=T_(s),c.return=a,a.child=c,Pn=a,qt=null)):s=null,s===null)throw qi(a);return a.lanes=536870912,null}return oh(a,m)}var S=s.memoizedState;if(S!==null){var B=S.dehydrated;if(op(a),b)if(a.flags&256)a.flags&=-257,a=$b(s,a,c);else if(a.memoizedState!==null)a.child=s.child,a.flags|=128,a=null;else throw Error(r(558));else if(yn||ul(s,a,c,!1),b=(c&s.childLanes)!==0,yn||b){if(m=zt,m!==null&&(B=vc(m,c),B!==0&&B!==S.retryLane))throw S.retryLane=B,io(s,B),mr(m,s,B),jp;_h(),a=$b(s,a,c)}else s=S.treeContext,qt=qr(B.nextSibling),Pn=a,_t=!0,$i=null,Vr=!1,s!==null&&R_(a,s),a=oh(a,m),a.flags|=4096;return a}return s=ei(s.child,{mode:m.mode,children:m.children}),s.ref=a.ref,a.child=s,s.return=a,s}function lh(s,a){var c=a.ref;if(c===null)s!==null&&s.ref!==null&&(a.flags|=4194816);else{if(typeof c!="function"&&typeof c!="object")throw Error(r(284));(s===null||s.ref!==c)&&(a.flags|=4194816)}}function Rp(s,a,c,m,b){return co(a),c=cp(s,a,c,m,void 0,b),m=up(),s!==null&&!yn?(dp(s,a,b),ai(s,a,b)):(_t&&m&&qm(a),a.flags|=1,zn(s,a,c,b),a.child)}function qb(s,a,c,m,b,S){return co(a),a.updateQueue=null,c=W_(a,m,c,b),G_(s),m=up(),s!==null&&!yn?(dp(s,a,S),ai(s,a,S)):(_t&&m&&qm(a),a.flags|=1,zn(s,a,c,S),a.child)}function Hb(s,a,c,m,b){if(co(a),a.stateNode===null){var S=al,B=c.contextType;typeof B=="object"&&B!==null&&(S=Bn(B)),S=new c(m,S),a.memoizedState=S.state!==null&&S.state!==void 0?S.state:null,S.updater=Tp,a.stateNode=S,S._reactInternals=a,S=a.stateNode,S.props=m,S.state=a.memoizedState,S.refs={},tp(a),B=c.contextType,S.context=typeof B=="object"&&B!==null?Bn(B):al,S.state=a.memoizedState,B=c.getDerivedStateFromProps,typeof B=="function"&&(Ep(a,c,B,m),S.state=a.memoizedState),typeof c.getDerivedStateFromProps=="function"||typeof S.getSnapshotBeforeUpdate=="function"||typeof S.UNSAFE_componentWillMount!="function"&&typeof S.componentWillMount!="function"||(B=S.state,typeof S.componentWillMount=="function"&&S.componentWillMount(),typeof S.UNSAFE_componentWillMount=="function"&&S.UNSAFE_componentWillMount(),B!==S.state&&Tp.enqueueReplaceState(S,S.state,null),Qc(a,m,S,b),Wc(),S.state=a.memoizedState),typeof S.componentDidMount=="function"&&(a.flags|=4194308),m=!0}else if(s===null){S=a.stateNode;var W=a.memoizedProps,se=go(c,W);S.props=se;var pe=S.context,Ee=c.contextType;B=al,typeof Ee=="object"&&Ee!==null&&(B=Bn(Ee));var Ie=c.getDerivedStateFromProps;Ee=typeof Ie=="function"||typeof S.getSnapshotBeforeUpdate=="function",W=a.pendingProps!==W,Ee||typeof S.UNSAFE_componentWillReceiveProps!="function"&&typeof S.componentWillReceiveProps!="function"||(W||pe!==B)&&kb(a,S,m,B),Gi=!1;var _e=a.memoizedState;S.state=_e,Qc(a,m,S,b),Wc(),pe=a.memoizedState,W||_e!==pe||Gi?(typeof Ie=="function"&&(Ep(a,c,Ie,m),pe=a.memoizedState),(se=Gi||Ib(a,c,se,m,_e,pe,B))?(Ee||typeof S.UNSAFE_componentWillMount!="function"&&typeof S.componentWillMount!="function"||(typeof S.componentWillMount=="function"&&S.componentWillMount(),typeof S.UNSAFE_componentWillMount=="function"&&S.UNSAFE_componentWillMount()),typeof S.componentDidMount=="function"&&(a.flags|=4194308)):(typeof S.componentDidMount=="function"&&(a.flags|=4194308),a.memoizedProps=m,a.memoizedState=pe),S.props=m,S.state=pe,S.context=B,m=se):(typeof S.componentDidMount=="function"&&(a.flags|=4194308),m=!1)}else{S=a.stateNode,np(s,a),B=a.memoizedProps,Ee=go(c,B),S.props=Ee,Ie=a.pendingProps,_e=S.context,pe=c.contextType,se=al,typeof pe=="object"&&pe!==null&&(se=Bn(pe)),W=c.getDerivedStateFromProps,(pe=typeof W=="function"||typeof S.getSnapshotBeforeUpdate=="function")||typeof S.UNSAFE_componentWillReceiveProps!="function"&&typeof S.componentWillReceiveProps!="function"||(B!==Ie||_e!==se)&&kb(a,S,m,se),Gi=!1,_e=a.memoizedState,S.state=_e,Qc(a,m,S,b),Wc();var xe=a.memoizedState;B!==Ie||_e!==xe||Gi||s!==null&&s.dependencies!==null&&$d(s.dependencies)?(typeof W=="function"&&(Ep(a,c,W,m),xe=a.memoizedState),(Ee=Gi||Ib(a,c,Ee,m,_e,xe,se)||s!==null&&s.dependencies!==null&&$d(s.dependencies))?(pe||typeof S.UNSAFE_componentWillUpdate!="function"&&typeof S.componentWillUpdate!="function"||(typeof S.componentWillUpdate=="function"&&S.componentWillUpdate(m,xe,se),typeof S.UNSAFE_componentWillUpdate=="function"&&S.UNSAFE_componentWillUpdate(m,xe,se)),typeof S.componentDidUpdate=="function"&&(a.flags|=4),typeof S.getSnapshotBeforeUpdate=="function"&&(a.flags|=1024)):(typeof S.componentDidUpdate!="function"||B===s.memoizedProps&&_e===s.memoizedState||(a.flags|=4),typeof S.getSnapshotBeforeUpdate!="function"||B===s.memoizedProps&&_e===s.memoizedState||(a.flags|=1024),a.memoizedProps=m,a.memoizedState=xe),S.props=m,S.state=xe,S.context=se,m=Ee):(typeof S.componentDidUpdate!="function"||B===s.memoizedProps&&_e===s.memoizedState||(a.flags|=4),typeof S.getSnapshotBeforeUpdate!="function"||B===s.memoizedProps&&_e===s.memoizedState||(a.flags|=1024),m=!1)}return S=m,lh(s,a),m=(a.flags&128)!==0,S||m?(S=a.stateNode,c=m&&typeof c.getDerivedStateFromError!="function"?null:S.render(),a.flags|=1,s!==null&&m?(a.child=mo(a,s.child,null,b),a.child=mo(a,null,c,b)):zn(s,a,c,b),a.memoizedState=S.state,s=a.child):s=ai(s,a,b),s}function Gb(s,a,c,m){return oo(),a.flags|=256,zn(s,a,c,m),a.child}var Ip={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function kp(s){return{baseLanes:s,cachePool:N_()}}function Dp(s,a,c){return s=s!==null?s.childLanes&~c:0,a&&(s|=Ar),s}function Wb(s,a,c){var m=a.pendingProps,b=!1,S=(a.flags&128)!==0,B;if((B=S)||(B=s!==null&&s.memoizedState===null?!1:(an.current&2)!==0),B&&(b=!0,a.flags&=-129),B=(a.flags&32)!==0,a.flags&=-33,s===null){if(_t){if(b?Ki(a):Yi(),(s=qt)?(s=tx(s,Vr),s=s!==null&&s.data!=="&"?s:null,s!==null&&(a.memoizedState={dehydrated:s,treeContext:Vi!==null?{id:Os,overflow:Ns}:null,retryLane:536870912,hydrationErrors:null},c=T_(s),c.return=a,a.child=c,Pn=a,qt=null)):s=null,s===null)throw qi(a);return mg(s)?a.lanes=32:a.lanes=536870912,null}var W=m.children;return m=m.fallback,b?(Yi(),b=a.mode,W=ch({mode:"hidden",children:W},b),m=ao(m,b,c,null),W.return=a,m.return=a,W.sibling=m,a.child=W,m=a.child,m.memoizedState=kp(c),m.childLanes=Dp(s,B,c),a.memoizedState=Ip,Jc(null,m)):(Ki(a),Mp(a,W))}var se=s.memoizedState;if(se!==null&&(W=se.dehydrated,W!==null)){if(S)a.flags&256?(Ki(a),a.flags&=-257,a=Op(s,a,c)):a.memoizedState!==null?(Yi(),a.child=s.child,a.flags|=128,a=null):(Yi(),W=m.fallback,b=a.mode,m=ch({mode:"visible",children:m.children},b),W=ao(W,b,c,null),W.flags|=2,m.return=a,W.return=a,m.sibling=W,a.child=m,mo(a,s.child,null,c),m=a.child,m.memoizedState=kp(c),m.childLanes=Dp(s,B,c),a.memoizedState=Ip,a=Jc(null,m));else if(Ki(a),mg(W)){if(B=W.nextSibling&&W.nextSibling.dataset,B)var pe=B.dgst;B=pe,m=Error(r(419)),m.stack="",m.digest=B,Fc({value:m,source:null,stack:null}),a=Op(s,a,c)}else if(yn||ul(s,a,c,!1),B=(c&s.childLanes)!==0,yn||B){if(B=zt,B!==null&&(m=vc(B,c),m!==0&&m!==se.retryLane))throw se.retryLane=m,io(s,m),mr(B,s,m),jp;fg(W)||_h(),a=Op(s,a,c)}else fg(W)?(a.flags|=192,a.child=s.child,a=null):(s=se.treeContext,qt=qr(W.nextSibling),Pn=a,_t=!0,$i=null,Vr=!1,s!==null&&R_(a,s),a=Mp(a,m.children),a.flags|=4096);return a}return b?(Yi(),W=m.fallback,b=a.mode,se=s.child,pe=se.sibling,m=ei(se,{mode:"hidden",children:m.children}),m.subtreeFlags=se.subtreeFlags&65011712,pe!==null?W=ei(pe,W):(W=ao(W,b,c,null),W.flags|=2),W.return=a,m.return=a,m.sibling=W,a.child=m,Jc(null,m),m=a.child,W=s.child.memoizedState,W===null?W=kp(c):(b=W.cachePool,b!==null?(se=pn._currentValue,b=b.parent!==se?{parent:se,pool:se}:b):b=N_(),W={baseLanes:W.baseLanes|c,cachePool:b}),m.memoizedState=W,m.childLanes=Dp(s,B,c),a.memoizedState=Ip,Jc(s.child,m)):(Ki(a),c=s.child,s=c.sibling,c=ei(c,{mode:"visible",children:m.children}),c.return=a,c.sibling=null,s!==null&&(B=a.deletions,B===null?(a.deletions=[s],a.flags|=16):B.push(s)),a.child=c,a.memoizedState=null,c)}function Mp(s,a){return a=ch({mode:"visible",children:a},s.mode),a.return=s,s.child=a}function ch(s,a){return s=Sr(22,s,null,a),s.lanes=0,s}function Op(s,a,c){return mo(a,s.child,null,c),s=Mp(a,a.pendingProps.children),s.flags|=2,a.memoizedState=null,s}function Qb(s,a,c){s.lanes|=a;var m=s.alternate;m!==null&&(m.lanes|=a),Km(s.return,a,c)}function Np(s,a,c,m,b,S){var B=s.memoizedState;B===null?s.memoizedState={isBackwards:a,rendering:null,renderingStartTime:0,last:m,tail:c,tailMode:b,treeForkCount:S}:(B.isBackwards=a,B.rendering=null,B.renderingStartTime=0,B.last=m,B.tail=c,B.tailMode=b,B.treeForkCount=S)}function Kb(s,a,c){var m=a.pendingProps,b=m.revealOrder,S=m.tail;m=m.children;var B=an.current,W=(B&2)!==0;if(W?(B=B&1|2,a.flags|=128):B&=1,re(an,B),zn(s,a,m,c),m=_t?Uc:0,!W&&s!==null&&(s.flags&128)!==0)e:for(s=a.child;s!==null;){if(s.tag===13)s.memoizedState!==null&&Qb(s,c,a);else if(s.tag===19)Qb(s,c,a);else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===a)break e;for(;s.sibling===null;){if(s.return===null||s.return===a)break e;s=s.return}s.sibling.return=s.return,s=s.sibling}switch(b){case"forwards":for(c=a.child,b=null;c!==null;)s=c.alternate,s!==null&&Xd(s)===null&&(b=c),c=c.sibling;c=b,c===null?(b=a.child,a.child=null):(b=c.sibling,c.sibling=null),Np(a,!1,b,c,S,m);break;case"backwards":case"unstable_legacy-backwards":for(c=null,b=a.child,a.child=null;b!==null;){if(s=b.alternate,s!==null&&Xd(s)===null){a.child=b;break}s=b.sibling,b.sibling=c,c=b,b=s}Np(a,!0,c,null,S,m);break;case"together":Np(a,!1,null,null,void 0,m);break;default:a.memoizedState=null}return a.child}function ai(s,a,c){if(s!==null&&(a.dependencies=s.dependencies),Ji|=a.lanes,(c&a.childLanes)===0)if(s!==null){if(ul(s,a,c,!1),(c&a.childLanes)===0)return null}else return null;if(s!==null&&a.child!==s.child)throw Error(r(153));if(a.child!==null){for(s=a.child,c=ei(s,s.pendingProps),a.child=c,c.return=a;s.sibling!==null;)s=s.sibling,c=c.sibling=ei(s,s.pendingProps),c.return=a;c.sibling=null}return a.child}function Pp(s,a){return(s.lanes&a)!==0?!0:(s=s.dependencies,!!(s!==null&&$d(s)))}function FA(s,a,c){switch(a.tag){case 3:ce(a,a.stateNode.containerInfo),Hi(a,pn,s.memoizedState.cache),oo();break;case 27:case 5:Oe(a);break;case 4:ce(a,a.stateNode.containerInfo);break;case 10:Hi(a,a.type,a.memoizedProps.value);break;case 31:if(a.memoizedState!==null)return a.flags|=128,op(a),null;break;case 13:var m=a.memoizedState;if(m!==null)return m.dehydrated!==null?(Ki(a),a.flags|=128,null):(c&a.child.childLanes)!==0?Wb(s,a,c):(Ki(a),s=ai(s,a,c),s!==null?s.sibling:null);Ki(a);break;case 19:var b=(s.flags&128)!==0;if(m=(c&a.childLanes)!==0,m||(ul(s,a,c,!1),m=(c&a.childLanes)!==0),b){if(m)return Kb(s,a,c);a.flags|=128}if(b=a.memoizedState,b!==null&&(b.rendering=null,b.tail=null,b.lastEffect=null),re(an,an.current),m)break;return null;case 22:return a.lanes=0,Fb(s,a,c,a.pendingProps);case 24:Hi(a,pn,s.memoizedState.cache)}return ai(s,a,c)}function Yb(s,a,c){if(s!==null)if(s.memoizedProps!==a.pendingProps)yn=!0;else{if(!Pp(s,c)&&(a.flags&128)===0)return yn=!1,FA(s,a,c);yn=(s.flags&131072)!==0}else yn=!1,_t&&(a.flags&1048576)!==0&&j_(a,Uc,a.index);switch(a.lanes=0,a.tag){case 16:e:{var m=a.pendingProps;if(s=ho(a.elementType),a.type=s,typeof s=="function")Fm(s)?(m=go(s,m),a.tag=1,a=Hb(null,a,s,m,c)):(a.tag=0,a=Rp(null,a,s,m,c));else{if(s!=null){var b=s.$$typeof;if(b===M){a.tag=11,a=zb(null,a,s,m,c);break e}else if(b===I){a.tag=14,a=Lb(null,a,s,m,c);break e}}throw a=N(s)||s,Error(r(306,a,""))}}return a;case 0:return Rp(s,a,a.type,a.pendingProps,c);case 1:return m=a.type,b=go(m,a.pendingProps),Hb(s,a,m,b,c);case 3:e:{if(ce(a,a.stateNode.containerInfo),s===null)throw Error(r(387));m=a.pendingProps;var S=a.memoizedState;b=S.element,np(s,a),Qc(a,m,null,c);var B=a.memoizedState;if(m=B.cache,Hi(a,pn,m),m!==S.cache&&Ym(a,[pn],c,!0),Wc(),m=B.element,S.isDehydrated)if(S={element:m,isDehydrated:!1,cache:B.cache},a.updateQueue.baseState=S,a.memoizedState=S,a.flags&256){a=Gb(s,a,m,c);break e}else if(m!==b){b=Lr(Error(r(424)),a),Fc(b),a=Gb(s,a,m,c);break e}else for(s=a.stateNode.containerInfo,s.nodeType===9?s=s.body:s=s.nodeName==="HTML"?s.ownerDocument.body:s,qt=qr(s.firstChild),Pn=a,_t=!0,$i=null,Vr=!0,c=F_(a,null,m,c),a.child=c;c;)c.flags=c.flags&-3|4096,c=c.sibling;else{if(oo(),m===b){a=ai(s,a,c);break e}zn(s,a,m,c)}a=a.child}return a;case 26:return lh(s,a),s===null?(c=ox(a.type,null,a.pendingProps,null))?a.memoizedState=c:_t||(c=a.type,s=a.pendingProps,m=Eh(be.current).createElement(c),m[hn]=a,m[In]=s,Ln(m,c,s),fn(m),a.stateNode=m):a.memoizedState=ox(a.type,s.memoizedProps,a.pendingProps,s.memoizedState),null;case 27:return Oe(a),s===null&&_t&&(m=a.stateNode=sx(a.type,a.pendingProps,be.current),Pn=a,Vr=!0,b=qt,sa(a.type)?(pg=b,qt=qr(m.firstChild)):qt=b),zn(s,a,a.pendingProps.children,c),lh(s,a),s===null&&(a.flags|=4194304),a.child;case 5:return s===null&&_t&&((b=m=qt)&&(m=y2(m,a.type,a.pendingProps,Vr),m!==null?(a.stateNode=m,Pn=a,qt=qr(m.firstChild),Vr=!1,b=!0):b=!1),b||qi(a)),Oe(a),b=a.type,S=a.pendingProps,B=s!==null?s.memoizedProps:null,m=S.children,ug(b,S)?m=null:B!==null&&ug(b,B)&&(a.flags|=32),a.memoizedState!==null&&(b=cp(s,a,DA,null,null,c),mu._currentValue=b),lh(s,a),zn(s,a,m,c),a.child;case 6:return s===null&&_t&&((s=c=qt)&&(c=_2(c,a.pendingProps,Vr),c!==null?(a.stateNode=c,Pn=a,qt=null,s=!0):s=!1),s||qi(a)),null;case 13:return Wb(s,a,c);case 4:return ce(a,a.stateNode.containerInfo),m=a.pendingProps,s===null?a.child=mo(a,null,m,c):zn(s,a,m,c),a.child;case 11:return zb(s,a,a.type,a.pendingProps,c);case 7:return zn(s,a,a.pendingProps,c),a.child;case 8:return zn(s,a,a.pendingProps.children,c),a.child;case 12:return zn(s,a,a.pendingProps.children,c),a.child;case 10:return m=a.pendingProps,Hi(a,a.type,m.value),zn(s,a,m.children,c),a.child;case 9:return b=a.type._context,m=a.pendingProps.children,co(a),b=Bn(b),m=m(b),a.flags|=1,zn(s,a,m,c),a.child;case 14:return Lb(s,a,a.type,a.pendingProps,c);case 15:return Ub(s,a,a.type,a.pendingProps,c);case 19:return Kb(s,a,c);case 31:return UA(s,a,c);case 22:return Fb(s,a,c,a.pendingProps);case 24:return co(a),m=Bn(pn),s===null?(b=Jm(),b===null&&(b=zt,S=Xm(),b.pooledCache=S,S.refCount++,S!==null&&(b.pooledCacheLanes|=c),b=S),a.memoizedState={parent:m,cache:b},tp(a),Hi(a,pn,b)):((s.lanes&c)!==0&&(np(s,a),Qc(a,null,null,c),Wc()),b=s.memoizedState,S=a.memoizedState,b.parent!==m?(b={parent:m,cache:m},a.memoizedState=b,a.lanes===0&&(a.memoizedState=a.updateQueue.baseState=b),Hi(a,pn,m)):(m=S.cache,Hi(a,pn,m),m!==b.cache&&Ym(a,[pn],c,!0))),zn(s,a,a.pendingProps.children,c),a.child;case 29:throw a.pendingProps}throw Error(r(156,a.tag))}function oi(s){s.flags|=4}function Bp(s,a,c,m,b){if((a=(s.mode&32)!==0)&&(a=!1),a){if(s.flags|=16777216,(b&335544128)===b)if(s.stateNode.complete)s.flags|=8192;else if(Sv())s.flags|=8192;else throw fo=Wd,ep}else s.flags&=-16777217}function Xb(s,a){if(a.type!=="stylesheet"||(a.state.loading&4)!==0)s.flags&=-16777217;else if(s.flags|=16777216,!hx(a))if(Sv())s.flags|=8192;else throw fo=Wd,ep}function uh(s,a){a!==null&&(s.flags|=4),s.flags&16384&&(a=s.tag!==22?gd():536870912,s.lanes|=a,wl|=a)}function eu(s,a){if(!_t)switch(s.tailMode){case"hidden":a=s.tail;for(var c=null;a!==null;)a.alternate!==null&&(c=a),a=a.sibling;c===null?s.tail=null:c.sibling=null;break;case"collapsed":c=s.tail;for(var m=null;c!==null;)c.alternate!==null&&(m=c),c=c.sibling;m===null?a||s.tail===null?s.tail=null:s.tail.sibling=null:m.sibling=null}}function Ht(s){var a=s.alternate!==null&&s.alternate.child===s.child,c=0,m=0;if(a)for(var b=s.child;b!==null;)c|=b.lanes|b.childLanes,m|=b.subtreeFlags&65011712,m|=b.flags&65011712,b.return=s,b=b.sibling;else for(b=s.child;b!==null;)c|=b.lanes|b.childLanes,m|=b.subtreeFlags,m|=b.flags,b.return=s,b=b.sibling;return s.subtreeFlags|=m,s.childLanes=c,a}function VA(s,a,c){var m=a.pendingProps;switch(Hm(a),a.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ht(a),null;case 1:return Ht(a),null;case 3:return c=a.stateNode,m=null,s!==null&&(m=s.memoizedState.cache),a.memoizedState.cache!==m&&(a.flags|=2048),ri(pn),ge(),c.pendingContext&&(c.context=c.pendingContext,c.pendingContext=null),(s===null||s.child===null)&&(cl(a)?oi(a):s===null||s.memoizedState.isDehydrated&&(a.flags&256)===0||(a.flags|=1024,Wm())),Ht(a),null;case 26:var b=a.type,S=a.memoizedState;return s===null?(oi(a),S!==null?(Ht(a),Xb(a,S)):(Ht(a),Bp(a,b,null,m,c))):S?S!==s.memoizedState?(oi(a),Ht(a),Xb(a,S)):(Ht(a),a.flags&=-16777217):(s=s.memoizedProps,s!==m&&oi(a),Ht(a),Bp(a,b,s,m,c)),null;case 27:if(ze(a),c=be.current,b=a.type,s!==null&&a.stateNode!=null)s.memoizedProps!==m&&oi(a);else{if(!m){if(a.stateNode===null)throw Error(r(166));return Ht(a),null}s=ne.current,cl(a)?I_(a):(s=sx(b,m,c),a.stateNode=s,oi(a))}return Ht(a),null;case 5:if(ze(a),b=a.type,s!==null&&a.stateNode!=null)s.memoizedProps!==m&&oi(a);else{if(!m){if(a.stateNode===null)throw Error(r(166));return Ht(a),null}if(S=ne.current,cl(a))I_(a);else{var B=Eh(be.current);switch(S){case 1:S=B.createElementNS("http://www.w3.org/2000/svg",b);break;case 2:S=B.createElementNS("http://www.w3.org/1998/Math/MathML",b);break;default:switch(b){case"svg":S=B.createElementNS("http://www.w3.org/2000/svg",b);break;case"math":S=B.createElementNS("http://www.w3.org/1998/Math/MathML",b);break;case"script":S=B.createElement("div"),S.innerHTML="<script><\/script>",S=S.removeChild(S.firstChild);break;case"select":S=typeof m.is=="string"?B.createElement("select",{is:m.is}):B.createElement("select"),m.multiple?S.multiple=!0:m.size&&(S.size=m.size);break;default:S=typeof m.is=="string"?B.createElement(b,{is:m.is}):B.createElement(b)}}S[hn]=a,S[In]=m;e:for(B=a.child;B!==null;){if(B.tag===5||B.tag===6)S.appendChild(B.stateNode);else if(B.tag!==4&&B.tag!==27&&B.child!==null){B.child.return=B,B=B.child;continue}if(B===a)break e;for(;B.sibling===null;){if(B.return===null||B.return===a)break e;B=B.return}B.sibling.return=B.return,B=B.sibling}a.stateNode=S;e:switch(Ln(S,b,m),b){case"button":case"input":case"select":case"textarea":m=!!m.autoFocus;break e;case"img":m=!0;break e;default:m=!1}m&&oi(a)}}return Ht(a),Bp(a,a.type,s===null?null:s.memoizedProps,a.pendingProps,c),null;case 6:if(s&&a.stateNode!=null)s.memoizedProps!==m&&oi(a);else{if(typeof m!="string"&&a.stateNode===null)throw Error(r(166));if(s=be.current,cl(a)){if(s=a.stateNode,c=a.memoizedProps,m=null,b=Pn,b!==null)switch(b.tag){case 27:case 5:m=b.memoizedProps}s[hn]=a,s=!!(s.nodeValue===c||m!==null&&m.suppressHydrationWarning===!0||Wv(s.nodeValue,c)),s||qi(a,!0)}else s=Eh(s).createTextNode(m),s[hn]=a,a.stateNode=s}return Ht(a),null;case 31:if(c=a.memoizedState,s===null||s.memoizedState!==null){if(m=cl(a),c!==null){if(s===null){if(!m)throw Error(r(318));if(s=a.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(r(557));s[hn]=a}else oo(),(a.flags&128)===0&&(a.memoizedState=null),a.flags|=4;Ht(a),s=!1}else c=Wm(),s!==null&&s.memoizedState!==null&&(s.memoizedState.hydrationErrors=c),s=!0;if(!s)return a.flags&256?(Er(a),a):(Er(a),null);if((a.flags&128)!==0)throw Error(r(558))}return Ht(a),null;case 13:if(m=a.memoizedState,s===null||s.memoizedState!==null&&s.memoizedState.dehydrated!==null){if(b=cl(a),m!==null&&m.dehydrated!==null){if(s===null){if(!b)throw Error(r(318));if(b=a.memoizedState,b=b!==null?b.dehydrated:null,!b)throw Error(r(317));b[hn]=a}else oo(),(a.flags&128)===0&&(a.memoizedState=null),a.flags|=4;Ht(a),b=!1}else b=Wm(),s!==null&&s.memoizedState!==null&&(s.memoizedState.hydrationErrors=b),b=!0;if(!b)return a.flags&256?(Er(a),a):(Er(a),null)}return Er(a),(a.flags&128)!==0?(a.lanes=c,a):(c=m!==null,s=s!==null&&s.memoizedState!==null,c&&(m=a.child,b=null,m.alternate!==null&&m.alternate.memoizedState!==null&&m.alternate.memoizedState.cachePool!==null&&(b=m.alternate.memoizedState.cachePool.pool),S=null,m.memoizedState!==null&&m.memoizedState.cachePool!==null&&(S=m.memoizedState.cachePool.pool),S!==b&&(m.flags|=2048)),c!==s&&c&&(a.child.flags|=8192),uh(a,a.updateQueue),Ht(a),null);case 4:return ge(),s===null&&ig(a.stateNode.containerInfo),Ht(a),null;case 10:return ri(a.type),Ht(a),null;case 19:if(H(an),m=a.memoizedState,m===null)return Ht(a),null;if(b=(a.flags&128)!==0,S=m.rendering,S===null)if(b)eu(m,!1);else{if(rn!==0||s!==null&&(s.flags&128)!==0)for(s=a.child;s!==null;){if(S=Xd(s),S!==null){for(a.flags|=128,eu(m,!1),s=S.updateQueue,a.updateQueue=s,uh(a,s),a.subtreeFlags=0,s=c,c=a.child;c!==null;)E_(c,s),c=c.sibling;return re(an,an.current&1|2),_t&&ti(a,m.treeForkCount),a.child}s=s.sibling}m.tail!==null&&Ne()>ph&&(a.flags|=128,b=!0,eu(m,!1),a.lanes=4194304)}else{if(!b)if(s=Xd(S),s!==null){if(a.flags|=128,b=!0,s=s.updateQueue,a.updateQueue=s,uh(a,s),eu(m,!0),m.tail===null&&m.tailMode==="hidden"&&!S.alternate&&!_t)return Ht(a),null}else 2*Ne()-m.renderingStartTime>ph&&c!==536870912&&(a.flags|=128,b=!0,eu(m,!1),a.lanes=4194304);m.isBackwards?(S.sibling=a.child,a.child=S):(s=m.last,s!==null?s.sibling=S:a.child=S,m.last=S)}return m.tail!==null?(s=m.tail,m.rendering=s,m.tail=s.sibling,m.renderingStartTime=Ne(),s.sibling=null,c=an.current,re(an,b?c&1|2:c&1),_t&&ti(a,m.treeForkCount),s):(Ht(a),null);case 22:case 23:return Er(a),ap(),m=a.memoizedState!==null,s!==null?s.memoizedState!==null!==m&&(a.flags|=8192):m&&(a.flags|=8192),m?(c&536870912)!==0&&(a.flags&128)===0&&(Ht(a),a.subtreeFlags&6&&(a.flags|=8192)):Ht(a),c=a.updateQueue,c!==null&&uh(a,c.retryQueue),c=null,s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(c=s.memoizedState.cachePool.pool),m=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(m=a.memoizedState.cachePool.pool),m!==c&&(a.flags|=2048),s!==null&&H(uo),null;case 24:return c=null,s!==null&&(c=s.memoizedState.cache),a.memoizedState.cache!==c&&(a.flags|=2048),ri(pn),Ht(a),null;case 25:return null;case 30:return null}throw Error(r(156,a.tag))}function $A(s,a){switch(Hm(a),a.tag){case 1:return s=a.flags,s&65536?(a.flags=s&-65537|128,a):null;case 3:return ri(pn),ge(),s=a.flags,(s&65536)!==0&&(s&128)===0?(a.flags=s&-65537|128,a):null;case 26:case 27:case 5:return ze(a),null;case 31:if(a.memoizedState!==null){if(Er(a),a.alternate===null)throw Error(r(340));oo()}return s=a.flags,s&65536?(a.flags=s&-65537|128,a):null;case 13:if(Er(a),s=a.memoizedState,s!==null&&s.dehydrated!==null){if(a.alternate===null)throw Error(r(340));oo()}return s=a.flags,s&65536?(a.flags=s&-65537|128,a):null;case 19:return H(an),null;case 4:return ge(),null;case 10:return ri(a.type),null;case 22:case 23:return Er(a),ap(),s!==null&&H(uo),s=a.flags,s&65536?(a.flags=s&-65537|128,a):null;case 24:return ri(pn),null;case 25:return null;default:return null}}function Zb(s,a){switch(Hm(a),a.tag){case 3:ri(pn),ge();break;case 26:case 27:case 5:ze(a);break;case 4:ge();break;case 31:a.memoizedState!==null&&Er(a);break;case 13:Er(a);break;case 19:H(an);break;case 10:ri(a.type);break;case 22:case 23:Er(a),ap(),s!==null&&H(uo);break;case 24:ri(pn)}}function tu(s,a){try{var c=a.updateQueue,m=c!==null?c.lastEffect:null;if(m!==null){var b=m.next;c=b;do{if((c.tag&s)===s){m=void 0;var S=c.create,B=c.inst;m=S(),B.destroy=m}c=c.next}while(c!==b)}}catch(W){It(a,a.return,W)}}function Xi(s,a,c){try{var m=a.updateQueue,b=m!==null?m.lastEffect:null;if(b!==null){var S=b.next;m=S;do{if((m.tag&s)===s){var B=m.inst,W=B.destroy;if(W!==void 0){B.destroy=void 0,b=a;var se=c,pe=W;try{pe()}catch(Ee){It(b,se,Ee)}}}m=m.next}while(m!==S)}}catch(Ee){It(a,a.return,Ee)}}function Jb(s){var a=s.updateQueue;if(a!==null){var c=s.stateNode;try{$_(a,c)}catch(m){It(s,s.return,m)}}}function ev(s,a,c){c.props=go(s.type,s.memoizedProps),c.state=s.memoizedState;try{c.componentWillUnmount()}catch(m){It(s,a,m)}}function nu(s,a){try{var c=s.ref;if(c!==null){switch(s.tag){case 26:case 27:case 5:var m=s.stateNode;break;case 30:m=s.stateNode;break;default:m=s.stateNode}typeof c=="function"?s.refCleanup=c(m):c.current=m}}catch(b){It(s,a,b)}}function Ps(s,a){var c=s.ref,m=s.refCleanup;if(c!==null)if(typeof m=="function")try{m()}catch(b){It(s,a,b)}finally{s.refCleanup=null,s=s.alternate,s!=null&&(s.refCleanup=null)}else if(typeof c=="function")try{c(null)}catch(b){It(s,a,b)}else c.current=null}function tv(s){var a=s.type,c=s.memoizedProps,m=s.stateNode;try{e:switch(a){case"button":case"input":case"select":case"textarea":c.autoFocus&&m.focus();break e;case"img":c.src?m.src=c.src:c.srcSet&&(m.srcset=c.srcSet)}}catch(b){It(s,s.return,b)}}function zp(s,a,c){try{var m=s.stateNode;d2(m,s.type,c,a),m[In]=a}catch(b){It(s,s.return,b)}}function nv(s){return s.tag===5||s.tag===3||s.tag===26||s.tag===27&&sa(s.type)||s.tag===4}function Lp(s){e:for(;;){for(;s.sibling===null;){if(s.return===null||nv(s.return))return null;s=s.return}for(s.sibling.return=s.return,s=s.sibling;s.tag!==5&&s.tag!==6&&s.tag!==18;){if(s.tag===27&&sa(s.type)||s.flags&2||s.child===null||s.tag===4)continue e;s.child.return=s,s=s.child}if(!(s.flags&2))return s.stateNode}}function Up(s,a,c){var m=s.tag;if(m===5||m===6)s=s.stateNode,a?(c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c).insertBefore(s,a):(a=c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c,a.appendChild(s),c=c._reactRootContainer,c!=null||a.onclick!==null||(a.onclick=es));else if(m!==4&&(m===27&&sa(s.type)&&(c=s.stateNode,a=null),s=s.child,s!==null))for(Up(s,a,c),s=s.sibling;s!==null;)Up(s,a,c),s=s.sibling}function dh(s,a,c){var m=s.tag;if(m===5||m===6)s=s.stateNode,a?c.insertBefore(s,a):c.appendChild(s);else if(m!==4&&(m===27&&sa(s.type)&&(c=s.stateNode),s=s.child,s!==null))for(dh(s,a,c),s=s.sibling;s!==null;)dh(s,a,c),s=s.sibling}function rv(s){var a=s.stateNode,c=s.memoizedProps;try{for(var m=s.type,b=a.attributes;b.length;)a.removeAttributeNode(b[0]);Ln(a,m,c),a[hn]=s,a[In]=c}catch(S){It(s,s.return,S)}}var li=!1,_n=!1,Fp=!1,sv=typeof WeakSet=="function"?WeakSet:Set,Dn=null;function qA(s,a){if(s=s.containerInfo,lg=Dh,s=g_(s),Om(s)){if("selectionStart"in s)var c={start:s.selectionStart,end:s.selectionEnd};else e:{c=(c=s.ownerDocument)&&c.defaultView||window;var m=c.getSelection&&c.getSelection();if(m&&m.rangeCount!==0){c=m.anchorNode;var b=m.anchorOffset,S=m.focusNode;m=m.focusOffset;try{c.nodeType,S.nodeType}catch{c=null;break e}var B=0,W=-1,se=-1,pe=0,Ee=0,Ie=s,_e=null;t:for(;;){for(var xe;Ie!==c||b!==0&&Ie.nodeType!==3||(W=B+b),Ie!==S||m!==0&&Ie.nodeType!==3||(se=B+m),Ie.nodeType===3&&(B+=Ie.nodeValue.length),(xe=Ie.firstChild)!==null;)_e=Ie,Ie=xe;for(;;){if(Ie===s)break t;if(_e===c&&++pe===b&&(W=B),_e===S&&++Ee===m&&(se=B),(xe=Ie.nextSibling)!==null)break;Ie=_e,_e=Ie.parentNode}Ie=xe}c=W===-1||se===-1?null:{start:W,end:se}}else c=null}c=c||{start:0,end:0}}else c=null;for(cg={focusedElem:s,selectionRange:c},Dh=!1,Dn=a;Dn!==null;)if(a=Dn,s=a.child,(a.subtreeFlags&1028)!==0&&s!==null)s.return=a,Dn=s;else for(;Dn!==null;){switch(a=Dn,S=a.alternate,s=a.flags,a.tag){case 0:if((s&4)!==0&&(s=a.updateQueue,s=s!==null?s.events:null,s!==null))for(c=0;c<s.length;c++)b=s[c],b.ref.impl=b.nextImpl;break;case 11:case 15:break;case 1:if((s&1024)!==0&&S!==null){s=void 0,c=a,b=S.memoizedProps,S=S.memoizedState,m=c.stateNode;try{var Fe=go(c.type,b);s=m.getSnapshotBeforeUpdate(Fe,S),m.__reactInternalSnapshotBeforeUpdate=s}catch(Qe){It(c,c.return,Qe)}}break;case 3:if((s&1024)!==0){if(s=a.stateNode.containerInfo,c=s.nodeType,c===9)hg(s);else if(c===1)switch(s.nodeName){case"HEAD":case"HTML":case"BODY":hg(s);break;default:s.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((s&1024)!==0)throw Error(r(163))}if(s=a.sibling,s!==null){s.return=a.return,Dn=s;break}Dn=a.return}}function iv(s,a,c){var m=c.flags;switch(c.tag){case 0:case 11:case 15:ui(s,c),m&4&&tu(5,c);break;case 1:if(ui(s,c),m&4)if(s=c.stateNode,a===null)try{s.componentDidMount()}catch(B){It(c,c.return,B)}else{var b=go(c.type,a.memoizedProps);a=a.memoizedState;try{s.componentDidUpdate(b,a,s.__reactInternalSnapshotBeforeUpdate)}catch(B){It(c,c.return,B)}}m&64&&Jb(c),m&512&&nu(c,c.return);break;case 3:if(ui(s,c),m&64&&(s=c.updateQueue,s!==null)){if(a=null,c.child!==null)switch(c.child.tag){case 27:case 5:a=c.child.stateNode;break;case 1:a=c.child.stateNode}try{$_(s,a)}catch(B){It(c,c.return,B)}}break;case 27:a===null&&m&4&&rv(c);case 26:case 5:ui(s,c),a===null&&m&4&&tv(c),m&512&&nu(c,c.return);break;case 12:ui(s,c);break;case 31:ui(s,c),m&4&&lv(s,c);break;case 13:ui(s,c),m&4&&cv(s,c),m&64&&(s=c.memoizedState,s!==null&&(s=s.dehydrated,s!==null&&(c=JA.bind(null,c),b2(s,c))));break;case 22:if(m=c.memoizedState!==null||li,!m){a=a!==null&&a.memoizedState!==null||_n,b=li;var S=_n;li=m,(_n=a)&&!S?di(s,c,(c.subtreeFlags&8772)!==0):ui(s,c),li=b,_n=S}break;case 30:break;default:ui(s,c)}}function av(s){var a=s.alternate;a!==null&&(s.alternate=null,av(a)),s.child=null,s.deletions=null,s.sibling=null,s.tag===5&&(a=s.stateNode,a!==null&&Go(a)),s.stateNode=null,s.return=null,s.dependencies=null,s.memoizedProps=null,s.memoizedState=null,s.pendingProps=null,s.stateNode=null,s.updateQueue=null}var Kt=null,ur=!1;function ci(s,a,c){for(c=c.child;c!==null;)ov(s,a,c),c=c.sibling}function ov(s,a,c){if(tn&&typeof tn.onCommitFiberUnmount=="function")try{tn.onCommitFiberUnmount(vt,c)}catch{}switch(c.tag){case 26:_n||Ps(c,a),ci(s,a,c),c.memoizedState?c.memoizedState.count--:c.stateNode&&(c=c.stateNode,c.parentNode.removeChild(c));break;case 27:_n||Ps(c,a);var m=Kt,b=ur;sa(c.type)&&(Kt=c.stateNode,ur=!1),ci(s,a,c),du(c.stateNode),Kt=m,ur=b;break;case 5:_n||Ps(c,a);case 6:if(m=Kt,b=ur,Kt=null,ci(s,a,c),Kt=m,ur=b,Kt!==null)if(ur)try{(Kt.nodeType===9?Kt.body:Kt.nodeName==="HTML"?Kt.ownerDocument.body:Kt).removeChild(c.stateNode)}catch(S){It(c,a,S)}else try{Kt.removeChild(c.stateNode)}catch(S){It(c,a,S)}break;case 18:Kt!==null&&(ur?(s=Kt,Jv(s.nodeType===9?s.body:s.nodeName==="HTML"?s.ownerDocument.body:s,c.stateNode),Il(s)):Jv(Kt,c.stateNode));break;case 4:m=Kt,b=ur,Kt=c.stateNode.containerInfo,ur=!0,ci(s,a,c),Kt=m,ur=b;break;case 0:case 11:case 14:case 15:Xi(2,c,a),_n||Xi(4,c,a),ci(s,a,c);break;case 1:_n||(Ps(c,a),m=c.stateNode,typeof m.componentWillUnmount=="function"&&ev(c,a,m)),ci(s,a,c);break;case 21:ci(s,a,c);break;case 22:_n=(m=_n)||c.memoizedState!==null,ci(s,a,c),_n=m;break;default:ci(s,a,c)}}function lv(s,a){if(a.memoizedState===null&&(s=a.alternate,s!==null&&(s=s.memoizedState,s!==null))){s=s.dehydrated;try{Il(s)}catch(c){It(a,a.return,c)}}}function cv(s,a){if(a.memoizedState===null&&(s=a.alternate,s!==null&&(s=s.memoizedState,s!==null&&(s=s.dehydrated,s!==null))))try{Il(s)}catch(c){It(a,a.return,c)}}function HA(s){switch(s.tag){case 31:case 13:case 19:var a=s.stateNode;return a===null&&(a=s.stateNode=new sv),a;case 22:return s=s.stateNode,a=s._retryCache,a===null&&(a=s._retryCache=new sv),a;default:throw Error(r(435,s.tag))}}function hh(s,a){var c=HA(s);a.forEach(function(m){if(!c.has(m)){c.add(m);var b=e2.bind(null,s,m);m.then(b,b)}})}function dr(s,a){var c=a.deletions;if(c!==null)for(var m=0;m<c.length;m++){var b=c[m],S=s,B=a,W=B;e:for(;W!==null;){switch(W.tag){case 27:if(sa(W.type)){Kt=W.stateNode,ur=!1;break e}break;case 5:Kt=W.stateNode,ur=!1;break e;case 3:case 4:Kt=W.stateNode.containerInfo,ur=!0;break e}W=W.return}if(Kt===null)throw Error(r(160));ov(S,B,b),Kt=null,ur=!1,S=b.alternate,S!==null&&(S.return=null),b.return=null}if(a.subtreeFlags&13886)for(a=a.child;a!==null;)uv(a,s),a=a.sibling}var as=null;function uv(s,a){var c=s.alternate,m=s.flags;switch(s.tag){case 0:case 11:case 14:case 15:dr(a,s),hr(s),m&4&&(Xi(3,s,s.return),tu(3,s),Xi(5,s,s.return));break;case 1:dr(a,s),hr(s),m&512&&(_n||c===null||Ps(c,c.return)),m&64&&li&&(s=s.updateQueue,s!==null&&(m=s.callbacks,m!==null&&(c=s.shared.hiddenCallbacks,s.shared.hiddenCallbacks=c===null?m:c.concat(m))));break;case 26:var b=as;if(dr(a,s),hr(s),m&512&&(_n||c===null||Ps(c,c.return)),m&4){var S=c!==null?c.memoizedState:null;if(m=s.memoizedState,c===null)if(m===null)if(s.stateNode===null){e:{m=s.type,c=s.memoizedProps,b=b.ownerDocument||b;t:switch(m){case"title":S=b.getElementsByTagName("title")[0],(!S||S[ws]||S[hn]||S.namespaceURI==="http://www.w3.org/2000/svg"||S.hasAttribute("itemprop"))&&(S=b.createElement(m),b.head.insertBefore(S,b.querySelector("head > title"))),Ln(S,m,c),S[hn]=s,fn(S),m=S;break e;case"link":var B=ux("link","href",b).get(m+(c.href||""));if(B){for(var W=0;W<B.length;W++)if(S=B[W],S.getAttribute("href")===(c.href==null||c.href===""?null:c.href)&&S.getAttribute("rel")===(c.rel==null?null:c.rel)&&S.getAttribute("title")===(c.title==null?null:c.title)&&S.getAttribute("crossorigin")===(c.crossOrigin==null?null:c.crossOrigin)){B.splice(W,1);break t}}S=b.createElement(m),Ln(S,m,c),b.head.appendChild(S);break;case"meta":if(B=ux("meta","content",b).get(m+(c.content||""))){for(W=0;W<B.length;W++)if(S=B[W],S.getAttribute("content")===(c.content==null?null:""+c.content)&&S.getAttribute("name")===(c.name==null?null:c.name)&&S.getAttribute("property")===(c.property==null?null:c.property)&&S.getAttribute("http-equiv")===(c.httpEquiv==null?null:c.httpEquiv)&&S.getAttribute("charset")===(c.charSet==null?null:c.charSet)){B.splice(W,1);break t}}S=b.createElement(m),Ln(S,m,c),b.head.appendChild(S);break;default:throw Error(r(468,m))}S[hn]=s,fn(S),m=S}s.stateNode=m}else dx(b,s.type,s.stateNode);else s.stateNode=cx(b,m,s.memoizedProps);else S!==m?(S===null?c.stateNode!==null&&(c=c.stateNode,c.parentNode.removeChild(c)):S.count--,m===null?dx(b,s.type,s.stateNode):cx(b,m,s.memoizedProps)):m===null&&s.stateNode!==null&&zp(s,s.memoizedProps,c.memoizedProps)}break;case 27:dr(a,s),hr(s),m&512&&(_n||c===null||Ps(c,c.return)),c!==null&&m&4&&zp(s,s.memoizedProps,c.memoizedProps);break;case 5:if(dr(a,s),hr(s),m&512&&(_n||c===null||Ps(c,c.return)),s.flags&32){b=s.stateNode;try{cr(b,"")}catch(Fe){It(s,s.return,Fe)}}m&4&&s.stateNode!=null&&(b=s.memoizedProps,zp(s,b,c!==null?c.memoizedProps:b)),m&1024&&(Fp=!0);break;case 6:if(dr(a,s),hr(s),m&4){if(s.stateNode===null)throw Error(r(162));m=s.memoizedProps,c=s.stateNode;try{c.nodeValue=m}catch(Fe){It(s,s.return,Fe)}}break;case 3:if(jh=null,b=as,as=Th(a.containerInfo),dr(a,s),as=b,hr(s),m&4&&c!==null&&c.memoizedState.isDehydrated)try{Il(a.containerInfo)}catch(Fe){It(s,s.return,Fe)}Fp&&(Fp=!1,dv(s));break;case 4:m=as,as=Th(s.stateNode.containerInfo),dr(a,s),hr(s),as=m;break;case 12:dr(a,s),hr(s);break;case 31:dr(a,s),hr(s),m&4&&(m=s.updateQueue,m!==null&&(s.updateQueue=null,hh(s,m)));break;case 13:dr(a,s),hr(s),s.child.flags&8192&&s.memoizedState!==null!=(c!==null&&c.memoizedState!==null)&&(mh=Ne()),m&4&&(m=s.updateQueue,m!==null&&(s.updateQueue=null,hh(s,m)));break;case 22:b=s.memoizedState!==null;var se=c!==null&&c.memoizedState!==null,pe=li,Ee=_n;if(li=pe||b,_n=Ee||se,dr(a,s),_n=Ee,li=pe,hr(s),m&8192)e:for(a=s.stateNode,a._visibility=b?a._visibility&-2:a._visibility|1,b&&(c===null||se||li||_n||yo(s)),c=null,a=s;;){if(a.tag===5||a.tag===26){if(c===null){se=c=a;try{if(S=se.stateNode,b)B=S.style,typeof B.setProperty=="function"?B.setProperty("display","none","important"):B.display="none";else{W=se.stateNode;var Ie=se.memoizedProps.style,_e=Ie!=null&&Ie.hasOwnProperty("display")?Ie.display:null;W.style.display=_e==null||typeof _e=="boolean"?"":(""+_e).trim()}}catch(Fe){It(se,se.return,Fe)}}}else if(a.tag===6){if(c===null){se=a;try{se.stateNode.nodeValue=b?"":se.memoizedProps}catch(Fe){It(se,se.return,Fe)}}}else if(a.tag===18){if(c===null){se=a;try{var xe=se.stateNode;b?ex(xe,!0):ex(se.stateNode,!1)}catch(Fe){It(se,se.return,Fe)}}}else if((a.tag!==22&&a.tag!==23||a.memoizedState===null||a===s)&&a.child!==null){a.child.return=a,a=a.child;continue}if(a===s)break e;for(;a.sibling===null;){if(a.return===null||a.return===s)break e;c===a&&(c=null),a=a.return}c===a&&(c=null),a.sibling.return=a.return,a=a.sibling}m&4&&(m=s.updateQueue,m!==null&&(c=m.retryQueue,c!==null&&(m.retryQueue=null,hh(s,c))));break;case 19:dr(a,s),hr(s),m&4&&(m=s.updateQueue,m!==null&&(s.updateQueue=null,hh(s,m)));break;case 30:break;case 21:break;default:dr(a,s),hr(s)}}function hr(s){var a=s.flags;if(a&2){try{for(var c,m=s.return;m!==null;){if(nv(m)){c=m;break}m=m.return}if(c==null)throw Error(r(160));switch(c.tag){case 27:var b=c.stateNode,S=Lp(s);dh(s,S,b);break;case 5:var B=c.stateNode;c.flags&32&&(cr(B,""),c.flags&=-33);var W=Lp(s);dh(s,W,B);break;case 3:case 4:var se=c.stateNode.containerInfo,pe=Lp(s);Up(s,pe,se);break;default:throw Error(r(161))}}catch(Ee){It(s,s.return,Ee)}s.flags&=-3}a&4096&&(s.flags&=-4097)}function dv(s){if(s.subtreeFlags&1024)for(s=s.child;s!==null;){var a=s;dv(a),a.tag===5&&a.flags&1024&&a.stateNode.reset(),s=s.sibling}}function ui(s,a){if(a.subtreeFlags&8772)for(a=a.child;a!==null;)iv(s,a.alternate,a),a=a.sibling}function yo(s){for(s=s.child;s!==null;){var a=s;switch(a.tag){case 0:case 11:case 14:case 15:Xi(4,a,a.return),yo(a);break;case 1:Ps(a,a.return);var c=a.stateNode;typeof c.componentWillUnmount=="function"&&ev(a,a.return,c),yo(a);break;case 27:du(a.stateNode);case 26:case 5:Ps(a,a.return),yo(a);break;case 22:a.memoizedState===null&&yo(a);break;case 30:yo(a);break;default:yo(a)}s=s.sibling}}function di(s,a,c){for(c=c&&(a.subtreeFlags&8772)!==0,a=a.child;a!==null;){var m=a.alternate,b=s,S=a,B=S.flags;switch(S.tag){case 0:case 11:case 15:di(b,S,c),tu(4,S);break;case 1:if(di(b,S,c),m=S,b=m.stateNode,typeof b.componentDidMount=="function")try{b.componentDidMount()}catch(pe){It(m,m.return,pe)}if(m=S,b=m.updateQueue,b!==null){var W=m.stateNode;try{var se=b.shared.hiddenCallbacks;if(se!==null)for(b.shared.hiddenCallbacks=null,b=0;b<se.length;b++)V_(se[b],W)}catch(pe){It(m,m.return,pe)}}c&&B&64&&Jb(S),nu(S,S.return);break;case 27:rv(S);case 26:case 5:di(b,S,c),c&&m===null&&B&4&&tv(S),nu(S,S.return);break;case 12:di(b,S,c);break;case 31:di(b,S,c),c&&B&4&&lv(b,S);break;case 13:di(b,S,c),c&&B&4&&cv(b,S);break;case 22:S.memoizedState===null&&di(b,S,c),nu(S,S.return);break;case 30:break;default:di(b,S,c)}a=a.sibling}}function Vp(s,a){var c=null;s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(c=s.memoizedState.cachePool.pool),s=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(s=a.memoizedState.cachePool.pool),s!==c&&(s!=null&&s.refCount++,c!=null&&Vc(c))}function $p(s,a){s=null,a.alternate!==null&&(s=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==s&&(a.refCount++,s!=null&&Vc(s))}function os(s,a,c,m){if(a.subtreeFlags&10256)for(a=a.child;a!==null;)hv(s,a,c,m),a=a.sibling}function hv(s,a,c,m){var b=a.flags;switch(a.tag){case 0:case 11:case 15:os(s,a,c,m),b&2048&&tu(9,a);break;case 1:os(s,a,c,m);break;case 3:os(s,a,c,m),b&2048&&(s=null,a.alternate!==null&&(s=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==s&&(a.refCount++,s!=null&&Vc(s)));break;case 12:if(b&2048){os(s,a,c,m),s=a.stateNode;try{var S=a.memoizedProps,B=S.id,W=S.onPostCommit;typeof W=="function"&&W(B,a.alternate===null?"mount":"update",s.passiveEffectDuration,-0)}catch(se){It(a,a.return,se)}}else os(s,a,c,m);break;case 31:os(s,a,c,m);break;case 13:os(s,a,c,m);break;case 23:break;case 22:S=a.stateNode,B=a.alternate,a.memoizedState!==null?S._visibility&2?os(s,a,c,m):ru(s,a):S._visibility&2?os(s,a,c,m):(S._visibility|=2,bl(s,a,c,m,(a.subtreeFlags&10256)!==0||!1)),b&2048&&Vp(B,a);break;case 24:os(s,a,c,m),b&2048&&$p(a.alternate,a);break;default:os(s,a,c,m)}}function bl(s,a,c,m,b){for(b=b&&((a.subtreeFlags&10256)!==0||!1),a=a.child;a!==null;){var S=s,B=a,W=c,se=m,pe=B.flags;switch(B.tag){case 0:case 11:case 15:bl(S,B,W,se,b),tu(8,B);break;case 23:break;case 22:var Ee=B.stateNode;B.memoizedState!==null?Ee._visibility&2?bl(S,B,W,se,b):ru(S,B):(Ee._visibility|=2,bl(S,B,W,se,b)),b&&pe&2048&&Vp(B.alternate,B);break;case 24:bl(S,B,W,se,b),b&&pe&2048&&$p(B.alternate,B);break;default:bl(S,B,W,se,b)}a=a.sibling}}function ru(s,a){if(a.subtreeFlags&10256)for(a=a.child;a!==null;){var c=s,m=a,b=m.flags;switch(m.tag){case 22:ru(c,m),b&2048&&Vp(m.alternate,m);break;case 24:ru(c,m),b&2048&&$p(m.alternate,m);break;default:ru(c,m)}a=a.sibling}}var su=8192;function vl(s,a,c){if(s.subtreeFlags&su)for(s=s.child;s!==null;)fv(s,a,c),s=s.sibling}function fv(s,a,c){switch(s.tag){case 26:vl(s,a,c),s.flags&su&&s.memoizedState!==null&&k2(c,as,s.memoizedState,s.memoizedProps);break;case 5:vl(s,a,c);break;case 3:case 4:var m=as;as=Th(s.stateNode.containerInfo),vl(s,a,c),as=m;break;case 22:s.memoizedState===null&&(m=s.alternate,m!==null&&m.memoizedState!==null?(m=su,su=16777216,vl(s,a,c),su=m):vl(s,a,c));break;default:vl(s,a,c)}}function mv(s){var a=s.alternate;if(a!==null&&(s=a.child,s!==null)){a.child=null;do a=s.sibling,s.sibling=null,s=a;while(s!==null)}}function iu(s){var a=s.deletions;if((s.flags&16)!==0){if(a!==null)for(var c=0;c<a.length;c++){var m=a[c];Dn=m,gv(m,s)}mv(s)}if(s.subtreeFlags&10256)for(s=s.child;s!==null;)pv(s),s=s.sibling}function pv(s){switch(s.tag){case 0:case 11:case 15:iu(s),s.flags&2048&&Xi(9,s,s.return);break;case 3:iu(s);break;case 12:iu(s);break;case 22:var a=s.stateNode;s.memoizedState!==null&&a._visibility&2&&(s.return===null||s.return.tag!==13)?(a._visibility&=-3,fh(s)):iu(s);break;default:iu(s)}}function fh(s){var a=s.deletions;if((s.flags&16)!==0){if(a!==null)for(var c=0;c<a.length;c++){var m=a[c];Dn=m,gv(m,s)}mv(s)}for(s=s.child;s!==null;){switch(a=s,a.tag){case 0:case 11:case 15:Xi(8,a,a.return),fh(a);break;case 22:c=a.stateNode,c._visibility&2&&(c._visibility&=-3,fh(a));break;default:fh(a)}s=s.sibling}}function gv(s,a){for(;Dn!==null;){var c=Dn;switch(c.tag){case 0:case 11:case 15:Xi(8,c,a);break;case 23:case 22:if(c.memoizedState!==null&&c.memoizedState.cachePool!==null){var m=c.memoizedState.cachePool.pool;m!=null&&m.refCount++}break;case 24:Vc(c.memoizedState.cache)}if(m=c.child,m!==null)m.return=c,Dn=m;else e:for(c=s;Dn!==null;){m=Dn;var b=m.sibling,S=m.return;if(av(m),m===c){Dn=null;break e}if(b!==null){b.return=S,Dn=b;break e}Dn=S}}}var GA={getCacheForType:function(s){var a=Bn(pn),c=a.data.get(s);return c===void 0&&(c=s(),a.data.set(s,c)),c},cacheSignal:function(){return Bn(pn).controller.signal}},WA=typeof WeakMap=="function"?WeakMap:Map,Tt=0,zt=null,ut=null,ft=0,Rt=0,Tr=null,Zi=!1,xl=!1,qp=!1,hi=0,rn=0,Ji=0,_o=0,Hp=0,Ar=0,wl=0,au=null,fr=null,Gp=!1,mh=0,yv=0,ph=1/0,gh=null,ea=null,Sn=0,ta=null,Sl=null,fi=0,Wp=0,Qp=null,_v=null,ou=0,Kp=null;function jr(){return(Tt&2)!==0&&ft!==0?ft&-ft:Y.T!==null?tg():yd()}function bv(){if(Ar===0)if((ft&536870912)===0||_t){var s=_s;_s<<=1,(_s&3932160)===0&&(_s=262144),Ar=s}else Ar=536870912;return s=Cr.current,s!==null&&(s.flags|=32),Ar}function mr(s,a,c){(s===zt&&(Rt===2||Rt===9)||s.cancelPendingCommit!==null)&&(Cl(s,0),na(s,ft,Ar,!1)),Ha(s,c),((Tt&2)===0||s!==zt)&&(s===zt&&((Tt&2)===0&&(_o|=c),rn===4&&na(s,ft,Ar,!1)),Bs(s))}function vv(s,a,c){if((Tt&6)!==0)throw Error(r(327));var m=!c&&(a&127)===0&&(a&s.expiredLanes)===0||Xr(s,a),b=m?YA(s,a):Xp(s,a,!0),S=m;do{if(b===0){xl&&!m&&na(s,a,0,!1);break}else{if(c=s.current.alternate,S&&!QA(c)){b=Xp(s,a,!1),S=!1;continue}if(b===2){if(S=a,s.errorRecoveryDisabledLanes&S)var B=0;else B=s.pendingLanes&-536870913,B=B!==0?B:B&536870912?536870912:0;if(B!==0){a=B;e:{var W=s;b=au;var se=W.current.memoizedState.isDehydrated;if(se&&(Cl(W,B).flags|=256),B=Xp(W,B,!1),B!==2){if(qp&&!se){W.errorRecoveryDisabledLanes|=S,_o|=S,b=4;break e}S=fr,fr=b,S!==null&&(fr===null?fr=S:fr.push.apply(fr,S))}b=B}if(S=!1,b!==2)continue}}if(b===1){Cl(s,0),na(s,a,0,!0);break}e:{switch(m=s,S=b,S){case 0:case 1:throw Error(r(345));case 4:if((a&4194048)!==a)break;case 6:na(m,a,Ar,!Zi);break e;case 2:fr=null;break;case 3:case 5:break;default:throw Error(r(329))}if((a&62914560)===a&&(b=mh+300-Ne(),10<b)){if(na(m,a,Ar,!Zi),bs(m,0,!0)!==0)break e;fi=a,m.timeoutHandle=Xv(xv.bind(null,m,c,fr,gh,Gp,a,Ar,_o,wl,Zi,S,"Throttled",-0,0),b);break e}xv(m,c,fr,gh,Gp,a,Ar,_o,wl,Zi,S,null,-0,0)}}break}while(!0);Bs(s)}function xv(s,a,c,m,b,S,B,W,se,pe,Ee,Ie,_e,xe){if(s.timeoutHandle=-1,Ie=a.subtreeFlags,Ie&8192||(Ie&16785408)===16785408){Ie={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:es},fv(a,S,Ie);var Fe=(S&62914560)===S?mh-Ne():(S&4194048)===S?yv-Ne():0;if(Fe=D2(Ie,Fe),Fe!==null){fi=S,s.cancelPendingCommit=Fe(Rv.bind(null,s,a,S,c,m,b,B,W,se,Ee,Ie,null,_e,xe)),na(s,S,B,!pe);return}}Rv(s,a,S,c,m,b,B,W,se)}function QA(s){for(var a=s;;){var c=a.tag;if((c===0||c===11||c===15)&&a.flags&16384&&(c=a.updateQueue,c!==null&&(c=c.stores,c!==null)))for(var m=0;m<c.length;m++){var b=c[m],S=b.getSnapshot;b=b.value;try{if(!wr(S(),b))return!1}catch{return!1}}if(c=a.child,a.subtreeFlags&16384&&c!==null)c.return=a,a=c;else{if(a===s)break;for(;a.sibling===null;){if(a.return===null||a.return===s)return!0;a=a.return}a.sibling.return=a.return,a=a.sibling}}return!0}function na(s,a,c,m){a&=~Hp,a&=~_o,s.suspendedLanes|=a,s.pingedLanes&=~a,m&&(s.warmLanes|=a),m=s.expirationTimes;for(var b=a;0<b;){var S=31-Ct(b),B=1<<S;m[S]=-1,b&=~B}c!==0&&Ga(s,c,a)}function yh(){return(Tt&6)===0?(lu(0),!1):!0}function Yp(){if(ut!==null){if(Rt===0)var s=ut.return;else s=ut,ni=lo=null,hp(s),ml=null,qc=0,s=ut;for(;s!==null;)Zb(s.alternate,s),s=s.return;ut=null}}function Cl(s,a){var c=s.timeoutHandle;c!==-1&&(s.timeoutHandle=-1,m2(c)),c=s.cancelPendingCommit,c!==null&&(s.cancelPendingCommit=null,c()),fi=0,Yp(),zt=s,ut=c=ei(s.current,null),ft=a,Rt=0,Tr=null,Zi=!1,xl=Xr(s,a),qp=!1,wl=Ar=Hp=_o=Ji=rn=0,fr=au=null,Gp=!1,(a&8)!==0&&(a|=a&32);var m=s.entangledLanes;if(m!==0)for(s=s.entanglements,m&=a;0<m;){var b=31-Ct(m),S=1<<b;a|=s[b],m&=~S}return hi=a,zd(),c}function wv(s,a){at=null,Y.H=Zc,a===fl||a===Gd?(a=z_(),Rt=3):a===ep?(a=z_(),Rt=4):Rt=a===jp?8:a!==null&&typeof a=="object"&&typeof a.then=="function"?6:1,Tr=a,ut===null&&(rn=1,ah(s,Lr(a,s.current)))}function Sv(){var s=Cr.current;return s===null?!0:(ft&4194048)===ft?$r===null:(ft&62914560)===ft||(ft&536870912)!==0?s===$r:!1}function Cv(){var s=Y.H;return Y.H=Zc,s===null?Zc:s}function Ev(){var s=Y.A;return Y.A=GA,s}function _h(){rn=4,Zi||(ft&4194048)!==ft&&Cr.current!==null||(xl=!0),(Ji&134217727)===0&&(_o&134217727)===0||zt===null||na(zt,ft,Ar,!1)}function Xp(s,a,c){var m=Tt;Tt|=2;var b=Cv(),S=Ev();(zt!==s||ft!==a)&&(gh=null,Cl(s,a)),a=!1;var B=rn;e:do try{if(Rt!==0&&ut!==null){var W=ut,se=Tr;switch(Rt){case 8:Yp(),B=6;break e;case 3:case 2:case 9:case 6:Cr.current===null&&(a=!0);var pe=Rt;if(Rt=0,Tr=null,El(s,W,se,pe),c&&xl){B=0;break e}break;default:pe=Rt,Rt=0,Tr=null,El(s,W,se,pe)}}KA(),B=rn;break}catch(Ee){wv(s,Ee)}while(!0);return a&&s.shellSuspendCounter++,ni=lo=null,Tt=m,Y.H=b,Y.A=S,ut===null&&(zt=null,ft=0,zd()),B}function KA(){for(;ut!==null;)Tv(ut)}function YA(s,a){var c=Tt;Tt|=2;var m=Cv(),b=Ev();zt!==s||ft!==a?(gh=null,ph=Ne()+500,Cl(s,a)):xl=Xr(s,a);e:do try{if(Rt!==0&&ut!==null){a=ut;var S=Tr;t:switch(Rt){case 1:Rt=0,Tr=null,El(s,a,S,1);break;case 2:case 9:if(P_(S)){Rt=0,Tr=null,Av(a);break}a=function(){Rt!==2&&Rt!==9||zt!==s||(Rt=7),Bs(s)},S.then(a,a);break e;case 3:Rt=7;break e;case 4:Rt=5;break e;case 7:P_(S)?(Rt=0,Tr=null,Av(a)):(Rt=0,Tr=null,El(s,a,S,7));break;case 5:var B=null;switch(ut.tag){case 26:B=ut.memoizedState;case 5:case 27:var W=ut;if(B?hx(B):W.stateNode.complete){Rt=0,Tr=null;var se=W.sibling;if(se!==null)ut=se;else{var pe=W.return;pe!==null?(ut=pe,bh(pe)):ut=null}break t}}Rt=0,Tr=null,El(s,a,S,5);break;case 6:Rt=0,Tr=null,El(s,a,S,6);break;case 8:Yp(),rn=6;break e;default:throw Error(r(462))}}XA();break}catch(Ee){wv(s,Ee)}while(!0);return ni=lo=null,Y.H=m,Y.A=b,Tt=c,ut!==null?0:(zt=null,ft=0,zd(),rn)}function XA(){for(;ut!==null&&!ae();)Tv(ut)}function Tv(s){var a=Yb(s.alternate,s,hi);s.memoizedProps=s.pendingProps,a===null?bh(s):ut=a}function Av(s){var a=s,c=a.alternate;switch(a.tag){case 15:case 0:a=qb(c,a,a.pendingProps,a.type,void 0,ft);break;case 11:a=qb(c,a,a.pendingProps,a.type.render,a.ref,ft);break;case 5:hp(a);default:Zb(c,a),a=ut=E_(a,hi),a=Yb(c,a,hi)}s.memoizedProps=s.pendingProps,a===null?bh(s):ut=a}function El(s,a,c,m){ni=lo=null,hp(a),ml=null,qc=0;var b=a.return;try{if(LA(s,b,a,c,ft)){rn=1,ah(s,Lr(c,s.current)),ut=null;return}}catch(S){if(b!==null)throw ut=b,S;rn=1,ah(s,Lr(c,s.current)),ut=null;return}a.flags&32768?(_t||m===1?s=!0:xl||(ft&536870912)!==0?s=!1:(Zi=s=!0,(m===2||m===9||m===3||m===6)&&(m=Cr.current,m!==null&&m.tag===13&&(m.flags|=16384))),jv(a,s)):bh(a)}function bh(s){var a=s;do{if((a.flags&32768)!==0){jv(a,Zi);return}s=a.return;var c=VA(a.alternate,a,hi);if(c!==null){ut=c;return}if(a=a.sibling,a!==null){ut=a;return}ut=a=s}while(a!==null);rn===0&&(rn=5)}function jv(s,a){do{var c=$A(s.alternate,s);if(c!==null){c.flags&=32767,ut=c;return}if(c=s.return,c!==null&&(c.flags|=32768,c.subtreeFlags=0,c.deletions=null),!a&&(s=s.sibling,s!==null)){ut=s;return}ut=s=c}while(s!==null);rn=6,ut=null}function Rv(s,a,c,m,b,S,B,W,se){s.cancelPendingCommit=null;do vh();while(Sn!==0);if((Tt&6)!==0)throw Error(r(327));if(a!==null){if(a===s.current)throw Error(r(177));if(S=a.lanes|a.childLanes,S|=Lm,Im(s,c,S,B,W,se),s===zt&&(ut=zt=null,ft=0),Sl=a,ta=s,fi=c,Wp=S,Qp=b,_v=m,(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?(s.callbackNode=null,s.callbackPriority=0,t2(rt,function(){return Ov(),null})):(s.callbackNode=null,s.callbackPriority=0),m=(a.flags&13878)!==0,(a.subtreeFlags&13878)!==0||m){m=Y.T,Y.T=null,b=G.p,G.p=2,B=Tt,Tt|=4;try{qA(s,a,c)}finally{Tt=B,G.p=b,Y.T=m}}Sn=1,Iv(),kv(),Dv()}}function Iv(){if(Sn===1){Sn=0;var s=ta,a=Sl,c=(a.flags&13878)!==0;if((a.subtreeFlags&13878)!==0||c){c=Y.T,Y.T=null;var m=G.p;G.p=2;var b=Tt;Tt|=4;try{uv(a,s);var S=cg,B=g_(s.containerInfo),W=S.focusedElem,se=S.selectionRange;if(B!==W&&W&&W.ownerDocument&&p_(W.ownerDocument.documentElement,W)){if(se!==null&&Om(W)){var pe=se.start,Ee=se.end;if(Ee===void 0&&(Ee=pe),"selectionStart"in W)W.selectionStart=pe,W.selectionEnd=Math.min(Ee,W.value.length);else{var Ie=W.ownerDocument||document,_e=Ie&&Ie.defaultView||window;if(_e.getSelection){var xe=_e.getSelection(),Fe=W.textContent.length,Qe=Math.min(se.start,Fe),Ot=se.end===void 0?Qe:Math.min(se.end,Fe);!xe.extend&&Qe>Ot&&(B=Ot,Ot=Qe,Qe=B);var ue=m_(W,Qe),le=m_(W,Ot);if(ue&&le&&(xe.rangeCount!==1||xe.anchorNode!==ue.node||xe.anchorOffset!==ue.offset||xe.focusNode!==le.node||xe.focusOffset!==le.offset)){var me=Ie.createRange();me.setStart(ue.node,ue.offset),xe.removeAllRanges(),Qe>Ot?(xe.addRange(me),xe.extend(le.node,le.offset)):(me.setEnd(le.node,le.offset),xe.addRange(me))}}}}for(Ie=[],xe=W;xe=xe.parentNode;)xe.nodeType===1&&Ie.push({element:xe,left:xe.scrollLeft,top:xe.scrollTop});for(typeof W.focus=="function"&&W.focus(),W=0;W<Ie.length;W++){var Ae=Ie[W];Ae.element.scrollLeft=Ae.left,Ae.element.scrollTop=Ae.top}}Dh=!!lg,cg=lg=null}finally{Tt=b,G.p=m,Y.T=c}}s.current=a,Sn=2}}function kv(){if(Sn===2){Sn=0;var s=ta,a=Sl,c=(a.flags&8772)!==0;if((a.subtreeFlags&8772)!==0||c){c=Y.T,Y.T=null;var m=G.p;G.p=2;var b=Tt;Tt|=4;try{iv(s,a.alternate,a)}finally{Tt=b,G.p=m,Y.T=c}}Sn=3}}function Dv(){if(Sn===4||Sn===3){Sn=0,je();var s=ta,a=Sl,c=fi,m=_v;(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?Sn=5:(Sn=0,Sl=ta=null,Mv(s,s.pendingLanes));var b=s.pendingLanes;if(b===0&&(ea=null),Ys(c),a=a.stateNode,tn&&typeof tn.onCommitFiberRoot=="function")try{tn.onCommitFiberRoot(vt,a,void 0,(a.current.flags&128)===128)}catch{}if(m!==null){a=Y.T,b=G.p,G.p=2,Y.T=null;try{for(var S=s.onRecoverableError,B=0;B<m.length;B++){var W=m[B];S(W.value,{componentStack:W.stack})}}finally{Y.T=a,G.p=b}}(fi&3)!==0&&vh(),Bs(s),b=s.pendingLanes,(c&261930)!==0&&(b&42)!==0?s===Kp?ou++:(ou=0,Kp=s):ou=0,lu(0)}}function Mv(s,a){(s.pooledCacheLanes&=a)===0&&(a=s.pooledCache,a!=null&&(s.pooledCache=null,Vc(a)))}function vh(){return Iv(),kv(),Dv(),Ov()}function Ov(){if(Sn!==5)return!1;var s=ta,a=Wp;Wp=0;var c=Ys(fi),m=Y.T,b=G.p;try{G.p=32>c?32:c,Y.T=null,c=Qp,Qp=null;var S=ta,B=fi;if(Sn=0,Sl=ta=null,fi=0,(Tt&6)!==0)throw Error(r(331));var W=Tt;if(Tt|=4,pv(S.current),hv(S,S.current,B,c),Tt=W,lu(0,!1),tn&&typeof tn.onPostCommitFiberRoot=="function")try{tn.onPostCommitFiberRoot(vt,S)}catch{}return!0}finally{G.p=b,Y.T=m,Mv(s,a)}}function Nv(s,a,c){a=Lr(c,a),a=Ap(s.stateNode,a,2),s=Qi(s,a,2),s!==null&&(Ha(s,2),Bs(s))}function It(s,a,c){if(s.tag===3)Nv(s,s,c);else for(;a!==null;){if(a.tag===3){Nv(a,s,c);break}else if(a.tag===1){var m=a.stateNode;if(typeof a.type.getDerivedStateFromError=="function"||typeof m.componentDidCatch=="function"&&(ea===null||!ea.has(m))){s=Lr(c,s),c=Pb(2),m=Qi(a,c,2),m!==null&&(Bb(c,m,a,s),Ha(m,2),Bs(m));break}}a=a.return}}function Zp(s,a,c){var m=s.pingCache;if(m===null){m=s.pingCache=new WA;var b=new Set;m.set(a,b)}else b=m.get(a),b===void 0&&(b=new Set,m.set(a,b));b.has(c)||(qp=!0,b.add(c),s=ZA.bind(null,s,a,c),a.then(s,s))}function ZA(s,a,c){var m=s.pingCache;m!==null&&m.delete(a),s.pingedLanes|=s.suspendedLanes&c,s.warmLanes&=~c,zt===s&&(ft&c)===c&&(rn===4||rn===3&&(ft&62914560)===ft&&300>Ne()-mh?(Tt&2)===0&&Cl(s,0):Hp|=c,wl===ft&&(wl=0)),Bs(s)}function Pv(s,a){a===0&&(a=gd()),s=io(s,a),s!==null&&(Ha(s,a),Bs(s))}function JA(s){var a=s.memoizedState,c=0;a!==null&&(c=a.retryLane),Pv(s,c)}function e2(s,a){var c=0;switch(s.tag){case 31:case 13:var m=s.stateNode,b=s.memoizedState;b!==null&&(c=b.retryLane);break;case 19:m=s.stateNode;break;case 22:m=s.stateNode._retryCache;break;default:throw Error(r(314))}m!==null&&m.delete(a),Pv(s,c)}function t2(s,a){return Se(s,a)}var xh=null,Tl=null,Jp=!1,wh=!1,eg=!1,ra=0;function Bs(s){s!==Tl&&s.next===null&&(Tl===null?xh=Tl=s:Tl=Tl.next=s),wh=!0,Jp||(Jp=!0,r2())}function lu(s,a){if(!eg&&wh){eg=!0;do for(var c=!1,m=xh;m!==null;){if(s!==0){var b=m.pendingLanes;if(b===0)var S=0;else{var B=m.suspendedLanes,W=m.pingedLanes;S=(1<<31-Ct(42|s)+1)-1,S&=b&~(B&~W),S=S&201326741?S&201326741|1:S?S|2:0}S!==0&&(c=!0,Uv(m,S))}else S=ft,S=bs(m,m===zt?S:0,m.cancelPendingCommit!==null||m.timeoutHandle!==-1),(S&3)===0||Xr(m,S)||(c=!0,Uv(m,S));m=m.next}while(c);eg=!1}}function n2(){Bv()}function Bv(){wh=Jp=!1;var s=0;ra!==0&&f2()&&(s=ra);for(var a=Ne(),c=null,m=xh;m!==null;){var b=m.next,S=zv(m,a);S===0?(m.next=null,c===null?xh=b:c.next=b,b===null&&(Tl=c)):(c=m,(s!==0||(S&3)!==0)&&(wh=!0)),m=b}Sn!==0&&Sn!==5||lu(s),ra!==0&&(ra=0)}function zv(s,a){for(var c=s.suspendedLanes,m=s.pingedLanes,b=s.expirationTimes,S=s.pendingLanes&-62914561;0<S;){var B=31-Ct(S),W=1<<B,se=b[B];se===-1?((W&c)===0||(W&m)!==0)&&(b[B]=Rm(W,a)):se<=a&&(s.expiredLanes|=W),S&=~W}if(a=zt,c=ft,c=bs(s,s===a?c:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),m=s.callbackNode,c===0||s===a&&(Rt===2||Rt===9)||s.cancelPendingCommit!==null)return m!==null&&m!==null&&we(m),s.callbackNode=null,s.callbackPriority=0;if((c&3)===0||Xr(s,c)){if(a=c&-c,a===s.callbackPriority)return a;switch(m!==null&&we(m),Ys(c)){case 2:case 8:c=xt;break;case 32:c=rt;break;case 268435456:c=gs;break;default:c=rt}return m=Lv.bind(null,s),c=Se(c,m),s.callbackPriority=a,s.callbackNode=c,a}return m!==null&&m!==null&&we(m),s.callbackPriority=2,s.callbackNode=null,2}function Lv(s,a){if(Sn!==0&&Sn!==5)return s.callbackNode=null,s.callbackPriority=0,null;var c=s.callbackNode;if(vh()&&s.callbackNode!==c)return null;var m=ft;return m=bs(s,s===zt?m:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),m===0?null:(vv(s,m,a),zv(s,Ne()),s.callbackNode!=null&&s.callbackNode===c?Lv.bind(null,s):null)}function Uv(s,a){if(vh())return null;vv(s,a,!0)}function r2(){p2(function(){(Tt&6)!==0?Se(qe,n2):Bv()})}function tg(){if(ra===0){var s=dl;s===0&&(s=Mr,Mr<<=1,(Mr&261888)===0&&(Mr=256)),ra=s}return ra}function Fv(s){return s==null||typeof s=="symbol"||typeof s=="boolean"?null:typeof s=="function"?s:Yo(""+s)}function Vv(s,a){var c=a.ownerDocument.createElement("input");return c.name=a.name,c.value=a.value,s.id&&c.setAttribute("form",s.id),a.parentNode.insertBefore(c,a),s=new FormData(s),c.parentNode.removeChild(c),s}function s2(s,a,c,m,b){if(a==="submit"&&c&&c.stateNode===b){var S=Fv((b[In]||null).action),B=m.submitter;B&&(a=(a=B[In]||null)?Fv(a.formAction):B.getAttribute("formAction"),a!==null&&(S=a,B=null));var W=new Is("action","action",null,m,b);s.push({event:W,listeners:[{instance:null,listener:function(){if(m.defaultPrevented){if(ra!==0){var se=B?Vv(b,B):new FormData(b);xp(c,{pending:!0,data:se,method:b.method,action:S},null,se)}}else typeof S=="function"&&(W.preventDefault(),se=B?Vv(b,B):new FormData(b),xp(c,{pending:!0,data:se,method:b.method,action:S},S,se))},currentTarget:b}]})}}for(var ng=0;ng<zm.length;ng++){var rg=zm[ng],i2=rg.toLowerCase(),a2=rg[0].toUpperCase()+rg.slice(1);is(i2,"on"+a2)}is(b_,"onAnimationEnd"),is(v_,"onAnimationIteration"),is(x_,"onAnimationStart"),is("dblclick","onDoubleClick"),is("focusin","onFocus"),is("focusout","onBlur"),is(wA,"onTransitionRun"),is(SA,"onTransitionStart"),is(CA,"onTransitionCancel"),is(w_,"onTransitionEnd"),Ts("onMouseEnter",["mouseout","mouseover"]),Ts("onMouseLeave",["mouseout","mouseover"]),Ts("onPointerEnter",["pointerout","pointerover"]),Ts("onPointerLeave",["pointerout","pointerover"]),Es("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Es("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Es("onBeforeInput",["compositionend","keypress","textInput","paste"]),Es("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Es("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Es("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var cu="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),o2=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(cu));function $v(s,a){a=(a&4)!==0;for(var c=0;c<s.length;c++){var m=s[c],b=m.event;m=m.listeners;e:{var S=void 0;if(a)for(var B=m.length-1;0<=B;B--){var W=m[B],se=W.instance,pe=W.currentTarget;if(W=W.listener,se!==S&&b.isPropagationStopped())break e;S=W,b.currentTarget=pe;try{S(b)}catch(Ee){Bd(Ee)}b.currentTarget=null,S=se}else for(B=0;B<m.length;B++){if(W=m[B],se=W.instance,pe=W.currentTarget,W=W.listener,se!==S&&b.isPropagationStopped())break e;S=W,b.currentTarget=pe;try{S(b)}catch(Ee){Bd(Ee)}b.currentTarget=null,S=se}}}}function dt(s,a){var c=a[Ho];c===void 0&&(c=a[Ho]=new Set);var m=s+"__bubble";c.has(m)||(qv(a,s,2,!1),c.add(m))}function sg(s,a,c){var m=0;a&&(m|=4),qv(c,s,m,a)}var Sh="_reactListening"+Math.random().toString(36).slice(2);function ig(s){if(!s[Sh]){s[Sh]=!0,xc.forEach(function(c){c!=="selectionchange"&&(o2.has(c)||sg(c,!1,s),sg(c,!0,s))});var a=s.nodeType===9?s:s.ownerDocument;a===null||a[Sh]||(a[Sh]=!0,sg("selectionchange",!1,a))}}function qv(s,a,c,m){switch(bx(a)){case 2:var b=N2;break;case 8:b=P2;break;default:b=vg}c=b.bind(null,a,c,s),b=void 0,!Xa||a!=="touchstart"&&a!=="touchmove"&&a!=="wheel"||(b=!0),m?b!==void 0?s.addEventListener(a,c,{capture:!0,passive:b}):s.addEventListener(a,c,!0):b!==void 0?s.addEventListener(a,c,{passive:b}):s.addEventListener(a,c,!1)}function ag(s,a,c,m,b){var S=m;if((a&1)===0&&(a&2)===0&&m!==null)e:for(;;){if(m===null)return;var B=m.tag;if(B===3||B===4){var W=m.stateNode.containerInfo;if(W===b)break;if(B===4)for(B=m.return;B!==null;){var se=B.tag;if((se===3||se===4)&&B.stateNode.containerInfo===b)return;B=B.return}for(;W!==null;){if(B=Ss(W),B===null)return;if(se=B.tag,se===5||se===6||se===26||se===27){m=S=B;continue e}W=W.parentNode}}m=m.return}zi(function(){var pe=S,Ee=Nr(c),Ie=[];e:{var _e=S_.get(s);if(_e!==void 0){var xe=Is,Fe=s;switch(s){case"keypress":if(Ja(c)===0)break e;case"keydown":case"keyup":xe=Od;break;case"focusin":Fe="focus",xe=to;break;case"focusout":Fe="blur",xe=to;break;case"beforeblur":case"afterblur":xe=to;break;case"click":if(c.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":xe=Oc;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":xe=Ed;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":xe=j;break;case b_:case v_:case x_:xe=Ad;break;case w_:xe=K;break;case"scroll":case"scrollend":xe=Mc;break;case"wheel":xe=ve;break;case"copy":case"cut":case"paste":xe=jd;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":xe=Js;break;case"toggle":case"beforetoggle":xe=it}var Qe=(a&4)!==0,Ot=!Qe&&(s==="scroll"||s==="scrollend"),ue=Qe?_e!==null?_e+"Capture":null:_e;Qe=[];for(var le=pe,me;le!==null;){var Ae=le;if(me=Ae.stateNode,Ae=Ae.tag,Ae!==5&&Ae!==26&&Ae!==27||me===null||ue===null||(Ae=ts(le,ue),Ae!=null&&Qe.push(uu(le,Ae,me))),Ot)break;le=le.return}0<Qe.length&&(_e=new xe(_e,Fe,null,c,Ee),Ie.push({event:_e,listeners:Qe}))}}if((a&7)===0){e:{if(_e=s==="mouseover"||s==="pointerover",xe=s==="mouseout"||s==="pointerout",_e&&c!==Ic&&(Fe=c.relatedTarget||c.fromElement)&&(Ss(Fe)||Fe[xs]))break e;if((xe||_e)&&(_e=Ee.window===Ee?Ee:(_e=Ee.ownerDocument)?_e.defaultView||_e.parentWindow:window,xe?(Fe=c.relatedTarget||c.toElement,xe=pe,Fe=Fe?Ss(Fe):null,Fe!==null&&(Ot=o(Fe),Qe=Fe.tag,Fe!==Ot||Qe!==5&&Qe!==27&&Qe!==6)&&(Fe=null)):(xe=null,Fe=pe),xe!==Fe)){if(Qe=Oc,Ae="onMouseLeave",ue="onMouseEnter",le="mouse",(s==="pointerout"||s==="pointerover")&&(Qe=Js,Ae="onPointerLeave",ue="onPointerEnter",le="pointer"),Ot=xe==null?_e:vr(xe),me=Fe==null?_e:vr(Fe),_e=new Qe(Ae,le+"leave",xe,c,Ee),_e.target=Ot,_e.relatedTarget=me,Ae=null,Ss(Ee)===pe&&(Qe=new Qe(ue,le+"enter",Fe,c,Ee),Qe.target=me,Qe.relatedTarget=Ot,Ae=Qe),Ot=Ae,xe&&Fe)t:{for(Qe=l2,ue=xe,le=Fe,me=0,Ae=ue;Ae;Ae=Qe(Ae))me++;Ae=0;for(var He=le;He;He=Qe(He))Ae++;for(;0<me-Ae;)ue=Qe(ue),me--;for(;0<Ae-me;)le=Qe(le),Ae--;for(;me--;){if(ue===le||le!==null&&ue===le.alternate){Qe=ue;break t}ue=Qe(ue),le=Qe(le)}Qe=null}else Qe=null;xe!==null&&Hv(Ie,_e,xe,Qe,!1),Fe!==null&&Ot!==null&&Hv(Ie,Ot,Fe,Qe,!0)}}e:{if(_e=pe?vr(pe):window,xe=_e.nodeName&&_e.nodeName.toLowerCase(),xe==="select"||xe==="input"&&_e.type==="file")var wt=l_;else if(a_(_e))if(c_)wt=bA;else{wt=yA;var $e=gA}else xe=_e.nodeName,!xe||xe.toLowerCase()!=="input"||_e.type!=="checkbox"&&_e.type!=="radio"?pe&&Ko(pe.elementType)&&(wt=l_):wt=_A;if(wt&&(wt=wt(s,pe))){o_(Ie,wt,c,Ee);break e}$e&&$e(s,_e,pe),s==="focusout"&&pe&&_e.type==="number"&&pe.memoizedProps.value!=null&&Ac(_e,"number",_e.value)}switch($e=pe?vr(pe):window,s){case"focusin":(a_($e)||$e.contentEditable==="true")&&(rl=$e,Nm=pe,Lc=null);break;case"focusout":Lc=Nm=rl=null;break;case"mousedown":Pm=!0;break;case"contextmenu":case"mouseup":case"dragend":Pm=!1,y_(Ie,c,Ee);break;case"selectionchange":if(xA)break;case"keydown":case"keyup":y_(Ie,c,Ee)}var lt;if(Et)e:{switch(s){case"compositionstart":var mt="onCompositionStart";break e;case"compositionend":mt="onCompositionEnd";break e;case"compositionupdate":mt="onCompositionUpdate";break e}mt=void 0}else nl?no(s,c)&&(mt="onCompositionEnd"):s==="keydown"&&c.keyCode===229&&(mt="onCompositionStart");mt&&(Ms&&c.locale!=="ko"&&(nl||mt!=="onCompositionStart"?mt==="onCompositionEnd"&&nl&&(lt=Dc()):(Rs=Ee,kc="value"in Rs?Rs.value:Rs.textContent,nl=!0)),$e=Ch(pe,mt),0<$e.length&&(mt=new Ds(mt,s,null,c,Ee),Ie.push({event:mt,listeners:$e}),lt?mt.data=lt:(lt=tl(c),lt!==null&&(mt.data=lt)))),(lt=Br?hA(s,c):fA(s,c))&&(mt=Ch(pe,"onBeforeInput"),0<mt.length&&($e=new Ds("onBeforeInput","beforeinput",null,c,Ee),Ie.push({event:$e,listeners:mt}),$e.data=lt)),s2(Ie,s,pe,c,Ee)}$v(Ie,a)})}function uu(s,a,c){return{instance:s,listener:a,currentTarget:c}}function Ch(s,a){for(var c=a+"Capture",m=[];s!==null;){var b=s,S=b.stateNode;if(b=b.tag,b!==5&&b!==26&&b!==27||S===null||(b=ts(s,c),b!=null&&m.unshift(uu(s,b,S)),b=ts(s,a),b!=null&&m.push(uu(s,b,S))),s.tag===3)return m;s=s.return}return[]}function l2(s){if(s===null)return null;do s=s.return;while(s&&s.tag!==5&&s.tag!==27);return s||null}function Hv(s,a,c,m,b){for(var S=a._reactName,B=[];c!==null&&c!==m;){var W=c,se=W.alternate,pe=W.stateNode;if(W=W.tag,se!==null&&se===m)break;W!==5&&W!==26&&W!==27||pe===null||(se=pe,b?(pe=ts(c,S),pe!=null&&B.unshift(uu(c,pe,se))):b||(pe=ts(c,S),pe!=null&&B.push(uu(c,pe,se)))),c=c.return}B.length!==0&&s.push({event:a,listeners:B})}var c2=/\r\n?/g,u2=/\u0000|\uFFFD/g;function Gv(s){return(typeof s=="string"?s:""+s).replace(c2,`
`).replace(u2,"")}function Wv(s,a){return a=Gv(a),Gv(s)===a}function Mt(s,a,c,m,b,S){switch(c){case"children":typeof m=="string"?a==="body"||a==="textarea"&&m===""||cr(s,m):(typeof m=="number"||typeof m=="bigint")&&a!=="body"&&cr(s,""+m);break;case"className":xr(s,"class",m);break;case"tabIndex":xr(s,"tabindex",m);break;case"dir":case"role":case"viewBox":case"width":case"height":xr(s,c,m);break;case"style":Rc(s,m,S);break;case"data":if(a!=="object"){xr(s,"data",m);break}case"src":case"href":if(m===""&&(a!=="a"||c!=="href")){s.removeAttribute(c);break}if(m==null||typeof m=="function"||typeof m=="symbol"||typeof m=="boolean"){s.removeAttribute(c);break}m=Yo(""+m),s.setAttribute(c,m);break;case"action":case"formAction":if(typeof m=="function"){s.setAttribute(c,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof S=="function"&&(c==="formAction"?(a!=="input"&&Mt(s,a,"name",b.name,b,null),Mt(s,a,"formEncType",b.formEncType,b,null),Mt(s,a,"formMethod",b.formMethod,b,null),Mt(s,a,"formTarget",b.formTarget,b,null)):(Mt(s,a,"encType",b.encType,b,null),Mt(s,a,"method",b.method,b,null),Mt(s,a,"target",b.target,b,null)));if(m==null||typeof m=="symbol"||typeof m=="boolean"){s.removeAttribute(c);break}m=Yo(""+m),s.setAttribute(c,m);break;case"onClick":m!=null&&(s.onclick=es);break;case"onScroll":m!=null&&dt("scroll",s);break;case"onScrollEnd":m!=null&&dt("scrollend",s);break;case"dangerouslySetInnerHTML":if(m!=null){if(typeof m!="object"||!("__html"in m))throw Error(r(61));if(c=m.__html,c!=null){if(b.children!=null)throw Error(r(60));s.innerHTML=c}}break;case"multiple":s.multiple=m&&typeof m!="function"&&typeof m!="symbol";break;case"muted":s.muted=m&&typeof m!="function"&&typeof m!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(m==null||typeof m=="function"||typeof m=="boolean"||typeof m=="symbol"){s.removeAttribute("xlink:href");break}c=Yo(""+m),s.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",c);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":m!=null&&typeof m!="function"&&typeof m!="symbol"?s.setAttribute(c,""+m):s.removeAttribute(c);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":m&&typeof m!="function"&&typeof m!="symbol"?s.setAttribute(c,""):s.removeAttribute(c);break;case"capture":case"download":m===!0?s.setAttribute(c,""):m!==!1&&m!=null&&typeof m!="function"&&typeof m!="symbol"?s.setAttribute(c,m):s.removeAttribute(c);break;case"cols":case"rows":case"size":case"span":m!=null&&typeof m!="function"&&typeof m!="symbol"&&!isNaN(m)&&1<=m?s.setAttribute(c,m):s.removeAttribute(c);break;case"rowSpan":case"start":m==null||typeof m=="function"||typeof m=="symbol"||isNaN(m)?s.removeAttribute(c):s.setAttribute(c,m);break;case"popover":dt("beforetoggle",s),dt("toggle",s),Wo(s,"popover",m);break;case"xlinkActuate":mn(s,"http://www.w3.org/1999/xlink","xlink:actuate",m);break;case"xlinkArcrole":mn(s,"http://www.w3.org/1999/xlink","xlink:arcrole",m);break;case"xlinkRole":mn(s,"http://www.w3.org/1999/xlink","xlink:role",m);break;case"xlinkShow":mn(s,"http://www.w3.org/1999/xlink","xlink:show",m);break;case"xlinkTitle":mn(s,"http://www.w3.org/1999/xlink","xlink:title",m);break;case"xlinkType":mn(s,"http://www.w3.org/1999/xlink","xlink:type",m);break;case"xmlBase":mn(s,"http://www.w3.org/XML/1998/namespace","xml:base",m);break;case"xmlLang":mn(s,"http://www.w3.org/XML/1998/namespace","xml:lang",m);break;case"xmlSpace":mn(s,"http://www.w3.org/XML/1998/namespace","xml:space",m);break;case"is":Wo(s,"is",m);break;case"innerText":case"textContent":break;default:(!(2<c.length)||c[0]!=="o"&&c[0]!=="O"||c[1]!=="n"&&c[1]!=="N")&&(c=Cd.get(c)||c,Wo(s,c,m))}}function og(s,a,c,m,b,S){switch(c){case"style":Rc(s,m,S);break;case"dangerouslySetInnerHTML":if(m!=null){if(typeof m!="object"||!("__html"in m))throw Error(r(61));if(c=m.__html,c!=null){if(b.children!=null)throw Error(r(60));s.innerHTML=c}}break;case"children":typeof m=="string"?cr(s,m):(typeof m=="number"||typeof m=="bigint")&&cr(s,""+m);break;case"onScroll":m!=null&&dt("scroll",s);break;case"onScrollEnd":m!=null&&dt("scrollend",s);break;case"onClick":m!=null&&(s.onclick=es);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!wc.hasOwnProperty(c))e:{if(c[0]==="o"&&c[1]==="n"&&(b=c.endsWith("Capture"),a=c.slice(2,b?c.length-7:void 0),S=s[In]||null,S=S!=null?S[c]:null,typeof S=="function"&&s.removeEventListener(a,S,b),typeof m=="function")){typeof S!="function"&&S!==null&&(c in s?s[c]=null:s.hasAttribute(c)&&s.removeAttribute(c)),s.addEventListener(a,m,b);break e}c in s?s[c]=m:m===!0?s.setAttribute(c,""):Wo(s,c,m)}}}function Ln(s,a,c){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":dt("error",s),dt("load",s);var m=!1,b=!1,S;for(S in c)if(c.hasOwnProperty(S)){var B=c[S];if(B!=null)switch(S){case"src":m=!0;break;case"srcSet":b=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(r(137,a));default:Mt(s,a,S,B,c,null)}}b&&Mt(s,a,"srcSet",c.srcSet,c,null),m&&Mt(s,a,"src",c.src,c,null);return;case"input":dt("invalid",s);var W=S=B=b=null,se=null,pe=null;for(m in c)if(c.hasOwnProperty(m)){var Ee=c[m];if(Ee!=null)switch(m){case"name":b=Ee;break;case"type":B=Ee;break;case"checked":se=Ee;break;case"defaultChecked":pe=Ee;break;case"value":S=Ee;break;case"defaultValue":W=Ee;break;case"children":case"dangerouslySetInnerHTML":if(Ee!=null)throw Error(r(137,a));break;default:Mt(s,a,m,Ee,c,null)}}xd(s,S,W,se,pe,B,b,!1);return;case"select":dt("invalid",s),m=B=S=null;for(b in c)if(c.hasOwnProperty(b)&&(W=c[b],W!=null))switch(b){case"value":S=W;break;case"defaultValue":B=W;break;case"multiple":m=W;default:Mt(s,a,b,W,c,null)}a=S,c=B,s.multiple=!!m,a!=null?Oi(s,!!m,a,!1):c!=null&&Oi(s,!!m,c,!0);return;case"textarea":dt("invalid",s),S=b=m=null;for(B in c)if(c.hasOwnProperty(B)&&(W=c[B],W!=null))switch(B){case"value":m=W;break;case"defaultValue":b=W;break;case"children":S=W;break;case"dangerouslySetInnerHTML":if(W!=null)throw Error(r(91));break;default:Mt(s,a,B,W,c,null)}Ni(s,m,b,S);return;case"option":for(se in c)c.hasOwnProperty(se)&&(m=c[se],m!=null)&&(se==="selected"?s.selected=m&&typeof m!="function"&&typeof m!="symbol":Mt(s,a,se,m,c,null));return;case"dialog":dt("beforetoggle",s),dt("toggle",s),dt("cancel",s),dt("close",s);break;case"iframe":case"object":dt("load",s);break;case"video":case"audio":for(m=0;m<cu.length;m++)dt(cu[m],s);break;case"image":dt("error",s),dt("load",s);break;case"details":dt("toggle",s);break;case"embed":case"source":case"link":dt("error",s),dt("load",s);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(pe in c)if(c.hasOwnProperty(pe)&&(m=c[pe],m!=null))switch(pe){case"children":case"dangerouslySetInnerHTML":throw Error(r(137,a));default:Mt(s,a,pe,m,c,null)}return;default:if(Ko(a)){for(Ee in c)c.hasOwnProperty(Ee)&&(m=c[Ee],m!==void 0&&og(s,a,Ee,m,c,void 0));return}}for(W in c)c.hasOwnProperty(W)&&(m=c[W],m!=null&&Mt(s,a,W,m,c,null))}function d2(s,a,c,m){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var b=null,S=null,B=null,W=null,se=null,pe=null,Ee=null;for(xe in c){var Ie=c[xe];if(c.hasOwnProperty(xe)&&Ie!=null)switch(xe){case"checked":break;case"value":break;case"defaultValue":se=Ie;default:m.hasOwnProperty(xe)||Mt(s,a,xe,null,m,Ie)}}for(var _e in m){var xe=m[_e];if(Ie=c[_e],m.hasOwnProperty(_e)&&(xe!=null||Ie!=null))switch(_e){case"type":S=xe;break;case"name":b=xe;break;case"checked":pe=xe;break;case"defaultChecked":Ee=xe;break;case"value":B=xe;break;case"defaultValue":W=xe;break;case"children":case"dangerouslySetInnerHTML":if(xe!=null)throw Error(r(137,a));break;default:xe!==Ie&&Mt(s,a,_e,xe,m,Ie)}}Qo(s,B,W,se,pe,Ee,S,b);return;case"select":xe=B=W=_e=null;for(S in c)if(se=c[S],c.hasOwnProperty(S)&&se!=null)switch(S){case"value":break;case"multiple":xe=se;default:m.hasOwnProperty(S)||Mt(s,a,S,null,m,se)}for(b in m)if(S=m[b],se=c[b],m.hasOwnProperty(b)&&(S!=null||se!=null))switch(b){case"value":_e=S;break;case"defaultValue":W=S;break;case"multiple":B=S;default:S!==se&&Mt(s,a,b,S,m,se)}a=W,c=B,m=xe,_e!=null?Oi(s,!!c,_e,!1):!!m!=!!c&&(a!=null?Oi(s,!!c,a,!0):Oi(s,!!c,c?[]:"",!1));return;case"textarea":xe=_e=null;for(W in c)if(b=c[W],c.hasOwnProperty(W)&&b!=null&&!m.hasOwnProperty(W))switch(W){case"value":break;case"children":break;default:Mt(s,a,W,null,m,b)}for(B in m)if(b=m[B],S=c[B],m.hasOwnProperty(B)&&(b!=null||S!=null))switch(B){case"value":_e=b;break;case"defaultValue":xe=b;break;case"children":break;case"dangerouslySetInnerHTML":if(b!=null)throw Error(r(91));break;default:b!==S&&Mt(s,a,B,b,m,S)}wd(s,_e,xe);return;case"option":for(var Fe in c)_e=c[Fe],c.hasOwnProperty(Fe)&&_e!=null&&!m.hasOwnProperty(Fe)&&(Fe==="selected"?s.selected=!1:Mt(s,a,Fe,null,m,_e));for(se in m)_e=m[se],xe=c[se],m.hasOwnProperty(se)&&_e!==xe&&(_e!=null||xe!=null)&&(se==="selected"?s.selected=_e&&typeof _e!="function"&&typeof _e!="symbol":Mt(s,a,se,_e,m,xe));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Qe in c)_e=c[Qe],c.hasOwnProperty(Qe)&&_e!=null&&!m.hasOwnProperty(Qe)&&Mt(s,a,Qe,null,m,_e);for(pe in m)if(_e=m[pe],xe=c[pe],m.hasOwnProperty(pe)&&_e!==xe&&(_e!=null||xe!=null))switch(pe){case"children":case"dangerouslySetInnerHTML":if(_e!=null)throw Error(r(137,a));break;default:Mt(s,a,pe,_e,m,xe)}return;default:if(Ko(a)){for(var Ot in c)_e=c[Ot],c.hasOwnProperty(Ot)&&_e!==void 0&&!m.hasOwnProperty(Ot)&&og(s,a,Ot,void 0,m,_e);for(Ee in m)_e=m[Ee],xe=c[Ee],!m.hasOwnProperty(Ee)||_e===xe||_e===void 0&&xe===void 0||og(s,a,Ee,_e,m,xe);return}}for(var ue in c)_e=c[ue],c.hasOwnProperty(ue)&&_e!=null&&!m.hasOwnProperty(ue)&&Mt(s,a,ue,null,m,_e);for(Ie in m)_e=m[Ie],xe=c[Ie],!m.hasOwnProperty(Ie)||_e===xe||_e==null&&xe==null||Mt(s,a,Ie,_e,m,xe)}function Qv(s){switch(s){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function h2(){if(typeof performance.getEntriesByType=="function"){for(var s=0,a=0,c=performance.getEntriesByType("resource"),m=0;m<c.length;m++){var b=c[m],S=b.transferSize,B=b.initiatorType,W=b.duration;if(S&&W&&Qv(B)){for(B=0,W=b.responseEnd,m+=1;m<c.length;m++){var se=c[m],pe=se.startTime;if(pe>W)break;var Ee=se.transferSize,Ie=se.initiatorType;Ee&&Qv(Ie)&&(se=se.responseEnd,B+=Ee*(se<W?1:(W-pe)/(se-pe)))}if(--m,a+=8*(S+B)/(b.duration/1e3),s++,10<s)break}}if(0<s)return a/s/1e6}return navigator.connection&&(s=navigator.connection.downlink,typeof s=="number")?s:5}var lg=null,cg=null;function Eh(s){return s.nodeType===9?s:s.ownerDocument}function Kv(s){switch(s){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Yv(s,a){if(s===0)switch(a){case"svg":return 1;case"math":return 2;default:return 0}return s===1&&a==="foreignObject"?0:s}function ug(s,a){return s==="textarea"||s==="noscript"||typeof a.children=="string"||typeof a.children=="number"||typeof a.children=="bigint"||typeof a.dangerouslySetInnerHTML=="object"&&a.dangerouslySetInnerHTML!==null&&a.dangerouslySetInnerHTML.__html!=null}var dg=null;function f2(){var s=window.event;return s&&s.type==="popstate"?s===dg?!1:(dg=s,!0):(dg=null,!1)}var Xv=typeof setTimeout=="function"?setTimeout:void 0,m2=typeof clearTimeout=="function"?clearTimeout:void 0,Zv=typeof Promise=="function"?Promise:void 0,p2=typeof queueMicrotask=="function"?queueMicrotask:typeof Zv<"u"?function(s){return Zv.resolve(null).then(s).catch(g2)}:Xv;function g2(s){setTimeout(function(){throw s})}function sa(s){return s==="head"}function Jv(s,a){var c=a,m=0;do{var b=c.nextSibling;if(s.removeChild(c),b&&b.nodeType===8)if(c=b.data,c==="/$"||c==="/&"){if(m===0){s.removeChild(b),Il(a);return}m--}else if(c==="$"||c==="$?"||c==="$~"||c==="$!"||c==="&")m++;else if(c==="html")du(s.ownerDocument.documentElement);else if(c==="head"){c=s.ownerDocument.head,du(c);for(var S=c.firstChild;S;){var B=S.nextSibling,W=S.nodeName;S[ws]||W==="SCRIPT"||W==="STYLE"||W==="LINK"&&S.rel.toLowerCase()==="stylesheet"||c.removeChild(S),S=B}}else c==="body"&&du(s.ownerDocument.body);c=b}while(c);Il(a)}function ex(s,a){var c=s;s=0;do{var m=c.nextSibling;if(c.nodeType===1?a?(c._stashedDisplay=c.style.display,c.style.display="none"):(c.style.display=c._stashedDisplay||"",c.getAttribute("style")===""&&c.removeAttribute("style")):c.nodeType===3&&(a?(c._stashedText=c.nodeValue,c.nodeValue=""):c.nodeValue=c._stashedText||""),m&&m.nodeType===8)if(c=m.data,c==="/$"){if(s===0)break;s--}else c!=="$"&&c!=="$?"&&c!=="$~"&&c!=="$!"||s++;c=m}while(c)}function hg(s){var a=s.firstChild;for(a&&a.nodeType===10&&(a=a.nextSibling);a;){var c=a;switch(a=a.nextSibling,c.nodeName){case"HTML":case"HEAD":case"BODY":hg(c),Go(c);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(c.rel.toLowerCase()==="stylesheet")continue}s.removeChild(c)}}function y2(s,a,c,m){for(;s.nodeType===1;){var b=c;if(s.nodeName.toLowerCase()!==a.toLowerCase()){if(!m&&(s.nodeName!=="INPUT"||s.type!=="hidden"))break}else if(m){if(!s[ws])switch(a){case"meta":if(!s.hasAttribute("itemprop"))break;return s;case"link":if(S=s.getAttribute("rel"),S==="stylesheet"&&s.hasAttribute("data-precedence"))break;if(S!==b.rel||s.getAttribute("href")!==(b.href==null||b.href===""?null:b.href)||s.getAttribute("crossorigin")!==(b.crossOrigin==null?null:b.crossOrigin)||s.getAttribute("title")!==(b.title==null?null:b.title))break;return s;case"style":if(s.hasAttribute("data-precedence"))break;return s;case"script":if(S=s.getAttribute("src"),(S!==(b.src==null?null:b.src)||s.getAttribute("type")!==(b.type==null?null:b.type)||s.getAttribute("crossorigin")!==(b.crossOrigin==null?null:b.crossOrigin))&&S&&s.hasAttribute("async")&&!s.hasAttribute("itemprop"))break;return s;default:return s}}else if(a==="input"&&s.type==="hidden"){var S=b.name==null?null:""+b.name;if(b.type==="hidden"&&s.getAttribute("name")===S)return s}else return s;if(s=qr(s.nextSibling),s===null)break}return null}function _2(s,a,c){if(a==="")return null;for(;s.nodeType!==3;)if((s.nodeType!==1||s.nodeName!=="INPUT"||s.type!=="hidden")&&!c||(s=qr(s.nextSibling),s===null))return null;return s}function tx(s,a){for(;s.nodeType!==8;)if((s.nodeType!==1||s.nodeName!=="INPUT"||s.type!=="hidden")&&!a||(s=qr(s.nextSibling),s===null))return null;return s}function fg(s){return s.data==="$?"||s.data==="$~"}function mg(s){return s.data==="$!"||s.data==="$?"&&s.ownerDocument.readyState!=="loading"}function b2(s,a){var c=s.ownerDocument;if(s.data==="$~")s._reactRetry=a;else if(s.data!=="$?"||c.readyState!=="loading")a();else{var m=function(){a(),c.removeEventListener("DOMContentLoaded",m)};c.addEventListener("DOMContentLoaded",m),s._reactRetry=m}}function qr(s){for(;s!=null;s=s.nextSibling){var a=s.nodeType;if(a===1||a===3)break;if(a===8){if(a=s.data,a==="$"||a==="$!"||a==="$?"||a==="$~"||a==="&"||a==="F!"||a==="F")break;if(a==="/$"||a==="/&")return null}}return s}var pg=null;function nx(s){s=s.nextSibling;for(var a=0;s;){if(s.nodeType===8){var c=s.data;if(c==="/$"||c==="/&"){if(a===0)return qr(s.nextSibling);a--}else c!=="$"&&c!=="$!"&&c!=="$?"&&c!=="$~"&&c!=="&"||a++}s=s.nextSibling}return null}function rx(s){s=s.previousSibling;for(var a=0;s;){if(s.nodeType===8){var c=s.data;if(c==="$"||c==="$!"||c==="$?"||c==="$~"||c==="&"){if(a===0)return s;a--}else c!=="/$"&&c!=="/&"||a++}s=s.previousSibling}return null}function sx(s,a,c){switch(a=Eh(c),s){case"html":if(s=a.documentElement,!s)throw Error(r(452));return s;case"head":if(s=a.head,!s)throw Error(r(453));return s;case"body":if(s=a.body,!s)throw Error(r(454));return s;default:throw Error(r(451))}}function du(s){for(var a=s.attributes;a.length;)s.removeAttributeNode(a[0]);Go(s)}var Hr=new Map,ix=new Set;function Th(s){return typeof s.getRootNode=="function"?s.getRootNode():s.nodeType===9?s:s.ownerDocument}var mi=G.d;G.d={f:v2,r:x2,D:w2,C:S2,L:C2,m:E2,X:A2,S:T2,M:j2};function v2(){var s=mi.f(),a=yh();return s||a}function x2(s){var a=Or(s);a!==null&&a.tag===5&&a.type==="form"?wb(a):mi.r(s)}var Al=typeof document>"u"?null:document;function ax(s,a,c){var m=Al;if(m&&typeof a=="string"&&a){var b=lr(a);b='link[rel="'+s+'"][href="'+b+'"]',typeof c=="string"&&(b+='[crossorigin="'+c+'"]'),ix.has(b)||(ix.add(b),s={rel:s,crossOrigin:c,href:a},m.querySelector(b)===null&&(a=m.createElement("link"),Ln(a,"link",s),fn(a),m.head.appendChild(a)))}}function w2(s){mi.D(s),ax("dns-prefetch",s,null)}function S2(s,a){mi.C(s,a),ax("preconnect",s,a)}function C2(s,a,c){mi.L(s,a,c);var m=Al;if(m&&s&&a){var b='link[rel="preload"][as="'+lr(a)+'"]';a==="image"&&c&&c.imageSrcSet?(b+='[imagesrcset="'+lr(c.imageSrcSet)+'"]',typeof c.imageSizes=="string"&&(b+='[imagesizes="'+lr(c.imageSizes)+'"]')):b+='[href="'+lr(s)+'"]';var S=b;switch(a){case"style":S=jl(s);break;case"script":S=Rl(s)}Hr.has(S)||(s=g({rel:"preload",href:a==="image"&&c&&c.imageSrcSet?void 0:s,as:a},c),Hr.set(S,s),m.querySelector(b)!==null||a==="style"&&m.querySelector(hu(S))||a==="script"&&m.querySelector(fu(S))||(a=m.createElement("link"),Ln(a,"link",s),fn(a),m.head.appendChild(a)))}}function E2(s,a){mi.m(s,a);var c=Al;if(c&&s){var m=a&&typeof a.as=="string"?a.as:"script",b='link[rel="modulepreload"][as="'+lr(m)+'"][href="'+lr(s)+'"]',S=b;switch(m){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":S=Rl(s)}if(!Hr.has(S)&&(s=g({rel:"modulepreload",href:s},a),Hr.set(S,s),c.querySelector(b)===null)){switch(m){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(c.querySelector(fu(S)))return}m=c.createElement("link"),Ln(m,"link",s),fn(m),c.head.appendChild(m)}}}function T2(s,a,c){mi.S(s,a,c);var m=Al;if(m&&s){var b=Cs(m).hoistableStyles,S=jl(s);a=a||"default";var B=b.get(S);if(!B){var W={loading:0,preload:null};if(B=m.querySelector(hu(S)))W.loading=5;else{s=g({rel:"stylesheet",href:s,"data-precedence":a},c),(c=Hr.get(S))&&gg(s,c);var se=B=m.createElement("link");fn(se),Ln(se,"link",s),se._p=new Promise(function(pe,Ee){se.onload=pe,se.onerror=Ee}),se.addEventListener("load",function(){W.loading|=1}),se.addEventListener("error",function(){W.loading|=2}),W.loading|=4,Ah(B,a,m)}B={type:"stylesheet",instance:B,count:1,state:W},b.set(S,B)}}}function A2(s,a){mi.X(s,a);var c=Al;if(c&&s){var m=Cs(c).hoistableScripts,b=Rl(s),S=m.get(b);S||(S=c.querySelector(fu(b)),S||(s=g({src:s,async:!0},a),(a=Hr.get(b))&&yg(s,a),S=c.createElement("script"),fn(S),Ln(S,"link",s),c.head.appendChild(S)),S={type:"script",instance:S,count:1,state:null},m.set(b,S))}}function j2(s,a){mi.M(s,a);var c=Al;if(c&&s){var m=Cs(c).hoistableScripts,b=Rl(s),S=m.get(b);S||(S=c.querySelector(fu(b)),S||(s=g({src:s,async:!0,type:"module"},a),(a=Hr.get(b))&&yg(s,a),S=c.createElement("script"),fn(S),Ln(S,"link",s),c.head.appendChild(S)),S={type:"script",instance:S,count:1,state:null},m.set(b,S))}}function ox(s,a,c,m){var b=(b=be.current)?Th(b):null;if(!b)throw Error(r(446));switch(s){case"meta":case"title":return null;case"style":return typeof c.precedence=="string"&&typeof c.href=="string"?(a=jl(c.href),c=Cs(b).hoistableStyles,m=c.get(a),m||(m={type:"style",instance:null,count:0,state:null},c.set(a,m)),m):{type:"void",instance:null,count:0,state:null};case"link":if(c.rel==="stylesheet"&&typeof c.href=="string"&&typeof c.precedence=="string"){s=jl(c.href);var S=Cs(b).hoistableStyles,B=S.get(s);if(B||(b=b.ownerDocument||b,B={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},S.set(s,B),(S=b.querySelector(hu(s)))&&!S._p&&(B.instance=S,B.state.loading=5),Hr.has(s)||(c={rel:"preload",as:"style",href:c.href,crossOrigin:c.crossOrigin,integrity:c.integrity,media:c.media,hrefLang:c.hrefLang,referrerPolicy:c.referrerPolicy},Hr.set(s,c),S||R2(b,s,c,B.state))),a&&m===null)throw Error(r(528,""));return B}if(a&&m!==null)throw Error(r(529,""));return null;case"script":return a=c.async,c=c.src,typeof c=="string"&&a&&typeof a!="function"&&typeof a!="symbol"?(a=Rl(c),c=Cs(b).hoistableScripts,m=c.get(a),m||(m={type:"script",instance:null,count:0,state:null},c.set(a,m)),m):{type:"void",instance:null,count:0,state:null};default:throw Error(r(444,s))}}function jl(s){return'href="'+lr(s)+'"'}function hu(s){return'link[rel="stylesheet"]['+s+"]"}function lx(s){return g({},s,{"data-precedence":s.precedence,precedence:null})}function R2(s,a,c,m){s.querySelector('link[rel="preload"][as="style"]['+a+"]")?m.loading=1:(a=s.createElement("link"),m.preload=a,a.addEventListener("load",function(){return m.loading|=1}),a.addEventListener("error",function(){return m.loading|=2}),Ln(a,"link",c),fn(a),s.head.appendChild(a))}function Rl(s){return'[src="'+lr(s)+'"]'}function fu(s){return"script[async]"+s}function cx(s,a,c){if(a.count++,a.instance===null)switch(a.type){case"style":var m=s.querySelector('style[data-href~="'+lr(c.href)+'"]');if(m)return a.instance=m,fn(m),m;var b=g({},c,{"data-href":c.href,"data-precedence":c.precedence,href:null,precedence:null});return m=(s.ownerDocument||s).createElement("style"),fn(m),Ln(m,"style",b),Ah(m,c.precedence,s),a.instance=m;case"stylesheet":b=jl(c.href);var S=s.querySelector(hu(b));if(S)return a.state.loading|=4,a.instance=S,fn(S),S;m=lx(c),(b=Hr.get(b))&&gg(m,b),S=(s.ownerDocument||s).createElement("link"),fn(S);var B=S;return B._p=new Promise(function(W,se){B.onload=W,B.onerror=se}),Ln(S,"link",m),a.state.loading|=4,Ah(S,c.precedence,s),a.instance=S;case"script":return S=Rl(c.src),(b=s.querySelector(fu(S)))?(a.instance=b,fn(b),b):(m=c,(b=Hr.get(S))&&(m=g({},c),yg(m,b)),s=s.ownerDocument||s,b=s.createElement("script"),fn(b),Ln(b,"link",m),s.head.appendChild(b),a.instance=b);case"void":return null;default:throw Error(r(443,a.type))}else a.type==="stylesheet"&&(a.state.loading&4)===0&&(m=a.instance,a.state.loading|=4,Ah(m,c.precedence,s));return a.instance}function Ah(s,a,c){for(var m=c.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),b=m.length?m[m.length-1]:null,S=b,B=0;B<m.length;B++){var W=m[B];if(W.dataset.precedence===a)S=W;else if(S!==b)break}S?S.parentNode.insertBefore(s,S.nextSibling):(a=c.nodeType===9?c.head:c,a.insertBefore(s,a.firstChild))}function gg(s,a){s.crossOrigin==null&&(s.crossOrigin=a.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=a.referrerPolicy),s.title==null&&(s.title=a.title)}function yg(s,a){s.crossOrigin==null&&(s.crossOrigin=a.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=a.referrerPolicy),s.integrity==null&&(s.integrity=a.integrity)}var jh=null;function ux(s,a,c){if(jh===null){var m=new Map,b=jh=new Map;b.set(c,m)}else b=jh,m=b.get(c),m||(m=new Map,b.set(c,m));if(m.has(s))return m;for(m.set(s,null),c=c.getElementsByTagName(s),b=0;b<c.length;b++){var S=c[b];if(!(S[ws]||S[hn]||s==="link"&&S.getAttribute("rel")==="stylesheet")&&S.namespaceURI!=="http://www.w3.org/2000/svg"){var B=S.getAttribute(a)||"";B=s+B;var W=m.get(B);W?W.push(S):m.set(B,[S])}}return m}function dx(s,a,c){s=s.ownerDocument||s,s.head.insertBefore(c,a==="title"?s.querySelector("head > title"):null)}function I2(s,a,c){if(c===1||a.itemProp!=null)return!1;switch(s){case"meta":case"title":return!0;case"style":if(typeof a.precedence!="string"||typeof a.href!="string"||a.href==="")break;return!0;case"link":if(typeof a.rel!="string"||typeof a.href!="string"||a.href===""||a.onLoad||a.onError)break;return a.rel==="stylesheet"?(s=a.disabled,typeof a.precedence=="string"&&s==null):!0;case"script":if(a.async&&typeof a.async!="function"&&typeof a.async!="symbol"&&!a.onLoad&&!a.onError&&a.src&&typeof a.src=="string")return!0}return!1}function hx(s){return!(s.type==="stylesheet"&&(s.state.loading&3)===0)}function k2(s,a,c,m){if(c.type==="stylesheet"&&(typeof m.media!="string"||matchMedia(m.media).matches!==!1)&&(c.state.loading&4)===0){if(c.instance===null){var b=jl(m.href),S=a.querySelector(hu(b));if(S){a=S._p,a!==null&&typeof a=="object"&&typeof a.then=="function"&&(s.count++,s=Rh.bind(s),a.then(s,s)),c.state.loading|=4,c.instance=S,fn(S);return}S=a.ownerDocument||a,m=lx(m),(b=Hr.get(b))&&gg(m,b),S=S.createElement("link"),fn(S);var B=S;B._p=new Promise(function(W,se){B.onload=W,B.onerror=se}),Ln(S,"link",m),c.instance=S}s.stylesheets===null&&(s.stylesheets=new Map),s.stylesheets.set(c,a),(a=c.state.preload)&&(c.state.loading&3)===0&&(s.count++,c=Rh.bind(s),a.addEventListener("load",c),a.addEventListener("error",c))}}var _g=0;function D2(s,a){return s.stylesheets&&s.count===0&&kh(s,s.stylesheets),0<s.count||0<s.imgCount?function(c){var m=setTimeout(function(){if(s.stylesheets&&kh(s,s.stylesheets),s.unsuspend){var S=s.unsuspend;s.unsuspend=null,S()}},6e4+a);0<s.imgBytes&&_g===0&&(_g=62500*h2());var b=setTimeout(function(){if(s.waitingForImages=!1,s.count===0&&(s.stylesheets&&kh(s,s.stylesheets),s.unsuspend)){var S=s.unsuspend;s.unsuspend=null,S()}},(s.imgBytes>_g?50:800)+a);return s.unsuspend=c,function(){s.unsuspend=null,clearTimeout(m),clearTimeout(b)}}:null}function Rh(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)kh(this,this.stylesheets);else if(this.unsuspend){var s=this.unsuspend;this.unsuspend=null,s()}}}var Ih=null;function kh(s,a){s.stylesheets=null,s.unsuspend!==null&&(s.count++,Ih=new Map,a.forEach(M2,s),Ih=null,Rh.call(s))}function M2(s,a){if(!(a.state.loading&4)){var c=Ih.get(s);if(c)var m=c.get(null);else{c=new Map,Ih.set(s,c);for(var b=s.querySelectorAll("link[data-precedence],style[data-precedence]"),S=0;S<b.length;S++){var B=b[S];(B.nodeName==="LINK"||B.getAttribute("media")!=="not all")&&(c.set(B.dataset.precedence,B),m=B)}m&&c.set(null,m)}b=a.instance,B=b.getAttribute("data-precedence"),S=c.get(B)||m,S===m&&c.set(null,b),c.set(B,b),this.count++,m=Rh.bind(this),b.addEventListener("load",m),b.addEventListener("error",m),S?S.parentNode.insertBefore(b,S.nextSibling):(s=s.nodeType===9?s.head:s,s.insertBefore(b,s.firstChild)),a.state.loading|=4}}var mu={$$typeof:R,Provider:null,Consumer:null,_currentValue:Z,_currentValue2:Z,_threadCount:0};function O2(s,a,c,m,b,S,B,W,se){this.tag=1,this.containerInfo=s,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=vs(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=vs(0),this.hiddenUpdates=vs(null),this.identifierPrefix=m,this.onUncaughtError=b,this.onCaughtError=S,this.onRecoverableError=B,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=se,this.incompleteTransitions=new Map}function fx(s,a,c,m,b,S,B,W,se,pe,Ee,Ie){return s=new O2(s,a,c,B,se,pe,Ee,Ie,W),a=1,S===!0&&(a|=24),S=Sr(3,null,null,a),s.current=S,S.stateNode=s,a=Xm(),a.refCount++,s.pooledCache=a,a.refCount++,S.memoizedState={element:m,isDehydrated:c,cache:a},tp(S),s}function mx(s){return s?(s=al,s):al}function px(s,a,c,m,b,S){b=mx(b),m.context===null?m.context=b:m.pendingContext=b,m=Wi(a),m.payload={element:c},S=S===void 0?null:S,S!==null&&(m.callback=S),c=Qi(s,m,a),c!==null&&(mr(c,s,a),Gc(c,s,a))}function gx(s,a){if(s=s.memoizedState,s!==null&&s.dehydrated!==null){var c=s.retryLane;s.retryLane=c!==0&&c<a?c:a}}function bg(s,a){gx(s,a),(s=s.alternate)&&gx(s,a)}function yx(s){if(s.tag===13||s.tag===31){var a=io(s,67108864);a!==null&&mr(a,s,67108864),bg(s,67108864)}}function _x(s){if(s.tag===13||s.tag===31){var a=jr();a=Wa(a);var c=io(s,a);c!==null&&mr(c,s,a),bg(s,a)}}var Dh=!0;function N2(s,a,c,m){var b=Y.T;Y.T=null;var S=G.p;try{G.p=2,vg(s,a,c,m)}finally{G.p=S,Y.T=b}}function P2(s,a,c,m){var b=Y.T;Y.T=null;var S=G.p;try{G.p=8,vg(s,a,c,m)}finally{G.p=S,Y.T=b}}function vg(s,a,c,m){if(Dh){var b=xg(m);if(b===null)ag(s,a,m,Mh,c),vx(s,m);else if(z2(b,s,a,c,m))m.stopPropagation();else if(vx(s,m),a&4&&-1<B2.indexOf(s)){for(;b!==null;){var S=Or(b);if(S!==null)switch(S.tag){case 3:if(S=S.stateNode,S.current.memoizedState.isDehydrated){var B=rr(S.pendingLanes);if(B!==0){var W=S;for(W.pendingLanes|=2,W.entangledLanes|=2;B;){var se=1<<31-Ct(B);W.entanglements[1]|=se,B&=~se}Bs(S),(Tt&6)===0&&(ph=Ne()+500,lu(0))}}break;case 31:case 13:W=io(S,2),W!==null&&mr(W,S,2),yh(),bg(S,2)}if(S=xg(m),S===null&&ag(s,a,m,Mh,c),S===b)break;b=S}b!==null&&m.stopPropagation()}else ag(s,a,m,null,c)}}function xg(s){return s=Nr(s),wg(s)}var Mh=null;function wg(s){if(Mh=null,s=Ss(s),s!==null){var a=o(s);if(a===null)s=null;else{var c=a.tag;if(c===13){if(s=l(a),s!==null)return s;s=null}else if(c===31){if(s=d(a),s!==null)return s;s=null}else if(c===3){if(a.stateNode.current.memoizedState.isDehydrated)return a.tag===3?a.stateNode.containerInfo:null;s=null}else a!==s&&(s=null)}}return Mh=s,null}function bx(s){switch(s){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(De()){case qe:return 2;case xt:return 8;case rt:case Qn:return 32;case gs:return 268435456;default:return 32}default:return 32}}var Sg=!1,ia=null,aa=null,oa=null,pu=new Map,gu=new Map,la=[],B2="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function vx(s,a){switch(s){case"focusin":case"focusout":ia=null;break;case"dragenter":case"dragleave":aa=null;break;case"mouseover":case"mouseout":oa=null;break;case"pointerover":case"pointerout":pu.delete(a.pointerId);break;case"gotpointercapture":case"lostpointercapture":gu.delete(a.pointerId)}}function yu(s,a,c,m,b,S){return s===null||s.nativeEvent!==S?(s={blockedOn:a,domEventName:c,eventSystemFlags:m,nativeEvent:S,targetContainers:[b]},a!==null&&(a=Or(a),a!==null&&yx(a)),s):(s.eventSystemFlags|=m,a=s.targetContainers,b!==null&&a.indexOf(b)===-1&&a.push(b),s)}function z2(s,a,c,m,b){switch(a){case"focusin":return ia=yu(ia,s,a,c,m,b),!0;case"dragenter":return aa=yu(aa,s,a,c,m,b),!0;case"mouseover":return oa=yu(oa,s,a,c,m,b),!0;case"pointerover":var S=b.pointerId;return pu.set(S,yu(pu.get(S)||null,s,a,c,m,b)),!0;case"gotpointercapture":return S=b.pointerId,gu.set(S,yu(gu.get(S)||null,s,a,c,m,b)),!0}return!1}function xx(s){var a=Ss(s.target);if(a!==null){var c=o(a);if(c!==null){if(a=c.tag,a===13){if(a=l(c),a!==null){s.blockedOn=a,Zr(s.priority,function(){_x(c)});return}}else if(a===31){if(a=d(c),a!==null){s.blockedOn=a,Zr(s.priority,function(){_x(c)});return}}else if(a===3&&c.stateNode.current.memoizedState.isDehydrated){s.blockedOn=c.tag===3?c.stateNode.containerInfo:null;return}}}s.blockedOn=null}function Oh(s){if(s.blockedOn!==null)return!1;for(var a=s.targetContainers;0<a.length;){var c=xg(s.nativeEvent);if(c===null){c=s.nativeEvent;var m=new c.constructor(c.type,c);Ic=m,c.target.dispatchEvent(m),Ic=null}else return a=Or(c),a!==null&&yx(a),s.blockedOn=c,!1;a.shift()}return!0}function wx(s,a,c){Oh(s)&&c.delete(a)}function L2(){Sg=!1,ia!==null&&Oh(ia)&&(ia=null),aa!==null&&Oh(aa)&&(aa=null),oa!==null&&Oh(oa)&&(oa=null),pu.forEach(wx),gu.forEach(wx)}function Nh(s,a){s.blockedOn===a&&(s.blockedOn=null,Sg||(Sg=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,L2)))}var Ph=null;function Sx(s){Ph!==s&&(Ph=s,t.unstable_scheduleCallback(t.unstable_NormalPriority,function(){Ph===s&&(Ph=null);for(var a=0;a<s.length;a+=3){var c=s[a],m=s[a+1],b=s[a+2];if(typeof m!="function"){if(wg(m||c)===null)continue;break}var S=Or(c);S!==null&&(s.splice(a,3),a-=3,xp(S,{pending:!0,data:b,method:c.method,action:m},m,b))}}))}function Il(s){function a(se){return Nh(se,s)}ia!==null&&Nh(ia,s),aa!==null&&Nh(aa,s),oa!==null&&Nh(oa,s),pu.forEach(a),gu.forEach(a);for(var c=0;c<la.length;c++){var m=la[c];m.blockedOn===s&&(m.blockedOn=null)}for(;0<la.length&&(c=la[0],c.blockedOn===null);)xx(c),c.blockedOn===null&&la.shift();if(c=(s.ownerDocument||s).$$reactFormReplay,c!=null)for(m=0;m<c.length;m+=3){var b=c[m],S=c[m+1],B=b[In]||null;if(typeof S=="function")B||Sx(c);else if(B){var W=null;if(S&&S.hasAttribute("formAction")){if(b=S,B=S[In]||null)W=B.formAction;else if(wg(b)!==null)continue}else W=B.action;typeof W=="function"?c[m+1]=W:(c.splice(m,3),m-=3),Sx(c)}}}function Cx(){function s(S){S.canIntercept&&S.info==="react-transition"&&S.intercept({handler:function(){return new Promise(function(B){return b=B})},focusReset:"manual",scroll:"manual"})}function a(){b!==null&&(b(),b=null),m||setTimeout(c,20)}function c(){if(!m&&!navigation.transition){var S=navigation.currentEntry;S&&S.url!=null&&navigation.navigate(S.url,{state:S.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var m=!1,b=null;return navigation.addEventListener("navigate",s),navigation.addEventListener("navigatesuccess",a),navigation.addEventListener("navigateerror",a),setTimeout(c,100),function(){m=!0,navigation.removeEventListener("navigate",s),navigation.removeEventListener("navigatesuccess",a),navigation.removeEventListener("navigateerror",a),b!==null&&(b(),b=null)}}}function Cg(s){this._internalRoot=s}Bh.prototype.render=Cg.prototype.render=function(s){var a=this._internalRoot;if(a===null)throw Error(r(409));var c=a.current,m=jr();px(c,m,s,a,null,null)},Bh.prototype.unmount=Cg.prototype.unmount=function(){var s=this._internalRoot;if(s!==null){this._internalRoot=null;var a=s.containerInfo;px(s.current,2,null,s,null,null),yh(),a[xs]=null}};function Bh(s){this._internalRoot=s}Bh.prototype.unstable_scheduleHydration=function(s){if(s){var a=yd();s={blockedOn:null,target:s,priority:a};for(var c=0;c<la.length&&a!==0&&a<la[c].priority;c++);la.splice(c,0,s),c===0&&xx(s)}};var Ex=e.version;if(Ex!=="19.2.3")throw Error(r(527,Ex,"19.2.3"));G.findDOMNode=function(s){var a=s._reactInternals;if(a===void 0)throw typeof s.render=="function"?Error(r(188)):(s=Object.keys(s).join(","),Error(r(268,s)));return s=f(a),s=s!==null?p(s):null,s=s===null?null:s.stateNode,s};var U2={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:Y,reconcilerVersion:"19.2.3"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var zh=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!zh.isDisabled&&zh.supportsFiber)try{vt=zh.inject(U2),tn=zh}catch{}}return bu.createRoot=function(s,a){if(!i(s))throw Error(r(299));var c=!1,m="",b=Db,S=Mb,B=Ob;return a!=null&&(a.unstable_strictMode===!0&&(c=!0),a.identifierPrefix!==void 0&&(m=a.identifierPrefix),a.onUncaughtError!==void 0&&(b=a.onUncaughtError),a.onCaughtError!==void 0&&(S=a.onCaughtError),a.onRecoverableError!==void 0&&(B=a.onRecoverableError)),a=fx(s,1,!1,null,null,c,m,null,b,S,B,Cx),s[xs]=a.current,ig(s),new Cg(a)},bu.hydrateRoot=function(s,a,c){if(!i(s))throw Error(r(299));var m=!1,b="",S=Db,B=Mb,W=Ob,se=null;return c!=null&&(c.unstable_strictMode===!0&&(m=!0),c.identifierPrefix!==void 0&&(b=c.identifierPrefix),c.onUncaughtError!==void 0&&(S=c.onUncaughtError),c.onCaughtError!==void 0&&(B=c.onCaughtError),c.onRecoverableError!==void 0&&(W=c.onRecoverableError),c.formState!==void 0&&(se=c.formState)),a=fx(s,1,!0,a,c??null,m,b,se,S,B,W,Cx),a.context=mx(null),c=a.current,m=jr(),m=Wa(m),b=Wi(m),b.callback=null,Qi(c,b,m),c=m,a.current.lanes=c,Ha(a,c),Bs(a),s[xs]=a.current,ig(s),new Bh(a)},bu.version="19.2.3",bu}var Nx;function X2(){if(Nx)return Ag.exports;Nx=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),Ag.exports=Y2(),Ag.exports}var Z2=X2();var Px="popstate";function J2(t={}){function e(r,i){let{pathname:o,search:l,hash:d}=r.location;return Jg("",{pathname:o,search:l,hash:d},i.state&&i.state.usr||null,i.state&&i.state.key||"default")}function n(r,i){return typeof i=="string"?i:Mu(i)}return t5(e,n,null,t)}function Zt(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function Ir(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function e5(){return Math.random().toString(36).substring(2,10)}function Bx(t,e){return{usr:t.state,key:t.key,idx:e}}function Jg(t,e,n=null,r){return{pathname:typeof t=="string"?t:t.pathname,search:"",hash:"",...typeof e=="string"?nc(e):e,state:n,key:e&&e.key||r||e5()}}function Mu({pathname:t="/",search:e="",hash:n=""}){return e&&e!=="?"&&(t+=e.charAt(0)==="?"?e:"?"+e),n&&n!=="#"&&(t+=n.charAt(0)==="#"?n:"#"+n),t}function nc(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substring(n),t=t.substring(0,n));let r=t.indexOf("?");r>=0&&(e.search=t.substring(r),t=t.substring(0,r)),t&&(e.pathname=t)}return e}function t5(t,e,n,r={}){let{window:i=document.defaultView,v5Compat:o=!1}=r,l=i.history,d="POP",h=null,f=p();f==null&&(f=0,l.replaceState({...l.state,idx:f},""));function p(){return(l.state||{idx:null}).idx}function g(){d="POP";let w=p(),E=w==null?null:w-f;f=w,h&&h({action:d,location:x.location,delta:E})}function v(w,E){d="PUSH";let T=Jg(x.location,w,E);f=p()+1;let R=Bx(T,f),M=x.createHref(T);try{l.pushState(R,"",M)}catch(V){if(V instanceof DOMException&&V.name==="DataCloneError")throw V;i.location.assign(M)}o&&h&&h({action:d,location:x.location,delta:1})}function _(w,E){d="REPLACE";let T=Jg(x.location,w,E);f=p();let R=Bx(T,f),M=x.createHref(T);l.replaceState(R,"",M),o&&h&&h({action:d,location:x.location,delta:0})}function C(w){return n5(w)}let x={get action(){return d},get location(){return t(i,l)},listen(w){if(h)throw new Error("A history only accepts one active listener");return i.addEventListener(Px,g),h=w,()=>{i.removeEventListener(Px,g),h=null}},createHref(w){return e(i,w)},createURL:C,encodeLocation(w){let E=C(w);return{pathname:E.pathname,search:E.search,hash:E.hash}},push:v,replace:_,go(w){return l.go(w)}};return x}function n5(t,e=!1){let n="http://localhost";typeof window<"u"&&(n=window.location.origin!=="null"?window.location.origin:window.location.href),Zt(n,"No window.location.(origin|href) available to create URL");let r=typeof t=="string"?t:Mu(t);return r=r.replace(/ $/,"%20"),!e&&r.startsWith("//")&&(r=n+r),new URL(r,n)}function fS(t,e,n="/"){return r5(t,e,n,!1)}function r5(t,e,n,r){let i=typeof e=="string"?nc(e):e,o=vi(i.pathname||"/",n);if(o==null)return null;let l=mS(t);s5(l);let d=null;for(let h=0;d==null&&h<l.length;++h){let f=p5(o);d=f5(l[h],f,r)}return d}function mS(t,e=[],n=[],r="",i=!1){let o=(l,d,h=i,f)=>{let p={relativePath:f===void 0?l.path||"":f,caseSensitive:l.caseSensitive===!0,childrenIndex:d,route:l};if(p.relativePath.startsWith("/")){if(!p.relativePath.startsWith(r)&&h)return;Zt(p.relativePath.startsWith(r),`Absolute route path "${p.relativePath}" nested under path "${r}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),p.relativePath=p.relativePath.slice(r.length)}let g=_i([r,p.relativePath]),v=n.concat(p);l.children&&l.children.length>0&&(Zt(l.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${g}".`),mS(l.children,e,v,g,h)),!(l.path==null&&!l.index)&&e.push({path:g,score:d5(g,l.index),routesMeta:v})};return t.forEach((l,d)=>{if(l.path===""||!l.path?.includes("?"))o(l,d);else for(let h of pS(l.path))o(l,d,!0,h)}),e}function pS(t){let e=t.split("/");if(e.length===0)return[];let[n,...r]=e,i=n.endsWith("?"),o=n.replace(/\?$/,"");if(r.length===0)return i?[o,""]:[o];let l=pS(r.join("/")),d=[];return d.push(...l.map(h=>h===""?o:[o,h].join("/"))),i&&d.push(...l),d.map(h=>t.startsWith("/")&&h===""?"/":h)}function s5(t){t.sort((e,n)=>e.score!==n.score?n.score-e.score:h5(e.routesMeta.map(r=>r.childrenIndex),n.routesMeta.map(r=>r.childrenIndex)))}var i5=/^:[\w-]+$/,a5=3,o5=2,l5=1,c5=10,u5=-2,zx=t=>t==="*";function d5(t,e){let n=t.split("/"),r=n.length;return n.some(zx)&&(r+=u5),e&&(r+=o5),n.filter(i=>!zx(i)).reduce((i,o)=>i+(i5.test(o)?a5:o===""?l5:c5),r)}function h5(t,e){return t.length===e.length&&t.slice(0,-1).every((r,i)=>r===e[i])?t[t.length-1]-e[e.length-1]:0}function f5(t,e,n=!1){let{routesMeta:r}=t,i={},o="/",l=[];for(let d=0;d<r.length;++d){let h=r[d],f=d===r.length-1,p=o==="/"?e:e.slice(o.length)||"/",g=cf({path:h.relativePath,caseSensitive:h.caseSensitive,end:f},p),v=h.route;if(!g&&f&&n&&!r[r.length-1].route.index&&(g=cf({path:h.relativePath,caseSensitive:h.caseSensitive,end:!1},p)),!g)return null;Object.assign(i,g.params),l.push({params:i,pathname:_i([o,g.pathname]),pathnameBase:b5(_i([o,g.pathnameBase])),route:v}),g.pathnameBase!=="/"&&(o=_i([o,g.pathnameBase]))}return l}function cf(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,r]=m5(t.path,t.caseSensitive,t.end),i=e.match(n);if(!i)return null;let o=i[0],l=o.replace(/(.)\/+$/,"$1"),d=i.slice(1);return{params:r.reduce((f,{paramName:p,isOptional:g},v)=>{if(p==="*"){let C=d[v]||"";l=o.slice(0,o.length-C.length).replace(/(.)\/+$/,"$1")}const _=d[v];return g&&!_?f[p]=void 0:f[p]=(_||"").replace(/%2F/g,"/"),f},{}),pathname:o,pathnameBase:l,pattern:t}}function m5(t,e=!1,n=!0){Ir(t==="*"||!t.endsWith("*")||t.endsWith("/*"),`Route path "${t}" will be treated as if it were "${t.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${t.replace(/\*$/,"/*")}".`);let r=[],i="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(l,d,h)=>(r.push({paramName:d,isOptional:h!=null}),h?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return t.endsWith("*")?(r.push({paramName:"*"}),i+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?i+="\\/*$":t!==""&&t!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,e?void 0:"i"),r]}function p5(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return Ir(!1,`The URL path "${t}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),t}}function vi(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,r=t.charAt(n);return r&&r!=="/"?null:t.slice(n)||"/"}var gS=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,g5=t=>gS.test(t);function y5(t,e="/"){let{pathname:n,search:r="",hash:i=""}=typeof t=="string"?nc(t):t,o;if(n)if(g5(n))o=n;else{if(n.includes("//")){let l=n;n=n.replace(/\/\/+/g,"/"),Ir(!1,`Pathnames cannot have embedded double slashes - normalizing ${l} -> ${n}`)}n.startsWith("/")?o=Lx(n.substring(1),"/"):o=Lx(n,e)}else o=e;return{pathname:o,search:v5(r),hash:x5(i)}}function Lx(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(i=>{i===".."?n.length>1&&n.pop():i!=="."&&n.push(i)}),n.length>1?n.join("/"):"/"}function kg(t,e,n,r){return`Cannot include a '${t}' character in a manually specified \`to.${e}\` field [${JSON.stringify(r)}].  Please separate it out to the \`to.${n}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function _5(t){return t.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function zy(t){let e=_5(t);return e.map((n,r)=>r===e.length-1?n.pathname:n.pathnameBase)}function Ly(t,e,n,r=!1){let i;typeof t=="string"?i=nc(t):(i={...t},Zt(!i.pathname||!i.pathname.includes("?"),kg("?","pathname","search",i)),Zt(!i.pathname||!i.pathname.includes("#"),kg("#","pathname","hash",i)),Zt(!i.search||!i.search.includes("#"),kg("#","search","hash",i)));let o=t===""||i.pathname==="",l=o?"/":i.pathname,d;if(l==null)d=n;else{let g=e.length-1;if(!r&&l.startsWith("..")){let v=l.split("/");for(;v[0]==="..";)v.shift(),g-=1;i.pathname=v.join("/")}d=g>=0?e[g]:"/"}let h=y5(i,d),f=l&&l!=="/"&&l.endsWith("/"),p=(o||l===".")&&n.endsWith("/");return!h.pathname.endsWith("/")&&(f||p)&&(h.pathname+="/"),h}var _i=t=>t.join("/").replace(/\/\/+/g,"/"),b5=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),v5=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,x5=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t,w5=class{constructor(t,e,n,r=!1){this.status=t,this.statusText=e||"",this.internal=r,n instanceof Error?(this.data=n.toString(),this.error=n):this.data=n}};function S5(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}function C5(t){return t.map(e=>e.route.path).filter(Boolean).join("/").replace(/\/\/*/g,"/")||"/"}var yS=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function _S(t,e){let n=t;if(typeof n!="string"||!gS.test(n))return{absoluteURL:void 0,isExternal:!1,to:n};let r=n,i=!1;if(yS)try{let o=new URL(window.location.href),l=n.startsWith("//")?new URL(o.protocol+n):new URL(n),d=vi(l.pathname,e);l.origin===o.origin&&d!=null?n=d+l.search+l.hash:i=!0}catch{Ir(!1,`<Link to="${n}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}return{absoluteURL:r,isExternal:i,to:n}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var bS=["POST","PUT","PATCH","DELETE"];new Set(bS);var E5=["GET",...bS];new Set(E5);var rc=k.createContext(null);rc.displayName="DataRouter";var Lf=k.createContext(null);Lf.displayName="DataRouterState";var T5=k.createContext(!1),vS=k.createContext({isTransitioning:!1});vS.displayName="ViewTransition";var A5=k.createContext(new Map);A5.displayName="Fetchers";var j5=k.createContext(null);j5.displayName="Await";var kr=k.createContext(null);kr.displayName="Navigation";var Yu=k.createContext(null);Yu.displayName="Location";var Kr=k.createContext({outlet:null,matches:[],isDataRoute:!1});Kr.displayName="Route";var Uy=k.createContext(null);Uy.displayName="RouteError";var xS="REACT_ROUTER_ERROR",R5="REDIRECT",I5="ROUTE_ERROR_RESPONSE";function k5(t){if(t.startsWith(`${xS}:${R5}:{`))try{let e=JSON.parse(t.slice(28));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.location=="string"&&typeof e.reloadDocument=="boolean"&&typeof e.replace=="boolean")return e}catch{}}function D5(t){if(t.startsWith(`${xS}:${I5}:{`))try{let e=JSON.parse(t.slice(40));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string")return new w5(e.status,e.statusText,e.data)}catch{}}function M5(t,{relative:e}={}){Zt(sc(),"useHref() may be used only in the context of a <Router> component.");let{basename:n,navigator:r}=k.useContext(kr),{hash:i,pathname:o,search:l}=Zu(t,{relative:e}),d=o;return n!=="/"&&(d=o==="/"?n:_i([n,o])),r.createHref({pathname:d,search:l,hash:i})}function sc(){return k.useContext(Yu)!=null}function tr(){return Zt(sc(),"useLocation() may be used only in the context of a <Router> component."),k.useContext(Yu).location}var wS="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function SS(t){k.useContext(kr).static||k.useLayoutEffect(t)}function Xu(){let{isDataRoute:t}=k.useContext(Kr);return t?K5():O5()}function O5(){Zt(sc(),"useNavigate() may be used only in the context of a <Router> component.");let t=k.useContext(rc),{basename:e,navigator:n}=k.useContext(kr),{matches:r}=k.useContext(Kr),{pathname:i}=tr(),o=JSON.stringify(zy(r)),l=k.useRef(!1);return SS(()=>{l.current=!0}),k.useCallback((h,f={})=>{if(Ir(l.current,wS),!l.current)return;if(typeof h=="number"){n.go(h);return}let p=Ly(h,JSON.parse(o),i,f.relative==="path");t==null&&e!=="/"&&(p.pathname=p.pathname==="/"?e:_i([e,p.pathname])),(f.replace?n.replace:n.push)(p,f.state,f)},[e,n,o,i,t])}var N5=k.createContext(null);function P5(t){let e=k.useContext(Kr).outlet;return k.useMemo(()=>e&&k.createElement(N5.Provider,{value:t},e),[e,t])}function B5(){let{matches:t}=k.useContext(Kr),e=t[t.length-1];return e?e.params:{}}function Zu(t,{relative:e}={}){let{matches:n}=k.useContext(Kr),{pathname:r}=tr(),i=JSON.stringify(zy(n));return k.useMemo(()=>Ly(t,JSON.parse(i),r,e==="path"),[t,i,r,e])}function z5(t,e){return CS(t,e)}function CS(t,e,n,r,i){Zt(sc(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:o}=k.useContext(kr),{matches:l}=k.useContext(Kr),d=l[l.length-1],h=d?d.params:{},f=d?d.pathname:"/",p=d?d.pathnameBase:"/",g=d&&d.route;{let T=g&&g.path||"";TS(f,!g||T.endsWith("*")||T.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${f}" (under <Route path="${T}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${T}"> to <Route path="${T==="/"?"*":`${T}/*`}">.`)}let v=tr(),_;if(e){let T=typeof e=="string"?nc(e):e;Zt(p==="/"||T.pathname?.startsWith(p),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${p}" but pathname "${T.pathname}" was given in the \`location\` prop.`),_=T}else _=v;let C=_.pathname||"/",x=C;if(p!=="/"){let T=p.replace(/^\//,"").split("/");x="/"+C.replace(/^\//,"").split("/").slice(T.length).join("/")}let w=fS(t,{pathname:x});Ir(g||w!=null,`No routes matched location "${_.pathname}${_.search}${_.hash}" `),Ir(w==null||w[w.length-1].route.element!==void 0||w[w.length-1].route.Component!==void 0||w[w.length-1].route.lazy!==void 0,`Matched leaf route at location "${_.pathname}${_.search}${_.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let E=$5(w&&w.map(T=>Object.assign({},T,{params:Object.assign({},h,T.params),pathname:_i([p,o.encodeLocation?o.encodeLocation(T.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:T.pathname]),pathnameBase:T.pathnameBase==="/"?p:_i([p,o.encodeLocation?o.encodeLocation(T.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:T.pathnameBase])})),l,n,r,i);return e&&E?k.createElement(Yu.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",..._},navigationType:"POP"}},E):E}function L5(){let t=Q5(),e=S5(t)?`${t.status} ${t.statusText}`:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,r="rgba(200,200,200, 0.5)",i={padding:"0.5rem",backgroundColor:r},o={padding:"2px 4px",backgroundColor:r},l=null;return console.error("Error handled by React Router default ErrorBoundary:",t),l=k.createElement(k.Fragment,null,k.createElement("p",null," Hey developer "),k.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",k.createElement("code",{style:o},"ErrorBoundary")," or"," ",k.createElement("code",{style:o},"errorElement")," prop on your route.")),k.createElement(k.Fragment,null,k.createElement("h2",null,"Unexpected Application Error!"),k.createElement("h3",{style:{fontStyle:"italic"}},e),n?k.createElement("pre",{style:i},n):null,l)}var U5=k.createElement(L5,null),ES=class extends k.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,e){return e.location!==t.location||e.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:e.error,location:e.location,revalidation:t.revalidation||e.revalidation}}componentDidCatch(t,e){this.props.onError?this.props.onError(t,e):console.error("React Router caught the following error during render",t)}render(){let t=this.state.error;if(this.context&&typeof t=="object"&&t&&"digest"in t&&typeof t.digest=="string"){const n=D5(t.digest);n&&(t=n)}let e=t!==void 0?k.createElement(Kr.Provider,{value:this.props.routeContext},k.createElement(Uy.Provider,{value:t,children:this.props.component})):this.props.children;return this.context?k.createElement(F5,{error:t},e):e}};ES.contextType=T5;var Dg=new WeakMap;function F5({children:t,error:e}){let{basename:n}=k.useContext(kr);if(typeof e=="object"&&e&&"digest"in e&&typeof e.digest=="string"){let r=k5(e.digest);if(r){let i=Dg.get(e);if(i)throw i;let o=_S(r.location,n);if(yS&&!Dg.get(e))if(o.isExternal||r.reloadDocument)window.location.href=o.absoluteURL||o.to;else{const l=Promise.resolve().then(()=>window.__reactRouterDataRouter.navigate(o.to,{replace:r.replace}));throw Dg.set(e,l),l}return k.createElement("meta",{httpEquiv:"refresh",content:`0;url=${o.absoluteURL||o.to}`})}}return t}function V5({routeContext:t,match:e,children:n}){let r=k.useContext(rc);return r&&r.static&&r.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=e.route.id),k.createElement(Kr.Provider,{value:t},n)}function $5(t,e=[],n=null,r=null,i=null){if(t==null){if(!n)return null;if(n.errors)t=n.matches;else if(e.length===0&&!n.initialized&&n.matches.length>0)t=n.matches;else return null}let o=t,l=n?.errors;if(l!=null){let p=o.findIndex(g=>g.route.id&&l?.[g.route.id]!==void 0);Zt(p>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(l).join(",")}`),o=o.slice(0,Math.min(o.length,p+1))}let d=!1,h=-1;if(n)for(let p=0;p<o.length;p++){let g=o[p];if((g.route.HydrateFallback||g.route.hydrateFallbackElement)&&(h=p),g.route.id){let{loaderData:v,errors:_}=n,C=g.route.loader&&!v.hasOwnProperty(g.route.id)&&(!_||_[g.route.id]===void 0);if(g.route.lazy||C){d=!0,h>=0?o=o.slice(0,h+1):o=[o[0]];break}}}let f=n&&r?(p,g)=>{r(p,{location:n.location,params:n.matches?.[0]?.params??{},unstable_pattern:C5(n.matches),errorInfo:g})}:void 0;return o.reduceRight((p,g,v)=>{let _,C=!1,x=null,w=null;n&&(_=l&&g.route.id?l[g.route.id]:void 0,x=g.route.errorElement||U5,d&&(h<0&&v===0?(TS("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),C=!0,w=null):h===v&&(C=!0,w=g.route.hydrateFallbackElement||null)));let E=e.concat(o.slice(0,v+1)),T=()=>{let R;return _?R=x:C?R=w:g.route.Component?R=k.createElement(g.route.Component,null):g.route.element?R=g.route.element:R=p,k.createElement(V5,{match:g,routeContext:{outlet:p,matches:E,isDataRoute:n!=null},children:R})};return n&&(g.route.ErrorBoundary||g.route.errorElement||v===0)?k.createElement(ES,{location:n.location,revalidation:n.revalidation,component:x,error:_,children:T(),routeContext:{outlet:null,matches:E,isDataRoute:!0},onError:f}):T()},null)}function Fy(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function q5(t){let e=k.useContext(rc);return Zt(e,Fy(t)),e}function H5(t){let e=k.useContext(Lf);return Zt(e,Fy(t)),e}function G5(t){let e=k.useContext(Kr);return Zt(e,Fy(t)),e}function Vy(t){let e=G5(t),n=e.matches[e.matches.length-1];return Zt(n.route.id,`${t} can only be used on routes that contain a unique "id"`),n.route.id}function W5(){return Vy("useRouteId")}function Q5(){let t=k.useContext(Uy),e=H5("useRouteError"),n=Vy("useRouteError");return t!==void 0?t:e.errors?.[n]}function K5(){let{router:t}=q5("useNavigate"),e=Vy("useNavigate"),n=k.useRef(!1);return SS(()=>{n.current=!0}),k.useCallback(async(i,o={})=>{Ir(n.current,wS),n.current&&(typeof i=="number"?await t.navigate(i):await t.navigate(i,{fromRouteId:e,...o}))},[t,e])}var Ux={};function TS(t,e,n){!e&&!Ux[t]&&(Ux[t]=!0,Ir(!1,n))}k.memo(Y5);function Y5({routes:t,future:e,state:n,onError:r}){return CS(t,void 0,n,r,e)}function Uf({to:t,replace:e,state:n,relative:r}){Zt(sc(),"<Navigate> may be used only in the context of a <Router> component.");let{static:i}=k.useContext(kr);Ir(!i,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:o}=k.useContext(Kr),{pathname:l}=tr(),d=Xu(),h=Ly(t,zy(o),l,r==="path"),f=JSON.stringify(h);return k.useEffect(()=>{d(JSON.parse(f),{replace:e,state:n,relative:r})},[d,f,r,e,n]),null}function Ff(t){return P5(t.context)}function Cn(t){Zt(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function X5({basename:t="/",children:e=null,location:n,navigationType:r="POP",navigator:i,static:o=!1,unstable_useTransitions:l}){Zt(!sc(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let d=t.replace(/^\/*/,"/"),h=k.useMemo(()=>({basename:d,navigator:i,static:o,unstable_useTransitions:l,future:{}}),[d,i,o,l]);typeof n=="string"&&(n=nc(n));let{pathname:f="/",search:p="",hash:g="",state:v=null,key:_="default"}=n,C=k.useMemo(()=>{let x=vi(f,d);return x==null?null:{location:{pathname:x,search:p,hash:g,state:v,key:_},navigationType:r}},[d,f,p,g,v,_,r]);return Ir(C!=null,`<Router basename="${d}"> is not able to match the URL "${f}${p}${g}" because it does not start with the basename, so the <Router> won't render anything.`),C==null?null:k.createElement(kr.Provider,{value:h},k.createElement(Yu.Provider,{children:e,value:C}))}function Z5({children:t,location:e}){return z5(ey(t),e)}function ey(t,e=[]){let n=[];return k.Children.forEach(t,(r,i)=>{if(!k.isValidElement(r))return;let o=[...e,i];if(r.type===k.Fragment){n.push.apply(n,ey(r.props.children,o));return}Zt(r.type===Cn,`[${typeof r.type=="string"?r.type:r.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),Zt(!r.props.index||!r.props.children,"An index route cannot have child routes.");let l={id:r.props.id||o.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,middleware:r.props.middleware,loader:r.props.loader,action:r.props.action,hydrateFallbackElement:r.props.hydrateFallbackElement,HydrateFallback:r.props.HydrateFallback,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.hasErrorBoundary===!0||r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(l.children=ey(r.props.children,o)),n.push(l)}),n}var Yh="get",Xh="application/x-www-form-urlencoded";function Vf(t){return typeof HTMLElement<"u"&&t instanceof HTMLElement}function J5(t){return Vf(t)&&t.tagName.toLowerCase()==="button"}function ej(t){return Vf(t)&&t.tagName.toLowerCase()==="form"}function tj(t){return Vf(t)&&t.tagName.toLowerCase()==="input"}function nj(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function rj(t,e){return t.button===0&&(!e||e==="_self")&&!nj(t)}function ty(t=""){return new URLSearchParams(typeof t=="string"||Array.isArray(t)||t instanceof URLSearchParams?t:Object.keys(t).reduce((e,n)=>{let r=t[n];return e.concat(Array.isArray(r)?r.map(i=>[n,i]):[[n,r]])},[]))}function sj(t,e){let n=ty(t);return e&&e.forEach((r,i)=>{n.has(i)||e.getAll(i).forEach(o=>{n.append(i,o)})}),n}var Uh=null;function ij(){if(Uh===null)try{new FormData(document.createElement("form"),0),Uh=!1}catch{Uh=!0}return Uh}var aj=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function Mg(t){return t!=null&&!aj.has(t)?(Ir(!1,`"${t}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${Xh}"`),null):t}function oj(t,e){let n,r,i,o,l;if(ej(t)){let d=t.getAttribute("action");r=d?vi(d,e):null,n=t.getAttribute("method")||Yh,i=Mg(t.getAttribute("enctype"))||Xh,o=new FormData(t)}else if(J5(t)||tj(t)&&(t.type==="submit"||t.type==="image")){let d=t.form;if(d==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let h=t.getAttribute("formaction")||d.getAttribute("action");if(r=h?vi(h,e):null,n=t.getAttribute("formmethod")||d.getAttribute("method")||Yh,i=Mg(t.getAttribute("formenctype"))||Mg(d.getAttribute("enctype"))||Xh,o=new FormData(d,t),!ij()){let{name:f,type:p,value:g}=t;if(p==="image"){let v=f?`${f}.`:"";o.append(`${v}x`,"0"),o.append(`${v}y`,"0")}else f&&o.append(f,g)}}else{if(Vf(t))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');n=Yh,r=null,i=Xh,l=t}return o&&i==="text/plain"&&(l=o,o=void 0),{action:r,method:n.toLowerCase(),encType:i,formData:o,body:l}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function $y(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function lj(t,e,n){let r=typeof t=="string"?new URL(t,typeof window>"u"?"server://singlefetch/":window.location.origin):t;return r.pathname==="/"?r.pathname=`_root.${n}`:e&&vi(r.pathname,e)==="/"?r.pathname=`${e.replace(/\/$/,"")}/_root.${n}`:r.pathname=`${r.pathname.replace(/\/$/,"")}.${n}`,r}async function cj(t,e){if(t.id in e)return e[t.id];try{let n=await import(t.module);return e[t.id]=n,n}catch(n){return console.error(`Error loading route module \`${t.module}\`, reloading page...`),console.error(n),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function uj(t){return t==null?!1:t.href==null?t.rel==="preload"&&typeof t.imageSrcSet=="string"&&typeof t.imageSizes=="string":typeof t.rel=="string"&&typeof t.href=="string"}async function dj(t,e,n){let r=await Promise.all(t.map(async i=>{let o=e.routes[i.route.id];if(o){let l=await cj(o,n);return l.links?l.links():[]}return[]}));return pj(r.flat(1).filter(uj).filter(i=>i.rel==="stylesheet"||i.rel==="preload").map(i=>i.rel==="stylesheet"?{...i,rel:"prefetch",as:"style"}:{...i,rel:"prefetch"}))}function Fx(t,e,n,r,i,o){let l=(h,f)=>n[f]?h.route.id!==n[f].route.id:!0,d=(h,f)=>n[f].pathname!==h.pathname||n[f].route.path?.endsWith("*")&&n[f].params["*"]!==h.params["*"];return o==="assets"?e.filter((h,f)=>l(h,f)||d(h,f)):o==="data"?e.filter((h,f)=>{let p=r.routes[h.route.id];if(!p||!p.hasLoader)return!1;if(l(h,f)||d(h,f))return!0;if(h.route.shouldRevalidate){let g=h.route.shouldRevalidate({currentUrl:new URL(i.pathname+i.search+i.hash,window.origin),currentParams:n[0]?.params||{},nextUrl:new URL(t,window.origin),nextParams:h.params,defaultShouldRevalidate:!0});if(typeof g=="boolean")return g}return!0}):[]}function hj(t,e,{includeHydrateFallback:n}={}){return fj(t.map(r=>{let i=e.routes[r.route.id];if(!i)return[];let o=[i.module];return i.clientActionModule&&(o=o.concat(i.clientActionModule)),i.clientLoaderModule&&(o=o.concat(i.clientLoaderModule)),n&&i.hydrateFallbackModule&&(o=o.concat(i.hydrateFallbackModule)),i.imports&&(o=o.concat(i.imports)),o}).flat(1))}function fj(t){return[...new Set(t)]}function mj(t){let e={},n=Object.keys(t).sort();for(let r of n)e[r]=t[r];return e}function pj(t,e){let n=new Set;return new Set(e),t.reduce((r,i)=>{let o=JSON.stringify(mj(i));return n.has(o)||(n.add(o),r.push({key:o,link:i})),r},[])}function AS(){let t=k.useContext(rc);return $y(t,"You must render this element inside a <DataRouterContext.Provider> element"),t}function gj(){let t=k.useContext(Lf);return $y(t,"You must render this element inside a <DataRouterStateContext.Provider> element"),t}var qy=k.createContext(void 0);qy.displayName="FrameworkContext";function jS(){let t=k.useContext(qy);return $y(t,"You must render this element inside a <HydratedRouter> element"),t}function yj(t,e){let n=k.useContext(qy),[r,i]=k.useState(!1),[o,l]=k.useState(!1),{onFocus:d,onBlur:h,onMouseEnter:f,onMouseLeave:p,onTouchStart:g}=e,v=k.useRef(null);k.useEffect(()=>{if(t==="render"&&l(!0),t==="viewport"){let x=E=>{E.forEach(T=>{l(T.isIntersecting)})},w=new IntersectionObserver(x,{threshold:.5});return v.current&&w.observe(v.current),()=>{w.disconnect()}}},[t]),k.useEffect(()=>{if(r){let x=setTimeout(()=>{l(!0)},100);return()=>{clearTimeout(x)}}},[r]);let _=()=>{i(!0)},C=()=>{i(!1),l(!1)};return n?t!=="intent"?[o,v,{}]:[o,v,{onFocus:vu(d,_),onBlur:vu(h,C),onMouseEnter:vu(f,_),onMouseLeave:vu(p,C),onTouchStart:vu(g,_)}]:[!1,v,{}]}function vu(t,e){return n=>{t&&t(n),n.defaultPrevented||e(n)}}function _j({page:t,...e}){let{router:n}=AS(),r=k.useMemo(()=>fS(n.routes,t,n.basename),[n.routes,t,n.basename]);return r?k.createElement(vj,{page:t,matches:r,...e}):null}function bj(t){let{manifest:e,routeModules:n}=jS(),[r,i]=k.useState([]);return k.useEffect(()=>{let o=!1;return dj(t,e,n).then(l=>{o||i(l)}),()=>{o=!0}},[t,e,n]),r}function vj({page:t,matches:e,...n}){let r=tr(),{manifest:i,routeModules:o}=jS(),{basename:l}=AS(),{loaderData:d,matches:h}=gj(),f=k.useMemo(()=>Fx(t,e,h,i,r,"data"),[t,e,h,i,r]),p=k.useMemo(()=>Fx(t,e,h,i,r,"assets"),[t,e,h,i,r]),g=k.useMemo(()=>{if(t===r.pathname+r.search+r.hash)return[];let C=new Set,x=!1;if(e.forEach(E=>{let T=i.routes[E.route.id];!T||!T.hasLoader||(!f.some(R=>R.route.id===E.route.id)&&E.route.id in d&&o[E.route.id]?.shouldRevalidate||T.hasClientLoader?x=!0:C.add(E.route.id))}),C.size===0)return[];let w=lj(t,l,"data");return x&&C.size>0&&w.searchParams.set("_routes",e.filter(E=>C.has(E.route.id)).map(E=>E.route.id).join(",")),[w.pathname+w.search]},[l,d,r,i,f,e,t,o]),v=k.useMemo(()=>hj(p,i),[p,i]),_=bj(p);return k.createElement(k.Fragment,null,g.map(C=>k.createElement("link",{key:C,rel:"prefetch",as:"fetch",href:C,...n})),v.map(C=>k.createElement("link",{key:C,rel:"modulepreload",href:C,...n})),_.map(({key:C,link:x})=>k.createElement("link",{key:C,nonce:n.nonce,...x})))}function xj(...t){return e=>{t.forEach(n=>{typeof n=="function"?n(e):n!=null&&(n.current=e)})}}var wj=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{wj&&(window.__reactRouterVersion="7.11.0")}catch{}function Sj({basename:t,children:e,unstable_useTransitions:n,window:r}){let i=k.useRef();i.current==null&&(i.current=J2({window:r,v5Compat:!0}));let o=i.current,[l,d]=k.useState({action:o.action,location:o.location}),h=k.useCallback(f=>{n===!1?d(f):k.startTransition(()=>d(f))},[n]);return k.useLayoutEffect(()=>o.listen(h),[o,h]),k.createElement(X5,{basename:t,children:e,location:l.location,navigationType:l.action,navigator:o,unstable_useTransitions:n})}var RS=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Tn=k.forwardRef(function({onClick:e,discover:n="render",prefetch:r="none",relative:i,reloadDocument:o,replace:l,state:d,target:h,to:f,preventScrollReset:p,viewTransition:g,unstable_defaultShouldRevalidate:v,..._},C){let{basename:x,unstable_useTransitions:w}=k.useContext(kr),E=typeof f=="string"&&RS.test(f),T=_S(f,x);f=T.to;let R=M5(f,{relative:i}),[M,V,$]=yj(r,_),I=Aj(f,{replace:l,state:d,target:h,preventScrollReset:p,relative:i,viewTransition:g,unstable_defaultShouldRevalidate:v,unstable_useTransitions:w});function D(L){e&&e(L),L.defaultPrevented||I(L)}let P=k.createElement("a",{..._,...$,href:T.absoluteURL||R,onClick:T.isExternal||o?e:D,ref:xj(C,V),target:h,"data-discover":!E&&n==="render"?"true":void 0});return M&&!E?k.createElement(k.Fragment,null,P,k.createElement(_j,{page:R})):P});Tn.displayName="Link";var Cj=k.forwardRef(function({"aria-current":e="page",caseSensitive:n=!1,className:r="",end:i=!1,style:o,to:l,viewTransition:d,children:h,...f},p){let g=Zu(l,{relative:f.relative}),v=tr(),_=k.useContext(Lf),{navigator:C,basename:x}=k.useContext(kr),w=_!=null&&Dj(g)&&d===!0,E=C.encodeLocation?C.encodeLocation(g).pathname:g.pathname,T=v.pathname,R=_&&_.navigation&&_.navigation.location?_.navigation.location.pathname:null;n||(T=T.toLowerCase(),R=R?R.toLowerCase():null,E=E.toLowerCase()),R&&x&&(R=vi(R,x)||R);const M=E!=="/"&&E.endsWith("/")?E.length-1:E.length;let V=T===E||!i&&T.startsWith(E)&&T.charAt(M)==="/",$=R!=null&&(R===E||!i&&R.startsWith(E)&&R.charAt(E.length)==="/"),I={isActive:V,isPending:$,isTransitioning:w},D=V?e:void 0,P;typeof r=="function"?P=r(I):P=[r,V?"active":null,$?"pending":null,w?"transitioning":null].filter(Boolean).join(" ");let L=typeof o=="function"?o(I):o;return k.createElement(Tn,{...f,"aria-current":D,className:P,ref:p,style:L,to:l,viewTransition:d},typeof h=="function"?h(I):h)});Cj.displayName="NavLink";var Ej=k.forwardRef(({discover:t="render",fetcherKey:e,navigate:n,reloadDocument:r,replace:i,state:o,method:l=Yh,action:d,onSubmit:h,relative:f,preventScrollReset:p,viewTransition:g,unstable_defaultShouldRevalidate:v,..._},C)=>{let{unstable_useTransitions:x}=k.useContext(kr),w=Ij(),E=kj(d,{relative:f}),T=l.toLowerCase()==="get"?"get":"post",R=typeof d=="string"&&RS.test(d),M=V=>{if(h&&h(V),V.defaultPrevented)return;V.preventDefault();let $=V.nativeEvent.submitter,I=$?.getAttribute("formmethod")||l,D=()=>w($||V.currentTarget,{fetcherKey:e,method:I,navigate:n,replace:i,state:o,relative:f,preventScrollReset:p,viewTransition:g,unstable_defaultShouldRevalidate:v});x&&n!==!1?k.startTransition(()=>D()):D()};return k.createElement("form",{ref:C,method:T,action:E,onSubmit:r?h:M,..._,"data-discover":!R&&t==="render"?"true":void 0})});Ej.displayName="Form";function Tj(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function IS(t){let e=k.useContext(rc);return Zt(e,Tj(t)),e}function Aj(t,{target:e,replace:n,state:r,preventScrollReset:i,relative:o,viewTransition:l,unstable_defaultShouldRevalidate:d,unstable_useTransitions:h}={}){let f=Xu(),p=tr(),g=Zu(t,{relative:o});return k.useCallback(v=>{if(rj(v,e)){v.preventDefault();let _=n!==void 0?n:Mu(p)===Mu(g),C=()=>f(t,{replace:_,state:r,preventScrollReset:i,relative:o,viewTransition:l,unstable_defaultShouldRevalidate:d});h?k.startTransition(()=>C()):C()}},[p,f,g,n,r,e,t,i,o,l,d,h])}function kS(t){Ir(typeof URLSearchParams<"u","You cannot use the `useSearchParams` hook in a browser that does not support the URLSearchParams API. If you need to support Internet Explorer 11, we recommend you load a polyfill such as https://github.com/ungap/url-search-params.");let e=k.useRef(ty(t)),n=k.useRef(!1),r=tr(),i=k.useMemo(()=>sj(r.search,n.current?null:e.current),[r.search]),o=Xu(),l=k.useCallback((d,h)=>{const f=ty(typeof d=="function"?d(new URLSearchParams(i)):d);n.current=!0,o("?"+f,h)},[o,i]);return[i,l]}var jj=0,Rj=()=>`__${String(++jj)}__`;function Ij(){let{router:t}=IS("useSubmit"),{basename:e}=k.useContext(kr),n=W5(),r=t.fetch,i=t.navigate;return k.useCallback(async(o,l={})=>{let{action:d,method:h,encType:f,formData:p,body:g}=oj(o,e);if(l.navigate===!1){let v=l.fetcherKey||Rj();await r(v,n,l.action||d,{unstable_defaultShouldRevalidate:l.unstable_defaultShouldRevalidate,preventScrollReset:l.preventScrollReset,formData:p,body:g,formMethod:l.method||h,formEncType:l.encType||f,flushSync:l.flushSync})}else await i(l.action||d,{unstable_defaultShouldRevalidate:l.unstable_defaultShouldRevalidate,preventScrollReset:l.preventScrollReset,formData:p,body:g,formMethod:l.method||h,formEncType:l.encType||f,replace:l.replace,state:l.state,fromRouteId:n,flushSync:l.flushSync,viewTransition:l.viewTransition})},[r,i,e,n])}function kj(t,{relative:e}={}){let{basename:n}=k.useContext(kr),r=k.useContext(Kr);Zt(r,"useFormAction must be used inside a RouteContext");let[i]=r.matches.slice(-1),o={...Zu(t||".",{relative:e})},l=tr();if(t==null){o.search=l.search;let d=new URLSearchParams(o.search),h=d.getAll("index");if(h.some(p=>p==="")){d.delete("index"),h.filter(g=>g).forEach(g=>d.append("index",g));let p=d.toString();o.search=p?`?${p}`:""}}return(!t||t===".")&&i.route.index&&(o.search=o.search?o.search.replace(/^\?/,"?index&"):"?index"),n!=="/"&&(o.pathname=o.pathname==="/"?n:_i([n,o.pathname])),Mu(o)}function Dj(t,{relative:e}={}){let n=k.useContext(vS);Zt(n!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:r}=IS("useViewTransitionState"),i=Zu(t,{relative:e});if(!n.isTransitioning)return!1;let o=vi(n.currentLocation.pathname,r)||n.currentLocation.pathname,l=vi(n.nextLocation.pathname,r)||n.nextLocation.pathname;return cf(i.pathname,l)!=null||cf(i.pathname,o)!=null}var ic=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(t){return this.listeners.add(t),this.onSubscribe(),()=>{this.listeners.delete(t),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},Mj={setTimeout:(t,e)=>setTimeout(t,e),clearTimeout:t=>clearTimeout(t),setInterval:(t,e)=>setInterval(t,e),clearInterval:t=>clearInterval(t)},Oj=class{#e=Mj;#t=!1;setTimeoutProvider(t){this.#e=t}setTimeout(t,e){return this.#e.setTimeout(t,e)}clearTimeout(t){this.#e.clearTimeout(t)}setInterval(t,e){return this.#e.setInterval(t,e)}clearInterval(t){this.#e.clearInterval(t)}},So=new Oj;function Nj(t){setTimeout(t,0)}var Ro=typeof window>"u"||"Deno"in globalThis;function ar(){}function Pj(t,e){return typeof t=="function"?t(e):t}function ny(t){return typeof t=="number"&&t>=0&&t!==1/0}function DS(t,e){return Math.max(t+(e||0)-Date.now(),0)}function va(t,e){return typeof t=="function"?t(e):t}function Gr(t,e){return typeof t=="function"?t(e):t}function Vx(t,e){const{type:n="all",exact:r,fetchStatus:i,predicate:o,queryKey:l,stale:d}=t;if(l){if(r){if(e.queryHash!==Hy(l,e.options))return!1}else if(!Ou(e.queryKey,l))return!1}if(n!=="all"){const h=e.isActive();if(n==="active"&&!h||n==="inactive"&&h)return!1}return!(typeof d=="boolean"&&e.isStale()!==d||i&&i!==e.state.fetchStatus||o&&!o(e))}function $x(t,e){const{exact:n,status:r,predicate:i,mutationKey:o}=t;if(o){if(!e.options.mutationKey)return!1;if(n){if(Io(e.options.mutationKey)!==Io(o))return!1}else if(!Ou(e.options.mutationKey,o))return!1}return!(r&&e.state.status!==r||i&&!i(e))}function Hy(t,e){return(e?.queryKeyHashFn||Io)(t)}function Io(t){return JSON.stringify(t,(e,n)=>ry(n)?Object.keys(n).sort().reduce((r,i)=>(r[i]=n[i],r),{}):n)}function Ou(t,e){return t===e?!0:typeof t!=typeof e?!1:t&&e&&typeof t=="object"&&typeof e=="object"?Object.keys(e).every(n=>Ou(t[n],e[n])):!1}var Bj=Object.prototype.hasOwnProperty;function MS(t,e){if(t===e)return t;const n=qx(t)&&qx(e);if(!n&&!(ry(t)&&ry(e)))return e;const i=(n?t:Object.keys(t)).length,o=n?e:Object.keys(e),l=o.length,d=n?new Array(l):{};let h=0;for(let f=0;f<l;f++){const p=n?f:o[f],g=t[p],v=e[p];if(g===v){d[p]=g,(n?f<i:Bj.call(t,p))&&h++;continue}if(g===null||v===null||typeof g!="object"||typeof v!="object"){d[p]=v;continue}const _=MS(g,v);d[p]=_,_===g&&h++}return i===l&&h===i?t:d}function uf(t,e){if(!e||Object.keys(t).length!==Object.keys(e).length)return!1;for(const n in t)if(t[n]!==e[n])return!1;return!0}function qx(t){return Array.isArray(t)&&t.length===Object.keys(t).length}function ry(t){if(!Hx(t))return!1;const e=t.constructor;if(e===void 0)return!0;const n=e.prototype;return!(!Hx(n)||!n.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(t)!==Object.prototype)}function Hx(t){return Object.prototype.toString.call(t)==="[object Object]"}function zj(t){return new Promise(e=>{So.setTimeout(e,t)})}function sy(t,e,n){return typeof n.structuralSharing=="function"?n.structuralSharing(t,e):n.structuralSharing!==!1?MS(t,e):e}function Lj(t,e,n=0){const r=[...t,e];return n&&r.length>n?r.slice(1):r}function Uj(t,e,n=0){const r=[e,...t];return n&&r.length>n?r.slice(0,-1):r}var Gy=Symbol();function OS(t,e){return!t.queryFn&&e?.initialPromise?()=>e.initialPromise:!t.queryFn||t.queryFn===Gy?()=>Promise.reject(new Error(`Missing queryFn: '${t.queryHash}'`)):t.queryFn}function NS(t,e){return typeof t=="function"?t(...e):!!t}var Fj=class extends ic{#e;#t;#n;constructor(){super(),this.#n=t=>{if(!Ro&&window.addEventListener){const e=()=>t();return window.addEventListener("visibilitychange",e,!1),()=>{window.removeEventListener("visibilitychange",e)}}}}onSubscribe(){this.#t||this.setEventListener(this.#n)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(t){this.#n=t,this.#t?.(),this.#t=t(e=>{typeof e=="boolean"?this.setFocused(e):this.onFocus()})}setFocused(t){this.#e!==t&&(this.#e=t,this.onFocus())}onFocus(){const t=this.isFocused();this.listeners.forEach(e=>{e(t)})}isFocused(){return typeof this.#e=="boolean"?this.#e:globalThis.document?.visibilityState!=="hidden"}},Wy=new Fj;function iy(){let t,e;const n=new Promise((i,o)=>{t=i,e=o});n.status="pending",n.catch(()=>{});function r(i){Object.assign(n,i),delete n.resolve,delete n.reject}return n.resolve=i=>{r({status:"fulfilled",value:i}),t(i)},n.reject=i=>{r({status:"rejected",reason:i}),e(i)},n}var Vj=Nj;function $j(){let t=[],e=0,n=d=>{d()},r=d=>{d()},i=Vj;const o=d=>{e?t.push(d):i(()=>{n(d)})},l=()=>{const d=t;t=[],d.length&&i(()=>{r(()=>{d.forEach(h=>{n(h)})})})};return{batch:d=>{let h;e++;try{h=d()}finally{e--,e||l()}return h},batchCalls:d=>(...h)=>{o(()=>{d(...h)})},schedule:o,setNotifyFunction:d=>{n=d},setBatchNotifyFunction:d=>{r=d},setScheduler:d=>{i=d}}}var En=$j(),qj=class extends ic{#e=!0;#t;#n;constructor(){super(),this.#n=t=>{if(!Ro&&window.addEventListener){const e=()=>t(!0),n=()=>t(!1);return window.addEventListener("online",e,!1),window.addEventListener("offline",n,!1),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",n)}}}}onSubscribe(){this.#t||this.setEventListener(this.#n)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(t){this.#n=t,this.#t?.(),this.#t=t(this.setOnline.bind(this))}setOnline(t){this.#e!==t&&(this.#e=t,this.listeners.forEach(n=>{n(t)}))}isOnline(){return this.#e}},df=new qj;function Hj(t){return Math.min(1e3*2**t,3e4)}function PS(t){return(t??"online")==="online"?df.isOnline():!0}var ay=class extends Error{constructor(t){super("CancelledError"),this.revert=t?.revert,this.silent=t?.silent}};function BS(t){let e=!1,n=0,r;const i=iy(),o=()=>i.status!=="pending",l=x=>{if(!o()){const w=new ay(x);v(w),t.onCancel?.(w)}},d=()=>{e=!0},h=()=>{e=!1},f=()=>Wy.isFocused()&&(t.networkMode==="always"||df.isOnline())&&t.canRun(),p=()=>PS(t.networkMode)&&t.canRun(),g=x=>{o()||(r?.(),i.resolve(x))},v=x=>{o()||(r?.(),i.reject(x))},_=()=>new Promise(x=>{r=w=>{(o()||f())&&x(w)},t.onPause?.()}).then(()=>{r=void 0,o()||t.onContinue?.()}),C=()=>{if(o())return;let x;const w=n===0?t.initialPromise:void 0;try{x=w??t.fn()}catch(E){x=Promise.reject(E)}Promise.resolve(x).then(g).catch(E=>{if(o())return;const T=t.retry??(Ro?0:3),R=t.retryDelay??Hj,M=typeof R=="function"?R(n,E):R,V=T===!0||typeof T=="number"&&n<T||typeof T=="function"&&T(n,E);if(e||!V){v(E);return}n++,t.onFail?.(n,E),zj(M).then(()=>f()?void 0:_()).then(()=>{e?v(E):C()})})};return{promise:i,status:()=>i.status,cancel:l,continue:()=>(r?.(),i),cancelRetry:d,continueRetry:h,canStart:p,start:()=>(p()?C():_().then(C),i)}}var zS=class{#e;destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),ny(this.gcTime)&&(this.#e=So.setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(t){this.gcTime=Math.max(this.gcTime||0,t??(Ro?1/0:300*1e3))}clearGcTimeout(){this.#e&&(So.clearTimeout(this.#e),this.#e=void 0)}},Gj=class extends zS{#e;#t;#n;#s;#r;#a;#o;constructor(e){super(),this.#o=!1,this.#a=e.defaultOptions,this.setOptions(e.options),this.observers=[],this.#s=e.client,this.#n=this.#s.getQueryCache(),this.queryKey=e.queryKey,this.queryHash=e.queryHash,this.#e=Wx(this.options),this.state=e.state??this.#e,this.scheduleGc()}get meta(){return this.options.meta}get promise(){return this.#r?.promise}setOptions(e){if(this.options={...this.#a,...e},this.updateGcTime(this.options.gcTime),this.state&&this.state.data===void 0){const n=Wx(this.options);n.data!==void 0&&(this.setState(Gx(n.data,n.dataUpdatedAt)),this.#e=n)}}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&this.#n.remove(this)}setData(e,n){const r=sy(this.state.data,e,this.options);return this.#i({data:r,type:"success",dataUpdatedAt:n?.updatedAt,manual:n?.manual}),r}setState(e,n){this.#i({type:"setState",state:e,setStateOptions:n})}cancel(e){const n=this.#r?.promise;return this.#r?.cancel(e),n?n.then(ar).catch(ar):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(this.#e)}isActive(){return this.observers.some(e=>Gr(e.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===Gy||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(e=>va(e.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(e=>e.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(e=0){return this.state.data===void 0?!0:e==="static"?!1:this.state.isInvalidated?!0:!DS(this.state.dataUpdatedAt,e)}onFocus(){this.observers.find(n=>n.shouldFetchOnWindowFocus())?.refetch({cancelRefetch:!1}),this.#r?.continue()}onOnline(){this.observers.find(n=>n.shouldFetchOnReconnect())?.refetch({cancelRefetch:!1}),this.#r?.continue()}addObserver(e){this.observers.includes(e)||(this.observers.push(e),this.clearGcTimeout(),this.#n.notify({type:"observerAdded",query:this,observer:e}))}removeObserver(e){this.observers.includes(e)&&(this.observers=this.observers.filter(n=>n!==e),this.observers.length||(this.#r&&(this.#o?this.#r.cancel({revert:!0}):this.#r.cancelRetry()),this.scheduleGc()),this.#n.notify({type:"observerRemoved",query:this,observer:e}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||this.#i({type:"invalidate"})}async fetch(e,n){if(this.state.fetchStatus!=="idle"&&this.#r?.status()!=="rejected"){if(this.state.data!==void 0&&n?.cancelRefetch)this.cancel({silent:!0});else if(this.#r)return this.#r.continueRetry(),this.#r.promise}if(e&&this.setOptions(e),!this.options.queryFn){const h=this.observers.find(f=>f.options.queryFn);h&&this.setOptions(h.options)}const r=new AbortController,i=h=>{Object.defineProperty(h,"signal",{enumerable:!0,get:()=>(this.#o=!0,r.signal)})},o=()=>{const h=OS(this.options,n),p=(()=>{const g={client:this.#s,queryKey:this.queryKey,meta:this.meta};return i(g),g})();return this.#o=!1,this.options.persister?this.options.persister(h,p,this):h(p)},d=(()=>{const h={fetchOptions:n,options:this.options,queryKey:this.queryKey,client:this.#s,state:this.state,fetchFn:o};return i(h),h})();this.options.behavior?.onFetch(d,this),this.#t=this.state,(this.state.fetchStatus==="idle"||this.state.fetchMeta!==d.fetchOptions?.meta)&&this.#i({type:"fetch",meta:d.fetchOptions?.meta}),this.#r=BS({initialPromise:n?.initialPromise,fn:d.fetchFn,onCancel:h=>{h instanceof ay&&h.revert&&this.setState({...this.#t,fetchStatus:"idle"}),r.abort()},onFail:(h,f)=>{this.#i({type:"failed",failureCount:h,error:f})},onPause:()=>{this.#i({type:"pause"})},onContinue:()=>{this.#i({type:"continue"})},retry:d.options.retry,retryDelay:d.options.retryDelay,networkMode:d.options.networkMode,canRun:()=>!0});try{const h=await this.#r.start();if(h===void 0)throw new Error(`${this.queryHash} data is undefined`);return this.setData(h),this.#n.config.onSuccess?.(h,this),this.#n.config.onSettled?.(h,this.state.error,this),h}catch(h){if(h instanceof ay){if(h.silent)return this.#r.promise;if(h.revert){if(this.state.data===void 0)throw h;return this.state.data}}throw this.#i({type:"error",error:h}),this.#n.config.onError?.(h,this),this.#n.config.onSettled?.(this.state.data,h,this),h}finally{this.scheduleGc()}}#i(e){const n=r=>{switch(e.type){case"failed":return{...r,fetchFailureCount:e.failureCount,fetchFailureReason:e.error};case"pause":return{...r,fetchStatus:"paused"};case"continue":return{...r,fetchStatus:"fetching"};case"fetch":return{...r,...LS(r.data,this.options),fetchMeta:e.meta??null};case"success":const i={...r,...Gx(e.data,e.dataUpdatedAt),dataUpdateCount:r.dataUpdateCount+1,...!e.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return this.#t=e.manual?i:void 0,i;case"error":const o=e.error;return{...r,error:o,errorUpdateCount:r.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:r.fetchFailureCount+1,fetchFailureReason:o,fetchStatus:"idle",status:"error"};case"invalidate":return{...r,isInvalidated:!0};case"setState":return{...r,...e.state}}};this.state=n(this.state),En.batch(()=>{this.observers.forEach(r=>{r.onQueryUpdate()}),this.#n.notify({query:this,type:"updated",action:e})})}};function LS(t,e){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:PS(e.networkMode)?"fetching":"paused",...t===void 0&&{error:null,status:"pending"}}}function Gx(t,e){return{data:t,dataUpdatedAt:e??Date.now(),error:null,isInvalidated:!1,status:"success"}}function Wx(t){const e=typeof t.initialData=="function"?t.initialData():t.initialData,n=e!==void 0,r=n?typeof t.initialDataUpdatedAt=="function"?t.initialDataUpdatedAt():t.initialDataUpdatedAt:0;return{data:e,dataUpdateCount:0,dataUpdatedAt:n?r??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:n?"success":"pending",fetchStatus:"idle"}}var Wj=class extends ic{constructor(t,e){super(),this.options=e,this.#e=t,this.#i=null,this.#o=iy(),this.bindMethods(),this.setOptions(e)}#e;#t=void 0;#n=void 0;#s=void 0;#r;#a;#o;#i;#p;#h;#f;#c;#u;#l;#m=new Set;bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(this.#t.addObserver(this),Qx(this.#t,this.options)?this.#d():this.updateResult(),this.#b())}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return oy(this.#t,this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return oy(this.#t,this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,this.#v(),this.#x(),this.#t.removeObserver(this)}setOptions(t){const e=this.options,n=this.#t;if(this.options=this.#e.defaultQueryOptions(t),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof Gr(this.options.enabled,this.#t)!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");this.#w(),this.#t.setOptions(this.options),e._defaulted&&!uf(this.options,e)&&this.#e.getQueryCache().notify({type:"observerOptionsUpdated",query:this.#t,observer:this});const r=this.hasListeners();r&&Kx(this.#t,n,this.options,e)&&this.#d(),this.updateResult(),r&&(this.#t!==n||Gr(this.options.enabled,this.#t)!==Gr(e.enabled,this.#t)||va(this.options.staleTime,this.#t)!==va(e.staleTime,this.#t))&&this.#g();const i=this.#y();r&&(this.#t!==n||Gr(this.options.enabled,this.#t)!==Gr(e.enabled,this.#t)||i!==this.#l)&&this.#_(i)}getOptimisticResult(t){const e=this.#e.getQueryCache().build(this.#e,t),n=this.createResult(e,t);return Kj(this,n)&&(this.#s=n,this.#a=this.options,this.#r=this.#t.state),n}getCurrentResult(){return this.#s}trackResult(t,e){return new Proxy(t,{get:(n,r)=>(this.trackProp(r),e?.(r),r==="promise"&&(this.trackProp("data"),!this.options.experimental_prefetchInRender&&this.#o.status==="pending"&&this.#o.reject(new Error("experimental_prefetchInRender feature flag is not enabled"))),Reflect.get(n,r))})}trackProp(t){this.#m.add(t)}getCurrentQuery(){return this.#t}refetch({...t}={}){return this.fetch({...t})}fetchOptimistic(t){const e=this.#e.defaultQueryOptions(t),n=this.#e.getQueryCache().build(this.#e,e);return n.fetch().then(()=>this.createResult(n,e))}fetch(t){return this.#d({...t,cancelRefetch:t.cancelRefetch??!0}).then(()=>(this.updateResult(),this.#s))}#d(t){this.#w();let e=this.#t.fetch(this.options,t);return t?.throwOnError||(e=e.catch(ar)),e}#g(){this.#v();const t=va(this.options.staleTime,this.#t);if(Ro||this.#s.isStale||!ny(t))return;const n=DS(this.#s.dataUpdatedAt,t)+1;this.#c=So.setTimeout(()=>{this.#s.isStale||this.updateResult()},n)}#y(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(this.#t):this.options.refetchInterval)??!1}#_(t){this.#x(),this.#l=t,!(Ro||Gr(this.options.enabled,this.#t)===!1||!ny(this.#l)||this.#l===0)&&(this.#u=So.setInterval(()=>{(this.options.refetchIntervalInBackground||Wy.isFocused())&&this.#d()},this.#l))}#b(){this.#g(),this.#_(this.#y())}#v(){this.#c&&(So.clearTimeout(this.#c),this.#c=void 0)}#x(){this.#u&&(So.clearInterval(this.#u),this.#u=void 0)}createResult(t,e){const n=this.#t,r=this.options,i=this.#s,o=this.#r,l=this.#a,h=t!==n?t.state:this.#n,{state:f}=t;let p={...f},g=!1,v;if(e._optimisticResults){const D=this.hasListeners(),P=!D&&Qx(t,e),L=D&&Kx(t,n,e,r);(P||L)&&(p={...p,...LS(f.data,t.options)}),e._optimisticResults==="isRestoring"&&(p.fetchStatus="idle")}let{error:_,errorUpdatedAt:C,status:x}=p;v=p.data;let w=!1;if(e.placeholderData!==void 0&&v===void 0&&x==="pending"){let D;i?.isPlaceholderData&&e.placeholderData===l?.placeholderData?(D=i.data,w=!0):D=typeof e.placeholderData=="function"?e.placeholderData(this.#f?.state.data,this.#f):e.placeholderData,D!==void 0&&(x="success",v=sy(i?.data,D,e),g=!0)}if(e.select&&v!==void 0&&!w)if(i&&v===o?.data&&e.select===this.#p)v=this.#h;else try{this.#p=e.select,v=e.select(v),v=sy(i?.data,v,e),this.#h=v,this.#i=null}catch(D){this.#i=D}this.#i&&(_=this.#i,v=this.#h,C=Date.now(),x="error");const E=p.fetchStatus==="fetching",T=x==="pending",R=x==="error",M=T&&E,V=v!==void 0,I={status:x,fetchStatus:p.fetchStatus,isPending:T,isSuccess:x==="success",isError:R,isInitialLoading:M,isLoading:M,data:v,dataUpdatedAt:p.dataUpdatedAt,error:_,errorUpdatedAt:C,failureCount:p.fetchFailureCount,failureReason:p.fetchFailureReason,errorUpdateCount:p.errorUpdateCount,isFetched:p.dataUpdateCount>0||p.errorUpdateCount>0,isFetchedAfterMount:p.dataUpdateCount>h.dataUpdateCount||p.errorUpdateCount>h.errorUpdateCount,isFetching:E,isRefetching:E&&!T,isLoadingError:R&&!V,isPaused:p.fetchStatus==="paused",isPlaceholderData:g,isRefetchError:R&&V,isStale:Qy(t,e),refetch:this.refetch,promise:this.#o,isEnabled:Gr(e.enabled,t)!==!1};if(this.options.experimental_prefetchInRender){const D=q=>{I.status==="error"?q.reject(I.error):I.data!==void 0&&q.resolve(I.data)},P=()=>{const q=this.#o=I.promise=iy();D(q)},L=this.#o;switch(L.status){case"pending":t.queryHash===n.queryHash&&D(L);break;case"fulfilled":(I.status==="error"||I.data!==L.value)&&P();break;case"rejected":(I.status!=="error"||I.error!==L.reason)&&P();break}}return I}updateResult(){const t=this.#s,e=this.createResult(this.#t,this.options);if(this.#r=this.#t.state,this.#a=this.options,this.#r.data!==void 0&&(this.#f=this.#t),uf(e,t))return;this.#s=e;const n=()=>{if(!t)return!0;const{notifyOnChangeProps:r}=this.options,i=typeof r=="function"?r():r;if(i==="all"||!i&&!this.#m.size)return!0;const o=new Set(i??this.#m);return this.options.throwOnError&&o.add("error"),Object.keys(this.#s).some(l=>{const d=l;return this.#s[d]!==t[d]&&o.has(d)})};this.#S({listeners:n()})}#w(){const t=this.#e.getQueryCache().build(this.#e,this.options);if(t===this.#t)return;const e=this.#t;this.#t=t,this.#n=t.state,this.hasListeners()&&(e?.removeObserver(this),t.addObserver(this))}onQueryUpdate(){this.updateResult(),this.hasListeners()&&this.#b()}#S(t){En.batch(()=>{t.listeners&&this.listeners.forEach(e=>{e(this.#s)}),this.#e.getQueryCache().notify({query:this.#t,type:"observerResultsUpdated"})})}};function Qj(t,e){return Gr(e.enabled,t)!==!1&&t.state.data===void 0&&!(t.state.status==="error"&&e.retryOnMount===!1)}function Qx(t,e){return Qj(t,e)||t.state.data!==void 0&&oy(t,e,e.refetchOnMount)}function oy(t,e,n){if(Gr(e.enabled,t)!==!1&&va(e.staleTime,t)!=="static"){const r=typeof n=="function"?n(t):n;return r==="always"||r!==!1&&Qy(t,e)}return!1}function Kx(t,e,n,r){return(t!==e||Gr(r.enabled,t)===!1)&&(!n.suspense||t.state.status!=="error")&&Qy(t,n)}function Qy(t,e){return Gr(e.enabled,t)!==!1&&t.isStaleByTime(va(e.staleTime,t))}function Kj(t,e){return!uf(t.getCurrentResult(),e)}function Yx(t){return{onFetch:(e,n)=>{const r=e.options,i=e.fetchOptions?.meta?.fetchMore?.direction,o=e.state.data?.pages||[],l=e.state.data?.pageParams||[];let d={pages:[],pageParams:[]},h=0;const f=async()=>{let p=!1;const g=C=>{Object.defineProperty(C,"signal",{enumerable:!0,get:()=>(e.signal.aborted?p=!0:e.signal.addEventListener("abort",()=>{p=!0}),e.signal)})},v=OS(e.options,e.fetchOptions),_=async(C,x,w)=>{if(p)return Promise.reject();if(x==null&&C.pages.length)return Promise.resolve(C);const T=(()=>{const $={client:e.client,queryKey:e.queryKey,pageParam:x,direction:w?"backward":"forward",meta:e.options.meta};return g($),$})(),R=await v(T),{maxPages:M}=e.options,V=w?Uj:Lj;return{pages:V(C.pages,R,M),pageParams:V(C.pageParams,x,M)}};if(i&&o.length){const C=i==="backward",x=C?Yj:Xx,w={pages:o,pageParams:l},E=x(r,w);d=await _(w,E,C)}else{const C=t??o.length;do{const x=h===0?l[0]??r.initialPageParam:Xx(r,d);if(h>0&&x==null)break;d=await _(d,x),h++}while(h<C)}return d};e.options.persister?e.fetchFn=()=>e.options.persister?.(f,{client:e.client,queryKey:e.queryKey,meta:e.options.meta,signal:e.signal},n):e.fetchFn=f}}}function Xx(t,{pages:e,pageParams:n}){const r=e.length-1;return e.length>0?t.getNextPageParam(e[r],e,n[r],n):void 0}function Yj(t,{pages:e,pageParams:n}){return e.length>0?t.getPreviousPageParam?.(e[0],e,n[0],n):void 0}var Xj=class extends zS{#e;#t;#n;#s;constructor(e){super(),this.#e=e.client,this.mutationId=e.mutationId,this.#n=e.mutationCache,this.#t=[],this.state=e.state||US(),this.setOptions(e.options),this.scheduleGc()}setOptions(e){this.options=e,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(e){this.#t.includes(e)||(this.#t.push(e),this.clearGcTimeout(),this.#n.notify({type:"observerAdded",mutation:this,observer:e}))}removeObserver(e){this.#t=this.#t.filter(n=>n!==e),this.scheduleGc(),this.#n.notify({type:"observerRemoved",mutation:this,observer:e})}optionalRemove(){this.#t.length||(this.state.status==="pending"?this.scheduleGc():this.#n.remove(this))}continue(){return this.#s?.continue()??this.execute(this.state.variables)}async execute(e){const n=()=>{this.#r({type:"continue"})},r={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};this.#s=BS({fn:()=>this.options.mutationFn?this.options.mutationFn(e,r):Promise.reject(new Error("No mutationFn found")),onFail:(l,d)=>{this.#r({type:"failed",failureCount:l,error:d})},onPause:()=>{this.#r({type:"pause"})},onContinue:n,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>this.#n.canRun(this)});const i=this.state.status==="pending",o=!this.#s.canStart();try{if(i)n();else{this.#r({type:"pending",variables:e,isPaused:o}),await this.#n.config.onMutate?.(e,this,r);const d=await this.options.onMutate?.(e,r);d!==this.state.context&&this.#r({type:"pending",context:d,variables:e,isPaused:o})}const l=await this.#s.start();return await this.#n.config.onSuccess?.(l,e,this.state.context,this,r),await this.options.onSuccess?.(l,e,this.state.context,r),await this.#n.config.onSettled?.(l,null,this.state.variables,this.state.context,this,r),await this.options.onSettled?.(l,null,e,this.state.context,r),this.#r({type:"success",data:l}),l}catch(l){try{throw await this.#n.config.onError?.(l,e,this.state.context,this,r),await this.options.onError?.(l,e,this.state.context,r),await this.#n.config.onSettled?.(void 0,l,this.state.variables,this.state.context,this,r),await this.options.onSettled?.(void 0,l,e,this.state.context,r),l}finally{this.#r({type:"error",error:l})}}finally{this.#n.runNext(this)}}#r(e){const n=r=>{switch(e.type){case"failed":return{...r,failureCount:e.failureCount,failureReason:e.error};case"pause":return{...r,isPaused:!0};case"continue":return{...r,isPaused:!1};case"pending":return{...r,context:e.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:e.isPaused,status:"pending",variables:e.variables,submittedAt:Date.now()};case"success":return{...r,data:e.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...r,data:void 0,error:e.error,failureCount:r.failureCount+1,failureReason:e.error,isPaused:!1,status:"error"}}};this.state=n(this.state),En.batch(()=>{this.#t.forEach(r=>{r.onMutationUpdate(e)}),this.#n.notify({mutation:this,type:"updated",action:e})})}};function US(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var Zj=class extends ic{constructor(t={}){super(),this.config=t,this.#e=new Set,this.#t=new Map,this.#n=0}#e;#t;#n;build(t,e,n){const r=new Xj({client:t,mutationCache:this,mutationId:++this.#n,options:t.defaultMutationOptions(e),state:n});return this.add(r),r}add(t){this.#e.add(t);const e=Fh(t);if(typeof e=="string"){const n=this.#t.get(e);n?n.push(t):this.#t.set(e,[t])}this.notify({type:"added",mutation:t})}remove(t){if(this.#e.delete(t)){const e=Fh(t);if(typeof e=="string"){const n=this.#t.get(e);if(n)if(n.length>1){const r=n.indexOf(t);r!==-1&&n.splice(r,1)}else n[0]===t&&this.#t.delete(e)}}this.notify({type:"removed",mutation:t})}canRun(t){const e=Fh(t);if(typeof e=="string"){const r=this.#t.get(e)?.find(i=>i.state.status==="pending");return!r||r===t}else return!0}runNext(t){const e=Fh(t);return typeof e=="string"?this.#t.get(e)?.find(r=>r!==t&&r.state.isPaused)?.continue()??Promise.resolve():Promise.resolve()}clear(){En.batch(()=>{this.#e.forEach(t=>{this.notify({type:"removed",mutation:t})}),this.#e.clear(),this.#t.clear()})}getAll(){return Array.from(this.#e)}find(t){const e={exact:!0,...t};return this.getAll().find(n=>$x(e,n))}findAll(t={}){return this.getAll().filter(e=>$x(t,e))}notify(t){En.batch(()=>{this.listeners.forEach(e=>{e(t)})})}resumePausedMutations(){const t=this.getAll().filter(e=>e.state.isPaused);return En.batch(()=>Promise.all(t.map(e=>e.continue().catch(ar))))}};function Fh(t){return t.options.scope?.id}var Jj=class extends ic{#e;#t=void 0;#n;#s;constructor(e,n){super(),this.#e=e,this.setOptions(n),this.bindMethods(),this.#r()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){const n=this.options;this.options=this.#e.defaultMutationOptions(e),uf(this.options,n)||this.#e.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#n,observer:this}),n?.mutationKey&&this.options.mutationKey&&Io(n.mutationKey)!==Io(this.options.mutationKey)?this.reset():this.#n?.state.status==="pending"&&this.#n.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#n?.removeObserver(this)}onMutationUpdate(e){this.#r(),this.#a(e)}getCurrentResult(){return this.#t}reset(){this.#n?.removeObserver(this),this.#n=void 0,this.#r(),this.#a()}mutate(e,n){return this.#s=n,this.#n?.removeObserver(this),this.#n=this.#e.getMutationCache().build(this.#e,this.options),this.#n.addObserver(this),this.#n.execute(e)}#r(){const e=this.#n?.state??US();this.#t={...e,isPending:e.status==="pending",isSuccess:e.status==="success",isError:e.status==="error",isIdle:e.status==="idle",mutate:this.mutate,reset:this.reset}}#a(e){En.batch(()=>{if(this.#s&&this.hasListeners()){const n=this.#t.variables,r=this.#t.context,i={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};e?.type==="success"?(this.#s.onSuccess?.(e.data,n,r,i),this.#s.onSettled?.(e.data,null,n,r,i)):e?.type==="error"&&(this.#s.onError?.(e.error,n,r,i),this.#s.onSettled?.(void 0,e.error,n,r,i))}this.listeners.forEach(n=>{n(this.#t)})})}},eR=class extends ic{constructor(t={}){super(),this.config=t,this.#e=new Map}#e;build(t,e,n){const r=e.queryKey,i=e.queryHash??Hy(r,e);let o=this.get(i);return o||(o=new Gj({client:t,queryKey:r,queryHash:i,options:t.defaultQueryOptions(e),state:n,defaultOptions:t.getQueryDefaults(r)}),this.add(o)),o}add(t){this.#e.has(t.queryHash)||(this.#e.set(t.queryHash,t),this.notify({type:"added",query:t}))}remove(t){const e=this.#e.get(t.queryHash);e&&(t.destroy(),e===t&&this.#e.delete(t.queryHash),this.notify({type:"removed",query:t}))}clear(){En.batch(()=>{this.getAll().forEach(t=>{this.remove(t)})})}get(t){return this.#e.get(t)}getAll(){return[...this.#e.values()]}find(t){const e={exact:!0,...t};return this.getAll().find(n=>Vx(e,n))}findAll(t={}){const e=this.getAll();return Object.keys(t).length>0?e.filter(n=>Vx(t,n)):e}notify(t){En.batch(()=>{this.listeners.forEach(e=>{e(t)})})}onFocus(){En.batch(()=>{this.getAll().forEach(t=>{t.onFocus()})})}onOnline(){En.batch(()=>{this.getAll().forEach(t=>{t.onOnline()})})}},tR=class{#e;#t;#n;#s;#r;#a;#o;#i;constructor(t={}){this.#e=t.queryCache||new eR,this.#t=t.mutationCache||new Zj,this.#n=t.defaultOptions||{},this.#s=new Map,this.#r=new Map,this.#a=0}mount(){this.#a++,this.#a===1&&(this.#o=Wy.subscribe(async t=>{t&&(await this.resumePausedMutations(),this.#e.onFocus())}),this.#i=df.subscribe(async t=>{t&&(await this.resumePausedMutations(),this.#e.onOnline())}))}unmount(){this.#a--,this.#a===0&&(this.#o?.(),this.#o=void 0,this.#i?.(),this.#i=void 0)}isFetching(t){return this.#e.findAll({...t,fetchStatus:"fetching"}).length}isMutating(t){return this.#t.findAll({...t,status:"pending"}).length}getQueryData(t){const e=this.defaultQueryOptions({queryKey:t});return this.#e.get(e.queryHash)?.state.data}ensureQueryData(t){const e=this.defaultQueryOptions(t),n=this.#e.build(this,e),r=n.state.data;return r===void 0?this.fetchQuery(t):(t.revalidateIfStale&&n.isStaleByTime(va(e.staleTime,n))&&this.prefetchQuery(e),Promise.resolve(r))}getQueriesData(t){return this.#e.findAll(t).map(({queryKey:e,state:n})=>{const r=n.data;return[e,r]})}setQueryData(t,e,n){const r=this.defaultQueryOptions({queryKey:t}),o=this.#e.get(r.queryHash)?.state.data,l=Pj(e,o);if(l!==void 0)return this.#e.build(this,r).setData(l,{...n,manual:!0})}setQueriesData(t,e,n){return En.batch(()=>this.#e.findAll(t).map(({queryKey:r})=>[r,this.setQueryData(r,e,n)]))}getQueryState(t){const e=this.defaultQueryOptions({queryKey:t});return this.#e.get(e.queryHash)?.state}removeQueries(t){const e=this.#e;En.batch(()=>{e.findAll(t).forEach(n=>{e.remove(n)})})}resetQueries(t,e){const n=this.#e;return En.batch(()=>(n.findAll(t).forEach(r=>{r.reset()}),this.refetchQueries({type:"active",...t},e)))}cancelQueries(t,e={}){const n={revert:!0,...e},r=En.batch(()=>this.#e.findAll(t).map(i=>i.cancel(n)));return Promise.all(r).then(ar).catch(ar)}invalidateQueries(t,e={}){return En.batch(()=>(this.#e.findAll(t).forEach(n=>{n.invalidate()}),t?.refetchType==="none"?Promise.resolve():this.refetchQueries({...t,type:t?.refetchType??t?.type??"active"},e)))}refetchQueries(t,e={}){const n={...e,cancelRefetch:e.cancelRefetch??!0},r=En.batch(()=>this.#e.findAll(t).filter(i=>!i.isDisabled()&&!i.isStatic()).map(i=>{let o=i.fetch(void 0,n);return n.throwOnError||(o=o.catch(ar)),i.state.fetchStatus==="paused"?Promise.resolve():o}));return Promise.all(r).then(ar)}fetchQuery(t){const e=this.defaultQueryOptions(t);e.retry===void 0&&(e.retry=!1);const n=this.#e.build(this,e);return n.isStaleByTime(va(e.staleTime,n))?n.fetch(e):Promise.resolve(n.state.data)}prefetchQuery(t){return this.fetchQuery(t).then(ar).catch(ar)}fetchInfiniteQuery(t){return t.behavior=Yx(t.pages),this.fetchQuery(t)}prefetchInfiniteQuery(t){return this.fetchInfiniteQuery(t).then(ar).catch(ar)}ensureInfiniteQueryData(t){return t.behavior=Yx(t.pages),this.ensureQueryData(t)}resumePausedMutations(){return df.isOnline()?this.#t.resumePausedMutations():Promise.resolve()}getQueryCache(){return this.#e}getMutationCache(){return this.#t}getDefaultOptions(){return this.#n}setDefaultOptions(t){this.#n=t}setQueryDefaults(t,e){this.#s.set(Io(t),{queryKey:t,defaultOptions:e})}getQueryDefaults(t){const e=[...this.#s.values()],n={};return e.forEach(r=>{Ou(t,r.queryKey)&&Object.assign(n,r.defaultOptions)}),n}setMutationDefaults(t,e){this.#r.set(Io(t),{mutationKey:t,defaultOptions:e})}getMutationDefaults(t){const e=[...this.#r.values()],n={};return e.forEach(r=>{Ou(t,r.mutationKey)&&Object.assign(n,r.defaultOptions)}),n}defaultQueryOptions(t){if(t._defaulted)return t;const e={...this.#n.queries,...this.getQueryDefaults(t.queryKey),...t,_defaulted:!0};return e.queryHash||(e.queryHash=Hy(e.queryKey,e)),e.refetchOnReconnect===void 0&&(e.refetchOnReconnect=e.networkMode!=="always"),e.throwOnError===void 0&&(e.throwOnError=!!e.suspense),!e.networkMode&&e.persister&&(e.networkMode="offlineFirst"),e.queryFn===Gy&&(e.enabled=!1),e}defaultMutationOptions(t){return t?._defaulted?t:{...this.#n.mutations,...t?.mutationKey&&this.getMutationDefaults(t.mutationKey),...t,_defaulted:!0}}clear(){this.#e.clear(),this.#t.clear()}},FS=k.createContext(void 0),$t=t=>{const e=k.useContext(FS);if(!e)throw new Error("No QueryClient set, use QueryClientProvider to set one");return e},nR=({client:t,children:e})=>(k.useEffect(()=>(t.mount(),()=>{t.unmount()}),[t]),u.jsx(FS.Provider,{value:t,children:e})),VS=k.createContext(!1),rR=()=>k.useContext(VS);VS.Provider;function sR(){let t=!1;return{clearReset:()=>{t=!1},reset:()=>{t=!0},isReset:()=>t}}var iR=k.createContext(sR()),aR=()=>k.useContext(iR),oR=(t,e)=>{(t.suspense||t.throwOnError||t.experimental_prefetchInRender)&&(e.isReset()||(t.retryOnMount=!1))},lR=t=>{k.useEffect(()=>{t.clearReset()},[t])},cR=({result:t,errorResetBoundary:e,throwOnError:n,query:r,suspense:i})=>t.isError&&!e.isReset()&&!t.isFetching&&r&&(i&&t.data===void 0||NS(n,[t.error,r])),uR=t=>{if(t.suspense){const n=i=>i==="static"?i:Math.max(i??1e3,1e3),r=t.staleTime;t.staleTime=typeof r=="function"?(...i)=>n(r(...i)):n(r),typeof t.gcTime=="number"&&(t.gcTime=Math.max(t.gcTime,1e3))}},dR=(t,e)=>t.isLoading&&t.isFetching&&!e,hR=(t,e)=>t?.suspense&&e.isPending,Zx=(t,e,n)=>e.fetchOptimistic(t).catch(()=>{n.clearReset()});function fR(t,e,n){const r=rR(),i=aR(),o=$t(),l=o.defaultQueryOptions(t);o.getDefaultOptions().queries?._experimental_beforeQuery?.(l),l._optimisticResults=r?"isRestoring":"optimistic",uR(l),oR(l,i),lR(i);const d=!o.getQueryCache().get(l.queryHash),[h]=k.useState(()=>new e(o,l)),f=h.getOptimisticResult(l),p=!r&&t.subscribed!==!1;if(k.useSyncExternalStore(k.useCallback(g=>{const v=p?h.subscribe(En.batchCalls(g)):ar;return h.updateResult(),v},[h,p]),()=>h.getCurrentResult(),()=>h.getCurrentResult()),k.useEffect(()=>{h.setOptions(l)},[l,h]),hR(l,f))throw Zx(l,h,i);if(cR({result:f,errorResetBoundary:i,throwOnError:l.throwOnError,query:o.getQueryCache().get(l.queryHash),suspense:l.suspense}))throw f.error;return o.getDefaultOptions().queries?._experimental_afterQuery?.(l,f),l.experimental_prefetchInRender&&!Ro&&dR(f,r)&&(d?Zx(l,h,i):o.getQueryCache().get(l.queryHash)?.promise)?.catch(ar).finally(()=>{h.updateResult()}),l.notifyOnChangeProps?f:h.trackResult(f)}function Pa(t,e){return fR(t,Wj)}function Wn(t,e){const n=$t(),[r]=k.useState(()=>new Jj(n,t));k.useEffect(()=>{r.setOptions(t)},[r,t]);const i=k.useSyncExternalStore(k.useCallback(l=>r.subscribe(En.batchCalls(l)),[r]),()=>r.getCurrentResult(),()=>r.getCurrentResult()),o=k.useCallback((l,d)=>{r.mutate(l,d).catch(ar)},[r]);if(i.error&&NS(r.options.throwOnError,[i.error]))throw i.error;return{...i,mutate:o,mutateAsync:i.mutate}}const mR={isLoading:!1,loadingMessage:"Loading...",addLoadingHold:()=>{},removeLoadingHold:()=>{}},$S=k.createContext(mR);function pR({children:t}){const[e,n]=k.useState(new Map),r=k.useCallback((h,f)=>{n(p=>new Map(p).set(h,f))},[]),i=k.useCallback(h=>{n(f=>{const p=new Map(f);return p.delete(h),p})},[]),o=e.size>0,l=e.size>0&&Array.from(e.values()).pop()||"Loading...",d={isLoading:o,loadingMessage:l,addLoadingHold:r,removeLoadingHold:i};return u.jsx($S.Provider,{value:d,children:t})}function On(){const t=k.useContext($S);if(!t)throw new Error("useApp must be used within an AppProvider");return t}const gR=()=>{};var Jx={};const qS=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let i=t.charCodeAt(r);i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=i&63|128):(i&64512)===55296&&r+1<t.length&&(t.charCodeAt(r+1)&64512)===56320?(i=65536+((i&1023)<<10)+(t.charCodeAt(++r)&1023),e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=i&63|128):(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=i&63|128)}return e},yR=function(t){const e=[];let n=0,r=0;for(;n<t.length;){const i=t[n++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){const o=t[n++];e[r++]=String.fromCharCode((i&31)<<6|o&63)}else if(i>239&&i<365){const o=t[n++],l=t[n++],d=t[n++],h=((i&7)<<18|(o&63)<<12|(l&63)<<6|d&63)-65536;e[r++]=String.fromCharCode(55296+(h>>10)),e[r++]=String.fromCharCode(56320+(h&1023))}else{const o=t[n++],l=t[n++];e[r++]=String.fromCharCode((i&15)<<12|(o&63)<<6|l&63)}}return e.join("")},HS={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<t.length;i+=3){const o=t[i],l=i+1<t.length,d=l?t[i+1]:0,h=i+2<t.length,f=h?t[i+2]:0,p=o>>2,g=(o&3)<<4|d>>4;let v=(d&15)<<2|f>>6,_=f&63;h||(_=64,l||(v=64)),r.push(n[p],n[g],n[v],n[_])}return r.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(qS(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):yR(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<t.length;){const o=n[t.charAt(i++)],d=i<t.length?n[t.charAt(i)]:0;++i;const f=i<t.length?n[t.charAt(i)]:64;++i;const g=i<t.length?n[t.charAt(i)]:64;if(++i,o==null||d==null||f==null||g==null)throw new _R;const v=o<<2|d>>4;if(r.push(v),f!==64){const _=d<<4&240|f>>2;if(r.push(_),g!==64){const C=f<<6&192|g;r.push(C)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class _R extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const bR=function(t){const e=qS(t);return HS.encodeByteArray(e,!0)},hf=function(t){return bR(t).replace(/\./g,"")},GS=function(t){try{return HS.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function vR(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const xR=()=>vR().__FIREBASE_DEFAULTS__,wR=()=>{if(typeof process>"u"||typeof Jx>"u")return;const t=Jx.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},SR=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&GS(t[1]);return e&&JSON.parse(e)},$f=()=>{try{return gR()||xR()||wR()||SR()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},WS=t=>$f()?.emulatorHosts?.[t],CR=t=>{const e=WS(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(n+1),10);return e[0]==="["?[e.substring(1,n-1),r]:[e.substring(0,n),r]},QS=()=>$f()?.config,KS=t=>$f()?.[`_${t}`];class ER{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,r)=>{n?this.reject(n):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,r))}}}function ac(t){try{return(t.startsWith("http://")||t.startsWith("https://")?new URL(t).hostname:t).endsWith(".cloudworkstations.dev")}catch{return!1}}async function YS(t){return(await fetch(t,{credentials:"include"})).ok}function TR(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n={alg:"none",type:"JWT"},r=e||"demo-project",i=t.iat||0,o=t.sub||t.user_id;if(!o)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const l={iss:`https://securetoken.google.com/${r}`,aud:r,iat:i,exp:i+3600,auth_time:i,sub:o,user_id:o,firebase:{sign_in_provider:"custom",identities:{}},...t};return[hf(JSON.stringify(n)),hf(JSON.stringify(l)),""].join(".")}const Au={};function AR(){const t={prod:[],emulator:[]};for(const e of Object.keys(Au))Au[e]?t.emulator.push(e):t.prod.push(e);return t}function jR(t){let e=document.getElementById(t),n=!1;return e||(e=document.createElement("div"),e.setAttribute("id",t),n=!0),{created:n,element:e}}let ew=!1;function XS(t,e){if(typeof window>"u"||typeof document>"u"||!ac(window.location.host)||Au[t]===e||Au[t]||ew)return;Au[t]=e;function n(v){return`__firebase__banner__${v}`}const r="__firebase__banner",o=AR().prod.length>0;function l(){const v=document.getElementById(r);v&&v.remove()}function d(v){v.style.display="flex",v.style.background="#7faaf0",v.style.position="fixed",v.style.bottom="5px",v.style.left="5px",v.style.padding=".5em",v.style.borderRadius="5px",v.style.alignItems="center"}function h(v,_){v.setAttribute("width","24"),v.setAttribute("id",_),v.setAttribute("height","24"),v.setAttribute("viewBox","0 0 24 24"),v.setAttribute("fill","none"),v.style.marginLeft="-6px"}function f(){const v=document.createElement("span");return v.style.cursor="pointer",v.style.marginLeft="16px",v.style.fontSize="24px",v.innerHTML=" &times;",v.onclick=()=>{ew=!0,l()},v}function p(v,_){v.setAttribute("id",_),v.innerText="Learn more",v.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",v.setAttribute("target","__blank"),v.style.paddingLeft="5px",v.style.textDecoration="underline"}function g(){const v=jR(r),_=n("text"),C=document.getElementById(_)||document.createElement("span"),x=n("learnmore"),w=document.getElementById(x)||document.createElement("a"),E=n("preprendIcon"),T=document.getElementById(E)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(v.created){const R=v.element;d(R),p(w,x);const M=f();h(T,E),R.append(T,C,w,M),document.body.appendChild(R)}o?(C.innerText="Preview backend disconnected.",T.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(T.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,C.innerText="Preview backend running in this workspace."),C.setAttribute("id",_)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",g):g()}function er(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function RR(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(er())}function IR(){const t=$f()?.forceEnvironment;if(t==="node")return!0;if(t==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function kR(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function DR(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function MR(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function OR(){const t=er();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function NR(){return!IR()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function PR(){try{return typeof indexedDB=="object"}catch{return!1}}function BR(){return new Promise((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{e(i.error?.message||"")}}catch(n){e(n)}})}const zR="FirebaseError";class Ii extends Error{constructor(e,n,r){super(n),this.code=e,this.customData=r,this.name=zR,Object.setPrototypeOf(this,Ii.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Ju.prototype.create)}}class Ju{constructor(e,n,r){this.service=e,this.serviceName=n,this.errors=r}create(e,...n){const r=n[0]||{},i=`${this.service}/${e}`,o=this.errors[e],l=o?LR(o,r):"Error",d=`${this.serviceName}: ${l} (${i}).`;return new Ii(i,d,r)}}function LR(t,e){return t.replace(UR,(n,r)=>{const i=e[r];return i!=null?String(i):`<${r}?>`})}const UR=/\{\$([^}]+)}/g;function FR(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function xi(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const i of n){if(!r.includes(i))return!1;const o=t[i],l=e[i];if(tw(o)&&tw(l)){if(!xi(o,l))return!1}else if(o!==l)return!1}for(const i of r)if(!n.includes(i))return!1;return!0}function tw(t){return t!==null&&typeof t=="object"}function ed(t){const e=[];for(const[n,r]of Object.entries(t))Array.isArray(r)?r.forEach(i=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function xu(t){const e={};return t.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[i,o]=r.split("=");e[decodeURIComponent(i)]=decodeURIComponent(o)}}),e}function wu(t){const e=t.indexOf("?");if(!e)return"";const n=t.indexOf("#",e);return t.substring(e,n>0?n:void 0)}function VR(t,e){const n=new $R(t,e);return n.subscribe.bind(n)}class $R{constructor(e,n){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(n=>{n.next(e)})}error(e){this.forEachObserver(n=>{n.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,n,r){let i;if(e===void 0&&n===void 0&&r===void 0)throw new Error("Missing Observer.");qR(e,["next","error","complete"])?i=e:i={next:e,error:n,complete:r},i.next===void 0&&(i.next=Og),i.error===void 0&&(i.error=Og),i.complete===void 0&&(i.complete=Og);const o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),o}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let n=0;n<this.observers.length;n++)this.sendOne(n,e)}sendOne(e,n){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{n(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function qR(t,e){if(typeof t!="object"||t===null)return!1;for(const n of e)if(n in t&&typeof t[n]=="function")return!0;return!1}function Og(){}function wn(t){return t&&t._delegate?t._delegate:t}class ko{constructor(e,n,r){this.name=e,this.instanceFactory=n,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const xo="[DEFAULT]";class HR{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){const r=new ER;if(this.instancesDeferred.set(n,r),this.isInitialized(n)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:n});i&&r.resolve(i)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){const n=this.normalizeInstanceIdentifier(e?.identifier),r=e?.optional??!1;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(i){if(r)return null;throw i}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(WR(e))try{this.getOrInitializeService({instanceIdentifier:xo})}catch{}for(const[n,r]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(n);try{const o=this.getOrInitializeService({instanceIdentifier:i});r.resolve(o)}catch{}}}}clearInstance(e=xo){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=xo){return this.instances.has(e)}getOptions(e=xo){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:n={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:r,options:n});for(const[o,l]of this.instancesDeferred.entries()){const d=this.normalizeInstanceIdentifier(o);r===d&&l.resolve(i)}return i}onInit(e,n){const r=this.normalizeInstanceIdentifier(n),i=this.onInitCallbacks.get(r)??new Set;i.add(e),this.onInitCallbacks.set(r,i);const o=this.instances.get(r);return o&&e(o,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,n){const r=this.onInitCallbacks.get(n);if(r)for(const i of r)try{i(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:GR(e),options:n}),this.instances.set(e,r),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=xo){return this.component?this.component.multipleInstances?e:xo:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function GR(t){return t===xo?void 0:t}function WR(t){return t.instantiationMode==="EAGER"}class QR{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const n=new HR(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}}var pt;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(pt||(pt={}));const KR={debug:pt.DEBUG,verbose:pt.VERBOSE,info:pt.INFO,warn:pt.WARN,error:pt.ERROR,silent:pt.SILENT},YR=pt.INFO,XR={[pt.DEBUG]:"log",[pt.VERBOSE]:"log",[pt.INFO]:"info",[pt.WARN]:"warn",[pt.ERROR]:"error"},ZR=(t,e,...n)=>{if(e<t.logLevel)return;const r=new Date().toISOString(),i=XR[e];if(i)console[i](`[${r}]  ${t.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Ky{constructor(e){this.name=e,this._logLevel=YR,this._logHandler=ZR,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in pt))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?KR[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,pt.DEBUG,...e),this._logHandler(this,pt.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,pt.VERBOSE,...e),this._logHandler(this,pt.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,pt.INFO,...e),this._logHandler(this,pt.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,pt.WARN,...e),this._logHandler(this,pt.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,pt.ERROR,...e),this._logHandler(this,pt.ERROR,...e)}}const JR=(t,e)=>e.some(n=>t instanceof n);let nw,rw;function eI(){return nw||(nw=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function tI(){return rw||(rw=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const ZS=new WeakMap,ly=new WeakMap,JS=new WeakMap,Ng=new WeakMap,Yy=new WeakMap;function nI(t){const e=new Promise((n,r)=>{const i=()=>{t.removeEventListener("success",o),t.removeEventListener("error",l)},o=()=>{n(xa(t.result)),i()},l=()=>{r(t.error),i()};t.addEventListener("success",o),t.addEventListener("error",l)});return e.then(n=>{n instanceof IDBCursor&&ZS.set(n,t)}).catch(()=>{}),Yy.set(e,t),e}function rI(t){if(ly.has(t))return;const e=new Promise((n,r)=>{const i=()=>{t.removeEventListener("complete",o),t.removeEventListener("error",l),t.removeEventListener("abort",l)},o=()=>{n(),i()},l=()=>{r(t.error||new DOMException("AbortError","AbortError")),i()};t.addEventListener("complete",o),t.addEventListener("error",l),t.addEventListener("abort",l)});ly.set(t,e)}let cy={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return ly.get(t);if(e==="objectStoreNames")return t.objectStoreNames||JS.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return xa(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function sI(t){cy=t(cy)}function iI(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const r=t.call(Pg(this),e,...n);return JS.set(r,e.sort?e.sort():[e]),xa(r)}:tI().includes(t)?function(...e){return t.apply(Pg(this),e),xa(ZS.get(this))}:function(...e){return xa(t.apply(Pg(this),e))}}function aI(t){return typeof t=="function"?iI(t):(t instanceof IDBTransaction&&rI(t),JR(t,eI())?new Proxy(t,cy):t)}function xa(t){if(t instanceof IDBRequest)return nI(t);if(Ng.has(t))return Ng.get(t);const e=aI(t);return e!==t&&(Ng.set(t,e),Yy.set(e,t)),e}const Pg=t=>Yy.get(t);function oI(t,e,{blocked:n,upgrade:r,blocking:i,terminated:o}={}){const l=indexedDB.open(t,e),d=xa(l);return r&&l.addEventListener("upgradeneeded",h=>{r(xa(l.result),h.oldVersion,h.newVersion,xa(l.transaction),h)}),n&&l.addEventListener("blocked",h=>n(h.oldVersion,h.newVersion,h)),d.then(h=>{o&&h.addEventListener("close",()=>o()),i&&h.addEventListener("versionchange",f=>i(f.oldVersion,f.newVersion,f))}).catch(()=>{}),d}const lI=["get","getKey","getAll","getAllKeys","count"],cI=["put","add","delete","clear"],Bg=new Map;function sw(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(Bg.get(e))return Bg.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,i=cI.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(i||lI.includes(n)))return;const o=async function(l,...d){const h=this.transaction(l,i?"readwrite":"readonly");let f=h.store;return r&&(f=f.index(d.shift())),(await Promise.all([f[n](...d),i&&h.done]))[0]};return Bg.set(e,o),o}sI(t=>({...t,get:(e,n,r)=>sw(e,n)||t.get(e,n,r),has:(e,n)=>!!sw(e,n)||t.has(e,n)}));class uI{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(dI(n)){const r=n.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(n=>n).join(" ")}}function dI(t){return t.getComponent()?.type==="VERSION"}const uy="@firebase/app",iw="0.14.6";const wi=new Ky("@firebase/app"),hI="@firebase/app-compat",fI="@firebase/analytics-compat",mI="@firebase/analytics",pI="@firebase/app-check-compat",gI="@firebase/app-check",yI="@firebase/auth",_I="@firebase/auth-compat",bI="@firebase/database",vI="@firebase/data-connect",xI="@firebase/database-compat",wI="@firebase/functions",SI="@firebase/functions-compat",CI="@firebase/installations",EI="@firebase/installations-compat",TI="@firebase/messaging",AI="@firebase/messaging-compat",jI="@firebase/performance",RI="@firebase/performance-compat",II="@firebase/remote-config",kI="@firebase/remote-config-compat",DI="@firebase/storage",MI="@firebase/storage-compat",OI="@firebase/firestore",NI="@firebase/ai",PI="@firebase/firestore-compat",BI="firebase",zI="12.6.0";const dy="[DEFAULT]",LI={[uy]:"fire-core",[hI]:"fire-core-compat",[mI]:"fire-analytics",[fI]:"fire-analytics-compat",[gI]:"fire-app-check",[pI]:"fire-app-check-compat",[yI]:"fire-auth",[_I]:"fire-auth-compat",[bI]:"fire-rtdb",[vI]:"fire-data-connect",[xI]:"fire-rtdb-compat",[wI]:"fire-fn",[SI]:"fire-fn-compat",[CI]:"fire-iid",[EI]:"fire-iid-compat",[TI]:"fire-fcm",[AI]:"fire-fcm-compat",[jI]:"fire-perf",[RI]:"fire-perf-compat",[II]:"fire-rc",[kI]:"fire-rc-compat",[DI]:"fire-gcs",[MI]:"fire-gcs-compat",[OI]:"fire-fst",[PI]:"fire-fst-compat",[NI]:"fire-vertex","fire-js":"fire-js",[BI]:"fire-js-all"};const ff=new Map,UI=new Map,hy=new Map;function aw(t,e){try{t.container.addComponent(e)}catch(n){wi.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function Hl(t){const e=t.name;if(hy.has(e))return wi.debug(`There were multiple attempts to register component ${e}.`),!1;hy.set(e,t);for(const n of ff.values())aw(n,t);for(const n of UI.values())aw(n,t);return!0}function Xy(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function cs(t){return t==null?!1:t.settings!==void 0}const FI={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},wa=new Ju("app","Firebase",FI);class VI{constructor(e,n,r){this._isDeleted=!1,this._options={...e},this._config={...n},this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new ko("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw wa.create("app-deleted",{appName:this._name})}}const oc=zI;function eC(t,e={}){let n=t;typeof e!="object"&&(e={name:e});const r={name:dy,automaticDataCollectionEnabled:!0,...e},i=r.name;if(typeof i!="string"||!i)throw wa.create("bad-app-name",{appName:String(i)});if(n||(n=QS()),!n)throw wa.create("no-options");const o=ff.get(i);if(o){if(xi(n,o.options)&&xi(r,o.config))return o;throw wa.create("duplicate-app",{appName:i})}const l=new QR(i);for(const h of hy.values())l.addComponent(h);const d=new VI(n,r,l);return ff.set(i,d),d}function tC(t=dy){const e=ff.get(t);if(!e&&t===dy&&QS())return eC();if(!e)throw wa.create("no-app",{appName:t});return e}function Sa(t,e,n){let r=LI[t]??t;n&&(r+=`-${n}`);const i=r.match(/\s|\//),o=e.match(/\s|\//);if(i||o){const l=[`Unable to register library "${r}" with version "${e}":`];i&&l.push(`library name "${r}" contains illegal characters (whitespace or "/")`),i&&o&&l.push("and"),o&&l.push(`version name "${e}" contains illegal characters (whitespace or "/")`),wi.warn(l.join(" "));return}Hl(new ko(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}const $I="firebase-heartbeat-database",qI=1,Nu="firebase-heartbeat-store";let zg=null;function nC(){return zg||(zg=oI($I,qI,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(Nu)}catch(n){console.warn(n)}}}}).catch(t=>{throw wa.create("idb-open",{originalErrorMessage:t.message})})),zg}async function HI(t){try{const n=(await nC()).transaction(Nu),r=await n.objectStore(Nu).get(rC(t));return await n.done,r}catch(e){if(e instanceof Ii)wi.warn(e.message);else{const n=wa.create("idb-get",{originalErrorMessage:e?.message});wi.warn(n.message)}}}async function ow(t,e){try{const r=(await nC()).transaction(Nu,"readwrite");await r.objectStore(Nu).put(e,rC(t)),await r.done}catch(n){if(n instanceof Ii)wi.warn(n.message);else{const r=wa.create("idb-set",{originalErrorMessage:n?.message});wi.warn(r.message)}}}function rC(t){return`${t.name}!${t.options.appId}`}const GI=1024,WI=30;class QI{constructor(e){this.container=e,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new YI(n),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){try{const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=lw();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(i=>i.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:n}),this._heartbeatsCache.heartbeats.length>WI){const i=XI(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(i,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){wi.warn(e)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const e=lw(),{heartbeatsToSend:n,unsentEntries:r}=KI(this._heartbeatsCache.heartbeats),i=hf(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(e){return wi.warn(e),""}}}function lw(){return new Date().toISOString().substring(0,10)}function KI(t,e=GI){const n=[];let r=t.slice();for(const i of t){const o=n.find(l=>l.agent===i.agent);if(o){if(o.dates.push(i.date),cw(n)>e){o.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),cw(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}class YI{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return PR()?BR().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const n=await HI(this.app);return n?.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return ow(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return ow(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function cw(t){return hf(JSON.stringify({version:2,heartbeats:t})).length}function XI(t){if(t.length===0)return-1;let e=0,n=t[0].date;for(let r=1;r<t.length;r++)t[r].date<n&&(n=t[r].date,e=r);return e}function ZI(t){Hl(new ko("platform-logger",e=>new uI(e),"PRIVATE")),Hl(new ko("heartbeat",e=>new QI(e),"PRIVATE")),Sa(uy,iw,t),Sa(uy,iw,"esm2020"),Sa("fire-js","")}ZI("");function sC(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const JI=sC,iC=new Ju("auth","Firebase",sC());const mf=new Ky("@firebase/auth");function ek(t,...e){mf.logLevel<=pt.WARN&&mf.warn(`Auth (${oc}): ${t}`,...e)}function Zh(t,...e){mf.logLevel<=pt.ERROR&&mf.error(`Auth (${oc}): ${t}`,...e)}function fs(t,...e){throw Zy(t,...e)}function Fs(t,...e){return Zy(t,...e)}function aC(t,e,n){const r={...JI(),[e]:n};return new Ju("auth","Firebase",r).create(e,{appName:t.name})}function Ca(t){return aC(t,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Zy(t,...e){if(typeof t!="string"){const n=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=t.name),t._errorFactory.create(n,...r)}return iC.create(t,...e)}function Ke(t,e,...n){if(!t)throw Zy(e,...n)}function gi(t){const e="INTERNAL ASSERTION FAILED: "+t;throw Zh(e),new Error(e)}function Si(t,e){t||gi(e)}function fy(){return typeof self<"u"&&self.location?.href||""}function tk(){return uw()==="http:"||uw()==="https:"}function uw(){return typeof self<"u"&&self.location?.protocol||null}function nk(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(tk()||DR()||"connection"in navigator)?navigator.onLine:!0}function rk(){if(typeof navigator>"u")return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}class td{constructor(e,n){this.shortDelay=e,this.longDelay=n,Si(n>e,"Short delay should be less than long delay!"),this.isMobile=RR()||MR()}get(){return nk()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function Jy(t,e){Si(t.emulator,"Emulator should always be set here");const{url:n}=t.emulator;return e?`${n}${e.startsWith("/")?e.slice(1):e}`:n}class oC{static initialize(e,n,r){this.fetchImpl=e,n&&(this.headersImpl=n),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;gi("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;gi("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;gi("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const sk={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};const ik=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],ak=new td(3e4,6e4);function Po(t,e){return t.tenantId&&!e.tenantId?{...e,tenantId:t.tenantId}:e}async function Ba(t,e,n,r,i={}){return lC(t,i,async()=>{let o={},l={};r&&(e==="GET"?l=r:o={body:JSON.stringify(r)});const d=ed({key:t.config.apiKey,...l}).slice(1),h=await t._getAdditionalHeaders();h["Content-Type"]="application/json",t.languageCode&&(h["X-Firebase-Locale"]=t.languageCode);const f={method:e,headers:h,...o};return kR()||(f.referrerPolicy="no-referrer"),t.emulatorConfig&&ac(t.emulatorConfig.host)&&(f.credentials="include"),oC.fetch()(await cC(t,t.config.apiHost,n,d),f)})}async function lC(t,e,n){t._canInitEmulator=!1;const r={...sk,...e};try{const i=new lk(t),o=await Promise.race([n(),i.promise]);i.clearNetworkTimeout();const l=await o.json();if("needConfirmation"in l)throw Vh(t,"account-exists-with-different-credential",l);if(o.ok&&!("errorMessage"in l))return l;{const d=o.ok?l.errorMessage:l.error.message,[h,f]=d.split(" : ");if(h==="FEDERATED_USER_ID_ALREADY_LINKED")throw Vh(t,"credential-already-in-use",l);if(h==="EMAIL_EXISTS")throw Vh(t,"email-already-in-use",l);if(h==="USER_DISABLED")throw Vh(t,"user-disabled",l);const p=r[h]||h.toLowerCase().replace(/[_\s]+/g,"-");if(f)throw aC(t,p,f);fs(t,p)}}catch(i){if(i instanceof Ii)throw i;fs(t,"network-request-failed",{message:String(i)})}}async function qf(t,e,n,r,i={}){const o=await Ba(t,e,n,r,i);return"mfaPendingCredential"in o&&fs(t,"multi-factor-auth-required",{_serverResponse:o}),o}async function cC(t,e,n,r){const i=`${e}${n}?${r}`,o=t,l=o.config.emulator?Jy(t.config,i):`${t.config.apiScheme}://${i}`;return ik.includes(n)&&(await o._persistenceManagerAvailable,o._getPersistenceType()==="COOKIE")?o._getPersistence()._getFinalTarget(l).toString():l}function ok(t){switch(t){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class lk{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((n,r)=>{this.timer=setTimeout(()=>r(Fs(this.auth,"network-request-failed")),ak.get())})}}function Vh(t,e,n){const r={appName:t.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const i=Fs(t,e,r);return i.customData._tokenResponse=n,i}function dw(t){return t!==void 0&&t.enterprise!==void 0}class ck{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const n of this.recaptchaEnforcementState)if(n.provider&&n.provider===e)return ok(n.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function uk(t,e){return Ba(t,"GET","/v2/recaptchaConfig",Po(t,e))}async function dk(t,e){return Ba(t,"POST","/v1/accounts:delete",e)}async function pf(t,e){return Ba(t,"POST","/v1/accounts:lookup",e)}function ju(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function hk(t,e=!1){const n=wn(t),r=await n.getIdToken(e),i=e0(r);Ke(i&&i.exp&&i.auth_time&&i.iat,n.auth,"internal-error");const o=typeof i.firebase=="object"?i.firebase:void 0,l=o?.sign_in_provider;return{claims:i,token:r,authTime:ju(Lg(i.auth_time)),issuedAtTime:ju(Lg(i.iat)),expirationTime:ju(Lg(i.exp)),signInProvider:l||null,signInSecondFactor:o?.sign_in_second_factor||null}}function Lg(t){return Number(t)*1e3}function e0(t){const[e,n,r]=t.split(".");if(e===void 0||n===void 0||r===void 0)return Zh("JWT malformed, contained fewer than 3 sections"),null;try{const i=GS(n);return i?JSON.parse(i):(Zh("Failed to decode base64 JWT payload"),null)}catch(i){return Zh("Caught error parsing JWT payload as JSON",i?.toString()),null}}function hw(t){const e=e0(t);return Ke(e,"internal-error"),Ke(typeof e.exp<"u","internal-error"),Ke(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}async function Pu(t,e,n=!1){if(n)return e;try{return await e}catch(r){throw r instanceof Ii&&fk(r)&&t.auth.currentUser===t&&await t.auth.signOut(),r}}function fk({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}class mk{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const n=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),n}else{this.errorBackoff=3e4;const r=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;const n=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},n)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class my{constructor(e,n){this.createdAt=e,this.lastLoginAt=n,this._initializeTime()}_initializeTime(){this.lastSignInTime=ju(this.lastLoginAt),this.creationTime=ju(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function gf(t){const e=t.auth,n=await t.getIdToken(),r=await Pu(t,pf(e,{idToken:n}));Ke(r?.users.length,e,"internal-error");const i=r.users[0];t._notifyReloadListener(i);const o=i.providerUserInfo?.length?uC(i.providerUserInfo):[],l=gk(t.providerData,o),d=t.isAnonymous,h=!(t.email&&i.passwordHash)&&!l?.length,f=d?h:!1,p={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:l,metadata:new my(i.createdAt,i.lastLoginAt),isAnonymous:f};Object.assign(t,p)}async function pk(t){const e=wn(t);await gf(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function gk(t,e){return[...t.filter(r=>!e.some(i=>i.providerId===r.providerId)),...e]}function uC(t){return t.map(({providerId:e,...n})=>({providerId:e,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}))}async function yk(t,e){const n=await lC(t,{},async()=>{const r=ed({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:o}=t.config,l=await cC(t,i,"/v1/token",`key=${o}`),d=await t._getAdditionalHeaders();d["Content-Type"]="application/x-www-form-urlencoded";const h={method:"POST",headers:d,body:r};return t.emulatorConfig&&ac(t.emulatorConfig.host)&&(h.credentials="include"),oC.fetch()(l,h)});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}async function _k(t,e){return Ba(t,"POST","/v2/accounts:revokeToken",Po(t,e))}class Ul{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Ke(e.idToken,"internal-error"),Ke(typeof e.idToken<"u","internal-error"),Ke(typeof e.refreshToken<"u","internal-error");const n="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):hw(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,n)}updateFromIdToken(e){Ke(e.length!==0,"internal-error");const n=hw(e);this.updateTokensAndExpiration(e,null,n)}async getToken(e,n=!1){return!n&&this.accessToken&&!this.isExpired?this.accessToken:(Ke(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,n){const{accessToken:r,refreshToken:i,expiresIn:o}=await yk(e,n);this.updateTokensAndExpiration(r,i,Number(o))}updateTokensAndExpiration(e,n,r){this.refreshToken=n||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,n){const{refreshToken:r,accessToken:i,expirationTime:o}=n,l=new Ul;return r&&(Ke(typeof r=="string","internal-error",{appName:e}),l.refreshToken=r),i&&(Ke(typeof i=="string","internal-error",{appName:e}),l.accessToken=i),o&&(Ke(typeof o=="number","internal-error",{appName:e}),l.expirationTime=o),l}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Ul,this.toJSON())}_performRefresh(){return gi("not implemented")}}function ua(t,e){Ke(typeof t=="string"||typeof t>"u","internal-error",{appName:e})}class us{constructor({uid:e,auth:n,stsTokenManager:r,...i}){this.providerId="firebase",this.proactiveRefresh=new mk(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new my(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const n=await Pu(this,this.stsTokenManager.getToken(this.auth,e));return Ke(n,this.auth,"internal-error"),this.accessToken!==n&&(this.accessToken=n,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),n}getIdTokenResult(e){return hk(this,e)}reload(){return pk(this)}_assign(e){this!==e&&(Ke(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(n=>({...n})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const n=new us({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return n.metadata._copy(this.metadata),n}_onReload(e){Ke(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,n=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),n&&await gf(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(cs(this.auth.app))return Promise.reject(Ca(this.auth));const e=await this.getIdToken();return await Pu(this,dk(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,n){const r=n.displayName??void 0,i=n.email??void 0,o=n.phoneNumber??void 0,l=n.photoURL??void 0,d=n.tenantId??void 0,h=n._redirectEventId??void 0,f=n.createdAt??void 0,p=n.lastLoginAt??void 0,{uid:g,emailVerified:v,isAnonymous:_,providerData:C,stsTokenManager:x}=n;Ke(g&&x,e,"internal-error");const w=Ul.fromJSON(this.name,x);Ke(typeof g=="string",e,"internal-error"),ua(r,e.name),ua(i,e.name),Ke(typeof v=="boolean",e,"internal-error"),Ke(typeof _=="boolean",e,"internal-error"),ua(o,e.name),ua(l,e.name),ua(d,e.name),ua(h,e.name),ua(f,e.name),ua(p,e.name);const E=new us({uid:g,auth:e,email:i,emailVerified:v,displayName:r,isAnonymous:_,photoURL:l,phoneNumber:o,tenantId:d,stsTokenManager:w,createdAt:f,lastLoginAt:p});return C&&Array.isArray(C)&&(E.providerData=C.map(T=>({...T}))),h&&(E._redirectEventId=h),E}static async _fromIdTokenResponse(e,n,r=!1){const i=new Ul;i.updateFromServerResponse(n);const o=new us({uid:n.localId,auth:e,stsTokenManager:i,isAnonymous:r});return await gf(o),o}static async _fromGetAccountInfoResponse(e,n,r){const i=n.users[0];Ke(i.localId!==void 0,"internal-error");const o=i.providerUserInfo!==void 0?uC(i.providerUserInfo):[],l=!(i.email&&i.passwordHash)&&!o?.length,d=new Ul;d.updateFromIdToken(r);const h=new us({uid:i.localId,auth:e,stsTokenManager:d,isAnonymous:l}),f={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:o,metadata:new my(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!o?.length};return Object.assign(h,f),h}}const fw=new Map;function yi(t){Si(t instanceof Function,"Expected a class definition");let e=fw.get(t);return e?(Si(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,fw.set(t,e),e)}class dC{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,n){this.storage[e]=n}async _get(e){const n=this.storage[e];return n===void 0?null:n}async _remove(e){delete this.storage[e]}_addListener(e,n){}_removeListener(e,n){}}dC.type="NONE";const mw=dC;function Jh(t,e,n){return`firebase:${t}:${e}:${n}`}class Fl{constructor(e,n,r){this.persistence=e,this.auth=n,this.userKey=r;const{config:i,name:o}=this.auth;this.fullUserKey=Jh(this.userKey,i.apiKey,o),this.fullPersistenceKey=Jh("persistence",i.apiKey,o),this.boundEventHandler=n._onStorageEvent.bind(n),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const n=await pf(this.auth,{idToken:e}).catch(()=>{});return n?us._fromGetAccountInfoResponse(this.auth,n,e):null}return us._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const n=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,n)return this.setCurrentUser(n)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,n,r="authUser"){if(!n.length)return new Fl(yi(mw),e,r);const i=(await Promise.all(n.map(async f=>{if(await f._isAvailable())return f}))).filter(f=>f);let o=i[0]||yi(mw);const l=Jh(r,e.config.apiKey,e.name);let d=null;for(const f of n)try{const p=await f._get(l);if(p){let g;if(typeof p=="string"){const v=await pf(e,{idToken:p}).catch(()=>{});if(!v)break;g=await us._fromGetAccountInfoResponse(e,v,p)}else g=us._fromJSON(e,p);f!==o&&(d=g),o=f;break}}catch{}const h=i.filter(f=>f._shouldAllowMigration);return!o._shouldAllowMigration||!h.length?new Fl(o,e,r):(o=h[0],d&&await o._set(l,d.toJSON()),await Promise.all(n.map(async f=>{if(f!==o)try{await f._remove(l)}catch{}})),new Fl(o,e,r))}}function pw(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(pC(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(hC(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(yC(e))return"Blackberry";if(_C(e))return"Webos";if(fC(e))return"Safari";if((e.includes("chrome/")||mC(e))&&!e.includes("edge/"))return"Chrome";if(gC(e))return"Android";{const n=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=t.match(n);if(r?.length===2)return r[1]}return"Other"}function hC(t=er()){return/firefox\//i.test(t)}function fC(t=er()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function mC(t=er()){return/crios\//i.test(t)}function pC(t=er()){return/iemobile/i.test(t)}function gC(t=er()){return/android/i.test(t)}function yC(t=er()){return/blackberry/i.test(t)}function _C(t=er()){return/webos/i.test(t)}function t0(t=er()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function bk(t=er()){return t0(t)&&!!window.navigator?.standalone}function vk(){return OR()&&document.documentMode===10}function bC(t=er()){return t0(t)||gC(t)||_C(t)||yC(t)||/windows phone/i.test(t)||pC(t)}function vC(t,e=[]){let n;switch(t){case"Browser":n=pw(er());break;case"Worker":n=`${pw(er())}-${t}`;break;default:n=t}const r=e.length?e.join(","):"FirebaseCore-web";return`${n}/JsCore/${oc}/${r}`}class xk{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,n){const r=o=>new Promise((l,d)=>{try{const h=e(o);l(h)}catch(h){d(h)}});r.onAbort=n,this.queue.push(r);const i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const n=[];try{for(const r of this.queue)await r(e),r.onAbort&&n.push(r.onAbort)}catch(r){n.reverse();for(const i of n)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r?.message})}}}async function wk(t,e={}){return Ba(t,"GET","/v2/passwordPolicy",Po(t,e))}const Sk=6;class Ck{constructor(e){const n=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=n.minPasswordLength??Sk,n.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=n.maxPasswordLength),n.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=n.containsLowercaseCharacter),n.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=n.containsUppercaseCharacter),n.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=n.containsNumericCharacter),n.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=n.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const n={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,n),this.validatePasswordCharacterOptions(e,n),n.isValid&&(n.isValid=n.meetsMinPasswordLength??!0),n.isValid&&(n.isValid=n.meetsMaxPasswordLength??!0),n.isValid&&(n.isValid=n.containsLowercaseLetter??!0),n.isValid&&(n.isValid=n.containsUppercaseLetter??!0),n.isValid&&(n.isValid=n.containsNumericCharacter??!0),n.isValid&&(n.isValid=n.containsNonAlphanumericCharacter??!0),n}validatePasswordLengthOptions(e,n){const r=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;r&&(n.meetsMinPasswordLength=e.length>=r),i&&(n.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,n){this.updatePasswordCharacterOptionsStatuses(n,!1,!1,!1,!1);let r;for(let i=0;i<e.length;i++)r=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(n,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,n,r,i,o){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=n)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=o))}}class Ek{constructor(e,n,r,i){this.app=e,this.heartbeatServiceProvider=n,this.appCheckServiceProvider=r,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new gw(this),this.idTokenSubscription=new gw(this),this.beforeStateQueue=new xk(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=iC,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion,this._persistenceManagerAvailable=new Promise(o=>this._resolvePersistenceManagerAvailable=o)}_initializeWithPersistence(e,n){return n&&(this._popupRedirectResolver=yi(n)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await Fl.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(n),this.lastNotifiedUid=this.currentUser?.uid||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const n=await pf(this,{idToken:e}),r=await us._fromGetAccountInfoResponse(this,n,e);await this.directlySetCurrentUser(r)}catch(n){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",n),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(cs(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(l=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(l,l))}):this.directlySetCurrentUser(null)}const n=await this.assertedPersistence.getCurrentUser();let r=n,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=this.redirectUser?._redirectEventId,l=r?._redirectEventId,d=await this.tryRedirectSignIn(e);(!o||o===l)&&d?.user&&(r=d.user,i=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(r)}catch(o){r=n,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return Ke(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let n=null;try{n=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return n}async reloadAndSetCurrentUserOrClear(e){try{await gf(e)}catch(n){if(n?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=rk()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(cs(this.app))return Promise.reject(Ca(this));const n=e?wn(e):null;return n&&Ke(n.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(n&&n._clone(this))}async _updateCurrentUser(e,n=!1){if(!this._deleted)return e&&Ke(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),n||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return cs(this.app)?Promise.reject(Ca(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return cs(this.app)?Promise.reject(Ca(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(yi(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const n=this._getPasswordPolicyInternal();return n.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):n.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await wk(this),n=new Ck(e);this.tenantId===null?this._projectPasswordPolicy=n:this._tenantPasswordPolicies[this.tenantId]=n}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new Ju("auth","Firebase",e())}onAuthStateChanged(e,n,r){return this.registerStateListener(this.authStateSubscription,e,n,r)}beforeAuthStateChanged(e,n){return this.beforeStateQueue.pushCallback(e,n)}onIdTokenChanged(e,n,r){return this.registerStateListener(this.idTokenSubscription,e,n,r)}authStateReady(){return new Promise((e,n)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},n)}})}async revokeAccessToken(e){if(this.currentUser){const n=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:n};this.tenantId!=null&&(r.tenantId=this.tenantId),await _k(this,r)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,n){const r=await this.getOrInitRedirectPersistenceManager(n);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const n=e&&yi(e)||this._popupRedirectResolver;Ke(n,this,"argument-error"),this.redirectPersistenceManager=await Fl.create(this,[yi(n._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,n,r,i){if(this._deleted)return()=>{};const o=typeof n=="function"?n:n.next.bind(n);let l=!1;const d=this._isInitialized?Promise.resolve():this._initializationPromise;if(Ke(d,this,"internal-error"),d.then(()=>{l||o(this.currentUser)}),typeof n=="function"){const h=e.addObserver(n,r,i);return()=>{l=!0,h()}}else{const h=e.addObserver(n);return()=>{l=!0,h()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Ke(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=vC(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const n=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();n&&(e["X-Firebase-Client"]=n);const r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){if(cs(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&ek(`Error while retrieving App Check token: ${e.error}`),e?.token}}function lc(t){return wn(t)}class gw{constructor(e){this.auth=e,this.observer=null,this.addObserver=VR(n=>this.observer=n)}get next(){return Ke(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let Hf={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function Tk(t){Hf=t}function xC(t){return Hf.loadJS(t)}function Ak(){return Hf.recaptchaEnterpriseScript}function jk(){return Hf.gapiScript}function Rk(t){return`__${t}${Math.floor(Math.random()*1e6)}`}class Ik{constructor(){this.enterprise=new kk}ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}class kk{ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}const Dk="recaptcha-enterprise",wC="NO_RECAPTCHA";class Mk{constructor(e){this.type=Dk,this.auth=lc(e)}async verify(e="verify",n=!1){async function r(o){if(!n){if(o.tenantId==null&&o._agentRecaptchaConfig!=null)return o._agentRecaptchaConfig.siteKey;if(o.tenantId!=null&&o._tenantRecaptchaConfigs[o.tenantId]!==void 0)return o._tenantRecaptchaConfigs[o.tenantId].siteKey}return new Promise(async(l,d)=>{uk(o,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(h=>{if(h.recaptchaKey===void 0)d(new Error("recaptcha Enterprise site key undefined"));else{const f=new ck(h);return o.tenantId==null?o._agentRecaptchaConfig=f:o._tenantRecaptchaConfigs[o.tenantId]=f,l(f.siteKey)}}).catch(h=>{d(h)})})}function i(o,l,d){const h=window.grecaptcha;dw(h)?h.enterprise.ready(()=>{h.enterprise.execute(o,{action:e}).then(f=>{l(f)}).catch(()=>{l(wC)})}):d(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new Ik().execute("siteKey",{action:"verify"}):new Promise((o,l)=>{r(this.auth).then(d=>{if(!n&&dw(window.grecaptcha))i(d,o,l);else{if(typeof window>"u"){l(new Error("RecaptchaVerifier is only supported in browser"));return}let h=Ak();h.length!==0&&(h+=d),xC(h).then(()=>{i(d,o,l)}).catch(f=>{l(f)})}}).catch(d=>{l(d)})})}}async function yw(t,e,n,r=!1,i=!1){const o=new Mk(t);let l;if(i)l=wC;else try{l=await o.verify(n)}catch{l=await o.verify(n,!0)}const d={...e};if(n==="mfaSmsEnrollment"||n==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in d){const h=d.phoneEnrollmentInfo.phoneNumber,f=d.phoneEnrollmentInfo.recaptchaToken;Object.assign(d,{phoneEnrollmentInfo:{phoneNumber:h,recaptchaToken:f,captchaResponse:l,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in d){const h=d.phoneSignInInfo.recaptchaToken;Object.assign(d,{phoneSignInInfo:{recaptchaToken:h,captchaResponse:l,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return d}return r?Object.assign(d,{captchaResp:l}):Object.assign(d,{captchaResponse:l}),Object.assign(d,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(d,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),d}async function _w(t,e,n,r,i){if(t._getRecaptchaConfig()?.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const o=await yw(t,e,n,n==="getOobCode");return r(t,o)}else return r(t,e).catch(async o=>{if(o.code==="auth/missing-recaptcha-token"){console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const l=await yw(t,e,n,n==="getOobCode");return r(t,l)}else return Promise.reject(o)})}function Ok(t,e){const n=Xy(t,"auth");if(n.isInitialized()){const i=n.getImmediate(),o=n.getOptions();if(xi(o,e??{}))return i;fs(i,"already-initialized")}return n.initialize({options:e})}function Nk(t,e){const n=e?.persistence||[],r=(Array.isArray(n)?n:[n]).map(yi);e?.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(r,e?.popupRedirectResolver)}function Pk(t,e,n){const r=lc(t);Ke(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const i=!1,o=SC(e),{host:l,port:d}=Bk(e),h=d===null?"":`:${d}`,f={url:`${o}//${l}${h}/`},p=Object.freeze({host:l,port:d,protocol:o.replace(":",""),options:Object.freeze({disableWarnings:i})});if(!r._canInitEmulator){Ke(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),Ke(xi(f,r.config.emulator)&&xi(p,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=f,r.emulatorConfig=p,r.settings.appVerificationDisabledForTesting=!0,ac(l)?(YS(`${o}//${l}${h}`),XS("Auth",!0)):zk()}function SC(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function Bk(t){const e=SC(t),n=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){const o=i[1];return{host:o,port:bw(r.substr(o.length+1))}}else{const[o,l]=r.split(":");return{host:o,port:bw(l)}}}function bw(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}function zk(){function t(){const e=document.createElement("p"),n=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",n.position="fixed",n.width="100%",n.backgroundColor="#ffffff",n.border=".1em solid #000000",n.color="#b50000",n.bottom="0px",n.left="0px",n.margin="0px",n.zIndex="10000",n.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",t):t())}class n0{constructor(e,n){this.providerId=e,this.signInMethod=n}toJSON(){return gi("not implemented")}_getIdTokenResponse(e){return gi("not implemented")}_linkToIdToken(e,n){return gi("not implemented")}_getReauthenticationResolver(e){return gi("not implemented")}}async function Lk(t,e){return Ba(t,"POST","/v1/accounts:signUp",e)}async function Uk(t,e){return qf(t,"POST","/v1/accounts:signInWithPassword",Po(t,e))}async function Fk(t,e){return qf(t,"POST","/v1/accounts:signInWithEmailLink",Po(t,e))}async function Vk(t,e){return qf(t,"POST","/v1/accounts:signInWithEmailLink",Po(t,e))}class Bu extends n0{constructor(e,n,r,i=null){super("password",r),this._email=e,this._password=n,this._tenantId=i}static _fromEmailAndPassword(e,n){return new Bu(e,n,"password")}static _fromEmailAndCode(e,n,r=null){return new Bu(e,n,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e;if(n?.email&&n?.password){if(n.signInMethod==="password")return this._fromEmailAndPassword(n.email,n.password);if(n.signInMethod==="emailLink")return this._fromEmailAndCode(n.email,n.password,n.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const n={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return _w(e,n,"signInWithPassword",Uk);case"emailLink":return Fk(e,{email:this._email,oobCode:this._password});default:fs(e,"internal-error")}}async _linkToIdToken(e,n){switch(this.signInMethod){case"password":const r={idToken:n,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return _w(e,r,"signUpPassword",Lk);case"emailLink":return Vk(e,{idToken:n,email:this._email,oobCode:this._password});default:fs(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function Vl(t,e){return qf(t,"POST","/v1/accounts:signInWithIdp",Po(t,e))}const $k="http://localhost";class Do extends n0{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const n=new Do(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(n.idToken=e.idToken),e.accessToken&&(n.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(n.nonce=e.nonce),e.pendingToken&&(n.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(n.accessToken=e.oauthToken,n.secret=e.oauthTokenSecret):fs("argument-error"),n}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:i,...o}=n;if(!r||!i)return null;const l=new Do(r,i);return l.idToken=o.idToken||void 0,l.accessToken=o.accessToken||void 0,l.secret=o.secret,l.nonce=o.nonce,l.pendingToken=o.pendingToken||null,l}_getIdTokenResponse(e){const n=this.buildRequest();return Vl(e,n)}_linkToIdToken(e,n){const r=this.buildRequest();return r.idToken=n,Vl(e,r)}_getReauthenticationResolver(e){const n=this.buildRequest();return n.autoCreate=!1,Vl(e,n)}buildRequest(){const e={requestUri:$k,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const n={};this.idToken&&(n.id_token=this.idToken),this.accessToken&&(n.access_token=this.accessToken),this.secret&&(n.oauth_token_secret=this.secret),n.providerId=this.providerId,this.nonce&&!this.pendingToken&&(n.nonce=this.nonce),e.postBody=ed(n)}return e}}function qk(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function Hk(t){const e=xu(wu(t)).link,n=e?xu(wu(e)).deep_link_id:null,r=xu(wu(t)).deep_link_id;return(r?xu(wu(r)).link:null)||r||n||e||t}class r0{constructor(e){const n=xu(wu(e)),r=n.apiKey??null,i=n.oobCode??null,o=qk(n.mode??null);Ke(r&&i&&o,"argument-error"),this.apiKey=r,this.operation=o,this.code=i,this.continueUrl=n.continueUrl??null,this.languageCode=n.lang??null,this.tenantId=n.tenantId??null}static parseLink(e){const n=Hk(e);try{return new r0(n)}catch{return null}}}class cc{constructor(){this.providerId=cc.PROVIDER_ID}static credential(e,n){return Bu._fromEmailAndPassword(e,n)}static credentialWithLink(e,n){const r=r0.parseLink(n);return Ke(r,"argument-error"),Bu._fromEmailAndCode(e,r.code,r.tenantId)}}cc.PROVIDER_ID="password";cc.EMAIL_PASSWORD_SIGN_IN_METHOD="password";cc.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class CC{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class nd extends CC{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class ha extends nd{constructor(){super("facebook.com")}static credential(e){return Do._fromParams({providerId:ha.PROVIDER_ID,signInMethod:ha.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return ha.credentialFromTaggedObject(e)}static credentialFromError(e){return ha.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return ha.credential(e.oauthAccessToken)}catch{return null}}}ha.FACEBOOK_SIGN_IN_METHOD="facebook.com";ha.PROVIDER_ID="facebook.com";class fa extends nd{constructor(){super("google.com"),this.addScope("profile")}static credential(e,n){return Do._fromParams({providerId:fa.PROVIDER_ID,signInMethod:fa.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:n})}static credentialFromResult(e){return fa.credentialFromTaggedObject(e)}static credentialFromError(e){return fa.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:n,oauthAccessToken:r}=e;if(!n&&!r)return null;try{return fa.credential(n,r)}catch{return null}}}fa.GOOGLE_SIGN_IN_METHOD="google.com";fa.PROVIDER_ID="google.com";class ma extends nd{constructor(){super("github.com")}static credential(e){return Do._fromParams({providerId:ma.PROVIDER_ID,signInMethod:ma.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return ma.credentialFromTaggedObject(e)}static credentialFromError(e){return ma.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return ma.credential(e.oauthAccessToken)}catch{return null}}}ma.GITHUB_SIGN_IN_METHOD="github.com";ma.PROVIDER_ID="github.com";class pa extends nd{constructor(){super("twitter.com")}static credential(e,n){return Do._fromParams({providerId:pa.PROVIDER_ID,signInMethod:pa.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:n})}static credentialFromResult(e){return pa.credentialFromTaggedObject(e)}static credentialFromError(e){return pa.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:n,oauthTokenSecret:r}=e;if(!n||!r)return null;try{return pa.credential(n,r)}catch{return null}}}pa.TWITTER_SIGN_IN_METHOD="twitter.com";pa.PROVIDER_ID="twitter.com";class Gl{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,n,r,i=!1){const o=await us._fromIdTokenResponse(e,r,i),l=vw(r);return new Gl({user:o,providerId:l,_tokenResponse:r,operationType:n})}static async _forOperation(e,n,r){await e._updateTokensIfNecessary(r,!0);const i=vw(r);return new Gl({user:e,providerId:i,_tokenResponse:r,operationType:n})}}function vw(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}class yf extends Ii{constructor(e,n,r,i){super(n.code,n.message),this.operationType=r,this.user=i,Object.setPrototypeOf(this,yf.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:n.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,n,r,i){return new yf(e,n,r,i)}}function EC(t,e,n,r){return(e==="reauthenticate"?n._getReauthenticationResolver(t):n._getIdTokenResponse(t)).catch(o=>{throw o.code==="auth/multi-factor-auth-required"?yf._fromErrorAndOperation(t,o,e,r):o})}async function Gk(t,e,n=!1){const r=await Pu(t,e._linkToIdToken(t.auth,await t.getIdToken()),n);return Gl._forOperation(t,"link",r)}async function Wk(t,e,n=!1){const{auth:r}=t;if(cs(r.app))return Promise.reject(Ca(r));const i="reauthenticate";try{const o=await Pu(t,EC(r,i,e,t),n);Ke(o.idToken,r,"internal-error");const l=e0(o.idToken);Ke(l,r,"internal-error");const{sub:d}=l;return Ke(t.uid===d,r,"user-mismatch"),Gl._forOperation(t,i,o)}catch(o){throw o?.code==="auth/user-not-found"&&fs(r,"user-mismatch"),o}}async function TC(t,e,n=!1){if(cs(t.app))return Promise.reject(Ca(t));const r="signIn",i=await EC(t,r,e),o=await Gl._fromIdTokenResponse(t,r,i);return n||await t._updateCurrentUser(o.user),o}async function Qk(t,e){return TC(lc(t),e)}async function Kk(t){const e=lc(t);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}function Yk(t,e,n){return cs(t.app)?Promise.reject(Ca(t)):Qk(wn(t),cc.credential(e,n)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&Kk(t),r})}function Xk(t,e,n,r){return wn(t).onIdTokenChanged(e,n,r)}function Zk(t,e,n){return wn(t).beforeAuthStateChanged(e,n)}function Jk(t,e,n,r){return wn(t).onAuthStateChanged(e,n,r)}function eD(t){return wn(t).signOut()}const _f="__sak";class AC{constructor(e,n){this.storageRetriever=e,this.type=n}_isAvailable(){try{return this.storage?(this.storage.setItem(_f,"1"),this.storage.removeItem(_f),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,n){return this.storage.setItem(e,JSON.stringify(n)),Promise.resolve()}_get(e){const n=this.storage.getItem(e);return Promise.resolve(n?JSON.parse(n):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}const tD=1e3,nD=10;class jC extends AC{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,n)=>this.onStorageEvent(e,n),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=bC(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const n of Object.keys(this.listeners)){const r=this.storage.getItem(n),i=this.localCache[n];r!==i&&e(n,i,r)}}onStorageEvent(e,n=!1){if(!e.key){this.forAllChangedKeys((l,d,h)=>{this.notifyListeners(l,h)});return}const r=e.key;n?this.detachListener():this.stopPolling();const i=()=>{const l=this.storage.getItem(r);!n&&this.localCache[r]===l||this.notifyListeners(r,l)},o=this.storage.getItem(r);vk()&&o!==e.newValue&&e.newValue!==e.oldValue?setTimeout(i,nD):i()}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const i of Array.from(r))i(n&&JSON.parse(n))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,n,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:n,newValue:r}),!0)})},tD)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,n){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,n){await super._set(e,n),this.localCache[e]=JSON.stringify(n)}async _get(e){const n=await super._get(e);return this.localCache[e]=JSON.stringify(n),n}async _remove(e){await super._remove(e),delete this.localCache[e]}}jC.type="LOCAL";const rD=jC;class RC extends AC{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,n){}_removeListener(e,n){}}RC.type="SESSION";const IC=RC;function sD(t){return Promise.all(t.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(n){return{fulfilled:!1,reason:n}}}))}class Gf{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const n=this.receivers.find(i=>i.isListeningto(e));if(n)return n;const r=new Gf(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const n=e,{eventId:r,eventType:i,data:o}=n.data,l=this.handlersMap[i];if(!l?.size)return;n.ports[0].postMessage({status:"ack",eventId:r,eventType:i});const d=Array.from(l).map(async f=>f(n.origin,o)),h=await sD(d);n.ports[0].postMessage({status:"done",eventId:r,eventType:i,response:h})}_subscribe(e,n){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(n)}_unsubscribe(e,n){this.handlersMap[e]&&n&&this.handlersMap[e].delete(n),(!n||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Gf.receivers=[];function s0(t="",e=10){let n="";for(let r=0;r<e;r++)n+=Math.floor(Math.random()*10);return t+n}class iD{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,n,r=50){const i=typeof MessageChannel<"u"?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let o,l;return new Promise((d,h)=>{const f=s0("",20);i.port1.start();const p=setTimeout(()=>{h(new Error("unsupported_event"))},r);l={messageChannel:i,onMessage(g){const v=g;if(v.data.eventId===f)switch(v.data.status){case"ack":clearTimeout(p),o=setTimeout(()=>{h(new Error("timeout"))},3e3);break;case"done":clearTimeout(o),d(v.data.response);break;default:clearTimeout(p),clearTimeout(o),h(new Error("invalid_response"));break}}},this.handlers.add(l),i.port1.addEventListener("message",l.onMessage),this.target.postMessage({eventType:e,eventId:f,data:n},[i.port2])}).finally(()=>{l&&this.removeMessageHandler(l)})}}function Vs(){return window}function aD(t){Vs().location.href=t}function kC(){return typeof Vs().WorkerGlobalScope<"u"&&typeof Vs().importScripts=="function"}async function oD(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function lD(){return navigator?.serviceWorker?.controller||null}function cD(){return kC()?self:null}const DC="firebaseLocalStorageDb",uD=1,bf="firebaseLocalStorage",MC="fbase_key";class rd{constructor(e){this.request=e}toPromise(){return new Promise((e,n)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{n(this.request.error)})})}}function Wf(t,e){return t.transaction([bf],e?"readwrite":"readonly").objectStore(bf)}function dD(){const t=indexedDB.deleteDatabase(DC);return new rd(t).toPromise()}function py(){const t=indexedDB.open(DC,uD);return new Promise((e,n)=>{t.addEventListener("error",()=>{n(t.error)}),t.addEventListener("upgradeneeded",()=>{const r=t.result;try{r.createObjectStore(bf,{keyPath:MC})}catch(i){n(i)}}),t.addEventListener("success",async()=>{const r=t.result;r.objectStoreNames.contains(bf)?e(r):(r.close(),await dD(),e(await py()))})})}async function xw(t,e,n){const r=Wf(t,!0).put({[MC]:e,value:n});return new rd(r).toPromise()}async function hD(t,e){const n=Wf(t,!1).get(e),r=await new rd(n).toPromise();return r===void 0?null:r.value}function ww(t,e){const n=Wf(t,!0).delete(e);return new rd(n).toPromise()}const fD=800,mD=3;class OC{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await py(),this.db)}async _withRetries(e){let n=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(n++>mD)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return kC()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Gf._getInstance(cD()),this.receiver._subscribe("keyChanged",async(e,n)=>({keyProcessed:(await this._poll()).includes(n.key)})),this.receiver._subscribe("ping",async(e,n)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await oD(),!this.activeServiceWorker)return;this.sender=new iD(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||lD()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await py();return await xw(e,_f,"1"),await ww(e,_f),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,n){return this._withPendingWrite(async()=>(await this._withRetries(r=>xw(r,e,n)),this.localCache[e]=n,this.notifyServiceWorker(e)))}async _get(e){const n=await this._withRetries(r=>hD(r,e));return this.localCache[e]=n,n}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(n=>ww(n,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(i=>{const o=Wf(i,!1).getAll();return new rd(o).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const n=[],r=new Set;if(e.length!==0)for(const{fbase_key:i,value:o}of e)r.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(o)&&(this.notifyListeners(i,o),n.push(i));for(const i of Object.keys(this.localCache))this.localCache[i]&&!r.has(i)&&(this.notifyListeners(i,null),n.push(i));return n}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const i of Array.from(r))i(n)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),fD)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,n){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}OC.type="LOCAL";const pD=OC;new td(3e4,6e4);function gD(t,e){return e?yi(e):(Ke(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}class i0 extends n0{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Vl(e,this._buildIdpRequest())}_linkToIdToken(e,n){return Vl(e,this._buildIdpRequest(n))}_getReauthenticationResolver(e){return Vl(e,this._buildIdpRequest())}_buildIdpRequest(e){const n={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(n.idToken=e),n}}function yD(t){return TC(t.auth,new i0(t),t.bypassAuthState)}function _D(t){const{auth:e,user:n}=t;return Ke(n,e,"internal-error"),Wk(n,new i0(t),t.bypassAuthState)}async function bD(t){const{auth:e,user:n}=t;return Ke(n,e,"internal-error"),Gk(n,new i0(t),t.bypassAuthState)}class NC{constructor(e,n,r,i,o=!1){this.auth=e,this.resolver=r,this.user=i,this.bypassAuthState=o,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(n)?n:[n]}execute(){return new Promise(async(e,n)=>{this.pendingPromise={resolve:e,reject:n};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:n,sessionId:r,postBody:i,tenantId:o,error:l,type:d}=e;if(l){this.reject(l);return}const h={auth:this.auth,requestUri:n,sessionId:r,tenantId:o||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(d)(h))}catch(f){this.reject(f)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return yD;case"linkViaPopup":case"linkViaRedirect":return bD;case"reauthViaPopup":case"reauthViaRedirect":return _D;default:fs(this.auth,"internal-error")}}resolve(e){Si(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Si(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const vD=new td(2e3,1e4);class Ll extends NC{constructor(e,n,r,i,o){super(e,n,i,o),this.provider=r,this.authWindow=null,this.pollId=null,Ll.currentPopupAction&&Ll.currentPopupAction.cancel(),Ll.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Ke(e,this.auth,"internal-error"),e}async onExecution(){Si(this.filter.length===1,"Popup operations only handle one event");const e=s0();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(n=>{this.reject(n)}),this.resolver._isIframeWebStorageSupported(this.auth,n=>{n||this.reject(Fs(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(Fs(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Ll.currentPopupAction=null}pollUserCancellation(){const e=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Fs(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,vD.get())};e()}}Ll.currentPopupAction=null;const xD="pendingRedirect",ef=new Map;class wD extends NC{constructor(e,n,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],n,void 0,r),this.eventId=null}async execute(){let e=ef.get(this.auth._key());if(!e){try{const r=await SD(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(n){e=()=>Promise.reject(n)}ef.set(this.auth._key(),e)}return this.bypassAuthState||ef.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const n=await this.auth._redirectUserForId(e.eventId);if(n)return this.user=n,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function SD(t,e){const n=TD(e),r=ED(t);if(!await r._isAvailable())return!1;const i=await r._get(n)==="true";return await r._remove(n),i}function CD(t,e){ef.set(t._key(),e)}function ED(t){return yi(t._redirectPersistence)}function TD(t){return Jh(xD,t.config.apiKey,t.name)}async function AD(t,e,n=!1){if(cs(t.app))return Promise.reject(Ca(t));const r=lc(t),i=gD(r,e),l=await new wD(r,i,n).execute();return l&&!n&&(delete l.user._redirectEventId,await r._persistUserIfCurrent(l.user),await r._setRedirectUser(null,e)),l}const jD=600*1e3;class RD{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let n=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(n=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!ID(e)||(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=e,n=!0)),n}sendToConsumer(e,n){if(e.error&&!PC(e)){const r=e.error.code?.split("auth/")[1]||"internal-error";n.onError(Fs(this.auth,r))}else n.onAuthEvent(e)}isEventForConsumer(e,n){const r=n.eventId===null||!!e.eventId&&e.eventId===n.eventId;return n.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=jD&&this.cachedEventUids.clear(),this.cachedEventUids.has(Sw(e))}saveEventToCache(e){this.cachedEventUids.add(Sw(e)),this.lastProcessedEventTime=Date.now()}}function Sw(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(e=>e).join("-")}function PC({type:t,error:e}){return t==="unknown"&&e?.code==="auth/no-auth-event"}function ID(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return PC(t);default:return!1}}async function kD(t,e={}){return Ba(t,"GET","/v1/projects",e)}const DD=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,MD=/^https?/;async function OD(t){if(t.config.emulator)return;const{authorizedDomains:e}=await kD(t);for(const n of e)try{if(ND(n))return}catch{}fs(t,"unauthorized-domain")}function ND(t){const e=fy(),{protocol:n,hostname:r}=new URL(e);if(t.startsWith("chrome-extension://")){const l=new URL(t);return l.hostname===""&&r===""?n==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):n==="chrome-extension:"&&l.hostname===r}if(!MD.test(n))return!1;if(DD.test(t))return r===t;const i=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}const PD=new td(3e4,6e4);function Cw(){const t=Vs().___jsl;if(t?.H){for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let n=0;n<t.CP.length;n++)t.CP[n]=null}}function BD(t){return new Promise((e,n)=>{function r(){Cw(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{Cw(),n(Fs(t,"network-request-failed"))},timeout:PD.get()})}if(Vs().gapi?.iframes?.Iframe)e(gapi.iframes.getContext());else if(Vs().gapi?.load)r();else{const i=Rk("iframefcb");return Vs()[i]=()=>{gapi.load?r():n(Fs(t,"network-request-failed"))},xC(`${jk()}?onload=${i}`).catch(o=>n(o))}}).catch(e=>{throw tf=null,e})}let tf=null;function zD(t){return tf=tf||BD(t),tf}const LD=new td(5e3,15e3),UD="__/auth/iframe",FD="emulator/auth/iframe",VD={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},$D=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function qD(t){const e=t.config;Ke(e.authDomain,t,"auth-domain-config-required");const n=e.emulator?Jy(e,FD):`https://${t.config.authDomain}/${UD}`,r={apiKey:e.apiKey,appName:t.name,v:oc},i=$D.get(t.config.apiHost);i&&(r.eid=i);const o=t._getFrameworks();return o.length&&(r.fw=o.join(",")),`${n}?${ed(r).slice(1)}`}async function HD(t){const e=await zD(t),n=Vs().gapi;return Ke(n,t,"internal-error"),e.open({where:document.body,url:qD(t),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:VD,dontclear:!0},r=>new Promise(async(i,o)=>{await r.restyle({setHideOnLeave:!1});const l=Fs(t,"network-request-failed"),d=Vs().setTimeout(()=>{o(l)},LD.get());function h(){Vs().clearTimeout(d),i(r)}r.ping(h).then(h,()=>{o(l)})}))}const GD={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},WD=500,QD=600,KD="_blank",YD="http://localhost";class Ew{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function XD(t,e,n,r=WD,i=QD){const o=Math.max((window.screen.availHeight-i)/2,0).toString(),l=Math.max((window.screen.availWidth-r)/2,0).toString();let d="";const h={...GD,width:r.toString(),height:i.toString(),top:o,left:l},f=er().toLowerCase();n&&(d=mC(f)?KD:n),hC(f)&&(e=e||YD,h.scrollbars="yes");const p=Object.entries(h).reduce((v,[_,C])=>`${v}${_}=${C},`,"");if(bk(f)&&d!=="_self")return ZD(e||"",d),new Ew(null);const g=window.open(e||"",d,p);Ke(g,t,"popup-blocked");try{g.focus()}catch{}return new Ew(g)}function ZD(t,e){const n=document.createElement("a");n.href=t,n.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}const JD="__/auth/handler",eM="emulator/auth/handler",tM=encodeURIComponent("fac");async function Tw(t,e,n,r,i,o){Ke(t.config.authDomain,t,"auth-domain-config-required"),Ke(t.config.apiKey,t,"invalid-api-key");const l={apiKey:t.config.apiKey,appName:t.name,authType:n,redirectUrl:r,v:oc,eventId:i};if(e instanceof CC){e.setDefaultLanguage(t.languageCode),l.providerId=e.providerId||"",FR(e.getCustomParameters())||(l.customParameters=JSON.stringify(e.getCustomParameters()));for(const[p,g]of Object.entries({}))l[p]=g}if(e instanceof nd){const p=e.getScopes().filter(g=>g!=="");p.length>0&&(l.scopes=p.join(","))}t.tenantId&&(l.tid=t.tenantId);const d=l;for(const p of Object.keys(d))d[p]===void 0&&delete d[p];const h=await t._getAppCheckToken(),f=h?`#${tM}=${encodeURIComponent(h)}`:"";return`${nM(t)}?${ed(d).slice(1)}${f}`}function nM({config:t}){return t.emulator?Jy(t,eM):`https://${t.authDomain}/${JD}`}const Ug="webStorageSupport";class rM{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=IC,this._completeRedirectFn=AD,this._overrideRedirectResult=CD}async _openPopup(e,n,r,i){Si(this.eventManagers[e._key()]?.manager,"_initialize() not called before _openPopup()");const o=await Tw(e,n,r,fy(),i);return XD(e,o,s0())}async _openRedirect(e,n,r,i){await this._originValidation(e);const o=await Tw(e,n,r,fy(),i);return aD(o),new Promise(()=>{})}_initialize(e){const n=e._key();if(this.eventManagers[n]){const{manager:i,promise:o}=this.eventManagers[n];return i?Promise.resolve(i):(Si(o,"If manager is not set, promise should be"),o)}const r=this.initAndGetManager(e);return this.eventManagers[n]={promise:r},r.catch(()=>{delete this.eventManagers[n]}),r}async initAndGetManager(e){const n=await HD(e),r=new RD(e);return n.register("authEvent",i=>(Ke(i?.authEvent,e,"invalid-auth-event"),{status:r.onEvent(i.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=n,r}_isIframeWebStorageSupported(e,n){this.iframes[e._key()].send(Ug,{type:Ug},i=>{const o=i?.[0]?.[Ug];o!==void 0&&n(!!o),fs(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const n=e._key();return this.originValidationPromises[n]||(this.originValidationPromises[n]=OD(e)),this.originValidationPromises[n]}get _shouldInitProactively(){return bC()||fC()||t0()}}const sM=rM;var Aw="@firebase/auth",jw="1.12.0";class iM{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const n=this.auth.onIdTokenChanged(r=>{e(r?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,n),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const n=this.internalListeners.get(e);n&&(this.internalListeners.delete(e),n(),this.updateProactiveRefresh())}assertAuthConfigured(){Ke(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function aM(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function oM(t){Hl(new ko("auth",(e,{options:n})=>{const r=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),o=e.getProvider("app-check-internal"),{apiKey:l,authDomain:d}=r.options;Ke(l&&!l.includes(":"),"invalid-api-key",{appName:r.name});const h={apiKey:l,authDomain:d,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:vC(t)},f=new Ek(r,i,o,h);return Nk(f,n),f},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,n,r)=>{e.getProvider("auth-internal").initialize()})),Hl(new ko("auth-internal",e=>{const n=lc(e.getProvider("auth").getImmediate());return(r=>new iM(r))(n)},"PRIVATE").setInstantiationMode("EXPLICIT")),Sa(Aw,jw,aM(t)),Sa(Aw,jw,"esm2020")}const lM=300,cM=KS("authIdTokenMaxAge")||lM;let Rw=null;const uM=t=>async e=>{const n=e&&await e.getIdTokenResult(),r=n&&(new Date().getTime()-Date.parse(n.issuedAtTime))/1e3;if(r&&r>cM)return;const i=n?.token;Rw!==i&&(Rw=i,await fetch(t,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))};function dM(t=tC()){const e=Xy(t,"auth");if(e.isInitialized())return e.getImmediate();const n=Ok(t,{popupRedirectResolver:sM,persistence:[pD,rD,IC]}),r=KS("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const o=new URL(r,location.origin);if(location.origin===o.origin){const l=uM(o.toString());Zk(n,l,()=>l(n.currentUser)),Xk(n,d=>l(d))}}const i=WS("auth");return i&&Pk(n,`http://${i}`),n}function hM(){return document.getElementsByTagName("head")?.[0]??document}Tk({loadJS(t){return new Promise((e,n)=>{const r=document.createElement("script");r.setAttribute("src",t),r.onload=e,r.onerror=i=>{const o=Fs("internal-error");o.customData=i,n(o)},r.type="text/javascript",r.charset="UTF-8",hM().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});oM("Browser");var fM="firebase",mM="12.7.0";Sa(fM,mM,"app");const pM={apiKey:"AIzaSyCfvR8bEeW2CXdD31Ec34doRNThnbryXJo",authDomain:"budget-tkl.firebaseapp.com",projectId:"budget-tkl",storageBucket:"budget-tkl.firebasestorage.app",messagingSenderId:"631248313026",appId:"1:631248313026:web:36574d789a42b2d102f95b"},BC=eC(pM);function za(){const t=dM(BC);async function e(){return!1}async function n(h,f){return Yk(t,h,f)}function r(){return eD(t)}function i(h){Jk(t,f=>{h(f)})}function o(){return t.currentUser}function l(){const h=t.currentUser;if(!h)throw new Error("Not authenticated");if(!h.email)throw new Error("Email is required but not available for this account");return h.email}return{set_user_listener:i,delete_firebase_user:e,login_firebase_user:n,logout_firebase_user:r,get_current_firebase_user:o,requireUserEmail:l}}const La=300*1e3,gM=1800*1e3,Be=new tR({defaultOptions:{queries:{staleTime:La,gcTime:gM,refetchOnWindowFocus:!1,refetchOnReconnect:!0,retry:1,refetchOnMount:!0},mutations:{retry:1}}});Be.getQueryCache().subscribe(t=>{const e=t?.query;if(e&&t.type==="updated"){const{state:n}=e;n.status==="error"&&n.error&&console.error("[RQ] Query FAILED:",e.queryKey,n.error)}});const Te={user:t=>["user",t],budget:t=>["budget",t],month:(t,e,n)=>["month",t,e,n],payees:t=>["payees",t],accessibleBudgets:t=>["accessibleBudgets",t],feedback:()=>["feedback"]};function yM({children:t}){return u.jsx(nR,{client:Be,children:t})}var Iw=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var Ea,zC;(function(){var t;function e(I,D){function P(){}P.prototype=D.prototype,I.F=D.prototype,I.prototype=new P,I.prototype.constructor=I,I.D=function(L,q,A){for(var O=Array(arguments.length-2),N=2;N<arguments.length;N++)O[N-2]=arguments[N];return D.prototype[q].apply(L,O)}}function n(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(r,n),r.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(I,D,P){P||(P=0);const L=Array(16);if(typeof D=="string")for(var q=0;q<16;++q)L[q]=D.charCodeAt(P++)|D.charCodeAt(P++)<<8|D.charCodeAt(P++)<<16|D.charCodeAt(P++)<<24;else for(q=0;q<16;++q)L[q]=D[P++]|D[P++]<<8|D[P++]<<16|D[P++]<<24;D=I.g[0],P=I.g[1],q=I.g[2];let A=I.g[3],O;O=D+(A^P&(q^A))+L[0]+3614090360&4294967295,D=P+(O<<7&4294967295|O>>>25),O=A+(q^D&(P^q))+L[1]+3905402710&4294967295,A=D+(O<<12&4294967295|O>>>20),O=q+(P^A&(D^P))+L[2]+606105819&4294967295,q=A+(O<<17&4294967295|O>>>15),O=P+(D^q&(A^D))+L[3]+3250441966&4294967295,P=q+(O<<22&4294967295|O>>>10),O=D+(A^P&(q^A))+L[4]+4118548399&4294967295,D=P+(O<<7&4294967295|O>>>25),O=A+(q^D&(P^q))+L[5]+1200080426&4294967295,A=D+(O<<12&4294967295|O>>>20),O=q+(P^A&(D^P))+L[6]+2821735955&4294967295,q=A+(O<<17&4294967295|O>>>15),O=P+(D^q&(A^D))+L[7]+4249261313&4294967295,P=q+(O<<22&4294967295|O>>>10),O=D+(A^P&(q^A))+L[8]+1770035416&4294967295,D=P+(O<<7&4294967295|O>>>25),O=A+(q^D&(P^q))+L[9]+2336552879&4294967295,A=D+(O<<12&4294967295|O>>>20),O=q+(P^A&(D^P))+L[10]+4294925233&4294967295,q=A+(O<<17&4294967295|O>>>15),O=P+(D^q&(A^D))+L[11]+2304563134&4294967295,P=q+(O<<22&4294967295|O>>>10),O=D+(A^P&(q^A))+L[12]+1804603682&4294967295,D=P+(O<<7&4294967295|O>>>25),O=A+(q^D&(P^q))+L[13]+4254626195&4294967295,A=D+(O<<12&4294967295|O>>>20),O=q+(P^A&(D^P))+L[14]+2792965006&4294967295,q=A+(O<<17&4294967295|O>>>15),O=P+(D^q&(A^D))+L[15]+1236535329&4294967295,P=q+(O<<22&4294967295|O>>>10),O=D+(q^A&(P^q))+L[1]+4129170786&4294967295,D=P+(O<<5&4294967295|O>>>27),O=A+(P^q&(D^P))+L[6]+3225465664&4294967295,A=D+(O<<9&4294967295|O>>>23),O=q+(D^P&(A^D))+L[11]+643717713&4294967295,q=A+(O<<14&4294967295|O>>>18),O=P+(A^D&(q^A))+L[0]+3921069994&4294967295,P=q+(O<<20&4294967295|O>>>12),O=D+(q^A&(P^q))+L[5]+3593408605&4294967295,D=P+(O<<5&4294967295|O>>>27),O=A+(P^q&(D^P))+L[10]+38016083&4294967295,A=D+(O<<9&4294967295|O>>>23),O=q+(D^P&(A^D))+L[15]+3634488961&4294967295,q=A+(O<<14&4294967295|O>>>18),O=P+(A^D&(q^A))+L[4]+3889429448&4294967295,P=q+(O<<20&4294967295|O>>>12),O=D+(q^A&(P^q))+L[9]+568446438&4294967295,D=P+(O<<5&4294967295|O>>>27),O=A+(P^q&(D^P))+L[14]+3275163606&4294967295,A=D+(O<<9&4294967295|O>>>23),O=q+(D^P&(A^D))+L[3]+4107603335&4294967295,q=A+(O<<14&4294967295|O>>>18),O=P+(A^D&(q^A))+L[8]+1163531501&4294967295,P=q+(O<<20&4294967295|O>>>12),O=D+(q^A&(P^q))+L[13]+2850285829&4294967295,D=P+(O<<5&4294967295|O>>>27),O=A+(P^q&(D^P))+L[2]+4243563512&4294967295,A=D+(O<<9&4294967295|O>>>23),O=q+(D^P&(A^D))+L[7]+1735328473&4294967295,q=A+(O<<14&4294967295|O>>>18),O=P+(A^D&(q^A))+L[12]+2368359562&4294967295,P=q+(O<<20&4294967295|O>>>12),O=D+(P^q^A)+L[5]+4294588738&4294967295,D=P+(O<<4&4294967295|O>>>28),O=A+(D^P^q)+L[8]+2272392833&4294967295,A=D+(O<<11&4294967295|O>>>21),O=q+(A^D^P)+L[11]+1839030562&4294967295,q=A+(O<<16&4294967295|O>>>16),O=P+(q^A^D)+L[14]+4259657740&4294967295,P=q+(O<<23&4294967295|O>>>9),O=D+(P^q^A)+L[1]+2763975236&4294967295,D=P+(O<<4&4294967295|O>>>28),O=A+(D^P^q)+L[4]+1272893353&4294967295,A=D+(O<<11&4294967295|O>>>21),O=q+(A^D^P)+L[7]+4139469664&4294967295,q=A+(O<<16&4294967295|O>>>16),O=P+(q^A^D)+L[10]+3200236656&4294967295,P=q+(O<<23&4294967295|O>>>9),O=D+(P^q^A)+L[13]+681279174&4294967295,D=P+(O<<4&4294967295|O>>>28),O=A+(D^P^q)+L[0]+3936430074&4294967295,A=D+(O<<11&4294967295|O>>>21),O=q+(A^D^P)+L[3]+3572445317&4294967295,q=A+(O<<16&4294967295|O>>>16),O=P+(q^A^D)+L[6]+76029189&4294967295,P=q+(O<<23&4294967295|O>>>9),O=D+(P^q^A)+L[9]+3654602809&4294967295,D=P+(O<<4&4294967295|O>>>28),O=A+(D^P^q)+L[12]+3873151461&4294967295,A=D+(O<<11&4294967295|O>>>21),O=q+(A^D^P)+L[15]+530742520&4294967295,q=A+(O<<16&4294967295|O>>>16),O=P+(q^A^D)+L[2]+3299628645&4294967295,P=q+(O<<23&4294967295|O>>>9),O=D+(q^(P|~A))+L[0]+4096336452&4294967295,D=P+(O<<6&4294967295|O>>>26),O=A+(P^(D|~q))+L[7]+1126891415&4294967295,A=D+(O<<10&4294967295|O>>>22),O=q+(D^(A|~P))+L[14]+2878612391&4294967295,q=A+(O<<15&4294967295|O>>>17),O=P+(A^(q|~D))+L[5]+4237533241&4294967295,P=q+(O<<21&4294967295|O>>>11),O=D+(q^(P|~A))+L[12]+1700485571&4294967295,D=P+(O<<6&4294967295|O>>>26),O=A+(P^(D|~q))+L[3]+2399980690&4294967295,A=D+(O<<10&4294967295|O>>>22),O=q+(D^(A|~P))+L[10]+4293915773&4294967295,q=A+(O<<15&4294967295|O>>>17),O=P+(A^(q|~D))+L[1]+2240044497&4294967295,P=q+(O<<21&4294967295|O>>>11),O=D+(q^(P|~A))+L[8]+1873313359&4294967295,D=P+(O<<6&4294967295|O>>>26),O=A+(P^(D|~q))+L[15]+4264355552&4294967295,A=D+(O<<10&4294967295|O>>>22),O=q+(D^(A|~P))+L[6]+2734768916&4294967295,q=A+(O<<15&4294967295|O>>>17),O=P+(A^(q|~D))+L[13]+1309151649&4294967295,P=q+(O<<21&4294967295|O>>>11),O=D+(q^(P|~A))+L[4]+4149444226&4294967295,D=P+(O<<6&4294967295|O>>>26),O=A+(P^(D|~q))+L[11]+3174756917&4294967295,A=D+(O<<10&4294967295|O>>>22),O=q+(D^(A|~P))+L[2]+718787259&4294967295,q=A+(O<<15&4294967295|O>>>17),O=P+(A^(q|~D))+L[9]+3951481745&4294967295,I.g[0]=I.g[0]+D&4294967295,I.g[1]=I.g[1]+(q+(O<<21&4294967295|O>>>11))&4294967295,I.g[2]=I.g[2]+q&4294967295,I.g[3]=I.g[3]+A&4294967295}r.prototype.v=function(I,D){D===void 0&&(D=I.length);const P=D-this.blockSize,L=this.C;let q=this.h,A=0;for(;A<D;){if(q==0)for(;A<=P;)i(this,I,A),A+=this.blockSize;if(typeof I=="string"){for(;A<D;)if(L[q++]=I.charCodeAt(A++),q==this.blockSize){i(this,L),q=0;break}}else for(;A<D;)if(L[q++]=I[A++],q==this.blockSize){i(this,L),q=0;break}}this.h=q,this.o+=D},r.prototype.A=function(){var I=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);I[0]=128;for(var D=1;D<I.length-8;++D)I[D]=0;D=this.o*8;for(var P=I.length-8;P<I.length;++P)I[P]=D&255,D/=256;for(this.v(I),I=Array(16),D=0,P=0;P<4;++P)for(let L=0;L<32;L+=8)I[D++]=this.g[P]>>>L&255;return I};function o(I,D){var P=d;return Object.prototype.hasOwnProperty.call(P,I)?P[I]:P[I]=D(I)}function l(I,D){this.h=D;const P=[];let L=!0;for(let q=I.length-1;q>=0;q--){const A=I[q]|0;L&&A==D||(P[q]=A,L=!1)}this.g=P}var d={};function h(I){return-128<=I&&I<128?o(I,function(D){return new l([D|0],D<0?-1:0)}):new l([I|0],I<0?-1:0)}function f(I){if(isNaN(I)||!isFinite(I))return g;if(I<0)return w(f(-I));const D=[];let P=1;for(let L=0;I>=P;L++)D[L]=I/P|0,P*=4294967296;return new l(D,0)}function p(I,D){if(I.length==0)throw Error("number format error: empty string");if(D=D||10,D<2||36<D)throw Error("radix out of range: "+D);if(I.charAt(0)=="-")return w(p(I.substring(1),D));if(I.indexOf("-")>=0)throw Error('number format error: interior "-" character');const P=f(Math.pow(D,8));let L=g;for(let A=0;A<I.length;A+=8){var q=Math.min(8,I.length-A);const O=parseInt(I.substring(A,A+q),D);q<8?(q=f(Math.pow(D,q)),L=L.j(q).add(f(O))):(L=L.j(P),L=L.add(f(O)))}return L}var g=h(0),v=h(1),_=h(16777216);t=l.prototype,t.m=function(){if(x(this))return-w(this).m();let I=0,D=1;for(let P=0;P<this.g.length;P++){const L=this.i(P);I+=(L>=0?L:4294967296+L)*D,D*=4294967296}return I},t.toString=function(I){if(I=I||10,I<2||36<I)throw Error("radix out of range: "+I);if(C(this))return"0";if(x(this))return"-"+w(this).toString(I);const D=f(Math.pow(I,6));var P=this;let L="";for(;;){const q=M(P,D).g;P=E(P,q.j(D));let A=((P.g.length>0?P.g[0]:P.h)>>>0).toString(I);if(P=q,C(P))return A+L;for(;A.length<6;)A="0"+A;L=A+L}},t.i=function(I){return I<0?0:I<this.g.length?this.g[I]:this.h};function C(I){if(I.h!=0)return!1;for(let D=0;D<I.g.length;D++)if(I.g[D]!=0)return!1;return!0}function x(I){return I.h==-1}t.l=function(I){return I=E(this,I),x(I)?-1:C(I)?0:1};function w(I){const D=I.g.length,P=[];for(let L=0;L<D;L++)P[L]=~I.g[L];return new l(P,~I.h).add(v)}t.abs=function(){return x(this)?w(this):this},t.add=function(I){const D=Math.max(this.g.length,I.g.length),P=[];let L=0;for(let q=0;q<=D;q++){let A=L+(this.i(q)&65535)+(I.i(q)&65535),O=(A>>>16)+(this.i(q)>>>16)+(I.i(q)>>>16);L=O>>>16,A&=65535,O&=65535,P[q]=O<<16|A}return new l(P,P[P.length-1]&-2147483648?-1:0)};function E(I,D){return I.add(w(D))}t.j=function(I){if(C(this)||C(I))return g;if(x(this))return x(I)?w(this).j(w(I)):w(w(this).j(I));if(x(I))return w(this.j(w(I)));if(this.l(_)<0&&I.l(_)<0)return f(this.m()*I.m());const D=this.g.length+I.g.length,P=[];for(var L=0;L<2*D;L++)P[L]=0;for(L=0;L<this.g.length;L++)for(let q=0;q<I.g.length;q++){const A=this.i(L)>>>16,O=this.i(L)&65535,N=I.i(q)>>>16,J=I.i(q)&65535;P[2*L+2*q]+=O*J,T(P,2*L+2*q),P[2*L+2*q+1]+=A*J,T(P,2*L+2*q+1),P[2*L+2*q+1]+=O*N,T(P,2*L+2*q+1),P[2*L+2*q+2]+=A*N,T(P,2*L+2*q+2)}for(I=0;I<D;I++)P[I]=P[2*I+1]<<16|P[2*I];for(I=D;I<2*D;I++)P[I]=0;return new l(P,0)};function T(I,D){for(;(I[D]&65535)!=I[D];)I[D+1]+=I[D]>>>16,I[D]&=65535,D++}function R(I,D){this.g=I,this.h=D}function M(I,D){if(C(D))throw Error("division by zero");if(C(I))return new R(g,g);if(x(I))return D=M(w(I),D),new R(w(D.g),w(D.h));if(x(D))return D=M(I,w(D)),new R(w(D.g),D.h);if(I.g.length>30){if(x(I)||x(D))throw Error("slowDivide_ only works with positive integers.");for(var P=v,L=D;L.l(I)<=0;)P=V(P),L=V(L);var q=$(P,1),A=$(L,1);for(L=$(L,2),P=$(P,2);!C(L);){var O=A.add(L);O.l(I)<=0&&(q=q.add(P),A=O),L=$(L,1),P=$(P,1)}return D=E(I,q.j(D)),new R(q,D)}for(q=g;I.l(D)>=0;){for(P=Math.max(1,Math.floor(I.m()/D.m())),L=Math.ceil(Math.log(P)/Math.LN2),L=L<=48?1:Math.pow(2,L-48),A=f(P),O=A.j(D);x(O)||O.l(I)>0;)P-=L,A=f(P),O=A.j(D);C(A)&&(A=v),q=q.add(A),I=E(I,O)}return new R(q,I)}t.B=function(I){return M(this,I).h},t.and=function(I){const D=Math.max(this.g.length,I.g.length),P=[];for(let L=0;L<D;L++)P[L]=this.i(L)&I.i(L);return new l(P,this.h&I.h)},t.or=function(I){const D=Math.max(this.g.length,I.g.length),P=[];for(let L=0;L<D;L++)P[L]=this.i(L)|I.i(L);return new l(P,this.h|I.h)},t.xor=function(I){const D=Math.max(this.g.length,I.g.length),P=[];for(let L=0;L<D;L++)P[L]=this.i(L)^I.i(L);return new l(P,this.h^I.h)};function V(I){const D=I.g.length+1,P=[];for(let L=0;L<D;L++)P[L]=I.i(L)<<1|I.i(L-1)>>>31;return new l(P,I.h)}function $(I,D){const P=D>>5;D%=32;const L=I.g.length-P,q=[];for(let A=0;A<L;A++)q[A]=D>0?I.i(A+P)>>>D|I.i(A+P+1)<<32-D:I.i(A+P);return new l(q,I.h)}r.prototype.digest=r.prototype.A,r.prototype.reset=r.prototype.u,r.prototype.update=r.prototype.v,zC=r,l.prototype.add=l.prototype.add,l.prototype.multiply=l.prototype.j,l.prototype.modulo=l.prototype.B,l.prototype.compare=l.prototype.l,l.prototype.toNumber=l.prototype.m,l.prototype.toString=l.prototype.toString,l.prototype.getBits=l.prototype.i,l.fromNumber=f,l.fromString=p,Ea=l}).apply(typeof Iw<"u"?Iw:typeof self<"u"?self:typeof window<"u"?window:{});var $h=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var LC,Su,UC,nf,gy,FC,VC,$C;(function(){var t,e=Object.defineProperty;function n(y){y=[typeof globalThis=="object"&&globalThis,y,typeof window=="object"&&window,typeof self=="object"&&self,typeof $h=="object"&&$h];for(var j=0;j<y.length;++j){var F=y[j];if(F&&F.Math==Math)return F}throw Error("Cannot find global object")}var r=n(this);function i(y,j){if(j)e:{var F=r;y=y.split(".");for(var K=0;K<y.length-1;K++){var he=y[K];if(!(he in F))break e;F=F[he]}y=y[y.length-1],K=F[y],j=j(K),j!=K&&j!=null&&e(F,y,{configurable:!0,writable:!0,value:j})}}i("Symbol.dispose",function(y){return y||Symbol("Symbol.dispose")}),i("Array.prototype.values",function(y){return y||function(){return this[Symbol.iterator]()}}),i("Object.entries",function(y){return y||function(j){var F=[],K;for(K in j)Object.prototype.hasOwnProperty.call(j,K)&&F.push([K,j[K]]);return F}});var o=o||{},l=this||self;function d(y){var j=typeof y;return j=="object"&&y!=null||j=="function"}function h(y,j,F){return y.call.apply(y.bind,arguments)}function f(y,j,F){return f=h,f.apply(null,arguments)}function p(y,j){var F=Array.prototype.slice.call(arguments,1);return function(){var K=F.slice();return K.push.apply(K,arguments),y.apply(this,K)}}function g(y,j){function F(){}F.prototype=j.prototype,y.Z=j.prototype,y.prototype=new F,y.prototype.constructor=y,y.Ob=function(K,he,ve){for(var Pe=Array(arguments.length-2),it=2;it<arguments.length;it++)Pe[it-2]=arguments[it];return j.prototype[he].apply(K,Pe)}}var v=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?y=>y&&AsyncContext.Snapshot.wrap(y):y=>y;function _(y){const j=y.length;if(j>0){const F=Array(j);for(let K=0;K<j;K++)F[K]=y[K];return F}return[]}function C(y,j){for(let K=1;K<arguments.length;K++){const he=arguments[K];var F=typeof he;if(F=F!="object"?F:he?Array.isArray(he)?"array":F:"null",F=="array"||F=="object"&&typeof he.length=="number"){F=y.length||0;const ve=he.length||0;y.length=F+ve;for(let Pe=0;Pe<ve;Pe++)y[F+Pe]=he[Pe]}else y.push(he)}}class x{constructor(j,F){this.i=j,this.j=F,this.h=0,this.g=null}get(){let j;return this.h>0?(this.h--,j=this.g,this.g=j.next,j.next=null):j=this.i(),j}}function w(y){l.setTimeout(()=>{throw y},0)}function E(){var y=I;let j=null;return y.g&&(j=y.g,y.g=y.g.next,y.g||(y.h=null),j.next=null),j}class T{constructor(){this.h=this.g=null}add(j,F){const K=R.get();K.set(j,F),this.h?this.h.next=K:this.g=K,this.h=K}}var R=new x(()=>new M,y=>y.reset());class M{constructor(){this.next=this.g=this.h=null}set(j,F){this.h=j,this.g=F,this.next=null}reset(){this.next=this.g=this.h=null}}let V,$=!1,I=new T,D=()=>{const y=Promise.resolve(void 0);V=()=>{y.then(P)}};function P(){for(var y;y=E();){try{y.h.call(y.g)}catch(F){w(F)}var j=R;j.j(y),j.h<100&&(j.h++,y.next=j.g,j.g=y)}$=!1}function L(){this.u=this.u,this.C=this.C}L.prototype.u=!1,L.prototype.dispose=function(){this.u||(this.u=!0,this.N())},L.prototype[Symbol.dispose]=function(){this.dispose()},L.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function q(y,j){this.type=y,this.g=this.target=j,this.defaultPrevented=!1}q.prototype.h=function(){this.defaultPrevented=!0};var A=(function(){if(!l.addEventListener||!Object.defineProperty)return!1;var y=!1,j=Object.defineProperty({},"passive",{get:function(){y=!0}});try{const F=()=>{};l.addEventListener("test",F,j),l.removeEventListener("test",F,j)}catch{}return y})();function O(y){return/^[\s\xa0]*$/.test(y)}function N(y,j){q.call(this,y?y.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,y&&this.init(y,j)}g(N,q),N.prototype.init=function(y,j){const F=this.type=y.type,K=y.changedTouches&&y.changedTouches.length?y.changedTouches[0]:null;this.target=y.target||y.srcElement,this.g=j,j=y.relatedTarget,j||(F=="mouseover"?j=y.fromElement:F=="mouseout"&&(j=y.toElement)),this.relatedTarget=j,K?(this.clientX=K.clientX!==void 0?K.clientX:K.pageX,this.clientY=K.clientY!==void 0?K.clientY:K.pageY,this.screenX=K.screenX||0,this.screenY=K.screenY||0):(this.clientX=y.clientX!==void 0?y.clientX:y.pageX,this.clientY=y.clientY!==void 0?y.clientY:y.pageY,this.screenX=y.screenX||0,this.screenY=y.screenY||0),this.button=y.button,this.key=y.key||"",this.ctrlKey=y.ctrlKey,this.altKey=y.altKey,this.shiftKey=y.shiftKey,this.metaKey=y.metaKey,this.pointerId=y.pointerId||0,this.pointerType=y.pointerType,this.state=y.state,this.i=y,y.defaultPrevented&&N.Z.h.call(this)},N.prototype.h=function(){N.Z.h.call(this);const y=this.i;y.preventDefault?y.preventDefault():y.returnValue=!1};var J="closure_listenable_"+(Math.random()*1e6|0),Y=0;function G(y,j,F,K,he){this.listener=y,this.proxy=null,this.src=j,this.type=F,this.capture=!!K,this.ha=he,this.key=++Y,this.da=this.fa=!1}function Z(y){y.da=!0,y.listener=null,y.proxy=null,y.src=null,y.ha=null}function Q(y,j,F){for(const K in y)j.call(F,y[K],K,y)}function te(y,j){for(const F in y)j.call(void 0,y[F],F,y)}function z(y){const j={};for(const F in y)j[F]=y[F];return j}const H="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function re(y,j){let F,K;for(let he=1;he<arguments.length;he++){K=arguments[he];for(F in K)y[F]=K[F];for(let ve=0;ve<H.length;ve++)F=H[ve],Object.prototype.hasOwnProperty.call(K,F)&&(y[F]=K[F])}}function ne(y){this.src=y,this.g={},this.h=0}ne.prototype.add=function(y,j,F,K,he){const ve=y.toString();y=this.g[ve],y||(y=this.g[ve]=[],this.h++);const Pe=be(y,j,K,he);return Pe>-1?(j=y[Pe],F||(j.fa=!1)):(j=new G(j,this.src,ve,!!K,he),j.fa=F,y.push(j)),j};function ie(y,j){const F=j.type;if(F in y.g){var K=y.g[F],he=Array.prototype.indexOf.call(K,j,void 0),ve;(ve=he>=0)&&Array.prototype.splice.call(K,he,1),ve&&(Z(j),y.g[F].length==0&&(delete y.g[F],y.h--))}}function be(y,j,F,K){for(let he=0;he<y.length;++he){const ve=y[he];if(!ve.da&&ve.listener==j&&ve.capture==!!F&&ve.ha==K)return he}return-1}var Ce="closure_lm_"+(Math.random()*1e6|0),ce={};function ge(y,j,F,K,he){if(Array.isArray(j)){for(let ve=0;ve<j.length;ve++)ge(y,j[ve],F,K,he);return null}return F=X(F),y&&y[J]?y.J(j,F,d(K)?!!K.capture:!1,he):Oe(y,j,F,!1,K,he)}function Oe(y,j,F,K,he,ve){if(!j)throw Error("Invalid event type");const Pe=d(he)?!!he.capture:!!he;let it=ye(y);if(it||(y[Ce]=it=new ne(y)),F=it.add(j,F,K,Pe,ve),F.proxy)return F;if(K=ze(),F.proxy=K,K.src=y,K.listener=F,y.addEventListener)A||(he=Pe),he===void 0&&(he=!1),y.addEventListener(j.toString(),K,he);else if(y.attachEvent)y.attachEvent(U(j.toString()),K);else if(y.addListener&&y.removeListener)y.addListener(K);else throw Error("addEventListener and attachEvent are unavailable.");return F}function ze(){function y(F){return j.call(y.src,y.listener,F)}const j=de;return y}function ot(y,j,F,K,he){if(Array.isArray(j))for(var ve=0;ve<j.length;ve++)ot(y,j[ve],F,K,he);else K=d(K)?!!K.capture:!!K,F=X(F),y&&y[J]?(y=y.i,ve=String(j).toString(),ve in y.g&&(j=y.g[ve],F=be(j,F,K,he),F>-1&&(Z(j[F]),Array.prototype.splice.call(j,F,1),j.length==0&&(delete y.g[ve],y.h--)))):y&&(y=ye(y))&&(j=y.g[j.toString()],y=-1,j&&(y=be(j,F,K,he)),(F=y>-1?j[y]:null)&&st(F))}function st(y){if(typeof y!="number"&&y&&!y.da){var j=y.src;if(j&&j[J])ie(j.i,y);else{var F=y.type,K=y.proxy;j.removeEventListener?j.removeEventListener(F,K,y.capture):j.detachEvent?j.detachEvent(U(F),K):j.addListener&&j.removeListener&&j.removeListener(K),(F=ye(j))?(ie(F,y),F.h==0&&(F.src=null,j[Ce]=null)):Z(y)}}}function U(y){return y in ce?ce[y]:ce[y]="on"+y}function de(y,j){if(y.da)y=!0;else{j=new N(j,this);const F=y.listener,K=y.ha||y.src;y.fa&&st(y),y=F.call(K,j)}return y}function ye(y){return y=y[Ce],y instanceof ne?y:null}var ee="__closure_events_fn_"+(Math.random()*1e9>>>0);function X(y){return typeof y=="function"?y:(y[ee]||(y[ee]=function(j){return y.handleEvent(j)}),y[ee])}function oe(){L.call(this),this.i=new ne(this),this.M=this,this.G=null}g(oe,L),oe.prototype[J]=!0,oe.prototype.removeEventListener=function(y,j,F,K){ot(this,y,j,F,K)};function Se(y,j){var F,K=y.G;if(K)for(F=[];K;K=K.G)F.push(K);if(y=y.M,K=j.type||j,typeof j=="string")j=new q(j,y);else if(j instanceof q)j.target=j.target||y;else{var he=j;j=new q(K,y),re(j,he)}he=!0;let ve,Pe;if(F)for(Pe=F.length-1;Pe>=0;Pe--)ve=j.g=F[Pe],he=we(ve,K,!0,j)&&he;if(ve=j.g=y,he=we(ve,K,!0,j)&&he,he=we(ve,K,!1,j)&&he,F)for(Pe=0;Pe<F.length;Pe++)ve=j.g=F[Pe],he=we(ve,K,!1,j)&&he}oe.prototype.N=function(){if(oe.Z.N.call(this),this.i){var y=this.i;for(const j in y.g){const F=y.g[j];for(let K=0;K<F.length;K++)Z(F[K]);delete y.g[j],y.h--}}this.G=null},oe.prototype.J=function(y,j,F,K){return this.i.add(String(y),j,!1,F,K)},oe.prototype.K=function(y,j,F,K){return this.i.add(String(y),j,!0,F,K)};function we(y,j,F,K){if(j=y.i.g[String(j)],!j)return!0;j=j.concat();let he=!0;for(let ve=0;ve<j.length;++ve){const Pe=j[ve];if(Pe&&!Pe.da&&Pe.capture==F){const it=Pe.listener,sn=Pe.ha||Pe.src;Pe.fa&&ie(y.i,Pe),he=it.call(sn,K)!==!1&&he}}return he&&!K.defaultPrevented}function ae(y,j){if(typeof y!="function")if(y&&typeof y.handleEvent=="function")y=f(y.handleEvent,y);else throw Error("Invalid listener argument");return Number(j)>2147483647?-1:l.setTimeout(y,j||0)}function je(y){y.g=ae(()=>{y.g=null,y.i&&(y.i=!1,je(y))},y.l);const j=y.h;y.h=null,y.m.apply(null,j)}class Ne extends L{constructor(j,F){super(),this.m=j,this.l=F,this.h=null,this.i=!1,this.g=null}j(j){this.h=arguments,this.g?this.i=!0:je(this)}N(){super.N(),this.g&&(l.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function De(y){L.call(this),this.h=y,this.g={}}g(De,L);var qe=[];function xt(y){Q(y.g,function(j,F){this.g.hasOwnProperty(F)&&st(j)},y),y.g={}}De.prototype.N=function(){De.Z.N.call(this),xt(this)},De.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var rt=l.JSON.stringify,Qn=l.JSON.parse,gs=class{stringify(y){return l.JSON.stringify(y,void 0)}parse(y){return l.JSON.parse(y,void 0)}};function nr(){}function ys(){}var vt={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function tn(){q.call(this,"d")}g(tn,q);function Kn(){q.call(this,"c")}g(Kn,q);var Ct={},qa=null;function Di(){return qa=qa||new oe}Ct.Ia="serverreachability";function qo(y){q.call(this,Ct.Ia,y)}g(qo,q);function Mr(y){const j=Di();Se(j,new qo(j))}Ct.STAT_EVENT="statevent";function _s(y,j){q.call(this,Ct.STAT_EVENT,y),this.stat=j}g(_s,q);function Ut(y){const j=Di();Se(j,new _s(j,y))}Ct.Ja="timingevent";function rr(y,j){q.call(this,Ct.Ja,y),this.size=j}g(rr,q);function bs(y,j){if(typeof y!="function")throw Error("Fn must not be null and must be a function");return l.setTimeout(function(){y()},j)}function Xr(){this.g=!0}Xr.prototype.ua=function(){this.g=!1};function Rm(y,j,F,K,he,ve){y.info(function(){if(y.g)if(ve){var Pe="",it=ve.split("&");for(let Et=0;Et<it.length;Et++){var sn=it[Et].split("=");if(sn.length>1){const Qt=sn[0];sn=sn[1];const Br=Qt.split("_");Pe=Br.length>=2&&Br[1]=="type"?Pe+(Qt+"="+sn+"&"):Pe+(Qt+"=redacted&")}}}else Pe=null;else Pe=ve;return"XMLHTTP REQ ("+K+") [attempt "+he+"]: "+j+`
`+F+`
`+Pe})}function gd(y,j,F,K,he,ve,Pe){y.info(function(){return"XMLHTTP RESP ("+K+") [ attempt "+he+"]: "+j+`
`+F+`
`+ve+" "+Pe})}function vs(y,j,F,K){y.info(function(){return"XMLHTTP TEXT ("+j+"): "+Im(y,F)+(K?" "+K:"")})}function Ha(y,j){y.info(function(){return"TIMEOUT: "+j})}Xr.prototype.info=function(){};function Im(y,j){if(!y.g)return j;if(!j)return null;try{const ve=JSON.parse(j);if(ve){for(y=0;y<ve.length;y++)if(Array.isArray(ve[y])){var F=ve[y];if(!(F.length<2)){var K=F[1];if(Array.isArray(K)&&!(K.length<1)){var he=K[0];if(he!="noop"&&he!="stop"&&he!="close")for(let Pe=1;Pe<K.length;Pe++)K[Pe]=""}}}}return rt(ve)}catch{return j}}var Ga={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},bc={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},vc;function Wa(){}g(Wa,nr),Wa.prototype.g=function(){return new XMLHttpRequest},vc=new Wa;function Ys(y){return encodeURIComponent(String(y))}function yd(y){var j=1;y=y.split(":");const F=[];for(;j>0&&y.length;)F.push(y.shift()),j--;return y.length&&F.push(y.join(":")),F}function Zr(y,j,F,K){this.j=y,this.i=j,this.l=F,this.S=K||1,this.V=new De(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new Jr}function Jr(){this.i=null,this.g="",this.h=!1}var hn={},In={};function xs(y,j,F){y.M=1,y.A=Qa(mn(j)),y.u=F,y.R=!0,Ho(y,null)}function Ho(y,j){y.F=Date.now(),ws(y),y.B=mn(y.A);var F=y.B,K=y.S;Array.isArray(K)||(K=[String(K)]),Ko(F.i,"t",K),y.C=0,F=y.j.L,y.h=new Jr,y.g=Dd(y.j,F?j:null,!y.u),y.P>0&&(y.O=new Ne(f(y.Y,y,y.g),y.P)),j=y.V,F=y.g,K=y.ba;var he="readystatechange";Array.isArray(he)||(he&&(qe[0]=he.toString()),he=qe);for(let ve=0;ve<he.length;ve++){const Pe=ge(F,he[ve],K||j.handleEvent,!1,j.h||j);if(!Pe)break;j.g[Pe.key]=Pe}j=y.J?z(y.J):{},y.u?(y.v||(y.v="POST"),j["Content-Type"]="application/x-www-form-urlencoded",y.g.ea(y.B,y.v,y.u,j)):(y.v="GET",y.g.ea(y.B,y.v,null,j)),Mr(),Rm(y.i,y.v,y.B,y.l,y.S,y.u)}Zr.prototype.ba=function(y){y=y.target;const j=this.O;j&&ns(y)==3?j.j():this.Y(y)},Zr.prototype.Y=function(y){try{if(y==this.g)e:{const it=ns(this.g),sn=this.g.ya(),Et=this.g.ca();if(!(it<3)&&(it!=3||this.g&&(this.h.h||this.g.la()||Nn(this.g)))){this.K||it!=4||sn==7||(sn==8||Et<=0?Mr(3):Mr(2)),Ss(this);var j=this.g.ca();this.X=j;var F=km(this);if(this.o=j==200,gd(this.i,this.v,this.B,this.l,this.S,it,j),this.o){if(this.U&&!this.L){t:{if(this.g){var K,he=this.g;if((K=he.g?he.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!O(K)){var ve=K;break t}}ve=null}if(y=ve)vs(this.i,this.l,y,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,Cs(this,y);else{this.o=!1,this.m=3,Ut(12),vr(this),Or(this);break e}}if(this.R){y=!0;let Qt;for(;!this.K&&this.C<F.length;)if(Qt=bd(this,F),Qt==In){it==4&&(this.m=4,Ut(14),y=!1),vs(this.i,this.l,null,"[Incomplete Response]");break}else if(Qt==hn){this.m=4,Ut(15),vs(this.i,this.l,F,"[Invalid Chunk]"),y=!1;break}else vs(this.i,this.l,Qt,null),Cs(this,Qt);if(_d(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),it!=4||F.length!=0||this.h.h||(this.m=1,Ut(16),y=!1),this.o=this.o&&y,!y)vs(this.i,this.l,F,"[Invalid Chunked Response]"),vr(this),Or(this);else if(F.length>0&&!this.W){this.W=!0;var Pe=this.j;Pe.g==this&&Pe.aa&&!Pe.P&&(Pe.j.info("Great, no buffering proxy detected. Bytes received: "+F.length),Nc(Pe),Pe.P=!0,Ut(11))}}else vs(this.i,this.l,F,null),Cs(this,F);it==4&&vr(this),this.o&&!this.K&&(it==4?jd(this.j,this):(this.o=!1,ws(this)))}else Zs(this.g),j==400&&F.indexOf("Unknown SID")>0?(this.m=3,Ut(12)):(this.m=0,Ut(13)),vr(this),Or(this)}}}catch{}};function km(y){if(!_d(y))return y.g.la();const j=Nn(y.g);if(j==="")return"";let F="";const K=j.length,he=ns(y.g)==4;if(!y.h.i){if(typeof TextDecoder>"u")return vr(y),Or(y),"";y.h.i=new l.TextDecoder}for(let ve=0;ve<K;ve++)y.h.h=!0,F+=y.h.i.decode(j[ve],{stream:!(he&&ve==K-1)});return j.length=0,y.h.g+=F,y.C=0,y.h.g}function _d(y){return y.g?y.v=="GET"&&y.M!=2&&y.j.Aa:!1}function bd(y,j){var F=y.C,K=j.indexOf(`
`,F);return K==-1?In:(F=Number(j.substring(F,K)),isNaN(F)?hn:(K+=1,K+F>j.length?In:(j=j.slice(K,K+F),y.C=K+F,j)))}Zr.prototype.cancel=function(){this.K=!0,vr(this)};function ws(y){y.T=Date.now()+y.H,Go(y,y.H)}function Go(y,j){if(y.D!=null)throw Error("WatchDog timer not null");y.D=bs(f(y.aa,y),j)}function Ss(y){y.D&&(l.clearTimeout(y.D),y.D=null)}Zr.prototype.aa=function(){this.D=null;const y=Date.now();y-this.T>=0?(Ha(this.i,this.B),this.M!=2&&(Mr(),Ut(17)),vr(this),this.m=2,Or(this)):Go(this,this.T-y)};function Or(y){y.j.I==0||y.K||jd(y.j,y)}function vr(y){Ss(y);var j=y.O;j&&typeof j.dispose=="function"&&j.dispose(),y.O=null,xt(y.V),y.g&&(j=y.g,y.g=null,j.abort(),j.dispose())}function Cs(y,j){try{var F=y.j;if(F.I!=0&&(F.g==y||Ts(F.h,y))){if(!y.L&&Ts(F.h,y)&&F.I==3){try{var K=F.Ba.g.parse(j)}catch{K=null}if(Array.isArray(K)&&K.length==3){var he=K;if(he[0]==0){e:if(!F.v){if(F.g)if(F.g.F+3e3<y.F)el(F),Ui(F);else break e;to(F),Ut(18)}}else F.xa=he[1],0<F.xa-F.K&&he[2]<37500&&F.F&&F.A==0&&!F.C&&(F.C=bs(f(F.Va,F),6e3));Es(F.h)<=1&&F.ta&&(F.ta=void 0)}else Ds(F,11)}else if((y.L||F.g==y)&&el(F),!O(j))for(he=F.Ba.g.parse(j),j=0;j<he.length;j++){let Et=he[j];const Qt=Et[0];if(!(Qt<=F.K))if(F.K=Qt,Et=Et[1],F.I==2)if(Et[0]=="c"){F.M=Et[1],F.ba=Et[2];const Br=Et[3];Br!=null&&(F.ka=Br,F.j.info("VER="+F.ka));const Ms=Et[4];Ms!=null&&(F.za=Ms,F.j.info("SVER="+F.za));const rs=Et[5];rs!=null&&typeof rs=="number"&&rs>0&&(K=1.5*rs,F.O=K,F.j.info("backChannelRequestTimeoutMs_="+K)),K=F;const ss=y.g;if(ss){const no=ss.g?ss.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(no){var ve=K.h;ve.g||no.indexOf("spdy")==-1&&no.indexOf("quic")==-1&&no.indexOf("h2")==-1||(ve.j=ve.l,ve.g=new Set,ve.h&&(Sc(ve,ve.h),ve.h=null))}if(K.G){const tl=ss.g?ss.g.getResponseHeader("X-HTTP-Session-Id"):null;tl&&(K.wa=tl,jt(K.J,K.G,tl))}}F.I=3,F.l&&F.l.ra(),F.aa&&(F.T=Date.now()-y.F,F.j.info("Handshake RTT: "+F.T+"ms")),K=F;var Pe=y;if(K.na=kd(K,K.L?K.ba:null,K.W),Pe.L){Cc(K.h,Pe);var it=Pe,sn=K.O;sn&&(it.H=sn),it.D&&(Ss(it),ws(it)),K.g=Pe}else Td(K);F.i.length>0&&ks(F)}else Et[0]!="stop"&&Et[0]!="close"||Ds(F,7);else F.I==3&&(Et[0]=="stop"||Et[0]=="close"?Et[0]=="stop"?Ds(F,7):Mc(F):Et[0]!="noop"&&F.l&&F.l.qa(Et),F.A=0)}}Mr(4)}catch{}}var fn=class{constructor(y,j){this.g=y,this.map=j}};function xc(y){this.l=y||10,l.PerformanceNavigationTiming?(y=l.performance.getEntriesByType("navigation"),y=y.length>0&&(y[0].nextHopProtocol=="hq"||y[0].nextHopProtocol=="h2")):y=!!(l.chrome&&l.chrome.loadTimes&&l.chrome.loadTimes()&&l.chrome.loadTimes().wasFetchedViaSpdy),this.j=y?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function wc(y){return y.h?!0:y.g?y.g.size>=y.j:!1}function Es(y){return y.h?1:y.g?y.g.size:0}function Ts(y,j){return y.h?y.h==j:y.g?y.g.has(j):!1}function Sc(y,j){y.g?y.g.add(j):y.h=j}function Cc(y,j){y.h&&y.h==j?y.h=null:y.g&&y.g.has(j)&&y.g.delete(j)}xc.prototype.cancel=function(){if(this.i=Ec(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const y of this.g.values())y.cancel();this.g.clear()}};function Ec(y){if(y.h!=null)return y.i.concat(y.h.G);if(y.g!=null&&y.g.size!==0){let j=y.i;for(const F of y.g.values())j=j.concat(F.G);return j}return _(y.i)}var vd=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Wo(y,j){if(y){y=y.split("&");for(let F=0;F<y.length;F++){const K=y[F].indexOf("=");let he,ve=null;K>=0?(he=y[F].substring(0,K),ve=y[F].substring(K+1)):he=y[F],j(he,ve?decodeURIComponent(ve.replace(/\+/g," ")):"")}}}function xr(y){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let j;y instanceof xr?(this.l=y.l,kn(this,y.j),this.o=y.o,this.g=y.g,Mi(this,y.u),this.h=y.h,Tc(this,Cd(y.i)),this.m=y.m):y&&(j=String(y).match(vd))?(this.l=!1,kn(this,j[1]||"",!0),this.o=As(j[2]||""),this.g=As(j[3]||"",!0),Mi(this,j[4]),this.h=As(j[5]||"",!0),Tc(this,j[6]||"",!0),this.m=As(j[7]||"")):(this.l=!1,this.i=new Ni(null,this.l))}xr.prototype.toString=function(){const y=[];var j=this.j;j&&y.push(Ka(j,Qo,!0),":");var F=this.g;return(F||j=="file")&&(y.push("//"),(j=this.o)&&y.push(Ka(j,Qo,!0),"@"),y.push(Ys(F).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),F=this.u,F!=null&&y.push(":",String(F))),(F=this.h)&&(this.g&&F.charAt(0)!="/"&&y.push("/"),y.push(Ka(F,F.charAt(0)=="/"?Ac:xd,!0))),(F=this.i.toString())&&y.push("?",F),(F=this.m)&&y.push("#",Ka(F,wd)),y.join("")},xr.prototype.resolve=function(y){const j=mn(this);let F=!!y.j;F?kn(j,y.j):F=!!y.o,F?j.o=y.o:F=!!y.g,F?j.g=y.g:F=y.u!=null;var K=y.h;if(F)Mi(j,y.u);else if(F=!!y.h){if(K.charAt(0)!="/")if(this.g&&!this.h)K="/"+K;else{var he=j.h.lastIndexOf("/");he!=-1&&(K=j.h.slice(0,he+1)+K)}if(he=K,he==".."||he==".")K="";else if(he.indexOf("./")!=-1||he.indexOf("/.")!=-1){K=he.lastIndexOf("/",0)==0,he=he.split("/");const ve=[];for(let Pe=0;Pe<he.length;){const it=he[Pe++];it=="."?K&&Pe==he.length&&ve.push(""):it==".."?((ve.length>1||ve.length==1&&ve[0]!="")&&ve.pop(),K&&Pe==he.length&&ve.push("")):(ve.push(it),K=!0)}K=ve.join("/")}else K=he}return F?j.h=K:F=y.i.toString()!=="",F?Tc(j,Cd(y.i)):F=!!y.m,F&&(j.m=y.m),j};function mn(y){return new xr(y)}function kn(y,j,F){y.j=F?As(j,!0):j,y.j&&(y.j=y.j.replace(/:$/,""))}function Mi(y,j){if(j){if(j=Number(j),isNaN(j)||j<0)throw Error("Bad port number "+j);y.u=j}else y.u=null}function Tc(y,j,F){j instanceof Ni?(y.i=j,Yo(y.i,y.l)):(F||(j=Ka(j,Oi)),y.i=new Ni(j,y.l))}function jt(y,j,F){y.i.set(j,F)}function Qa(y){return jt(y,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),y}function As(y,j){return y?j?decodeURI(y.replace(/%25/g,"%2525")):decodeURIComponent(y):""}function Ka(y,j,F){return typeof y=="string"?(y=encodeURI(y).replace(j,lr),F&&(y=y.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),y):null}function lr(y){return y=y.charCodeAt(0),"%"+(y>>4&15).toString(16)+(y&15).toString(16)}var Qo=/[#\/\?@]/g,xd=/[#\?:]/g,Ac=/[#\?]/g,Oi=/[#\?@]/g,wd=/#/g;function Ni(y,j){this.h=this.g=null,this.i=y||null,this.j=!!j}function cr(y){y.g||(y.g=new Map,y.h=0,y.i&&Wo(y.i,function(j,F){y.add(decodeURIComponent(j.replace(/\+/g," ")),F)}))}t=Ni.prototype,t.add=function(y,j){cr(this),this.i=null,y=Pi(this,y);let F=this.g.get(y);return F||this.g.set(y,F=[]),F.push(j),this.h+=1,this};function Sd(y,j){cr(y),j=Pi(y,j),y.g.has(j)&&(y.i=null,y.h-=y.g.get(j).length,y.g.delete(j))}function jc(y,j){return cr(y),j=Pi(y,j),y.g.has(j)}t.forEach=function(y,j){cr(this),this.g.forEach(function(F,K){F.forEach(function(he){y.call(j,he,K,this)},this)},this)};function Rc(y,j){cr(y);let F=[];if(typeof j=="string")jc(y,j)&&(F=F.concat(y.g.get(Pi(y,j))));else for(y=Array.from(y.g.values()),j=0;j<y.length;j++)F=F.concat(y[j]);return F}t.set=function(y,j){return cr(this),this.i=null,y=Pi(this,y),jc(this,y)&&(this.h-=this.g.get(y).length),this.g.set(y,[j]),this.h+=1,this},t.get=function(y,j){return y?(y=Rc(this,y),y.length>0?String(y[0]):j):j};function Ko(y,j,F){Sd(y,j),F.length>0&&(y.i=null,y.g.set(Pi(y,j),_(F)),y.h+=F.length)}t.toString=function(){if(this.i)return this.i;if(!this.g)return"";const y=[],j=Array.from(this.g.keys());for(let K=0;K<j.length;K++){var F=j[K];const he=Ys(F);F=Rc(this,F);for(let ve=0;ve<F.length;ve++){let Pe=he;F[ve]!==""&&(Pe+="="+Ys(F[ve])),y.push(Pe)}}return this.i=y.join("&")};function Cd(y){const j=new Ni;return j.i=y.i,y.g&&(j.g=new Map(y.g),j.h=y.h),j}function Pi(y,j){return j=String(j),y.j&&(j=j.toLowerCase()),j}function Yo(y,j){j&&!y.j&&(cr(y),y.i=null,y.g.forEach(function(F,K){const he=K.toLowerCase();K!=he&&(Sd(this,K),Ko(this,he,F))},y)),y.j=j}function es(y,j){const F=new Xr;if(l.Image){const K=new Image;K.onload=p(Nr,F,"TestLoadImage: loaded",!0,j,K),K.onerror=p(Nr,F,"TestLoadImage: error",!1,j,K),K.onabort=p(Nr,F,"TestLoadImage: abort",!1,j,K),K.ontimeout=p(Nr,F,"TestLoadImage: timeout",!1,j,K),l.setTimeout(function(){K.ontimeout&&K.ontimeout()},1e4),K.src=y}else j(!1)}function Ic(y,j){const F=new Xr,K=new AbortController,he=setTimeout(()=>{K.abort(),Nr(F,"TestPingServer: timeout",!1,j)},1e4);fetch(y,{signal:K.signal}).then(ve=>{clearTimeout(he),ve.ok?Nr(F,"TestPingServer: ok",!0,j):Nr(F,"TestPingServer: server error",!1,j)}).catch(()=>{clearTimeout(he),Nr(F,"TestPingServer: error",!1,j)})}function Nr(y,j,F,K,he){try{he&&(he.onload=null,he.onerror=null,he.onabort=null,he.ontimeout=null),K(F)}catch{}}function Bi(){this.g=new gs}function js(y){this.i=y.Sb||null,this.h=y.ab||!1}g(js,nr),js.prototype.g=function(){return new Ya(this.i,this.h)};function Ya(y,j){oe.call(this),this.H=y,this.o=j,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}g(Ya,oe),t=Ya.prototype,t.open=function(y,j){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=y,this.D=j,this.readyState=1,ts(this)},t.send=function(y){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const j={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};y&&(j.body=y),(this.H||l).fetch(new Request(this.D,j)).then(this.Pa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,zi(this)),this.readyState=0},t.Pa=function(y){if(this.g&&(this.l=y,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=y.headers,this.readyState=2,ts(this)),this.g&&(this.readyState=3,ts(this),this.g)))if(this.responseType==="arraybuffer")y.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof l.ReadableStream<"u"&&"body"in y){if(this.j=y.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;Xo(this)}else y.text().then(this.Oa.bind(this),this.ga.bind(this))};function Xo(y){y.j.read().then(y.Ma.bind(y)).catch(y.ga.bind(y))}t.Ma=function(y){if(this.g){if(this.o&&y.value)this.response.push(y.value);else if(!this.o){var j=y.value?y.value:new Uint8Array(0);(j=this.B.decode(j,{stream:!y.done}))&&(this.response=this.responseText+=j)}y.done?zi(this):ts(this),this.readyState==3&&Xo(this)}},t.Oa=function(y){this.g&&(this.response=this.responseText=y,zi(this))},t.Na=function(y){this.g&&(this.response=y,zi(this))},t.ga=function(){this.g&&zi(this)};function zi(y){y.readyState=4,y.l=null,y.j=null,y.B=null,ts(y)}t.setRequestHeader=function(y,j){this.A.append(y,j)},t.getResponseHeader=function(y){return this.h&&this.h.get(y.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";const y=[],j=this.h.entries();for(var F=j.next();!F.done;)F=F.value,y.push(F[0]+": "+F[1]),F=j.next();return y.join(`\r
`)};function ts(y){y.onreadystatechange&&y.onreadystatechange.call(y)}Object.defineProperty(Ya.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(y){this.m=y?"include":"same-origin"}});function Pr(y){let j="";return Q(y,function(F,K){j+=K,j+=":",j+=F,j+=`\r
`}),j}function Xa(y,j,F){e:{for(K in F){var K=!1;break e}K=!0}K||(F=Pr(F),typeof y=="string"?F!=null&&Ys(F):jt(y,j,F))}function kt(y){oe.call(this),this.headers=new Map,this.L=y||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}g(kt,oe);var Rs=/^https?$/i,kc=["POST","PUT"];t=kt.prototype,t.Fa=function(y){this.H=y},t.ea=function(y,j,F,K){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+y);j=j?j.toUpperCase():"GET",this.D=y,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():vc.g(),this.g.onreadystatechange=v(f(this.Ca,this));try{this.B=!0,this.g.open(j,String(y),!0),this.B=!1}catch(ve){Za(this,ve);return}if(y=F||"",F=new Map(this.headers),K)if(Object.getPrototypeOf(K)===Object.prototype)for(var he in K)F.set(he,K[he]);else if(typeof K.keys=="function"&&typeof K.get=="function")for(const ve of K.keys())F.set(ve,K.get(ve));else throw Error("Unknown input type for opt_headers: "+String(K));K=Array.from(F.keys()).find(ve=>ve.toLowerCase()=="content-type"),he=l.FormData&&y instanceof l.FormData,!(Array.prototype.indexOf.call(kc,j,void 0)>=0)||K||he||F.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[ve,Pe]of F)this.g.setRequestHeader(ve,Pe);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(y),this.v=!1}catch(ve){Za(this,ve)}};function Za(y,j){y.h=!1,y.g&&(y.j=!0,y.g.abort(),y.j=!1),y.l=j,y.o=5,Dc(y),Xs(y)}function Dc(y){y.A||(y.A=!0,Se(y,"complete"),Se(y,"error"))}t.abort=function(y){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=y||7,Se(this,"complete"),Se(this,"abort"),Xs(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Xs(this,!0)),kt.Z.N.call(this)},t.Ca=function(){this.u||(this.B||this.v||this.j?Ja(this):this.Xa())},t.Xa=function(){Ja(this)};function Ja(y){if(y.h&&typeof o<"u"){if(y.v&&ns(y)==4)setTimeout(y.Ca.bind(y),0);else if(Se(y,"readystatechange"),ns(y)==4){y.h=!1;try{const ve=y.ca();e:switch(ve){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var j=!0;break e;default:j=!1}var F;if(!(F=j)){var K;if(K=ve===0){let Pe=String(y.D).match(vd)[1]||null;!Pe&&l.self&&l.self.location&&(Pe=l.self.location.protocol.slice(0,-1)),K=!Rs.test(Pe?Pe.toLowerCase():"")}F=K}if(F)Se(y,"complete"),Se(y,"success");else{y.o=6;try{var he=ns(y)>2?y.g.statusText:""}catch{he=""}y.l=he+" ["+y.ca()+"]",Dc(y)}}finally{Xs(y)}}}}function Xs(y,j){if(y.g){y.m&&(clearTimeout(y.m),y.m=null);const F=y.g;y.g=null,j||Se(y,"ready");try{F.onreadystatechange=null}catch{}}}t.isActive=function(){return!!this.g};function ns(y){return y.g?y.g.readyState:0}t.ca=function(){try{return ns(this)>2?this.g.status:-1}catch{return-1}},t.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},t.La=function(y){if(this.g){var j=this.g.responseText;return y&&j.indexOf(y)==0&&(j=j.substring(y.length)),Qn(j)}};function Nn(y){try{if(!y.g)return null;if("response"in y.g)return y.g.response;switch(y.F){case"":case"text":return y.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in y.g)return y.g.mozResponseArrayBuffer}return null}catch{return null}}function Zs(y){const j={};y=(y.g&&ns(y)>=2&&y.g.getAllResponseHeaders()||"").split(`\r
`);for(let K=0;K<y.length;K++){if(O(y[K]))continue;var F=yd(y[K]);const he=F[0];if(F=F[1],typeof F!="string")continue;F=F.trim();const ve=j[he]||[];j[he]=ve,ve.push(F)}te(j,function(K){return K.join(", ")})}t.ya=function(){return this.o},t.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function Is(y,j,F){return F&&F.internalChannelParams&&F.internalChannelParams[y]||j}function Li(y){this.za=0,this.i=[],this.j=new Xr,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=Is("failFast",!1,y),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=Is("baseRetryDelayMs",5e3,y),this.Za=Is("retryDelaySeedMs",1e4,y),this.Ta=Is("forwardChannelMaxRetries",2,y),this.va=Is("forwardChannelRequestTimeoutMs",2e4,y),this.ma=y&&y.xmlHttpFactory||void 0,this.Ua=y&&y.Rb||void 0,this.Aa=y&&y.useFetchStreams||!1,this.O=void 0,this.L=y&&y.supportsCrossDomainXhr||!1,this.M="",this.h=new xc(y&&y.concurrentRequestLimit),this.Ba=new Bi,this.S=y&&y.fastHandshake||!1,this.R=y&&y.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=y&&y.Pb||!1,y&&y.ua&&this.j.ua(),y&&y.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&y&&y.detectBufferingProxy||!1,this.ia=void 0,y&&y.longPollingTimeout&&y.longPollingTimeout>0&&(this.ia=y.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}t=Li.prototype,t.ka=8,t.I=1,t.connect=function(y,j,F,K){Ut(0),this.W=y,this.H=j||{},F&&K!==void 0&&(this.H.OSID=F,this.H.OAID=K),this.F=this.X,this.J=kd(this,null,this.W),ks(this)};function Mc(y){if(Zo(y),y.I==3){var j=y.V++,F=mn(y.J);if(jt(F,"SID",y.M),jt(F,"RID",j),jt(F,"TYPE","terminate"),eo(y,F),j=new Zr(y,y.j,j),j.M=2,j.A=Qa(mn(F)),F=!1,l.navigator&&l.navigator.sendBeacon)try{F=l.navigator.sendBeacon(j.A.toString(),"")}catch{}!F&&l.Image&&(new Image().src=j.A,F=!0),F||(j.g=Dd(j.j,null),j.g.ea(j.A)),j.F=Date.now(),ws(j)}Id(y)}function Ui(y){y.g&&(Nc(y),y.g.cancel(),y.g=null)}function Zo(y){Ui(y),y.v&&(l.clearTimeout(y.v),y.v=null),el(y),y.h.cancel(),y.m&&(typeof y.m=="number"&&l.clearTimeout(y.m),y.m=null)}function ks(y){if(!wc(y.h)&&!y.m){y.m=!0;var j=y.Ea;V||D(),$||(V(),$=!0),I.add(j,y),y.D=0}}function Jo(y,j){return Es(y.h)>=y.h.j-(y.m?1:0)?!1:y.m?(y.i=j.G.concat(y.i),!0):y.I==1||y.I==2||y.D>=(y.Sa?0:y.Ta)?!1:(y.m=bs(f(y.Ea,y,j),Rd(y,y.D)),y.D++,!0)}t.Ea=function(y){if(this.m)if(this.m=null,this.I==1){if(!y){this.V=Math.floor(Math.random()*1e5),y=this.V++;const he=new Zr(this,this.j,y);let ve=this.o;if(this.U&&(ve?(ve=z(ve),re(ve,this.U)):ve=this.U),this.u!==null||this.R||(he.J=ve,ve=null),this.S)e:{for(var j=0,F=0;F<this.i.length;F++){t:{var K=this.i[F];if("__data__"in K.map&&(K=K.map.__data__,typeof K=="string")){K=K.length;break t}K=void 0}if(K===void 0)break;if(j+=K,j>4096){j=F;break e}if(j===4096||F===this.i.length-1){j=F+1;break e}}j=1e3}else j=1e3;j=Ed(this,he,j),F=mn(this.J),jt(F,"RID",y),jt(F,"CVER",22),this.G&&jt(F,"X-HTTP-Session-Id",this.G),eo(this,F),ve&&(this.R?j="headers="+Ys(Pr(ve))+"&"+j:this.u&&Xa(F,this.u,ve)),Sc(this.h,he),this.Ra&&jt(F,"TYPE","init"),this.S?(jt(F,"$req",j),jt(F,"SID","null"),he.U=!0,xs(he,F,null)):xs(he,F,j),this.I=2}}else this.I==3&&(y?Oc(this,y):this.i.length==0||wc(this.h)||Oc(this))};function Oc(y,j){var F;j?F=j.l:F=y.V++;const K=mn(y.J);jt(K,"SID",y.M),jt(K,"RID",F),jt(K,"AID",y.K),eo(y,K),y.u&&y.o&&Xa(K,y.u,y.o),F=new Zr(y,y.j,F,y.D+1),y.u===null&&(F.J=y.o),j&&(y.i=j.G.concat(y.i)),j=Ed(y,F,1e3),F.H=Math.round(y.va*.5)+Math.round(y.va*.5*Math.random()),Sc(y.h,F),xs(F,K,j)}function eo(y,j){y.H&&Q(y.H,function(F,K){jt(j,K,F)}),y.l&&Q({},function(F,K){jt(j,K,F)})}function Ed(y,j,F){F=Math.min(y.i.length,F);const K=y.l?f(y.l.Ka,y.l,y):null;e:{var he=y.i;let it=-1;for(;;){const sn=["count="+F];it==-1?F>0?(it=he[0].g,sn.push("ofs="+it)):it=0:sn.push("ofs="+it);let Et=!0;for(let Qt=0;Qt<F;Qt++){var ve=he[Qt].g;const Br=he[Qt].map;if(ve-=it,ve<0)it=Math.max(0,he[Qt].g-100),Et=!1;else try{ve="req"+ve+"_"||"";try{var Pe=Br instanceof Map?Br:Object.entries(Br);for(const[Ms,rs]of Pe){let ss=rs;d(rs)&&(ss=rt(rs)),sn.push(ve+Ms+"="+encodeURIComponent(ss))}}catch(Ms){throw sn.push(ve+"type="+encodeURIComponent("_badmap")),Ms}}catch{K&&K(Br)}}if(Et){Pe=sn.join("&");break e}}Pe=void 0}return y=y.i.splice(0,F),j.G=y,Pe}function Td(y){if(!y.g&&!y.v){y.Y=1;var j=y.Da;V||D(),$||(V(),$=!0),I.add(j,y),y.A=0}}function to(y){return y.g||y.v||y.A>=3?!1:(y.Y++,y.v=bs(f(y.Da,y),Rd(y,y.A)),y.A++,!0)}t.Da=function(){if(this.v=null,Ad(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var y=4*this.T;this.j.info("BP detection timer enabled: "+y),this.B=bs(f(this.Wa,this),y)}},t.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,Ut(10),Ui(this),Ad(this))};function Nc(y){y.B!=null&&(l.clearTimeout(y.B),y.B=null)}function Ad(y){y.g=new Zr(y,y.j,"rpc",y.Y),y.u===null&&(y.g.J=y.o),y.g.P=0;var j=mn(y.na);jt(j,"RID","rpc"),jt(j,"SID",y.M),jt(j,"AID",y.K),jt(j,"CI",y.F?"0":"1"),!y.F&&y.ia&&jt(j,"TO",y.ia),jt(j,"TYPE","xmlhttp"),eo(y,j),y.u&&y.o&&Xa(j,y.u,y.o),y.O&&(y.g.H=y.O);var F=y.g;y=y.ba,F.M=1,F.A=Qa(mn(j)),F.u=null,F.R=!0,Ho(F,y)}t.Va=function(){this.C!=null&&(this.C=null,Ui(this),to(this),Ut(19))};function el(y){y.C!=null&&(l.clearTimeout(y.C),y.C=null)}function jd(y,j){var F=null;if(y.g==j){el(y),Nc(y),y.g=null;var K=2}else if(Ts(y.h,j))F=j.G,Cc(y.h,j),K=1;else return;if(y.I!=0){if(j.o)if(K==1){F=j.u?j.u.length:0,j=Date.now()-j.F;var he=y.D;K=Di(),Se(K,new rr(K,F)),ks(y)}else Td(y);else if(he=j.m,he==3||he==0&&j.X>0||!(K==1&&Jo(y,j)||K==2&&to(y)))switch(F&&F.length>0&&(j=y.h,j.i=j.i.concat(F)),he){case 1:Ds(y,5);break;case 4:Ds(y,10);break;case 3:Ds(y,6);break;default:Ds(y,2)}}}function Rd(y,j){let F=y.Qa+Math.floor(Math.random()*y.Za);return y.isActive()||(F*=2),F*j}function Ds(y,j){if(y.j.info("Error code "+j),j==2){var F=f(y.bb,y),K=y.Ua;const he=!K;K=new xr(K||"//www.google.com/images/cleardot.gif"),l.location&&l.location.protocol=="http"||kn(K,"https"),Qa(K),he?es(K.toString(),F):Ic(K.toString(),F)}else Ut(2);y.I=0,y.l&&y.l.pa(j),Id(y),Zo(y)}t.bb=function(y){y?(this.j.info("Successfully pinged google.com"),Ut(2)):(this.j.info("Failed to ping google.com"),Ut(1))};function Id(y){if(y.I=0,y.ja=[],y.l){const j=Ec(y.h);(j.length!=0||y.i.length!=0)&&(C(y.ja,j),C(y.ja,y.i),y.h.i.length=0,_(y.i),y.i.length=0),y.l.oa()}}function kd(y,j,F){var K=F instanceof xr?mn(F):new xr(F);if(K.g!="")j&&(K.g=j+"."+K.g),Mi(K,K.u);else{var he=l.location;K=he.protocol,j=j?j+"."+he.hostname:he.hostname,he=+he.port;const ve=new xr(null);K&&kn(ve,K),j&&(ve.g=j),he&&Mi(ve,he),F&&(ve.h=F),K=ve}return F=y.G,j=y.wa,F&&j&&jt(K,F,j),jt(K,"VER",y.ka),eo(y,K),K}function Dd(y,j,F){if(j&&!y.L)throw Error("Can't create secondary domain capable XhrIo object.");return j=y.Aa&&!y.ma?new kt(new js({ab:F})):new kt(y.ma),j.Fa(y.L),j}t.isActive=function(){return!!this.l&&this.l.isActive(this)};function Md(){}t=Md.prototype,t.ra=function(){},t.qa=function(){},t.pa=function(){},t.oa=function(){},t.isActive=function(){return!0},t.Ka=function(){};function Fi(){}Fi.prototype.g=function(y,j){return new sr(y,j)};function sr(y,j){oe.call(this),this.g=new Li(j),this.l=y,this.h=j&&j.messageUrlParams||null,y=j&&j.messageHeaders||null,j&&j.clientProtocolHeaderRequired&&(y?y["X-Client-Protocol"]="webchannel":y={"X-Client-Protocol":"webchannel"}),this.g.o=y,y=j&&j.initMessageHeaders||null,j&&j.messageContentType&&(y?y["X-WebChannel-Content-Type"]=j.messageContentType:y={"X-WebChannel-Content-Type":j.messageContentType}),j&&j.sa&&(y?y["X-WebChannel-Client-Profile"]=j.sa:y={"X-WebChannel-Client-Profile":j.sa}),this.g.U=y,(y=j&&j.Qb)&&!O(y)&&(this.g.u=y),this.A=j&&j.supportsCrossDomainXhr||!1,this.v=j&&j.sendRawJson||!1,(j=j&&j.httpSessionIdParam)&&!O(j)&&(this.g.G=j,y=this.h,y!==null&&j in y&&(y=this.h,j in y&&delete y[j])),this.j=new Js(this)}g(sr,oe),sr.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},sr.prototype.close=function(){Mc(this.g)},sr.prototype.o=function(y){var j=this.g;if(typeof y=="string"){var F={};F.__data__=y,y=F}else this.v&&(F={},F.__data__=rt(y),y=F);j.i.push(new fn(j.Ya++,y)),j.I==3&&ks(j)},sr.prototype.N=function(){this.g.l=null,delete this.j,Mc(this.g),delete this.g,sr.Z.N.call(this)};function Od(y){tn.call(this),y.__headers__&&(this.headers=y.__headers__,this.statusCode=y.__status__,delete y.__headers__,delete y.__status__);var j=y.__sm__;if(j){e:{for(const F in j){y=F;break e}y=void 0}(this.i=y)&&(y=this.i,j=j!==null&&y in j?j[y]:void 0),this.data=j}else this.data=y}g(Od,tn);function Nd(){Kn.call(this),this.status=1}g(Nd,Kn);function Js(y){this.g=y}g(Js,Md),Js.prototype.ra=function(){Se(this.g,"a")},Js.prototype.qa=function(y){Se(this.g,new Od(y))},Js.prototype.pa=function(y){Se(this.g,new Nd)},Js.prototype.oa=function(){Se(this.g,"b")},Fi.prototype.createWebChannel=Fi.prototype.g,sr.prototype.send=sr.prototype.o,sr.prototype.open=sr.prototype.m,sr.prototype.close=sr.prototype.close,$C=function(){return new Fi},VC=function(){return Di()},FC=Ct,gy={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},Ga.NO_ERROR=0,Ga.TIMEOUT=8,Ga.HTTP_ERROR=6,nf=Ga,bc.COMPLETE="complete",UC=bc,ys.EventType=vt,vt.OPEN="a",vt.CLOSE="b",vt.ERROR="c",vt.MESSAGE="d",oe.prototype.listen=oe.prototype.J,Su=ys,kt.prototype.listenOnce=kt.prototype.K,kt.prototype.getLastError=kt.prototype.Ha,kt.prototype.getLastErrorCode=kt.prototype.ya,kt.prototype.getStatus=kt.prototype.ca,kt.prototype.getResponseJson=kt.prototype.La,kt.prototype.getResponseText=kt.prototype.la,kt.prototype.send=kt.prototype.ea,kt.prototype.setWithCredentials=kt.prototype.Fa,LC=kt}).apply(typeof $h<"u"?$h:typeof self<"u"?self:typeof window<"u"?window:{});const kw="@firebase/firestore",Dw="4.9.3";class Zn{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Zn.UNAUTHENTICATED=new Zn(null),Zn.GOOGLE_CREDENTIALS=new Zn("google-credentials-uid"),Zn.FIRST_PARTY=new Zn("first-party-uid"),Zn.MOCK_USER=new Zn("mock-user");let uc="12.7.0";const Mo=new Ky("@firebase/firestore");function Nl(){return Mo.logLevel}function Ue(t,...e){if(Mo.logLevel<=pt.DEBUG){const n=e.map(a0);Mo.debug(`Firestore (${uc}): ${t}`,...n)}}function Ci(t,...e){if(Mo.logLevel<=pt.ERROR){const n=e.map(a0);Mo.error(`Firestore (${uc}): ${t}`,...n)}}function Wl(t,...e){if(Mo.logLevel<=pt.WARN){const n=e.map(a0);Mo.warn(`Firestore (${uc}): ${t}`,...n)}}function a0(t){if(typeof t=="string")return t;try{return(function(n){return JSON.stringify(n)})(t)}catch{return t}}function Ye(t,e,n){let r="Unexpected state";typeof e=="string"?r=e:n=e,qC(t,r,n)}function qC(t,e,n){let r=`FIRESTORE (${uc}) INTERNAL ASSERTION FAILED: ${e} (ID: ${t.toString(16)})`;if(n!==void 0)try{r+=" CONTEXT: "+JSON.stringify(n)}catch{r+=" CONTEXT: "+n}throw Ci(r),new Error(r)}function At(t,e,n,r){let i="Unexpected state";typeof n=="string"?i=n:r=n,t||qC(e,i,r)}function nt(t,e){return t}const Re={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Le extends Ii{constructor(e,n){super(e,n),this.code=e,this.message=n,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class bi{constructor(){this.promise=new Promise(((e,n)=>{this.resolve=e,this.reject=n}))}}class HC{constructor(e,n){this.user=n,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class _M{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,n){e.enqueueRetryable((()=>n(Zn.UNAUTHENTICATED)))}shutdown(){}}class bM{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,n){this.changeListener=n,e.enqueueRetryable((()=>n(this.token.user)))}shutdown(){this.changeListener=null}}class vM{constructor(e){this.t=e,this.currentUser=Zn.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,n){At(this.o===void 0,42304);let r=this.i;const i=h=>this.i!==r?(r=this.i,n(h)):Promise.resolve();let o=new bi;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new bi,e.enqueueRetryable((()=>i(this.currentUser)))};const l=()=>{const h=o;e.enqueueRetryable((async()=>{await h.promise,await i(this.currentUser)}))},d=h=>{Ue("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=h,this.o&&(this.auth.addAuthTokenListener(this.o),l())};this.t.onInit((h=>d(h))),setTimeout((()=>{if(!this.auth){const h=this.t.getImmediate({optional:!0});h?d(h):(Ue("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new bi)}}),0),l()}getToken(){const e=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then((r=>this.i!==e?(Ue("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(At(typeof r.accessToken=="string",31837,{l:r}),new HC(r.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return At(e===null||typeof e=="string",2055,{h:e}),new Zn(e)}}class xM{constructor(e,n,r){this.P=e,this.T=n,this.I=r,this.type="FirstParty",this.user=Zn.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class wM{constructor(e,n,r){this.P=e,this.T=n,this.I=r}getToken(){return Promise.resolve(new xM(this.P,this.T,this.I))}start(e,n){e.enqueueRetryable((()=>n(Zn.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class Mw{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class SM{constructor(e,n){this.V=n,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,cs(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,n){At(this.o===void 0,3512);const r=o=>{o.error!=null&&Ue("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${o.error.message}`);const l=o.token!==this.m;return this.m=o.token,Ue("FirebaseAppCheckTokenProvider",`Received ${l?"new":"existing"} token.`),l?n(o.token):Promise.resolve()};this.o=o=>{e.enqueueRetryable((()=>r(o)))};const i=o=>{Ue("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=o,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((o=>i(o))),setTimeout((()=>{if(!this.appCheck){const o=this.V.getImmediate({optional:!0});o?i(o):Ue("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new Mw(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((n=>n?(At(typeof n.token=="string",44558,{tokenResult:n}),this.m=n.token,new Mw(n.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function CM(t){const e=typeof self<"u"&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(n);else for(let r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}class o0{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const i=CM(40);for(let o=0;o<i.length;++o)r.length<20&&i[o]<n&&(r+=e.charAt(i[o]%62))}return r}}function gt(t,e){return t<e?-1:t>e?1:0}function yy(t,e){const n=Math.min(t.length,e.length);for(let r=0;r<n;r++){const i=t.charAt(r),o=e.charAt(r);if(i!==o)return Fg(i)===Fg(o)?gt(i,o):Fg(i)?1:-1}return gt(t.length,e.length)}const EM=55296,TM=57343;function Fg(t){const e=t.charCodeAt(0);return e>=EM&&e<=TM}function Ql(t,e,n){return t.length===e.length&&t.every(((r,i)=>n(r,e[i])))}const Ow="__name__";class Ls{constructor(e,n,r){n===void 0?n=0:n>e.length&&Ye(637,{offset:n,range:e.length}),r===void 0?r=e.length-n:r>e.length-n&&Ye(1746,{length:r,range:e.length-n}),this.segments=e,this.offset=n,this.len=r}get length(){return this.len}isEqual(e){return Ls.comparator(this,e)===0}child(e){const n=this.segments.slice(this.offset,this.limit());return e instanceof Ls?e.forEach((r=>{n.push(r)})):n.push(e),this.construct(n)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}forEach(e){for(let n=this.offset,r=this.limit();n<r;n++)e(this.segments[n])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,n){const r=Math.min(e.length,n.length);for(let i=0;i<r;i++){const o=Ls.compareSegments(e.get(i),n.get(i));if(o!==0)return o}return gt(e.length,n.length)}static compareSegments(e,n){const r=Ls.isNumericId(e),i=Ls.isNumericId(n);return r&&!i?-1:!r&&i?1:r&&i?Ls.extractNumericId(e).compare(Ls.extractNumericId(n)):yy(e,n)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Ea.fromString(e.substring(4,e.length-2))}}class Ft extends Ls{construct(e,n,r){return new Ft(e,n,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const n=[];for(const r of e){if(r.indexOf("//")>=0)throw new Le(Re.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);n.push(...r.split("/").filter((i=>i.length>0)))}return new Ft(n)}static emptyPath(){return new Ft([])}}const AM=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class $n extends Ls{construct(e,n,r){return new $n(e,n,r)}static isValidIdentifier(e){return AM.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),$n.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===Ow}static keyField(){return new $n([Ow])}static fromServerFormat(e){const n=[];let r="",i=0;const o=()=>{if(r.length===0)throw new Le(Re.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);n.push(r),r=""};let l=!1;for(;i<e.length;){const d=e[i];if(d==="\\"){if(i+1===e.length)throw new Le(Re.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const h=e[i+1];if(h!=="\\"&&h!=="."&&h!=="`")throw new Le(Re.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=h,i+=2}else d==="`"?(l=!l,i++):d!=="."||l?(r+=d,i++):(o(),i++)}if(o(),l)throw new Le(Re.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new $n(n)}static emptyPath(){return new $n([])}}class Ge{constructor(e){this.path=e}static fromPath(e){return new Ge(Ft.fromString(e))}static fromName(e){return new Ge(Ft.fromString(e).popFirst(5))}static empty(){return new Ge(Ft.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Ft.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,n){return Ft.comparator(e.path,n.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Ge(new Ft(e.slice()))}}function GC(t,e,n){if(!n)throw new Le(Re.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function jM(t,e,n,r){if(e===!0&&r===!0)throw new Le(Re.INVALID_ARGUMENT,`${t} and ${n} cannot be used together.`)}function Nw(t){if(!Ge.isDocumentKey(t))throw new Le(Re.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function Pw(t){if(Ge.isDocumentKey(t))throw new Le(Re.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function WC(t){return typeof t=="object"&&t!==null&&(Object.getPrototypeOf(t)===Object.prototype||Object.getPrototypeOf(t)===null)}function Qf(t){if(t===void 0)return"undefined";if(t===null)return"null";if(typeof t=="string")return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if(typeof t=="number"||typeof t=="boolean")return""+t;if(typeof t=="object"){if(t instanceof Array)return"an array";{const e=(function(r){return r.constructor?r.constructor.name:null})(t);return e?`a custom ${e} object`:"an object"}}return typeof t=="function"?"a function":Ye(12329,{type:typeof t})}function ms(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new Le(Re.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=Qf(t);throw new Le(Re.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}function xn(t,e){const n={typeString:t};return e&&(n.value=e),n}function sd(t,e){if(!WC(t))throw new Le(Re.INVALID_ARGUMENT,"JSON must be an object");let n;for(const r in e)if(e[r]){const i=e[r].typeString,o="value"in e[r]?{value:e[r].value}:void 0;if(!(r in t)){n=`JSON missing required field: '${r}'`;break}const l=t[r];if(i&&typeof l!==i){n=`JSON field '${r}' must be a ${i}.`;break}if(o!==void 0&&l!==o.value){n=`Expected '${r}' field to equal '${o.value}'`;break}}if(n)throw new Le(Re.INVALID_ARGUMENT,n);return!0}const Bw=-62135596800,zw=1e6;class Wt{static now(){return Wt.fromMillis(Date.now())}static fromDate(e){return Wt.fromMillis(e.getTime())}static fromMillis(e){const n=Math.floor(e/1e3),r=Math.floor((e-1e3*n)*zw);return new Wt(n,r)}constructor(e,n){if(this.seconds=e,this.nanoseconds=n,n<0)throw new Le(Re.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new Le(Re.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(e<Bw)throw new Le(Re.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Le(Re.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/zw}_compareTo(e){return this.seconds===e.seconds?gt(this.nanoseconds,e.nanoseconds):gt(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:Wt._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(sd(e,Wt._jsonSchema))return new Wt(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-Bw;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}Wt._jsonSchemaVersion="firestore/timestamp/1.0",Wt._jsonSchema={type:xn("string",Wt._jsonSchemaVersion),seconds:xn("number"),nanoseconds:xn("number")};class Ze{static fromTimestamp(e){return new Ze(e)}static min(){return new Ze(new Wt(0,0))}static max(){return new Ze(new Wt(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const zu=-1;function RM(t,e){const n=t.toTimestamp().seconds,r=t.toTimestamp().nanoseconds+1,i=Ze.fromTimestamp(r===1e9?new Wt(n+1,0):new Wt(n,r));return new Aa(i,Ge.empty(),e)}function IM(t){return new Aa(t.readTime,t.key,zu)}class Aa{constructor(e,n,r){this.readTime=e,this.documentKey=n,this.largestBatchId=r}static min(){return new Aa(Ze.min(),Ge.empty(),zu)}static max(){return new Aa(Ze.max(),Ge.empty(),zu)}}function kM(t,e){let n=t.readTime.compareTo(e.readTime);return n!==0?n:(n=Ge.comparator(t.documentKey,e.documentKey),n!==0?n:gt(t.largestBatchId,e.largestBatchId))}const DM="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class MM{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function dc(t){if(t.code!==Re.FAILED_PRECONDITION||t.message!==DM)throw t;Ue("LocalStore","Unexpectedly lost primary lease")}class ke{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((n=>{this.isDone=!0,this.result=n,this.nextCallback&&this.nextCallback(n)}),(n=>{this.isDone=!0,this.error=n,this.catchCallback&&this.catchCallback(n)}))}catch(e){return this.next(void 0,e)}next(e,n){return this.callbackAttached&&Ye(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new ke(((r,i)=>{this.nextCallback=o=>{this.wrapSuccess(e,o).next(r,i)},this.catchCallback=o=>{this.wrapFailure(n,o).next(r,i)}}))}toPromise(){return new Promise(((e,n)=>{this.next(e,n)}))}wrapUserFunction(e){try{const n=e();return n instanceof ke?n:ke.resolve(n)}catch(n){return ke.reject(n)}}wrapSuccess(e,n){return e?this.wrapUserFunction((()=>e(n))):ke.resolve(n)}wrapFailure(e,n){return e?this.wrapUserFunction((()=>e(n))):ke.reject(n)}static resolve(e){return new ke(((n,r)=>{n(e)}))}static reject(e){return new ke(((n,r)=>{r(e)}))}static waitFor(e){return new ke(((n,r)=>{let i=0,o=0,l=!1;e.forEach((d=>{++i,d.next((()=>{++o,l&&o===i&&n()}),(h=>r(h)))})),l=!0,o===i&&n()}))}static or(e){let n=ke.resolve(!1);for(const r of e)n=n.next((i=>i?ke.resolve(i):r()));return n}static forEach(e,n){const r=[];return e.forEach(((i,o)=>{r.push(n.call(this,i,o))})),this.waitFor(r)}static mapArray(e,n){return new ke(((r,i)=>{const o=e.length,l=new Array(o);let d=0;for(let h=0;h<o;h++){const f=h;n(e[f]).next((p=>{l[f]=p,++d,d===o&&r(l)}),(p=>i(p)))}}))}static doWhile(e,n){return new ke(((r,i)=>{const o=()=>{e()===!0?n().next((()=>{o()}),i):r()};o()}))}}function OM(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}function hc(t){return t.name==="IndexedDbTransactionError"}class Kf{constructor(e,n){this.previousValue=e,n&&(n.sequenceNumberHandler=r=>this.ae(r),this.ue=r=>n.writeSequenceNumber(r))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}Kf.ce=-1;const l0=-1;function Yf(t){return t==null}function vf(t){return t===0&&1/t==-1/0}function NM(t){return typeof t=="number"&&Number.isInteger(t)&&!vf(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}const QC="";function PM(t){let e="";for(let n=0;n<t.length;n++)e.length>0&&(e=Lw(e)),e=BM(t.get(n),e);return Lw(e)}function BM(t,e){let n=e;const r=t.length;for(let i=0;i<r;i++){const o=t.charAt(i);switch(o){case"\0":n+="";break;case QC:n+="";break;default:n+=o}}return n}function Lw(t){return t+QC+""}function Uw(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Ua(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function KC(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}class en{constructor(e,n){this.comparator=e,this.root=n||Un.EMPTY}insert(e,n){return new en(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,Un.BLACK,null,null))}remove(e){return new en(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Un.BLACK,null,null))}get(e){let n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(r===0)return n.value;r<0?n=n.left:r>0&&(n=n.right)}return null}indexOf(e){let n=0,r=this.root;for(;!r.isEmpty();){const i=this.comparator(e,r.key);if(i===0)return n+r.left.size;i<0?r=r.left:(n+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((n,r)=>(e(n,r),!1)))}toString(){const e=[];return this.inorderTraversal(((n,r)=>(e.push(`${n}:${r}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new qh(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new qh(this.root,e,this.comparator,!1)}getReverseIterator(){return new qh(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new qh(this.root,e,this.comparator,!0)}}class qh{constructor(e,n,r,i){this.isReverse=i,this.nodeStack=[];let o=1;for(;!e.isEmpty();)if(o=n?r(e.key,n):1,n&&i&&(o*=-1),o<0)e=this.isReverse?e.left:e.right;else{if(o===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const n={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return n}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Un{constructor(e,n,r,i,o){this.key=e,this.value=n,this.color=r??Un.RED,this.left=i??Un.EMPTY,this.right=o??Un.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,n,r,i,o){return new Un(e??this.key,n??this.value,r??this.color,i??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,r){let i=this;const o=r(e,i.key);return i=o<0?i.copy(null,null,null,i.left.insert(e,n,r),null):o===0?i.copy(null,n,null,null,null):i.copy(null,null,null,null,i.right.insert(e,n,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return Un.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,n){let r,i=this;if(n(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),n(e,i.key)===0){if(i.right.isEmpty())return Un.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Un.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Un.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Ye(43730,{key:this.key,value:this.value});if(this.right.isRed())throw Ye(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw Ye(27949);return e+(this.isRed()?0:1)}}Un.EMPTY=null,Un.RED=!0,Un.BLACK=!1;Un.EMPTY=new class{constructor(){this.size=0}get key(){throw Ye(57766)}get value(){throw Ye(16141)}get color(){throw Ye(16727)}get left(){throw Ye(29726)}get right(){throw Ye(36894)}copy(e,n,r,i,o){return this}insert(e,n,r){return new Un(e,n)}remove(e,n){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class An{constructor(e){this.comparator=e,this.data=new en(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((n,r)=>(e(n),!1)))}forEachInRange(e,n){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;n(i.key)}}forEachWhile(e,n){let r;for(r=n!==void 0?this.data.getIteratorFrom(n):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const n=this.data.getIteratorFrom(e);return n.hasNext()?n.getNext().key:null}getIterator(){return new Fw(this.data.getIterator())}getIteratorFrom(e){return new Fw(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let n=this;return n.size<e.size&&(n=e,e=this),e.forEach((r=>{n=n.add(r)})),n}isEqual(e){if(!(e instanceof An)||this.size!==e.size)return!1;const n=this.data.getIterator(),r=e.data.getIterator();for(;n.hasNext();){const i=n.getNext().key,o=r.getNext().key;if(this.comparator(i,o)!==0)return!1}return!0}toArray(){const e=[];return this.forEach((n=>{e.push(n)})),e}toString(){const e=[];return this.forEach((n=>e.push(n))),"SortedSet("+e.toString()+")"}copy(e){const n=new An(this.comparator);return n.data=e,n}}class Fw{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class Rr{constructor(e){this.fields=e,e.sort($n.comparator)}static empty(){return new Rr([])}unionWith(e){let n=new An($n.comparator);for(const r of this.fields)n=n.add(r);for(const r of e)n=n.add(r);return new Rr(n.toArray())}covers(e){for(const n of this.fields)if(n.isPrefixOf(e))return!0;return!1}isEqual(e){return Ql(this.fields,e.fields,((n,r)=>n.isEqual(r)))}}class YC extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Gn{constructor(e){this.binaryString=e}static fromBase64String(e){const n=(function(i){try{return atob(i)}catch(o){throw typeof DOMException<"u"&&o instanceof DOMException?new YC("Invalid base64 string: "+o):o}})(e);return new Gn(n)}static fromUint8Array(e){const n=(function(i){let o="";for(let l=0;l<i.length;++l)o+=String.fromCharCode(i[l]);return o})(e);return new Gn(n)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(n){return btoa(n)})(this.binaryString)}toUint8Array(){return(function(n){const r=new Uint8Array(n.length);for(let i=0;i<n.length;i++)r[i]=n.charCodeAt(i);return r})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return gt(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Gn.EMPTY_BYTE_STRING=new Gn("");const zM=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ja(t){if(At(!!t,39018),typeof t=="string"){let e=0;const n=zM.exec(t);if(At(!!n,46558,{timestamp:t}),n[1]){let i=n[1];i=(i+"000000000").substr(0,9),e=Number(i)}const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:ln(t.seconds),nanos:ln(t.nanos)}}function ln(t){return typeof t=="number"?t:typeof t=="string"?Number(t):0}function Ra(t){return typeof t=="string"?Gn.fromBase64String(t):Gn.fromUint8Array(t)}const XC="server_timestamp",ZC="__type__",JC="__previous_value__",eE="__local_write_time__";function c0(t){return(t?.mapValue?.fields||{})[ZC]?.stringValue===XC}function Xf(t){const e=t.mapValue.fields[JC];return c0(e)?Xf(e):e}function Lu(t){const e=ja(t.mapValue.fields[eE].timestampValue);return new Wt(e.seconds,e.nanos)}class LM{constructor(e,n,r,i,o,l,d,h,f,p){this.databaseId=e,this.appId=n,this.persistenceKey=r,this.host=i,this.ssl=o,this.forceLongPolling=l,this.autoDetectLongPolling=d,this.longPollingOptions=h,this.useFetchStreams=f,this.isUsingEmulator=p}}const xf="(default)";class Uu{constructor(e,n){this.projectId=e,this.database=n||xf}static empty(){return new Uu("","")}get isDefaultDatabase(){return this.database===xf}isEqual(e){return e instanceof Uu&&e.projectId===this.projectId&&e.database===this.database}}const tE="__type__",UM="__max__",Hh={mapValue:{}},nE="__vector__",wf="value";function Ia(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?c0(t)?4:VM(t)?9007199254740991:FM(t)?10:11:Ye(28295,{value:t})}function Qs(t,e){if(t===e)return!0;const n=Ia(t);if(n!==Ia(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Lu(t).isEqual(Lu(e));case 3:return(function(i,o){if(typeof i.timestampValue=="string"&&typeof o.timestampValue=="string"&&i.timestampValue.length===o.timestampValue.length)return i.timestampValue===o.timestampValue;const l=ja(i.timestampValue),d=ja(o.timestampValue);return l.seconds===d.seconds&&l.nanos===d.nanos})(t,e);case 5:return t.stringValue===e.stringValue;case 6:return(function(i,o){return Ra(i.bytesValue).isEqual(Ra(o.bytesValue))})(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return(function(i,o){return ln(i.geoPointValue.latitude)===ln(o.geoPointValue.latitude)&&ln(i.geoPointValue.longitude)===ln(o.geoPointValue.longitude)})(t,e);case 2:return(function(i,o){if("integerValue"in i&&"integerValue"in o)return ln(i.integerValue)===ln(o.integerValue);if("doubleValue"in i&&"doubleValue"in o){const l=ln(i.doubleValue),d=ln(o.doubleValue);return l===d?vf(l)===vf(d):isNaN(l)&&isNaN(d)}return!1})(t,e);case 9:return Ql(t.arrayValue.values||[],e.arrayValue.values||[],Qs);case 10:case 11:return(function(i,o){const l=i.mapValue.fields||{},d=o.mapValue.fields||{};if(Uw(l)!==Uw(d))return!1;for(const h in l)if(l.hasOwnProperty(h)&&(d[h]===void 0||!Qs(l[h],d[h])))return!1;return!0})(t,e);default:return Ye(52216,{left:t})}}function Fu(t,e){return(t.values||[]).find((n=>Qs(n,e)))!==void 0}function Kl(t,e){if(t===e)return 0;const n=Ia(t),r=Ia(e);if(n!==r)return gt(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return gt(t.booleanValue,e.booleanValue);case 2:return(function(o,l){const d=ln(o.integerValue||o.doubleValue),h=ln(l.integerValue||l.doubleValue);return d<h?-1:d>h?1:d===h?0:isNaN(d)?isNaN(h)?0:-1:1})(t,e);case 3:return Vw(t.timestampValue,e.timestampValue);case 4:return Vw(Lu(t),Lu(e));case 5:return yy(t.stringValue,e.stringValue);case 6:return(function(o,l){const d=Ra(o),h=Ra(l);return d.compareTo(h)})(t.bytesValue,e.bytesValue);case 7:return(function(o,l){const d=o.split("/"),h=l.split("/");for(let f=0;f<d.length&&f<h.length;f++){const p=gt(d[f],h[f]);if(p!==0)return p}return gt(d.length,h.length)})(t.referenceValue,e.referenceValue);case 8:return(function(o,l){const d=gt(ln(o.latitude),ln(l.latitude));return d!==0?d:gt(ln(o.longitude),ln(l.longitude))})(t.geoPointValue,e.geoPointValue);case 9:return $w(t.arrayValue,e.arrayValue);case 10:return(function(o,l){const d=o.fields||{},h=l.fields||{},f=d[wf]?.arrayValue,p=h[wf]?.arrayValue,g=gt(f?.values?.length||0,p?.values?.length||0);return g!==0?g:$w(f,p)})(t.mapValue,e.mapValue);case 11:return(function(o,l){if(o===Hh.mapValue&&l===Hh.mapValue)return 0;if(o===Hh.mapValue)return 1;if(l===Hh.mapValue)return-1;const d=o.fields||{},h=Object.keys(d),f=l.fields||{},p=Object.keys(f);h.sort(),p.sort();for(let g=0;g<h.length&&g<p.length;++g){const v=yy(h[g],p[g]);if(v!==0)return v;const _=Kl(d[h[g]],f[p[g]]);if(_!==0)return _}return gt(h.length,p.length)})(t.mapValue,e.mapValue);default:throw Ye(23264,{he:n})}}function Vw(t,e){if(typeof t=="string"&&typeof e=="string"&&t.length===e.length)return gt(t,e);const n=ja(t),r=ja(e),i=gt(n.seconds,r.seconds);return i!==0?i:gt(n.nanos,r.nanos)}function $w(t,e){const n=t.values||[],r=e.values||[];for(let i=0;i<n.length&&i<r.length;++i){const o=Kl(n[i],r[i]);if(o)return o}return gt(n.length,r.length)}function Yl(t){return _y(t)}function _y(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?(function(n){const r=ja(n);return`time(${r.seconds},${r.nanos})`})(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?(function(n){return Ra(n).toBase64()})(t.bytesValue):"referenceValue"in t?(function(n){return Ge.fromName(n).toString()})(t.referenceValue):"geoPointValue"in t?(function(n){return`geo(${n.latitude},${n.longitude})`})(t.geoPointValue):"arrayValue"in t?(function(n){let r="[",i=!0;for(const o of n.values||[])i?i=!1:r+=",",r+=_y(o);return r+"]"})(t.arrayValue):"mapValue"in t?(function(n){const r=Object.keys(n.fields||{}).sort();let i="{",o=!0;for(const l of r)o?o=!1:i+=",",i+=`${l}:${_y(n.fields[l])}`;return i+"}"})(t.mapValue):Ye(61005,{value:t})}function rf(t){switch(Ia(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=Xf(t);return e?16+rf(e):16;case 5:return 2*t.stringValue.length;case 6:return Ra(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return(function(r){return(r.values||[]).reduce(((i,o)=>i+rf(o)),0)})(t.arrayValue);case 10:case 11:return(function(r){let i=0;return Ua(r.fields,((o,l)=>{i+=o.length+rf(l)})),i})(t.mapValue);default:throw Ye(13486,{value:t})}}function qw(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function by(t){return!!t&&"integerValue"in t}function u0(t){return!!t&&"arrayValue"in t}function Hw(t){return!!t&&"nullValue"in t}function Gw(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function sf(t){return!!t&&"mapValue"in t}function FM(t){return(t?.mapValue?.fields||{})[tE]?.stringValue===nE}function Ru(t){if(t.geoPointValue)return{geoPointValue:{...t.geoPointValue}};if(t.timestampValue&&typeof t.timestampValue=="object")return{timestampValue:{...t.timestampValue}};if(t.mapValue){const e={mapValue:{fields:{}}};return Ua(t.mapValue.fields,((n,r)=>e.mapValue.fields[n]=Ru(r))),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=Ru(t.arrayValue.values[n]);return e}return{...t}}function VM(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue===UM}class gr{constructor(e){this.value=e}static empty(){return new gr({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let n=this.value;for(let r=0;r<e.length-1;++r)if(n=(n.mapValue.fields||{})[e.get(r)],!sf(n))return null;return n=(n.mapValue.fields||{})[e.lastSegment()],n||null}}set(e,n){this.getFieldsMap(e.popLast())[e.lastSegment()]=Ru(n)}setAll(e){let n=$n.emptyPath(),r={},i=[];e.forEach(((l,d)=>{if(!n.isImmediateParentOf(d)){const h=this.getFieldsMap(n);this.applyChanges(h,r,i),r={},i=[],n=d.popLast()}l?r[d.lastSegment()]=Ru(l):i.push(d.lastSegment())}));const o=this.getFieldsMap(n);this.applyChanges(o,r,i)}delete(e){const n=this.field(e.popLast());sf(n)&&n.mapValue.fields&&delete n.mapValue.fields[e.lastSegment()]}isEqual(e){return Qs(this.value,e.value)}getFieldsMap(e){let n=this.value;n.mapValue.fields||(n.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=n.mapValue.fields[e.get(r)];sf(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},n.mapValue.fields[e.get(r)]=i),n=i}return n.mapValue.fields}applyChanges(e,n,r){Ua(n,((i,o)=>e[i]=o));for(const i of r)delete e[i]}clone(){return new gr(Ru(this.value))}}function rE(t){const e=[];return Ua(t.fields,((n,r)=>{const i=new $n([n]);if(sf(r)){const o=rE(r.mapValue).fields;if(o.length===0)e.push(i);else for(const l of o)e.push(i.child(l))}else e.push(i)})),new Rr(e)}class Jn{constructor(e,n,r,i,o,l,d){this.key=e,this.documentType=n,this.version=r,this.readTime=i,this.createTime=o,this.data=l,this.documentState=d}static newInvalidDocument(e){return new Jn(e,0,Ze.min(),Ze.min(),Ze.min(),gr.empty(),0)}static newFoundDocument(e,n,r,i){return new Jn(e,1,n,Ze.min(),r,i,0)}static newNoDocument(e,n){return new Jn(e,2,n,Ze.min(),Ze.min(),gr.empty(),0)}static newUnknownDocument(e,n){return new Jn(e,3,n,Ze.min(),Ze.min(),gr.empty(),2)}convertToFoundDocument(e,n){return!this.createTime.isEqual(Ze.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=n,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=gr.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=gr.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Ze.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Jn&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Jn(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Sf{constructor(e,n){this.position=e,this.inclusive=n}}function Ww(t,e,n){let r=0;for(let i=0;i<t.position.length;i++){const o=e[i],l=t.position[i];if(o.field.isKeyField()?r=Ge.comparator(Ge.fromName(l.referenceValue),n.key):r=Kl(l,n.data.field(o.field)),o.dir==="desc"&&(r*=-1),r!==0)break}return r}function Qw(t,e){if(t===null)return e===null;if(e===null||t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!Qs(t.position[n],e.position[n]))return!1;return!0}class Cf{constructor(e,n="asc"){this.field=e,this.dir=n}}function $M(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}class sE{}class vn extends sE{constructor(e,n,r){super(),this.field=e,this.op=n,this.value=r}static create(e,n,r){return e.isKeyField()?n==="in"||n==="not-in"?this.createKeyFieldInFilter(e,n,r):new HM(e,n,r):n==="array-contains"?new QM(e,r):n==="in"?new KM(e,r):n==="not-in"?new YM(e,r):n==="array-contains-any"?new XM(e,r):new vn(e,n,r)}static createKeyFieldInFilter(e,n,r){return n==="in"?new GM(e,r):new WM(e,r)}matches(e){const n=e.data.field(this.field);return this.op==="!="?n!==null&&n.nullValue===void 0&&this.matchesComparison(Kl(n,this.value)):n!==null&&Ia(this.value)===Ia(n)&&this.matchesComparison(Kl(n,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Ye(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class ps extends sE{constructor(e,n){super(),this.filters=e,this.op=n,this.Pe=null}static create(e,n){return new ps(e,n)}matches(e){return iE(this)?this.filters.find((n=>!n.matches(e)))===void 0:this.filters.find((n=>n.matches(e)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((e,n)=>e.concat(n.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function iE(t){return t.op==="and"}function aE(t){return qM(t)&&iE(t)}function qM(t){for(const e of t.filters)if(e instanceof ps)return!1;return!0}function vy(t){if(t instanceof vn)return t.field.canonicalString()+t.op.toString()+Yl(t.value);if(aE(t))return t.filters.map((e=>vy(e))).join(",");{const e=t.filters.map((n=>vy(n))).join(",");return`${t.op}(${e})`}}function oE(t,e){return t instanceof vn?(function(r,i){return i instanceof vn&&r.op===i.op&&r.field.isEqual(i.field)&&Qs(r.value,i.value)})(t,e):t instanceof ps?(function(r,i){return i instanceof ps&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce(((o,l,d)=>o&&oE(l,i.filters[d])),!0):!1})(t,e):void Ye(19439)}function lE(t){return t instanceof vn?(function(n){return`${n.field.canonicalString()} ${n.op} ${Yl(n.value)}`})(t):t instanceof ps?(function(n){return n.op.toString()+" {"+n.getFilters().map(lE).join(" ,")+"}"})(t):"Filter"}class HM extends vn{constructor(e,n,r){super(e,n,r),this.key=Ge.fromName(r.referenceValue)}matches(e){const n=Ge.comparator(e.key,this.key);return this.matchesComparison(n)}}class GM extends vn{constructor(e,n){super(e,"in",n),this.keys=cE("in",n)}matches(e){return this.keys.some((n=>n.isEqual(e.key)))}}class WM extends vn{constructor(e,n){super(e,"not-in",n),this.keys=cE("not-in",n)}matches(e){return!this.keys.some((n=>n.isEqual(e.key)))}}function cE(t,e){return(e.arrayValue?.values||[]).map((n=>Ge.fromName(n.referenceValue)))}class QM extends vn{constructor(e,n){super(e,"array-contains",n)}matches(e){const n=e.data.field(this.field);return u0(n)&&Fu(n.arrayValue,this.value)}}class KM extends vn{constructor(e,n){super(e,"in",n)}matches(e){const n=e.data.field(this.field);return n!==null&&Fu(this.value.arrayValue,n)}}class YM extends vn{constructor(e,n){super(e,"not-in",n)}matches(e){if(Fu(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const n=e.data.field(this.field);return n!==null&&n.nullValue===void 0&&!Fu(this.value.arrayValue,n)}}class XM extends vn{constructor(e,n){super(e,"array-contains-any",n)}matches(e){const n=e.data.field(this.field);return!(!u0(n)||!n.arrayValue.values)&&n.arrayValue.values.some((r=>Fu(this.value.arrayValue,r)))}}class ZM{constructor(e,n=null,r=[],i=[],o=null,l=null,d=null){this.path=e,this.collectionGroup=n,this.orderBy=r,this.filters=i,this.limit=o,this.startAt=l,this.endAt=d,this.Te=null}}function Kw(t,e=null,n=[],r=[],i=null,o=null,l=null){return new ZM(t,e,n,r,i,o,l)}function d0(t){const e=nt(t);if(e.Te===null){let n=e.path.canonicalString();e.collectionGroup!==null&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map((r=>vy(r))).join(","),n+="|ob:",n+=e.orderBy.map((r=>(function(o){return o.field.canonicalString()+o.dir})(r))).join(","),Yf(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map((r=>Yl(r))).join(",")),e.endAt&&(n+="|ub:",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map((r=>Yl(r))).join(",")),e.Te=n}return e.Te}function h0(t,e){if(t.limit!==e.limit||t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!$M(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!oE(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!Qw(t.startAt,e.startAt)&&Qw(t.endAt,e.endAt)}function xy(t){return Ge.isDocumentKey(t.path)&&t.collectionGroup===null&&t.filters.length===0}class id{constructor(e,n=null,r=[],i=[],o=null,l="F",d=null,h=null){this.path=e,this.collectionGroup=n,this.explicitOrderBy=r,this.filters=i,this.limit=o,this.limitType=l,this.startAt=d,this.endAt=h,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function JM(t,e,n,r,i,o,l,d){return new id(t,e,n,r,i,o,l,d)}function f0(t){return new id(t)}function Yw(t){return t.filters.length===0&&t.limit===null&&t.startAt==null&&t.endAt==null&&(t.explicitOrderBy.length===0||t.explicitOrderBy.length===1&&t.explicitOrderBy[0].field.isKeyField())}function uE(t){return t.collectionGroup!==null}function Iu(t){const e=nt(t);if(e.Ie===null){e.Ie=[];const n=new Set;for(const o of e.explicitOrderBy)e.Ie.push(o),n.add(o.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(l){let d=new An($n.comparator);return l.filters.forEach((h=>{h.getFlattenedFilters().forEach((f=>{f.isInequality()&&(d=d.add(f.field))}))})),d})(e).forEach((o=>{n.has(o.canonicalString())||o.isKeyField()||e.Ie.push(new Cf(o,r))})),n.has($n.keyField().canonicalString())||e.Ie.push(new Cf($n.keyField(),r))}return e.Ie}function $s(t){const e=nt(t);return e.Ee||(e.Ee=eO(e,Iu(t))),e.Ee}function eO(t,e){if(t.limitType==="F")return Kw(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map((i=>{const o=i.dir==="desc"?"asc":"desc";return new Cf(i.field,o)}));const n=t.endAt?new Sf(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new Sf(t.startAt.position,t.startAt.inclusive):null;return Kw(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}}function wy(t,e){const n=t.filters.concat([e]);return new id(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}function Sy(t,e,n){return new id(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Zf(t,e){return h0($s(t),$s(e))&&t.limitType===e.limitType}function dE(t){return`${d0($s(t))}|lt:${t.limitType}`}function Pl(t){return`Query(target=${(function(n){let r=n.path.canonicalString();return n.collectionGroup!==null&&(r+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(r+=`, filters: [${n.filters.map((i=>lE(i))).join(", ")}]`),Yf(n.limit)||(r+=", limit: "+n.limit),n.orderBy.length>0&&(r+=`, orderBy: [${n.orderBy.map((i=>(function(l){return`${l.field.canonicalString()} (${l.dir})`})(i))).join(", ")}]`),n.startAt&&(r+=", startAt: ",r+=n.startAt.inclusive?"b:":"a:",r+=n.startAt.position.map((i=>Yl(i))).join(",")),n.endAt&&(r+=", endAt: ",r+=n.endAt.inclusive?"a:":"b:",r+=n.endAt.position.map((i=>Yl(i))).join(",")),`Target(${r})`})($s(t))}; limitType=${t.limitType})`}function Jf(t,e){return e.isFoundDocument()&&(function(r,i){const o=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(o):Ge.isDocumentKey(r.path)?r.path.isEqual(o):r.path.isImmediateParentOf(o)})(t,e)&&(function(r,i){for(const o of Iu(r))if(!o.field.isKeyField()&&i.data.field(o.field)===null)return!1;return!0})(t,e)&&(function(r,i){for(const o of r.filters)if(!o.matches(i))return!1;return!0})(t,e)&&(function(r,i){return!(r.startAt&&!(function(l,d,h){const f=Ww(l,d,h);return l.inclusive?f<=0:f<0})(r.startAt,Iu(r),i)||r.endAt&&!(function(l,d,h){const f=Ww(l,d,h);return l.inclusive?f>=0:f>0})(r.endAt,Iu(r),i))})(t,e)}function tO(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function hE(t){return(e,n)=>{let r=!1;for(const i of Iu(t)){const o=nO(i,e,n);if(o!==0)return o;r=r||i.field.isKeyField()}return 0}}function nO(t,e,n){const r=t.field.isKeyField()?Ge.comparator(e.key,n.key):(function(o,l,d){const h=l.data.field(o),f=d.data.field(o);return h!==null&&f!==null?Kl(h,f):Ye(42886)})(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return Ye(19790,{direction:t.dir})}}class Bo{constructor(e,n){this.mapKeyFn=e,this.equalsFn=n,this.inner={},this.innerSize=0}get(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r!==void 0){for(const[i,o]of r)if(this.equalsFn(i,e))return o}}has(e){return this.get(e)!==void 0}set(e,n){const r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,n]],void this.innerSize++;for(let o=0;o<i.length;o++)if(this.equalsFn(i[o][0],e))return void(i[o]=[e,n]);i.push([e,n]),this.innerSize++}delete(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[n]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Ua(this.inner,((n,r)=>{for(const[i,o]of r)e(i,o)}))}isEmpty(){return KC(this.inner)}size(){return this.innerSize}}const rO=new en(Ge.comparator);function Ei(){return rO}const fE=new en(Ge.comparator);function Cu(...t){let e=fE;for(const n of t)e=e.insert(n.key,n);return e}function mE(t){let e=fE;return t.forEach(((n,r)=>e=e.insert(n,r.overlayedDocument))),e}function Co(){return ku()}function pE(){return ku()}function ku(){return new Bo((t=>t.toString()),((t,e)=>t.isEqual(e)))}const sO=new en(Ge.comparator),iO=new An(Ge.comparator);function yt(...t){let e=iO;for(const n of t)e=e.add(n);return e}const aO=new An(gt);function oO(){return aO}function m0(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:vf(e)?"-0":e}}function gE(t){return{integerValue:""+t}}function lO(t,e){return NM(e)?gE(e):m0(t,e)}class em{constructor(){this._=void 0}}function cO(t,e,n){return t instanceof Ef?(function(i,o){const l={fields:{[ZC]:{stringValue:XC},[eE]:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return o&&c0(o)&&(o=Xf(o)),o&&(l.fields[JC]=o),{mapValue:l}})(n,e):t instanceof Xl?_E(t,e):t instanceof Zl?bE(t,e):(function(i,o){const l=yE(i,o),d=Xw(l)+Xw(i.Ae);return by(l)&&by(i.Ae)?gE(d):m0(i.serializer,d)})(t,e)}function uO(t,e,n){return t instanceof Xl?_E(t,e):t instanceof Zl?bE(t,e):n}function yE(t,e){return t instanceof Tf?(function(r){return by(r)||(function(o){return!!o&&"doubleValue"in o})(r)})(e)?e:{integerValue:0}:null}class Ef extends em{}class Xl extends em{constructor(e){super(),this.elements=e}}function _E(t,e){const n=vE(e);for(const r of t.elements)n.some((i=>Qs(i,r)))||n.push(r);return{arrayValue:{values:n}}}class Zl extends em{constructor(e){super(),this.elements=e}}function bE(t,e){let n=vE(e);for(const r of t.elements)n=n.filter((i=>!Qs(i,r)));return{arrayValue:{values:n}}}class Tf extends em{constructor(e,n){super(),this.serializer=e,this.Ae=n}}function Xw(t){return ln(t.integerValue||t.doubleValue)}function vE(t){return u0(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}class xE{constructor(e,n){this.field=e,this.transform=n}}function dO(t,e){return t.field.isEqual(e.field)&&(function(r,i){return r instanceof Xl&&i instanceof Xl||r instanceof Zl&&i instanceof Zl?Ql(r.elements,i.elements,Qs):r instanceof Tf&&i instanceof Tf?Qs(r.Ae,i.Ae):r instanceof Ef&&i instanceof Ef})(t.transform,e.transform)}class hO{constructor(e,n){this.version=e,this.transformResults=n}}class _r{constructor(e,n){this.updateTime=e,this.exists=n}static none(){return new _r}static exists(e){return new _r(void 0,e)}static updateTime(e){return new _r(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function af(t,e){return t.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(t.updateTime):t.exists===void 0||t.exists===e.isFoundDocument()}class tm{}function wE(t,e){if(!t.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return t.isNoDocument()?new nm(t.key,_r.none()):new ad(t.key,t.data,_r.none());{const n=t.data,r=gr.empty();let i=new An($n.comparator);for(let o of e.fields)if(!i.has(o)){let l=n.field(o);l===null&&o.length>1&&(o=o.popLast(),l=n.field(o)),l===null?r.delete(o):r.set(o,l),i=i.add(o)}return new Fa(t.key,r,new Rr(i.toArray()),_r.none())}}function fO(t,e,n){t instanceof ad?(function(i,o,l){const d=i.value.clone(),h=Jw(i.fieldTransforms,o,l.transformResults);d.setAll(h),o.convertToFoundDocument(l.version,d).setHasCommittedMutations()})(t,e,n):t instanceof Fa?(function(i,o,l){if(!af(i.precondition,o))return void o.convertToUnknownDocument(l.version);const d=Jw(i.fieldTransforms,o,l.transformResults),h=o.data;h.setAll(SE(i)),h.setAll(d),o.convertToFoundDocument(l.version,h).setHasCommittedMutations()})(t,e,n):(function(i,o,l){o.convertToNoDocument(l.version).setHasCommittedMutations()})(0,e,n)}function Du(t,e,n,r){return t instanceof ad?(function(o,l,d,h){if(!af(o.precondition,l))return d;const f=o.value.clone(),p=e1(o.fieldTransforms,h,l);return f.setAll(p),l.convertToFoundDocument(l.version,f).setHasLocalMutations(),null})(t,e,n,r):t instanceof Fa?(function(o,l,d,h){if(!af(o.precondition,l))return d;const f=e1(o.fieldTransforms,h,l),p=l.data;return p.setAll(SE(o)),p.setAll(f),l.convertToFoundDocument(l.version,p).setHasLocalMutations(),d===null?null:d.unionWith(o.fieldMask.fields).unionWith(o.fieldTransforms.map((g=>g.field)))})(t,e,n,r):(function(o,l,d){return af(o.precondition,l)?(l.convertToNoDocument(l.version).setHasLocalMutations(),null):d})(t,e,n)}function mO(t,e){let n=null;for(const r of t.fieldTransforms){const i=e.data.field(r.field),o=yE(r.transform,i||null);o!=null&&(n===null&&(n=gr.empty()),n.set(r.field,o))}return n||null}function Zw(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!(function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&Ql(r,i,((o,l)=>dO(o,l)))})(t.fieldTransforms,e.fieldTransforms)&&(t.type===0?t.value.isEqual(e.value):t.type!==1||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class ad extends tm{constructor(e,n,r,i=[]){super(),this.key=e,this.value=n,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class Fa extends tm{constructor(e,n,r,i,o=[]){super(),this.key=e,this.data=n,this.fieldMask=r,this.precondition=i,this.fieldTransforms=o,this.type=1}getFieldMask(){return this.fieldMask}}function SE(t){const e=new Map;return t.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const r=t.data.field(n);e.set(n,r)}})),e}function Jw(t,e,n){const r=new Map;At(t.length===n.length,32656,{Re:n.length,Ve:t.length});for(let i=0;i<n.length;i++){const o=t[i],l=o.transform,d=e.data.field(o.field);r.set(o.field,uO(l,d,n[i]))}return r}function e1(t,e,n){const r=new Map;for(const i of t){const o=i.transform,l=n.data.field(i.field);r.set(i.field,cO(o,l,e))}return r}class nm extends tm{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class pO extends tm{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class gO{constructor(e,n,r,i){this.batchId=e,this.localWriteTime=n,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,n){const r=n.mutationResults;for(let i=0;i<this.mutations.length;i++){const o=this.mutations[i];o.key.isEqual(e.key)&&fO(o,e,r[i])}}applyToLocalView(e,n){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(n=Du(r,e,n,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(n=Du(r,e,n,this.localWriteTime));return n}applyToLocalDocumentSet(e,n){const r=pE();return this.mutations.forEach((i=>{const o=e.get(i.key),l=o.overlayedDocument;let d=this.applyToLocalView(l,o.mutatedFields);d=n.has(i.key)?null:d;const h=wE(l,d);h!==null&&r.set(i.key,h),l.isValidDocument()||l.convertToNoDocument(Ze.min())})),r}keys(){return this.mutations.reduce(((e,n)=>e.add(n.key)),yt())}isEqual(e){return this.batchId===e.batchId&&Ql(this.mutations,e.mutations,((n,r)=>Zw(n,r)))&&Ql(this.baseMutations,e.baseMutations,((n,r)=>Zw(n,r)))}}class p0{constructor(e,n,r,i){this.batch=e,this.commitVersion=n,this.mutationResults=r,this.docVersions=i}static from(e,n,r){At(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let i=(function(){return sO})();const o=e.mutations;for(let l=0;l<o.length;l++)i=i.insert(o[l].key,r[l].version);return new p0(e,n,r,i)}}class yO{constructor(e,n){this.largestBatchId=e,this.mutation=n}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class _O{constructor(e,n){this.count=e,this.unchangedNames=n}}var bn,bt;function bO(t){switch(t){case Re.OK:return Ye(64938);case Re.CANCELLED:case Re.UNKNOWN:case Re.DEADLINE_EXCEEDED:case Re.RESOURCE_EXHAUSTED:case Re.INTERNAL:case Re.UNAVAILABLE:case Re.UNAUTHENTICATED:return!1;case Re.INVALID_ARGUMENT:case Re.NOT_FOUND:case Re.ALREADY_EXISTS:case Re.PERMISSION_DENIED:case Re.FAILED_PRECONDITION:case Re.ABORTED:case Re.OUT_OF_RANGE:case Re.UNIMPLEMENTED:case Re.DATA_LOSS:return!0;default:return Ye(15467,{code:t})}}function CE(t){if(t===void 0)return Ci("GRPC error has no .code"),Re.UNKNOWN;switch(t){case bn.OK:return Re.OK;case bn.CANCELLED:return Re.CANCELLED;case bn.UNKNOWN:return Re.UNKNOWN;case bn.DEADLINE_EXCEEDED:return Re.DEADLINE_EXCEEDED;case bn.RESOURCE_EXHAUSTED:return Re.RESOURCE_EXHAUSTED;case bn.INTERNAL:return Re.INTERNAL;case bn.UNAVAILABLE:return Re.UNAVAILABLE;case bn.UNAUTHENTICATED:return Re.UNAUTHENTICATED;case bn.INVALID_ARGUMENT:return Re.INVALID_ARGUMENT;case bn.NOT_FOUND:return Re.NOT_FOUND;case bn.ALREADY_EXISTS:return Re.ALREADY_EXISTS;case bn.PERMISSION_DENIED:return Re.PERMISSION_DENIED;case bn.FAILED_PRECONDITION:return Re.FAILED_PRECONDITION;case bn.ABORTED:return Re.ABORTED;case bn.OUT_OF_RANGE:return Re.OUT_OF_RANGE;case bn.UNIMPLEMENTED:return Re.UNIMPLEMENTED;case bn.DATA_LOSS:return Re.DATA_LOSS;default:return Ye(39323,{code:t})}}(bt=bn||(bn={}))[bt.OK=0]="OK",bt[bt.CANCELLED=1]="CANCELLED",bt[bt.UNKNOWN=2]="UNKNOWN",bt[bt.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",bt[bt.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",bt[bt.NOT_FOUND=5]="NOT_FOUND",bt[bt.ALREADY_EXISTS=6]="ALREADY_EXISTS",bt[bt.PERMISSION_DENIED=7]="PERMISSION_DENIED",bt[bt.UNAUTHENTICATED=16]="UNAUTHENTICATED",bt[bt.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",bt[bt.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",bt[bt.ABORTED=10]="ABORTED",bt[bt.OUT_OF_RANGE=11]="OUT_OF_RANGE",bt[bt.UNIMPLEMENTED=12]="UNIMPLEMENTED",bt[bt.INTERNAL=13]="INTERNAL",bt[bt.UNAVAILABLE=14]="UNAVAILABLE",bt[bt.DATA_LOSS=15]="DATA_LOSS";function vO(){return new TextEncoder}const xO=new Ea([4294967295,4294967295],0);function t1(t){const e=vO().encode(t),n=new zC;return n.update(e),new Uint8Array(n.digest())}function n1(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),o=e.getUint32(12,!0);return[new Ea([n,r],0),new Ea([i,o],0)]}class g0{constructor(e,n,r){if(this.bitmap=e,this.padding=n,this.hashCount=r,n<0||n>=8)throw new Eu(`Invalid padding: ${n}`);if(r<0)throw new Eu(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Eu(`Invalid hash count: ${r}`);if(e.length===0&&n!==0)throw new Eu(`Invalid padding when bitmap length is 0: ${n}`);this.ge=8*e.length-n,this.pe=Ea.fromNumber(this.ge)}ye(e,n,r){let i=e.add(n.multiply(Ea.fromNumber(r)));return i.compare(xO)===1&&(i=new Ea([i.getBits(0),i.getBits(1)],0)),i.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const n=t1(e),[r,i]=n1(n);for(let o=0;o<this.hashCount;o++){const l=this.ye(r,i,o);if(!this.we(l))return!1}return!0}static create(e,n,r){const i=e%8==0?0:8-e%8,o=new Uint8Array(Math.ceil(e/8)),l=new g0(o,i,n);return r.forEach((d=>l.insert(d))),l}insert(e){if(this.ge===0)return;const n=t1(e),[r,i]=n1(n);for(let o=0;o<this.hashCount;o++){const l=this.ye(r,i,o);this.Se(l)}}Se(e){const n=Math.floor(e/8),r=e%8;this.bitmap[n]|=1<<r}}class Eu extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class rm{constructor(e,n,r,i,o){this.snapshotVersion=e,this.targetChanges=n,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=o}static createSynthesizedRemoteEventForCurrentChange(e,n,r){const i=new Map;return i.set(e,od.createSynthesizedTargetChangeForCurrentChange(e,n,r)),new rm(Ze.min(),i,new en(gt),Ei(),yt())}}class od{constructor(e,n,r,i,o){this.resumeToken=e,this.current=n,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=o}static createSynthesizedTargetChangeForCurrentChange(e,n,r){return new od(r,n,yt(),yt(),yt())}}class of{constructor(e,n,r,i){this.be=e,this.removedTargetIds=n,this.key=r,this.De=i}}class EE{constructor(e,n){this.targetId=e,this.Ce=n}}class TE{constructor(e,n,r=Gn.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=n,this.resumeToken=r,this.cause=i}}class r1{constructor(){this.ve=0,this.Fe=s1(),this.Me=Gn.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=yt(),n=yt(),r=yt();return this.Fe.forEach(((i,o)=>{switch(o){case 0:e=e.add(i);break;case 2:n=n.add(i);break;case 1:r=r.add(i);break;default:Ye(38017,{changeType:o})}})),new od(this.Me,this.xe,e,n,r)}qe(){this.Oe=!1,this.Fe=s1()}Qe(e,n){this.Oe=!0,this.Fe=this.Fe.insert(e,n)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,At(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class wO{constructor(e){this.Ge=e,this.ze=new Map,this.je=Ei(),this.Je=Gh(),this.He=Gh(),this.Ye=new en(gt)}Ze(e){for(const n of e.be)e.De&&e.De.isFoundDocument()?this.Xe(n,e.De):this.et(n,e.key,e.De);for(const n of e.removedTargetIds)this.et(n,e.key,e.De)}tt(e){this.forEachTarget(e,(n=>{const r=this.nt(n);switch(e.state){case 0:this.rt(n)&&r.Le(e.resumeToken);break;case 1:r.Ke(),r.Ne||r.qe(),r.Le(e.resumeToken);break;case 2:r.Ke(),r.Ne||this.removeTarget(n);break;case 3:this.rt(n)&&(r.We(),r.Le(e.resumeToken));break;case 4:this.rt(n)&&(this.it(n),r.Le(e.resumeToken));break;default:Ye(56790,{state:e.state})}}))}forEachTarget(e,n){e.targetIds.length>0?e.targetIds.forEach(n):this.ze.forEach(((r,i)=>{this.rt(i)&&n(i)}))}st(e){const n=e.targetId,r=e.Ce.count,i=this.ot(n);if(i){const o=i.target;if(xy(o))if(r===0){const l=new Ge(o.path);this.et(n,l,Jn.newNoDocument(l,Ze.min()))}else At(r===1,20013,{expectedCount:r});else{const l=this._t(n);if(l!==r){const d=this.ut(e),h=d?this.ct(d,e,l):1;if(h!==0){this.it(n);const f=h===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(n,f)}}}}}ut(e){const n=e.Ce.unchangedNames;if(!n||!n.bits)return null;const{bits:{bitmap:r="",padding:i=0},hashCount:o=0}=n;let l,d;try{l=Ra(r).toUint8Array()}catch(h){if(h instanceof YC)return Wl("Decoding the base64 bloom filter in existence filter failed ("+h.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw h}try{d=new g0(l,i,o)}catch(h){return Wl(h instanceof Eu?"BloomFilter error: ":"Applying bloom filter failed: ",h),null}return d.ge===0?null:d}ct(e,n,r){return n.Ce.count===r-this.Pt(e,n.targetId)?0:2}Pt(e,n){const r=this.Ge.getRemoteKeysForTarget(n);let i=0;return r.forEach((o=>{const l=this.Ge.ht(),d=`projects/${l.projectId}/databases/${l.database}/documents/${o.path.canonicalString()}`;e.mightContain(d)||(this.et(n,o,null),i++)})),i}Tt(e){const n=new Map;this.ze.forEach(((o,l)=>{const d=this.ot(l);if(d){if(o.current&&xy(d.target)){const h=new Ge(d.target.path);this.It(h).has(l)||this.Et(l,h)||this.et(l,h,Jn.newNoDocument(h,e))}o.Be&&(n.set(l,o.ke()),o.qe())}}));let r=yt();this.He.forEach(((o,l)=>{let d=!0;l.forEachWhile((h=>{const f=this.ot(h);return!f||f.purpose==="TargetPurposeLimboResolution"||(d=!1,!1)})),d&&(r=r.add(o))})),this.je.forEach(((o,l)=>l.setReadTime(e)));const i=new rm(e,n,this.Ye,this.je,r);return this.je=Ei(),this.Je=Gh(),this.He=Gh(),this.Ye=new en(gt),i}Xe(e,n){if(!this.rt(e))return;const r=this.Et(e,n.key)?2:0;this.nt(e).Qe(n.key,r),this.je=this.je.insert(n.key,n),this.Je=this.Je.insert(n.key,this.It(n.key).add(e)),this.He=this.He.insert(n.key,this.dt(n.key).add(e))}et(e,n,r){if(!this.rt(e))return;const i=this.nt(e);this.Et(e,n)?i.Qe(n,1):i.$e(n),this.He=this.He.insert(n,this.dt(n).delete(e)),this.He=this.He.insert(n,this.dt(n).add(e)),r&&(this.je=this.je.insert(n,r))}removeTarget(e){this.ze.delete(e)}_t(e){const n=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+n.addedDocuments.size-n.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let n=this.ze.get(e);return n||(n=new r1,this.ze.set(e,n)),n}dt(e){let n=this.He.get(e);return n||(n=new An(gt),this.He=this.He.insert(e,n)),n}It(e){let n=this.Je.get(e);return n||(n=new An(gt),this.Je=this.Je.insert(e,n)),n}rt(e){const n=this.ot(e)!==null;return n||Ue("WatchChangeAggregator","Detected inactive target",e),n}ot(e){const n=this.ze.get(e);return n&&n.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new r1),this.Ge.getRemoteKeysForTarget(e).forEach((n=>{this.et(e,n,null)}))}Et(e,n){return this.Ge.getRemoteKeysForTarget(e).has(n)}}function Gh(){return new en(Ge.comparator)}function s1(){return new en(Ge.comparator)}const SO={asc:"ASCENDING",desc:"DESCENDING"},CO={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},EO={and:"AND",or:"OR"};class TO{constructor(e,n){this.databaseId=e,this.useProto3Json=n}}function Cy(t,e){return t.useProto3Json||Yf(e)?e:{value:e}}function Af(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function AE(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function AO(t,e){return Af(t,e.toTimestamp())}function qs(t){return At(!!t,49232),Ze.fromTimestamp((function(n){const r=ja(n);return new Wt(r.seconds,r.nanos)})(t))}function y0(t,e){return Ey(t,e).canonicalString()}function Ey(t,e){const n=(function(i){return new Ft(["projects",i.projectId,"databases",i.database])})(t).child("documents");return e===void 0?n:n.child(e)}function jE(t){const e=Ft.fromString(t);return At(ME(e),10190,{key:e.toString()}),e}function Ty(t,e){return y0(t.databaseId,e.path)}function Vg(t,e){const n=jE(e);if(n.get(1)!==t.databaseId.projectId)throw new Le(Re.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new Le(Re.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new Ge(IE(n))}function RE(t,e){return y0(t.databaseId,e)}function jO(t){const e=jE(t);return e.length===4?Ft.emptyPath():IE(e)}function Ay(t){return new Ft(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function IE(t){return At(t.length>4&&t.get(4)==="documents",29091,{key:t.toString()}),t.popFirst(5)}function i1(t,e,n){return{name:Ty(t,e),fields:n.value.mapValue.fields}}function RO(t,e){let n;if("targetChange"in e){e.targetChange;const r=(function(f){return f==="NO_CHANGE"?0:f==="ADD"?1:f==="REMOVE"?2:f==="CURRENT"?3:f==="RESET"?4:Ye(39313,{state:f})})(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],o=(function(f,p){return f.useProto3Json?(At(p===void 0||typeof p=="string",58123),Gn.fromBase64String(p||"")):(At(p===void 0||p instanceof Buffer||p instanceof Uint8Array,16193),Gn.fromUint8Array(p||new Uint8Array))})(t,e.targetChange.resumeToken),l=e.targetChange.cause,d=l&&(function(f){const p=f.code===void 0?Re.UNKNOWN:CE(f.code);return new Le(p,f.message||"")})(l);n=new TE(r,i,o,d||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const i=Vg(t,r.document.name),o=qs(r.document.updateTime),l=r.document.createTime?qs(r.document.createTime):Ze.min(),d=new gr({mapValue:{fields:r.document.fields}}),h=Jn.newFoundDocument(i,o,l,d),f=r.targetIds||[],p=r.removedTargetIds||[];n=new of(f,p,h.key,h)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const i=Vg(t,r.document),o=r.readTime?qs(r.readTime):Ze.min(),l=Jn.newNoDocument(i,o),d=r.removedTargetIds||[];n=new of([],d,l.key,l)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const i=Vg(t,r.document),o=r.removedTargetIds||[];n=new of([],o,i,null)}else{if(!("filter"in e))return Ye(11601,{Rt:e});{e.filter;const r=e.filter;r.targetId;const{count:i=0,unchangedNames:o}=r,l=new _O(i,o),d=r.targetId;n=new EE(d,l)}}return n}function IO(t,e){let n;if(e instanceof ad)n={update:i1(t,e.key,e.value)};else if(e instanceof nm)n={delete:Ty(t,e.key)};else if(e instanceof Fa)n={update:i1(t,e.key,e.data),updateMask:LO(e.fieldMask)};else{if(!(e instanceof pO))return Ye(16599,{Vt:e.type});n={verify:Ty(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map((r=>(function(o,l){const d=l.transform;if(d instanceof Ef)return{fieldPath:l.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(d instanceof Xl)return{fieldPath:l.field.canonicalString(),appendMissingElements:{values:d.elements}};if(d instanceof Zl)return{fieldPath:l.field.canonicalString(),removeAllFromArray:{values:d.elements}};if(d instanceof Tf)return{fieldPath:l.field.canonicalString(),increment:d.Ae};throw Ye(20930,{transform:l.transform})})(0,r)))),e.precondition.isNone||(n.currentDocument=(function(i,o){return o.updateTime!==void 0?{updateTime:AO(i,o.updateTime)}:o.exists!==void 0?{exists:o.exists}:Ye(27497)})(t,e.precondition)),n}function kO(t,e){return t&&t.length>0?(At(e!==void 0,14353),t.map((n=>(function(i,o){let l=i.updateTime?qs(i.updateTime):qs(o);return l.isEqual(Ze.min())&&(l=qs(o)),new hO(l,i.transformResults||[])})(n,e)))):[]}function DO(t,e){return{documents:[RE(t,e.path)]}}function MO(t,e){const n={structuredQuery:{}},r=e.path;let i;e.collectionGroup!==null?(i=r,n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=RE(t,i);const o=(function(f){if(f.length!==0)return DE(ps.create(f,"and"))})(e.filters);o&&(n.structuredQuery.where=o);const l=(function(f){if(f.length!==0)return f.map((p=>(function(v){return{field:Bl(v.field),direction:PO(v.dir)}})(p)))})(e.orderBy);l&&(n.structuredQuery.orderBy=l);const d=Cy(t,e.limit);return d!==null&&(n.structuredQuery.limit=d),e.startAt&&(n.structuredQuery.startAt=(function(f){return{before:f.inclusive,values:f.position}})(e.startAt)),e.endAt&&(n.structuredQuery.endAt=(function(f){return{before:!f.inclusive,values:f.position}})(e.endAt)),{ft:n,parent:i}}function OO(t){let e=jO(t.parent);const n=t.structuredQuery,r=n.from?n.from.length:0;let i=null;if(r>0){At(r===1,65062);const p=n.from[0];p.allDescendants?i=p.collectionId:e=e.child(p.collectionId)}let o=[];n.where&&(o=(function(g){const v=kE(g);return v instanceof ps&&aE(v)?v.getFilters():[v]})(n.where));let l=[];n.orderBy&&(l=(function(g){return g.map((v=>(function(C){return new Cf(zl(C.field),(function(w){switch(w){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(C.direction))})(v)))})(n.orderBy));let d=null;n.limit&&(d=(function(g){let v;return v=typeof g=="object"?g.value:g,Yf(v)?null:v})(n.limit));let h=null;n.startAt&&(h=(function(g){const v=!!g.before,_=g.values||[];return new Sf(_,v)})(n.startAt));let f=null;return n.endAt&&(f=(function(g){const v=!g.before,_=g.values||[];return new Sf(_,v)})(n.endAt)),JM(e,i,l,o,d,"F",h,f)}function NO(t,e){const n=(function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Ye(28987,{purpose:i})}})(e.purpose);return n==null?null:{"goog-listen-tags":n}}function kE(t){return t.unaryFilter!==void 0?(function(n){switch(n.unaryFilter.op){case"IS_NAN":const r=zl(n.unaryFilter.field);return vn.create(r,"==",{doubleValue:NaN});case"IS_NULL":const i=zl(n.unaryFilter.field);return vn.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const o=zl(n.unaryFilter.field);return vn.create(o,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const l=zl(n.unaryFilter.field);return vn.create(l,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return Ye(61313);default:return Ye(60726)}})(t):t.fieldFilter!==void 0?(function(n){return vn.create(zl(n.fieldFilter.field),(function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return Ye(58110);default:return Ye(50506)}})(n.fieldFilter.op),n.fieldFilter.value)})(t):t.compositeFilter!==void 0?(function(n){return ps.create(n.compositeFilter.filters.map((r=>kE(r))),(function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return Ye(1026)}})(n.compositeFilter.op))})(t):Ye(30097,{filter:t})}function PO(t){return SO[t]}function BO(t){return CO[t]}function zO(t){return EO[t]}function Bl(t){return{fieldPath:t.canonicalString()}}function zl(t){return $n.fromServerFormat(t.fieldPath)}function DE(t){return t instanceof vn?(function(n){if(n.op==="=="){if(Gw(n.value))return{unaryFilter:{field:Bl(n.field),op:"IS_NAN"}};if(Hw(n.value))return{unaryFilter:{field:Bl(n.field),op:"IS_NULL"}}}else if(n.op==="!="){if(Gw(n.value))return{unaryFilter:{field:Bl(n.field),op:"IS_NOT_NAN"}};if(Hw(n.value))return{unaryFilter:{field:Bl(n.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Bl(n.field),op:BO(n.op),value:n.value}}})(t):t instanceof ps?(function(n){const r=n.getFilters().map((i=>DE(i)));return r.length===1?r[0]:{compositeFilter:{op:zO(n.op),filters:r}}})(t):Ye(54877,{filter:t})}function LO(t){const e=[];return t.fields.forEach((n=>e.push(n.canonicalString()))),{fieldPaths:e}}function ME(t){return t.length>=4&&t.get(0)==="projects"&&t.get(2)==="databases"}class ga{constructor(e,n,r,i,o=Ze.min(),l=Ze.min(),d=Gn.EMPTY_BYTE_STRING,h=null){this.target=e,this.targetId=n,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=o,this.lastLimboFreeSnapshotVersion=l,this.resumeToken=d,this.expectedCount=h}withSequenceNumber(e){return new ga(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,n){return new ga(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new ga(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new ga(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class UO{constructor(e){this.yt=e}}function FO(t){const e=OO({parent:t.parent,structuredQuery:t.structuredQuery});return t.limitType==="LAST"?Sy(e,e.limit,"L"):e}class VO{constructor(){this.Cn=new $O}addToCollectionParentIndex(e,n){return this.Cn.add(n),ke.resolve()}getCollectionParents(e,n){return ke.resolve(this.Cn.getEntries(n))}addFieldIndex(e,n){return ke.resolve()}deleteFieldIndex(e,n){return ke.resolve()}deleteAllFieldIndexes(e){return ke.resolve()}createTargetIndexes(e,n){return ke.resolve()}getDocumentsMatchingTarget(e,n){return ke.resolve(null)}getIndexType(e,n){return ke.resolve(0)}getFieldIndexes(e,n){return ke.resolve([])}getNextCollectionGroupToUpdate(e){return ke.resolve(null)}getMinOffset(e,n){return ke.resolve(Aa.min())}getMinOffsetFromCollectionGroup(e,n){return ke.resolve(Aa.min())}updateCollectionGroup(e,n,r){return ke.resolve()}updateIndexEntries(e,n){return ke.resolve()}}class $O{constructor(){this.index={}}add(e){const n=e.lastSegment(),r=e.popLast(),i=this.index[n]||new An(Ft.comparator),o=!i.has(r);return this.index[n]=i.add(r),o}has(e){const n=e.lastSegment(),r=e.popLast(),i=this.index[n];return i&&i.has(r)}getEntries(e){return(this.index[e]||new An(Ft.comparator)).toArray()}}const a1={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},OE=41943040;class pr{static withCacheSize(e){return new pr(e,pr.DEFAULT_COLLECTION_PERCENTILE,pr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,n,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=n,this.maximumSequenceNumbersToCollect=r}}pr.DEFAULT_COLLECTION_PERCENTILE=10,pr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,pr.DEFAULT=new pr(OE,pr.DEFAULT_COLLECTION_PERCENTILE,pr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),pr.DISABLED=new pr(-1,0,0);class Jl{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new Jl(0)}static cr(){return new Jl(-1)}}const o1="LruGarbageCollector",qO=1048576;function l1([t,e],[n,r]){const i=gt(t,n);return i===0?gt(e,r):i}class HO{constructor(e){this.Ir=e,this.buffer=new An(l1),this.Er=0}dr(){return++this.Er}Ar(e){const n=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(n);else{const r=this.buffer.last();l1(n,r)<0&&(this.buffer=this.buffer.delete(r).add(n))}}get maxValue(){return this.buffer.last()[0]}}class GO{constructor(e,n,r){this.garbageCollector=e,this.asyncQueue=n,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){Ue(o1,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(n){hc(n)?Ue(o1,"Ignoring IndexedDB error during garbage collection: ",n):await dc(n)}await this.Vr(3e5)}))}}class WO{constructor(e,n){this.mr=e,this.params=n}calculateTargetCount(e,n){return this.mr.gr(e).next((r=>Math.floor(n/100*r)))}nthSequenceNumber(e,n){if(n===0)return ke.resolve(Kf.ce);const r=new HO(n);return this.mr.forEachTarget(e,(i=>r.Ar(i.sequenceNumber))).next((()=>this.mr.pr(e,(i=>r.Ar(i))))).next((()=>r.maxValue))}removeTargets(e,n,r){return this.mr.removeTargets(e,n,r)}removeOrphanedDocuments(e,n){return this.mr.removeOrphanedDocuments(e,n)}collect(e,n){return this.params.cacheSizeCollectionThreshold===-1?(Ue("LruGarbageCollector","Garbage collection skipped; disabled"),ke.resolve(a1)):this.getCacheSize(e).next((r=>r<this.params.cacheSizeCollectionThreshold?(Ue("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),a1):this.yr(e,n)))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,n){let r,i,o,l,d,h,f;const p=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((g=>(g>this.params.maximumSequenceNumbersToCollect?(Ue("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${g}`),i=this.params.maximumSequenceNumbersToCollect):i=g,l=Date.now(),this.nthSequenceNumber(e,i)))).next((g=>(r=g,d=Date.now(),this.removeTargets(e,r,n)))).next((g=>(o=g,h=Date.now(),this.removeOrphanedDocuments(e,r)))).next((g=>(f=Date.now(),Nl()<=pt.DEBUG&&Ue("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${l-p}ms
	Determined least recently used ${i} in `+(d-l)+`ms
	Removed ${o} targets in `+(h-d)+`ms
	Removed ${g} documents in `+(f-h)+`ms
Total Duration: ${f-p}ms`),ke.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:o,documentsRemoved:g}))))}}function QO(t,e){return new WO(t,e)}class KO{constructor(){this.changes=new Bo((e=>e.toString()),((e,n)=>e.isEqual(n))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,n){this.assertNotApplied(),this.changes.set(e,Jn.newInvalidDocument(e).setReadTime(n))}getEntry(e,n){this.assertNotApplied();const r=this.changes.get(n);return r!==void 0?ke.resolve(r):this.getFromCache(e,n)}getEntries(e,n){return this.getAllFromCache(e,n)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class YO{constructor(e,n){this.overlayedDocument=e,this.mutatedFields=n}}class XO{constructor(e,n,r,i){this.remoteDocumentCache=e,this.mutationQueue=n,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,n){let r=null;return this.documentOverlayCache.getOverlay(e,n).next((i=>(r=i,this.remoteDocumentCache.getEntry(e,n)))).next((i=>(r!==null&&Du(r.mutation,i,Rr.empty(),Wt.now()),i)))}getDocuments(e,n){return this.remoteDocumentCache.getEntries(e,n).next((r=>this.getLocalViewOfDocuments(e,r,yt()).next((()=>r))))}getLocalViewOfDocuments(e,n,r=yt()){const i=Co();return this.populateOverlays(e,i,n).next((()=>this.computeViews(e,n,i,r).next((o=>{let l=Cu();return o.forEach(((d,h)=>{l=l.insert(d,h.overlayedDocument)})),l}))))}getOverlayedDocuments(e,n){const r=Co();return this.populateOverlays(e,r,n).next((()=>this.computeViews(e,n,r,yt())))}populateOverlays(e,n,r){const i=[];return r.forEach((o=>{n.has(o)||i.push(o)})),this.documentOverlayCache.getOverlays(e,i).next((o=>{o.forEach(((l,d)=>{n.set(l,d)}))}))}computeViews(e,n,r,i){let o=Ei();const l=ku(),d=(function(){return ku()})();return n.forEach(((h,f)=>{const p=r.get(f.key);i.has(f.key)&&(p===void 0||p.mutation instanceof Fa)?o=o.insert(f.key,f):p!==void 0?(l.set(f.key,p.mutation.getFieldMask()),Du(p.mutation,f,p.mutation.getFieldMask(),Wt.now())):l.set(f.key,Rr.empty())})),this.recalculateAndSaveOverlays(e,o).next((h=>(h.forEach(((f,p)=>l.set(f,p))),n.forEach(((f,p)=>d.set(f,new YO(p,l.get(f)??null)))),d)))}recalculateAndSaveOverlays(e,n){const r=ku();let i=new en(((l,d)=>l-d)),o=yt();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,n).next((l=>{for(const d of l)d.keys().forEach((h=>{const f=n.get(h);if(f===null)return;let p=r.get(h)||Rr.empty();p=d.applyToLocalView(f,p),r.set(h,p);const g=(i.get(d.batchId)||yt()).add(h);i=i.insert(d.batchId,g)}))})).next((()=>{const l=[],d=i.getReverseIterator();for(;d.hasNext();){const h=d.getNext(),f=h.key,p=h.value,g=pE();p.forEach((v=>{if(!o.has(v)){const _=wE(n.get(v),r.get(v));_!==null&&g.set(v,_),o=o.add(v)}})),l.push(this.documentOverlayCache.saveOverlays(e,f,g))}return ke.waitFor(l)})).next((()=>r))}recalculateAndSaveOverlaysForDocumentKeys(e,n){return this.remoteDocumentCache.getEntries(e,n).next((r=>this.recalculateAndSaveOverlays(e,r)))}getDocumentsMatchingQuery(e,n,r,i){return(function(l){return Ge.isDocumentKey(l.path)&&l.collectionGroup===null&&l.filters.length===0})(n)?this.getDocumentsMatchingDocumentQuery(e,n.path):uE(n)?this.getDocumentsMatchingCollectionGroupQuery(e,n,r,i):this.getDocumentsMatchingCollectionQuery(e,n,r,i)}getNextDocuments(e,n,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,n,r,i).next((o=>{const l=i-o.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,n,r.largestBatchId,i-o.size):ke.resolve(Co());let d=zu,h=o;return l.next((f=>ke.forEach(f,((p,g)=>(d<g.largestBatchId&&(d=g.largestBatchId),o.get(p)?ke.resolve():this.remoteDocumentCache.getEntry(e,p).next((v=>{h=h.insert(p,v)}))))).next((()=>this.populateOverlays(e,f,o))).next((()=>this.computeViews(e,h,f,yt()))).next((p=>({batchId:d,changes:mE(p)})))))}))}getDocumentsMatchingDocumentQuery(e,n){return this.getDocument(e,new Ge(n)).next((r=>{let i=Cu();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i}))}getDocumentsMatchingCollectionGroupQuery(e,n,r,i){const o=n.collectionGroup;let l=Cu();return this.indexManager.getCollectionParents(e,o).next((d=>ke.forEach(d,(h=>{const f=(function(g,v){return new id(v,null,g.explicitOrderBy.slice(),g.filters.slice(),g.limit,g.limitType,g.startAt,g.endAt)})(n,h.child(o));return this.getDocumentsMatchingCollectionQuery(e,f,r,i).next((p=>{p.forEach(((g,v)=>{l=l.insert(g,v)}))}))})).next((()=>l))))}getDocumentsMatchingCollectionQuery(e,n,r,i){let o;return this.documentOverlayCache.getOverlaysForCollection(e,n.path,r.largestBatchId).next((l=>(o=l,this.remoteDocumentCache.getDocumentsMatchingQuery(e,n,r,o,i)))).next((l=>{o.forEach(((h,f)=>{const p=f.getKey();l.get(p)===null&&(l=l.insert(p,Jn.newInvalidDocument(p)))}));let d=Cu();return l.forEach(((h,f)=>{const p=o.get(h);p!==void 0&&Du(p.mutation,f,Rr.empty(),Wt.now()),Jf(n,f)&&(d=d.insert(h,f))})),d}))}}class ZO{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,n){return ke.resolve(this.Lr.get(n))}saveBundleMetadata(e,n){return this.Lr.set(n.id,(function(i){return{id:i.id,version:i.version,createTime:qs(i.createTime)}})(n)),ke.resolve()}getNamedQuery(e,n){return ke.resolve(this.kr.get(n))}saveNamedQuery(e,n){return this.kr.set(n.name,(function(i){return{name:i.name,query:FO(i.bundledQuery),readTime:qs(i.readTime)}})(n)),ke.resolve()}}class JO{constructor(){this.overlays=new en(Ge.comparator),this.qr=new Map}getOverlay(e,n){return ke.resolve(this.overlays.get(n))}getOverlays(e,n){const r=Co();return ke.forEach(n,(i=>this.getOverlay(e,i).next((o=>{o!==null&&r.set(i,o)})))).next((()=>r))}saveOverlays(e,n,r){return r.forEach(((i,o)=>{this.St(e,n,o)})),ke.resolve()}removeOverlaysForBatchId(e,n,r){const i=this.qr.get(r);return i!==void 0&&(i.forEach((o=>this.overlays=this.overlays.remove(o))),this.qr.delete(r)),ke.resolve()}getOverlaysForCollection(e,n,r){const i=Co(),o=n.length+1,l=new Ge(n.child("")),d=this.overlays.getIteratorFrom(l);for(;d.hasNext();){const h=d.getNext().value,f=h.getKey();if(!n.isPrefixOf(f.path))break;f.path.length===o&&h.largestBatchId>r&&i.set(h.getKey(),h)}return ke.resolve(i)}getOverlaysForCollectionGroup(e,n,r,i){let o=new en(((f,p)=>f-p));const l=this.overlays.getIterator();for(;l.hasNext();){const f=l.getNext().value;if(f.getKey().getCollectionGroup()===n&&f.largestBatchId>r){let p=o.get(f.largestBatchId);p===null&&(p=Co(),o=o.insert(f.largestBatchId,p)),p.set(f.getKey(),f)}}const d=Co(),h=o.getIterator();for(;h.hasNext()&&(h.getNext().value.forEach(((f,p)=>d.set(f,p))),!(d.size()>=i)););return ke.resolve(d)}St(e,n,r){const i=this.overlays.get(r.key);if(i!==null){const l=this.qr.get(i.largestBatchId).delete(r.key);this.qr.set(i.largestBatchId,l)}this.overlays=this.overlays.insert(r.key,new yO(n,r));let o=this.qr.get(n);o===void 0&&(o=yt(),this.qr.set(n,o)),this.qr.set(n,o.add(r.key))}}class eN{constructor(){this.sessionToken=Gn.EMPTY_BYTE_STRING}getSessionToken(e){return ke.resolve(this.sessionToken)}setSessionToken(e,n){return this.sessionToken=n,ke.resolve()}}class _0{constructor(){this.Qr=new An(Mn.$r),this.Ur=new An(Mn.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,n){const r=new Mn(e,n);this.Qr=this.Qr.add(r),this.Ur=this.Ur.add(r)}Wr(e,n){e.forEach((r=>this.addReference(r,n)))}removeReference(e,n){this.Gr(new Mn(e,n))}zr(e,n){e.forEach((r=>this.removeReference(r,n)))}jr(e){const n=new Ge(new Ft([])),r=new Mn(n,e),i=new Mn(n,e+1),o=[];return this.Ur.forEachInRange([r,i],(l=>{this.Gr(l),o.push(l.key)})),o}Jr(){this.Qr.forEach((e=>this.Gr(e)))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const n=new Ge(new Ft([])),r=new Mn(n,e),i=new Mn(n,e+1);let o=yt();return this.Ur.forEachInRange([r,i],(l=>{o=o.add(l.key)})),o}containsKey(e){const n=new Mn(e,0),r=this.Qr.firstAfterOrEqual(n);return r!==null&&e.isEqual(r.key)}}class Mn{constructor(e,n){this.key=e,this.Yr=n}static $r(e,n){return Ge.comparator(e.key,n.key)||gt(e.Yr,n.Yr)}static Kr(e,n){return gt(e.Yr,n.Yr)||Ge.comparator(e.key,n.key)}}class tN{constructor(e,n){this.indexManager=e,this.referenceDelegate=n,this.mutationQueue=[],this.tr=1,this.Zr=new An(Mn.$r)}checkEmpty(e){return ke.resolve(this.mutationQueue.length===0)}addMutationBatch(e,n,r,i){const o=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const l=new gO(o,n,r,i);this.mutationQueue.push(l);for(const d of i)this.Zr=this.Zr.add(new Mn(d.key,o)),this.indexManager.addToCollectionParentIndex(e,d.key.path.popLast());return ke.resolve(l)}lookupMutationBatch(e,n){return ke.resolve(this.Xr(n))}getNextMutationBatchAfterBatchId(e,n){const r=n+1,i=this.ei(r),o=i<0?0:i;return ke.resolve(this.mutationQueue.length>o?this.mutationQueue[o]:null)}getHighestUnacknowledgedBatchId(){return ke.resolve(this.mutationQueue.length===0?l0:this.tr-1)}getAllMutationBatches(e){return ke.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,n){const r=new Mn(n,0),i=new Mn(n,Number.POSITIVE_INFINITY),o=[];return this.Zr.forEachInRange([r,i],(l=>{const d=this.Xr(l.Yr);o.push(d)})),ke.resolve(o)}getAllMutationBatchesAffectingDocumentKeys(e,n){let r=new An(gt);return n.forEach((i=>{const o=new Mn(i,0),l=new Mn(i,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([o,l],(d=>{r=r.add(d.Yr)}))})),ke.resolve(this.ti(r))}getAllMutationBatchesAffectingQuery(e,n){const r=n.path,i=r.length+1;let o=r;Ge.isDocumentKey(o)||(o=o.child(""));const l=new Mn(new Ge(o),0);let d=new An(gt);return this.Zr.forEachWhile((h=>{const f=h.key.path;return!!r.isPrefixOf(f)&&(f.length===i&&(d=d.add(h.Yr)),!0)}),l),ke.resolve(this.ti(d))}ti(e){const n=[];return e.forEach((r=>{const i=this.Xr(r);i!==null&&n.push(i)})),n}removeMutationBatch(e,n){At(this.ni(n.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Zr;return ke.forEach(n.mutations,(i=>{const o=new Mn(i.key,n.batchId);return r=r.delete(o),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)})).next((()=>{this.Zr=r}))}ir(e){}containsKey(e,n){const r=new Mn(n,0),i=this.Zr.firstAfterOrEqual(r);return ke.resolve(n.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,ke.resolve()}ni(e,n){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const n=this.ei(e);return n<0||n>=this.mutationQueue.length?null:this.mutationQueue[n]}}class nN{constructor(e){this.ri=e,this.docs=(function(){return new en(Ge.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,n){const r=n.key,i=this.docs.get(r),o=i?i.size:0,l=this.ri(n);return this.docs=this.docs.insert(r,{document:n.mutableCopy(),size:l}),this.size+=l-o,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const n=this.docs.get(e);n&&(this.docs=this.docs.remove(e),this.size-=n.size)}getEntry(e,n){const r=this.docs.get(n);return ke.resolve(r?r.document.mutableCopy():Jn.newInvalidDocument(n))}getEntries(e,n){let r=Ei();return n.forEach((i=>{const o=this.docs.get(i);r=r.insert(i,o?o.document.mutableCopy():Jn.newInvalidDocument(i))})),ke.resolve(r)}getDocumentsMatchingQuery(e,n,r,i){let o=Ei();const l=n.path,d=new Ge(l.child("__id-9223372036854775808__")),h=this.docs.getIteratorFrom(d);for(;h.hasNext();){const{key:f,value:{document:p}}=h.getNext();if(!l.isPrefixOf(f.path))break;f.path.length>l.length+1||kM(IM(p),r)<=0||(i.has(p.key)||Jf(n,p))&&(o=o.insert(p.key,p.mutableCopy()))}return ke.resolve(o)}getAllFromCollectionGroup(e,n,r,i){Ye(9500)}ii(e,n){return ke.forEach(this.docs,(r=>n(r)))}newChangeBuffer(e){return new rN(this)}getSize(e){return ke.resolve(this.size)}}class rN extends KO{constructor(e){super(),this.Nr=e}applyChanges(e){const n=[];return this.changes.forEach(((r,i)=>{i.isValidDocument()?n.push(this.Nr.addEntry(e,i)):this.Nr.removeEntry(r)})),ke.waitFor(n)}getFromCache(e,n){return this.Nr.getEntry(e,n)}getAllFromCache(e,n){return this.Nr.getEntries(e,n)}}class sN{constructor(e){this.persistence=e,this.si=new Bo((n=>d0(n)),h0),this.lastRemoteSnapshotVersion=Ze.min(),this.highestTargetId=0,this.oi=0,this._i=new _0,this.targetCount=0,this.ai=Jl.ur()}forEachTarget(e,n){return this.si.forEach(((r,i)=>n(i))),ke.resolve()}getLastRemoteSnapshotVersion(e){return ke.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return ke.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),ke.resolve(this.highestTargetId)}setTargetsMetadata(e,n,r){return r&&(this.lastRemoteSnapshotVersion=r),n>this.oi&&(this.oi=n),ke.resolve()}Pr(e){this.si.set(e.target,e);const n=e.targetId;n>this.highestTargetId&&(this.ai=new Jl(n),this.highestTargetId=n),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,n){return this.Pr(n),this.targetCount+=1,ke.resolve()}updateTargetData(e,n){return this.Pr(n),ke.resolve()}removeTargetData(e,n){return this.si.delete(n.target),this._i.jr(n.targetId),this.targetCount-=1,ke.resolve()}removeTargets(e,n,r){let i=0;const o=[];return this.si.forEach(((l,d)=>{d.sequenceNumber<=n&&r.get(d.targetId)===null&&(this.si.delete(l),o.push(this.removeMatchingKeysForTargetId(e,d.targetId)),i++)})),ke.waitFor(o).next((()=>i))}getTargetCount(e){return ke.resolve(this.targetCount)}getTargetData(e,n){const r=this.si.get(n)||null;return ke.resolve(r)}addMatchingKeys(e,n,r){return this._i.Wr(n,r),ke.resolve()}removeMatchingKeys(e,n,r){this._i.zr(n,r);const i=this.persistence.referenceDelegate,o=[];return i&&n.forEach((l=>{o.push(i.markPotentiallyOrphaned(e,l))})),ke.waitFor(o)}removeMatchingKeysForTargetId(e,n){return this._i.jr(n),ke.resolve()}getMatchingKeysForTargetId(e,n){const r=this._i.Hr(n);return ke.resolve(r)}containsKey(e,n){return ke.resolve(this._i.containsKey(n))}}class NE{constructor(e,n){this.ui={},this.overlays={},this.ci=new Kf(0),this.li=!1,this.li=!0,this.hi=new eN,this.referenceDelegate=e(this),this.Pi=new sN(this),this.indexManager=new VO,this.remoteDocumentCache=(function(i){return new nN(i)})((r=>this.referenceDelegate.Ti(r))),this.serializer=new UO(n),this.Ii=new ZO(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let n=this.overlays[e.toKey()];return n||(n=new JO,this.overlays[e.toKey()]=n),n}getMutationQueue(e,n){let r=this.ui[e.toKey()];return r||(r=new tN(n,this.referenceDelegate),this.ui[e.toKey()]=r),r}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,n,r){Ue("MemoryPersistence","Starting transaction:",e);const i=new iN(this.ci.next());return this.referenceDelegate.Ei(),r(i).next((o=>this.referenceDelegate.di(i).next((()=>o)))).toPromise().then((o=>(i.raiseOnCommittedEvent(),o)))}Ai(e,n){return ke.or(Object.values(this.ui).map((r=>()=>r.containsKey(e,n))))}}class iN extends MM{constructor(e){super(),this.currentSequenceNumber=e}}class b0{constructor(e){this.persistence=e,this.Ri=new _0,this.Vi=null}static mi(e){return new b0(e)}get fi(){if(this.Vi)return this.Vi;throw Ye(60996)}addReference(e,n,r){return this.Ri.addReference(r,n),this.fi.delete(r.toString()),ke.resolve()}removeReference(e,n,r){return this.Ri.removeReference(r,n),this.fi.add(r.toString()),ke.resolve()}markPotentiallyOrphaned(e,n){return this.fi.add(n.toString()),ke.resolve()}removeTarget(e,n){this.Ri.jr(n.targetId).forEach((i=>this.fi.add(i.toString())));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,n.targetId).next((i=>{i.forEach((o=>this.fi.add(o.toString())))})).next((()=>r.removeTargetData(e,n)))}Ei(){this.Vi=new Set}di(e){const n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return ke.forEach(this.fi,(r=>{const i=Ge.fromPath(r);return this.gi(e,i).next((o=>{o||n.removeEntry(i,Ze.min())}))})).next((()=>(this.Vi=null,n.apply(e))))}updateLimboDocument(e,n){return this.gi(e,n).next((r=>{r?this.fi.delete(n.toString()):this.fi.add(n.toString())}))}Ti(e){return 0}gi(e,n){return ke.or([()=>ke.resolve(this.Ri.containsKey(n)),()=>this.persistence.getTargetCache().containsKey(e,n),()=>this.persistence.Ai(e,n)])}}class jf{constructor(e,n){this.persistence=e,this.pi=new Bo((r=>PM(r.path)),((r,i)=>r.isEqual(i))),this.garbageCollector=QO(this,n)}static mi(e,n){return new jf(e,n)}Ei(){}di(e){return ke.resolve()}forEachTarget(e,n){return this.persistence.getTargetCache().forEachTarget(e,n)}gr(e){const n=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next((r=>n.next((i=>r+i))))}wr(e){let n=0;return this.pr(e,(r=>{n++})).next((()=>n))}pr(e,n){return ke.forEach(this.pi,((r,i)=>this.br(e,r,i).next((o=>o?ke.resolve():n(i)))))}removeTargets(e,n,r){return this.persistence.getTargetCache().removeTargets(e,n,r)}removeOrphanedDocuments(e,n){let r=0;const i=this.persistence.getRemoteDocumentCache(),o=i.newChangeBuffer();return i.ii(e,(l=>this.br(e,l,n).next((d=>{d||(r++,o.removeEntry(l,Ze.min()))})))).next((()=>o.apply(e))).next((()=>r))}markPotentiallyOrphaned(e,n){return this.pi.set(n,e.currentSequenceNumber),ke.resolve()}removeTarget(e,n){const r=n.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,n,r){return this.pi.set(r,e.currentSequenceNumber),ke.resolve()}removeReference(e,n,r){return this.pi.set(r,e.currentSequenceNumber),ke.resolve()}updateLimboDocument(e,n){return this.pi.set(n,e.currentSequenceNumber),ke.resolve()}Ti(e){let n=e.key.toString().length;return e.isFoundDocument()&&(n+=rf(e.data.value)),n}br(e,n,r){return ke.or([()=>this.persistence.Ai(e,n),()=>this.persistence.getTargetCache().containsKey(e,n),()=>{const i=this.pi.get(n);return ke.resolve(i!==void 0&&i>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class v0{constructor(e,n,r,i){this.targetId=e,this.fromCache=n,this.Es=r,this.ds=i}static As(e,n){let r=yt(),i=yt();for(const o of n.docChanges)switch(o.type){case 0:r=r.add(o.doc.key);break;case 1:i=i.add(o.doc.key)}return new v0(e,n.fromCache,r,i)}}class aN{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class oN{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(function(){return NR()?8:OM(er())>0?6:4})()}initialize(e,n){this.ps=e,this.indexManager=n,this.Rs=!0}getDocumentsMatchingQuery(e,n,r,i){const o={result:null};return this.ys(e,n).next((l=>{o.result=l})).next((()=>{if(!o.result)return this.ws(e,n,i,r).next((l=>{o.result=l}))})).next((()=>{if(o.result)return;const l=new aN;return this.Ss(e,n,l).next((d=>{if(o.result=d,this.Vs)return this.bs(e,n,l,d.size)}))})).next((()=>o.result))}bs(e,n,r,i){return r.documentReadCount<this.fs?(Nl()<=pt.DEBUG&&Ue("QueryEngine","SDK will not create cache indexes for query:",Pl(n),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),ke.resolve()):(Nl()<=pt.DEBUG&&Ue("QueryEngine","Query:",Pl(n),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.gs*i?(Nl()<=pt.DEBUG&&Ue("QueryEngine","The SDK decides to create cache indexes for query:",Pl(n),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,$s(n))):ke.resolve())}ys(e,n){if(Yw(n))return ke.resolve(null);let r=$s(n);return this.indexManager.getIndexType(e,r).next((i=>i===0?null:(n.limit!==null&&i===1&&(n=Sy(n,null,"F"),r=$s(n)),this.indexManager.getDocumentsMatchingTarget(e,r).next((o=>{const l=yt(...o);return this.ps.getDocuments(e,l).next((d=>this.indexManager.getMinOffset(e,r).next((h=>{const f=this.Ds(n,d);return this.Cs(n,f,l,h.readTime)?this.ys(e,Sy(n,null,"F")):this.vs(e,f,n,h)}))))})))))}ws(e,n,r,i){return Yw(n)||i.isEqual(Ze.min())?ke.resolve(null):this.ps.getDocuments(e,r).next((o=>{const l=this.Ds(n,o);return this.Cs(n,l,r,i)?ke.resolve(null):(Nl()<=pt.DEBUG&&Ue("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Pl(n)),this.vs(e,l,n,RM(i,zu)).next((d=>d)))}))}Ds(e,n){let r=new An(hE(e));return n.forEach(((i,o)=>{Jf(e,o)&&(r=r.add(o))})),r}Cs(e,n,r,i){if(e.limit===null)return!1;if(r.size!==n.size)return!0;const o=e.limitType==="F"?n.last():n.first();return!!o&&(o.hasPendingWrites||o.version.compareTo(i)>0)}Ss(e,n,r){return Nl()<=pt.DEBUG&&Ue("QueryEngine","Using full collection scan to execute query:",Pl(n)),this.ps.getDocumentsMatchingQuery(e,n,Aa.min(),r)}vs(e,n,r,i){return this.ps.getDocumentsMatchingQuery(e,r,i).next((o=>(n.forEach((l=>{o=o.insert(l.key,l)})),o)))}}const x0="LocalStore",lN=3e8;class cN{constructor(e,n,r,i){this.persistence=e,this.Fs=n,this.serializer=i,this.Ms=new en(gt),this.xs=new Bo((o=>d0(o)),h0),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(r)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new XO(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(n=>e.collect(n,this.Ms)))}}function uN(t,e,n,r){return new cN(t,e,n,r)}async function PE(t,e){const n=nt(t);return await n.persistence.runTransaction("Handle user change","readonly",(r=>{let i;return n.mutationQueue.getAllMutationBatches(r).next((o=>(i=o,n.Bs(e),n.mutationQueue.getAllMutationBatches(r)))).next((o=>{const l=[],d=[];let h=yt();for(const f of i){l.push(f.batchId);for(const p of f.mutations)h=h.add(p.key)}for(const f of o){d.push(f.batchId);for(const p of f.mutations)h=h.add(p.key)}return n.localDocuments.getDocuments(r,h).next((f=>({Ls:f,removedBatchIds:l,addedBatchIds:d})))}))}))}function dN(t,e){const n=nt(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(r=>{const i=e.batch.keys(),o=n.Ns.newChangeBuffer({trackRemovals:!0});return(function(d,h,f,p){const g=f.batch,v=g.keys();let _=ke.resolve();return v.forEach((C=>{_=_.next((()=>p.getEntry(h,C))).next((x=>{const w=f.docVersions.get(C);At(w!==null,48541),x.version.compareTo(w)<0&&(g.applyToRemoteDocument(x,f),x.isValidDocument()&&(x.setReadTime(f.commitVersion),p.addEntry(x)))}))})),_.next((()=>d.mutationQueue.removeMutationBatch(h,g)))})(n,r,e,o).next((()=>o.apply(r))).next((()=>n.mutationQueue.performConsistencyCheck(r))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,(function(d){let h=yt();for(let f=0;f<d.mutationResults.length;++f)d.mutationResults[f].transformResults.length>0&&(h=h.add(d.batch.mutations[f].key));return h})(e)))).next((()=>n.localDocuments.getDocuments(r,i)))}))}function BE(t){const e=nt(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(n=>e.Pi.getLastRemoteSnapshotVersion(n)))}function hN(t,e){const n=nt(t),r=e.snapshotVersion;let i=n.Ms;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(o=>{const l=n.Ns.newChangeBuffer({trackRemovals:!0});i=n.Ms;const d=[];e.targetChanges.forEach(((p,g)=>{const v=i.get(g);if(!v)return;d.push(n.Pi.removeMatchingKeys(o,p.removedDocuments,g).next((()=>n.Pi.addMatchingKeys(o,p.addedDocuments,g))));let _=v.withSequenceNumber(o.currentSequenceNumber);e.targetMismatches.get(g)!==null?_=_.withResumeToken(Gn.EMPTY_BYTE_STRING,Ze.min()).withLastLimboFreeSnapshotVersion(Ze.min()):p.resumeToken.approximateByteSize()>0&&(_=_.withResumeToken(p.resumeToken,r)),i=i.insert(g,_),(function(x,w,E){return x.resumeToken.approximateByteSize()===0||w.snapshotVersion.toMicroseconds()-x.snapshotVersion.toMicroseconds()>=lN?!0:E.addedDocuments.size+E.modifiedDocuments.size+E.removedDocuments.size>0})(v,_,p)&&d.push(n.Pi.updateTargetData(o,_))}));let h=Ei(),f=yt();if(e.documentUpdates.forEach((p=>{e.resolvedLimboDocuments.has(p)&&d.push(n.persistence.referenceDelegate.updateLimboDocument(o,p))})),d.push(fN(o,l,e.documentUpdates).next((p=>{h=p.ks,f=p.qs}))),!r.isEqual(Ze.min())){const p=n.Pi.getLastRemoteSnapshotVersion(o).next((g=>n.Pi.setTargetsMetadata(o,o.currentSequenceNumber,r)));d.push(p)}return ke.waitFor(d).next((()=>l.apply(o))).next((()=>n.localDocuments.getLocalViewOfDocuments(o,h,f))).next((()=>h))})).then((o=>(n.Ms=i,o)))}function fN(t,e,n){let r=yt(),i=yt();return n.forEach((o=>r=r.add(o))),e.getEntries(t,r).next((o=>{let l=Ei();return n.forEach(((d,h)=>{const f=o.get(d);h.isFoundDocument()!==f.isFoundDocument()&&(i=i.add(d)),h.isNoDocument()&&h.version.isEqual(Ze.min())?(e.removeEntry(d,h.readTime),l=l.insert(d,h)):!f.isValidDocument()||h.version.compareTo(f.version)>0||h.version.compareTo(f.version)===0&&f.hasPendingWrites?(e.addEntry(h),l=l.insert(d,h)):Ue(x0,"Ignoring outdated watch update for ",d,". Current version:",f.version," Watch version:",h.version)})),{ks:l,qs:i}}))}function mN(t,e){const n=nt(t);return n.persistence.runTransaction("Get next mutation batch","readonly",(r=>(e===void 0&&(e=l0),n.mutationQueue.getNextMutationBatchAfterBatchId(r,e))))}function pN(t,e){const n=nt(t);return n.persistence.runTransaction("Allocate target","readwrite",(r=>{let i;return n.Pi.getTargetData(r,e).next((o=>o?(i=o,ke.resolve(i)):n.Pi.allocateTargetId(r).next((l=>(i=new ga(e,l,"TargetPurposeListen",r.currentSequenceNumber),n.Pi.addTargetData(r,i).next((()=>i)))))))})).then((r=>{const i=n.Ms.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(n.Ms=n.Ms.insert(r.targetId,r),n.xs.set(e,r.targetId)),r}))}async function jy(t,e,n){const r=nt(t),i=r.Ms.get(e),o=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",o,(l=>r.persistence.referenceDelegate.removeTarget(l,i)))}catch(l){if(!hc(l))throw l;Ue(x0,`Failed to update sequence numbers for target ${e}: ${l}`)}r.Ms=r.Ms.remove(e),r.xs.delete(i.target)}function c1(t,e,n){const r=nt(t);let i=Ze.min(),o=yt();return r.persistence.runTransaction("Execute query","readwrite",(l=>(function(h,f,p){const g=nt(h),v=g.xs.get(p);return v!==void 0?ke.resolve(g.Ms.get(v)):g.Pi.getTargetData(f,p)})(r,l,$s(e)).next((d=>{if(d)return i=d.lastLimboFreeSnapshotVersion,r.Pi.getMatchingKeysForTargetId(l,d.targetId).next((h=>{o=h}))})).next((()=>r.Fs.getDocumentsMatchingQuery(l,e,n?i:Ze.min(),n?o:yt()))).next((d=>(gN(r,tO(e),d),{documents:d,Qs:o})))))}function gN(t,e,n){let r=t.Os.get(e)||Ze.min();n.forEach(((i,o)=>{o.readTime.compareTo(r)>0&&(r=o.readTime)})),t.Os.set(e,r)}class u1{constructor(){this.activeTargetIds=oO()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class yN{constructor(){this.Mo=new u1,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,n,r){}addLocalQueryTarget(e,n=!0){return n&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,n,r){this.xo[e]=n}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new u1,Promise.resolve()}handleUserChange(e,n,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class _N{Oo(e){}shutdown(){}}const d1="ConnectivityMonitor";class h1{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){Ue(d1,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){Ue(d1,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}let Wh=null;function Ry(){return Wh===null?Wh=(function(){return 268435456+Math.round(2147483648*Math.random())})():Wh++,"0x"+Wh.toString(16)}const $g="RestConnection",bN={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class vN{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const n=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Uo=n+"://"+e.host,this.Ko=`projects/${r}/databases/${i}`,this.Wo=this.databaseId.database===xf?`project_id=${r}`:`project_id=${r}&database_id=${i}`}Go(e,n,r,i,o){const l=Ry(),d=this.zo(e,n.toUriEncodedString());Ue($g,`Sending RPC '${e}' ${l}:`,d,r);const h={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(h,i,o);const{host:f}=new URL(d),p=ac(f);return this.Jo(e,d,h,r,p).then((g=>(Ue($g,`Received RPC '${e}' ${l}: `,g),g)),(g=>{throw Wl($g,`RPC '${e}' ${l} failed with error: `,g,"url: ",d,"request:",r),g}))}Ho(e,n,r,i,o,l){return this.Go(e,n,r,i,o)}jo(e,n,r){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+uc})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach(((i,o)=>e[o]=i)),r&&r.headers.forEach(((i,o)=>e[o]=i))}zo(e,n){const r=bN[e];return`${this.Uo}/v1/${n}:${r}`}terminate(){}}class xN{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}const Xn="WebChannelConnection";class wN extends vN{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,n,r,i,o){const l=Ry();return new Promise(((d,h)=>{const f=new LC;f.setWithCredentials(!0),f.listenOnce(UC.COMPLETE,(()=>{try{switch(f.getLastErrorCode()){case nf.NO_ERROR:const g=f.getResponseJson();Ue(Xn,`XHR for RPC '${e}' ${l} received:`,JSON.stringify(g)),d(g);break;case nf.TIMEOUT:Ue(Xn,`RPC '${e}' ${l} timed out`),h(new Le(Re.DEADLINE_EXCEEDED,"Request time out"));break;case nf.HTTP_ERROR:const v=f.getStatus();if(Ue(Xn,`RPC '${e}' ${l} failed with status:`,v,"response text:",f.getResponseText()),v>0){let _=f.getResponseJson();Array.isArray(_)&&(_=_[0]);const C=_?.error;if(C&&C.status&&C.message){const x=(function(E){const T=E.toLowerCase().replace(/_/g,"-");return Object.values(Re).indexOf(T)>=0?T:Re.UNKNOWN})(C.status);h(new Le(x,C.message))}else h(new Le(Re.UNKNOWN,"Server responded with status "+f.getStatus()))}else h(new Le(Re.UNAVAILABLE,"Connection failed."));break;default:Ye(9055,{l_:e,streamId:l,h_:f.getLastErrorCode(),P_:f.getLastError()})}}finally{Ue(Xn,`RPC '${e}' ${l} completed.`)}}));const p=JSON.stringify(i);Ue(Xn,`RPC '${e}' ${l} sending request:`,i),f.send(n,"POST",p,r,15)}))}T_(e,n,r){const i=Ry(),o=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],l=$C(),d=VC(),h={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},f=this.longPollingOptions.timeoutSeconds;f!==void 0&&(h.longPollingTimeout=Math.round(1e3*f)),this.useFetchStreams&&(h.useFetchStreams=!0),this.jo(h.initMessageHeaders,n,r),h.encodeInitMessageHeaders=!0;const p=o.join("");Ue(Xn,`Creating RPC '${e}' stream ${i}: ${p}`,h);const g=l.createWebChannel(p,h);this.I_(g);let v=!1,_=!1;const C=new xN({Yo:w=>{_?Ue(Xn,`Not sending because RPC '${e}' stream ${i} is closed:`,w):(v||(Ue(Xn,`Opening RPC '${e}' stream ${i} transport.`),g.open(),v=!0),Ue(Xn,`RPC '${e}' stream ${i} sending:`,w),g.send(w))},Zo:()=>g.close()}),x=(w,E,T)=>{w.listen(E,(R=>{try{T(R)}catch(M){setTimeout((()=>{throw M}),0)}}))};return x(g,Su.EventType.OPEN,(()=>{_||(Ue(Xn,`RPC '${e}' stream ${i} transport opened.`),C.o_())})),x(g,Su.EventType.CLOSE,(()=>{_||(_=!0,Ue(Xn,`RPC '${e}' stream ${i} transport closed`),C.a_(),this.E_(g))})),x(g,Su.EventType.ERROR,(w=>{_||(_=!0,Wl(Xn,`RPC '${e}' stream ${i} transport errored. Name:`,w.name,"Message:",w.message),C.a_(new Le(Re.UNAVAILABLE,"The operation could not be completed")))})),x(g,Su.EventType.MESSAGE,(w=>{if(!_){const E=w.data[0];At(!!E,16349);const T=E,R=T?.error||T[0]?.error;if(R){Ue(Xn,`RPC '${e}' stream ${i} received error:`,R);const M=R.status;let V=(function(D){const P=bn[D];if(P!==void 0)return CE(P)})(M),$=R.message;V===void 0&&(V=Re.INTERNAL,$="Unknown error status: "+M+" with message "+R.message),_=!0,C.a_(new Le(V,$)),g.close()}else Ue(Xn,`RPC '${e}' stream ${i} received:`,E),C.u_(E)}})),x(d,FC.STAT_EVENT,(w=>{w.stat===gy.PROXY?Ue(Xn,`RPC '${e}' stream ${i} detected buffering proxy`):w.stat===gy.NOPROXY&&Ue(Xn,`RPC '${e}' stream ${i} detected no buffering proxy`)})),setTimeout((()=>{C.__()}),0),C}terminate(){this.c_.forEach((e=>e.close())),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter((n=>n===e))}}function qg(){return typeof document<"u"?document:null}function sm(t){return new TO(t,!0)}class zE{constructor(e,n,r=1e3,i=1.5,o=6e4){this.Mi=e,this.timerId=n,this.d_=r,this.A_=i,this.R_=o,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const n=Math.floor(this.V_+this.y_()),r=Math.max(0,Date.now()-this.f_),i=Math.max(0,n-r);i>0&&Ue("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.V_} ms, delay with jitter: ${n} ms, last attempt: ${r} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,i,(()=>(this.f_=Date.now(),e()))),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}const f1="PersistentStream";class LE{constructor(e,n,r,i,o,l,d,h){this.Mi=e,this.S_=r,this.b_=i,this.connection=o,this.authCredentialsProvider=l,this.appCheckCredentialsProvider=d,this.listener=h,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new zE(e,n)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,(()=>this.k_())))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,n){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():n&&n.code===Re.RESOURCE_EXHAUSTED?(Ci(n.toString()),Ci("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):n&&n.code===Re.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(n)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),n=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([r,i])=>{this.D_===n&&this.G_(r,i)}),(r=>{e((()=>{const i=new Le(Re.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(i)}))}))}G_(e,n){const r=this.W_(this.D_);this.stream=this.j_(e,n),this.stream.Xo((()=>{r((()=>this.listener.Xo()))})),this.stream.t_((()=>{r((()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.t_())))})),this.stream.r_((i=>{r((()=>this.z_(i)))})),this.stream.onMessage((i=>{r((()=>++this.F_==1?this.J_(i):this.onNext(i)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(e){return Ue(f1,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return n=>{this.Mi.enqueueAndForget((()=>this.D_===e?n():(Ue(f1,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class SN extends LE{constructor(e,n,r,i,o,l){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",n,r,i,l),this.serializer=o}j_(e,n){return this.connection.T_("Listen",e,n)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const n=RO(this.serializer,e),r=(function(o){if(!("targetChange"in o))return Ze.min();const l=o.targetChange;return l.targetIds&&l.targetIds.length?Ze.min():l.readTime?qs(l.readTime):Ze.min()})(e);return this.listener.H_(n,r)}Y_(e){const n={};n.database=Ay(this.serializer),n.addTarget=(function(o,l){let d;const h=l.target;if(d=xy(h)?{documents:DO(o,h)}:{query:MO(o,h).ft},d.targetId=l.targetId,l.resumeToken.approximateByteSize()>0){d.resumeToken=AE(o,l.resumeToken);const f=Cy(o,l.expectedCount);f!==null&&(d.expectedCount=f)}else if(l.snapshotVersion.compareTo(Ze.min())>0){d.readTime=Af(o,l.snapshotVersion.toTimestamp());const f=Cy(o,l.expectedCount);f!==null&&(d.expectedCount=f)}return d})(this.serializer,e);const r=NO(this.serializer,e);r&&(n.labels=r),this.q_(n)}Z_(e){const n={};n.database=Ay(this.serializer),n.removeTarget=e,this.q_(n)}}class CN extends LE{constructor(e,n,r,i,o,l){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",n,r,i,l),this.serializer=o}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,n){return this.connection.T_("Write",e,n)}J_(e){return At(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,At(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){At(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const n=kO(e.writeResults,e.commitTime),r=qs(e.commitTime);return this.listener.na(r,n)}ra(){const e={};e.database=Ay(this.serializer),this.q_(e)}ea(e){const n={streamToken:this.lastStreamToken,writes:e.map((r=>IO(this.serializer,r)))};this.q_(n)}}class EN{}class TN extends EN{constructor(e,n,r,i){super(),this.authCredentials=e,this.appCheckCredentials=n,this.connection=r,this.serializer=i,this.ia=!1}sa(){if(this.ia)throw new Le(Re.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,n,r,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([o,l])=>this.connection.Go(e,Ey(n,r),i,o,l))).catch((o=>{throw o.name==="FirebaseError"?(o.code===Re.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new Le(Re.UNKNOWN,o.toString())}))}Ho(e,n,r,i,o){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([l,d])=>this.connection.Ho(e,Ey(n,r),i,l,d,o))).catch((l=>{throw l.name==="FirebaseError"?(l.code===Re.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),l):new Le(Re.UNKNOWN,l.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}class AN{constructor(e,n){this.asyncQueue=e,this.onlineStateHandler=n,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const n=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(Ci(n),this.aa=!1):Ue("OnlineStateTracker",n)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}const Oo="RemoteStore";class jN{constructor(e,n,r,i,o){this.localStore=e,this.datastore=n,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=o,this.Aa.Oo((l=>{r.enqueueAndForget((async()=>{zo(this)&&(Ue(Oo,"Restarting streams for network reachability change."),await(async function(h){const f=nt(h);f.Ea.add(4),await ld(f),f.Ra.set("Unknown"),f.Ea.delete(4),await im(f)})(this))}))})),this.Ra=new AN(r,i)}}async function im(t){if(zo(t))for(const e of t.da)await e(!0)}async function ld(t){for(const e of t.da)await e(!1)}function UE(t,e){const n=nt(t);n.Ia.has(e.targetId)||(n.Ia.set(e.targetId,e),E0(n)?C0(n):fc(n).O_()&&S0(n,e))}function w0(t,e){const n=nt(t),r=fc(n);n.Ia.delete(e),r.O_()&&FE(n,e),n.Ia.size===0&&(r.O_()?r.L_():zo(n)&&n.Ra.set("Unknown"))}function S0(t,e){if(t.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Ze.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}fc(t).Y_(e)}function FE(t,e){t.Va.Ue(e),fc(t).Z_(e)}function C0(t){t.Va=new wO({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),At:e=>t.Ia.get(e)||null,ht:()=>t.datastore.serializer.databaseId}),fc(t).start(),t.Ra.ua()}function E0(t){return zo(t)&&!fc(t).x_()&&t.Ia.size>0}function zo(t){return nt(t).Ea.size===0}function VE(t){t.Va=void 0}async function RN(t){t.Ra.set("Online")}async function IN(t){t.Ia.forEach(((e,n)=>{S0(t,e)}))}async function kN(t,e){VE(t),E0(t)?(t.Ra.ha(e),C0(t)):t.Ra.set("Unknown")}async function DN(t,e,n){if(t.Ra.set("Online"),e instanceof TE&&e.state===2&&e.cause)try{await(async function(i,o){const l=o.cause;for(const d of o.targetIds)i.Ia.has(d)&&(await i.remoteSyncer.rejectListen(d,l),i.Ia.delete(d),i.Va.removeTarget(d))})(t,e)}catch(r){Ue(Oo,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await Rf(t,r)}else if(e instanceof of?t.Va.Ze(e):e instanceof EE?t.Va.st(e):t.Va.tt(e),!n.isEqual(Ze.min()))try{const r=await BE(t.localStore);n.compareTo(r)>=0&&await(function(o,l){const d=o.Va.Tt(l);return d.targetChanges.forEach(((h,f)=>{if(h.resumeToken.approximateByteSize()>0){const p=o.Ia.get(f);p&&o.Ia.set(f,p.withResumeToken(h.resumeToken,l))}})),d.targetMismatches.forEach(((h,f)=>{const p=o.Ia.get(h);if(!p)return;o.Ia.set(h,p.withResumeToken(Gn.EMPTY_BYTE_STRING,p.snapshotVersion)),FE(o,h);const g=new ga(p.target,h,f,p.sequenceNumber);S0(o,g)})),o.remoteSyncer.applyRemoteEvent(d)})(t,n)}catch(r){Ue(Oo,"Failed to raise snapshot:",r),await Rf(t,r)}}async function Rf(t,e,n){if(!hc(e))throw e;t.Ea.add(1),await ld(t),t.Ra.set("Offline"),n||(n=()=>BE(t.localStore)),t.asyncQueue.enqueueRetryable((async()=>{Ue(Oo,"Retrying IndexedDB access"),await n(),t.Ea.delete(1),await im(t)}))}function $E(t,e){return e().catch((n=>Rf(t,n,e)))}async function am(t){const e=nt(t),n=ka(e);let r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:l0;for(;MN(e);)try{const i=await mN(e.localStore,r);if(i===null){e.Ta.length===0&&n.L_();break}r=i.batchId,ON(e,i)}catch(i){await Rf(e,i)}qE(e)&&HE(e)}function MN(t){return zo(t)&&t.Ta.length<10}function ON(t,e){t.Ta.push(e);const n=ka(t);n.O_()&&n.X_&&n.ea(e.mutations)}function qE(t){return zo(t)&&!ka(t).x_()&&t.Ta.length>0}function HE(t){ka(t).start()}async function NN(t){ka(t).ra()}async function PN(t){const e=ka(t);for(const n of t.Ta)e.ea(n.mutations)}async function BN(t,e,n){const r=t.Ta.shift(),i=p0.from(r,e,n);await $E(t,(()=>t.remoteSyncer.applySuccessfulWrite(i))),await am(t)}async function zN(t,e){e&&ka(t).X_&&await(async function(r,i){if((function(l){return bO(l)&&l!==Re.ABORTED})(i.code)){const o=r.Ta.shift();ka(r).B_(),await $E(r,(()=>r.remoteSyncer.rejectFailedWrite(o.batchId,i))),await am(r)}})(t,e),qE(t)&&HE(t)}async function m1(t,e){const n=nt(t);n.asyncQueue.verifyOperationInProgress(),Ue(Oo,"RemoteStore received new credentials");const r=zo(n);n.Ea.add(3),await ld(n),r&&n.Ra.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.Ea.delete(3),await im(n)}async function LN(t,e){const n=nt(t);e?(n.Ea.delete(2),await im(n)):e||(n.Ea.add(2),await ld(n),n.Ra.set("Unknown"))}function fc(t){return t.ma||(t.ma=(function(n,r,i){const o=nt(n);return o.sa(),new SN(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,i)})(t.datastore,t.asyncQueue,{Xo:RN.bind(null,t),t_:IN.bind(null,t),r_:kN.bind(null,t),H_:DN.bind(null,t)}),t.da.push((async e=>{e?(t.ma.B_(),E0(t)?C0(t):t.Ra.set("Unknown")):(await t.ma.stop(),VE(t))}))),t.ma}function ka(t){return t.fa||(t.fa=(function(n,r,i){const o=nt(n);return o.sa(),new CN(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,i)})(t.datastore,t.asyncQueue,{Xo:()=>Promise.resolve(),t_:NN.bind(null,t),r_:zN.bind(null,t),ta:PN.bind(null,t),na:BN.bind(null,t)}),t.da.push((async e=>{e?(t.fa.B_(),await am(t)):(await t.fa.stop(),t.Ta.length>0&&(Ue(Oo,`Stopping write stream with ${t.Ta.length} pending writes`),t.Ta=[]))}))),t.fa}class T0{constructor(e,n,r,i,o){this.asyncQueue=e,this.timerId=n,this.targetTimeMs=r,this.op=i,this.removalCallback=o,this.deferred=new bi,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((l=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,n,r,i,o){const l=Date.now()+r,d=new T0(e,n,l,i,o);return d.start(r),d}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Le(Re.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function A0(t,e){if(Ci("AsyncQueue",`${e}: ${t}`),hc(t))return new Le(Re.UNAVAILABLE,`${e}: ${t}`);throw t}class $l{static emptySet(e){return new $l(e.comparator)}constructor(e){this.comparator=e?(n,r)=>e(n,r)||Ge.comparator(n.key,r.key):(n,r)=>Ge.comparator(n.key,r.key),this.keyedMap=Cu(),this.sortedSet=new en(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const n=this.keyedMap.get(e);return n?this.sortedSet.indexOf(n):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((n,r)=>(e(n),!1)))}add(e){const n=this.delete(e.key);return n.copy(n.keyedMap.insert(e.key,e),n.sortedSet.insert(e,null))}delete(e){const n=this.get(e);return n?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(n)):this}isEqual(e){if(!(e instanceof $l)||this.size!==e.size)return!1;const n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;n.hasNext();){const i=n.getNext().key,o=r.getNext().key;if(!i.isEqual(o))return!1}return!0}toString(){const e=[];return this.forEach((n=>{e.push(n.toString())})),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,n){const r=new $l;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r}}class p1{constructor(){this.ga=new en(Ge.comparator)}track(e){const n=e.doc.key,r=this.ga.get(n);r?e.type!==0&&r.type===3?this.ga=this.ga.insert(n,e):e.type===3&&r.type!==1?this.ga=this.ga.insert(n,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.ga=this.ga.insert(n,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.ga=this.ga.insert(n,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.ga=this.ga.remove(n):e.type===1&&r.type===2?this.ga=this.ga.insert(n,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.ga=this.ga.insert(n,{type:2,doc:e.doc}):Ye(63341,{Rt:e,pa:r}):this.ga=this.ga.insert(n,e)}ya(){const e=[];return this.ga.inorderTraversal(((n,r)=>{e.push(r)})),e}}class ec{constructor(e,n,r,i,o,l,d,h,f){this.query=e,this.docs=n,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=o,this.fromCache=l,this.syncStateChanged=d,this.excludesMetadataChanges=h,this.hasCachedResults=f}static fromInitialDocuments(e,n,r,i,o){const l=[];return n.forEach((d=>{l.push({type:0,doc:d})})),new ec(e,n,$l.emptySet(n),l,r,i,!0,!1,o)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Zf(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const n=this.docChanges,r=e.docChanges;if(n.length!==r.length)return!1;for(let i=0;i<n.length;i++)if(n[i].type!==r[i].type||!n[i].doc.isEqual(r[i].doc))return!1;return!0}}class UN{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some((e=>e.Da()))}}class FN{constructor(){this.queries=g1(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(n,r){const i=nt(n),o=i.queries;i.queries=g1(),o.forEach(((l,d)=>{for(const h of d.Sa)h.onError(r)}))})(this,new Le(Re.ABORTED,"Firestore shutting down"))}}function g1(){return new Bo((t=>dE(t)),Zf)}async function GE(t,e){const n=nt(t);let r=3;const i=e.query;let o=n.queries.get(i);o?!o.ba()&&e.Da()&&(r=2):(o=new UN,r=e.Da()?0:1);try{switch(r){case 0:o.wa=await n.onListen(i,!0);break;case 1:o.wa=await n.onListen(i,!1);break;case 2:await n.onFirstRemoteStoreListen(i)}}catch(l){const d=A0(l,`Initialization of query '${Pl(e.query)}' failed`);return void e.onError(d)}n.queries.set(i,o),o.Sa.push(e),e.va(n.onlineState),o.wa&&e.Fa(o.wa)&&j0(n)}async function WE(t,e){const n=nt(t),r=e.query;let i=3;const o=n.queries.get(r);if(o){const l=o.Sa.indexOf(e);l>=0&&(o.Sa.splice(l,1),o.Sa.length===0?i=e.Da()?0:1:!o.ba()&&e.Da()&&(i=2))}switch(i){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}}function VN(t,e){const n=nt(t);let r=!1;for(const i of e){const o=i.query,l=n.queries.get(o);if(l){for(const d of l.Sa)d.Fa(i)&&(r=!0);l.wa=i}}r&&j0(n)}function $N(t,e,n){const r=nt(t),i=r.queries.get(e);if(i)for(const o of i.Sa)o.onError(n);r.queries.delete(e)}function j0(t){t.Ca.forEach((e=>{e.next()}))}var Iy,y1;(y1=Iy||(Iy={})).Ma="default",y1.Cache="cache";class QE{constructor(e,n,r){this.query=e,this.xa=n,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){const r=[];for(const i of e.docChanges)i.type!==3&&r.push(i);e=new ec(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let n=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),n=!0):this.La(e,this.onlineState)&&(this.ka(e),n=!0),this.Na=e,n}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let n=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),n=!0),n}La(e,n){if(!e.fromCache||!this.Da())return!0;const r=n!=="Offline";return(!this.options.qa||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||n==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const n=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!n)&&this.options.includeMetadataChanges===!0}ka(e){e=ec.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==Iy.Cache}}class KE{constructor(e){this.key=e}}class YE{constructor(e){this.key=e}}class qN{constructor(e,n){this.query=e,this.Ya=n,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=yt(),this.mutatedKeys=yt(),this.eu=hE(e),this.tu=new $l(this.eu)}get nu(){return this.Ya}ru(e,n){const r=n?n.iu:new p1,i=n?n.tu:this.tu;let o=n?n.mutatedKeys:this.mutatedKeys,l=i,d=!1;const h=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,f=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal(((p,g)=>{const v=i.get(p),_=Jf(this.query,g)?g:null,C=!!v&&this.mutatedKeys.has(v.key),x=!!_&&(_.hasLocalMutations||this.mutatedKeys.has(_.key)&&_.hasCommittedMutations);let w=!1;v&&_?v.data.isEqual(_.data)?C!==x&&(r.track({type:3,doc:_}),w=!0):this.su(v,_)||(r.track({type:2,doc:_}),w=!0,(h&&this.eu(_,h)>0||f&&this.eu(_,f)<0)&&(d=!0)):!v&&_?(r.track({type:0,doc:_}),w=!0):v&&!_&&(r.track({type:1,doc:v}),w=!0,(h||f)&&(d=!0)),w&&(_?(l=l.add(_),o=x?o.add(p):o.delete(p)):(l=l.delete(p),o=o.delete(p)))})),this.query.limit!==null)for(;l.size>this.query.limit;){const p=this.query.limitType==="F"?l.last():l.first();l=l.delete(p.key),o=o.delete(p.key),r.track({type:1,doc:p})}return{tu:l,iu:r,Cs:d,mutatedKeys:o}}su(e,n){return e.hasLocalMutations&&n.hasCommittedMutations&&!n.hasLocalMutations}applyChanges(e,n,r,i){const o=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const l=e.iu.ya();l.sort(((p,g)=>(function(_,C){const x=w=>{switch(w){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Ye(20277,{Rt:w})}};return x(_)-x(C)})(p.type,g.type)||this.eu(p.doc,g.doc))),this.ou(r),i=i??!1;const d=n&&!i?this._u():[],h=this.Xa.size===0&&this.current&&!i?1:0,f=h!==this.Za;return this.Za=h,l.length!==0||f?{snapshot:new ec(this.query,e.tu,o,l,e.mutatedKeys,h===0,f,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:d}:{au:d}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new p1,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach((n=>this.Ya=this.Ya.add(n))),e.modifiedDocuments.forEach((n=>{})),e.removedDocuments.forEach((n=>this.Ya=this.Ya.delete(n))),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=yt(),this.tu.forEach((r=>{this.uu(r.key)&&(this.Xa=this.Xa.add(r.key))}));const n=[];return e.forEach((r=>{this.Xa.has(r)||n.push(new YE(r))})),this.Xa.forEach((r=>{e.has(r)||n.push(new KE(r))})),n}cu(e){this.Ya=e.Qs,this.Xa=yt();const n=this.ru(e.documents);return this.applyChanges(n,!0)}lu(){return ec.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const R0="SyncEngine";class HN{constructor(e,n,r){this.query=e,this.targetId=n,this.view=r}}class GN{constructor(e){this.key=e,this.hu=!1}}class WN{constructor(e,n,r,i,o,l){this.localStore=e,this.remoteStore=n,this.eventManager=r,this.sharedClientState=i,this.currentUser=o,this.maxConcurrentLimboResolutions=l,this.Pu={},this.Tu=new Bo((d=>dE(d)),Zf),this.Iu=new Map,this.Eu=new Set,this.du=new en(Ge.comparator),this.Au=new Map,this.Ru=new _0,this.Vu={},this.mu=new Map,this.fu=Jl.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function QN(t,e,n=!0){const r=nT(t);let i;const o=r.Tu.get(e);return o?(r.sharedClientState.addLocalQueryTarget(o.targetId),i=o.view.lu()):i=await XE(r,e,n,!0),i}async function KN(t,e){const n=nT(t);await XE(n,e,!0,!1)}async function XE(t,e,n,r){const i=await pN(t.localStore,$s(e)),o=i.targetId,l=t.sharedClientState.addLocalQueryTarget(o,n);let d;return r&&(d=await YN(t,e,o,l==="current",i.resumeToken)),t.isPrimaryClient&&n&&UE(t.remoteStore,i),d}async function YN(t,e,n,r,i){t.pu=(g,v,_)=>(async function(x,w,E,T){let R=w.view.ru(E);R.Cs&&(R=await c1(x.localStore,w.query,!1).then((({documents:I})=>w.view.ru(I,R))));const M=T&&T.targetChanges.get(w.targetId),V=T&&T.targetMismatches.get(w.targetId)!=null,$=w.view.applyChanges(R,x.isPrimaryClient,M,V);return b1(x,w.targetId,$.au),$.snapshot})(t,g,v,_);const o=await c1(t.localStore,e,!0),l=new qN(e,o.Qs),d=l.ru(o.documents),h=od.createSynthesizedTargetChangeForCurrentChange(n,r&&t.onlineState!=="Offline",i),f=l.applyChanges(d,t.isPrimaryClient,h);b1(t,n,f.au);const p=new HN(e,n,l);return t.Tu.set(e,p),t.Iu.has(n)?t.Iu.get(n).push(e):t.Iu.set(n,[e]),f.snapshot}async function XN(t,e,n){const r=nt(t),i=r.Tu.get(e),o=r.Iu.get(i.targetId);if(o.length>1)return r.Iu.set(i.targetId,o.filter((l=>!Zf(l,e)))),void r.Tu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||await jy(r.localStore,i.targetId,!1).then((()=>{r.sharedClientState.clearQueryState(i.targetId),n&&w0(r.remoteStore,i.targetId),ky(r,i.targetId)})).catch(dc)):(ky(r,i.targetId),await jy(r.localStore,i.targetId,!0))}async function ZN(t,e){const n=nt(t),r=n.Tu.get(e),i=n.Iu.get(r.targetId);n.isPrimaryClient&&i.length===1&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),w0(n.remoteStore,r.targetId))}async function JN(t,e,n){const r=a6(t);try{const i=await(function(l,d){const h=nt(l),f=Wt.now(),p=d.reduce(((_,C)=>_.add(C.key)),yt());let g,v;return h.persistence.runTransaction("Locally write mutations","readwrite",(_=>{let C=Ei(),x=yt();return h.Ns.getEntries(_,p).next((w=>{C=w,C.forEach(((E,T)=>{T.isValidDocument()||(x=x.add(E))}))})).next((()=>h.localDocuments.getOverlayedDocuments(_,C))).next((w=>{g=w;const E=[];for(const T of d){const R=mO(T,g.get(T.key).overlayedDocument);R!=null&&E.push(new Fa(T.key,R,rE(R.value.mapValue),_r.exists(!0)))}return h.mutationQueue.addMutationBatch(_,f,E,d)})).next((w=>{v=w;const E=w.applyToLocalDocumentSet(g,x);return h.documentOverlayCache.saveOverlays(_,w.batchId,E)}))})).then((()=>({batchId:v.batchId,changes:mE(g)})))})(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),(function(l,d,h){let f=l.Vu[l.currentUser.toKey()];f||(f=new en(gt)),f=f.insert(d,h),l.Vu[l.currentUser.toKey()]=f})(r,i.batchId,n),await cd(r,i.changes),await am(r.remoteStore)}catch(i){const o=A0(i,"Failed to persist write");n.reject(o)}}async function ZE(t,e){const n=nt(t);try{const r=await hN(n.localStore,e);e.targetChanges.forEach(((i,o)=>{const l=n.Au.get(o);l&&(At(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1,22616),i.addedDocuments.size>0?l.hu=!0:i.modifiedDocuments.size>0?At(l.hu,14607):i.removedDocuments.size>0&&(At(l.hu,42227),l.hu=!1))})),await cd(n,r,e)}catch(r){await dc(r)}}function _1(t,e,n){const r=nt(t);if(r.isPrimaryClient&&n===0||!r.isPrimaryClient&&n===1){const i=[];r.Tu.forEach(((o,l)=>{const d=l.view.va(e);d.snapshot&&i.push(d.snapshot)})),(function(l,d){const h=nt(l);h.onlineState=d;let f=!1;h.queries.forEach(((p,g)=>{for(const v of g.Sa)v.va(d)&&(f=!0)})),f&&j0(h)})(r.eventManager,e),i.length&&r.Pu.H_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function e6(t,e,n){const r=nt(t);r.sharedClientState.updateQueryState(e,"rejected",n);const i=r.Au.get(e),o=i&&i.key;if(o){let l=new en(Ge.comparator);l=l.insert(o,Jn.newNoDocument(o,Ze.min()));const d=yt().add(o),h=new rm(Ze.min(),new Map,new en(gt),l,d);await ZE(r,h),r.du=r.du.remove(o),r.Au.delete(e),I0(r)}else await jy(r.localStore,e,!1).then((()=>ky(r,e,n))).catch(dc)}async function t6(t,e){const n=nt(t),r=e.batch.batchId;try{const i=await dN(n.localStore,e);eT(n,r,null),JE(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await cd(n,i)}catch(i){await dc(i)}}async function n6(t,e,n){const r=nt(t);try{const i=await(function(l,d){const h=nt(l);return h.persistence.runTransaction("Reject batch","readwrite-primary",(f=>{let p;return h.mutationQueue.lookupMutationBatch(f,d).next((g=>(At(g!==null,37113),p=g.keys(),h.mutationQueue.removeMutationBatch(f,g)))).next((()=>h.mutationQueue.performConsistencyCheck(f))).next((()=>h.documentOverlayCache.removeOverlaysForBatchId(f,p,d))).next((()=>h.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(f,p))).next((()=>h.localDocuments.getDocuments(f,p)))}))})(r.localStore,e);eT(r,e,n),JE(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),await cd(r,i)}catch(i){await dc(i)}}function JE(t,e){(t.mu.get(e)||[]).forEach((n=>{n.resolve()})),t.mu.delete(e)}function eT(t,e,n){const r=nt(t);let i=r.Vu[r.currentUser.toKey()];if(i){const o=i.get(e);o&&(n?o.reject(n):o.resolve(),i=i.remove(e)),r.Vu[r.currentUser.toKey()]=i}}function ky(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.Iu.get(e))t.Tu.delete(r),n&&t.Pu.yu(r,n);t.Iu.delete(e),t.isPrimaryClient&&t.Ru.jr(e).forEach((r=>{t.Ru.containsKey(r)||tT(t,r)}))}function tT(t,e){t.Eu.delete(e.path.canonicalString());const n=t.du.get(e);n!==null&&(w0(t.remoteStore,n),t.du=t.du.remove(e),t.Au.delete(n),I0(t))}function b1(t,e,n){for(const r of n)r instanceof KE?(t.Ru.addReference(r.key,e),r6(t,r)):r instanceof YE?(Ue(R0,"Document no longer in limbo: "+r.key),t.Ru.removeReference(r.key,e),t.Ru.containsKey(r.key)||tT(t,r.key)):Ye(19791,{wu:r})}function r6(t,e){const n=e.key,r=n.path.canonicalString();t.du.get(n)||t.Eu.has(r)||(Ue(R0,"New document in limbo: "+n),t.Eu.add(r),I0(t))}function I0(t){for(;t.Eu.size>0&&t.du.size<t.maxConcurrentLimboResolutions;){const e=t.Eu.values().next().value;t.Eu.delete(e);const n=new Ge(Ft.fromString(e)),r=t.fu.next();t.Au.set(r,new GN(n)),t.du=t.du.insert(n,r),UE(t.remoteStore,new ga($s(f0(n.path)),r,"TargetPurposeLimboResolution",Kf.ce))}}async function cd(t,e,n){const r=nt(t),i=[],o=[],l=[];r.Tu.isEmpty()||(r.Tu.forEach(((d,h)=>{l.push(r.pu(h,e,n).then((f=>{if((f||n)&&r.isPrimaryClient){const p=f?!f.fromCache:n?.targetChanges.get(h.targetId)?.current;r.sharedClientState.updateQueryState(h.targetId,p?"current":"not-current")}if(f){i.push(f);const p=v0.As(h.targetId,f);o.push(p)}})))})),await Promise.all(l),r.Pu.H_(i),await(async function(h,f){const p=nt(h);try{await p.persistence.runTransaction("notifyLocalViewChanges","readwrite",(g=>ke.forEach(f,(v=>ke.forEach(v.Es,(_=>p.persistence.referenceDelegate.addReference(g,v.targetId,_))).next((()=>ke.forEach(v.ds,(_=>p.persistence.referenceDelegate.removeReference(g,v.targetId,_)))))))))}catch(g){if(!hc(g))throw g;Ue(x0,"Failed to update sequence numbers: "+g)}for(const g of f){const v=g.targetId;if(!g.fromCache){const _=p.Ms.get(v),C=_.snapshotVersion,x=_.withLastLimboFreeSnapshotVersion(C);p.Ms=p.Ms.insert(v,x)}}})(r.localStore,o))}async function s6(t,e){const n=nt(t);if(!n.currentUser.isEqual(e)){Ue(R0,"User change. New user:",e.toKey());const r=await PE(n.localStore,e);n.currentUser=e,(function(o,l){o.mu.forEach((d=>{d.forEach((h=>{h.reject(new Le(Re.CANCELLED,l))}))})),o.mu.clear()})(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await cd(n,r.Ls)}}function i6(t,e){const n=nt(t),r=n.Au.get(e);if(r&&r.hu)return yt().add(r.key);{let i=yt();const o=n.Iu.get(e);if(!o)return i;for(const l of o){const d=n.Tu.get(l);i=i.unionWith(d.view.nu)}return i}}function nT(t){const e=nt(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=ZE.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=i6.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=e6.bind(null,e),e.Pu.H_=VN.bind(null,e.eventManager),e.Pu.yu=$N.bind(null,e.eventManager),e}function a6(t){const e=nt(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=t6.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=n6.bind(null,e),e}class If{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=sm(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,n){return null}Mu(e,n){return null}vu(e){return uN(this.persistence,new oN,e.initialUser,this.serializer)}Cu(e){return new NE(b0.mi,this.serializer)}Du(e){return new yN}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}If.provider={build:()=>new If};class o6 extends If{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,n){At(this.persistence.referenceDelegate instanceof jf,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new GO(r,e.asyncQueue,n)}Cu(e){const n=this.cacheSizeBytes!==void 0?pr.withCacheSize(this.cacheSizeBytes):pr.DEFAULT;return new NE((r=>jf.mi(r,n)),this.serializer)}}class Dy{async initialize(e,n){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>_1(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=s6.bind(null,this.syncEngine),await LN(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new FN})()}createDatastore(e){const n=sm(e.databaseInfo.databaseId),r=(function(o){return new wN(o)})(e.databaseInfo);return(function(o,l,d,h){return new TN(o,l,d,h)})(e.authCredentials,e.appCheckCredentials,r,n)}createRemoteStore(e){return(function(r,i,o,l,d){return new jN(r,i,o,l,d)})(this.localStore,this.datastore,e.asyncQueue,(n=>_1(this.syncEngine,n,0)),(function(){return h1.v()?new h1:new _N})())}createSyncEngine(e,n){return(function(i,o,l,d,h,f,p){const g=new WN(i,o,l,d,h,f);return p&&(g.gu=!0),g})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,n)}async terminate(){await(async function(n){const r=nt(n);Ue(Oo,"RemoteStore shutting down."),r.Ea.add(5),await ld(r),r.Aa.shutdown(),r.Ra.set("Unknown")})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}Dy.provider={build:()=>new Dy};class rT{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):Ci("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,n){setTimeout((()=>{this.muted||e(n)}),0)}}const Da="FirestoreClient";class l6{constructor(e,n,r,i,o){this.authCredentials=e,this.appCheckCredentials=n,this.asyncQueue=r,this.databaseInfo=i,this.user=Zn.UNAUTHENTICATED,this.clientId=o0.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=o,this.authCredentials.start(r,(async l=>{Ue(Da,"Received user=",l.uid),await this.authCredentialListener(l),this.user=l})),this.appCheckCredentials.start(r,(l=>(Ue(Da,"Received new app check token=",l),this.appCheckCredentialListener(l,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new bi;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){const r=A0(n,"Failed to shutdown persistence");e.reject(r)}})),e.promise}}async function Hg(t,e){t.asyncQueue.verifyOperationInProgress(),Ue(Da,"Initializing OfflineComponentProvider");const n=t.configuration;await e.initialize(n);let r=n.initialUser;t.setCredentialChangeListener((async i=>{r.isEqual(i)||(await PE(e.localStore,i),r=i)})),e.persistence.setDatabaseDeletedListener((()=>t.terminate())),t._offlineComponents=e}async function v1(t,e){t.asyncQueue.verifyOperationInProgress();const n=await c6(t);Ue(Da,"Initializing OnlineComponentProvider"),await e.initialize(n,t.configuration),t.setCredentialChangeListener((r=>m1(e.remoteStore,r))),t.setAppCheckTokenChangeListener(((r,i)=>m1(e.remoteStore,i))),t._onlineComponents=e}async function c6(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){Ue(Da,"Using user provided OfflineComponentProvider");try{await Hg(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!(function(i){return i.name==="FirebaseError"?i.code===Re.FAILED_PRECONDITION||i.code===Re.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11})(n))throw n;Wl("Error using user provided cache. Falling back to memory cache: "+n),await Hg(t,new If)}}else Ue(Da,"Using default OfflineComponentProvider"),await Hg(t,new o6(void 0));return t._offlineComponents}async function sT(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(Ue(Da,"Using user provided OnlineComponentProvider"),await v1(t,t._uninitializedComponentsProvider._online)):(Ue(Da,"Using default OnlineComponentProvider"),await v1(t,new Dy))),t._onlineComponents}function u6(t){return sT(t).then((e=>e.syncEngine))}async function iT(t){const e=await sT(t),n=e.eventManager;return n.onListen=QN.bind(null,e.syncEngine),n.onUnlisten=XN.bind(null,e.syncEngine),n.onFirstRemoteStoreListen=KN.bind(null,e.syncEngine),n.onLastRemoteStoreUnlisten=ZN.bind(null,e.syncEngine),n}function d6(t,e,n={}){const r=new bi;return t.asyncQueue.enqueueAndForget((async()=>(function(o,l,d,h,f){const p=new rT({next:v=>{p.Nu(),l.enqueueAndForget((()=>WE(o,g)));const _=v.docs.has(d);!_&&v.fromCache?f.reject(new Le(Re.UNAVAILABLE,"Failed to get document because the client is offline.")):_&&v.fromCache&&h&&h.source==="server"?f.reject(new Le(Re.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):f.resolve(v)},error:v=>f.reject(v)}),g=new QE(f0(d.path),p,{includeMetadataChanges:!0,qa:!0});return GE(o,g)})(await iT(t),t.asyncQueue,e,n,r))),r.promise}function h6(t,e,n={}){const r=new bi;return t.asyncQueue.enqueueAndForget((async()=>(function(o,l,d,h,f){const p=new rT({next:v=>{p.Nu(),l.enqueueAndForget((()=>WE(o,g))),v.fromCache&&h.source==="server"?f.reject(new Le(Re.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):f.resolve(v)},error:v=>f.reject(v)}),g=new QE(d,p,{includeMetadataChanges:!0,qa:!0});return GE(o,g)})(await iT(t),t.asyncQueue,e,n,r))),r.promise}function aT(t){const e={};return t.timeoutSeconds!==void 0&&(e.timeoutSeconds=t.timeoutSeconds),e}const x1=new Map;const oT="firestore.googleapis.com",w1=!0;class S1{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new Le(Re.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=oT,this.ssl=w1}else this.host=e.host,this.ssl=e.ssl??w1;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=OE;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<qO)throw new Le(Re.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}jM("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=aT(e.experimentalLongPollingOptions??{}),(function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new Le(Re.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new Le(Re.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new Le(Re.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(r,i){return r.timeoutSeconds===i.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class om{constructor(e,n,r,i){this._authCredentials=e,this._appCheckCredentials=n,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new S1({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Le(Re.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new Le(Re.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new S1(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(r){if(!r)return new _M;switch(r.type){case"firstParty":return new wM(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new Le(Re.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(n){const r=x1.get(n);r&&(Ue("ComponentProvider","Removing Datastore"),x1.delete(n),r.terminate())})(this),Promise.resolve()}}function f6(t,e,n,r={}){t=ms(t,om);const i=ac(e),o=t._getSettings(),l={...o,emulatorOptions:t._getEmulatorOptions()},d=`${e}:${n}`;i&&(YS(`https://${d}`),XS("Firestore",!0)),o.host!==oT&&o.host!==d&&Wl("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const h={...o,host:d,ssl:i,emulatorOptions:r};if(!xi(h,l)&&(t._setSettings(h),r.mockUserToken)){let f,p;if(typeof r.mockUserToken=="string")f=r.mockUserToken,p=Zn.MOCK_USER;else{f=TR(r.mockUserToken,t._app?.options.projectId);const g=r.mockUserToken.sub||r.mockUserToken.user_id;if(!g)throw new Le(Re.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");p=new Zn(g)}t._authCredentials=new bM(new HC(f,p))}}class mc{constructor(e,n,r){this.converter=n,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new mc(this.firestore,e,this._query)}}class un{constructor(e,n,r){this.converter=n,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Ta(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new un(this.firestore,e,this._key)}toJSON(){return{type:un._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,n,r){if(sd(n,un._jsonSchema))return new un(e,r||null,new Ge(Ft.fromString(n.referencePath)))}}un._jsonSchemaVersion="firestore/documentReference/1.0",un._jsonSchema={type:xn("string",un._jsonSchemaVersion),referencePath:xn("string")};class Ta extends mc{constructor(e,n,r){super(e,n,f0(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new un(this.firestore,null,new Ge(e))}withConverter(e){return new Ta(this.firestore,e,this._path)}}function m6(t,e,...n){if(t=wn(t),GC("collection","path",e),t instanceof om){const r=Ft.fromString(e,...n);return Pw(r),new Ta(t,null,r)}{if(!(t instanceof un||t instanceof Ta))throw new Le(Re.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(Ft.fromString(e,...n));return Pw(r),new Ta(t.firestore,null,r)}}function pc(t,e,...n){if(t=wn(t),arguments.length===1&&(e=o0.newId()),GC("doc","path",e),t instanceof om){const r=Ft.fromString(e,...n);return Nw(r),new un(t,null,new Ge(r))}{if(!(t instanceof un||t instanceof Ta))throw new Le(Re.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(Ft.fromString(e,...n));return Nw(r),new un(t.firestore,t instanceof Ta?t.converter:null,new Ge(r))}}const C1="AsyncQueue";class E1{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new zE(this,"async_queue_retry"),this._c=()=>{const r=qg();r&&Ue(C1,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=e;const n=qg();n&&typeof n.addEventListener=="function"&&n.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const n=qg();n&&typeof n.removeEventListener=="function"&&n.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise((()=>{}));const n=new bi;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(e().then(n.resolve,n.reject),n.promise))).then((()=>n.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Xu.push(e),this.lc())))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!hc(e))throw e;Ue(C1,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_((()=>this.lc()))}}cc(e){const n=this.ac.then((()=>(this.rc=!0,e().catch((r=>{throw this.nc=r,this.rc=!1,Ci("INTERNAL UNHANDLED ERROR: ",T1(r)),r})).then((r=>(this.rc=!1,r))))));return this.ac=n,n}enqueueAfterDelay(e,n,r){this.uc(),this.oc.indexOf(e)>-1&&(n=0);const i=T0.createAndSchedule(this,e,n,r,(o=>this.hc(o)));return this.tc.push(i),i}uc(){this.nc&&Ye(47125,{Pc:T1(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const n of this.tc)if(n.timerId===e)return!0;return!1}Ec(e){return this.Tc().then((()=>{this.tc.sort(((n,r)=>n.targetTimeMs-r.targetTimeMs));for(const n of this.tc)if(n.skipDelay(),e!=="all"&&n.timerId===e)break;return this.Tc()}))}dc(e){this.oc.push(e)}hc(e){const n=this.tc.indexOf(e);this.tc.splice(n,1)}}function T1(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+`
`+t.stack),e}class Lo extends om{constructor(e,n,r,i){super(e,n,r,i),this.type="firestore",this._queue=new E1,this._persistenceKey=i?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new E1(e),this._firestoreClient=void 0,await e}}}function p6(t,e){const n=typeof t=="object"?t:tC(),r=typeof t=="string"?t:xf,i=Xy(n,"firestore").getImmediate({identifier:r});if(!i._initialized){const o=CR("firestore");o&&f6(i,...o)}return i}function lm(t){if(t._terminated)throw new Le(Re.FAILED_PRECONDITION,"The client has already been terminated.");return t._firestoreClient||g6(t),t._firestoreClient}function g6(t){const e=t._freezeSettings(),n=(function(i,o,l,d){return new LM(i,o,l,d.host,d.ssl,d.experimentalForceLongPolling,d.experimentalAutoDetectLongPolling,aT(d.experimentalLongPollingOptions),d.useFetchStreams,d.isUsingEmulator)})(t._databaseId,t._app?.options.appId||"",t._persistenceKey,e);t._componentsProvider||e.localCache?._offlineComponentProvider&&e.localCache?._onlineComponentProvider&&(t._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),t._firestoreClient=new l6(t._authCredentials,t._appCheckCredentials,t._queue,n,t._componentsProvider&&(function(i){const o=i?._online.build();return{_offline:i?._offline.build(o),_online:o}})(t._componentsProvider))}class Qr{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Qr(Gn.fromBase64String(e))}catch(n){throw new Le(Re.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+n)}}static fromUint8Array(e){return new Qr(Gn.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:Qr._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(sd(e,Qr._jsonSchema))return Qr.fromBase64String(e.bytes)}}Qr._jsonSchemaVersion="firestore/bytes/1.0",Qr._jsonSchema={type:xn("string",Qr._jsonSchemaVersion),bytes:xn("string")};class ud{constructor(...e){for(let n=0;n<e.length;++n)if(e[n].length===0)throw new Le(Re.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new $n(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class dd{constructor(e){this._methodName=e}}class Hs{constructor(e,n){if(!isFinite(e)||e<-90||e>90)throw new Le(Re.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(n)||n<-180||n>180)throw new Le(Re.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=e,this._long=n}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return gt(this._lat,e._lat)||gt(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Hs._jsonSchemaVersion}}static fromJSON(e){if(sd(e,Hs._jsonSchema))return new Hs(e.latitude,e.longitude)}}Hs._jsonSchemaVersion="firestore/geoPoint/1.0",Hs._jsonSchema={type:xn("string",Hs._jsonSchemaVersion),latitude:xn("number"),longitude:xn("number")};class Gs{constructor(e){this._values=(e||[]).map((n=>n))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(r,i){if(r.length!==i.length)return!1;for(let o=0;o<r.length;++o)if(r[o]!==i[o])return!1;return!0})(this._values,e._values)}toJSON(){return{type:Gs._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(sd(e,Gs._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every((n=>typeof n=="number")))return new Gs(e.vectorValues);throw new Le(Re.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Gs._jsonSchemaVersion="firestore/vectorValue/1.0",Gs._jsonSchema={type:xn("string",Gs._jsonSchemaVersion),vectorValues:xn("object")};const y6=/^__.*__$/;class _6{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return this.fieldMask!==null?new Fa(e,this.data,this.fieldMask,n,this.fieldTransforms):new ad(e,this.data,n,this.fieldTransforms)}}class lT{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return new Fa(e,this.data,this.fieldMask,n,this.fieldTransforms)}}function cT(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Ye(40011,{Ac:t})}}class cm{constructor(e,n,r,i,o,l){this.settings=e,this.databaseId=n,this.serializer=r,this.ignoreUndefinedProperties=i,o===void 0&&this.Rc(),this.fieldTransforms=o||[],this.fieldMask=l||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new cm({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){const n=this.path?.child(e),r=this.Vc({path:n,fc:!1});return r.gc(e),r}yc(e){const n=this.path?.child(e),r=this.Vc({path:n,fc:!1});return r.Rc(),r}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return kf(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find((n=>e.isPrefixOf(n)))!==void 0||this.fieldTransforms.find((n=>e.isPrefixOf(n.field)))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(cT(this.Ac)&&y6.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class b6{constructor(e,n,r){this.databaseId=e,this.ignoreUndefinedProperties=n,this.serializer=r||sm(e)}Cc(e,n,r,i=!1){return new cm({Ac:e,methodName:n,Dc:r,path:$n.emptyPath(),fc:!1,bc:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function um(t){const e=t._freezeSettings(),n=sm(t._databaseId);return new b6(t._databaseId,!!e.ignoreUndefinedProperties,n)}function uT(t,e,n,r,i,o={}){const l=t.Cc(o.merge||o.mergeFields?2:0,e,n,i);M0("Data must be an object, but it was:",l,r);const d=mT(r,l);let h,f;if(o.merge)h=new Rr(l.fieldMask),f=l.fieldTransforms;else if(o.mergeFields){const p=[];for(const g of o.mergeFields){const v=My(e,g,n);if(!l.contains(v))throw new Le(Re.INVALID_ARGUMENT,`Field '${v}' is specified in your field mask but missing from your input data.`);gT(p,v)||p.push(v)}h=new Rr(p),f=l.fieldTransforms.filter((g=>h.covers(g.field)))}else h=null,f=l.fieldTransforms;return new _6(new gr(d),h,f)}class dm extends dd{_toFieldTransform(e){if(e.Ac!==2)throw e.Ac===1?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof dm}}function dT(t,e,n){return new cm({Ac:3,Dc:e.settings.Dc,methodName:t._methodName,fc:n},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class k0 extends dd{constructor(e,n){super(e),this.vc=n}_toFieldTransform(e){const n=dT(this,e,!0),r=this.vc.map((o=>Uo(o,n))),i=new Xl(r);return new xE(e.path,i)}isEqual(e){return e instanceof k0&&xi(this.vc,e.vc)}}class D0 extends dd{constructor(e,n){super(e),this.vc=n}_toFieldTransform(e){const n=dT(this,e,!0),r=this.vc.map((o=>Uo(o,n))),i=new Zl(r);return new xE(e.path,i)}isEqual(e){return e instanceof D0&&xi(this.vc,e.vc)}}function hT(t,e,n,r){const i=t.Cc(1,e,n);M0("Data must be an object, but it was:",i,r);const o=[],l=gr.empty();Ua(r,((h,f)=>{const p=O0(e,h,n);f=wn(f);const g=i.yc(p);if(f instanceof dm)o.push(p);else{const v=Uo(f,g);v!=null&&(o.push(p),l.set(p,v))}}));const d=new Rr(o);return new lT(l,d,i.fieldTransforms)}function fT(t,e,n,r,i,o){const l=t.Cc(1,e,n),d=[My(e,r,n)],h=[i];if(o.length%2!=0)throw new Le(Re.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let v=0;v<o.length;v+=2)d.push(My(e,o[v])),h.push(o[v+1]);const f=[],p=gr.empty();for(let v=d.length-1;v>=0;--v)if(!gT(f,d[v])){const _=d[v];let C=h[v];C=wn(C);const x=l.yc(_);if(C instanceof dm)f.push(_);else{const w=Uo(C,x);w!=null&&(f.push(_),p.set(_,w))}}const g=new Rr(f);return new lT(p,g,l.fieldTransforms)}function v6(t,e,n,r=!1){return Uo(n,t.Cc(r?4:3,e))}function Uo(t,e){if(pT(t=wn(t)))return M0("Unsupported field value:",e,t),mT(t,e);if(t instanceof dd)return(function(r,i){if(!cT(i.Ac))throw i.Sc(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Sc(`${r._methodName}() is not currently supported inside arrays`);const o=r._toFieldTransform(i);o&&i.fieldTransforms.push(o)})(t,e),null;if(t===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return(function(r,i){const o=[];let l=0;for(const d of r){let h=Uo(d,i.wc(l));h==null&&(h={nullValue:"NULL_VALUE"}),o.push(h),l++}return{arrayValue:{values:o}}})(t,e)}return(function(r,i){if((r=wn(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return lO(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const o=Wt.fromDate(r);return{timestampValue:Af(i.serializer,o)}}if(r instanceof Wt){const o=new Wt(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Af(i.serializer,o)}}if(r instanceof Hs)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Qr)return{bytesValue:AE(i.serializer,r._byteString)};if(r instanceof un){const o=i.databaseId,l=r.firestore._databaseId;if(!l.isEqual(o))throw i.Sc(`Document reference is for database ${l.projectId}/${l.database} but should be for database ${o.projectId}/${o.database}`);return{referenceValue:y0(r.firestore._databaseId||i.databaseId,r._key.path)}}if(r instanceof Gs)return(function(l,d){return{mapValue:{fields:{[tE]:{stringValue:nE},[wf]:{arrayValue:{values:l.toArray().map((f=>{if(typeof f!="number")throw d.Sc("VectorValues must only contain numeric values.");return m0(d.serializer,f)}))}}}}}})(r,i);throw i.Sc(`Unsupported field value: ${Qf(r)}`)})(t,e)}function mT(t,e){const n={};return KC(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Ua(t,((r,i)=>{const o=Uo(i,e.mc(r));o!=null&&(n[r]=o)})),{mapValue:{fields:n}}}function pT(t){return!(typeof t!="object"||t===null||t instanceof Array||t instanceof Date||t instanceof Wt||t instanceof Hs||t instanceof Qr||t instanceof un||t instanceof dd||t instanceof Gs)}function M0(t,e,n){if(!pT(n)||!WC(n)){const r=Qf(n);throw r==="an object"?e.Sc(t+" a custom object"):e.Sc(t+" "+r)}}function My(t,e,n){if((e=wn(e))instanceof ud)return e._internalPath;if(typeof e=="string")return O0(t,e);throw kf("Field path arguments must be of type string or ",t,!1,void 0,n)}const x6=new RegExp("[~\\*/\\[\\]]");function O0(t,e,n){if(e.search(x6)>=0)throw kf(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new ud(...e.split("."))._internalPath}catch{throw kf(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function kf(t,e,n,r,i){const o=r&&!r.isEmpty(),l=i!==void 0;let d=`Function ${e}() called with invalid data`;n&&(d+=" (via `toFirestore()`)"),d+=". ";let h="";return(o||l)&&(h+=" (found",o&&(h+=` in field ${r}`),l&&(h+=` in document ${i}`),h+=")"),new Le(Re.INVALID_ARGUMENT,d+t+h)}function gT(t,e){return t.some((n=>n.isEqual(e)))}class yT{constructor(e,n,r,i,o){this._firestore=e,this._userDataWriter=n,this._key=r,this._document=i,this._converter=o}get id(){return this._key.path.lastSegment()}get ref(){return new un(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new w6(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const n=this._document.data.field(N0("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n)}}}class w6 extends yT{data(){return super.data()}}function N0(t,e){return typeof e=="string"?O0(t,e):e instanceof ud?e._internalPath:e._delegate._internalPath}function S6(t){if(t.limitType==="L"&&t.explicitOrderBy.length===0)throw new Le(Re.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class P0{}class C6 extends P0{}function E6(t,e,...n){let r=[];e instanceof P0&&r.push(e),r=r.concat(n),(function(o){const l=o.filter((h=>h instanceof B0)).length,d=o.filter((h=>h instanceof hm)).length;if(l>1||l>0&&d>0)throw new Le(Re.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")})(r);for(const i of r)t=i._apply(t);return t}class hm extends C6{constructor(e,n,r){super(),this._field=e,this._op=n,this._value=r,this.type="where"}static _create(e,n,r){return new hm(e,n,r)}_apply(e){const n=this._parse(e);return _T(e._query,n),new mc(e.firestore,e.converter,wy(e._query,n))}_parse(e){const n=um(e.firestore);return(function(o,l,d,h,f,p,g){let v;if(f.isKeyField()){if(p==="array-contains"||p==="array-contains-any")throw new Le(Re.INVALID_ARGUMENT,`Invalid Query. You can't perform '${p}' queries on documentId().`);if(p==="in"||p==="not-in"){j1(g,p);const C=[];for(const x of g)C.push(A1(h,o,x));v={arrayValue:{values:C}}}else v=A1(h,o,g)}else p!=="in"&&p!=="not-in"&&p!=="array-contains-any"||j1(g,p),v=v6(d,l,g,p==="in"||p==="not-in");return vn.create(f,p,v)})(e._query,"where",n,e.firestore._databaseId,this._field,this._op,this._value)}}function T6(t,e,n){const r=e,i=N0("where",t);return hm._create(i,r,n)}class B0 extends P0{constructor(e,n){super(),this.type=e,this._queryConstraints=n}static _create(e,n){return new B0(e,n)}_parse(e){const n=this._queryConstraints.map((r=>r._parse(e))).filter((r=>r.getFilters().length>0));return n.length===1?n[0]:ps.create(n,this._getOperator())}_apply(e){const n=this._parse(e);return n.getFilters().length===0?e:((function(i,o){let l=i;const d=o.getFlattenedFilters();for(const h of d)_T(l,h),l=wy(l,h)})(e._query,n),new mc(e.firestore,e.converter,wy(e._query,n)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function A1(t,e,n){if(typeof(n=wn(n))=="string"){if(n==="")throw new Le(Re.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!uE(e)&&n.indexOf("/")!==-1)throw new Le(Re.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=e.path.child(Ft.fromString(n));if(!Ge.isDocumentKey(r))throw new Le(Re.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return qw(t,new Ge(r))}if(n instanceof un)return qw(t,n._key);throw new Le(Re.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Qf(n)}.`)}function j1(t,e){if(!Array.isArray(t)||t.length===0)throw new Le(Re.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function _T(t,e){const n=(function(i,o){for(const l of i)for(const d of l.getFlattenedFilters())if(o.indexOf(d.op)>=0)return d.op;return null})(t.filters,(function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(e.op));if(n!==null)throw n===e.op?new Le(Re.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new Le(Re.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}class A6{convertValue(e,n="none"){switch(Ia(e)){case 0:return null;case 1:return e.booleanValue;case 2:return ln(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,n);case 5:return e.stringValue;case 6:return this.convertBytes(Ra(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,n);case 11:return this.convertObject(e.mapValue,n);case 10:return this.convertVectorValue(e.mapValue);default:throw Ye(62114,{value:e})}}convertObject(e,n){return this.convertObjectMap(e.fields,n)}convertObjectMap(e,n="none"){const r={};return Ua(e,((i,o)=>{r[i]=this.convertValue(o,n)})),r}convertVectorValue(e){const n=e.fields?.[wf].arrayValue?.values?.map((r=>ln(r.doubleValue)));return new Gs(n)}convertGeoPoint(e){return new Hs(ln(e.latitude),ln(e.longitude))}convertArray(e,n){return(e.values||[]).map((r=>this.convertValue(r,n)))}convertServerTimestamp(e,n){switch(n){case"previous":const r=Xf(e);return r==null?null:this.convertValue(r,n);case"estimate":return this.convertTimestamp(Lu(e));default:return null}}convertTimestamp(e){const n=ja(e);return new Wt(n.seconds,n.nanos)}convertDocumentKey(e,n){const r=Ft.fromString(e);At(ME(r),9688,{name:e});const i=new Uu(r.get(1),r.get(3)),o=new Ge(r.popFirst(5));return i.isEqual(n)||Ci(`Document ${o} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${n.projectId}/${n.database}) instead.`),o}}function bT(t,e,n){let r;return r=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,r}class Tu{constructor(e,n){this.hasPendingWrites=e,this.fromCache=n}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class jo extends yT{constructor(e,n,r,i,o,l){super(e,n,r,i,l),this._firestore=e,this._firestoreImpl=e,this.metadata=o}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const n=new lf(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(n,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,n={}){if(this._document){const r=this._document.data.field(N0("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,n.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new Le(Re.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,n={};return n.type=jo._jsonSchemaVersion,n.bundle="",n.bundleSource="DocumentSnapshot",n.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?n:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),n.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),n)}}jo._jsonSchemaVersion="firestore/documentSnapshot/1.0",jo._jsonSchema={type:xn("string",jo._jsonSchemaVersion),bundleSource:xn("string","DocumentSnapshot"),bundleName:xn("string"),bundle:xn("string")};class lf extends jo{data(e={}){return super.data(e)}}class ql{constructor(e,n,r,i){this._firestore=e,this._userDataWriter=n,this._snapshot=i,this.metadata=new Tu(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){const e=[];return this.forEach((n=>e.push(n))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,n){this._snapshot.docs.forEach((r=>{e.call(n,new lf(this._firestore,this._userDataWriter,r.key,r,new Tu(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const n=!!e.includeMetadataChanges;if(n&&this._snapshot.excludesMetadataChanges)throw new Le(Re.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===n||(this._cachedChanges=(function(i,o){if(i._snapshot.oldDocs.isEmpty()){let l=0;return i._snapshot.docChanges.map((d=>{const h=new lf(i._firestore,i._userDataWriter,d.doc.key,d.doc,new Tu(i._snapshot.mutatedKeys.has(d.doc.key),i._snapshot.fromCache),i.query.converter);return d.doc,{type:"added",doc:h,oldIndex:-1,newIndex:l++}}))}{let l=i._snapshot.oldDocs;return i._snapshot.docChanges.filter((d=>o||d.type!==3)).map((d=>{const h=new lf(i._firestore,i._userDataWriter,d.doc.key,d.doc,new Tu(i._snapshot.mutatedKeys.has(d.doc.key),i._snapshot.fromCache),i.query.converter);let f=-1,p=-1;return d.type!==0&&(f=l.indexOf(d.doc.key),l=l.delete(d.doc.key)),d.type!==1&&(l=l.add(d.doc),p=l.indexOf(d.doc.key)),{type:j6(d.type),doc:h,oldIndex:f,newIndex:p}}))}})(this,n),this._cachedChangesIncludeMetadataChanges=n),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new Le(Re.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=ql._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=o0.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const n=[],r=[],i=[];return this.docs.forEach((o=>{o._document!==null&&(n.push(o._document),r.push(this._userDataWriter.convertObjectMap(o._document.data.value.mapValue.fields,"previous")),i.push(o.ref.path))})),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function j6(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Ye(61501,{type:t})}}function R6(t){t=ms(t,un);const e=ms(t.firestore,Lo);return d6(lm(e),t._key).then((n=>O6(e,t,n)))}ql._jsonSchemaVersion="firestore/querySnapshot/1.0",ql._jsonSchema={type:xn("string",ql._jsonSchemaVersion),bundleSource:xn("string","QuerySnapshot"),bundleName:xn("string"),bundle:xn("string")};class vT extends A6{constructor(e){super(),this.firestore=e}convertBytes(e){return new Qr(e)}convertReference(e){const n=this.convertDocumentKey(e,this.firestore._databaseId);return new un(this.firestore,null,n)}}function I6(t){t=ms(t,mc);const e=ms(t.firestore,Lo),n=lm(e),r=new vT(e);return S6(t._query),h6(n,t._query).then((i=>new ql(e,r,t,i)))}function k6(t,e,n){t=ms(t,un);const r=ms(t.firestore,Lo),i=bT(t.converter,e,n);return fm(r,[uT(um(r),"setDoc",t._key,i,t.converter!==null,n).toMutation(t._key,_r.none())])}function D6(t,e,n,...r){t=ms(t,un);const i=ms(t.firestore,Lo),o=um(i);let l;return l=typeof(e=wn(e))=="string"||e instanceof ud?fT(o,"updateDoc",t._key,e,n,r):hT(o,"updateDoc",t._key,e),fm(i,[l.toMutation(t._key,_r.exists(!0))])}function M6(t){return fm(ms(t.firestore,Lo),[new nm(t._key,_r.none())])}function fm(t,e){return(function(r,i){const o=new bi;return r.asyncQueue.enqueueAndForget((async()=>JN(await u6(r),i,o))),o.promise})(lm(t),e)}function O6(t,e,n){const r=n.docs.get(e._key),i=new vT(t);return new jo(t,i,e._key,r,new Tu(n.hasPendingWrites,n.fromCache),e.converter)}class N6{constructor(e,n){this._firestore=e,this._commitHandler=n,this._mutations=[],this._committed=!1,this._dataReader=um(e)}set(e,n,r){this._verifyNotCommitted();const i=Gg(e,this._firestore),o=bT(i.converter,n,r),l=uT(this._dataReader,"WriteBatch.set",i._key,o,i.converter!==null,r);return this._mutations.push(l.toMutation(i._key,_r.none())),this}update(e,n,r,...i){this._verifyNotCommitted();const o=Gg(e,this._firestore);let l;return l=typeof(n=wn(n))=="string"||n instanceof ud?fT(this._dataReader,"WriteBatch.update",o._key,n,r,i):hT(this._dataReader,"WriteBatch.update",o._key,n),this._mutations.push(l.toMutation(o._key,_r.exists(!0))),this}delete(e){this._verifyNotCommitted();const n=Gg(e,this._firestore);return this._mutations=this._mutations.concat(new nm(n._key,_r.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new Le(Re.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Gg(t,e){if((t=wn(t)).firestore!==e)throw new Le(Re.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}function Vu(...t){return new k0("arrayUnion",t)}function R1(...t){return new D0("arrayRemove",t)}function xT(t){return lm(t=ms(t,Lo)),new N6(t,(e=>fm(t,e)))}(function(e,n=!0){(function(i){uc=i})(oc),Hl(new ko("firestore",((r,{instanceIdentifier:i,options:o})=>{const l=r.getProvider("app").getImmediate(),d=new Lo(new vM(r.getProvider("auth-internal")),new SM(l,r.getProvider("app-check-internal")),(function(f,p){if(!Object.prototype.hasOwnProperty.apply(f.options,["projectId"]))throw new Le(Re.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Uu(f.options.projectId,p)})(l,i),l);return o={useFetchStreams:n,...o},d._setSettings(o),d}),"PUBLIC").setMultipleInstances(!0)),Sa(kw,Dw,e),Sa(kw,Dw,"esm2020")})();function Fo(){return p6(BC)}const Yt={showGroupTotals:!1};function Vo(t,e,n,r=1,i,o){let l=e;if(e.startsWith("budgets/"))l="budgets";else if(e.startsWith("months/")){const p=e.replace("months/","").split("_");if(p.length>=2){const g=p[p.length-1];l=`months/${p[p.length-2]}/${g}`}}console.log(`[Firebase] ${t}(${r}): ${l}${i===!1?" [NOT FOUND]":""}`)}async function Lt(t,e,n){const r=pc(Fo(),t,e),i=`${t}/${e}`,o=await R6(r),l=o.exists(),d=l?o.data():null;return Vo("READ",i,n,1,l),{exists:l,data:d,ref:r}}async function Fn(t,e,n){const r=Fo(),i=m6(r,t);let o;if(n&&n.length>0){const f=n.map(p=>T6(p.field,p.op,p.value));o=E6(i,...f)}else o=i;const l=await I6(o),d=l.docs.map(f=>({id:f.id,data:f.data()}));let h=t;if(n&&n.length>0){const f=n.map(p=>`${p.field} ${p.op} ${JSON.stringify(p.value)}`).join(", ");h+=` WHERE ${f}`}return Vo("QUERY",h,e,l.docs.length,void 0),{docs:d}}async function or(t,e,n,r,i){const o=pc(Fo(),t,e),l=`${t}/${e}`;return Vo("WRITE",l,r,1,void 0),k6(o,n,i??{})}async function mm(t,e){const r=Fo();for(let i=0;i<t.length;i+=500){const o=t.slice(i,i+500),l=xT(r);for(const{collectionPath:d,docId:h,data:f}of o){const p=pc(r,d,h);l.set(p,f)}Vo("BATCH_WRITE",`${o.length} docs`,e,o.length,void 0);try{await l.commit()}catch(d){throw console.error(`[Firebase] BATCH_WRITE ERROR in ${e}:`,d),console.error("[Firebase] Failed batch details:",{batchIndex:Math.floor(i/500)+1,totalBatches:Math.ceil(t.length/500),docsInBatch:o.length,firstDoc:o[0]?`${o[0].collectionPath}/${o[0].docId}`:"none"}),d}}}async function Df(t,e,n,r){const i=pc(Fo(),t,e),o=`${t}/${e}`;return Vo("UPDATE",o,r,1,void 0),D6(i,n)}async function Oy(t,e,n){const r=pc(Fo(),t,e),i=`${t}/${e}`;return Vo("DELETE",i),M6(r)}async function wT(t,e,n){const i=Fo();for(let o=0;o<t.length;o+=500){const l=t.slice(o,o+500),d=xT(i);for(const{collectionPath:h,docId:f}of l){const p=pc(i,h,f);d.delete(p)}Vo("BATCH_DELETE",`${l.length} docs`,e,l.length),await d.commit(),n?.(o+l.length)}}const wo={mobile:640,tablet:768,wide:1200},P6=wo.mobile,$u=["January","February","March","April","May","June","July","August","September","October","November","December"],Ws=3,qu=3,Jt="ungrouped_accounts",cn="ungrouped_categories";function B6(t={}){const e={};return Object.entries(t).forEach(([n,r])=>{e[n]={nickname:r.nickname??"",description:r.description??"",balance:r.balance??0,account_group_id:r.account_group_id??Jt,sort_order:r.sort_order??0,is_income_account:r.is_income_account??!1,is_income_default:r.is_income_default??!1,is_outgo_account:r.is_outgo_account??!1,is_outgo_default:r.is_outgo_default??!1,on_budget:r.on_budget??!0,is_active:r.is_active??!0}}),e}function z6(t={}){const e={};return Object.entries(t).forEach(([n,r])=>{e[n]={name:r.name,sort_order:r.sort_order??0,expected_balance:r.expected_balance??"positive",on_budget:r.on_budget!==void 0?r.on_budget:null,is_active:r.is_active!==void 0?r.is_active:null}}),e[Jt]||(e[Jt]={name:"Ungrouped",sort_order:0,expected_balance:"positive",on_budget:null,is_active:null}),e}function L6(t={}){const e={};return Object.entries(t).forEach(([n,r])=>{e[n]={name:r.name,description:r.description,category_group_id:r.category_group_id??cn,sort_order:r.sort_order??0,default_monthly_amount:r.default_monthly_amount,default_monthly_type:r.default_monthly_type,balance:r.balance??0,is_hidden:r.is_hidden??!1}}),e}function U6(t=[]){const e=t.map(r=>({id:r.id,name:r.name,sort_order:r.sort_order??0}));return e.some(r=>r.id===cn)||e.push({id:cn,name:"Uncategorized",sort_order:0}),e.sort((r,i)=>r.sort_order-i.sort_order),e}function F6(t={}){const e={};return Object.keys(t).forEach(n=>{e[n]={}}),e}async function z0(t){const{exists:e,data:n}=await Lt("budgets",t,"loading budget data (cache miss or stale)");if(!e||!n)throw new Error(`Budget ${t} not found`);const r=B6(n.accounts),i=z6(n.account_groups),o=L6(n.categories),l=U6(n.category_groups),d=F6(n.month_map);return{budget:{id:t,name:n.name,user_ids:n.user_ids||[],accepted_user_ids:n.accepted_user_ids||[],owner_id:n.owner_id||n.user_ids?.[0]||"",owner_email:n.owner_email||"",accounts:r,account_groups:i,categories:o,category_groups:l,month_map:d},accounts:r,accountGroups:i,categories:o,categoryGroups:l,monthMap:d}}function V6(t,e){const{initialDataLoadComplete:n}=Xe(),r=!!t&&e?.enabled!==!1&&n;return Pa({queryKey:t?Te.budget(t):["budget","none"],queryFn:()=>z0(t),enabled:r,staleTime:La})}function Ti(t,e,n){const r=n.toString().padStart(2,"0");return`${t}_${e}_${r}`}function gc(t,e){return e===1?{year:t-1,month:12}:{year:t,month:e-1}}function L0(t,e){return e===12?{year:t+1,month:1}:{year:t,month:e+1}}function et(t,e){return`${t}${e.toString().padStart(2,"0")}`}function Ny(t){return new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit"})}function pm(t,e){const n=new Date,r=n.getFullYear(),i=n.getMonth()+1;if(t===r&&e===i){const o=n.getDate();return`${r}-${String(i).padStart(2,"0")}-${String(o).padStart(2,"0")}`}return`${t}-${String(e).padStart(2,"0")}-01`}function gm(t){const[e,n]=t.split("-").map(Number);return{year:e,month:n}}function Me(t){return Math.round((t+Number.EPSILON)*100)/100}function ht(t){if(t==null||isNaN(t))return!1;const e=t*100;return Math.abs(e-Math.round(e))>1e-9}function Ai(t){if(t==null)return t;if(Array.isArray(t))return t.map(e=>Ai(e));if(typeof t=="object"){const e={};for(const[n,r]of Object.entries(t))r!==void 0&&(e[n]=Ai(r));return e}return t}const Xt="__NO_CATEGORY__",No="No Category";function Je(t){return t===Xt}const Gt="__NO_ACCOUNT__",Ma="No Account";function We(t){return t===Gt}function $6(t,e){return Me(e.filter(n=>n.category_id===t).reduce((n,r)=>n+r.amount,0))}function q6(t,e){let n=0;for(const r of e)r.from_category_id===t&&!Je(r.from_category_id)&&(n-=r.amount),r.to_category_id===t&&!Je(r.to_category_id)&&(n+=r.amount);return Me(n)}function H6(t,e){return Me(e.filter(n=>n.category_id===t&&!Je(n.category_id)).reduce((n,r)=>n+r.amount,0))}function ST(t,e,n,r){const i=$6(t.category_id,e),o=q6(t.category_id,n),l=H6(t.category_id,r),d=Me(t.start_balance+t.allocated+i+o+l);return{...t,spent:i,transfers:o,adjustments:l,end_balance:d}}function CT(t,e,n,r){return t.map(i=>ST(i,e,n,r))}const G6=Object.freeze(Object.defineProperty({__proto__:null,calculateCategoryBalance:ST,calculateCategoryBalances:CT},Symbol.toStringTag,{value:"Module"}));function W6(t,e){return Me(e.filter(n=>n.account_id===t).reduce((n,r)=>n+r.amount,0))}function Q6(t,e){return Me(e.filter(n=>n.account_id===t).reduce((n,r)=>n+r.amount,0))}function K6(t,e){let n=0;for(const r of e)r.from_account_id===t&&!We(r.from_account_id)&&(n-=r.amount),r.to_account_id===t&&!We(r.to_account_id)&&(n+=r.amount);return Me(n)}function Y6(t,e){return Me(e.filter(n=>n.account_id===t&&!We(n.account_id)).reduce((n,r)=>n+r.amount,0))}function X6(t,e,n,r,i){const o=W6(t.account_id,e),l=Q6(t.account_id,n),d=K6(t.account_id,r),h=Y6(t.account_id,i),f=Me(o+l+d+h),p=Me(t.start_balance+f);return{...t,income:o,expenses:l,transfers:d,adjustments:h,net_change:f,end_balance:p}}function Z6(t,e,n,r,i){return t.map(o=>X6(o,e,n,r,i))}function U0(){const t=new Date,e=t.getFullYear(),n=t.getMonth()+1;let r=e,i=n-qu;for(;i<1;)i+=12,r-=1;return{year:r,month:i}}function ym(t,e){const n=U0(),r=et(t,e),i=et(n.year,n.month);return r<=i}function J6(t,e,n,r){if("spent"in t&&"transfers"in t&&"adjustments"in t&&"end_balance"in t)return t;const[i]=CT([t],e,n,r);return i}function e4(t,e,n,r,i){if("income"in t&&"expenses"in t&&"transfers"in t&&"adjustments"in t&&"net_change"in t&&"end_balance"in t)return t;const[o]=Z6([t],e,n,r,i);return o}function t4(t,e,n){const r=ym(e,n);return{category_id:t.category_id,start_balance:r?t.start_balance:0,allocated:t.allocated}}function n4(t,e,n){const r=ym(e,n);return{account_id:t.account_id,start_balance:r?t.start_balance:0}}function _m(t){const e=t.category_balances.map(r=>J6(r,t.expenses,t.transfers,t.adjustments)),n=t.account_balances.map(r=>e4(r,t.income,t.expenses,t.transfers,t.adjustments));return{...t,category_balances:e,account_balances:n}}function bm(t){const e=t.category_balances.map(d=>t4(d,t.year,t.month)),n=t.account_balances.map(d=>n4(d,t.year,t.month)),{total_income:r,total_expenses:i,previous_month_income:o,...l}=t;return{...l,category_balances:e,account_balances:n}}async function ET(t,e,n,r){const{year:i,month:o}=gc(e,n),l=Te.month(t,i,o);if(r){const d=r.getQueryData(l);if(d?.month){const h=d.month.income||[];return Me(h.reduce((f,p)=>f+(p.amount||0),0))}}try{const d=Ti(t,i,o),{exists:h,data:f}=await Lt("months",d,`calculating previous_month_income for ${e}/${n}`);if(h&&f){const p=f.income||[];return Me(p.reduce((g,v)=>g+(v.amount||0),0))}}catch(d){console.warn(`[calculatePreviousMonthIncome] Could not fetch previous month ${i}/${o}:`,d)}return 0}async function r4(t,e,n,r,i){const o=t.income||[],l=t.expenses||[],d=o.reduce((g,v)=>g+(v.amount||0),0),h=l.reduce((g,v)=>g+(v.amount||0),0),f=t.previous_month_income!==void 0?t.previous_month_income:await ET(e,n,r,i),p={budget_id:e,year_month_ordinal:t.year_month_ordinal??et(n,r),year:t.year??n,month:t.month??r,income:o,total_income:d,previous_month_income:f,expenses:l,total_expenses:h,transfers:t.transfers||[],adjustments:t.adjustments||[],account_balances:t.account_balances||[],category_balances:t.category_balances||[],are_allocations_finalized:t.are_allocations_finalized??!1,created_at:t.created_at,updated_at:t.updated_at};return _m(p)}async function Dr(t,e,n,r){const i=Ti(t,e,n);return(await Be.fetchQuery({queryKey:Te.month(t,e,n),queryFn:async()=>{const{exists:l,data:d}=await Lt("months",i,r?.description??`reading month ${e}/${n}`);return!l||!d?null:{month:await r4(d,t,e,n,Be)}},staleTime:La}))?.month??null}function s4(t){const e={},n={};return t.category_balances&&t.category_balances.forEach(r=>{e[r.category_id]=r.end_balance}),t.account_balances&&t.account_balances.forEach(r=>{n[r.account_id]=r.end_balance}),{categoryEndBalances:e,accountEndBalances:n}}function TT(){const t=new Date,e=t.getFullYear(),n=t.getMonth()+1,r=[];for(let i=qu;i>0;i--){let o=e,l=n-i;for(;l<1;)l+=12,o-=1;r.push(et(o,l))}r.push(et(e,n));for(let i=1;i<=Ws;i++){let o=e,l=n+i;for(;l>12;)l-=12,o+=1;r.push(et(o,l))}return r}function i4(t,e){const n=Te.budget(t),r=Be.getQueryData(n);if(!r?.monthMap)return!1;const i=TT();for(const o of i)if(o>=e&&!(o in r.monthMap))return!1;return!0}function a4(t,e,n){const r=Te.budget(t),i=Be.getQueryData(r);i&&Be.setQueryData(r,{...i,monthMap:n,budget:{...i.budget,month_map:n}})}function o4(t,e,n){const r=Te.budget(t),i=Be.getQueryData(r);i&&Be.setQueryData(r,{...i,monthMap:e,budget:{...i.budget,month_map:e}})}function l4(t,e,n,r){const i=et(e,n),o=Te.budget(t),l=Be.getQueryData(o);if(!l)return console.warn(`[removeMonthFromMap] Budget ${t} not found in cache`),{};const d=l.monthMap||{},{[i]:h,...f}=d,p=f;return Be.setQueryData(o,{...l,monthMap:p,budget:{...l.budget,month_map:p}}),r&&r({type:"budget",budgetId:t}),p}async function c4(t,e,n,r){const{bypassDateLimit:i=!1}={},o=new Date,l=o.getFullYear(),d=o.getMonth()+1,h=(e-l)*12+(n-d);if(!i&&h>Ws){const P=`[createMonth] Refusing to create month ${e}/${n} - it's ${h} months in the future (max allowed: ${Ws}). This likely indicates a bug in month navigation.`;throw console.error(P),new Error(P)}if(!i&&h<-qu){const P=`[createMonth] Refusing to create month ${e}/${n} - it's ${Math.abs(h)} months in the past (max allowed: ${qu}). Existing months can still be viewed, but new months cannot be created this far back.`;throw console.error(P),new Error(P)}const{exists:f,data:p}=await Lt("budgets",t,"validating budget exists before creating month");if(!f||!p){Be.removeQueries({queryKey:Te.budget(t)});const P=`[createMonth] Budget ${t} does not exist. It may have been deleted. Please refresh the page.`;throw console.error(P),new Error(P)}const g=o.toISOString(),v=Ti(t,e,n);let _=0,C={},x={};if(n>1||e>new Date().getFullYear()-10){const{year:P,month:L}=gc(e,n),q=Ti(t,P,L);try{const{exists:A,data:O}=await Lt("months",q,"fetching previous month to create start balances for new month");if(A&&O){const N={budget_id:t,year_month_ordinal:O.year_month_ordinal??et(P,L),year:O.year??P,month:O.month??L,income:O.income||[],total_income:O.total_income??0,previous_month_income:O.previous_month_income??0,expenses:O.expenses||[],total_expenses:O.total_expenses??0,transfers:O.transfers||[],adjustments:O.adjustments||[],account_balances:O.account_balances||[],category_balances:O.category_balances||[],are_allocations_finalized:O.are_allocations_finalized??!1,created_at:O.created_at,updated_at:O.updated_at};_=N.total_income;const{categoryEndBalances:J,accountEndBalances:Y}=s4(N);C=J,x=Y}}catch(A){if(A instanceof Error&&A.message.includes("Missing or insufficient permissions"))console.warn(`[createMonth] Permission error reading previous month ${P}/${L}, starting with zero balances`);else throw A}}const w=ym(e,n),E=Object.entries(C).map(([P,L])=>({category_id:P,start_balance:w?L:0,allocated:0,spent:0,transfers:0,adjustments:0,end_balance:L})),T=Object.entries(x).map(([P,L])=>({account_id:P,start_balance:w?L:0,income:0,expenses:0,transfers:0,adjustments:0,net_change:0,end_balance:L})),R={budget_id:t,year_month_ordinal:et(e,n),year:e,month:n,income:[],total_income:0,previous_month_income:_,expenses:[],total_expenses:0,transfers:[],adjustments:[],account_balances:T,category_balances:E,are_allocations_finalized:!1,created_at:g,updated_at:g},M={budget_id:t,year_month_ordinal:et(e,n),year:e,month:n,income:[],expenses:[],transfers:[],adjustments:[],account_balances:T,category_balances:E,are_allocations_finalized:!1,created_at:g,updated_at:g};await or("months",v,M,"creating new month document (first time viewing this month)"),Be.setQueryData(Te.month(t,e,n),{month:R});const V=et(e,n),I={...p.month_map||{},[V]:{}},D=I;return o4(t,D),await Df("budgets",t,{month_map:D,updated_at:g},`adding month ${e}/${n} to budget month_map`),R}async function u4(t,e,n,r,i){const o=t.income||[],l=t.expenses||[],d=o.reduce((g,v)=>g+(v.amount||0),0),h=l.reduce((g,v)=>g+(v.amount||0),0),f=t.previous_month_income!==void 0?t.previous_month_income:await ET(e,n,r,i),p={budget_id:e,year_month_ordinal:t.year_month_ordinal??et(n,r),year:t.year??n,month:t.month??r,income:o,total_income:d,previous_month_income:f,expenses:l,total_expenses:h,transfers:t.transfers||[],adjustments:t.adjustments||[],account_balances:t.account_balances||[],category_balances:t.category_balances||[],are_allocations_finalized:t.are_allocations_finalized??!1,created_at:t.created_at,updated_at:t.updated_at};return _m(p)}async function Hu(t,e,n){const r=Ti(t,e,n);try{const{exists:i,data:o}=await Lt("months",r,`loading month ${e}/${n}`);return!i||!o?null:await u4(o,t,e,n)}catch(i){if(i instanceof Error&&i.message.includes("Missing or insufficient permissions"))return console.warn(`[readMonthDirect] Permission error reading month ${e}/${n}, treating as not found`),null;throw i}}async function d4(t,e,n,r){const i=await Hu(t,e,n);if(i)return i;let o=!1;if(r){const l=r.getQueryData(Te.budget(t));l?.monthMap&&(o=et(e,n)in l.monthMap)}else{const{exists:l,data:d}=await Lt("budgets",t,"checking month_map before creating month");if(l&&d?.month_map){const h=et(e,n),f=d.month_map;o=h in f}}if(o)return c4(t,e,n);throw new Error(`Month ${e}/${n} does not exist in budget. Cannot create months that are not in month_map.`)}function h4(t,e,n,r){const i=$t(),{initialDataLoadComplete:o}=Xe(),l=t?Te.month(t,e,n):["month","none"],d=!!t&&r?.enabled!==!1&&o;return Pa({queryKey:l,queryFn:async()=>({month:await d4(t,e,n,i)}),enabled:d,staleTime:La})}async function F0(t){const{exists:e,data:n}=await Lt("payees",t,"loading payees for autocomplete (cache miss or stale)");return e&&n?n.payees||[]:[]}function V0(t,e){const{initialDataLoadComplete:n}=Xe(),r=!!t&&e?.enabled!==!1&&n;return Pa({queryKey:t?Te.payees(t):["payees","none"],queryFn:()=>F0(t),enabled:r,staleTime:La})}async function f4(t,e){const{exists:n,data:r}=await Lt("users",t,"loading user profile (cache miss or stale)");if(n&&r)return r;const i={uid:t,email:e,budget_ids:[],created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return await or("users",t,i,"creating new user document (first login)"),i}function m4(t,e,n){return Pa({queryKey:t?Te.user(t):["user","none"],queryFn:()=>f4(t,e),enabled:!!t&&n?.enabled!==!1})}async function p4(t,e){const n=await Fn("budgets","loading budgets user has access to (cache miss or stale)",[{field:"user_ids",op:"array-contains",value:t}]),r=[],i=[];for(const o of n.docs){const l=o.data;l.accepted_user_ids?.includes(t)||e?.budget_ids?.includes(o.id)?r.push({id:o.id,name:l.name||"Unnamed Budget",ownerEmail:l.owner_email||null,isOwner:l.owner_id===t,isPending:!1}):i.push({budgetId:o.id,budgetName:l.name||"Unnamed Budget",ownerEmail:l.owner_email||null})}return{budgets:r,pendingInvites:i}}function g4(t,e,n){return Pa({queryKey:t?Te.accessibleBudgets(t):["accessibleBudgets","none"],queryFn:async()=>t?p4(t,e):{budgets:[],pendingInvites:[]},enabled:!!t&&n?.enabled!==!1,staleTime:60*1e3})}function y4(t){if(Array.isArray(t))return t;if(t&&typeof t=="object"&&!Array.isArray(t)){const e=t;if(e._methodName==="arrayUnion"&&Array.isArray(e.vc))return console.warn("[fetchFeedback] Found corrupted arrayUnion in feedback document - extracting items from vc"),e.vc}return[]}async function _4(){const t=await Fn("feedback","admin loading all feedback (cache miss or stale)"),e=[];for(const n of t.docs){const r=y4(n.data.items),i=n.data.user_email||n.id;r.forEach(o=>{e.push({...o,doc_id:n.id,user_email:i})})}return{items:e}}function b4(t){return Pa({queryKey:Te.feedback(),queryFn:_4,enabled:t?.enabled!==!1})}const v4="modulepreload",x4=function(t){return"/"+t},I1={},$0=function(e,n,r){let i=Promise.resolve();if(n&&n.length>0){let f=function(p){return Promise.all(p.map(g=>Promise.resolve(g).then(v=>({status:"fulfilled",value:v}),v=>({status:"rejected",reason:v}))))};var l=f;document.getElementsByTagName("link");const d=document.querySelector("meta[property=csp-nonce]"),h=d?.nonce||d?.getAttribute("nonce");i=f(n.map(p=>{if(p=x4(p),p in I1)return;I1[p]=!0;const g=p.endsWith(".css"),v=g?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${p}"]${v}`))return;const _=document.createElement("link");if(_.rel=g?"stylesheet":v4,g||(_.as="script"),_.crossOrigin="",_.href=p,h&&_.setAttribute("nonce",h),document.head.appendChild(_),g)return new Promise((C,x)=>{_.addEventListener("load",C),_.addEventListener("error",()=>x(new Error(`Unable to preload CSS for ${p}`)))})}))}function o(d){const h=new Event("vite:preloadError",{cancelable:!0});if(h.payload=d,window.dispatchEvent(h),!h.defaultPrevented)throw d}return i.then(d=>{for(const h of d||[])h.status==="rejected"&&o(h.reason);return e().catch(o)})},vm={categoryEndBalances:{},accountEndBalances:{},totalIncome:0};function Gu(t,e){const n=t.income||[],r=t.expenses||[],i=Me(n.reduce((g,v)=>g+v.amount,0)),o=Me(r.reduce((g,v)=>g+v.amount,0)),{transfersMap:l,adjustmentsMap:d}=w4(t),h={};for(const g of r)Je(g.category_id)||(h[g.category_id]=(h[g.category_id]||0)+g.amount);for(const g of Object.keys(h))h[g]=Me(h[g]);const f=S4(t.category_balances,e.categoryEndBalances,l,d,h),p=C4(t,e.accountEndBalances);return{...t,total_income:i,total_expenses:o,previous_month_income:e.totalIncome,category_balances:f,account_balances:p,updated_at:new Date().toISOString()}}function w4(t){const e={},n={};for(const r of t.transfers||[])Je(r.from_category_id)||(e[r.from_category_id]=(e[r.from_category_id]||0)-r.amount),Je(r.to_category_id)||(e[r.to_category_id]=(e[r.to_category_id]||0)+r.amount);for(const r of t.adjustments||[])Je(r.category_id)||(n[r.category_id]=(n[r.category_id]||0)+r.amount);for(const r of Object.keys(e))e[r]=Me(e[r]);for(const r of Object.keys(n))n[r]=Me(n[r]);return{transfersMap:e,adjustmentsMap:n}}function S4(t,e,n,r,i){const o=new Map;for(const h of t)Je(h.category_id)||o.set(h.category_id,h);const l=new Set;for(const h of t)Je(h.category_id)||l.add(h.category_id);for(const h of Object.keys(e))Je(h)||l.add(h);for(const h of Object.keys(n))Je(h)||l.add(h);for(const h of Object.keys(r))Je(h)||l.add(h);const d=[];for(const h of l){const f=o.get(h),p=Me(e[h]??0),g=Me(f?.allocated??0),v=Me(i[h]??0),_=Me(n[h]??0),C=Me(r[h]??0);d.push({category_id:h,start_balance:p,allocated:g,spent:v,transfers:_,adjustments:C,end_balance:Me(p+g+v+_+C)})}return d}function C4(t,e){const n=new Set;for(const i of t.income||[])We(i.account_id)||n.add(i.account_id);for(const i of t.expenses||[])We(i.account_id)||n.add(i.account_id);for(const i of t.transfers||[])We(i.from_account_id)||n.add(i.from_account_id),We(i.to_account_id)||n.add(i.to_account_id);for(const i of t.adjustments||[])We(i.account_id)||n.add(i.account_id);for(const i of Object.keys(e))We(i)||n.add(i);for(const i of t.account_balances||[])We(i.account_id)||n.add(i.account_id);const r=[];for(const i of n){const o=Me(e[i]??0),l=Me((t.income||[]).filter(_=>_.account_id===i).reduce((_,C)=>_+C.amount,0)),d=Me((t.expenses||[]).filter(_=>_.account_id===i).reduce((_,C)=>_+C.amount,0)),h=Me((t.transfers||[]).filter(_=>_.from_account_id===i).reduce((_,C)=>_-C.amount,0)),f=Me((t.transfers||[]).filter(_=>_.to_account_id===i).reduce((_,C)=>_+C.amount,0)),p=Me(f+h),g=Me((t.adjustments||[]).filter(_=>_.account_id===i).reduce((_,C)=>_+C.amount,0)),v=Me(l+d+p+g);r.push({account_id:i,start_balance:o,income:l,expenses:d,transfers:p,adjustments:g,net_change:v,end_balance:Me(o+v)})}return r}function tc(t){const e={},n={};for(const r of t.category_balances||[])Je(r.category_id)||(e[r.category_id]=Me(r.end_balance));for(const r of t.account_balances||[])We(r.account_id)||(n[r.account_id]=Me(r.end_balance));return{categoryEndBalances:e,accountEndBalances:n,totalIncome:Me(t.total_income)}}async function E4(t,e){return Be.fetchQuery({queryKey:["budgetInvite",t,e],queryFn:async()=>{const{exists:n,data:r}=await Lt("budgets",t,"checking if user has pending invite for budget");return!n||!r?null:{isInvited:r.user_ids?.includes(e)??!1,hasAccepted:r.accepted_user_ids?.includes(e)??!1,budgetName:r.name||"Unnamed Budget",ownerEmail:r.owner_email||null}},staleTime:60*1e3})}async function Py(t,e,n){const r=await Dr(t,e,n,{description:`fetching month for balance calculation (walking ${e}/${n})`});return r?{year:r.year,month:r.month,category_balances:r.category_balances,are_allocations_finalized:r.are_allocations_finalized,expenses:r.expenses}:null}async function T4(t,e,n,r){const i={};e.forEach(v=>{i[v]=0});const o=await Py(t,n,r);if(o?.category_balances){for(const v of o.category_balances)e.includes(v.category_id)&&(i[v.category_id]=v.end_balance);return i}const l={};e.forEach(v=>{l[v]=0});const d=[];o&&d.push(o);let h=n,f=r,p=!1;const g=120;for(let v=0;v<g&&!p;v++){const _=gc(h,f);h=_.year,f=_.month;const C=await Py(t,h,f);if(!C)p=!0;else if(C.category_balances){p=!0;for(const x of C.category_balances)e.includes(x.category_id)&&(l[x.category_id]=x.end_balance)}else d.push(C)}d.reverse(),Object.assign(i,l);for(const v of d){if(v.are_allocations_finalized&&v.category_balances)for(const _ of v.category_balances)e.includes(_.category_id)&&(i[_.category_id]=(i[_.category_id]||0)+_.allocated);if(v.expenses)for(const _ of v.expenses)e.includes(_.category_id)&&(i[_.category_id]=(i[_.category_id]||0)-_.amount)}return i}async function q0(t,e,n,r,i){const o={...n},d=Be.getQueryData(Te.budget(t))?.monthMap||{},h=new Date,f=h.getFullYear(),p=h.getMonth()+1;let g=f,v=p+Ws;for(;v>12;)v-=12,g+=1;const _=et(g,v);let C=r,x=i;const w=Ws*2;for(let E=0;E<w;E++){const T=L0(C,x);C=T.year,x=T.month;const R=et(C,x);if(R>_||!(R in d))break;const M=await Py(t,C,x);if(!M)break;if(M.are_allocations_finalized&&M.category_balances)for(const V of M.category_balances)e.includes(V.category_id)&&(o[V.category_id]=(o[V.category_id]||0)+V.allocated);if(M.expenses)for(const V of M.expenses)e.includes(V.category_id)&&(o[V.category_id]=(o[V.category_id]||0)-V.amount)}return o}async function Wg(t,e,n,r){const i=await T4(t,e,n,r),o=await q0(t,e,i,n,r);return{current:i,total:o}}function A4(t={}){const e={};return Object.keys(t).forEach(n=>{e[n]={}}),e}function j4(t,e,n){const r=Object.entries(t).reduce((o,[,l])=>{const d=l.account_group_id?n[l.account_group_id]:void 0,h=d&&d.on_budget!==null?d.on_budget:l.on_budget!==!1,f=d&&d.is_active!==null?d.is_active:l.is_active!==!1;return h&&f?o+(l.balance??0):o},0),i=Object.values(e).reduce((o,l)=>{const d=l.balance??0;return o+(d>0?d:0)},0);return Me(r-i)}async function AT(t,e,n,r){const{exists:i,data:o}=await Lt("budgets",t,"[recalc] reading budget for cache update");if(!i||!o)return;const l={...o.accounts};for(const[p,g]of Object.entries(e))l[p]&&(l[p]={...l[p],balance:Me(g)});const d={...o.categories};for(const[p,g]of Object.entries(n))d[p]&&(d[p]={...d[p],balance:Me(g)});const h=j4(l,d,o.account_groups||{}),{writeBudgetData:f}=await $0(async()=>{const{writeBudgetData:p}=await Promise.resolve().then(()=>VT);return{writeBudgetData:p}},[]);await f({budgetId:t,updates:{month_map:r},description:"[recalc] updating month_map"}),R4(t,l,d,h,r)}function R4(t,e,n,r,i){const o=Be.getQueryData(Te.budget(t));if(o){const l={};for(const[h,f]of Object.entries(o.accounts)){const p=e[h];p&&p.balance!==void 0?l[h]={...f,balance:Me(p.balance)}:l[h]=f}const d={};for(const[h,f]of Object.entries(o.categories)){const p=n[h];p&&p.balance!==void 0?d[h]={...f,balance:Me(p.balance)}:d[h]=f}Be.setQueryData(Te.budget(t),{...o,accounts:l,categories:d,accountGroups:o.accountGroups,categoryGroups:o.categoryGroups,monthMap:i,budget:{...o.budget,accounts:l,categories:d,account_groups:o.budget.account_groups,category_groups:o.budget.category_groups,month_map:i}})}}async function I4(t,e,n){const r=et(e,n);if(i4(t,r))return{markedCount:0,budgetUpdated:!1};const{exists:i,data:o}=await Lt("budgets",t,"reading budget for month_map update");if(!i||!o)return console.warn(`[markMonthsNeedRecalculation] Budget ${t} not found`),{markedCount:0,budgetUpdated:!1};const d={...o.month_map||{}},h=TT();let f=0;for(const g of h)g>=r&&!(g in d)&&(d[g]={},f++);if(f===0)return{markedCount:0,budgetUpdated:!1};const p=d;return a4(t,r,p),await Df("budgets",t,{month_map:p,updated_at:new Date().toISOString()},`adding ${f} month(s) to budget month_map`),{markedCount:f,budgetUpdated:!0}}async function jT(t,e,n){const r=Ti(t,e.year,e.month),i=bm(e);await or("months",r,i,`writeMonthData: ${n}`)}async function RT(t,e,n){await I4(t,e,n)}async function H0(t){const{budgetId:e,month:n,description:r,cascadeRecalculation:i=!0}=t;await jT(e,n,r||`${n.year}/${n.month}`),Be.setQueryData(Te.month(e,n.year,n.month),{month:n}),i&&await RT(e,n.year,n.month)}function k4(){const t=$t();return{writeData:Wn({mutationFn:async({budgetId:n,month:r,description:i,cascadeRecalculation:o=!0})=>(await jT(n,r,i||`${r.year}/${r.month}`),{budgetId:n,year:r.year,month:r.month,cascadeRecalculation:o}),onMutate:async({budgetId:n,month:r})=>{const i=Te.month(n,r.year,r.month);await t.cancelQueries({queryKey:i});const o=t.getQueryData(i);return t.setQueryData(i,{month:r}),{oldMonthQueryData:o,monthKey:i}},onSuccess:async({budgetId:n,year:r,month:i,cascadeRecalculation:o})=>{o&&await RT(n,r,i)},onError:(n,r,i)=>{i?.oldMonthQueryData&&t.setQueryData(i.monthKey,i.oldMonthQueryData)}})}}function D4(){const{writeData:t}=k4();return{saveDraftAllocations:async(n,r,i,o)=>{const l=await Dr(n,r,i);if(!l)throw new Error(`Month not found: ${r}/${i}`);const{calculateCategoryBalances:d}=await $0(async()=>{const{calculateCategoryBalances:g}=await Promise.resolve().then(()=>G6);return{calculateCategoryBalances:g}},void 0),h=l.category_balances.map(g=>({category_id:g.category_id,start_balance:g.start_balance,allocated:o[g.category_id]??g.allocated})),f=d(h,l.expenses||[],l.transfers||[],l.adjustments||[]),p={...l,category_balances:f,updated_at:new Date().toISOString()};return await t.mutateAsync({budgetId:n,month:p,cascadeRecalculation:!1}),{updatedMonth:p}},isPending:t.isPending,isError:t.isError,error:t.error}}const fe={primary:"#646cff",error:"#f87171",errorBg:"rgba(220, 38, 38, 0.1)",errorBorder:"rgba(220, 38, 38, 0.3)",success:"#4ade80",danger:"#f87171",warning:"#facc15",debt:"#fb923c",zero:"rgba(255, 255, 255, 0.4)"},ds={textDecoration:"underline",textDecorationStyle:"dotted",textUnderlineOffset:"3px"},Oa="1px solid color-mix(in srgb, currentColor 20%, transparent)",Mf={maxWidth:"var(--page-max-width, 85rem)",margin:"0 auto",padding:"var(--page-padding, 2rem)"},G0={background:"color-mix(in srgb, currentColor 8%, transparent)",padding:"1rem 1.25rem",borderRadius:"8px",display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem"},M4={background:"color-mix(in srgb, currentColor 8%, transparent)",padding:"1.25rem",borderRadius:"8px",display:"flex",flexDirection:"column",gap:"1rem"},O4={display:"flex",flexDirection:"column",gap:"0.5rem"},N4={fontSize:"0.9rem",fontWeight:500},Va={padding:"0.6rem 0.8rem",borderRadius:"6px",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"1rem",color:"inherit",width:"100%",boxSizing:"border-box"},P4={...Va,cursor:"pointer"},W0={padding:"0.6rem 1.25rem",borderRadius:"6px",cursor:"pointer",fontWeight:500,fontSize:"0.9rem",transition:"opacity 0.15s"},IT={...W0,background:fe.primary,color:"white",border:"none"},B4={...IT,padding:"0.75rem 1.5rem",borderRadius:"8px"},z4={...W0,background:"transparent",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)"},L4={...W0,background:"transparent",border:`1px solid ${fe.errorBorder}`,color:fe.error},U4={background:"transparent",border:"1px solid color-mix(in srgb, currentColor 25%, transparent)",padding:"0.35rem 0.75rem",borderRadius:"6px",cursor:"pointer",fontSize:"0.8rem",opacity:.8,transition:"opacity 0.15s"},ya={background:"transparent",border:"1px solid color-mix(in srgb, currentColor 15%, transparent)",padding:"0.25rem 0.35rem",borderRadius:"4px",cursor:"pointer",fontSize:"0.75rem",lineHeight:1,display:"flex",alignItems:"center",justifyContent:"center",opacity:.6,transition:"opacity 0.15s, background 0.15s"},Of={display:"flex",flexDirection:"column",gap:"2px"},F4={display:"flex",gap:"0.75rem",marginTop:"0.5rem"},V4={opacity:.4,cursor:"grab"},$4={position:"absolute",top:"-4px",left:0,right:0,height:"3px",background:fe.primary,borderRadius:"2px",transition:"opacity 0.15s"},q4={position:"relative",height:"2rem",marginTop:"-0.25rem"},H4={position:"absolute",top:"50%",left:0,right:0,height:"3px",background:fe.primary,borderRadius:"2px",transition:"opacity 0.15s"},G4={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"0.75rem",opacity:.7,background:"var(--background, #1a1a1a)",padding:"0 0.5rem",whiteSpace:"nowrap"},W4={background:fe.errorBg,border:`1px solid ${fe.errorBorder}`,color:fe.error,padding:"0.75rem 1rem",borderRadius:"8px",marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem"},Q4={background:"transparent",border:"none",color:fe.error,cursor:"pointer",fontSize:"1.2rem",padding:"0 0.25rem",lineHeight:1},kT={opacity:.7,marginBottom:"1.5rem"},k1={display:"flex",flexDirection:"column",gap:"0.5rem",marginBottom:"1.5rem"};function xm({message:t,children:e,onDismiss:n,style:r}){return u.jsxs("div",{style:{...W4,...r},children:[u.jsx("span",{children:e??t}),n&&u.jsx("button",{onClick:n,style:Q4,children:""})]})}const K4={primary:IT,"primary-large":B4,secondary:z4,danger:L4,small:U4},Y4={position:"absolute",bottom:"100%",left:"50%",transform:"translateX(-50%)",background:fe.warning,color:"#1a1a1a",padding:"0.5rem 0.75rem",borderRadius:"6px",fontSize:"0.8rem",fontWeight:500,whiteSpace:"nowrap",marginBottom:"0.5rem",zIndex:100,boxShadow:"0 2px 8px rgba(0,0,0,0.3)",animation:"tooltipFadeIn 0.15s ease-out"},X4={position:"absolute",top:"100%",left:"50%",transform:"translateX(-50%)",width:0,height:0,borderLeft:"6px solid transparent",borderRight:"6px solid transparent",borderTop:`6px solid ${fe.warning}`};function Ve({variant:t="primary",isLoading:e,loadingText:n="Saving...",children:r,disabled:i,style:o,actionName:l,disabledReason:d,onClick:h,...f}){const p=K4[t],g=i||e,[v,_]=k.useState(!1);function C(E){h?.(E)}function x(E){g&&d&&(E.preventDefault(),E.stopPropagation(),_(!0),setTimeout(()=>_(!1),3e3))}const w=g?{cursor:"not-allowed",opacity:.35,filter:"grayscale(50%)"}:{};return u.jsxs("div",{style:{position:"relative",display:"inline-block"},onClick:x,children:[v&&d&&u.jsxs("div",{style:Y4,children:[d,u.jsx("div",{style:X4})]}),u.jsx("button",{disabled:g,style:{...p,cursor:g?"not-allowed":"pointer",...w,...o},onClick:C,...f,children:e?n:r})]})}function DT(t,e){const n=t.toLowerCase(),r=e.toLowerCase();if(r.includes(n)){const d=r.indexOf(n);return{match:!0,score:d===0||/\s/.test(r[d-1])?100:90}}let i=0,o=0,l=0;for(let d=0;d<r.length&&i<n.length;d++)r[d]===n[i]?(i++,l++,o+=l*2):l=0;return i===n.length?{match:!0,score:o}:{match:!1,score:0}}function MT(t){return[...t].sort((e,n)=>!e.groupId&&n.groupId?1:e.groupId&&!n.groupId?-1:!e.groupId&&!n.groupId?e.sortOrder-n.sortOrder:e.groupSortOrder!==n.groupSortOrder?e.groupSortOrder-n.groupSortOrder:e.sortOrder-n.sortOrder)}function OT(t){const e=MT(t),n=[];let r="__initial__";return e.forEach(i=>{i.groupId!==r&&(r=i.groupId,n.push({groupId:i.groupId,groupName:i.groupName,groupSortOrder:i.groupSortOrder,items:[]})),n[n.length-1].items.push(i)}),n}function NT(t,e,n){return e.trim()?t.map(i=>{const o=n(i);let l=0,d=!1;for(const h of o){const f=DT(e,h);f.match&&(d=!0,l=Math.max(l,f.score))}return{item:i,score:l,hasMatch:d}}).filter(({hasMatch:i})=>i).sort((i,o)=>o.score!==i.score?o.score-i.score:!i.item.groupId&&o.item.groupId?1:i.item.groupId&&!o.item.groupId?-1:i.item.groupSortOrder!==o.item.groupSortOrder?i.item.groupSortOrder-o.item.groupSortOrder:i.item.sortOrder-o.item.sortOrder).map(({item:i})=>i):MT(t)}const Q0={position:"absolute",top:"100%",left:0,right:0,marginTop:"4px",background:"var(--background, #1a1a1a)",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",borderRadius:"6px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",zIndex:1e3},Wu={padding:"0.6rem 0.8rem",cursor:"pointer",transition:"background 0.1s"};function D1({id:t,value:e,onChange:n,payees:r,placeholder:i="Enter payee name",autoFocus:o}){const[l,d]=k.useState(!1),[h,f]=k.useState(-1),p=k.useRef(null),g=k.useRef(null),v=e.trim()?r.map(x=>({payee:x,...DT(e,x)})).filter(x=>x.match).sort((x,w)=>w.score-x.score).slice(0,8).map(x=>x.payee):[];k.useEffect(()=>{function x(w){p.current&&!p.current.contains(w.target)&&d(!1)}return document.addEventListener("mousedown",x),()=>document.removeEventListener("mousedown",x)},[]);function _(x){!l||v.length===0||(x.key==="ArrowDown"?(x.preventDefault(),f(w=>Math.min(w+1,v.length-1))):x.key==="ArrowUp"?(x.preventDefault(),f(w=>Math.max(w-1,-1))):x.key==="Enter"&&h>=0?(x.preventDefault(),n(v[h]),d(!1),f(-1)):x.key==="Escape"&&(d(!1),f(-1)))}function C(x){n(x),d(!1),f(-1),g.current?.focus()}return u.jsxs("div",{ref:p,style:{position:"relative"},children:[u.jsx("input",{ref:g,id:t,type:"text",value:e,onChange:x=>{n(x.target.value),d(!0),f(-1)},onFocus:()=>d(!0),onKeyDown:_,placeholder:i,autoComplete:"off",autoFocus:o,style:Va}),l&&v.length>0&&u.jsx("div",{style:{...Q0,maxHeight:"200px",overflowY:"auto"},children:v.map((x,w)=>u.jsx("div",{onClick:()=>C(x),style:{...Wu,background:w===h?`color-mix(in srgb, ${fe.primary} 20%, transparent)`:"transparent",borderBottom:w<v.length-1?"1px solid color-mix(in srgb, currentColor 10%, transparent)":"none"},onMouseEnter:()=>f(w),children:x},x))})]})}function PT({id:t,value:e,onChange:n,categories:r,categoryGroups:i,placeholder:o="Search categories...",required:l,showNoCategoryOption:d=!1,showHiddenCategories:h=!1}){const f=Object.fromEntries(i.map(G=>[G.id,G.name])),p=Object.fromEntries(i.map(G=>[G.id,G.sort_order])),g=h?r:Object.fromEntries(Object.entries(r).filter(([,G])=>!G.is_hidden)),v=Object.entries(g).map(([G,Z])=>({id:G,name:Z.name,groupId:Z.category_group_id,groupName:Z.category_group_id&&f[Z.category_group_id]||null,sortOrder:Z.sort_order,groupSortOrder:Z.category_group_id?p[Z.category_group_id]??999:999})),_=e===Xt,C=_?null:e?r[e]:null,x=_?"":C?.name||"",[w,E]=k.useState(x),[T,R]=k.useState(!1),[M,V]=k.useState(-1),$=k.useRef(null),I=k.useRef(null);k.useEffect(()=>{if(e===Xt)E("");else if(e){const G=r[e];E(G?.name||"")}},[e,r]);const D=NT(v,w,G=>[G.name]),P=OT(D);k.useEffect(()=>{function G(Z){if($.current&&!$.current.contains(Z.target))if(R(!1),e===Xt)E("");else{const Q=e?r[e]:null;E(Q?.name||"")}}return document.addEventListener("mousedown",G),()=>document.removeEventListener("mousedown",G)},[e,r]);function L(G){if(G.key==="ArrowDown")G.preventDefault(),T?V(Z=>Math.min(Z+1,D.length-1)):(R(!0),V(0));else if(G.key==="ArrowUp")G.preventDefault(),V(Z=>Math.max(Z-1,0));else if(G.key==="Enter")G.preventDefault(),T&&M>=0&&D[M]&&q(D[M]);else if(G.key==="Escape")if(R(!1),V(-1),e===Xt)E("");else{const Z=e?r[e]:null;E(Z?.name||"")}else if(G.key==="Tab")if(T&&M>=0&&D[M])q(D[M]);else if(R(!1),V(-1),e===Xt)E("");else{const Z=e?r[e]:null;E(Z?.name||"")}}function q(G){n(G.id),E(G.id===Xt?"":G.name),R(!1),V(-1)}function A(){n(Xt),E(""),R(!1),V(-1)}function O(G){const Z=G.target.value;E(Z),R(!0),V(Z.trim()?0:-1),Z!==x&&(d&&Z.trim()===""?n(Xt):n(""))}function N(){R(!0),d&&(e===Xt||w.trim()==="")?V(-1):D.length>0&&V(0)}let J=-1;const Y=()=>++J;return u.jsxs("div",{ref:$,style:{position:"relative"},children:[u.jsx("input",{ref:I,id:t,type:"text",value:w,onChange:O,onFocus:N,onKeyDown:L,placeholder:o,autoComplete:"off",required:l&&!d,style:{...Va,borderColor:l&&!e?fe.error:void 0}}),T&&u.jsxs("div",{style:{...Q0,maxHeight:"250px",overflowY:"auto"},children:[d&&u.jsx("div",{onClick:A,onMouseEnter:()=>V(-1),style:{...Wu,opacity:.7,fontStyle:"italic",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)",background:M===-1?`color-mix(in srgb, ${fe.primary} 20%, transparent)`:"transparent"},children:No}),P.map((G,Z)=>u.jsxs("div",{children:[G.groupName&&u.jsx("div",{style:{padding:"0.4rem 0.8rem",fontSize:"0.75rem",textTransform:"uppercase",letterSpacing:"0.5px",opacity:.6,background:"color-mix(in srgb, currentColor 5%, transparent)",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},children:G.groupName}),G.items.map(Q=>{const te=Y();return u.jsx("div",{onClick:()=>q(Q),style:{...Wu,paddingLeft:G.groupName?"1.2rem":"0.8rem",background:te===M?`color-mix(in srgb, ${fe.primary} 20%, transparent)`:"transparent",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},onMouseEnter:()=>V(te),children:Q.name},Q.id)})]},`group-${Z}`)),D.length===0&&w.trim()&&!d&&u.jsx("div",{style:{padding:"0.6rem 0.8rem",opacity:.6,fontStyle:"italic"},children:"No matching categories"})]})]})}function BT({id:t,value:e,onChange:n,accounts:r,accountGroups:i,placeholder:o="Search accounts...",required:l,showNoAccountOption:d=!1,showHiddenAccounts:h=!1}){const p=(h?r:r.filter(([,J])=>!J.is_hidden)).map(([J,Y])=>({id:J,name:Y.nickname,groupId:Y.account_group_id,groupName:Y.account_group_id&&i[Y.account_group_id]?.name||null,sortOrder:Y.sort_order,groupSortOrder:Y.account_group_id?i[Y.account_group_id]?.sort_order??999:999})),g=e===Gt,v=g?null:r.find(([J])=>J===e)?.[1],_=g?"":v?.nickname||"",[C,x]=k.useState(_),[w,E]=k.useState(!1),[T,R]=k.useState(-1),M=k.useRef(null),V=k.useRef(null);k.useEffect(()=>{if(e===Gt)x("");else if(e){const J=r.find(([Y])=>Y===e)?.[1];x(J?.nickname||"")}},[e,r]);const $=NT(p,C,J=>[J.name]),I=OT($);k.useEffect(()=>{function J(Y){if(M.current&&!M.current.contains(Y.target))if(E(!1),e===Gt)x("");else{const G=r.find(([Z])=>Z===e)?.[1];x(G?.nickname||"")}}return document.addEventListener("mousedown",J),()=>document.removeEventListener("mousedown",J)},[e,r]);function D(J){if(J.key==="ArrowDown")J.preventDefault(),w?R(Y=>Math.min(Y+1,$.length-1)):(E(!0),R(0));else if(J.key==="ArrowUp")J.preventDefault(),R(Y=>Math.max(Y-1,0));else if(J.key==="Enter")J.preventDefault(),w&&T>=0&&$[T]&&P($[T]);else if(J.key==="Escape")if(E(!1),R(-1),e===Gt)x("");else{const Y=r.find(([G])=>G===e)?.[1];x(Y?.nickname||"")}else if(J.key==="Tab")if(w&&T>=0&&$[T])P($[T]);else if(E(!1),R(-1),e===Gt)x("");else{const Y=r.find(([G])=>G===e)?.[1];x(Y?.nickname||"")}}function P(J){n(J.id),x(J.id===Gt?"":J.name),E(!1),R(-1)}function L(){n(Gt),x(""),E(!1),R(-1)}function q(J){const Y=J.target.value;x(Y),E(!0),R(Y.trim()?0:-1),Y!==_&&(d&&Y.trim()===""?n(Gt):n(""))}function A(){E(!0),d&&(e===Gt||C.trim()==="")?R(-1):$.length>0&&R(0)}let O=-1;const N=()=>++O;return u.jsxs("div",{ref:M,style:{position:"relative"},children:[u.jsx("input",{ref:V,id:t,type:"text",value:C,onChange:q,onFocus:A,onKeyDown:D,placeholder:o,autoComplete:"off",required:l&&!d,style:{...Va,borderColor:l&&!e?fe.error:void 0}}),w&&u.jsxs("div",{style:{...Q0,maxHeight:"250px",overflowY:"auto"},children:[d&&u.jsx("div",{onClick:L,onMouseEnter:()=>R(-1),style:{...Wu,opacity:.7,fontStyle:"italic",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)",background:T===-1?`color-mix(in srgb, ${fe.primary} 20%, transparent)`:"transparent"},children:Ma}),I.map((J,Y)=>u.jsxs("div",{children:[J.groupName&&u.jsx("div",{style:{padding:"0.4rem 0.8rem",fontSize:"0.75rem",textTransform:"uppercase",letterSpacing:"0.5px",opacity:.6,background:"color-mix(in srgb, currentColor 5%, transparent)",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},children:J.groupName}),J.items.map(G=>{const Z=N();return u.jsx("div",{onClick:()=>P(G),style:{...Wu,paddingLeft:J.groupName?"1.2rem":"0.8rem",background:Z===T?`color-mix(in srgb, ${fe.primary} 20%, transparent)`:"transparent",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},onMouseEnter:()=>R(Z),children:G.name},G.id)})]},`group-${Y}`)),$.length===0&&C.trim()&&!d&&u.jsx("div",{style:{padding:"0.6rem 0.8rem",opacity:.6,fontStyle:"italic"},children:"No matching accounts"})]})]})}function ji({children:t,onSubmit:e,actionName:n}){function r(i){e(i)}return u.jsx("form",{onSubmit:r,style:M4,children:t})}function Nt({label:t,htmlFor:e,children:n,hint:r,style:i}){return u.jsxs("div",{style:{...O4,...i},children:[u.jsx("label",{htmlFor:e,style:N4,children:t}),n,r&&u.jsx("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.85rem",opacity:.6},children:r})]})}function Ri(t){return u.jsx("input",{style:Va,...t})}function Z4(t){if(!t)return"";try{return new Date(t+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"})}catch{return t}}function Nf({value:t,onChange:e,style:n,autoFocus:r,...i}){const o=k.useRef(null),l=k.useRef(null),d=Z4(t);k.useEffect(()=>{r&&l.current?.focus()},[r]);function h(){o.current?.showPicker?.()}function f(p){p.key==="Enter"&&(p.preventDefault(),o.current?.showPicker?.())}return u.jsxs("div",{style:{position:"relative"},children:[u.jsx("input",{ref:o,type:"date",value:t||"",onChange:e,style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",opacity:0,pointerEvents:"none"},...i}),u.jsx("div",{ref:l,tabIndex:0,onClick:h,onKeyDown:f,style:{...Va,cursor:"pointer",display:"flex",alignItems:"center",fontSize:"0.85rem",fontFamily:"monospace",color:t?"inherit":"color-mix(in srgb, currentColor 50%, transparent)",...n},children:d||"Select date"})]})}function Qu({children:t,...e}){return u.jsx("select",{style:P4,...e,children:t})}function K0({minHeight:t="6rem",style:e,...n}){return u.jsx("textarea",{style:{...Va,width:"100%",minHeight:t,resize:"vertical",fontFamily:"inherit",boxSizing:"border-box",...e},...n})}function $a({children:t}){return u.jsx("div",{style:F4,children:t})}function Qg(t){const n=t.replace(/[^\d.]/g,"").split("."),r=n[0]||"",i=n[1],o=r.replace(/\B(?=(\d{3})+(?!\d))/g,",");return i!==void 0?`$${o}.${i.slice(0,2)}`:o?`$${o}`:""}function J4(t){return t.replace(/[$,]/g,"")}function Eo({id:t,value:e,onChange:n,placeholder:r="$0.00",required:i,autoFocus:o,style:l}){const[d,h]=k.useState(()=>Qg(e)),f=k.useRef(null);k.useEffect(()=>{const g=Qg(e);J4(d)!==e&&h(g)},[e]);function p(g){const v=g.target.value;if(!v||v==="$"){h(""),n("");return}const C=v.replace(/[^\d.]/g,"").split(".");let x=C[0];C.length>1&&(x+="."+C.slice(1).join("").slice(0,2));const w=Qg(x);h(w),n(x)}return u.jsx("input",{ref:f,id:t,type:"text",inputMode:"decimal",value:d,onChange:p,placeholder:r,required:i,autoFocus:o,style:{...Va,...l}})}function ki(t=P6){const[e,n]=k.useState(()=>typeof window>"u"?!1:window.innerWidth<t);return k.useEffect(()=>{const r=window.matchMedia(`(max-width: ${t-1}px)`);function i(l){n(l.matches)}i(r),r.addEventListener("change",i);function o(){n(window.innerWidth<t)}return window.addEventListener("resize",o),()=>{r.removeEventListener("change",i),window.removeEventListener("resize",o)}},[t]),e}function zT(){const[t,e]=k.useState(()=>typeof window>"u"?1200:window.innerWidth);return k.useEffect(()=>{function n(){e(window.innerWidth)}return window.addEventListener("resize",n),n(),()=>window.removeEventListener("resize",n)},[]),{width:t,isWide:t>=wo.wide,isMedium:t>=wo.tablet&&t<wo.wide,isNarrowMedium:t>=wo.mobile&&t<wo.tablet,isMobile:t<wo.mobile}}function jn(){const{selectedBudgetId:t,currentUserId:e}=Xe(),n=V6(t),r=n.data,i=r?.budget||null,o=k.useMemo(()=>r?.accounts||{},[r?.accounts]),l=k.useMemo(()=>r?.accountGroups||{},[r?.accountGroups]),d=k.useMemo(()=>r?.categories||{},[r?.categories]),h=k.useMemo(()=>r?.categoryGroups||[],[r?.categoryGroups]),f=i?.owner_id===e,p=k.useMemo(()=>i?.user_ids||[],[i?.user_ids]),g=k.useMemo(()=>i?.accepted_user_ids||[],[i?.accepted_user_ids]),v=k.useMemo(()=>{if(!i)return 0;const M=Object.entries(o).reduce(($,[,I])=>{const D=I.account_group_id?l[I.account_group_id]:void 0,P=D&&D.on_budget!==null?D.on_budget:I.on_budget!==!1,L=D&&D.is_active!==null?D.is_active:I.is_active!==!1;return P&&L?$+I.balance:$},0),V=Object.values(d).reduce(($,I)=>$+(I.balance>0?I.balance:0),0);return M-V},[i,o,l,d]),_=k.useMemo(()=>r?.monthMap||{},[r?.monthMap]),C=k.useCallback(M=>{if(!t)return;const V=Be.getQueryData(Te.budget(t));V&&Be.setQueryData(Te.budget(t),{...V,accounts:M})},[t]),x=k.useCallback(M=>{if(!t)return;const V=Be.getQueryData(Te.budget(t));V&&Be.setQueryData(Te.budget(t),{...V,accountGroups:M})},[t]),w=k.useCallback(M=>{if(!t)return;const V=Be.getQueryData(Te.budget(t));V&&Be.setQueryData(Te.budget(t),{...V,categories:M})},[t]),E=k.useCallback(M=>{if(!t)return;const V=Be.getQueryData(Te.budget(t));V&&Be.setQueryData(Te.budget(t),{...V,categoryGroups:M})},[t]),T=k.useCallback(async()=>{t&&await Be.invalidateQueries({queryKey:Te.budget(t)})},[t]),R=k.useCallback(()=>Object.entries(o).filter(([,M])=>{const V=M.account_group_id?l[M.account_group_id]:void 0,$=V&&V.on_budget!==null?V.on_budget:M.on_budget!==!1,I=V&&V.is_active!==null?V.is_active:M.is_active!==!1;return $&&I}).reduce((M,[,V])=>M+V.balance,0),[o,l]);return{isLoading:n.isLoading,isFetching:n.isFetching,error:n.error,budget:i,accounts:o,accountGroups:l,categories:d,categoryGroups:h,isOwner:f,budgetUserIds:p,acceptedUserIds:g,totalAvailable:v,monthMap:_,setAccountsOptimistic:C,setAccountGroupsOptimistic:x,setCategoriesOptimistic:w,setCategoryGroupsOptimistic:E,refreshBudget:T,getOnBudgetTotal:R}}function Ks(t,e,n){const{addLoadingHold:r,removeLoadingHold:i}=On(),o=$t(),l=h4(t,e,n,{enabled:!!t});k.useEffect(()=>{const T=t?Te.month(t,e,n):null;return!(T?o.getQueryData(T):null)&&l.isLoading?r("month-query","Loading month data..."):i("month-query"),()=>i("month-query")},[l.isLoading,t,e,n,o,r,i]);const d=l.data?.month||null,h=k.useMemo(()=>d?.income||[],[d?.income]),f=k.useMemo(()=>d?.expenses||[],[d?.expenses]),p=k.useMemo(()=>d?.transfers||[],[d?.transfers]),g=k.useMemo(()=>d?.adjustments||[],[d?.adjustments]),v=k.useMemo(()=>d?.category_balances||[],[d?.category_balances]),_=k.useMemo(()=>d?.account_balances||[],[d?.account_balances]),C=d?.total_income||0,x=d?.total_expenses||0,w=d?.are_allocations_finalized||!1,E=d?.previous_month_income??0;return{isLoading:l.isLoading,isFetching:l.isFetching,error:l.error,month:d,income:h,expenses:f,transfers:p,adjustments:g,categoryBalances:v,accountBalances:_,totalIncome:C,totalExpenses:x,areAllocationsFinalized:w,previousMonthIncome:E}}const e3={trackChange:()=>{},clearChanges:()=>{},removeChange:()=>{},getChanges:()=>[],hasChanges:()=>!1,isSaving:!1,setIsSaving:()=>{},lastSaveTime:null,setLastSaveTime:()=>{},saveError:null,setSaveError:()=>{},clearSaveError:()=>{},syncError:null,setSyncError:()=>{}},LT=k.createContext(e3);function t3({children:t}){const[e,n]=k.useState(new Map),[r,i]=k.useState(!1),[o,l]=k.useState(null),[d,h]=k.useState(null),[f,p]=k.useState(null),g=k.useCallback($=>{i($)},[]),v=k.useCallback($=>{l($)},[]),_=k.useCallback($=>{h($)},[]),C=k.useCallback($=>$.type==="month"&&$.year!==void 0&&$.month!==void 0?`${$.type}:${$.budgetId}:${$.year}:${$.month}`:`${$.type}:${$.budgetId}`,[]),x=k.useCallback($=>{n(I=>{const D=new Map(I),P=C($);return D.set(P,{...$,timestamp:Date.now()}),D})},[C]),w=k.useCallback(()=>{n(new Map)},[]),E=k.useCallback($=>{n(I=>{const D=new Map(I),P=C($);return D.delete(P),D})},[C]),T=k.useCallback(()=>Array.from(e.values()),[e]),R=k.useCallback(()=>e.size>0,[e]),M=k.useCallback(()=>{h(null)},[]),V={trackChange:x,clearChanges:w,removeChange:E,getChanges:T,hasChanges:R,isSaving:r,lastSaveTime:o,saveError:d,clearSaveError:M,setIsSaving:g,setLastSaveTime:v,setSaveError:_,syncError:f,setSyncError:p};return u.jsx(LT.Provider,{value:V,children:t})}function hd(){const t=k.useContext(LT);if(!t)throw new Error("useSync must be used within a SyncProvider");return t}function wm(){const{trackChange:t}=hd();return{updateBudgetCacheAndTrack:(n,r)=>{Be.setQueryData(Te.budget(n),r),t({type:"budget",budgetId:n})}}}function UT(){const t=$t(),{currentViewingDocument:e}=Xe(),{saveCurrentDocument:n}=Rn(),{updateBudgetCacheAndTrack:r}=wm(),i=Wn({onMutate:async l=>{const{budgetId:d,accounts:h}=l,f=Te.budget(d);await t.cancelQueries({queryKey:f});const p=t.getQueryData(f);if(p){const v={...p,accounts:h};r(d,v)}if(e.type==="budget")try{await n(d,"budget")}catch(v){console.warn("[useUpdateAccounts] Failed to save current document immediately:",v)}return{previousData:p}},mutationFn:async l=>{const{accounts:d}=l;return{accounts:d}},onError:(l,d,h)=>{h?.previousData&&t.setQueryData(Te.budget(d.budgetId),h.previousData)}});return{updateAccounts:{mutate:l=>i.mutate(l),mutateAsync:l=>i.mutateAsync(l),isPending:i.isPending,isError:i.isError,error:i.error,reset:i.reset}}}function n3(){const t=$t(),{currentViewingDocument:e}=Xe(),{saveCurrentDocument:n}=Rn(),{updateBudgetCacheAndTrack:r}=wm(),i=Wn({onMutate:async l=>{const{budgetId:d,accountGroups:h}=l,f=Te.budget(d);await t.cancelQueries({queryKey:f});const p=t.getQueryData(f);if(p){const v={...p,accountGroups:h};r(d,v)}if(e.type==="budget")try{await n(d,"budget")}catch(v){console.warn("[useUpdateAccountGroups] Failed to save current document immediately:",v)}return{previousData:p}},mutationFn:async l=>{const{accountGroups:d}=l;return{accountGroups:d}},onError:(l,d,h)=>{h?.previousData&&t.setQueryData(Te.budget(d.budgetId),h.previousData)}});return{updateAccountGroups:{mutate:l=>i.mutate(l),mutateAsync:l=>i.mutateAsync(l),isPending:i.isPending,isError:i.isError,error:i.error,reset:i.reset}}}function FT(){const t=$t(),{currentViewingDocument:e}=Xe(),{saveCurrentDocument:n}=Rn(),{updateBudgetCacheAndTrack:r}=wm(),i=Wn({onMutate:async l=>{const{budgetId:d,categories:h}=l,f=Te.budget(d);await t.cancelQueries({queryKey:f});const p=t.getQueryData(f);if(p){const v={...p,categories:h};r(d,v)}if(e.type==="budget")try{await n(d,"budget")}catch(v){console.warn("[useUpdateCategories] Failed to save current document immediately:",v)}return{previousData:p}},mutationFn:async l=>{const{categories:d}=l;return{categories:d}},onError:(l,d,h)=>{h?.previousData&&t.setQueryData(Te.budget(d.budgetId),h.previousData)}});return{updateCategories:{mutate:l=>i.mutate(l),mutateAsync:l=>i.mutateAsync(l),isPending:i.isPending,isError:i.isError,error:i.error,reset:i.reset}}}function r3(){const t=$t(),{currentViewingDocument:e}=Xe(),{saveCurrentDocument:n}=Rn(),{updateBudgetCacheAndTrack:r}=wm(),i=Wn({onMutate:async l=>{const{budgetId:d,categoryGroups:h}=l,f=Te.budget(d);await t.cancelQueries({queryKey:f});const p=t.getQueryData(f);if(p){const v={...p,categoryGroups:h};r(d,v)}if(e.type==="budget")try{await n(d,"budget")}catch(v){console.warn("[useUpdateCategoryGroups] Failed to save current document immediately:",v)}return{previousData:p}},mutationFn:async l=>{const{categoryGroups:d}=l;return{categoryGroups:d}},onError:(l,d,h)=>{h?.previousData&&t.setQueryData(Te.budget(d.budgetId),h.previousData)}});return{updateCategoryGroups:{mutate:l=>i.mutate(l),mutateAsync:l=>i.mutateAsync(l),isPending:i.isPending,isError:i.isError,error:i.error,reset:i.reset}}}async function fd(t){const{budgetId:e,updates:n,description:r}=t,{total_available:i,is_needs_recalculation:o,...l}=n,d={...l,updated_at:new Date().toISOString()},h=Ai(d);await or("budgets",e,h,r,{merge:!0});const f=Be.getQueryData(Te.budget(e));f&&Be.setQueryData(Te.budget(e),{...f,budget:{...f.budget,...n}})}const VT=Object.freeze(Object.defineProperty({__proto__:null,writeBudgetData:fd},Symbol.toStringTag,{value:"Module"}));function s3(){const t=$t(),e=Wn({onMutate:async r=>{const{budgetId:i,newName:o}=r,l=Te.budget(i);await t.cancelQueries({queryKey:l});const d=t.getQueryData(l);return d&&t.setQueryData(l,{...d,budget:{...d.budget,name:o.trim()}}),{previousData:d}},mutationFn:async r=>{const{budgetId:i,newName:o}=r,l=o.trim();return await fd({budgetId:i,updates:{name:l},description:`renaming budget to "${l}"`}),{newName:l}},onError:(r,i,o)=>{o?.previousData&&t.setQueryData(Te.budget(i.budgetId),o.previousData)}});return{renameBudget:{mutate:r=>e.mutate(r),mutateAsync:r=>e.mutateAsync(r),isPending:e.isPending,isError:e.isError,error:e.error,reset:e.reset}}}function i3({currentBudget:t,accounts:e,accountGroups:n,setAccountsOptimistic:r,setAccountGroupsOptimistic:i,saveAccounts:o,saveAccountGroups:l,setError:d}){const h=k.useCallback(async(p,g,v)=>{const _=e[p];if(!_)return;const C=v==="ungrouped"?Jt:v,x=Object.entries(e).filter(([,T])=>(T.account_group_id||"ungrouped")===v),w={};Object.entries(e).forEach(([T,R])=>{T!==p&&(w[T]={...R})});let E;if(g==="__group_end__"||x.length===0||!x.find(([T])=>T===g))E=(x.length>0?Math.max(...x.filter(([R])=>R!==p).map(([,R])=>R.sort_order)):-1)+1;else{const T=x.find(([R])=>R===g);if(T){const[,R]=T;E=R.sort_order,Object.entries(w).forEach(([M,V])=>{(V.account_group_id||"ungrouped")===v&&V.sort_order>=E&&(w[M]={...V,sort_order:V.sort_order+1})})}else E=0}if(w[p]={..._,account_group_id:C,sort_order:E},r(w),!!t)try{await o(w)}catch(T){d(T instanceof Error?T.message:"Failed to save changes")}},[t,e,r,o,d]),f=k.useCallback(async(p,g)=>{if(p===g)return;const v=Object.entries(n).sort(([,E],[,T])=>E.sort_order-T.sort_order),_=v.findIndex(([E])=>E===p),C=[...v],[x]=C.splice(_,1);if(g==="__end__")C.push(x);else{const E=C.findIndex(([T])=>T===g);C.splice(E,0,x)}const w={};if(C.forEach(([E,T],R)=>{w[E]={...T,sort_order:R}}),i(w),!!t)try{await l(w)}catch(E){d(E instanceof Error?E.message:"Failed to save new order")}},[t,n,i,l,d]);return{reorderAccountsInGroup:h,reorderGroups:f}}function a3(){const{selectedBudgetId:t}=Xe(),{budget:e,accounts:n,accountGroups:r,setAccountsOptimistic:i,setAccountGroupsOptimistic:o}=jn(),{updateAccounts:l}=UT(),{updateAccountGroups:d}=n3(),[h,f]=k.useState(null),p=k.useCallback(async L=>{if(!t)throw new Error("No budget selected");await l.mutateAsync({budgetId:t,accounts:L})},[t,l]),g=k.useCallback(async L=>{if(!t)throw new Error("No budget selected");await d.mutateAsync({budgetId:t,accountGroups:L})},[t,d]),v=k.useCallback(async(L,q)=>{if(!t)throw new Error("No budget selected");await Promise.all([l.mutateAsync({budgetId:t,accounts:L}),d.mutateAsync({budgetId:t,accountGroups:q})])},[t,l,d]),_=k.useMemo(()=>Object.entries(n).filter(([,L])=>!L.is_hidden).reduce((L,[q,A])=>{const O=A.account_group_id||Jt;return L[O]||(L[O]=[]),L[O].push({...A,id:q}),L},{}),[n]),C=k.useMemo(()=>Object.entries(n).filter(([,L])=>L.is_hidden).map(([L,q])=>({...q,id:L})).sort((L,q)=>L.sort_order-q.sort_order),[n]),x=k.useMemo(()=>Object.entries(r).sort(([,L],[,q])=>L.sort_order-q.sort_order).map(([L,q])=>({...q,id:L})),[r]),w=k.useCallback((L,q)=>{if(!e)return;const A=q||Jt,O=Object.values(n).filter(Z=>Z.account_group_id===A),N=O.length>0?Math.max(...O.map(Z=>Z.sort_order)):-1,J=`account_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,Y={nickname:L.nickname,description:"",balance:0,account_group_id:A,sort_order:N+1,is_income_account:L.is_income_account??!1,is_income_default:L.is_income_default??!1,is_outgo_account:L.is_outgo_account??!1,is_outgo_default:L.is_outgo_default??!1,on_budget:L.on_budget!==!1,is_active:L.is_active!==!1,is_hidden:L.is_hidden??!1},G={...n};L.is_income_default&&Object.keys(G).forEach(Z=>{G[Z]={...G[Z],is_income_default:!1}}),L.is_outgo_default&&Object.keys(G).forEach(Z=>{G[Z]={...G[Z],is_outgo_default:!1}}),G[J]=Y,i(G),p(G).catch(Z=>f(Z instanceof Error?Z.message:"Failed to create account."))},[e,n,i,p]),E=k.useCallback((L,q)=>{if(!e)return;const A=n[L];if(!A)return;const O=A.account_group_id||Jt,N=q.account_group_id||Jt;let J=A.sort_order;if(O!==N){const G=Object.values(n).filter(Z=>Z.account_group_id===N);J=G.length>0?Math.max(...G.map(Z=>Z.sort_order))+1:0}const Y={};Object.entries(n).forEach(([G,Z])=>{G===L?Y[G]={...Z,nickname:q.nickname,account_group_id:N,sort_order:J,is_income_account:q.is_income_account??!1,is_income_default:q.is_income_default??!1,is_outgo_account:q.is_outgo_account??!1,is_outgo_default:q.is_outgo_default??!1,on_budget:q.on_budget!==!1,is_active:q.is_active!==!1,is_hidden:q.is_hidden??!1}:(Y[G]={...Z},q.is_income_default&&!A.is_income_default&&(Y[G].is_income_default=!1),q.is_outgo_default&&!A.is_outgo_default&&(Y[G].is_outgo_default=!1))}),i(Y),p(Y).catch(G=>f(G instanceof Error?G.message:"Failed to save account."))},[e,n,i,p]),T=k.useCallback(L=>{if(!confirm("Are you sure you want to delete this account?")||!e)return;const{[L]:q,...A}=n;i(A),p(A).catch(O=>f(O instanceof Error?O.message:"Failed to delete account."))},[e,n,i,p]),R=k.useCallback(async(L,q)=>{const A=n[L];if(!A)return;const O=A.account_group_id||Jt,N=Object.entries(n).filter(([,te])=>te.account_group_id===O).sort(([,te],[,z])=>te.sort_order-z.sort_order),J=N.findIndex(([te])=>te===L),Y=q==="up"?J-1:J+1;if(Y<0||Y>=N.length)return;const[G,Z]=N[Y],Q={};if(Object.entries(n).forEach(([te,z])=>{te===L?Q[te]={...z,sort_order:Z.sort_order}:te===G?Q[te]={...z,sort_order:A.sort_order}:Q[te]={...z}}),i(Q),!!e)try{await p(Q)}catch(te){i(n),f(te instanceof Error?te.message:"Failed to move account")}},[e,n,i,p]),M=k.useCallback(L=>{if(!e)return;const q=Object.values(r).map(Y=>Y.sort_order),A=q.length>0?Math.max(...q):-1,O=`account_group_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,N={name:L.name,sort_order:A+1,expected_balance:L.expected_balance,on_budget:L.on_budget??null,is_active:L.is_active??null},J={...r,[O]:N};o(J),g(J).catch(Y=>f(Y instanceof Error?Y.message:"Failed to create account type."))},[e,r,o,g]),V=k.useCallback((L,q)=>{if(!e)return;const A={...r,[L]:{...r[L],name:q.name,expected_balance:q.expected_balance,on_budget:q.on_budget??null,is_active:q.is_active??null}};o(A),g(A).catch(O=>f(O instanceof Error?O.message:"Failed to update account type."))},[e,r,o,g]),$=k.useCallback(L=>{if(L===Jt){alert("Cannot delete the default Ungrouped account type.");return}if(!confirm("Are you sure you want to delete this account type? Accounts in this type will move to Ungrouped.")||!e)return;const q={};Object.entries(n).forEach(([N,J])=>{q[N]=J.account_group_id===L?{...J,account_group_id:Jt}:J});const{[L]:A,...O}=r;i(q),o(O),v(q,O).catch(N=>f(N instanceof Error?N.message:"Failed to delete account type."))},[e,n,r,i,o,v]),I=k.useCallback(async(L,q)=>{const A=Object.entries(r).sort(([,G],[,Z])=>G.sort_order-Z.sort_order),O=A.findIndex(([G])=>G===L),N=q==="up"?O-1:O+1;if(N<0||N>=A.length)return;const[J]=A.splice(O,1);A.splice(N,0,J);const Y={};if(A.forEach(([G,Z],Q)=>{Y[G]={...Z,sort_order:Q}}),o(Y),!!e)try{await g(Y)}catch(G){o(r),f(G instanceof Error?G.message:"Failed to move account type")}},[e,r,o,g]),{reorderAccountsInGroup:D,reorderGroups:P}=i3({currentBudget:e,accounts:n,accountGroups:r,setAccountsOptimistic:i,setAccountGroupsOptimistic:o,saveAccounts:p,saveAccountGroups:g,setError:f});return{accounts:n,accountGroups:r,accountsByGroup:_,hiddenAccounts:C,sortedGroups:x,currentBudget:e,error:h,setError:f,handleCreateAccount:w,handleUpdateAccount:E,handleDeleteAccount:T,handleMoveAccount:R,handleCreateGroup:M,handleUpdateGroup:V,handleDeleteGroup:$,handleMoveGroup:I,reorderAccountsInGroup:D,reorderGroups:P}}function M1(t,e){if(!t)return{};const n={};return Object.entries(e).forEach(([r,i])=>{if(i.default_monthly_type==="percentage")return;const o=t.category_balances?.find(l=>l.category_id===r);o&&o.allocated>0?n[r]=o.allocated.toString():i.default_monthly_amount!==void 0&&i.default_monthly_amount>0?n[r]=i.default_monthly_amount.toString():n[r]=""}),n}function o3(){const{addLoadingHold:t,removeLoadingHold:e}=On(),{selectedBudgetId:n,currentYear:r,currentMonthNumber:i}=Xe(),{categories:o,getOnBudgetTotal:l,totalAvailable:d}=jn(),{month:h,isLoading:f,previousMonthIncome:p,areAllocationsFinalized:g}=Ks(n,r,i),v=k.useMemo(()=>h?.income?h.income.reduce((z,H)=>z+H.amount,0):0,[h]),{saveDraftAllocations:_}=D4(),{finalizeAllocations:C}=VP(),{deleteAllocations:x}=rA(),w=k.useMemo(()=>M1(h,o),[h,o]),[E,T]=k.useState(w),[R,M]=k.useState(!1),[V,$]=k.useState(null),I=k.useRef(null);k.useMemo(()=>Object.values(o).reduce((z,H)=>z+(H.balance??0),0),[o]),k.useEffect(()=>{if(!h)return;const z=`${h.year}-${h.month}`;I.current!==z&&(M(!1),T(M1(h,o)),I.current=z)},[h,o]);const D=k.useCallback((z,H)=>{if(H.default_monthly_type==="percentage"&&H.default_monthly_amount!==void 0)return Me(H.default_monthly_amount/100*p);const re=E[z],ne=parseFloat(re||"0");return isNaN(ne)?0:Me(ne)},[E,p]),P=k.useMemo(()=>Object.entries(o).reduce((z,[H,re])=>{const ne=D(H,re),ie=re.balance??0;if(ie<0){const be=Math.abs(ie),Ce=Math.max(0,ne-be);return z+Ce}return z+ne},0),[o,D]),L=l(),q=g?(h?.category_balances||[]).reduce((z,H)=>{const re=o[H.category_id]?.balance??0,ne=H.allocated,ie=re-ne;if(ie<0){const be=Math.abs(ie);return z+Math.max(0,ne-be)}return z+ne},0):0,A=R?d+q:d,O=k.useMemo(()=>R?A-P:A-P+q,[A,P,q,R]),N=k.useCallback((z,H)=>{T(re=>({...re,[z]:H}))},[]),J=k.useCallback(()=>{if(!h)return;const z={};Object.entries(o).forEach(([H,re])=>{if(re.default_monthly_type==="percentage")return;const ne=h.category_balances?.find(ie=>ie.category_id===H);ne&&ne.allocated>0?z[H]=ne.allocated.toString():re.default_monthly_amount!==void 0&&re.default_monthly_amount>0?z[H]=re.default_monthly_amount.toString():z[H]=""}),T(z),M(!1)},[h,o]),Y=k.useCallback(()=>{const z={};return Object.entries(o).forEach(([H,re])=>{const ne=D(H,re);ne>0&&(z[H]=ne)}),z},[o,D]),G=k.useCallback(async()=>{if(n){$(null),t("allocations-save","Saving allocations...");try{await _(n,r,i,Y()),M(!1)}catch(z){$(z instanceof Error?z.message:"Failed to save allocations")}finally{e("allocations-save")}}},[n,r,i,_,Y,t,e]),Z=k.useCallback(async()=>{if(n){$(null),t("allocations-finalize","Applying allocations...");try{await C({budgetId:n,year:r,month:i,allocations:Y(),onProgress:z=>{t("allocations-finalize",z.message)}}),M(!1)}catch(z){$(z instanceof Error?z.message:"Failed to finalize allocations")}finally{e("allocations-finalize")}}},[n,r,i,C,Y,t,e]),Q=k.useCallback(async()=>{if(n){$(null),t("allocations-delete","Deleting allocations...");try{await x({budgetId:n,year:r,month:i,onProgress:H=>{t("allocations-delete",H.message)}});const z={};Object.entries(o).forEach(([H,re])=>{re.default_monthly_type!=="percentage"&&(re.default_monthly_amount!==void 0&&re.default_monthly_amount>0?z[H]=re.default_monthly_amount.toString():z[H]="")}),T(z),M(!1)}catch(z){$(z instanceof Error?z.message:"Failed to delete allocations")}finally{e("allocations-delete")}}},[n,r,i,x,o,t,e]),te=P-q;return{localAllocations:E,isEditingAppliedAllocations:R,error:V,monthLoading:f,onBudgetTotal:L,availableNow:A,currentDraftTotal:P,draftChangeAmount:te,availableAfterApply:O,previousMonthIncome:p,currentMonthIncome:v,allocationsFinalized:g,getAllocationAmount:D,handleAllocationChange:N,resetAllocationsToSaved:J,handleSaveAllocations:G,handleFinalizeAllocations:Z,handleDeleteAllocations:Q,setIsEditingAppliedAllocations:M,setError:$}}function l3({budgetId:t,categories:e,currentYear:n,currentMonth:r,updateCategoriesWithBalances:i}){const o=Object.keys(e),l=o.length>0,d=k.useMemo(()=>o.sort().join(","),[o]),h=k.useMemo(()=>{const M={};return Object.entries(e).forEach(([V,$])=>{M[V]={current:$.balance??0,total:$.balance??0}}),M},[e]),p=Pa({queryKey:["categoryBalances",t,n,r,d],queryFn:async()=>{if(!t||!l)return{};const{current:M,total:V}=await Wg(t,o,n,r),$={};return o.forEach(I=>{$[I]={current:M[I]??0,total:V[I]??0}}),$},enabled:!!t&&l,staleTime:La,placeholderData:h,refetchOnMount:!1}).data||h,g=!1,v=k.useMemo(()=>p,[p]),[_,C]=k.useState(!1),x=_||g,[w,E]=k.useState(null),T=k.useCallback(async()=>{if(!t||Object.keys(e).length===0)return null;const M=Object.keys(e),{total:V}=await Wg(t,M,n,r),$={};Object.entries(e).forEach(([D,P])=>{const L=P.balance,q=V[D]??0;Math.abs(L-q)>.01&&($[D]={stored:L,calculated:q})});const I=Object.keys($).length>0?$:null;return E(I),I},[t,e,n,r]),R=k.useCallback(async()=>{if(!(!t||!l)){C(!0);try{const{total:M}=await Wg(t,o,n,r),V={};Object.entries(e).forEach(([$,I])=>{V[$]={...I,balance:M[$]??0}}),await i(V),Be.invalidateQueries({queryKey:["categoryBalances",t,n,r]}),E(null)}finally{C(!1)}}},[t,e,i,n,r,o,l]);return{categoryBalances:v,loadingBalances:x,categoryBalanceMismatch:w,checkCategoryBalanceMismatch:T,recalculateAndSaveCategoryBalances:R}}function c3({categories:t,categoryGroups:e,currentBudget:n,setCategoriesOptimistic:r,setCategoryGroupsOptimistic:i,saveCategories:o,saveCategoryGroups:l,setError:d}){const[h,f]=k.useState(null),[p,g]=k.useState(null),[v,_]=k.useState(null),[C,x]=k.useState(null);function w(D,P){f("category"),g(P),D.dataTransfer.effectAllowed="move"}function E(D,P,L){D.preventDefault(),h==="category"&&(P!==p&&_(P),x(L))}function T(D,P){D.preventDefault(),h==="category"&&(x(P),_(null))}function R(){_(null)}function M(){x(null)}function V(){f(null),g(null),_(null),x(null)}async function $(D,P,L){if(D.preventDefault(),D.stopPropagation(),!p||h!=="category"){V();return}const q=t[p];if(!q)return;const A=L==="ungrouped"?cn:L,O=Object.entries(t).filter(([,Y])=>(Y.category_group_id||"ungrouped")===L),N={};Object.entries(t).forEach(([Y,G])=>{Y!==p&&(N[Y]=G)});let J;if(P==="__group_end__"||O.length===0||!O.find(([Y])=>Y===P))J=(O.length>0?Math.max(...O.filter(([G])=>G!==p).map(([,G])=>G.sort_order)):-1)+1;else{const Y=O.find(([G])=>G===P);Y?(J=Y[1].sort_order,Object.entries(N).forEach(([G,Z])=>{(Z.category_group_id||"ungrouped")===L&&Z.sort_order>=J&&(N[G]={...Z,sort_order:Z.sort_order+1})})):J=0}if(N[p]={...q,category_group_id:A,sort_order:J},r(N),V(),!!n)try{await o(N)}catch(Y){d(Y instanceof Error?Y.message:"Failed to save changes")}}async function I(D,P){D.preventDefault(),h==="category"&&await $(D,"__group_end__",P)}return{dragType:h,draggedId:p,dragOverId:v,dragOverGroupId:C,setDragOverId:_,setDragOverGroupId:x,handleCategoryDragStart:w,handleCategoryDragOver:E,handleDragOverGroup:T,handleDragLeave:R,handleDragLeaveGroup:M,handleDragEnd:V,handleCategoryDrop:$,handleDropOnGroup:I}}function u3(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n}=Xe(),{budget:r,categories:i,categoryGroups:o,isLoading:l,setCategoriesOptimistic:d,setCategoryGroupsOptimistic:h,getOnBudgetTotal:f}=jn(),{updateCategories:p}=FT(),{updateCategoryGroups:g}=r3(),[v,_]=k.useState(null),C=k.useCallback(async Z=>{if(!t)throw new Error("No budget selected");await p.mutateAsync({budgetId:t,categories:Z})},[t,p]),x=k.useCallback(async Z=>{if(!t)throw new Error("No budget selected");await g.mutateAsync({budgetId:t,categoryGroups:Z})},[t,g]),w=k.useCallback(async(Z,Q)=>{if(!t)throw new Error("No budget selected");await Promise.all([p.mutateAsync({budgetId:t,categories:Z}),g.mutateAsync({budgetId:t,categoryGroups:Q})])},[t,p,g]),{categoryBalances:E,loadingBalances:T,categoryBalanceMismatch:R,checkCategoryBalanceMismatch:M,recalculateAndSaveCategoryBalances:V}=l3({budgetId:t,categories:i,currentYear:e,currentMonth:n,updateCategoriesWithBalances:C}),$=c3({categories:i,categoryGroups:o,currentBudget:r,setCategoriesOptimistic:d,setCategoryGroupsOptimistic:h,saveCategories:C,saveCategoryGroups:x,setError:_});async function I(Z,Q){if(!r)return;const te=Q||cn,z=Object.values(i).filter(be=>be.category_group_id===te),H=z.length>0?Math.max(...z.map(be=>be.sort_order)):-1,re=`category_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,ne={name:Z.name,description:Z.description??"",category_group_id:te,sort_order:H+1,default_monthly_amount:Z.default_monthly_amount??0,default_monthly_type:Z.default_monthly_type??"fixed",balance:0,is_hidden:Z.is_hidden??!1},ie={...i,[re]:ne};d(ie);try{await C(ie)}catch(be){d(i),_(be instanceof Error?be.message:"Failed to create category")}}async function D(Z,Q){if(r)try{const te=i[Z];if(!te)return;const z=te.category_group_id||cn,H=Q.category_group_id||cn;let re=te.sort_order;if(z!==H){const ie=Object.values(i).filter(be=>be.category_group_id===H).filter((be,Ce,ce)=>i[Z]!==ce[Ce]);re=ie.length>0?Math.max(...ie.map(be=>be.sort_order))+1:0}const ne={...i,[Z]:{...te,name:Q.name,description:Q.description??"",category_group_id:H,sort_order:re,default_monthly_amount:Q.default_monthly_amount??0,default_monthly_type:Q.default_monthly_type??"fixed",is_hidden:Q.is_hidden??!1}};d(ne),await C(ne)}catch(te){_(te instanceof Error?te.message:"Failed to update category")}}async function P(Z){if(confirm("Are you sure you want to delete this category?")&&r)try{const{[Z]:Q,...te}=i;d(te),await C(te)}catch(Q){_(Q instanceof Error?Q.message:"Failed to delete category")}}async function L(Z,Q){const te=i[Z];if(!te)return;const z=te.category_group_id||cn,H=Object.entries(i).filter(([,ce])=>ce.category_group_id===z).sort((ce,ge)=>ce[1].sort_order-ge[1].sort_order),re=H.findIndex(([ce])=>ce===Z),ne=Q==="up"?re-1:re+1;if(ne<0||ne>=H.length)return;const[ie,be]=H[ne],Ce={};if(Object.entries(i).forEach(([ce,ge])=>{ce===Z?Ce[ce]={...ge,sort_order:be.sort_order}:ce===ie?Ce[ce]={...ge,sort_order:te.sort_order}:Ce[ce]=ge}),d(Ce),!!r)try{await C(Ce)}catch(ce){d(i),_(ce instanceof Error?ce.message:"Failed to move category")}}async function q(Z){if(r)try{const Q=o.length>0?Math.max(...o.map(H=>H.sort_order)):-1,te={id:`category_group_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,name:Z.name,sort_order:Q+1},z=[...o,te];h(z),await x(z)}catch(Q){_(Q instanceof Error?Q.message:"Failed to create group")}}async function A(Z,Q){if(r)try{const te=o.map(z=>z.id===Z?{...z,name:Q.name}:z);h(te),await x(te)}catch(te){_(te instanceof Error?te.message:"Failed to update group")}}async function O(Z){if(Z===cn){alert("Cannot delete the default Uncategorized category group.");return}if(confirm("Are you sure you want to delete this group? Categories in this group will move to Uncategorized.")&&r)try{const Q={};Object.entries(i).forEach(([z,H])=>{Q[z]=H.category_group_id===Z?{...H,category_group_id:cn}:H});const te=o.filter(z=>z.id!==Z);d(Q),h(te),await w(Q,te)}catch(Q){_(Q instanceof Error?Q.message:"Failed to delete group")}}async function N(Z,Q){const te=[...o].sort((ie,be)=>ie.sort_order-be.sort_order),z=te.findIndex(ie=>ie.id===Z),H=Q==="up"?z-1:z+1;if(H<0||H>=te.length)return;const[re]=te.splice(z,1);te.splice(H,0,re);const ne=te.map((ie,be)=>({...ie,sort_order:be}));if(h(ne),!!r)try{await x(ne)}catch(ie){h(o),_(ie instanceof Error?ie.message:"Failed to move group")}}const J=Object.entries(i).filter(([,Z])=>!Z.is_hidden).reduce((Z,[Q,te])=>{const z=te.category_group_id||cn;return Z[z]||(Z[z]=[]),Z[z].push([Q,te]),Z},{}),Y=Object.entries(i).filter(([,Z])=>Z.is_hidden).map(([Z,Q])=>[Z,Q]).sort((Z,Q)=>Z[1].sort_order-Q[1].sort_order),G=[...o].sort((Z,Q)=>Z.sort_order-Q.sort_order);return{currentBudget:r,categories:i,categoryGroups:o,categoriesByGroup:J,hiddenCategories:Y,sortedGroups:G,categoryBalances:E,isLoading:l,loadingBalances:T,error:v,setError:_,getOnBudgetTotal:f,categoryBalanceMismatch:R,checkCategoryBalanceMismatch:M,recalculateAndSaveCategoryBalances:V,handleCreateCategory:I,handleUpdateCategory:D,handleDeleteCategory:P,handleMoveCategory:L,handleCreateGroup:q,handleUpdateGroup:A,handleDeleteGroup:O,handleMoveGroup:N,dragType:$.dragType,draggedId:$.draggedId,dragOverId:$.dragOverId,dragOverGroupId:$.dragOverGroupId,setDragOverId:$.setDragOverId,setDragOverGroupId:$.setDragOverGroupId,handleCategoryDragStart:$.handleCategoryDragStart,handleCategoryDragOver:$.handleCategoryDragOver,handleDragOverGroup:$.handleDragOverGroup,handleDragLeave:$.handleDragLeave,handleDragLeaveGroup:$.handleDragLeaveGroup,handleDragEnd:$.handleDragEnd,handleCategoryDrop:$.handleCategoryDrop,handleDropOnGroup:$.handleDropOnGroup}}function d3({categories:t,categoryBalances:e,totalAvailable:n,onBudgetTotal:r,isDataLoading:i,loadingBalances:o,currentBudget:l}){const d=k.useMemo(()=>Object.values(t).reduce((x,w)=>x+Math.max(0,w.balance??0),0),[t]),h=k.useMemo(()=>Object.values(e).reduce((x,w)=>x+Math.max(0,w.total),0),[e]),f=d,p=k.useMemo(()=>Object.values(t).reduce((x,w)=>x+Math.max(0,w.balance??0),0),[t]),g=n,v=k.useMemo(()=>Math.abs(d-h)>.01,[d,h]),_=k.useMemo(()=>Math.abs(r-(f+g))>.01,[r,f,g]),C=k.useMemo(()=>Math.abs(d-p)>.01,[d,p]);return k.useEffect(()=>{},[v,_,C,d,h,f,g,r,p,i,o,l]),{allocatedFromStored:d,allocatedFromCalculated:h,allocated:f,unallocated:g,monthViewAllTime:p,calculationMismatch:v,relationshipMismatch:_,monthViewMismatch:C}}function h3(t,e,n,r){const i={budget_id:e,year_month_ordinal:t.year_month_ordinal??et(n,r),year:t.year??n,month:t.month??r,income:t.income||[],total_income:t.total_income??0,previous_month_income:t.previous_month_income??0,expenses:t.expenses||[],total_expenses:t.total_expenses??0,transfers:t.transfers||[],adjustments:t.adjustments||[],account_balances:t.account_balances||[],category_balances:t.category_balances||[],are_allocations_finalized:t.are_allocations_finalized??!1,created_at:t.created_at,updated_at:t.updated_at};return _m(i)}async function f3(t){const e=new Date,n=e.getFullYear(),r=e.getMonth()+1;let i=n,o=r-3;for(;o<=0;)o+=12,i-=1;const l=et(i,o);return(await Fn("months","useInitialDataLoad: loading initial months",[{field:"budget_id",op:"==",value:t},{field:"year_month_ordinal",op:">=",value:l}])).docs.map(f=>{const p=f.data,g=p.year,v=p.month;return h3(p,t,g,v)}).sort((f,p)=>f.year!==p.year?f.year-p.year:f.month-p.month)}async function m3(t){const[e,n,r]=await Promise.all([z0(t),F0(t),f3(t)]);return{budget:e,payees:n,months:r}}function p3(t,e){return Pa({queryKey:t?["initialDataLoad",t]:["initialDataLoad","none"],queryFn:()=>m3(t),enabled:!!t&&e?.enabled!==!1,staleTime:1/0})}async function g3(t,e,n,r){const i=Te.month(t,e,n),o=r.getQueryData(i);if(!o?.month)throw new Error(`Month ${e}/${n} not found in cache`);const l=o.month,d=await y3(t,e,n,r),h=Gu(l,d);return r.setQueryData(i,{month:h}),h}async function y3(t,e,n,r){const{year:i,month:o}=gc(e,n),l=Te.month(t,i,o),d=r.getQueryData(l);if(d?.month)return tc(d.month);try{const h=await Hu(t,i,o);if(h)return r.setQueryData(l,{month:h}),tc(h)}catch(h){console.warn(`[useLocalRecalculation] Could not fetch previous month ${i}/${o}:`,h)}return vm}const O1=300*1e3;function _3(t,e,n,r){const i={budget_id:e,year_month_ordinal:t.year_month_ordinal??et(n,r),year:t.year??n,month:t.month??r,income:t.income||[],total_income:t.total_income??0,previous_month_income:t.previous_month_income??0,expenses:t.expenses||[],total_expenses:t.total_expenses??0,transfers:t.transfers||[],adjustments:t.adjustments||[],account_balances:t.account_balances||[],category_balances:t.category_balances||[],are_allocations_finalized:t.are_allocations_finalized??!1,created_at:t.created_at,updated_at:t.updated_at};return _m(i)}function N1(t,e){return e?t?new Date(e)>new Date(t):!0:!1}async function b3(t,e){const n=[],r=new Date,i=r.getFullYear(),o=r.getMonth()+1;let l=i,d=o-3;for(;d<=0;)d+=12,l-=1;const h=et(l,d),[f,p,g]=await Promise.all([Be.fetchQuery({queryKey:Te.budget(t),queryFn:()=>z0(t),staleTime:0}).catch(()=>null),Be.fetchQuery({queryKey:Te.payees(t),queryFn:()=>F0(t),staleTime:0}).catch(()=>null),Fn("months","useSyncCheck: checking for remote changes",[{field:"budget_id",op:"==",value:t},{field:"year_month_ordinal",op:">=",value:h}]).catch(()=>({docs:[]}))]);if(f){const _=Be.getQueryData(Te.budget(t));if(_){const C=_.budget?.updated_at;N1(C,f.budget.updated_at)&&(e.some(w=>w.type==="budget"&&w.budgetId===t)?n.push("Budget document has been updated remotely (you have unsaved local changes)"):Be.setQueryData(Te.budget(t),f))}}p!==null&&Be.getQueryData(Te.payees(t));const v=g.docs.map(_=>{const C=_.data,x=C.year,w=C.month;return _3(C,t,x,w)});for(const _ of v){const C=Be.getQueryData(Te.month(t,_.year,_.month));C?.month&&N1(C.month.updated_at,_.updated_at)&&(e.some(w=>w.type==="month"&&w.budgetId===t&&w.year===_.year&&w.month===_.month)?n.push(`Month ${_.year}/${_.month} has been updated remotely (you have unsaved local changes)`):Be.setQueryData(Te.month(t,_.year,_.month),{month:_}))}return n}function v3(t,e){const{setSyncError:n,getChanges:r}=hd(),i=k.useRef(null),o=k.useRef(null),l=k.useRef(0),d=k.useRef(!1);k.useEffect(()=>{if(!t||!e||d.current)return;d.current=!0;const h=async()=>{try{const f=r(),p=await b3(t,f);if(p.length>0){const g=`Sync conflict detected: ${p.join("; ")}`;n(g),qn.add({type:"error",message:g,autoDismissMs:0})}else n(null)}catch(f){console.error("[useSyncCheck] Sync check failed:",f);const p=`Failed to check for sync conflicts: ${f instanceof Error?f.message:String(f)}`;n(p),qn.add({type:"error",message:p,autoDismissMs:0})}};return o.current=setTimeout(()=>{h(),l.current=Date.now(),i.current=setInterval(()=>{h(),l.current=Date.now()},O1)},O1),()=>{o.current&&clearTimeout(o.current),i.current&&clearInterval(i.current),d.current=!1}},[t,e,n,r])}function x3(t,e,n){const r=$t(),i=k.useRef(null),o=k.useRef(null);k.useEffect(()=>{if(i.current===null||o.current===null){i.current=e,o.current=n;return}if(i.current===e&&o.current===n)return;if(!t){i.current=e,o.current=n;return}const l=et(i.current,o.current),f=et(e,n)>l?L0(e,n):gc(e,n),p=Te.month(t,f.year,f.month);if(!r.getQueryData(p)){const v=r.getQueryData(Te.budget(t)),_=et(f.year,f.month);v?.monthMap&&_ in v.monthMap&&r.prefetchQuery({queryKey:p,queryFn:async()=>{const x=await Hu(t,f.year,f.month);return x?{month:x}:null},staleTime:La}).catch(x=>{console.warn(`[useMonthPrefetch] Failed to prefetch month ${f.year}/${f.month}:`,x)})}i.current=e,o.current=n},[t,e,n,r])}function w3(t,e){const n={};Object.keys(e).forEach(l=>{n[l]=0});const r=Be.getQueryData(Te.budget(t));if(!r)return n;const i=r.budget.month_map||{},o=Object.keys(i).sort();for(const l of o){const d=parseInt(l.substring(0,4),10),h=parseInt(l.substring(4,6),10),f=Te.month(t,d,h),p=Be.getQueryData(f);if(!p?.month)continue;const g=p.month;for(const v of g.account_balances||[])v.account_id&&!We(v.account_id)&&n[v.account_id]===0&&(n[v.account_id]=v.start_balance??0)}for(const l of o){const d=parseInt(l.substring(0,4),10),h=parseInt(l.substring(4,6),10),f=Te.month(t,d,h),p=Be.getQueryData(f);if(!p?.month)continue;const g=p.month;for(const v of g.income||[])v.account_id&&!We(v.account_id)&&n[v.account_id]!==void 0&&(n[v.account_id]+=v.amount);for(const v of g.expenses||[])v.account_id&&!We(v.account_id)&&n[v.account_id]!==void 0&&(n[v.account_id]+=v.amount);for(const v of g.transfers||[])v.to_account_id&&!We(v.to_account_id)&&n[v.to_account_id]!==void 0&&(n[v.to_account_id]+=v.amount),v.from_account_id&&!We(v.from_account_id)&&n[v.from_account_id]!==void 0&&(n[v.from_account_id]-=v.amount);for(const v of g.adjustments||[])v.account_id&&!We(v.account_id)&&n[v.account_id]!==void 0&&(n[v.account_id]+=v.amount)}for(const l of Object.keys(n))n[l]=Me(n[l]);return n}function $T(t){const e=Be.getQueryData(Te.budget(t));if(!e){console.warn("[recalculateBudgetAccountBalancesFromCache] Budget not in cache");return}const n=w3(t,e.accounts),r={};for(const[i,o]of Object.entries(e.accounts))r[i]={...o,balance:n[i]??o.balance};Be.setQueryData(Te.budget(t),{...e,accounts:r,budget:{...e.budget,accounts:r}})}function P1(t){return{year:parseInt(t.substring(0,4),10),month:parseInt(t.substring(4,6),10)}}async function S3(t){const e=Be.getQueryData(Te.budget(t));if(!e){console.warn("[recalculateBudgetCategoryBalancesFromCache] Budget not in cache");return}const n=Object.keys(e.categories);if(n.length===0)return;const r=new Date,i=r.getFullYear(),o=r.getMonth()+1,l=et(i,o),d=e.monthMap||{},h={};n.forEach(E=>{h[E]=0});const f=Object.keys(d).sort(),p=Te.month(t,i,o),g=Be.getQueryData(p);if(g?.month?.category_balances)for(const E of g.month.category_balances)n.includes(E.category_id)&&(h[E.category_id]=E.end_balance??0);else{let E=!1;for(let T=f.length-1;T>=0&&!E;T--){const R=f[T];if(R>l)continue;const{year:M,month:V}=P1(R),$=Te.month(t,M,V),I=Be.getQueryData($);if(I?.month?.category_balances){E=!0;for(const D of I.month.category_balances)n.includes(D.category_id)&&(h[D.category_id]=D.end_balance??0)}}if(!E&&f.length>0)for(const T of f){if(T>l)break;const{year:R,month:M}=P1(T),V=Te.month(t,R,M),$=Be.getQueryData(V);if($?.month){const I=$.month;if(I.are_allocations_finalized&&I.category_balances)for(const D of I.category_balances)n.includes(D.category_id)&&(h[D.category_id]=(h[D.category_id]||0)+(D.allocated||0));if(I.expenses)for(const D of I.expenses)n.includes(D.category_id)&&(h[D.category_id]=(h[D.category_id]||0)-D.amount);if(I.adjustments)for(const D of I.adjustments)D.category_id&&n.includes(D.category_id)&&(h[D.category_id]=(h[D.category_id]||0)+D.amount);if(I.transfers)for(const D of I.transfers)D.to_category_id&&n.includes(D.to_category_id)&&(h[D.to_category_id]=(h[D.to_category_id]||0)+D.amount),D.from_category_id&&n.includes(D.from_category_id)&&(h[D.from_category_id]=(h[D.from_category_id]||0)-D.amount)}}}const v=et(i+Math.floor((o+Ws-1)/12),(o+Ws-1)%12+1);let _=i,C=o;for(let E=0;E<Ws*2;E++){const T=L0(_,C);_=T.year,C=T.month;const R=et(_,C);if(R>v||!(R in d))break;const M=Te.month(t,_,C),V=Be.getQueryData(M);if(!V?.month)break;const $=V.month;if($.are_allocations_finalized&&$.category_balances)for(const I of $.category_balances)n.includes(I.category_id)&&(h[I.category_id]=(h[I.category_id]||0)+(I.allocated||0));if($.expenses)for(const I of $.expenses)n.includes(I.category_id)&&(h[I.category_id]=(h[I.category_id]||0)-I.amount)}const x={};for(const E of n)x[E]=Me(h[E]||0);const w={};for(const[E,T]of Object.entries(e.categories))w[E]={...T,balance:x[E]??T.balance};Be.setQueryData(Te.budget(t),{...e,categories:w,budget:{...e.budget,categories:w}}),Be.invalidateQueries({queryKey:["categoryBalances",t]})}function C3(t){return{year:parseInt(t.substring(0,4),10),month:parseInt(t.substring(4,6),10)}}function E3(t,e){const n=new Date,r=n.getFullYear(),i=n.getMonth()+1,o=et(r,i);let l=r,d=i+Ws;for(;d>12;)d-=12,l+=1;const h=et(l,d),f=[],p=Object.keys(e).sort();for(const g of p){if(g<o)continue;if(g>h)break;const{year:v,month:_}=C3(g),C=Te.month(t,v,_),x=Be.getQueryState(C),w=!x?.data,E=x?.dataUpdatedAt?Date.now()-x.dataUpdatedAt>La:!0;(w||E)&&f.push({year:v,month:_,ordinal:g})}return f}async function qT(t,e){const n=Be.getQueryData(Te.budget(t));if(!n){console.warn("[ensureMonthsFreshAndRecalculateBalances] Budget not in cache");return}const r=n.monthMap||{},i=E3(t,r);if(i.length>0){e?.(!0,`Refreshing ${i.length} month${i.length>1?"s":""}...`);try{await Promise.all(i.map(({year:o,month:l})=>Dr(t,o,l,{description:`refreshing month ${o}/${l} for balance calculation`})))}finally{e?.(!1,"")}}$T(t),await S3(t)}function HT(t=!0){const{selectedBudgetId:e}=Xe(),{addLoadingHold:n,removeLoadingHold:r}=On(),i=k.useRef(!1);k.useEffect(()=>{if(!t||!e||i.current)return;i.current=!0;let o=null;qT(e,(l,d)=>{l?(o="ensure-balances-fresh",n(o,d)):o&&(r(o),o=null)}).catch(l=>{console.error("[useEnsureBalancesFresh] Failed to ensure balances fresh:",l),o&&r(o)})},[t,e,n,r]),k.useEffect(()=>{e||(i.current=!1)},[e])}function Na(){Be.removeQueries({queryKey:["budget"]}),Be.removeQueries({queryKey:["month"]}),Be.removeQueries({queryKey:["accessibleBudgets"]}),Be.removeQueries({queryKey:["payees"]}),Be.removeQueries({queryKey:["user"]}),console.log("[Migration] All caches cleared")}async function Sm(t){try{const e=await t();return Na(),e}catch(e){throw Na(),e}}const GT=k.createContext(null),B1={isOpen:!1,migrationName:"",stage:"",progress:null,currentItem:null,details:null,isComplete:!1,error:null};function T3({children:t}){const[e,n]=k.useState(B1),r=k.useCallback(()=>({setStage:d=>{n(h=>({...h,stage:d}))},setProgress:d=>{n(h=>({...h,progress:d}))},setCurrentItem:d=>{n(h=>({...h,currentItem:d}))},setDetails:d=>{n(h=>({...h,details:d}))},updateItemProgress:(d,h,f)=>{const p=h>0?Math.round(d/h*100):0;n(g=>({...g,progress:p,currentItem:f||`Item ${d} of ${h}`,details:`${d} / ${h} complete`}))}}),[]),i=k.useCallback(async(d,h)=>{n({isOpen:!0,migrationName:d,stage:"Starting migration...",progress:null,currentItem:null,details:null,isComplete:!1,error:null});const f=r();try{const p=await h(f);return Na(),n(g=>({...g,isComplete:!0,stage:"Migration complete",progress:100,details:p.errors.length>0?`Completed with ${p.errors.length} error(s)`:"All operations successful"})),p}catch(p){Na();const g=p instanceof Error?p.message:"Unknown error occurred";throw n(v=>({...v,isComplete:!0,error:g,stage:"Migration failed",progress:null})),p}},[r]),o=k.useCallback(()=>{n(d=>d.isComplete?B1:(console.warn("[MigrationProgress] Cannot close modal while migration is running"),d))},[]),l={state:e,runMigrationWithProgress:i,closeModal:o};return u.jsx(GT.Provider,{value:l,children:t})}function Y0(){const t=k.useContext(GT);if(!t)throw new Error("useMigrationProgress must be used within MigrationProgressProvider");return t}async function A3(t){return(await Fn("budgets",`${t}: batch reading all budgets`)).docs.map(n=>({id:n.id,data:n.data}))}async function WT(t,e){return(await Fn("months",`${e}: batch reading months for budget ${t}`,[{field:"budget_id",op:"==",value:t}])).docs.map(i=>({id:i.id,data:i.data,budgetId:i.data.budget_id,year:i.data.year,month:i.data.month})).sort((i,o)=>i.year!==o.year?i.year-o.year:i.month-o.month)}async function Yr(t){const e=await A3(t),n=await Fn("months",`${t}: batch reading all months`),r=new Map;for(const i of n.docs){const o=i.data.budget_id,l={id:i.id,data:i.data,budgetId:o,year:i.data.year,month:i.data.month};r.has(o)||r.set(o,[]),r.get(o).push(l)}for(const i of r.values())i.sort((o,l)=>o.year!==l.year?o.year-l.year:o.month-l.month);return{budgets:e,monthsByBudget:r}}async function $o(t,e){if(t.length===0)return;const n=t.map(r=>{const i=bm(r.data);return{collectionPath:"months",docId:Ti(r.budgetId,r.year,r.month),data:Ai({...i,updated_at:new Date().toISOString()})}});await mm(n,`${e}: batch writing ${t.length} months`)}async function QT(t,e){if(t.length===0)return;const n=t.map(r=>{const i={...r.data};if(i.accounts&&typeof i.accounts=="object"){const o=i.accounts;i.accounts=Object.fromEntries(Object.entries(o).map(([l,d])=>{if(d&&typeof d=="object"){const{balance:h,...f}=d;return[l,f]}return[l,d]}))}if(i.categories&&typeof i.categories=="object"){const o=i.categories;i.categories=Object.fromEntries(Object.entries(o).map(([l,d])=>{if(d&&typeof d=="object"){const{balance:h,...f}=d;return[l,f]}return[l,d]}))}return delete i.total_available,delete i.is_needs_recalculation,{collectionPath:"budgets",docId:r.budgetId,data:Ai({...i,updated_at:new Date().toISOString()})}});await mm(n,`${e}: batch writing ${t.length} budgets`)}async function KT(t,e,n){if(e.length===0)return;let r=vm;const i=[];for(const p of e){const g=Gu(p,r);i.push(g),r=tc(g)}const o=i.map(p=>({budgetId:t,year:p.year,month:p.month,data:p}));await $o(o,n);const l=r.accountEndBalances,d=r.categoryEndBalances,{exists:h,data:f}=await Lt("budgets",t,`${n}: reading budget for final update`);if(h&&f){const p=A4(f.month_map||{}),g={...d},v=f.categories||{};for(const _ of Object.keys(v))_ in g||(g[_]=0);await AT(t,l,g,p)}}async function j3(t,e){if(t.length===0)return;const n=new Map;for(const r of t)n.has(r.budgetId)||n.set(r.budgetId,[]),n.get(r.budgetId).push(r);for(const[r,i]of n){i.sort((d,h)=>d.year!==h.year?d.year-h.year:d.month-h.month),await $o(i,e);const l=(await WT(r,e)).map(d=>d.data);await KT(r,l,e)}}async function R3(t){const{exists:e,data:n}=await Lt("budgets",t,`[delete all months] reading budget ${t} for reset`);if(!e||!n)return;const r=Object.fromEntries(Object.entries(n.accounts||{}).map(([o,l])=>{if(l&&typeof l=="object"){const{balance:d,...h}=l;return[o,h]}return[o,l]})),i=Object.fromEntries(Object.entries(n.categories||{}).map(([o,l])=>{if(l&&typeof l=="object"){const{balance:d,...h}=l;return[o,h]}return[o,l]}));await or("budgets",t,{...n,accounts:r,categories:i,month_map:{},updated_at:new Date().toISOString()},`[delete all months] resetting budget ${t} (removing balances)`)}function I3({currentUser:t,onComplete:e}){const[n,r]=k.useState(!1),[i,o]=k.useState(!1),[l,d]=k.useState(null),[h,f]=k.useState(null),[p,g]=k.useState(null);async function v(){if(t){r(!0);try{const C=await Fn("months","delete all months: scanning for all months"),x=[],w=new Set;for(const E of C.docs){const{budget_id:T,year:R,month:M}=E.data;w.add(T),x.push({docId:E.id,budgetId:T,year:R,month:M})}x.sort((E,T)=>E.budgetId!==T.budgetId?E.budgetId.localeCompare(T.budgetId):E.year!==T.year?E.year-T.year:E.month-T.month),d({monthsToDelete:x,monthsCount:x.length,budgetCount:w.size})}catch{}finally{r(!1)}}}async function _(){if(!t||!l||l.monthsToDelete.length===0)return;o(!0),f(null);const C=l.monthsToDelete.length,x=new Set,w=[];for(const V of l.monthsToDelete)x.add(V.budgetId);g({phase:"deleting",deleted:0,total:C,currentMonth:null,budgetsRecalculated:0,totalBudgets:l.budgetCount,percentComplete:0});const E=l.monthsToDelete.map(V=>({collectionPath:"months",docId:V.docId}));let T=0;try{await wT(E,"delete all months: batch deleting all month documents",V=>{T=V,g({phase:"deleting",deleted:V,total:C,currentMonth:`Batch ${Math.ceil(V/500)} of ${Math.ceil(C/500)}`,budgetsRecalculated:0,totalBudgets:l.budgetCount,percentComplete:Math.round(V/C*70)})}),T=C}catch(V){w.push(`Batch delete failed: ${V instanceof Error?V.message:"Unknown error"}`)}const R=Array.from(x);let M=0;for(const V of R){g({phase:"resetting-budgets",deleted:T,total:C,currentMonth:`Budget ${M+1}/${R.length}`,budgetsRecalculated:M,totalBudgets:R.length,percentComplete:70+Math.round(M/R.length*25)});try{await R3(V),M++}catch{M++}}g({phase:"clearing-cache",deleted:T,total:C,currentMonth:null,budgetsRecalculated:M,totalBudgets:R.length,percentComplete:95}),Na(),g({phase:"complete",deleted:T,total:C,currentMonth:null,budgetsRecalculated:M,totalBudgets:R.length,percentComplete:100}),f({deleted:T,errors:w,budgetsRecalculated:M}),o(!1),g(null),w.length===0&&(d({monthsToDelete:[],monthsCount:0,budgetCount:0}),e?.())}return{status:l,isScanning:n,scanStatus:v,isDeleting:i,deleteResult:h,deleteProgress:p,deleteAllMonths:_}}const Kg="sample@sample.com",bo="budget_1767746876726_xuj7nzl4l";function k3({currentUser:t,onComplete:e}){const[n,r]=k.useState(!1),[i,o]=k.useState(!1),[l,d]=k.useState(null),[h,f]=k.useState(null),[p,g]=k.useState(null);async function v(){if(t){r(!0);try{let x=(await Fn("budgets","delete sample user budget: scanning for sample user budgets",[{field:"owner_email",op:"==",value:Kg}])).docs;if(x.length===0){console.log("delete sample user budget: no budgets found by owner_email, checking fallback budget ID");const V=await Lt("budgets",bo,"delete sample user budget: checking fallback budget ID");V.exists&&V.data&&(console.log("delete sample user budget: found fallback budget",bo),x=[{id:bo,data:V.data}])}const w=[];let E=0,T=!1;for(const V of x){const $=V.id,I=V.data.name,P=(await Fn("months",`delete sample user budget: counting months for budget ${$}`,[{field:"budget_id",op:"==",value:$}])).docs.length;E+=P,w.push({budgetId:$,budgetName:I,monthCount:P}),(await Fn("payees",`delete sample user budget: checking payees for budget ${$}`,[{field:"budget_id",op:"==",value:$}])).docs.length>0&&(T=!0)}const R=[],M=await Fn("users","delete sample user budget: finding sample user document",[{field:"email",op:"==",value:Kg}]);M.docs.length>0&&M.docs[0].data.budget_ids?.includes(bo)&&(w.some(D=>D.budgetId===bo)||(console.log("delete sample user budget: found stale budget reference in sample user document",bo),R.push(bo))),d({budgets:w,totalBudgets:w.length,totalMonths:E,hasPayees:T,staleBudgetIds:R})}catch(C){console.error("Error scanning for sample user budgets:",C)}finally{r(!1)}}}async function _(){if(!t||!l||l.budgets.length===0&&l.staleBudgetIds.length===0)return;o(!0),f(null);const C=[];let x=0,w=0,E=0;const T=l.totalMonths,R=l.totalBudgets;g({phase:"deleting-months",monthsDeleted:0,totalMonths:T,budgetsDeleted:0,totalBudgets:R,percentComplete:0});for(const V of l.budgets)try{const I=(await Fn("months",`delete sample user budget: fetching month IDs for budget ${V.budgetId}`)).docs.filter(D=>D.data.budget_id===V.budgetId).map(D=>({collectionPath:"months",docId:D.id}));I.length>0&&(await wT(I,`delete sample user budget: deleting ${I.length} months for budget ${V.budgetId}`,D=>{x=D,g({phase:"deleting-months",monthsDeleted:x,totalMonths:T,budgetsDeleted:w,totalBudgets:R,percentComplete:Math.round(x/Math.max(T,1)*60)})}),x=I.length)}catch($){C.push(`Failed to delete months for budget ${V.budgetId}: ${$ instanceof Error?$.message:"Unknown error"}`)}g({phase:"deleting-payees",monthsDeleted:x,totalMonths:T,budgetsDeleted:w,totalBudgets:R,percentComplete:60});for(const V of l.budgets)try{await Oy("payees",V.budgetId,`delete sample user budget: deleting payees for budget ${V.budgetId}`),E++}catch{}g({phase:"deleting-budgets",monthsDeleted:x,totalMonths:T,budgetsDeleted:w,totalBudgets:R,percentComplete:70});for(const V of l.budgets)try{await Oy("budgets",V.budgetId,`delete sample user budget: deleting budget ${V.budgetId}`),w++,g({phase:"deleting-budgets",monthsDeleted:x,totalMonths:T,budgetsDeleted:w,totalBudgets:R,percentComplete:70+Math.round(w/R*10)})}catch($){C.push(`Failed to delete budget ${V.budgetId}: ${$ instanceof Error?$.message:"Unknown error"}`)}g({phase:"updating-user",monthsDeleted:x,totalMonths:T,budgetsDeleted:w,totalBudgets:R,percentComplete:80});const M=[...l.budgets.map(V=>V.budgetId),...l.staleBudgetIds];try{const V=await Fn("users","delete sample user budget: finding sample user document to remove budget references",[{field:"email",op:"==",value:Kg}]);if(V.docs.length>0){const $=V.docs[0],I=$.id,D=$.data,P=(D.budget_ids||[]).filter(L=>!M.includes(L));await or("users",I,{...D,budget_ids:P,updated_at:new Date().toISOString()},"delete sample user budget: removing deleted budget IDs from sample user document"),console.log(`delete sample user budget: removed ${M.length} budget IDs from sample user document`)}else console.log("delete sample user budget: no sample user document found, skipping user update")}catch(V){C.push(`Failed to update sample user document: ${V instanceof Error?V.message:"Unknown error"}`)}g({phase:"clearing-cache",monthsDeleted:x,totalMonths:T,budgetsDeleted:w,totalBudgets:R,percentComplete:95}),Na(),g({phase:"complete",monthsDeleted:x,totalMonths:T,budgetsDeleted:w,totalBudgets:R,percentComplete:100}),f({budgetsDeleted:w,monthsDeleted:x,payeesDeleted:E,errors:C}),o(!1),g(null),C.length===0&&(d({budgets:[],totalBudgets:0,totalMonths:0,hasPayees:!1,staleBudgetIds:[]}),e?.())}return{status:l,isScanning:n,scanStatus:v,isDeleting:i,deleteResult:h,deleteProgress:p,deleteSampleUserBudget:_}}function z1(t){if(!t)return 0;let e=0;for(const n of t)ht(n.start_balance??0)&&e++,ht(n.end_balance??0)&&e++,ht(n.allocated??0)&&e++,ht(n.spent??0)&&e++,ht(n.income??0)&&e++,ht(n.expenses??0)&&e++,ht(n.net_change??0)&&e++;return e}function L1(t){if(!t)return 0;let e=0;for(const n of t)ht(n.amount??0)&&e++;return e}async function U1(){const t=await Fn("budgets","precision cleanup: scanning all budgets");let e=0,n=0,r=0,i=0;for(const g of t.docs){const v=g.data;let _=!1;ht(v.total_available??0)&&(i++,_=!0);const C=v.accounts;if(C&&typeof C=="object")for(const w of Object.values(C))ht(w.balance??0)&&(n++,_=!0);const x=v.categories;if(x&&typeof x=="object")for(const w of Object.values(x))ht(w.balance??0)&&(r++,_=!0),ht(w.default_monthly_amount??0)&&(r++,_=!0);_&&e++}const o=await Fn("months","precision cleanup: scanning all months");let l=0,d=0,h=0,f=0,p=0;for(const g of o.docs){const v=g.data;let _=!1;(ht(v.total_income??0)||ht(v.total_expenses??0)||ht(v.previous_month_income??0))&&(_=!0);const C=L1(v.income);C>0&&(d+=C,_=!0);const x=L1(v.expenses);x>0&&(h+=x,_=!0);const w=z1(v.category_balances);w>0&&(f+=w,_=!0);const E=z1(v.account_balances);E>0&&(p+=E,_=!0),_&&l++}return{totalBudgets:t.docs.length,budgetsWithPrecisionIssues:e,accountsWithPrecisionIssues:n,categoriesWithPrecisionIssues:r,totalAvailableWithPrecisionIssues:i,totalMonths:o.docs.length,monthsWithPrecisionIssues:l,incomeValuesWithPrecisionIssues:d,expenseValuesWithPrecisionIssues:h,categoryBalancesWithPrecisionIssues:f,accountBalancesWithPrecisionIssues:p}}function F1(t){const e={...t};return e.start_balance!==void 0&&(e.start_balance=Me(e.start_balance)),e.end_balance!==void 0&&(e.end_balance=Me(e.end_balance)),e.allocated!==void 0&&(e.allocated=Me(e.allocated)),e.spent!==void 0&&(e.spent=Me(e.spent)),e.income!==void 0&&(e.income=Me(e.income)),e.expenses!==void 0&&(e.expenses=Me(e.expenses)),e.transfers!==void 0&&(e.transfers=Me(e.transfers)),e.adjustments!==void 0&&(e.adjustments=Me(e.adjustments)),e.net_change!==void 0&&(e.net_change=Me(e.net_change)),e}function D3(t,e){let n=!1;ht(t.total_available??0)&&(t.total_available=Me(t.total_available??0),e.totalAvailableFixed++,n=!0);const r=t.accounts;if(r&&typeof r=="object")for(const[o,l]of Object.entries(r)){const d=l;ht(d.balance??0)&&(r[o].balance=Me(d.balance??0),e.accountsFixed++,n=!0)}const i=t.categories;if(i&&typeof i=="object")for(const[o,l]of Object.entries(i)){const d=l;ht(d.balance??0)&&(i[o].balance=Me(d.balance??0),e.categoriesFixed++,n=!0),ht(d.default_monthly_amount??0)&&(i[o].default_monthly_amount=Me(d.default_monthly_amount??0),e.categoriesFixed++,n=!0)}return{fixed:n,data:t}}function M3(t,e){let n=!1;if(ht(t.total_income??0)&&(t.total_income=Me(t.total_income??0),n=!0),ht(t.total_expenses??0)&&(t.total_expenses=Me(t.total_expenses??0),n=!0),ht(t.previous_month_income??0)&&(t.previous_month_income=Me(t.previous_month_income??0),n=!0),t.income&&Array.isArray(t.income)){const r=[];for(const i of t.income)ht(i.amount??0)?(r.push({...i,amount:Me(i.amount??0)}),e.incomeValuesFixed++,n=!0):r.push(i);t.income=r}if(t.expenses&&Array.isArray(t.expenses)){const r=[];for(const i of t.expenses)ht(i.amount??0)?(r.push({...i,amount:Me(i.amount??0)}),e.expenseValuesFixed++,n=!0):r.push(i);t.expenses=r}if(t.category_balances&&Array.isArray(t.category_balances)){const r=[];for(const i of t.category_balances)ht(i.start_balance??0)||ht(i.end_balance??0)||ht(i.allocated??0)||ht(i.spent??0)||ht(i.transfers??0)||ht(i.adjustments??0)?(r.push(F1(i)),e.categoryBalancesFixed++,n=!0):r.push(i);t.category_balances=r}if(t.account_balances&&Array.isArray(t.account_balances)){const r=[];for(const i of t.account_balances)ht(i.start_balance??0)||ht(i.end_balance??0)||ht(i.income??0)||ht(i.expenses??0)||ht(i.transfers??0)||ht(i.adjustments??0)||ht(i.net_change??0)?(r.push(F1(i)),e.accountBalancesFixed++,n=!0):r.push(i);t.account_balances=r}return{fixed:n,data:t}}function O3(t,e,n){const r={...t.data},{fixed:i,data:o}=D3(r,n),l=i?{budgetId:t.id,data:o}:null;i&&n.budgetsProcessed++;const d=[];let h=!1;for(const f of e){const p={...f.data},{fixed:g,data:v}=M3(p,n);g&&(n.monthsProcessed++,h=!0),d.push(v)}return{budgetUpdate:l,fixedMonths:d,hasMonthFixes:h}}async function N3(){const t={budgetsProcessed:0,accountsFixed:0,categoriesFixed:0,totalAvailableFixed:0,monthsProcessed:0,incomeValuesFixed:0,expenseValuesFixed:0,categoryBalancesFixed:0,accountBalancesFixed:0,errors:[]},{budgets:e,monthsByBudget:n}=await Yr("precision cleanup"),r=[],i=[];for(const o of e)try{const l=n.get(o.id)||[],{budgetUpdate:d,fixedMonths:h,hasMonthFixes:f}=O3(o,l,t);d&&r.push(d),(f||h.length>0)&&i.push({budgetId:o.id,months:h})}catch(l){t.errors.push(`Budget ${o.id}: ${l instanceof Error?l.message:String(l)}`)}if(r.length>0)try{await QT(r,"precision cleanup")}catch(o){t.errors.push(`Budget batch write: ${o instanceof Error?o.message:String(o)}`)}for(const{budgetId:o,months:l}of i)try{await KT(o,l,"precision cleanup")}catch(d){t.errors.push(`Budget ${o} recalc: ${d instanceof Error?d.message:String(d)}`)}return t}function P3({currentUser:t,onComplete:e}){const[n,r]=k.useState(null),[i,o]=k.useState(!1),[l,d]=k.useState(!1),[h,f]=k.useState(null),[p,g]=k.useState(null),v=n?n.accountsWithPrecisionIssues+n.categoriesWithPrecisionIssues+n.totalAvailableWithPrecisionIssues+n.incomeValuesWithPrecisionIssues+n.expenseValuesWithPrecisionIssues+n.categoryBalancesWithPrecisionIssues+n.accountBalancesWithPrecisionIssues:0,_=v>0,C=k.useCallback(async()=>{if(t){o(!0),g(null);try{const w=await U1();r(w),f(null)}catch(w){g(w instanceof Error?w.message:"Failed to scan for precision issues")}finally{o(!1)}}},[t]),x=k.useCallback(async()=>{if(!(!t||!_)){d(!0),g(null);try{const w=await Sm(()=>N3());f(w);const E=await U1();r(E),e?.()}catch(w){g(w instanceof Error?w.message:"Failed to run precision cleanup")}finally{d(!1)}}},[t,_,e]);return{status:n,isScanning:i,isRunning:l,result:h,error:p,totalIssues:v,hasIssues:_,hasData:n!==null,scan:C,runCleanup:x}}function Cm(t){const e=t.income||[],n=t.expenses||[],r=Me(e.reduce((d,h)=>d+h.amount,0)),i=Me(n.reduce((d,h)=>d+h.amount,0)),o=B3(t),l=z3(t);return{...t,total_income:r,total_expenses:i,account_balances:o,category_balances:l}}function B3(t){const e=t.income||[],n=t.expenses||[],r=t.transfers||[],i=t.adjustments||[],o=t.account_balances||[],l=new Map;for(const f of o)We(f.account_id)||l.set(f.account_id,f);const d=new Set;for(const f of e)We(f.account_id)||d.add(f.account_id);for(const f of n)We(f.account_id)||d.add(f.account_id);for(const f of r)We(f.from_account_id)||d.add(f.from_account_id),We(f.to_account_id)||d.add(f.to_account_id);for(const f of i)We(f.account_id)||d.add(f.account_id);for(const f of o)We(f.account_id)||d.add(f.account_id);const h=[];for(const f of d){const p=l.get(f),g=Me(p?.start_balance??0),v=Me(e.filter(R=>R.account_id===f).reduce((R,M)=>R+M.amount,0)),_=Me(n.filter(R=>R.account_id===f).reduce((R,M)=>R+M.amount,0)),C=Me(r.filter(R=>R.from_account_id===f).reduce((R,M)=>R-M.amount,0)),x=Me(r.filter(R=>R.to_account_id===f).reduce((R,M)=>R+M.amount,0)),w=Me(x+C),E=Me(i.filter(R=>R.account_id===f).reduce((R,M)=>R+M.amount,0)),T=Me(v+_+w+E);h.push({account_id:f,start_balance:g,income:v,expenses:_,transfers:w,adjustments:E,net_change:T,end_balance:Me(g+T)})}return h}function z3(t){const e=t.expenses||[],n=t.transfers||[],r=t.adjustments||[],i=t.category_balances||[],o=new Map;for(const g of i)Je(g.category_id)||o.set(g.category_id,g);const l=new Map;for(const g of e){if(Je(g.category_id))continue;const v=l.get(g.category_id)||0;l.set(g.category_id,v+g.amount)}const d=new Map;for(const g of n){if(!Je(g.from_category_id)){const v=d.get(g.from_category_id)||0;d.set(g.from_category_id,v-g.amount)}if(!Je(g.to_category_id)){const v=d.get(g.to_category_id)||0;d.set(g.to_category_id,v+g.amount)}}const h=new Map;for(const g of r)if(!Je(g.category_id)){const v=h.get(g.category_id)||0;h.set(g.category_id,v+g.amount)}const f=new Set;for(const g of i)Je(g.category_id)||f.add(g.category_id);for(const g of e)Je(g.category_id)||f.add(g.category_id);for(const g of n)Je(g.from_category_id)||f.add(g.from_category_id),Je(g.to_category_id)||f.add(g.to_category_id);for(const g of r)Je(g.category_id)||f.add(g.category_id);const p=[];for(const g of f){const v=o.get(g),_=Me(l.get(g)??0),C=Me(d.get(g)??0),x=Me(h.get(g)??0);if(v){const w=Me(v.start_balance),E=Me(v.allocated);p.push({category_id:g,start_balance:w,allocated:E,spent:_,transfers:C,adjustments:x,end_balance:Me(w+E+_+C+x)})}else p.push({category_id:g,start_balance:0,allocated:0,spent:_,transfers:C,adjustments:x,end_balance:Me(_+C+x)})}return p}const L3=["unknown","Unknown","UNKNOWN","","null","undefined","N/A","n/a"],U3=["unknown","Unknown","UNKNOWN","","null","undefined","N/A","n/a"];function Em(t){return!t||We(t)?!0:L3.includes(t)}function Tm(t){return!t||Je(t)?!0:U3.includes(t)}function YT(t){return Em(t.account_id)||Tm(t.category_id)}function F3(t){return{id:t.id.replace("expense_","adjustment_"),amount:t.amount,account_id:Em(t.account_id)?Gt:t.account_id,category_id:Tm(t.category_id)?Xt:t.category_id,date:t.date,description:t.description||t.payee,cleared:t.cleared,created_at:t.created_at}}function V3(t){const e=t.data,n=e.expenses||[],r=e.adjustments||[],i=[],o=[];let l=0,d=0;for(const f of n)YT(f)?(Em(f.account_id)&&!We(f.account_id)&&l++,Tm(f.category_id)&&!Je(f.category_id)&&d++,o.push(F3(f))):i.push(f);return o.length===0?{needsUpdate:!1,updatedMonth:null,stats:{expensesMigrated:0,invalidAccountsFixed:0,invalidCategoriesFixed:0}}:{needsUpdate:!0,updatedMonth:Cm({...e,expenses:i,adjustments:[...r,...o],transfers:e.transfers||[],updated_at:new Date().toISOString()}),stats:{expensesMigrated:o.length,invalidAccountsFixed:l,invalidCategoriesFixed:d}}}async function $3(){const{budgets:t,monthsByBudget:e}=await Yr("expense-to-adjustment-scan");let n=0,r=0,i=0,o=0;for(const l of t){const d=e.get(l.id)||[];n+=d.length;for(const h of d){const p=h.data.expenses||[];for(const g of p)YT(g)&&(r++,Em(g.account_id)&&!We(g.account_id)&&i++,Tm(g.category_id)&&!Je(g.category_id)&&o++)}}return{totalBudgets:t.length,totalMonths:n,expensesToMigrate:r,invalidAccountsToFix:i,invalidCategoriesToFix:o}}async function q3(){const{budgets:t,monthsByBudget:e}=await Yr("expense-to-adjustment-migration"),n=[];let r=0,i=0,o=0;const l=[];for(const d of t){const h=e.get(d.id)||[];for(const f of h)try{const{needsUpdate:p,updatedMonth:g,stats:v}=V3(f);p&&g&&(n.push({budgetId:d.id,year:f.year,month:f.month,data:g}),r+=v.expensesMigrated,i+=v.invalidAccountsFixed,o+=v.invalidCategoriesFixed)}catch(p){l.push(`Month ${f.year}/${f.month} in budget ${d.id}: ${p instanceof Error?p.message:String(p)}`)}}return n.length>0&&await $o(n,"expense-to-adjustment-migration"),{budgetsProcessed:t.length,monthsProcessed:n.length,expensesMigrated:r,invalidAccountsFixed:i,invalidCategoriesFixed:o,errors:l}}function H3({currentUser:t,onComplete:e}){const[n,r]=k.useState(!1),[i,o]=k.useState(!1),[l,d]=k.useState(null),[h,f]=k.useState(null);async function p(){if(t){r(!0);try{const _=await $3();d(_)}catch(_){console.error("Failed to scan for expense to adjustment migration:",_)}finally{r(!1)}}}async function g(){if(t){o(!0),f(null);try{const _=await Sm(()=>q3());f(_),e?.()}catch(_){f({budgetsProcessed:0,monthsProcessed:0,expensesMigrated:0,invalidAccountsFixed:0,invalidCategoriesFixed:0,errors:[_ instanceof Error?_.message:"Unknown error"]})}finally{o(!1)}}}const v=l!==null&&l.expensesToMigrate>0;return{status:l,isScanning:n,scanStatus:p,hasItemsToMigrate:v,isRunning:i,result:h,runMigration:g}}function XT(t){const e=new Set,n=new Set,r=t.categories;if(r)for(const o of Object.keys(r))e.add(o);const i=t.accounts;if(i)for(const o of Object.keys(i))n.add(o);return{categoryIds:e,accountIds:n}}function _a(t,e){return!t||Je(t)?!1:!e.has(t)}function Us(t,e){return!t||We(t)?!1:!e.has(t)}function G3(t,e){const n=t.data;let r=0,i=0,o=0,l=0,d=0,h=0,f=!1;const p=(n.expenses||[]).map(x=>{const w={...x};let E=!1;return _a(x.category_id,e.categoryIds)&&(w.category_id=Xt,r++,E=!0),Us(x.account_id,e.accountIds)&&(w.account_id=Gt,i++,E=!0),E&&(o++,f=!0),w}),g=(n.income||[]).map(x=>{const w={...x};let E=!1;return Us(x.account_id,e.accountIds)&&(w.account_id=Gt,i++,E=!0),E&&(l++,f=!0),w}),v=(n.transfers||[]).map(x=>{const w={...x};let E=!1;return _a(x.from_category_id,e.categoryIds)&&(w.from_category_id=Xt,r++,E=!0),_a(x.to_category_id,e.categoryIds)&&(w.to_category_id=Xt,r++,E=!0),Us(x.from_account_id,e.accountIds)&&(w.from_account_id=Gt,i++,E=!0),Us(x.to_account_id,e.accountIds)&&(w.to_account_id=Gt,i++,E=!0),E&&(d++,f=!0),w}),_=(n.adjustments||[]).map(x=>{const w={...x};let E=!1;return _a(x.category_id,e.categoryIds)&&(w.category_id=Xt,r++,E=!0),Us(x.account_id,e.accountIds)&&(w.account_id=Gt,i++,E=!0),E&&(h++,f=!0),w});return f?{needsUpdate:!0,updatedMonth:{...n,expenses:p,income:g,transfers:v,adjustments:_,updated_at:new Date().toISOString()},stats:{categoryIdsFixed:r,accountIdsFixed:i,affectedExpenses:o,affectedIncome:l,affectedTransfers:d,affectedAdjustments:h}}:{needsUpdate:!1,updatedMonth:null,stats:{categoryIdsFixed:0,accountIdsFixed:0,affectedExpenses:0,affectedIncome:0,affectedTransfers:0,affectedAdjustments:0}}}async function W3(){const{budgets:t,monthsByBudget:e}=await Yr("orphaned-id-scan");let n=0,r=0,i=0,o=0,l=0,d=0,h=0;for(const f of t){const p=XT(f.data),g=e.get(f.id)||[];n+=g.length;for(const v of g){const _=v.data;for(const C of _.expenses||[]){let x=!1;_a(C.category_id,p.categoryIds)&&(r++,x=!0),Us(C.account_id,p.accountIds)&&(i++,x=!0),x&&o++}for(const C of _.income||[])Us(C.account_id,p.accountIds)&&(i++,l++);for(const C of _.transfers||[]){let x=!1;_a(C.from_category_id,p.categoryIds)&&(r++,x=!0),_a(C.to_category_id,p.categoryIds)&&(r++,x=!0),Us(C.from_account_id,p.accountIds)&&(i++,x=!0),Us(C.to_account_id,p.accountIds)&&(i++,x=!0),x&&d++}for(const C of _.adjustments||[]){let x=!1;_a(C.category_id,p.categoryIds)&&(r++,x=!0),Us(C.account_id,p.accountIds)&&(i++,x=!0),x&&h++}}}return{totalBudgets:t.length,totalMonths:n,orphanedCategoryIds:r,orphanedAccountIds:i,affectedExpenses:o,affectedIncome:l,affectedTransfers:d,affectedAdjustments:h}}async function Q3(){const{budgets:t,monthsByBudget:e}=await Yr("orphaned-id-cleanup"),n=[];let r=0,i=0;const o=[];for(const l of t){const d=XT(l.data),h=e.get(l.id)||[];for(const f of h)try{const{needsUpdate:p,updatedMonth:g,stats:v}=G3(f,d);p&&g&&(n.push({budgetId:l.id,year:f.year,month:f.month,data:g}),r+=v.categoryIdsFixed,i+=v.accountIdsFixed)}catch(p){o.push(`Month ${f.year}/${f.month} in budget ${l.id}: ${p instanceof Error?p.message:String(p)}`)}}return n.length>0&&await $o(n,"orphaned-id-cleanup"),{budgetsProcessed:t.length,monthsProcessed:n.length,categoryIdsFixed:r,accountIdsFixed:i,errors:o}}function K3({currentUser:t,onComplete:e}){const[n,r]=k.useState(!1),[i,o]=k.useState(!1),[l,d]=k.useState(null),[h,f]=k.useState(null);async function p(){if(t){r(!0);try{const _=await W3();d(_)}catch(_){console.error("Failed to scan for orphaned IDs:",_)}finally{r(!1)}}}async function g(){if(t){o(!0),f(null);try{const _=await Sm(()=>Q3());f(_),e?.()}catch(_){f({budgetsProcessed:0,monthsProcessed:0,categoryIdsFixed:0,accountIdsFixed:0,errors:[_ instanceof Error?_.message:"Unknown error"]})}finally{o(!1)}}}const v=l!==null&&(l.orphanedCategoryIds>0||l.orphanedAccountIds>0);return{status:l,isScanning:n,scanStatus:p,hasItemsToFix:v,isRunning:i,result:h,runMigration:g}}function Y3(t,e){if(t.date!==e.date||Math.abs(t.amount+e.amount)>.001)return null;const n=t.amount<0?t:e,r=t.amount<0?e:t,i=Je(t.category_id)&&Je(e.category_id),o=!We(t.account_id)&&!We(e.account_id),l=t.account_id!==e.account_id;if(i&&o&&l)return{negative:n,positive:r,type:"account"};const d=We(t.account_id)&&We(e.account_id),h=!Je(t.category_id)&&!Je(e.category_id),f=t.category_id!==e.category_id;return d&&h&&f?{negative:n,positive:r,type:"category"}:null}function ZT(t){const e=[],n=new Set;for(let r=0;r<t.length;r++)if(!n.has(t[r].id))for(let i=r+1;i<t.length;i++){if(n.has(t[i].id))continue;const o=Y3(t[r],t[i]);if(o){e.push(o),n.add(t[r].id),n.add(t[i].id);break}}return e}function X3(t){const{negative:e,positive:n,type:r}=t;return r==="account"?{id:`transfer_from_adj_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,amount:Math.abs(e.amount),from_account_id:e.account_id,to_account_id:n.account_id,from_category_id:Xt,to_category_id:Xt,date:e.date,description:e.description||n.description||"Transfer",cleared:e.cleared&&n.cleared,created_at:new Date().toISOString()}:{id:`transfer_from_adj_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,amount:Math.abs(e.amount),from_account_id:Gt,to_account_id:Gt,from_category_id:e.category_id,to_category_id:n.category_id,date:e.date,description:e.description||n.description||"Transfer",cleared:e.cleared&&n.cleared,created_at:new Date().toISOString()}}function Z3(t){const e=t.data,n=e.adjustments||[],r=e.transfers||[],i=ZT(n);if(i.length===0)return{needsUpdate:!1,updatedMonth:null,stats:{pairsConverted:0,adjustmentsRemoved:0}};const o=i.map(X3),l=new Set;for(const f of i)l.add(f.negative.id),l.add(f.positive.id);const d=n.filter(f=>!l.has(f.id));return{needsUpdate:!0,updatedMonth:{...e,adjustments:d,transfers:[...r,...o],updated_at:new Date().toISOString()},stats:{pairsConverted:i.length,adjustmentsRemoved:l.size}}}async function J3(){const{budgets:t,monthsByBudget:e}=await Yr("adjustments-to-transfers-scan");let n=0,r=0,i=0,o=0;for(const l of t){const d=e.get(l.id)||[];n+=d.length;for(const h of d){const p=h.data.adjustments||[],g=ZT(p);r+=g.length;for(const v of g)v.type==="account"?i++:o++}}return{totalBudgets:t.length,totalMonths:n,pairsFound:r,accountTransferPairs:i,categoryTransferPairs:o}}async function eP(){const{budgets:t,monthsByBudget:e}=await Yr("adjustments-to-transfers-migration"),n=[];let r=0,i=0;const o=[];for(const l of t){const d=e.get(l.id)||[];for(const h of d)try{const{needsUpdate:f,updatedMonth:p,stats:g}=Z3(h);f&&p&&(n.push({budgetId:l.id,year:h.year,month:h.month,data:p}),r+=g.pairsConverted,i+=g.adjustmentsRemoved)}catch(f){o.push(`Month ${h.year}/${h.month} in budget ${l.id}: ${f instanceof Error?f.message:String(f)}`)}}return n.length>0&&await $o(n,"adjustments-to-transfers-migration"),{budgetsProcessed:t.length,monthsProcessed:n.length,transfersCreated:r,adjustmentsRemoved:i,errors:o}}function tP({currentUser:t,onComplete:e}){const[n,r]=k.useState(!1),[i,o]=k.useState(!1),[l,d]=k.useState(null),[h,f]=k.useState(null);async function p(){if(t){r(!0);try{const _=await J3();d(_)}catch(_){console.error("Failed to scan for adjustment pairs:",_)}finally{r(!1)}}}async function g(){if(t){o(!0),f(null);try{const _=await Sm(()=>eP());f(_),e?.()}catch(_){f({budgetsProcessed:0,monthsProcessed:0,transfersCreated:0,adjustmentsRemoved:0,errors:[_ instanceof Error?_.message:"Unknown error"]})}finally{o(!1)}}}const v=l!==null&&l.pairsFound>0;return{status:l,isScanning:n,scanStatus:p,hasPairsToConvert:v,isRunning:i,result:h,runMigration:g}}function nP(t){const e=[];let n="",r=!1;for(let i=0;i<t.length;i++){const o=t[i];o==='"'?r=!r:o===","&&!r?(e.push(n.trim()),n=""):n+=o}return e.push(n.trim()),e}function rP(t){if(!t)return 0;let e=t.replace(/[$\s]/g,"");const n=e.startsWith("(")||e.startsWith("-");e=e.replace(/[()]/g,"").replace("-",""),e=e.replace(/,/g,"");const r=parseFloat(e);return isNaN(r)?0:n?-r:r}function sP(t){if(!t)return null;const e=t.split("/");if(e.length!==3)return null;const n=parseInt(e[0],10),r=parseInt(e[1],10),i=parseInt(e[2],10);return isNaN(n)||isNaN(r)||isNaN(i)||n<1||n>12||r<1||r>31?null:{year:i,month:n,day:r}}function iP(t){if(!t)return!1;const e=t.toLowerCase().trim();return e==="true"||e==="1"||e==="yes"}function aP(t,e){return e.toLowerCase()==="income"?"income":t.toLowerCase()==="budget allocation"?"allocation":"spend"}function oP(t){const e=t.split(`
`).filter(r=>r.trim()),n=[];for(const r of e){const i=nP(r);if(i.length<5)continue;const[o,l,d,h,f,p,g]=i;if(o.toLowerCase()==="cash flow"||o.toLowerCase()==="date")continue;const v=sP(o);if(!v)continue;const _=aP(l,d),C=rP(f),x=iP(g||"");n.push({recordType:_,date:o,year:v.year,month:v.month,day:v.day,payee:l,category:d,account:h,amount:C,description:p||"",cleared:x,rawLine:r})}return n}function lP(t){return!t.account_id||t.account_id.trim()===""?"Missing account_id (empty or undefined)":null}function cP(t){const e=[];return(!t.account_id||t.account_id.trim()==="")&&e.push("missing account_id"),(!t.category_id||t.category_id.trim()==="")&&e.push("missing category_id"),e.length>0?e.join(", "):null}function uP(t){const e=We(t.account_id)||!t.account_id||t.account_id.trim()==="",n=Je(t.category_id)||!t.category_id||t.category_id.trim()==="";return e&&n?"Both account_id and category_id are missing/NO_* (must have at least one real ID)":null}function dP(t){const e=[];if((!t.from_account_id||t.from_account_id.trim()==="")&&e.push("missing from_account_id"),(!t.to_account_id||t.to_account_id.trim()==="")&&e.push("missing to_account_id"),(!t.from_category_id||t.from_category_id.trim()==="")&&e.push("missing from_category_id"),(!t.to_category_id||t.to_category_id.trim()==="")&&e.push("missing to_category_id"),e.length>0)return e.join(", ");const n=t.from_account_id===t.to_account_id,r=t.from_category_id===t.to_category_id;if(n&&r)return"Transfer has same from/to on both account and category (nothing would transfer)";const i=We(t.from_account_id),o=We(t.to_account_id),l=Je(t.from_category_id),d=Je(t.to_category_id);return i&&o&&l&&d?"All from/to account and category IDs are NO_* (must involve at least one real entity)":i&&o&&r?"Both accounts are NO_ACCOUNT and categories are the same (nothing transfers)":l&&d&&n?"Both categories are NO_CATEGORY and accounts are the same (nothing transfers)":null}function Qh(t,e,n,r,i){return t.filter(o=>{const[l,d,h]=e.split("-").map(Number);return o.year!==l||o.month!==d||o.day!==h||Math.abs(Math.abs(o.amount)-Math.abs(n))>.01?!1:(r&&o.payee&&o.payee.toLowerCase()===r.toLowerCase()||i&&o.description&&o.description.toLowerCase().includes(i.toLowerCase()),!0)})}async function hP(t){const e=[];let n=0,r=0,i=0,o=0;const l=t?oP(t):[],{budgets:d,monthsByBudget:h}=await Yr("account-category-validation");for(const f of d){const p=h.get(f.id)||[];for(const g of p){const v=g.data,_=`${v.year}-${String(v.month).padStart(2,"0")}`,C=v.income||[];n+=C.length;for(const T of C){const R=lP(T);R&&e.push({budgetId:f.id,monthKey:_,transactionType:"income",transactionId:T.id,violation:R,transactionDetails:{date:T.date,amount:T.amount,payee:T.payee,description:T.description,accountId:T.account_id},potentialSeedMatches:Qh(l,T.date,T.amount,T.payee,T.description)})}const x=v.expenses||[];r+=x.length;for(const T of x){const R=cP(T);R&&e.push({budgetId:f.id,monthKey:_,transactionType:"expense",transactionId:T.id,violation:R,transactionDetails:{date:T.date,amount:T.amount,payee:T.payee,description:T.description,accountId:T.account_id,categoryId:T.category_id},potentialSeedMatches:Qh(l,T.date,T.amount,T.payee,T.description)})}const w=v.adjustments||[];i+=w.length;for(const T of w){const R=uP(T);R&&e.push({budgetId:f.id,monthKey:_,transactionType:"adjustment",transactionId:T.id,violation:R,transactionDetails:{date:T.date,amount:T.amount,description:T.description,accountId:T.account_id,categoryId:T.category_id},potentialSeedMatches:Qh(l,T.date,T.amount,void 0,T.description)})}const E=v.transfers||[];o+=E.length;for(const T of E){const R=dP(T);R&&e.push({budgetId:f.id,monthKey:_,transactionType:"transfer",transactionId:T.id,violation:R,transactionDetails:{date:T.date,amount:T.amount,description:T.description,fromAccountId:T.from_account_id,toAccountId:T.to_account_id,fromCategoryId:T.from_category_id,toCategoryId:T.to_category_id},potentialSeedMatches:Qh(l,T.date,T.amount,void 0,T.description)})}}}return e.sort((f,p)=>{const g=f.monthKey.localeCompare(p.monthKey);return g!==0?g:f.transactionType.localeCompare(p.transactionType)}),{totalBudgets:d.length,totalMonths:Array.from(h.values()).reduce((f,p)=>f+p.length,0),totalIncome:n,totalExpenses:r,totalAdjustments:i,totalTransfers:o,violations:e,scannedAt:new Date().toISOString()}}function fP(t){const e=[];if(e.push("=".repeat(80),"ACCOUNT/CATEGORY VALIDATION REPORT",`Scanned at: ${t.scannedAt}`,"=".repeat(80),"","SUMMARY:"),e.push(`  Budgets scanned: ${t.totalBudgets}`,`  Months scanned: ${t.totalMonths}`,`  Income transactions: ${t.totalIncome}`,`  Expense transactions: ${t.totalExpenses}`,`  Adjustment transactions: ${t.totalAdjustments}`,`  Transfer transactions: ${t.totalTransfers}`,`  VIOLATIONS FOUND: ${t.violations.length}`,""),t.violations.length===0)return e.push(" No violations found!"),e.join(`
`);const n=new Map;for(const r of t.violations)n.has(r.transactionType)||n.set(r.transactionType,[]),n.get(r.transactionType).push(r);e.push("-".repeat(80),"VIOLATIONS BY TYPE:","-".repeat(80));for(const[r,i]of n){e.push("",`## ${r.toUpperCase()} (${i.length} violations)`,"");for(const o of i){if(e.push(`  [${o.monthKey}] ID: ${o.transactionId}`,`    Violation: ${o.violation}`,`    Date: ${o.transactionDetails.date}`,`    Amount: ${o.transactionDetails.amount}`),o.transactionDetails.payee&&e.push(`    Payee: ${o.transactionDetails.payee}`),o.transactionDetails.description&&e.push(`    Description: ${o.transactionDetails.description}`),o.transactionDetails.accountId!==void 0&&e.push(`    Account ID: ${o.transactionDetails.accountId||"(empty)"}`),o.transactionDetails.categoryId!==void 0&&e.push(`    Category ID: ${o.transactionDetails.categoryId||"(empty)"}`),o.transactionDetails.fromAccountId!==void 0&&e.push(`    From Account: ${o.transactionDetails.fromAccountId||"(empty)"}`,`    To Account: ${o.transactionDetails.toAccountId||"(empty)"}`,`    From Category: ${o.transactionDetails.fromCategoryId||"(empty)"}`,`    To Category: ${o.transactionDetails.toCategoryId||"(empty)"}`),o.potentialSeedMatches.length>0){e.push(`    POTENTIAL SEED MATCHES (${o.potentialSeedMatches.length}):`);for(const l of o.potentialSeedMatches.slice(0,5))e.push(`      - Line: ${l.rawLine}`,`        Type: ${l.recordType}, Date: ${l.date}, Payee: ${l.payee}`,`        Category: ${l.category}, Account: ${l.account}`);o.potentialSeedMatches.length>5&&e.push(`      ... and ${o.potentialSeedMatches.length-5} more matches`)}else e.push("    No seed matches found");e.push("")}}return e.join(`
`)}function mP({currentUser:t}){const[e,n]=k.useState(!1),[r,i]=k.useState(null),[o,l]=k.useState(null);async function d(h){if(t){n(!0),i(null),l(null);try{const f=await hP(h);i(f),l(fP(f))}catch(f){console.error("Failed to scan transactions:",f),l(`Error scanning: ${f instanceof Error?f.message:"Unknown error"}`)}finally{n(!1)}}}return{isScanning:e,status:r,report:o,scan:d,hasViolations:r!==null&&r.violations.length>0,violationCount:r?.violations.length??0}}async function pP(){const{budgets:t,monthsByBudget:e}=await Yr("remove-total-fields-migration-scan");let n=0,r=0,i=0;for(const l of t){const d=e.get(l.id)||[];for(const h of d){const f=h.data,p="total_income"in f&&f.total_income!==void 0,g="total_expenses"in f&&f.total_expenses!==void 0;p&&r++,g&&i++,(p||g)&&n++}}const o=e.size>0?Array.from(e.values()).reduce((l,d)=>l+d.length,0):0;return{totalBudgets:t.length,totalMonths:o,monthsNeedingMigration:n,monthsWithTotalIncome:r,monthsWithTotalExpenses:i}}async function gP(t){const e={budgetsProcessed:0,monthsProcessed:0,monthsUpdated:0,errors:[]};t.setStage("Reading all budgets and months..."),t.setProgress(null);const{budgets:n,monthsByBudget:r}=await Yr("remove-total-fields-migration");t.setDetails(`Found ${n.length} budget(s) to process`);const i=[];t.setStage("Processing months...");let o=0;for(const d of r.values())o+=d.length;let l=0;for(const d of n)try{const h=r.get(d.id)||[];for(const f of h){l++;const p=f.data;t.updateItemProgress(l,o,`Month ${p.year}/${p.month}`);const g="total_income"in p&&p.total_income!==void 0,v="total_expenses"in p&&p.total_expenses!==void 0;if(g||v){const{total_income:_,total_expenses:C,...x}=p;i.push({budgetId:d.id,year:p.year,month:p.month,data:{...x,updated_at:new Date().toISOString()}}),e.monthsUpdated++}e.monthsProcessed++}h.length>0&&e.budgetsProcessed++}catch(h){e.errors.push(`Budget ${d.id}: ${h instanceof Error?h.message:String(h)}`)}return i.length>0&&(t.setStage(`Writing ${i.length} month update(s)...`),t.setProgress(null),t.setCurrentItem(`${i.length} month(s) to update`),await $o(i,"remove-total-fields-migration")),t.setStage("Migration complete"),t.setProgress(100),e}function yP({currentUser:t}){const[e,n]=k.useState(!1),[r,i]=k.useState(!1),[o,l]=k.useState(null),[d,h]=k.useState(null),{runMigrationWithProgress:f}=Y0();async function p(){if(t){n(!0);try{const C=await pP();l(C)}catch(C){console.error("Failed to scan remove total fields status:",C)}finally{n(!1)}}}async function g(){if(t){i(!0),h(null);try{const C=await f("Remove Total Fields Migration",x=>gP(x));h(C)}catch(C){h({budgetsProcessed:0,monthsProcessed:0,monthsUpdated:0,errors:[C instanceof Error?C.message:"Unknown error"]})}finally{i(!1)}}}const v=o!==null&&o.monthsNeedingMigration>0,_=o?.monthsNeedingMigration??0;return{isScanning:e,isRunning:r,status:o,result:d,scanStatus:p,runMigration:g,needsMigration:v,totalItemsToFix:_}}async function _P(){const{budgets:t,monthsByBudget:e}=await Yr("remove-previous-month-income-migration-scan");let n=0;for(const i of t){const o=e.get(i.id)||[];for(const l of o){const d=l.data;"previous_month_income"in d&&d.previous_month_income!==void 0&&n++}}const r=e.size>0?Array.from(e.values()).reduce((i,o)=>i+o.length,0):0;return{totalBudgets:t.length,totalMonths:r,monthsNeedingMigration:n}}async function bP(t){const e={budgetsProcessed:0,monthsProcessed:0,monthsUpdated:0,errors:[]},{budgets:n,monthsByBudget:r}=await Yr("remove-previous-month-income-migration");t.setStage(`Processing ${n.length} budget(s)...`),t.setProgress(0);const i=[];for(let o=0;o<n.length;o++){const l=n[o];t.setProgress(o/n.length*100),t.setCurrentItem(`Budget ${o+1}/${n.length}: ${l.id}`);try{const d=r.get(l.id)||[];for(const h of d){const f=h.data;if("previous_month_income"in f&&f.previous_month_income!==void 0){const{previous_month_income:g,...v}=f;i.push({budgetId:l.id,year:f.year,month:f.month,data:{...v,updated_at:new Date().toISOString()}}),e.monthsUpdated++}e.monthsProcessed++}d.length>0&&e.budgetsProcessed++}catch(d){e.errors.push(`Budget ${l.id}: ${d instanceof Error?d.message:String(d)}`)}}return i.length>0&&(t.setStage(`Writing ${i.length} month update(s)...`),t.setProgress(null),t.setCurrentItem(`${i.length} month(s) to update`),await $o(i,"remove-previous-month-income-migration")),t.setStage("Migration complete"),t.setProgress(100),e}function vP({currentUser:t}){const[e,n]=k.useState(!1),[r,i]=k.useState(!1),[o,l]=k.useState(null),[d,h]=k.useState(null),{runMigrationWithProgress:f}=Y0();async function p(){if(t){n(!0);try{const C=await _P();l(C)}catch(C){console.error("Failed to scan remove previous month income status:",C)}finally{n(!1)}}}async function g(){if(t){i(!0),h(null);try{const C=await f("Remove Previous Month Income Migration",x=>bP(x));h(C)}catch(C){h({budgetsProcessed:0,monthsProcessed:0,monthsUpdated:0,errors:[C instanceof Error?C.message:"Unknown error"]})}finally{i(!1)}}}const v=o!==null&&o.monthsNeedingMigration>0,_=o?.monthsNeedingMigration??0;return{isScanning:e,isRunning:r,status:o,result:d,scanStatus:p,runMigration:g,needsMigration:v,totalItemsToFix:_}}function Kh(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Yg={exports:{}};var V1;function xP(){return V1||(V1=1,(function(t,e){(function(n){t.exports=n()})(function(){return(function n(r,i,o){function l(f,p){if(!i[f]){if(!r[f]){var g=typeof Kh=="function"&&Kh;if(!p&&g)return g(f,!0);if(d)return d(f,!0);var v=new Error("Cannot find module '"+f+"'");throw v.code="MODULE_NOT_FOUND",v}var _=i[f]={exports:{}};r[f][0].call(_.exports,function(C){var x=r[f][1][C];return l(x||C)},_,_.exports,n,r,i,o)}return i[f].exports}for(var d=typeof Kh=="function"&&Kh,h=0;h<o.length;h++)l(o[h]);return l})({1:[function(n,r,i){var o=n("./utils"),l=n("./support"),d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(h){for(var f,p,g,v,_,C,x,w=[],E=0,T=h.length,R=T,M=o.getTypeOf(h)!=="string";E<h.length;)R=T-E,g=M?(f=h[E++],p=E<T?h[E++]:0,E<T?h[E++]:0):(f=h.charCodeAt(E++),p=E<T?h.charCodeAt(E++):0,E<T?h.charCodeAt(E++):0),v=f>>2,_=(3&f)<<4|p>>4,C=1<R?(15&p)<<2|g>>6:64,x=2<R?63&g:64,w.push(d.charAt(v)+d.charAt(_)+d.charAt(C)+d.charAt(x));return w.join("")},i.decode=function(h){var f,p,g,v,_,C,x=0,w=0,E="data:";if(h.substr(0,E.length)===E)throw new Error("Invalid base64 input, it looks like a data url.");var T,R=3*(h=h.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(h.charAt(h.length-1)===d.charAt(64)&&R--,h.charAt(h.length-2)===d.charAt(64)&&R--,R%1!=0)throw new Error("Invalid base64 input, bad content length.");for(T=l.uint8array?new Uint8Array(0|R):new Array(0|R);x<h.length;)f=d.indexOf(h.charAt(x++))<<2|(v=d.indexOf(h.charAt(x++)))>>4,p=(15&v)<<4|(_=d.indexOf(h.charAt(x++)))>>2,g=(3&_)<<6|(C=d.indexOf(h.charAt(x++))),T[w++]=f,_!==64&&(T[w++]=p),C!==64&&(T[w++]=g);return T}},{"./support":30,"./utils":32}],2:[function(n,r,i){var o=n("./external"),l=n("./stream/DataWorker"),d=n("./stream/Crc32Probe"),h=n("./stream/DataLengthProbe");function f(p,g,v,_,C){this.compressedSize=p,this.uncompressedSize=g,this.crc32=v,this.compression=_,this.compressedContent=C}f.prototype={getContentWorker:function(){var p=new l(o.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new h("data_length")),g=this;return p.on("end",function(){if(this.streamInfo.data_length!==g.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),p},getCompressedWorker:function(){return new l(o.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},f.createWorkerFrom=function(p,g,v){return p.pipe(new d).pipe(new h("uncompressedSize")).pipe(g.compressWorker(v)).pipe(new h("compressedSize")).withStreamInfo("compression",g)},r.exports=f},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(n,r,i){var o=n("./stream/GenericWorker");i.STORE={magic:"\0\0",compressWorker:function(){return new o("STORE compression")},uncompressWorker:function(){return new o("STORE decompression")}},i.DEFLATE=n("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(n,r,i){var o=n("./utils"),l=(function(){for(var d,h=[],f=0;f<256;f++){d=f;for(var p=0;p<8;p++)d=1&d?3988292384^d>>>1:d>>>1;h[f]=d}return h})();r.exports=function(d,h){return d!==void 0&&d.length?o.getTypeOf(d)!=="string"?(function(f,p,g,v){var _=l,C=v+g;f^=-1;for(var x=v;x<C;x++)f=f>>>8^_[255&(f^p[x])];return-1^f})(0|h,d,d.length,0):(function(f,p,g,v){var _=l,C=v+g;f^=-1;for(var x=v;x<C;x++)f=f>>>8^_[255&(f^p.charCodeAt(x))];return-1^f})(0|h,d,d.length,0):0}},{"./utils":32}],5:[function(n,r,i){i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!0,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],6:[function(n,r,i){var o=null;o=typeof Promise<"u"?Promise:n("lie"),r.exports={Promise:o}},{lie:37}],7:[function(n,r,i){var o=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",l=n("pako"),d=n("./utils"),h=n("./stream/GenericWorker"),f=o?"uint8array":"array";function p(g,v){h.call(this,"FlateWorker/"+g),this._pako=null,this._pakoAction=g,this._pakoOptions=v,this.meta={}}i.magic="\b\0",d.inherits(p,h),p.prototype.processChunk=function(g){this.meta=g.meta,this._pako===null&&this._createPako(),this._pako.push(d.transformTo(f,g.data),!1)},p.prototype.flush=function(){h.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},p.prototype.cleanUp=function(){h.prototype.cleanUp.call(this),this._pako=null},p.prototype._createPako=function(){this._pako=new l[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var g=this;this._pako.onData=function(v){g.push({data:v,meta:g.meta})}},i.compressWorker=function(g){return new p("Deflate",g)},i.uncompressWorker=function(){return new p("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(n,r,i){function o(_,C){var x,w="";for(x=0;x<C;x++)w+=String.fromCharCode(255&_),_>>>=8;return w}function l(_,C,x,w,E,T){var R,M,V=_.file,$=_.compression,I=T!==f.utf8encode,D=d.transformTo("string",T(V.name)),P=d.transformTo("string",f.utf8encode(V.name)),L=V.comment,q=d.transformTo("string",T(L)),A=d.transformTo("string",f.utf8encode(L)),O=P.length!==V.name.length,N=A.length!==L.length,J="",Y="",G="",Z=V.dir,Q=V.date,te={crc32:0,compressedSize:0,uncompressedSize:0};C&&!x||(te.crc32=_.crc32,te.compressedSize=_.compressedSize,te.uncompressedSize=_.uncompressedSize);var z=0;C&&(z|=8),I||!O&&!N||(z|=2048);var H=0,re=0;Z&&(H|=16),E==="UNIX"?(re=798,H|=(function(ie,be){var Ce=ie;return ie||(Ce=be?16893:33204),(65535&Ce)<<16})(V.unixPermissions,Z)):(re=20,H|=(function(ie){return 63&(ie||0)})(V.dosPermissions)),R=Q.getUTCHours(),R<<=6,R|=Q.getUTCMinutes(),R<<=5,R|=Q.getUTCSeconds()/2,M=Q.getUTCFullYear()-1980,M<<=4,M|=Q.getUTCMonth()+1,M<<=5,M|=Q.getUTCDate(),O&&(Y=o(1,1)+o(p(D),4)+P,J+="up"+o(Y.length,2)+Y),N&&(G=o(1,1)+o(p(q),4)+A,J+="uc"+o(G.length,2)+G);var ne="";return ne+=`
\0`,ne+=o(z,2),ne+=$.magic,ne+=o(R,2),ne+=o(M,2),ne+=o(te.crc32,4),ne+=o(te.compressedSize,4),ne+=o(te.uncompressedSize,4),ne+=o(D.length,2),ne+=o(J.length,2),{fileRecord:g.LOCAL_FILE_HEADER+ne+D+J,dirRecord:g.CENTRAL_FILE_HEADER+o(re,2)+ne+o(q.length,2)+"\0\0\0\0"+o(H,4)+o(w,4)+D+J+q}}var d=n("../utils"),h=n("../stream/GenericWorker"),f=n("../utf8"),p=n("../crc32"),g=n("../signature");function v(_,C,x,w){h.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=C,this.zipPlatform=x,this.encodeFileName=w,this.streamFiles=_,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}d.inherits(v,h),v.prototype.push=function(_){var C=_.meta.percent||0,x=this.entriesCount,w=this._sources.length;this.accumulate?this.contentBuffer.push(_):(this.bytesWritten+=_.data.length,h.prototype.push.call(this,{data:_.data,meta:{currentFile:this.currentFile,percent:x?(C+100*(x-w-1))/x:100}}))},v.prototype.openedSource=function(_){this.currentSourceOffset=this.bytesWritten,this.currentFile=_.file.name;var C=this.streamFiles&&!_.file.dir;if(C){var x=l(_,C,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:x.fileRecord,meta:{percent:0}})}else this.accumulate=!0},v.prototype.closedSource=function(_){this.accumulate=!1;var C=this.streamFiles&&!_.file.dir,x=l(_,C,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(x.dirRecord),C)this.push({data:(function(w){return g.DATA_DESCRIPTOR+o(w.crc32,4)+o(w.compressedSize,4)+o(w.uncompressedSize,4)})(_),meta:{percent:100}});else for(this.push({data:x.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},v.prototype.flush=function(){for(var _=this.bytesWritten,C=0;C<this.dirRecords.length;C++)this.push({data:this.dirRecords[C],meta:{percent:100}});var x=this.bytesWritten-_,w=(function(E,T,R,M,V){var $=d.transformTo("string",V(M));return g.CENTRAL_DIRECTORY_END+"\0\0\0\0"+o(E,2)+o(E,2)+o(T,4)+o(R,4)+o($.length,2)+$})(this.dirRecords.length,x,_,this.zipComment,this.encodeFileName);this.push({data:w,meta:{percent:100}})},v.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},v.prototype.registerPrevious=function(_){this._sources.push(_);var C=this;return _.on("data",function(x){C.processChunk(x)}),_.on("end",function(){C.closedSource(C.previous.streamInfo),C._sources.length?C.prepareNextSource():C.end()}),_.on("error",function(x){C.error(x)}),this},v.prototype.resume=function(){return!!h.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},v.prototype.error=function(_){var C=this._sources;if(!h.prototype.error.call(this,_))return!1;for(var x=0;x<C.length;x++)try{C[x].error(_)}catch{}return!0},v.prototype.lock=function(){h.prototype.lock.call(this);for(var _=this._sources,C=0;C<_.length;C++)_[C].lock()},r.exports=v},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(n,r,i){var o=n("../compressions"),l=n("./ZipFileWorker");i.generateWorker=function(d,h,f){var p=new l(h.streamFiles,f,h.platform,h.encodeFileName),g=0;try{d.forEach(function(v,_){g++;var C=(function(T,R){var M=T||R,V=o[M];if(!V)throw new Error(M+" is not a valid compression method !");return V})(_.options.compression,h.compression),x=_.options.compressionOptions||h.compressionOptions||{},w=_.dir,E=_.date;_._compressWorker(C,x).withStreamInfo("file",{name:v,dir:w,date:E,comment:_.comment||"",unixPermissions:_.unixPermissions,dosPermissions:_.dosPermissions}).pipe(p)}),p.entriesCount=g}catch(v){p.error(v)}return p}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(n,r,i){function o(){if(!(this instanceof o))return new o;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var l=new o;for(var d in this)typeof this[d]!="function"&&(l[d]=this[d]);return l}}(o.prototype=n("./object")).loadAsync=n("./load"),o.support=n("./support"),o.defaults=n("./defaults"),o.version="3.10.1",o.loadAsync=function(l,d){return new o().loadAsync(l,d)},o.external=n("./external"),r.exports=o},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(n,r,i){var o=n("./utils"),l=n("./external"),d=n("./utf8"),h=n("./zipEntries"),f=n("./stream/Crc32Probe"),p=n("./nodejsUtils");function g(v){return new l.Promise(function(_,C){var x=v.decompressed.getContentWorker().pipe(new f);x.on("error",function(w){C(w)}).on("end",function(){x.streamInfo.crc32!==v.decompressed.crc32?C(new Error("Corrupted zip : CRC32 mismatch")):_()}).resume()})}r.exports=function(v,_){var C=this;return _=o.extend(_||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:d.utf8decode}),p.isNode&&p.isStream(v)?l.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):o.prepareContent("the loaded zip file",v,!0,_.optimizedBinaryString,_.base64).then(function(x){var w=new h(_);return w.load(x),w}).then(function(x){var w=[l.Promise.resolve(x)],E=x.files;if(_.checkCRC32)for(var T=0;T<E.length;T++)w.push(g(E[T]));return l.Promise.all(w)}).then(function(x){for(var w=x.shift(),E=w.files,T=0;T<E.length;T++){var R=E[T],M=R.fileNameStr,V=o.resolve(R.fileNameStr);C.file(V,R.decompressed,{binary:!0,optimizedBinaryString:!0,date:R.date,dir:R.dir,comment:R.fileCommentStr.length?R.fileCommentStr:null,unixPermissions:R.unixPermissions,dosPermissions:R.dosPermissions,createFolders:_.createFolders}),R.dir||(C.file(V).unsafeOriginalName=M)}return w.zipComment.length&&(C.comment=w.zipComment),C})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(n,r,i){var o=n("../utils"),l=n("../stream/GenericWorker");function d(h,f){l.call(this,"Nodejs stream input adapter for "+h),this._upstreamEnded=!1,this._bindStream(f)}o.inherits(d,l),d.prototype._bindStream=function(h){var f=this;(this._stream=h).pause(),h.on("data",function(p){f.push({data:p,meta:{percent:0}})}).on("error",function(p){f.isPaused?this.generatedError=p:f.error(p)}).on("end",function(){f.isPaused?f._upstreamEnded=!0:f.end()})},d.prototype.pause=function(){return!!l.prototype.pause.call(this)&&(this._stream.pause(),!0)},d.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},r.exports=d},{"../stream/GenericWorker":28,"../utils":32}],13:[function(n,r,i){var o=n("readable-stream").Readable;function l(d,h,f){o.call(this,h),this._helper=d;var p=this;d.on("data",function(g,v){p.push(g)||p._helper.pause(),f&&f(v)}).on("error",function(g){p.emit("error",g)}).on("end",function(){p.push(null)})}n("../utils").inherits(l,o),l.prototype._read=function(){this._helper.resume()},r.exports=l},{"../utils":32,"readable-stream":16}],14:[function(n,r,i){r.exports={isNode:typeof Buffer<"u",newBufferFrom:function(o,l){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(o,l);if(typeof o=="number")throw new Error('The "data" argument must not be a number');return new Buffer(o,l)},allocBuffer:function(o){if(Buffer.alloc)return Buffer.alloc(o);var l=new Buffer(o);return l.fill(0),l},isBuffer:function(o){return Buffer.isBuffer(o)},isStream:function(o){return o&&typeof o.on=="function"&&typeof o.pause=="function"&&typeof o.resume=="function"}}},{}],15:[function(n,r,i){function o(V,$,I){var D,P=d.getTypeOf($),L=d.extend(I||{},p);L.date=L.date||new Date,L.compression!==null&&(L.compression=L.compression.toUpperCase()),typeof L.unixPermissions=="string"&&(L.unixPermissions=parseInt(L.unixPermissions,8)),L.unixPermissions&&16384&L.unixPermissions&&(L.dir=!0),L.dosPermissions&&16&L.dosPermissions&&(L.dir=!0),L.dir&&(V=E(V)),L.createFolders&&(D=w(V))&&T.call(this,D,!0);var q=P==="string"&&L.binary===!1&&L.base64===!1;I&&I.binary!==void 0||(L.binary=!q),($ instanceof g&&$.uncompressedSize===0||L.dir||!$||$.length===0)&&(L.base64=!1,L.binary=!0,$="",L.compression="STORE",P="string");var A=null;A=$ instanceof g||$ instanceof h?$:C.isNode&&C.isStream($)?new x(V,$):d.prepareContent(V,$,L.binary,L.optimizedBinaryString,L.base64);var O=new v(V,A,L);this.files[V]=O}var l=n("./utf8"),d=n("./utils"),h=n("./stream/GenericWorker"),f=n("./stream/StreamHelper"),p=n("./defaults"),g=n("./compressedObject"),v=n("./zipObject"),_=n("./generate"),C=n("./nodejsUtils"),x=n("./nodejs/NodejsStreamInputAdapter"),w=function(V){V.slice(-1)==="/"&&(V=V.substring(0,V.length-1));var $=V.lastIndexOf("/");return 0<$?V.substring(0,$):""},E=function(V){return V.slice(-1)!=="/"&&(V+="/"),V},T=function(V,$){return $=$!==void 0?$:p.createFolders,V=E(V),this.files[V]||o.call(this,V,null,{dir:!0,createFolders:$}),this.files[V]};function R(V){return Object.prototype.toString.call(V)==="[object RegExp]"}var M={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(V){var $,I,D;for($ in this.files)D=this.files[$],(I=$.slice(this.root.length,$.length))&&$.slice(0,this.root.length)===this.root&&V(I,D)},filter:function(V){var $=[];return this.forEach(function(I,D){V(I,D)&&$.push(D)}),$},file:function(V,$,I){if(arguments.length!==1)return V=this.root+V,o.call(this,V,$,I),this;if(R(V)){var D=V;return this.filter(function(L,q){return!q.dir&&D.test(L)})}var P=this.files[this.root+V];return P&&!P.dir?P:null},folder:function(V){if(!V)return this;if(R(V))return this.filter(function(P,L){return L.dir&&V.test(P)});var $=this.root+V,I=T.call(this,$),D=this.clone();return D.root=I.name,D},remove:function(V){V=this.root+V;var $=this.files[V];if($||(V.slice(-1)!=="/"&&(V+="/"),$=this.files[V]),$&&!$.dir)delete this.files[V];else for(var I=this.filter(function(P,L){return L.name.slice(0,V.length)===V}),D=0;D<I.length;D++)delete this.files[I[D].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(V){var $,I={};try{if((I=d.extend(V||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:l.utf8encode})).type=I.type.toLowerCase(),I.compression=I.compression.toUpperCase(),I.type==="binarystring"&&(I.type="string"),!I.type)throw new Error("No output type specified.");d.checkSupport(I.type),I.platform!=="darwin"&&I.platform!=="freebsd"&&I.platform!=="linux"&&I.platform!=="sunos"||(I.platform="UNIX"),I.platform==="win32"&&(I.platform="DOS");var D=I.comment||this.comment||"";$=_.generateWorker(this,I,D)}catch(P){($=new h("error")).error(P)}return new f($,I.type||"string",I.mimeType)},generateAsync:function(V,$){return this.generateInternalStream(V).accumulate($)},generateNodeStream:function(V,$){return(V=V||{}).type||(V.type="nodebuffer"),this.generateInternalStream(V).toNodejsStream($)}};r.exports=M},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(n,r,i){r.exports=n("stream")},{stream:void 0}],17:[function(n,r,i){var o=n("./DataReader");function l(d){o.call(this,d);for(var h=0;h<this.data.length;h++)d[h]=255&d[h]}n("../utils").inherits(l,o),l.prototype.byteAt=function(d){return this.data[this.zero+d]},l.prototype.lastIndexOfSignature=function(d){for(var h=d.charCodeAt(0),f=d.charCodeAt(1),p=d.charCodeAt(2),g=d.charCodeAt(3),v=this.length-4;0<=v;--v)if(this.data[v]===h&&this.data[v+1]===f&&this.data[v+2]===p&&this.data[v+3]===g)return v-this.zero;return-1},l.prototype.readAndCheckSignature=function(d){var h=d.charCodeAt(0),f=d.charCodeAt(1),p=d.charCodeAt(2),g=d.charCodeAt(3),v=this.readData(4);return h===v[0]&&f===v[1]&&p===v[2]&&g===v[3]},l.prototype.readData=function(d){if(this.checkOffset(d),d===0)return[];var h=this.data.slice(this.zero+this.index,this.zero+this.index+d);return this.index+=d,h},r.exports=l},{"../utils":32,"./DataReader":18}],18:[function(n,r,i){var o=n("../utils");function l(d){this.data=d,this.length=d.length,this.index=0,this.zero=0}l.prototype={checkOffset:function(d){this.checkIndex(this.index+d)},checkIndex:function(d){if(this.length<this.zero+d||d<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+d+"). Corrupted zip ?")},setIndex:function(d){this.checkIndex(d),this.index=d},skip:function(d){this.setIndex(this.index+d)},byteAt:function(){},readInt:function(d){var h,f=0;for(this.checkOffset(d),h=this.index+d-1;h>=this.index;h--)f=(f<<8)+this.byteAt(h);return this.index+=d,f},readString:function(d){return o.transformTo("string",this.readData(d))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var d=this.readInt(4);return new Date(Date.UTC(1980+(d>>25&127),(d>>21&15)-1,d>>16&31,d>>11&31,d>>5&63,(31&d)<<1))}},r.exports=l},{"../utils":32}],19:[function(n,r,i){var o=n("./Uint8ArrayReader");function l(d){o.call(this,d)}n("../utils").inherits(l,o),l.prototype.readData=function(d){this.checkOffset(d);var h=this.data.slice(this.zero+this.index,this.zero+this.index+d);return this.index+=d,h},r.exports=l},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(n,r,i){var o=n("./DataReader");function l(d){o.call(this,d)}n("../utils").inherits(l,o),l.prototype.byteAt=function(d){return this.data.charCodeAt(this.zero+d)},l.prototype.lastIndexOfSignature=function(d){return this.data.lastIndexOf(d)-this.zero},l.prototype.readAndCheckSignature=function(d){return d===this.readData(4)},l.prototype.readData=function(d){this.checkOffset(d);var h=this.data.slice(this.zero+this.index,this.zero+this.index+d);return this.index+=d,h},r.exports=l},{"../utils":32,"./DataReader":18}],21:[function(n,r,i){var o=n("./ArrayReader");function l(d){o.call(this,d)}n("../utils").inherits(l,o),l.prototype.readData=function(d){if(this.checkOffset(d),d===0)return new Uint8Array(0);var h=this.data.subarray(this.zero+this.index,this.zero+this.index+d);return this.index+=d,h},r.exports=l},{"../utils":32,"./ArrayReader":17}],22:[function(n,r,i){var o=n("../utils"),l=n("../support"),d=n("./ArrayReader"),h=n("./StringReader"),f=n("./NodeBufferReader"),p=n("./Uint8ArrayReader");r.exports=function(g){var v=o.getTypeOf(g);return o.checkSupport(v),v!=="string"||l.uint8array?v==="nodebuffer"?new f(g):l.uint8array?new p(o.transformTo("uint8array",g)):new d(o.transformTo("array",g)):new h(g)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(n,r,i){i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(n,r,i){var o=n("./GenericWorker"),l=n("../utils");function d(h){o.call(this,"ConvertWorker to "+h),this.destType=h}l.inherits(d,o),d.prototype.processChunk=function(h){this.push({data:l.transformTo(this.destType,h.data),meta:h.meta})},r.exports=d},{"../utils":32,"./GenericWorker":28}],25:[function(n,r,i){var o=n("./GenericWorker"),l=n("../crc32");function d(){o.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}n("../utils").inherits(d,o),d.prototype.processChunk=function(h){this.streamInfo.crc32=l(h.data,this.streamInfo.crc32||0),this.push(h)},r.exports=d},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(n,r,i){var o=n("../utils"),l=n("./GenericWorker");function d(h){l.call(this,"DataLengthProbe for "+h),this.propName=h,this.withStreamInfo(h,0)}o.inherits(d,l),d.prototype.processChunk=function(h){if(h){var f=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=f+h.data.length}l.prototype.processChunk.call(this,h)},r.exports=d},{"../utils":32,"./GenericWorker":28}],27:[function(n,r,i){var o=n("../utils"),l=n("./GenericWorker");function d(h){l.call(this,"DataWorker");var f=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,h.then(function(p){f.dataIsReady=!0,f.data=p,f.max=p&&p.length||0,f.type=o.getTypeOf(p),f.isPaused||f._tickAndRepeat()},function(p){f.error(p)})}o.inherits(d,l),d.prototype.cleanUp=function(){l.prototype.cleanUp.call(this),this.data=null},d.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,o.delay(this._tickAndRepeat,[],this)),!0)},d.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(o.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},d.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var h=null,f=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":h=this.data.substring(this.index,f);break;case"uint8array":h=this.data.subarray(this.index,f);break;case"array":case"nodebuffer":h=this.data.slice(this.index,f)}return this.index=f,this.push({data:h,meta:{percent:this.max?this.index/this.max*100:0}})},r.exports=d},{"../utils":32,"./GenericWorker":28}],28:[function(n,r,i){function o(l){this.name=l||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}o.prototype={push:function(l){this.emit("data",l)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(l){this.emit("error",l)}return!0},error:function(l){return!this.isFinished&&(this.isPaused?this.generatedError=l:(this.isFinished=!0,this.emit("error",l),this.previous&&this.previous.error(l),this.cleanUp()),!0)},on:function(l,d){return this._listeners[l].push(d),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(l,d){if(this._listeners[l])for(var h=0;h<this._listeners[l].length;h++)this._listeners[l][h].call(this,d)},pipe:function(l){return l.registerPrevious(this)},registerPrevious:function(l){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=l.streamInfo,this.mergeStreamInfo(),this.previous=l;var d=this;return l.on("data",function(h){d.processChunk(h)}),l.on("end",function(){d.end()}),l.on("error",function(h){d.error(h)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var l=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),l=!0),this.previous&&this.previous.resume(),!l},flush:function(){},processChunk:function(l){this.push(l)},withStreamInfo:function(l,d){return this.extraStreamInfo[l]=d,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var l in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,l)&&(this.streamInfo[l]=this.extraStreamInfo[l])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var l="Worker "+this.name;return this.previous?this.previous+" -> "+l:l}},r.exports=o},{}],29:[function(n,r,i){var o=n("../utils"),l=n("./ConvertWorker"),d=n("./GenericWorker"),h=n("../base64"),f=n("../support"),p=n("../external"),g=null;if(f.nodestream)try{g=n("../nodejs/NodejsStreamOutputAdapter")}catch{}function v(C,x){return new p.Promise(function(w,E){var T=[],R=C._internalType,M=C._outputType,V=C._mimeType;C.on("data",function($,I){T.push($),x&&x(I)}).on("error",function($){T=[],E($)}).on("end",function(){try{var $=(function(I,D,P){switch(I){case"blob":return o.newBlob(o.transformTo("arraybuffer",D),P);case"base64":return h.encode(D);default:return o.transformTo(I,D)}})(M,(function(I,D){var P,L=0,q=null,A=0;for(P=0;P<D.length;P++)A+=D[P].length;switch(I){case"string":return D.join("");case"array":return Array.prototype.concat.apply([],D);case"uint8array":for(q=new Uint8Array(A),P=0;P<D.length;P++)q.set(D[P],L),L+=D[P].length;return q;case"nodebuffer":return Buffer.concat(D);default:throw new Error("concat : unsupported type '"+I+"'")}})(R,T),V);w($)}catch(I){E(I)}T=[]}).resume()})}function _(C,x,w){var E=x;switch(x){case"blob":case"arraybuffer":E="uint8array";break;case"base64":E="string"}try{this._internalType=E,this._outputType=x,this._mimeType=w,o.checkSupport(E),this._worker=C.pipe(new l(E)),C.lock()}catch(T){this._worker=new d("error"),this._worker.error(T)}}_.prototype={accumulate:function(C){return v(this,C)},on:function(C,x){var w=this;return C==="data"?this._worker.on(C,function(E){x.call(w,E.data,E.meta)}):this._worker.on(C,function(){o.delay(x,arguments,w)}),this},resume:function(){return o.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(C){if(o.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new g(this,{objectMode:this._outputType!=="nodebuffer"},C)}},r.exports=_},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(n,r,i){if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",i.nodebuffer=typeof Buffer<"u",i.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")i.blob=!1;else{var o=new ArrayBuffer(0);try{i.blob=new Blob([o],{type:"application/zip"}).size===0}catch{try{var l=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);l.append(o),i.blob=l.getBlob("application/zip").size===0}catch{i.blob=!1}}}try{i.nodestream=!!n("readable-stream").Readable}catch{i.nodestream=!1}},{"readable-stream":16}],31:[function(n,r,i){for(var o=n("./utils"),l=n("./support"),d=n("./nodejsUtils"),h=n("./stream/GenericWorker"),f=new Array(256),p=0;p<256;p++)f[p]=252<=p?6:248<=p?5:240<=p?4:224<=p?3:192<=p?2:1;f[254]=f[254]=1;function g(){h.call(this,"utf-8 decode"),this.leftOver=null}function v(){h.call(this,"utf-8 encode")}i.utf8encode=function(_){return l.nodebuffer?d.newBufferFrom(_,"utf-8"):(function(C){var x,w,E,T,R,M=C.length,V=0;for(T=0;T<M;T++)(64512&(w=C.charCodeAt(T)))==55296&&T+1<M&&(64512&(E=C.charCodeAt(T+1)))==56320&&(w=65536+(w-55296<<10)+(E-56320),T++),V+=w<128?1:w<2048?2:w<65536?3:4;for(x=l.uint8array?new Uint8Array(V):new Array(V),T=R=0;R<V;T++)(64512&(w=C.charCodeAt(T)))==55296&&T+1<M&&(64512&(E=C.charCodeAt(T+1)))==56320&&(w=65536+(w-55296<<10)+(E-56320),T++),w<128?x[R++]=w:(w<2048?x[R++]=192|w>>>6:(w<65536?x[R++]=224|w>>>12:(x[R++]=240|w>>>18,x[R++]=128|w>>>12&63),x[R++]=128|w>>>6&63),x[R++]=128|63&w);return x})(_)},i.utf8decode=function(_){return l.nodebuffer?o.transformTo("nodebuffer",_).toString("utf-8"):(function(C){var x,w,E,T,R=C.length,M=new Array(2*R);for(x=w=0;x<R;)if((E=C[x++])<128)M[w++]=E;else if(4<(T=f[E]))M[w++]=65533,x+=T-1;else{for(E&=T===2?31:T===3?15:7;1<T&&x<R;)E=E<<6|63&C[x++],T--;1<T?M[w++]=65533:E<65536?M[w++]=E:(E-=65536,M[w++]=55296|E>>10&1023,M[w++]=56320|1023&E)}return M.length!==w&&(M.subarray?M=M.subarray(0,w):M.length=w),o.applyFromCharCode(M)})(_=o.transformTo(l.uint8array?"uint8array":"array",_))},o.inherits(g,h),g.prototype.processChunk=function(_){var C=o.transformTo(l.uint8array?"uint8array":"array",_.data);if(this.leftOver&&this.leftOver.length){if(l.uint8array){var x=C;(C=new Uint8Array(x.length+this.leftOver.length)).set(this.leftOver,0),C.set(x,this.leftOver.length)}else C=this.leftOver.concat(C);this.leftOver=null}var w=(function(T,R){var M;for((R=R||T.length)>T.length&&(R=T.length),M=R-1;0<=M&&(192&T[M])==128;)M--;return M<0||M===0?R:M+f[T[M]]>R?M:R})(C),E=C;w!==C.length&&(l.uint8array?(E=C.subarray(0,w),this.leftOver=C.subarray(w,C.length)):(E=C.slice(0,w),this.leftOver=C.slice(w,C.length))),this.push({data:i.utf8decode(E),meta:_.meta})},g.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:i.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},i.Utf8DecodeWorker=g,o.inherits(v,h),v.prototype.processChunk=function(_){this.push({data:i.utf8encode(_.data),meta:_.meta})},i.Utf8EncodeWorker=v},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(n,r,i){var o=n("./support"),l=n("./base64"),d=n("./nodejsUtils"),h=n("./external");function f(x){return x}function p(x,w){for(var E=0;E<x.length;++E)w[E]=255&x.charCodeAt(E);return w}n("setimmediate"),i.newBlob=function(x,w){i.checkSupport("blob");try{return new Blob([x],{type:w})}catch{try{var E=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return E.append(x),E.getBlob(w)}catch{throw new Error("Bug : can't construct the Blob.")}}};var g={stringifyByChunk:function(x,w,E){var T=[],R=0,M=x.length;if(M<=E)return String.fromCharCode.apply(null,x);for(;R<M;)w==="array"||w==="nodebuffer"?T.push(String.fromCharCode.apply(null,x.slice(R,Math.min(R+E,M)))):T.push(String.fromCharCode.apply(null,x.subarray(R,Math.min(R+E,M)))),R+=E;return T.join("")},stringifyByChar:function(x){for(var w="",E=0;E<x.length;E++)w+=String.fromCharCode(x[E]);return w},applyCanBeUsed:{uint8array:(function(){try{return o.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}})(),nodebuffer:(function(){try{return o.nodebuffer&&String.fromCharCode.apply(null,d.allocBuffer(1)).length===1}catch{return!1}})()}};function v(x){var w=65536,E=i.getTypeOf(x),T=!0;if(E==="uint8array"?T=g.applyCanBeUsed.uint8array:E==="nodebuffer"&&(T=g.applyCanBeUsed.nodebuffer),T)for(;1<w;)try{return g.stringifyByChunk(x,E,w)}catch{w=Math.floor(w/2)}return g.stringifyByChar(x)}function _(x,w){for(var E=0;E<x.length;E++)w[E]=x[E];return w}i.applyFromCharCode=v;var C={};C.string={string:f,array:function(x){return p(x,new Array(x.length))},arraybuffer:function(x){return C.string.uint8array(x).buffer},uint8array:function(x){return p(x,new Uint8Array(x.length))},nodebuffer:function(x){return p(x,d.allocBuffer(x.length))}},C.array={string:v,array:f,arraybuffer:function(x){return new Uint8Array(x).buffer},uint8array:function(x){return new Uint8Array(x)},nodebuffer:function(x){return d.newBufferFrom(x)}},C.arraybuffer={string:function(x){return v(new Uint8Array(x))},array:function(x){return _(new Uint8Array(x),new Array(x.byteLength))},arraybuffer:f,uint8array:function(x){return new Uint8Array(x)},nodebuffer:function(x){return d.newBufferFrom(new Uint8Array(x))}},C.uint8array={string:v,array:function(x){return _(x,new Array(x.length))},arraybuffer:function(x){return x.buffer},uint8array:f,nodebuffer:function(x){return d.newBufferFrom(x)}},C.nodebuffer={string:v,array:function(x){return _(x,new Array(x.length))},arraybuffer:function(x){return C.nodebuffer.uint8array(x).buffer},uint8array:function(x){return _(x,new Uint8Array(x.length))},nodebuffer:f},i.transformTo=function(x,w){if(w=w||"",!x)return w;i.checkSupport(x);var E=i.getTypeOf(w);return C[E][x](w)},i.resolve=function(x){for(var w=x.split("/"),E=[],T=0;T<w.length;T++){var R=w[T];R==="."||R===""&&T!==0&&T!==w.length-1||(R===".."?E.pop():E.push(R))}return E.join("/")},i.getTypeOf=function(x){return typeof x=="string"?"string":Object.prototype.toString.call(x)==="[object Array]"?"array":o.nodebuffer&&d.isBuffer(x)?"nodebuffer":o.uint8array&&x instanceof Uint8Array?"uint8array":o.arraybuffer&&x instanceof ArrayBuffer?"arraybuffer":void 0},i.checkSupport=function(x){if(!o[x.toLowerCase()])throw new Error(x+" is not supported by this platform")},i.MAX_VALUE_16BITS=65535,i.MAX_VALUE_32BITS=-1,i.pretty=function(x){var w,E,T="";for(E=0;E<(x||"").length;E++)T+="\\x"+((w=x.charCodeAt(E))<16?"0":"")+w.toString(16).toUpperCase();return T},i.delay=function(x,w,E){setImmediate(function(){x.apply(E||null,w||[])})},i.inherits=function(x,w){function E(){}E.prototype=w.prototype,x.prototype=new E},i.extend=function(){var x,w,E={};for(x=0;x<arguments.length;x++)for(w in arguments[x])Object.prototype.hasOwnProperty.call(arguments[x],w)&&E[w]===void 0&&(E[w]=arguments[x][w]);return E},i.prepareContent=function(x,w,E,T,R){return h.Promise.resolve(w).then(function(M){return o.blob&&(M instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(M))!==-1)&&typeof FileReader<"u"?new h.Promise(function(V,$){var I=new FileReader;I.onload=function(D){V(D.target.result)},I.onerror=function(D){$(D.target.error)},I.readAsArrayBuffer(M)}):M}).then(function(M){var V=i.getTypeOf(M);return V?(V==="arraybuffer"?M=i.transformTo("uint8array",M):V==="string"&&(R?M=l.decode(M):E&&T!==!0&&(M=(function($){return p($,o.uint8array?new Uint8Array($.length):new Array($.length))})(M))),M):h.Promise.reject(new Error("Can't read the data of '"+x+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(n,r,i){var o=n("./reader/readerFor"),l=n("./utils"),d=n("./signature"),h=n("./zipEntry"),f=n("./support");function p(g){this.files=[],this.loadOptions=g}p.prototype={checkSignature:function(g){if(!this.reader.readAndCheckSignature(g)){this.reader.index-=4;var v=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+l.pretty(v)+", expected "+l.pretty(g)+")")}},isSignature:function(g,v){var _=this.reader.index;this.reader.setIndex(g);var C=this.reader.readString(4)===v;return this.reader.setIndex(_),C},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var g=this.reader.readData(this.zipCommentLength),v=f.uint8array?"uint8array":"array",_=l.transformTo(v,g);this.zipComment=this.loadOptions.decodeFileName(_)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var g,v,_,C=this.zip64EndOfCentralSize-44;0<C;)g=this.reader.readInt(2),v=this.reader.readInt(4),_=this.reader.readData(v),this.zip64ExtensibleData[g]={id:g,length:v,value:_}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var g,v;for(g=0;g<this.files.length;g++)v=this.files[g],this.reader.setIndex(v.localHeaderOffset),this.checkSignature(d.LOCAL_FILE_HEADER),v.readLocalPart(this.reader),v.handleUTF8(),v.processAttributes()},readCentralDir:function(){var g;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(d.CENTRAL_FILE_HEADER);)(g=new h({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(g);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var g=this.reader.lastIndexOfSignature(d.CENTRAL_DIRECTORY_END);if(g<0)throw this.isSignature(0,d.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(g);var v=g;if(this.checkSignature(d.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===l.MAX_VALUE_16BITS||this.diskWithCentralDirStart===l.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===l.MAX_VALUE_16BITS||this.centralDirRecords===l.MAX_VALUE_16BITS||this.centralDirSize===l.MAX_VALUE_32BITS||this.centralDirOffset===l.MAX_VALUE_32BITS){if(this.zip64=!0,(g=this.reader.lastIndexOfSignature(d.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(g),this.checkSignature(d.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,d.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(d.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(d.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var _=this.centralDirOffset+this.centralDirSize;this.zip64&&(_+=20,_+=12+this.zip64EndOfCentralSize);var C=v-_;if(0<C)this.isSignature(v,d.CENTRAL_FILE_HEADER)||(this.reader.zero=C);else if(C<0)throw new Error("Corrupted zip: missing "+Math.abs(C)+" bytes.")},prepareReader:function(g){this.reader=o(g)},load:function(g){this.prepareReader(g),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},r.exports=p},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(n,r,i){var o=n("./reader/readerFor"),l=n("./utils"),d=n("./compressedObject"),h=n("./crc32"),f=n("./utf8"),p=n("./compressions"),g=n("./support");function v(_,C){this.options=_,this.loadOptions=C}v.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(_){var C,x;if(_.skip(22),this.fileNameLength=_.readInt(2),x=_.readInt(2),this.fileName=_.readData(this.fileNameLength),_.skip(x),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((C=(function(w){for(var E in p)if(Object.prototype.hasOwnProperty.call(p,E)&&p[E].magic===w)return p[E];return null})(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+l.pretty(this.compressionMethod)+" unknown (inner file : "+l.transformTo("string",this.fileName)+")");this.decompressed=new d(this.compressedSize,this.uncompressedSize,this.crc32,C,_.readData(this.compressedSize))},readCentralPart:function(_){this.versionMadeBy=_.readInt(2),_.skip(2),this.bitFlag=_.readInt(2),this.compressionMethod=_.readString(2),this.date=_.readDate(),this.crc32=_.readInt(4),this.compressedSize=_.readInt(4),this.uncompressedSize=_.readInt(4);var C=_.readInt(2);if(this.extraFieldsLength=_.readInt(2),this.fileCommentLength=_.readInt(2),this.diskNumberStart=_.readInt(2),this.internalFileAttributes=_.readInt(2),this.externalFileAttributes=_.readInt(4),this.localHeaderOffset=_.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");_.skip(C),this.readExtraFields(_),this.parseZIP64ExtraField(_),this.fileComment=_.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var _=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),_==0&&(this.dosPermissions=63&this.externalFileAttributes),_==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var _=o(this.extraFields[1].value);this.uncompressedSize===l.MAX_VALUE_32BITS&&(this.uncompressedSize=_.readInt(8)),this.compressedSize===l.MAX_VALUE_32BITS&&(this.compressedSize=_.readInt(8)),this.localHeaderOffset===l.MAX_VALUE_32BITS&&(this.localHeaderOffset=_.readInt(8)),this.diskNumberStart===l.MAX_VALUE_32BITS&&(this.diskNumberStart=_.readInt(4))}},readExtraFields:function(_){var C,x,w,E=_.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});_.index+4<E;)C=_.readInt(2),x=_.readInt(2),w=_.readData(x),this.extraFields[C]={id:C,length:x,value:w};_.setIndex(E)},handleUTF8:function(){var _=g.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=f.utf8decode(this.fileName),this.fileCommentStr=f.utf8decode(this.fileComment);else{var C=this.findExtraFieldUnicodePath();if(C!==null)this.fileNameStr=C;else{var x=l.transformTo(_,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(x)}var w=this.findExtraFieldUnicodeComment();if(w!==null)this.fileCommentStr=w;else{var E=l.transformTo(_,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(E)}}},findExtraFieldUnicodePath:function(){var _=this.extraFields[28789];if(_){var C=o(_.value);return C.readInt(1)!==1||h(this.fileName)!==C.readInt(4)?null:f.utf8decode(C.readData(_.length-5))}return null},findExtraFieldUnicodeComment:function(){var _=this.extraFields[25461];if(_){var C=o(_.value);return C.readInt(1)!==1||h(this.fileComment)!==C.readInt(4)?null:f.utf8decode(C.readData(_.length-5))}return null}},r.exports=v},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(n,r,i){function o(C,x,w){this.name=C,this.dir=w.dir,this.date=w.date,this.comment=w.comment,this.unixPermissions=w.unixPermissions,this.dosPermissions=w.dosPermissions,this._data=x,this._dataBinary=w.binary,this.options={compression:w.compression,compressionOptions:w.compressionOptions}}var l=n("./stream/StreamHelper"),d=n("./stream/DataWorker"),h=n("./utf8"),f=n("./compressedObject"),p=n("./stream/GenericWorker");o.prototype={internalStream:function(C){var x=null,w="string";try{if(!C)throw new Error("No output type specified.");var E=(w=C.toLowerCase())==="string"||w==="text";w!=="binarystring"&&w!=="text"||(w="string"),x=this._decompressWorker();var T=!this._dataBinary;T&&!E&&(x=x.pipe(new h.Utf8EncodeWorker)),!T&&E&&(x=x.pipe(new h.Utf8DecodeWorker))}catch(R){(x=new p("error")).error(R)}return new l(x,w,"")},async:function(C,x){return this.internalStream(C).accumulate(x)},nodeStream:function(C,x){return this.internalStream(C||"nodebuffer").toNodejsStream(x)},_compressWorker:function(C,x){if(this._data instanceof f&&this._data.compression.magic===C.magic)return this._data.getCompressedWorker();var w=this._decompressWorker();return this._dataBinary||(w=w.pipe(new h.Utf8EncodeWorker)),f.createWorkerFrom(w,C,x)},_decompressWorker:function(){return this._data instanceof f?this._data.getContentWorker():this._data instanceof p?this._data:new d(this._data)}};for(var g=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],v=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},_=0;_<g.length;_++)o.prototype[g[_]]=v;r.exports=o},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(n,r,i){(function(o){var l,d,h=o.MutationObserver||o.WebKitMutationObserver;if(h){var f=0,p=new h(C),g=o.document.createTextNode("");p.observe(g,{characterData:!0}),l=function(){g.data=f=++f%2}}else if(o.setImmediate||o.MessageChannel===void 0)l="document"in o&&"onreadystatechange"in o.document.createElement("script")?function(){var x=o.document.createElement("script");x.onreadystatechange=function(){C(),x.onreadystatechange=null,x.parentNode.removeChild(x),x=null},o.document.documentElement.appendChild(x)}:function(){setTimeout(C,0)};else{var v=new o.MessageChannel;v.port1.onmessage=C,l=function(){v.port2.postMessage(0)}}var _=[];function C(){var x,w;d=!0;for(var E=_.length;E;){for(w=_,_=[],x=-1;++x<E;)w[x]();E=_.length}d=!1}r.exports=function(x){_.push(x)!==1||d||l()}}).call(this,typeof Lh<"u"?Lh:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(n,r,i){var o=n("immediate");function l(){}var d={},h=["REJECTED"],f=["FULFILLED"],p=["PENDING"];function g(E){if(typeof E!="function")throw new TypeError("resolver must be a function");this.state=p,this.queue=[],this.outcome=void 0,E!==l&&x(this,E)}function v(E,T,R){this.promise=E,typeof T=="function"&&(this.onFulfilled=T,this.callFulfilled=this.otherCallFulfilled),typeof R=="function"&&(this.onRejected=R,this.callRejected=this.otherCallRejected)}function _(E,T,R){o(function(){var M;try{M=T(R)}catch(V){return d.reject(E,V)}M===E?d.reject(E,new TypeError("Cannot resolve promise with itself")):d.resolve(E,M)})}function C(E){var T=E&&E.then;if(E&&(typeof E=="object"||typeof E=="function")&&typeof T=="function")return function(){T.apply(E,arguments)}}function x(E,T){var R=!1;function M(I){R||(R=!0,d.reject(E,I))}function V(I){R||(R=!0,d.resolve(E,I))}var $=w(function(){T(V,M)});$.status==="error"&&M($.value)}function w(E,T){var R={};try{R.value=E(T),R.status="success"}catch(M){R.status="error",R.value=M}return R}(r.exports=g).prototype.finally=function(E){if(typeof E!="function")return this;var T=this.constructor;return this.then(function(R){return T.resolve(E()).then(function(){return R})},function(R){return T.resolve(E()).then(function(){throw R})})},g.prototype.catch=function(E){return this.then(null,E)},g.prototype.then=function(E,T){if(typeof E!="function"&&this.state===f||typeof T!="function"&&this.state===h)return this;var R=new this.constructor(l);return this.state!==p?_(R,this.state===f?E:T,this.outcome):this.queue.push(new v(R,E,T)),R},v.prototype.callFulfilled=function(E){d.resolve(this.promise,E)},v.prototype.otherCallFulfilled=function(E){_(this.promise,this.onFulfilled,E)},v.prototype.callRejected=function(E){d.reject(this.promise,E)},v.prototype.otherCallRejected=function(E){_(this.promise,this.onRejected,E)},d.resolve=function(E,T){var R=w(C,T);if(R.status==="error")return d.reject(E,R.value);var M=R.value;if(M)x(E,M);else{E.state=f,E.outcome=T;for(var V=-1,$=E.queue.length;++V<$;)E.queue[V].callFulfilled(T)}return E},d.reject=function(E,T){E.state=h,E.outcome=T;for(var R=-1,M=E.queue.length;++R<M;)E.queue[R].callRejected(T);return E},g.resolve=function(E){return E instanceof this?E:d.resolve(new this(l),E)},g.reject=function(E){var T=new this(l);return d.reject(T,E)},g.all=function(E){var T=this;if(Object.prototype.toString.call(E)!=="[object Array]")return this.reject(new TypeError("must be an array"));var R=E.length,M=!1;if(!R)return this.resolve([]);for(var V=new Array(R),$=0,I=-1,D=new this(l);++I<R;)P(E[I],I);return D;function P(L,q){T.resolve(L).then(function(A){V[q]=A,++$!==R||M||(M=!0,d.resolve(D,V))},function(A){M||(M=!0,d.reject(D,A))})}},g.race=function(E){var T=this;if(Object.prototype.toString.call(E)!=="[object Array]")return this.reject(new TypeError("must be an array"));var R=E.length,M=!1;if(!R)return this.resolve([]);for(var V=-1,$=new this(l);++V<R;)I=E[V],T.resolve(I).then(function(D){M||(M=!0,d.resolve($,D))},function(D){M||(M=!0,d.reject($,D))});var I;return $}},{immediate:36}],38:[function(n,r,i){var o={};(0,n("./lib/utils/common").assign)(o,n("./lib/deflate"),n("./lib/inflate"),n("./lib/zlib/constants")),r.exports=o},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(n,r,i){var o=n("./zlib/deflate"),l=n("./utils/common"),d=n("./utils/strings"),h=n("./zlib/messages"),f=n("./zlib/zstream"),p=Object.prototype.toString,g=0,v=-1,_=0,C=8;function x(E){if(!(this instanceof x))return new x(E);this.options=l.assign({level:v,method:C,chunkSize:16384,windowBits:15,memLevel:8,strategy:_,to:""},E||{});var T=this.options;T.raw&&0<T.windowBits?T.windowBits=-T.windowBits:T.gzip&&0<T.windowBits&&T.windowBits<16&&(T.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new f,this.strm.avail_out=0;var R=o.deflateInit2(this.strm,T.level,T.method,T.windowBits,T.memLevel,T.strategy);if(R!==g)throw new Error(h[R]);if(T.header&&o.deflateSetHeader(this.strm,T.header),T.dictionary){var M;if(M=typeof T.dictionary=="string"?d.string2buf(T.dictionary):p.call(T.dictionary)==="[object ArrayBuffer]"?new Uint8Array(T.dictionary):T.dictionary,(R=o.deflateSetDictionary(this.strm,M))!==g)throw new Error(h[R]);this._dict_set=!0}}function w(E,T){var R=new x(T);if(R.push(E,!0),R.err)throw R.msg||h[R.err];return R.result}x.prototype.push=function(E,T){var R,M,V=this.strm,$=this.options.chunkSize;if(this.ended)return!1;M=T===~~T?T:T===!0?4:0,typeof E=="string"?V.input=d.string2buf(E):p.call(E)==="[object ArrayBuffer]"?V.input=new Uint8Array(E):V.input=E,V.next_in=0,V.avail_in=V.input.length;do{if(V.avail_out===0&&(V.output=new l.Buf8($),V.next_out=0,V.avail_out=$),(R=o.deflate(V,M))!==1&&R!==g)return this.onEnd(R),!(this.ended=!0);V.avail_out!==0&&(V.avail_in!==0||M!==4&&M!==2)||(this.options.to==="string"?this.onData(d.buf2binstring(l.shrinkBuf(V.output,V.next_out))):this.onData(l.shrinkBuf(V.output,V.next_out)))}while((0<V.avail_in||V.avail_out===0)&&R!==1);return M===4?(R=o.deflateEnd(this.strm),this.onEnd(R),this.ended=!0,R===g):M!==2||(this.onEnd(g),!(V.avail_out=0))},x.prototype.onData=function(E){this.chunks.push(E)},x.prototype.onEnd=function(E){E===g&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=l.flattenChunks(this.chunks)),this.chunks=[],this.err=E,this.msg=this.strm.msg},i.Deflate=x,i.deflate=w,i.deflateRaw=function(E,T){return(T=T||{}).raw=!0,w(E,T)},i.gzip=function(E,T){return(T=T||{}).gzip=!0,w(E,T)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(n,r,i){var o=n("./zlib/inflate"),l=n("./utils/common"),d=n("./utils/strings"),h=n("./zlib/constants"),f=n("./zlib/messages"),p=n("./zlib/zstream"),g=n("./zlib/gzheader"),v=Object.prototype.toString;function _(x){if(!(this instanceof _))return new _(x);this.options=l.assign({chunkSize:16384,windowBits:0,to:""},x||{});var w=this.options;w.raw&&0<=w.windowBits&&w.windowBits<16&&(w.windowBits=-w.windowBits,w.windowBits===0&&(w.windowBits=-15)),!(0<=w.windowBits&&w.windowBits<16)||x&&x.windowBits||(w.windowBits+=32),15<w.windowBits&&w.windowBits<48&&(15&w.windowBits)==0&&(w.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new p,this.strm.avail_out=0;var E=o.inflateInit2(this.strm,w.windowBits);if(E!==h.Z_OK)throw new Error(f[E]);this.header=new g,o.inflateGetHeader(this.strm,this.header)}function C(x,w){var E=new _(w);if(E.push(x,!0),E.err)throw E.msg||f[E.err];return E.result}_.prototype.push=function(x,w){var E,T,R,M,V,$,I=this.strm,D=this.options.chunkSize,P=this.options.dictionary,L=!1;if(this.ended)return!1;T=w===~~w?w:w===!0?h.Z_FINISH:h.Z_NO_FLUSH,typeof x=="string"?I.input=d.binstring2buf(x):v.call(x)==="[object ArrayBuffer]"?I.input=new Uint8Array(x):I.input=x,I.next_in=0,I.avail_in=I.input.length;do{if(I.avail_out===0&&(I.output=new l.Buf8(D),I.next_out=0,I.avail_out=D),(E=o.inflate(I,h.Z_NO_FLUSH))===h.Z_NEED_DICT&&P&&($=typeof P=="string"?d.string2buf(P):v.call(P)==="[object ArrayBuffer]"?new Uint8Array(P):P,E=o.inflateSetDictionary(this.strm,$)),E===h.Z_BUF_ERROR&&L===!0&&(E=h.Z_OK,L=!1),E!==h.Z_STREAM_END&&E!==h.Z_OK)return this.onEnd(E),!(this.ended=!0);I.next_out&&(I.avail_out!==0&&E!==h.Z_STREAM_END&&(I.avail_in!==0||T!==h.Z_FINISH&&T!==h.Z_SYNC_FLUSH)||(this.options.to==="string"?(R=d.utf8border(I.output,I.next_out),M=I.next_out-R,V=d.buf2string(I.output,R),I.next_out=M,I.avail_out=D-M,M&&l.arraySet(I.output,I.output,R,M,0),this.onData(V)):this.onData(l.shrinkBuf(I.output,I.next_out)))),I.avail_in===0&&I.avail_out===0&&(L=!0)}while((0<I.avail_in||I.avail_out===0)&&E!==h.Z_STREAM_END);return E===h.Z_STREAM_END&&(T=h.Z_FINISH),T===h.Z_FINISH?(E=o.inflateEnd(this.strm),this.onEnd(E),this.ended=!0,E===h.Z_OK):T!==h.Z_SYNC_FLUSH||(this.onEnd(h.Z_OK),!(I.avail_out=0))},_.prototype.onData=function(x){this.chunks.push(x)},_.prototype.onEnd=function(x){x===h.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=l.flattenChunks(this.chunks)),this.chunks=[],this.err=x,this.msg=this.strm.msg},i.Inflate=_,i.inflate=C,i.inflateRaw=function(x,w){return(w=w||{}).raw=!0,C(x,w)},i.ungzip=C},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(n,r,i){var o=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";i.assign=function(h){for(var f=Array.prototype.slice.call(arguments,1);f.length;){var p=f.shift();if(p){if(typeof p!="object")throw new TypeError(p+"must be non-object");for(var g in p)p.hasOwnProperty(g)&&(h[g]=p[g])}}return h},i.shrinkBuf=function(h,f){return h.length===f?h:h.subarray?h.subarray(0,f):(h.length=f,h)};var l={arraySet:function(h,f,p,g,v){if(f.subarray&&h.subarray)h.set(f.subarray(p,p+g),v);else for(var _=0;_<g;_++)h[v+_]=f[p+_]},flattenChunks:function(h){var f,p,g,v,_,C;for(f=g=0,p=h.length;f<p;f++)g+=h[f].length;for(C=new Uint8Array(g),f=v=0,p=h.length;f<p;f++)_=h[f],C.set(_,v),v+=_.length;return C}},d={arraySet:function(h,f,p,g,v){for(var _=0;_<g;_++)h[v+_]=f[p+_]},flattenChunks:function(h){return[].concat.apply([],h)}};i.setTyped=function(h){h?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,l)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,d))},i.setTyped(o)},{}],42:[function(n,r,i){var o=n("./common"),l=!0,d=!0;try{String.fromCharCode.apply(null,[0])}catch{l=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{d=!1}for(var h=new o.Buf8(256),f=0;f<256;f++)h[f]=252<=f?6:248<=f?5:240<=f?4:224<=f?3:192<=f?2:1;function p(g,v){if(v<65537&&(g.subarray&&d||!g.subarray&&l))return String.fromCharCode.apply(null,o.shrinkBuf(g,v));for(var _="",C=0;C<v;C++)_+=String.fromCharCode(g[C]);return _}h[254]=h[254]=1,i.string2buf=function(g){var v,_,C,x,w,E=g.length,T=0;for(x=0;x<E;x++)(64512&(_=g.charCodeAt(x)))==55296&&x+1<E&&(64512&(C=g.charCodeAt(x+1)))==56320&&(_=65536+(_-55296<<10)+(C-56320),x++),T+=_<128?1:_<2048?2:_<65536?3:4;for(v=new o.Buf8(T),x=w=0;w<T;x++)(64512&(_=g.charCodeAt(x)))==55296&&x+1<E&&(64512&(C=g.charCodeAt(x+1)))==56320&&(_=65536+(_-55296<<10)+(C-56320),x++),_<128?v[w++]=_:(_<2048?v[w++]=192|_>>>6:(_<65536?v[w++]=224|_>>>12:(v[w++]=240|_>>>18,v[w++]=128|_>>>12&63),v[w++]=128|_>>>6&63),v[w++]=128|63&_);return v},i.buf2binstring=function(g){return p(g,g.length)},i.binstring2buf=function(g){for(var v=new o.Buf8(g.length),_=0,C=v.length;_<C;_++)v[_]=g.charCodeAt(_);return v},i.buf2string=function(g,v){var _,C,x,w,E=v||g.length,T=new Array(2*E);for(_=C=0;_<E;)if((x=g[_++])<128)T[C++]=x;else if(4<(w=h[x]))T[C++]=65533,_+=w-1;else{for(x&=w===2?31:w===3?15:7;1<w&&_<E;)x=x<<6|63&g[_++],w--;1<w?T[C++]=65533:x<65536?T[C++]=x:(x-=65536,T[C++]=55296|x>>10&1023,T[C++]=56320|1023&x)}return p(T,C)},i.utf8border=function(g,v){var _;for((v=v||g.length)>g.length&&(v=g.length),_=v-1;0<=_&&(192&g[_])==128;)_--;return _<0||_===0?v:_+h[g[_]]>v?_:v}},{"./common":41}],43:[function(n,r,i){r.exports=function(o,l,d,h){for(var f=65535&o|0,p=o>>>16&65535|0,g=0;d!==0;){for(d-=g=2e3<d?2e3:d;p=p+(f=f+l[h++]|0)|0,--g;);f%=65521,p%=65521}return f|p<<16|0}},{}],44:[function(n,r,i){r.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(n,r,i){var o=(function(){for(var l,d=[],h=0;h<256;h++){l=h;for(var f=0;f<8;f++)l=1&l?3988292384^l>>>1:l>>>1;d[h]=l}return d})();r.exports=function(l,d,h,f){var p=o,g=f+h;l^=-1;for(var v=f;v<g;v++)l=l>>>8^p[255&(l^d[v])];return-1^l}},{}],46:[function(n,r,i){var o,l=n("../utils/common"),d=n("./trees"),h=n("./adler32"),f=n("./crc32"),p=n("./messages"),g=0,v=4,_=0,C=-2,x=-1,w=4,E=2,T=8,R=9,M=286,V=30,$=19,I=2*M+1,D=15,P=3,L=258,q=L+P+1,A=42,O=113,N=1,J=2,Y=3,G=4;function Z(U,de){return U.msg=p[de],de}function Q(U){return(U<<1)-(4<U?9:0)}function te(U){for(var de=U.length;0<=--de;)U[de]=0}function z(U){var de=U.state,ye=de.pending;ye>U.avail_out&&(ye=U.avail_out),ye!==0&&(l.arraySet(U.output,de.pending_buf,de.pending_out,ye,U.next_out),U.next_out+=ye,de.pending_out+=ye,U.total_out+=ye,U.avail_out-=ye,de.pending-=ye,de.pending===0&&(de.pending_out=0))}function H(U,de){d._tr_flush_block(U,0<=U.block_start?U.block_start:-1,U.strstart-U.block_start,de),U.block_start=U.strstart,z(U.strm)}function re(U,de){U.pending_buf[U.pending++]=de}function ne(U,de){U.pending_buf[U.pending++]=de>>>8&255,U.pending_buf[U.pending++]=255&de}function ie(U,de){var ye,ee,X=U.max_chain_length,oe=U.strstart,Se=U.prev_length,we=U.nice_match,ae=U.strstart>U.w_size-q?U.strstart-(U.w_size-q):0,je=U.window,Ne=U.w_mask,De=U.prev,qe=U.strstart+L,xt=je[oe+Se-1],rt=je[oe+Se];U.prev_length>=U.good_match&&(X>>=2),we>U.lookahead&&(we=U.lookahead);do if(je[(ye=de)+Se]===rt&&je[ye+Se-1]===xt&&je[ye]===je[oe]&&je[++ye]===je[oe+1]){oe+=2,ye++;do;while(je[++oe]===je[++ye]&&je[++oe]===je[++ye]&&je[++oe]===je[++ye]&&je[++oe]===je[++ye]&&je[++oe]===je[++ye]&&je[++oe]===je[++ye]&&je[++oe]===je[++ye]&&je[++oe]===je[++ye]&&oe<qe);if(ee=L-(qe-oe),oe=qe-L,Se<ee){if(U.match_start=de,we<=(Se=ee))break;xt=je[oe+Se-1],rt=je[oe+Se]}}while((de=De[de&Ne])>ae&&--X!=0);return Se<=U.lookahead?Se:U.lookahead}function be(U){var de,ye,ee,X,oe,Se,we,ae,je,Ne,De=U.w_size;do{if(X=U.window_size-U.lookahead-U.strstart,U.strstart>=De+(De-q)){for(l.arraySet(U.window,U.window,De,De,0),U.match_start-=De,U.strstart-=De,U.block_start-=De,de=ye=U.hash_size;ee=U.head[--de],U.head[de]=De<=ee?ee-De:0,--ye;);for(de=ye=De;ee=U.prev[--de],U.prev[de]=De<=ee?ee-De:0,--ye;);X+=De}if(U.strm.avail_in===0)break;if(Se=U.strm,we=U.window,ae=U.strstart+U.lookahead,je=X,Ne=void 0,Ne=Se.avail_in,je<Ne&&(Ne=je),ye=Ne===0?0:(Se.avail_in-=Ne,l.arraySet(we,Se.input,Se.next_in,Ne,ae),Se.state.wrap===1?Se.adler=h(Se.adler,we,Ne,ae):Se.state.wrap===2&&(Se.adler=f(Se.adler,we,Ne,ae)),Se.next_in+=Ne,Se.total_in+=Ne,Ne),U.lookahead+=ye,U.lookahead+U.insert>=P)for(oe=U.strstart-U.insert,U.ins_h=U.window[oe],U.ins_h=(U.ins_h<<U.hash_shift^U.window[oe+1])&U.hash_mask;U.insert&&(U.ins_h=(U.ins_h<<U.hash_shift^U.window[oe+P-1])&U.hash_mask,U.prev[oe&U.w_mask]=U.head[U.ins_h],U.head[U.ins_h]=oe,oe++,U.insert--,!(U.lookahead+U.insert<P)););}while(U.lookahead<q&&U.strm.avail_in!==0)}function Ce(U,de){for(var ye,ee;;){if(U.lookahead<q){if(be(U),U.lookahead<q&&de===g)return N;if(U.lookahead===0)break}if(ye=0,U.lookahead>=P&&(U.ins_h=(U.ins_h<<U.hash_shift^U.window[U.strstart+P-1])&U.hash_mask,ye=U.prev[U.strstart&U.w_mask]=U.head[U.ins_h],U.head[U.ins_h]=U.strstart),ye!==0&&U.strstart-ye<=U.w_size-q&&(U.match_length=ie(U,ye)),U.match_length>=P)if(ee=d._tr_tally(U,U.strstart-U.match_start,U.match_length-P),U.lookahead-=U.match_length,U.match_length<=U.max_lazy_match&&U.lookahead>=P){for(U.match_length--;U.strstart++,U.ins_h=(U.ins_h<<U.hash_shift^U.window[U.strstart+P-1])&U.hash_mask,ye=U.prev[U.strstart&U.w_mask]=U.head[U.ins_h],U.head[U.ins_h]=U.strstart,--U.match_length!=0;);U.strstart++}else U.strstart+=U.match_length,U.match_length=0,U.ins_h=U.window[U.strstart],U.ins_h=(U.ins_h<<U.hash_shift^U.window[U.strstart+1])&U.hash_mask;else ee=d._tr_tally(U,0,U.window[U.strstart]),U.lookahead--,U.strstart++;if(ee&&(H(U,!1),U.strm.avail_out===0))return N}return U.insert=U.strstart<P-1?U.strstart:P-1,de===v?(H(U,!0),U.strm.avail_out===0?Y:G):U.last_lit&&(H(U,!1),U.strm.avail_out===0)?N:J}function ce(U,de){for(var ye,ee,X;;){if(U.lookahead<q){if(be(U),U.lookahead<q&&de===g)return N;if(U.lookahead===0)break}if(ye=0,U.lookahead>=P&&(U.ins_h=(U.ins_h<<U.hash_shift^U.window[U.strstart+P-1])&U.hash_mask,ye=U.prev[U.strstart&U.w_mask]=U.head[U.ins_h],U.head[U.ins_h]=U.strstart),U.prev_length=U.match_length,U.prev_match=U.match_start,U.match_length=P-1,ye!==0&&U.prev_length<U.max_lazy_match&&U.strstart-ye<=U.w_size-q&&(U.match_length=ie(U,ye),U.match_length<=5&&(U.strategy===1||U.match_length===P&&4096<U.strstart-U.match_start)&&(U.match_length=P-1)),U.prev_length>=P&&U.match_length<=U.prev_length){for(X=U.strstart+U.lookahead-P,ee=d._tr_tally(U,U.strstart-1-U.prev_match,U.prev_length-P),U.lookahead-=U.prev_length-1,U.prev_length-=2;++U.strstart<=X&&(U.ins_h=(U.ins_h<<U.hash_shift^U.window[U.strstart+P-1])&U.hash_mask,ye=U.prev[U.strstart&U.w_mask]=U.head[U.ins_h],U.head[U.ins_h]=U.strstart),--U.prev_length!=0;);if(U.match_available=0,U.match_length=P-1,U.strstart++,ee&&(H(U,!1),U.strm.avail_out===0))return N}else if(U.match_available){if((ee=d._tr_tally(U,0,U.window[U.strstart-1]))&&H(U,!1),U.strstart++,U.lookahead--,U.strm.avail_out===0)return N}else U.match_available=1,U.strstart++,U.lookahead--}return U.match_available&&(ee=d._tr_tally(U,0,U.window[U.strstart-1]),U.match_available=0),U.insert=U.strstart<P-1?U.strstart:P-1,de===v?(H(U,!0),U.strm.avail_out===0?Y:G):U.last_lit&&(H(U,!1),U.strm.avail_out===0)?N:J}function ge(U,de,ye,ee,X){this.good_length=U,this.max_lazy=de,this.nice_length=ye,this.max_chain=ee,this.func=X}function Oe(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=T,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new l.Buf16(2*I),this.dyn_dtree=new l.Buf16(2*(2*V+1)),this.bl_tree=new l.Buf16(2*(2*$+1)),te(this.dyn_ltree),te(this.dyn_dtree),te(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new l.Buf16(D+1),this.heap=new l.Buf16(2*M+1),te(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new l.Buf16(2*M+1),te(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function ze(U){var de;return U&&U.state?(U.total_in=U.total_out=0,U.data_type=E,(de=U.state).pending=0,de.pending_out=0,de.wrap<0&&(de.wrap=-de.wrap),de.status=de.wrap?A:O,U.adler=de.wrap===2?0:1,de.last_flush=g,d._tr_init(de),_):Z(U,C)}function ot(U){var de=ze(U);return de===_&&(function(ye){ye.window_size=2*ye.w_size,te(ye.head),ye.max_lazy_match=o[ye.level].max_lazy,ye.good_match=o[ye.level].good_length,ye.nice_match=o[ye.level].nice_length,ye.max_chain_length=o[ye.level].max_chain,ye.strstart=0,ye.block_start=0,ye.lookahead=0,ye.insert=0,ye.match_length=ye.prev_length=P-1,ye.match_available=0,ye.ins_h=0})(U.state),de}function st(U,de,ye,ee,X,oe){if(!U)return C;var Se=1;if(de===x&&(de=6),ee<0?(Se=0,ee=-ee):15<ee&&(Se=2,ee-=16),X<1||R<X||ye!==T||ee<8||15<ee||de<0||9<de||oe<0||w<oe)return Z(U,C);ee===8&&(ee=9);var we=new Oe;return(U.state=we).strm=U,we.wrap=Se,we.gzhead=null,we.w_bits=ee,we.w_size=1<<we.w_bits,we.w_mask=we.w_size-1,we.hash_bits=X+7,we.hash_size=1<<we.hash_bits,we.hash_mask=we.hash_size-1,we.hash_shift=~~((we.hash_bits+P-1)/P),we.window=new l.Buf8(2*we.w_size),we.head=new l.Buf16(we.hash_size),we.prev=new l.Buf16(we.w_size),we.lit_bufsize=1<<X+6,we.pending_buf_size=4*we.lit_bufsize,we.pending_buf=new l.Buf8(we.pending_buf_size),we.d_buf=1*we.lit_bufsize,we.l_buf=3*we.lit_bufsize,we.level=de,we.strategy=oe,we.method=ye,ot(U)}o=[new ge(0,0,0,0,function(U,de){var ye=65535;for(ye>U.pending_buf_size-5&&(ye=U.pending_buf_size-5);;){if(U.lookahead<=1){if(be(U),U.lookahead===0&&de===g)return N;if(U.lookahead===0)break}U.strstart+=U.lookahead,U.lookahead=0;var ee=U.block_start+ye;if((U.strstart===0||U.strstart>=ee)&&(U.lookahead=U.strstart-ee,U.strstart=ee,H(U,!1),U.strm.avail_out===0)||U.strstart-U.block_start>=U.w_size-q&&(H(U,!1),U.strm.avail_out===0))return N}return U.insert=0,de===v?(H(U,!0),U.strm.avail_out===0?Y:G):(U.strstart>U.block_start&&(H(U,!1),U.strm.avail_out),N)}),new ge(4,4,8,4,Ce),new ge(4,5,16,8,Ce),new ge(4,6,32,32,Ce),new ge(4,4,16,16,ce),new ge(8,16,32,32,ce),new ge(8,16,128,128,ce),new ge(8,32,128,256,ce),new ge(32,128,258,1024,ce),new ge(32,258,258,4096,ce)],i.deflateInit=function(U,de){return st(U,de,T,15,8,0)},i.deflateInit2=st,i.deflateReset=ot,i.deflateResetKeep=ze,i.deflateSetHeader=function(U,de){return U&&U.state?U.state.wrap!==2?C:(U.state.gzhead=de,_):C},i.deflate=function(U,de){var ye,ee,X,oe;if(!U||!U.state||5<de||de<0)return U?Z(U,C):C;if(ee=U.state,!U.output||!U.input&&U.avail_in!==0||ee.status===666&&de!==v)return Z(U,U.avail_out===0?-5:C);if(ee.strm=U,ye=ee.last_flush,ee.last_flush=de,ee.status===A)if(ee.wrap===2)U.adler=0,re(ee,31),re(ee,139),re(ee,8),ee.gzhead?(re(ee,(ee.gzhead.text?1:0)+(ee.gzhead.hcrc?2:0)+(ee.gzhead.extra?4:0)+(ee.gzhead.name?8:0)+(ee.gzhead.comment?16:0)),re(ee,255&ee.gzhead.time),re(ee,ee.gzhead.time>>8&255),re(ee,ee.gzhead.time>>16&255),re(ee,ee.gzhead.time>>24&255),re(ee,ee.level===9?2:2<=ee.strategy||ee.level<2?4:0),re(ee,255&ee.gzhead.os),ee.gzhead.extra&&ee.gzhead.extra.length&&(re(ee,255&ee.gzhead.extra.length),re(ee,ee.gzhead.extra.length>>8&255)),ee.gzhead.hcrc&&(U.adler=f(U.adler,ee.pending_buf,ee.pending,0)),ee.gzindex=0,ee.status=69):(re(ee,0),re(ee,0),re(ee,0),re(ee,0),re(ee,0),re(ee,ee.level===9?2:2<=ee.strategy||ee.level<2?4:0),re(ee,3),ee.status=O);else{var Se=T+(ee.w_bits-8<<4)<<8;Se|=(2<=ee.strategy||ee.level<2?0:ee.level<6?1:ee.level===6?2:3)<<6,ee.strstart!==0&&(Se|=32),Se+=31-Se%31,ee.status=O,ne(ee,Se),ee.strstart!==0&&(ne(ee,U.adler>>>16),ne(ee,65535&U.adler)),U.adler=1}if(ee.status===69)if(ee.gzhead.extra){for(X=ee.pending;ee.gzindex<(65535&ee.gzhead.extra.length)&&(ee.pending!==ee.pending_buf_size||(ee.gzhead.hcrc&&ee.pending>X&&(U.adler=f(U.adler,ee.pending_buf,ee.pending-X,X)),z(U),X=ee.pending,ee.pending!==ee.pending_buf_size));)re(ee,255&ee.gzhead.extra[ee.gzindex]),ee.gzindex++;ee.gzhead.hcrc&&ee.pending>X&&(U.adler=f(U.adler,ee.pending_buf,ee.pending-X,X)),ee.gzindex===ee.gzhead.extra.length&&(ee.gzindex=0,ee.status=73)}else ee.status=73;if(ee.status===73)if(ee.gzhead.name){X=ee.pending;do{if(ee.pending===ee.pending_buf_size&&(ee.gzhead.hcrc&&ee.pending>X&&(U.adler=f(U.adler,ee.pending_buf,ee.pending-X,X)),z(U),X=ee.pending,ee.pending===ee.pending_buf_size)){oe=1;break}oe=ee.gzindex<ee.gzhead.name.length?255&ee.gzhead.name.charCodeAt(ee.gzindex++):0,re(ee,oe)}while(oe!==0);ee.gzhead.hcrc&&ee.pending>X&&(U.adler=f(U.adler,ee.pending_buf,ee.pending-X,X)),oe===0&&(ee.gzindex=0,ee.status=91)}else ee.status=91;if(ee.status===91)if(ee.gzhead.comment){X=ee.pending;do{if(ee.pending===ee.pending_buf_size&&(ee.gzhead.hcrc&&ee.pending>X&&(U.adler=f(U.adler,ee.pending_buf,ee.pending-X,X)),z(U),X=ee.pending,ee.pending===ee.pending_buf_size)){oe=1;break}oe=ee.gzindex<ee.gzhead.comment.length?255&ee.gzhead.comment.charCodeAt(ee.gzindex++):0,re(ee,oe)}while(oe!==0);ee.gzhead.hcrc&&ee.pending>X&&(U.adler=f(U.adler,ee.pending_buf,ee.pending-X,X)),oe===0&&(ee.status=103)}else ee.status=103;if(ee.status===103&&(ee.gzhead.hcrc?(ee.pending+2>ee.pending_buf_size&&z(U),ee.pending+2<=ee.pending_buf_size&&(re(ee,255&U.adler),re(ee,U.adler>>8&255),U.adler=0,ee.status=O)):ee.status=O),ee.pending!==0){if(z(U),U.avail_out===0)return ee.last_flush=-1,_}else if(U.avail_in===0&&Q(de)<=Q(ye)&&de!==v)return Z(U,-5);if(ee.status===666&&U.avail_in!==0)return Z(U,-5);if(U.avail_in!==0||ee.lookahead!==0||de!==g&&ee.status!==666){var we=ee.strategy===2?(function(ae,je){for(var Ne;;){if(ae.lookahead===0&&(be(ae),ae.lookahead===0)){if(je===g)return N;break}if(ae.match_length=0,Ne=d._tr_tally(ae,0,ae.window[ae.strstart]),ae.lookahead--,ae.strstart++,Ne&&(H(ae,!1),ae.strm.avail_out===0))return N}return ae.insert=0,je===v?(H(ae,!0),ae.strm.avail_out===0?Y:G):ae.last_lit&&(H(ae,!1),ae.strm.avail_out===0)?N:J})(ee,de):ee.strategy===3?(function(ae,je){for(var Ne,De,qe,xt,rt=ae.window;;){if(ae.lookahead<=L){if(be(ae),ae.lookahead<=L&&je===g)return N;if(ae.lookahead===0)break}if(ae.match_length=0,ae.lookahead>=P&&0<ae.strstart&&(De=rt[qe=ae.strstart-1])===rt[++qe]&&De===rt[++qe]&&De===rt[++qe]){xt=ae.strstart+L;do;while(De===rt[++qe]&&De===rt[++qe]&&De===rt[++qe]&&De===rt[++qe]&&De===rt[++qe]&&De===rt[++qe]&&De===rt[++qe]&&De===rt[++qe]&&qe<xt);ae.match_length=L-(xt-qe),ae.match_length>ae.lookahead&&(ae.match_length=ae.lookahead)}if(ae.match_length>=P?(Ne=d._tr_tally(ae,1,ae.match_length-P),ae.lookahead-=ae.match_length,ae.strstart+=ae.match_length,ae.match_length=0):(Ne=d._tr_tally(ae,0,ae.window[ae.strstart]),ae.lookahead--,ae.strstart++),Ne&&(H(ae,!1),ae.strm.avail_out===0))return N}return ae.insert=0,je===v?(H(ae,!0),ae.strm.avail_out===0?Y:G):ae.last_lit&&(H(ae,!1),ae.strm.avail_out===0)?N:J})(ee,de):o[ee.level].func(ee,de);if(we!==Y&&we!==G||(ee.status=666),we===N||we===Y)return U.avail_out===0&&(ee.last_flush=-1),_;if(we===J&&(de===1?d._tr_align(ee):de!==5&&(d._tr_stored_block(ee,0,0,!1),de===3&&(te(ee.head),ee.lookahead===0&&(ee.strstart=0,ee.block_start=0,ee.insert=0))),z(U),U.avail_out===0))return ee.last_flush=-1,_}return de!==v?_:ee.wrap<=0?1:(ee.wrap===2?(re(ee,255&U.adler),re(ee,U.adler>>8&255),re(ee,U.adler>>16&255),re(ee,U.adler>>24&255),re(ee,255&U.total_in),re(ee,U.total_in>>8&255),re(ee,U.total_in>>16&255),re(ee,U.total_in>>24&255)):(ne(ee,U.adler>>>16),ne(ee,65535&U.adler)),z(U),0<ee.wrap&&(ee.wrap=-ee.wrap),ee.pending!==0?_:1)},i.deflateEnd=function(U){var de;return U&&U.state?(de=U.state.status)!==A&&de!==69&&de!==73&&de!==91&&de!==103&&de!==O&&de!==666?Z(U,C):(U.state=null,de===O?Z(U,-3):_):C},i.deflateSetDictionary=function(U,de){var ye,ee,X,oe,Se,we,ae,je,Ne=de.length;if(!U||!U.state||(oe=(ye=U.state).wrap)===2||oe===1&&ye.status!==A||ye.lookahead)return C;for(oe===1&&(U.adler=h(U.adler,de,Ne,0)),ye.wrap=0,Ne>=ye.w_size&&(oe===0&&(te(ye.head),ye.strstart=0,ye.block_start=0,ye.insert=0),je=new l.Buf8(ye.w_size),l.arraySet(je,de,Ne-ye.w_size,ye.w_size,0),de=je,Ne=ye.w_size),Se=U.avail_in,we=U.next_in,ae=U.input,U.avail_in=Ne,U.next_in=0,U.input=de,be(ye);ye.lookahead>=P;){for(ee=ye.strstart,X=ye.lookahead-(P-1);ye.ins_h=(ye.ins_h<<ye.hash_shift^ye.window[ee+P-1])&ye.hash_mask,ye.prev[ee&ye.w_mask]=ye.head[ye.ins_h],ye.head[ye.ins_h]=ee,ee++,--X;);ye.strstart=ee,ye.lookahead=P-1,be(ye)}return ye.strstart+=ye.lookahead,ye.block_start=ye.strstart,ye.insert=ye.lookahead,ye.lookahead=0,ye.match_length=ye.prev_length=P-1,ye.match_available=0,U.next_in=we,U.input=ae,U.avail_in=Se,ye.wrap=oe,_},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(n,r,i){r.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(n,r,i){r.exports=function(o,l){var d,h,f,p,g,v,_,C,x,w,E,T,R,M,V,$,I,D,P,L,q,A,O,N,J;d=o.state,h=o.next_in,N=o.input,f=h+(o.avail_in-5),p=o.next_out,J=o.output,g=p-(l-o.avail_out),v=p+(o.avail_out-257),_=d.dmax,C=d.wsize,x=d.whave,w=d.wnext,E=d.window,T=d.hold,R=d.bits,M=d.lencode,V=d.distcode,$=(1<<d.lenbits)-1,I=(1<<d.distbits)-1;e:do{R<15&&(T+=N[h++]<<R,R+=8,T+=N[h++]<<R,R+=8),D=M[T&$];t:for(;;){if(T>>>=P=D>>>24,R-=P,(P=D>>>16&255)===0)J[p++]=65535&D;else{if(!(16&P)){if((64&P)==0){D=M[(65535&D)+(T&(1<<P)-1)];continue t}if(32&P){d.mode=12;break e}o.msg="invalid literal/length code",d.mode=30;break e}L=65535&D,(P&=15)&&(R<P&&(T+=N[h++]<<R,R+=8),L+=T&(1<<P)-1,T>>>=P,R-=P),R<15&&(T+=N[h++]<<R,R+=8,T+=N[h++]<<R,R+=8),D=V[T&I];n:for(;;){if(T>>>=P=D>>>24,R-=P,!(16&(P=D>>>16&255))){if((64&P)==0){D=V[(65535&D)+(T&(1<<P)-1)];continue n}o.msg="invalid distance code",d.mode=30;break e}if(q=65535&D,R<(P&=15)&&(T+=N[h++]<<R,(R+=8)<P&&(T+=N[h++]<<R,R+=8)),_<(q+=T&(1<<P)-1)){o.msg="invalid distance too far back",d.mode=30;break e}if(T>>>=P,R-=P,(P=p-g)<q){if(x<(P=q-P)&&d.sane){o.msg="invalid distance too far back",d.mode=30;break e}if(O=E,(A=0)===w){if(A+=C-P,P<L){for(L-=P;J[p++]=E[A++],--P;);A=p-q,O=J}}else if(w<P){if(A+=C+w-P,(P-=w)<L){for(L-=P;J[p++]=E[A++],--P;);if(A=0,w<L){for(L-=P=w;J[p++]=E[A++],--P;);A=p-q,O=J}}}else if(A+=w-P,P<L){for(L-=P;J[p++]=E[A++],--P;);A=p-q,O=J}for(;2<L;)J[p++]=O[A++],J[p++]=O[A++],J[p++]=O[A++],L-=3;L&&(J[p++]=O[A++],1<L&&(J[p++]=O[A++]))}else{for(A=p-q;J[p++]=J[A++],J[p++]=J[A++],J[p++]=J[A++],2<(L-=3););L&&(J[p++]=J[A++],1<L&&(J[p++]=J[A++]))}break}}break}}while(h<f&&p<v);h-=L=R>>3,T&=(1<<(R-=L<<3))-1,o.next_in=h,o.next_out=p,o.avail_in=h<f?f-h+5:5-(h-f),o.avail_out=p<v?v-p+257:257-(p-v),d.hold=T,d.bits=R}},{}],49:[function(n,r,i){var o=n("../utils/common"),l=n("./adler32"),d=n("./crc32"),h=n("./inffast"),f=n("./inftrees"),p=1,g=2,v=0,_=-2,C=1,x=852,w=592;function E(A){return(A>>>24&255)+(A>>>8&65280)+((65280&A)<<8)+((255&A)<<24)}function T(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new o.Buf16(320),this.work=new o.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function R(A){var O;return A&&A.state?(O=A.state,A.total_in=A.total_out=O.total=0,A.msg="",O.wrap&&(A.adler=1&O.wrap),O.mode=C,O.last=0,O.havedict=0,O.dmax=32768,O.head=null,O.hold=0,O.bits=0,O.lencode=O.lendyn=new o.Buf32(x),O.distcode=O.distdyn=new o.Buf32(w),O.sane=1,O.back=-1,v):_}function M(A){var O;return A&&A.state?((O=A.state).wsize=0,O.whave=0,O.wnext=0,R(A)):_}function V(A,O){var N,J;return A&&A.state?(J=A.state,O<0?(N=0,O=-O):(N=1+(O>>4),O<48&&(O&=15)),O&&(O<8||15<O)?_:(J.window!==null&&J.wbits!==O&&(J.window=null),J.wrap=N,J.wbits=O,M(A))):_}function $(A,O){var N,J;return A?(J=new T,(A.state=J).window=null,(N=V(A,O))!==v&&(A.state=null),N):_}var I,D,P=!0;function L(A){if(P){var O;for(I=new o.Buf32(512),D=new o.Buf32(32),O=0;O<144;)A.lens[O++]=8;for(;O<256;)A.lens[O++]=9;for(;O<280;)A.lens[O++]=7;for(;O<288;)A.lens[O++]=8;for(f(p,A.lens,0,288,I,0,A.work,{bits:9}),O=0;O<32;)A.lens[O++]=5;f(g,A.lens,0,32,D,0,A.work,{bits:5}),P=!1}A.lencode=I,A.lenbits=9,A.distcode=D,A.distbits=5}function q(A,O,N,J){var Y,G=A.state;return G.window===null&&(G.wsize=1<<G.wbits,G.wnext=0,G.whave=0,G.window=new o.Buf8(G.wsize)),J>=G.wsize?(o.arraySet(G.window,O,N-G.wsize,G.wsize,0),G.wnext=0,G.whave=G.wsize):(J<(Y=G.wsize-G.wnext)&&(Y=J),o.arraySet(G.window,O,N-J,Y,G.wnext),(J-=Y)?(o.arraySet(G.window,O,N-J,J,0),G.wnext=J,G.whave=G.wsize):(G.wnext+=Y,G.wnext===G.wsize&&(G.wnext=0),G.whave<G.wsize&&(G.whave+=Y))),0}i.inflateReset=M,i.inflateReset2=V,i.inflateResetKeep=R,i.inflateInit=function(A){return $(A,15)},i.inflateInit2=$,i.inflate=function(A,O){var N,J,Y,G,Z,Q,te,z,H,re,ne,ie,be,Ce,ce,ge,Oe,ze,ot,st,U,de,ye,ee,X=0,oe=new o.Buf8(4),Se=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!A||!A.state||!A.output||!A.input&&A.avail_in!==0)return _;(N=A.state).mode===12&&(N.mode=13),Z=A.next_out,Y=A.output,te=A.avail_out,G=A.next_in,J=A.input,Q=A.avail_in,z=N.hold,H=N.bits,re=Q,ne=te,de=v;e:for(;;)switch(N.mode){case C:if(N.wrap===0){N.mode=13;break}for(;H<16;){if(Q===0)break e;Q--,z+=J[G++]<<H,H+=8}if(2&N.wrap&&z===35615){oe[N.check=0]=255&z,oe[1]=z>>>8&255,N.check=d(N.check,oe,2,0),H=z=0,N.mode=2;break}if(N.flags=0,N.head&&(N.head.done=!1),!(1&N.wrap)||(((255&z)<<8)+(z>>8))%31){A.msg="incorrect header check",N.mode=30;break}if((15&z)!=8){A.msg="unknown compression method",N.mode=30;break}if(H-=4,U=8+(15&(z>>>=4)),N.wbits===0)N.wbits=U;else if(U>N.wbits){A.msg="invalid window size",N.mode=30;break}N.dmax=1<<U,A.adler=N.check=1,N.mode=512&z?10:12,H=z=0;break;case 2:for(;H<16;){if(Q===0)break e;Q--,z+=J[G++]<<H,H+=8}if(N.flags=z,(255&N.flags)!=8){A.msg="unknown compression method",N.mode=30;break}if(57344&N.flags){A.msg="unknown header flags set",N.mode=30;break}N.head&&(N.head.text=z>>8&1),512&N.flags&&(oe[0]=255&z,oe[1]=z>>>8&255,N.check=d(N.check,oe,2,0)),H=z=0,N.mode=3;case 3:for(;H<32;){if(Q===0)break e;Q--,z+=J[G++]<<H,H+=8}N.head&&(N.head.time=z),512&N.flags&&(oe[0]=255&z,oe[1]=z>>>8&255,oe[2]=z>>>16&255,oe[3]=z>>>24&255,N.check=d(N.check,oe,4,0)),H=z=0,N.mode=4;case 4:for(;H<16;){if(Q===0)break e;Q--,z+=J[G++]<<H,H+=8}N.head&&(N.head.xflags=255&z,N.head.os=z>>8),512&N.flags&&(oe[0]=255&z,oe[1]=z>>>8&255,N.check=d(N.check,oe,2,0)),H=z=0,N.mode=5;case 5:if(1024&N.flags){for(;H<16;){if(Q===0)break e;Q--,z+=J[G++]<<H,H+=8}N.length=z,N.head&&(N.head.extra_len=z),512&N.flags&&(oe[0]=255&z,oe[1]=z>>>8&255,N.check=d(N.check,oe,2,0)),H=z=0}else N.head&&(N.head.extra=null);N.mode=6;case 6:if(1024&N.flags&&(Q<(ie=N.length)&&(ie=Q),ie&&(N.head&&(U=N.head.extra_len-N.length,N.head.extra||(N.head.extra=new Array(N.head.extra_len)),o.arraySet(N.head.extra,J,G,ie,U)),512&N.flags&&(N.check=d(N.check,J,ie,G)),Q-=ie,G+=ie,N.length-=ie),N.length))break e;N.length=0,N.mode=7;case 7:if(2048&N.flags){if(Q===0)break e;for(ie=0;U=J[G+ie++],N.head&&U&&N.length<65536&&(N.head.name+=String.fromCharCode(U)),U&&ie<Q;);if(512&N.flags&&(N.check=d(N.check,J,ie,G)),Q-=ie,G+=ie,U)break e}else N.head&&(N.head.name=null);N.length=0,N.mode=8;case 8:if(4096&N.flags){if(Q===0)break e;for(ie=0;U=J[G+ie++],N.head&&U&&N.length<65536&&(N.head.comment+=String.fromCharCode(U)),U&&ie<Q;);if(512&N.flags&&(N.check=d(N.check,J,ie,G)),Q-=ie,G+=ie,U)break e}else N.head&&(N.head.comment=null);N.mode=9;case 9:if(512&N.flags){for(;H<16;){if(Q===0)break e;Q--,z+=J[G++]<<H,H+=8}if(z!==(65535&N.check)){A.msg="header crc mismatch",N.mode=30;break}H=z=0}N.head&&(N.head.hcrc=N.flags>>9&1,N.head.done=!0),A.adler=N.check=0,N.mode=12;break;case 10:for(;H<32;){if(Q===0)break e;Q--,z+=J[G++]<<H,H+=8}A.adler=N.check=E(z),H=z=0,N.mode=11;case 11:if(N.havedict===0)return A.next_out=Z,A.avail_out=te,A.next_in=G,A.avail_in=Q,N.hold=z,N.bits=H,2;A.adler=N.check=1,N.mode=12;case 12:if(O===5||O===6)break e;case 13:if(N.last){z>>>=7&H,H-=7&H,N.mode=27;break}for(;H<3;){if(Q===0)break e;Q--,z+=J[G++]<<H,H+=8}switch(N.last=1&z,H-=1,3&(z>>>=1)){case 0:N.mode=14;break;case 1:if(L(N),N.mode=20,O!==6)break;z>>>=2,H-=2;break e;case 2:N.mode=17;break;case 3:A.msg="invalid block type",N.mode=30}z>>>=2,H-=2;break;case 14:for(z>>>=7&H,H-=7&H;H<32;){if(Q===0)break e;Q--,z+=J[G++]<<H,H+=8}if((65535&z)!=(z>>>16^65535)){A.msg="invalid stored block lengths",N.mode=30;break}if(N.length=65535&z,H=z=0,N.mode=15,O===6)break e;case 15:N.mode=16;case 16:if(ie=N.length){if(Q<ie&&(ie=Q),te<ie&&(ie=te),ie===0)break e;o.arraySet(Y,J,G,ie,Z),Q-=ie,G+=ie,te-=ie,Z+=ie,N.length-=ie;break}N.mode=12;break;case 17:for(;H<14;){if(Q===0)break e;Q--,z+=J[G++]<<H,H+=8}if(N.nlen=257+(31&z),z>>>=5,H-=5,N.ndist=1+(31&z),z>>>=5,H-=5,N.ncode=4+(15&z),z>>>=4,H-=4,286<N.nlen||30<N.ndist){A.msg="too many length or distance symbols",N.mode=30;break}N.have=0,N.mode=18;case 18:for(;N.have<N.ncode;){for(;H<3;){if(Q===0)break e;Q--,z+=J[G++]<<H,H+=8}N.lens[Se[N.have++]]=7&z,z>>>=3,H-=3}for(;N.have<19;)N.lens[Se[N.have++]]=0;if(N.lencode=N.lendyn,N.lenbits=7,ye={bits:N.lenbits},de=f(0,N.lens,0,19,N.lencode,0,N.work,ye),N.lenbits=ye.bits,de){A.msg="invalid code lengths set",N.mode=30;break}N.have=0,N.mode=19;case 19:for(;N.have<N.nlen+N.ndist;){for(;ge=(X=N.lencode[z&(1<<N.lenbits)-1])>>>16&255,Oe=65535&X,!((ce=X>>>24)<=H);){if(Q===0)break e;Q--,z+=J[G++]<<H,H+=8}if(Oe<16)z>>>=ce,H-=ce,N.lens[N.have++]=Oe;else{if(Oe===16){for(ee=ce+2;H<ee;){if(Q===0)break e;Q--,z+=J[G++]<<H,H+=8}if(z>>>=ce,H-=ce,N.have===0){A.msg="invalid bit length repeat",N.mode=30;break}U=N.lens[N.have-1],ie=3+(3&z),z>>>=2,H-=2}else if(Oe===17){for(ee=ce+3;H<ee;){if(Q===0)break e;Q--,z+=J[G++]<<H,H+=8}H-=ce,U=0,ie=3+(7&(z>>>=ce)),z>>>=3,H-=3}else{for(ee=ce+7;H<ee;){if(Q===0)break e;Q--,z+=J[G++]<<H,H+=8}H-=ce,U=0,ie=11+(127&(z>>>=ce)),z>>>=7,H-=7}if(N.have+ie>N.nlen+N.ndist){A.msg="invalid bit length repeat",N.mode=30;break}for(;ie--;)N.lens[N.have++]=U}}if(N.mode===30)break;if(N.lens[256]===0){A.msg="invalid code -- missing end-of-block",N.mode=30;break}if(N.lenbits=9,ye={bits:N.lenbits},de=f(p,N.lens,0,N.nlen,N.lencode,0,N.work,ye),N.lenbits=ye.bits,de){A.msg="invalid literal/lengths set",N.mode=30;break}if(N.distbits=6,N.distcode=N.distdyn,ye={bits:N.distbits},de=f(g,N.lens,N.nlen,N.ndist,N.distcode,0,N.work,ye),N.distbits=ye.bits,de){A.msg="invalid distances set",N.mode=30;break}if(N.mode=20,O===6)break e;case 20:N.mode=21;case 21:if(6<=Q&&258<=te){A.next_out=Z,A.avail_out=te,A.next_in=G,A.avail_in=Q,N.hold=z,N.bits=H,h(A,ne),Z=A.next_out,Y=A.output,te=A.avail_out,G=A.next_in,J=A.input,Q=A.avail_in,z=N.hold,H=N.bits,N.mode===12&&(N.back=-1);break}for(N.back=0;ge=(X=N.lencode[z&(1<<N.lenbits)-1])>>>16&255,Oe=65535&X,!((ce=X>>>24)<=H);){if(Q===0)break e;Q--,z+=J[G++]<<H,H+=8}if(ge&&(240&ge)==0){for(ze=ce,ot=ge,st=Oe;ge=(X=N.lencode[st+((z&(1<<ze+ot)-1)>>ze)])>>>16&255,Oe=65535&X,!(ze+(ce=X>>>24)<=H);){if(Q===0)break e;Q--,z+=J[G++]<<H,H+=8}z>>>=ze,H-=ze,N.back+=ze}if(z>>>=ce,H-=ce,N.back+=ce,N.length=Oe,ge===0){N.mode=26;break}if(32&ge){N.back=-1,N.mode=12;break}if(64&ge){A.msg="invalid literal/length code",N.mode=30;break}N.extra=15&ge,N.mode=22;case 22:if(N.extra){for(ee=N.extra;H<ee;){if(Q===0)break e;Q--,z+=J[G++]<<H,H+=8}N.length+=z&(1<<N.extra)-1,z>>>=N.extra,H-=N.extra,N.back+=N.extra}N.was=N.length,N.mode=23;case 23:for(;ge=(X=N.distcode[z&(1<<N.distbits)-1])>>>16&255,Oe=65535&X,!((ce=X>>>24)<=H);){if(Q===0)break e;Q--,z+=J[G++]<<H,H+=8}if((240&ge)==0){for(ze=ce,ot=ge,st=Oe;ge=(X=N.distcode[st+((z&(1<<ze+ot)-1)>>ze)])>>>16&255,Oe=65535&X,!(ze+(ce=X>>>24)<=H);){if(Q===0)break e;Q--,z+=J[G++]<<H,H+=8}z>>>=ze,H-=ze,N.back+=ze}if(z>>>=ce,H-=ce,N.back+=ce,64&ge){A.msg="invalid distance code",N.mode=30;break}N.offset=Oe,N.extra=15&ge,N.mode=24;case 24:if(N.extra){for(ee=N.extra;H<ee;){if(Q===0)break e;Q--,z+=J[G++]<<H,H+=8}N.offset+=z&(1<<N.extra)-1,z>>>=N.extra,H-=N.extra,N.back+=N.extra}if(N.offset>N.dmax){A.msg="invalid distance too far back",N.mode=30;break}N.mode=25;case 25:if(te===0)break e;if(ie=ne-te,N.offset>ie){if((ie=N.offset-ie)>N.whave&&N.sane){A.msg="invalid distance too far back",N.mode=30;break}be=ie>N.wnext?(ie-=N.wnext,N.wsize-ie):N.wnext-ie,ie>N.length&&(ie=N.length),Ce=N.window}else Ce=Y,be=Z-N.offset,ie=N.length;for(te<ie&&(ie=te),te-=ie,N.length-=ie;Y[Z++]=Ce[be++],--ie;);N.length===0&&(N.mode=21);break;case 26:if(te===0)break e;Y[Z++]=N.length,te--,N.mode=21;break;case 27:if(N.wrap){for(;H<32;){if(Q===0)break e;Q--,z|=J[G++]<<H,H+=8}if(ne-=te,A.total_out+=ne,N.total+=ne,ne&&(A.adler=N.check=N.flags?d(N.check,Y,ne,Z-ne):l(N.check,Y,ne,Z-ne)),ne=te,(N.flags?z:E(z))!==N.check){A.msg="incorrect data check",N.mode=30;break}H=z=0}N.mode=28;case 28:if(N.wrap&&N.flags){for(;H<32;){if(Q===0)break e;Q--,z+=J[G++]<<H,H+=8}if(z!==(4294967295&N.total)){A.msg="incorrect length check",N.mode=30;break}H=z=0}N.mode=29;case 29:de=1;break e;case 30:de=-3;break e;case 31:return-4;default:return _}return A.next_out=Z,A.avail_out=te,A.next_in=G,A.avail_in=Q,N.hold=z,N.bits=H,(N.wsize||ne!==A.avail_out&&N.mode<30&&(N.mode<27||O!==4))&&q(A,A.output,A.next_out,ne-A.avail_out)?(N.mode=31,-4):(re-=A.avail_in,ne-=A.avail_out,A.total_in+=re,A.total_out+=ne,N.total+=ne,N.wrap&&ne&&(A.adler=N.check=N.flags?d(N.check,Y,ne,A.next_out-ne):l(N.check,Y,ne,A.next_out-ne)),A.data_type=N.bits+(N.last?64:0)+(N.mode===12?128:0)+(N.mode===20||N.mode===15?256:0),(re==0&&ne===0||O===4)&&de===v&&(de=-5),de)},i.inflateEnd=function(A){if(!A||!A.state)return _;var O=A.state;return O.window&&(O.window=null),A.state=null,v},i.inflateGetHeader=function(A,O){var N;return A&&A.state?(2&(N=A.state).wrap)==0?_:((N.head=O).done=!1,v):_},i.inflateSetDictionary=function(A,O){var N,J=O.length;return A&&A.state?(N=A.state).wrap!==0&&N.mode!==11?_:N.mode===11&&l(1,O,J,0)!==N.check?-3:q(A,O,J,J)?(N.mode=31,-4):(N.havedict=1,v):_},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(n,r,i){var o=n("../utils/common"),l=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],d=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],h=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],f=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];r.exports=function(p,g,v,_,C,x,w,E){var T,R,M,V,$,I,D,P,L,q=E.bits,A=0,O=0,N=0,J=0,Y=0,G=0,Z=0,Q=0,te=0,z=0,H=null,re=0,ne=new o.Buf16(16),ie=new o.Buf16(16),be=null,Ce=0;for(A=0;A<=15;A++)ne[A]=0;for(O=0;O<_;O++)ne[g[v+O]]++;for(Y=q,J=15;1<=J&&ne[J]===0;J--);if(J<Y&&(Y=J),J===0)return C[x++]=20971520,C[x++]=20971520,E.bits=1,0;for(N=1;N<J&&ne[N]===0;N++);for(Y<N&&(Y=N),A=Q=1;A<=15;A++)if(Q<<=1,(Q-=ne[A])<0)return-1;if(0<Q&&(p===0||J!==1))return-1;for(ie[1]=0,A=1;A<15;A++)ie[A+1]=ie[A]+ne[A];for(O=0;O<_;O++)g[v+O]!==0&&(w[ie[g[v+O]]++]=O);if(I=p===0?(H=be=w,19):p===1?(H=l,re-=257,be=d,Ce-=257,256):(H=h,be=f,-1),A=N,$=x,Z=O=z=0,M=-1,V=(te=1<<(G=Y))-1,p===1&&852<te||p===2&&592<te)return 1;for(;;){for(D=A-Z,L=w[O]<I?(P=0,w[O]):w[O]>I?(P=be[Ce+w[O]],H[re+w[O]]):(P=96,0),T=1<<A-Z,N=R=1<<G;C[$+(z>>Z)+(R-=T)]=D<<24|P<<16|L|0,R!==0;);for(T=1<<A-1;z&T;)T>>=1;if(T!==0?(z&=T-1,z+=T):z=0,O++,--ne[A]==0){if(A===J)break;A=g[v+w[O]]}if(Y<A&&(z&V)!==M){for(Z===0&&(Z=Y),$+=N,Q=1<<(G=A-Z);G+Z<J&&!((Q-=ne[G+Z])<=0);)G++,Q<<=1;if(te+=1<<G,p===1&&852<te||p===2&&592<te)return 1;C[M=z&V]=Y<<24|G<<16|$-x|0}}return z!==0&&(C[$+z]=A-Z<<24|64<<16|0),E.bits=Y,0}},{"../utils/common":41}],51:[function(n,r,i){r.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(n,r,i){var o=n("../utils/common"),l=0,d=1;function h(X){for(var oe=X.length;0<=--oe;)X[oe]=0}var f=0,p=29,g=256,v=g+1+p,_=30,C=19,x=2*v+1,w=15,E=16,T=7,R=256,M=16,V=17,$=18,I=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],D=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],P=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],L=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],q=new Array(2*(v+2));h(q);var A=new Array(2*_);h(A);var O=new Array(512);h(O);var N=new Array(256);h(N);var J=new Array(p);h(J);var Y,G,Z,Q=new Array(_);function te(X,oe,Se,we,ae){this.static_tree=X,this.extra_bits=oe,this.extra_base=Se,this.elems=we,this.max_length=ae,this.has_stree=X&&X.length}function z(X,oe){this.dyn_tree=X,this.max_code=0,this.stat_desc=oe}function H(X){return X<256?O[X]:O[256+(X>>>7)]}function re(X,oe){X.pending_buf[X.pending++]=255&oe,X.pending_buf[X.pending++]=oe>>>8&255}function ne(X,oe,Se){X.bi_valid>E-Se?(X.bi_buf|=oe<<X.bi_valid&65535,re(X,X.bi_buf),X.bi_buf=oe>>E-X.bi_valid,X.bi_valid+=Se-E):(X.bi_buf|=oe<<X.bi_valid&65535,X.bi_valid+=Se)}function ie(X,oe,Se){ne(X,Se[2*oe],Se[2*oe+1])}function be(X,oe){for(var Se=0;Se|=1&X,X>>>=1,Se<<=1,0<--oe;);return Se>>>1}function Ce(X,oe,Se){var we,ae,je=new Array(w+1),Ne=0;for(we=1;we<=w;we++)je[we]=Ne=Ne+Se[we-1]<<1;for(ae=0;ae<=oe;ae++){var De=X[2*ae+1];De!==0&&(X[2*ae]=be(je[De]++,De))}}function ce(X){var oe;for(oe=0;oe<v;oe++)X.dyn_ltree[2*oe]=0;for(oe=0;oe<_;oe++)X.dyn_dtree[2*oe]=0;for(oe=0;oe<C;oe++)X.bl_tree[2*oe]=0;X.dyn_ltree[2*R]=1,X.opt_len=X.static_len=0,X.last_lit=X.matches=0}function ge(X){8<X.bi_valid?re(X,X.bi_buf):0<X.bi_valid&&(X.pending_buf[X.pending++]=X.bi_buf),X.bi_buf=0,X.bi_valid=0}function Oe(X,oe,Se,we){var ae=2*oe,je=2*Se;return X[ae]<X[je]||X[ae]===X[je]&&we[oe]<=we[Se]}function ze(X,oe,Se){for(var we=X.heap[Se],ae=Se<<1;ae<=X.heap_len&&(ae<X.heap_len&&Oe(oe,X.heap[ae+1],X.heap[ae],X.depth)&&ae++,!Oe(oe,we,X.heap[ae],X.depth));)X.heap[Se]=X.heap[ae],Se=ae,ae<<=1;X.heap[Se]=we}function ot(X,oe,Se){var we,ae,je,Ne,De=0;if(X.last_lit!==0)for(;we=X.pending_buf[X.d_buf+2*De]<<8|X.pending_buf[X.d_buf+2*De+1],ae=X.pending_buf[X.l_buf+De],De++,we===0?ie(X,ae,oe):(ie(X,(je=N[ae])+g+1,oe),(Ne=I[je])!==0&&ne(X,ae-=J[je],Ne),ie(X,je=H(--we),Se),(Ne=D[je])!==0&&ne(X,we-=Q[je],Ne)),De<X.last_lit;);ie(X,R,oe)}function st(X,oe){var Se,we,ae,je=oe.dyn_tree,Ne=oe.stat_desc.static_tree,De=oe.stat_desc.has_stree,qe=oe.stat_desc.elems,xt=-1;for(X.heap_len=0,X.heap_max=x,Se=0;Se<qe;Se++)je[2*Se]!==0?(X.heap[++X.heap_len]=xt=Se,X.depth[Se]=0):je[2*Se+1]=0;for(;X.heap_len<2;)je[2*(ae=X.heap[++X.heap_len]=xt<2?++xt:0)]=1,X.depth[ae]=0,X.opt_len--,De&&(X.static_len-=Ne[2*ae+1]);for(oe.max_code=xt,Se=X.heap_len>>1;1<=Se;Se--)ze(X,je,Se);for(ae=qe;Se=X.heap[1],X.heap[1]=X.heap[X.heap_len--],ze(X,je,1),we=X.heap[1],X.heap[--X.heap_max]=Se,X.heap[--X.heap_max]=we,je[2*ae]=je[2*Se]+je[2*we],X.depth[ae]=(X.depth[Se]>=X.depth[we]?X.depth[Se]:X.depth[we])+1,je[2*Se+1]=je[2*we+1]=ae,X.heap[1]=ae++,ze(X,je,1),2<=X.heap_len;);X.heap[--X.heap_max]=X.heap[1],(function(rt,Qn){var gs,nr,ys,vt,tn,Kn,Ct=Qn.dyn_tree,qa=Qn.max_code,Di=Qn.stat_desc.static_tree,qo=Qn.stat_desc.has_stree,Mr=Qn.stat_desc.extra_bits,_s=Qn.stat_desc.extra_base,Ut=Qn.stat_desc.max_length,rr=0;for(vt=0;vt<=w;vt++)rt.bl_count[vt]=0;for(Ct[2*rt.heap[rt.heap_max]+1]=0,gs=rt.heap_max+1;gs<x;gs++)Ut<(vt=Ct[2*Ct[2*(nr=rt.heap[gs])+1]+1]+1)&&(vt=Ut,rr++),Ct[2*nr+1]=vt,qa<nr||(rt.bl_count[vt]++,tn=0,_s<=nr&&(tn=Mr[nr-_s]),Kn=Ct[2*nr],rt.opt_len+=Kn*(vt+tn),qo&&(rt.static_len+=Kn*(Di[2*nr+1]+tn)));if(rr!==0){do{for(vt=Ut-1;rt.bl_count[vt]===0;)vt--;rt.bl_count[vt]--,rt.bl_count[vt+1]+=2,rt.bl_count[Ut]--,rr-=2}while(0<rr);for(vt=Ut;vt!==0;vt--)for(nr=rt.bl_count[vt];nr!==0;)qa<(ys=rt.heap[--gs])||(Ct[2*ys+1]!==vt&&(rt.opt_len+=(vt-Ct[2*ys+1])*Ct[2*ys],Ct[2*ys+1]=vt),nr--)}})(X,oe),Ce(je,xt,X.bl_count)}function U(X,oe,Se){var we,ae,je=-1,Ne=oe[1],De=0,qe=7,xt=4;for(Ne===0&&(qe=138,xt=3),oe[2*(Se+1)+1]=65535,we=0;we<=Se;we++)ae=Ne,Ne=oe[2*(we+1)+1],++De<qe&&ae===Ne||(De<xt?X.bl_tree[2*ae]+=De:ae!==0?(ae!==je&&X.bl_tree[2*ae]++,X.bl_tree[2*M]++):De<=10?X.bl_tree[2*V]++:X.bl_tree[2*$]++,je=ae,xt=(De=0)===Ne?(qe=138,3):ae===Ne?(qe=6,3):(qe=7,4))}function de(X,oe,Se){var we,ae,je=-1,Ne=oe[1],De=0,qe=7,xt=4;for(Ne===0&&(qe=138,xt=3),we=0;we<=Se;we++)if(ae=Ne,Ne=oe[2*(we+1)+1],!(++De<qe&&ae===Ne)){if(De<xt)for(;ie(X,ae,X.bl_tree),--De!=0;);else ae!==0?(ae!==je&&(ie(X,ae,X.bl_tree),De--),ie(X,M,X.bl_tree),ne(X,De-3,2)):De<=10?(ie(X,V,X.bl_tree),ne(X,De-3,3)):(ie(X,$,X.bl_tree),ne(X,De-11,7));je=ae,xt=(De=0)===Ne?(qe=138,3):ae===Ne?(qe=6,3):(qe=7,4)}}h(Q);var ye=!1;function ee(X,oe,Se,we){ne(X,(f<<1)+(we?1:0),3),(function(ae,je,Ne,De){ge(ae),re(ae,Ne),re(ae,~Ne),o.arraySet(ae.pending_buf,ae.window,je,Ne,ae.pending),ae.pending+=Ne})(X,oe,Se)}i._tr_init=function(X){ye||((function(){var oe,Se,we,ae,je,Ne=new Array(w+1);for(ae=we=0;ae<p-1;ae++)for(J[ae]=we,oe=0;oe<1<<I[ae];oe++)N[we++]=ae;for(N[we-1]=ae,ae=je=0;ae<16;ae++)for(Q[ae]=je,oe=0;oe<1<<D[ae];oe++)O[je++]=ae;for(je>>=7;ae<_;ae++)for(Q[ae]=je<<7,oe=0;oe<1<<D[ae]-7;oe++)O[256+je++]=ae;for(Se=0;Se<=w;Se++)Ne[Se]=0;for(oe=0;oe<=143;)q[2*oe+1]=8,oe++,Ne[8]++;for(;oe<=255;)q[2*oe+1]=9,oe++,Ne[9]++;for(;oe<=279;)q[2*oe+1]=7,oe++,Ne[7]++;for(;oe<=287;)q[2*oe+1]=8,oe++,Ne[8]++;for(Ce(q,v+1,Ne),oe=0;oe<_;oe++)A[2*oe+1]=5,A[2*oe]=be(oe,5);Y=new te(q,I,g+1,v,w),G=new te(A,D,0,_,w),Z=new te(new Array(0),P,0,C,T)})(),ye=!0),X.l_desc=new z(X.dyn_ltree,Y),X.d_desc=new z(X.dyn_dtree,G),X.bl_desc=new z(X.bl_tree,Z),X.bi_buf=0,X.bi_valid=0,ce(X)},i._tr_stored_block=ee,i._tr_flush_block=function(X,oe,Se,we){var ae,je,Ne=0;0<X.level?(X.strm.data_type===2&&(X.strm.data_type=(function(De){var qe,xt=4093624447;for(qe=0;qe<=31;qe++,xt>>>=1)if(1&xt&&De.dyn_ltree[2*qe]!==0)return l;if(De.dyn_ltree[18]!==0||De.dyn_ltree[20]!==0||De.dyn_ltree[26]!==0)return d;for(qe=32;qe<g;qe++)if(De.dyn_ltree[2*qe]!==0)return d;return l})(X)),st(X,X.l_desc),st(X,X.d_desc),Ne=(function(De){var qe;for(U(De,De.dyn_ltree,De.l_desc.max_code),U(De,De.dyn_dtree,De.d_desc.max_code),st(De,De.bl_desc),qe=C-1;3<=qe&&De.bl_tree[2*L[qe]+1]===0;qe--);return De.opt_len+=3*(qe+1)+5+5+4,qe})(X),ae=X.opt_len+3+7>>>3,(je=X.static_len+3+7>>>3)<=ae&&(ae=je)):ae=je=Se+5,Se+4<=ae&&oe!==-1?ee(X,oe,Se,we):X.strategy===4||je===ae?(ne(X,2+(we?1:0),3),ot(X,q,A)):(ne(X,4+(we?1:0),3),(function(De,qe,xt,rt){var Qn;for(ne(De,qe-257,5),ne(De,xt-1,5),ne(De,rt-4,4),Qn=0;Qn<rt;Qn++)ne(De,De.bl_tree[2*L[Qn]+1],3);de(De,De.dyn_ltree,qe-1),de(De,De.dyn_dtree,xt-1)})(X,X.l_desc.max_code+1,X.d_desc.max_code+1,Ne+1),ot(X,X.dyn_ltree,X.dyn_dtree)),ce(X),we&&ge(X)},i._tr_tally=function(X,oe,Se){return X.pending_buf[X.d_buf+2*X.last_lit]=oe>>>8&255,X.pending_buf[X.d_buf+2*X.last_lit+1]=255&oe,X.pending_buf[X.l_buf+X.last_lit]=255&Se,X.last_lit++,oe===0?X.dyn_ltree[2*Se]++:(X.matches++,oe--,X.dyn_ltree[2*(N[Se]+g+1)]++,X.dyn_dtree[2*H(oe)]++),X.last_lit===X.lit_bufsize-1},i._tr_align=function(X){ne(X,2,3),ie(X,R,q),(function(oe){oe.bi_valid===16?(re(oe,oe.bi_buf),oe.bi_buf=0,oe.bi_valid=0):8<=oe.bi_valid&&(oe.pending_buf[oe.pending++]=255&oe.bi_buf,oe.bi_buf>>=8,oe.bi_valid-=8)})(X)}},{"../utils/common":41}],53:[function(n,r,i){r.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(n,r,i){(function(o){(function(l,d){if(!l.setImmediate){var h,f,p,g,v=1,_={},C=!1,x=l.document,w=Object.getPrototypeOf&&Object.getPrototypeOf(l);w=w&&w.setTimeout?w:l,h={}.toString.call(l.process)==="[object process]"?function(M){process.nextTick(function(){T(M)})}:(function(){if(l.postMessage&&!l.importScripts){var M=!0,V=l.onmessage;return l.onmessage=function(){M=!1},l.postMessage("","*"),l.onmessage=V,M}})()?(g="setImmediate$"+Math.random()+"$",l.addEventListener?l.addEventListener("message",R,!1):l.attachEvent("onmessage",R),function(M){l.postMessage(g+M,"*")}):l.MessageChannel?((p=new MessageChannel).port1.onmessage=function(M){T(M.data)},function(M){p.port2.postMessage(M)}):x&&"onreadystatechange"in x.createElement("script")?(f=x.documentElement,function(M){var V=x.createElement("script");V.onreadystatechange=function(){T(M),V.onreadystatechange=null,f.removeChild(V),V=null},f.appendChild(V)}):function(M){setTimeout(T,0,M)},w.setImmediate=function(M){typeof M!="function"&&(M=new Function(""+M));for(var V=new Array(arguments.length-1),$=0;$<V.length;$++)V[$]=arguments[$+1];var I={callback:M,args:V};return _[v]=I,h(v),v++},w.clearImmediate=E}function E(M){delete _[M]}function T(M){if(C)setTimeout(T,0,M);else{var V=_[M];if(V){C=!0;try{(function($){var I=$.callback,D=$.args;switch(D.length){case 0:I();break;case 1:I(D[0]);break;case 2:I(D[0],D[1]);break;case 3:I(D[0],D[1],D[2]);break;default:I.apply(d,D)}})(V)}finally{E(M),C=!1}}}}function R(M){M.source===l&&typeof M.data=="string"&&M.data.indexOf(g)===0&&T(+M.data.slice(g.length))}})(typeof self>"u"?o===void 0?this:o:self)}).call(this,typeof Lh<"u"?Lh:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(Yg)),Yg.exports}var wP=xP();const Am=V2(wP);function SP({currentUser:t,budgetId:e}){const[n,r]=k.useState(!1),[i,o]=k.useState(null),[l,d]=k.useState(null);async function h(){if(!t){d("Must be logged in to download budget");return}if(!e){d("No budget selected");return}r(!0),d(null),o({phase:"reading",current:0,total:1,percentComplete:0});try{o({phase:"reading",current:0,total:1,percentComplete:10});const{exists:f,data:p}=await Lt("budgets",e,`downloading budget ${e}`);if(!f||!p){d(`Budget ${e} not found`);return}const g=await WT(e,"download-budget");let v=null;try{const{exists:A,data:O}=await Lt("payees",e,`downloading payees for budget ${e}`);A&&O&&(v=O)}catch(A){console.warn(`Could not read payees for budget ${e}:`,A)}o({phase:"processing",current:0,total:g.length+1,percentComplete:20});const _=new Am,C=new Date,x=C.toISOString().split("T")[0],w=`budget_${e}`,{accounts:E,account_groups:T,categories:R,category_groups:M,...V}=p;_.file(`${w}/budget.json`,JSON.stringify(V,null,2)),_.file(`${w}/accounts.json`,JSON.stringify(E||{},null,2)),_.file(`${w}/account_groups.json`,JSON.stringify(T||{},null,2)),_.file(`${w}/categories.json`,JSON.stringify(R||{},null,2)),_.file(`${w}/category_groups.json`,JSON.stringify(M||[],null,2)),v&&_.file(`${w}/payees.json`,JSON.stringify(v,null,2));let $=0;for(const A of g){const O=A.data,N=`${w}/months/month_${O.year}_${String(O.month).padStart(2,"0")}`,J={};if(O.are_allocations_finalized&&O.category_balances)for(const Y of O.category_balances)Y.allocated!==void 0&&(J[Y.category_id]=Y.allocated);_.file(`${N}/metadata.json`,JSON.stringify({budget_id:O.budget_id,year_month_ordinal:O.year_month_ordinal,year:O.year,month:O.month,total_income:O.total_income,previous_month_income:O.previous_month_income,total_expenses:O.total_expenses,are_allocations_finalized:O.are_allocations_finalized,created_at:O.created_at,updated_at:O.updated_at,...O.are_allocations_finalized&&{allocations:J},downloaded_at:C.toISOString()},null,2)),_.file(`${N}/income.json`,JSON.stringify(O.income||[],null,2)),_.file(`${N}/expenses.json`,JSON.stringify(O.expenses||[],null,2)),_.file(`${N}/transfers.json`,JSON.stringify(O.transfers||[],null,2)),_.file(`${N}/adjustments.json`,JSON.stringify(O.adjustments||[],null,2)),_.file(`${N}/account_balances.json`,JSON.stringify(O.account_balances||[],null,2)),_.file(`${N}/category_balances.json`,JSON.stringify(O.category_balances||[],null,2)),$++,o({phase:"processing",current:$,total:g.length,percentComplete:20+Math.round($/g.length*60)})}o({phase:"zipping",current:0,total:1,percentComplete:80});const I=await _.generateAsync({type:"blob"});o({phase:"complete",current:1,total:1,percentComplete:100});const P=(p.name||"budget").replace(/[^a-z0-9]/gi,"_").toLowerCase(),L=URL.createObjectURL(I),q=document.createElement("a");q.href=L,q.download=`${x}_${P}_${e}.zip`,document.body.appendChild(q),q.click(),document.body.removeChild(q),URL.revokeObjectURL(L)}catch(f){d(f instanceof Error?f.message:"Unknown error during download")}finally{r(!1),o(null)}}return{isDownloading:n,progress:i,error:l,downloadBudget:h}}async function CP(t){const n=await new Am().loadAsync(t),r=new Set,i=new Set;for(const[o]of Object.entries(n.files)){const l=o.match(/^budget_([^/]+)\//);if(l){const d=l[1];r.add(d),o.match(/^budget_([^/]+)\/months\/month_\d{4}_\d{2}\//)&&i.add(o.split("/months/")[1].split("/")[0])}}return{budgetsFound:r.size,monthsFound:i.size,payeesFound:r.size,budgetsToRestore:Array.from(r)}}async function EP(t,e,n){const i=`${`${e}/months/`}${n}/`,o=`${i}metadata.json`,l=t.files[o];if(!l)return null;const d=await l.async("string"),h=JSON.parse(d),{downloaded_at:f,allocations:p,...g}=h,v=async w=>{const E=`${i}${w}`,T=t.files[E];if(T){const R=await T.async("string");return JSON.parse(R)}return[]},_={budget_id:g.budget_id,year:g.year,month:g.month,year_month_ordinal:g.year_month_ordinal,total_income:0,previous_month_income:0,total_expenses:0,are_allocations_finalized:g.are_allocations_finalized??!1,created_at:g.created_at||new Date().toISOString(),updated_at:new Date().toISOString(),income:await v("income.json"),expenses:await v("expenses.json"),transfers:await v("transfers.json"),adjustments:await v("adjustments.json"),account_balances:[],category_balances:[]},C=Ai(_);let x=Cm(C);if(h.are_allocations_finalized&&p!==void 0){const w=new Map;for(const R of x.category_balances)w.set(R.category_id,R);const E=[],T=new Set;for(const R of x.category_balances){const M=p[R.category_id];if(M!==void 0){const V=Me(M);E.push({...R,allocated:V,end_balance:Me(R.start_balance+V+R.spent+R.transfers+R.adjustments)})}else E.push(R);T.add(R.category_id)}for(const[R,M]of Object.entries(p))if(!T.has(R)){const V=Me(M);E.push({category_id:R,start_balance:0,allocated:V,spent:0,transfers:0,adjustments:0,end_balance:V})}x={...x,category_balances:E}}return{budgetId:g.budget_id,year:g.year,month:g.month,data:x}}async function TP(t,e){const n=`budget_${e}`,r=async $=>{const I=t.files[$];if(I){const D=await I.async("string");return JSON.parse(D)}return null},i=`${n}/budget.json`,o=`${n}/accounts.json`,l=`${n}/account_groups.json`,d=`${n}/categories.json`,h=`${n}/category_groups.json`,f=await r(i);if(!f)throw new Error("Missing required file budget.json");const p=await r(o)||{},g=await r(l)||{},v=await r(d)||{},_=await r(h)||[],C=Ai({...f,accounts:p,account_groups:g,categories:v,category_groups:_}),x={budgetId:e,data:C},w=`${n}/payees.json`,E=await r(w);let T=null;if(E){const $={...E,budget_id:e,updated_at:new Date().toISOString()};T={collectionPath:"payees",docId:e,data:Ai($)}}const R=`${n}/months/`,M=new Set;for(const $ of Object.keys(t.files))if($.startsWith(R)&&$.includes("/metadata.json")){const I=$.split("/months/")[1].split("/")[0];M.add(I)}const V=[];for(const $ of M){const I=await EP(t,n,$);I&&V.push(I)}return{budgetUpdate:x,monthUpdates:V,payeeWrite:T}}function AP({currentUser:t}){const[e,n]=k.useState(!1),[r,i]=k.useState(!1),[o,l]=k.useState(null),[d,h]=k.useState(null),[f,p]=k.useState(null),[g,v]=k.useState(null);async function _(x){if(!t){p("Must be logged in to upload budget");return}n(!0),p(null),l(null),v(null);try{const w=await CP(x);l(w)}catch(w){p(w instanceof Error?w.message:"Failed to parse zip file")}finally{n(!1)}}async function C(x){if(!t){p("Must be logged in to upload budget");return}if(!o){p("Must scan file first");return}i(!0),p(null),h({phase:"parsing",current:0,total:1,percentComplete:0});const w=[];let E=0,T=0,R=0;try{h({phase:"parsing",current:0,total:1,percentComplete:10});const V=await new Am().loadAsync(x);h({phase:"validating",current:0,total:1,percentComplete:20}),h({phase:"uploading",current:0,total:o.budgetsToRestore.length,percentComplete:30});const $=[],I=[],D=[];for(let P=0;P<o.budgetsToRestore.length;P++){const L=o.budgetsToRestore[P];try{const{budgetUpdate:q,monthUpdates:A,payeeWrite:O}=await TP(V,L);$.push(q),I.push(...A),O&&D.push(O),h({phase:"uploading",current:P+1,total:o.budgetsToRestore.length,percentComplete:30+Math.round((P+1)/o.budgetsToRestore.length*50)})}catch(q){w.push(`Budget ${L}: ${q instanceof Error?q.message:String(q)}`)}}if(h({phase:"uploading",current:o.budgetsToRestore.length,total:o.budgetsToRestore.length,percentComplete:80}),$.length>0)try{console.log(`[Upload] Writing ${$.length} budget(s)...`),await QT($,"upload-budget"),E=$.length,console.log(`[Upload] Successfully wrote ${E} budget(s)`)}catch(P){const L=`Failed to write budgets: ${P instanceof Error?P.message:String(P)}`;throw console.error(`[Upload] ${L}`,P),w.push(L),P}if(D.length>0)try{console.log(`[Upload] Writing ${D.length} payee doc(s)...`),await mm(D,"upload-budget: writing payees"),R=D.length,console.log(`[Upload] Successfully wrote ${R} payee doc(s)`)}catch(P){const L=`Failed to write payees: ${P instanceof Error?P.message:String(P)}`;throw console.error(`[Upload] ${L}`,P),w.push(L),P}if(I.length>0)try{console.log(`[Upload] Writing ${I.length} month(s) and recalculating...`),await j3(I,"upload-budget"),T=I.length,console.log(`[Upload] Successfully wrote ${T} month(s)`)}catch(P){const L=`Failed to write months: ${P instanceof Error?P.message:String(P)}`;throw console.error(`[Upload] ${L}`,P),w.push(L),P}h({phase:"complete",current:1,total:1,percentComplete:100}),v({success:w.length===0,budgetsRestored:E,monthsRestored:T,payeesRestored:R,errors:w}),console.log("[Upload] Clearing all caches after upload..."),Na()}catch(M){const V=M instanceof Error?M.message:"Unknown error during upload";console.error("[Upload] Upload failed with error:",M),console.error("[Upload] Error details:",{errorMessage:V,budgetsRestored:E,monthsRestored:T,payeesRestored:R,errorsSoFar:w}),p(V),v({success:!1,budgetsRestored:E,monthsRestored:T,payeesRestored:R,errors:[...w,V]}),console.log("[Upload] Clearing all caches after failed upload (partial writes possible)..."),Na()}finally{i(!1),h(null)}}return{isScanning:e,isUploading:r,status:o,progress:d,error:f,result:g,scanZipFile:_,uploadBudget:C}}function jP({isActive:t,onDragOver:e,onDragLeave:n,onDrop:r,label:i="Move to end"}){return u.jsxs("div",{onDragOver:e,onDragLeave:n,onDrop:r,style:q4,children:[u.jsx("div",{style:{...H4,opacity:t?1:.3,boxShadow:t?"0 0 8px rgba(100, 108, 255, 0.6)":"none"}}),t&&u.jsx("span",{style:G4,children:i})]})}function Vt(t){return`$${Math.abs(t).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`}function yr(t){return t<0?`-$${Math.abs(t).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`:`$${t.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`}function Vn(t){return t<0?`-$${Math.abs(t).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`:`$${t.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`}function Pt(t){return t===0?"$0.00":`${t>0?"+":"-"}${Vt(t)}`}function Bt(t){return`${t>=0?"+":"-"}${Vt(t)}`}function ct(t){return t===0?fe.zero:t>0?fe.success:fe.danger}function dn(t){return t===0?fe.zero:t>0?fe.success:fe.debt}function yc(t){return t===0?fe.zero:t<0?fe.error:fe.success}function _c(t){return t===0?fe.zero:t>0?fe.success:fe.error}async function JT(t,e){const{exists:n,data:r}=await Lt("feedback",t,`VALIDATION-READ: ${e}`);if(!n||!r)throw new Error(`Feedback document not found: ${t}`);return{items:r.items||[],user_email:r.user_email,created_at:r.created_at,updated_at:r.updated_at}}async function X0(t){const{docId:e,items:n,description:r}=t;await or("feedback",e,{items:n,updated_at:new Date().toISOString()},r,{merge:!0})}async function RP(t,e,n,r){const{exists:i}=await Lt("feedback",t,"checking if user has existing feedback document");i?await or("feedback",t,{items:Vu(e),user_email:n,updated_at:new Date().toISOString()},r,{merge:!0}):await or("feedback",t,{items:[e],user_email:n,created_at:new Date().toISOString(),updated_at:new Date().toISOString()},r)}function eA(){const t=$t(),e=Wn({onMutate:async r=>{const{userId:i,userEmail:o,text:l,feedbackType:d,currentPath:h}=r,f=o||i,p=Te.feedback();await t.cancelQueries({queryKey:p});const g=t.getQueryData(p),v=`feedback_optimistic_${Date.now()}`,_={id:v,text:`${l}

(Submitted from: ${h})`,created_at:new Date().toISOString(),is_done:!1,completed_at:null,sort_order:Date.now(),feedback_type:d,doc_id:f,user_email:o};return g&&t.setQueryData(p,{items:[...g.items,_]}),{previousData:g,optimisticId:v}},mutationFn:async r=>{const{userId:i,userEmail:o,text:l,feedbackType:d,currentPath:h}=r,f=o||i,p={id:`feedback_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,text:`${l}

(Submitted from: ${h})`,created_at:new Date().toISOString(),is_done:!1,completed_at:null,sort_order:Date.now(),feedback_type:d};return await RP(f,p,o,"submitting new feedback"),{feedbackItem:p,docId:f}},onSuccess:(r,i,o)=>{if(!o?.optimisticId)return;const l=t.getQueryData(Te.feedback());l&&t.setQueryData(Te.feedback(),{items:l.items.map(d=>d.id===o.optimisticId?{...r.feedbackItem,doc_id:r.docId,user_email:i.userEmail}:d)})},onError:(r,i,o)=>{o?.previousData&&t.setQueryData(Te.feedback(),o.previousData)}});return{submitFeedback:{mutate:r=>e.mutate(r),mutateAsync:r=>e.mutateAsync(r),isPending:e.isPending,isError:e.isError,error:e.error,reset:e.reset}}}function IP(){const t=$t(),e=Wn({onMutate:async r=>{const{item:i}=r,o=Te.feedback(),l=!i.is_done,d=l?new Date().toISOString():null;await t.cancelQueries({queryKey:o});const h=t.getQueryData(o);return h&&t.setQueryData(o,{items:h.items.map(f=>f.id===i.id?{...f,is_done:l,completed_at:d}:f)}),{previousData:h}},mutationFn:async r=>{const{item:i}=r,o=!i.is_done,l=o?new Date().toISOString():null,d=await JT(i.doc_id,"toggle feedback");let h=!1;const f=d.items.map(p=>p.id===i.id?(h=!0,{...p,is_done:o,completed_at:l}):p);if(!h)throw console.error("[toggleFeedback] Item not found in document",{searchingFor:i.id,inDocument:i.doc_id,availableIds:d.items.map(p=>p.id)}),new Error(`Feedback item not found in document. Item ID: ${i.id}, Doc ID: ${i.doc_id}`);return await X0({docId:i.doc_id,items:f,description:`marking feedback item as ${o?"done":"not done"}`}),{itemId:i.id,isDone:o,completedAt:l}},onError:(r,i,o)=>{o?.previousData&&t.setQueryData(Te.feedback(),o.previousData)}});return{toggleFeedback:{mutate:r=>e.mutate(r),mutateAsync:r=>e.mutateAsync(r),isPending:e.isPending,isError:e.isError,error:e.error,reset:e.reset}}}function kP(){const t=$t(),e=Wn({onMutate:async r=>{const{docId:i,items:o}=r,l=Te.feedback();await t.cancelQueries({queryKey:l});const d=t.getQueryData(l),h=new Map;return o.forEach(f=>{h.set(f.id,f.sort_order)}),d&&t.setQueryData(l,{items:d.items.map(f=>f.doc_id===i&&h.has(f.id)?{...f,sort_order:h.get(f.id)}:f)}),{previousData:d}},mutationFn:async r=>{const{docId:i,items:o}=r;return await X0({docId:i,items:o,description:"saving reordered feedback items"}),{docId:i,items:o}},onError:(r,i,o)=>{o?.previousData&&t.setQueryData(Te.feedback(),o.previousData)}});return{updateSortOrder:{mutate:r=>e.mutate(r),mutateAsync:r=>e.mutateAsync(r),isPending:e.isPending,isError:e.isError,error:e.error,reset:e.reset}}}function hs({isOpen:t,onClose:e,title:n,children:r,width:i="28rem"}){if(!t)return null;function o(){e()}return u.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0, 0, 0, 0.6)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1001,padding:"1rem"},onClick:o,children:u.jsxs("div",{style:{background:"#1a1a1a",color:"rgba(255, 255, 255, 0.87)",borderRadius:"12px",padding:"1.5rem",width:i,maxWidth:"calc(100vw - 2rem)",flexShrink:0,boxSizing:"border-box",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.5)"},onClick:l=>l.stopPropagation(),children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[u.jsx("h2",{style:{margin:0,fontSize:"1.25rem"},children:n}),u.jsx("button",{onClick:o,style:{background:"transparent",border:"none",color:"inherit",cursor:"pointer",fontSize:"1.5rem",opacity:.6,lineHeight:1},children:""})]}),r]})})}const DP=2e3,MP={critical_bug:{label:"Critical Bug",color:"#ff4757",bgColor:"rgba(255, 71, 87, 0.15)"},bug:{label:"Bug",color:"#ffa502",bgColor:"rgba(255, 165, 2, 0.15)"},new_feature:{label:"New Feature",color:"#2ed573",bgColor:"rgba(46, 213, 115, 0.15)"},core_feature:{label:"Core Feature",color:"#1e90ff",bgColor:"rgba(30, 144, 255, 0.15)"},qol:{label:"QOL",color:"#a55eea",bgColor:"rgba(165, 94, 234, 0.15)"}};function OP(){const[t,e]=k.useState(!1),[n,r]=k.useState(""),[i,o]=k.useState("bug"),[l,d]=k.useState(!1),h=k.useContext(md),p=za().get_current_firebase_user(),g=tr(),{submitFeedback:v}=eA();if(k.useEffect(()=>{if(l){const x=setTimeout(()=>d(!1),DP);return()=>clearTimeout(x)}},[l]),g.pathname.includes("/admin/feedback")||!h.is_logged_in)return null;function C(x){x.preventDefault(),!(!n.trim()||!h.username||!p)&&(v.mutate({userId:p.uid,userEmail:h.username,text:n.trim(),feedbackType:i,currentPath:g.pathname}),r(""),o("bug"),e(!1),d(!0))}return u.jsxs(u.Fragment,{children:[l&&u.jsxs("div",{style:{position:"fixed",bottom:"5rem",right:"1.5rem",background:"rgba(46, 213, 115, 0.95)",color:"white",padding:"0.75rem 1rem",borderRadius:"0.5rem",fontSize:"0.9rem",fontWeight:500,boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",zIndex:1001,display:"flex",alignItems:"center",gap:"0.5rem",animation:"fadeInUp 0.2s ease-out"},children:[u.jsx("span",{children:""}),u.jsx("span",{children:"Feedback submitted!"})]}),u.jsx("button",{onClick:()=>{e(!0)},style:{position:"fixed",bottom:"1.5rem",right:"1.5rem",width:"3rem",height:"3rem",borderRadius:"50%",background:fe.primary,color:"white",border:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1.25rem",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",transition:"transform 0.15s, box-shadow 0.15s",zIndex:1e3},title:"Send Feedback",onMouseEnter:x=>{x.currentTarget.style.transform="scale(1.1)",x.currentTarget.style.boxShadow="0 6px 16px rgba(0, 0, 0, 0.4)"},onMouseLeave:x=>{x.currentTarget.style.transform="scale(1)",x.currentTarget.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.3)"},children:""}),u.jsx(hs,{isOpen:t,onClose:()=>{e(!1),o("bug")},title:"Send Feedback",children:u.jsxs("form",{onSubmit:C,children:[u.jsx("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"0.75rem",paddingBottom:"1rem",flexWrap:"wrap"},children:["critical_bug","bug","new_feature","core_feature","qol"].map(x=>{const w=MP[x],E=i===x;return u.jsxs("button",{type:"button",onClick:()=>{w.label,o(x)},style:{flex:1,padding:"0.6rem 0.5rem",border:`2px solid ${w.color}`,borderRadius:"0.5rem",background:E?w.bgColor:"transparent",color:E?w.color:"rgba(255,255,255,0.5)",cursor:"pointer",fontWeight:E?600:400,fontSize:"0.8rem",transition:"all 0.15s ease",opacity:E?1:.5,boxShadow:E?`0 0 12px ${w.bgColor}`:"none",position:"relative"},children:[w.label,E&&u.jsx("span",{style:{position:"absolute",bottom:"-14px",left:"10%",right:"10%",height:"3px",background:"white",borderRadius:"2px"}})]},x)})}),u.jsx(K0,{value:n,onChange:x=>r(x.target.value),placeholder:"Share your feedback, bug reports, or feature requests...",minHeight:"8rem",autoFocus:!0,required:!0}),u.jsxs($a,{children:[u.jsx(Ve,{type:"button",variant:"secondary",actionName:"Cancel Feedback",onClick:()=>{e(!1),o("bug")},children:"Cancel"}),u.jsx(Ve,{type:"submit",actionName:"Submit Feedback",disabled:!n.trim(),children:"Submit"})]})]})})]})}function Wr({children:t,labelStyle:e,...n}){return u.jsxs("label",{style:{display:"flex",alignItems:"flex-start",gap:"0.75rem",flex:1,cursor:"pointer",...e},children:[u.jsx("input",{type:"checkbox",style:{width:"1.25rem",height:"1.25rem",marginTop:"0.1rem",cursor:"pointer",accentColor:fe.primary},...n}),t]})}function Z0({title:t,count:e,children:n,defaultExpanded:r=!1}){const[i,o]=k.useState(r);return u.jsxs("div",{style:{marginTop:"2rem"},children:[u.jsxs("button",{onClick:()=>o(!i),style:{background:"transparent",border:"none",color:"inherit",cursor:"pointer",display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 0",fontSize:"0.9rem",opacity:.7},children:[u.jsx("span",{style:{transition:"transform 0.2s",transform:i?"rotate(90deg)":"rotate(0deg)"},children:""}),t,e!==void 0&&` (${e})`]}),i&&n]})}const NP=t=>{switch(t){case 2:return 220;case 3:return 320;case 4:return 420;case 5:return 520;case 6:return 620;default:return t*100+20}},PP=t=>t<=4?2:t<=6?3:Math.ceil(t/2);function Pf(t){const{tabs:e,activeTab:n,variant:r="primary"}=t,i=e.filter(w=>!w.hidden),o=i.length,l=NP(o),d=PP(o),h=Math.floor(100/d),f=`tab-nav-${o}-${r}`,p=r==="primary",g=r==="secondary",v=r==="segmented",_=w=>{const E="color-mix(in srgb, currentColor 10%, transparent)",T="color-mix(in srgb, currentColor 3%, transparent)";return v?{flex:"1 1 0",padding:"0.75rem 1rem",border:"none",borderRadius:0,background:w?E:T,cursor:"pointer",fontWeight:w?600:400,fontSize:"0.95rem",color:"inherit",opacity:w?1:.55,transition:"all 0.15s",textDecoration:"none",display:"inline-flex",alignItems:"center",justifyContent:"center",gap:"0.25rem",position:"relative",boxSizing:"border-box",outline:"none",borderBottom:w?"2px solid currentColor":"2px solid transparent"}:g?{flex:"none",minWidth:"8.5rem",padding:"0.55rem 1rem 0.65rem",border:"none",borderRadius:"10px 10px 0 0",background:"transparent",cursor:"pointer",fontWeight:600,fontSize:"0.85rem",color:w?"inherit":"color-mix(in srgb, currentColor 55%, transparent)",transition:"color 0.15s",textDecoration:"none",display:"inline-flex",alignItems:"center",justifyContent:"center",gap:"0.25rem",position:"relative",boxSizing:"border-box",outline:"none",marginBottom:w?"-1px":"0"}:{flex:"1 1 0",padding:"0.7rem 0.75rem",border:"none",borderRadius:0,background:"transparent",cursor:"pointer",fontWeight:w?600:400,fontSize:"1rem",letterSpacing:"0.01em",color:"inherit",opacity:w?1:.6,transition:"all 0.15s",textDecoration:"none",display:"inline-flex",alignItems:"center",justifyContent:"center",gap:"0.25rem",position:"relative",boxSizing:"border-box",outline:"none"}},C=(w,E)=>u.jsxs(u.Fragment,{children:[u.jsx("span",{children:w.label}),w.checkmark&&u.jsx("span",{style:{color:fe.success,fontWeight:600},children:""}),p&&E&&u.jsx("span",{style:{position:"absolute",bottom:"-1px",left:"10%",right:"10%",height:"3px",background:"white",borderRadius:"2px"}})]}),x=()=>v?`
        .${f} {
          display: flex;
          margin-bottom: 0.75rem;
          border-bottom: 1px solid color-mix(in srgb, currentColor 15%, transparent);
        }
      `:g?`
        .${f} {
          display: flex;
          flex-wrap: nowrap;
          margin-bottom: 1rem;
          border-bottom: 1px solid color-mix(in srgb, currentColor 10%, transparent);
          justify-content: flex-start;
          padding-left: 0.75rem;
          position: relative;
        }
        .${f} > button,
        .${f} > a {
          margin-right: -8px;
          isolation: isolate;
        }
        .${f} > button:last-child,
        .${f} > a:last-child {
          margin-right: 0;
        }
        .${f} > button::before,
        .${f} > a::before {
          content: '';
          position: absolute;
          inset: 0;
          background: var(--tab-bg);
          border-radius: 10px 10px 0 0;
          z-index: -1;
          transform: perspective(50px) rotateX(5deg);
          transform-origin: bottom center;
          transition: background 0.15s;
          box-shadow: -1px 0 0 #242424, 1px 0 0 #242424;
        }
        .${f} > button:nth-child(1),
        .${f} > a:nth-child(1) {
          z-index: 4;
        }
        .${f} > button:nth-child(2),
        .${f} > a:nth-child(2) {
          z-index: 3;
        }
        .${f} > button:nth-child(3),
        .${f} > a:nth-child(3) {
          z-index: 2;
        }
        .${f} > button:nth-child(4),
        .${f} > a:nth-child(4) {
          z-index: 1;
        }
        .${f} > button.tab-active,
        .${f} > a.tab-active {
          z-index: 10;
        }
        .${f} > button.tab-active::before,
        .${f} > a.tab-active::before {
          background: var(--tab-bg-active);
        }
        .${f} > button:not(.tab-active):hover,
        .${f} > a:not(.tab-active):hover {
          color: color-mix(in srgb, currentColor 80%, transparent);
        }
        .${f} > button:not(.tab-active):hover::before,
        .${f} > a:not(.tab-active):hover::before {
          background: var(--tab-bg-hover);
        }
        @media (max-width: 480px) {
          .${f} {
            padding-left: 0;
            padding-right: 0;
          }
          .${f} > button,
          .${f} > a {
            flex: 0 0 27% !important;
            min-width: 27% !important;
            padding: 0.55rem 0.5rem 0.65rem !important;
            font-size: 0.8rem !important;
          }
        }
      `:`
      .${f} {
        display: flex;
        flex-wrap: wrap;
        margin-bottom: 0;
        border-bottom: 1px solid color-mix(in srgb, currentColor 25%, transparent);
      }
      @media (max-width: ${l}px) {
        .${f} > * {
          flex: 1 1 ${h}% !important;
          min-width: ${h}% !important;
        }
      }
    `;return u.jsxs(u.Fragment,{children:[u.jsx("style",{children:`
        ${x()}
        .${f} > button,
        .${f} > a {
          border: none !important;
          border-radius: 0 !important;
          outline: none !important;
        }
        .${f} > button:hover,
        .${f} > button:focus,
        .${f} > a:hover,
        .${f} > a:focus {
          border: none !important;
          border-color: transparent !important;
          ${p?"opacity: 0.85;":""}
          ${v?"background: color-mix(in srgb, currentColor 7%, transparent);":""}
        }
      `}),u.jsx("div",{className:f,children:i.map(w=>{const E=n===w.id;return t.mode==="link"?u.jsx(Tn,{to:`${t.linkPrefix}/${w.id}`,onClick:()=>(`${w.label}`,void 0),style:_(E),className:E?"tab-active":"",children:C(w,E)},w.id):u.jsx("button",{onClick:()=>{`${w.label}`,t.onTabChange(w.id)},style:_(E),className:E?"tab-active":"",children:C(w,E)},w.id)})})]})}function tA({items:t}){const[e,n]=k.useState(!1),r=k.useRef(null),o=tr().pathname;k.useEffect(()=>{function d(h){r.current&&!r.current.contains(h.target)&&n(!1)}if(e)return document.addEventListener("mousedown",d),()=>document.removeEventListener("mousedown",d)},[e]),k.useEffect(()=>{function d(h){h.key==="Escape"&&n(!1)}if(e)return document.addEventListener("keydown",d),()=>document.removeEventListener("keydown",d)},[e]);const l=t.filter(d=>d.hidden?!1:d.to?d.to==="/budget"?!(o==="/budget"||/^\/budget\/\d{4}\/\d{1,2}\/\w+$/.test(o)):d.to==="/account"||d.to==="/"?o!==d.to:!o.startsWith(d.to):!0);return u.jsxs("div",{ref:r,style:{position:"relative"},children:[u.jsx("button",{onClick:()=>{n(!e)},style:{display:"flex",alignItems:"center",justifyContent:"center",width:"2.5rem",height:"2.5rem",borderRadius:"8px",background:e?"color-mix(in srgb, currentColor 15%, transparent)":"color-mix(in srgb, currentColor 8%, transparent)",border:"none",cursor:"pointer",fontSize:"1.25rem",color:"inherit",transition:"background 0.15s",lineHeight:1},title:"Menu","aria-expanded":e,"aria-haspopup":"true",children:""}),e&&u.jsx("div",{style:{position:"absolute",top:"100%",right:0,marginTop:"0.5rem",minWidth:"180px",background:"#1a1a2e",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",borderRadius:"8px",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.3)",zIndex:1e3,overflow:"hidden"},children:l.map((d,h)=>{if(d.divider)return u.jsx("div",{style:{height:"1px",background:"color-mix(in srgb, currentColor 15%, transparent)",margin:"0.25rem 0"}},h);const f=u.jsxs(u.Fragment,{children:[d.icon&&u.jsx("span",{style:{width:"1.5rem",textAlign:"center"},children:d.icon}),u.jsx("span",{children:d.label})]}),p={display:"flex",alignItems:"center",gap:"0.75rem",padding:"0.75rem 1rem",fontSize:"0.95rem",color:"inherit",textDecoration:"none",cursor:"pointer",transition:"background 0.15s",background:"transparent",border:"none",width:"100%",textAlign:"left"},g={background:"color-mix(in srgb, currentColor 10%, transparent)"};return d.to?u.jsx(Tn,{to:d.to,style:p,onMouseEnter:v=>Object.assign(v.currentTarget.style,g),onMouseLeave:v=>v.currentTarget.style.background="transparent",onClick:()=>{`${d.label}`,n(!1)},children:f},h):u.jsx("button",{onClick:()=>{`${d.label}`,d.onClick?.(),n(!1)},style:p,onMouseEnter:v=>Object.assign(v.currentTarget.style,g),onMouseLeave:v=>v.currentTarget.style.background="transparent",children:f},h)})})]})}function BP({title:t,showBackArrow:e=!1,hideMenu:n=!1}){const{isAdmin:r}=Xe(),i=tr(),l=[...i.pathname==="/budget"||i.pathname.startsWith("/budget/")&&!i.pathname.startsWith("/budget/settings")&&!i.pathname.startsWith("/budget/admin")&&!i.pathname.startsWith("/budget/analytics")&&!i.pathname.startsWith("/budget/my-budgets")?[]:[{label:"Budget",icon:"",to:"/budget"}],{label:"Budget Settings",icon:"",to:"/budget/settings"},{label:"Analytics",icon:"",to:"/budget/analytics"},...r?[{label:"Admin",icon:"",to:"/budget/admin"}]:[],{label:"Switch Budgets",icon:"",to:"/budget/my-budgets"},{divider:!0,label:""},{label:"Exit Budget App",icon:"",to:"/"}];return u.jsxs("nav",{style:{marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%"},children:[u.jsx("div",{style:{flex:"0 0 auto"},children:e?u.jsx(Tn,{to:"/",onClick:()=>void 0,style:{opacity:.6,fontSize:"1.5rem",textDecoration:"none"},title:"Back to Home",children:""}):u.jsx(Tn,{to:"/budget",onClick:()=>void 0,title:"Budget Home",children:u.jsx("img",{src:"/budget-icon.svg",alt:"Budget",style:{width:"1.5rem",height:"1.5rem"}})})}),u.jsx("span",{style:{fontWeight:600,fontSize:"1.1rem",textAlign:"center",flex:"1 1 auto"},children:t}),u.jsx("div",{style:{flex:"0 0 auto"},children:n?u.jsx("div",{style:{width:"1.5rem"}}):u.jsx(tA,{items:l})})]})}function nA({children:t,style:e}){return u.jsx("div",{style:{width:"100%",maxWidth:"var(--content-max-width, 900px)",marginLeft:"auto",marginRight:"auto",...e},children:t})}function Ku({message:t,linkText:e,linkTo:n}){return u.jsx("div",{style:{gridColumn:"1 / -1",background:`color-mix(in srgb, ${fe.warning} 12%, transparent)`,border:`2px solid ${fe.warning}`,borderRadius:"8px",padding:"1rem 1.25rem",margin:"0.75rem 0",animation:"warningPulse 2s ease-in-out infinite"},children:u.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"0.75rem",flexWrap:"wrap"},children:[u.jsx("span",{style:{fontSize:"1.25rem",lineHeight:1.3},children:""}),u.jsxs("div",{style:{flex:1,minWidth:"200px"},children:[u.jsx("p",{style:{margin:0,fontWeight:500,color:fe.warning,fontSize:"0.95rem"},children:t}),u.jsxs(Tn,{to:n,style:{display:"inline-flex",alignItems:"center",gap:"0.35rem",marginTop:"0.5rem",color:fe.warning,fontWeight:600,fontSize:"0.9rem",textDecoration:"underline",textUnderlineOffset:"3px"},children:[e," "]})]})]})})}const zP={success:{bgColor:"rgba(46, 213, 115, 0.95)",color:"white",icon:""},error:{bgColor:"rgba(255, 71, 87, 0.95)",color:"white",icon:""},warning:{bgColor:"rgba(255, 165, 2, 0.95)",color:"white",icon:""},info:{bgColor:"rgba(30, 144, 255, 0.95)",color:"white",icon:""}};function LP({item:t,onDismiss:e}){const[n,r]=k.useState(!1);if(k.useEffect(()=>{if(t){if(r(!0),t.autoDismissMs&&t.autoDismissMs>0){const o=setTimeout(()=>{r(!1),setTimeout(()=>e(t.id),200)},t.autoDismissMs);return()=>clearTimeout(o)}}else r(!1)},[t,e]),!t||!n)return null;const i=zP[t.type];return u.jsxs("div",{style:{position:"fixed",bottom:"1.5rem",right:"1.5rem",left:"1.5rem",maxWidth:"600px",margin:"0 auto",background:i.bgColor,color:i.color,padding:"0.75rem 1rem",borderRadius:"0.5rem",fontSize:"0.9rem",fontWeight:500,boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",zIndex:1001,display:"flex",alignItems:"center",gap:"0.5rem",animation:n?"fadeInUp 0.2s ease-out":"fadeOut 0.2s ease-out",cursor:"pointer"},onClick:()=>{r(!1),setTimeout(()=>e(t.id),200)},children:[u.jsx("span",{children:i.icon}),u.jsx("span",{style:{flex:1},children:t.message}),u.jsx("span",{style:{fontSize:"1.2rem",lineHeight:1},children:""})]})}class UP{items=[];listeners=new Set;nextId=1;add(e){const n=`banner-${this.nextId++}`,r={...e,id:n};return this.items.push(r),this.notify(),n}remove(e){this.items=this.items.filter(n=>n.id!==e),this.notify()}getCurrent(){return this.items[0]||null}subscribe(e){return this.listeners.add(e),e(this.getCurrent()),()=>{this.listeners.delete(e)}}notify(){const e=this.getCurrent();this.listeners.forEach(n=>n(e))}}const qn=new UP;function Rn(){const{removeChange:t,getChanges:e,clearChanges:n,hasChanges:r,setIsSaving:i,setLastSaveTime:o,setSaveError:l}=hd(),d=k.useRef(!1),h=k.useCallback(async(_,C,x,w)=>{const E=Te.month(_,C,x),T=Be.getQueryData(E);if(!T?.month)throw new Error(`Month ${C}/${x} not found in cache`);await H0({budgetId:_,month:T.month,description:`${w}: ${C}/${x}`,cascadeRecalculation:!1})},[]),f=k.useCallback(async(_,C)=>{const x=Te.budget(_),w=Be.getQueryData(x);if(!w)throw new Error(`Budget ${_} not found in cache`);const E=Object.fromEntries(Object.entries(w.budget.accounts||{}).map(([R,M])=>{const{balance:V,...$}=M;return[R,$]})),T=Object.fromEntries(Object.entries(w.budget.categories||{}).map(([R,M])=>{const{balance:V,...$}=M;return[R,$]}));await fd({budgetId:_,updates:{name:w.budget.name,user_ids:w.budget.user_ids,accepted_user_ids:w.budget.accepted_user_ids,owner_id:w.budget.owner_id,owner_email:w.budget.owner_email,accounts:E,account_groups:w.budget.account_groups,categories:T,category_groups:w.budget.category_groups,month_map:w.budget.month_map},description:`${C}: budget`})},[]),p=k.useCallback(async(_,C)=>{const x=Te.payees(_),w=Be.getQueryData(x);if(!w)throw new Error(`Payees for budget ${_} not found in cache`);await or("payees",_,{budget_id:_,payees:w,updated_at:new Date().toISOString()},`${C}: payees`)},[]),g=k.useCallback(async(_="periodic save")=>{if(d.current||!r())return;d.current=!0,i(!0),l(null);const C=e(),x=[];try{const w=[],E=new Set,T=new Set;for(const R of C)R.type==="month"&&R.year!==void 0&&R.month!==void 0?w.push({budgetId:R.budgetId,year:R.year,month:R.month}):R.type==="budget"?E.add(R.budgetId):R.type==="payees"&&T.add(R.budgetId);for(const{budgetId:R,year:M,month:V}of w){const $=Te.month(R,M,V),I=Be.getQueryData($);if(I?.month){const D=Cm(I.month);Be.setQueryData($,{month:D})}}for(const{budgetId:R,year:M,month:V}of w)try{await h(R,M,V,_)}catch($){const I=`Failed to save month ${M}/${V}: ${$ instanceof Error?$.message:String($)}`;x.push(I),console.error("[useBackgroundSave]",I,$)}for(const R of E)try{$T(R)}catch(M){console.warn("[useBackgroundSave] Failed to recalculate budget account balances from cache:",M)}for(const R of E)try{await f(R,_)}catch(M){const V=`Failed to save budget: ${M instanceof Error?M.message:String(M)}`;x.push(V),console.error("[useBackgroundSave]",V,M)}for(const R of T)try{await p(R,_)}catch(M){const V=`Failed to save payees: ${M instanceof Error?M.message:String(M)}`;x.push(V),console.error("[useBackgroundSave]",V,M)}if(x.length===0)n(),o(Date.now()),qn.add({type:"success",message:"All changes saved successfully",autoDismissMs:2e3});else throw new Error(x.join("; "))}catch(w){const E=w instanceof Error?w.message:String(w);throw l(E),qn.add({type:"error",message:`Failed to save changes: ${E}`,autoDismissMs:0}),w}finally{d.current=!1,i(!1)}},[r,e,n,h,f,p,i,o,l]),v=k.useCallback(async(_,C,x,w)=>{try{i(!0),l(null),C==="month"&&x!==void 0&&w!==void 0?(await h(_,x,w,"immediate save (current viewing document)"),t({type:"month",budgetId:_,year:x,month:w}),o(Date.now())):C==="budget"&&(await f(_,"immediate save (current viewing document)"),t({type:"budget",budgetId:_}),o(Date.now()))}catch(E){const T=E instanceof Error?E.message:String(E);throw l(T),qn.add({type:"error",message:`Failed to save current document: ${T}`,autoDismissMs:0}),E}finally{i(!1)}},[h,f,t,i,o,l]);return{saveAllChanges:g,saveCurrentDocument:v}}async function FP(t,e,n,r){const i=Be.getQueryData(Te.budget(t));if(!i){console.warn("[mutationHelpers] Budget not in cache, skipping local recalculation");return}const o=i.budget.month_map,l=et(e,n),d=[];for(const[h]of Object.entries(o))if(h>=l){const f=parseInt(h.substring(0,4),10),p=parseInt(h.substring(4,6),10);d.push({year:f,month:p})}d.sort((h,f)=>h.year!==f.year?h.year-f.year:h.month-f.month);for(const{year:h,month:f}of d)try{await g3(t,h,f,Be),r&&r({type:"month",budgetId:t,year:h,month:f})}catch(p){console.warn(`[mutationHelpers] Failed to recalculate month ${h}/${f} locally:`,p)}}function br(){const{trackChange:t}=hd();return{updateMonthCacheAndTrack:(r,i,o,l)=>{Be.setQueryData(Te.month(r,i,o),{month:l}),t({type:"month",budgetId:r,year:i,month:o})},recalculateMonthAndCascade:async(r,i,o,l)=>{const d=Te.month(r,i,o),h=Be.getQueryData(d);if(h?.month){const _=Cm(h.month);Be.setQueryData(d,{month:_})}const f=U0(),p=et(f.year,f.month),g=et(i,o),v=g<p;if(await FP(r,i,o,t),v){l?.(!0,"Saving start balances...");try{const _=Be.getQueryData(Te.budget(r));if(!_){console.warn("[mutationHelpers] Budget not in cache, skipping start_balance save");return}const C=_.monthMap||{},x=[];for(const[w]of Object.entries(C))if(w>=g&&w<=p){const E=parseInt(w.substring(0,4),10),T=parseInt(w.substring(4,6),10);x.push({year:E,month:T})}x.sort((w,E)=>w.year!==E.year?w.year-E.year:w.month-E.month);for(const{year:w,month:E}of x){const T=Te.month(r,w,E),R=Be.getQueryData(T);if(R?.month){const M=bm(R.month);await H0({budgetId:r,month:M,description:`recalculation: saving start_balance for ${w}/${E}`,cascadeRecalculation:!1})}}}catch(_){console.error("[mutationHelpers] Failed to save start_balance for months at/before window:",_)}finally{l?.(!1,"")}}try{await qT(r)}catch(_){console.warn("[mutationHelpers] Failed to ensure months fresh and recalculate balances:",_)}t({type:"budget",budgetId:r})},trackChange:t}}function VP(){const{currentViewingDocument:t}=Xe(),{saveCurrentDocument:e}=Rn(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=br();return{finalizeAllocations:async o=>{const{budgetId:l,year:d,month:h,allocations:f,onProgress:p}=o;p?.({phase:"saving",message:"Saving allocations..."});const g=await Dr(l,d,h);if(!g)throw new Error(`Month not found: ${d}/${h}`);const v=g.category_balances?.map(w=>w.category_id)??[],_=g.category_balances.map(w=>{const E=f[w.category_id]??w.allocated;return{...w,allocated:E}});for(const[w,E]of Object.entries(f))v.includes(w)||_.push({category_id:w,start_balance:0,allocated:E,spent:0,transfers:0,adjustments:0,end_balance:0});const C={...g,category_balances:_,are_allocations_finalized:!0,updated_at:new Date().toISOString()};n(l,d,h,C),p?.({phase:"recalculating",message:"Recalculating month balances..."});try{await r(l,d,h)}catch(w){console.warn("[useFinalizeAllocations] Failed to recalculate month and cascade:",w)}if(t.type==="month"&&t.year===d&&t.month===h)try{await e(l,"month",d,h)}catch(w){console.warn("[useFinalizeAllocations] Failed to save current document immediately:",w)}return p?.({phase:"complete",message:"Allocations applied!"}),{updatedMonth:C}},isPending:!1,isError:!1,error:null}}function rA(){const{currentViewingDocument:t}=Xe(),{saveCurrentDocument:e}=Rn(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=br();return{deleteAllocations:async o=>{const{budgetId:l,year:d,month:h,onProgress:f}=o;f?.({phase:"saving",message:"Deleting allocations..."});const p=await Dr(l,d,h);if(!p)throw new Error(`Month not found: ${d}/${h}`);const g=p.category_balances.map(C=>({...C,allocated:0})),v={...p,category_balances:g,are_allocations_finalized:!1,updated_at:new Date().toISOString()};n(l,d,h,v),f?.({phase:"recalculating",message:"Recalculating month balances..."});try{await r(l,d,h)}catch(C){console.warn("[useDeleteAllocations] Failed to recalculate month and cascade:",C)}if(t.type==="month"&&t.year===d&&t.month===h)try{await e(l,"month",d,h)}catch(C){console.warn("[useDeleteAllocations] Failed to save current document immediately:",C)}return f?.({phase:"complete",message:"Allocations deleted!"}),{updatedMonth:v}},isPending:!1,isError:!1,error:null}}async function jm(t,e,n){const r=e.trim();if(!r||n.includes(r))return null;const i=[...n,r].sort((o,l)=>o.toLowerCase().localeCompare(l.toLowerCase()));return await or("payees",t,{budget_id:t,payees:i,updated_at:new Date().toISOString()},`adding new payee "${r}" to autocomplete list`),i}function $P(t,e){const n={id:e,amount:t.amount,account_id:t.accountId,date:t.date,created_at:new Date().toISOString()};return t.payee?.trim()&&(n.payee=t.payee.trim()),t.description&&(n.description=t.description),n}function qP(){const t=$t(),{currentViewingDocument:e}=Xe(),{saveCurrentDocument:n}=Rn(),{updateMonthCacheAndTrack:r,recalculateMonthAndCascade:i,trackChange:o}=br(),l=Wn({onMutate:async h=>{const{budgetId:f,year:p,month:g}=h,v=Te.month(f,p,g);await t.cancelQueries({queryKey:v});const _=t.getQueryData(v),C=`income_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,x=$P(h,C);if(_?.month){const E={..._.month,income:[..._.month.income||[],x],updated_at:new Date().toISOString()};r(f,p,g,E)}try{await i(f,p,g)}catch(E){console.warn("[useAddIncome] Failed to recalculate month and cascade:",E)}if(h.payee?.trim()){const E=t.getQueryData(Te.payees(f))||[],T=await jm(f,h.payee,E);T&&(t.setQueryData(Te.payees(f),T),o({type:"payees",budgetId:f}))}if(e.type==="month"&&e.year===p&&e.month===g)try{await n(f,"month",p,g)}catch(E){console.warn("[useAddIncome] Failed to save current document immediately:",E)}return{previousData:_,incomeId:C,newIncome:x}},mutationFn:async h=>{const{budgetId:f,year:p,month:g}=h,v=Te.month(f,p,g),_=t.getQueryData(v);if(!_?.month)throw new Error("No month data in cache after optimistic update");const C=_.month,x=C.income?.[C.income.length-1];if(!x)throw new Error("Could not find new income in updated month");return{updatedMonth:C,newIncome:x}},onError:(h,f,p)=>{if(p?.previousData){const{budgetId:g,year:v,month:_}=f;t.setQueryData(Te.month(g,v,_),p.previousData)}}});return{addIncome:async(h,f,p,g,v,_,C,x)=>l.mutateAsync({budgetId:h,year:f,month:p,amount:g,accountId:v,date:_,payee:C,description:x}),isPending:l.isPending,isError:l.isError,error:l.error}}function HP(t,e,n,r,i,o){if(!t)return!0;const l=t.payee||void 0,d=i?.trim()||void 0,h=t.description||void 0,f=o||void 0;return e!==t.amount||n!==t.account_id||r!==t.date||d!==l||f!==h}function GP(){const t=$t(),{currentViewingDocument:e}=Xe(),{saveCurrentDocument:n}=Rn(),{updateMonthCacheAndTrack:r,recalculateMonthAndCascade:i,trackChange:o}=br();return{updateIncome:async(d,h,f,p,g,v,_,C,x)=>{const w=await Dr(d,h,f);if(!w)throw new Error(`Month not found: ${h}/${f}`);const E=(w.income||[]).find($=>$.id===p);if(!HP(E,g,v,_,C,x))return{updatedMonth:w,noOp:!0};const T={id:p,amount:g,account_id:v,date:_,created_at:(w.income||[]).find($=>$.id===p)?.created_at||new Date().toISOString()};C?.trim()&&(T.payee=C.trim()),x&&(T.description=x);const R=(w.income||[]).map($=>$.id===p?T:$),M={...w,income:R,updated_at:new Date().toISOString()};r(d,h,f,M);try{await i(d,h,f)}catch($){console.warn("[useUpdateIncome] Failed to recalculate month and cascade:",$)}if(C?.trim()){const $=t.getQueryData(Te.payees(d))||[],I=await jm(d,C,$);I&&(t.setQueryData(Te.payees(d),I),o({type:"payees",budgetId:d}))}if(e.type==="month"&&e.year===h&&e.month===f)try{await n(d,"month",h,f)}catch($){console.warn("[useUpdateIncome] Failed to save current document immediately:",$)}return{updatedMonth:M}},isPending:!1,isError:!1,error:null}}function WP(){const{currentViewingDocument:t}=Xe(),{saveCurrentDocument:e}=Rn(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=br();return{deleteIncome:async(o,l,d,h)=>{const f=await Dr(o,l,d);if(!f)throw new Error(`Month not found: ${l}/${d}`);const p=(f.income||[]).filter(_=>_.id!==h),g={...f,income:p,updated_at:new Date().toISOString()};n(o,l,d,g);try{await r(o,l,d)}catch(_){console.warn("[useDeleteIncome] Failed to recalculate month and cascade:",_)}if(t.type==="month"&&t.year===l&&t.month===d)try{await e(o,"month",l,d)}catch(_){console.warn("[useDeleteIncome] Failed to save current document immediately:",_)}return{updatedMonth:g}},isPending:!1,isError:!1,error:null}}function QP(t,e){const n={id:e,amount:t.amount,category_id:t.categoryId,account_id:t.accountId,date:t.date,created_at:new Date().toISOString()};return t.payee?.trim()&&(n.payee=t.payee.trim()),t.description&&(n.description=t.description),t.cleared!==void 0&&(n.cleared=t.cleared),n}function KP(){const t=$t(),{currentViewingDocument:e}=Xe(),{saveCurrentDocument:n}=Rn(),{updateMonthCacheAndTrack:r,recalculateMonthAndCascade:i,trackChange:o}=br(),l=Wn({onMutate:async h=>{const{budgetId:f,year:p,month:g}=h,v=Te.month(f,p,g);await t.cancelQueries({queryKey:v});const _=t.getQueryData(v),C=`expense_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,x=QP(h,C);if(_?.month){const E={..._.month,expenses:[..._.month.expenses||[],x],updated_at:new Date().toISOString()};r(f,p,g,E)}try{await i(f,p,g)}catch(E){console.warn("[useAddExpense] Failed to recalculate month and cascade:",E)}if(h.payee?.trim()){const E=t.getQueryData(Te.payees(f))||[],T=await jm(f,h.payee,E);T&&(t.setQueryData(Te.payees(f),T),o({type:"payees",budgetId:f}))}if(e.type==="month"&&e.year===p&&e.month===g)try{await n(f,"month",p,g)}catch(E){console.warn("[useAddExpense] Failed to save current document immediately:",E)}return{previousData:_,expenseId:C,newExpense:x}},mutationFn:async h=>{const{budgetId:f,year:p,month:g}=h,v=Te.month(f,p,g),_=t.getQueryData(v);if(!_?.month)throw new Error("No month data in cache after optimistic update");const C=_.month,x=C.expenses?.[C.expenses.length-1];if(!x)throw new Error("Could not find new expense in updated month");return{updatedMonth:C,newExpense:x}},onError:(h,f,p)=>{if(p?.previousData){const{budgetId:g,year:v,month:_}=f;t.setQueryData(Te.month(g,v,_),p.previousData)}}});return{addExpense:async(h,f,p,g,v,_,C,x,w,E)=>l.mutateAsync({budgetId:h,year:f,month:p,amount:g,categoryId:v,accountId:_,date:C,payee:x,description:w,cleared:E}),isPending:l.isPending,isError:l.isError,error:l.error}}function YP(t,e,n,r,i,o,l,d){if(!t)return!0;const h=t.payee||void 0,f=o?.trim()||void 0,p=t.description||void 0,g=l||void 0;return e!==t.amount||n!==t.category_id||r!==t.account_id||i!==t.date||f!==h||g!==p||d!==t.cleared}function XP(){const t=$t(),{currentViewingDocument:e}=Xe(),{saveCurrentDocument:n}=Rn(),{updateMonthCacheAndTrack:r,recalculateMonthAndCascade:i}=br();return{updateExpense:async(l,d,h,f,p,g,v,_,C,x,w)=>{const E=await Dr(l,d,h);if(!E)throw new Error(`Month not found: ${d}/${h}`);const T=(E.expenses||[]).find(I=>I.id===f);if(!YP(T,p,g,v,_,C,x,w))return{updatedMonth:E,noOp:!0};const R={id:f,amount:p,category_id:g,account_id:v,date:_,created_at:E.expenses?.find(I=>I.id===f)?.created_at||new Date().toISOString()};C?.trim()&&(R.payee=C.trim()),x&&(R.description=x),w!==void 0&&(R.cleared=w);const M=(E.expenses||[]).map(I=>I.id===f?R:I),V={...E,expenses:M,updated_at:new Date().toISOString()};r(l,d,h,V);try{await i(l,d,h)}catch(I){console.warn("[useUpdateExpense] Failed to recalculate month and cascade:",I)}if(C?.trim()){const I=t.getQueryData(Te.payees(l))||[],D=await jm(l,C,I);D&&t.setQueryData(Te.payees(l),D)}if(e.type==="month"&&e.year===d&&e.month===h)try{await n(l,"month",d,h)}catch(I){console.warn("[useUpdateExpense] Failed to save current document immediately:",I)}return{updatedMonth:V}},isPending:!1,isError:!1,error:null}}function ZP(){const{currentViewingDocument:t}=Xe(),{saveCurrentDocument:e}=Rn(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=br();return{deleteExpense:async(o,l,d,h)=>{const f=await Dr(o,l,d);if(!f)throw new Error(`Month not found: ${l}/${d}`);const p=(f.expenses||[]).filter(_=>_.id!==h),g={...f,expenses:p,updated_at:new Date().toISOString()};n(o,l,d,g);try{await r(o,l,d)}catch(_){console.warn("[useDeleteExpense] Failed to recalculate month and cascade:",_)}if(t.type==="month"&&t.year===l&&t.month===d)try{await e(o,"month",l,d)}catch(_){console.warn("[useDeleteExpense] Failed to save current document immediately:",_)}return{updatedMonth:g}},isPending:!1,isError:!1,error:null}}function JP(t,e){const n={id:e,amount:t.amount,from_account_id:t.fromAccountId,to_account_id:t.toAccountId,from_category_id:t.fromCategoryId,to_category_id:t.toCategoryId,date:t.date,created_at:new Date().toISOString()};return t.description&&(n.description=t.description),t.cleared!==void 0&&(n.cleared=t.cleared),n}function eB(){const t=$t(),{currentViewingDocument:e}=Xe(),{saveCurrentDocument:n}=Rn(),{updateMonthCacheAndTrack:r,recalculateMonthAndCascade:i}=br(),o=Wn({onMutate:async d=>{const{budgetId:h,year:f,month:p}=d,g=Te.month(h,f,p);await t.cancelQueries({queryKey:g});const v=t.getQueryData(g),_=`transfer_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,C=JP(d,_);if(v?.month){const w={...v.month,transfers:[...v.month.transfers||[],C],updated_at:new Date().toISOString()};r(h,f,p,w)}try{await i(h,f,p)}catch(w){console.warn("[useAddTransfer] Failed to recalculate month and cascade:",w)}if(e.type==="month"&&e.year===f&&e.month===p)try{await n(h,"month",f,p)}catch(w){console.warn("[useAddTransfer] Failed to save current document immediately:",w)}return{previousData:v,transferId:_,newTransfer:C}},mutationFn:async d=>{const{budgetId:h,year:f,month:p}=d,g=Te.month(h,f,p),v=t.getQueryData(g);if(!v?.month)throw new Error("No month data in cache after optimistic update");const _=v.month,C=_.transfers?.[_.transfers.length-1];if(!C)throw new Error("Could not find new transfer in updated month");return{updatedMonth:_,newTransfer:C}},onError:(d,h,f)=>{if(f?.previousData){const{budgetId:p,year:g,month:v}=h;t.setQueryData(Te.month(p,g,v),f.previousData)}}});return{addTransfer:async(d,h,f,p,g,v,_,C,x,w,E)=>o.mutateAsync({budgetId:d,year:h,month:f,amount:p,fromAccountId:g,toAccountId:v,fromCategoryId:_,toCategoryId:C,date:x,description:w,cleared:E}),isPending:o.isPending,isError:o.isError,error:o.error}}function tB(t,e,n,r,i,o,l,d,h){if(!t)return!0;const f=t.description||void 0,p=d||void 0;return e!==t.amount||n!==t.from_account_id||r!==t.to_account_id||i!==t.from_category_id||o!==t.to_category_id||l!==t.date||p!==f||h!==t.cleared}function nB(){const{currentViewingDocument:t}=Xe(),{saveCurrentDocument:e}=Rn(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=br();return{updateTransfer:async(o,l,d,h,f,p,g,v,_,C,x,w)=>{const E=await Dr(o,l,d);if(!E)throw new Error(`Month not found: ${l}/${d}`);const T=(E.transfers||[]).find(I=>I.id===h);if(!tB(T,f,p,g,v,_,C,x,w))return{updatedMonth:E,noOp:!0};const R={id:h,amount:f,from_account_id:p,to_account_id:g,from_category_id:v,to_category_id:_,date:C,created_at:E.transfers?.find(I=>I.id===h)?.created_at||new Date().toISOString()};x&&(R.description=x),w!==void 0&&(R.cleared=w);const M=(E.transfers||[]).map(I=>I.id===h?R:I),V={...E,transfers:M,updated_at:new Date().toISOString()};n(o,l,d,V);try{await r(o,l,d)}catch(I){console.warn("[useUpdateTransfer] Failed to recalculate month and cascade:",I)}if(t.type==="month"&&t.year===l&&t.month===d)try{await e(o,"month",l,d)}catch(I){console.warn("[useUpdateTransfer] Failed to save current document immediately:",I)}return{updatedMonth:V}},isPending:!1,isError:!1,error:null}}function rB(){const{currentViewingDocument:t}=Xe(),{saveCurrentDocument:e}=Rn(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=br();return{deleteTransfer:async(o,l,d,h)=>{const f=await Dr(o,l,d);if(!f)throw new Error(`Month not found: ${l}/${d}`);const p=(f.transfers||[]).filter(_=>_.id!==h),g={...f,transfers:p,updated_at:new Date().toISOString()};n(o,l,d,g);try{await r(o,l,d)}catch(_){console.warn("[useDeleteTransfer] Failed to recalculate month and cascade:",_)}if(t.type==="month"&&t.year===l&&t.month===d)try{await e(o,"month",l,d)}catch(_){console.warn("[useDeleteTransfer] Failed to save current document immediately:",_)}return{updatedMonth:g}},isPending:!1,isError:!1,error:null}}function sB(t,e){const n={id:e,amount:t.amount,account_id:t.accountId,category_id:t.categoryId,date:t.date,created_at:new Date().toISOString()};return t.payee?.trim()&&(n.payee=t.payee.trim()),t.description&&(n.description=t.description),t.cleared!==void 0&&(n.cleared=t.cleared),n}function iB(){const t=$t(),{currentViewingDocument:e}=Xe(),{saveCurrentDocument:n}=Rn(),{updateMonthCacheAndTrack:r,recalculateMonthAndCascade:i}=br(),o=Wn({onMutate:async d=>{const{budgetId:h,year:f,month:p}=d,g=Te.month(h,f,p);await t.cancelQueries({queryKey:g});const v=t.getQueryData(g),_=`adjustment_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,C=sB(d,_);if(v?.month){const w={...v.month,adjustments:[...v.month.adjustments||[],C],updated_at:new Date().toISOString()};r(h,f,p,w)}try{await i(h,f,p)}catch(w){console.warn("[useAddAdjustment] Failed to recalculate month and cascade:",w)}if(e.type==="month"&&e.year===f&&e.month===p)try{await n(h,"month",f,p)}catch(w){console.warn("[useAddAdjustment] Failed to save current document immediately:",w)}return{previousData:v,adjustmentId:_,newAdjustment:C}},mutationFn:async d=>{const{budgetId:h,year:f,month:p}=d,g=Te.month(h,f,p),v=t.getQueryData(g);if(!v?.month)throw new Error("No month data in cache after optimistic update");const _=v.month,C=_.adjustments?.[_.adjustments.length-1];if(!C)throw new Error("Could not find new adjustment in updated month");return{updatedMonth:_,newAdjustment:C}},onError:(d,h,f)=>{if(f?.previousData){const{budgetId:p,year:g,month:v}=h;t.setQueryData(Te.month(p,g,v),f.previousData)}}});return{addAdjustment:async(d,h,f,p,g,v,_,C,x,w)=>o.mutateAsync({budgetId:d,year:h,month:f,amount:p,accountId:g,categoryId:v,date:_,payee:C,description:x,cleared:w}),isPending:o.isPending,isError:o.isError,error:o.error}}function aB(t,e,n,r,i,o,l,d){if(!t)return!0;const h=t.payee||void 0,f=o?.trim()||void 0,p=t.description||void 0,g=l||void 0;return e!==t.amount||n!==t.account_id||r!==t.category_id||i!==t.date||f!==h||g!==p||d!==t.cleared}function oB(){const{currentViewingDocument:t}=Xe(),{saveCurrentDocument:e}=Rn(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=br();return{updateAdjustment:async(o,l,d,h,f,p,g,v,_,C,x)=>{const w=await Dr(o,l,d);if(!w)throw new Error(`Month not found: ${l}/${d}`);const E=(w.adjustments||[]).find($=>$.id===h);if(!aB(E,f,p,g,v,_,C,x))return{updatedMonth:w,noOp:!0};const T={id:h,amount:f,account_id:p,category_id:g,date:v,created_at:w.adjustments?.find($=>$.id===h)?.created_at||new Date().toISOString()};_?.trim()&&(T.payee=_.trim()),C&&(T.description=C),x!==void 0&&(T.cleared=x);const R=(w.adjustments||[]).map($=>$.id===h?T:$),M={...w,adjustments:R,updated_at:new Date().toISOString()};n(o,l,d,M);try{await r(o,l,d)}catch($){console.warn("[useUpdateAdjustment] Failed to recalculate month and cascade:",$)}if(t.type==="month"&&t.year===l&&t.month===d)try{await e(o,"month",l,d)}catch($){console.warn("[useUpdateAdjustment] Failed to save current document immediately:",$)}return{updatedMonth:M}},isPending:!1,isError:!1,error:null}}function lB(){const{currentViewingDocument:t}=Xe(),{saveCurrentDocument:e}=Rn(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=br();return{deleteAdjustment:async(o,l,d,h)=>{const f=await Dr(o,l,d);if(!f)throw new Error(`Month not found: ${l}/${d}`);const p=(f.adjustments||[]).filter(_=>_.id!==h),g={...f,adjustments:p,updated_at:new Date().toISOString()};n(o,l,d,g);try{await r(o,l,d)}catch(_){console.warn("[useDeleteAdjustment] Failed to recalculate month and cascade:",_)}if(t.type==="month"&&t.year===l&&t.month===d)try{await e(o,"month",l,d)}catch(_){console.warn("[useDeleteAdjustment] Failed to save current document immediately:",_)}return{updatedMonth:g}},isPending:!1,isError:!1,error:null}}function cB({budgetId:t,enabled:e,initialDataLoadComplete:n,months:r}){const{addLoadingHold:i,removeLoadingHold:o}=On(),{updateAccounts:l}=UT(),{updateCategories:d}=FT(),h=k.useRef(!1);k.useEffect(()=>{if(!e||!t||!n||r.length===0||h.current)return;h.current=!0,(async()=>{try{i("initial-balance-calculation","Calculating balances...");const p=Be.getQueryData(Te.budget(t));if(!p){console.warn("[useInitialBalanceCalculation] No budget data in cache"),o("initial-balance-calculation");return}const{budget:g,accounts:v,categories:_}=p,C=Object.keys(_),x=[...r].sort((Q,te)=>Q.year!==te.year?Q.year-te.year:Q.month-te.month),w=U0(),E=et(w.year,w.month),T=x[0],R=T?et(T.year,T.month):null;let M=null;R&&R<=E?M=x.find(Q=>et(Q.year,Q.month)===E)||null:M=await Hu(t,w.year,w.month);let V=!1;M&&(V=(M.category_balances||[]).some(Q=>!Je(Q.category_id)&&Q.start_balance!==0)||(M.account_balances||[]).some(Q=>!We(Q.account_id)&&Q.start_balance!==0));let $=vm;const I=[];if(!V&&M){let Q=w.year,te=w.month,z=!1;const H=120;for(let re=0;re<H&&!z;re++){const ne=gc(Q,te);Q=ne.year,te=ne.month;const ie=await Hu(t,Q,te);if(!ie)z=!0;else if((ie.category_balances||[]).some(Ce=>!Je(Ce.category_id)&&Ce.start_balance!==0)||(ie.account_balances||[]).some(Ce=>!We(Ce.account_id)&&Ce.start_balance!==0)){z=!0;const Ce={},ce={};for(const ge of ie.category_balances||[])Je(ge.category_id)||(Ce[ge.category_id]=Me(ge.end_balance??0));for(const ge of ie.account_balances||[])We(ge.account_id)||(ce[ge.account_id]=Me(ge.end_balance??0));$={categoryEndBalances:Ce,accountEndBalances:ce,totalIncome:Me(ie.total_income??0)}}else I.push(ie)}I.reverse();for(const re of I){const ne=Gu(re,$);if($=tc(ne),ym(re.year,re.month)){const ie=bm(ne);await H0({budgetId:t,month:ie,description:`initial balance calculation: ensuring start_balance for ${re.year}/${re.month}`,cascadeRecalculation:!1})}}}else if(T){const Q={},te={};for(const z of T.category_balances||[])Je(z.category_id)||(Q[z.category_id]=Me(z.start_balance??0));for(const z of T.account_balances||[])We(z.account_id)||(te[z.account_id]=Me(z.start_balance??0));$={categoryEndBalances:Q,accountEndBalances:te,totalIncome:Me(T.previous_month_income??0)}}const D=[];for(const Q of x){const te=Gu(Q,$);D.push(te),$=tc(te)}const P=$.accountEndBalances,L=$.categoryEndBalances,q=D.length>0?D[D.length-1]:x.length>0?x[x.length-1]:null;let A;q?A=await q0(t,C,L,q.year,q.month):(A={},C.forEach(Q=>{A[Q]=0}));const O={};Object.entries(v).forEach(([Q,te])=>{O[Q]={...te,balance:P[Q]??0}});const N={};Object.entries(_).forEach(([Q,te])=>{N[Q]={...te,balance:A[Q]??0}});const J=g.month_map||{},Y=new Set(x.map(Q=>et(Q.year,Q.month))),G={};for(const Q of Object.keys(J))Y.has(Q)?G[Q]={}:G[Q]=J[Q];for(const Q of x){const te=et(Q.year,Q.month);te in G||(G[te]={})}for(const Q of D)Be.setQueryData(Te.month(t,Q.year,Q.month),{month:Q});if(JSON.stringify(g.month_map)!==JSON.stringify(G)){i("initial-balance-calculation","Saving month map...");const{writeBudgetData:Q}=await $0(async()=>{const{writeBudgetData:te}=await Promise.resolve().then(()=>VT);return{writeBudgetData:te}},void 0);await Q({budgetId:t,updates:{month_map:G},description:"initial balance calculation: updating month_map"})}Be.setQueryData(Te.budget(t),{...p,budget:{...g,month_map:G},accounts:O,categories:N})}catch(p){const g=p instanceof Error?p.message:"Failed to calculate initial balances";console.error("[useInitialBalanceCalculation] Error calculating balances:",p),qn.add({type:"error",message:`Initial balance calculation failed: ${g}`,autoDismissMs:1e4})}finally{o("initial-balance-calculation")}})()},[e,t,n,r,i,o,l,d]),k.useEffect(()=>{t||(h.current=!1)},[t])}const uB={currentUserId:null,selectedBudgetId:null,currentYear:new Date().getFullYear(),currentMonthNumber:new Date().getMonth()+1,lastActiveTab:"categories",lastSettingsTab:"categories",lastAdminTab:"budget",currentViewingDocument:{type:null},setCurrentViewingDocument:()=>{},setSelectedBudgetId:()=>{},setCurrentYear:()=>{},setCurrentMonthNumber:()=>{},setLastActiveTab:()=>{},setLastSettingsTab:()=>{},setLastAdminTab:()=>{},pageTitle:"Budget",setPageTitle:()=>{},isInitialized:!1,needsFirstBudget:!1,initialDataLoadComplete:!1,goToPreviousMonth:()=>{},goToNextMonth:()=>{},pendingInvites:[],hasPendingInvites:!1,accessibleBudgets:[],isAdmin:!1,isTest:!1,loadAccessibleBudgets:async()=>{},switchToBudget:()=>{},checkBudgetInvite:async()=>null,clearCache:()=>{}},sA=k.createContext(uB);function dB({children:t}){const n=za().get_current_firebase_user(),[r,i]=k.useState(null),[o,l]=k.useState(new Date().getFullYear()),[d,h]=k.useState(new Date().getMonth()+1),[f,p]=k.useState("categories"),[g,v]=k.useState("categories"),[_,C]=k.useState("budget"),[x,w]=k.useState("Budget"),E=k.useCallback(be=>{w(Ce=>Ce===be?Ce:be)},[]),[T,R]=k.useState({type:null}),[M,V]=k.useState(!1),[$,I]=k.useState(!1),D=m4(n?.uid||null,n?.email||null),P=D.data&&D.data.budget_ids.length===0,L=g4(n?.uid||null,D.data||null,{enabled:!!n?.uid&&!!D.data&&P}),q=p3(r,{enabled:!!r&&M}),[A,O]=k.useState(!1);k.useEffect(()=>{if(!q.data){O(!1);return}const{budget:be,payees:Ce,months:ce}=q.data,ge=Date.now();Be.setQueryData(Te.budget(r),be,{updatedAt:ge}),Be.setQueryData(Te.payees(r),Ce,{updatedAt:ge});for(const Oe of ce)Be.setQueryData(Te.month(r,Oe.year,Oe.month),{month:Oe},{updatedAt:ge});O(!0)},[q.data,r]),cB({budgetId:r,enabled:!!r&&M&&A,initialDataLoadComplete:A,months:q.data?.months||[]}),k.useEffect(()=>{r||O(!1)},[r]);const N=D.data?.permission_flags?.is_admin===!0,J=D.data?.permission_flags?.is_test===!0,Y=L.data?.pendingInvites||[],G=L.data?.budgets||[],Z=Y.length>0;k.useEffect(()=>{if(!n||M||D.isLoading)return;const be=D.data;if(!(!be&&!D.isError))if(be&&be.budget_ids.length>0)i(be.budget_ids[0]),I(!1),V(!0);else{if(L.isLoading)return;const Ce=L.data;I(!(Ce?.pendingInvites&&Ce.pendingInvites.length>0)),V(!0)}},[n,M,D.data,D.isLoading,D.isError,L.data,L.isLoading]);const Q=k.useCallback(()=>{d===1?(l(be=>be-1),h(12)):h(be=>be-1)},[d]),te=k.useCallback(()=>{d===12?(l(be=>be+1),h(1)):h(be=>be+1)},[d]),z=k.useCallback(async be=>{(be?.force||!L.data)&&await L.refetch()},[L]),H=k.useCallback(be=>{i(be),I(!1)},[]),re=k.useCallback(async be=>{if(!n)return null;try{const Ce=await E4(be,n.uid);return Ce&&Ce.isInvited&&!Ce.hasAccepted?{budgetId:be,budgetName:Ce.budgetName,ownerEmail:Ce.ownerEmail}:null}catch(Ce){return console.error("[BudgetContext] Error checking budget invite:",Ce),null}},[n]),ne=k.useCallback(()=>{Be.clear()},[]),ie={currentUserId:n?.uid||null,selectedBudgetId:r,currentYear:o,currentMonthNumber:d,lastActiveTab:f,lastSettingsTab:g,lastAdminTab:_,currentViewingDocument:T,setCurrentViewingDocument:R,setSelectedBudgetId:i,setCurrentYear:l,setCurrentMonthNumber:h,setLastActiveTab:p,setLastSettingsTab:v,setLastAdminTab:C,pageTitle:x,setPageTitle:E,isInitialized:M,needsFirstBudget:$,initialDataLoadComplete:A,goToPreviousMonth:Q,goToNextMonth:te,pendingInvites:Y,hasPendingInvites:Z,accessibleBudgets:G,isAdmin:N,isTest:J,loadAccessibleBudgets:z,switchToBudget:H,checkBudgetInvite:re,clearCache:ne};return u.jsx(sA.Provider,{value:ie,children:t})}function Xe(){const t=k.useContext(sA);if(!t)throw new Error("useBudget must be used within a BudgetProvider");return t}const hB=function(){},fB={is_logged_in:!1,is_auth_checked:!1,username:"",set_user_context:hB},md=k.createContext(fB);function $1({budget:t,isCurrent:e,isAccepting:n,isSwitching:r,isEditing:i,editName:o,isRenaming:l,onAccept:d,onSwitch:h,onStartEdit:f,onCancelEdit:p,onEditNameChange:g,onSaveEdit:v}){const _=e&&t.isOwner;return u.jsx("div",{style:{background:e?"color-mix(in srgb, #646cff 15%, transparent)":"color-mix(in srgb, currentColor 8%, transparent)",border:e?"2px solid color-mix(in srgb, #646cff 50%, transparent)":"1px solid transparent",padding:"1rem",borderRadius:"8px"},children:i?u.jsxs("form",{onSubmit:v,children:[u.jsx("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"0.5rem"},children:u.jsx("input",{type:"text",value:o,onChange:C=>g(C.target.value),placeholder:"Budget name",autoFocus:!0,style:{flex:1,padding:"0.5rem 0.75rem",borderRadius:"6px",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"1rem",fontWeight:600,color:"inherit"}})}),u.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[u.jsx("button",{type:"submit",disabled:l||!o.trim(),style:{background:"#22c55e",color:"white",border:"none",padding:"0.4rem 0.75rem",borderRadius:"6px",cursor:l||!o.trim()?"not-allowed":"pointer",fontWeight:500,opacity:l||!o.trim()?.7:1,fontSize:"0.8rem"},children:l?"Saving...":"Save"}),u.jsx("button",{type:"button",onClick:p,disabled:l,style:{background:"transparent",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)",padding:"0.4rem 0.75rem",borderRadius:"6px",cursor:l?"not-allowed":"pointer",fontWeight:500,opacity:l?.7:.8,fontSize:"0.8rem"},children:"Cancel"})]})]}):u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem",flexWrap:"wrap"},children:[u.jsxs("div",{style:{flex:1,minWidth:"200px"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flexWrap:"wrap",marginBottom:"0.25rem"},children:[u.jsx("span",{style:{fontWeight:600},children:t.name}),t.isOwner&&u.jsx("span",{style:{background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.65rem",textTransform:"uppercase",fontWeight:600},children:"Owner"}),e&&u.jsx("span",{style:{background:"color-mix(in srgb, #22c55e 20%, transparent)",color:"#4ade80",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.65rem",textTransform:"uppercase",fontWeight:600},children:"Active"}),t.isPending&&u.jsx("span",{style:{background:"color-mix(in srgb, #f59e0b 20%, transparent)",color:"#fbbf24",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.65rem",textTransform:"uppercase",fontWeight:600},children:"Pending"}),_&&u.jsx("button",{onClick:f,style:{background:"transparent",border:"none",padding:"0.15rem",cursor:"pointer",opacity:.5,fontSize:"0.8rem",lineHeight:1},title:"Rename budget",children:""})]}),u.jsx("p",{style:{margin:0,fontSize:"0.8rem",opacity:.6},children:t.ownerEmail?`Owner: ${t.ownerEmail}`:`ID: ${t.id}`})]}),u.jsx("div",{style:{display:"flex",gap:"0.5rem"},children:t.isPending?u.jsx("button",{onClick:d,disabled:n,style:{background:"#22c55e",color:"white",border:"none",padding:"0.5rem 1rem",borderRadius:"6px",cursor:n?"not-allowed":"pointer",fontWeight:500,opacity:n?.7:1,fontSize:"0.85rem"},children:n?"Accepting...":"Accept"}):e?null:u.jsx("button",{onClick:h,disabled:r,style:{background:"#646cff",color:"white",border:"none",padding:"0.5rem 1rem",borderRadius:"6px",cursor:r?"not-allowed":"pointer",fontWeight:500,opacity:r?.7:1,fontSize:"0.85rem"},children:r?"Switching...":"Switch"})})]})})}const Bf={critical_bug:{label:"Critical Bug",color:"#ff4757",bgColor:"rgba(255, 71, 87, 0.15)"},bug:{label:"Bug",color:"#ffa502",bgColor:"rgba(255, 165, 2, 0.15)"},new_feature:{label:"New Feature",color:"#2ed573",bgColor:"rgba(46, 213, 115, 0.15)"},core_feature:{label:"Core Feature",color:"#1e90ff",bgColor:"rgba(30, 144, 255, 0.15)"},qol:{label:"QOL",color:"#a55eea",bgColor:"rgba(165, 94, 234, 0.15)"}};function iA({type:t,onClick:e}){const n=t==="feature"?"new_feature":t,r=n&&n in Bf?n:"bug",i=Bf[r];return u.jsx("button",{type:"button",onClick:e,style:{padding:"0.25rem 0.5rem",borderRadius:"0.25rem",background:i.bgColor,color:i.color,fontSize:"0.7rem",fontWeight:600,textTransform:"uppercase",letterSpacing:"0.025em",flexShrink:0,border:"none",cursor:"pointer",transition:"opacity 0.15s, transform 0.15s"},onMouseEnter:o=>{o.currentTarget.style.opacity="0.8",o.currentTarget.style.transform="scale(1.05)"},onMouseLeave:o=>{o.currentTarget.style.opacity="1",o.currentTarget.style.transform="scale(1)"},title:"Click to change type",children:i.label})}function mB({item:t,isDragging:e,isDragOver:n,onDragStart:r,onDragOver:i,onDragLeave:o,onDragEnd:l,onDrop:d,onToggleDone:h,onTypeClick:f}){return u.jsxs("div",{onDragOver:p=>{p.stopPropagation(),i(p)},onDragLeave:p=>{p.stopPropagation(),o()},onDrop:p=>{p.stopPropagation(),d(p)},style:{position:"relative"},children:[u.jsx("div",{style:{...$4,opacity:n?1:0,boxShadow:n?"0 0 8px rgba(100, 108, 255, 0.6)":"none"}}),u.jsxs("div",{draggable:!0,onDragStart:r,onDragEnd:l,style:{...G0,cursor:"grab",opacity:e?.5:1,flexDirection:"column",alignItems:"stretch",gap:"0.5rem"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[u.jsx("span",{style:{...V4},children:""}),u.jsx("input",{type:"checkbox",checked:t.is_done,onChange:h,style:{width:"1.25rem",height:"1.25rem",cursor:"pointer",accentColor:fe.primary,flexShrink:0}}),u.jsx(iA,{type:t.feedback_type,onClick:f})]}),u.jsxs("div",{style:{marginLeft:"3.25rem"},children:[u.jsx("p",{style:{margin:0,lineHeight:1.5},children:t.text}),u.jsxs("p",{style:{margin:"0.5rem 0 0 0",fontSize:"0.8rem",opacity:.6},children:[t.user_email,"  ",Ny(t.created_at)]})]})]})]})}function pB({item:t,onToggleDone:e,onTypeClick:n}){return u.jsxs("div",{style:{...G0,opacity:.6,flexDirection:"column",alignItems:"stretch",gap:"0.5rem"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[u.jsx("input",{type:"checkbox",checked:t.is_done,onChange:e,style:{width:"1.25rem",height:"1.25rem",cursor:"pointer",accentColor:fe.primary,flexShrink:0}}),u.jsx(iA,{type:t.feedback_type,onClick:n})]}),u.jsxs("div",{style:{marginLeft:"2rem"},children:[u.jsx("p",{style:{margin:0,lineHeight:1.5,textDecoration:"line-through"},children:t.text}),u.jsxs("p",{style:{margin:"0.5rem 0 0 0",fontSize:"0.8rem",opacity:.8},children:[t.user_email,"  Created: ",Ny(t.created_at)]}),t.completed_at&&u.jsxs("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.8rem",color:fe.success},children:[" Completed: ",Ny(t.completed_at)]})]})]})}function Hn({noMargin:t}={}){return u.jsx("span",{style:{display:"inline-block",width:"14px",height:"14px",border:"2px solid rgba(255, 255, 255, 0.3)",borderTopColor:"white",borderRadius:"50%",animation:"spin 0.8s linear infinite",marginRight:t?0:"0.5rem",verticalAlign:"middle"}})}function aA(){const{state:t,closeModal:e}=Y0();if(!t.isOpen)return null;const n=t.isComplete;return u.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0, 0, 0, 0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1002,padding:"1rem"},onClick:n?e:void 0,children:u.jsxs("div",{style:{background:"#1a1a1a",color:"rgba(255, 255, 255, 0.87)",borderRadius:"16px",padding:"2rem",width:"32rem",maxWidth:"calc(100vw - 2rem)",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.5)"},onClick:r=>r.stopPropagation(),children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1.5rem"},children:[u.jsxs("h2",{style:{margin:0,fontSize:"1.25rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[!t.isComplete&&u.jsx(Hn,{noMargin:!0}),t.migrationName]}),n&&u.jsx("button",{onClick:e,style:{background:"transparent",border:"none",color:"inherit",cursor:"pointer",fontSize:"1.5rem",opacity:.6,lineHeight:1,padding:"0.25rem"},title:"Close",children:""})]}),u.jsxs("div",{style:{fontSize:"1rem",fontWeight:500,marginBottom:"1rem",color:t.error?"#ef4444":t.isComplete?"#22c55e":"inherit"},children:[t.error?" ":t.isComplete?" ":"",t.stage]}),u.jsx("div",{style:{background:"rgba(255, 255, 255, 0.1)",borderRadius:"8px",height:"12px",overflow:"hidden",marginBottom:"1rem"},children:t.progress!==null?u.jsx("div",{style:{background:t.error?"#ef4444":t.isComplete?"#22c55e":"#646cff",height:"100%",width:`${t.progress}%`,transition:"width 0.3s ease-out",borderRadius:"8px"}}):u.jsx("div",{style:{background:t.error?"#ef4444":"#646cff",height:"100%",width:"30%",borderRadius:"8px",animation:"progressIndeterminate 1.5s ease-in-out infinite"}})}),t.currentItem&&u.jsx("div",{style:{fontSize:"0.9rem",opacity:.8,marginBottom:"0.5rem",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:t.currentItem}),t.details&&u.jsx("div",{style:{fontSize:"0.85rem",opacity:.6,marginBottom:t.error?"1rem":0},children:t.details}),t.error&&u.jsx("div",{style:{background:"rgba(239, 68, 68, 0.1)",border:"1px solid rgba(239, 68, 68, 0.3)",borderRadius:"8px",padding:"0.75rem 1rem",fontSize:"0.9rem",color:"#ef4444"},children:t.error}),t.isComplete&&u.jsx("button",{onClick:e,style:{marginTop:"1.5rem",width:"100%",background:t.error?"rgba(239, 68, 68, 0.2)":"#646cff",color:"white",border:"none",padding:"0.75rem 1.5rem",borderRadius:"8px",cursor:"pointer",fontWeight:500,fontSize:"1rem"},children:t.error?"Close":"Done"}),!t.isComplete&&u.jsx("div",{style:{marginTop:"1rem",fontSize:"0.85rem",opacity:.5,textAlign:"center"},children:"Please wait  do not close this window"}),u.jsx("style",{children:`
            @keyframes progressIndeterminate {
              0% { transform: translateX(-100%); }
              100% { transform: translateX(400%); }
            }
          `})]})})}function To({isOpen:t,onClose:e,onConfirm:n,migrationName:r,isDestructive:i=!1,onDownloadBackup:o,isDownloading:l=!1}){const[d,h]=k.useState(!1),f=k.useCallback(async()=>{o&&(await o(),h(!0))},[o]),p=k.useCallback(()=>{n(d?"downloaded":"already-have")},[d,n]),g=k.useCallback(()=>{n("cancelled"),e()},[n,e]);return u.jsxs(hs,{isOpen:t,onClose:g,title:" Backup Recommended",children:[u.jsx("div",{style:{background:i?"color-mix(in srgb, #ef4444 15%, transparent)":"color-mix(in srgb, #f59e0b 15%, transparent)",border:`1px solid ${i?"color-mix(in srgb, #ef4444 40%, transparent)":"color-mix(in srgb, #f59e0b 40%, transparent)"}`,borderRadius:"8px",padding:"1rem",marginBottom:"1rem"},children:u.jsx("p",{style:{margin:0,color:i?"#fca5a5":"#fcd34d",fontWeight:500,fontSize:"0.95rem"},children:i?" This migration modifies your data. A backup is strongly recommended!":" Before running migrations, we recommend having a recent backup."})}),u.jsxs("p",{style:{margin:"0 0 0.75rem",opacity:.9},children:["You are about to run: ",u.jsx("strong",{children:r})]}),u.jsx("p",{style:{margin:"0 0 1rem",opacity:.8,fontSize:"0.9rem"},children:"Please ensure you have a recent backup of your data. You can download a diagnostic backup that includes all your budget and month data."}),o&&u.jsx("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",padding:"1rem",marginBottom:"1rem"},children:u.jsx(Ve,{variant:"secondary",onClick:f,disabled:l,actionName:"Download Backup Before Migration",style:{width:"100%"},children:l?u.jsxs(u.Fragment,{children:[u.jsx(Hn,{noMargin:!0})," Downloading Backup..."]}):d?" Backup Downloaded":" Download Backup Now"})}),u.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[u.jsx(Ve,{variant:"secondary",actionName:"Cancel Migration",onClick:g,children:"Cancel"}),u.jsx(Ve,{variant:i?"danger":"primary",actionName:`Proceed with ${r}`,onClick:p,disabled:l,children:d?" Proceed with Migration":" I Have a Backup - Proceed"})]})]})}function Ao({migrationName:t,isDestructive:e=!1,onDownloadBackup:n}){const[r,i]=k.useState(!1),[o,l]=k.useState(!1),[d,h]=k.useState(null),f=k.useCallback(_=>{h(()=>_),i(!0)},[]),p=k.useCallback(_=>{_!=="cancelled"&&d&&d(),h(null),i(!1)},[d]),g=k.useCallback(()=>{h(null),i(!1)},[]),v=k.useCallback(async()=>{if(n){l(!0);try{await n()}finally{l(!1)}}},[n]);return{promptBeforeAction:f,promptProps:{isOpen:r,onClose:g,onConfirm:p,migrationName:t,isDestructive:e,onDownloadBackup:n?v:void 0,isDownloading:o}}}const gB={onetime:{borderColor:"color-mix(in srgb, #a855f7 30%, transparent)",iconBg:"color-mix(in srgb, #a855f7 15%, transparent)",headerBg:"color-mix(in srgb, #a855f7 8%, transparent)"},maintenance:{borderColor:"color-mix(in srgb, #3b82f6 30%, transparent)",iconBg:"color-mix(in srgb, #3b82f6 15%, transparent)",headerBg:"color-mix(in srgb, #3b82f6 8%, transparent)"},utility:{borderColor:"color-mix(in srgb, #22c55e 30%, transparent)",iconBg:"color-mix(in srgb, #22c55e 15%, transparent)",headerBg:"color-mix(in srgb, #22c55e 8%, transparent)"}};function J0({title:t,icon:e,description:n,type:r,children:i,onValidateAll:o,isValidating:l=!1,isAnyRunning:d=!1}){const h=gB[r],f=l||d,p=()=>{o&&!f&&o()};return u.jsxs("section",{style:{background:"color-mix(in srgb, currentColor 3%, transparent)",border:`1px solid ${h.borderColor}`,borderRadius:"12px",marginBottom:"1.5rem",overflow:"hidden"},children:[u.jsxs("div",{style:{background:h.headerBg,padding:"1.25rem 1.5rem",borderBottom:`2px solid ${h.borderColor}`,display:"flex",justifyContent:"space-between",alignItems:"flex-start",gap:"1rem"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"0.875rem",flex:1},children:[u.jsx("span",{style:{fontSize:"1.75rem",background:h.iconBg,padding:"0.625rem",borderRadius:"10px",lineHeight:1,display:"flex",alignItems:"center",justifyContent:"center",minWidth:"48px",minHeight:"48px"},children:e}),u.jsxs("div",{children:[u.jsx("h3",{style:{margin:"0 0 0.375rem 0",fontSize:"1.25rem",fontWeight:600,letterSpacing:"-0.01em"},children:t}),u.jsx("p",{style:{margin:0,opacity:.75,fontSize:"0.9rem",lineHeight:1.4},children:n})]})]}),o&&u.jsx("button",{onClick:p,disabled:f,style:{background:"color-mix(in srgb, #3b82f6 20%, transparent)",color:"#60a5fa",border:"1px solid color-mix(in srgb, #3b82f6 40%, transparent)",padding:"0.5rem 1rem",borderRadius:"6px",cursor:f?"not-allowed":"pointer",fontWeight:500,fontSize:"0.85rem",opacity:f?.6:1,display:"flex",alignItems:"center",gap:"0.4rem",flexShrink:0},children:l?u.jsxs(u.Fragment,{children:[u.jsx(Hn,{noMargin:!0})," Validating..."]}):" Validate All"})]}),u.jsx("div",{style:{padding:"0.75rem",background:"color-mix(in srgb, currentColor 1%, transparent)"},children:i})]})}const yB={unknown:{color:"#9ca3af",icon:"",text:"Unknown"},clean:{color:"#22c55e",icon:"",text:"Clean"},"needs-action":{color:"#f59e0b",icon:"",text:"Needs Action"},running:{color:"#60a5fa",icon:"",text:"Running"},complete:{color:"#22c55e",icon:"",text:"Complete"},error:{color:"#ef4444",icon:"",text:"Error"}};function pd({name:t,description:e,status:n,statusText:r,onCheck:i,isChecking:o,onRun:l,isRunning:d=!1,actionText:h="Run",disabled:f=!1,itemCount:p,details:g,isDestructive:v=!1}){const[_,C]=k.useState(!1),x=yB[n],w=r||x.text,E=f||d||o,T=()=>{i()},R=()=>{l&&l()},M=()=>{g&&C(!_)};return u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"8px",margin:"0.25rem 0",overflow:"hidden"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"0.75rem 1rem",gap:"1rem"},children:[u.jsx("div",{style:{width:"28px",height:"28px",borderRadius:"50%",background:`color-mix(in srgb, ${x.color} 20%, transparent)`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.85rem",flexShrink:0},children:d||o?u.jsx(Hn,{noMargin:!0}):x.icon}),u.jsxs("div",{style:{flex:1,minWidth:0},children:[u.jsx("div",{style:{fontWeight:500,fontSize:"0.95rem",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:t}),u.jsx("div",{style:{fontSize:"0.8rem",opacity:.6,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:e})]}),u.jsxs("div",{style:{color:x.color,fontSize:"0.8rem",fontWeight:500,display:"flex",alignItems:"center",gap:"0.25rem",flexShrink:0},children:[w,p!==void 0&&p>0&&u.jsx("span",{style:{background:`color-mix(in srgb, ${x.color} 20%, transparent)`,padding:"0.15rem 0.4rem",borderRadius:"4px",fontSize:"0.75rem"},children:p})]}),u.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:[u.jsx("button",{onClick:T,disabled:E,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",padding:"0.35rem 0.6rem",borderRadius:"4px",cursor:E?"not-allowed":"pointer",fontSize:"0.8rem",opacity:E?.5:1,display:"flex",alignItems:"center",gap:"0.25rem"},title:"Check status",children:o?u.jsx(Hn,{noMargin:!0}):""}),l&&n==="needs-action"&&u.jsx("button",{onClick:R,disabled:E,style:{background:v?"#ef4444":"#646cff",color:"white",border:"none",padding:"0.35rem 0.75rem",borderRadius:"4px",cursor:E?"not-allowed":"pointer",fontSize:"0.8rem",fontWeight:500,opacity:E?.6:1,display:"flex",alignItems:"center",gap:"0.25rem"},children:d?u.jsx(Hn,{noMargin:!0}):h}),g&&u.jsx("button",{onClick:M,style:{background:"transparent",color:"inherit",border:"none",padding:"0.35rem",borderRadius:"4px",cursor:"pointer",fontSize:"0.9rem",opacity:.6},title:_?"Collapse details":"Expand details",children:_?"":""})]})]}),_&&g&&u.jsx("div",{style:{borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)",padding:"1rem",background:"color-mix(in srgb, currentColor 2%, transparent)"},children:g})]})}function _B({name:t,description:e,onAction:n,actionText:r,actionIcon:i,isRunning:o=!1,disabled:l=!1,progress:d,error:h,isDestructive:f=!1}){const p=l||o,g=()=>{n()};return u.jsx("div",{style:{background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"8px",margin:"0.25rem 0",padding:"0.75rem 1rem"},children:u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},children:[u.jsxs("div",{style:{flex:1,minWidth:0},children:[u.jsx("div",{style:{fontWeight:500,fontSize:"0.95rem",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:t}),u.jsx("div",{style:{fontSize:"0.8rem",opacity:.6,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:e}),h&&u.jsx("div",{style:{fontSize:"0.8rem",color:"#ef4444",marginTop:"0.25rem"},children:h})]}),d!==void 0&&o&&u.jsxs("div",{style:{width:"100px",flexShrink:0},children:[u.jsx("div",{style:{background:"rgba(255, 255, 255, 0.1)",borderRadius:"4px",height:"6px",overflow:"hidden"},children:u.jsx("div",{style:{background:f?"#ef4444":"#646cff",height:"100%",width:`${d}%`,transition:"width 0.3s"}})}),u.jsxs("div",{style:{fontSize:"0.7rem",opacity:.6,textAlign:"center",marginTop:"0.15rem"},children:[d,"%"]})]}),u.jsx("button",{onClick:g,disabled:p,style:{background:f?"#ef4444":"#646cff",color:"white",border:"none",padding:"0.5rem 1rem",borderRadius:"6px",cursor:p?"not-allowed":"pointer",fontSize:"0.85rem",fontWeight:500,opacity:p?.6:1,display:"flex",alignItems:"center",gap:"0.4rem",flexShrink:0},children:o?u.jsxs(u.Fragment,{children:[u.jsx(Hn,{noMargin:!0})," Running..."]}):u.jsxs(u.Fragment,{children:[i&&u.jsx("span",{children:i}),r]})})]})})}function bB(t,e,n,r,i){return r?"running":i?i.errors.length>0?"error":"complete":e?n?"needs-action":"clean":"unknown"}function vB(t,e,n,r){return e?n?`${r} month(s) need migration`:"No data to migrate":"No data scanned"}function xB(t,e,n,r,i){return t?u.jsxs("div",{style:{fontSize:"0.85rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem",fontWeight:500},children:t.errors.length>0?" Completed with errors":" Migration complete"}),u.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[t.budgetsProcessed>0&&u.jsxs("li",{children:[t.budgetsProcessed," budget(s) processed"]}),t.monthsProcessed>0&&u.jsxs("li",{children:[t.monthsProcessed," month(s) processed"]}),t.monthsUpdated>0&&u.jsxs("li",{children:[t.monthsUpdated," month(s) updated"]}),t.monthsUpdated===0&&t.monthsProcessed>0&&u.jsx("li",{children:"No months needed updates"})]}),t.errors.length>0&&u.jsxs("div",{style:{marginTop:"0.5rem",color:"#ef4444"},children:[u.jsxs("div",{children:["Errors (",t.errors.length,"):"]}),u.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1.25rem"},children:[t.errors.slice(0,3).map((o,l)=>u.jsx("li",{children:o},l)),t.errors.length>3&&u.jsxs("li",{children:["...and ",t.errors.length-3," more"]})]})]})]}):e?n?u.jsxs("div",{style:{fontSize:"0.85rem"},children:[u.jsxs("div",{style:{marginBottom:"0.25rem"},children:["Found ",i," month(s) with total_income or total_expenses fields."]}),r&&u.jsxs("div",{style:{opacity:.6,fontSize:"0.8rem"},children:[r.monthsWithTotalIncome>0&&`${r.monthsWithTotalIncome} with total_income`,r.monthsWithTotalIncome>0&&r.monthsWithTotalExpenses>0&&", ",r.monthsWithTotalExpenses>0&&`${r.monthsWithTotalExpenses} with total_expenses`]})]}):u.jsxs("div",{style:{fontSize:"0.85rem"},children:[" All months are clean.",u.jsxs("div",{style:{marginTop:"0.25rem",opacity:.6},children:["Scanned ",r.totalMonths," month(s) across ",r.totalBudgets," budget(s)."]})]}):u.jsx("div",{style:{fontSize:"0.85rem",opacity:.7},children:"Click check to scan for months with total_income or total_expenses fields."})}function wB({status:t,hasData:e,needsMigration:n,totalItemsToFix:r,isChecking:i,isRunning:o,result:l,onCheck:d,onRun:h,disabled:f}){return u.jsx(pd,{name:"Remove Total Fields Migration",description:"Removes total_income and total_expenses from month documents. These are calculated from income/expenses arrays on-the-fly.",status:bB(t,e,n,o,l),statusText:vB(t,e,n,r),isChecking:i,isRunning:o,onCheck:d,onRun:n?h:void 0,actionText:n?`Migrate ${r}`:void 0,disabled:f,itemCount:r,details:xB(l,e,n,t,r)})}function SB(t,e,n,r,i){return r?"running":i?i.errors.length>0?"error":"complete":e?n?"needs-action":"clean":"unknown"}function CB(t,e,n,r){return e?n?`${r} month(s) need migration`:"No data to migrate":"No data scanned"}function EB(t,e,n,r,i){return t?u.jsxs("div",{style:{fontSize:"0.85rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem",fontWeight:500},children:t.errors.length>0?" Completed with errors":" Migration complete"}),u.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[t.budgetsProcessed>0&&u.jsxs("li",{children:[t.budgetsProcessed," budget(s) processed"]}),t.monthsProcessed>0&&u.jsxs("li",{children:[t.monthsProcessed," month(s) processed"]}),t.monthsUpdated>0&&u.jsxs("li",{children:[t.monthsUpdated," month(s) updated"]}),t.monthsUpdated===0&&t.monthsProcessed>0&&u.jsx("li",{children:"No months needed updates"})]}),t.errors.length>0&&u.jsxs("div",{style:{marginTop:"0.5rem",color:"#ef4444"},children:[u.jsxs("div",{children:["Errors (",t.errors.length,"):"]}),u.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1.25rem"},children:[t.errors.slice(0,3).map((o,l)=>u.jsx("li",{children:o},l)),t.errors.length>3&&u.jsxs("li",{children:["...and ",t.errors.length-3," more"]})]})]})]}):e?n?u.jsxs("div",{style:{fontSize:"0.85rem"},children:[u.jsxs("div",{style:{marginBottom:"0.25rem"},children:["Found ",i," month(s) with previous_month_income field."]}),u.jsx("div",{style:{opacity:.6,fontSize:"0.8rem"},children:"This field is now calculated from the previous month's income array."})]}):u.jsxs("div",{style:{fontSize:"0.85rem"},children:[" All months are clean.",u.jsxs("div",{style:{marginTop:"0.25rem",opacity:.6},children:["Scanned ",r.totalMonths," month(s) across ",r.totalBudgets," budget(s)."]})]}):u.jsx("div",{style:{fontSize:"0.85rem",opacity:.7},children:"Click check to scan for months with previous_month_income field."})}function TB({status:t,hasData:e,needsMigration:n,totalItemsToFix:r,isChecking:i,isRunning:o,result:l,onCheck:d,onRun:h,disabled:f}){return u.jsx(pd,{name:"Remove Previous Month Income Migration",description:"Removes previous_month_income from month documents. This is calculated from the previous month's income array on-the-fly.",status:SB(t,e,n,o,l),statusText:CB(t,e,n,r),isChecking:i,isRunning:o,onCheck:d,onRun:n?h:void 0,actionText:n?`Migrate ${r}`:void 0,disabled:f,itemCount:r,details:EB(l,e,n,t,r)})}function AB({disabled:t,onDownloadBackup:e,isDownloadingBackup:n,removeTotalFieldsMigration:r,removePreviousMonthIncomeMigration:i}){const o=r.isRunning||i.isRunning;return u.jsx(u.Fragment,{children:u.jsxs(J0,{title:"One-Time Migrations",icon:"",description:"Migrations that typically only need to be run once. Check status first, then apply if needed.",type:"onetime",isAnyRunning:o,children:[u.jsx(wB,{status:r.status,hasData:r.hasData,needsMigration:r.needsMigration,totalItemsToFix:r.totalItemsToFix,isChecking:r.isScanning,isRunning:r.isRunning,result:r.result,onCheck:r.scanStatus,onRun:r.runMigration,disabled:t}),u.jsx(TB,{status:i.status,hasData:i.hasData,needsMigration:i.needsMigration,totalItemsToFix:i.totalItemsToFix,isChecking:i.isScanning,isRunning:i.isRunning,result:i.result,onCheck:i.scanStatus,onRun:i.runMigration,disabled:t})]})})}const oA={unknown:{color:"#9ca3af",icon:""},clean:{color:"#22c55e",icon:""},"needs-action":{color:"#f59e0b",icon:""},running:{color:"#60a5fa",icon:""},complete:{color:"#22c55e",icon:""},error:{color:"#ef4444",icon:""}};function jB({check:t,disabled:e}){const n=oA[t.status],r=e||t.isRunning||t.isChecking;return u.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"0.5rem 0.75rem",gap:"0.75rem",borderRadius:"6px",background:"color-mix(in srgb, currentColor 3%, transparent)",marginBottom:"0.25rem"},children:[u.jsx("div",{style:{width:"20px",height:"20px",borderRadius:"50%",background:`color-mix(in srgb, ${n.color} 20%, transparent)`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.7rem",flexShrink:0},children:t.isRunning||t.isChecking?u.jsx(Hn,{noMargin:!0}):n.icon}),u.jsxs("div",{style:{flex:1,minWidth:0},children:[u.jsxs("div",{style:{fontWeight:500,fontSize:"0.85rem"},children:[t.name,t.issueCount>0&&u.jsxs("span",{style:{marginLeft:"0.5rem",color:n.color,fontSize:"0.75rem"},children:["(",t.issueCount,")"]})]}),u.jsx("div",{style:{fontSize:"0.75rem",opacity:.6},children:t.description}),t.details]}),u.jsxs("div",{style:{display:"flex",gap:"0.35rem",flexShrink:0},children:[u.jsx("button",{onClick:()=>{`${t.name}`,t.onCheck()},disabled:r,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",padding:"0.25rem 0.4rem",borderRadius:"4px",cursor:r?"not-allowed":"pointer",fontSize:"0.7rem",opacity:r?.5:1},title:"Check",children:t.isChecking?u.jsx(Hn,{noMargin:!0}):""}),t.canFix&&t.onFix&&u.jsx("button",{onClick:()=>{`${t.name}`,t.onFix()},disabled:r,style:{background:"#646cff",color:"white",border:"none",padding:"0.25rem 0.5rem",borderRadius:"4px",cursor:r?"not-allowed":"pointer",fontSize:"0.7rem",fontWeight:500,opacity:r?.6:1},children:t.isRunning?u.jsx(Hn,{noMargin:!0}):"Fix"})]})]})}function RB({accountCategoryValidation:t,orphanedIdCleanup:e,expenseToAdjustment:n,adjustmentsToTransfers:r,needsAction:i,totalIssues:o,isScanning:l,isRunning:d,disabled:h,onRunOrphaned:f,onRunExpense:p,onRunTransfers:g}){const[v,_]=k.useState(!1),x=d?"running":t.hasData&&e.hasData&&n.hasData&&r.hasData?i?"needs-action":"clean":"unknown",w=oA[x],E=[{id:"validation",name:"Account/Category Validation",status:t.isScanning?"running":t.hasData?t.hasViolations?"needs-action":"clean":"unknown",issueCount:t.violationCount,description:"Validates all transactions have proper account/category combinations",canFix:!1,onCheck:()=>t.scan(),isChecking:t.isScanning,isRunning:!1,details:t.hasViolations&&t.status&&u.jsxs("div",{style:{fontSize:"0.8rem",opacity:.8},children:[t.status.violations.filter(M=>M.transactionType==="income").length>0&&u.jsxs("span",{children:["Income: ",t.status.violations.filter(M=>M.transactionType==="income").length," "]}),t.status.violations.filter(M=>M.transactionType==="expense").length>0&&u.jsxs("span",{children:["Expenses: ",t.status.violations.filter(M=>M.transactionType==="expense").length," "]}),t.status.violations.filter(M=>M.transactionType==="adjustment").length>0&&u.jsxs("span",{children:["Adjustments: ",t.status.violations.filter(M=>M.transactionType==="adjustment").length," "]}),t.status.violations.filter(M=>M.transactionType==="transfer").length>0&&u.jsxs("span",{children:["Transfers: ",t.status.violations.filter(M=>M.transactionType==="transfer").length]})]})},{id:"orphaned",name:"Orphaned ID Cleanup",status:Xg(e),issueCount:e.totalOrphaned,description:"Finds transactions with deleted/invalid account/category IDs",canFix:e.hasItemsToFix,onCheck:e.scanStatus,onFix:f,isChecking:e.isScanning,isRunning:e.isRunning,details:e.hasItemsToFix&&e.status&&u.jsxs("div",{style:{fontSize:"0.8rem",opacity:.8},children:[e.status.orphanedCategoryIds>0&&u.jsxs("span",{children:["Categories: ",e.status.orphanedCategoryIds," "]}),e.status.orphanedAccountIds>0&&u.jsxs("span",{children:["Accounts: ",e.status.orphanedAccountIds]})]})},{id:"expense",name:"Expense  Adjustment",status:Xg(n,"hasItemsToMigrate"),issueCount:n.totalToMigrate,description:"Moves expenses without account/category to adjustments",canFix:n.hasItemsToMigrate,onCheck:n.scanStatus,onFix:p,isChecking:n.isScanning,isRunning:n.isRunning,details:n.hasItemsToMigrate&&n.status&&u.jsxs("div",{style:{fontSize:"0.8rem",opacity:.8},children:[n.status.expensesToMigrate," expense(s) with No Account or No Category"]})},{id:"transfers",name:"Adjustment  Transfers",status:Xg(r,"hasPairsToConvert"),issueCount:r.totalPairs,description:"Converts opposite adjustment pairs to transfers",canFix:r.hasPairsToConvert,onCheck:r.scanStatus,onFix:g,isChecking:r.isScanning,isRunning:r.isRunning,details:r.hasPairsToConvert&&r.status&&u.jsxs("div",{style:{fontSize:"0.8rem",opacity:.8},children:[r.status.accountTransferPairs>0&&u.jsxs("span",{children:["Account transfers: ",r.status.accountTransferPairs," "]}),r.status.categoryTransferPairs>0&&u.jsxs("span",{children:["Category transfers: ",r.status.categoryTransferPairs]})]})}],T=h||d||l,R=()=>{E.forEach(M=>M.onCheck())};return u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"8px",margin:"0.25rem 0",overflow:"hidden"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"0.75rem 1rem",gap:"1rem"},children:[u.jsx("div",{style:{width:"28px",height:"28px",borderRadius:"50%",background:`color-mix(in srgb, ${w.color} 20%, transparent)`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.85rem",flexShrink:0},children:d||l?u.jsx(Hn,{noMargin:!0}):w.icon}),u.jsxs("div",{style:{flex:1,minWidth:0},children:[u.jsx("div",{style:{fontWeight:500,fontSize:"0.95rem",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:"Transaction Type Audit"}),u.jsx("div",{style:{fontSize:"0.8rem",opacity:.6,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:"Validates account/category assignments and fixes invalid transactions"})]}),u.jsxs("div",{style:{color:w.color,fontSize:"0.8rem",fontWeight:500,display:"flex",alignItems:"center",gap:"0.25rem",flexShrink:0},children:[x==="unknown"?"Unknown":x==="clean"?"Clean":x==="running"?"Running":"Needs Action",o>0&&u.jsx("span",{style:{background:`color-mix(in srgb, ${w.color} 20%, transparent)`,padding:"0.15rem 0.4rem",borderRadius:"4px",fontSize:"0.75rem"},children:o})]}),u.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:[u.jsx("button",{onClick:R,disabled:T,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",padding:"0.35rem 0.6rem",borderRadius:"4px",cursor:T?"not-allowed":"pointer",fontSize:"0.8rem",opacity:T?.5:1,display:"flex",alignItems:"center",gap:"0.25rem"},title:"Check all",children:l?u.jsx(Hn,{noMargin:!0}):""}),u.jsx("button",{onClick:()=>_(!v),style:{background:"transparent",color:"inherit",border:"none",padding:"0.35rem",borderRadius:"4px",cursor:"pointer",fontSize:"0.9rem",opacity:.6},title:v?"Collapse":"Expand",children:v?"":""})]})]}),v&&u.jsx("div",{style:{borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)",padding:"0.5rem",background:"color-mix(in srgb, currentColor 2%, transparent)"},children:E.map(M=>u.jsx(jB,{check:M,disabled:h},M.id))})]})}function Xg(t,e="hasItemsToFix"){return t.isRunning?"running":t.result&&t.result.errors.length===0?"complete":t.isScanning?"running":t.hasData?t[e]?"needs-action":"clean":"unknown"}function IB({status:t,hasData:e,hasIssues:n,totalIssues:r,isChecking:i,isRunning:o,result:l,onCheck:d,onRun:h,disabled:f}){const p=()=>o?"running":e?l&&l.errors.length===0?"complete":l&&l.errors.length>0?"error":n?"needs-action":"clean":"unknown",g=()=>{if(l&&l.errors.length===0){const _=l.accountsFixed+l.categoriesFixed+l.totalAvailableFixed+l.incomeValuesFixed+l.expenseValuesFixed+l.categoryBalancesFixed+l.accountBalancesFixed;return _>0?`Fixed ${_}`:"Complete"}},v=()=>{if(l){const _=l.accountsFixed+l.categoriesFixed+l.totalAvailableFixed+l.incomeValuesFixed+l.expenseValuesFixed+l.categoryBalancesFixed+l.accountBalancesFixed;return u.jsxs("div",{style:{fontSize:"0.85rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem",fontWeight:500},children:l.errors.length>0?" Completed with errors":" Cleanup complete"}),u.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[l.budgetsProcessed>0&&u.jsxs("li",{children:[l.budgetsProcessed," budget(s) updated"]}),l.accountsFixed>0&&u.jsxs("li",{children:[l.accountsFixed," account balance(s) fixed"]}),l.categoriesFixed>0&&u.jsxs("li",{children:[l.categoriesFixed," category value(s) fixed"]}),l.totalAvailableFixed>0&&u.jsxs("li",{children:[l.totalAvailableFixed," total_available value(s) fixed"]}),l.monthsProcessed>0&&u.jsxs("li",{children:[l.monthsProcessed," month(s) updated"]}),l.incomeValuesFixed>0&&u.jsxs("li",{children:[l.incomeValuesFixed," income amount(s) fixed"]}),l.expenseValuesFixed>0&&u.jsxs("li",{children:[l.expenseValuesFixed," expense amount(s) fixed"]}),l.categoryBalancesFixed>0&&u.jsxs("li",{children:[l.categoryBalancesFixed," category balance(s) fixed"]}),l.accountBalancesFixed>0&&u.jsxs("li",{children:[l.accountBalancesFixed," account balance(s) fixed"]}),_===0&&u.jsx("li",{children:"No changes needed"})]}),l.errors.length>0&&u.jsxs("div",{style:{marginTop:"0.5rem",color:"#ef4444"},children:[u.jsxs("div",{children:["Errors (",l.errors.length,"):"]}),u.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1.25rem"},children:[l.errors.slice(0,3).map((C,x)=>u.jsx("li",{children:C},x)),l.errors.length>3&&u.jsxs("li",{children:["...and ",l.errors.length-3," more"]})]})]})]})}return e?n?u.jsxs("div",{style:{fontSize:"0.85rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem",color:"#fbbf24"},children:"Precision issues found:"}),u.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[t.budgetsWithPrecisionIssues>0&&u.jsxs("li",{children:[t.budgetsWithPrecisionIssues," budget(s) with issues:",u.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1rem",opacity:.8},children:[t.accountsWithPrecisionIssues>0&&u.jsxs("li",{children:[t.accountsWithPrecisionIssues," account balance(s)"]}),t.categoriesWithPrecisionIssues>0&&u.jsxs("li",{children:[t.categoriesWithPrecisionIssues," category value(s)"]}),t.totalAvailableWithPrecisionIssues>0&&u.jsxs("li",{children:[t.totalAvailableWithPrecisionIssues," total_available value(s)"]})]})]}),t.monthsWithPrecisionIssues>0&&u.jsxs("li",{children:[t.monthsWithPrecisionIssues," month(s) with issues:",u.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1rem",opacity:.8},children:[t.incomeValuesWithPrecisionIssues>0&&u.jsxs("li",{children:[t.incomeValuesWithPrecisionIssues," income amount(s)"]}),t.expenseValuesWithPrecisionIssues>0&&u.jsxs("li",{children:[t.expenseValuesWithPrecisionIssues," expense amount(s)"]}),t.categoryBalancesWithPrecisionIssues>0&&u.jsxs("li",{children:[t.categoryBalancesWithPrecisionIssues," category balance(s)"]}),t.accountBalancesWithPrecisionIssues>0&&u.jsxs("li",{children:[t.accountBalancesWithPrecisionIssues," account balance(s)"]})]})]})]}),u.jsxs("div",{style:{marginTop:"0.5rem",opacity:.6},children:["Scanned ",t.totalBudgets," budget(s) and ",t.totalMonths," month(s)."]})]}):u.jsxs("div",{style:{fontSize:"0.85rem"},children:[" All currency values have proper precision (2 decimal places).",u.jsxs("div",{style:{marginTop:"0.25rem",opacity:.6},children:["Scanned ",t.totalBudgets," budget(s) and ",t.totalMonths," month(s)."]})]}):u.jsx("div",{style:{fontSize:"0.85rem",opacity:.7},children:"Click check to scan for precision issues."})};return u.jsx(pd,{name:"Currency Precision",description:"Fixes floating-point precision by rounding all values to 2 decimal places",status:p(),statusText:g(),onCheck:d,isChecking:i,onRun:h,isRunning:o,actionText:`Fix ${r}`,disabled:f,itemCount:n?r:void 0,details:v(),isDestructive:!0})}function kB({disabled:t,onDownloadBackup:e,isDownloadingBackup:n,accountCategoryValidation:r,orphanedIdCleanup:i,expenseToAdjustment:o,adjustmentsToTransfers:l,precisionCleanup:d}){const h=r.isScanning||i.isScanning||o.isScanning||l.isScanning||d.isScanning,f=i.isRunning||o.isRunning||l.isRunning||d.isRunning,p=async()=>{await Promise.all([r.scan(),i.scanStatus(),o.scanStatus(),l.scanStatus(),d.scan()])},g=Ao({migrationName:"Orphaned ID Cleanup",isDestructive:!0,onDownloadBackup:e}),v=Ao({migrationName:"Expense to Adjustment Migration",isDestructive:!0,onDownloadBackup:e}),_=Ao({migrationName:"Adjustments to Transfers Migration",isDestructive:!0,onDownloadBackup:e}),C=Ao({migrationName:"Currency Precision Cleanup",isDestructive:!0,onDownloadBackup:e}),x=r.hasViolations||i.hasItemsToFix||o.hasItemsToMigrate||l.hasPairsToConvert,w=(r.violationCount||0)+(i.totalOrphaned||0)+(o.totalToMigrate||0)+(l.totalPairs||0);return u.jsxs(u.Fragment,{children:[u.jsxs(J0,{title:"Maintenance",icon:"",description:"Re-runnable database validation scripts. Validate all to see which need resolution.",type:"maintenance",onValidateAll:p,isValidating:h,isAnyRunning:f,children:[u.jsx(RB,{accountCategoryValidation:r,orphanedIdCleanup:i,expenseToAdjustment:o,adjustmentsToTransfers:l,needsAction:x,totalIssues:w,isScanning:r.isScanning||i.isScanning||o.isScanning||l.isScanning,isRunning:i.isRunning||o.isRunning||l.isRunning,disabled:t,onRunOrphaned:()=>g.promptBeforeAction(i.runMigration),onRunExpense:()=>v.promptBeforeAction(o.runMigration),onRunTransfers:()=>_.promptBeforeAction(l.runMigration)}),u.jsx(IB,{status:d.status,hasData:d.hasData,hasIssues:d.hasIssues,totalIssues:d.totalIssues,isChecking:d.isScanning,isRunning:d.isRunning,result:d.result,onCheck:d.scan,onRun:()=>C.promptBeforeAction(d.runCleanup),disabled:t})]}),u.jsx(To,{...g.promptProps,isDownloading:n}),u.jsx(To,{...v.promptProps,isDownloading:n}),u.jsx(To,{..._.promptProps,isDownloading:n}),u.jsx(To,{...C.promptProps,isDownloading:n})]})}function DB({isDownloading:t,downloadProgress:e,downloadError:n,onDownload:r,isScanning:i,isUploading:o,uploadStatus:l,uploadProgress:d,uploadError:h,uploadResult:f,onScan:p,onUpload:g,disabled:v}){const _=k.useRef(null),[C,x]=k.useState(null),[w,E]=k.useState(!1),T=async q=>{const A=q.target.files?.[0];A&&(x(A),await p(A))},R=l!==null,M=R&&(l.budgetsFound>0||l.monthsFound>0),V=v||t||i||o,$=f?.success?"#22c55e":M?"#f59e0b":R?"#22c55e":"#9ca3af",I=f?.success?"":o||i||t?"":M?"":R?"":"",D=f?.success?"Uploaded":o?"Uploading":i?"Scanning":t?"Downloading":M?`${l.budgetsFound} budget(s), ${l.monthsFound} month(s) ready`:R?"Nothing to upload":"Select file",P=t?e?.percentComplete:d?.percentComplete,L=n||h;return u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"8px",margin:"0.25rem 0",overflow:"hidden"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"0.75rem 1rem",gap:"1rem"},children:[u.jsx("div",{style:{width:"28px",height:"28px",borderRadius:"50%",background:`color-mix(in srgb, ${$} 20%, transparent)`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.85rem",flexShrink:0},children:o||i||t?u.jsx(Hn,{noMargin:!0}):I}),u.jsxs("div",{style:{flex:1,minWidth:0},children:[u.jsx("div",{style:{fontWeight:500,fontSize:"0.95rem",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:" Budget Backup & Restore"}),u.jsx("div",{style:{fontSize:"0.8rem",opacity:.6,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:"Download selected budget as zip or restore from zip file"})]}),u.jsx("div",{style:{color:$,fontSize:"0.8rem",fontWeight:500,flexShrink:0},children:D}),u.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:[u.jsx("button",{onClick:()=>{r()},disabled:V,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",padding:"0.35rem 0.6rem",borderRadius:"4px",cursor:V?"not-allowed":"pointer",fontSize:"0.8rem",opacity:V?.5:1,display:"flex",alignItems:"center",gap:"0.25rem"},title:"Download all budgets as zip",children:t?u.jsx(Hn,{noMargin:!0}):""}),u.jsx("input",{ref:_,type:"file",accept:".zip",onChange:T,style:{display:"none"}}),u.jsx("button",{onClick:()=>_.current?.click(),disabled:V,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",padding:"0.35rem 0.6rem",borderRadius:"4px",cursor:V?"not-allowed":"pointer",fontSize:"0.8rem",opacity:V?.5:1,display:"flex",alignItems:"center",gap:"0.25rem"},title:"Select zip file to restore",children:i?u.jsx(Hn,{noMargin:!0}):""}),M&&C&&u.jsx("button",{onClick:async()=>{await g(C)},disabled:V,style:{background:"#646cff",color:"white",border:"none",padding:"0.35rem 0.75rem",borderRadius:"4px",cursor:V?"not-allowed":"pointer",fontSize:"0.8rem",fontWeight:500,opacity:V?.6:1,display:"flex",alignItems:"center",gap:"0.25rem"},children:o?u.jsx(Hn,{noMargin:!0}):"Upload"}),(R||f||L)&&u.jsx("button",{onClick:()=>E(!w),style:{background:"transparent",color:"inherit",border:"none",padding:"0.35rem",borderRadius:"4px",cursor:"pointer",fontSize:"0.9rem",opacity:.6},title:w?"Collapse":"Expand",children:w?"":""})]})]}),(t||o)&&P!==void 0&&u.jsxs("div",{style:{padding:"0 1rem 0.5rem 1rem"},children:[u.jsx("div",{style:{width:"100%",height:"4px",background:"color-mix(in srgb, currentColor 10%, transparent)",borderRadius:"2px",overflow:"hidden"},children:u.jsx("div",{style:{width:`${P}%`,height:"100%",background:"#646cff",transition:"width 0.3s ease"}})}),u.jsxs("div",{style:{fontSize:"0.75rem",opacity:.6,marginTop:"0.25rem",textAlign:"center"},children:[t?e?.phase:d?.phase,": ",P,"%"]})]}),w&&(R||f||L)&&u.jsxs("div",{style:{borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)",padding:"1rem",background:"color-mix(in srgb, currentColor 2%, transparent)",fontSize:"0.85rem"},children:[L&&u.jsxs("div",{style:{marginBottom:"0.75rem",color:"#ef4444"},children:[" Error: ",L]}),f&&u.jsx("div",{style:{marginBottom:l?"0.75rem":0,color:f.success?"#22c55e":"#ef4444"},children:f.success?u.jsxs(u.Fragment,{children:[" Restored ",f.budgetsRestored," budget(s), ",f.monthsRestored," month(s), ",f.payeesRestored," payee doc(s)"]}):u.jsxs(u.Fragment,{children:[" Upload failed: ",f.errors.join(", ")]})}),l&&u.jsxs(u.Fragment,{children:[u.jsxs("div",{style:{marginBottom:"0.25rem"},children:[u.jsx("strong",{children:"Found in zip:"})," ",l.budgetsFound," budget(s), ",l.monthsFound," month(s), ",l.payeesFound," payee doc(s)"]}),l.budgetsToRestore.length>0&&u.jsxs("div",{children:[u.jsx("strong",{children:"Budgets to restore:"})," ",l.budgetsToRestore.join(", ")]})]})]})]})}function MB({hasData:t,monthsCount:e,budgetCount:n,isChecking:r,isDeleting:i,deleteResult:o,onCheck:l,onDelete:d,disabled:h}){const[f,p]=k.useState(!1),g=()=>i?"running":t?o&&o.errors.length===0?"complete":e===0?"clean":"needs-action":"unknown",v=()=>o&&o.errors.length===0?`Deleted ${o.deleted}`:e===0?"No months":`${e} months`,_=()=>{p(!0)},C=()=>{p(!1),d()},x=()=>o?u.jsxs("div",{style:{fontSize:"0.85rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem",fontWeight:500},children:o.errors.length>0?" Completed with errors":" Deletion complete"}),u.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[u.jsxs("li",{children:[o.deleted," month(s) deleted"]}),o.budgetsRecalculated>0&&u.jsxs("li",{children:[o.budgetsRecalculated," budget(s) reset"]})]}),o.errors.length>0&&u.jsxs("div",{style:{marginTop:"0.5rem",color:"#ef4444"},children:[u.jsxs("div",{children:["Errors (",o.errors.length,"):"]}),u.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1.25rem"},children:[o.errors.slice(0,3).map((w,E)=>u.jsx("li",{children:w},E)),o.errors.length>3&&u.jsxs("li",{children:["...and ",o.errors.length-3," more"]})]})]})]}):t?e===0?u.jsx("div",{style:{fontSize:"0.85rem"},children:" No month documents found in Firebase."}):u.jsxs("div",{style:{fontSize:"0.85rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem",color:"#ef4444"},children:" DESTRUCTIVE ACTION"}),u.jsxs("div",{children:["Found ",e," month(s) across ",n," budget(s)."]}),u.jsx("div",{style:{marginTop:"0.5rem",opacity:.7},children:"This will permanently delete ALL month documents and reset all budgets."})]}):u.jsx("div",{style:{fontSize:"0.85rem",opacity:.7},children:"Click check to scan for months."});return u.jsxs(u.Fragment,{children:[u.jsx(pd,{name:"Delete ALL Months",description:"DESTRUCTIVE: Deletes all month documents from all budgets",status:g(),statusText:v(),onCheck:l,isChecking:r,onRun:e>0?_:void 0,isRunning:i,actionText:"Delete",disabled:h,itemCount:e>0?e:void 0,details:x(),isDestructive:!0}),u.jsxs(hs,{isOpen:f,onClose:()=>p(!1),title:" Delete All Months?",children:[u.jsx("div",{style:{background:"color-mix(in srgb, #ef4444 15%, transparent)",border:"1px solid color-mix(in srgb, #ef4444 40%, transparent)",borderRadius:"8px",padding:"1rem",marginBottom:"1rem"},children:u.jsx("p",{style:{margin:0,color:"#fca5a5",fontWeight:500,fontSize:"0.95rem"},children:" This is a destructive operation that cannot be undone!"})}),u.jsxs("p",{style:{margin:"0 0 0.75rem",opacity:.9},children:["This will permanently delete ",u.jsxs("strong",{style:{color:"#ef4444"},children:[e," month(s)"]})," across"," ",u.jsxs("strong",{style:{color:"#ef4444"},children:[n," budget(s)"]}),"."]}),u.jsxs("ul",{style:{margin:"0 0 1.5rem",paddingLeft:"1.5rem",opacity:.8,fontSize:"0.9rem"},children:[u.jsx("li",{children:"All account balances  $0"}),u.jsx("li",{children:"All category balances  $0"}),u.jsx("li",{children:"Month history cleared"})]}),u.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[u.jsx(Ve,{variant:"secondary",actionName:"Cancel Delete All Months",onClick:()=>p(!1),children:"Cancel"}),u.jsxs(Ve,{variant:"danger",actionName:"Confirm Delete All Months",onClick:C,children:[" Delete All ",e," Months"]})]})]})]})}function OB({status:t,hasData:e,totalBudgets:n,totalMonths:r,isChecking:i,isDeleting:o,deleteResult:l,onCheck:d,onDelete:h,disabled:f}){const[p,g]=k.useState(!1),v=t?.staleBudgetIds??[],_=v.length>0,C=()=>o?"running":e?l&&l.errors.length===0?"complete":n===0&&!_?"clean":"needs-action":"unknown",x=()=>l&&l.errors.length===0?`Deleted ${l.budgetsDeleted}`:n===0&&!_?"Clean":_?`${v.length} stale ref(s)`:`${n} budget(s)`,w=()=>{g(!0)},E=()=>{g(!1),h()},T=()=>l?u.jsxs("div",{style:{fontSize:"0.85rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem",fontWeight:500},children:l.errors.length>0?" Completed with errors":" Deletion complete"}),u.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[l.budgetsDeleted>0&&u.jsxs("li",{children:[l.budgetsDeleted," budget(s) deleted"]}),l.monthsDeleted>0&&u.jsxs("li",{children:[l.monthsDeleted," month(s) deleted"]}),l.payeesDeleted>0&&u.jsxs("li",{children:[l.payeesDeleted," payee doc(s) deleted"]})]}),l.errors.length>0&&u.jsxs("div",{style:{marginTop:"0.5rem",color:"#ef4444"},children:[u.jsxs("div",{children:["Errors (",l.errors.length,"):"]}),u.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1.25rem"},children:[l.errors.slice(0,3).map((M,V)=>u.jsx("li",{children:M},V)),l.errors.length>3&&u.jsxs("li",{children:["...and ",l.errors.length-3," more"]})]})]})]}):e?n===0&&!_?u.jsx("div",{style:{fontSize:"0.85rem"},children:' No budget found for sample@sample.com  user is in "new user" state.'}):_?u.jsxs("div",{style:{fontSize:"0.85rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem",color:"#f59e0b"},children:" Found stale budget references:"}),u.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[v.slice(0,3).map(M=>u.jsx("li",{style:{opacity:.8},children:M},M)),v.length>3&&u.jsxs("li",{style:{opacity:.6},children:["...and ",v.length-3," more"]})]})]}):u.jsxs("div",{style:{fontSize:"0.85rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem",color:"#f59e0b"},children:" Sample user budget found:"}),u.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[u.jsxs("li",{children:[n," budget(s)"]}),u.jsxs("li",{children:[r," month(s)"]})]}),u.jsx("div",{style:{marginTop:"0.5rem",opacity:.7},children:"Deleting will reset sample@sample.com to a new user state."})]}):u.jsx("div",{style:{fontSize:"0.85rem",opacity:.7},children:"Click check to scan for sample user budget."}),R=n>0||_;return u.jsxs(u.Fragment,{children:[u.jsx(pd,{name:"Delete Sample User Budget",description:"Reset sample@sample.com to new user state",status:C(),statusText:x(),onCheck:d,isChecking:i,onRun:R?w:void 0,isRunning:o,actionText:"Delete",disabled:f,itemCount:R?n||v.length:void 0,details:T(),isDestructive:!0}),u.jsxs(hs,{isOpen:p,onClose:()=>g(!1),title:" Delete Sample User Budget?",children:[u.jsx("div",{style:{background:"color-mix(in srgb, #f59e0b 15%, transparent)",border:"1px solid color-mix(in srgb, #f59e0b 40%, transparent)",borderRadius:"8px",padding:"1rem",marginBottom:"1rem"},children:u.jsx("p",{style:{margin:0,color:"#fcd34d",fontWeight:500,fontSize:"0.95rem"},children:" This will delete all data for sample@sample.com!"})}),n>0&&u.jsxs("p",{style:{margin:"0 0 0.75rem",opacity:.9},children:["This will permanently delete ",u.jsxs("strong",{style:{color:"#f59e0b"},children:[n," budget(s)"]})," and"," ",u.jsxs("strong",{style:{color:"#f59e0b"},children:[r," month(s)"]}),"."]}),_&&u.jsxs("p",{style:{margin:"0 0 0.75rem",opacity:.9},children:["This will remove ",u.jsxs("strong",{style:{color:"#f59e0b"},children:[v.length," stale reference(s)"]})," from the user document."]}),u.jsxs("ul",{style:{margin:"0 0 1.5rem",paddingLeft:"1.5rem",opacity:.8,fontSize:"0.9rem"},children:[u.jsx("li",{children:"Budget document deleted"}),u.jsx("li",{children:"All month documents deleted"}),u.jsx("li",{children:"Payees document deleted"}),u.jsx("li",{children:"User will see onboarding flow"})]}),u.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[u.jsx(Ve,{variant:"secondary",actionName:"Cancel Delete Sample User Budget",onClick:()=>g(!1),children:"Cancel"}),u.jsx(Ve,{variant:"danger",actionName:"Confirm Delete Sample User Budget",onClick:E,children:" Delete Sample User Data"})]})]})]})}function NB({onClearCache:t,disabled:e}){const[n,r]=k.useState(!1),i=()=>{r(!0)},o=()=>{r(!1),t()};return u.jsxs(u.Fragment,{children:[u.jsx(_B,{name:"Clear All Caches",description:"Clear cached data and reload to fetch fresh data from Firestore",onAction:i,actionText:"Clear & Reload",actionIcon:"",disabled:e,isDestructive:!0}),u.jsxs(hs,{isOpen:n,onClose:()=>r(!1),title:"Clear Caches & Reload?",children:[u.jsx("p",{style:{margin:"0 0 1rem 0",opacity:.8},children:"This will clear all cached data and reload the page. The app will fetch fresh data from Firestore for everything."}),u.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[u.jsx(Ve,{variant:"secondary",actionName:"Cancel Clear Caches",onClick:()=>r(!1),children:"Cancel"}),u.jsx(Ve,{variant:"danger",actionName:"Confirm Clear Caches & Reload",onClick:o,children:"Clear & Reload"})]})]})]})}function PB({disabled:t,onDownloadBackup:e,isDownloadingBackup:n,budgetDownloadUpload:r,deleteAllMonths:i,deleteSampleUserBudget:o,onClearCache:l}){const d=r.isDownloading||r.isUploading||i.isDeleting||o.isDeleting,h=Ao({migrationName:"Delete All Months",isDestructive:!0,onDownloadBackup:e}),f=Ao({migrationName:"Delete Sample User Budget",isDestructive:!0,onDownloadBackup:e}),p=Ao({migrationName:"Upload Budget",isDestructive:!0,onDownloadBackup:e});return u.jsxs(u.Fragment,{children:[u.jsxs(J0,{title:"Utilities",icon:"",description:"Administrative utilities for data management, downloads, and cache control.",type:"utility",isAnyRunning:d,children:[u.jsx(DB,{isDownloading:r.isDownloading,downloadProgress:r.downloadProgress,downloadError:r.downloadError,onDownload:r.downloadBudget,isScanning:r.isScanning,isUploading:r.isUploading,uploadStatus:r.uploadStatus,uploadProgress:r.uploadProgress,uploadError:r.uploadError,uploadResult:r.uploadResult,onScan:r.scanZipFile,onUpload:async g=>{p.promptBeforeAction(()=>{r.uploadBudget(g).catch(v=>console.error("Upload failed:",v))})},disabled:t}),u.jsxs("div",{style:{marginTop:"0.75rem",paddingTop:"0.75rem",borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},children:[u.jsx("div",{style:{fontSize:"0.75rem",opacity:.5,textTransform:"uppercase",letterSpacing:"0.05em",marginBottom:"0.5rem",paddingLeft:"0.5rem"},children:"Destructive Actions"}),u.jsx(MB,{status:i.status,hasData:i.hasData,monthsCount:i.monthsCount,budgetCount:i.budgetCount,isChecking:i.isScanning,isDeleting:i.isDeleting,deleteResult:i.deleteResult,deleteProgress:i.deleteProgress,onCheck:i.scanStatus,onDelete:()=>h.promptBeforeAction(i.deleteAllMonths),disabled:t}),u.jsx(OB,{status:o.status,hasData:o.hasData,totalBudgets:o.totalBudgets,totalMonths:o.totalMonths,isChecking:o.isScanning,isDeleting:o.isDeleting,deleteResult:o.deleteResult,deleteProgress:o.deleteProgress,onCheck:o.scanStatus,onDelete:()=>f.promptBeforeAction(o.deleteSampleUserBudget),disabled:t}),u.jsx(NB,{onClearCache:l,disabled:t})]})]}),u.jsx(To,{...h.promptProps,isDownloading:n}),u.jsx(To,{...f.promptProps,isDownloading:n}),u.jsx(To,{...p.promptProps,isDownloading:n})]})}function BB({message:t="Loading...",spinnerColor:e=fe.primary,children:n,spinnerSize:r=4}){return u.jsxs("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(15, 15, 20, 0.95)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",zIndex:9999,gap:"1.5rem",backdropFilter:"blur(4px)"},children:[u.jsx("div",{style:{width:`${r}rem`,height:`${r}rem`,border:"3px solid rgba(255, 255, 255, 0.15)",borderTopColor:e,borderRadius:"50%",animation:"loadingOverlaySpin 0.8s linear infinite"}}),u.jsx("p",{style:{color:"rgba(255, 255, 255, 0.95)",fontSize:"1.2rem",fontWeight:600,letterSpacing:"0.02em",margin:0},children:t}),n,u.jsx("style",{children:`
        @keyframes loadingOverlaySpin {
          to { transform: rotate(360deg); }
        }
      `})]})}function zB(){return u.jsxs("div",{style:Mf,children:[u.jsx("nav",{style:{marginBottom:"1rem",display:"flex",alignItems:"center"},children:u.jsx(Tn,{to:"/",style:{display:"flex",alignItems:"center"},title:"Tarron Lane Home",children:u.jsx("img",{src:"/t-icon.svg",alt:"Tarron Lane Home",style:{width:"2rem",height:"2rem"}})})}),u.jsx("h1",{children:"Tarron Lane Homepage"}),u.jsx("nav",{children:u.jsxs("ul",{children:[u.jsx("li",{children:u.jsx(Tn,{to:"/sql-test",children:"SQL Test"})}),u.jsx("li",{children:u.jsx(Tn,{to:"/budget",children:"Budget"})}),u.jsx("li",{children:u.jsx(Tn,{to:"/account",children:"Account"})})]})})]})}function LB(){const t=k.useContext(md),e=za(),[n,r]=k.useState(!1),i=tr(),o=Xu(),l=i.state?.from||"/";k.useEffect(()=>{t.is_logged_in&&l!=="/"&&o(l,{replace:!0})},[t.is_logged_in,l,o]);function d(){r(!0),e.logout_firebase_user().then(function(){Be.clear(),window.location.href="/"})}return u.jsxs("div",{style:Mf,children:[u.jsxs("nav",{style:{marginBottom:"1rem",display:"grid",gridTemplateColumns:"1fr auto 1fr",alignItems:"center"},children:[u.jsx("div",{style:{display:"flex",alignItems:"center"},children:u.jsx(Tn,{to:"/",style:{opacity:.6,fontSize:"1.5rem",textDecoration:"none",padding:"0.25rem 0.5rem"},title:"Back to Home",children:""})}),u.jsxs(Tn,{to:"/",style:{display:"flex",alignItems:"center",gap:"0.5rem",textDecoration:"none",color:"inherit"},title:"Tarron Lane Home",children:[u.jsx("img",{src:"/t-icon.svg",alt:"Tarron Lane",style:{width:"1.5rem",height:"1.5rem"}}),u.jsx("span",{style:{fontWeight:600,fontSize:"1.1rem"},children:"Account"})]}),u.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:u.jsx(tA,{items:[{label:"Budget",icon:"",to:"/budget"},{label:"Account",icon:"",to:"/account"}]})})]}),u.jsx("h1",{children:"Account"}),t.is_logged_in?n?u.jsx("p",{children:"Logging Out..."}):u.jsxs(u.Fragment,{children:[u.jsxs("p",{children:["You are logged in as ",t.username]}),u.jsx("button",{onClick:d,style:{marginTop:"1rem"},children:"Logout"})]}):u.jsx(UB,{})]})}function UB(){const t=za(),[e,n]=k.useState(""),[r,i]=k.useState(""),[o,l]=k.useState(!1),[d,h]=k.useState(!1),[f,p]=k.useState("");function g(C){n(C.target.value)}function v(C){i(C.target.value)}function _(C){C.preventDefault(),h(!0),p(""),Be.clear(),t.login_firebase_user(e,r).then(function(){}).catch(function(){p("Incorrect login credentials")}).finally(function(){h(!1)})}return u.jsxs("form",{onSubmit:_,children:[u.jsxs("div",{children:[u.jsx("label",{htmlFor:"username",children:"Email: "}),u.jsx("input",{id:"username",type:"email",value:e,onChange:g})]}),u.jsxs("div",{children:[u.jsx("label",{htmlFor:"password",children:"Password: "}),u.jsxs("div",{style:{display:"inline-flex",alignItems:"center",position:"relative"},children:[u.jsx("input",{id:"password",type:o?"text":"password",value:r,onChange:v,style:{paddingRight:"2rem"}}),u.jsx("button",{type:"button",onClick:()=>l(!o),style:{position:"absolute",right:"0.25rem",background:"none",border:"none",cursor:"pointer",padding:"0.25rem",opacity:.6,fontSize:"1rem"},title:o?"Hide password":"Show password",children:o?"":""})]})]}),d?u.jsx("p",{children:"Logging in..."}):u.jsx("button",{children:"Login"}),f&&u.jsx("p",{style:{color:"red"},children:f})]})}const FB={categories:"balances",accounts:"balances",income:"transactions",spend:"transactions",transfers:"transactions",adjustments:"transactions"},VB={balances:"categories",transactions:"income"};function $B({activeTab:t,setActiveTab:e,allocationsFinalized:n}){const r=FB[t],i=k.useMemo(()=>[{id:"balances",label:"Balances"},{id:"transactions",label:"Transactions"}],[]),o=k.useMemo(()=>[{id:"categories",label:"Categories",checkmark:n},{id:"accounts",label:"Accounts"}],[n]),l=k.useMemo(()=>[{id:"income",label:"Income"},{id:"spend",label:"Spend"},{id:"transfers",label:"Transfers"},{id:"adjustments",label:"Adjustments"}],[]),d=f=>{e(VB[f])},h=r==="balances"?o:l;return u.jsxs("div",{children:[u.jsx(Pf,{mode:"button",tabs:i,activeTab:r,onTabChange:d,variant:"segmented"}),u.jsx(Pf,{mode:"button",tabs:h,activeTab:t,onTabChange:f=>e(f),variant:"secondary"})]})}function qB({isOpen:t,onClose:e,onProceed:n,results:r}){const[i,o]=k.useState("from_current"),l=!r||r.status==="confirming",d=r&&!["confirming","done","error"].includes(r.status),h=l||r?.status==="done"||r?.status==="error";function f(){h&&(e(),o("from_current"))}function p(){n(i)}return u.jsx(hs,{isOpen:t,onClose:f,title:"Recalculate Balances",width:"540px",children:u.jsxs("div",{style:{padding:"0.5rem 0"},children:[l&&u.jsxs(u.Fragment,{children:[u.jsx("p",{style:{margin:"0 0 1rem 0",fontSize:"0.95rem",lineHeight:1.5},children:"Choose what to recalculate:"}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem",marginBottom:"1.5rem"},children:[u.jsx(H1,{selected:i==="from_current",onClick:()=>o("from_current"),title:"From current month forward",description:"Recalculate from this month onward. Use for quick fixes."}),u.jsx(H1,{selected:i==="all_months",onClick:()=>o("all_months"),title:"All months from beginning",description:"Recalculate entire history. Use after migrations or data repairs.",recommended:!0})]}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem",marginBottom:"1.5rem"},children:[u.jsx(kl,{status:"waiting",label:"Find all months to process"}),u.jsx(kl,{status:"waiting",label:"Process months"}),u.jsx(kl,{status:"waiting",label:"Update budget totals"})]}),u.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[u.jsx(Ve,{variant:"secondary",actionName:"Cancel Recalculation",onClick:e,children:"Cancel"}),u.jsx(Ve,{actionName:"Proceed with Recalculation",onClick:p,children:"Proceed"})]})]}),!l&&u.jsxs(u.Fragment,{children:[u.jsx("p",{style:{margin:"0 0 1.5rem 0",fontSize:"0.9rem",opacity:.7},children:"Recalculating category balances and account balances..."}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:[u.jsx(kl,{status:r?.status==="pending"?"waiting":"complete",label:"Find all months to process",detail:r&&r.status!=="pending"?`Found ${r.monthsFound||0} month${r.monthsFound!==1?"s":""}`:void 0}),u.jsx(kl,{status:q1(r?.status,["pending","finding_months"],"processing_months"),label:"Process months",detail:r?.status==="processing_months"?`Processing: ${r.currentMonthLabel} (${(r.currentMonthIndex||0)+1}/${r.monthsFound||0})`:r?.monthsProcessed!==void 0?`Processed ${r.monthsProcessed} month${r.monthsProcessed!==1?"s":""}`:void 0}),u.jsx(kl,{status:r?.status==="error"?"error":q1(r?.status,["pending","finding_months","processing_months"],"updating_budget"),label:"Update budget totals",detail:r?.status==="error"?r.error:void 0,isError:r?.status==="error"})]}),r?.status==="done"&&u.jsxs("div",{style:{marginTop:"1.5rem",padding:"1rem",background:`color-mix(in srgb, ${fe.success} 10%, transparent)`,border:`1px solid ${fe.success}`,borderRadius:"8px",textAlign:"center"},children:[u.jsx("p",{style:{margin:0,fontWeight:600,color:fe.success},children:" Recalculation complete!"}),u.jsxs("p",{style:{margin:"0.5rem 0 0 0",fontSize:"0.9rem",opacity:.8},children:[r.monthsProcessed," month",r.monthsProcessed!==1?"s":""," processed",u.jsx("br",{}),"Total Income: ",Vt(r.totalIncomeRecalculated||0),u.jsx("br",{}),"Total Expenses: ",Vt(r.totalExpensesRecalculated||0)]})]}),(r?.status==="done"||r?.status==="error")&&u.jsx("div",{style:{marginTop:"1.5rem",display:"flex",justifyContent:"center"},children:u.jsx(Ve,{actionName:"Close Recalculation Modal",onClick:e,children:"Done"})}),d&&u.jsx("p",{style:{marginTop:"1.5rem",textAlign:"center",fontSize:"0.85rem",opacity:.6},children:"Please wait, do not close this window..."})]})]})})}function q1(t,e,n){return!t||e.includes(t)?t===n?"active":"waiting":t===n?"active":"complete"}function kl({status:t,label:e,detail:n,isError:r}){const i=t==="waiting"?"":t==="active"?"":t==="error"?"":"";return u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[u.jsx("span",{style:{fontSize:"1.1rem",width:"1.5rem",textAlign:"center"},children:i}),u.jsxs("div",{style:{flex:1},children:[u.jsx("p",{style:{margin:0,fontWeight:500},children:e}),n&&u.jsx("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.85rem",opacity:r?1:.6,color:r?fe.error:"inherit"},children:n})]})]})}function H1({selected:t,onClick:e,title:n,description:r,recommended:i}){return u.jsxs("button",{type:"button",onClick:e,style:{display:"flex",alignItems:"flex-start",gap:"0.75rem",padding:"0.75rem 1rem",background:t?"color-mix(in srgb, #646cff 15%, transparent)":"color-mix(in srgb, currentColor 5%, transparent)",border:t?"2px solid #646cff":"2px solid transparent",borderRadius:"8px",cursor:"pointer",textAlign:"left",width:"100%",transition:"all 0.15s ease"},children:[u.jsx("span",{style:{width:"20px",height:"20px",borderRadius:"50%",border:t?"6px solid #646cff":"2px solid rgba(128,128,128,0.5)",flexShrink:0,marginTop:"2px",background:t?"white":"transparent"}}),u.jsxs("div",{style:{flex:1},children:[u.jsxs("p",{style:{margin:0,fontWeight:600,fontSize:"0.95rem"},children:[n,i&&u.jsx("span",{style:{marginLeft:"0.5rem",padding:"0.15rem 0.5rem",background:fe.success,color:"white",borderRadius:"4px",fontSize:"0.7rem",fontWeight:500,verticalAlign:"middle"},children:"RECOMMENDED"})]}),u.jsx("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.85rem",opacity:.7},children:r})]})]})}function e_({isDisabled:t,onCloseMenu:e}){const{selectedBudgetId:n}=Xe(),{categories:r}=jn(),[i,o]=k.useState(!1),[l,d]=k.useState(!1),[h,f]=k.useState(null);function p(){d(!0),f({status:"confirming"})}async function g(_){if(n){o(!0),f({status:"pending"});try{f({status:"finding_months"});const x=(await Fn("months","recalculate all: querying all months",[{field:"budget_id",op:"==",value:n}])).docs.map(A=>{const O=A.data;return{budget_id:n,year_month_ordinal:O.year_month_ordinal??`${O.year}${String(O.month).padStart(2,"0")}`,year:O.year,month:O.month,income:O.income||[],total_income:O.total_income??0,previous_month_income:O.previous_month_income??0,expenses:O.expenses||[],total_expenses:O.total_expenses??0,transfers:O.transfers||[],adjustments:O.adjustments||[],account_balances:O.account_balances||[],category_balances:O.category_balances||[],are_allocations_finalized:O.are_allocations_finalized??!1,created_at:O.created_at,updated_at:O.updated_at}}).sort((A,O)=>A.year!==O.year?A.year-O.year:A.month-O.month);if(f({status:"finding_months",monthsFound:x.length}),x.length===0){f({status:"done",monthsFound:0,monthsProcessed:0,totalIncomeRecalculated:0,totalExpensesRecalculated:0});return}const w=x[0];let E=vm;if(w){const A={},O={};for(const N of w.category_balances||[])Je(N.category_id)||(A[N.category_id]=Me(N.start_balance??0));for(const N of w.account_balances||[])We(N.account_id)||(O[N.account_id]=Me(N.start_balance??0));E={categoryEndBalances:A,accountEndBalances:O,totalIncome:Me(w.previous_month_income??0)}}f({status:"processing_months",monthsFound:x.length,currentMonthIndex:0});const T=[];let R=0,M=0;for(let A=0;A<x.length;A++){const O=x[A],N=`${$u[O.month-1]} ${O.year}`;f({status:"processing_months",monthsFound:x.length,currentMonthIndex:A,currentMonthLabel:N});const J=Gu(O,E);T.push(J),R+=J.total_income,M+=J.total_expenses,E=tc(J)}if(f({status:"updating_budget",monthsFound:x.length,monthsProcessed:x.length}),T.length>0){const A=T.map(O=>({collectionPath:"months",docId:Ti(n,O.year,O.month),data:Ai({...O,updated_at:new Date().toISOString()})}));await mm(A,"recalculate all: batch write months");for(const O of T)Be.setQueryData(Te.month(n,O.year,O.month),{month:O})}f({status:"updating_budget",monthsFound:x.length,monthsProcessed:x.length,totalIncomeRecalculated:R,totalExpensesRecalculated:M});const V=E.accountEndBalances,$=E.categoryEndBalances,I=T[T.length-1],D=Object.keys(r),P=await q0(n,D,$,I.year,I.month),q=Be.getQueryData(Te.budget(n))?.budget?.month_map||{};await AT(n,V,P,q),f({status:"done",monthsFound:x.length,monthsProcessed:x.length,totalIncomeRecalculated:R,totalExpensesRecalculated:M})}catch(C){const x=C instanceof Error?C.message:"Failed to recalculate";console.error("[RecalculateAllButton] Recalculate error:",C),f({status:"error",error:x}),qn.add({type:"error",message:`Recalculation failed: ${x}`,autoDismissMs:1e4})}finally{o(!1)}}}function v(){d(!1),f(null),e?.()}return u.jsxs(u.Fragment,{children:[u.jsxs("button",{onClick:p,disabled:t||i,style:{background:"color-mix(in srgb, currentColor 15%, transparent)",border:"1px solid rgba(255,255,255,0.2)",borderRadius:"6px",padding:"0.4rem 0.75rem",cursor:t||i?"not-allowed":"pointer",opacity:t||i?.5:1,fontSize:"0.9rem",fontWeight:500,display:"flex",alignItems:"center",justifyContent:"center",gap:"0.4rem",transition:"all 0.15s ease"},onMouseEnter:_=>{!t&&!i&&(_.currentTarget.style.background="color-mix(in srgb, currentColor 20%, transparent)",_.currentTarget.style.borderColor="rgba(255,255,255,0.3)")},onMouseLeave:_=>{!t&&!i&&(_.currentTarget.style.background="color-mix(in srgb, currentColor 15%, transparent)",_.currentTarget.style.borderColor="rgba(255,255,255,0.2)")},title:"Recalculate all months from the beginning",children:[i?"":""," Recalculate"]}),u.jsx(qB,{isOpen:l,onClose:v,onProceed:g,results:h})]})}function G1({direction:t,isDisabled:e,isLoading:n,disabledReason:r,onNavigate:i}){const[o,l]=k.useState(!1),d=n||e,h=t==="prev"?"":"",f=t==="prev"?"Previous month":"Next month",p=()=>{n||(e?(l(!0),setTimeout(()=>l(!1),2e3)):i())};return u.jsxs("div",{style:{position:"relative"},children:[u.jsx("button",{onClick:p,onMouseEnter:()=>e&&l(!0),onMouseLeave:()=>l(!1),style:{background:"color-mix(in srgb, currentColor 10%, transparent)",border:"none",borderRadius:"8px",padding:"0.75rem 1rem",cursor:d?"not-allowed":"pointer",fontSize:"1.25rem",opacity:d?.5:1,transition:"opacity 0.15s, background 0.15s"},title:e?void 0:f,children:h}),o&&e&&u.jsx("div",{style:{position:"absolute",top:"100%",...t==="prev"?{left:0}:{right:0},marginTop:"0.5rem",padding:"0.5rem 0.75rem",background:fe.warning,color:"#000",borderRadius:"6px",fontSize:"0.75rem",fontWeight:500,width:"max-content",maxWidth:"min(300px, 50vw)",textAlign:"center",zIndex:20,boxShadow:"0 2px 8px rgba(0,0,0,0.3)"},children:r})]})}function HB({pickerYear:t,pickerMonth:e,currentYear:n,currentMonthNumber:r,minOrdinal:i,maxOrdinal:o,minAllowed:l,maxAllowed:d,onYearChange:h,onMonthChange:f,onGo:p}){const g=t>l.year,v=t<d.year,_=Number(et(t,e)),C=_>=i&&_<=o;return u.jsxs("div",{style:{padding:"0.75rem",borderTop:"1px solid color-mix(in srgb, currentColor 15%, transparent)",marginTop:"0.25rem"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.5rem"},children:[u.jsx("button",{onClick:()=>h(t-1),disabled:!g,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",border:"none",borderRadius:"4px",padding:"0.25rem 0.5rem",cursor:g?"pointer":"not-allowed",fontSize:"0.8rem",opacity:g?1:.3},title:g?"Previous year":"Cannot go further back",children:""}),u.jsx("span",{style:{flex:1,textAlign:"center",fontSize:"0.9rem",fontWeight:500},children:t}),u.jsx("button",{onClick:()=>h(t+1),disabled:!v,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",border:"none",borderRadius:"4px",padding:"0.25rem 0.5rem",cursor:v?"pointer":"not-allowed",fontSize:"0.8rem",opacity:v?1:.3},title:v?"Next year":"Cannot go further ahead",children:""})]}),u.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"0.25rem",marginBottom:"0.5rem"},children:$u.map((x,w)=>{const E=w+1,T=E===e,R=t===n&&E===r,M=Number(et(t,E)),V=M<i,$=M>o,I=V||$;let D=x;return V?D="Too far in the past":$&&(D="Too far in the future"),u.jsx("button",{onClick:()=>f(E),disabled:I,style:{background:T?fe.primary:"color-mix(in srgb, currentColor 8%, transparent)",border:R?`1px solid ${fe.primary}`:"1px solid transparent",borderRadius:"4px",padding:"0.35rem 0.25rem",cursor:I?"not-allowed":"pointer",fontSize:"0.7rem",color:T?"#fff":"inherit",opacity:I?.3:1,transition:"background 0.15s"},title:D,children:x.slice(0,3)},E)})}),u.jsxs("button",{onClick:p,disabled:!C,style:{width:"100%",background:C?fe.primary:"color-mix(in srgb, currentColor 20%, transparent)",border:"none",borderRadius:"6px",padding:"0.5rem",cursor:C?"pointer":"not-allowed",fontSize:"0.85rem",color:C?"#fff":"inherit",fontWeight:500,opacity:C?1:.5},children:["Go to ",$u[e-1]," ",t]})]})}function GB({isOpen:t,onClose:e,year:n,month:r,isDeleting:i,onConfirm:o}){return u.jsxs(hs,{isOpen:t,onClose:e,title:" Delete Month?",children:[u.jsx("div",{style:{background:"color-mix(in srgb, #ef4444 15%, transparent)",border:"1px solid color-mix(in srgb, #ef4444 40%, transparent)",borderRadius:"8px",padding:"1rem",marginBottom:"1rem"},children:u.jsxs("p",{style:{margin:0,color:"#fca5a5",fontWeight:500,fontSize:"0.95rem"},children:[" This will permanently delete ",$u[r-1]," ",n,"!"]})}),u.jsx("p",{style:{margin:"0 0 0.75rem",opacity:.9},children:"This month document and all its data (income, expenses, allocations) will be permanently deleted."}),u.jsx("p",{style:{margin:"0 0 1rem",opacity:.8,fontSize:"0.9rem"},children:"After deletion, you will be navigated to the previous month."}),u.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[u.jsx(Ve,{variant:"secondary",actionName:"Cancel Delete Month",onClick:e,disabled:i,children:"Cancel"}),u.jsx(Ve,{variant:"danger",actionName:"Confirm Delete Month",onClick:o,disabled:i,children:i?"Deleting...":" Delete Month"})]})]})}function WB(){const t=new Date;let e=t.getFullYear(),n=t.getMonth()+1+Ws;for(;n>12;)n-=12,e+=1;return{year:e,month:n}}function QB(){const t=new Date;let e=t.getFullYear(),n=t.getMonth()+1-qu;for(;n<1;)n+=12,e-=1;return{year:e,month:n}}function KB(t){return Object.keys(t).sort()[0]}function YB(t){const e=parseInt(t.slice(0,4),10),n=parseInt(t.slice(4,6),10);return{year:e,month:n}}function XB(t){const e=QB(),n=KB(t);if(!n)return e;const r=et(e.year,e.month);return n<r?YB(n):e}function W1(t,e){return e===1?{year:t-1,month:12}:{year:t,month:e-1}}function ZB(t,e){return e===12?{year:t+1,month:1}:{year:t,month:e+1}}function JB({onPreviousMonth:t,onNextMonth:e}){const{isLoading:n}=On(),{currentYear:r,currentMonthNumber:i,isAdmin:o,selectedBudgetId:l,setCurrentYear:d,setCurrentMonthNumber:h}=Xe(),{budget:f,monthMap:p}=jn(),{month:g}=Ks(l,r,i),v=W1(r,i),_=ZB(r,i),C=XB(p),x=WB(),w=Number(et(C.year,C.month)),E=Number(et(x.year,x.month)),T=Number(et(v.year,v.month)),R=Number(et(_.year,_.month)),M=T<w,V=R>E,[$,I]=k.useState(!1),[D,P]=k.useState(!1),[L,q]=k.useState(r),[A,O]=k.useState(i),[N,J]=k.useState(!1),[Y,G]=k.useState(!1),Z=k.useRef(null),Q=(()=>{if(!p||Object.keys(p).length===0)return!1;const ie=et(r,i),be=Math.max(...Object.keys(p).map(Number));return Number(ie)===be})(),{trackChange:te}=hd();async function z(){if(l){G(!0);try{const ie=Ti(l,r,i);l4(l,r,i,te),await Oy("months",ie,`deleting month ${r}/${i}`),`${r}${i}`,Be.removeQueries({queryKey:Te.month(l,r,i)});const be=W1(r,i);J(!1),I(!1),window.location.href=`/budget/${be.year}/${be.month}/categories`}catch(ie){console.error("Failed to delete month:",ie),alert(`Failed to delete month: ${ie instanceof Error?ie.message:"Unknown error"}`)}finally{G(!1)}}}k.useEffect(()=>{if(!$)return;function ie(be){Z.current&&!Z.current.contains(be.target)&&(I(!1),P(!1))}return document.addEventListener("mousedown",ie),()=>document.removeEventListener("mousedown",ie)},[$]);function H(){D||(q(r),O(i)),P(!D)}function re(){d(L),h(A),P(!1),I(!1)}async function ne(){if(!g||!f)return;const ie=new Date,Ce=`${ie.toISOString().split("T")[0]}_month_${r}_${String(i).padStart(2,"0")}`,ce=new Am,ge=[{name:`${Ce}_income.json`,data:g.income||[]},{name:`${Ce}_expenses.json`,data:g.expenses||[]},{name:`${Ce}_transfers.json`,data:g.transfers||[]},{name:`${Ce}_adjustments.json`,data:g.adjustments||[]},{name:`${Ce}_account_balances.json`,data:g.account_balances||[]},{name:`${Ce}_category_balances.json`,data:g.category_balances||[]}],Oe={budget_id:f.id,budget_name:f.name,year_month_ordinal:g.year_month_ordinal,year:g.year,month:g.month,total_income:g.total_income,previous_month_income:g.previous_month_income,total_expenses:g.total_expenses,are_allocations_finalized:g.are_allocations_finalized,created_at:g.created_at,updated_at:g.updated_at,downloaded_at:ie.toISOString()};ge.push({name:`${Ce}_metadata.json`,data:Oe});for(const U of ge)ce.file(U.name,JSON.stringify(U.data,null,2));const ze=await ce.generateAsync({type:"blob"}),ot=URL.createObjectURL(ze),st=document.createElement("a");st.href=ot,st.download=`${Ce}.zip`,document.body.appendChild(st),st.click(),document.body.removeChild(st),URL.revokeObjectURL(ot),I(!1)}return u.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"1rem",marginBottom:"1.5rem",padding:"1rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"12px"},children:[u.jsx(G1,{direction:"prev",isDisabled:M,isLoading:n,disabledReason:"Cannot create months more than 3 months into the past",onNavigate:t}),u.jsxs("div",{ref:Z,style:{textAlign:"center",minWidth:"180px",position:"relative"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"flex-start",justifyContent:"center",gap:"0.25rem"},children:[u.jsxs("h2",{style:{margin:0,fontSize:"1.5rem"},children:[$u[i-1]," ",r]}),u.jsx("button",{onClick:()=>I(!$),style:{background:"transparent",border:"none",cursor:"pointer",fontSize:"0.5rem",opacity:.4,padding:"0.15rem",borderRadius:"4px",transition:"opacity 0.15s, transform 0.15s",transform:$?"rotate(180deg)":"rotate(0deg)",marginTop:"0.25rem"},title:"Month options",children:""})]}),n&&u.jsxs(u.Fragment,{children:[u.jsx("style",{children:"@keyframes spin { to { transform: rotate(360deg); } }"}),u.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0.4rem",marginTop:"0.35rem"},children:[u.jsx("span",{style:{display:"inline-block",width:"14px",height:"14px",border:"2px solid color-mix(in srgb, currentColor 20%, transparent)",borderTopColor:fe.primary,borderRadius:"50%",animation:"spin 0.8s linear infinite"}}),u.jsx("span",{style:{fontSize:"0.8rem",opacity:.6},children:"Loading..."})]})]}),$&&u.jsxs("div",{style:{position:"absolute",top:"100%",left:"50%",transform:"translateX(-50%)",marginTop:"0.5rem",background:"var(--background, #242424)",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",borderRadius:"8px",padding:"0.25rem",zIndex:100,minWidth:"160px",boxShadow:"0 4px 12px rgba(0,0,0,0.3)"},children:[u.jsx(e_,{isDisabled:n,onCloseMenu:()=>I(!1)}),u.jsx("button",{onClick:H,style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%",background:"transparent",border:"none",borderRadius:"6px",padding:"0.5rem 0.75rem",cursor:"pointer",fontSize:"0.85rem",color:"inherit",textAlign:"left",transition:"background 0.15s"},title:"Jump to a specific month",children:" Go to Month"}),D&&u.jsx(HB,{pickerYear:L,pickerMonth:A,currentYear:r,currentMonthNumber:i,minOrdinal:w,maxOrdinal:E,minAllowed:C,maxAllowed:x,onYearChange:q,onMonthChange:O,onGo:re}),o&&g&&u.jsx("button",{onClick:()=>{ne()},style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%",background:"transparent",border:"none",borderRadius:"6px",padding:"0.5rem 0.75rem",cursor:"pointer",fontSize:"0.85rem",color:"inherit",textAlign:"left",transition:"background 0.15s"},title:"Download month document as JSON (for debugging)",children:" Download JSON"}),o&&g&&Q&&u.jsx("button",{onClick:()=>J(!0),style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%",background:"transparent",border:"none",borderRadius:"6px",padding:"0.5rem 0.75rem",cursor:"pointer",fontSize:"0.85rem",color:"#ef4444",textAlign:"left",transition:"background 0.15s"},title:"Delete this month (last month only)",children:" Delete Month"})]})]}),u.jsx(G1,{direction:"next",isDisabled:V,isLoading:n,disabledReason:"Cannot create months more than 3 months into the future",onNavigate:e}),u.jsx(GB,{isOpen:N,onClose:()=>J(!1),year:r,month:i,isDeleting:Y,onConfirm:z})]})}const t_={cursor:"pointer",fontSize:"0.9rem",padding:"0.35rem 0.5rem",borderRadius:"4px"},ez={...t_,background:fe.primary,border:"none",color:"white"},tz={...t_,background:"transparent",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)"},nz={...t_,background:"transparent",border:`1px solid ${fe.errorBorder}`,color:fe.error},Q1=t=>({display:"flex",alignItems:"center",justifyContent:"center",width:"2.25rem",height:"100%",minHeight:"2.25rem",background:t?`color-mix(in srgb, ${fe.error} 15%, transparent)`:`color-mix(in srgb, ${fe.success} 15%, transparent)`,border:`1px solid ${t?fe.errorBorder:"rgba(74, 222, 128, 0.4)"}`,borderRadius:"4px 0 0 4px",cursor:"pointer",fontSize:"1rem",fontWeight:600,color:t?fe.error:fe.success,transition:"all 0.15s ease",flexShrink:0});function n_({accounts:t,accountGroups:e,categories:n,categoryGroups:r,payees:i,initialData:o,defaultAccountId:l,defaultDate:d,config:h,onSubmit:f,onCancel:p,onDelete:g,extraContent:v}){const{isWide:_}=zT(),{showCategory:C=!1,showCleared:x=!1,showSignToggle:w=!1,accountLabel:E="Account",payeePlaceholder:T="Payee name",descriptionPlaceholder:R="Optional note",submitLabel:M}=h,V=new Date().toISOString().split("T")[0],[$,I]=k.useState(o?.date||d||V),[D,P]=k.useState(o?.payee||""),[L,q]=k.useState(o?.categoryId||(h.showNoCategoryOption?Xt:"")),[A,O]=k.useState(o?.accountId||l||(h.showNoAccountOption?Gt:t[0]?t[0][0]:"")),N=o?.amount!==void 0?Math.abs(o.amount):void 0,[J,Y]=k.useState(N?.toString()||""),[G,Z]=k.useState(o?.description||""),[Q,te]=k.useState(o?.cleared||!1),[z,H]=k.useState(()=>w?o?.amount!==void 0?o.amount<0:!1:!0),[re,ne]=k.useState(!1),ie={},be=[];t.forEach(([we,ae])=>{ae.account_group_id?(ie[ae.account_group_id]||(ie[ae.account_group_id]=[]),ie[ae.account_group_id].push([we,ae])):be.push([we,ae])});function Ce(we){we.preventDefault();const ae=parseFloat(J);if(isNaN(ae)||ae<=0||C&&!L||!A||!$)return;if(L===Xt&&A===Gt){ne(!0);return}ne(!1);const De=w&&z?-ae:ae;f({date:$,payee:D.trim()||void 0,categoryId:C?L:void 0,accountId:A,amount:De,description:G.trim()||void 0,cleared:x?Q:void 0})}!(L===Xt&&A===Gt)&&re&&ne(!1);const ze=h.showNoAccountOption?u.jsx(BT,{id:"txn-account",value:A,onChange:O,accounts:t,accountGroups:e,placeholder:Ma,required:!0,showNoAccountOption:!0}):u.jsxs(Qu,{id:"txn-account",value:A,onChange:we=>O(we.target.value),required:!0,style:{fontSize:"0.85rem",padding:"0.5rem"},children:[Object.entries(e).map(([we,ae])=>{const je=ie[we];return je?.length?u.jsx("optgroup",{label:ae.name,children:je.map(([Ne,De])=>u.jsx("option",{value:Ne,children:De.nickname},Ne))},we):null}),be.length>0&&u.jsx("optgroup",{label:"Other",children:be.map(([we,ae])=>u.jsx("option",{value:we,children:ae.nickname},we))})]}),ot=C&&n&&r?u.jsx(Nt,{label:"Category",htmlFor:"txn-category",children:u.jsx(PT,{id:"txn-category",value:L,onChange:q,categories:n,categoryGroups:r,placeholder:h.showNoCategoryOption?No:"Search...",required:!0,showNoCategoryOption:h.showNoCategoryOption})}):null,st=x?u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.25rem",paddingBottom:"0.35rem"},children:[u.jsx("label",{htmlFor:"txn-cleared",style:{fontSize:"0.75rem",opacity:.7,fontWeight:500},children:"Clr"}),u.jsx(Wr,{id:"txn-cleared",checked:Q,onChange:we=>te(we.target.checked)})]}):null,U=u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.25rem",paddingBottom:"0.1rem"},children:[u.jsx("span",{style:{fontSize:"0.75rem",opacity:.7,fontWeight:500},children:""}),u.jsxs("div",{style:{display:"flex",gap:"0.25rem"},children:[u.jsx("button",{type:"submit",title:M,style:ez,children:""}),u.jsx("button",{type:"button",onClick:()=>{p()},title:"Cancel",style:tz,children:""}),g&&u.jsx("button",{type:"button",onClick:()=>{g()},title:"Delete",style:nz,children:""})]})]}),de=re?u.jsx("div",{style:{background:`color-mix(in srgb, ${fe.error} 15%, transparent)`,border:`1px solid ${fe.errorBorder}`,borderRadius:"6px",padding:"0.5rem 0.75rem",fontSize:"0.85rem",color:fe.error},children:'Cannot select both "No Category" and "No Account"  at least one must be a real category or account.'}):null,ye=u.jsxs($a,{children:[u.jsx(Ve,{type:"submit",actionName:M,children:M}),u.jsx(Ve,{type:"button",variant:"secondary",actionName:"Cancel Transaction Form",onClick:p,children:"Cancel"}),g&&u.jsx(Ve,{type:"button",variant:"danger",actionName:"Delete Transaction",onClick:g,children:" Delete"})]}),ee=C&&n&&r,X={fontSize:"0.85rem",padding:"0.5rem"};if(!_)return u.jsxs(ji,{actionName:M,onSubmit:Ce,children:[u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:[u.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[u.jsx(Nt,{label:"Date",htmlFor:"txn-date",children:u.jsx(Nf,{id:"txn-date",value:$,onChange:we=>I(we.target.value),required:!0,autoFocus:!0})}),u.jsx(Nt,{label:w?z?"Amount (Expense)":"Amount (Refund)":"Amount",htmlFor:"txn-amount",children:w?u.jsxs("div",{className:"currency-with-sign",style:{display:"flex",alignItems:"stretch"},children:[u.jsx("button",{type:"button",onClick:()=>H(!z),style:Q1(z),title:z?"Click to make this a refund (+)":"Click to make this an expense (-)",children:z?"":"+"}),u.jsx("div",{style:{flex:1},children:u.jsx(Eo,{id:"txn-amount",value:J,onChange:Y,placeholder:"$0.00",required:!0,style:{borderTopLeftRadius:0,borderBottomLeftRadius:0,borderLeft:"none",color:z?fe.error:fe.success}})})]}):u.jsx(Eo,{id:"txn-amount",value:J,onChange:Y,placeholder:"$0.00",required:!0})})]}),u.jsx(Nt,{label:"Payee",htmlFor:"txn-payee",children:u.jsx(D1,{id:"txn-payee",value:D,onChange:P,payees:i,placeholder:T})}),ot,u.jsx(Nt,{label:E,htmlFor:"txn-account",children:ze}),u.jsx(Nt,{label:"Description (optional)",htmlFor:"txn-description",children:u.jsx(Ri,{id:"txn-description",value:G,onChange:we=>Z(we.target.value),placeholder:R})}),x&&u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx(Wr,{id:"txn-cleared-stacked",checked:Q,onChange:we=>te(we.target.checked)}),u.jsx("label",{htmlFor:"txn-cleared-stacked",style:{fontSize:"0.9rem",cursor:"pointer"},children:"Cleared (appeared in bank account)"})]}),de,v]}),ye]});const oe=w?"8.25rem":"6rem",Se=ee?x?`6rem minmax(8rem, 1fr) minmax(8rem, 1fr) minmax(8rem, 1fr) ${oe} minmax(10rem, 2fr) auto auto`:`6rem minmax(8rem, 1fr) minmax(8rem, 1fr) minmax(8rem, 1fr) ${oe} minmax(10rem, 2fr) auto`:x?`6rem minmax(10rem, 1fr) minmax(10rem, 1fr) ${oe} minmax(12rem, 2fr) auto auto`:`6rem minmax(10rem, 1fr) minmax(10rem, 1fr) ${oe} minmax(12rem, 2fr) auto`;return u.jsxs(ji,{actionName:M,onSubmit:Ce,children:[u.jsxs("div",{style:{display:"grid",gridTemplateColumns:Se,gap:"1rem",alignItems:"end"},children:[u.jsx(Nt,{label:"Date",htmlFor:"txn-date",children:u.jsx(Nf,{id:"txn-date",value:$,onChange:we=>I(we.target.value),required:!0,style:X,autoFocus:!0})}),u.jsx(Nt,{label:"Payee",htmlFor:"txn-payee",children:u.jsx(D1,{id:"txn-payee",value:D,onChange:P,payees:i,placeholder:T})}),ot,u.jsx(Nt,{label:E,htmlFor:"txn-account",children:ze}),u.jsx(Nt,{label:w?z?"Amount ()":"Amount (+)":"Amount",htmlFor:"txn-amount",children:w?u.jsxs("div",{className:"currency-with-sign",style:{display:"flex",alignItems:"stretch"},children:[u.jsx("button",{type:"button",onClick:()=>H(!z),style:Q1(z),title:z?"Click to make this a refund (+)":"Click to make this an expense (-)",children:z?"":"+"}),u.jsx("div",{style:{flex:1},children:u.jsx(Eo,{id:"txn-amount",value:J,onChange:Y,placeholder:"$0.00",required:!0,style:{borderTopLeftRadius:0,borderBottomLeftRadius:0,borderLeft:"none",color:z?fe.error:fe.success}})})]}):u.jsx(Eo,{id:"txn-amount",value:J,onChange:Y,placeholder:"$0.00",required:!0})}),u.jsx(Nt,{label:"Description",htmlFor:"txn-description",children:u.jsx(Ri,{id:"txn-description",value:G,onChange:we=>Z(we.target.value),placeholder:R,style:X})}),st,U]}),de,v]})}function K1({accounts:t,accountGroups:e,payees:n,initialData:r,defaultAccountId:i,defaultDate:o,onSubmit:l,onCancel:d,onDelete:h,submitLabel:f}){function p(g){l(g.amount,g.accountId,g.date,g.payee,g.description)}return u.jsx(n_,{accounts:t,accountGroups:e,payees:n,initialData:r?{date:r.date,payee:r.payee,accountId:r.account_id,amount:r.amount,description:r.description}:void 0,defaultAccountId:i,defaultDate:o,config:{showCategory:!1,showCleared:!1,accountLabel:"Deposit To",payeePlaceholder:"e.g., Employer, Client name",descriptionPlaceholder:"e.g., January paycheck",submitLabel:f},onSubmit:p,onCancel:d,onDelete:h})}function rz({income:t,accountName:e,accountGroupName:n,onEdit:r,onDelete:i,isMobile:o,isEvenRow:l}){const d=t.date?new Date(t.date+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"}):"",h=n?`${n} / ${e}`:e,f=l?"transparent":"rgba(255,255,255,0.04)";if(o)return u.jsxs("div",{onClick:r,style:{gridColumn:"1 / -1",display:"grid",gridTemplateColumns:"1fr auto",gap:"0.5rem",padding:"0.75rem 1rem",background:f,cursor:"pointer",transition:"background 0.15s"},children:[u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{style:{fontSize:"0.75rem",opacity:.5,fontFamily:"monospace",minWidth:"3rem"},children:d}),u.jsx("span",{style:{fontWeight:500,fontSize:"0.9rem"},children:t.payee||""})]}),u.jsxs("span",{style:{fontSize:"0.75rem",opacity:.6},children:[" ",h]})]}),u.jsx("div",{style:{display:"flex",alignItems:"center"},children:u.jsxs("span",{style:{fontWeight:600,color:fe.success,fontFamily:"monospace"},children:["+",Vt(t.amount)]})})]});const p={padding:"0.6rem 0.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem"};return u.jsxs("div",{style:{gridColumn:"1 / -1",background:f,display:"grid",gridTemplateColumns:"5rem 1.5fr 7rem 1fr 6rem 1fr 3rem 4rem"},children:[u.jsx("div",{style:{...p,fontSize:"0.85rem",fontFamily:"monospace"},children:u.jsx("span",{style:{opacity:.6},children:d})}),u.jsx("div",{style:{...p,fontWeight:500,overflow:"hidden"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.payee||""})}),u.jsx("div",{style:{...p,overflow:"hidden"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.85rem",opacity:.7},children:h})}),u.jsxs("div",{style:{...p,justifyContent:"flex-end",fontWeight:600,color:fe.success,fontFamily:"monospace"},children:["+",Vt(t.amount)]}),u.jsx("div",{style:{...p,paddingLeft:"0.5rem",overflow:"hidden"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.8rem",opacity:.6},children:t.description||""})}),u.jsxs("div",{style:{...p,justifyContent:"flex-end",gap:"0.25rem"},children:[u.jsx("button",{onClick:r,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:g=>g.currentTarget.style.opacity="1",onMouseLeave:g=>g.currentTarget.style.opacity="0.5",title:"Edit",children:""}),u.jsx("button",{onClick:i,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:g=>g.currentTarget.style.opacity="1",onMouseLeave:g=>g.currentTarget.style.opacity="0.5",title:"Delete",children:""})]})]})}const Dl={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderTop:"1px solid rgba(255,255,255,0.1)"};function sz(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n,setCurrentYear:r,setCurrentMonthNumber:i}=Xe(),{accounts:o,accountGroups:l}=jn(),{month:d,isLoading:h}=Ks(t,e,n),{addIncome:f}=qP(),{updateIncome:p}=GP(),{deleteIncome:g}=WP(),v=ki(),[_,C]=k.useState(null),[x,w]=k.useState(!1),[E,T]=k.useState(null),V=V0(t,{enabled:x||E!==null}).data||[];function $(G){const Z=G.account_group_id?l[G.account_group_id]:void 0;return Z&&Z.is_active!==null?Z.is_active:G.is_active!==!1}function I(G){const Z=G.account_group_id?l[G.account_group_id]:void 0;return Z&&Z.on_budget!==null?Z.on_budget:G.on_budget!==!1}const D=Object.entries(o).filter(([,G])=>$(G)&&I(G)),P=D.filter(([,G])=>G.is_income_account),L=P.length>0?P:D,q=D.find(([,G])=>G.is_income_default),A=q?q[0]:void 0,O=d?.income.reduce((G,Z)=>G+Z.amount,0)||0;function N(G,Z,Q,te,z){if(!t)return;C(null),w(!1);const{year:H,month:re}=gm(Q);(H!==e||re!==n)&&(r(H),i(re)),f(t,H,re,G,Z,Q,te,z).catch(ne=>{C(ne instanceof Error?ne.message:"Failed to add income")})}function J(G,Z,Q,te,z,H){t&&(C(null),T(null),p(t,e,n,G,Z,Q,te,z,H).catch(re=>{C(re instanceof Error?re.message:"Failed to update income")}))}function Y(G){t&&confirm("Are you sure you want to delete this income entry?")&&(C(null),g(t,e,n,G).catch(Z=>{C(Z instanceof Error?Z.message:"Failed to delete income")}))}return u.jsxs("div",{style:{opacity:h?.5:1,transition:"opacity 0.15s ease-out",pointerEvents:h?"none":"auto"},children:[_&&u.jsx("div",{style:{background:`color-mix(in srgb, ${fe.error} 15%, transparent)`,border:`1px solid ${fe.error}`,borderRadius:"8px",padding:"0.75rem",marginBottom:"1rem",color:fe.error},children:_}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:v?"1fr":"5rem 1.5fr 2fr 7rem 1.5fr 3rem"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"#242424",borderBottom:"1px solid rgba(255,255,255,0.15)",display:v?"block":"grid",gridTemplateColumns:v?void 0:"subgrid"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem"},children:[u.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[u.jsx("span",{style:{fontWeight:600},children:"Income:"}),u.jsx("span",{style:{opacity:.6,fontSize:"0.8rem"},children:"Incoming money that should be factored into income calculations"}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"Total: "}),u.jsx("span",{style:{color:ct(O),fontWeight:600},children:Vt(O)})]})]}),u.jsx("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:!x&&u.jsx(Ve,{actionName:"Open Add Income Form",onClick:()=>w(!0),disabled:L.length===0,disabledReason:Object.keys(o).length===0?"Create an account first":"Set up an income account first",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:"+ Add Income"})})]}),!v&&u.jsxs(u.Fragment,{children:[u.jsx("div",{style:Dl,children:"Date"}),u.jsx("div",{style:Dl,children:"Payee"}),u.jsx("div",{style:Dl,children:"Account"}),u.jsx("div",{style:{...Dl,textAlign:"right"},children:"Amount"}),u.jsx("div",{style:Dl,children:"Description"}),u.jsx("div",{style:Dl})]})]}),u.jsx("div",{style:{gridColumn:"1 / -1",fontSize:"0.8rem",opacity:.55,fontStyle:"italic",padding:"0.5rem 0"},children:" All income entries on this page count towards the tithing owed calculation."}),L.length===0&&u.jsx(Ku,{message:Object.keys(o).length===0?"You need to create at least one account before adding income.":'No accounts are set up for income deposits. Edit an account and enable "Show in income deposit list".',linkText:"Manage accounts",linkTo:"/budget/settings/accounts"}),x&&u.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"1rem"},children:u.jsx(K1,{accounts:L,accountGroups:l,payees:V,defaultAccountId:A,defaultDate:pm(e,n),onSubmit:N,onCancel:()=>w(!1),submitLabel:"Add Income",isMobile:v})}),d?.income.slice().sort((G,Z)=>(G.date||"").localeCompare(Z.date||"")).map((G,Z)=>E===G.id?u.jsx("div",{style:{gridColumn:"1 / -1",padding:"0.5rem"},children:u.jsx(K1,{accounts:L,accountGroups:l,payees:V,initialData:G,onSubmit:(Q,te,z,H,re)=>J(G.id,Q,te,z,H,re),onCancel:()=>T(null),onDelete:()=>Y(G.id),submitLabel:"Save",isMobile:v})},G.id):u.jsx(rz,{income:G,accountName:We(G.account_id)?Ma:o[G.account_id]?.nickname||"Unknown Account",accountGroupName:We(G.account_id)?void 0:o[G.account_id]?.account_group_id?l[o[G.account_id].account_group_id]?.name:void 0,onEdit:()=>{G.payee||`${G.amount}`,T(G.id)},onDelete:()=>Y(G.id),isMobile:v,isEvenRow:Z%2===0},G.id)),(!d?.income||d.income.length===0)&&!x&&u.jsx("p",{style:{gridColumn:"1 / -1",opacity:.5,fontSize:"0.9rem",textAlign:"center",padding:"1.5rem"},children:"No income recorded for this month"}),u.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]})]})}function Y1({accounts:t,accountGroups:e,categories:n,categoryGroups:r,payees:i,initialData:o,defaultAccountId:l,defaultDate:d,onSubmit:h,onCancel:f,onDelete:p,submitLabel:g}){function v(_){h(_.amount,_.categoryId,_.accountId,_.date,_.payee,_.description,_.cleared)}return u.jsx(n_,{accounts:t,accountGroups:e,categories:n,categoryGroups:r,payees:i,initialData:o?{date:o.date,payee:o.payee,categoryId:o.category_id,accountId:o.account_id,amount:o.amount,description:o.description,cleared:o.cleared}:void 0,defaultAccountId:l,defaultDate:d,config:{showCategory:!0,showCleared:!0,showNoCategoryOption:!1,showNoAccountOption:!1,showSignToggle:!0,accountLabel:"Pay From",payeePlaceholder:"e.g., Grocery Store",descriptionPlaceholder:"e.g., Weekly groceries",submitLabel:g},onSubmit:v,onCancel:f,onDelete:p})}function iz({expense:t,categoryName:e,accountName:n,accountGroupName:r,onEdit:i,onDelete:o,isMobile:l,isEvenRow:d}){const h=t.date?new Date(t.date+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"}):"",f=r?`${r} / ${n}`:n,p=d?"transparent":"rgba(255,255,255,0.04)";if(l)return u.jsxs("div",{onClick:i,style:{gridColumn:"1 / -1",display:"grid",gridTemplateColumns:"1fr auto",gap:"0.5rem",padding:"0.75rem 1rem",background:p,cursor:"pointer",transition:"background 0.15s"},children:[u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{style:{fontSize:"0.75rem",opacity:.5,fontFamily:"monospace",minWidth:"3rem"},children:h}),u.jsx("span",{style:{fontWeight:500,fontSize:"0.9rem"},children:t.payee||""}),t.cleared&&u.jsx("span",{style:{fontSize:"0.7rem",color:fe.success},title:"Cleared",children:""})]}),u.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap"},children:[u.jsx("span",{style:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px"},children:e}),u.jsxs("span",{style:{fontSize:"0.75rem",opacity:.6},children:[" ",f]})]})]}),u.jsx("div",{style:{display:"flex",alignItems:"center"},children:u.jsx("span",{style:{fontWeight:600,color:ct(t.amount),fontFamily:"monospace"},children:Bt(t.amount)})})]});const g={padding:"0.6rem 0.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem"};return u.jsxs("div",{style:{gridColumn:"1 / -1",background:p,display:"grid",gridTemplateColumns:"5rem 1.5fr 7rem 1fr 6rem 1fr 3rem 4rem"},children:[u.jsx("div",{style:{...g,fontSize:"0.85rem",fontFamily:"monospace"},children:u.jsx("span",{style:{opacity:.6},children:h})}),u.jsx("div",{style:{...g,fontWeight:500,overflow:"hidden"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.payee||""})}),u.jsx("div",{style:{...g,justifyContent:"center"},children:u.jsx("span",{style:{fontSize:"0.8rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e})}),u.jsx("div",{style:{...g,overflow:"hidden"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.85rem",opacity:.7},children:f})}),u.jsx("div",{style:{...g,justifyContent:"flex-end",fontWeight:600,color:ct(t.amount),fontFamily:"monospace"},children:Bt(t.amount)}),u.jsx("div",{style:{...g,paddingLeft:"0.5rem",overflow:"hidden"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.8rem",opacity:.6},children:t.description||""})}),u.jsx("div",{style:{...g,justifyContent:"center",color:t.cleared?fe.success:"inherit",opacity:t.cleared?1:.3,fontSize:"1rem"},children:t.cleared?"":""}),u.jsxs("div",{style:{...g,justifyContent:"flex-end",gap:"0.25rem"},children:[u.jsx("button",{onClick:i,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:v=>v.currentTarget.style.opacity="1",onMouseLeave:v=>v.currentTarget.style.opacity="0.5",title:"Edit",children:""}),u.jsx("button",{onClick:o,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:v=>v.currentTarget.style.opacity="1",onMouseLeave:v=>v.currentTarget.style.opacity="0.5",title:"Delete",children:""})]})]})}const da={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderTop:"1px solid rgba(255,255,255,0.1)"};function az(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n,setCurrentYear:r,setCurrentMonthNumber:i}=Xe(),{accounts:o,accountGroups:l,categories:d,categoryGroups:h}=jn(),{month:f,isLoading:p}=Ks(t,e,n),{addExpense:g}=KP(),{updateExpense:v}=XP(),{deleteExpense:_}=ZP(),C=ki(),[x,w]=k.useState(null),[E,T]=k.useState(!1),[R,M]=k.useState(null),I=V0(t,{enabled:E||R!==null}).data||[];function D(Q){const te=Q.account_group_id?l[Q.account_group_id]:void 0;return te&&te.is_active!==null?te.is_active:Q.is_active!==!1}function P(Q){const te=Q.account_group_id?l[Q.account_group_id]:void 0;return te&&te.on_budget!==null?te.on_budget:Q.on_budget!==!1}const L=Object.entries(o).filter(([,Q])=>D(Q)&&P(Q)),q=L.filter(([,Q])=>Q.is_outgo_account),A=q.length>0?q:L,O=L.find(([,Q])=>Q.is_outgo_default),N=O?O[0]:void 0,J=f?.expenses?.reduce((Q,te)=>Q+te.amount,0)||0;function Y(Q,te,z,H,re,ne,ie){if(!t)return;w(null),T(!1);const{year:be,month:Ce}=gm(H);(be!==e||Ce!==n)&&(r(be),i(Ce)),g(t,be,Ce,Q,te,z,H,re,ne,ie).catch(ce=>{w(ce instanceof Error?ce.message:"Failed to add expense")})}function G(Q,te,z,H,re,ne,ie,be){t&&(w(null),M(null),v(t,e,n,Q,te,z,H,re,ne,ie,be).catch(Ce=>{w(Ce instanceof Error?Ce.message:"Failed to update expense")}))}function Z(Q){t&&confirm("Are you sure you want to delete this expense?")&&(w(null),_(t,e,n,Q).catch(te=>{w(te instanceof Error?te.message:"Failed to delete expense")}))}return u.jsxs("div",{style:{opacity:p?.5:1,transition:"opacity 0.15s ease-out",pointerEvents:p?"none":"auto"},children:[x&&u.jsx("div",{style:{background:`color-mix(in srgb, ${fe.error} 15%, transparent)`,border:`1px solid ${fe.error}`,borderRadius:"8px",padding:"0.75rem",marginBottom:"1rem",color:fe.error},children:x}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:C?"1fr":"5rem 1.5fr 7rem 1fr 6rem 1fr 3rem 4rem"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"#242424",borderBottom:"1px solid rgba(255,255,255,0.15)",display:C?"block":"grid",gridTemplateColumns:C?void 0:"subgrid"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem"},children:[u.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[u.jsx("span",{style:{fontWeight:600},children:"Expenses:"}),u.jsx("span",{style:{opacity:.6,fontSize:"0.8rem"},children:"Transactions that should be factored into spend calculations"}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"Total: "}),u.jsx("span",{style:{color:ct(J),fontWeight:600},children:Bt(J)})]})]}),u.jsx("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:!E&&u.jsx(Ve,{actionName:"Open Add Expense Form",onClick:()=>T(!0),disabled:A.length===0||Object.keys(d).length===0,disabledReason:A.length===0&&Object.keys(d).length===0?"Create accounts and categories first":A.length===0?"Create an expense account first":"Create a category first",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:"+ Add Expense"})})]}),!C&&u.jsxs(u.Fragment,{children:[u.jsx("div",{style:da,children:"Date"}),u.jsx("div",{style:da,children:"Payee"}),u.jsx("div",{style:{...da,textAlign:"center"},children:"Category"}),u.jsx("div",{style:da,children:"Account"}),u.jsx("div",{style:{...da,textAlign:"right"},children:"Amount"}),u.jsx("div",{style:da,children:"Description"}),u.jsx("div",{style:{...da,textAlign:"center"},children:"Clr"}),u.jsx("div",{style:da})]})]}),A.length===0&&u.jsx(Ku,{message:Object.keys(o).length===0?"You need to create at least one account before adding expenses.":'No accounts are set up for expenses. Edit an account and enable "Show in expense list".',linkText:"Manage accounts",linkTo:"/budget/settings/accounts"}),Object.keys(d).length===0&&u.jsx(Ku,{message:"You need to create at least one category before adding expenses.",linkText:"Create categories",linkTo:"/budget/settings/categories"}),E&&u.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"1rem"},children:u.jsx(Y1,{accounts:A,accountGroups:l,categories:d,categoryGroups:h,payees:I,defaultAccountId:N,defaultDate:pm(e,n),onSubmit:Y,onCancel:()=>T(!1),submitLabel:"Add Expense",isMobile:C})}),f?.expenses?.slice().sort((Q,te)=>(Q.date||"").localeCompare(te.date||"")).map((Q,te)=>R===Q.id?u.jsx("div",{style:{gridColumn:"1 / -1",padding:"0.5rem"},children:u.jsx(Y1,{accounts:A,accountGroups:l,categories:d,categoryGroups:h,payees:I,initialData:Q,onSubmit:(z,H,re,ne,ie,be,Ce)=>G(Q.id,z,H,re,ne,ie,be,Ce),onCancel:()=>M(null),onDelete:()=>Z(Q.id),submitLabel:"Save",isMobile:C})},Q.id):u.jsx(iz,{expense:Q,categoryName:Je(Q.category_id)?No:d[Q.category_id]?.name||"Unknown Category",accountName:We(Q.account_id)?Ma:o[Q.account_id]?.nickname||"Unknown Account",accountGroupName:We(Q.account_id)?void 0:o[Q.account_id]?.account_group_id?l[o[Q.account_id].account_group_id]?.name:void 0,onEdit:()=>{Q.payee||`${Q.amount}`,M(Q.id)},onDelete:()=>Z(Q.id),isMobile:C,isEvenRow:te%2===0},Q.id)),(!f?.expenses||f.expenses.length===0)&&!E&&u.jsx("p",{style:{gridColumn:"1 / -1",opacity:.5,fontSize:"0.9rem",textAlign:"center",padding:"1.5rem"},children:"No expenses recorded for this month"}),u.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]})]})}const oz={background:fe.primary,border:"none",cursor:"pointer",fontSize:"0.9rem",padding:"0.35rem 0.5rem",borderRadius:"4px",color:"white"},lz={background:"transparent",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)",cursor:"pointer",fontSize:"0.9rem",padding:"0.35rem 0.5rem",borderRadius:"4px"},cz={background:"transparent",border:`1px solid ${fe.errorBorder}`,color:fe.error,cursor:"pointer",fontSize:"0.9rem",padding:"0.35rem 0.5rem",borderRadius:"4px"};function X1({accounts:t,accountGroups:e,categories:n,categoryGroups:r,initialData:i,defaultDate:o,onSubmit:l,onCancel:d,onDelete:h,submitLabel:f}){const{isWide:p}=zT(),g=new Date().toISOString().split("T")[0],[v,_]=k.useState(i?.date||o||g),[C,x]=k.useState(i?.amount?.toString()||""),[w,E]=k.useState(i?.from_account_id||Gt),[T,R]=k.useState(i?.to_account_id||Gt),[M,V]=k.useState(i?.from_category_id||Xt),[$,I]=k.useState(i?.to_category_id||Xt),[D,P]=k.useState(i?.description||""),[L,q]=k.useState(i?.cleared||!1),[A,O]=k.useState(null),N=M===Xt,J=$===Xt,Y=w===Gt,G=T===Gt;function Z(){return N&&J&&(Y&&G)?'A transfer must move between real categories or real accounts  not all "No" options.':Y!==G?'Both accounts must be real accounts, or both must be "No Account". Cannot transfer from a real account to nothing.':N!==J?'Both categories must be real categories, or both must be "No Category". Cannot transfer from a real category to nothing.':null}Z()===null&&A!==null&&O(null);function te(ce){ce.preventDefault();const ge=parseFloat(C);if(isNaN(ge)||ge<=0||!w||!T||!M||!$||!v)return;const Oe=Z();if(Oe){O(Oe);return}O(null),l(ge,w,T,M,$,v,D.trim()||void 0,L)}const z=A?u.jsx("div",{style:{background:`color-mix(in srgb, ${fe.error} 15%, transparent)`,border:`1px solid ${fe.errorBorder}`,borderRadius:"6px",padding:"0.5rem 0.75rem",fontSize:"0.85rem",color:fe.error,marginTop:"0.5rem"},children:A}):null,H=(ce,ge,Oe,ze)=>u.jsx(Nt,{label:ze,htmlFor:ce,children:u.jsx(BT,{id:ce,value:ge,onChange:Oe,accounts:t,accountGroups:e,placeholder:Ma,required:!0,showNoAccountOption:!0})}),re=(ce,ge,Oe,ze)=>u.jsx(Nt,{label:ze,htmlFor:ce,children:u.jsx(PT,{id:ce,value:ge,onChange:Oe,categories:n,categoryGroups:r,placeholder:No,required:!0,showNoCategoryOption:!0})}),ne=u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.25rem",paddingBottom:"0.35rem"},children:[u.jsx("label",{htmlFor:"transfer-cleared",style:{fontSize:"0.75rem",opacity:.7,fontWeight:500},children:"Clr"}),u.jsx(Wr,{id:"transfer-cleared",checked:L,onChange:ce=>q(ce.target.checked)})]}),ie=u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.25rem",paddingBottom:"0.1rem"},children:[u.jsx("span",{style:{fontSize:"0.75rem",opacity:.7,fontWeight:500},children:""}),u.jsxs("div",{style:{display:"flex",gap:"0.25rem"},children:[u.jsx("button",{type:"submit",title:f,style:oz,children:""}),u.jsx("button",{type:"button",onClick:()=>{d()},title:"Cancel",style:lz,children:""}),h&&u.jsx("button",{type:"button",onClick:()=>{h()},title:"Delete",style:cz,children:""})]})]}),be=u.jsxs($a,{children:[u.jsx(Ve,{type:"submit",actionName:f,children:f}),u.jsx(Ve,{type:"button",variant:"secondary",actionName:"Cancel Transfer Form",onClick:d,children:"Cancel"}),h&&u.jsx(Ve,{type:"button",variant:"danger",actionName:"Delete Transfer",onClick:h,children:" Delete"})]}),Ce={fontSize:"0.85rem",padding:"0.5rem"};return p?u.jsx(ji,{actionName:f,onSubmit:te,children:u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[u.jsxs("div",{style:{display:"grid",gridTemplateColumns:"5.5rem 5.5rem 1fr 1fr 1.5fr",gap:"0.75rem",alignItems:"end"},children:[u.jsx(Nt,{label:"Date",htmlFor:"transfer-date",children:u.jsx(Nf,{id:"transfer-date",value:v,onChange:ce=>_(ce.target.value),required:!0,style:Ce,autoFocus:!0})}),u.jsx(Nt,{label:"Amount",htmlFor:"transfer-amount",children:u.jsx(Eo,{id:"transfer-amount",value:C,onChange:x,placeholder:"$0.00",required:!0})}),re("from-category",M,V,"From Category"),H("from-account",w,E,"From Account"),u.jsx(Nt,{label:"Description",htmlFor:"transfer-description",children:u.jsx(Ri,{id:"transfer-description",value:D,onChange:ce=>P(ce.target.value),placeholder:"e.g., Transfer",style:Ce})})]}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:"5.5rem 5.5rem 1fr 1fr 1.5fr",gap:"0.75rem",alignItems:"end"},children:[u.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1.2rem",opacity:.5,paddingBottom:"0.5rem"},children:""}),u.jsx("div",{}),re("to-category",$,I,"To Category"),H("to-account",T,R,"To Account"),u.jsxs("div",{style:{display:"flex",gap:"0.75rem",alignItems:"end",paddingBottom:"0.25rem"},children:[ne,ie]})]}),z]})}):u.jsxs(ji,{actionName:f,onSubmit:te,children:[u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:[u.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[u.jsx(Nt,{label:"Date",htmlFor:"transfer-date",children:u.jsx(Nf,{id:"transfer-date",value:v,onChange:ce=>_(ce.target.value),required:!0,autoFocus:!0})}),u.jsx(Nt,{label:"Amount",htmlFor:"transfer-amount",children:u.jsx(Eo,{id:"transfer-amount",value:C,onChange:x,placeholder:"$0.00",required:!0})})]}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem",background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1rem",borderRadius:"8px"},children:[u.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"0.75rem",alignItems:"end"},children:[re("from-category",M,V,"From Cat."),H("from-account",w,E,"From Acct.")]}),u.jsx("div",{style:{display:"flex",justifyContent:"center",fontSize:"1.5rem",opacity:.5},children:""}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"0.75rem",alignItems:"end"},children:[re("to-category",$,I,"To Cat."),H("to-account",T,R,"To Acct.")]})]}),u.jsx(Nt,{label:"Description (optional)",htmlFor:"transfer-description",children:u.jsx(Ri,{id:"transfer-description",value:D,onChange:ce=>P(ce.target.value),placeholder:"e.g., Transfer to savings"})}),u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx(Wr,{id:"transfer-cleared-stacked",checked:L,onChange:ce=>q(ce.target.checked)}),u.jsx("label",{htmlFor:"transfer-cleared-stacked",style:{fontSize:"0.9rem",cursor:"pointer"},children:"Cleared (appeared in bank account)"})]}),z]}),be]})}function uz({transfer:t,fromCategoryName:e,toCategoryName:n,fromAccountName:r,toAccountName:i,fromAccountGroupName:o,toAccountGroupName:l,isFromCategoryNo:d,isToCategoryNo:h,isFromAccountNo:f,isToAccountNo:p,onEdit:g,onDelete:v,isMobile:_,isEvenRow:C}){const x=t.date?new Date(t.date+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"}):"",w=C?"transparent":"rgba(255,255,255,0.04)";if(_)return u.jsxs("div",{onClick:g,style:{gridColumn:"1 / -1",display:"flex",flexDirection:"column",gap:"0.5rem",padding:"0.75rem 1rem",background:w,cursor:"pointer",transition:"background 0.15s"},children:[u.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{style:{fontSize:"0.75rem",opacity:.5,fontFamily:"monospace",minWidth:"3rem"},children:x}),u.jsx("span",{style:{fontWeight:600,opacity:.8,fontFamily:"monospace"},children:Vt(t.amount)}),t.cleared&&u.jsx("span",{style:{fontSize:"0.7rem",color:fe.success},title:"Cleared",children:""})]})}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto 1fr",gap:"0.5rem",alignItems:"center"},children:[u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[u.jsx("span",{style:d?{fontSize:"0.7rem",opacity:.4}:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px",display:"inline-block",width:"fit-content"},children:e}),f?u.jsx("span",{style:{fontSize:"0.75rem",opacity:.4},children:r}):u.jsxs("div",{style:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px",display:"inline-flex",flexDirection:"column",gap:"0.1rem",width:"fit-content"},children:[o&&u.jsx("span",{style:{fontSize:"0.65rem",opacity:.6},children:o}),u.jsx("span",{children:r})]})]}),u.jsx("span",{style:{opacity:.5},children:""}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[u.jsx("span",{style:h?{fontSize:"0.7rem",opacity:.4}:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px",display:"inline-block",width:"fit-content"},children:n}),p?u.jsx("span",{style:{fontSize:"0.75rem",opacity:.4},children:i}):u.jsxs("div",{style:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px",display:"inline-flex",flexDirection:"column",gap:"0.1rem",width:"fit-content"},children:[l&&u.jsx("span",{style:{fontSize:"0.65rem",opacity:.6},children:l}),u.jsx("span",{children:i})]})]})]}),t.description&&u.jsx("div",{style:{fontSize:"0.75rem",opacity:.6},children:t.description})]});const E={padding:"0.6rem 0.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem"};return u.jsxs("div",{style:{gridColumn:"1 / -1",background:w,display:"grid",gridTemplateColumns:"5rem 1.5fr 7rem 1fr 6rem 1fr 3rem 4rem"},children:[u.jsx("div",{style:{...E,fontSize:"0.85rem",fontFamily:"monospace"},children:u.jsx("span",{style:{opacity:.6},children:x})}),u.jsx("div",{style:{...E,justifyContent:"flex-end",fontWeight:600,opacity:.8,fontFamily:"monospace"},children:Vt(t.amount)}),u.jsx("div",{style:{...E,justifyContent:"center"},children:u.jsx("span",{style:d?{fontSize:"0.8rem",opacity:.4}:{fontSize:"0.8rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e})}),u.jsx("div",{style:{...E,overflow:"hidden"},children:f?u.jsx("span",{style:{opacity:.4,fontSize:"0.85rem"},children:r}):u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.1rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden"},children:[o&&u.jsx("span",{style:{fontSize:"0.7rem",opacity:.6,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:o}),u.jsx("span",{style:{fontSize:"0.8rem",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:r})]})}),u.jsx("div",{style:{...E,justifyContent:"center",fontSize:"1rem"},children:u.jsx("span",{style:{opacity:.5},children:""})}),u.jsx("div",{style:{...E,justifyContent:"center"},children:u.jsx("span",{style:h?{fontSize:"0.8rem",opacity:.4}:{fontSize:"0.8rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:n})}),u.jsx("div",{style:{...E,overflow:"hidden"},children:p?u.jsx("span",{style:{opacity:.4,fontSize:"0.85rem"},children:i}):u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.1rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden"},children:[l&&u.jsx("span",{style:{fontSize:"0.7rem",opacity:.6,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:l}),u.jsx("span",{style:{fontSize:"0.8rem",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:i})]})}),u.jsx("div",{style:{...E,paddingLeft:"0.5rem",overflow:"hidden"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.8rem",opacity:.6},children:t.description||""})}),u.jsx("div",{style:{...E,justifyContent:"center",color:t.cleared?fe.success:"inherit",opacity:t.cleared?1:.3,fontSize:"1rem"},children:t.cleared?"":""}),u.jsxs("div",{style:{...E,justifyContent:"flex-end",gap:"0.25rem"},children:[u.jsx("button",{onClick:g,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:T=>T.currentTarget.style.opacity="1",onMouseLeave:T=>T.currentTarget.style.opacity="0.5",title:"Edit",children:""}),u.jsx("button",{onClick:v,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:T=>T.currentTarget.style.opacity="1",onMouseLeave:T=>T.currentTarget.style.opacity="0.5",title:"Delete",children:""})]})]})}const zs={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderTop:"1px solid rgba(255,255,255,0.1)"};function dz(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n,setCurrentYear:r,setCurrentMonthNumber:i}=Xe(),{accounts:o,accountGroups:l,categories:d,categoryGroups:h}=jn(),{month:f,isLoading:p}=Ks(t,e,n),{addTransfer:g}=eB(),{updateTransfer:v}=nB(),{deleteTransfer:_}=rB(),C=ki(),[x,w]=k.useState(null),[E,T]=k.useState(!1),[R,M]=k.useState(null);function V(A){const O=A.account_group_id?l[A.account_group_id]:void 0;return O&&O.is_active!==null?O.is_active:A.is_active!==!1}function $(A){const O=A.account_group_id?l[A.account_group_id]:void 0;return O&&O.on_budget!==null?O.on_budget:A.on_budget!==!1}const I=Object.entries(o).filter(([,A])=>V(A)&&$(A));function D(A,O,N,J,Y,G,Z,Q){if(!t)return;w(null),T(!1);const{year:te,month:z}=gm(G);(te!==e||z!==n)&&(r(te),i(z)),g(t,te,z,A,O,N,J,Y,G,Z,Q).catch(H=>{w(H instanceof Error?H.message:"Failed to add transfer")})}function P(A,O,N,J,Y,G,Z,Q,te){t&&(w(null),M(null),v(t,e,n,A,O,N,J,Y,G,Z,Q,te).catch(z=>{w(z instanceof Error?z.message:"Failed to update transfer")}))}function L(A){t&&confirm("Are you sure you want to delete this transfer?")&&(w(null),_(t,e,n,A).catch(O=>{w(O instanceof Error?O.message:"Failed to delete transfer")}))}const q=I.length>=1&&Object.keys(d).length>=1;return u.jsxs("div",{style:{opacity:p?.5:1,transition:"opacity 0.15s ease-out",pointerEvents:p?"none":"auto"},children:[x&&u.jsx("div",{style:{background:`color-mix(in srgb, ${fe.error} 15%, transparent)`,border:`1px solid ${fe.error}`,borderRadius:"8px",padding:"0.75rem",marginBottom:"1rem",color:fe.error},children:x}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:C?"1fr":"5rem 6rem 1fr 1fr 2rem 1fr 1fr 1fr 3rem 4rem"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"#242424",borderBottom:"1px solid rgba(255,255,255,0.15)",display:C?"block":"grid",gridTemplateColumns:C?void 0:"subgrid"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem"},children:[u.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[u.jsx("span",{style:{fontWeight:600},children:"Transfers:"}),u.jsx("span",{style:{opacity:.6,fontSize:"0.8rem"},children:"Moving money between accounts and categories within the budget"})]}),u.jsx("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:!E&&u.jsx(Ve,{actionName:"Open Add Transfer Form",onClick:()=>T(!0),disabled:!q,disabledReason:I.length===0&&Object.keys(d).length===0?"Create accounts and categories first":I.length===0?"Create an account first":"Create a category first",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:"+ Add Transfer"})})]}),!C&&u.jsxs(u.Fragment,{children:[u.jsx("div",{style:zs,children:"Date"}),u.jsx("div",{style:{...zs,textAlign:"right"},children:"Amount"}),u.jsx("div",{style:{...zs,textAlign:"center"},children:"From Cat"}),u.jsx("div",{style:zs,children:"From Acct"}),u.jsx("div",{style:zs}),u.jsx("div",{style:{...zs,textAlign:"center"},children:"To Cat"}),u.jsx("div",{style:zs,children:"To Acct"}),u.jsx("div",{style:zs,children:"Description"}),u.jsx("div",{style:{...zs,textAlign:"center"},children:"Clr"}),u.jsx("div",{style:zs})]})]}),!q&&u.jsx(Ku,{message:"You need at least one account and one category before adding transfers.",linkText:"Manage accounts",linkTo:"/budget/settings/accounts"}),E&&u.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"1rem"},children:u.jsx(X1,{accounts:I,accountGroups:l,categories:d,categoryGroups:h,defaultDate:pm(e,n),onSubmit:D,onCancel:()=>T(!1),submitLabel:"Add Transfer"})}),f?.transfers?.slice().sort((A,O)=>(A.date||"").localeCompare(O.date||"")).map((A,O)=>R===A.id?u.jsx("div",{style:{gridColumn:"1 / -1",padding:"0.5rem"},children:u.jsx(X1,{accounts:I,accountGroups:l,categories:d,categoryGroups:h,initialData:A,onSubmit:(N,J,Y,G,Z,Q,te,z)=>P(A.id,N,J,Y,G,Z,Q,te,z),onCancel:()=>M(null),onDelete:()=>L(A.id),submitLabel:"Save"})},A.id):u.jsx(uz,{transfer:A,fromCategoryName:Je(A.from_category_id)?No:d[A.from_category_id]?.name||"Unknown",toCategoryName:Je(A.to_category_id)?No:d[A.to_category_id]?.name||"Unknown",fromAccountName:We(A.from_account_id)?Ma:o[A.from_account_id]?.nickname||"Unknown",toAccountName:We(A.to_account_id)?Ma:o[A.to_account_id]?.nickname||"Unknown",fromAccountGroupName:We(A.from_account_id)?void 0:o[A.from_account_id]?.account_group_id?l[o[A.from_account_id].account_group_id]?.name:void 0,toAccountGroupName:We(A.to_account_id)?void 0:o[A.to_account_id]?.account_group_id?l[o[A.to_account_id].account_group_id]?.name:void 0,isFromCategoryNo:Je(A.from_category_id),isToCategoryNo:Je(A.to_category_id),isFromAccountNo:We(A.from_account_id),isToAccountNo:We(A.to_account_id),onEdit:()=>{A.description||`${A.amount}`,M(A.id)},onDelete:()=>L(A.id),isMobile:C,isEvenRow:O%2===0},A.id)),(!f?.transfers||f.transfers.length===0)&&!E&&u.jsx("p",{style:{gridColumn:"1 / -1",opacity:.5,fontSize:"0.9rem",textAlign:"center",padding:"1.5rem"},children:"No transfers recorded for this month"}),u.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]})]})}function Z1({accounts:t,accountGroups:e,categories:n,categoryGroups:r,payees:i,initialData:o,defaultAccountId:l,defaultDate:d,onSubmit:h,onCancel:f,onDelete:p,submitLabel:g}){function v(_){h(_.amount,_.accountId,_.categoryId,_.date,_.payee,_.description,_.cleared)}return u.jsx(n_,{accounts:t,accountGroups:e,categories:n,categoryGroups:r,payees:i,initialData:o?{date:o.date,payee:o.payee,categoryId:o.category_id,accountId:o.account_id,amount:o.amount,description:o.description,cleared:o.cleared}:void 0,defaultAccountId:l,defaultDate:d,config:{showCategory:!0,showCleared:!0,showNoCategoryOption:!0,showNoAccountOption:!0,showSignToggle:!0,accountLabel:"Account",payeePlaceholder:"e.g., Bank, Interest source",descriptionPlaceholder:"e.g., Starting balance, Correction",submitLabel:g},onSubmit:v,onCancel:f,onDelete:p})}function hz({adjustment:t,categoryName:e,accountName:n,accountGroupName:r,onEdit:i,onDelete:o,isMobile:l,isEvenRow:d}){const h=t.date?new Date(t.date+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"}):"",f=r?`${r} / ${n}`:n,p=d?"transparent":"rgba(255,255,255,0.04)";if(l)return u.jsxs("div",{onClick:i,style:{gridColumn:"1 / -1",display:"flex",flexDirection:"column",gap:"0.25rem",padding:"0.75rem 1rem",background:p,cursor:"pointer",transition:"background 0.15s"},children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{style:{fontSize:"0.75rem",opacity:.5,fontFamily:"monospace"},children:h}),t.cleared&&u.jsx("span",{style:{fontSize:"0.7rem",color:fe.success},title:"Cleared",children:""})]}),u.jsx("span",{style:{fontWeight:600,color:ct(t.amount),fontFamily:"monospace"},children:Bt(t.amount)})]}),u.jsx("div",{style:{fontWeight:500,fontSize:"0.9rem"},children:t.description||"Adjustment"}),u.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap",alignItems:"center"},children:[u.jsx("span",{style:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px"},children:e}),u.jsx("span",{style:{fontSize:"0.75rem",opacity:.6},children:f})]})]});const g={padding:"0.6rem 0.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem"};return u.jsxs("div",{style:{gridColumn:"1 / -1",background:p,display:"grid",gridTemplateColumns:"5rem 1.5fr 7rem 1fr 6rem 1fr 3rem 4rem"},children:[u.jsx("div",{style:{...g,fontSize:"0.85rem",fontFamily:"monospace"},children:u.jsx("span",{style:{opacity:.6},children:h})}),u.jsx("div",{style:{...g,justifyContent:"center"},children:u.jsx("span",{style:{fontSize:"0.8rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e})}),u.jsx("div",{style:{...g,overflow:"hidden"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.85rem",opacity:.7},children:f})}),u.jsx("div",{style:{...g,justifyContent:"flex-end",fontWeight:600,color:ct(t.amount),fontFamily:"monospace"},children:Bt(t.amount)}),u.jsx("div",{style:{...g,paddingLeft:"0.5rem",overflow:"hidden"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.8rem",opacity:.6},children:t.description||""})}),u.jsx("div",{style:{...g,justifyContent:"center",color:t.cleared?fe.success:"inherit",opacity:t.cleared?1:.3,fontSize:"1rem"},children:t.cleared?"":""}),u.jsxs("div",{style:{...g,justifyContent:"flex-end",gap:"0.25rem"},children:[u.jsx("button",{onClick:i,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:v=>v.currentTarget.style.opacity="1",onMouseLeave:v=>v.currentTarget.style.opacity="0.5",title:"Edit",children:""}),u.jsx("button",{onClick:o,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:v=>v.currentTarget.style.opacity="1",onMouseLeave:v=>v.currentTarget.style.opacity="0.5",title:"Delete",children:""})]})]})}const vo={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderTop:"1px solid rgba(255,255,255,0.1)"};function fz(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n,setCurrentYear:r,setCurrentMonthNumber:i}=Xe(),{accounts:o,accountGroups:l,categories:d,categoryGroups:h}=jn(),{month:f,isLoading:p}=Ks(t,e,n),{addAdjustment:g}=iB(),{updateAdjustment:v}=oB(),{deleteAdjustment:_}=lB(),C=ki(),[x,w]=k.useState(null),[E,T]=k.useState(!1),[R,M]=k.useState(null),I=V0(t,{enabled:E||R!==null}).data||[];function D(N){const J=N.account_group_id?l[N.account_group_id]:void 0;return J&&J.is_active!==null?J.is_active:N.is_active!==!1}function P(N){const J=N.account_group_id?l[N.account_group_id]:void 0;return J&&J.on_budget!==null?J.on_budget:N.on_budget!==!1}const L=Object.entries(o).filter(([,N])=>D(N)&&P(N));function q(N,J,Y,G,Z,Q,te){if(!t)return;w(null),T(!1);const{year:z,month:H}=gm(G);(z!==e||H!==n)&&(r(z),i(H)),g(t,z,H,N,J,Y,G,Z,Q,te).catch(re=>{w(re instanceof Error?re.message:"Failed to add adjustment")})}function A(N,J,Y,G,Z,Q,te,z){t&&(w(null),M(null),v(t,e,n,N,J,Y,G,Z,Q,te,z).catch(H=>{w(H instanceof Error?H.message:"Failed to update adjustment")}))}function O(N){t&&confirm("Are you sure you want to delete this adjustment?")&&(w(null),_(t,e,n,N).catch(J=>{w(J instanceof Error?J.message:"Failed to delete adjustment")}))}return u.jsxs("div",{style:{opacity:p?.5:1,transition:"opacity 0.15s ease-out",pointerEvents:p?"none":"auto"},children:[x&&u.jsx("div",{style:{background:`color-mix(in srgb, ${fe.error} 15%, transparent)`,border:`1px solid ${fe.error}`,borderRadius:"8px",padding:"0.75rem",marginBottom:"1rem",color:fe.error},children:x}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:C?"1fr":"5rem 1fr 1fr 6rem 1.5fr 3rem 4rem"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"#242424",borderBottom:"1px solid rgba(255,255,255,0.15)",display:C?"block":"grid",gridTemplateColumns:C?void 0:"subgrid"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem"},children:[u.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[u.jsx("span",{style:{fontWeight:600},children:"Adjustments:"}),u.jsx("span",{style:{opacity:.6,fontSize:"0.8rem"},children:"Incoming or outgoing transactions that should bypass income and spend calculations"})]}),u.jsx("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:!E&&u.jsx(Ve,{actionName:"Open Add Adjustment Form",onClick:()=>T(!0),disabled:Object.keys(d).length===0&&L.length===0,disabledReason:"Create an account or category first",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:"+ Add Adjustment"})})]}),!C&&u.jsxs(u.Fragment,{children:[u.jsx("div",{style:vo,children:"Date"}),u.jsx("div",{style:{...vo,textAlign:"center"},children:"Category"}),u.jsx("div",{style:vo,children:"Account"}),u.jsx("div",{style:{...vo,textAlign:"right"},children:"Amount"}),u.jsx("div",{style:vo,children:"Description"}),u.jsx("div",{style:{...vo,textAlign:"center"},children:"Clr"}),u.jsx("div",{style:vo})]})]}),L.length===0&&Object.keys(d).length===0&&u.jsx(Ku,{message:"You need to create at least one account or category before adding adjustments.",linkText:"Manage accounts",linkTo:"/budget/settings/accounts"}),E&&u.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"1rem"},children:u.jsx(Z1,{accounts:L,accountGroups:l,categories:d,categoryGroups:h,payees:I,defaultDate:pm(e,n),onSubmit:q,onCancel:()=>T(!1),submitLabel:"Add Adjustment"})}),f?.adjustments?.slice().sort((N,J)=>(N.date||"").localeCompare(J.date||"")).map((N,J)=>R===N.id?u.jsx("div",{style:{gridColumn:"1 / -1",padding:"0.5rem"},children:u.jsx(Z1,{accounts:L,accountGroups:l,categories:d,categoryGroups:h,payees:I,initialData:N,onSubmit:(Y,G,Z,Q,te,z,H)=>A(N.id,Y,G,Z,Q,te,z,H),onCancel:()=>M(null),onDelete:()=>O(N.id),submitLabel:"Save"})},N.id):u.jsx(hz,{adjustment:N,categoryName:Je(N.category_id)?No:d[N.category_id]?.name||"Unknown Category",accountName:We(N.account_id)?Ma:o[N.account_id]?.nickname||"Unknown Account",accountGroupName:We(N.account_id)?void 0:o[N.account_id]?.account_group_id?l[o[N.account_id].account_group_id]?.name:void 0,onEdit:()=>{N.description||`${N.amount}`,M(N.id)},onDelete:()=>O(N.id),isMobile:C,isEvenRow:J%2===0},N.id)),(!f?.adjustments||f.adjustments.length===0)&&!E&&u.jsx("p",{style:{gridColumn:"1 / -1",opacity:.5,fontSize:"0.9rem",textAlign:"center",padding:"1.5rem"},children:"No adjustments recorded for this month"}),u.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]})]})}function mz({isOpen:t,onClose:e,onDeleted:n}){const{addLoadingHold:r,removeLoadingHold:i}=On(),{selectedBudgetId:o,currentYear:l,currentMonthNumber:d}=Xe(),{deleteAllocations:h}=rA(),[f,p]=k.useState(null),g=async()=>{if(o){p(null),r("allocations-delete","Deleting allocations...");try{await h({budgetId:o,year:l,month:d}),e(),n?.()}catch(v){p(v instanceof Error?v.message:"Failed to delete allocations")}finally{i("allocations-delete")}}};return u.jsxs(hs,{isOpen:t,onClose:e,title:"Delete Allocations",children:[f&&u.jsx(xm,{message:f,onDismiss:()=>p(null)}),u.jsx("p",{style:{margin:"0 0 1.5rem 0"},children:"Are you sure you want to delete all allocations for this month? This will remove all allocated amounts and reset the month to unfinalized."}),u.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[u.jsx(Ve,{actionName:"Cancel Delete Allocations",variant:"secondary",onClick:e,children:"Cancel"}),u.jsx(Ve,{actionName:"Confirm Delete Allocations",variant:"danger",onClick:g,children:"Delete Allocations"})]})]})}function lA({isDraftMode:t,isEditingAppliedAllocations:e,availableNow:n,currentMonthIncome:r,balanceTotals:i,draftChangeAmount:o,availableAfterApply:l,currentDraftTotal:d}){const h=t&&d!==void 0?d:i.allocated;return u.jsxs(u.Fragment,{children:[u.jsx("span",{style:{fontWeight:600,marginRight:"0.25rem"},children:t||e?"Allocations Worksheet:":"Month Summary:"}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:t?"Avail: ":"Inc: "}),t?u.jsx("span",{style:{color:ct(n),fontWeight:600},children:Vn(n)}):u.jsx("span",{style:{color:fe.success,fontWeight:600},children:Vn(r)})]}),u.jsxs("span",{children:[t&&u.jsx("span",{style:{opacity:.6},children:" "}),u.jsx("span",{style:{opacity:.6},children:t?"Draft: ":"Alloc: "}),u.jsx("span",{style:{color:_c(t?h:i.allocated),fontWeight:600,...t?ds:{}},children:Vn(t?h:i.allocated)}),e&&o!==0&&u.jsxs("span",{style:{fontSize:"0.85em",color:o>0?fe.warning:fe.success,marginLeft:"0.25rem"},children:["(",Bt(o),")"]})]}),!t&&u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"Spent: "}),u.jsx("span",{style:{color:yc(i.spent),fontWeight:600},children:Vn(i.spent)})]}),u.jsxs("span",{children:[t&&u.jsx("span",{style:{opacity:.6},children:"= "}),u.jsx("span",{style:{opacity:.6},children:t?"Remaining: ":"Net: "}),t?u.jsx("span",{style:{color:ct(l),fontWeight:600,...ds},children:Vn(l)}):u.jsx("span",{style:{color:ct(i.allocated+i.spent),fontWeight:600},children:Vn(i.allocated+i.spent)})]})]})}function pz({totals:t}){return u.jsxs(u.Fragment,{children:[u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"Start: "}),u.jsx("span",{style:{color:ct(t.start),fontWeight:600},children:Vn(t.start)})]}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"Inc: "}),u.jsx("span",{style:{color:fe.success,fontWeight:600},children:Vn(t.income)})]}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"Exp: "}),u.jsx("span",{style:{color:yc(t.expenses),fontWeight:600},children:Vn(t.expenses)})]}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"End: "}),u.jsx("span",{style:{color:ct(t.end),fontWeight:600},children:Vn(t.end)})]})]})}function r_({isDraftMode:t,isEditingAppliedAllocations:e,allocationsFinalized:n,onSave:r,onApply:i,onEdit:o,onCancel:l,onDelete:d}){return u.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:[t&&!e&&u.jsxs(u.Fragment,{children:[u.jsx(Ve,{actionName:"Save Draft Allocations",onClick:r,variant:"secondary",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:" Save"}),u.jsx(Ve,{actionName:"Apply Allocations",onClick:i,variant:"secondary",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:" Apply"})]}),!t&&n&&u.jsx(Ve,{actionName:"Edit Allocations",onClick:o,variant:"secondary",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:" Edit Allocations"}),e&&u.jsxs(u.Fragment,{children:[u.jsx(Ve,{actionName:"Apply Allocations",onClick:i,variant:"secondary",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:" Apply"}),u.jsx(Ve,{actionName:"Cancel Edit Allocations",onClick:l,variant:"secondary",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:""}),u.jsx(Ve,{actionName:"Open Delete Allocations Modal",onClick:d,variant:"secondary",style:{fontSize:"0.8rem",padding:"0.4em 0.8em",color:fe.error},children:""})]})]})}function J1(t){return t===0?fe.zero:t>0?fe.success:fe.error}function gz({category:t,balance:e,localAllocation:n,previousMonthIncome:r,isDraftMode:i,onAllocationChange:o,projectedAllTime:l}){const d=t.default_monthly_type==="percentage"&&t.default_monthly_amount!==void 0&&t.default_monthly_amount>0,h=d?t.default_monthly_amount/100*r:0,f=d?h.toFixed(2):n,p=i&&!d,g=i?l:t.balance??0,v=t.balance??0,_=v<0,C=_?Math.abs(v):0,x=d?h:parseFloat(n)||0,w=_?Math.min(x,C):0,E=_?Math.max(0,x-C):0,T=_&&x>0&&E>0;return u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",padding:"0.75rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem"},children:u.jsx("span",{style:{fontWeight:500},children:t.name})}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr 1fr 1fr",gap:"0.25rem",fontSize:"0.75rem"},children:[u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:"Start"}),u.jsx("span",{style:{color:dn(e.start_balance)},children:yr(e.start_balance)})]}),u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:"Alloc"}),p?u.jsxs(u.Fragment,{children:[u.jsx("input",{type:"text",inputMode:"decimal",value:f?`$${f}`:"",onChange:R=>{const M=R.target.value.replace(/[^\d.]/g,"");o(M)},placeholder:"$0",style:{width:"100%",maxWidth:"80px",padding:"0.25rem 0.35rem",borderRadius:"4px",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",background:"color-mix(in srgb, currentColor 8%, transparent)",fontSize:"0.8rem",color:"inherit",boxSizing:"border-box"}}),_&&x>0&&u.jsxs("div",{style:{fontSize:"0.65rem",marginTop:"0.15rem",lineHeight:1.3},children:[u.jsxs("span",{style:{color:fe.debt,display:"block"},children:[Vt(w),"  debt"]}),T&&u.jsxs("span",{style:{color:fe.success,display:"block"},children:[Vt(E),"  balance"]})]})]}):u.jsx("span",{style:{color:_c(e.allocated)},children:Bt(e.allocated)})]}),u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:"Spent"}),u.jsx("span",{style:{color:yc(e.spent)},children:Pt(e.spent)})]}),u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:"End"}),u.jsx("span",{style:{color:dn(e.end_balance),...i&&!d?ds:{}},children:yr(e.end_balance)})]}),u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:i?"Proj. All-Time":"All-Time"}),u.jsx("span",{style:{color:dn(g),...i&&!d?ds:{}},children:yr(g)})]})]}),(e.transfers!==0||e.adjustments!==0)&&u.jsxs("div",{style:{marginTop:"0.5rem",paddingTop:"0.5rem",borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)",display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",fontSize:"0.7rem",opacity:.7},children:[e.transfers!==0&&u.jsxs("span",{style:{color:J1(e.transfers)},children:[Bt(e.transfers)," transfers"]}),e.adjustments!==0&&u.jsxs("span",{style:{color:J1(e.adjustments)},children:[Bt(e.adjustments)," adjust"]})]}),i&&d&&u.jsx("div",{style:{marginTop:"0.5rem"},children:u.jsxs("span",{style:{fontSize:"0.8rem"},children:[u.jsxs("span",{style:{opacity:.6},children:[Vt(r),"  "]}),u.jsxs("span",{style:{color:fe.success},children:[t.default_monthly_amount,"%"]}),u.jsx("span",{style:{opacity:.6},children:" = "}),u.jsx("span",{style:{color:fe.success},children:Vt(h)})]})})]})}function zf(t){return t===0?fe.zero:t>0?fe.success:fe.error}function eS({name:t,categories:e,groupTotals:n,getCategoryBalance:r,localAllocations:i,savedAllocations:o,previousMonthIncome:l,isDraftMode:d,onAllocationChange:h,isMobile:f,isUngrouped:p,getAllocationAmount:g,gridTemplateColumns:v}){const _={paddingTop:"0.6rem",paddingBottom:"0.6rem",paddingLeft:"0.5rem",paddingRight:"0.5rem",marginTop:"1.25rem",borderTop:"1px solid rgba(255,255,255,0.2)",borderBottom:Oa,background:"rgba(255,255,255,0.04)",display:"flex",alignItems:"center",fontSize:"0.9rem",fontWeight:600},C=n.allocated+n.spent+n.transfers+n.adjustments,x=e.reduce((w,[E,T])=>{const R=T.balance??0;let M=R;if(d){const V=g(E,T),$=o[E]??0,I=V-$;M=R+I}return w+Math.max(0,M)},0);return u.jsxs("div",{style:{display:"contents"},children:[!f&&u.jsxs(u.Fragment,{children:[u.jsxs("div",{style:{..._,paddingLeft:"0.5rem",opacity:p?.7:1},children:[u.jsx("span",{children:t}),u.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",e.length,")"]})]}),u.jsx("div",{style:{..._,justifyContent:"flex-end",color:dn(n.start)},children:Yt.showGroupTotals}),u.jsx("div",{style:{..._,justifyContent:d?"center":"flex-end",color:_c(n.allocated)},children:Yt.showGroupTotals}),u.jsx("div",{style:{..._,justifyContent:"flex-end",color:yc(n.spent)},children:Yt.showGroupTotals}),u.jsx("div",{style:{..._,justifyContent:"flex-end",color:zf(n.transfers)},children:Yt.showGroupTotals}),u.jsx("div",{style:{..._,justifyContent:"flex-end",color:zf(n.adjustments)},children:Yt.showGroupTotals}),u.jsx("div",{style:{..._,justifyContent:"flex-end",color:dn(C)},children:Yt.showGroupTotals}),u.jsx("div",{style:{..._,justifyContent:"flex-end",color:dn(n.end),paddingRight:"1rem",borderRight:"2px solid rgba(128, 128, 128, 0.4)"},children:Yt.showGroupTotals}),u.jsx("div",{style:{..._,justifyContent:"flex-end",color:dn(x)},children:Yt.showGroupTotals})]}),!d&&f&&u.jsxs("div",{style:{gridColumn:"1 / -1",paddingTop:"0.6rem",paddingBottom:"0.6rem",paddingLeft:"0.5rem",paddingRight:"0.5rem",marginTop:"1.25rem",borderTop:"1px solid rgba(255,255,255,0.2)",borderBottom:Oa,background:"rgba(255,255,255,0.04)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[u.jsxs("span",{style:{fontWeight:600,opacity:p?.7:1},children:[t,u.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",e.length,")"]})]}),Yt.showGroupTotals]}),e.map(([w,E],T)=>{const R=r(w);if(!R)return null;const M=E.balance??0;let V=M;if(d){const $=g(w,E),I=o[w]??0,D=$-I;V=M+D}return f?u.jsx("div",{style:{gridColumn:"1 / -1"},children:u.jsx(gz,{category:E,balance:R,localAllocation:i[w]||"",previousMonthIncome:l,isDraftMode:d,onAllocationChange:$=>h(w,$),projectedAllTime:V})},w):u.jsx(yz,{category:E,balance:R,localAllocation:i[w]||"",previousMonthIncome:l,isDraftMode:d,onAllocationChange:$=>h(w,$),allTimeBalance:V,isEvenRow:T%2===0,gridTemplateColumns:v},w)})]})}function yz({category:t,balance:e,localAllocation:n,previousMonthIncome:r,isDraftMode:i,onAllocationChange:o,allTimeBalance:l,isEvenRow:d,gridTemplateColumns:h}){const f=t.default_monthly_type==="percentage"&&t.default_monthly_amount!==void 0&&t.default_monthly_amount>0,p=f?t.default_monthly_amount/100*r:0,g=f?p.toFixed(2):n,v=t.balance??0,_=v<0,C=_?Math.abs(v):0,x=f?p:parseFloat(n)||0,w=_?Math.min(x,C):0,E=_?Math.max(0,x-C):0,T=_&&x>0&&E>0,R=d?"transparent":"rgba(255,255,255,0.04)",M={paddingTop:"0.6rem",paddingBottom:"0.6rem",paddingLeft:"0.5rem",paddingRight:"0.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem",minHeight:"2.4rem",boxSizing:"border-box"},V=e.allocated+e.spent+e.transfers+e.adjustments;return u.jsxs("div",{style:{gridColumn:"1 / -1",background:R,display:"grid",gridTemplateColumns:h},children:[u.jsx("div",{style:{paddingTop:"0.6rem",paddingBottom:"0.6rem",paddingRight:"0.5rem",paddingLeft:"1.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem",fontWeight:500,overflow:"hidden",borderLeft:"2px solid rgba(255,255,255,0.1)",minHeight:"2.4rem",boxSizing:"border-box"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.name})}),u.jsx("div",{style:{...M,justifyContent:"flex-end",color:dn(e.start_balance)},children:yr(e.start_balance)}),i?u.jsx("div",{style:{...M,justifyContent:"center",flexDirection:"column",gap:"0.1rem"},children:f?u.jsxs("span",{style:{fontSize:"0.85rem"},children:[u.jsxs("span",{style:{color:fe.success},children:[t.default_monthly_amount,"%"]}),u.jsx("span",{style:{opacity:.5},children:" = "}),u.jsx("span",{style:{color:fe.success},children:Vt(p)})]}):u.jsxs(u.Fragment,{children:[u.jsx("input",{type:"text",inputMode:"decimal",value:g?`$${g}`:"",onChange:$=>{const I=$.target.value.replace(/[^\d.]/g,"");o(I)},placeholder:"$0.00",style:{width:"100px",padding:"0.2rem 0.5rem",borderRadius:"4px",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"0.9rem",lineHeight:1,color:"inherit",boxSizing:"border-box"}}),_&&x>0&&u.jsxs("div",{style:{fontSize:"0.6rem",whiteSpace:"nowrap",textAlign:"center",lineHeight:1.3,display:"flex",flexDirection:"column",alignItems:"center"},children:[u.jsxs("span",{style:{color:fe.debt},children:[Vt(w),"  debt"]}),T&&u.jsxs("span",{style:{color:fe.success},children:[Vt(E),"  bal"]})]})]})}):(()=>{const $=e.start_balance<0,I=$?Math.abs(e.start_balance):0,D=$?Math.min(e.allocated,I):0,P=$?Math.max(0,e.allocated-I):0,L=$&&e.allocated>0;return u.jsxs("div",{style:{...M,justifyContent:"flex-end",flexDirection:"column",alignItems:"flex-end",gap:"0.1rem",color:_c(e.allocated)},children:[u.jsxs("span",{children:["+",Vt(e.allocated)]}),L&&u.jsxs("div",{style:{fontSize:"0.6rem",whiteSpace:"nowrap",textAlign:"right",lineHeight:1.3,display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[u.jsxs("span",{style:{color:fe.debt},children:[Vt(D),"  debt"]}),P>0&&u.jsxs("span",{style:{color:fe.success},children:[Vt(P),"  bal"]})]})]})})(),u.jsx("div",{style:{...M,justifyContent:"flex-end",color:yc(e.spent)},children:Pt(e.spent)}),u.jsx("div",{style:{...M,justifyContent:"flex-end",color:zf(e.transfers)},children:Bt(e.transfers)}),u.jsx("div",{style:{...M,justifyContent:"flex-end",color:zf(e.adjustments)},children:Bt(e.adjustments)}),u.jsx("div",{style:{...M,justifyContent:"flex-end",color:dn(V),...i&&!f?ds:{}},children:Bt(V)}),u.jsx("div",{style:{...M,justifyContent:"flex-end",fontWeight:600,color:dn(e.end_balance),paddingRight:"1rem",borderRight:"2px solid rgba(128, 128, 128, 0.4)",...i&&!f?ds:{}},children:yr(e.end_balance)}),u.jsx("div",{style:{...M,justifyContent:"flex-end",color:dn(l),...i&&!f?ds:{}},children:yr(l)})]})}function _z(t,e){const{includeHidden:n=!1}={},r=Object.entries(t).filter(([,i])=>n||!i.is_hidden).reduce((i,[o,l])=>{const d=l.category_group_id||"ungrouped";return i[d]||(i[d]=[]),i[d].push([o,l]),i},{});return Object.keys(r).forEach(i=>{r[i].sort((o,l)=>o[1].sort_order-l[1].sort_order)}),r}function bz(t,e,n,r,i){const o={};t?.category_balances&&t.category_balances.forEach(d=>{o[d.category_id]=d});const l={};return Object.entries(e).forEach(([d,h])=>{const f=o[d],p=f?.start_balance??0;let g=0;n?g=i(d,h):r&&f&&(g=f.allocated);let v=0;t?.expenses&&(v=t.expenses.filter(x=>x.category_id===d).reduce((x,w)=>x+w.amount,0));let _=0;t?.transfers&&t.transfers.forEach(x=>{x.to_category_id===d&&(_+=x.amount),x.from_category_id===d&&(_-=x.amount)});let C=0;t?.adjustments&&(C=t.adjustments.filter(x=>x.category_id===d).reduce((x,w)=>x+w.amount,0)),l[d]={category_id:d,start_balance:p,allocated:g,spent:v,transfers:_,adjustments:C,end_balance:p+g+v+_+C}}),l}function vz(t,e){const n={};t?.account_balances&&t.account_balances.forEach(i=>{n[i.account_id]=i});const r={};return Object.entries(e).forEach(([i,o])=>{const d=n[i]?.start_balance??o.balance;let h=0;t?.income&&(h=t.income.filter(_=>_.account_id===i).reduce((_,C)=>_+C.amount,0));let f=0;t?.expenses&&(f=t.expenses.filter(_=>_.account_id===i).reduce((_,C)=>_+C.amount,0));let p=0;t?.transfers&&t.transfers.forEach(_=>{_.to_account_id===i&&(p+=_.amount),_.from_account_id===i&&(p-=_.amount)});let g=0;t?.adjustments&&(g=t.adjustments.filter(_=>_.account_id===i).reduce((_,C)=>_+C.amount,0));const v=h+f+p+g;r[i]={account_id:i,start_balance:d,income:h,expenses:f,transfers:p,adjustments:g,net_change:v,end_balance:d+v}}),r}function xz(t){return Object.values(t).reduce((e,n)=>({start:e.start+n.start_balance,income:e.income+n.income,expenses:e.expenses+n.expenses,transfers:e.transfers+n.transfers,adjustments:e.adjustments+n.adjustments,netChange:e.netChange+n.net_change,end:e.end+n.end_balance}),{start:0,income:0,expenses:0,transfers:0,adjustments:0,netChange:0,end:0})}function wz(t){return Object.values(t).reduce((e,n)=>({start:e.start+n.start_balance,allocated:e.allocated+n.allocated,spent:e.spent+n.spent,transfers:e.transfers+n.transfers,adjustments:e.adjustments+n.adjustments,end:e.end+Math.max(0,n.end_balance)}),{start:0,allocated:0,spent:0,transfers:0,adjustments:0,end:0})}function cA(t,e){const n={},r={};return t?.account_balances&&t.account_balances.forEach(i=>{r[i.account_id]=i}),t?(Object.entries(e).forEach(([i,o])=>{const d=r[i]?.start_balance??o.balance;let h=0,f=0;t?.income&&t.income.filter(T=>T.account_id===i).forEach(T=>{f+=T.amount,h+=T.amount});let p=0,g=0;t?.expenses&&t.expenses.filter(T=>T.account_id===i).forEach(T=>{g+=T.amount,T.cleared===!0&&(p+=T.amount)});let v=0,_=0;t?.transfers&&t.transfers.forEach(T=>{T.to_account_id===i&&(_+=T.amount,T.cleared===!0&&(v+=T.amount)),T.from_account_id===i&&(_-=T.amount,T.cleared===!0&&(v-=T.amount))});let C=0,x=0;t?.adjustments&&t.adjustments.filter(T=>T.account_id===i).forEach(T=>{x+=T.amount,T.cleared===!0&&(C+=T.amount)});const w=h+p+v+C,E=f+g+_+x;n[i]={account_id:i,cleared_balance:d+w,uncleared_balance:d+E}}),n):(Object.entries(e).forEach(([i,o])=>{n[i]={account_id:i,cleared_balance:o.balance??0,uncleared_balance:o.balance??0}}),n)}function tS(t){return t===0?fe.zero:t>0?fe.success:fe.error}function Sz({isDraftMode:t,allocationsFinalized:e,balanceTotals:n,grandAllTime:r,onSave:i,onApply:o,onEdit:l,onCancel:d,onDelete:h}){const f={paddingTop:"0.6rem",paddingBottom:"0.6rem",paddingLeft:"0.5rem",paddingRight:"0.5rem",borderTop:"2px solid rgba(255,255,255,0.3)",borderBottom:"2px solid rgba(255,255,255,0.3)",fontWeight:600,display:"flex",alignItems:"center",fontSize:"0.9rem"},p=n.allocated+n.spent+n.transfers+n.adjustments;return u.jsxs(u.Fragment,{children:[u.jsxs("div",{style:{...f,gap:"0.75rem"},children:["Grand Totals",!t&&u.jsx(r_,{isDraftMode:!1,isEditingAppliedAllocations:!1,allocationsFinalized:e,onSave:i,onApply:o,onEdit:l,onCancel:d,onDelete:h})]}),u.jsx("div",{style:{...f,justifyContent:"flex-end",color:dn(n.start)},children:yr(n.start)}),u.jsxs("div",{style:{...f,justifyContent:t?"center":"flex-end",color:_c(n.allocated),...t?ds:{}},children:["+",Vt(n.allocated)]}),u.jsx("div",{style:{...f,justifyContent:"flex-end",color:yc(n.spent)},children:Pt(n.spent)}),u.jsx("div",{style:{...f,justifyContent:"flex-end",color:tS(n.transfers)},children:Bt(n.transfers)}),u.jsx("div",{style:{...f,justifyContent:"flex-end",color:tS(n.adjustments)},children:Bt(n.adjustments)}),u.jsx("div",{style:{...f,justifyContent:"flex-end",color:dn(p),...t?ds:{}},children:Bt(p)}),u.jsx("div",{style:{...f,justifyContent:"flex-end",color:dn(n.end),paddingRight:"1rem",borderRight:"2px solid rgba(128, 128, 128, 0.4)",...t?ds:{}},children:yr(n.end)}),u.jsx("div",{style:{...f,justifyContent:"flex-end",color:dn(r),...t?ds:{}},children:yr(r)})]})}function Cz({allocationsFinalized:t,availableNow:e,currentMonthIncome:n,balanceTotals:r,draftChangeAmount:i,availableAfterApply:o,currentDraftTotal:l,onSave:d,onApply:h,onEdit:f,onCancel:p,onDelete:g}){return u.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem",borderTop:"2px solid rgba(255,255,255,0.3)",borderBottom:"2px solid rgba(255,255,255,0.3)"},children:[u.jsx("span",{style:{fontWeight:600},children:"Grand Totals:"}),u.jsx(lA,{isDraftMode:!1,isEditingAppliedAllocations:!1,availableNow:e,currentMonthIncome:n,balanceTotals:r,draftChangeAmount:i,availableAfterApply:o,currentDraftTotal:l}),u.jsx(r_,{isDraftMode:!1,isEditingAppliedAllocations:!1,allocationsFinalized:t,onSave:d,onApply:h,onEdit:f,onCancel:p,onDelete:g})]})}const pi={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderBottom:"2px solid rgba(255,255,255,0.2)"};function Ez(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n}=Xe(),{categories:r,categoryGroups:i}=jn(),{month:o}=Ks(t,e,n),l=ki(),[d,h]=k.useState(!1),{localAllocations:f,isEditingAppliedAllocations:p,error:g,availableNow:v,currentDraftTotal:_,draftChangeAmount:C,availableAfterApply:x,previousMonthIncome:w,currentMonthIncome:E,allocationsFinalized:T,getAllocationAmount:R,handleAllocationChange:M,resetAllocationsToSaved:V,handleSaveAllocations:$,handleFinalizeAllocations:I,setIsEditingAppliedAllocations:D,setError:P}=o3(),L=[...i].sort((te,z)=>te.sort_order-z.sort_order),q=k.useMemo(()=>_z(r),[r]),A=!T||p,O=k.useMemo(()=>bz(o,r,A,T,R),[o,r,A,T,R]),N=te=>O[te],J=k.useMemo(()=>wz(O),[O]),Y=k.useMemo(()=>{const te={};if(o?.category_balances)for(const z of o.category_balances)te[z.category_id]=z.allocated;return te},[o]),G=k.useMemo(()=>Object.entries(r).reduce((te,[z,H])=>{const re=H.balance??0;let ne=re;if(A){const ie=R(z,H),be=Y[z]??0,Ce=ie-be;ne=re+Ce}return te+Math.max(0,ne)},0),[r,A,R,Y]),Z=k.useMemo(()=>Object.values(r).reduce((te,z)=>te+Math.max(0,z.balance??0),0),[r]);k.useEffect(()=>{if(!t||A)return;if(Math.abs(G-Z)>.01){const z=Math.abs(G-Z);console.error("[MonthCategories] Month View vs Settings Mismatch:",{grandAllTime:G,settingsPageAllocated:Z,difference:z,message:'Month view "ALL-TIME" does not match settings page "Allocated" total. These should always match.'}),qn.add({type:"error",message:`Balance display mismatch: Month view "ALL-TIME" (${Vt(G)})  Settings "Allocated" (${Vt(Z)}). Difference: ${Vt(z)}. Budget may need recalculation.`,autoDismissMs:1e4})}},[G,Z,A,t]);const Q={onSave:$,onApply:I,onEdit:()=>D(!0),onCancel:V,onDelete:()=>h(!0)};return u.jsxs(u.Fragment,{children:[g&&u.jsx(xm,{message:g,onDismiss:()=>P(null)}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:l?"1fr":A?"2fr 1fr 200px 1fr 1fr 1fr 1fr 1fr 120px":"2fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 120px"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"#242424",display:l?"block":"grid",gridTemplateColumns:l?void 0:"subgrid"},children:[A&&u.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexDirection:l?"column":"row",flexWrap:"wrap",alignItems:l?"stretch":"center",gap:l?"0.5rem":"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:l?"0.5rem":"0.25rem"},children:[u.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:l?void 0:1,alignItems:"center"},children:u.jsx(lA,{isDraftMode:A,isEditingAppliedAllocations:p,availableNow:v,currentMonthIncome:E,balanceTotals:J,draftChangeAmount:C,availableAfterApply:x,currentDraftTotal:_})}),u.jsx(r_,{isDraftMode:A,isEditingAppliedAllocations:p,allocationsFinalized:T,...Q})]}),!l&&u.jsxs(u.Fragment,{children:[u.jsx("div",{style:pi,children:"Category"}),u.jsx("div",{style:{...pi,textAlign:"right"},children:"Start"}),u.jsx("div",{style:{...pi,textAlign:A?"center":"right"},children:"Allocated"}),u.jsx("div",{style:{...pi,textAlign:"right"},children:"Spent"}),u.jsx("div",{style:{...pi,textAlign:"right"},children:"Transfers"}),u.jsx("div",{style:{...pi,textAlign:"right"},children:"Adjust"}),u.jsx("div",{style:{...pi,textAlign:"right"},children:"Net Change"}),u.jsx("div",{style:{...pi,textAlign:"right",paddingRight:"1rem",borderRight:"2px solid rgba(128, 128, 128, 0.4)"},children:"End"}),u.jsx("div",{style:{...pi,textAlign:"right"},children:"All-Time"})]}),!l&&u.jsx(Sz,{isDraftMode:A,allocationsFinalized:T,balanceTotals:J,grandAllTime:G,...Q}),!A&&l&&u.jsx(Cz,{allocationsFinalized:T,availableNow:v,currentMonthIncome:E,balanceTotals:J,draftChangeAmount:C,availableAfterApply:x,currentDraftTotal:_,...Q})]}),Object.keys(r).length===0&&u.jsxs("p",{style:{gridColumn:"1 / -1",opacity:.6,textAlign:"center",padding:"2rem"},children:["No categories yet. ",u.jsx(Tn,{to:"/budget/settings/categories",style:{opacity:1},children:"Create categories "})]}),L.map(te=>{const z=q[te.id]||[];if(z.length===0)return null;const H=z.reduce((re,[ne])=>{const ie=N(ne);return ie?{start:re.start+ie.start_balance,allocated:re.allocated+ie.allocated,spent:re.spent+ie.spent,transfers:re.transfers+ie.transfers,adjustments:re.adjustments+ie.adjustments,end:re.end+ie.end_balance}:re},{start:0,allocated:0,spent:0,transfers:0,adjustments:0,end:0});return u.jsx(eS,{name:te.name,categories:z,groupTotals:H,getCategoryBalance:N,localAllocations:f,savedAllocations:Y,previousMonthIncome:w,isDraftMode:A,onAllocationChange:M,isMobile:l,getAllocationAmount:R,gridTemplateColumns:A?"2fr 1fr 200px 1fr 1fr 1fr 1fr 1fr 120px":"2fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 120px"},te.id)}),q[cn]?.length>0&&(()=>{const te=q[cn],z=te.reduce((H,[re])=>{const ne=N(re);return ne?{start:H.start+ne.start_balance,allocated:H.allocated+ne.allocated,spent:H.spent+ne.spent,transfers:H.transfers+ne.transfers,adjustments:H.adjustments+ne.adjustments,end:H.end+ne.end_balance}:H},{start:0,allocated:0,spent:0,transfers:0,adjustments:0,end:0});return u.jsx(eS,{name:"Uncategorized",categories:te,groupTotals:z,getCategoryBalance:N,localAllocations:f,savedAllocations:Y,previousMonthIncome:w,isDraftMode:A,onAllocationChange:M,isMobile:l,isUngrouped:!0,getAllocationAmount:R,gridTemplateColumns:A?"2fr 1fr 200px 1fr 1fr 1fr 1fr 1fr 120px":"2fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 120px"},cn)})(),u.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]}),u.jsx(mz,{isOpen:d,onClose:()=>h(!1),onDeleted:()=>D(!1)})]})}function uA(t){return t===0?fe.zero:t>0?fe.success:fe.error}function dA(t){return t===0?fe.zero:t<0?fe.error:fe.success}function ba(t){return t===0?fe.zero:t>0?fe.success:fe.error}function nS({name:t,accounts:e,groupTotals:n,accountBalances:r,accountClearedBalances:i,isMobile:o,isUngrouped:l}){const d={padding:"0.6rem 0.5rem",marginTop:"1.25rem",borderTop:"1px solid rgba(255,255,255,0.2)",borderBottom:Oa,background:"rgba(255,255,255,0.04)",display:"flex",alignItems:"center",fontSize:"0.9rem",fontWeight:600};return u.jsxs("div",{style:{display:"contents"},children:[!o&&u.jsxs(u.Fragment,{children:[u.jsxs("div",{style:{...d,opacity:l?.7:1},children:[u.jsx("span",{children:t}),u.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",e.length,")"]})]}),u.jsx("div",{style:{...d,justifyContent:"flex-end",color:ct(n.start)},children:Yt.showGroupTotals}),u.jsx("div",{style:{...d,justifyContent:"flex-end",color:uA(n.income)},children:Yt.showGroupTotals}),u.jsx("div",{style:{...d,justifyContent:"flex-end",color:dA(n.expenses)},children:Yt.showGroupTotals}),u.jsx("div",{style:{...d,justifyContent:"flex-end",color:ba(n.transfers)},children:Yt.showGroupTotals}),u.jsx("div",{style:{...d,justifyContent:"flex-end",color:ba(n.adjustments)},children:Yt.showGroupTotals}),u.jsx("div",{style:{...d,justifyContent:"flex-end",color:ba(n.netChange)},children:Yt.showGroupTotals}),u.jsx("div",{style:{...d,justifyContent:"flex-end",color:ct(n.end)},children:Yt.showGroupTotals}),u.jsx("div",{style:{...d,justifyContent:"flex-end"},children:Yt.showGroupTotals}),u.jsx("div",{style:{...d,justifyContent:"flex-end"},children:Yt.showGroupTotals}),u.jsx("div",{style:{...d,justifyContent:"flex-end"},children:Yt.showGroupTotals})]}),o&&u.jsxs("div",{style:{gridColumn:"1 / -1",padding:"0.6rem 0.5rem",marginTop:"1.25rem",borderTop:"1px solid rgba(255,255,255,0.2)",borderBottom:Oa,background:"rgba(255,255,255,0.04)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[u.jsxs("span",{style:{fontWeight:600,opacity:l?.7:1},children:[t,u.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",e.length,")"]})]}),Yt.showGroupTotals]}),e.map(([h,f],p)=>{const g=r[h];if(!g)return null;const v=i?.[h];return o?u.jsx("div",{style:{gridColumn:"1 / -1"},children:u.jsx(Az,{account:f,balance:g,clearedBalance:v})},h):u.jsx(Tz,{account:f,balance:g,clearedBalance:v,isEvenRow:p%2===0},h)})]})}function Tz({account:t,balance:e,clearedBalance:n,isEvenRow:r}){const i=r?"transparent":"rgba(255,255,255,0.04)",o={padding:"0.5rem 0.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem"};return u.jsxs("div",{style:{gridColumn:"1 / -1",background:i,display:"grid",gridTemplateColumns:"2fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr"},children:[u.jsx("div",{style:{...o,fontWeight:500,overflow:"hidden",paddingLeft:"1.5rem",borderLeft:"2px solid rgba(255,255,255,0.1)"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.nickname})}),u.jsx("div",{style:{...o,justifyContent:"flex-end",color:ct(e.start_balance)},children:Pt(e.start_balance)}),u.jsxs("div",{style:{...o,justifyContent:"flex-end",color:uA(e.income)},children:["+",Vt(e.income)]}),u.jsx("div",{style:{...o,justifyContent:"flex-end",color:dA(e.expenses)},children:Pt(e.expenses)}),u.jsx("div",{style:{...o,justifyContent:"flex-end",color:ba(e.transfers)},children:Bt(e.transfers)}),u.jsx("div",{style:{...o,justifyContent:"flex-end",color:ba(e.adjustments)},children:Bt(e.adjustments)}),u.jsx("div",{style:{...o,justifyContent:"flex-end",color:ba(e.net_change)},children:Bt(e.net_change)}),u.jsx("div",{style:{...o,justifyContent:"flex-end",fontWeight:600,color:ct(e.end_balance)},children:Pt(e.end_balance)}),n?u.jsx("div",{style:{...o,justifyContent:"flex-end",color:ct(n.uncleared_balance),fontWeight:600},children:Pt(n.uncleared_balance)}):u.jsx("div",{style:{...o,justifyContent:"flex-end",opacity:.3,color:"#9ca3af"},children:""}),n?u.jsx("div",{style:{...o,justifyContent:"flex-end",color:ct(n.cleared_balance)},children:Math.abs(n.uncleared_balance-n.cleared_balance)<.01?u.jsx("span",{style:{opacity:.3,color:"#9ca3af"},children:""}):Pt(n.cleared_balance)}):u.jsx("div",{style:{...o,justifyContent:"flex-end",opacity:.3,color:"#9ca3af"},children:""}),n&&Math.abs(n.uncleared_balance-n.cleared_balance)>=.01?u.jsx("div",{style:{...o,justifyContent:"flex-end",color:ba(n.uncleared_balance-n.cleared_balance)},children:Bt(n.uncleared_balance-n.cleared_balance)}):u.jsx("div",{style:{...o,justifyContent:"flex-end",opacity:.3,color:"#9ca3af"},children:""})]})}function Az({account:t,balance:e,clearedBalance:n}){return u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",padding:"0.75rem",marginBottom:"0.25rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem"},children:u.jsx("span",{style:{fontWeight:500},children:t.nickname})}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:n&&Math.abs(n.uncleared_balance-n.cleared_balance)>=.01?"1fr 1fr 1fr 1fr":"1fr 1fr 1fr",gap:"0.25rem",fontSize:"0.75rem"},children:[u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:"Start"}),u.jsx("span",{children:Pt(e.start_balance)})]}),u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:"Net Change"}),u.jsx("span",{style:{color:ct(e.net_change)},children:Bt(e.net_change)})]}),u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:"End"}),u.jsx("span",{style:{color:ct(e.end_balance)},children:Pt(e.end_balance)})]}),n&&u.jsxs(u.Fragment,{children:[u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:"Total"}),u.jsx("span",{style:{color:ct(n.uncleared_balance),fontWeight:600},children:Pt(n.uncleared_balance)})]}),Math.abs(n.uncleared_balance-n.cleared_balance)>=.01?u.jsxs(u.Fragment,{children:[u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:"Cleared"}),u.jsx("span",{style:{color:ct(n.cleared_balance)},children:Pt(n.cleared_balance)})]}),u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:"Uncleared"}),u.jsx("span",{style:{color:ba(n.uncleared_balance-n.cleared_balance)},children:Bt(n.uncleared_balance-n.cleared_balance)})]})]}):u.jsxs(u.Fragment,{children:[u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:"Cleared"}),u.jsx("span",{style:{opacity:.3,color:"#9ca3af"},children:""})]}),u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:"Uncleared"}),u.jsx("span",{style:{opacity:.3,color:"#9ca3af"},children:""})]})]})]})]}),(e.income!==0||e.expenses!==0||e.transfers!==0||e.adjustments!==0)&&u.jsxs("div",{style:{marginTop:"0.5rem",paddingTop:"0.5rem",borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)",display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",fontSize:"0.7rem",opacity:.7},children:[e.income!==0&&u.jsxs("span",{children:[Bt(e.income)," income"]}),e.expenses!==0&&u.jsxs("span",{children:[Pt(e.expenses)," expenses"]}),e.transfers!==0&&u.jsxs("span",{children:[Bt(e.transfers)," transfers"]}),e.adjustments!==0&&u.jsxs("span",{children:[Bt(e.adjustments)," adjust"]})]})]})}const ls={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderBottom:"2px solid rgba(255,255,255,0.2)"};function jz(t){return t===0?fe.zero:t>0?fe.success:fe.error}function Rz(t){return t===0?fe.zero:t<0?fe.error:fe.success}function Zg(t){return t===0?fe.zero:t>0?fe.success:fe.error}function Iz(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n}=Xe(),{accounts:r,accountGroups:i}=jn(),{month:o}=Ks(t,e,n),l=ki(),d=k.useMemo(()=>Object.entries(i).map(([x,w])=>({id:x,...w})).sort((x,w)=>x.sort_order-w.sort_order),[i]),h=k.useMemo(()=>{const x={};return Object.entries(r).filter(([,w])=>!w.is_hidden).forEach(([w,E])=>{const T=E.account_group_id||Jt;x[T]||(x[T]=[]),x[T].push([w,E])}),Object.keys(x).forEach(w=>{x[w].sort((E,T)=>E[1].sort_order-T[1].sort_order)}),x},[r]),f=k.useMemo(()=>vz(o,r),[o,r]),p=k.useMemo(()=>cA(o,r),[o,r]),g=k.useMemo(()=>xz(f),[f]),v=g.income+g.expenses,C={...{padding:"0.6rem 0.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem"},borderTop:"2px solid rgba(255,255,255,0.3)",borderBottom:"2px solid rgba(255,255,255,0.3)",fontWeight:600};return u.jsx(u.Fragment,{children:u.jsxs("div",{style:{display:"grid",gridTemplateColumns:l?"1fr":"2fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"#242424",display:l?"block":"grid",gridTemplateColumns:l?void 0:"subgrid"},children:[!l&&u.jsxs(u.Fragment,{children:[u.jsx("div",{style:ls,children:"Account"}),u.jsx("div",{style:{...ls,textAlign:"right"},children:"Start"}),u.jsx("div",{style:{...ls,textAlign:"right"},children:"Income"}),u.jsx("div",{style:{...ls,textAlign:"right"},children:"Expenses"}),u.jsx("div",{style:{...ls,textAlign:"right"},children:"Transfers"}),u.jsx("div",{style:{...ls,textAlign:"right"},children:"Adjust"}),u.jsx("div",{style:{...ls,textAlign:"right"},children:"Net Change"}),u.jsx("div",{style:{...ls,textAlign:"right"},children:"End"}),u.jsx("div",{style:{...ls,textAlign:"right"},children:"Total"}),u.jsx("div",{style:{...ls,textAlign:"right"},children:"Cleared"}),u.jsx("div",{style:{...ls,textAlign:"right"},children:"Uncleared"})]}),l?u.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem",borderTop:"2px solid rgba(255,255,255,0.3)",borderBottom:"2px solid rgba(255,255,255,0.3)"},children:[u.jsx("span",{style:{fontWeight:600},children:"Grand Totals:"}),u.jsx(pz,{totals:g})]}):u.jsxs(u.Fragment,{children:[u.jsx("div",{style:{...C},children:"Grand Totals"}),u.jsx("div",{style:{...C,justifyContent:"flex-end",color:ct(g.start)},children:Pt(g.start)}),u.jsxs("div",{style:{...C,justifyContent:"flex-end",color:jz(g.income)},children:["+",Vt(g.income)]}),u.jsx("div",{style:{...C,justifyContent:"flex-end",color:Rz(g.expenses)},children:Pt(g.expenses)}),u.jsx("div",{style:{...C,justifyContent:"flex-end",color:Zg(g.transfers)},children:Bt(g.transfers)}),u.jsx("div",{style:{...C,justifyContent:"flex-end",color:Zg(g.adjustments)},children:Bt(g.adjustments)}),u.jsx("div",{style:{...C,justifyContent:"flex-end",color:Zg(v)},children:Bt(v)}),u.jsx("div",{style:{...C,justifyContent:"flex-end",color:ct(g.end)},children:Pt(g.end)}),u.jsx("div",{style:{...C,justifyContent:"flex-end"},children:Object.keys(p).length>0?Pt(Object.values(p).reduce((x,w)=>x+w.uncleared_balance,0)):u.jsx("span",{style:{opacity:.3,color:"#9ca3af"},children:""})}),u.jsx("div",{style:{...C,justifyContent:"flex-end"},children:(()=>{if(Object.keys(p).length===0)return u.jsx("span",{style:{opacity:.3,color:"#9ca3af"},children:""});const x=Object.values(p).reduce((E,T)=>E+T.cleared_balance,0),w=Object.values(p).reduce((E,T)=>E+T.uncleared_balance,0);return Math.abs(w-x)<.01?u.jsx("span",{style:{opacity:.3,color:"#9ca3af"},children:""}):Pt(x)})()}),u.jsx("div",{style:{...C,justifyContent:"flex-end"},children:(()=>{if(Object.keys(p).length===0)return u.jsx("span",{style:{opacity:.3,color:"#9ca3af"},children:""});const x=Object.values(p).reduce((T,R)=>T+R.cleared_balance,0),E=Object.values(p).reduce((T,R)=>T+R.uncleared_balance,0)-x;return Math.abs(E)<.01?u.jsx("span",{style:{opacity:.3,color:"#9ca3af"},children:""}):Bt(E)})()})]})]}),Object.keys(r).length===0&&u.jsxs("p",{style:{gridColumn:"1 / -1",opacity:.6,textAlign:"center",padding:"2rem"},children:["No accounts yet."," ",u.jsx(Tn,{to:"/budget/settings/accounts",style:{opacity:1},children:"Add accounts "})]}),d.map(x=>{const w=h[x.id]||[];if(w.length===0)return null;const E=w.reduce((T,[R])=>{const M=f[R];return M?{start:T.start+M.start_balance,income:T.income+M.income,expenses:T.expenses+M.expenses,transfers:T.transfers+M.transfers,adjustments:T.adjustments+M.adjustments,netChange:T.netChange+M.net_change,end:T.end+M.end_balance}:T},{start:0,income:0,expenses:0,transfers:0,adjustments:0,netChange:0,end:0});return u.jsx(nS,{name:x.name,accounts:w,groupTotals:E,accountBalances:f,accountClearedBalances:p,isMobile:l},x.id)}),h[Jt]?.length>0&&(()=>{const x=h[Jt],w=x.reduce((E,[T])=>{const R=f[T];return R?{start:E.start+R.start_balance,income:E.income+R.income,expenses:E.expenses+R.expenses,transfers:E.transfers+R.transfers,adjustments:E.adjustments+R.adjustments,netChange:E.netChange+R.net_change,end:E.end+R.end_balance}:E},{start:0,income:0,expenses:0,transfers:0,adjustments:0,netChange:0,end:0});return u.jsx(nS,{name:"Ungrouped",accounts:x,groupTotals:w,accountBalances:f,accountClearedBalances:p,isMobile:l,isUngrouped:!0},Jt)})(),u.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]})})}const kz=["income","categories","accounts","spend","transfers","adjustments"];function rS(t){const e=t.year?parseInt(t.year,10):null,n=t.month?parseInt(t.month,10):null,r=t.tab&&kz.includes(t.tab)?t.tab:null;return{year:e&&!isNaN(e)&&e>=2e3&&e<=2100?e:null,month:n&&!isNaN(n)&&n>=1&&n<=12?n:null,tab:r}}function Dz(){const t=new Date;return{year:t.getFullYear(),month:t.getMonth()+1}}function sS(){const t=B5(),e=Xu(),[n,r]=kS(),{addLoadingHold:i,removeLoadingHold:o}=On(),{selectedBudgetId:l,setSelectedBudgetId:d,currentYear:h,currentMonthNumber:f,lastActiveTab:p,setCurrentYear:g,setCurrentMonthNumber:v,setLastActiveTab:_,setPageTitle:C,goToPreviousMonth:x,goToNextMonth:w,hasPendingInvites:E,needsFirstBudget:T,initialDataLoadComplete:R}=Xe(),{budget:M,isLoading:V}=jn(),$=!V,[I,D]=k.useState(!1);k.useEffect(()=>(!$||!R?i("budget-data","Loading budget data..."):o("budget-data"),()=>o("budget-data")),[$,R,i,o]);const P=k.useRef(!1),L=n.get("error"),[q,A]=k.useState(L);k.useEffect(()=>{L&&(n.delete("error"),r(n,{replace:!0}))},[L,n,r]);const[O,N]=k.useState(()=>{const{tab:H}=rS(t);return H??p}),J=H=>{N(H),_(H)};k.useEffect(()=>{if(P.current)return;const{year:H,month:re}=rS(t);H&&g(H),re&&v(re),P.current=!0},[t,g,v]),k.useEffect(()=>{if(!P.current)return;const H=`/budget/${h}/${f}/${O}`,re=`/budget/${t.year}/${t.month}/${t.tab}`;H!==re&&e(H,{replace:!0})},[h,f,O,e,t]);const{month:Y,error:G,isLoading:Z}=Ks($?l:null,h,f);k.useEffect(()=>{if(!G||I)return;const H=G.message||"";if(H.includes("Budget")&&H.includes("does not exist")){queueMicrotask(()=>{d(null),e("/budget/my-budgets?context=budget-not-found",{replace:!0})});return}(H.includes("months in the past")||H.includes("Refusing to create month"))&&queueMicrotask(()=>{i("month-redirect","Redirecting to current month..."),D(!0);const{year:re,month:ne}=Dz();A(`Cannot create month ${h}/${f} - it's too far in the past. Redirected to current month.`),g(re),v(ne)})},[G,I,h,f,g,v,i,d,e]),k.useEffect(()=>{I&&Y&&!Z&&queueMicrotask(()=>{D(!1),o("month-redirect")})},[I,Y,Z,o]),k.useLayoutEffect(()=>{C(M?.name||"Budget")},[M?.name,C]);const{setCurrentViewingDocument:Q}=Xe();if(k.useEffect(()=>(M&&h&&f&&Q({type:"month",year:h,month:f}),()=>{Q({type:null})}),[M,h,f,Q]),k.useEffect(()=>{if($&&!I){if(!M&&!l){e("/budget/my-budgets",{replace:!0});return}if(!M&&E){e("/budget/my-budgets",{replace:!0});return}if(T){e("/budget/my-budgets",{replace:!0});return}}},[$,I,M,l,E,T,e]),x3(l,h,f),!$||!R||I||!M)return null;function te(){A(null),x()}function z(){A(null),w()}return u.jsxs(u.Fragment,{children:[q&&u.jsx(xm,{message:q,onDismiss:()=>A(null)}),u.jsx(JB,{onPreviousMonth:te,onNextMonth:z}),u.jsx($B,{activeTab:O,setActiveTab:J,allocationsFinalized:Y?.are_allocations_finalized}),O==="income"&&u.jsx(sz,{},`${h}-${f}`),O==="categories"&&u.jsx(Ez,{},`${h}-${f}`),O==="accounts"&&u.jsx(Iz,{},`${h}-${f}`),O==="spend"&&u.jsx(az,{},`${h}-${f}`),O==="transfers"&&u.jsx(dz,{},`${h}-${f}`),O==="adjustments"&&u.jsx(fz,{},`${h}-${f}`)]})}function Mz(){const{setPageTitle:t}=Xe();return k.useLayoutEffect(()=>{t("Analytics")},[t]),u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"50vh",textAlign:"center",gap:"1.5rem"},children:[u.jsx("div",{style:{fontSize:"4rem",opacity:.8},children:""}),u.jsx("h1",{style:{margin:0,fontSize:"2rem",fontWeight:600},children:"Analytics"}),u.jsx("p",{style:{margin:0,fontSize:"1.25rem",opacity:.6,maxWidth:"400px"},children:"Coming Soon"}),u.jsx("p",{style:{margin:0,fontSize:"0.95rem",opacity:.5,maxWidth:"500px",lineHeight:1.6},children:"Track spending trends, category breakdowns, and insights about your budget over time."}),u.jsx(Tn,{to:"/budget",style:{marginTop:"1rem",padding:"0.75rem 1.5rem",background:fe.primary,color:"white",borderRadius:"8px",textDecoration:"none",fontWeight:500,transition:"opacity 0.15s"},children:"Back to Budget"})]})}function Oz(){const t=$t();return{createBudget:Wn({mutationFn:async({name:n,userId:r,userEmail:i})=>{const o=`budget_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,l=new Date().toISOString(),d={name:n.trim()||"My Budget",user_ids:[r],accepted_user_ids:[r],owner_id:r,owner_email:i,accounts:{},account_groups:{[Jt]:{name:"Ungrouped",sort_order:0,expected_balance:"positive",on_budget:null,is_active:null}},categories:{},category_groups:[{id:cn,name:"Uncategorized",sort_order:0}],month_map:{},created_at:l,updated_at:l};return await or("budgets",o,d,"creating new budget document"),await or("users",r,{uid:r,email:i,budget_ids:Vu(o),updated_at:l},"adding new budget to user's budget list",{merge:!0}),{budgetId:o,budget:{id:o,...d}}},onSuccess:(n,{userId:r})=>{t.invalidateQueries({queryKey:Te.user(r)}),t.invalidateQueries({queryKey:Te.accessibleBudgets(r)})}})}}function Nz(){const t=$t();return{acceptInvite:Wn({mutationFn:async({budgetId:n,userId:r})=>{const i=new Date().toISOString(),{exists:o,data:l}=await Lt("budgets",n,"validating user was invited to this budget");if(!o||!l)throw new Error("Budget not found");if(!l.user_ids?.includes(r))throw new Error("You have not been invited to this budget");if(l.accepted_user_ids?.includes(r))throw new Error("You have already accepted this invite");return await or("users",r,{uid:r,budget_ids:Vu(n),updated_at:i},"adding accepted budget to user's budget list",{merge:!0}),await or("budgets",n,{accepted_user_ids:Vu(r),updated_at:i},"marking user as accepted in budget's accepted_user_ids",{merge:!0}),{budgetId:n}},onSuccess:(n,{userId:r})=>{t.invalidateQueries({queryKey:Te.user(r)}),t.invalidateQueries({queryKey:Te.accessibleBudgets(r)}),t.invalidateQueries({queryKey:Te.budget(n.budgetId)})}})}}function Pz(){const t=$t(),e=Wn({onMutate:async r=>{const{budgetId:i,userId:o}=r,l=Te.budget(i);await t.cancelQueries({queryKey:l});const d=t.getQueryData(l);return d&&t.setQueryData(l,{...d,budget:{...d.budget,user_ids:[...d.budget.user_ids,o]}}),{previousData:d}},mutationFn:async r=>{const{budgetId:i,userId:o}=r,{exists:l,data:d}=await Lt("budgets",i,"validating user is not already invited");if(!l||!d)throw new Error("Budget not found");if(d.user_ids?.includes(o))throw new Error("User is already invited");return await fd({budgetId:i,updates:{user_ids:Vu(o)},description:"adding user to budget's invited users list"}),{budgetId:i}},onError:(r,i,o)=>{o?.previousData&&t.setQueryData(Te.budget(i.budgetId),o.previousData)}});return{inviteUser:{mutate:r=>e.mutate(r),mutateAsync:r=>e.mutateAsync(r),isPending:e.isPending,isError:e.isError,error:e.error,reset:e.reset}}}function Bz(){const t=$t(),e=Wn({onMutate:async r=>{const{budgetId:i,userId:o}=r,l=Te.budget(i);await t.cancelQueries({queryKey:l});const d=t.getQueryData(l);return d&&t.setQueryData(l,{...d,budget:{...d.budget,user_ids:d.budget.user_ids.filter(h=>h!==o),accepted_user_ids:d.budget.accepted_user_ids.filter(h=>h!==o)}}),{previousData:d}},mutationFn:async r=>{const{budgetId:i,userId:o}=r;return await fd({budgetId:i,updates:{user_ids:R1(o),accepted_user_ids:R1(o)},description:"removing user from budget's access lists"}),{budgetId:i}},onError:(r,i,o)=>{o?.previousData&&t.setQueryData(Te.budget(i.budgetId),o.previousData)}});return{revokeUser:{mutate:r=>e.mutate(r),mutateAsync:r=>e.mutateAsync(r),isPending:e.isPending,isError:e.isError,error:e.error,reset:e.reset}}}function zz({message:t,onDismiss:e}){return u.jsxs("div",{style:{background:"rgba(220, 38, 38, 0.1)",border:"1px solid rgba(220, 38, 38, 0.3)",color:"#f87171",padding:"0.75rem 1rem",borderRadius:"8px",marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[u.jsx("span",{children:t}),u.jsx("button",{onClick:e,style:{background:"transparent",border:"none",color:"#f87171",cursor:"pointer",fontSize:"1.2rem",padding:"0 0.25rem",lineHeight:1},children:""})]})}function Lz({message:t,onDismiss:e}){return u.jsxs("div",{style:{background:"rgba(34, 197, 94, 0.1)",border:"1px solid rgba(34, 197, 94, 0.3)",color:"#4ade80",padding:"0.75rem 1rem",borderRadius:"8px",marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[u.jsx("span",{children:t}),u.jsx("button",{onClick:e,style:{background:"transparent",border:"none",color:"#4ade80",cursor:"pointer",fontSize:"1.2rem",padding:"0 0.25rem",lineHeight:1},children:""})]})}function Uz({budgetIdInput:t,setBudgetIdInput:e,isCheckingManual:n,manualInvite:r,isAccepting:i,onCheckInvite:o,onAcceptInvite:l,onCancel:d}){return u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px"},children:[u.jsxs("h3",{style:{margin:"0 0 0.75rem 0",fontSize:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{children:""})," Join Budget by ID"]}),u.jsx("p",{style:{margin:"0 0 1rem 0",fontSize:"0.9rem",opacity:.7},children:"If someone shared a budget ID with you, enter it below to accept the invitation:"}),r?u.jsxs("div",{style:{background:"color-mix(in srgb, #22c55e 10%, transparent)",border:"1px solid color-mix(in srgb, #22c55e 30%, transparent)",padding:"1rem",borderRadius:"8px"},children:[u.jsx("p",{style:{margin:"0 0 0.75rem 0",fontWeight:500},children:" You've been invited to join:"}),u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 8%, transparent)",padding:"0.75rem 1rem",borderRadius:"6px",marginBottom:"1rem"},children:[u.jsx("p",{style:{margin:"0 0 0.25rem 0",fontWeight:600,fontSize:"1.1rem"},children:r.budgetName}),r.ownerEmail&&u.jsxs("p",{style:{margin:0,fontSize:"0.9rem",opacity:.7},children:["Owner: ",r.ownerEmail]})]}),u.jsxs("div",{style:{display:"flex",gap:"0.75rem"},children:[u.jsx("button",{onClick:l,disabled:i===r.budgetId,style:{background:"#22c55e",color:"white",border:"none",padding:"0.6rem 1.25rem",borderRadius:"6px",cursor:i===r.budgetId?"not-allowed":"pointer",fontWeight:500,opacity:i===r.budgetId?.7:1},children:i===r.budgetId?"Accepting...":"Accept Invitation"}),u.jsx("button",{onClick:d,disabled:i===r.budgetId,style:{background:"transparent",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)",padding:"0.6rem 1.25rem",borderRadius:"6px",cursor:i===r.budgetId?"not-allowed":"pointer",fontWeight:500,opacity:i===r.budgetId?.7:.8},children:"Cancel"})]})]}):u.jsxs("form",{onSubmit:o,style:{display:"flex",gap:"0.75rem"},children:[u.jsx("input",{type:"text",value:t,onChange:h=>e(h.target.value),placeholder:"Enter Budget ID",style:{flex:1,padding:"0.6rem 0.8rem",borderRadius:"6px",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"0.95rem",color:"inherit"}}),u.jsx("button",{type:"submit",disabled:n||!t.trim(),style:{background:"#646cff",color:"white",border:"none",padding:"0.6rem 1.25rem",borderRadius:"6px",cursor:n||!t.trim()?"not-allowed":"pointer",fontWeight:500,opacity:n||!t.trim()?.7:1,whiteSpace:"nowrap"},children:n?"Checking...":"Check Invite"})]})]})}function Fz({currentUserId:t}){return u.jsxs("div",{style:{marginTop:"1.5rem",padding:"1rem",background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"6px",fontSize:"0.85rem",opacity:.7},children:[u.jsx("p",{style:{margin:"0 0 0.5rem 0"},children:" Share your User ID with budget owners so they can invite you:"}),u.jsx("code",{style:{display:"block",padding:"0.5rem 0.75rem",background:"color-mix(in srgb, currentColor 8%, transparent)",borderRadius:"4px",fontSize:"0.8rem",wordBreak:"break-all"},children:t})]})}function Vz(){const{addLoadingHold:t,removeLoadingHold:e}=On(),{selectedBudgetId:n,currentUserId:r,accessibleBudgets:i,loadAccessibleBudgets:o,switchToBudget:l,checkBudgetInvite:d,isInitialized:h,setPageTitle:f,needsFirstBudget:p}=Xe(),{requireUserEmail:g}=za(),v=k.useRef(!1),[_,C]=kS(),x=_.get("context");k.useEffect(()=>{x&&(_.delete("context"),C(_,{replace:!0}))},[x,_,C]);const w=x==="budget-not-found",E=p&&i.length===0;k.useLayoutEffect(()=>{f("My Budgets")},[f]),k.useEffect(()=>{h&&!v.current&&(v.current=!0,o())},[h,o]);const{budget:T,isLoading:R}=jn(),{renameBudget:M}=s3(),{acceptInvite:V}=Nz(),{createBudget:$}=Oz(),[I,D]=k.useState(null),[P,L]=k.useState(null),[q,A]=k.useState(null),[O,N]=k.useState(null),[J,Y]=k.useState(null),[G,Z]=k.useState(""),[Q,te]=k.useState(!1),[z,H]=k.useState(""),[re,ne]=k.useState(!1),[ie,be]=k.useState(null),[Ce,ce]=k.useState(""),[ge,Oe]=k.useState(!1);async function ze(ae){if(ae!==T?.id){D(ae),A(null),N(null);try{await l(ae),N("Switched to budget successfully!"),await o({force:!0})}catch(je){A(je instanceof Error?je.message:"Failed to switch budget")}finally{D(null)}}}async function ot(ae){if(r){L(ae),A(null),N(null);try{await V.mutateAsync({budgetId:ae,userId:r}),N("Invitation accepted! You now have access to this budget."),await o({force:!0})}catch(je){A(je instanceof Error?je.message:"Failed to accept invitation")}finally{L(null)}}}async function st(ae){if(ae.preventDefault(),!!z.trim()){ne(!0),A(null),be(null);try{const je=await d(z.trim());je?be(je):A("No pending invitation found for this budget ID. Make sure you've been invited by the budget owner.")}catch(je){A(je instanceof Error?je.message:"Failed to check invitation")}finally{ne(!1)}}}async function U(){if(!(!ie||!r)){ie.budgetName,L(ie.budgetId),A(null);try{await V.mutateAsync({budgetId:ie.budgetId,userId:r}),N(`Successfully joined "${ie.budgetName}"!`),be(null),H(""),await o({force:!0})}catch(ae){A(ae instanceof Error?ae.message:"Failed to accept invitation")}finally{L(null)}}}function de(ae,je){Z(je),Y(ae)}async function ye(ae){if(ae.preventDefault(),!(!G.trim()||!J||!n)){G.trim(),te(!0),A(null),N(null);try{await M.mutateAsync({budgetId:n,newName:G.trim()}),N("Budget renamed successfully!"),Y(null),await o({force:!0})}catch(je){A(je instanceof Error?je.message:"Failed to rename budget")}finally{te(!1)}}}async function ee(ae){if(ae.preventDefault(),!!r){Ce.trim(),Oe(!0),A(null),N(null);try{const je=await $.mutateAsync({name:Ce.trim()||"My Budget",userId:r,userEmail:g()});await l(je.budgetId),N("Budget created successfully!"),ce(""),await o({force:!0})}catch(je){A(je instanceof Error?je.message:"Failed to create budget")}finally{Oe(!1)}}}const X=i.filter(ae=>!ae.isPending),oe=i.filter(ae=>ae.isPending);if(k.useEffect(()=>(R||!h?t("my-budgets","Loading your budgets..."):e("my-budgets"),()=>e("my-budgets")),[R,h,t,e]),R||!h)return null;let Se="My Budgets",we="Switch between budgets, accept invitations, or create a new budget.";return w?(Se="Budget Not Found",we="Your selected budget could not be found. It may have been deleted. Select another budget or create a new one."):E&&(Se="Welcome!",we="Get started by creating your first budget or accepting an invitation."),u.jsxs("div",{children:[u.jsx("h1",{children:Se}),u.jsx("p",{style:{opacity:.7,marginBottom:"1.5rem"},children:we}),q&&u.jsx(zz,{message:q,onDismiss:()=>A(null)}),O&&u.jsx(Lz,{message:O,onDismiss:()=>N(null)}),oe.length>0&&u.jsxs("div",{style:{background:"color-mix(in srgb, #f59e0b 10%, transparent)",border:"1px solid color-mix(in srgb, #f59e0b 30%, transparent)",padding:"1.25rem",borderRadius:"8px",marginBottom:"1.5rem"},children:[u.jsxs("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{children:""})," Pending Invitations (",oe.length,")"]}),u.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:oe.map(ae=>u.jsx($1,{budget:ae,isCurrent:!1,isAccepting:P===ae.id,isSwitching:!1,isEditing:!1,editName:"",isRenaming:!1,onAccept:()=>ot(ae.id),onSwitch:()=>{},onStartEdit:()=>{},onCancelEdit:()=>{},onEditNameChange:()=>{},onSaveEdit:()=>{}},ae.id))})]}),X.length>0&&u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px",marginBottom:"1.5rem"},children:[u.jsxs("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{children:""})," Your Budgets (",X.length,")"]}),u.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:X.map(ae=>u.jsx($1,{budget:ae,isCurrent:ae.id===n,isAccepting:!1,isSwitching:I===ae.id,isEditing:J===ae.id,editName:J===ae.id?G:"",isRenaming:Q,onAccept:()=>{},onSwitch:()=>ze(ae.id),onStartEdit:()=>de(ae.id,ae.name),onCancelEdit:()=>{Y(null),Z("")},onEditNameChange:Z,onSaveEdit:ye},ae.id))})]}),u.jsxs("div",{style:{background:"color-mix(in srgb, #646cff 8%, transparent)",border:"1px solid color-mix(in srgb, #646cff 25%, transparent)",padding:"1.5rem",borderRadius:"8px",marginBottom:"1.5rem"},children:[u.jsxs("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{children:""})," Create New Budget"]}),u.jsxs("form",{onSubmit:ee,children:[u.jsxs("div",{style:{marginBottom:"1rem"},children:[u.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.9rem",opacity:.8},children:"Budget Name"}),u.jsx("input",{type:"text",value:Ce,onChange:ae=>ce(ae.target.value),placeholder:"My Budget",style:{width:"100%",padding:"0.6rem 0.8rem",borderRadius:"6px",border:"1px solid color-mix(in srgb, currentColor 25%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"0.95rem",color:"inherit",boxSizing:"border-box"}}),u.jsx("p",{style:{margin:"0.5rem 0 0 0",fontSize:"0.8rem",opacity:.5},children:"You can always rename this later"})]}),u.jsx("button",{type:"submit",disabled:ge,style:{background:fe.primary,color:"white",border:"none",padding:"0.6rem 1.5rem",borderRadius:"6px",cursor:ge?"not-allowed":"pointer",fontWeight:500,opacity:ge?.7:1,fontSize:"0.9rem"},children:ge?"Creating...":"Create Budget"})]})]}),u.jsx(Uz,{budgetIdInput:z,setBudgetIdInput:H,isCheckingManual:re,manualInvite:ie,isAccepting:P,onCheckInvite:st,onAcceptInvite:U,onCancel:()=>{be(null),H("")}}),r&&u.jsx(Fz,{currentUserId:r})]})}const $z=["accounts","categories","users"];function qz(){const{addLoadingHold:t,removeLoadingHold:e}=On(),{lastSettingsTab:n,setLastSettingsTab:r,setPageTitle:i,selectedBudgetId:o,setCurrentViewingDocument:l}=Xe();k.useLayoutEffect(()=>{i("Budget Settings")},[i]),k.useEffect(()=>(o&&l({type:"budget"}),()=>{l({type:null})}),[o,l]);const{isOwner:d,isLoading:h}=jn();k.useEffect(()=>(h?t("settings","Loading settings..."):e("settings"),()=>e("settings")),[h,t,e]);const f=tr(),p=f.pathname==="/budget/settings",g=k.useMemo(()=>{const w=f.pathname;return w.includes("/settings/accounts")?"accounts":w.includes("/settings/categories")?"categories":w.includes("/settings/users")?"users":"categories"},[f.pathname]),v=g==="users";k.useEffect(()=>{p||r(g)},[g,p,r]);function _(){return!$z.includes(n)||n==="users"&&!d?"categories":n}const C=k.useMemo(()=>[{id:"accounts",label:"Accounts",icon:""},{id:"categories",label:"Categories",icon:""},{id:"users",label:"Users",icon:"",hidden:!d}],[d]);return h?null:!d&&v?u.jsxs("div",{children:[u.jsx("h1",{children:"Access Denied"}),u.jsx("p",{style:{opacity:.7},children:"Only the budget owner can access this section."}),u.jsx("p",{style:{marginTop:"1rem"},children:u.jsx(Tn,{to:"/budget/settings/categories",children:"Go to Categories "})})]}):u.jsxs("div",{children:[u.jsx(Pf,{mode:"link",linkPrefix:"/budget/settings",tabs:C,activeTab:p?_():g}),p?u.jsx(Uf,{to:`/budget/settings/${_()}`,replace:!0}):u.jsx(nA,{children:u.jsx(Ff,{})})]})}function s_({initialData:t,onSubmit:e,onCancel:n,submitLabel:r,accountGroups:i,showGroupSelector:o=!1,showIncomeSettings:l=!1,hasExistingIncomeDefault:d=!1,hasExistingOutgoDefault:h=!1,currentGroupId:f,onDelete:p}){const[g,v]=k.useState(t||{nickname:"",account_group_id:null,is_income_account:!1,is_income_default:!1,is_outgo_account:!1,is_outgo_default:!1,on_budget:!0,is_active:!0,is_hidden:!1}),_=g.account_group_id||f,C=_?i.find(M=>M.id===_):null,x=!!(C&&C.is_active!==null),w=!!(C&&C.on_budget!==null);function E(M){M.preventDefault(),g.nickname.trim()&&e(g)}function T(M){v({...g,is_income_account:M,is_income_default:M?g.is_income_default:!1})}function R(M){v({...g,is_outgo_account:M,is_outgo_default:M?g.is_outgo_default:!1})}return u.jsxs(ji,{actionName:r==="Create Account"?"Create Account":"Update Account",onSubmit:E,children:[u.jsx(Nt,{label:"Account Nickname",htmlFor:"account-nickname",children:u.jsx(Ri,{id:"account-nickname",type:"text",value:g.nickname,onChange:M=>v({...g,nickname:M.target.value}),placeholder:"e.g., Main Checking, Savings",required:!0,autoFocus:!0})}),o&&u.jsx(Nt,{label:"Account Type",htmlFor:"account-group",children:u.jsxs(Qu,{id:"account-group",value:g.account_group_id||Jt,onChange:M=>v({...g,account_group_id:M.target.value===Jt?null:M.target.value}),children:[u.jsx("option",{value:Jt,children:"Ungrouped"}),i.map(M=>u.jsx("option",{value:M.id,children:M.name},M.id))]})}),l&&u.jsxs("div",{style:{padding:"0.75rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",display:"flex",flexDirection:"column",gap:"0.75rem"},children:[u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[u.jsx("p",{style:{margin:0,fontSize:"0.85rem",opacity:.7},children:"Account Status"}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[u.jsx(Wr,{id:"is-active",checked:(()=>{if(x&&C){const M=C.is_active;return M===null||M===void 0?!1:M}return g.is_active??!0})(),onChange:M=>v({...g,is_active:M.target.checked}),disabled:x,children:u.jsx("span",{style:{opacity:x?.5:1},children:"Active account"})}),x&&C&&u.jsxs("p",{style:{margin:0,fontSize:"0.7rem",opacity:.6,marginLeft:"2rem",color:fe.warning},children:['Set by account type "',C.name,'"']})]}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[u.jsx(Wr,{id:"on-budget",checked:(()=>{if(w&&C){const M=C.on_budget;return M===null||M===void 0?!1:M}return g.on_budget??!0})(),onChange:M=>v({...g,on_budget:M.target.checked}),disabled:w,children:u.jsx("span",{style:{opacity:w?.5:1},children:"On budget (affects budget totals)"})}),w&&C&&u.jsxs("p",{style:{margin:0,fontSize:"0.7rem",opacity:.6,marginLeft:"2rem",color:fe.warning},children:['Set by account type "',C.name,'"']})]}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[u.jsx(Wr,{id:"is-hidden",checked:g.is_hidden||!1,onChange:M=>v({...g,is_hidden:M.target.checked}),children:"Hidden account"}),u.jsx("p",{style:{margin:0,fontSize:"0.7rem",opacity:.6,marginLeft:"2rem"},children:"Hidden accounts don't appear in dropdowns or balance displays. Use for historical accounts that aren't actively used."})]})]}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[u.jsx("p",{style:{margin:0,fontSize:"0.85rem",opacity:.7},children:"Income Settings"}),u.jsx(Wr,{id:"is-income-account",checked:g.is_income_account||!1,onChange:M=>T(M.target.checked),children:"Show in income deposit list"}),g.is_income_account&&u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem",marginLeft:"2rem"},children:[u.jsx(Wr,{id:"is-income-default",checked:g.is_income_default||!1,onChange:M=>v({...g,is_income_default:M.target.checked}),disabled:d&&!t?.is_income_default,children:"Default account for new income"}),d&&!t?.is_income_default&&u.jsx("p",{style:{margin:0,fontSize:"0.75rem",opacity:.5},children:"Another account is already set as default"})]})]}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[u.jsx("p",{style:{margin:0,fontSize:"0.85rem",opacity:.7},children:"Expense Settings"}),u.jsx(Wr,{id:"is-outgo-account",checked:g.is_outgo_account||!1,onChange:M=>R(M.target.checked),children:"Show in expense account list"}),g.is_outgo_account&&u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem",marginLeft:"2rem"},children:[u.jsx(Wr,{id:"is-outgo-default",checked:g.is_outgo_default||!1,onChange:M=>v({...g,is_outgo_default:M.target.checked}),disabled:h&&!t?.is_outgo_default,children:"Default account for new expenses"}),h&&!t?.is_outgo_default&&u.jsx("p",{style:{margin:0,fontSize:"0.75rem",opacity:.5},children:"Another account is already set as default"})]})]})]}),u.jsxs($a,{children:[u.jsx(Ve,{type:"submit",actionName:r,children:r}),u.jsx(Ve,{type:"button",variant:"secondary",actionName:"Cancel Account Form",onClick:n,children:"Cancel"}),p&&u.jsx(Ve,{type:"button",variant:"secondary",actionName:"Delete Account",onClick:M=>{M.preventDefault(),p()},style:{color:"#ff6b6b",borderColor:"#ff6b6b"},children:" Delete"})]})]})}function iS({label:t,value:e,onChange:n,trueLabel:r,falseLabel:i,undefinedLabel:o}){function l(){n(e===void 0?!0:e===!0?!1:void 0)}const d=e===!0?r:e===!1?i:o,h=e===!0?fe.success:e===!1?fe.warning:"inherit",f=e===!0?"":e===!1?"":"";return u.jsxs("button",{type:"button",onClick:l,style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 0.75rem",background:e!==void 0?`color-mix(in srgb, ${h} 15%, transparent)`:"color-mix(in srgb, currentColor 8%, transparent)",border:e!==void 0?`1px solid color-mix(in srgb, ${h} 40%, transparent)`:"1px solid color-mix(in srgb, currentColor 20%, transparent)",borderRadius:"6px",cursor:"pointer",fontSize:"0.85rem",color:"inherit",textAlign:"left",width:"100%"},children:[u.jsx("span",{style:{width:"1.25rem",height:"1.25rem",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"4px",background:e!==void 0?h:"color-mix(in srgb, currentColor 20%, transparent)",color:e!==void 0?"white":"inherit",fontWeight:600,fontSize:"0.75rem"},children:f}),u.jsxs("span",{style:{flex:1},children:[u.jsxs("span",{style:{opacity:.7},children:[t,":"]})," ",u.jsx("span",{style:{fontWeight:500,color:h},children:d})]}),u.jsx("span",{style:{fontSize:"0.7rem",opacity:.5},children:"click to cycle"})]})}function aS({initialData:t,onSubmit:e,onCancel:n,submitLabel:r}){const[i,o]=k.useState(t||{name:"",expected_balance:"positive"});function l(d){d.preventDefault(),i.name.trim()&&e(i)}return u.jsxs(ji,{actionName:r==="Create Account Type"?"Create Account Type":"Update Account Type",onSubmit:l,children:[u.jsx(Nt,{label:"Account Type Name",htmlFor:"group-name",children:u.jsx(Ri,{id:"group-name",type:"text",value:i.name,onChange:d=>o({...i,name:d.target.value}),placeholder:"e.g., Checking, Savings, Credit Cards, Investments",required:!0,autoFocus:!0})}),u.jsx(Nt,{label:"Expected Balance",htmlFor:"expected-balance",children:u.jsxs(Qu,{id:"expected-balance",value:i.expected_balance,onChange:d=>o({...i,expected_balance:d.target.value}),children:[u.jsx("option",{value:"positive",children:"Normally Positive (e.g., Checking, Savings)"}),u.jsx("option",{value:"negative",children:"Normally Negative (e.g., Credit Cards, Loans)"}),u.jsx("option",{value:"any",children:"Either (no warnings)"})]})}),u.jsxs("div",{style:{padding:"0.75rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",display:"flex",flexDirection:"column",gap:"0.5rem"},children:[u.jsxs("p",{style:{margin:0,fontSize:"0.85rem",opacity:.7},children:["Group-Level Overrides ",u.jsx("span",{style:{fontSize:"0.75rem",opacity:.6},children:"(applies to all accounts in this type)"})]}),u.jsx(iS,{label:"Active status",value:i.is_active,onChange:d=>o({...i,is_active:d}),trueLabel:"All active",falseLabel:"All inactive",undefinedLabel:"Per account"}),u.jsx(iS,{label:"Budget status",value:i.on_budget,onChange:d=>o({...i,on_budget:d}),trueLabel:"All on budget",falseLabel:"All off budget",undefinedLabel:"Per account"})]}),u.jsxs($a,{children:[u.jsx(Ve,{type:"submit",actionName:r,children:r}),u.jsx(Ve,{type:"button",variant:"secondary",actionName:"Cancel Account Type Form",onClick:n,children:"Cancel"})]})]})}function Ml({icon:t,label:e,variant:n,title:r}){const o={success:{background:`color-mix(in srgb, ${fe.success} 20%, transparent)`,border:`1px solid color-mix(in srgb, ${fe.success} 40%, transparent)`,color:fe.success,opacity:1},warning:{background:`color-mix(in srgb, ${fe.warning} 15%, transparent)`,border:`1px solid color-mix(in srgb, ${fe.warning} 35%, transparent)`,color:fe.warning,opacity:1},muted:{background:"color-mix(in srgb, currentColor 12%, transparent)",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",color:"inherit",opacity:.7},income:{background:`color-mix(in srgb, ${fe.success} 10%, transparent)`,border:`1px solid color-mix(in srgb, ${fe.success} 25%, transparent)`,color:fe.success,opacity:.7},expense:{background:`color-mix(in srgb, ${fe.warning} 10%, transparent)`,border:`1px solid color-mix(in srgb, ${fe.warning} 25%, transparent)`,color:fe.warning,opacity:.7}}[n];return u.jsxs("span",{title:r||e,style:{display:"inline-flex",alignItems:"center",gap:"0.25rem",background:o.background,border:o.border,padding:"0.15rem 0.4rem",borderRadius:"4px",fontSize:"0.7rem",fontWeight:500,textTransform:"uppercase",letterSpacing:"0.3px",color:o.color,opacity:o.opacity,whiteSpace:"nowrap"},children:[u.jsx("span",{style:{fontSize:"0.75rem"},children:t}),e]})}function oS({account:t,accountGroups:e}){const n=[],r=t.account_group_id?e.find(l=>l.id===t.account_group_id):null,i=r&&r.is_active!==null?r.is_active:t.is_active!==!1,o=r&&r.on_budget!==null?r.on_budget:t.on_budget!==!1;if(!i){const l=r&&r.is_active!==null;n.push(u.jsx(Ml,{icon:"",label:l?"Inactive (type)":"Inactive",variant:"warning",title:l?`Set by "${r.name}" account type`:"Account is inactive/archived"},"inactive"))}if(!o){const l=r&&r.on_budget!==null;n.push(u.jsx(Ml,{icon:"",label:l?"Off Budget (type)":"Off Budget",variant:"warning",title:l?`Set by "${r.name}" account type`:"Tracking only - not included in budget"},"off-budget"))}return t.is_income_default?n.push(u.jsx(Ml,{icon:"",label:"Income Default",variant:"success",title:"Default income deposit account"},"income-default")):t.is_income_account&&n.push(u.jsx(Ml,{icon:"",label:"Income",variant:"income",title:"Income deposit account"},"income")),t.is_outgo_default?n.push(u.jsx(Ml,{icon:"",label:"Expense Default",variant:"warning",title:"Default expense account"},"outgo-default")):t.is_outgo_account&&n.push(u.jsx(Ml,{icon:"",label:"Expense",variant:"expense",title:"Expense account"},"outgo")),n.length===0?null:u.jsx(u.Fragment,{children:n})}function Hz({account:t,accountIndex:e,allGroups:n,allAccounts:r,clearedBalance:i,onEdit:o,onDelete:l,onMoveUp:d,onMoveDown:h,canMoveUp:f,canMoveDown:p,editingAccountId:g,setEditingAccountId:v,onUpdateAccount:_,isMobile:C}){if(g===t.id)return u.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"0.5rem"},children:u.jsx(s_,{initialData:{nickname:t.nickname,account_group_id:t.account_group_id,is_income_account:t.is_income_account,is_income_default:t.is_income_default,is_outgo_account:t.is_outgo_account,is_outgo_default:t.is_outgo_default,on_budget:t.on_budget,is_active:t.is_active},onSubmit:T=>{_(t.id,T),v(null)},onCancel:()=>v(null),onDelete:()=>{t.nickname,l(t.id),v(null)},submitLabel:"Save",accountGroups:n,showGroupSelector:!0,showIncomeSettings:!0,currentGroupId:t.account_group_id,hasExistingIncomeDefault:Object.entries(r).some(([T,R])=>R.is_income_default&&T!==t.id),hasExistingOutgoDefault:Object.entries(r).some(([T,R])=>R.is_outgo_default&&T!==t.id)})});if(C)return u.jsx("div",{style:{gridColumn:"1 / -1"},children:u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",padding:"0.75rem",marginBottom:"0.25rem"},children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"},children:[u.jsx("span",{style:{fontWeight:500},children:t.nickname}),u.jsx("div",{style:{display:"flex",gap:"1rem",fontSize:"0.85rem"},children:i?u.jsxs(u.Fragment,{children:[u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[u.jsx("span",{style:{opacity:.6,fontSize:"0.7rem"},children:"Total"}),u.jsx("span",{style:{color:ct(i.uncleared_balance),fontWeight:600},children:Pt(i.uncleared_balance)})]}),Math.abs(i.uncleared_balance-i.cleared_balance)>=.01?u.jsxs(u.Fragment,{children:[u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[u.jsx("span",{style:{opacity:.6,fontSize:"0.7rem"},children:"Cleared"}),u.jsx("span",{style:{color:ct(i.cleared_balance)},children:Pt(i.cleared_balance)})]}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[u.jsx("span",{style:{opacity:.6,fontSize:"0.7rem"},children:"Uncleared"}),u.jsx("span",{style:{color:ct(i.uncleared_balance-i.cleared_balance)},children:Pt(i.uncleared_balance-i.cleared_balance)})]})]}):u.jsxs(u.Fragment,{children:[u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[u.jsx("span",{style:{opacity:.6,fontSize:"0.7rem"},children:"Cleared"}),u.jsx("span",{style:{opacity:.3,color:"#9ca3af"},children:""})]}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[u.jsx("span",{style:{opacity:.6,fontSize:"0.7rem"},children:"Uncleared"}),u.jsx("span",{style:{opacity:.3,color:"#9ca3af"},children:""})]})]})]}):u.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:u.jsx("span",{style:{color:ct(t.balance),fontWeight:600},children:Pt(t.balance)})})})]}),u.jsx("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap",marginBottom:"0.5rem"},children:u.jsx(oS,{account:t,accountGroups:n})}),u.jsxs("div",{style:{display:"flex",gap:"0.5rem",justifyContent:"flex-end"},children:[u.jsx("button",{onClick:T=>{T.stopPropagation(),t.nickname,o(t.id)},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Edit",children:""}),u.jsx("button",{onClick:T=>{T.stopPropagation(),d()},disabled:!f,style:{background:"transparent",border:"none",cursor:f?"pointer":"default",opacity:f?.6:.2,fontSize:"0.9rem",padding:"0.25rem"},title:"Move up",children:""}),u.jsx("button",{onClick:T=>{T.stopPropagation(),h()},disabled:!p,style:{background:"transparent",border:"none",cursor:p?"pointer":"default",opacity:p?.6:.2,fontSize:"0.9rem",padding:"0.25rem"},title:"Move down",children:""})]})]})});const w=e%2===0?"transparent":"rgba(255,255,255,0.04)",E={padding:"0.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem"};return u.jsxs("div",{style:{gridColumn:"1 / -1",background:w,display:"grid",gridTemplateColumns:"2fr 1fr 1fr 1fr 1.5fr 1fr"},children:[u.jsx("div",{style:{...E,fontWeight:500,overflow:"hidden",paddingLeft:"1.5rem",borderLeft:"2px solid rgba(255,255,255,0.1)"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.nickname})}),i?u.jsx("div",{style:{...E,justifyContent:"flex-end",color:ct(i.uncleared_balance),fontWeight:600},children:Pt(i.uncleared_balance)}):u.jsx("div",{style:{...E,justifyContent:"flex-end",color:ct(t.balance),fontWeight:600},children:Pt(t.balance)}),i?u.jsx("div",{style:{...E,justifyContent:"flex-end",color:ct(i.cleared_balance)},children:Math.abs(i.uncleared_balance-i.cleared_balance)<.01?u.jsx("span",{style:{opacity:.3,color:"#9ca3af"},children:""}):Pt(i.cleared_balance)}):u.jsx("div",{style:{...E,justifyContent:"flex-end",color:ct(t.balance),fontWeight:600},children:Pt(t.balance)}),i&&Math.abs(i.uncleared_balance-i.cleared_balance)>=.01?u.jsx("div",{style:{...E,justifyContent:"flex-end",color:ct(i.uncleared_balance-i.cleared_balance)},children:Pt(i.uncleared_balance-i.cleared_balance)}):u.jsx("div",{style:{...E,justifyContent:"flex-end",opacity:.3,color:"#9ca3af"},children:""}),u.jsx("div",{style:{...E,gap:"0.25rem",flexWrap:"wrap"},children:u.jsx(oS,{account:t,accountGroups:n})}),u.jsxs("div",{style:{...E,justifyContent:"flex-end",gap:"0.25rem"},children:[u.jsx("button",{onClick:T=>{T.stopPropagation(),t.nickname,o(t.id)},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Edit",children:""}),u.jsx("button",{onClick:T=>{T.stopPropagation(),d()},disabled:!f,style:{background:"transparent",border:"none",cursor:f?"pointer":"default",opacity:f?.6:.2,fontSize:"0.9rem",padding:"0.25rem"},title:"Move up",children:""}),u.jsx("button",{onClick:T=>{T.stopPropagation(),h()},disabled:!p,style:{background:"transparent",border:"none",cursor:p?"pointer":"default",opacity:p?.6:.2,fontSize:"0.9rem",padding:"0.25rem"},title:"Move down",children:""})]})]})}function lS({group:t,accounts:e,allGroups:n,allAccounts:r,accountClearedBalances:i,editingAccountId:o,createForGroupId:l,setEditingAccountId:d,setCreateForGroupId:h,onUpdateAccount:f,onDeleteAccount:p,onMoveAccount:g,onCreateAccount:v,isMobile:_,isUngrouped:C,canMoveGroupUp:x,canMoveGroupDown:w,onEditGroup:E,onDeleteGroup:T,onMoveGroupUp:R,onMoveGroupDown:M}){const V=[...e].sort((I,D)=>I.sort_order-D.sort_order);V.reduce((I,D)=>I+D.balance,0);const $={padding:"0.6rem 0.5rem",marginTop:"1.25rem",borderTop:"1px solid rgba(255,255,255,0.2)",borderBottom:Oa,background:"rgba(255,255,255,0.04)",display:"flex",alignItems:"center",fontSize:"0.9rem",fontWeight:600};return u.jsxs("div",{style:{display:"contents"},children:[!_&&u.jsxs(u.Fragment,{children:[u.jsxs("div",{style:{...$,opacity:C?.7:1,justifyContent:"space-between"},children:[u.jsxs("span",{children:[u.jsx("span",{children:t.name}),u.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",V.length,")"]})]}),u.jsx("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center",flexShrink:0},children:!C&&u.jsxs(u.Fragment,{children:[u.jsx(Ve,{variant:"small",actionName:`Open Add Account Form (${t.name})`,onClick:()=>h(t.id),disabled:l!==null,children:"+ Account"}),u.jsx("button",{onClick:()=>{t.name,E()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Edit account type",children:""}),u.jsx("button",{onClick:()=>{t.name,T()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Delete account type",children:""}),u.jsxs("div",{style:Of,children:[u.jsx("button",{onClick:R,disabled:!x,style:{...ya,opacity:x?.6:.2,cursor:x?"pointer":"default"},title:"Move up","aria-label":"Move up",children:""}),u.jsx("button",{onClick:M,disabled:!w,style:{...ya,opacity:w?.6:.2,cursor:w?"pointer":"default"},title:"Move down","aria-label":"Move down",children:""})]})]})})]}),u.jsx("div",{style:$}),u.jsx("div",{style:$}),u.jsx("div",{style:$}),u.jsx("div",{style:$}),u.jsx("div",{style:$})]}),_&&u.jsxs("div",{style:{gridColumn:"1 / -1",padding:"0.6rem 0.5rem",marginTop:"1.25rem",borderTop:"1px solid rgba(255,255,255,0.2)",borderBottom:Oa,background:"rgba(255,255,255,0.04)"},children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"},children:[u.jsxs("span",{style:{fontWeight:600,opacity:C?.7:1},children:[t.name,u.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",V.length,")"]})]}),Yt.showGroupTotals]}),!C&&u.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center",flexWrap:"wrap"},children:[u.jsx(Ve,{variant:"small",actionName:`Open Add Account Form (${t.name})`,onClick:()=>h(t.id),disabled:l!==null,children:"+ Account"}),u.jsx("button",{onClick:()=>{t.name,E()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Edit account type",children:""}),u.jsx("button",{onClick:()=>{t.name,T()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Delete account type",children:""}),u.jsxs("div",{style:Of,children:[u.jsx("button",{onClick:R,disabled:!x,style:{...ya,opacity:x?.6:.2,cursor:x?"pointer":"default"},title:"Move up","aria-label":"Move up",children:""}),u.jsx("button",{onClick:M,disabled:!w,style:{...ya,opacity:w?.6:.2,cursor:w?"pointer":"default"},title:"Move down","aria-label":"Move down",children:""})]})]})]}),V.map((I,D)=>u.jsx(Hz,{account:I,accountIndex:D,totalAccounts:V.length,allGroups:n,allAccounts:r,clearedBalance:i?.[I.id],onEdit:d,onDelete:p,onMoveUp:()=>g(I.id,"up"),onMoveDown:()=>g(I.id,"down"),canMoveUp:D>0,canMoveDown:D<V.length-1,editingAccountId:o,setEditingAccountId:d,onUpdateAccount:f,isMobile:_},I.id)),l===t.id&&u.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"0.5rem"},children:u.jsx(s_,{initialData:{nickname:"",account_group_id:t.id},onSubmit:I=>v(I,t.id),onCancel:()=>h(null),submitLabel:"Create",accountGroups:n,showIncomeSettings:!0,currentGroupId:t.id})})]})}function Gz({hiddenAccounts:t,accounts:e,sortedGroups:n,editingAccountId:r,setEditingAccountId:i,onUpdateAccount:o}){return t.length===0?null:u.jsx("div",{style:{marginBottom:"2rem"},children:u.jsxs(Z0,{title:"Hidden Accounts",count:t.length,children:[u.jsxs("div",{style:{padding:"0.75rem",marginBottom:"1rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",fontSize:"0.85rem"},children:[u.jsxs("p",{style:{margin:"0 0 0.5rem 0",opacity:.8},children:[u.jsx("strong",{children:" Hidden accounts"})," are excluded from dropdowns and balance displays. They're useful for historical accounts (like closed bank accounts or old 401Ks) that you want to keep for record-keeping but don't need in everyday use."]}),u.jsx("p",{style:{margin:0,opacity:.6},children:'To unhide an account, click it to edit and uncheck "Hidden account".'})]}),u.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:t.map(l=>r===l.id?u.jsx(s_,{initialData:{nickname:l.nickname,account_group_id:l.account_group_id,is_income_account:l.is_income_account,is_income_default:l.is_income_default,is_outgo_account:l.is_outgo_account,is_outgo_default:l.is_outgo_default,on_budget:l.on_budget,is_active:l.is_active,is_hidden:l.is_hidden},onSubmit:d=>{o(l.id,d),i(null)},onCancel:()=>i(null),submitLabel:"Save",accountGroups:n,showGroupSelector:!0,showIncomeSettings:!0,currentGroupId:l.account_group_id,hasExistingIncomeDefault:Object.entries(e).some(([d,h])=>h.is_income_default&&d!==l.id),hasExistingOutgoDefault:Object.entries(e).some(([d,h])=>h.is_outgo_default&&d!==l.id)},l.id):u.jsxs("div",{onClick:()=>i(l.id),style:{padding:"0.75rem 1rem",background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"8px",cursor:"pointer",display:"flex",justifyContent:"space-between",alignItems:"center",opacity:.7},children:[u.jsx("span",{children:l.nickname}),u.jsx("span",{style:{color:ct(l.balance),fontWeight:500},children:Pt(l.balance)})]},l.id))})]})})}function Wz(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n}=Xe(),{isLoading:r,isFetching:i,accounts:o}=jn(),{month:l}=Ks(t,e,n),{accounts:d,accountsByGroup:h,hiddenAccounts:f,sortedGroups:p,currentBudget:g,error:v,setError:_,handleCreateAccount:C,handleUpdateAccount:x,handleDeleteAccount:w,handleMoveAccount:E,handleCreateGroup:T,handleUpdateGroup:R,handleDeleteGroup:M,handleMoveGroup:V}=a3(),$=ki(),{addLoadingHold:I,removeLoadingHold:D}=On(),P=r||i||!g;HT(!P&&!!g),k.useEffect(()=>(P?I("accounts","Loading accounts..."):D("accounts"),()=>D("accounts")),[P,I,D]);const[L,q]=k.useState(null),[A,O]=k.useState(null),[N,J]=k.useState(null),[Y,G]=k.useState(!1),Z=k.useMemo(()=>{const ne=Object.values(d),ie=ne.reduce((ce,ge)=>ce+(ge.balance??0),0);let be=0,Ce=0;for(const ce of ne){const ge=p.find(ze=>ze.id===ce.account_group_id);ce.on_budget===!0||ce.on_budget===void 0&&ge?.on_budget!==!1?be+=ce.balance??0:Ce+=ce.balance??0}return{count:ne.length,groupCount:p.filter(ce=>ce.id!==Jt).length,totalBalance:ie,onBudgetTotal:be,offBudgetTotal:Ce}},[d,p]),Q=k.useMemo(()=>p.filter(ne=>ne.id!==Jt),[p]),te=k.useMemo(()=>({id:Jt,name:"Ungrouped",sort_order:Q.length,expected_balance:"any",on_budget:null,is_active:null}),[Q.length]),z=h[Jt]||[],H=k.useMemo(()=>l?cA(l,o):{},[l,o]),re={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",paddingTop:"0.75rem",paddingBottom:"0.5rem",paddingLeft:"0.5rem",paddingRight:"0.5rem",borderBottom:"2px solid rgba(255,255,255,0.2)"};return k.useEffect(()=>{v&&(console.error("[Settings/Accounts] Error:",v),qn.add({type:"error",message:"Failed to update accounts. See console for details.",autoDismissMs:0}),_(null))},[v,_]),P||!g?P?null:u.jsx("p",{children:"No budget found. Please log in."}):u.jsxs("div",{children:[u.jsxs("div",{style:{display:"grid",gridTemplateColumns:$?"1fr":"2fr 1fr 1fr 1fr 1.5fr 1fr",marginBottom:"1.5rem"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:50,backgroundColor:"#242424",display:$?"block":"grid",gridTemplateColumns:$?void 0:"subgrid"},children:[u.jsx("div",{style:{gridColumn:"1 / -1",marginLeft:"calc(-1 * var(--page-padding, 2rem))",marginRight:"calc(-1 * var(--page-padding, 2rem))",paddingLeft:"var(--page-padding, 2rem)",paddingRight:"var(--page-padding, 2rem)",paddingTop:"0.5rem",paddingBottom:"0.5rem"},children:u.jsxs("div",{style:{display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingBottom:"0.5rem",borderBottom:"1px solid rgba(255,255,255,0.15)"},children:[u.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[u.jsx("span",{style:{fontWeight:600},children:"Accounts:"}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"On-Budget: "}),u.jsx("span",{style:{color:ct(Z.onBudgetTotal),fontWeight:600},children:Vn(Z.onBudgetTotal)})]}),Z.offBudgetTotal!==0&&u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"Off-Budget: "}),u.jsx("span",{style:{fontWeight:600,opacity:.7},children:Vn(Z.offBudgetTotal)})]}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"Total: "}),u.jsx("span",{style:{color:ct(Z.totalBalance),fontWeight:600},children:Vn(Z.totalBalance)})]}),u.jsx("span",{style:{opacity:.5,fontSize:"0.8rem"},children:"Use  buttons to reorder accounts."})]}),u.jsx("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:u.jsx(e_,{})})]})}),!$&&u.jsxs(u.Fragment,{children:[u.jsx("div",{style:re,children:"Account"}),u.jsx("div",{style:{...re,textAlign:"right"},children:"Total"}),u.jsx("div",{style:{...re,textAlign:"right"},children:"Cleared"}),u.jsx("div",{style:{...re,textAlign:"right"},children:"Uncleared"}),u.jsx("div",{style:re,children:"Flags"}),u.jsx("div",{style:{...re,textAlign:"right"},children:"Actions"})]})]}),Object.keys(d).length===0&&Q.length===0&&u.jsx("p",{style:{gridColumn:"1 / -1",opacity:.7,textAlign:"center",padding:"2rem"},children:"No accounts yet. Create an account type first, then add accounts!"}),Q.map((ne,ie)=>{const be=h[ne.id]||[];return be.length===0&&N!==ne.id&&A!==ne.id?null:N===ne.id?u.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"1rem"},children:u.jsx(aS,{initialData:{name:ne.name,expected_balance:ne.expected_balance||"positive",on_budget:ne.on_budget??void 0,is_active:ne.is_active??void 0},onSubmit:Ce=>{R(ne.id,Ce),J(null)},onCancel:()=>J(null),submitLabel:"Save"})},ne.id):u.jsx(lS,{group:ne,accounts:be,allGroups:Q,allAccounts:d,accountClearedBalances:H,editingAccountId:L,createForGroupId:A,setEditingAccountId:q,setCreateForGroupId:O,onUpdateAccount:(Ce,ce)=>{x(Ce,ce),q(null)},onDeleteAccount:w,onMoveAccount:E,onCreateAccount:C,isMobile:$,canMoveGroupUp:ie>0,canMoveGroupDown:ie<Q.length-1,onEditGroup:()=>J(ne.id),onDeleteGroup:()=>M(ne.id),onMoveGroupUp:()=>V(ne.id,"up"),onMoveGroupDown:()=>V(ne.id,"down")},ne.id)}),(z.length>0||A==="ungrouped")&&u.jsx(lS,{group:te,accounts:z,allGroups:Q,allAccounts:d,accountClearedBalances:H,editingAccountId:L,createForGroupId:A,setEditingAccountId:q,setCreateForGroupId:O,onUpdateAccount:(ne,ie)=>{x(ne,ie),q(null)},onDeleteAccount:w,onMoveAccount:E,onCreateAccount:C,isMobile:$,isUngrouped:!0,canMoveGroupUp:!1,canMoveGroupDown:!1,onEditGroup:()=>{},onDeleteGroup:()=>{},onMoveGroupUp:()=>{},onMoveGroupDown:()=>{}}),u.jsx("div",{style:{gridColumn:"1 / -1",height:"1rem"}})]}),u.jsx(Gz,{hiddenAccounts:f,accounts:d,sortedGroups:Q,editingAccountId:L,setEditingAccountId:q,onUpdateAccount:x}),Y?u.jsx(aS,{onSubmit:ne=>{T(ne),G(!1)},onCancel:()=>G(!1),submitLabel:"Create Account Type"}):u.jsx(Ve,{variant:"primary-large",actionName:"Open Add Account Type Form",onClick:()=>G(!0),children:"+ Add Account Type"})]})}function i_({initialData:t,onSubmit:e,onCancel:n,submitLabel:r,categoryGroups:i=[],showGroupSelector:o=!1,onDelete:l}){const[d,h]=k.useState(t||{name:"",category_group_id:null,is_hidden:!1}),[f,p]=k.useState(t?.default_monthly_amount?.toString()||""),[g,v]=k.useState(t?.default_monthly_type||"fixed"),[_,C]=k.useState(!1);function x(w){if(w.preventDefault(),!d.name.trim())return;C(!0);const E=parseFloat(f),T=!isNaN(E)&&E>0;e({...d,description:d.description?.trim()||void 0,default_monthly_amount:T?E:void 0,default_monthly_type:T?g:void 0})}return u.jsxs(ji,{actionName:r==="Create"?"Create Category":"Update Category",onSubmit:x,children:[u.jsx(Nt,{label:"Category Name",htmlFor:"category-name",children:u.jsx(Ri,{id:"category-name",type:"text",value:d.name,onChange:w=>h({...d,name:w.target.value}),placeholder:"e.g., Groceries, Rent, Gas",required:!0,autoFocus:!0})}),u.jsx(Nt,{label:"Description (optional)",htmlFor:"category-description",children:u.jsx(K0,{id:"category-description",value:d.description||"",onChange:w=>h({...d,description:w.target.value}),placeholder:"What is this category used for?",minHeight:"3rem"})}),o&&u.jsx(Nt,{label:"Category Group",htmlFor:"category-group",children:u.jsxs(Qu,{id:"category-group",value:d.category_group_id||cn,onChange:w=>h({...d,category_group_id:w.target.value===cn?null:w.target.value}),children:[u.jsx("option",{value:cn,children:"Uncategorized"}),i.map(w=>u.jsx("option",{value:w.id,children:w.name},w.id))]})}),u.jsxs(Nt,{label:"Default Monthly Allocation (optional)",htmlFor:"default-amount",children:[u.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center"},children:[u.jsxs(Qu,{id:"default-type",value:g,onChange:w=>v(w.target.value),style:{width:"auto",flex:"0 0 auto"},children:[u.jsx("option",{value:"fixed",children:"Fixed $"}),u.jsx("option",{value:"percentage",children:"% of Prev Income"})]}),g==="fixed"?u.jsx(Eo,{id:"default-amount",value:f,onChange:p,placeholder:"$0.00"}):u.jsx(Ri,{id:"default-amount",type:"number",value:f,onChange:w=>p(w.target.value),placeholder:"0",min:"0",max:"100",step:"0.1",style:{width:"80px"}}),g==="percentage"&&u.jsx("span",{style:{opacity:.6},children:"%"})]}),u.jsx("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.75rem",opacity:.6},children:g==="fixed"?"Suggested fixed amount to allocate each month":"Percentage of previous month's total income"})]}),o&&u.jsxs("div",{style:{padding:"0.75rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px"},children:[u.jsx(Wr,{id:"is-hidden",checked:d.is_hidden||!1,onChange:w=>h({...d,is_hidden:w.target.checked}),children:"Hidden category"}),u.jsx("p",{style:{margin:"0.25rem 0 0 2rem",fontSize:"0.7rem",opacity:.6},children:"Hidden categories don't appear in dropdowns or balance displays. Use for historical categories that aren't actively used."})]}),u.jsxs($a,{children:[u.jsx(Ve,{type:"submit",actionName:r==="Create"?"Create Category":"Save Category",isLoading:_,children:r}),u.jsx(Ve,{type:"button",variant:"secondary",actionName:"Cancel Category Form",onClick:n,children:"Cancel"}),l&&u.jsx(Ve,{type:"button",variant:"secondary",actionName:"Delete Category",onClick:w=>{w.preventDefault(),l()},style:{color:"#ff6b6b",borderColor:"#ff6b6b"},children:" Delete"})]})]})}function cS({initialData:t,onSubmit:e,onCancel:n,submitLabel:r}){const[i,o]=k.useState(t||{name:""}),[l,d]=k.useState(!1);function h(f){f.preventDefault(),i.name.trim()&&(d(!0),e(i))}return u.jsxs(ji,{actionName:r==="Create Group"?"Create Category Group":"Update Category Group",onSubmit:h,children:[u.jsx(Nt,{label:"Group Name",htmlFor:"group-name",children:u.jsx(Ri,{id:"group-name",type:"text",value:i.name,onChange:f=>o({...i,name:f.target.value}),placeholder:"e.g., Housing, Transportation, Food",required:!0,autoFocus:!0})}),u.jsxs($a,{children:[u.jsx(Ve,{type:"submit",actionName:r==="Create Group"?"Create Category Group":"Save Category Group",isLoading:l,children:r}),u.jsx(Ve,{type:"button",variant:"secondary",actionName:"Cancel Category Group Form",onClick:n,children:"Cancel"})]})]})}function Qz({category:t,catId:e,categoryIndex:n,categoryGroups:r,categoryBalances:i,loadingBalances:o,onEdit:l,onDelete:d,onMoveUp:h,onMoveDown:f,canMoveUp:p,canMoveDown:g,editingCategoryId:v,setEditingCategoryId:_,onUpdateCategory:C,isMobile:x}){const w=i[e]||{current:0,total:0};if(v===e)return u.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"0.5rem"},children:u.jsx(i_,{initialData:{name:t.name,description:t.description,category_group_id:t.category_group_id,default_monthly_amount:t.default_monthly_amount,default_monthly_type:t.default_monthly_type,is_hidden:t.is_hidden},onSubmit:M=>{C(e,M),_(null)},onCancel:()=>_(null),onDelete:()=>{t.name,d(e),_(null)},submitLabel:"Save",categoryGroups:r,showGroupSelector:!0})});if(x)return u.jsx("div",{style:{gridColumn:"1 / -1"},children:u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",padding:"0.75rem",marginBottom:"0.25rem"},children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"},children:[u.jsx("span",{style:{fontWeight:500},children:t.name}),u.jsxs("div",{style:{display:"flex",gap:"1rem",fontSize:"0.85rem"},children:[t.default_monthly_amount!==void 0&&t.default_monthly_amount>0&&u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[u.jsx("span",{style:{opacity:.6,fontSize:"0.7rem"},children:"Default"}),u.jsx("span",{style:{opacity:.7},children:t.default_monthly_type==="percentage"?`${t.default_monthly_amount}%`:`${Vt(t.default_monthly_amount)}/mo`})]}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[u.jsx("span",{style:{opacity:.6,fontSize:"0.7rem"},children:"Available Now"}),u.jsx("span",{style:{color:dn(w.current),fontWeight:600},children:o?"...":yr(w.current)})]}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[u.jsx("span",{style:{opacity:.6,fontSize:"0.7rem"},children:"Total Allocated"}),u.jsx("span",{style:{color:dn(w.total)},children:o?"...":yr(w.total)})]})]})]}),t.description&&u.jsx("p",{style:{fontSize:"0.8rem",opacity:.6,margin:"0 0 0.5rem 0"},children:t.description}),t.default_monthly_amount!==void 0&&t.default_monthly_amount>0&&u.jsxs("div",{style:{fontSize:"0.75rem",opacity:.8,marginBottom:"0.5rem"},children:["Default: ",t.default_monthly_type==="percentage"?u.jsxs(u.Fragment,{children:[u.jsxs("span",{style:{color:fe.success,fontWeight:500},children:[t.default_monthly_amount,"%"]})," of prev income"]}):u.jsxs(u.Fragment,{children:[u.jsx("span",{style:{color:fe.success,fontWeight:500},children:t.default_monthly_amount}),"/mo"]})]}),u.jsxs("div",{style:{display:"flex",gap:"0.5rem",justifyContent:"flex-end"},children:[u.jsx("button",{onClick:M=>{M.stopPropagation(),t.name,l(e)},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Edit",children:""}),u.jsx("button",{onClick:M=>{M.stopPropagation(),h()},disabled:!p,style:{background:"transparent",border:"none",cursor:p?"pointer":"default",opacity:p?.6:.2,fontSize:"0.9rem",padding:"0.25rem"},title:"Move up",children:""}),u.jsx("button",{onClick:M=>{M.stopPropagation(),f()},disabled:!g,style:{background:"transparent",border:"none",cursor:g?"pointer":"default",opacity:g?.6:.2,fontSize:"0.9rem",padding:"0.25rem"},title:"Move down",children:""})]})]})});const T=n%2===0?"transparent":"rgba(255,255,255,0.04)",R={padding:"0.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem"};return u.jsxs("div",{style:{gridColumn:"1 / -1",background:T,display:"grid",gridTemplateColumns:"2fr 1fr 1fr 1fr 2fr 1fr"},children:[u.jsx("div",{style:{...R,fontWeight:500,overflow:"hidden",paddingLeft:"1.5rem",borderLeft:"2px solid rgba(255,255,255,0.1)"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.name})}),u.jsx("div",{style:{...R,justifyContent:"flex-end",opacity:.7,fontSize:"0.85rem"},children:t.default_monthly_amount!==void 0&&t.default_monthly_amount>0?u.jsx("span",{children:t.default_monthly_type==="percentage"?`${t.default_monthly_amount}%`:`${yr(t.default_monthly_amount)}/mo`}):u.jsx("span",{style:{opacity:.3,fontStyle:"italic",color:"#9ca3af"},children:""})}),u.jsx("div",{style:{...R,justifyContent:"flex-end",color:dn(w.current),fontWeight:600},children:o?"...":yr(w.current)}),u.jsx("div",{style:{...R,justifyContent:"flex-end",color:dn(w.total)},children:o?"...":yr(w.total)}),u.jsx("div",{style:{...R,opacity:.7,fontSize:"0.85rem"},children:t.description?u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.description}):u.jsx("span",{style:{opacity:.3,fontStyle:"italic",color:"#9ca3af"},children:""})}),u.jsxs("div",{style:{...R,justifyContent:"flex-end",gap:"0.25rem"},children:[u.jsx("button",{onClick:M=>{M.stopPropagation(),t.name,l(e)},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Edit",children:""}),u.jsx("button",{onClick:M=>{M.stopPropagation(),h()},disabled:!p,style:{background:"transparent",border:"none",cursor:p?"pointer":"default",opacity:p?.6:.2,fontSize:"0.9rem",padding:"0.25rem"},title:"Move up",children:""}),u.jsx("button",{onClick:M=>{M.stopPropagation(),f()},disabled:!g,style:{background:"transparent",border:"none",cursor:g?"pointer":"default",opacity:g?.6:.2,fontSize:"0.9rem",padding:"0.25rem"},title:"Move down",children:""})]})]})}function uS({group:t,categories:e,categoryGroups:n,categoryBalances:r,loadingBalances:i,editingCategoryId:o,createForGroupId:l,setEditingCategoryId:d,setCreateForGroupId:h,handleUpdateCategory:f,handleDeleteCategory:p,handleMoveCategory:g,handleCreateCategory:v,isMobile:_,isUngrouped:C,startRowIndex:x=0,canMoveGroupUp:w,canMoveGroupDown:E,onEditGroup:T,onDeleteGroup:R,onMoveGroupUp:M,onMoveGroupDown:V}){const $=[...e].sort((L,q)=>L[1].sort_order-q[1].sort_order),I=$.reduce((L,[q])=>{const A=r[q];return L+(A?.current||0)},0),D=x===0,P={padding:"0.6rem 0.5rem",marginTop:D?0:"1.25rem",borderTop:"1px solid rgba(255,255,255,0.2)",borderBottom:Oa,background:"rgba(255,255,255,0.04)",display:"flex",alignItems:"center",fontSize:"0.9rem",fontWeight:600};return u.jsxs("div",{style:{display:"contents"},children:[!_&&u.jsxs(u.Fragment,{children:[u.jsxs("div",{style:{...P,opacity:C?.7:1,justifyContent:"space-between"},children:[u.jsxs("span",{children:[u.jsx("span",{children:t.name}),u.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",$.length,")"]})]}),u.jsx("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center",flexShrink:0},children:!C&&u.jsxs(u.Fragment,{children:[u.jsx(Ve,{variant:"small",actionName:`Open Add Category Form (${t.name})`,onClick:()=>h(t.id),disabled:l!==null,children:"+ Category"}),u.jsx("button",{onClick:()=>{t.name,T()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Edit group",children:""}),u.jsx("button",{onClick:()=>{t.name,R()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Delete group",children:""}),u.jsxs("div",{style:Of,children:[u.jsx("button",{onClick:M,disabled:!w,style:{...ya,opacity:w?.6:.2,cursor:w?"pointer":"default"},title:"Move group up","aria-label":"Move group up",children:""}),u.jsx("button",{onClick:V,disabled:!E,style:{...ya,opacity:E?.6:.2,cursor:E?"pointer":"default"},title:"Move group down","aria-label":"Move group down",children:""})]})]})})]}),u.jsx("div",{style:P}),u.jsx("div",{style:{...P,justifyContent:"flex-end",color:dn(I)},children:Yt.showGroupTotals}),u.jsx("div",{style:{...P,justifyContent:"flex-end",color:dn($.reduce((L,[q])=>{const A=r[q];return L+(A?.total||0)},0))},children:Yt.showGroupTotals}),u.jsx("div",{style:P}),u.jsx("div",{style:P})]}),_&&u.jsxs("div",{style:{gridColumn:"1 / -1",padding:"0.6rem 0.5rem",marginTop:D?0:"1.25rem",borderTop:"1px solid rgba(255,255,255,0.2)",borderBottom:Oa,background:"rgba(255,255,255,0.04)"},children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"},children:[u.jsxs("span",{style:{fontWeight:600,opacity:C?.7:1},children:[t.name,u.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",$.length,")"]})]}),Yt.showGroupTotals]}),!C&&u.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center",flexWrap:"wrap"},children:[u.jsx(Ve,{variant:"small",actionName:`Open Add Category Form (${t.name})`,onClick:()=>h(t.id),disabled:l!==null,children:"+ Category"}),u.jsx("button",{onClick:()=>{t.name,T()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Edit group",children:""}),u.jsx("button",{onClick:()=>{t.name,R()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Delete group",children:""}),u.jsxs("div",{style:Of,children:[u.jsx("button",{onClick:M,disabled:!w,style:{...ya,opacity:w?.6:.2,cursor:w?"pointer":"default"},title:"Move group up","aria-label":"Move group up",children:""}),u.jsx("button",{onClick:V,disabled:!E,style:{...ya,opacity:E?.6:.2,cursor:E?"pointer":"default"},title:"Move group down","aria-label":"Move group down",children:""})]})]})]}),$.map(([L,q],A)=>{const O=x+A;return u.jsx(Qz,{category:q,catId:L,categoryIndex:O,totalCategories:$.length,categoryGroups:n,categoryBalances:r,loadingBalances:i,onEdit:d,onDelete:p,onMoveUp:()=>g(L,"up"),onMoveDown:()=>g(L,"down"),canMoveUp:A>0,canMoveDown:A<$.length-1,editingCategoryId:o,setEditingCategoryId:d,onUpdateCategory:f,isMobile:_},L)}),l===t.id&&u.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"0.5rem"},children:u.jsx(i_,{initialData:{name:"",category_group_id:t.id},onSubmit:L=>v(L,t.id),onCancel:()=>h(null),submitLabel:"Create",categoryGroups:n})})]})}function Kz({onBudgetTotal:t,allocated:e,unallocated:n,relationshipMismatch:r,calculationMismatch:i}){return u.jsx("div",{style:{gridColumn:"1 / -1",marginLeft:"calc(-1 * var(--page-padding, 2rem))",marginRight:"calc(-1 * var(--page-padding, 2rem))",paddingLeft:"var(--page-padding, 2rem)",paddingRight:"var(--page-padding, 2rem)",paddingTop:"0.5rem",paddingBottom:"0.5rem"},children:u.jsx("div",{style:{display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingBottom:"0.5rem",borderBottom:"1px solid rgba(255,255,255,0.15)"},children:u.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[u.jsx("span",{style:{fontWeight:600},children:"Categories:"}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"On Budget: "}),u.jsx("span",{style:{color:ct(t),fontWeight:600},children:Vn(t)})]}),u.jsx("span",{style:{opacity:r?1:.5,color:r?"#ef4444":void 0,fontWeight:r?700:void 0},children:r?"":"="}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"Allocated: "}),u.jsx("span",{style:{color:_c(e),fontWeight:600},children:Vn(e)})]}),u.jsx("span",{style:{opacity:r?1:.5,color:r?"#ef4444":void 0,fontWeight:r?700:void 0},children:"+"}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"Unallocated: "}),u.jsx("span",{style:{color:ct(n),fontWeight:600},children:Vn(n)})]}),u.jsx("span",{style:{opacity:.6},children:"Use  buttons to reorder categories."})]})})})}function Yz(){const{isLoading:t,isFetching:e,totalAvailable:n}=jn(),{currentBudget:r,categories:i,categoryGroups:o,categoriesByGroup:l,hiddenCategories:d,sortedGroups:h,categoryBalances:f,isLoading:p,loadingBalances:g,error:v,setError:_,getOnBudgetTotal:C,handleCreateCategory:x,handleUpdateCategory:w,handleDeleteCategory:E,handleMoveCategory:T,handleCreateGroup:R,handleUpdateGroup:M,handleDeleteGroup:V,handleMoveGroup:$}=u3(),I=ki(),{addLoadingHold:D,removeLoadingHold:P}=On(),L=t||p||e||!r;HT(!L&&!!r),k.useEffect(()=>(L?D("categories","Loading categories..."):P("categories"),()=>P("categories")),[L,D,P]);const[q,A]=k.useState(null),[O,N]=k.useState(null),[J,Y]=k.useState(null),[G,Z]=k.useState(!1),Q=k.useMemo(()=>h.filter(ce=>ce.id!==cn),[h]),te=k.useMemo(()=>({id:cn,name:"Uncategorized",sort_order:Q.length}),[Q.length]),z=(l[cn]||[]).sort((ce,ge)=>ce[1].sort_order-ge[1].sort_order);k.useEffect(()=>{v&&(console.error("[Settings/Categories] Error:",v),qn.add({type:"error",message:"Failed to update categories. See console for details.",autoDismissMs:0}),_(null))},[v,_]);const H=k.useMemo(()=>C(),[C]),{allocated:re,unallocated:ne,calculationMismatch:ie,relationshipMismatch:be}=d3({categories:i,categoryBalances:f,totalAvailable:n,onBudgetTotal:H,isDataLoading:L,loadingBalances:g,currentBudget:r});if(L||!r)return L?null:u.jsx("p",{children:"No budget found. Please log in."});const Ce={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",paddingTop:"0.75rem",paddingBottom:"0.5rem",paddingLeft:"0.5rem",paddingRight:"0.5rem",borderBottom:"2px solid rgba(255,255,255,0.2)"};return u.jsxs("div",{children:[u.jsxs("div",{style:{display:"grid",gridTemplateColumns:I?"1fr":"2fr 1fr 1fr 1fr 2fr 1fr",marginBottom:"1.5rem"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:50,backgroundColor:"#242424",display:I?"block":"grid",gridTemplateColumns:I?void 0:"subgrid"},children:[u.jsx(Kz,{onBudgetTotal:H,allocated:re,unallocated:ne,relationshipMismatch:be,calculationMismatch:ie}),u.jsx("div",{style:{gridColumn:"1 / -1",display:"flex",gap:"0.5rem",flexShrink:0,justifyContent:"flex-end",paddingRight:"var(--page-padding, 2rem)",marginTop:"-0.5rem",marginBottom:"0.5rem"},children:u.jsx(e_,{})}),!I&&u.jsxs(u.Fragment,{children:[u.jsx("div",{style:Ce,children:"Category"}),u.jsx("div",{style:{...Ce,textAlign:"right"},children:"Default"}),u.jsx("div",{style:{...Ce,textAlign:"right"},children:"Available Now"}),u.jsx("div",{style:{...Ce,textAlign:"right"},children:"Total Allocated"}),u.jsx("div",{style:Ce,children:"Description"}),u.jsx("div",{style:{...Ce,textAlign:"right"},children:"Actions"})]})]}),Object.keys(i).length===0&&o.length===0&&u.jsx("p",{style:{gridColumn:"1 / -1",opacity:.7,textAlign:"center",padding:"2rem"},children:"No categories yet. Create a group first, then add categories!"}),(()=>{const ce={};let ge=0;return Q.forEach(Oe=>{const ze=(l[Oe.id]||[]).sort((ot,st)=>ot[1].sort_order-st[1].sort_order);ce[Oe.id]=ge,ge+=ze.length}),Q.map((Oe,ze)=>{const ot=(l[Oe.id]||[]).sort((st,U)=>st[1].sort_order-U[1].sort_order);return ot.length===0&&J!==Oe.id&&O!==Oe.id?null:J===Oe.id?u.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"1rem"},children:u.jsx(cS,{initialData:{name:Oe.name},onSubmit:st=>{M(Oe.id,st),Y(null)},onCancel:()=>Y(null),submitLabel:"Save"})},Oe.id):u.jsx(uS,{group:Oe,categories:ot,categoryGroups:o,categoryBalances:f,loadingBalances:g,editingCategoryId:q,createForGroupId:O,setEditingCategoryId:A,setCreateForGroupId:N,handleUpdateCategory:w,handleDeleteCategory:E,handleMoveCategory:T,handleCreateCategory:x,isMobile:I,canMoveGroupUp:ze>0,canMoveGroupDown:ze<Q.length-1,onEditGroup:()=>Y(Oe.id),onDeleteGroup:()=>V(Oe.id),onMoveGroupUp:()=>$(Oe.id,"up"),onMoveGroupDown:()=>$(Oe.id,"down"),startRowIndex:ce[Oe.id]??0},Oe.id)})})(),(z.length>0||O==="ungrouped")&&(()=>{const ce=Q.reduce((ge,Oe)=>{const ze=(l[Oe.id]||[]).sort((ot,st)=>ot[1].sort_order-st[1].sort_order);return ge+ze.length},0);return u.jsx(uS,{group:te,categories:z,categoryGroups:o,categoryBalances:f,loadingBalances:g,editingCategoryId:q,createForGroupId:O,setEditingCategoryId:A,setCreateForGroupId:N,handleUpdateCategory:w,handleDeleteCategory:E,handleMoveCategory:T,handleCreateCategory:x,isMobile:I,isUngrouped:!0,canMoveGroupUp:!1,canMoveGroupDown:!1,onEditGroup:()=>{},onDeleteGroup:()=>{},onMoveGroupUp:()=>{},onMoveGroupDown:()=>{},startRowIndex:ce})})(),u.jsx("div",{style:{gridColumn:"1 / -1",height:"1rem"}})]}),d.length>0&&u.jsx("div",{style:{marginBottom:"2rem"},children:u.jsxs(Z0,{title:"Hidden Categories",count:d.length,children:[u.jsxs("div",{style:{padding:"0.75rem",marginBottom:"1rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",fontSize:"0.85rem"},children:[u.jsxs("p",{style:{margin:"0 0 0.5rem 0",opacity:.8},children:[u.jsx("strong",{children:" Hidden categories"})," are excluded from dropdowns and balance displays. They're useful for historical categories that you want to keep for record-keeping but don't need in everyday use."]}),u.jsx("p",{style:{margin:0,opacity:.6},children:'To unhide a category, click it to edit and uncheck "Hidden category".'})]}),u.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:d.map(([ce,ge])=>q===ce?u.jsx(i_,{initialData:{name:ge.name,description:ge.description,category_group_id:ge.category_group_id,default_monthly_amount:ge.default_monthly_amount,default_monthly_type:ge.default_monthly_type,is_hidden:ge.is_hidden},onSubmit:Oe=>{w(ce,Oe),A(null)},onCancel:()=>A(null),submitLabel:"Save",categoryGroups:o,showGroupSelector:!0},ce):u.jsxs("div",{onClick:()=>A(ce),style:{padding:"0.75rem 1rem",background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"8px",cursor:"pointer",display:"flex",justifyContent:"space-between",alignItems:"center",opacity:.7},children:[u.jsx("span",{children:ge.name}),u.jsx("span",{style:{color:ct(ge.balance),fontWeight:500},children:Vn(ge.balance)})]},ce))})]})}),G?u.jsx(cS,{onSubmit:ce=>{R(ce),Z(!1)},onCancel:()=>Z(!1),submitLabel:"Create Group"}):u.jsx(Ve,{variant:"primary-large",actionName:"Open Add Category Group Form",onClick:()=>Z(!0),children:"+ Add Category Group"})]})}function Xz(){const{selectedBudgetId:t,currentUserId:e}=Xe(),{addLoadingHold:n,removeLoadingHold:r}=On(),{budget:i,budgetUserIds:o,acceptedUserIds:l,isLoading:d}=jn();k.useEffect(()=>(d||!i?n("users","Loading users..."):r("users"),()=>r("users")),[d,i,n,r]);const{inviteUser:h}=Pz(),{revokeUser:f}=Bz(),[p,g]=k.useState(""),[v,_]=k.useState(!1),[C,x]=k.useState(null),[w,E]=k.useState(null);if(d)return null;if(!i)return u.jsx("p",{children:"No budget found."});async function T($){if($.preventDefault(),!(!p.trim()||!i||!t)){_(!0),x(null),E(null);try{await h.mutateAsync({budgetId:t,userId:p.trim()}),g(""),E("Invite sent! The user can now accept the invitation from their account.")}catch(I){x(I instanceof Error?I.message:"Failed to invite user")}finally{_(!1)}}}async function R($){if(!i||!t)return;if($===i.owner_id){x("Cannot revoke the budget owner");return}if($===e){x("Cannot revoke yourself from the budget");return}const I=l.includes($);if(confirm(I?"Are you sure you want to revoke this user's access? They will lose access to this budget.":"Are you sure you want to cancel this invitation?")){x(null),E(null);try{await f.mutateAsync({budgetId:t,userId:$}),E(I?"User access revoked.":"Invitation cancelled.")}catch(P){x(P instanceof Error?P.message:"Failed to revoke user")}}}const M=o.filter($=>l.includes($)),V=o.filter($=>!l.includes($));return u.jsxs("div",{children:[u.jsx("h2",{style:{marginTop:0},children:"Budget Users"}),u.jsx("p",{style:{opacity:.7,marginBottom:"1.5rem"},children:"Invite users to access this budget. They must accept the invitation before they can access it."}),C&&u.jsxs("div",{style:{background:"rgba(220, 38, 38, 0.1)",border:"1px solid rgba(220, 38, 38, 0.3)",color:"#f87171",padding:"0.75rem 1rem",borderRadius:"8px",marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[u.jsx("span",{children:C}),u.jsx("button",{onClick:()=>x(null),style:{background:"transparent",border:"none",color:"#f87171",cursor:"pointer",fontSize:"1.2rem",padding:"0 0.25rem",lineHeight:1},children:""})]}),w&&u.jsxs("div",{style:{background:"rgba(34, 197, 94, 0.1)",border:"1px solid rgba(34, 197, 94, 0.3)",color:"#4ade80",padding:"0.75rem 1rem",borderRadius:"8px",marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[u.jsx("span",{children:w}),u.jsx("button",{onClick:()=>E(null),style:{background:"transparent",border:"none",color:"#4ade80",cursor:"pointer",fontSize:"1.2rem",padding:"0 0.25rem",lineHeight:1},children:""})]}),u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px",marginBottom:"1.5rem"},children:[u.jsxs("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem"},children:["Active Users (",M.length,")"]}),M.length===0?u.jsx("p",{style:{opacity:.6,margin:0},children:"No users have accepted invitations yet."}):u.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:M.map($=>{const I=$===i.owner_id,D=$===e;return u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 8%, transparent)",padding:"0.75rem 1rem",borderRadius:"6px",display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem"},children:[u.jsx("div",{style:{flex:1,minWidth:0},children:u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flexWrap:"wrap"},children:[u.jsx("code",{style:{fontSize:"0.85rem",background:"color-mix(in srgb, currentColor 10%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",wordBreak:"break-all"},children:$}),I&&u.jsx("span",{style:{background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.7rem",textTransform:"uppercase",fontWeight:600},children:"Owner"}),D&&u.jsx("span",{style:{background:"color-mix(in srgb, #22c55e 20%, transparent)",color:"#4ade80",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.7rem",textTransform:"uppercase",fontWeight:600},children:"You"})]})}),!I&&!D&&u.jsx("button",{onClick:()=>R($),style:{background:"transparent",border:"1px solid rgba(220, 38, 38, 0.4)",color:"#f87171",padding:"0.4rem 0.75rem",borderRadius:"6px",cursor:"pointer",fontSize:"0.8rem",whiteSpace:"nowrap"},children:"Revoke Access"})]},$)})})]}),V.length>0&&u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px",marginBottom:"1.5rem"},children:[u.jsxs("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem"},children:["Pending Invitations (",V.length,")"]}),u.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:V.map($=>u.jsxs("div",{style:{background:"color-mix(in srgb, #f59e0b 10%, transparent)",border:"1px solid color-mix(in srgb, #f59e0b 30%, transparent)",padding:"0.75rem 1rem",borderRadius:"6px",display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem"},children:[u.jsx("div",{style:{flex:1,minWidth:0},children:u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flexWrap:"wrap"},children:[u.jsx("code",{style:{fontSize:"0.85rem",background:"color-mix(in srgb, currentColor 10%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",wordBreak:"break-all"},children:$}),u.jsx("span",{style:{background:"color-mix(in srgb, #f59e0b 20%, transparent)",color:"#fbbf24",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.7rem",textTransform:"uppercase",fontWeight:600},children:"Pending"})]})}),u.jsx("button",{onClick:()=>R($),style:{background:"transparent",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)",color:"inherit",padding:"0.4rem 0.75rem",borderRadius:"6px",cursor:"pointer",fontSize:"0.8rem",whiteSpace:"nowrap",opacity:.8},children:"Cancel Invite"})]},$))})]}),u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px"},children:[u.jsx("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem"},children:"Invite User"}),u.jsxs("form",{onSubmit:T,style:{display:"flex",gap:"0.75rem"},children:[u.jsx("input",{type:"text",value:p,onChange:$=>g($.target.value),placeholder:"Enter Firebase User ID",style:{flex:1,padding:"0.6rem 0.8rem",borderRadius:"6px",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"0.95rem",color:"inherit"}}),u.jsx("button",{type:"submit",disabled:v||!p.trim(),style:{background:"#646cff",color:"white",border:"none",padding:"0.6rem 1.25rem",borderRadius:"6px",cursor:v||!p.trim()?"not-allowed":"pointer",fontWeight:500,opacity:v||!p.trim()?.7:1,whiteSpace:"nowrap"},children:v?"Inviting...":"Send Invite"})]}),u.jsx("p",{style:{margin:"1rem 0 0 0",fontSize:"0.85rem",opacity:.6},children:" The invited user will need to accept the invitation from their Account page using this budget's ID:"}),u.jsx("code",{style:{display:"block",marginTop:"0.5rem",padding:"0.5rem 0.75rem",background:"color-mix(in srgb, currentColor 10%, transparent)",borderRadius:"6px",fontSize:"0.85rem",wordBreak:"break-all"},children:i.id})]})]})}const Zz=["budget","feedback","migration","tests"];function Jz(){const{isAdmin:t,isTest:e,lastAdminTab:n,setLastAdminTab:r,setPageTitle:i}=Xe();k.useLayoutEffect(()=>{i("Budget Admin")},[i]);const o=tr(),l=o.pathname==="/budget/admin",d=k.useMemo(()=>{const g=o.pathname;return g.includes("/admin/budget")?"budget":g.includes("/admin/feedback")?"feedback":g.includes("/admin/migration")?"migration":g.includes("/admin/tests")?"tests":"budget"},[o.pathname]),h=d==="tests";k.useEffect(()=>{l||r(d)},[d,l,r]);function f(){return!Zz.includes(n)||n==="tests"&&!e?"budget":n}const p=k.useMemo(()=>[{id:"budget",label:"Budget",icon:""},{id:"feedback",label:"Feedback",icon:""},{id:"migration",label:"Migration",icon:""},{id:"tests",label:"Tests",icon:"",hidden:!e}],[e]);return t?!e&&h?u.jsxs("div",{children:[u.jsx("h1",{children:"Access Denied"}),u.jsx("p",{style:{opacity:.7},children:"Only test users can access this section."}),u.jsx("p",{style:{marginTop:"1rem"},children:u.jsx(Tn,{to:"/budget/admin/budget",children:"Go to Admin "})})]}):u.jsxs("div",{children:[u.jsx(Pf,{mode:"link",linkPrefix:"/budget/admin",tabs:p,activeTab:d}),l?u.jsx(Uf,{to:`/budget/admin/${f()}`,replace:!0}):u.jsx(Ff,{})]}):u.jsxs("div",{children:[u.jsx("h1",{children:"Access Denied"}),u.jsx("p",{style:{opacity:.7},children:"Only administrators can access this section."}),u.jsx("p",{style:{marginTop:"1rem"},children:u.jsx(Tn,{to:"/budget",children:"Go to Budget "})})]})}function eL(){const{addLoadingHold:t,removeLoadingHold:e}=On(),{isAdmin:n}=Xe(),{budget:r,accounts:i,accountGroups:o,categories:l,categoryGroups:d,isOwner:h,isLoading:f}=jn();return k.useEffect(()=>(f?t("settings-budget","Loading budget info..."):e("settings-budget"),()=>e("settings-budget")),[f,t,e]),f?null:r?u.jsxs("div",{children:[u.jsx("h2",{style:{marginTop:0},children:"Budget Summary"}),u.jsx("p",{style:{opacity:.7,marginBottom:"1.5rem"},children:"Information about the currently selected budget."}),u.jsx("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px",marginBottom:"1.5rem"},children:u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem",fontSize:"0.95rem"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{children:""}),u.jsx("span",{style:{opacity:.7,minWidth:"80px"},children:"Name:"}),u.jsx("strong",{children:r.name})]}),u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{children:""}),u.jsx("span",{style:{opacity:.7,minWidth:"80px"},children:"ID:"}),u.jsx("code",{style:{background:"color-mix(in srgb, currentColor 10%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",fontSize:"0.85rem"},children:r.id})]}),u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{children:""}),u.jsx("span",{style:{opacity:.7,minWidth:"80px"},children:"Owner:"}),u.jsx("strong",{children:r.owner_email||r.owner_id})]}),u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{children:""}),u.jsx("span",{style:{opacity:.7,minWidth:"80px"},children:"Users:"}),u.jsxs("span",{children:[r.user_ids.length," user",r.user_ids.length!==1?"s":"",u.jsxs("span",{style:{opacity:.7},children:["  ",h?"You are the owner":"Shared with you"]})]})]})]})}),n&&u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px"},children:[u.jsx("h3",{style:{margin:"0 0 0.75rem 0",fontSize:"1rem"},children:"Admin Tools"}),u.jsx("button",{onClick:()=>{const p={...r,accounts:i,account_groups:o,categories:l,category_groups:d,_meta:{downloaded_at:new Date().toISOString()}},g=new Blob([JSON.stringify(p,null,2)],{type:"application/json"}),v=URL.createObjectURL(g),_=document.createElement("a");_.href=v,_.download=`budget_${r.id}.json`,document.body.appendChild(_),_.click(),document.body.removeChild(_),URL.revokeObjectURL(v)},style:{display:"inline-flex",alignItems:"center",gap:"0.5rem",background:"color-mix(in srgb, currentColor 10%, transparent)",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",borderRadius:"6px",padding:"0.5rem 0.75rem",cursor:"pointer",fontSize:"0.85rem",color:"inherit",transition:"background 0.15s"},title:"Download budget document as JSON (for debugging)",children:" Download Budget JSON"})]})]}):u.jsx("p",{style:{opacity:.7},children:"No budget selected."})}function dS({selectedType:t,onSelect:e}){return u.jsx("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"0.75rem",paddingBottom:"1rem",flexWrap:"wrap"},children:["critical_bug","bug","new_feature","core_feature","qol"].map(n=>{const r=Bf[n],i=t==="feature"?"new_feature":t,o=i===n||!i&&n==="bug";return u.jsxs("button",{type:"button",onClick:()=>{r.label,e(n)},style:{flex:1,padding:"0.6rem 0.75rem",border:`2px solid ${r.color}`,borderRadius:"0.5rem",background:o?r.bgColor:"transparent",color:o?r.color:"rgba(255,255,255,0.5)",cursor:"pointer",fontWeight:o?600:400,fontSize:"0.85rem",transition:"all 0.15s ease",opacity:o?1:.5,boxShadow:o?`0 0 12px ${r.bgColor}`:"none",position:"relative"},children:[r.label,o&&u.jsx("span",{style:{position:"absolute",bottom:"-14px",left:"10%",right:"10%",height:"3px",background:"white",borderRadius:"2px"}})]},n)})})}function tL(){const[t,e]=k.useState(null),[n,r]=k.useState(null),[i,o]=k.useState(!1),[l,d]=k.useState(""),[h,f]=k.useState("bug"),[p,g]=k.useState(null),[v,_]=k.useState(!1),[C,x]=k.useState(null),w=k.useContext(md),T=za().get_current_firebase_user(),R=$t(),M=b4(),{submitFeedback:V}=eA(),{toggleFeedback:$}=IP(),{updateSortOrder:I}=kP(),D=M.data?.items||[],P=ki(),{addLoadingHold:L,removeLoadingHold:q}=On();k.useEffect(()=>(M.isLoading?L("settings-feedback","Loading feedback..."):q("settings-feedback"),()=>q("settings-feedback")),[M.isLoading,L,q]);function A(ce){ce.preventDefault(),!(!l.trim()||!w.username||!T)&&(V.mutate({userId:T.uid,userEmail:w.username,text:l.trim(),feedbackType:h,currentPath:"/settings/feedback"}),d(""),f("bug"),o(!1))}function O(ce){ce.is_done?N(ce):g(ce)}async function N(ce){try{await $.mutateAsync({item:ce})}catch(ge){console.error("[Feedback] Error updating feedback:",ge),qn.add({type:"error",message:"Failed to update feedback",autoDismissMs:5e3})}}function J(){p&&(N(p),g(null))}async function Y(){_(!1);const ce="mark-all-feedback-complete";L(ce,`Marking ${Q.length} item${Q.length!==1?"s":""} as complete...`);try{const ge=new Date().toISOString(),Oe=new Set(Q.map(de=>de.id)),ze=new Map;for(const de of Q)ze.has(de.doc_id)||ze.set(de.doc_id,[]),ze.get(de.doc_id).push(de);const ot=[];for(const[de,ye]of ze){const ee=(async()=>{const oe=(await JT(de,"mark all feedback complete")).items.map(Se=>Oe.has(Se.id)?{...Se,is_done:!0,completed_at:ge}:Se);await X0({docId:de,items:oe,description:`marking ${ye.length} feedback item${ye.length!==1?"s":""} as complete`})})();ot.push(ee)}await Promise.all(ot);const st=Te.feedback(),U=R.getQueryData(st);U&&R.setQueryData(st,{items:U.items.map(de=>Oe.has(de.id)?{...de,is_done:!0,completed_at:ge}:de)}),await R.invalidateQueries({queryKey:st}),qn.add({type:"success",message:`Marked ${Q.length} item${Q.length!==1?"s":""} as complete`,autoDismissMs:3e3})}catch(ge){console.error("[Feedback] Error marking all as complete:",ge),qn.add({type:"error",message:"Failed to mark all items as complete",autoDismissMs:5e3}),await R.invalidateQueries({queryKey:Te.feedback()})}finally{q(ce)}}function G(){Y()}async function Z(ce){if(C){try{const Oe=D.filter(ze=>ze.doc_id===C.doc_id).map(ze=>({id:ze.id,text:ze.text,created_at:ze.created_at,is_done:ze.is_done,completed_at:ze.completed_at,sort_order:ze.sort_order,feedback_type:ze.id===C.id?ce:ze.feedback_type}));await I.mutateAsync({docId:C.doc_id,items:Oe})}catch(ge){console.error("[Feedback] Error updating feedback type:",ge),qn.add({type:"error",message:"Failed to update feedback type",autoDismissMs:5e3})}x(null)}}const Q=D.filter(ce=>!ce.is_done).sort((ce,ge)=>ce.sort_order-ge.sort_order),te=D.filter(ce=>ce.is_done).sort((ce,ge)=>new Date(ge.completed_at||0).getTime()-new Date(ce.completed_at||0).getTime());function z(ce,ge){e(ge),ce.dataTransfer.effectAllowed="move"}function H(ce,ge){ce.preventDefault(),ge!==t&&r(ge)}function re(){r(null)}function ne(){e(null),r(null)}async function ie(ce,ge){if(ce.preventDefault(),!t||t===ge){ne();return}const Oe=Q.findIndex(de=>de.id===t),ze=[...Q],[ot]=ze.splice(Oe,1);if(ge==="__end__")ze.push(ot);else{const de=ze.findIndex(ye=>ye.id===ge);ze.splice(de,0,ot)}const st=ze.map((de,ye)=>({...de,sort_order:ye}));ne();const U=new Map;for(const de of st)U.has(de.doc_id)||U.set(de.doc_id,[]),U.get(de.doc_id).push({id:de.id,text:de.text,created_at:de.created_at,is_done:de.is_done,completed_at:de.completed_at,sort_order:de.sort_order,feedback_type:de.feedback_type});for(const de of te)U.has(de.doc_id)||U.set(de.doc_id,[]),U.get(de.doc_id).push({id:de.id,text:de.text,created_at:de.created_at,is_done:de.is_done,completed_at:de.completed_at,sort_order:de.sort_order,feedback_type:de.feedback_type});try{for(const[de,ye]of U)await I.mutateAsync({docId:de,items:ye})}catch(de){console.error("[Feedback] Error saving order:",de),qn.add({type:"error",message:"Failed to save order",autoDismissMs:5e3})}}function be(){const ce=Ce(Q),ge=new Blob([ce],{type:"text/markdown"}),Oe=URL.createObjectURL(ge),ze=document.createElement("a");ze.href=Oe,ze.download=`feedback-${new Date().toISOString().split("T")[0]}.md`,document.body.appendChild(ze),ze.click(),document.body.removeChild(ze),URL.revokeObjectURL(Oe)}function Ce(ce){let ge=`# Feedback Export

`;return ge+=`Generated: ${new Date().toISOString()}

`,ce.length>0&&(ge+=`## Pending

`,ce.forEach((Oe,ze)=>{const ot=Oe.feedback_type?Bf[Oe.feedback_type]?.label||Oe.feedback_type:"Unknown";ge+=`### ${ze+1}. [${ot}] ${Oe.text.split(`
`)[0].substring(0,60)}${Oe.text.split(`
`)[0].length>60?"...":""}

`,ge+=`- **Type:** ${ot}
`,ge+=`- **Created:** ${Oe.created_at}
`,ge+=`- **User:** ${Oe.user_email||Oe.doc_id}
`,ge+=`- **ID:** ${Oe.id}

`,ge+=`${Oe.text}

`,ge+=`---

`})),ge}return M.isLoading?null:u.jsxs("div",{children:[u.jsxs("div",{style:{display:"flex",flexDirection:P?"column":"row",justifyContent:"space-between",alignItems:P?"stretch":"flex-start",gap:P?"0.75rem":"1rem",marginTop:"1.5rem",marginBottom:"0.5rem"},children:[u.jsxs("div",{children:[u.jsx("h2",{style:{marginTop:0},children:"Feedback"}),u.jsx("p",{style:{...kT,fontSize:"0.9rem"},children:"View and manage user feedback. Drag to reorder pending items."})]}),u.jsxs("div",{style:{display:"flex",gap:"0.75rem",flexDirection:P?"column":"row"},children:[u.jsx(Ve,{variant:"secondary",actionName:"Download Feedback as Markdown",onClick:be,disabled:Q.length===0,style:P?{width:"100%"}:void 0,children:"Download Markdown"}),u.jsx(Ve,{variant:"secondary",actionName:"Mark All Complete",onClick:()=>_(!0),disabled:Q.length===0,style:P?{width:"100%"}:void 0,children:"Mark All Complete"})]})]}),u.jsxs("div",{style:k1,children:[Q.length===0&&!i&&u.jsx("p",{style:{opacity:.7},children:"No pending feedback."}),Q.map(ce=>u.jsx(mB,{item:ce,isDragging:t===ce.id,isDragOver:n===ce.id,onDragStart:ge=>z(ge,ce.id),onDragOver:ge=>H(ge,ce.id),onDragLeave:re,onDragEnd:ne,onDrop:ge=>ie(ge,ce.id),onToggleDone:()=>O(ce),onTypeClick:()=>x(ce)},ce.id)),t&&Q.length>0&&u.jsx(jP,{isActive:n==="__end__",onDragOver:ce=>H(ce,"__end__"),onDragLeave:re,onDrop:ce=>ie(ce,"__end__")})]}),i?u.jsxs(ji,{actionName:"Add Feedback",onSubmit:A,children:[u.jsx(dS,{selectedType:h,onSelect:f}),u.jsx(K0,{value:l,onChange:ce=>d(ce.target.value),placeholder:"Enter your feedback, bug report, or feature request...",autoFocus:!0,required:!0}),u.jsxs($a,{children:[u.jsx(Ve,{type:"submit",actionName:"Add Feedback",disabled:!l.trim(),children:"Add Feedback"}),u.jsx(Ve,{type:"button",variant:"secondary",actionName:"Cancel Add Feedback",onClick:()=>{o(!1),d(""),f("bug")},children:"Cancel"})]})]}):u.jsx(Ve,{variant:"primary-large",actionName:"Open Add Feedback Form",onClick:()=>o(!0),children:"+ Add Feedback"}),te.length>0&&u.jsx(Z0,{title:"Completed",count:te.length,children:u.jsx("div",{style:{...k1,marginTop:"0.5rem"},children:te.map(ce=>u.jsx(pB,{item:ce,onToggleDone:()=>O(ce),onTypeClick:()=>x(ce)},ce.id))})}),u.jsxs(hs,{isOpen:p!==null,onClose:()=>g(null),title:"Mark as Complete",children:[u.jsx("p",{style:{margin:"0 0 1.5rem 0"},children:"Are you sure you want to mark this feedback item as complete?"}),p&&u.jsxs("p",{style:{margin:"0 0 1.5rem 0",padding:"0.75rem",background:"rgba(255,255,255,0.05)",borderRadius:"0.5rem",fontSize:"0.9rem"},children:['"',p.text,'"']}),u.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[u.jsx(Ve,{variant:"secondary",actionName:"Cancel Mark Complete",onClick:()=>g(null),children:"Cancel"}),u.jsx(Ve,{variant:"primary",actionName:"Confirm Mark Complete",onClick:J,children:"Mark Complete"})]})]}),u.jsxs(hs,{isOpen:v,onClose:()=>_(!1),title:"Mark All as Complete",children:[u.jsxs("p",{style:{margin:"0 0 1.5rem 0"},children:["Are you sure you want to mark all ",Q.length," pending feedback item",Q.length!==1?"s":""," as complete?"]}),u.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[u.jsx(Ve,{variant:"secondary",actionName:"Cancel Mark All Complete",onClick:()=>_(!1),children:"Cancel"}),u.jsx(Ve,{variant:"primary",actionName:"Confirm Mark All Complete",onClick:G,children:"Mark All Complete"})]})]}),u.jsxs(hs,{isOpen:C!==null,onClose:()=>x(null),title:"Change Feedback Type",children:[u.jsx("p",{style:{margin:"0 0 1rem 0",fontSize:"0.9rem",opacity:.8},children:"Select a new type for this feedback:"}),u.jsx(dS,{selectedType:C?.feedback_type||"bug",onSelect:Z}),u.jsx(Ve,{variant:"secondary",actionName:"Cancel Change Feedback Type",onClick:()=>x(null),style:{width:"100%"},children:"Cancel"})]})]})}function nL(){Be.clear(),window.location.reload()}function rL(){const e=za().get_current_firebase_user(),{selectedBudgetId:n}=Xe(),r=yP({currentUser:e}),i=vP({currentUser:e}),o=mP({currentUser:e}),l=K3({currentUser:e}),d=H3({currentUser:e}),h=tP({currentUser:e}),f=P3({currentUser:e}),p=SP({currentUser:e,budgetId:n}),g=AP({currentUser:e}),v=I3({currentUser:e}),_=k3({currentUser:e}),C=r.isScanning||i.isScanning||o.isScanning||l.isScanning||d.isScanning||h.isScanning||f.isScanning||v.isScanning||_.isScanning,x=r.isRunning||i.isRunning||l.isRunning||d.isRunning||h.isRunning||f.isRunning||v.isDeleting||_.isDeleting||p.isDownloading||g.isUploading,w=async()=>{await Promise.all([r.scanStatus(),i.scanStatus(),o.scan(),l.scanStatus(),d.scanStatus(),h.scanStatus(),f.scan(),v.scanStatus(),_.scanStatus()])};return u.jsxs("div",{children:[u.jsx("style",{children:"@keyframes spin { to { transform: rotate(360deg); } }"}),u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"},children:[u.jsx("h2",{style:{margin:0},children:"Data Migrations"}),u.jsxs("button",{onClick:w,disabled:C||x,style:{background:"#646cff",color:"white",border:"none",padding:"0.5rem 1rem",borderRadius:"6px",cursor:C||x?"not-allowed":"pointer",fontWeight:500,opacity:C||x?.7:1,display:"flex",alignItems:"center",gap:"0.4rem",minWidth:"130px",minHeight:"36px"},children:[u.jsx("span",{style:{width:"18px",height:"18px",display:"inline-flex",justifyContent:"center",alignItems:"center",flexShrink:0},children:C?u.jsx(Hn,{noMargin:!0}):""}),"Refresh All"]})]}),u.jsx("p",{style:{opacity:.7,marginBottom:"1.5rem"},children:'Run migrations to validate and fix your database. Click "Refresh All" to scan Firestore directly.'}),u.jsx(AB,{disabled:!e,onDownloadBackup:p.downloadBudget,isDownloadingBackup:p.isDownloading,removeTotalFieldsMigration:{status:r.status,hasData:!!r.status,needsMigration:r.needsMigration,totalItemsToFix:r.totalItemsToFix,isScanning:r.isScanning,isRunning:r.isRunning,result:r.result,scanStatus:r.scanStatus,runMigration:r.runMigration},removePreviousMonthIncomeMigration:{status:i.status,hasData:!!i.status,needsMigration:i.needsMigration,totalItemsToFix:i.totalItemsToFix,isScanning:i.isScanning,isRunning:i.isRunning,result:i.result,scanStatus:i.scanStatus,runMigration:i.runMigration}}),u.jsx(kB,{disabled:!e,onDownloadBackup:p.downloadBudget,isDownloadingBackup:p.isDownloading,accountCategoryValidation:{status:o.status,hasData:!!o.status,hasViolations:o.hasViolations,violationCount:o.violationCount,isScanning:o.isScanning,report:o.report,scan:o.scan},orphanedIdCleanup:{status:l.status,hasData:!!l.status,hasItemsToFix:l.hasItemsToFix,totalOrphaned:l.status?l.status.orphanedCategoryIds+l.status.orphanedAccountIds:0,isScanning:l.isScanning,isRunning:l.isRunning,result:l.result,scanStatus:l.scanStatus,runMigration:l.runMigration},expenseToAdjustment:{status:d.status,hasData:!!d.status,hasItemsToMigrate:d.hasItemsToMigrate,totalToMigrate:d.status?.expensesToMigrate??0,isScanning:d.isScanning,isRunning:d.isRunning,result:d.result,scanStatus:d.scanStatus,runMigration:d.runMigration},adjustmentsToTransfers:{status:h.status,hasData:!!h.status,hasPairsToConvert:h.hasPairsToConvert,totalPairs:h.status?.pairsFound??0,isScanning:h.isScanning,isRunning:h.isRunning,result:h.result,scanStatus:h.scanStatus,runMigration:h.runMigration},precisionCleanup:{status:f.status,hasData:f.hasData,hasIssues:f.hasIssues,totalIssues:f.totalIssues,isScanning:f.isScanning,isRunning:f.isRunning,result:f.result,scan:f.scan,runCleanup:f.runCleanup}}),u.jsx(PB,{disabled:!e,onDownloadBackup:p.downloadBudget,isDownloadingBackup:p.isDownloading,budgetDownloadUpload:{isDownloading:p.isDownloading,downloadProgress:p.progress,downloadError:p.error,downloadBudget:p.downloadBudget,isScanning:g.isScanning,isUploading:g.isUploading,uploadStatus:g.status,uploadProgress:g.progress,uploadError:g.error,uploadResult:g.result,scanZipFile:g.scanZipFile,uploadBudget:g.uploadBudget},deleteAllMonths:{status:v.status,hasData:!!v.status,monthsCount:v.status?.monthsCount??0,budgetCount:v.status?.budgetCount??0,isScanning:v.isScanning,isDeleting:v.isDeleting,deleteResult:v.deleteResult,deleteProgress:v.deleteProgress,scanStatus:v.scanStatus,deleteAllMonths:v.deleteAllMonths},deleteSampleUserBudget:{status:_.status,hasData:!!_.status,totalBudgets:_.status?.totalBudgets??0,totalMonths:_.status?.totalMonths??0,isScanning:_.isScanning,isDeleting:_.isDeleting,deleteResult:_.deleteResult,deleteProgress:_.deleteProgress,scanStatus:_.scanStatus,deleteSampleUserBudget:_.deleteSampleUserBudget},onClearCache:nL}),u.jsx("div",{style:{background:"color-mix(in srgb, currentColor 3%, transparent)",padding:"1rem",borderRadius:"8px",fontSize:"0.85rem"},children:u.jsxs("p",{style:{margin:0,opacity:.7},children:[u.jsx("strong",{children:"Note:"})," These migrations will process ",u.jsx("strong",{children:"all budgets and months"})," in the system, not just the ones you own or are invited to."]})}),u.jsx(aA,{})]})}function Ol({name:t,description:e,expectedBehavior:n,result:r,onRun:i,disabled:o,expectedToSucceed:l}){const d=r?.status==="passed"?fe.success:r?.status==="failed"?fe.danger:r?.status==="running"?fe.warning:"inherit";return u.jsxs("div",{style:{...G0,display:"flex",flexDirection:"column",gap:"0.5rem"},children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",gap:"1rem"},children:[u.jsxs("div",{style:{flex:1},children:[u.jsx("h4",{style:{margin:0,fontSize:"0.95rem"},children:t}),u.jsx("p",{style:{margin:"0.25rem 0 0",opacity:.7,fontSize:"0.85rem"},children:e}),u.jsxs("p",{style:{margin:"0.25rem 0 0",fontSize:"0.8rem",color:l?fe.success:fe.warning},children:["Expected: ",n]})]}),u.jsx(Ve,{onClick:i,disabled:o,variant:"secondary",style:{flexShrink:0},children:r?.status==="running"?"":"Run"})]}),r&&r.status!=="pending"&&u.jsx("div",{style:{padding:"0.5rem 0.75rem",borderRadius:"6px",background:`color-mix(in srgb, ${d} 15%, transparent)`,border:`1px solid color-mix(in srgb, ${d} 30%, transparent)`,fontSize:"0.85rem",color:d},children:r.message})]})}function sL({totalCount:t,passedCount:e,failedCount:n}){return u.jsxs("div",{style:{display:"flex",gap:"1rem",padding:"0.75rem 1rem",borderRadius:"8px",background:"color-mix(in srgb, currentColor 5%, transparent)",marginBottom:"1rem"},children:[u.jsxs("span",{children:["Total: ",u.jsx("strong",{children:t})]}),u.jsxs("span",{style:{color:fe.success},children:["Passed: ",u.jsx("strong",{children:e})]}),u.jsxs("span",{style:{color:fe.danger},children:["Failed: ",u.jsx("strong",{children:n})]})]})}const hS=[{name:"Read unauthorized budget",expectedToFail:!0},{name:"Read another user's document",expectedToFail:!0},{name:"Read unauthorized budget month",expectedToFail:!0},{name:"Toggle is_admin in own permission_flags",expectedToFail:!0},{name:"Toggle is_test in own permission_flags",expectedToFail:!0},{name:"Read own user document",expectedToFail:!1}];function iL(){const{currentUserId:t}=Xe(),[e,n]=k.useState([]),[r,i]=k.useState(!1);function o(_,C){n(x=>x.map(w=>w.name===_?{...w,...C}:w))}async function l(_,C,x){o(_,{status:"running",message:"Running..."});try{const w=await C();x?o(_,{status:"failed",message:` ${w}`}):o(_,{status:"passed",message:` ${w}`})}catch(w){const E=w instanceof Error?w.message:"Unknown error";x?o(_,{status:"passed",message:` Blocked as expected: ${E}`}):o(_,{status:"failed",message:` ${E}`})}}async function d(){i(!0),n(hS.map(_=>({..._,status:"pending",message:""})));for(const _ of hS)await h(_.name);i(!1)}async function h(_){switch(_){case"Read unauthorized budget":await l(_,async()=>(await Lt("budgets","unauthorized_budget_test_12345","security test: attempting unauthorized budget read"),"Was able to read budget (unexpected)"),!0);break;case"Read another user's document":await l(_,async()=>(await Lt("users","another_user_test_12345","security test: attempting unauthorized user read"),"Was able to read user document (unexpected)"),!0);break;case"Read unauthorized budget month":await l(_,async()=>(await Lt("months","unauthorized_budget_test_12345_2024_01","security test: attempting unauthorized month read"),"Was able to read month document for unauthorized budget (unexpected)"),!0);break;case"Toggle is_admin in own permission_flags":await l(_,async()=>{if(!t)throw new Error("Not authenticated");const{data:C}=await Lt("users",t,"security test: reading own user to get current is_admin value"),x=C?.permission_flags?.is_admin??!1;return await Df("users",t,{"permission_flags.is_admin":!x},"security test: attempting to toggle is_admin (should fail)"),`Was able to change is_admin from ${x} to ${!x} (SECURITY ISSUE!)`},!0);break;case"Toggle is_test in own permission_flags":await l(_,async()=>{if(!t)throw new Error("Not authenticated");const{data:C}=await Lt("users",t,"security test: reading own user to get current is_test value"),x=C?.permission_flags?.is_test??!1;return await Df("users",t,{"permission_flags.is_test":!x},"security test: attempting to toggle is_test (should fail)"),`Was able to change is_test from ${x} to ${!x} (SECURITY ISSUE!)`},!0);break;case"Read own user document":await l(_,async()=>{if(!t)throw new Error("Not authenticated");const{exists:C}=await Lt("users",t,"security test: reading own user document (should succeed)");if(C)return"Successfully read own document";throw new Error("Document does not exist")},!1);break}}async function f(_){e.find(x=>x.name===_)||n(x=>[...x,{name:_,status:"pending",message:"",expectedToFail:!0}]),i(!0),await h(_),i(!1)}const p=e.filter(_=>_.status==="passed").length,g=e.filter(_=>_.status==="failed").length,v=e.length;return u.jsxs("div",{children:[u.jsx("p",{style:kT,children:'Run security tests to verify Firestore rules are working correctly. Tests that are expected to fail (blocked by security rules) should show as "passed".'}),u.jsx("div",{style:{marginBottom:"1.5rem"},children:u.jsx(Ve,{onClick:d,disabled:r,variant:"primary",children:r?"Running Tests...":"Run All Tests"})}),e.length>0&&u.jsx(sL,{totalCount:v,passedCount:p,failedCount:g}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:[u.jsx("h3",{style:{margin:"0.5rem 0"},children:"Individual Tests"}),u.jsx(Ol,{name:"Read unauthorized budget",description:"Try to read a budget the user doesn't have access to",expectedBehavior:"Should be blocked by Firestore rules",result:e.find(_=>_.name==="Read unauthorized budget"),onRun:()=>f("Read unauthorized budget"),disabled:r}),u.jsx(Ol,{name:"Read another user's document",description:"Try to read another user's profile document",expectedBehavior:"Should be blocked by Firestore rules",result:e.find(_=>_.name==="Read another user's document"),onRun:()=>f("Read another user's document"),disabled:r}),u.jsx(Ol,{name:"Read unauthorized budget month",description:"Try to read a month document for a budget you don't have access to",expectedBehavior:"Should be blocked - months inherit budget access",result:e.find(_=>_.name==="Read unauthorized budget month"),onRun:()=>f("Read unauthorized budget month"),disabled:r}),u.jsx(Ol,{name:"Toggle is_admin in own permission_flags",description:"Try to change your admin privileges (toggles current value)",expectedBehavior:"Should be blocked - permission_flags is protected",result:e.find(_=>_.name==="Toggle is_admin in own permission_flags"),onRun:()=>f("Toggle is_admin in own permission_flags"),disabled:r}),u.jsx(Ol,{name:"Toggle is_test in own permission_flags",description:"Try to change your test privileges (toggles current value)",expectedBehavior:"Should be blocked - permission_flags is protected",result:e.find(_=>_.name==="Toggle is_test in own permission_flags"),onRun:()=>f("Toggle is_test in own permission_flags"),disabled:r}),u.jsx(Ol,{name:"Read own user document",description:"Read your own user profile document",expectedBehavior:"Should succeed - users can read their own data",result:e.find(_=>_.name==="Read own user document"),onRun:()=>f("Read own user document"),disabled:r,expectedToSucceed:!0})]}),g>0&&u.jsxs(xm,{style:{marginTop:"1.5rem"},children:[" ",g," test(s) failed! This may indicate a security vulnerability in your Firestore rules."]})]})}function aL({children:t}){const{addLoadingHold:e,removeLoadingHold:n}=On(),r=k.useContext(md),i=tr();return k.useEffect(()=>(r.is_auth_checked?n("protected-route"):e("protected-route","Checking authentication..."),()=>n("protected-route")),[r.is_auth_checked,e,n]),r.is_auth_checked?r.is_logged_in?t?u.jsx(u.Fragment,{children:t}):u.jsx(Ff,{}):u.jsx(Uf,{to:"/account",state:{from:i.pathname},replace:!0}):null}function oL(){const{addLoadingHold:t,removeLoadingHold:e}=On(),{isInitialized:n,pageTitle:r}=Xe(),{isLoading:i,error:o}=jn();return k.useEffect(()=>{n?e("budget-init"):t("budget-init",i?"Fetching data from server...":"Loading budget...")},[n,i,t,e]),k.useEffect(()=>()=>e("budget-init"),[e]),o?(console.error("[BudgetLayout] Error:",o),u.jsx("div",{style:Mf,children:u.jsxs("p",{style:{color:"#ef4444"},children:["Error: ",o.message]})})):u.jsx("div",{style:{...Mf,paddingBottom:"5rem"},children:u.jsxs(nA,{children:[u.jsx(BP,{title:r}),n&&u.jsx(Ff,{})]})})}const lL={is_logged_in:!1,is_auth_checked:!1,username:"",set_user_context:()=>{}};function cL(){const{isLoading:t,loadingMessage:e}=On();return t?u.jsx(BB,{message:e}):null}function uL(){const[t,e]=k.useState(null);return k.useEffect(()=>qn.subscribe(e),[]),t?u.jsx(LP,{item:t,onDismiss:n=>qn.remove(n)}):null}function dL(){const{selectedBudgetId:t,isInitialized:e}=Xe(),n=$t(),r=t?["initialDataLoad",t]:null,i=r?n.getQueryState(r)?.status==="success":!1;return Rn(),v3(t,i&&e),u.jsxs(u.Fragment,{children:[u.jsxs(Z5,{children:[u.jsx(Cn,{path:"/",element:u.jsx(zB,{})}),u.jsx(Cn,{path:"/account",element:u.jsx(LB,{})}),u.jsx(Cn,{path:"/budget",element:u.jsx(aL,{}),children:u.jsxs(Cn,{element:u.jsx(oL,{}),children:[u.jsx(Cn,{index:!0,element:u.jsx(sS,{})}),u.jsx(Cn,{path:":year/:month/:tab/:view?",element:u.jsx(sS,{})}),u.jsx(Cn,{path:"analytics",element:u.jsx(Mz,{})}),u.jsx(Cn,{path:"my-budgets",element:u.jsx(Vz,{})}),u.jsxs(Cn,{path:"settings",element:u.jsx(qz,{}),children:[u.jsx(Cn,{index:!0,element:u.jsx(Uf,{to:"categories",replace:!0})}),u.jsx(Cn,{path:"accounts",element:u.jsx(Wz,{})}),u.jsx(Cn,{path:"categories",element:u.jsx(Yz,{})}),u.jsx(Cn,{path:"users",element:u.jsx(Xz,{})})]}),u.jsxs(Cn,{path:"admin",element:u.jsx(Jz,{}),children:[u.jsx(Cn,{path:"budget",element:u.jsx(eL,{})}),u.jsx(Cn,{path:"feedback",element:u.jsx(tL,{})}),u.jsx(Cn,{path:"migration",element:u.jsx(rL,{})}),u.jsx(Cn,{path:"tests",element:u.jsx(iL,{})})]})]})})]}),u.jsx(OP,{}),u.jsx(aA,{}),u.jsx(uL,{})]})}function hL(){const[t,e]=k.useState(lL),n=za(),r=k.useRef(!1),{addLoadingHold:i,removeLoadingHold:o}=On();return k.useEffect(function(){r.current||(r.current=!0,n.set_user_listener(l=>{e({is_logged_in:l!=null,is_auth_checked:!0,username:l?.email??"",set_user_context:e})}))},[n]),k.useEffect(()=>{t.is_auth_checked?o("auth"):i("auth","Authenticating...")},[t.is_auth_checked,i,o]),t.is_auth_checked?u.jsx(md.Provider,{value:t,children:u.jsx(yM,{children:u.jsx(dB,{children:u.jsx(t3,{children:u.jsx(T3,{children:u.jsx(Sj,{children:u.jsx(dL,{})})})})})})}):null}function fL(){return u.jsxs(pR,{children:[u.jsx(cL,{}),u.jsx(hL,{})]})}Z2.createRoot(document.getElementById("root")).render(u.jsx(k.StrictMode,{children:u.jsx(fL,{})}));
