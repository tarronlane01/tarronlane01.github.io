(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function n(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=n(i);fetch(i.href,o)}})();var Oh=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function z2(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var bg={exports:{}},gu={};var Sx;function B2(){if(Sx)return gu;Sx=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function n(r,i,o){var l=null;if(o!==void 0&&(l=""+o),i.key!==void 0&&(l=""+i.key),"key"in i){o={};for(var d in i)d!=="key"&&(o[d]=i[d])}else o=i;return i=o.ref,{$$typeof:t,type:r,key:l,ref:i!==void 0?i:null,props:o}}return gu.Fragment=e,gu.jsx=n,gu.jsxs=n,gu}var Cx;function L2(){return Cx||(Cx=1,bg.exports=B2()),bg.exports}var u=L2(),vg={exports:{}},Ze={};var Ex;function U2(){if(Ex)return Ze;Ex=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),o=Symbol.for("react.consumer"),l=Symbol.for("react.context"),d=Symbol.for("react.forward_ref"),h=Symbol.for("react.suspense"),m=Symbol.for("react.memo"),p=Symbol.for("react.lazy"),g=Symbol.for("react.activity"),v=Symbol.iterator;function b(L){return L===null||typeof L!="object"?null:(L=v&&L[v]||L["@@iterator"],typeof L=="function"?L:null)}var C={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},x=Object.assign,S={};function E(L,G,ne){this.props=L,this.context=G,this.refs=S,this.updater=ne||C}E.prototype.isReactComponent={},E.prototype.setState=function(L,G){if(typeof L!="object"&&typeof L!="function"&&L!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,L,G,"setState")},E.prototype.forceUpdate=function(L){this.updater.enqueueForceUpdate(this,L,"forceUpdate")};function T(){}T.prototype=E.prototype;function I(L,G,ne){this.props=L,this.context=G,this.refs=S,this.updater=ne||C}var D=I.prototype=new T;D.constructor=I,x(D,E.prototype),D.isPureReactComponent=!0;var B=Array.isArray;function $(){}var k={H:null,A:null,T:null,S:null},j=Object.prototype.hasOwnProperty;function N(L,G,ne){var ie=ne.ref;return{$$typeof:t,type:L,key:G,ref:ie!==void 0?ie:null,props:ne}}function F(L,G){return N(L.type,G,L.props)}function q(L){return typeof L=="object"&&L!==null&&L.$$typeof===t}function A(L){var G={"=":"=0",":":"=2"};return"$"+L.replace(/[=:]/g,function(ne){return G[ne]})}var P=/\/+/g;function O(L,G){return typeof L=="object"&&L!==null&&L.key!=null?A(""+L.key):G.toString(36)}function X(L){switch(L.status){case"fulfilled":return L.value;case"rejected":throw L.reason;default:switch(typeof L.status=="string"?L.then($,$):(L.status="pending",L.then(function(G){L.status==="pending"&&(L.status="fulfilled",L.value=G)},function(G){L.status==="pending"&&(L.status="rejected",L.reason=G)})),L.status){case"fulfilled":return L.value;case"rejected":throw L.reason}}throw L}function W(L,G,ne,ie,te){var ue=typeof L;(ue==="undefined"||ue==="boolean")&&(L=null);var ve=!1;if(L===null)ve=!0;else switch(ue){case"bigint":case"string":case"number":ve=!0;break;case"object":switch(L.$$typeof){case t:case e:ve=!0;break;case p:return ve=L._init,W(ve(L._payload),G,ne,ie,te)}}if(ve)return te=te(L),ve=ie===""?"."+O(L,0):ie,B(te)?(ne="",ve!=null&&(ne=ve.replace(P,"$&/")+"/"),W(te,G,ne,"",function(ze){return ze})):te!=null&&(q(te)&&(te=F(te,ne+(te.key==null||L&&L.key===te.key?"":(""+te.key).replace(P,"$&/")+"/")+ve)),G.push(te)),1;ve=0;var ce=ie===""?".":ie+":";if(B(L))for(var be=0;be<L.length;be++)ie=L[be],ue=ce+O(ie,be),ve+=W(ie,G,ne,ue,te);else if(be=b(L),typeof be=="function")for(L=be.call(L),be=0;!(ie=L.next()).done;)ie=ie.value,ue=ce+O(ie,be++),ve+=W(ie,G,ne,ue,te);else if(ue==="object"){if(typeof L.then=="function")return W(X(L),G,ne,ie,te);throw G=String(L),Error("Objects are not valid as a React child (found: "+(G==="[object Object]"?"object with keys {"+Object.keys(L).join(", ")+"}":G)+"). If you meant to render a collection of children, use an array instead.")}return ve}function H(L,G,ne){if(L==null)return L;var ie=[],te=0;return W(L,ie,"","",function(ue){return G.call(ne,ue,te++)}),ie}function Z(L){if(L._status===-1){var G=L._result;G=G(),G.then(function(ne){(L._status===0||L._status===-1)&&(L._status=1,L._result=ne)},function(ne){(L._status===0||L._status===-1)&&(L._status=2,L._result=ne)}),L._status===-1&&(L._status=0,L._result=G)}if(L._status===1)return L._result.default;throw L._result}var Y=typeof reportError=="function"?reportError:function(L){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var G=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof L=="object"&&L!==null&&typeof L.message=="string"?String(L.message):String(L),error:L});if(!window.dispatchEvent(G))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",L);return}console.error(L)},se={map:H,forEach:function(L,G,ne){H(L,function(){G.apply(this,arguments)},ne)},count:function(L){var G=0;return H(L,function(){G++}),G},toArray:function(L){return H(L,function(G){return G})||[]},only:function(L){if(!q(L))throw Error("React.Children.only expected to receive a single React element child.");return L}};return Ze.Activity=g,Ze.Children=se,Ze.Component=E,Ze.Fragment=n,Ze.Profiler=i,Ze.PureComponent=I,Ze.StrictMode=r,Ze.Suspense=h,Ze.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=k,Ze.__COMPILER_RUNTIME={__proto__:null,c:function(L){return k.H.useMemoCache(L)}},Ze.cache=function(L){return function(){return L.apply(null,arguments)}},Ze.cacheSignal=function(){return null},Ze.cloneElement=function(L,G,ne){if(L==null)throw Error("The argument must be a React element, but you passed "+L+".");var ie=x({},L.props),te=L.key;if(G!=null)for(ue in G.key!==void 0&&(te=""+G.key),G)!j.call(G,ue)||ue==="key"||ue==="__self"||ue==="__source"||ue==="ref"&&G.ref===void 0||(ie[ue]=G[ue]);var ue=arguments.length-2;if(ue===1)ie.children=ne;else if(1<ue){for(var ve=Array(ue),ce=0;ce<ue;ce++)ve[ce]=arguments[ce+2];ie.children=ve}return N(L.type,te,ie)},Ze.createContext=function(L){return L={$$typeof:l,_currentValue:L,_currentValue2:L,_threadCount:0,Provider:null,Consumer:null},L.Provider=L,L.Consumer={$$typeof:o,_context:L},L},Ze.createElement=function(L,G,ne){var ie,te={},ue=null;if(G!=null)for(ie in G.key!==void 0&&(ue=""+G.key),G)j.call(G,ie)&&ie!=="key"&&ie!=="__self"&&ie!=="__source"&&(te[ie]=G[ie]);var ve=arguments.length-2;if(ve===1)te.children=ne;else if(1<ve){for(var ce=Array(ve),be=0;be<ve;be++)ce[be]=arguments[be+2];te.children=ce}if(L&&L.defaultProps)for(ie in ve=L.defaultProps,ve)te[ie]===void 0&&(te[ie]=ve[ie]);return N(L,ue,te)},Ze.createRef=function(){return{current:null}},Ze.forwardRef=function(L){return{$$typeof:d,render:L}},Ze.isValidElement=q,Ze.lazy=function(L){return{$$typeof:p,_payload:{_status:-1,_result:L},_init:Z}},Ze.memo=function(L,G){return{$$typeof:m,type:L,compare:G===void 0?null:G}},Ze.startTransition=function(L){var G=k.T,ne={};k.T=ne;try{var ie=L(),te=k.S;te!==null&&te(ne,ie),typeof ie=="object"&&ie!==null&&typeof ie.then=="function"&&ie.then($,Y)}catch(ue){Y(ue)}finally{G!==null&&ne.types!==null&&(G.types=ne.types),k.T=G}},Ze.unstable_useCacheRefresh=function(){return k.H.useCacheRefresh()},Ze.use=function(L){return k.H.use(L)},Ze.useActionState=function(L,G,ne){return k.H.useActionState(L,G,ne)},Ze.useCallback=function(L,G){return k.H.useCallback(L,G)},Ze.useContext=function(L){return k.H.useContext(L)},Ze.useDebugValue=function(){},Ze.useDeferredValue=function(L,G){return k.H.useDeferredValue(L,G)},Ze.useEffect=function(L,G){return k.H.useEffect(L,G)},Ze.useEffectEvent=function(L){return k.H.useEffectEvent(L)},Ze.useId=function(){return k.H.useId()},Ze.useImperativeHandle=function(L,G,ne){return k.H.useImperativeHandle(L,G,ne)},Ze.useInsertionEffect=function(L,G){return k.H.useInsertionEffect(L,G)},Ze.useLayoutEffect=function(L,G){return k.H.useLayoutEffect(L,G)},Ze.useMemo=function(L,G){return k.H.useMemo(L,G)},Ze.useOptimistic=function(L,G){return k.H.useOptimistic(L,G)},Ze.useReducer=function(L,G,ne){return k.H.useReducer(L,G,ne)},Ze.useRef=function(L){return k.H.useRef(L)},Ze.useState=function(L){return k.H.useState(L)},Ze.useSyncExternalStore=function(L,G,ne){return k.H.useSyncExternalStore(L,G,ne)},Ze.useTransition=function(){return k.H.useTransition()},Ze.version="19.2.3",Ze}var Tx;function My(){return Tx||(Tx=1,vg.exports=U2()),vg.exports}var M=My(),xg={exports:{}},yu={},wg={exports:{}},Sg={};var Ax;function F2(){return Ax||(Ax=1,(function(t){function e(W,H){var Z=W.length;W.push(H);e:for(;0<Z;){var Y=Z-1>>>1,se=W[Y];if(0<i(se,H))W[Y]=H,W[Z]=se,Z=Y;else break e}}function n(W){return W.length===0?null:W[0]}function r(W){if(W.length===0)return null;var H=W[0],Z=W.pop();if(Z!==H){W[0]=Z;e:for(var Y=0,se=W.length,L=se>>>1;Y<L;){var G=2*(Y+1)-1,ne=W[G],ie=G+1,te=W[ie];if(0>i(ne,Z))ie<se&&0>i(te,ne)?(W[Y]=te,W[ie]=Z,Y=ie):(W[Y]=ne,W[G]=Z,Y=G);else if(ie<se&&0>i(te,Z))W[Y]=te,W[ie]=Z,Y=ie;else break e}}return H}function i(W,H){var Z=W.sortIndex-H.sortIndex;return Z!==0?Z:W.id-H.id}if(t.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var o=performance;t.unstable_now=function(){return o.now()}}else{var l=Date,d=l.now();t.unstable_now=function(){return l.now()-d}}var h=[],m=[],p=1,g=null,v=3,b=!1,C=!1,x=!1,S=!1,E=typeof setTimeout=="function"?setTimeout:null,T=typeof clearTimeout=="function"?clearTimeout:null,I=typeof setImmediate<"u"?setImmediate:null;function D(W){for(var H=n(m);H!==null;){if(H.callback===null)r(m);else if(H.startTime<=W)r(m),H.sortIndex=H.expirationTime,e(h,H);else break;H=n(m)}}function B(W){if(x=!1,D(W),!C)if(n(h)!==null)C=!0,$||($=!0,A());else{var H=n(m);H!==null&&X(B,H.startTime-W)}}var $=!1,k=-1,j=5,N=-1;function F(){return S?!0:!(t.unstable_now()-N<j)}function q(){if(S=!1,$){var W=t.unstable_now();N=W;var H=!0;try{e:{C=!1,x&&(x=!1,T(k),k=-1),b=!0;var Z=v;try{t:{for(D(W),g=n(h);g!==null&&!(g.expirationTime>W&&F());){var Y=g.callback;if(typeof Y=="function"){g.callback=null,v=g.priorityLevel;var se=Y(g.expirationTime<=W);if(W=t.unstable_now(),typeof se=="function"){g.callback=se,D(W),H=!0;break t}g===n(h)&&r(h),D(W)}else r(h);g=n(h)}if(g!==null)H=!0;else{var L=n(m);L!==null&&X(B,L.startTime-W),H=!1}}break e}finally{g=null,v=Z,b=!1}H=void 0}}finally{H?A():$=!1}}}var A;if(typeof I=="function")A=function(){I(q)};else if(typeof MessageChannel<"u"){var P=new MessageChannel,O=P.port2;P.port1.onmessage=q,A=function(){O.postMessage(null)}}else A=function(){E(q,0)};function X(W,H){k=E(function(){W(t.unstable_now())},H)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(W){W.callback=null},t.unstable_forceFrameRate=function(W){0>W||125<W?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):j=0<W?Math.floor(1e3/W):5},t.unstable_getCurrentPriorityLevel=function(){return v},t.unstable_next=function(W){switch(v){case 1:case 2:case 3:var H=3;break;default:H=v}var Z=v;v=H;try{return W()}finally{v=Z}},t.unstable_requestPaint=function(){S=!0},t.unstable_runWithPriority=function(W,H){switch(W){case 1:case 2:case 3:case 4:case 5:break;default:W=3}var Z=v;v=W;try{return H()}finally{v=Z}},t.unstable_scheduleCallback=function(W,H,Z){var Y=t.unstable_now();switch(typeof Z=="object"&&Z!==null?(Z=Z.delay,Z=typeof Z=="number"&&0<Z?Y+Z:Y):Z=Y,W){case 1:var se=-1;break;case 2:se=250;break;case 5:se=1073741823;break;case 4:se=1e4;break;default:se=5e3}return se=Z+se,W={id:p++,callback:H,priorityLevel:W,startTime:Z,expirationTime:se,sortIndex:-1},Z>Y?(W.sortIndex=Z,e(m,W),n(h)===null&&W===n(m)&&(x?(T(k),k=-1):x=!0,X(B,Z-Y))):(W.sortIndex=se,e(h,W),C||b||(C=!0,$||($=!0,A()))),W},t.unstable_shouldYield=F,t.unstable_wrapCallback=function(W){var H=v;return function(){var Z=v;v=H;try{return W.apply(this,arguments)}finally{v=Z}}}})(Sg)),Sg}var jx;function V2(){return jx||(jx=1,wg.exports=F2()),wg.exports}var Cg={exports:{}},Yn={};var Rx;function $2(){if(Rx)return Yn;Rx=1;var t=My();function e(h){var m="https://react.dev/errors/"+h;if(1<arguments.length){m+="?args[]="+encodeURIComponent(arguments[1]);for(var p=2;p<arguments.length;p++)m+="&args[]="+encodeURIComponent(arguments[p])}return"Minified React error #"+h+"; visit "+m+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function n(){}var r={d:{f:n,r:function(){throw Error(e(522))},D:n,C:n,L:n,m:n,X:n,S:n,M:n},p:0,findDOMNode:null},i=Symbol.for("react.portal");function o(h,m,p){var g=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:i,key:g==null?null:""+g,children:h,containerInfo:m,implementation:p}}var l=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function d(h,m){if(h==="font")return"";if(typeof m=="string")return m==="use-credentials"?m:""}return Yn.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=r,Yn.createPortal=function(h,m){var p=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!m||m.nodeType!==1&&m.nodeType!==9&&m.nodeType!==11)throw Error(e(299));return o(h,m,null,p)},Yn.flushSync=function(h){var m=l.T,p=r.p;try{if(l.T=null,r.p=2,h)return h()}finally{l.T=m,r.p=p,r.d.f()}},Yn.preconnect=function(h,m){typeof h=="string"&&(m?(m=m.crossOrigin,m=typeof m=="string"?m==="use-credentials"?m:"":void 0):m=null,r.d.C(h,m))},Yn.prefetchDNS=function(h){typeof h=="string"&&r.d.D(h)},Yn.preinit=function(h,m){if(typeof h=="string"&&m&&typeof m.as=="string"){var p=m.as,g=d(p,m.crossOrigin),v=typeof m.integrity=="string"?m.integrity:void 0,b=typeof m.fetchPriority=="string"?m.fetchPriority:void 0;p==="style"?r.d.S(h,typeof m.precedence=="string"?m.precedence:void 0,{crossOrigin:g,integrity:v,fetchPriority:b}):p==="script"&&r.d.X(h,{crossOrigin:g,integrity:v,fetchPriority:b,nonce:typeof m.nonce=="string"?m.nonce:void 0})}},Yn.preinitModule=function(h,m){if(typeof h=="string")if(typeof m=="object"&&m!==null){if(m.as==null||m.as==="script"){var p=d(m.as,m.crossOrigin);r.d.M(h,{crossOrigin:p,integrity:typeof m.integrity=="string"?m.integrity:void 0,nonce:typeof m.nonce=="string"?m.nonce:void 0})}}else m==null&&r.d.M(h)},Yn.preload=function(h,m){if(typeof h=="string"&&typeof m=="object"&&m!==null&&typeof m.as=="string"){var p=m.as,g=d(p,m.crossOrigin);r.d.L(h,p,{crossOrigin:g,integrity:typeof m.integrity=="string"?m.integrity:void 0,nonce:typeof m.nonce=="string"?m.nonce:void 0,type:typeof m.type=="string"?m.type:void 0,fetchPriority:typeof m.fetchPriority=="string"?m.fetchPriority:void 0,referrerPolicy:typeof m.referrerPolicy=="string"?m.referrerPolicy:void 0,imageSrcSet:typeof m.imageSrcSet=="string"?m.imageSrcSet:void 0,imageSizes:typeof m.imageSizes=="string"?m.imageSizes:void 0,media:typeof m.media=="string"?m.media:void 0})}},Yn.preloadModule=function(h,m){if(typeof h=="string")if(m){var p=d(m.as,m.crossOrigin);r.d.m(h,{as:typeof m.as=="string"&&m.as!=="script"?m.as:void 0,crossOrigin:p,integrity:typeof m.integrity=="string"?m.integrity:void 0})}else r.d.m(h)},Yn.requestFormReset=function(h){r.d.r(h)},Yn.unstable_batchedUpdates=function(h,m){return h(m)},Yn.useFormState=function(h,m,p){return l.H.useFormState(h,m,p)},Yn.useFormStatus=function(){return l.H.useHostTransitionStatus()},Yn.version="19.2.3",Yn}var Ix;function q2(){if(Ix)return Cg.exports;Ix=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),Cg.exports=$2(),Cg.exports}var kx;function H2(){if(kx)return yu;kx=1;var t=V2(),e=My(),n=q2();function r(s){var a="https://react.dev/errors/"+s;if(1<arguments.length){a+="?args[]="+encodeURIComponent(arguments[1]);for(var c=2;c<arguments.length;c++)a+="&args[]="+encodeURIComponent(arguments[c])}return"Minified React error #"+s+"; visit "+a+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(s){return!(!s||s.nodeType!==1&&s.nodeType!==9&&s.nodeType!==11)}function o(s){var a=s,c=s;if(s.alternate)for(;a.return;)a=a.return;else{s=a;do a=s,(a.flags&4098)!==0&&(c=a.return),s=a.return;while(s)}return a.tag===3?c:null}function l(s){if(s.tag===13){var a=s.memoizedState;if(a===null&&(s=s.alternate,s!==null&&(a=s.memoizedState)),a!==null)return a.dehydrated}return null}function d(s){if(s.tag===31){var a=s.memoizedState;if(a===null&&(s=s.alternate,s!==null&&(a=s.memoizedState)),a!==null)return a.dehydrated}return null}function h(s){if(o(s)!==s)throw Error(r(188))}function m(s){var a=s.alternate;if(!a){if(a=o(s),a===null)throw Error(r(188));return a!==s?null:s}for(var c=s,f=a;;){var _=c.return;if(_===null)break;var w=_.alternate;if(w===null){if(f=_.return,f!==null){c=f;continue}break}if(_.child===w.child){for(w=_.child;w;){if(w===c)return h(_),s;if(w===f)return h(_),a;w=w.sibling}throw Error(r(188))}if(c.return!==f.return)c=_,f=w;else{for(var z=!1,Q=_.child;Q;){if(Q===c){z=!0,c=_,f=w;break}if(Q===f){z=!0,f=_,c=w;break}Q=Q.sibling}if(!z){for(Q=w.child;Q;){if(Q===c){z=!0,c=w,f=_;break}if(Q===f){z=!0,f=w,c=_;break}Q=Q.sibling}if(!z)throw Error(r(189))}}if(c.alternate!==f)throw Error(r(190))}if(c.tag!==3)throw Error(r(188));return c.stateNode.current===c?s:a}function p(s){var a=s.tag;if(a===5||a===26||a===27||a===6)return s;for(s=s.child;s!==null;){if(a=p(s),a!==null)return a;s=s.sibling}return null}var g=Object.assign,v=Symbol.for("react.element"),b=Symbol.for("react.transitional.element"),C=Symbol.for("react.portal"),x=Symbol.for("react.fragment"),S=Symbol.for("react.strict_mode"),E=Symbol.for("react.profiler"),T=Symbol.for("react.consumer"),I=Symbol.for("react.context"),D=Symbol.for("react.forward_ref"),B=Symbol.for("react.suspense"),$=Symbol.for("react.suspense_list"),k=Symbol.for("react.memo"),j=Symbol.for("react.lazy"),N=Symbol.for("react.activity"),F=Symbol.for("react.memo_cache_sentinel"),q=Symbol.iterator;function A(s){return s===null||typeof s!="object"?null:(s=q&&s[q]||s["@@iterator"],typeof s=="function"?s:null)}var P=Symbol.for("react.client.reference");function O(s){if(s==null)return null;if(typeof s=="function")return s.$$typeof===P?null:s.displayName||s.name||null;if(typeof s=="string")return s;switch(s){case x:return"Fragment";case E:return"Profiler";case S:return"StrictMode";case B:return"Suspense";case $:return"SuspenseList";case N:return"Activity"}if(typeof s=="object")switch(s.$$typeof){case C:return"Portal";case I:return s.displayName||"Context";case T:return(s._context.displayName||"Context")+".Consumer";case D:var a=s.render;return s=s.displayName,s||(s=a.displayName||a.name||"",s=s!==""?"ForwardRef("+s+")":"ForwardRef"),s;case k:return a=s.displayName||null,a!==null?a:O(s.type)||"Memo";case j:a=s._payload,s=s._init;try{return O(s(a))}catch{}}return null}var X=Array.isArray,W=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,H=n.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Z={pending:!1,data:null,method:null,action:null},Y=[],se=-1;function L(s){return{current:s}}function G(s){0>se||(s.current=Y[se],Y[se]=null,se--)}function ne(s,a){se++,Y[se]=s.current,s.current=a}var ie=L(null),te=L(null),ue=L(null),ve=L(null);function ce(s,a){switch(ne(ue,a),ne(te,s),ne(ie,null),a.nodeType){case 9:case 11:s=(s=a.documentElement)&&(s=s.namespaceURI)?Gv(s):0;break;default:if(s=a.tagName,a=a.namespaceURI)a=Gv(a),s=Qv(a,s);else switch(s){case"svg":s=1;break;case"math":s=2;break;default:s=0}}G(ie),ne(ie,s)}function be(){G(ie),G(te),G(ue)}function ze(s){s.memoizedState!==null&&ne(ve,s);var a=ie.current,c=Qv(a,s.type);a!==c&&(ne(te,s),ne(ie,c))}function Pe(s){te.current===s&&(G(ie),G(te)),ve.current===s&&(G(ve),hu._currentValue=Z)}var at,bt;function U(s){if(at===void 0)try{throw Error()}catch(c){var a=c.stack.trim().match(/\n( *(at )?)/);at=a&&a[1]||"",bt=-1<c.stack.indexOf(`
    at`)?" (<anonymous>)":-1<c.stack.indexOf("@")?"@unknown:0:0":""}return`
`+at+s+bt}var he=!1;function ye(s,a){if(!s||he)return"";he=!0;var c=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var f={DetermineComponentFrameRoot:function(){try{if(a){var Re=function(){throw Error()};if(Object.defineProperty(Re.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Re,[])}catch(we){var _e=we}Reflect.construct(s,[],Re)}else{try{Re.call()}catch(we){_e=we}s.call(Re.prototype)}}else{try{throw Error()}catch(we){_e=we}(Re=s())&&typeof Re.catch=="function"&&Re.catch(function(){})}}catch(we){if(we&&_e&&typeof we.stack=="string")return[we.stack,_e.stack]}return[null,null]}};f.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var _=Object.getOwnPropertyDescriptor(f.DetermineComponentFrameRoot,"name");_&&_.configurable&&Object.defineProperty(f.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var w=f.DetermineComponentFrameRoot(),z=w[0],Q=w[1];if(z&&Q){var re=z.split(`
`),ge=Q.split(`
`);for(_=f=0;f<re.length&&!re[f].includes("DetermineComponentFrameRoot");)f++;for(;_<ge.length&&!ge[_].includes("DetermineComponentFrameRoot");)_++;if(f===re.length||_===ge.length)for(f=re.length-1,_=ge.length-1;1<=f&&0<=_&&re[f]!==ge[_];)_--;for(;1<=f&&0<=_;f--,_--)if(re[f]!==ge[_]){if(f!==1||_!==1)do if(f--,_--,0>_||re[f]!==ge[_]){var Ee=`
`+re[f].replace(" at new "," at ");return s.displayName&&Ee.includes("<anonymous>")&&(Ee=Ee.replace("<anonymous>",s.displayName)),Ee}while(1<=f&&0<=_);break}}}finally{he=!1,Error.prepareStackTrace=c}return(c=s?s.displayName||s.name:"")?U(c):""}function ee(s,a){switch(s.tag){case 26:case 27:case 5:return U(s.type);case 16:return U("Lazy");case 13:return s.child!==a&&a!==null?U("Suspense Fallback"):U("Suspense");case 19:return U("SuspenseList");case 0:case 15:return ye(s.type,!1);case 11:return ye(s.type.render,!1);case 1:return ye(s.type,!0);case 31:return U("Activity");default:return""}}function J(s){try{var a="",c=null;do a+=ee(s,c),c=s,s=s.return;while(s);return a}catch(f){return`
Error generating stack: `+f.message+`
`+f.stack}}var oe=Object.prototype.hasOwnProperty,Ce=t.unstable_scheduleCallback,Se=t.unstable_cancelCallback,ae=t.unstable_shouldYield,Ae=t.unstable_requestPaint,Oe=t.unstable_now,De=t.unstable_getCurrentPriorityLevel,qe=t.unstable_ImmediatePriority,St=t.unstable_UserBlockingPriority,tt=t.unstable_NormalPriority,Wn=t.unstable_LowPriority,ps=t.unstable_IdlePriority,tr=t.log,gs=t.unstable_setDisableYieldValue,xt=null,tn=null;function Kn(s){if(typeof tr=="function"&&gs(s),tn&&typeof tn.setStrictMode=="function")try{tn.setStrictMode(xt,s)}catch{}}var Tt=Math.clz32?Math.clz32:Fo,Fa=Math.log,ji=Math.LN2;function Fo(s){return s>>>=0,s===0?32:31-(Fa(s)/ji|0)|0}var kr=256,ys=262144,Ft=4194304;function nr(s){var a=s&42;if(a!==0)return a;switch(s&-s){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return s&261888;case 262144:case 524288:case 1048576:case 2097152:return s&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return s&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return s}}function _s(s,a,c){var f=s.pendingLanes;if(f===0)return 0;var _=0,w=s.suspendedLanes,z=s.pingedLanes;s=s.warmLanes;var Q=f&134217727;return Q!==0?(f=Q&~w,f!==0?_=nr(f):(z&=Q,z!==0?_=nr(z):c||(c=Q&~s,c!==0&&(_=nr(c))))):(Q=f&~w,Q!==0?_=nr(Q):z!==0?_=nr(z):c||(c=f&~s,c!==0&&(_=nr(c)))),_===0?0:a!==0&&a!==_&&(a&w)===0&&(w=_&-_,c=a&-a,w>=c||w===32&&(c&4194048)!==0)?a:_}function Kr(s,a){return(s.pendingLanes&~(s.suspendedLanes&~s.pingedLanes)&a)===0}function Sm(s,a){switch(s){case 1:case 2:case 4:case 8:case 64:return a+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function dd(){var s=Ft;return Ft<<=1,(Ft&62914560)===0&&(Ft=4194304),s}function bs(s){for(var a=[],c=0;31>c;c++)a.push(s);return a}function Va(s,a){s.pendingLanes|=a,a!==268435456&&(s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0)}function Cm(s,a,c,f,_,w){var z=s.pendingLanes;s.pendingLanes=c,s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0,s.expiredLanes&=c,s.entangledLanes&=c,s.errorRecoveryDisabledLanes&=c,s.shellSuspendCounter=0;var Q=s.entanglements,re=s.expirationTimes,ge=s.hiddenUpdates;for(c=z&~c;0<c;){var Ee=31-Tt(c),Re=1<<Ee;Q[Ee]=0,re[Ee]=-1;var _e=ge[Ee];if(_e!==null)for(ge[Ee]=null,Ee=0;Ee<_e.length;Ee++){var we=_e[Ee];we!==null&&(we.lane&=-536870913)}c&=~Re}f!==0&&$a(s,f,0),w!==0&&_===0&&s.tag!==0&&(s.suspendedLanes|=w&~(z&~a))}function $a(s,a,c){s.pendingLanes|=a,s.suspendedLanes&=~a;var f=31-Tt(a);s.entangledLanes|=a,s.entanglements[f]=s.entanglements[f]|1073741824|c&261930}function yc(s,a){var c=s.entangledLanes|=a;for(s=s.entanglements;c;){var f=31-Tt(c),_=1<<f;_&a|s[f]&a&&(s[f]|=a),c&=~_}}function _c(s,a){var c=a&-a;return c=(c&42)!==0?1:qa(c),(c&(s.suspendedLanes|a))!==0?0:c}function qa(s){switch(s){case 2:s=1;break;case 8:s=4;break;case 32:s=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:s=128;break;case 268435456:s=134217728;break;default:s=0}return s}function Ws(s){return s&=-s,2<s?8<s?(s&134217727)!==0?32:268435456:8:2}function hd(){var s=H.p;return s!==0?s:(s=window.event,s===void 0?32:gx(s.type))}function Yr(s,a){var c=H.p;try{return H.p=s,a()}finally{H.p=c}}var Xr=Math.random().toString(36).slice(2),hn="__reactFiber$"+Xr,In="__reactProps$"+Xr,vs="__reactContainer$"+Xr,Vo="__reactEvents$"+Xr,Em="__reactListeners$"+Xr,fd="__reactHandles$"+Xr,md="__reactResources$"+Xr,xs="__reactMarker$"+Xr;function $o(s){delete s[hn],delete s[In],delete s[Vo],delete s[Em],delete s[fd]}function ws(s){var a=s[hn];if(a)return a;for(var c=s.parentNode;c;){if(a=c[vs]||c[hn]){if(c=a.alternate,a.child!==null||c!==null&&c.child!==null)for(s=ex(s);s!==null;){if(c=s[hn])return c;s=ex(s)}return a}s=c,c=s.parentNode}return null}function Dr(s){if(s=s[hn]||s[vs]){var a=s.tag;if(a===5||a===6||a===13||a===31||a===26||a===27||a===3)return s}return null}function br(s){var a=s.tag;if(a===5||a===26||a===27||a===6)return s.stateNode;throw Error(r(33))}function Ss(s){var a=s[md];return a||(a=s[md]={hoistableStyles:new Map,hoistableScripts:new Map}),a}function fn(s){s[xs]=!0}var bc=new Set,vc={};function Cs(s,a){Es(s,a),Es(s+"Capture",a)}function Es(s,a){for(vc[s]=a,s=0;s<a.length;s++)bc.add(a[s])}var xc=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),wc={},Sc={};function pd(s){return oe.call(Sc,s)?!0:oe.call(wc,s)?!1:xc.test(s)?Sc[s]=!0:(wc[s]=!0,!1)}function qo(s,a,c){if(pd(a))if(c===null)s.removeAttribute(a);else{switch(typeof c){case"undefined":case"function":case"symbol":s.removeAttribute(a);return;case"boolean":var f=a.toLowerCase().slice(0,5);if(f!=="data-"&&f!=="aria-"){s.removeAttribute(a);return}}s.setAttribute(a,""+c)}}function vr(s,a,c){if(c===null)s.removeAttribute(a);else{switch(typeof c){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(a);return}s.setAttribute(a,""+c)}}function mn(s,a,c,f){if(f===null)s.removeAttribute(c);else{switch(typeof f){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(c);return}s.setAttributeNS(a,c,""+f)}}function kn(s){switch(typeof s){case"bigint":case"boolean":case"number":case"string":case"undefined":return s;case"object":return s;default:return""}}function Ri(s){var a=s.type;return(s=s.nodeName)&&s.toLowerCase()==="input"&&(a==="checkbox"||a==="radio")}function Cc(s,a,c){var f=Object.getOwnPropertyDescriptor(s.constructor.prototype,a);if(!s.hasOwnProperty(a)&&typeof f<"u"&&typeof f.get=="function"&&typeof f.set=="function"){var _=f.get,w=f.set;return Object.defineProperty(s,a,{configurable:!0,get:function(){return _.call(this)},set:function(z){c=""+z,w.call(this,z)}}),Object.defineProperty(s,a,{enumerable:f.enumerable}),{getValue:function(){return c},setValue:function(z){c=""+z},stopTracking:function(){s._valueTracker=null,delete s[a]}}}}function kt(s){if(!s._valueTracker){var a=Ri(s)?"checked":"value";s._valueTracker=Cc(s,a,""+s[a])}}function Ha(s){if(!s)return!1;var a=s._valueTracker;if(!a)return!0;var c=a.getValue(),f="";return s&&(f=Ri(s)?s.checked?"true":"false":s.value),s=f,s!==c?(a.setValue(s),!0):!1}function Ts(s){if(s=s||(typeof document<"u"?document:void 0),typeof s>"u")return null;try{return s.activeElement||s.body}catch{return s.body}}var Ga=/[\n"\\]/g;function ar(s){return s.replace(Ga,function(a){return"\\"+a.charCodeAt(0).toString(16)+" "})}function Ho(s,a,c,f,_,w,z,Q){s.name="",z!=null&&typeof z!="function"&&typeof z!="symbol"&&typeof z!="boolean"?s.type=z:s.removeAttribute("type"),a!=null?z==="number"?(a===0&&s.value===""||s.value!=a)&&(s.value=""+kn(a)):s.value!==""+kn(a)&&(s.value=""+kn(a)):z!=="submit"&&z!=="reset"||s.removeAttribute("value"),a!=null?Ec(s,z,kn(a)):c!=null?Ec(s,z,kn(c)):f!=null&&s.removeAttribute("value"),_==null&&w!=null&&(s.defaultChecked=!!w),_!=null&&(s.checked=_&&typeof _!="function"&&typeof _!="symbol"),Q!=null&&typeof Q!="function"&&typeof Q!="symbol"&&typeof Q!="boolean"?s.name=""+kn(Q):s.removeAttribute("name")}function gd(s,a,c,f,_,w,z,Q){if(w!=null&&typeof w!="function"&&typeof w!="symbol"&&typeof w!="boolean"&&(s.type=w),a!=null||c!=null){if(!(w!=="submit"&&w!=="reset"||a!=null)){kt(s);return}c=c!=null?""+kn(c):"",a=a!=null?""+kn(a):c,Q||a===s.value||(s.value=a),s.defaultValue=a}f=f??_,f=typeof f!="function"&&typeof f!="symbol"&&!!f,s.checked=Q?s.checked:!!f,s.defaultChecked=!!f,z!=null&&typeof z!="function"&&typeof z!="symbol"&&typeof z!="boolean"&&(s.name=z),kt(s)}function Ec(s,a,c){a==="number"&&Ts(s.ownerDocument)===s||s.defaultValue===""+c||(s.defaultValue=""+c)}function Ii(s,a,c,f){if(s=s.options,a){a={};for(var _=0;_<c.length;_++)a["$"+c[_]]=!0;for(c=0;c<s.length;c++)_=a.hasOwnProperty("$"+s[c].value),s[c].selected!==_&&(s[c].selected=_),_&&f&&(s[c].defaultSelected=!0)}else{for(c=""+kn(c),a=null,_=0;_<s.length;_++){if(s[_].value===c){s[_].selected=!0,f&&(s[_].defaultSelected=!0);return}a!==null||s[_].disabled||(a=s[_])}a!==null&&(a.selected=!0)}}function yd(s,a,c){if(a!=null&&(a=""+kn(a),a!==s.value&&(s.value=a),c==null)){s.defaultValue!==a&&(s.defaultValue=a);return}s.defaultValue=c!=null?""+kn(c):""}function ki(s,a,c,f){if(a==null){if(f!=null){if(c!=null)throw Error(r(92));if(X(f)){if(1<f.length)throw Error(r(93));f=f[0]}c=f}c==null&&(c=""),a=c}c=kn(a),s.defaultValue=c,f=s.textContent,f===c&&f!==""&&f!==null&&(s.value=f),kt(s)}function or(s,a){if(a){var c=s.firstChild;if(c&&c===s.lastChild&&c.nodeType===3){c.nodeValue=a;return}}s.textContent=a}var _d=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Tc(s,a,c){var f=a.indexOf("--")===0;c==null||typeof c=="boolean"||c===""?f?s.setProperty(a,""):a==="float"?s.cssFloat="":s[a]="":f?s.setProperty(a,c):typeof c!="number"||c===0||_d.has(a)?a==="float"?s.cssFloat=c:s[a]=(""+c).trim():s[a]=c+"px"}function Ac(s,a,c){if(a!=null&&typeof a!="object")throw Error(r(62));if(s=s.style,c!=null){for(var f in c)!c.hasOwnProperty(f)||a!=null&&a.hasOwnProperty(f)||(f.indexOf("--")===0?s.setProperty(f,""):f==="float"?s.cssFloat="":s[f]="");for(var _ in a)f=a[_],a.hasOwnProperty(_)&&c[_]!==f&&Tc(s,_,f)}else for(var w in a)a.hasOwnProperty(w)&&Tc(s,w,a[w])}function Go(s){if(s.indexOf("-")===-1)return!1;switch(s){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var bd=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Di=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Qo(s){return Di.test(""+s)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":s}function Zr(){}var jc=null;function Mr(s){return s=s.target||s.srcElement||window,s.correspondingUseElement&&(s=s.correspondingUseElement),s.nodeType===3?s.parentNode:s}var Mi=null,As=null;function Qa(s){var a=Dr(s);if(a&&(s=a.stateNode)){var c=s[In]||null;e:switch(s=a.stateNode,a.type){case"input":if(Ho(s,c.value,c.defaultValue,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name),a=c.name,c.type==="radio"&&a!=null){for(c=s;c.parentNode;)c=c.parentNode;for(c=c.querySelectorAll('input[name="'+ar(""+a)+'"][type="radio"]'),a=0;a<c.length;a++){var f=c[a];if(f!==s&&f.form===s.form){var _=f[In]||null;if(!_)throw Error(r(90));Ho(f,_.value,_.defaultValue,_.defaultValue,_.checked,_.defaultChecked,_.type,_.name)}}for(a=0;a<c.length;a++)f=c[a],f.form===s.form&&Ha(f)}break e;case"textarea":yd(s,c.value,c.defaultValue);break e;case"select":a=c.value,a!=null&&Ii(s,!!c.multiple,a,!1)}}}var Wo=!1;function Oi(s,a,c){if(Wo)return s(a,c);Wo=!0;try{var f=s(a);return f}finally{if(Wo=!1,(Mi!==null||As!==null)&&(hh(),Mi&&(a=Mi,s=As,As=Mi=null,Qa(a),s)))for(a=0;a<s.length;a++)Qa(s[a])}}function Jr(s,a){var c=s.stateNode;if(c===null)return null;var f=c[In]||null;if(f===null)return null;c=f[a];e:switch(a){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(f=!f.disabled)||(s=s.type,f=!(s==="button"||s==="input"||s==="select"||s==="textarea")),s=!f;break e;default:s=!1}if(s)return null;if(c&&typeof c!="function")throw Error(r(231,a,typeof c));return c}var Or=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Wa=!1;if(Or)try{var Ot={};Object.defineProperty(Ot,"passive",{get:function(){Wa=!0}}),window.addEventListener("test",Ot,Ot),window.removeEventListener("test",Ot,Ot)}catch{Wa=!1}var js=null,Rc=null,Ka=null;function Ic(){if(Ka)return Ka;var s,a=Rc,c=a.length,f,_="value"in js?js.value:js.textContent,w=_.length;for(s=0;s<c&&a[s]===_[s];s++);var z=c-s;for(f=1;f<=z&&a[c-f]===_[w-f];f++);return Ka=_.slice(s,1<f?1-f:void 0)}function Ya(s){var a=s.keyCode;return"charCode"in s?(s=s.charCode,s===0&&a===13&&(s=13)):s=a,s===10&&(s=13),32<=s||s===13?s:0}function Ks(){return!0}function es(){return!1}function Pn(s){function a(c,f,_,w,z){this._reactName=c,this._targetInst=_,this.type=f,this.nativeEvent=w,this.target=z,this.currentTarget=null;for(var Q in s)s.hasOwnProperty(Q)&&(c=s[Q],this[Q]=c?c(w):w[Q]);return this.isDefaultPrevented=(w.defaultPrevented!=null?w.defaultPrevented:w.returnValue===!1)?Ks:es,this.isPropagationStopped=es,this}return g(a.prototype,{preventDefault:function(){this.defaultPrevented=!0;var c=this.nativeEvent;c&&(c.preventDefault?c.preventDefault():typeof c.returnValue!="unknown"&&(c.returnValue=!1),this.isDefaultPrevented=Ks)},stopPropagation:function(){var c=this.nativeEvent;c&&(c.stopPropagation?c.stopPropagation():typeof c.cancelBubble!="unknown"&&(c.cancelBubble=!0),this.isPropagationStopped=Ks)},persist:function(){},isPersistent:Ks}),a}var Ys={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(s){return s.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Rs=Pn(Ys),Ni=g({},Ys,{view:0,detail:0}),kc=Pn(Ni),Pi,Ko,Is,Yo=g({},Ni,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:zi,button:0,buttons:0,relatedTarget:function(s){return s.relatedTarget===void 0?s.fromElement===s.srcElement?s.toElement:s.fromElement:s.relatedTarget},movementX:function(s){return"movementX"in s?s.movementX:(s!==Is&&(Is&&s.type==="mousemove"?(Pi=s.screenX-Is.screenX,Ko=s.screenY-Is.screenY):Ko=Pi=0,Is=s),Pi)},movementY:function(s){return"movementY"in s?s.movementY:Ko}}),Dc=Pn(Yo),Xa=g({},Yo,{dataTransfer:0}),vd=Pn(Xa),xd=g({},Ni,{relatedTarget:0}),Za=Pn(xd),Mc=g({},Ys,{animationName:0,elapsedTime:0,pseudoElement:0}),wd=Pn(Mc),Xo=g({},Ys,{clipboardData:function(s){return"clipboardData"in s?s.clipboardData:window.clipboardData}}),Sd=Pn(Xo),Cd=g({},Ys,{data:0}),ks=Pn(Cd),Ed={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Td={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Ad={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function jd(s){var a=this.nativeEvent;return a.getModifierState?a.getModifierState(s):(s=Ad[s])?!!a[s]:!1}function zi(){return jd}var rr=g({},Ni,{key:function(s){if(s.key){var a=Ed[s.key]||s.key;if(a!=="Unidentified")return a}return s.type==="keypress"?(s=Ya(s),s===13?"Enter":String.fromCharCode(s)):s.type==="keydown"||s.type==="keyup"?Td[s.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:zi,charCode:function(s){return s.type==="keypress"?Ya(s):0},keyCode:function(s){return s.type==="keydown"||s.type==="keyup"?s.keyCode:0},which:function(s){return s.type==="keypress"?Ya(s):s.type==="keydown"||s.type==="keyup"?s.keyCode:0}}),Rd=Pn(rr),Id=g({},Yo,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Xs=Pn(Id),y=g({},Ni,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:zi}),R=Pn(y),V=g({},Ys,{propertyName:0,elapsedTime:0,pseudoElement:0}),K=Pn(V),fe=g({},Yo,{deltaX:function(s){return"deltaX"in s?s.deltaX:"wheelDeltaX"in s?-s.wheelDeltaX:0},deltaY:function(s){return"deltaY"in s?s.deltaY:"wheelDeltaY"in s?-s.wheelDeltaY:"wheelDelta"in s?-s.wheelDelta:0},deltaZ:0,deltaMode:0}),xe=Pn(fe),Ne=g({},Ys,{newState:0,oldState:0}),nt=Pn(Ne),sn=[9,13,27,32],At=Or&&"CompositionEvent"in window,Wt=null;Or&&"documentMode"in document&&(Wt=document.documentMode);var Nr=Or&&"TextEvent"in window&&!Wt,Ds=Or&&(!At||Wt&&8<Wt&&11>=Wt),ts=" ",ns=!1;function Ja(s,a){switch(s){case"keyup":return sn.indexOf(a.keyCode)!==-1;case"keydown":return a.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Zo(s){return s=s.detail,typeof s=="object"&&"data"in s?s.data:null}var Jo=!1;function oA(s,a){switch(s){case"compositionend":return Zo(a);case"keypress":return a.which!==32?null:(ns=!0,ts);case"textInput":return s=a.data,s===ts&&ns?null:s;default:return null}}function lA(s,a){if(Jo)return s==="compositionend"||!At&&Ja(s,a)?(s=Ic(),Ka=Rc=js=null,Jo=!1,s):null;switch(s){case"paste":return null;case"keypress":if(!(a.ctrlKey||a.altKey||a.metaKey)||a.ctrlKey&&a.altKey){if(a.char&&1<a.char.length)return a.char;if(a.which)return String.fromCharCode(a.which)}return null;case"compositionend":return Ds&&a.locale!=="ko"?null:a.data;default:return null}}var cA={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function r_(s){var a=s&&s.nodeName&&s.nodeName.toLowerCase();return a==="input"?!!cA[s.type]:a==="textarea"}function s_(s,a,c,f){Mi?As?As.push(f):As=[f]:Mi=f,a=bh(a,"onChange"),0<a.length&&(c=new Rs("onChange","change",null,c,f),s.push({event:c,listeners:a}))}var Oc=null,Nc=null;function uA(s){Uv(s,0)}function kd(s){var a=br(s);if(Ha(a))return s}function i_(s,a){if(s==="change")return a}var a_=!1;if(Or){var Tm;if(Or){var Am="oninput"in document;if(!Am){var o_=document.createElement("div");o_.setAttribute("oninput","return;"),Am=typeof o_.oninput=="function"}Tm=Am}else Tm=!1;a_=Tm&&(!document.documentMode||9<document.documentMode)}function l_(){Oc&&(Oc.detachEvent("onpropertychange",c_),Nc=Oc=null)}function c_(s){if(s.propertyName==="value"&&kd(Nc)){var a=[];s_(a,Nc,s,Mr(s)),Oi(uA,a)}}function dA(s,a,c){s==="focusin"?(l_(),Oc=a,Nc=c,Oc.attachEvent("onpropertychange",c_)):s==="focusout"&&l_()}function hA(s){if(s==="selectionchange"||s==="keyup"||s==="keydown")return kd(Nc)}function fA(s,a){if(s==="click")return kd(a)}function mA(s,a){if(s==="input"||s==="change")return kd(a)}function pA(s,a){return s===a&&(s!==0||1/s===1/a)||s!==s&&a!==a}var xr=typeof Object.is=="function"?Object.is:pA;function Pc(s,a){if(xr(s,a))return!0;if(typeof s!="object"||s===null||typeof a!="object"||a===null)return!1;var c=Object.keys(s),f=Object.keys(a);if(c.length!==f.length)return!1;for(f=0;f<c.length;f++){var _=c[f];if(!oe.call(a,_)||!xr(s[_],a[_]))return!1}return!0}function u_(s){for(;s&&s.firstChild;)s=s.firstChild;return s}function d_(s,a){var c=u_(s);s=0;for(var f;c;){if(c.nodeType===3){if(f=s+c.textContent.length,s<=a&&f>=a)return{node:c,offset:a-s};s=f}e:{for(;c;){if(c.nextSibling){c=c.nextSibling;break e}c=c.parentNode}c=void 0}c=u_(c)}}function h_(s,a){return s&&a?s===a?!0:s&&s.nodeType===3?!1:a&&a.nodeType===3?h_(s,a.parentNode):"contains"in s?s.contains(a):s.compareDocumentPosition?!!(s.compareDocumentPosition(a)&16):!1:!1}function f_(s){s=s!=null&&s.ownerDocument!=null&&s.ownerDocument.defaultView!=null?s.ownerDocument.defaultView:window;for(var a=Ts(s.document);a instanceof s.HTMLIFrameElement;){try{var c=typeof a.contentWindow.location.href=="string"}catch{c=!1}if(c)s=a.contentWindow;else break;a=Ts(s.document)}return a}function jm(s){var a=s&&s.nodeName&&s.nodeName.toLowerCase();return a&&(a==="input"&&(s.type==="text"||s.type==="search"||s.type==="tel"||s.type==="url"||s.type==="password")||a==="textarea"||s.contentEditable==="true")}var gA=Or&&"documentMode"in document&&11>=document.documentMode,el=null,Rm=null,zc=null,Im=!1;function m_(s,a,c){var f=c.window===c?c.document:c.nodeType===9?c:c.ownerDocument;Im||el==null||el!==Ts(f)||(f=el,"selectionStart"in f&&jm(f)?f={start:f.selectionStart,end:f.selectionEnd}:(f=(f.ownerDocument&&f.ownerDocument.defaultView||window).getSelection(),f={anchorNode:f.anchorNode,anchorOffset:f.anchorOffset,focusNode:f.focusNode,focusOffset:f.focusOffset}),zc&&Pc(zc,f)||(zc=f,f=bh(Rm,"onSelect"),0<f.length&&(a=new Rs("onSelect","select",null,a,c),s.push({event:a,listeners:f}),a.target=el)))}function eo(s,a){var c={};return c[s.toLowerCase()]=a.toLowerCase(),c["Webkit"+s]="webkit"+a,c["Moz"+s]="moz"+a,c}var tl={animationend:eo("Animation","AnimationEnd"),animationiteration:eo("Animation","AnimationIteration"),animationstart:eo("Animation","AnimationStart"),transitionrun:eo("Transition","TransitionRun"),transitionstart:eo("Transition","TransitionStart"),transitioncancel:eo("Transition","TransitionCancel"),transitionend:eo("Transition","TransitionEnd")},km={},p_={};Or&&(p_=document.createElement("div").style,"AnimationEvent"in window||(delete tl.animationend.animation,delete tl.animationiteration.animation,delete tl.animationstart.animation),"TransitionEvent"in window||delete tl.transitionend.transition);function to(s){if(km[s])return km[s];if(!tl[s])return s;var a=tl[s],c;for(c in a)if(a.hasOwnProperty(c)&&c in p_)return km[s]=a[c];return s}var g_=to("animationend"),y_=to("animationiteration"),__=to("animationstart"),yA=to("transitionrun"),_A=to("transitionstart"),bA=to("transitioncancel"),b_=to("transitionend"),v_=new Map,Dm="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Dm.push("scrollEnd");function rs(s,a){v_.set(s,a),Cs(a,[s])}var Dd=typeof reportError=="function"?reportError:function(s){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var a=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof s=="object"&&s!==null&&typeof s.message=="string"?String(s.message):String(s),error:s});if(!window.dispatchEvent(a))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",s);return}console.error(s)},Pr=[],nl=0,Mm=0;function Md(){for(var s=nl,a=Mm=nl=0;a<s;){var c=Pr[a];Pr[a++]=null;var f=Pr[a];Pr[a++]=null;var _=Pr[a];Pr[a++]=null;var w=Pr[a];if(Pr[a++]=null,f!==null&&_!==null){var z=f.pending;z===null?_.next=_:(_.next=z.next,z.next=_),f.pending=_}w!==0&&x_(c,_,w)}}function Od(s,a,c,f){Pr[nl++]=s,Pr[nl++]=a,Pr[nl++]=c,Pr[nl++]=f,Mm|=f,s.lanes|=f,s=s.alternate,s!==null&&(s.lanes|=f)}function Om(s,a,c,f){return Od(s,a,c,f),Nd(s)}function no(s,a){return Od(s,null,null,a),Nd(s)}function x_(s,a,c){s.lanes|=c;var f=s.alternate;f!==null&&(f.lanes|=c);for(var _=!1,w=s.return;w!==null;)w.childLanes|=c,f=w.alternate,f!==null&&(f.childLanes|=c),w.tag===22&&(s=w.stateNode,s===null||s._visibility&1||(_=!0)),s=w,w=w.return;return s.tag===3?(w=s.stateNode,_&&a!==null&&(_=31-Tt(c),s=w.hiddenUpdates,f=s[_],f===null?s[_]=[a]:f.push(a),a.lane=c|536870912),w):null}function Nd(s){if(50<iu)throw iu=0,$p=null,Error(r(185));for(var a=s.return;a!==null;)s=a,a=s.return;return s.tag===3?s.stateNode:null}var rl={};function vA(s,a,c,f){this.tag=s,this.key=c,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=a,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=f,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function wr(s,a,c,f){return new vA(s,a,c,f)}function Nm(s){return s=s.prototype,!(!s||!s.isReactComponent)}function Zs(s,a){var c=s.alternate;return c===null?(c=wr(s.tag,a,s.key,s.mode),c.elementType=s.elementType,c.type=s.type,c.stateNode=s.stateNode,c.alternate=s,s.alternate=c):(c.pendingProps=a,c.type=s.type,c.flags=0,c.subtreeFlags=0,c.deletions=null),c.flags=s.flags&65011712,c.childLanes=s.childLanes,c.lanes=s.lanes,c.child=s.child,c.memoizedProps=s.memoizedProps,c.memoizedState=s.memoizedState,c.updateQueue=s.updateQueue,a=s.dependencies,c.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext},c.sibling=s.sibling,c.index=s.index,c.ref=s.ref,c.refCleanup=s.refCleanup,c}function w_(s,a){s.flags&=65011714;var c=s.alternate;return c===null?(s.childLanes=0,s.lanes=a,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=c.childLanes,s.lanes=c.lanes,s.child=c.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=c.memoizedProps,s.memoizedState=c.memoizedState,s.updateQueue=c.updateQueue,s.type=c.type,a=c.dependencies,s.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext}),s}function Pd(s,a,c,f,_,w){var z=0;if(f=s,typeof s=="function")Nm(s)&&(z=1);else if(typeof s=="string")z=E2(s,c,ie.current)?26:s==="html"||s==="head"||s==="body"?27:5;else e:switch(s){case N:return s=wr(31,c,a,_),s.elementType=N,s.lanes=w,s;case x:return ro(c.children,_,w,a);case S:z=8,_|=24;break;case E:return s=wr(12,c,a,_|2),s.elementType=E,s.lanes=w,s;case B:return s=wr(13,c,a,_),s.elementType=B,s.lanes=w,s;case $:return s=wr(19,c,a,_),s.elementType=$,s.lanes=w,s;default:if(typeof s=="object"&&s!==null)switch(s.$$typeof){case I:z=10;break e;case T:z=9;break e;case D:z=11;break e;case k:z=14;break e;case j:z=16,f=null;break e}z=29,c=Error(r(130,s===null?"null":typeof s,"")),f=null}return a=wr(z,c,a,_),a.elementType=s,a.type=f,a.lanes=w,a}function ro(s,a,c,f){return s=wr(7,s,f,a),s.lanes=c,s}function Pm(s,a,c){return s=wr(6,s,null,a),s.lanes=c,s}function S_(s){var a=wr(18,null,null,0);return a.stateNode=s,a}function zm(s,a,c){return a=wr(4,s.children!==null?s.children:[],s.key,a),a.lanes=c,a.stateNode={containerInfo:s.containerInfo,pendingChildren:null,implementation:s.implementation},a}var C_=new WeakMap;function zr(s,a){if(typeof s=="object"&&s!==null){var c=C_.get(s);return c!==void 0?c:(a={value:s,source:a,stack:J(a)},C_.set(s,a),a)}return{value:s,source:a,stack:J(a)}}var sl=[],il=0,zd=null,Bc=0,Br=[],Lr=0,Bi=null,Ms=1,Os="";function Js(s,a){sl[il++]=Bc,sl[il++]=zd,zd=s,Bc=a}function E_(s,a,c){Br[Lr++]=Ms,Br[Lr++]=Os,Br[Lr++]=Bi,Bi=s;var f=Ms;s=Os;var _=32-Tt(f)-1;f&=~(1<<_),c+=1;var w=32-Tt(a)+_;if(30<w){var z=_-_%5;w=(f&(1<<z)-1).toString(32),f>>=z,_-=z,Ms=1<<32-Tt(a)+_|c<<_|f,Os=w+s}else Ms=1<<w|c<<_|f,Os=s}function Bm(s){s.return!==null&&(Js(s,1),E_(s,1,0))}function Lm(s){for(;s===zd;)zd=sl[--il],sl[il]=null,Bc=sl[--il],sl[il]=null;for(;s===Bi;)Bi=Br[--Lr],Br[Lr]=null,Os=Br[--Lr],Br[Lr]=null,Ms=Br[--Lr],Br[Lr]=null}function T_(s,a){Br[Lr++]=Ms,Br[Lr++]=Os,Br[Lr++]=Bi,Ms=a.id,Os=a.overflow,Bi=s}var zn=null,qt=null,yt=!1,Li=null,Ur=!1,Um=Error(r(519));function Ui(s){var a=Error(r(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Lc(zr(a,s)),Um}function A_(s){var a=s.stateNode,c=s.type,f=s.memoizedProps;switch(a[hn]=s,a[In]=f,c){case"dialog":ct("cancel",a),ct("close",a);break;case"iframe":case"object":case"embed":ct("load",a);break;case"video":case"audio":for(c=0;c<ou.length;c++)ct(ou[c],a);break;case"source":ct("error",a);break;case"img":case"image":case"link":ct("error",a),ct("load",a);break;case"details":ct("toggle",a);break;case"input":ct("invalid",a),gd(a,f.value,f.defaultValue,f.checked,f.defaultChecked,f.type,f.name,!0);break;case"select":ct("invalid",a);break;case"textarea":ct("invalid",a),ki(a,f.value,f.defaultValue,f.children)}c=f.children,typeof c!="string"&&typeof c!="number"&&typeof c!="bigint"||a.textContent===""+c||f.suppressHydrationWarning===!0||qv(a.textContent,c)?(f.popover!=null&&(ct("beforetoggle",a),ct("toggle",a)),f.onScroll!=null&&ct("scroll",a),f.onScrollEnd!=null&&ct("scrollend",a),f.onClick!=null&&(a.onclick=Zr),a=!0):a=!1,a||Ui(s,!0)}function j_(s){for(zn=s.return;zn;)switch(zn.tag){case 5:case 31:case 13:Ur=!1;return;case 27:case 3:Ur=!0;return;default:zn=zn.return}}function al(s){if(s!==zn)return!1;if(!yt)return j_(s),yt=!0,!1;var a=s.tag,c;if((c=a!==3&&a!==27)&&((c=a===5)&&(c=s.type,c=!(c!=="form"&&c!=="button")||sg(s.type,s.memoizedProps)),c=!c),c&&qt&&Ui(s),j_(s),a===13){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(r(317));qt=Jv(s)}else if(a===31){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(r(317));qt=Jv(s)}else a===27?(a=qt,ea(s.type)?(s=cg,cg=null,qt=s):qt=a):qt=zn?Vr(s.stateNode.nextSibling):null;return!0}function so(){qt=zn=null,yt=!1}function Fm(){var s=Li;return s!==null&&(dr===null?dr=s:dr.push.apply(dr,s),Li=null),s}function Lc(s){Li===null?Li=[s]:Li.push(s)}var Vm=L(null),io=null,ei=null;function Fi(s,a,c){ne(Vm,a._currentValue),a._currentValue=c}function ti(s){s._currentValue=Vm.current,G(Vm)}function $m(s,a,c){for(;s!==null;){var f=s.alternate;if((s.childLanes&a)!==a?(s.childLanes|=a,f!==null&&(f.childLanes|=a)):f!==null&&(f.childLanes&a)!==a&&(f.childLanes|=a),s===c)break;s=s.return}}function qm(s,a,c,f){var _=s.child;for(_!==null&&(_.return=s);_!==null;){var w=_.dependencies;if(w!==null){var z=_.child;w=w.firstContext;e:for(;w!==null;){var Q=w;w=_;for(var re=0;re<a.length;re++)if(Q.context===a[re]){w.lanes|=c,Q=w.alternate,Q!==null&&(Q.lanes|=c),$m(w.return,c,s),f||(z=null);break e}w=Q.next}}else if(_.tag===18){if(z=_.return,z===null)throw Error(r(341));z.lanes|=c,w=z.alternate,w!==null&&(w.lanes|=c),$m(z,c,s),z=null}else z=_.child;if(z!==null)z.return=_;else for(z=_;z!==null;){if(z===s){z=null;break}if(_=z.sibling,_!==null){_.return=z.return,z=_;break}z=z.return}_=z}}function ol(s,a,c,f){s=null;for(var _=a,w=!1;_!==null;){if(!w){if((_.flags&524288)!==0)w=!0;else if((_.flags&262144)!==0)break}if(_.tag===10){var z=_.alternate;if(z===null)throw Error(r(387));if(z=z.memoizedProps,z!==null){var Q=_.type;xr(_.pendingProps.value,z.value)||(s!==null?s.push(Q):s=[Q])}}else if(_===ve.current){if(z=_.alternate,z===null)throw Error(r(387));z.memoizedState.memoizedState!==_.memoizedState.memoizedState&&(s!==null?s.push(hu):s=[hu])}_=_.return}s!==null&&qm(a,s,c,f),a.flags|=262144}function Bd(s){for(s=s.firstContext;s!==null;){if(!xr(s.context._currentValue,s.memoizedValue))return!0;s=s.next}return!1}function ao(s){io=s,ei=null,s=s.dependencies,s!==null&&(s.firstContext=null)}function Bn(s){return R_(io,s)}function Ld(s,a){return io===null&&ao(s),R_(s,a)}function R_(s,a){var c=a._currentValue;if(a={context:a,memoizedValue:c,next:null},ei===null){if(s===null)throw Error(r(308));ei=a,s.dependencies={lanes:0,firstContext:a},s.flags|=524288}else ei=ei.next=a;return c}var xA=typeof AbortController<"u"?AbortController:function(){var s=[],a=this.signal={aborted:!1,addEventListener:function(c,f){s.push(f)}};this.abort=function(){a.aborted=!0,s.forEach(function(c){return c()})}},wA=t.unstable_scheduleCallback,SA=t.unstable_NormalPriority,pn={$$typeof:I,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Hm(){return{controller:new xA,data:new Map,refCount:0}}function Uc(s){s.refCount--,s.refCount===0&&wA(SA,function(){s.controller.abort()})}var Fc=null,Gm=0,ll=0,cl=null;function CA(s,a){if(Fc===null){var c=Fc=[];Gm=0,ll=Kp(),cl={status:"pending",value:void 0,then:function(f){c.push(f)}}}return Gm++,a.then(I_,I_),a}function I_(){if(--Gm===0&&Fc!==null){cl!==null&&(cl.status="fulfilled");var s=Fc;Fc=null,ll=0,cl=null;for(var a=0;a<s.length;a++)(0,s[a])()}}function EA(s,a){var c=[],f={status:"pending",value:null,reason:null,then:function(_){c.push(_)}};return s.then(function(){f.status="fulfilled",f.value=a;for(var _=0;_<c.length;_++)(0,c[_])(a)},function(_){for(f.status="rejected",f.reason=_,_=0;_<c.length;_++)(0,c[_])(void 0)}),f}var k_=W.S;W.S=function(s,a){mv=Oe(),typeof a=="object"&&a!==null&&typeof a.then=="function"&&CA(s,a),k_!==null&&k_(s,a)};var oo=L(null);function Qm(){var s=oo.current;return s!==null?s:Ut.pooledCache}function Ud(s,a){a===null?ne(oo,oo.current):ne(oo,a.pool)}function D_(){var s=Qm();return s===null?null:{parent:pn._currentValue,pool:s}}var ul=Error(r(460)),Wm=Error(r(474)),Fd=Error(r(542)),Vd={then:function(){}};function M_(s){return s=s.status,s==="fulfilled"||s==="rejected"}function O_(s,a,c){switch(c=s[c],c===void 0?s.push(a):c!==a&&(a.then(Zr,Zr),a=c),a.status){case"fulfilled":return a.value;case"rejected":throw s=a.reason,P_(s),s;default:if(typeof a.status=="string")a.then(Zr,Zr);else{if(s=Ut,s!==null&&100<s.shellSuspendCounter)throw Error(r(482));s=a,s.status="pending",s.then(function(f){if(a.status==="pending"){var _=a;_.status="fulfilled",_.value=f}},function(f){if(a.status==="pending"){var _=a;_.status="rejected",_.reason=f}})}switch(a.status){case"fulfilled":return a.value;case"rejected":throw s=a.reason,P_(s),s}throw co=a,ul}}function lo(s){try{var a=s._init;return a(s._payload)}catch(c){throw c!==null&&typeof c=="object"&&typeof c.then=="function"?(co=c,ul):c}}var co=null;function N_(){if(co===null)throw Error(r(459));var s=co;return co=null,s}function P_(s){if(s===ul||s===Fd)throw Error(r(483))}var dl=null,Vc=0;function $d(s){var a=Vc;return Vc+=1,dl===null&&(dl=[]),O_(dl,s,a)}function $c(s,a){a=a.props.ref,s.ref=a!==void 0?a:null}function qd(s,a){throw a.$$typeof===v?Error(r(525)):(s=Object.prototype.toString.call(a),Error(r(31,s==="[object Object]"?"object with keys {"+Object.keys(a).join(", ")+"}":s)))}function z_(s){function a(de,le){if(s){var pe=de.deletions;pe===null?(de.deletions=[le],de.flags|=16):pe.push(le)}}function c(de,le){if(!s)return null;for(;le!==null;)a(de,le),le=le.sibling;return null}function f(de){for(var le=new Map;de!==null;)de.key!==null?le.set(de.key,de):le.set(de.index,de),de=de.sibling;return le}function _(de,le){return de=Zs(de,le),de.index=0,de.sibling=null,de}function w(de,le,pe){return de.index=pe,s?(pe=de.alternate,pe!==null?(pe=pe.index,pe<le?(de.flags|=67108866,le):pe):(de.flags|=67108866,le)):(de.flags|=1048576,le)}function z(de){return s&&de.alternate===null&&(de.flags|=67108866),de}function Q(de,le,pe,Te){return le===null||le.tag!==6?(le=Pm(pe,de.mode,Te),le.return=de,le):(le=_(le,pe),le.return=de,le)}function re(de,le,pe,Te){var He=pe.type;return He===x?Ee(de,le,pe.props.children,Te,pe.key):le!==null&&(le.elementType===He||typeof He=="object"&&He!==null&&He.$$typeof===j&&lo(He)===le.type)?(le=_(le,pe.props),$c(le,pe),le.return=de,le):(le=Pd(pe.type,pe.key,pe.props,null,de.mode,Te),$c(le,pe),le.return=de,le)}function ge(de,le,pe,Te){return le===null||le.tag!==4||le.stateNode.containerInfo!==pe.containerInfo||le.stateNode.implementation!==pe.implementation?(le=zm(pe,de.mode,Te),le.return=de,le):(le=_(le,pe.children||[]),le.return=de,le)}function Ee(de,le,pe,Te,He){return le===null||le.tag!==7?(le=ro(pe,de.mode,Te,He),le.return=de,le):(le=_(le,pe),le.return=de,le)}function Re(de,le,pe){if(typeof le=="string"&&le!==""||typeof le=="number"||typeof le=="bigint")return le=Pm(""+le,de.mode,pe),le.return=de,le;if(typeof le=="object"&&le!==null){switch(le.$$typeof){case b:return pe=Pd(le.type,le.key,le.props,null,de.mode,pe),$c(pe,le),pe.return=de,pe;case C:return le=zm(le,de.mode,pe),le.return=de,le;case j:return le=lo(le),Re(de,le,pe)}if(X(le)||A(le))return le=ro(le,de.mode,pe,null),le.return=de,le;if(typeof le.then=="function")return Re(de,$d(le),pe);if(le.$$typeof===I)return Re(de,Ld(de,le),pe);qd(de,le)}return null}function _e(de,le,pe,Te){var He=le!==null?le.key:null;if(typeof pe=="string"&&pe!==""||typeof pe=="number"||typeof pe=="bigint")return He!==null?null:Q(de,le,""+pe,Te);if(typeof pe=="object"&&pe!==null){switch(pe.$$typeof){case b:return pe.key===He?re(de,le,pe,Te):null;case C:return pe.key===He?ge(de,le,pe,Te):null;case j:return pe=lo(pe),_e(de,le,pe,Te)}if(X(pe)||A(pe))return He!==null?null:Ee(de,le,pe,Te,null);if(typeof pe.then=="function")return _e(de,le,$d(pe),Te);if(pe.$$typeof===I)return _e(de,le,Ld(de,pe),Te);qd(de,pe)}return null}function we(de,le,pe,Te,He){if(typeof Te=="string"&&Te!==""||typeof Te=="number"||typeof Te=="bigint")return de=de.get(pe)||null,Q(le,de,""+Te,He);if(typeof Te=="object"&&Te!==null){switch(Te.$$typeof){case b:return de=de.get(Te.key===null?pe:Te.key)||null,re(le,de,Te,He);case C:return de=de.get(Te.key===null?pe:Te.key)||null,ge(le,de,Te,He);case j:return Te=lo(Te),we(de,le,pe,Te,He)}if(X(Te)||A(Te))return de=de.get(pe)||null,Ee(le,de,Te,He,null);if(typeof Te.then=="function")return we(de,le,pe,$d(Te),He);if(Te.$$typeof===I)return we(de,le,pe,Ld(le,Te),He);qd(le,Te)}return null}function Fe(de,le,pe,Te){for(var He=null,Ct=null,$e=le,st=le=0,ht=null;$e!==null&&st<pe.length;st++){$e.index>st?(ht=$e,$e=null):ht=$e.sibling;var Et=_e(de,$e,pe[st],Te);if(Et===null){$e===null&&($e=ht);break}s&&$e&&Et.alternate===null&&a(de,$e),le=w(Et,le,st),Ct===null?He=Et:Ct.sibling=Et,Ct=Et,$e=ht}if(st===pe.length)return c(de,$e),yt&&Js(de,st),He;if($e===null){for(;st<pe.length;st++)$e=Re(de,pe[st],Te),$e!==null&&(le=w($e,le,st),Ct===null?He=$e:Ct.sibling=$e,Ct=$e);return yt&&Js(de,st),He}for($e=f($e);st<pe.length;st++)ht=we($e,de,st,pe[st],Te),ht!==null&&(s&&ht.alternate!==null&&$e.delete(ht.key===null?st:ht.key),le=w(ht,le,st),Ct===null?He=ht:Ct.sibling=ht,Ct=ht);return s&&$e.forEach(function(ia){return a(de,ia)}),yt&&Js(de,st),He}function Qe(de,le,pe,Te){if(pe==null)throw Error(r(151));for(var He=null,Ct=null,$e=le,st=le=0,ht=null,Et=pe.next();$e!==null&&!Et.done;st++,Et=pe.next()){$e.index>st?(ht=$e,$e=null):ht=$e.sibling;var ia=_e(de,$e,Et.value,Te);if(ia===null){$e===null&&($e=ht);break}s&&$e&&ia.alternate===null&&a(de,$e),le=w(ia,le,st),Ct===null?He=ia:Ct.sibling=ia,Ct=ia,$e=ht}if(Et.done)return c(de,$e),yt&&Js(de,st),He;if($e===null){for(;!Et.done;st++,Et=pe.next())Et=Re(de,Et.value,Te),Et!==null&&(le=w(Et,le,st),Ct===null?He=Et:Ct.sibling=Et,Ct=Et);return yt&&Js(de,st),He}for($e=f($e);!Et.done;st++,Et=pe.next())Et=we($e,de,st,Et.value,Te),Et!==null&&(s&&Et.alternate!==null&&$e.delete(Et.key===null?st:Et.key),le=w(Et,le,st),Ct===null?He=Et:Ct.sibling=Et,Ct=Et);return s&&$e.forEach(function(P2){return a(de,P2)}),yt&&Js(de,st),He}function zt(de,le,pe,Te){if(typeof pe=="object"&&pe!==null&&pe.type===x&&pe.key===null&&(pe=pe.props.children),typeof pe=="object"&&pe!==null){switch(pe.$$typeof){case b:e:{for(var He=pe.key;le!==null;){if(le.key===He){if(He=pe.type,He===x){if(le.tag===7){c(de,le.sibling),Te=_(le,pe.props.children),Te.return=de,de=Te;break e}}else if(le.elementType===He||typeof He=="object"&&He!==null&&He.$$typeof===j&&lo(He)===le.type){c(de,le.sibling),Te=_(le,pe.props),$c(Te,pe),Te.return=de,de=Te;break e}c(de,le);break}else a(de,le);le=le.sibling}pe.type===x?(Te=ro(pe.props.children,de.mode,Te,pe.key),Te.return=de,de=Te):(Te=Pd(pe.type,pe.key,pe.props,null,de.mode,Te),$c(Te,pe),Te.return=de,de=Te)}return z(de);case C:e:{for(He=pe.key;le!==null;){if(le.key===He)if(le.tag===4&&le.stateNode.containerInfo===pe.containerInfo&&le.stateNode.implementation===pe.implementation){c(de,le.sibling),Te=_(le,pe.children||[]),Te.return=de,de=Te;break e}else{c(de,le);break}else a(de,le);le=le.sibling}Te=zm(pe,de.mode,Te),Te.return=de,de=Te}return z(de);case j:return pe=lo(pe),zt(de,le,pe,Te)}if(X(pe))return Fe(de,le,pe,Te);if(A(pe)){if(He=A(pe),typeof He!="function")throw Error(r(150));return pe=He.call(pe),Qe(de,le,pe,Te)}if(typeof pe.then=="function")return zt(de,le,$d(pe),Te);if(pe.$$typeof===I)return zt(de,le,Ld(de,pe),Te);qd(de,pe)}return typeof pe=="string"&&pe!==""||typeof pe=="number"||typeof pe=="bigint"?(pe=""+pe,le!==null&&le.tag===6?(c(de,le.sibling),Te=_(le,pe),Te.return=de,de=Te):(c(de,le),Te=Pm(pe,de.mode,Te),Te.return=de,de=Te),z(de)):c(de,le)}return function(de,le,pe,Te){try{Vc=0;var He=zt(de,le,pe,Te);return dl=null,He}catch($e){if($e===ul||$e===Fd)throw $e;var Ct=wr(29,$e,null,de.mode);return Ct.lanes=Te,Ct.return=de,Ct}}}var uo=z_(!0),B_=z_(!1),Vi=!1;function Km(s){s.updateQueue={baseState:s.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Ym(s,a){s=s.updateQueue,a.updateQueue===s&&(a.updateQueue={baseState:s.baseState,firstBaseUpdate:s.firstBaseUpdate,lastBaseUpdate:s.lastBaseUpdate,shared:s.shared,callbacks:null})}function $i(s){return{lane:s,tag:0,payload:null,callback:null,next:null}}function qi(s,a,c){var f=s.updateQueue;if(f===null)return null;if(f=f.shared,(jt&2)!==0){var _=f.pending;return _===null?a.next=a:(a.next=_.next,_.next=a),f.pending=a,a=Nd(s),x_(s,null,c),a}return Od(s,f,a,c),Nd(s)}function qc(s,a,c){if(a=a.updateQueue,a!==null&&(a=a.shared,(c&4194048)!==0)){var f=a.lanes;f&=s.pendingLanes,c|=f,a.lanes=c,yc(s,c)}}function Xm(s,a){var c=s.updateQueue,f=s.alternate;if(f!==null&&(f=f.updateQueue,c===f)){var _=null,w=null;if(c=c.firstBaseUpdate,c!==null){do{var z={lane:c.lane,tag:c.tag,payload:c.payload,callback:null,next:null};w===null?_=w=z:w=w.next=z,c=c.next}while(c!==null);w===null?_=w=a:w=w.next=a}else _=w=a;c={baseState:f.baseState,firstBaseUpdate:_,lastBaseUpdate:w,shared:f.shared,callbacks:f.callbacks},s.updateQueue=c;return}s=c.lastBaseUpdate,s===null?c.firstBaseUpdate=a:s.next=a,c.lastBaseUpdate=a}var Zm=!1;function Hc(){if(Zm){var s=cl;if(s!==null)throw s}}function Gc(s,a,c,f){Zm=!1;var _=s.updateQueue;Vi=!1;var w=_.firstBaseUpdate,z=_.lastBaseUpdate,Q=_.shared.pending;if(Q!==null){_.shared.pending=null;var re=Q,ge=re.next;re.next=null,z===null?w=ge:z.next=ge,z=re;var Ee=s.alternate;Ee!==null&&(Ee=Ee.updateQueue,Q=Ee.lastBaseUpdate,Q!==z&&(Q===null?Ee.firstBaseUpdate=ge:Q.next=ge,Ee.lastBaseUpdate=re))}if(w!==null){var Re=_.baseState;z=0,Ee=ge=re=null,Q=w;do{var _e=Q.lane&-536870913,we=_e!==Q.lane;if(we?(dt&_e)===_e:(f&_e)===_e){_e!==0&&_e===ll&&(Zm=!0),Ee!==null&&(Ee=Ee.next={lane:0,tag:Q.tag,payload:Q.payload,callback:null,next:null});e:{var Fe=s,Qe=Q;_e=a;var zt=c;switch(Qe.tag){case 1:if(Fe=Qe.payload,typeof Fe=="function"){Re=Fe.call(zt,Re,_e);break e}Re=Fe;break e;case 3:Fe.flags=Fe.flags&-65537|128;case 0:if(Fe=Qe.payload,_e=typeof Fe=="function"?Fe.call(zt,Re,_e):Fe,_e==null)break e;Re=g({},Re,_e);break e;case 2:Vi=!0}}_e=Q.callback,_e!==null&&(s.flags|=64,we&&(s.flags|=8192),we=_.callbacks,we===null?_.callbacks=[_e]:we.push(_e))}else we={lane:_e,tag:Q.tag,payload:Q.payload,callback:Q.callback,next:null},Ee===null?(ge=Ee=we,re=Re):Ee=Ee.next=we,z|=_e;if(Q=Q.next,Q===null){if(Q=_.shared.pending,Q===null)break;we=Q,Q=we.next,we.next=null,_.lastBaseUpdate=we,_.shared.pending=null}}while(!0);Ee===null&&(re=Re),_.baseState=re,_.firstBaseUpdate=ge,_.lastBaseUpdate=Ee,w===null&&(_.shared.lanes=0),Ki|=z,s.lanes=z,s.memoizedState=Re}}function L_(s,a){if(typeof s!="function")throw Error(r(191,s));s.call(a)}function U_(s,a){var c=s.callbacks;if(c!==null)for(s.callbacks=null,s=0;s<c.length;s++)L_(c[s],a)}var hl=L(null),Hd=L(0);function F_(s,a){s=ui,ne(Hd,s),ne(hl,a),ui=s|a.baseLanes}function Jm(){ne(Hd,ui),ne(hl,hl.current)}function ep(){ui=Hd.current,G(hl),G(Hd)}var Sr=L(null),Fr=null;function Hi(s){var a=s.alternate;ne(an,an.current&1),ne(Sr,s),Fr===null&&(a===null||hl.current!==null||a.memoizedState!==null)&&(Fr=s)}function tp(s){ne(an,an.current),ne(Sr,s),Fr===null&&(Fr=s)}function V_(s){s.tag===22?(ne(an,an.current),ne(Sr,s),Fr===null&&(Fr=s)):Gi()}function Gi(){ne(an,an.current),ne(Sr,Sr.current)}function Cr(s){G(Sr),Fr===s&&(Fr=null),G(an)}var an=L(0);function Gd(s){for(var a=s;a!==null;){if(a.tag===13){var c=a.memoizedState;if(c!==null&&(c=c.dehydrated,c===null||og(c)||lg(c)))return a}else if(a.tag===19&&(a.memoizedProps.revealOrder==="forwards"||a.memoizedProps.revealOrder==="backwards"||a.memoizedProps.revealOrder==="unstable_legacy-backwards"||a.memoizedProps.revealOrder==="together")){if((a.flags&128)!==0)return a}else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===s)break;for(;a.sibling===null;){if(a.return===null||a.return===s)return null;a=a.return}a.sibling.return=a.return,a=a.sibling}return null}var ni=0,rt=null,Nt=null,gn=null,Qd=!1,fl=!1,ho=!1,Wd=0,Qc=0,ml=null,TA=0;function nn(){throw Error(r(321))}function np(s,a){if(a===null)return!1;for(var c=0;c<a.length&&c<s.length;c++)if(!xr(s[c],a[c]))return!1;return!0}function rp(s,a,c,f,_,w){return ni=w,rt=a,a.memoizedState=null,a.updateQueue=null,a.lanes=0,W.H=s===null||s.memoizedState===null?Eb:_p,ho=!1,w=c(f,_),ho=!1,fl&&(w=q_(a,c,f,_)),$_(s),w}function $_(s){W.H=Yc;var a=Nt!==null&&Nt.next!==null;if(ni=0,gn=Nt=rt=null,Qd=!1,Qc=0,ml=null,a)throw Error(r(300));s===null||yn||(s=s.dependencies,s!==null&&Bd(s)&&(yn=!0))}function q_(s,a,c,f){rt=s;var _=0;do{if(fl&&(ml=null),Qc=0,fl=!1,25<=_)throw Error(r(301));if(_+=1,gn=Nt=null,s.updateQueue!=null){var w=s.updateQueue;w.lastEffect=null,w.events=null,w.stores=null,w.memoCache!=null&&(w.memoCache.index=0)}W.H=Tb,w=a(c,f)}while(fl);return w}function AA(){var s=W.H,a=s.useState()[0];return a=typeof a.then=="function"?Wc(a):a,s=s.useState()[0],(Nt!==null?Nt.memoizedState:null)!==s&&(rt.flags|=1024),a}function sp(){var s=Wd!==0;return Wd=0,s}function ip(s,a,c){a.updateQueue=s.updateQueue,a.flags&=-2053,s.lanes&=~c}function ap(s){if(Qd){for(s=s.memoizedState;s!==null;){var a=s.queue;a!==null&&(a.pending=null),s=s.next}Qd=!1}ni=0,gn=Nt=rt=null,fl=!1,Qc=Wd=0,ml=null}function sr(){var s={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return gn===null?rt.memoizedState=gn=s:gn=gn.next=s,gn}function on(){if(Nt===null){var s=rt.alternate;s=s!==null?s.memoizedState:null}else s=Nt.next;var a=gn===null?rt.memoizedState:gn.next;if(a!==null)gn=a,Nt=s;else{if(s===null)throw rt.alternate===null?Error(r(467)):Error(r(310));Nt=s,s={memoizedState:Nt.memoizedState,baseState:Nt.baseState,baseQueue:Nt.baseQueue,queue:Nt.queue,next:null},gn===null?rt.memoizedState=gn=s:gn=gn.next=s}return gn}function Kd(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Wc(s){var a=Qc;return Qc+=1,ml===null&&(ml=[]),s=O_(ml,s,a),a=rt,(gn===null?a.memoizedState:gn.next)===null&&(a=a.alternate,W.H=a===null||a.memoizedState===null?Eb:_p),s}function Yd(s){if(s!==null&&typeof s=="object"){if(typeof s.then=="function")return Wc(s);if(s.$$typeof===I)return Bn(s)}throw Error(r(438,String(s)))}function op(s){var a=null,c=rt.updateQueue;if(c!==null&&(a=c.memoCache),a==null){var f=rt.alternate;f!==null&&(f=f.updateQueue,f!==null&&(f=f.memoCache,f!=null&&(a={data:f.data.map(function(_){return _.slice()}),index:0})))}if(a==null&&(a={data:[],index:0}),c===null&&(c=Kd(),rt.updateQueue=c),c.memoCache=a,c=a.data[a.index],c===void 0)for(c=a.data[a.index]=Array(s),f=0;f<s;f++)c[f]=F;return a.index++,c}function ri(s,a){return typeof a=="function"?a(s):a}function Xd(s){var a=on();return lp(a,Nt,s)}function lp(s,a,c){var f=s.queue;if(f===null)throw Error(r(311));f.lastRenderedReducer=c;var _=s.baseQueue,w=f.pending;if(w!==null){if(_!==null){var z=_.next;_.next=w.next,w.next=z}a.baseQueue=_=w,f.pending=null}if(w=s.baseState,_===null)s.memoizedState=w;else{a=_.next;var Q=z=null,re=null,ge=a,Ee=!1;do{var Re=ge.lane&-536870913;if(Re!==ge.lane?(dt&Re)===Re:(ni&Re)===Re){var _e=ge.revertLane;if(_e===0)re!==null&&(re=re.next={lane:0,revertLane:0,gesture:null,action:ge.action,hasEagerState:ge.hasEagerState,eagerState:ge.eagerState,next:null}),Re===ll&&(Ee=!0);else if((ni&_e)===_e){ge=ge.next,_e===ll&&(Ee=!0);continue}else Re={lane:0,revertLane:ge.revertLane,gesture:null,action:ge.action,hasEagerState:ge.hasEagerState,eagerState:ge.eagerState,next:null},re===null?(Q=re=Re,z=w):re=re.next=Re,rt.lanes|=_e,Ki|=_e;Re=ge.action,ho&&c(w,Re),w=ge.hasEagerState?ge.eagerState:c(w,Re)}else _e={lane:Re,revertLane:ge.revertLane,gesture:ge.gesture,action:ge.action,hasEagerState:ge.hasEagerState,eagerState:ge.eagerState,next:null},re===null?(Q=re=_e,z=w):re=re.next=_e,rt.lanes|=Re,Ki|=Re;ge=ge.next}while(ge!==null&&ge!==a);if(re===null?z=w:re.next=Q,!xr(w,s.memoizedState)&&(yn=!0,Ee&&(c=cl,c!==null)))throw c;s.memoizedState=w,s.baseState=z,s.baseQueue=re,f.lastRenderedState=w}return _===null&&(f.lanes=0),[s.memoizedState,f.dispatch]}function cp(s){var a=on(),c=a.queue;if(c===null)throw Error(r(311));c.lastRenderedReducer=s;var f=c.dispatch,_=c.pending,w=a.memoizedState;if(_!==null){c.pending=null;var z=_=_.next;do w=s(w,z.action),z=z.next;while(z!==_);xr(w,a.memoizedState)||(yn=!0),a.memoizedState=w,a.baseQueue===null&&(a.baseState=w),c.lastRenderedState=w}return[w,f]}function H_(s,a,c){var f=rt,_=on(),w=yt;if(w){if(c===void 0)throw Error(r(407));c=c()}else c=a();var z=!xr((Nt||_).memoizedState,c);if(z&&(_.memoizedState=c,yn=!0),_=_.queue,hp(W_.bind(null,f,_,s),[s]),_.getSnapshot!==a||z||gn!==null&&gn.memoizedState.tag&1){if(f.flags|=2048,pl(9,{destroy:void 0},Q_.bind(null,f,_,c,a),null),Ut===null)throw Error(r(349));w||(ni&127)!==0||G_(f,a,c)}return c}function G_(s,a,c){s.flags|=16384,s={getSnapshot:a,value:c},a=rt.updateQueue,a===null?(a=Kd(),rt.updateQueue=a,a.stores=[s]):(c=a.stores,c===null?a.stores=[s]:c.push(s))}function Q_(s,a,c,f){a.value=c,a.getSnapshot=f,K_(a)&&Y_(s)}function W_(s,a,c){return c(function(){K_(a)&&Y_(s)})}function K_(s){var a=s.getSnapshot;s=s.value;try{var c=a();return!xr(s,c)}catch{return!0}}function Y_(s){var a=no(s,2);a!==null&&hr(a,s,2)}function up(s){var a=sr();if(typeof s=="function"){var c=s;if(s=c(),ho){Kn(!0);try{c()}finally{Kn(!1)}}}return a.memoizedState=a.baseState=s,a.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ri,lastRenderedState:s},a}function X_(s,a,c,f){return s.baseState=c,lp(s,Nt,typeof f=="function"?f:ri)}function jA(s,a,c,f,_){if(eh(s))throw Error(r(485));if(s=a.action,s!==null){var w={payload:_,action:s,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(z){w.listeners.push(z)}};W.T!==null?c(!0):w.isTransition=!1,f(w),c=a.pending,c===null?(w.next=a.pending=w,Z_(a,w)):(w.next=c.next,a.pending=c.next=w)}}function Z_(s,a){var c=a.action,f=a.payload,_=s.state;if(a.isTransition){var w=W.T,z={};W.T=z;try{var Q=c(_,f),re=W.S;re!==null&&re(z,Q),J_(s,a,Q)}catch(ge){dp(s,a,ge)}finally{w!==null&&z.types!==null&&(w.types=z.types),W.T=w}}else try{w=c(_,f),J_(s,a,w)}catch(ge){dp(s,a,ge)}}function J_(s,a,c){c!==null&&typeof c=="object"&&typeof c.then=="function"?c.then(function(f){eb(s,a,f)},function(f){return dp(s,a,f)}):eb(s,a,c)}function eb(s,a,c){a.status="fulfilled",a.value=c,tb(a),s.state=c,a=s.pending,a!==null&&(c=a.next,c===a?s.pending=null:(c=c.next,a.next=c,Z_(s,c)))}function dp(s,a,c){var f=s.pending;if(s.pending=null,f!==null){f=f.next;do a.status="rejected",a.reason=c,tb(a),a=a.next;while(a!==f)}s.action=null}function tb(s){s=s.listeners;for(var a=0;a<s.length;a++)(0,s[a])()}function nb(s,a){return a}function rb(s,a){if(yt){var c=Ut.formState;if(c!==null){e:{var f=rt;if(yt){if(qt){t:{for(var _=qt,w=Ur;_.nodeType!==8;){if(!w){_=null;break t}if(_=Vr(_.nextSibling),_===null){_=null;break t}}w=_.data,_=w==="F!"||w==="F"?_:null}if(_){qt=Vr(_.nextSibling),f=_.data==="F!";break e}}Ui(f)}f=!1}f&&(a=c[0])}}return c=sr(),c.memoizedState=c.baseState=a,f={pending:null,lanes:0,dispatch:null,lastRenderedReducer:nb,lastRenderedState:a},c.queue=f,c=wb.bind(null,rt,f),f.dispatch=c,f=up(!1),w=yp.bind(null,rt,!1,f.queue),f=sr(),_={state:a,dispatch:null,action:s,pending:null},f.queue=_,c=jA.bind(null,rt,_,w,c),_.dispatch=c,f.memoizedState=s,[a,c,!1]}function sb(s){var a=on();return ib(a,Nt,s)}function ib(s,a,c){if(a=lp(s,a,nb)[0],s=Xd(ri)[0],typeof a=="object"&&a!==null&&typeof a.then=="function")try{var f=Wc(a)}catch(z){throw z===ul?Fd:z}else f=a;a=on();var _=a.queue,w=_.dispatch;return c!==a.memoizedState&&(rt.flags|=2048,pl(9,{destroy:void 0},RA.bind(null,_,c),null)),[f,w,s]}function RA(s,a){s.action=a}function ab(s){var a=on(),c=Nt;if(c!==null)return ib(a,c,s);on(),a=a.memoizedState,c=on();var f=c.queue.dispatch;return c.memoizedState=s,[a,f,!1]}function pl(s,a,c,f){return s={tag:s,create:c,deps:f,inst:a,next:null},a=rt.updateQueue,a===null&&(a=Kd(),rt.updateQueue=a),c=a.lastEffect,c===null?a.lastEffect=s.next=s:(f=c.next,c.next=s,s.next=f,a.lastEffect=s),s}function ob(){return on().memoizedState}function Zd(s,a,c,f){var _=sr();rt.flags|=s,_.memoizedState=pl(1|a,{destroy:void 0},c,f===void 0?null:f)}function Jd(s,a,c,f){var _=on();f=f===void 0?null:f;var w=_.memoizedState.inst;Nt!==null&&f!==null&&np(f,Nt.memoizedState.deps)?_.memoizedState=pl(a,w,c,f):(rt.flags|=s,_.memoizedState=pl(1|a,w,c,f))}function lb(s,a){Zd(8390656,8,s,a)}function hp(s,a){Jd(2048,8,s,a)}function IA(s){rt.flags|=4;var a=rt.updateQueue;if(a===null)a=Kd(),rt.updateQueue=a,a.events=[s];else{var c=a.events;c===null?a.events=[s]:c.push(s)}}function cb(s){var a=on().memoizedState;return IA({ref:a,nextImpl:s}),function(){if((jt&2)!==0)throw Error(r(440));return a.impl.apply(void 0,arguments)}}function ub(s,a){return Jd(4,2,s,a)}function db(s,a){return Jd(4,4,s,a)}function hb(s,a){if(typeof a=="function"){s=s();var c=a(s);return function(){typeof c=="function"?c():a(null)}}if(a!=null)return s=s(),a.current=s,function(){a.current=null}}function fb(s,a,c){c=c!=null?c.concat([s]):null,Jd(4,4,hb.bind(null,a,s),c)}function fp(){}function mb(s,a){var c=on();a=a===void 0?null:a;var f=c.memoizedState;return a!==null&&np(a,f[1])?f[0]:(c.memoizedState=[s,a],s)}function pb(s,a){var c=on();a=a===void 0?null:a;var f=c.memoizedState;if(a!==null&&np(a,f[1]))return f[0];if(f=s(),ho){Kn(!0);try{s()}finally{Kn(!1)}}return c.memoizedState=[f,a],f}function mp(s,a,c){return c===void 0||(ni&1073741824)!==0&&(dt&261930)===0?s.memoizedState=a:(s.memoizedState=c,s=gv(),rt.lanes|=s,Ki|=s,c)}function gb(s,a,c,f){return xr(c,a)?c:hl.current!==null?(s=mp(s,c,f),xr(s,a)||(yn=!0),s):(ni&42)===0||(ni&1073741824)!==0&&(dt&261930)===0?(yn=!0,s.memoizedState=c):(s=gv(),rt.lanes|=s,Ki|=s,a)}function yb(s,a,c,f,_){var w=H.p;H.p=w!==0&&8>w?w:8;var z=W.T,Q={};W.T=Q,yp(s,!1,a,c);try{var re=_(),ge=W.S;if(ge!==null&&ge(Q,re),re!==null&&typeof re=="object"&&typeof re.then=="function"){var Ee=EA(re,f);Kc(s,a,Ee,Ar(s))}else Kc(s,a,f,Ar(s))}catch(Re){Kc(s,a,{then:function(){},status:"rejected",reason:Re},Ar())}finally{H.p=w,z!==null&&Q.types!==null&&(z.types=Q.types),W.T=z}}function kA(){}function pp(s,a,c,f){if(s.tag!==5)throw Error(r(476));var _=_b(s).queue;yb(s,_,a,Z,c===null?kA:function(){return bb(s),c(f)})}function _b(s){var a=s.memoizedState;if(a!==null)return a;a={memoizedState:Z,baseState:Z,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ri,lastRenderedState:Z},next:null};var c={};return a.next={memoizedState:c,baseState:c,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ri,lastRenderedState:c},next:null},s.memoizedState=a,s=s.alternate,s!==null&&(s.memoizedState=a),a}function bb(s){var a=_b(s);a.next===null&&(a=s.alternate.memoizedState),Kc(s,a.next.queue,{},Ar())}function gp(){return Bn(hu)}function vb(){return on().memoizedState}function xb(){return on().memoizedState}function DA(s){for(var a=s.return;a!==null;){switch(a.tag){case 24:case 3:var c=Ar();s=$i(c);var f=qi(a,s,c);f!==null&&(hr(f,a,c),qc(f,a,c)),a={cache:Hm()},s.payload=a;return}a=a.return}}function MA(s,a,c){var f=Ar();c={lane:f,revertLane:0,gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null},eh(s)?Sb(a,c):(c=Om(s,a,c,f),c!==null&&(hr(c,s,f),Cb(c,a,f)))}function wb(s,a,c){var f=Ar();Kc(s,a,c,f)}function Kc(s,a,c,f){var _={lane:f,revertLane:0,gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null};if(eh(s))Sb(a,_);else{var w=s.alternate;if(s.lanes===0&&(w===null||w.lanes===0)&&(w=a.lastRenderedReducer,w!==null))try{var z=a.lastRenderedState,Q=w(z,c);if(_.hasEagerState=!0,_.eagerState=Q,xr(Q,z))return Od(s,a,_,0),Ut===null&&Md(),!1}catch{}if(c=Om(s,a,_,f),c!==null)return hr(c,s,f),Cb(c,a,f),!0}return!1}function yp(s,a,c,f){if(f={lane:2,revertLane:Kp(),gesture:null,action:f,hasEagerState:!1,eagerState:null,next:null},eh(s)){if(a)throw Error(r(479))}else a=Om(s,c,f,2),a!==null&&hr(a,s,2)}function eh(s){var a=s.alternate;return s===rt||a!==null&&a===rt}function Sb(s,a){fl=Qd=!0;var c=s.pending;c===null?a.next=a:(a.next=c.next,c.next=a),s.pending=a}function Cb(s,a,c){if((c&4194048)!==0){var f=a.lanes;f&=s.pendingLanes,c|=f,a.lanes=c,yc(s,c)}}var Yc={readContext:Bn,use:Yd,useCallback:nn,useContext:nn,useEffect:nn,useImperativeHandle:nn,useLayoutEffect:nn,useInsertionEffect:nn,useMemo:nn,useReducer:nn,useRef:nn,useState:nn,useDebugValue:nn,useDeferredValue:nn,useTransition:nn,useSyncExternalStore:nn,useId:nn,useHostTransitionStatus:nn,useFormState:nn,useActionState:nn,useOptimistic:nn,useMemoCache:nn,useCacheRefresh:nn};Yc.useEffectEvent=nn;var Eb={readContext:Bn,use:Yd,useCallback:function(s,a){return sr().memoizedState=[s,a===void 0?null:a],s},useContext:Bn,useEffect:lb,useImperativeHandle:function(s,a,c){c=c!=null?c.concat([s]):null,Zd(4194308,4,hb.bind(null,a,s),c)},useLayoutEffect:function(s,a){return Zd(4194308,4,s,a)},useInsertionEffect:function(s,a){Zd(4,2,s,a)},useMemo:function(s,a){var c=sr();a=a===void 0?null:a;var f=s();if(ho){Kn(!0);try{s()}finally{Kn(!1)}}return c.memoizedState=[f,a],f},useReducer:function(s,a,c){var f=sr();if(c!==void 0){var _=c(a);if(ho){Kn(!0);try{c(a)}finally{Kn(!1)}}}else _=a;return f.memoizedState=f.baseState=_,s={pending:null,lanes:0,dispatch:null,lastRenderedReducer:s,lastRenderedState:_},f.queue=s,s=s.dispatch=MA.bind(null,rt,s),[f.memoizedState,s]},useRef:function(s){var a=sr();return s={current:s},a.memoizedState=s},useState:function(s){s=up(s);var a=s.queue,c=wb.bind(null,rt,a);return a.dispatch=c,[s.memoizedState,c]},useDebugValue:fp,useDeferredValue:function(s,a){var c=sr();return mp(c,s,a)},useTransition:function(){var s=up(!1);return s=yb.bind(null,rt,s.queue,!0,!1),sr().memoizedState=s,[!1,s]},useSyncExternalStore:function(s,a,c){var f=rt,_=sr();if(yt){if(c===void 0)throw Error(r(407));c=c()}else{if(c=a(),Ut===null)throw Error(r(349));(dt&127)!==0||G_(f,a,c)}_.memoizedState=c;var w={value:c,getSnapshot:a};return _.queue=w,lb(W_.bind(null,f,w,s),[s]),f.flags|=2048,pl(9,{destroy:void 0},Q_.bind(null,f,w,c,a),null),c},useId:function(){var s=sr(),a=Ut.identifierPrefix;if(yt){var c=Os,f=Ms;c=(f&~(1<<32-Tt(f)-1)).toString(32)+c,a="_"+a+"R_"+c,c=Wd++,0<c&&(a+="H"+c.toString(32)),a+="_"}else c=TA++,a="_"+a+"r_"+c.toString(32)+"_";return s.memoizedState=a},useHostTransitionStatus:gp,useFormState:rb,useActionState:rb,useOptimistic:function(s){var a=sr();a.memoizedState=a.baseState=s;var c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return a.queue=c,a=yp.bind(null,rt,!0,c),c.dispatch=a,[s,a]},useMemoCache:op,useCacheRefresh:function(){return sr().memoizedState=DA.bind(null,rt)},useEffectEvent:function(s){var a=sr(),c={impl:s};return a.memoizedState=c,function(){if((jt&2)!==0)throw Error(r(440));return c.impl.apply(void 0,arguments)}}},_p={readContext:Bn,use:Yd,useCallback:mb,useContext:Bn,useEffect:hp,useImperativeHandle:fb,useInsertionEffect:ub,useLayoutEffect:db,useMemo:pb,useReducer:Xd,useRef:ob,useState:function(){return Xd(ri)},useDebugValue:fp,useDeferredValue:function(s,a){var c=on();return gb(c,Nt.memoizedState,s,a)},useTransition:function(){var s=Xd(ri)[0],a=on().memoizedState;return[typeof s=="boolean"?s:Wc(s),a]},useSyncExternalStore:H_,useId:vb,useHostTransitionStatus:gp,useFormState:sb,useActionState:sb,useOptimistic:function(s,a){var c=on();return X_(c,Nt,s,a)},useMemoCache:op,useCacheRefresh:xb};_p.useEffectEvent=cb;var Tb={readContext:Bn,use:Yd,useCallback:mb,useContext:Bn,useEffect:hp,useImperativeHandle:fb,useInsertionEffect:ub,useLayoutEffect:db,useMemo:pb,useReducer:cp,useRef:ob,useState:function(){return cp(ri)},useDebugValue:fp,useDeferredValue:function(s,a){var c=on();return Nt===null?mp(c,s,a):gb(c,Nt.memoizedState,s,a)},useTransition:function(){var s=cp(ri)[0],a=on().memoizedState;return[typeof s=="boolean"?s:Wc(s),a]},useSyncExternalStore:H_,useId:vb,useHostTransitionStatus:gp,useFormState:ab,useActionState:ab,useOptimistic:function(s,a){var c=on();return Nt!==null?X_(c,Nt,s,a):(c.baseState=s,[s,c.queue.dispatch])},useMemoCache:op,useCacheRefresh:xb};Tb.useEffectEvent=cb;function bp(s,a,c,f){a=s.memoizedState,c=c(f,a),c=c==null?a:g({},a,c),s.memoizedState=c,s.lanes===0&&(s.updateQueue.baseState=c)}var vp={enqueueSetState:function(s,a,c){s=s._reactInternals;var f=Ar(),_=$i(f);_.payload=a,c!=null&&(_.callback=c),a=qi(s,_,f),a!==null&&(hr(a,s,f),qc(a,s,f))},enqueueReplaceState:function(s,a,c){s=s._reactInternals;var f=Ar(),_=$i(f);_.tag=1,_.payload=a,c!=null&&(_.callback=c),a=qi(s,_,f),a!==null&&(hr(a,s,f),qc(a,s,f))},enqueueForceUpdate:function(s,a){s=s._reactInternals;var c=Ar(),f=$i(c);f.tag=2,a!=null&&(f.callback=a),a=qi(s,f,c),a!==null&&(hr(a,s,c),qc(a,s,c))}};function Ab(s,a,c,f,_,w,z){return s=s.stateNode,typeof s.shouldComponentUpdate=="function"?s.shouldComponentUpdate(f,w,z):a.prototype&&a.prototype.isPureReactComponent?!Pc(c,f)||!Pc(_,w):!0}function jb(s,a,c,f){s=a.state,typeof a.componentWillReceiveProps=="function"&&a.componentWillReceiveProps(c,f),typeof a.UNSAFE_componentWillReceiveProps=="function"&&a.UNSAFE_componentWillReceiveProps(c,f),a.state!==s&&vp.enqueueReplaceState(a,a.state,null)}function fo(s,a){var c=a;if("ref"in a){c={};for(var f in a)f!=="ref"&&(c[f]=a[f])}if(s=s.defaultProps){c===a&&(c=g({},c));for(var _ in s)c[_]===void 0&&(c[_]=s[_])}return c}function Rb(s){Dd(s)}function Ib(s){console.error(s)}function kb(s){Dd(s)}function th(s,a){try{var c=s.onUncaughtError;c(a.value,{componentStack:a.stack})}catch(f){setTimeout(function(){throw f})}}function Db(s,a,c){try{var f=s.onCaughtError;f(c.value,{componentStack:c.stack,errorBoundary:a.tag===1?a.stateNode:null})}catch(_){setTimeout(function(){throw _})}}function xp(s,a,c){return c=$i(c),c.tag=3,c.payload={element:null},c.callback=function(){th(s,a)},c}function Mb(s){return s=$i(s),s.tag=3,s}function Ob(s,a,c,f){var _=c.type.getDerivedStateFromError;if(typeof _=="function"){var w=f.value;s.payload=function(){return _(w)},s.callback=function(){Db(a,c,f)}}var z=c.stateNode;z!==null&&typeof z.componentDidCatch=="function"&&(s.callback=function(){Db(a,c,f),typeof _!="function"&&(Yi===null?Yi=new Set([this]):Yi.add(this));var Q=f.stack;this.componentDidCatch(f.value,{componentStack:Q!==null?Q:""})})}function OA(s,a,c,f,_){if(c.flags|=32768,f!==null&&typeof f=="object"&&typeof f.then=="function"){if(a=c.alternate,a!==null&&ol(a,c,_,!0),c=Sr.current,c!==null){switch(c.tag){case 31:case 13:return Fr===null?fh():c.alternate===null&&rn===0&&(rn=3),c.flags&=-257,c.flags|=65536,c.lanes=_,f===Vd?c.flags|=16384:(a=c.updateQueue,a===null?c.updateQueue=new Set([f]):a.add(f),Gp(s,f,_)),!1;case 22:return c.flags|=65536,f===Vd?c.flags|=16384:(a=c.updateQueue,a===null?(a={transitions:null,markerInstances:null,retryQueue:new Set([f])},c.updateQueue=a):(c=a.retryQueue,c===null?a.retryQueue=new Set([f]):c.add(f)),Gp(s,f,_)),!1}throw Error(r(435,c.tag))}return Gp(s,f,_),fh(),!1}if(yt)return a=Sr.current,a!==null?((a.flags&65536)===0&&(a.flags|=256),a.flags|=65536,a.lanes=_,f!==Um&&(s=Error(r(422),{cause:f}),Lc(zr(s,c)))):(f!==Um&&(a=Error(r(423),{cause:f}),Lc(zr(a,c))),s=s.current.alternate,s.flags|=65536,_&=-_,s.lanes|=_,f=zr(f,c),_=xp(s.stateNode,f,_),Xm(s,_),rn!==4&&(rn=2)),!1;var w=Error(r(520),{cause:f});if(w=zr(w,c),su===null?su=[w]:su.push(w),rn!==4&&(rn=2),a===null)return!0;f=zr(f,c),c=a;do{switch(c.tag){case 3:return c.flags|=65536,s=_&-_,c.lanes|=s,s=xp(c.stateNode,f,s),Xm(c,s),!1;case 1:if(a=c.type,w=c.stateNode,(c.flags&128)===0&&(typeof a.getDerivedStateFromError=="function"||w!==null&&typeof w.componentDidCatch=="function"&&(Yi===null||!Yi.has(w))))return c.flags|=65536,_&=-_,c.lanes|=_,_=Mb(_),Ob(_,s,c,f),Xm(c,_),!1}c=c.return}while(c!==null);return!1}var wp=Error(r(461)),yn=!1;function Ln(s,a,c,f){a.child=s===null?B_(a,null,c,f):uo(a,s.child,c,f)}function Nb(s,a,c,f,_){c=c.render;var w=a.ref;if("ref"in f){var z={};for(var Q in f)Q!=="ref"&&(z[Q]=f[Q])}else z=f;return ao(a),f=rp(s,a,c,z,w,_),Q=sp(),s!==null&&!yn?(ip(s,a,_),si(s,a,_)):(yt&&Q&&Bm(a),a.flags|=1,Ln(s,a,f,_),a.child)}function Pb(s,a,c,f,_){if(s===null){var w=c.type;return typeof w=="function"&&!Nm(w)&&w.defaultProps===void 0&&c.compare===null?(a.tag=15,a.type=w,zb(s,a,w,f,_)):(s=Pd(c.type,null,f,a,a.mode,_),s.ref=a.ref,s.return=a,a.child=s)}if(w=s.child,!Ip(s,_)){var z=w.memoizedProps;if(c=c.compare,c=c!==null?c:Pc,c(z,f)&&s.ref===a.ref)return si(s,a,_)}return a.flags|=1,s=Zs(w,f),s.ref=a.ref,s.return=a,a.child=s}function zb(s,a,c,f,_){if(s!==null){var w=s.memoizedProps;if(Pc(w,f)&&s.ref===a.ref)if(yn=!1,a.pendingProps=f=w,Ip(s,_))(s.flags&131072)!==0&&(yn=!0);else return a.lanes=s.lanes,si(s,a,_)}return Sp(s,a,c,f,_)}function Bb(s,a,c,f){var _=f.children,w=s!==null?s.memoizedState:null;if(s===null&&a.stateNode===null&&(a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),f.mode==="hidden"){if((a.flags&128)!==0){if(w=w!==null?w.baseLanes|c:c,s!==null){for(f=a.child=s.child,_=0;f!==null;)_=_|f.lanes|f.childLanes,f=f.sibling;f=_&~w}else f=0,a.child=null;return Lb(s,a,w,c,f)}if((c&536870912)!==0)a.memoizedState={baseLanes:0,cachePool:null},s!==null&&Ud(a,w!==null?w.cachePool:null),w!==null?F_(a,w):Jm(),V_(a);else return f=a.lanes=536870912,Lb(s,a,w!==null?w.baseLanes|c:c,c,f)}else w!==null?(Ud(a,w.cachePool),F_(a,w),Gi(),a.memoizedState=null):(s!==null&&Ud(a,null),Jm(),Gi());return Ln(s,a,_,c),a.child}function Xc(s,a){return s!==null&&s.tag===22||a.stateNode!==null||(a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),a.sibling}function Lb(s,a,c,f,_){var w=Qm();return w=w===null?null:{parent:pn._currentValue,pool:w},a.memoizedState={baseLanes:c,cachePool:w},s!==null&&Ud(a,null),Jm(),V_(a),s!==null&&ol(s,a,f,!0),a.childLanes=_,null}function nh(s,a){return a=sh({mode:a.mode,children:a.children},s.mode),a.ref=s.ref,s.child=a,a.return=s,a}function Ub(s,a,c){return uo(a,s.child,null,c),s=nh(a,a.pendingProps),s.flags|=2,Cr(a),a.memoizedState=null,s}function NA(s,a,c){var f=a.pendingProps,_=(a.flags&128)!==0;if(a.flags&=-129,s===null){if(yt){if(f.mode==="hidden")return s=nh(a,f),a.lanes=536870912,Xc(null,s);if(tp(a),(s=qt)?(s=Zv(s,Ur),s=s!==null&&s.data==="&"?s:null,s!==null&&(a.memoizedState={dehydrated:s,treeContext:Bi!==null?{id:Ms,overflow:Os}:null,retryLane:536870912,hydrationErrors:null},c=S_(s),c.return=a,a.child=c,zn=a,qt=null)):s=null,s===null)throw Ui(a);return a.lanes=536870912,null}return nh(a,f)}var w=s.memoizedState;if(w!==null){var z=w.dehydrated;if(tp(a),_)if(a.flags&256)a.flags&=-257,a=Ub(s,a,c);else if(a.memoizedState!==null)a.child=s.child,a.flags|=128,a=null;else throw Error(r(558));else if(yn||ol(s,a,c,!1),_=(c&s.childLanes)!==0,yn||_){if(f=Ut,f!==null&&(z=_c(f,c),z!==0&&z!==w.retryLane))throw w.retryLane=z,no(s,z),hr(f,s,z),wp;fh(),a=Ub(s,a,c)}else s=w.treeContext,qt=Vr(z.nextSibling),zn=a,yt=!0,Li=null,Ur=!1,s!==null&&T_(a,s),a=nh(a,f),a.flags|=4096;return a}return s=Zs(s.child,{mode:f.mode,children:f.children}),s.ref=a.ref,a.child=s,s.return=a,s}function rh(s,a){var c=a.ref;if(c===null)s!==null&&s.ref!==null&&(a.flags|=4194816);else{if(typeof c!="function"&&typeof c!="object")throw Error(r(284));(s===null||s.ref!==c)&&(a.flags|=4194816)}}function Sp(s,a,c,f,_){return ao(a),c=rp(s,a,c,f,void 0,_),f=sp(),s!==null&&!yn?(ip(s,a,_),si(s,a,_)):(yt&&f&&Bm(a),a.flags|=1,Ln(s,a,c,_),a.child)}function Fb(s,a,c,f,_,w){return ao(a),a.updateQueue=null,c=q_(a,f,c,_),$_(s),f=sp(),s!==null&&!yn?(ip(s,a,w),si(s,a,w)):(yt&&f&&Bm(a),a.flags|=1,Ln(s,a,c,w),a.child)}function Vb(s,a,c,f,_){if(ao(a),a.stateNode===null){var w=rl,z=c.contextType;typeof z=="object"&&z!==null&&(w=Bn(z)),w=new c(f,w),a.memoizedState=w.state!==null&&w.state!==void 0?w.state:null,w.updater=vp,a.stateNode=w,w._reactInternals=a,w=a.stateNode,w.props=f,w.state=a.memoizedState,w.refs={},Km(a),z=c.contextType,w.context=typeof z=="object"&&z!==null?Bn(z):rl,w.state=a.memoizedState,z=c.getDerivedStateFromProps,typeof z=="function"&&(bp(a,c,z,f),w.state=a.memoizedState),typeof c.getDerivedStateFromProps=="function"||typeof w.getSnapshotBeforeUpdate=="function"||typeof w.UNSAFE_componentWillMount!="function"&&typeof w.componentWillMount!="function"||(z=w.state,typeof w.componentWillMount=="function"&&w.componentWillMount(),typeof w.UNSAFE_componentWillMount=="function"&&w.UNSAFE_componentWillMount(),z!==w.state&&vp.enqueueReplaceState(w,w.state,null),Gc(a,f,w,_),Hc(),w.state=a.memoizedState),typeof w.componentDidMount=="function"&&(a.flags|=4194308),f=!0}else if(s===null){w=a.stateNode;var Q=a.memoizedProps,re=fo(c,Q);w.props=re;var ge=w.context,Ee=c.contextType;z=rl,typeof Ee=="object"&&Ee!==null&&(z=Bn(Ee));var Re=c.getDerivedStateFromProps;Ee=typeof Re=="function"||typeof w.getSnapshotBeforeUpdate=="function",Q=a.pendingProps!==Q,Ee||typeof w.UNSAFE_componentWillReceiveProps!="function"&&typeof w.componentWillReceiveProps!="function"||(Q||ge!==z)&&jb(a,w,f,z),Vi=!1;var _e=a.memoizedState;w.state=_e,Gc(a,f,w,_),Hc(),ge=a.memoizedState,Q||_e!==ge||Vi?(typeof Re=="function"&&(bp(a,c,Re,f),ge=a.memoizedState),(re=Vi||Ab(a,c,re,f,_e,ge,z))?(Ee||typeof w.UNSAFE_componentWillMount!="function"&&typeof w.componentWillMount!="function"||(typeof w.componentWillMount=="function"&&w.componentWillMount(),typeof w.UNSAFE_componentWillMount=="function"&&w.UNSAFE_componentWillMount()),typeof w.componentDidMount=="function"&&(a.flags|=4194308)):(typeof w.componentDidMount=="function"&&(a.flags|=4194308),a.memoizedProps=f,a.memoizedState=ge),w.props=f,w.state=ge,w.context=z,f=re):(typeof w.componentDidMount=="function"&&(a.flags|=4194308),f=!1)}else{w=a.stateNode,Ym(s,a),z=a.memoizedProps,Ee=fo(c,z),w.props=Ee,Re=a.pendingProps,_e=w.context,ge=c.contextType,re=rl,typeof ge=="object"&&ge!==null&&(re=Bn(ge)),Q=c.getDerivedStateFromProps,(ge=typeof Q=="function"||typeof w.getSnapshotBeforeUpdate=="function")||typeof w.UNSAFE_componentWillReceiveProps!="function"&&typeof w.componentWillReceiveProps!="function"||(z!==Re||_e!==re)&&jb(a,w,f,re),Vi=!1,_e=a.memoizedState,w.state=_e,Gc(a,f,w,_),Hc();var we=a.memoizedState;z!==Re||_e!==we||Vi||s!==null&&s.dependencies!==null&&Bd(s.dependencies)?(typeof Q=="function"&&(bp(a,c,Q,f),we=a.memoizedState),(Ee=Vi||Ab(a,c,Ee,f,_e,we,re)||s!==null&&s.dependencies!==null&&Bd(s.dependencies))?(ge||typeof w.UNSAFE_componentWillUpdate!="function"&&typeof w.componentWillUpdate!="function"||(typeof w.componentWillUpdate=="function"&&w.componentWillUpdate(f,we,re),typeof w.UNSAFE_componentWillUpdate=="function"&&w.UNSAFE_componentWillUpdate(f,we,re)),typeof w.componentDidUpdate=="function"&&(a.flags|=4),typeof w.getSnapshotBeforeUpdate=="function"&&(a.flags|=1024)):(typeof w.componentDidUpdate!="function"||z===s.memoizedProps&&_e===s.memoizedState||(a.flags|=4),typeof w.getSnapshotBeforeUpdate!="function"||z===s.memoizedProps&&_e===s.memoizedState||(a.flags|=1024),a.memoizedProps=f,a.memoizedState=we),w.props=f,w.state=we,w.context=re,f=Ee):(typeof w.componentDidUpdate!="function"||z===s.memoizedProps&&_e===s.memoizedState||(a.flags|=4),typeof w.getSnapshotBeforeUpdate!="function"||z===s.memoizedProps&&_e===s.memoizedState||(a.flags|=1024),f=!1)}return w=f,rh(s,a),f=(a.flags&128)!==0,w||f?(w=a.stateNode,c=f&&typeof c.getDerivedStateFromError!="function"?null:w.render(),a.flags|=1,s!==null&&f?(a.child=uo(a,s.child,null,_),a.child=uo(a,null,c,_)):Ln(s,a,c,_),a.memoizedState=w.state,s=a.child):s=si(s,a,_),s}function $b(s,a,c,f){return so(),a.flags|=256,Ln(s,a,c,f),a.child}var Cp={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Ep(s){return{baseLanes:s,cachePool:D_()}}function Tp(s,a,c){return s=s!==null?s.childLanes&~c:0,a&&(s|=Tr),s}function qb(s,a,c){var f=a.pendingProps,_=!1,w=(a.flags&128)!==0,z;if((z=w)||(z=s!==null&&s.memoizedState===null?!1:(an.current&2)!==0),z&&(_=!0,a.flags&=-129),z=(a.flags&32)!==0,a.flags&=-33,s===null){if(yt){if(_?Hi(a):Gi(),(s=qt)?(s=Zv(s,Ur),s=s!==null&&s.data!=="&"?s:null,s!==null&&(a.memoizedState={dehydrated:s,treeContext:Bi!==null?{id:Ms,overflow:Os}:null,retryLane:536870912,hydrationErrors:null},c=S_(s),c.return=a,a.child=c,zn=a,qt=null)):s=null,s===null)throw Ui(a);return lg(s)?a.lanes=32:a.lanes=536870912,null}var Q=f.children;return f=f.fallback,_?(Gi(),_=a.mode,Q=sh({mode:"hidden",children:Q},_),f=ro(f,_,c,null),Q.return=a,f.return=a,Q.sibling=f,a.child=Q,f=a.child,f.memoizedState=Ep(c),f.childLanes=Tp(s,z,c),a.memoizedState=Cp,Xc(null,f)):(Hi(a),Ap(a,Q))}var re=s.memoizedState;if(re!==null&&(Q=re.dehydrated,Q!==null)){if(w)a.flags&256?(Hi(a),a.flags&=-257,a=jp(s,a,c)):a.memoizedState!==null?(Gi(),a.child=s.child,a.flags|=128,a=null):(Gi(),Q=f.fallback,_=a.mode,f=sh({mode:"visible",children:f.children},_),Q=ro(Q,_,c,null),Q.flags|=2,f.return=a,Q.return=a,f.sibling=Q,a.child=f,uo(a,s.child,null,c),f=a.child,f.memoizedState=Ep(c),f.childLanes=Tp(s,z,c),a.memoizedState=Cp,a=Xc(null,f));else if(Hi(a),lg(Q)){if(z=Q.nextSibling&&Q.nextSibling.dataset,z)var ge=z.dgst;z=ge,f=Error(r(419)),f.stack="",f.digest=z,Lc({value:f,source:null,stack:null}),a=jp(s,a,c)}else if(yn||ol(s,a,c,!1),z=(c&s.childLanes)!==0,yn||z){if(z=Ut,z!==null&&(f=_c(z,c),f!==0&&f!==re.retryLane))throw re.retryLane=f,no(s,f),hr(z,s,f),wp;og(Q)||fh(),a=jp(s,a,c)}else og(Q)?(a.flags|=192,a.child=s.child,a=null):(s=re.treeContext,qt=Vr(Q.nextSibling),zn=a,yt=!0,Li=null,Ur=!1,s!==null&&T_(a,s),a=Ap(a,f.children),a.flags|=4096);return a}return _?(Gi(),Q=f.fallback,_=a.mode,re=s.child,ge=re.sibling,f=Zs(re,{mode:"hidden",children:f.children}),f.subtreeFlags=re.subtreeFlags&65011712,ge!==null?Q=Zs(ge,Q):(Q=ro(Q,_,c,null),Q.flags|=2),Q.return=a,f.return=a,f.sibling=Q,a.child=f,Xc(null,f),f=a.child,Q=s.child.memoizedState,Q===null?Q=Ep(c):(_=Q.cachePool,_!==null?(re=pn._currentValue,_=_.parent!==re?{parent:re,pool:re}:_):_=D_(),Q={baseLanes:Q.baseLanes|c,cachePool:_}),f.memoizedState=Q,f.childLanes=Tp(s,z,c),a.memoizedState=Cp,Xc(s.child,f)):(Hi(a),c=s.child,s=c.sibling,c=Zs(c,{mode:"visible",children:f.children}),c.return=a,c.sibling=null,s!==null&&(z=a.deletions,z===null?(a.deletions=[s],a.flags|=16):z.push(s)),a.child=c,a.memoizedState=null,c)}function Ap(s,a){return a=sh({mode:"visible",children:a},s.mode),a.return=s,s.child=a}function sh(s,a){return s=wr(22,s,null,a),s.lanes=0,s}function jp(s,a,c){return uo(a,s.child,null,c),s=Ap(a,a.pendingProps.children),s.flags|=2,a.memoizedState=null,s}function Hb(s,a,c){s.lanes|=a;var f=s.alternate;f!==null&&(f.lanes|=a),$m(s.return,a,c)}function Rp(s,a,c,f,_,w){var z=s.memoizedState;z===null?s.memoizedState={isBackwards:a,rendering:null,renderingStartTime:0,last:f,tail:c,tailMode:_,treeForkCount:w}:(z.isBackwards=a,z.rendering=null,z.renderingStartTime=0,z.last=f,z.tail=c,z.tailMode=_,z.treeForkCount=w)}function Gb(s,a,c){var f=a.pendingProps,_=f.revealOrder,w=f.tail;f=f.children;var z=an.current,Q=(z&2)!==0;if(Q?(z=z&1|2,a.flags|=128):z&=1,ne(an,z),Ln(s,a,f,c),f=yt?Bc:0,!Q&&s!==null&&(s.flags&128)!==0)e:for(s=a.child;s!==null;){if(s.tag===13)s.memoizedState!==null&&Hb(s,c,a);else if(s.tag===19)Hb(s,c,a);else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===a)break e;for(;s.sibling===null;){if(s.return===null||s.return===a)break e;s=s.return}s.sibling.return=s.return,s=s.sibling}switch(_){case"forwards":for(c=a.child,_=null;c!==null;)s=c.alternate,s!==null&&Gd(s)===null&&(_=c),c=c.sibling;c=_,c===null?(_=a.child,a.child=null):(_=c.sibling,c.sibling=null),Rp(a,!1,_,c,w,f);break;case"backwards":case"unstable_legacy-backwards":for(c=null,_=a.child,a.child=null;_!==null;){if(s=_.alternate,s!==null&&Gd(s)===null){a.child=_;break}s=_.sibling,_.sibling=c,c=_,_=s}Rp(a,!0,c,null,w,f);break;case"together":Rp(a,!1,null,null,void 0,f);break;default:a.memoizedState=null}return a.child}function si(s,a,c){if(s!==null&&(a.dependencies=s.dependencies),Ki|=a.lanes,(c&a.childLanes)===0)if(s!==null){if(ol(s,a,c,!1),(c&a.childLanes)===0)return null}else return null;if(s!==null&&a.child!==s.child)throw Error(r(153));if(a.child!==null){for(s=a.child,c=Zs(s,s.pendingProps),a.child=c,c.return=a;s.sibling!==null;)s=s.sibling,c=c.sibling=Zs(s,s.pendingProps),c.return=a;c.sibling=null}return a.child}function Ip(s,a){return(s.lanes&a)!==0?!0:(s=s.dependencies,!!(s!==null&&Bd(s)))}function PA(s,a,c){switch(a.tag){case 3:ce(a,a.stateNode.containerInfo),Fi(a,pn,s.memoizedState.cache),so();break;case 27:case 5:ze(a);break;case 4:ce(a,a.stateNode.containerInfo);break;case 10:Fi(a,a.type,a.memoizedProps.value);break;case 31:if(a.memoizedState!==null)return a.flags|=128,tp(a),null;break;case 13:var f=a.memoizedState;if(f!==null)return f.dehydrated!==null?(Hi(a),a.flags|=128,null):(c&a.child.childLanes)!==0?qb(s,a,c):(Hi(a),s=si(s,a,c),s!==null?s.sibling:null);Hi(a);break;case 19:var _=(s.flags&128)!==0;if(f=(c&a.childLanes)!==0,f||(ol(s,a,c,!1),f=(c&a.childLanes)!==0),_){if(f)return Gb(s,a,c);a.flags|=128}if(_=a.memoizedState,_!==null&&(_.rendering=null,_.tail=null,_.lastEffect=null),ne(an,an.current),f)break;return null;case 22:return a.lanes=0,Bb(s,a,c,a.pendingProps);case 24:Fi(a,pn,s.memoizedState.cache)}return si(s,a,c)}function Qb(s,a,c){if(s!==null)if(s.memoizedProps!==a.pendingProps)yn=!0;else{if(!Ip(s,c)&&(a.flags&128)===0)return yn=!1,PA(s,a,c);yn=(s.flags&131072)!==0}else yn=!1,yt&&(a.flags&1048576)!==0&&E_(a,Bc,a.index);switch(a.lanes=0,a.tag){case 16:e:{var f=a.pendingProps;if(s=lo(a.elementType),a.type=s,typeof s=="function")Nm(s)?(f=fo(s,f),a.tag=1,a=Vb(null,a,s,f,c)):(a.tag=0,a=Sp(null,a,s,f,c));else{if(s!=null){var _=s.$$typeof;if(_===D){a.tag=11,a=Nb(null,a,s,f,c);break e}else if(_===k){a.tag=14,a=Pb(null,a,s,f,c);break e}}throw a=O(s)||s,Error(r(306,a,""))}}return a;case 0:return Sp(s,a,a.type,a.pendingProps,c);case 1:return f=a.type,_=fo(f,a.pendingProps),Vb(s,a,f,_,c);case 3:e:{if(ce(a,a.stateNode.containerInfo),s===null)throw Error(r(387));f=a.pendingProps;var w=a.memoizedState;_=w.element,Ym(s,a),Gc(a,f,null,c);var z=a.memoizedState;if(f=z.cache,Fi(a,pn,f),f!==w.cache&&qm(a,[pn],c,!0),Hc(),f=z.element,w.isDehydrated)if(w={element:f,isDehydrated:!1,cache:z.cache},a.updateQueue.baseState=w,a.memoizedState=w,a.flags&256){a=$b(s,a,f,c);break e}else if(f!==_){_=zr(Error(r(424)),a),Lc(_),a=$b(s,a,f,c);break e}else for(s=a.stateNode.containerInfo,s.nodeType===9?s=s.body:s=s.nodeName==="HTML"?s.ownerDocument.body:s,qt=Vr(s.firstChild),zn=a,yt=!0,Li=null,Ur=!0,c=B_(a,null,f,c),a.child=c;c;)c.flags=c.flags&-3|4096,c=c.sibling;else{if(so(),f===_){a=si(s,a,c);break e}Ln(s,a,f,c)}a=a.child}return a;case 26:return rh(s,a),s===null?(c=sx(a.type,null,a.pendingProps,null))?a.memoizedState=c:yt||(c=a.type,s=a.pendingProps,f=vh(ue.current).createElement(c),f[hn]=a,f[In]=s,Un(f,c,s),fn(f),a.stateNode=f):a.memoizedState=sx(a.type,s.memoizedProps,a.pendingProps,s.memoizedState),null;case 27:return ze(a),s===null&&yt&&(f=a.stateNode=tx(a.type,a.pendingProps,ue.current),zn=a,Ur=!0,_=qt,ea(a.type)?(cg=_,qt=Vr(f.firstChild)):qt=_),Ln(s,a,a.pendingProps.children,c),rh(s,a),s===null&&(a.flags|=4194304),a.child;case 5:return s===null&&yt&&((_=f=qt)&&(f=h2(f,a.type,a.pendingProps,Ur),f!==null?(a.stateNode=f,zn=a,qt=Vr(f.firstChild),Ur=!1,_=!0):_=!1),_||Ui(a)),ze(a),_=a.type,w=a.pendingProps,z=s!==null?s.memoizedProps:null,f=w.children,sg(_,w)?f=null:z!==null&&sg(_,z)&&(a.flags|=32),a.memoizedState!==null&&(_=rp(s,a,AA,null,null,c),hu._currentValue=_),rh(s,a),Ln(s,a,f,c),a.child;case 6:return s===null&&yt&&((s=c=qt)&&(c=f2(c,a.pendingProps,Ur),c!==null?(a.stateNode=c,zn=a,qt=null,s=!0):s=!1),s||Ui(a)),null;case 13:return qb(s,a,c);case 4:return ce(a,a.stateNode.containerInfo),f=a.pendingProps,s===null?a.child=uo(a,null,f,c):Ln(s,a,f,c),a.child;case 11:return Nb(s,a,a.type,a.pendingProps,c);case 7:return Ln(s,a,a.pendingProps,c),a.child;case 8:return Ln(s,a,a.pendingProps.children,c),a.child;case 12:return Ln(s,a,a.pendingProps.children,c),a.child;case 10:return f=a.pendingProps,Fi(a,a.type,f.value),Ln(s,a,f.children,c),a.child;case 9:return _=a.type._context,f=a.pendingProps.children,ao(a),_=Bn(_),f=f(_),a.flags|=1,Ln(s,a,f,c),a.child;case 14:return Pb(s,a,a.type,a.pendingProps,c);case 15:return zb(s,a,a.type,a.pendingProps,c);case 19:return Gb(s,a,c);case 31:return NA(s,a,c);case 22:return Bb(s,a,c,a.pendingProps);case 24:return ao(a),f=Bn(pn),s===null?(_=Qm(),_===null&&(_=Ut,w=Hm(),_.pooledCache=w,w.refCount++,w!==null&&(_.pooledCacheLanes|=c),_=w),a.memoizedState={parent:f,cache:_},Km(a),Fi(a,pn,_)):((s.lanes&c)!==0&&(Ym(s,a),Gc(a,null,null,c),Hc()),_=s.memoizedState,w=a.memoizedState,_.parent!==f?(_={parent:f,cache:f},a.memoizedState=_,a.lanes===0&&(a.memoizedState=a.updateQueue.baseState=_),Fi(a,pn,f)):(f=w.cache,Fi(a,pn,f),f!==_.cache&&qm(a,[pn],c,!0))),Ln(s,a,a.pendingProps.children,c),a.child;case 29:throw a.pendingProps}throw Error(r(156,a.tag))}function ii(s){s.flags|=4}function kp(s,a,c,f,_){if((a=(s.mode&32)!==0)&&(a=!1),a){if(s.flags|=16777216,(_&335544128)===_)if(s.stateNode.complete)s.flags|=8192;else if(vv())s.flags|=8192;else throw co=Vd,Wm}else s.flags&=-16777217}function Wb(s,a){if(a.type!=="stylesheet"||(a.state.loading&4)!==0)s.flags&=-16777217;else if(s.flags|=16777216,!cx(a))if(vv())s.flags|=8192;else throw co=Vd,Wm}function ih(s,a){a!==null&&(s.flags|=4),s.flags&16384&&(a=s.tag!==22?dd():536870912,s.lanes|=a,bl|=a)}function Zc(s,a){if(!yt)switch(s.tailMode){case"hidden":a=s.tail;for(var c=null;a!==null;)a.alternate!==null&&(c=a),a=a.sibling;c===null?s.tail=null:c.sibling=null;break;case"collapsed":c=s.tail;for(var f=null;c!==null;)c.alternate!==null&&(f=c),c=c.sibling;f===null?a||s.tail===null?s.tail=null:s.tail.sibling=null:f.sibling=null}}function Ht(s){var a=s.alternate!==null&&s.alternate.child===s.child,c=0,f=0;if(a)for(var _=s.child;_!==null;)c|=_.lanes|_.childLanes,f|=_.subtreeFlags&65011712,f|=_.flags&65011712,_.return=s,_=_.sibling;else for(_=s.child;_!==null;)c|=_.lanes|_.childLanes,f|=_.subtreeFlags,f|=_.flags,_.return=s,_=_.sibling;return s.subtreeFlags|=f,s.childLanes=c,a}function zA(s,a,c){var f=a.pendingProps;switch(Lm(a),a.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ht(a),null;case 1:return Ht(a),null;case 3:return c=a.stateNode,f=null,s!==null&&(f=s.memoizedState.cache),a.memoizedState.cache!==f&&(a.flags|=2048),ti(pn),be(),c.pendingContext&&(c.context=c.pendingContext,c.pendingContext=null),(s===null||s.child===null)&&(al(a)?ii(a):s===null||s.memoizedState.isDehydrated&&(a.flags&256)===0||(a.flags|=1024,Fm())),Ht(a),null;case 26:var _=a.type,w=a.memoizedState;return s===null?(ii(a),w!==null?(Ht(a),Wb(a,w)):(Ht(a),kp(a,_,null,f,c))):w?w!==s.memoizedState?(ii(a),Ht(a),Wb(a,w)):(Ht(a),a.flags&=-16777217):(s=s.memoizedProps,s!==f&&ii(a),Ht(a),kp(a,_,s,f,c)),null;case 27:if(Pe(a),c=ue.current,_=a.type,s!==null&&a.stateNode!=null)s.memoizedProps!==f&&ii(a);else{if(!f){if(a.stateNode===null)throw Error(r(166));return Ht(a),null}s=ie.current,al(a)?A_(a):(s=tx(_,f,c),a.stateNode=s,ii(a))}return Ht(a),null;case 5:if(Pe(a),_=a.type,s!==null&&a.stateNode!=null)s.memoizedProps!==f&&ii(a);else{if(!f){if(a.stateNode===null)throw Error(r(166));return Ht(a),null}if(w=ie.current,al(a))A_(a);else{var z=vh(ue.current);switch(w){case 1:w=z.createElementNS("http://www.w3.org/2000/svg",_);break;case 2:w=z.createElementNS("http://www.w3.org/1998/Math/MathML",_);break;default:switch(_){case"svg":w=z.createElementNS("http://www.w3.org/2000/svg",_);break;case"math":w=z.createElementNS("http://www.w3.org/1998/Math/MathML",_);break;case"script":w=z.createElement("div"),w.innerHTML="<script><\/script>",w=w.removeChild(w.firstChild);break;case"select":w=typeof f.is=="string"?z.createElement("select",{is:f.is}):z.createElement("select"),f.multiple?w.multiple=!0:f.size&&(w.size=f.size);break;default:w=typeof f.is=="string"?z.createElement(_,{is:f.is}):z.createElement(_)}}w[hn]=a,w[In]=f;e:for(z=a.child;z!==null;){if(z.tag===5||z.tag===6)w.appendChild(z.stateNode);else if(z.tag!==4&&z.tag!==27&&z.child!==null){z.child.return=z,z=z.child;continue}if(z===a)break e;for(;z.sibling===null;){if(z.return===null||z.return===a)break e;z=z.return}z.sibling.return=z.return,z=z.sibling}a.stateNode=w;e:switch(Un(w,_,f),_){case"button":case"input":case"select":case"textarea":f=!!f.autoFocus;break e;case"img":f=!0;break e;default:f=!1}f&&ii(a)}}return Ht(a),kp(a,a.type,s===null?null:s.memoizedProps,a.pendingProps,c),null;case 6:if(s&&a.stateNode!=null)s.memoizedProps!==f&&ii(a);else{if(typeof f!="string"&&a.stateNode===null)throw Error(r(166));if(s=ue.current,al(a)){if(s=a.stateNode,c=a.memoizedProps,f=null,_=zn,_!==null)switch(_.tag){case 27:case 5:f=_.memoizedProps}s[hn]=a,s=!!(s.nodeValue===c||f!==null&&f.suppressHydrationWarning===!0||qv(s.nodeValue,c)),s||Ui(a,!0)}else s=vh(s).createTextNode(f),s[hn]=a,a.stateNode=s}return Ht(a),null;case 31:if(c=a.memoizedState,s===null||s.memoizedState!==null){if(f=al(a),c!==null){if(s===null){if(!f)throw Error(r(318));if(s=a.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(r(557));s[hn]=a}else so(),(a.flags&128)===0&&(a.memoizedState=null),a.flags|=4;Ht(a),s=!1}else c=Fm(),s!==null&&s.memoizedState!==null&&(s.memoizedState.hydrationErrors=c),s=!0;if(!s)return a.flags&256?(Cr(a),a):(Cr(a),null);if((a.flags&128)!==0)throw Error(r(558))}return Ht(a),null;case 13:if(f=a.memoizedState,s===null||s.memoizedState!==null&&s.memoizedState.dehydrated!==null){if(_=al(a),f!==null&&f.dehydrated!==null){if(s===null){if(!_)throw Error(r(318));if(_=a.memoizedState,_=_!==null?_.dehydrated:null,!_)throw Error(r(317));_[hn]=a}else so(),(a.flags&128)===0&&(a.memoizedState=null),a.flags|=4;Ht(a),_=!1}else _=Fm(),s!==null&&s.memoizedState!==null&&(s.memoizedState.hydrationErrors=_),_=!0;if(!_)return a.flags&256?(Cr(a),a):(Cr(a),null)}return Cr(a),(a.flags&128)!==0?(a.lanes=c,a):(c=f!==null,s=s!==null&&s.memoizedState!==null,c&&(f=a.child,_=null,f.alternate!==null&&f.alternate.memoizedState!==null&&f.alternate.memoizedState.cachePool!==null&&(_=f.alternate.memoizedState.cachePool.pool),w=null,f.memoizedState!==null&&f.memoizedState.cachePool!==null&&(w=f.memoizedState.cachePool.pool),w!==_&&(f.flags|=2048)),c!==s&&c&&(a.child.flags|=8192),ih(a,a.updateQueue),Ht(a),null);case 4:return be(),s===null&&Jp(a.stateNode.containerInfo),Ht(a),null;case 10:return ti(a.type),Ht(a),null;case 19:if(G(an),f=a.memoizedState,f===null)return Ht(a),null;if(_=(a.flags&128)!==0,w=f.rendering,w===null)if(_)Zc(f,!1);else{if(rn!==0||s!==null&&(s.flags&128)!==0)for(s=a.child;s!==null;){if(w=Gd(s),w!==null){for(a.flags|=128,Zc(f,!1),s=w.updateQueue,a.updateQueue=s,ih(a,s),a.subtreeFlags=0,s=c,c=a.child;c!==null;)w_(c,s),c=c.sibling;return ne(an,an.current&1|2),yt&&Js(a,f.treeForkCount),a.child}s=s.sibling}f.tail!==null&&Oe()>uh&&(a.flags|=128,_=!0,Zc(f,!1),a.lanes=4194304)}else{if(!_)if(s=Gd(w),s!==null){if(a.flags|=128,_=!0,s=s.updateQueue,a.updateQueue=s,ih(a,s),Zc(f,!0),f.tail===null&&f.tailMode==="hidden"&&!w.alternate&&!yt)return Ht(a),null}else 2*Oe()-f.renderingStartTime>uh&&c!==536870912&&(a.flags|=128,_=!0,Zc(f,!1),a.lanes=4194304);f.isBackwards?(w.sibling=a.child,a.child=w):(s=f.last,s!==null?s.sibling=w:a.child=w,f.last=w)}return f.tail!==null?(s=f.tail,f.rendering=s,f.tail=s.sibling,f.renderingStartTime=Oe(),s.sibling=null,c=an.current,ne(an,_?c&1|2:c&1),yt&&Js(a,f.treeForkCount),s):(Ht(a),null);case 22:case 23:return Cr(a),ep(),f=a.memoizedState!==null,s!==null?s.memoizedState!==null!==f&&(a.flags|=8192):f&&(a.flags|=8192),f?(c&536870912)!==0&&(a.flags&128)===0&&(Ht(a),a.subtreeFlags&6&&(a.flags|=8192)):Ht(a),c=a.updateQueue,c!==null&&ih(a,c.retryQueue),c=null,s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(c=s.memoizedState.cachePool.pool),f=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(f=a.memoizedState.cachePool.pool),f!==c&&(a.flags|=2048),s!==null&&G(oo),null;case 24:return c=null,s!==null&&(c=s.memoizedState.cache),a.memoizedState.cache!==c&&(a.flags|=2048),ti(pn),Ht(a),null;case 25:return null;case 30:return null}throw Error(r(156,a.tag))}function BA(s,a){switch(Lm(a),a.tag){case 1:return s=a.flags,s&65536?(a.flags=s&-65537|128,a):null;case 3:return ti(pn),be(),s=a.flags,(s&65536)!==0&&(s&128)===0?(a.flags=s&-65537|128,a):null;case 26:case 27:case 5:return Pe(a),null;case 31:if(a.memoizedState!==null){if(Cr(a),a.alternate===null)throw Error(r(340));so()}return s=a.flags,s&65536?(a.flags=s&-65537|128,a):null;case 13:if(Cr(a),s=a.memoizedState,s!==null&&s.dehydrated!==null){if(a.alternate===null)throw Error(r(340));so()}return s=a.flags,s&65536?(a.flags=s&-65537|128,a):null;case 19:return G(an),null;case 4:return be(),null;case 10:return ti(a.type),null;case 22:case 23:return Cr(a),ep(),s!==null&&G(oo),s=a.flags,s&65536?(a.flags=s&-65537|128,a):null;case 24:return ti(pn),null;case 25:return null;default:return null}}function Kb(s,a){switch(Lm(a),a.tag){case 3:ti(pn),be();break;case 26:case 27:case 5:Pe(a);break;case 4:be();break;case 31:a.memoizedState!==null&&Cr(a);break;case 13:Cr(a);break;case 19:G(an);break;case 10:ti(a.type);break;case 22:case 23:Cr(a),ep(),s!==null&&G(oo);break;case 24:ti(pn)}}function Jc(s,a){try{var c=a.updateQueue,f=c!==null?c.lastEffect:null;if(f!==null){var _=f.next;c=_;do{if((c.tag&s)===s){f=void 0;var w=c.create,z=c.inst;f=w(),z.destroy=f}c=c.next}while(c!==_)}}catch(Q){Mt(a,a.return,Q)}}function Qi(s,a,c){try{var f=a.updateQueue,_=f!==null?f.lastEffect:null;if(_!==null){var w=_.next;f=w;do{if((f.tag&s)===s){var z=f.inst,Q=z.destroy;if(Q!==void 0){z.destroy=void 0,_=a;var re=c,ge=Q;try{ge()}catch(Ee){Mt(_,re,Ee)}}}f=f.next}while(f!==w)}}catch(Ee){Mt(a,a.return,Ee)}}function Yb(s){var a=s.updateQueue;if(a!==null){var c=s.stateNode;try{U_(a,c)}catch(f){Mt(s,s.return,f)}}}function Xb(s,a,c){c.props=fo(s.type,s.memoizedProps),c.state=s.memoizedState;try{c.componentWillUnmount()}catch(f){Mt(s,a,f)}}function eu(s,a){try{var c=s.ref;if(c!==null){switch(s.tag){case 26:case 27:case 5:var f=s.stateNode;break;case 30:f=s.stateNode;break;default:f=s.stateNode}typeof c=="function"?s.refCleanup=c(f):c.current=f}}catch(_){Mt(s,a,_)}}function Ns(s,a){var c=s.ref,f=s.refCleanup;if(c!==null)if(typeof f=="function")try{f()}catch(_){Mt(s,a,_)}finally{s.refCleanup=null,s=s.alternate,s!=null&&(s.refCleanup=null)}else if(typeof c=="function")try{c(null)}catch(_){Mt(s,a,_)}else c.current=null}function Zb(s){var a=s.type,c=s.memoizedProps,f=s.stateNode;try{e:switch(a){case"button":case"input":case"select":case"textarea":c.autoFocus&&f.focus();break e;case"img":c.src?f.src=c.src:c.srcSet&&(f.srcset=c.srcSet)}}catch(_){Mt(s,s.return,_)}}function Dp(s,a,c){try{var f=s.stateNode;a2(f,s.type,c,a),f[In]=a}catch(_){Mt(s,s.return,_)}}function Jb(s){return s.tag===5||s.tag===3||s.tag===26||s.tag===27&&ea(s.type)||s.tag===4}function Mp(s){e:for(;;){for(;s.sibling===null;){if(s.return===null||Jb(s.return))return null;s=s.return}for(s.sibling.return=s.return,s=s.sibling;s.tag!==5&&s.tag!==6&&s.tag!==18;){if(s.tag===27&&ea(s.type)||s.flags&2||s.child===null||s.tag===4)continue e;s.child.return=s,s=s.child}if(!(s.flags&2))return s.stateNode}}function Op(s,a,c){var f=s.tag;if(f===5||f===6)s=s.stateNode,a?(c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c).insertBefore(s,a):(a=c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c,a.appendChild(s),c=c._reactRootContainer,c!=null||a.onclick!==null||(a.onclick=Zr));else if(f!==4&&(f===27&&ea(s.type)&&(c=s.stateNode,a=null),s=s.child,s!==null))for(Op(s,a,c),s=s.sibling;s!==null;)Op(s,a,c),s=s.sibling}function ah(s,a,c){var f=s.tag;if(f===5||f===6)s=s.stateNode,a?c.insertBefore(s,a):c.appendChild(s);else if(f!==4&&(f===27&&ea(s.type)&&(c=s.stateNode),s=s.child,s!==null))for(ah(s,a,c),s=s.sibling;s!==null;)ah(s,a,c),s=s.sibling}function ev(s){var a=s.stateNode,c=s.memoizedProps;try{for(var f=s.type,_=a.attributes;_.length;)a.removeAttributeNode(_[0]);Un(a,f,c),a[hn]=s,a[In]=c}catch(w){Mt(s,s.return,w)}}var ai=!1,_n=!1,Np=!1,tv=typeof WeakSet=="function"?WeakSet:Set,Dn=null;function LA(s,a){if(s=s.containerInfo,ng=Ah,s=f_(s),jm(s)){if("selectionStart"in s)var c={start:s.selectionStart,end:s.selectionEnd};else e:{c=(c=s.ownerDocument)&&c.defaultView||window;var f=c.getSelection&&c.getSelection();if(f&&f.rangeCount!==0){c=f.anchorNode;var _=f.anchorOffset,w=f.focusNode;f=f.focusOffset;try{c.nodeType,w.nodeType}catch{c=null;break e}var z=0,Q=-1,re=-1,ge=0,Ee=0,Re=s,_e=null;t:for(;;){for(var we;Re!==c||_!==0&&Re.nodeType!==3||(Q=z+_),Re!==w||f!==0&&Re.nodeType!==3||(re=z+f),Re.nodeType===3&&(z+=Re.nodeValue.length),(we=Re.firstChild)!==null;)_e=Re,Re=we;for(;;){if(Re===s)break t;if(_e===c&&++ge===_&&(Q=z),_e===w&&++Ee===f&&(re=z),(we=Re.nextSibling)!==null)break;Re=_e,_e=Re.parentNode}Re=we}c=Q===-1||re===-1?null:{start:Q,end:re}}else c=null}c=c||{start:0,end:0}}else c=null;for(rg={focusedElem:s,selectionRange:c},Ah=!1,Dn=a;Dn!==null;)if(a=Dn,s=a.child,(a.subtreeFlags&1028)!==0&&s!==null)s.return=a,Dn=s;else for(;Dn!==null;){switch(a=Dn,w=a.alternate,s=a.flags,a.tag){case 0:if((s&4)!==0&&(s=a.updateQueue,s=s!==null?s.events:null,s!==null))for(c=0;c<s.length;c++)_=s[c],_.ref.impl=_.nextImpl;break;case 11:case 15:break;case 1:if((s&1024)!==0&&w!==null){s=void 0,c=a,_=w.memoizedProps,w=w.memoizedState,f=c.stateNode;try{var Fe=fo(c.type,_);s=f.getSnapshotBeforeUpdate(Fe,w),f.__reactInternalSnapshotBeforeUpdate=s}catch(Qe){Mt(c,c.return,Qe)}}break;case 3:if((s&1024)!==0){if(s=a.stateNode.containerInfo,c=s.nodeType,c===9)ag(s);else if(c===1)switch(s.nodeName){case"HEAD":case"HTML":case"BODY":ag(s);break;default:s.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((s&1024)!==0)throw Error(r(163))}if(s=a.sibling,s!==null){s.return=a.return,Dn=s;break}Dn=a.return}}function nv(s,a,c){var f=c.flags;switch(c.tag){case 0:case 11:case 15:li(s,c),f&4&&Jc(5,c);break;case 1:if(li(s,c),f&4)if(s=c.stateNode,a===null)try{s.componentDidMount()}catch(z){Mt(c,c.return,z)}else{var _=fo(c.type,a.memoizedProps);a=a.memoizedState;try{s.componentDidUpdate(_,a,s.__reactInternalSnapshotBeforeUpdate)}catch(z){Mt(c,c.return,z)}}f&64&&Yb(c),f&512&&eu(c,c.return);break;case 3:if(li(s,c),f&64&&(s=c.updateQueue,s!==null)){if(a=null,c.child!==null)switch(c.child.tag){case 27:case 5:a=c.child.stateNode;break;case 1:a=c.child.stateNode}try{U_(s,a)}catch(z){Mt(c,c.return,z)}}break;case 27:a===null&&f&4&&ev(c);case 26:case 5:li(s,c),a===null&&f&4&&Zb(c),f&512&&eu(c,c.return);break;case 12:li(s,c);break;case 31:li(s,c),f&4&&iv(s,c);break;case 13:li(s,c),f&4&&av(s,c),f&64&&(s=c.memoizedState,s!==null&&(s=s.dehydrated,s!==null&&(c=WA.bind(null,c),m2(s,c))));break;case 22:if(f=c.memoizedState!==null||ai,!f){a=a!==null&&a.memoizedState!==null||_n,_=ai;var w=_n;ai=f,(_n=a)&&!w?ci(s,c,(c.subtreeFlags&8772)!==0):li(s,c),ai=_,_n=w}break;case 30:break;default:li(s,c)}}function rv(s){var a=s.alternate;a!==null&&(s.alternate=null,rv(a)),s.child=null,s.deletions=null,s.sibling=null,s.tag===5&&(a=s.stateNode,a!==null&&$o(a)),s.stateNode=null,s.return=null,s.dependencies=null,s.memoizedProps=null,s.memoizedState=null,s.pendingProps=null,s.stateNode=null,s.updateQueue=null}var Kt=null,lr=!1;function oi(s,a,c){for(c=c.child;c!==null;)sv(s,a,c),c=c.sibling}function sv(s,a,c){if(tn&&typeof tn.onCommitFiberUnmount=="function")try{tn.onCommitFiberUnmount(xt,c)}catch{}switch(c.tag){case 26:_n||Ns(c,a),oi(s,a,c),c.memoizedState?c.memoizedState.count--:c.stateNode&&(c=c.stateNode,c.parentNode.removeChild(c));break;case 27:_n||Ns(c,a);var f=Kt,_=lr;ea(c.type)&&(Kt=c.stateNode,lr=!1),oi(s,a,c),cu(c.stateNode),Kt=f,lr=_;break;case 5:_n||Ns(c,a);case 6:if(f=Kt,_=lr,Kt=null,oi(s,a,c),Kt=f,lr=_,Kt!==null)if(lr)try{(Kt.nodeType===9?Kt.body:Kt.nodeName==="HTML"?Kt.ownerDocument.body:Kt).removeChild(c.stateNode)}catch(w){Mt(c,a,w)}else try{Kt.removeChild(c.stateNode)}catch(w){Mt(c,a,w)}break;case 18:Kt!==null&&(lr?(s=Kt,Yv(s.nodeType===9?s.body:s.nodeName==="HTML"?s.ownerDocument.body:s,c.stateNode),Al(s)):Yv(Kt,c.stateNode));break;case 4:f=Kt,_=lr,Kt=c.stateNode.containerInfo,lr=!0,oi(s,a,c),Kt=f,lr=_;break;case 0:case 11:case 14:case 15:Qi(2,c,a),_n||Qi(4,c,a),oi(s,a,c);break;case 1:_n||(Ns(c,a),f=c.stateNode,typeof f.componentWillUnmount=="function"&&Xb(c,a,f)),oi(s,a,c);break;case 21:oi(s,a,c);break;case 22:_n=(f=_n)||c.memoizedState!==null,oi(s,a,c),_n=f;break;default:oi(s,a,c)}}function iv(s,a){if(a.memoizedState===null&&(s=a.alternate,s!==null&&(s=s.memoizedState,s!==null))){s=s.dehydrated;try{Al(s)}catch(c){Mt(a,a.return,c)}}}function av(s,a){if(a.memoizedState===null&&(s=a.alternate,s!==null&&(s=s.memoizedState,s!==null&&(s=s.dehydrated,s!==null))))try{Al(s)}catch(c){Mt(a,a.return,c)}}function UA(s){switch(s.tag){case 31:case 13:case 19:var a=s.stateNode;return a===null&&(a=s.stateNode=new tv),a;case 22:return s=s.stateNode,a=s._retryCache,a===null&&(a=s._retryCache=new tv),a;default:throw Error(r(435,s.tag))}}function oh(s,a){var c=UA(s);a.forEach(function(f){if(!c.has(f)){c.add(f);var _=KA.bind(null,s,f);f.then(_,_)}})}function cr(s,a){var c=a.deletions;if(c!==null)for(var f=0;f<c.length;f++){var _=c[f],w=s,z=a,Q=z;e:for(;Q!==null;){switch(Q.tag){case 27:if(ea(Q.type)){Kt=Q.stateNode,lr=!1;break e}break;case 5:Kt=Q.stateNode,lr=!1;break e;case 3:case 4:Kt=Q.stateNode.containerInfo,lr=!0;break e}Q=Q.return}if(Kt===null)throw Error(r(160));sv(w,z,_),Kt=null,lr=!1,w=_.alternate,w!==null&&(w.return=null),_.return=null}if(a.subtreeFlags&13886)for(a=a.child;a!==null;)ov(a,s),a=a.sibling}var ss=null;function ov(s,a){var c=s.alternate,f=s.flags;switch(s.tag){case 0:case 11:case 14:case 15:cr(a,s),ur(s),f&4&&(Qi(3,s,s.return),Jc(3,s),Qi(5,s,s.return));break;case 1:cr(a,s),ur(s),f&512&&(_n||c===null||Ns(c,c.return)),f&64&&ai&&(s=s.updateQueue,s!==null&&(f=s.callbacks,f!==null&&(c=s.shared.hiddenCallbacks,s.shared.hiddenCallbacks=c===null?f:c.concat(f))));break;case 26:var _=ss;if(cr(a,s),ur(s),f&512&&(_n||c===null||Ns(c,c.return)),f&4){var w=c!==null?c.memoizedState:null;if(f=s.memoizedState,c===null)if(f===null)if(s.stateNode===null){e:{f=s.type,c=s.memoizedProps,_=_.ownerDocument||_;t:switch(f){case"title":w=_.getElementsByTagName("title")[0],(!w||w[xs]||w[hn]||w.namespaceURI==="http://www.w3.org/2000/svg"||w.hasAttribute("itemprop"))&&(w=_.createElement(f),_.head.insertBefore(w,_.querySelector("head > title"))),Un(w,f,c),w[hn]=s,fn(w),f=w;break e;case"link":var z=ox("link","href",_).get(f+(c.href||""));if(z){for(var Q=0;Q<z.length;Q++)if(w=z[Q],w.getAttribute("href")===(c.href==null||c.href===""?null:c.href)&&w.getAttribute("rel")===(c.rel==null?null:c.rel)&&w.getAttribute("title")===(c.title==null?null:c.title)&&w.getAttribute("crossorigin")===(c.crossOrigin==null?null:c.crossOrigin)){z.splice(Q,1);break t}}w=_.createElement(f),Un(w,f,c),_.head.appendChild(w);break;case"meta":if(z=ox("meta","content",_).get(f+(c.content||""))){for(Q=0;Q<z.length;Q++)if(w=z[Q],w.getAttribute("content")===(c.content==null?null:""+c.content)&&w.getAttribute("name")===(c.name==null?null:c.name)&&w.getAttribute("property")===(c.property==null?null:c.property)&&w.getAttribute("http-equiv")===(c.httpEquiv==null?null:c.httpEquiv)&&w.getAttribute("charset")===(c.charSet==null?null:c.charSet)){z.splice(Q,1);break t}}w=_.createElement(f),Un(w,f,c),_.head.appendChild(w);break;default:throw Error(r(468,f))}w[hn]=s,fn(w),f=w}s.stateNode=f}else lx(_,s.type,s.stateNode);else s.stateNode=ax(_,f,s.memoizedProps);else w!==f?(w===null?c.stateNode!==null&&(c=c.stateNode,c.parentNode.removeChild(c)):w.count--,f===null?lx(_,s.type,s.stateNode):ax(_,f,s.memoizedProps)):f===null&&s.stateNode!==null&&Dp(s,s.memoizedProps,c.memoizedProps)}break;case 27:cr(a,s),ur(s),f&512&&(_n||c===null||Ns(c,c.return)),c!==null&&f&4&&Dp(s,s.memoizedProps,c.memoizedProps);break;case 5:if(cr(a,s),ur(s),f&512&&(_n||c===null||Ns(c,c.return)),s.flags&32){_=s.stateNode;try{or(_,"")}catch(Fe){Mt(s,s.return,Fe)}}f&4&&s.stateNode!=null&&(_=s.memoizedProps,Dp(s,_,c!==null?c.memoizedProps:_)),f&1024&&(Np=!0);break;case 6:if(cr(a,s),ur(s),f&4){if(s.stateNode===null)throw Error(r(162));f=s.memoizedProps,c=s.stateNode;try{c.nodeValue=f}catch(Fe){Mt(s,s.return,Fe)}}break;case 3:if(Sh=null,_=ss,ss=xh(a.containerInfo),cr(a,s),ss=_,ur(s),f&4&&c!==null&&c.memoizedState.isDehydrated)try{Al(a.containerInfo)}catch(Fe){Mt(s,s.return,Fe)}Np&&(Np=!1,lv(s));break;case 4:f=ss,ss=xh(s.stateNode.containerInfo),cr(a,s),ur(s),ss=f;break;case 12:cr(a,s),ur(s);break;case 31:cr(a,s),ur(s),f&4&&(f=s.updateQueue,f!==null&&(s.updateQueue=null,oh(s,f)));break;case 13:cr(a,s),ur(s),s.child.flags&8192&&s.memoizedState!==null!=(c!==null&&c.memoizedState!==null)&&(ch=Oe()),f&4&&(f=s.updateQueue,f!==null&&(s.updateQueue=null,oh(s,f)));break;case 22:_=s.memoizedState!==null;var re=c!==null&&c.memoizedState!==null,ge=ai,Ee=_n;if(ai=ge||_,_n=Ee||re,cr(a,s),_n=Ee,ai=ge,ur(s),f&8192)e:for(a=s.stateNode,a._visibility=_?a._visibility&-2:a._visibility|1,_&&(c===null||re||ai||_n||mo(s)),c=null,a=s;;){if(a.tag===5||a.tag===26){if(c===null){re=c=a;try{if(w=re.stateNode,_)z=w.style,typeof z.setProperty=="function"?z.setProperty("display","none","important"):z.display="none";else{Q=re.stateNode;var Re=re.memoizedProps.style,_e=Re!=null&&Re.hasOwnProperty("display")?Re.display:null;Q.style.display=_e==null||typeof _e=="boolean"?"":(""+_e).trim()}}catch(Fe){Mt(re,re.return,Fe)}}}else if(a.tag===6){if(c===null){re=a;try{re.stateNode.nodeValue=_?"":re.memoizedProps}catch(Fe){Mt(re,re.return,Fe)}}}else if(a.tag===18){if(c===null){re=a;try{var we=re.stateNode;_?Xv(we,!0):Xv(re.stateNode,!1)}catch(Fe){Mt(re,re.return,Fe)}}}else if((a.tag!==22&&a.tag!==23||a.memoizedState===null||a===s)&&a.child!==null){a.child.return=a,a=a.child;continue}if(a===s)break e;for(;a.sibling===null;){if(a.return===null||a.return===s)break e;c===a&&(c=null),a=a.return}c===a&&(c=null),a.sibling.return=a.return,a=a.sibling}f&4&&(f=s.updateQueue,f!==null&&(c=f.retryQueue,c!==null&&(f.retryQueue=null,oh(s,c))));break;case 19:cr(a,s),ur(s),f&4&&(f=s.updateQueue,f!==null&&(s.updateQueue=null,oh(s,f)));break;case 30:break;case 21:break;default:cr(a,s),ur(s)}}function ur(s){var a=s.flags;if(a&2){try{for(var c,f=s.return;f!==null;){if(Jb(f)){c=f;break}f=f.return}if(c==null)throw Error(r(160));switch(c.tag){case 27:var _=c.stateNode,w=Mp(s);ah(s,w,_);break;case 5:var z=c.stateNode;c.flags&32&&(or(z,""),c.flags&=-33);var Q=Mp(s);ah(s,Q,z);break;case 3:case 4:var re=c.stateNode.containerInfo,ge=Mp(s);Op(s,ge,re);break;default:throw Error(r(161))}}catch(Ee){Mt(s,s.return,Ee)}s.flags&=-3}a&4096&&(s.flags&=-4097)}function lv(s){if(s.subtreeFlags&1024)for(s=s.child;s!==null;){var a=s;lv(a),a.tag===5&&a.flags&1024&&a.stateNode.reset(),s=s.sibling}}function li(s,a){if(a.subtreeFlags&8772)for(a=a.child;a!==null;)nv(s,a.alternate,a),a=a.sibling}function mo(s){for(s=s.child;s!==null;){var a=s;switch(a.tag){case 0:case 11:case 14:case 15:Qi(4,a,a.return),mo(a);break;case 1:Ns(a,a.return);var c=a.stateNode;typeof c.componentWillUnmount=="function"&&Xb(a,a.return,c),mo(a);break;case 27:cu(a.stateNode);case 26:case 5:Ns(a,a.return),mo(a);break;case 22:a.memoizedState===null&&mo(a);break;case 30:mo(a);break;default:mo(a)}s=s.sibling}}function ci(s,a,c){for(c=c&&(a.subtreeFlags&8772)!==0,a=a.child;a!==null;){var f=a.alternate,_=s,w=a,z=w.flags;switch(w.tag){case 0:case 11:case 15:ci(_,w,c),Jc(4,w);break;case 1:if(ci(_,w,c),f=w,_=f.stateNode,typeof _.componentDidMount=="function")try{_.componentDidMount()}catch(ge){Mt(f,f.return,ge)}if(f=w,_=f.updateQueue,_!==null){var Q=f.stateNode;try{var re=_.shared.hiddenCallbacks;if(re!==null)for(_.shared.hiddenCallbacks=null,_=0;_<re.length;_++)L_(re[_],Q)}catch(ge){Mt(f,f.return,ge)}}c&&z&64&&Yb(w),eu(w,w.return);break;case 27:ev(w);case 26:case 5:ci(_,w,c),c&&f===null&&z&4&&Zb(w),eu(w,w.return);break;case 12:ci(_,w,c);break;case 31:ci(_,w,c),c&&z&4&&iv(_,w);break;case 13:ci(_,w,c),c&&z&4&&av(_,w);break;case 22:w.memoizedState===null&&ci(_,w,c),eu(w,w.return);break;case 30:break;default:ci(_,w,c)}a=a.sibling}}function Pp(s,a){var c=null;s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(c=s.memoizedState.cachePool.pool),s=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(s=a.memoizedState.cachePool.pool),s!==c&&(s!=null&&s.refCount++,c!=null&&Uc(c))}function zp(s,a){s=null,a.alternate!==null&&(s=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==s&&(a.refCount++,s!=null&&Uc(s))}function is(s,a,c,f){if(a.subtreeFlags&10256)for(a=a.child;a!==null;)cv(s,a,c,f),a=a.sibling}function cv(s,a,c,f){var _=a.flags;switch(a.tag){case 0:case 11:case 15:is(s,a,c,f),_&2048&&Jc(9,a);break;case 1:is(s,a,c,f);break;case 3:is(s,a,c,f),_&2048&&(s=null,a.alternate!==null&&(s=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==s&&(a.refCount++,s!=null&&Uc(s)));break;case 12:if(_&2048){is(s,a,c,f),s=a.stateNode;try{var w=a.memoizedProps,z=w.id,Q=w.onPostCommit;typeof Q=="function"&&Q(z,a.alternate===null?"mount":"update",s.passiveEffectDuration,-0)}catch(re){Mt(a,a.return,re)}}else is(s,a,c,f);break;case 31:is(s,a,c,f);break;case 13:is(s,a,c,f);break;case 23:break;case 22:w=a.stateNode,z=a.alternate,a.memoizedState!==null?w._visibility&2?is(s,a,c,f):tu(s,a):w._visibility&2?is(s,a,c,f):(w._visibility|=2,gl(s,a,c,f,(a.subtreeFlags&10256)!==0||!1)),_&2048&&Pp(z,a);break;case 24:is(s,a,c,f),_&2048&&zp(a.alternate,a);break;default:is(s,a,c,f)}}function gl(s,a,c,f,_){for(_=_&&((a.subtreeFlags&10256)!==0||!1),a=a.child;a!==null;){var w=s,z=a,Q=c,re=f,ge=z.flags;switch(z.tag){case 0:case 11:case 15:gl(w,z,Q,re,_),Jc(8,z);break;case 23:break;case 22:var Ee=z.stateNode;z.memoizedState!==null?Ee._visibility&2?gl(w,z,Q,re,_):tu(w,z):(Ee._visibility|=2,gl(w,z,Q,re,_)),_&&ge&2048&&Pp(z.alternate,z);break;case 24:gl(w,z,Q,re,_),_&&ge&2048&&zp(z.alternate,z);break;default:gl(w,z,Q,re,_)}a=a.sibling}}function tu(s,a){if(a.subtreeFlags&10256)for(a=a.child;a!==null;){var c=s,f=a,_=f.flags;switch(f.tag){case 22:tu(c,f),_&2048&&Pp(f.alternate,f);break;case 24:tu(c,f),_&2048&&zp(f.alternate,f);break;default:tu(c,f)}a=a.sibling}}var nu=8192;function yl(s,a,c){if(s.subtreeFlags&nu)for(s=s.child;s!==null;)uv(s,a,c),s=s.sibling}function uv(s,a,c){switch(s.tag){case 26:yl(s,a,c),s.flags&nu&&s.memoizedState!==null&&T2(c,ss,s.memoizedState,s.memoizedProps);break;case 5:yl(s,a,c);break;case 3:case 4:var f=ss;ss=xh(s.stateNode.containerInfo),yl(s,a,c),ss=f;break;case 22:s.memoizedState===null&&(f=s.alternate,f!==null&&f.memoizedState!==null?(f=nu,nu=16777216,yl(s,a,c),nu=f):yl(s,a,c));break;default:yl(s,a,c)}}function dv(s){var a=s.alternate;if(a!==null&&(s=a.child,s!==null)){a.child=null;do a=s.sibling,s.sibling=null,s=a;while(s!==null)}}function ru(s){var a=s.deletions;if((s.flags&16)!==0){if(a!==null)for(var c=0;c<a.length;c++){var f=a[c];Dn=f,fv(f,s)}dv(s)}if(s.subtreeFlags&10256)for(s=s.child;s!==null;)hv(s),s=s.sibling}function hv(s){switch(s.tag){case 0:case 11:case 15:ru(s),s.flags&2048&&Qi(9,s,s.return);break;case 3:ru(s);break;case 12:ru(s);break;case 22:var a=s.stateNode;s.memoizedState!==null&&a._visibility&2&&(s.return===null||s.return.tag!==13)?(a._visibility&=-3,lh(s)):ru(s);break;default:ru(s)}}function lh(s){var a=s.deletions;if((s.flags&16)!==0){if(a!==null)for(var c=0;c<a.length;c++){var f=a[c];Dn=f,fv(f,s)}dv(s)}for(s=s.child;s!==null;){switch(a=s,a.tag){case 0:case 11:case 15:Qi(8,a,a.return),lh(a);break;case 22:c=a.stateNode,c._visibility&2&&(c._visibility&=-3,lh(a));break;default:lh(a)}s=s.sibling}}function fv(s,a){for(;Dn!==null;){var c=Dn;switch(c.tag){case 0:case 11:case 15:Qi(8,c,a);break;case 23:case 22:if(c.memoizedState!==null&&c.memoizedState.cachePool!==null){var f=c.memoizedState.cachePool.pool;f!=null&&f.refCount++}break;case 24:Uc(c.memoizedState.cache)}if(f=c.child,f!==null)f.return=c,Dn=f;else e:for(c=s;Dn!==null;){f=Dn;var _=f.sibling,w=f.return;if(rv(f),f===c){Dn=null;break e}if(_!==null){_.return=w,Dn=_;break e}Dn=w}}}var FA={getCacheForType:function(s){var a=Bn(pn),c=a.data.get(s);return c===void 0&&(c=s(),a.data.set(s,c)),c},cacheSignal:function(){return Bn(pn).controller.signal}},VA=typeof WeakMap=="function"?WeakMap:Map,jt=0,Ut=null,lt=null,dt=0,Dt=0,Er=null,Wi=!1,_l=!1,Bp=!1,ui=0,rn=0,Ki=0,po=0,Lp=0,Tr=0,bl=0,su=null,dr=null,Up=!1,ch=0,mv=0,uh=1/0,dh=null,Yi=null,Cn=0,Xi=null,vl=null,di=0,Fp=0,Vp=null,pv=null,iu=0,$p=null;function Ar(){return(jt&2)!==0&&dt!==0?dt&-dt:W.T!==null?Kp():hd()}function gv(){if(Tr===0)if((dt&536870912)===0||yt){var s=ys;ys<<=1,(ys&3932160)===0&&(ys=262144),Tr=s}else Tr=536870912;return s=Sr.current,s!==null&&(s.flags|=32),Tr}function hr(s,a,c){(s===Ut&&(Dt===2||Dt===9)||s.cancelPendingCommit!==null)&&(xl(s,0),Zi(s,dt,Tr,!1)),Va(s,c),((jt&2)===0||s!==Ut)&&(s===Ut&&((jt&2)===0&&(po|=c),rn===4&&Zi(s,dt,Tr,!1)),Ps(s))}function yv(s,a,c){if((jt&6)!==0)throw Error(r(327));var f=!c&&(a&127)===0&&(a&s.expiredLanes)===0||Kr(s,a),_=f?HA(s,a):Hp(s,a,!0),w=f;do{if(_===0){_l&&!f&&Zi(s,a,0,!1);break}else{if(c=s.current.alternate,w&&!$A(c)){_=Hp(s,a,!1),w=!1;continue}if(_===2){if(w=a,s.errorRecoveryDisabledLanes&w)var z=0;else z=s.pendingLanes&-536870913,z=z!==0?z:z&536870912?536870912:0;if(z!==0){a=z;e:{var Q=s;_=su;var re=Q.current.memoizedState.isDehydrated;if(re&&(xl(Q,z).flags|=256),z=Hp(Q,z,!1),z!==2){if(Bp&&!re){Q.errorRecoveryDisabledLanes|=w,po|=w,_=4;break e}w=dr,dr=_,w!==null&&(dr===null?dr=w:dr.push.apply(dr,w))}_=z}if(w=!1,_!==2)continue}}if(_===1){xl(s,0),Zi(s,a,0,!0);break}e:{switch(f=s,w=_,w){case 0:case 1:throw Error(r(345));case 4:if((a&4194048)!==a)break;case 6:Zi(f,a,Tr,!Wi);break e;case 2:dr=null;break;case 3:case 5:break;default:throw Error(r(329))}if((a&62914560)===a&&(_=ch+300-Oe(),10<_)){if(Zi(f,a,Tr,!Wi),_s(f,0,!0)!==0)break e;di=a,f.timeoutHandle=Wv(_v.bind(null,f,c,dr,dh,Up,a,Tr,po,bl,Wi,w,"Throttled",-0,0),_);break e}_v(f,c,dr,dh,Up,a,Tr,po,bl,Wi,w,null,-0,0)}}break}while(!0);Ps(s)}function _v(s,a,c,f,_,w,z,Q,re,ge,Ee,Re,_e,we){if(s.timeoutHandle=-1,Re=a.subtreeFlags,Re&8192||(Re&16785408)===16785408){Re={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Zr},uv(a,w,Re);var Fe=(w&62914560)===w?ch-Oe():(w&4194048)===w?mv-Oe():0;if(Fe=A2(Re,Fe),Fe!==null){di=w,s.cancelPendingCommit=Fe(Tv.bind(null,s,a,w,c,f,_,z,Q,re,Ee,Re,null,_e,we)),Zi(s,w,z,!ge);return}}Tv(s,a,w,c,f,_,z,Q,re)}function $A(s){for(var a=s;;){var c=a.tag;if((c===0||c===11||c===15)&&a.flags&16384&&(c=a.updateQueue,c!==null&&(c=c.stores,c!==null)))for(var f=0;f<c.length;f++){var _=c[f],w=_.getSnapshot;_=_.value;try{if(!xr(w(),_))return!1}catch{return!1}}if(c=a.child,a.subtreeFlags&16384&&c!==null)c.return=a,a=c;else{if(a===s)break;for(;a.sibling===null;){if(a.return===null||a.return===s)return!0;a=a.return}a.sibling.return=a.return,a=a.sibling}}return!0}function Zi(s,a,c,f){a&=~Lp,a&=~po,s.suspendedLanes|=a,s.pingedLanes&=~a,f&&(s.warmLanes|=a),f=s.expirationTimes;for(var _=a;0<_;){var w=31-Tt(_),z=1<<w;f[w]=-1,_&=~z}c!==0&&$a(s,c,a)}function hh(){return(jt&6)===0?(au(0),!1):!0}function qp(){if(lt!==null){if(Dt===0)var s=lt.return;else s=lt,ei=io=null,ap(s),dl=null,Vc=0,s=lt;for(;s!==null;)Kb(s.alternate,s),s=s.return;lt=null}}function xl(s,a){var c=s.timeoutHandle;c!==-1&&(s.timeoutHandle=-1,c2(c)),c=s.cancelPendingCommit,c!==null&&(s.cancelPendingCommit=null,c()),di=0,qp(),Ut=s,lt=c=Zs(s.current,null),dt=a,Dt=0,Er=null,Wi=!1,_l=Kr(s,a),Bp=!1,bl=Tr=Lp=po=Ki=rn=0,dr=su=null,Up=!1,(a&8)!==0&&(a|=a&32);var f=s.entangledLanes;if(f!==0)for(s=s.entanglements,f&=a;0<f;){var _=31-Tt(f),w=1<<_;a|=s[_],f&=~w}return ui=a,Md(),c}function bv(s,a){rt=null,W.H=Yc,a===ul||a===Fd?(a=N_(),Dt=3):a===Wm?(a=N_(),Dt=4):Dt=a===wp?8:a!==null&&typeof a=="object"&&typeof a.then=="function"?6:1,Er=a,lt===null&&(rn=1,th(s,zr(a,s.current)))}function vv(){var s=Sr.current;return s===null?!0:(dt&4194048)===dt?Fr===null:(dt&62914560)===dt||(dt&536870912)!==0?s===Fr:!1}function xv(){var s=W.H;return W.H=Yc,s===null?Yc:s}function wv(){var s=W.A;return W.A=FA,s}function fh(){rn=4,Wi||(dt&4194048)!==dt&&Sr.current!==null||(_l=!0),(Ki&134217727)===0&&(po&134217727)===0||Ut===null||Zi(Ut,dt,Tr,!1)}function Hp(s,a,c){var f=jt;jt|=2;var _=xv(),w=wv();(Ut!==s||dt!==a)&&(dh=null,xl(s,a)),a=!1;var z=rn;e:do try{if(Dt!==0&&lt!==null){var Q=lt,re=Er;switch(Dt){case 8:qp(),z=6;break e;case 3:case 2:case 9:case 6:Sr.current===null&&(a=!0);var ge=Dt;if(Dt=0,Er=null,wl(s,Q,re,ge),c&&_l){z=0;break e}break;default:ge=Dt,Dt=0,Er=null,wl(s,Q,re,ge)}}qA(),z=rn;break}catch(Ee){bv(s,Ee)}while(!0);return a&&s.shellSuspendCounter++,ei=io=null,jt=f,W.H=_,W.A=w,lt===null&&(Ut=null,dt=0,Md()),z}function qA(){for(;lt!==null;)Sv(lt)}function HA(s,a){var c=jt;jt|=2;var f=xv(),_=wv();Ut!==s||dt!==a?(dh=null,uh=Oe()+500,xl(s,a)):_l=Kr(s,a);e:do try{if(Dt!==0&&lt!==null){a=lt;var w=Er;t:switch(Dt){case 1:Dt=0,Er=null,wl(s,a,w,1);break;case 2:case 9:if(M_(w)){Dt=0,Er=null,Cv(a);break}a=function(){Dt!==2&&Dt!==9||Ut!==s||(Dt=7),Ps(s)},w.then(a,a);break e;case 3:Dt=7;break e;case 4:Dt=5;break e;case 7:M_(w)?(Dt=0,Er=null,Cv(a)):(Dt=0,Er=null,wl(s,a,w,7));break;case 5:var z=null;switch(lt.tag){case 26:z=lt.memoizedState;case 5:case 27:var Q=lt;if(z?cx(z):Q.stateNode.complete){Dt=0,Er=null;var re=Q.sibling;if(re!==null)lt=re;else{var ge=Q.return;ge!==null?(lt=ge,mh(ge)):lt=null}break t}}Dt=0,Er=null,wl(s,a,w,5);break;case 6:Dt=0,Er=null,wl(s,a,w,6);break;case 8:qp(),rn=6;break e;default:throw Error(r(462))}}GA();break}catch(Ee){bv(s,Ee)}while(!0);return ei=io=null,W.H=f,W.A=_,jt=c,lt!==null?0:(Ut=null,dt=0,Md(),rn)}function GA(){for(;lt!==null&&!ae();)Sv(lt)}function Sv(s){var a=Qb(s.alternate,s,ui);s.memoizedProps=s.pendingProps,a===null?mh(s):lt=a}function Cv(s){var a=s,c=a.alternate;switch(a.tag){case 15:case 0:a=Fb(c,a,a.pendingProps,a.type,void 0,dt);break;case 11:a=Fb(c,a,a.pendingProps,a.type.render,a.ref,dt);break;case 5:ap(a);default:Kb(c,a),a=lt=w_(a,ui),a=Qb(c,a,ui)}s.memoizedProps=s.pendingProps,a===null?mh(s):lt=a}function wl(s,a,c,f){ei=io=null,ap(a),dl=null,Vc=0;var _=a.return;try{if(OA(s,_,a,c,dt)){rn=1,th(s,zr(c,s.current)),lt=null;return}}catch(w){if(_!==null)throw lt=_,w;rn=1,th(s,zr(c,s.current)),lt=null;return}a.flags&32768?(yt||f===1?s=!0:_l||(dt&536870912)!==0?s=!1:(Wi=s=!0,(f===2||f===9||f===3||f===6)&&(f=Sr.current,f!==null&&f.tag===13&&(f.flags|=16384))),Ev(a,s)):mh(a)}function mh(s){var a=s;do{if((a.flags&32768)!==0){Ev(a,Wi);return}s=a.return;var c=zA(a.alternate,a,ui);if(c!==null){lt=c;return}if(a=a.sibling,a!==null){lt=a;return}lt=a=s}while(a!==null);rn===0&&(rn=5)}function Ev(s,a){do{var c=BA(s.alternate,s);if(c!==null){c.flags&=32767,lt=c;return}if(c=s.return,c!==null&&(c.flags|=32768,c.subtreeFlags=0,c.deletions=null),!a&&(s=s.sibling,s!==null)){lt=s;return}lt=s=c}while(s!==null);rn=6,lt=null}function Tv(s,a,c,f,_,w,z,Q,re){s.cancelPendingCommit=null;do ph();while(Cn!==0);if((jt&6)!==0)throw Error(r(327));if(a!==null){if(a===s.current)throw Error(r(177));if(w=a.lanes|a.childLanes,w|=Mm,Cm(s,c,w,z,Q,re),s===Ut&&(lt=Ut=null,dt=0),vl=a,Xi=s,di=c,Fp=w,Vp=_,pv=f,(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?(s.callbackNode=null,s.callbackPriority=0,YA(tt,function(){return kv(),null})):(s.callbackNode=null,s.callbackPriority=0),f=(a.flags&13878)!==0,(a.subtreeFlags&13878)!==0||f){f=W.T,W.T=null,_=H.p,H.p=2,z=jt,jt|=4;try{LA(s,a,c)}finally{jt=z,H.p=_,W.T=f}}Cn=1,Av(),jv(),Rv()}}function Av(){if(Cn===1){Cn=0;var s=Xi,a=vl,c=(a.flags&13878)!==0;if((a.subtreeFlags&13878)!==0||c){c=W.T,W.T=null;var f=H.p;H.p=2;var _=jt;jt|=4;try{ov(a,s);var w=rg,z=f_(s.containerInfo),Q=w.focusedElem,re=w.selectionRange;if(z!==Q&&Q&&Q.ownerDocument&&h_(Q.ownerDocument.documentElement,Q)){if(re!==null&&jm(Q)){var ge=re.start,Ee=re.end;if(Ee===void 0&&(Ee=ge),"selectionStart"in Q)Q.selectionStart=ge,Q.selectionEnd=Math.min(Ee,Q.value.length);else{var Re=Q.ownerDocument||document,_e=Re&&Re.defaultView||window;if(_e.getSelection){var we=_e.getSelection(),Fe=Q.textContent.length,Qe=Math.min(re.start,Fe),zt=re.end===void 0?Qe:Math.min(re.end,Fe);!we.extend&&Qe>zt&&(z=zt,zt=Qe,Qe=z);var de=d_(Q,Qe),le=d_(Q,zt);if(de&&le&&(we.rangeCount!==1||we.anchorNode!==de.node||we.anchorOffset!==de.offset||we.focusNode!==le.node||we.focusOffset!==le.offset)){var pe=Re.createRange();pe.setStart(de.node,de.offset),we.removeAllRanges(),Qe>zt?(we.addRange(pe),we.extend(le.node,le.offset)):(pe.setEnd(le.node,le.offset),we.addRange(pe))}}}}for(Re=[],we=Q;we=we.parentNode;)we.nodeType===1&&Re.push({element:we,left:we.scrollLeft,top:we.scrollTop});for(typeof Q.focus=="function"&&Q.focus(),Q=0;Q<Re.length;Q++){var Te=Re[Q];Te.element.scrollLeft=Te.left,Te.element.scrollTop=Te.top}}Ah=!!ng,rg=ng=null}finally{jt=_,H.p=f,W.T=c}}s.current=a,Cn=2}}function jv(){if(Cn===2){Cn=0;var s=Xi,a=vl,c=(a.flags&8772)!==0;if((a.subtreeFlags&8772)!==0||c){c=W.T,W.T=null;var f=H.p;H.p=2;var _=jt;jt|=4;try{nv(s,a.alternate,a)}finally{jt=_,H.p=f,W.T=c}}Cn=3}}function Rv(){if(Cn===4||Cn===3){Cn=0,Ae();var s=Xi,a=vl,c=di,f=pv;(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?Cn=5:(Cn=0,vl=Xi=null,Iv(s,s.pendingLanes));var _=s.pendingLanes;if(_===0&&(Yi=null),Ws(c),a=a.stateNode,tn&&typeof tn.onCommitFiberRoot=="function")try{tn.onCommitFiberRoot(xt,a,void 0,(a.current.flags&128)===128)}catch{}if(f!==null){a=W.T,_=H.p,H.p=2,W.T=null;try{for(var w=s.onRecoverableError,z=0;z<f.length;z++){var Q=f[z];w(Q.value,{componentStack:Q.stack})}}finally{W.T=a,H.p=_}}(di&3)!==0&&ph(),Ps(s),_=s.pendingLanes,(c&261930)!==0&&(_&42)!==0?s===$p?iu++:(iu=0,$p=s):iu=0,au(0)}}function Iv(s,a){(s.pooledCacheLanes&=a)===0&&(a=s.pooledCache,a!=null&&(s.pooledCache=null,Uc(a)))}function ph(){return Av(),jv(),Rv(),kv()}function kv(){if(Cn!==5)return!1;var s=Xi,a=Fp;Fp=0;var c=Ws(di),f=W.T,_=H.p;try{H.p=32>c?32:c,W.T=null,c=Vp,Vp=null;var w=Xi,z=di;if(Cn=0,vl=Xi=null,di=0,(jt&6)!==0)throw Error(r(331));var Q=jt;if(jt|=4,hv(w.current),cv(w,w.current,z,c),jt=Q,au(0,!1),tn&&typeof tn.onPostCommitFiberRoot=="function")try{tn.onPostCommitFiberRoot(xt,w)}catch{}return!0}finally{H.p=_,W.T=f,Iv(s,a)}}function Dv(s,a,c){a=zr(c,a),a=xp(s.stateNode,a,2),s=qi(s,a,2),s!==null&&(Va(s,2),Ps(s))}function Mt(s,a,c){if(s.tag===3)Dv(s,s,c);else for(;a!==null;){if(a.tag===3){Dv(a,s,c);break}else if(a.tag===1){var f=a.stateNode;if(typeof a.type.getDerivedStateFromError=="function"||typeof f.componentDidCatch=="function"&&(Yi===null||!Yi.has(f))){s=zr(c,s),c=Mb(2),f=qi(a,c,2),f!==null&&(Ob(c,f,a,s),Va(f,2),Ps(f));break}}a=a.return}}function Gp(s,a,c){var f=s.pingCache;if(f===null){f=s.pingCache=new VA;var _=new Set;f.set(a,_)}else _=f.get(a),_===void 0&&(_=new Set,f.set(a,_));_.has(c)||(Bp=!0,_.add(c),s=QA.bind(null,s,a,c),a.then(s,s))}function QA(s,a,c){var f=s.pingCache;f!==null&&f.delete(a),s.pingedLanes|=s.suspendedLanes&c,s.warmLanes&=~c,Ut===s&&(dt&c)===c&&(rn===4||rn===3&&(dt&62914560)===dt&&300>Oe()-ch?(jt&2)===0&&xl(s,0):Lp|=c,bl===dt&&(bl=0)),Ps(s)}function Mv(s,a){a===0&&(a=dd()),s=no(s,a),s!==null&&(Va(s,a),Ps(s))}function WA(s){var a=s.memoizedState,c=0;a!==null&&(c=a.retryLane),Mv(s,c)}function KA(s,a){var c=0;switch(s.tag){case 31:case 13:var f=s.stateNode,_=s.memoizedState;_!==null&&(c=_.retryLane);break;case 19:f=s.stateNode;break;case 22:f=s.stateNode._retryCache;break;default:throw Error(r(314))}f!==null&&f.delete(a),Mv(s,c)}function YA(s,a){return Ce(s,a)}var gh=null,Sl=null,Qp=!1,yh=!1,Wp=!1,Ji=0;function Ps(s){s!==Sl&&s.next===null&&(Sl===null?gh=Sl=s:Sl=Sl.next=s),yh=!0,Qp||(Qp=!0,ZA())}function au(s,a){if(!Wp&&yh){Wp=!0;do for(var c=!1,f=gh;f!==null;){if(s!==0){var _=f.pendingLanes;if(_===0)var w=0;else{var z=f.suspendedLanes,Q=f.pingedLanes;w=(1<<31-Tt(42|s)+1)-1,w&=_&~(z&~Q),w=w&201326741?w&201326741|1:w?w|2:0}w!==0&&(c=!0,zv(f,w))}else w=dt,w=_s(f,f===Ut?w:0,f.cancelPendingCommit!==null||f.timeoutHandle!==-1),(w&3)===0||Kr(f,w)||(c=!0,zv(f,w));f=f.next}while(c);Wp=!1}}function XA(){Ov()}function Ov(){yh=Qp=!1;var s=0;Ji!==0&&l2()&&(s=Ji);for(var a=Oe(),c=null,f=gh;f!==null;){var _=f.next,w=Nv(f,a);w===0?(f.next=null,c===null?gh=_:c.next=_,_===null&&(Sl=c)):(c=f,(s!==0||(w&3)!==0)&&(yh=!0)),f=_}Cn!==0&&Cn!==5||au(s),Ji!==0&&(Ji=0)}function Nv(s,a){for(var c=s.suspendedLanes,f=s.pingedLanes,_=s.expirationTimes,w=s.pendingLanes&-62914561;0<w;){var z=31-Tt(w),Q=1<<z,re=_[z];re===-1?((Q&c)===0||(Q&f)!==0)&&(_[z]=Sm(Q,a)):re<=a&&(s.expiredLanes|=Q),w&=~Q}if(a=Ut,c=dt,c=_s(s,s===a?c:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),f=s.callbackNode,c===0||s===a&&(Dt===2||Dt===9)||s.cancelPendingCommit!==null)return f!==null&&f!==null&&Se(f),s.callbackNode=null,s.callbackPriority=0;if((c&3)===0||Kr(s,c)){if(a=c&-c,a===s.callbackPriority)return a;switch(f!==null&&Se(f),Ws(c)){case 2:case 8:c=St;break;case 32:c=tt;break;case 268435456:c=ps;break;default:c=tt}return f=Pv.bind(null,s),c=Ce(c,f),s.callbackPriority=a,s.callbackNode=c,a}return f!==null&&f!==null&&Se(f),s.callbackPriority=2,s.callbackNode=null,2}function Pv(s,a){if(Cn!==0&&Cn!==5)return s.callbackNode=null,s.callbackPriority=0,null;var c=s.callbackNode;if(ph()&&s.callbackNode!==c)return null;var f=dt;return f=_s(s,s===Ut?f:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),f===0?null:(yv(s,f,a),Nv(s,Oe()),s.callbackNode!=null&&s.callbackNode===c?Pv.bind(null,s):null)}function zv(s,a){if(ph())return null;yv(s,a,!0)}function ZA(){u2(function(){(jt&6)!==0?Ce(qe,XA):Ov()})}function Kp(){if(Ji===0){var s=ll;s===0&&(s=kr,kr<<=1,(kr&261888)===0&&(kr=256)),Ji=s}return Ji}function Bv(s){return s==null||typeof s=="symbol"||typeof s=="boolean"?null:typeof s=="function"?s:Qo(""+s)}function Lv(s,a){var c=a.ownerDocument.createElement("input");return c.name=a.name,c.value=a.value,s.id&&c.setAttribute("form",s.id),a.parentNode.insertBefore(c,a),s=new FormData(s),c.parentNode.removeChild(c),s}function JA(s,a,c,f,_){if(a==="submit"&&c&&c.stateNode===_){var w=Bv((_[In]||null).action),z=f.submitter;z&&(a=(a=z[In]||null)?Bv(a.formAction):z.getAttribute("formAction"),a!==null&&(w=a,z=null));var Q=new Rs("action","action",null,f,_);s.push({event:Q,listeners:[{instance:null,listener:function(){if(f.defaultPrevented){if(Ji!==0){var re=z?Lv(_,z):new FormData(_);pp(c,{pending:!0,data:re,method:_.method,action:w},null,re)}}else typeof w=="function"&&(Q.preventDefault(),re=z?Lv(_,z):new FormData(_),pp(c,{pending:!0,data:re,method:_.method,action:w},w,re))},currentTarget:_}]})}}for(var Yp=0;Yp<Dm.length;Yp++){var Xp=Dm[Yp],e2=Xp.toLowerCase(),t2=Xp[0].toUpperCase()+Xp.slice(1);rs(e2,"on"+t2)}rs(g_,"onAnimationEnd"),rs(y_,"onAnimationIteration"),rs(__,"onAnimationStart"),rs("dblclick","onDoubleClick"),rs("focusin","onFocus"),rs("focusout","onBlur"),rs(yA,"onTransitionRun"),rs(_A,"onTransitionStart"),rs(bA,"onTransitionCancel"),rs(b_,"onTransitionEnd"),Es("onMouseEnter",["mouseout","mouseover"]),Es("onMouseLeave",["mouseout","mouseover"]),Es("onPointerEnter",["pointerout","pointerover"]),Es("onPointerLeave",["pointerout","pointerover"]),Cs("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Cs("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Cs("onBeforeInput",["compositionend","keypress","textInput","paste"]),Cs("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Cs("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Cs("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ou="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),n2=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(ou));function Uv(s,a){a=(a&4)!==0;for(var c=0;c<s.length;c++){var f=s[c],_=f.event;f=f.listeners;e:{var w=void 0;if(a)for(var z=f.length-1;0<=z;z--){var Q=f[z],re=Q.instance,ge=Q.currentTarget;if(Q=Q.listener,re!==w&&_.isPropagationStopped())break e;w=Q,_.currentTarget=ge;try{w(_)}catch(Ee){Dd(Ee)}_.currentTarget=null,w=re}else for(z=0;z<f.length;z++){if(Q=f[z],re=Q.instance,ge=Q.currentTarget,Q=Q.listener,re!==w&&_.isPropagationStopped())break e;w=Q,_.currentTarget=ge;try{w(_)}catch(Ee){Dd(Ee)}_.currentTarget=null,w=re}}}}function ct(s,a){var c=a[Vo];c===void 0&&(c=a[Vo]=new Set);var f=s+"__bubble";c.has(f)||(Fv(a,s,2,!1),c.add(f))}function Zp(s,a,c){var f=0;a&&(f|=4),Fv(c,s,f,a)}var _h="_reactListening"+Math.random().toString(36).slice(2);function Jp(s){if(!s[_h]){s[_h]=!0,bc.forEach(function(c){c!=="selectionchange"&&(n2.has(c)||Zp(c,!1,s),Zp(c,!0,s))});var a=s.nodeType===9?s:s.ownerDocument;a===null||a[_h]||(a[_h]=!0,Zp("selectionchange",!1,a))}}function Fv(s,a,c,f){switch(gx(a)){case 2:var _=I2;break;case 8:_=k2;break;default:_=mg}c=_.bind(null,a,c,s),_=void 0,!Wa||a!=="touchstart"&&a!=="touchmove"&&a!=="wheel"||(_=!0),f?_!==void 0?s.addEventListener(a,c,{capture:!0,passive:_}):s.addEventListener(a,c,!0):_!==void 0?s.addEventListener(a,c,{passive:_}):s.addEventListener(a,c,!1)}function eg(s,a,c,f,_){var w=f;if((a&1)===0&&(a&2)===0&&f!==null)e:for(;;){if(f===null)return;var z=f.tag;if(z===3||z===4){var Q=f.stateNode.containerInfo;if(Q===_)break;if(z===4)for(z=f.return;z!==null;){var re=z.tag;if((re===3||re===4)&&z.stateNode.containerInfo===_)return;z=z.return}for(;Q!==null;){if(z=ws(Q),z===null)return;if(re=z.tag,re===5||re===6||re===26||re===27){f=w=z;continue e}Q=Q.parentNode}}f=f.return}Oi(function(){var ge=w,Ee=Mr(c),Re=[];e:{var _e=v_.get(s);if(_e!==void 0){var we=Rs,Fe=s;switch(s){case"keypress":if(Ya(c)===0)break e;case"keydown":case"keyup":we=Rd;break;case"focusin":Fe="focus",we=Za;break;case"focusout":Fe="blur",we=Za;break;case"beforeblur":case"afterblur":we=Za;break;case"click":if(c.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":we=Dc;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":we=vd;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":we=R;break;case g_:case y_:case __:we=wd;break;case b_:we=K;break;case"scroll":case"scrollend":we=kc;break;case"wheel":we=xe;break;case"copy":case"cut":case"paste":we=Sd;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":we=Xs;break;case"toggle":case"beforetoggle":we=nt}var Qe=(a&4)!==0,zt=!Qe&&(s==="scroll"||s==="scrollend"),de=Qe?_e!==null?_e+"Capture":null:_e;Qe=[];for(var le=ge,pe;le!==null;){var Te=le;if(pe=Te.stateNode,Te=Te.tag,Te!==5&&Te!==26&&Te!==27||pe===null||de===null||(Te=Jr(le,de),Te!=null&&Qe.push(lu(le,Te,pe))),zt)break;le=le.return}0<Qe.length&&(_e=new we(_e,Fe,null,c,Ee),Re.push({event:_e,listeners:Qe}))}}if((a&7)===0){e:{if(_e=s==="mouseover"||s==="pointerover",we=s==="mouseout"||s==="pointerout",_e&&c!==jc&&(Fe=c.relatedTarget||c.fromElement)&&(ws(Fe)||Fe[vs]))break e;if((we||_e)&&(_e=Ee.window===Ee?Ee:(_e=Ee.ownerDocument)?_e.defaultView||_e.parentWindow:window,we?(Fe=c.relatedTarget||c.toElement,we=ge,Fe=Fe?ws(Fe):null,Fe!==null&&(zt=o(Fe),Qe=Fe.tag,Fe!==zt||Qe!==5&&Qe!==27&&Qe!==6)&&(Fe=null)):(we=null,Fe=ge),we!==Fe)){if(Qe=Dc,Te="onMouseLeave",de="onMouseEnter",le="mouse",(s==="pointerout"||s==="pointerover")&&(Qe=Xs,Te="onPointerLeave",de="onPointerEnter",le="pointer"),zt=we==null?_e:br(we),pe=Fe==null?_e:br(Fe),_e=new Qe(Te,le+"leave",we,c,Ee),_e.target=zt,_e.relatedTarget=pe,Te=null,ws(Ee)===ge&&(Qe=new Qe(de,le+"enter",Fe,c,Ee),Qe.target=pe,Qe.relatedTarget=zt,Te=Qe),zt=Te,we&&Fe)t:{for(Qe=r2,de=we,le=Fe,pe=0,Te=de;Te;Te=Qe(Te))pe++;Te=0;for(var He=le;He;He=Qe(He))Te++;for(;0<pe-Te;)de=Qe(de),pe--;for(;0<Te-pe;)le=Qe(le),Te--;for(;pe--;){if(de===le||le!==null&&de===le.alternate){Qe=de;break t}de=Qe(de),le=Qe(le)}Qe=null}else Qe=null;we!==null&&Vv(Re,_e,we,Qe,!1),Fe!==null&&zt!==null&&Vv(Re,zt,Fe,Qe,!0)}}e:{if(_e=ge?br(ge):window,we=_e.nodeName&&_e.nodeName.toLowerCase(),we==="select"||we==="input"&&_e.type==="file")var Ct=i_;else if(r_(_e))if(a_)Ct=mA;else{Ct=hA;var $e=dA}else we=_e.nodeName,!we||we.toLowerCase()!=="input"||_e.type!=="checkbox"&&_e.type!=="radio"?ge&&Go(ge.elementType)&&(Ct=i_):Ct=fA;if(Ct&&(Ct=Ct(s,ge))){s_(Re,Ct,c,Ee);break e}$e&&$e(s,_e,ge),s==="focusout"&&ge&&_e.type==="number"&&ge.memoizedProps.value!=null&&Ec(_e,"number",_e.value)}switch($e=ge?br(ge):window,s){case"focusin":(r_($e)||$e.contentEditable==="true")&&(el=$e,Rm=ge,zc=null);break;case"focusout":zc=Rm=el=null;break;case"mousedown":Im=!0;break;case"contextmenu":case"mouseup":case"dragend":Im=!1,m_(Re,c,Ee);break;case"selectionchange":if(gA)break;case"keydown":case"keyup":m_(Re,c,Ee)}var st;if(At)e:{switch(s){case"compositionstart":var ht="onCompositionStart";break e;case"compositionend":ht="onCompositionEnd";break e;case"compositionupdate":ht="onCompositionUpdate";break e}ht=void 0}else Jo?Ja(s,c)&&(ht="onCompositionEnd"):s==="keydown"&&c.keyCode===229&&(ht="onCompositionStart");ht&&(Ds&&c.locale!=="ko"&&(Jo||ht!=="onCompositionStart"?ht==="onCompositionEnd"&&Jo&&(st=Ic()):(js=Ee,Rc="value"in js?js.value:js.textContent,Jo=!0)),$e=bh(ge,ht),0<$e.length&&(ht=new ks(ht,s,null,c,Ee),Re.push({event:ht,listeners:$e}),st?ht.data=st:(st=Zo(c),st!==null&&(ht.data=st)))),(st=Nr?oA(s,c):lA(s,c))&&(ht=bh(ge,"onBeforeInput"),0<ht.length&&($e=new ks("onBeforeInput","beforeinput",null,c,Ee),Re.push({event:$e,listeners:ht}),$e.data=st)),JA(Re,s,ge,c,Ee)}Uv(Re,a)})}function lu(s,a,c){return{instance:s,listener:a,currentTarget:c}}function bh(s,a){for(var c=a+"Capture",f=[];s!==null;){var _=s,w=_.stateNode;if(_=_.tag,_!==5&&_!==26&&_!==27||w===null||(_=Jr(s,c),_!=null&&f.unshift(lu(s,_,w)),_=Jr(s,a),_!=null&&f.push(lu(s,_,w))),s.tag===3)return f;s=s.return}return[]}function r2(s){if(s===null)return null;do s=s.return;while(s&&s.tag!==5&&s.tag!==27);return s||null}function Vv(s,a,c,f,_){for(var w=a._reactName,z=[];c!==null&&c!==f;){var Q=c,re=Q.alternate,ge=Q.stateNode;if(Q=Q.tag,re!==null&&re===f)break;Q!==5&&Q!==26&&Q!==27||ge===null||(re=ge,_?(ge=Jr(c,w),ge!=null&&z.unshift(lu(c,ge,re))):_||(ge=Jr(c,w),ge!=null&&z.push(lu(c,ge,re)))),c=c.return}z.length!==0&&s.push({event:a,listeners:z})}var s2=/\r\n?/g,i2=/\u0000|\uFFFD/g;function $v(s){return(typeof s=="string"?s:""+s).replace(s2,`
`).replace(i2,"")}function qv(s,a){return a=$v(a),$v(s)===a}function Pt(s,a,c,f,_,w){switch(c){case"children":typeof f=="string"?a==="body"||a==="textarea"&&f===""||or(s,f):(typeof f=="number"||typeof f=="bigint")&&a!=="body"&&or(s,""+f);break;case"className":vr(s,"class",f);break;case"tabIndex":vr(s,"tabindex",f);break;case"dir":case"role":case"viewBox":case"width":case"height":vr(s,c,f);break;case"style":Ac(s,f,w);break;case"data":if(a!=="object"){vr(s,"data",f);break}case"src":case"href":if(f===""&&(a!=="a"||c!=="href")){s.removeAttribute(c);break}if(f==null||typeof f=="function"||typeof f=="symbol"||typeof f=="boolean"){s.removeAttribute(c);break}f=Qo(""+f),s.setAttribute(c,f);break;case"action":case"formAction":if(typeof f=="function"){s.setAttribute(c,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof w=="function"&&(c==="formAction"?(a!=="input"&&Pt(s,a,"name",_.name,_,null),Pt(s,a,"formEncType",_.formEncType,_,null),Pt(s,a,"formMethod",_.formMethod,_,null),Pt(s,a,"formTarget",_.formTarget,_,null)):(Pt(s,a,"encType",_.encType,_,null),Pt(s,a,"method",_.method,_,null),Pt(s,a,"target",_.target,_,null)));if(f==null||typeof f=="symbol"||typeof f=="boolean"){s.removeAttribute(c);break}f=Qo(""+f),s.setAttribute(c,f);break;case"onClick":f!=null&&(s.onclick=Zr);break;case"onScroll":f!=null&&ct("scroll",s);break;case"onScrollEnd":f!=null&&ct("scrollend",s);break;case"dangerouslySetInnerHTML":if(f!=null){if(typeof f!="object"||!("__html"in f))throw Error(r(61));if(c=f.__html,c!=null){if(_.children!=null)throw Error(r(60));s.innerHTML=c}}break;case"multiple":s.multiple=f&&typeof f!="function"&&typeof f!="symbol";break;case"muted":s.muted=f&&typeof f!="function"&&typeof f!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(f==null||typeof f=="function"||typeof f=="boolean"||typeof f=="symbol"){s.removeAttribute("xlink:href");break}c=Qo(""+f),s.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",c);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":f!=null&&typeof f!="function"&&typeof f!="symbol"?s.setAttribute(c,""+f):s.removeAttribute(c);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":f&&typeof f!="function"&&typeof f!="symbol"?s.setAttribute(c,""):s.removeAttribute(c);break;case"capture":case"download":f===!0?s.setAttribute(c,""):f!==!1&&f!=null&&typeof f!="function"&&typeof f!="symbol"?s.setAttribute(c,f):s.removeAttribute(c);break;case"cols":case"rows":case"size":case"span":f!=null&&typeof f!="function"&&typeof f!="symbol"&&!isNaN(f)&&1<=f?s.setAttribute(c,f):s.removeAttribute(c);break;case"rowSpan":case"start":f==null||typeof f=="function"||typeof f=="symbol"||isNaN(f)?s.removeAttribute(c):s.setAttribute(c,f);break;case"popover":ct("beforetoggle",s),ct("toggle",s),qo(s,"popover",f);break;case"xlinkActuate":mn(s,"http://www.w3.org/1999/xlink","xlink:actuate",f);break;case"xlinkArcrole":mn(s,"http://www.w3.org/1999/xlink","xlink:arcrole",f);break;case"xlinkRole":mn(s,"http://www.w3.org/1999/xlink","xlink:role",f);break;case"xlinkShow":mn(s,"http://www.w3.org/1999/xlink","xlink:show",f);break;case"xlinkTitle":mn(s,"http://www.w3.org/1999/xlink","xlink:title",f);break;case"xlinkType":mn(s,"http://www.w3.org/1999/xlink","xlink:type",f);break;case"xmlBase":mn(s,"http://www.w3.org/XML/1998/namespace","xml:base",f);break;case"xmlLang":mn(s,"http://www.w3.org/XML/1998/namespace","xml:lang",f);break;case"xmlSpace":mn(s,"http://www.w3.org/XML/1998/namespace","xml:space",f);break;case"is":qo(s,"is",f);break;case"innerText":case"textContent":break;default:(!(2<c.length)||c[0]!=="o"&&c[0]!=="O"||c[1]!=="n"&&c[1]!=="N")&&(c=bd.get(c)||c,qo(s,c,f))}}function tg(s,a,c,f,_,w){switch(c){case"style":Ac(s,f,w);break;case"dangerouslySetInnerHTML":if(f!=null){if(typeof f!="object"||!("__html"in f))throw Error(r(61));if(c=f.__html,c!=null){if(_.children!=null)throw Error(r(60));s.innerHTML=c}}break;case"children":typeof f=="string"?or(s,f):(typeof f=="number"||typeof f=="bigint")&&or(s,""+f);break;case"onScroll":f!=null&&ct("scroll",s);break;case"onScrollEnd":f!=null&&ct("scrollend",s);break;case"onClick":f!=null&&(s.onclick=Zr);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!vc.hasOwnProperty(c))e:{if(c[0]==="o"&&c[1]==="n"&&(_=c.endsWith("Capture"),a=c.slice(2,_?c.length-7:void 0),w=s[In]||null,w=w!=null?w[c]:null,typeof w=="function"&&s.removeEventListener(a,w,_),typeof f=="function")){typeof w!="function"&&w!==null&&(c in s?s[c]=null:s.hasAttribute(c)&&s.removeAttribute(c)),s.addEventListener(a,f,_);break e}c in s?s[c]=f:f===!0?s.setAttribute(c,""):qo(s,c,f)}}}function Un(s,a,c){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":ct("error",s),ct("load",s);var f=!1,_=!1,w;for(w in c)if(c.hasOwnProperty(w)){var z=c[w];if(z!=null)switch(w){case"src":f=!0;break;case"srcSet":_=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(r(137,a));default:Pt(s,a,w,z,c,null)}}_&&Pt(s,a,"srcSet",c.srcSet,c,null),f&&Pt(s,a,"src",c.src,c,null);return;case"input":ct("invalid",s);var Q=w=z=_=null,re=null,ge=null;for(f in c)if(c.hasOwnProperty(f)){var Ee=c[f];if(Ee!=null)switch(f){case"name":_=Ee;break;case"type":z=Ee;break;case"checked":re=Ee;break;case"defaultChecked":ge=Ee;break;case"value":w=Ee;break;case"defaultValue":Q=Ee;break;case"children":case"dangerouslySetInnerHTML":if(Ee!=null)throw Error(r(137,a));break;default:Pt(s,a,f,Ee,c,null)}}gd(s,w,Q,re,ge,z,_,!1);return;case"select":ct("invalid",s),f=z=w=null;for(_ in c)if(c.hasOwnProperty(_)&&(Q=c[_],Q!=null))switch(_){case"value":w=Q;break;case"defaultValue":z=Q;break;case"multiple":f=Q;default:Pt(s,a,_,Q,c,null)}a=w,c=z,s.multiple=!!f,a!=null?Ii(s,!!f,a,!1):c!=null&&Ii(s,!!f,c,!0);return;case"textarea":ct("invalid",s),w=_=f=null;for(z in c)if(c.hasOwnProperty(z)&&(Q=c[z],Q!=null))switch(z){case"value":f=Q;break;case"defaultValue":_=Q;break;case"children":w=Q;break;case"dangerouslySetInnerHTML":if(Q!=null)throw Error(r(91));break;default:Pt(s,a,z,Q,c,null)}ki(s,f,_,w);return;case"option":for(re in c)c.hasOwnProperty(re)&&(f=c[re],f!=null)&&(re==="selected"?s.selected=f&&typeof f!="function"&&typeof f!="symbol":Pt(s,a,re,f,c,null));return;case"dialog":ct("beforetoggle",s),ct("toggle",s),ct("cancel",s),ct("close",s);break;case"iframe":case"object":ct("load",s);break;case"video":case"audio":for(f=0;f<ou.length;f++)ct(ou[f],s);break;case"image":ct("error",s),ct("load",s);break;case"details":ct("toggle",s);break;case"embed":case"source":case"link":ct("error",s),ct("load",s);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(ge in c)if(c.hasOwnProperty(ge)&&(f=c[ge],f!=null))switch(ge){case"children":case"dangerouslySetInnerHTML":throw Error(r(137,a));default:Pt(s,a,ge,f,c,null)}return;default:if(Go(a)){for(Ee in c)c.hasOwnProperty(Ee)&&(f=c[Ee],f!==void 0&&tg(s,a,Ee,f,c,void 0));return}}for(Q in c)c.hasOwnProperty(Q)&&(f=c[Q],f!=null&&Pt(s,a,Q,f,c,null))}function a2(s,a,c,f){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var _=null,w=null,z=null,Q=null,re=null,ge=null,Ee=null;for(we in c){var Re=c[we];if(c.hasOwnProperty(we)&&Re!=null)switch(we){case"checked":break;case"value":break;case"defaultValue":re=Re;default:f.hasOwnProperty(we)||Pt(s,a,we,null,f,Re)}}for(var _e in f){var we=f[_e];if(Re=c[_e],f.hasOwnProperty(_e)&&(we!=null||Re!=null))switch(_e){case"type":w=we;break;case"name":_=we;break;case"checked":ge=we;break;case"defaultChecked":Ee=we;break;case"value":z=we;break;case"defaultValue":Q=we;break;case"children":case"dangerouslySetInnerHTML":if(we!=null)throw Error(r(137,a));break;default:we!==Re&&Pt(s,a,_e,we,f,Re)}}Ho(s,z,Q,re,ge,Ee,w,_);return;case"select":we=z=Q=_e=null;for(w in c)if(re=c[w],c.hasOwnProperty(w)&&re!=null)switch(w){case"value":break;case"multiple":we=re;default:f.hasOwnProperty(w)||Pt(s,a,w,null,f,re)}for(_ in f)if(w=f[_],re=c[_],f.hasOwnProperty(_)&&(w!=null||re!=null))switch(_){case"value":_e=w;break;case"defaultValue":Q=w;break;case"multiple":z=w;default:w!==re&&Pt(s,a,_,w,f,re)}a=Q,c=z,f=we,_e!=null?Ii(s,!!c,_e,!1):!!f!=!!c&&(a!=null?Ii(s,!!c,a,!0):Ii(s,!!c,c?[]:"",!1));return;case"textarea":we=_e=null;for(Q in c)if(_=c[Q],c.hasOwnProperty(Q)&&_!=null&&!f.hasOwnProperty(Q))switch(Q){case"value":break;case"children":break;default:Pt(s,a,Q,null,f,_)}for(z in f)if(_=f[z],w=c[z],f.hasOwnProperty(z)&&(_!=null||w!=null))switch(z){case"value":_e=_;break;case"defaultValue":we=_;break;case"children":break;case"dangerouslySetInnerHTML":if(_!=null)throw Error(r(91));break;default:_!==w&&Pt(s,a,z,_,f,w)}yd(s,_e,we);return;case"option":for(var Fe in c)_e=c[Fe],c.hasOwnProperty(Fe)&&_e!=null&&!f.hasOwnProperty(Fe)&&(Fe==="selected"?s.selected=!1:Pt(s,a,Fe,null,f,_e));for(re in f)_e=f[re],we=c[re],f.hasOwnProperty(re)&&_e!==we&&(_e!=null||we!=null)&&(re==="selected"?s.selected=_e&&typeof _e!="function"&&typeof _e!="symbol":Pt(s,a,re,_e,f,we));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Qe in c)_e=c[Qe],c.hasOwnProperty(Qe)&&_e!=null&&!f.hasOwnProperty(Qe)&&Pt(s,a,Qe,null,f,_e);for(ge in f)if(_e=f[ge],we=c[ge],f.hasOwnProperty(ge)&&_e!==we&&(_e!=null||we!=null))switch(ge){case"children":case"dangerouslySetInnerHTML":if(_e!=null)throw Error(r(137,a));break;default:Pt(s,a,ge,_e,f,we)}return;default:if(Go(a)){for(var zt in c)_e=c[zt],c.hasOwnProperty(zt)&&_e!==void 0&&!f.hasOwnProperty(zt)&&tg(s,a,zt,void 0,f,_e);for(Ee in f)_e=f[Ee],we=c[Ee],!f.hasOwnProperty(Ee)||_e===we||_e===void 0&&we===void 0||tg(s,a,Ee,_e,f,we);return}}for(var de in c)_e=c[de],c.hasOwnProperty(de)&&_e!=null&&!f.hasOwnProperty(de)&&Pt(s,a,de,null,f,_e);for(Re in f)_e=f[Re],we=c[Re],!f.hasOwnProperty(Re)||_e===we||_e==null&&we==null||Pt(s,a,Re,_e,f,we)}function Hv(s){switch(s){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function o2(){if(typeof performance.getEntriesByType=="function"){for(var s=0,a=0,c=performance.getEntriesByType("resource"),f=0;f<c.length;f++){var _=c[f],w=_.transferSize,z=_.initiatorType,Q=_.duration;if(w&&Q&&Hv(z)){for(z=0,Q=_.responseEnd,f+=1;f<c.length;f++){var re=c[f],ge=re.startTime;if(ge>Q)break;var Ee=re.transferSize,Re=re.initiatorType;Ee&&Hv(Re)&&(re=re.responseEnd,z+=Ee*(re<Q?1:(Q-ge)/(re-ge)))}if(--f,a+=8*(w+z)/(_.duration/1e3),s++,10<s)break}}if(0<s)return a/s/1e6}return navigator.connection&&(s=navigator.connection.downlink,typeof s=="number")?s:5}var ng=null,rg=null;function vh(s){return s.nodeType===9?s:s.ownerDocument}function Gv(s){switch(s){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Qv(s,a){if(s===0)switch(a){case"svg":return 1;case"math":return 2;default:return 0}return s===1&&a==="foreignObject"?0:s}function sg(s,a){return s==="textarea"||s==="noscript"||typeof a.children=="string"||typeof a.children=="number"||typeof a.children=="bigint"||typeof a.dangerouslySetInnerHTML=="object"&&a.dangerouslySetInnerHTML!==null&&a.dangerouslySetInnerHTML.__html!=null}var ig=null;function l2(){var s=window.event;return s&&s.type==="popstate"?s===ig?!1:(ig=s,!0):(ig=null,!1)}var Wv=typeof setTimeout=="function"?setTimeout:void 0,c2=typeof clearTimeout=="function"?clearTimeout:void 0,Kv=typeof Promise=="function"?Promise:void 0,u2=typeof queueMicrotask=="function"?queueMicrotask:typeof Kv<"u"?function(s){return Kv.resolve(null).then(s).catch(d2)}:Wv;function d2(s){setTimeout(function(){throw s})}function ea(s){return s==="head"}function Yv(s,a){var c=a,f=0;do{var _=c.nextSibling;if(s.removeChild(c),_&&_.nodeType===8)if(c=_.data,c==="/$"||c==="/&"){if(f===0){s.removeChild(_),Al(a);return}f--}else if(c==="$"||c==="$?"||c==="$~"||c==="$!"||c==="&")f++;else if(c==="html")cu(s.ownerDocument.documentElement);else if(c==="head"){c=s.ownerDocument.head,cu(c);for(var w=c.firstChild;w;){var z=w.nextSibling,Q=w.nodeName;w[xs]||Q==="SCRIPT"||Q==="STYLE"||Q==="LINK"&&w.rel.toLowerCase()==="stylesheet"||c.removeChild(w),w=z}}else c==="body"&&cu(s.ownerDocument.body);c=_}while(c);Al(a)}function Xv(s,a){var c=s;s=0;do{var f=c.nextSibling;if(c.nodeType===1?a?(c._stashedDisplay=c.style.display,c.style.display="none"):(c.style.display=c._stashedDisplay||"",c.getAttribute("style")===""&&c.removeAttribute("style")):c.nodeType===3&&(a?(c._stashedText=c.nodeValue,c.nodeValue=""):c.nodeValue=c._stashedText||""),f&&f.nodeType===8)if(c=f.data,c==="/$"){if(s===0)break;s--}else c!=="$"&&c!=="$?"&&c!=="$~"&&c!=="$!"||s++;c=f}while(c)}function ag(s){var a=s.firstChild;for(a&&a.nodeType===10&&(a=a.nextSibling);a;){var c=a;switch(a=a.nextSibling,c.nodeName){case"HTML":case"HEAD":case"BODY":ag(c),$o(c);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(c.rel.toLowerCase()==="stylesheet")continue}s.removeChild(c)}}function h2(s,a,c,f){for(;s.nodeType===1;){var _=c;if(s.nodeName.toLowerCase()!==a.toLowerCase()){if(!f&&(s.nodeName!=="INPUT"||s.type!=="hidden"))break}else if(f){if(!s[xs])switch(a){case"meta":if(!s.hasAttribute("itemprop"))break;return s;case"link":if(w=s.getAttribute("rel"),w==="stylesheet"&&s.hasAttribute("data-precedence"))break;if(w!==_.rel||s.getAttribute("href")!==(_.href==null||_.href===""?null:_.href)||s.getAttribute("crossorigin")!==(_.crossOrigin==null?null:_.crossOrigin)||s.getAttribute("title")!==(_.title==null?null:_.title))break;return s;case"style":if(s.hasAttribute("data-precedence"))break;return s;case"script":if(w=s.getAttribute("src"),(w!==(_.src==null?null:_.src)||s.getAttribute("type")!==(_.type==null?null:_.type)||s.getAttribute("crossorigin")!==(_.crossOrigin==null?null:_.crossOrigin))&&w&&s.hasAttribute("async")&&!s.hasAttribute("itemprop"))break;return s;default:return s}}else if(a==="input"&&s.type==="hidden"){var w=_.name==null?null:""+_.name;if(_.type==="hidden"&&s.getAttribute("name")===w)return s}else return s;if(s=Vr(s.nextSibling),s===null)break}return null}function f2(s,a,c){if(a==="")return null;for(;s.nodeType!==3;)if((s.nodeType!==1||s.nodeName!=="INPUT"||s.type!=="hidden")&&!c||(s=Vr(s.nextSibling),s===null))return null;return s}function Zv(s,a){for(;s.nodeType!==8;)if((s.nodeType!==1||s.nodeName!=="INPUT"||s.type!=="hidden")&&!a||(s=Vr(s.nextSibling),s===null))return null;return s}function og(s){return s.data==="$?"||s.data==="$~"}function lg(s){return s.data==="$!"||s.data==="$?"&&s.ownerDocument.readyState!=="loading"}function m2(s,a){var c=s.ownerDocument;if(s.data==="$~")s._reactRetry=a;else if(s.data!=="$?"||c.readyState!=="loading")a();else{var f=function(){a(),c.removeEventListener("DOMContentLoaded",f)};c.addEventListener("DOMContentLoaded",f),s._reactRetry=f}}function Vr(s){for(;s!=null;s=s.nextSibling){var a=s.nodeType;if(a===1||a===3)break;if(a===8){if(a=s.data,a==="$"||a==="$!"||a==="$?"||a==="$~"||a==="&"||a==="F!"||a==="F")break;if(a==="/$"||a==="/&")return null}}return s}var cg=null;function Jv(s){s=s.nextSibling;for(var a=0;s;){if(s.nodeType===8){var c=s.data;if(c==="/$"||c==="/&"){if(a===0)return Vr(s.nextSibling);a--}else c!=="$"&&c!=="$!"&&c!=="$?"&&c!=="$~"&&c!=="&"||a++}s=s.nextSibling}return null}function ex(s){s=s.previousSibling;for(var a=0;s;){if(s.nodeType===8){var c=s.data;if(c==="$"||c==="$!"||c==="$?"||c==="$~"||c==="&"){if(a===0)return s;a--}else c!=="/$"&&c!=="/&"||a++}s=s.previousSibling}return null}function tx(s,a,c){switch(a=vh(c),s){case"html":if(s=a.documentElement,!s)throw Error(r(452));return s;case"head":if(s=a.head,!s)throw Error(r(453));return s;case"body":if(s=a.body,!s)throw Error(r(454));return s;default:throw Error(r(451))}}function cu(s){for(var a=s.attributes;a.length;)s.removeAttributeNode(a[0]);$o(s)}var $r=new Map,nx=new Set;function xh(s){return typeof s.getRootNode=="function"?s.getRootNode():s.nodeType===9?s:s.ownerDocument}var hi=H.d;H.d={f:p2,r:g2,D:y2,C:_2,L:b2,m:v2,X:w2,S:x2,M:S2};function p2(){var s=hi.f(),a=hh();return s||a}function g2(s){var a=Dr(s);a!==null&&a.tag===5&&a.type==="form"?bb(a):hi.r(s)}var Cl=typeof document>"u"?null:document;function rx(s,a,c){var f=Cl;if(f&&typeof a=="string"&&a){var _=ar(a);_='link[rel="'+s+'"][href="'+_+'"]',typeof c=="string"&&(_+='[crossorigin="'+c+'"]'),nx.has(_)||(nx.add(_),s={rel:s,crossOrigin:c,href:a},f.querySelector(_)===null&&(a=f.createElement("link"),Un(a,"link",s),fn(a),f.head.appendChild(a)))}}function y2(s){hi.D(s),rx("dns-prefetch",s,null)}function _2(s,a){hi.C(s,a),rx("preconnect",s,a)}function b2(s,a,c){hi.L(s,a,c);var f=Cl;if(f&&s&&a){var _='link[rel="preload"][as="'+ar(a)+'"]';a==="image"&&c&&c.imageSrcSet?(_+='[imagesrcset="'+ar(c.imageSrcSet)+'"]',typeof c.imageSizes=="string"&&(_+='[imagesizes="'+ar(c.imageSizes)+'"]')):_+='[href="'+ar(s)+'"]';var w=_;switch(a){case"style":w=El(s);break;case"script":w=Tl(s)}$r.has(w)||(s=g({rel:"preload",href:a==="image"&&c&&c.imageSrcSet?void 0:s,as:a},c),$r.set(w,s),f.querySelector(_)!==null||a==="style"&&f.querySelector(uu(w))||a==="script"&&f.querySelector(du(w))||(a=f.createElement("link"),Un(a,"link",s),fn(a),f.head.appendChild(a)))}}function v2(s,a){hi.m(s,a);var c=Cl;if(c&&s){var f=a&&typeof a.as=="string"?a.as:"script",_='link[rel="modulepreload"][as="'+ar(f)+'"][href="'+ar(s)+'"]',w=_;switch(f){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":w=Tl(s)}if(!$r.has(w)&&(s=g({rel:"modulepreload",href:s},a),$r.set(w,s),c.querySelector(_)===null)){switch(f){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(c.querySelector(du(w)))return}f=c.createElement("link"),Un(f,"link",s),fn(f),c.head.appendChild(f)}}}function x2(s,a,c){hi.S(s,a,c);var f=Cl;if(f&&s){var _=Ss(f).hoistableStyles,w=El(s);a=a||"default";var z=_.get(w);if(!z){var Q={loading:0,preload:null};if(z=f.querySelector(uu(w)))Q.loading=5;else{s=g({rel:"stylesheet",href:s,"data-precedence":a},c),(c=$r.get(w))&&ug(s,c);var re=z=f.createElement("link");fn(re),Un(re,"link",s),re._p=new Promise(function(ge,Ee){re.onload=ge,re.onerror=Ee}),re.addEventListener("load",function(){Q.loading|=1}),re.addEventListener("error",function(){Q.loading|=2}),Q.loading|=4,wh(z,a,f)}z={type:"stylesheet",instance:z,count:1,state:Q},_.set(w,z)}}}function w2(s,a){hi.X(s,a);var c=Cl;if(c&&s){var f=Ss(c).hoistableScripts,_=Tl(s),w=f.get(_);w||(w=c.querySelector(du(_)),w||(s=g({src:s,async:!0},a),(a=$r.get(_))&&dg(s,a),w=c.createElement("script"),fn(w),Un(w,"link",s),c.head.appendChild(w)),w={type:"script",instance:w,count:1,state:null},f.set(_,w))}}function S2(s,a){hi.M(s,a);var c=Cl;if(c&&s){var f=Ss(c).hoistableScripts,_=Tl(s),w=f.get(_);w||(w=c.querySelector(du(_)),w||(s=g({src:s,async:!0,type:"module"},a),(a=$r.get(_))&&dg(s,a),w=c.createElement("script"),fn(w),Un(w,"link",s),c.head.appendChild(w)),w={type:"script",instance:w,count:1,state:null},f.set(_,w))}}function sx(s,a,c,f){var _=(_=ue.current)?xh(_):null;if(!_)throw Error(r(446));switch(s){case"meta":case"title":return null;case"style":return typeof c.precedence=="string"&&typeof c.href=="string"?(a=El(c.href),c=Ss(_).hoistableStyles,f=c.get(a),f||(f={type:"style",instance:null,count:0,state:null},c.set(a,f)),f):{type:"void",instance:null,count:0,state:null};case"link":if(c.rel==="stylesheet"&&typeof c.href=="string"&&typeof c.precedence=="string"){s=El(c.href);var w=Ss(_).hoistableStyles,z=w.get(s);if(z||(_=_.ownerDocument||_,z={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},w.set(s,z),(w=_.querySelector(uu(s)))&&!w._p&&(z.instance=w,z.state.loading=5),$r.has(s)||(c={rel:"preload",as:"style",href:c.href,crossOrigin:c.crossOrigin,integrity:c.integrity,media:c.media,hrefLang:c.hrefLang,referrerPolicy:c.referrerPolicy},$r.set(s,c),w||C2(_,s,c,z.state))),a&&f===null)throw Error(r(528,""));return z}if(a&&f!==null)throw Error(r(529,""));return null;case"script":return a=c.async,c=c.src,typeof c=="string"&&a&&typeof a!="function"&&typeof a!="symbol"?(a=Tl(c),c=Ss(_).hoistableScripts,f=c.get(a),f||(f={type:"script",instance:null,count:0,state:null},c.set(a,f)),f):{type:"void",instance:null,count:0,state:null};default:throw Error(r(444,s))}}function El(s){return'href="'+ar(s)+'"'}function uu(s){return'link[rel="stylesheet"]['+s+"]"}function ix(s){return g({},s,{"data-precedence":s.precedence,precedence:null})}function C2(s,a,c,f){s.querySelector('link[rel="preload"][as="style"]['+a+"]")?f.loading=1:(a=s.createElement("link"),f.preload=a,a.addEventListener("load",function(){return f.loading|=1}),a.addEventListener("error",function(){return f.loading|=2}),Un(a,"link",c),fn(a),s.head.appendChild(a))}function Tl(s){return'[src="'+ar(s)+'"]'}function du(s){return"script[async]"+s}function ax(s,a,c){if(a.count++,a.instance===null)switch(a.type){case"style":var f=s.querySelector('style[data-href~="'+ar(c.href)+'"]');if(f)return a.instance=f,fn(f),f;var _=g({},c,{"data-href":c.href,"data-precedence":c.precedence,href:null,precedence:null});return f=(s.ownerDocument||s).createElement("style"),fn(f),Un(f,"style",_),wh(f,c.precedence,s),a.instance=f;case"stylesheet":_=El(c.href);var w=s.querySelector(uu(_));if(w)return a.state.loading|=4,a.instance=w,fn(w),w;f=ix(c),(_=$r.get(_))&&ug(f,_),w=(s.ownerDocument||s).createElement("link"),fn(w);var z=w;return z._p=new Promise(function(Q,re){z.onload=Q,z.onerror=re}),Un(w,"link",f),a.state.loading|=4,wh(w,c.precedence,s),a.instance=w;case"script":return w=Tl(c.src),(_=s.querySelector(du(w)))?(a.instance=_,fn(_),_):(f=c,(_=$r.get(w))&&(f=g({},c),dg(f,_)),s=s.ownerDocument||s,_=s.createElement("script"),fn(_),Un(_,"link",f),s.head.appendChild(_),a.instance=_);case"void":return null;default:throw Error(r(443,a.type))}else a.type==="stylesheet"&&(a.state.loading&4)===0&&(f=a.instance,a.state.loading|=4,wh(f,c.precedence,s));return a.instance}function wh(s,a,c){for(var f=c.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),_=f.length?f[f.length-1]:null,w=_,z=0;z<f.length;z++){var Q=f[z];if(Q.dataset.precedence===a)w=Q;else if(w!==_)break}w?w.parentNode.insertBefore(s,w.nextSibling):(a=c.nodeType===9?c.head:c,a.insertBefore(s,a.firstChild))}function ug(s,a){s.crossOrigin==null&&(s.crossOrigin=a.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=a.referrerPolicy),s.title==null&&(s.title=a.title)}function dg(s,a){s.crossOrigin==null&&(s.crossOrigin=a.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=a.referrerPolicy),s.integrity==null&&(s.integrity=a.integrity)}var Sh=null;function ox(s,a,c){if(Sh===null){var f=new Map,_=Sh=new Map;_.set(c,f)}else _=Sh,f=_.get(c),f||(f=new Map,_.set(c,f));if(f.has(s))return f;for(f.set(s,null),c=c.getElementsByTagName(s),_=0;_<c.length;_++){var w=c[_];if(!(w[xs]||w[hn]||s==="link"&&w.getAttribute("rel")==="stylesheet")&&w.namespaceURI!=="http://www.w3.org/2000/svg"){var z=w.getAttribute(a)||"";z=s+z;var Q=f.get(z);Q?Q.push(w):f.set(z,[w])}}return f}function lx(s,a,c){s=s.ownerDocument||s,s.head.insertBefore(c,a==="title"?s.querySelector("head > title"):null)}function E2(s,a,c){if(c===1||a.itemProp!=null)return!1;switch(s){case"meta":case"title":return!0;case"style":if(typeof a.precedence!="string"||typeof a.href!="string"||a.href==="")break;return!0;case"link":if(typeof a.rel!="string"||typeof a.href!="string"||a.href===""||a.onLoad||a.onError)break;return a.rel==="stylesheet"?(s=a.disabled,typeof a.precedence=="string"&&s==null):!0;case"script":if(a.async&&typeof a.async!="function"&&typeof a.async!="symbol"&&!a.onLoad&&!a.onError&&a.src&&typeof a.src=="string")return!0}return!1}function cx(s){return!(s.type==="stylesheet"&&(s.state.loading&3)===0)}function T2(s,a,c,f){if(c.type==="stylesheet"&&(typeof f.media!="string"||matchMedia(f.media).matches!==!1)&&(c.state.loading&4)===0){if(c.instance===null){var _=El(f.href),w=a.querySelector(uu(_));if(w){a=w._p,a!==null&&typeof a=="object"&&typeof a.then=="function"&&(s.count++,s=Ch.bind(s),a.then(s,s)),c.state.loading|=4,c.instance=w,fn(w);return}w=a.ownerDocument||a,f=ix(f),(_=$r.get(_))&&ug(f,_),w=w.createElement("link"),fn(w);var z=w;z._p=new Promise(function(Q,re){z.onload=Q,z.onerror=re}),Un(w,"link",f),c.instance=w}s.stylesheets===null&&(s.stylesheets=new Map),s.stylesheets.set(c,a),(a=c.state.preload)&&(c.state.loading&3)===0&&(s.count++,c=Ch.bind(s),a.addEventListener("load",c),a.addEventListener("error",c))}}var hg=0;function A2(s,a){return s.stylesheets&&s.count===0&&Th(s,s.stylesheets),0<s.count||0<s.imgCount?function(c){var f=setTimeout(function(){if(s.stylesheets&&Th(s,s.stylesheets),s.unsuspend){var w=s.unsuspend;s.unsuspend=null,w()}},6e4+a);0<s.imgBytes&&hg===0&&(hg=62500*o2());var _=setTimeout(function(){if(s.waitingForImages=!1,s.count===0&&(s.stylesheets&&Th(s,s.stylesheets),s.unsuspend)){var w=s.unsuspend;s.unsuspend=null,w()}},(s.imgBytes>hg?50:800)+a);return s.unsuspend=c,function(){s.unsuspend=null,clearTimeout(f),clearTimeout(_)}}:null}function Ch(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)Th(this,this.stylesheets);else if(this.unsuspend){var s=this.unsuspend;this.unsuspend=null,s()}}}var Eh=null;function Th(s,a){s.stylesheets=null,s.unsuspend!==null&&(s.count++,Eh=new Map,a.forEach(j2,s),Eh=null,Ch.call(s))}function j2(s,a){if(!(a.state.loading&4)){var c=Eh.get(s);if(c)var f=c.get(null);else{c=new Map,Eh.set(s,c);for(var _=s.querySelectorAll("link[data-precedence],style[data-precedence]"),w=0;w<_.length;w++){var z=_[w];(z.nodeName==="LINK"||z.getAttribute("media")!=="not all")&&(c.set(z.dataset.precedence,z),f=z)}f&&c.set(null,f)}_=a.instance,z=_.getAttribute("data-precedence"),w=c.get(z)||f,w===f&&c.set(null,_),c.set(z,_),this.count++,f=Ch.bind(this),_.addEventListener("load",f),_.addEventListener("error",f),w?w.parentNode.insertBefore(_,w.nextSibling):(s=s.nodeType===9?s.head:s,s.insertBefore(_,s.firstChild)),a.state.loading|=4}}var hu={$$typeof:I,Provider:null,Consumer:null,_currentValue:Z,_currentValue2:Z,_threadCount:0};function R2(s,a,c,f,_,w,z,Q,re){this.tag=1,this.containerInfo=s,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=bs(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=bs(0),this.hiddenUpdates=bs(null),this.identifierPrefix=f,this.onUncaughtError=_,this.onCaughtError=w,this.onRecoverableError=z,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=re,this.incompleteTransitions=new Map}function ux(s,a,c,f,_,w,z,Q,re,ge,Ee,Re){return s=new R2(s,a,c,z,re,ge,Ee,Re,Q),a=1,w===!0&&(a|=24),w=wr(3,null,null,a),s.current=w,w.stateNode=s,a=Hm(),a.refCount++,s.pooledCache=a,a.refCount++,w.memoizedState={element:f,isDehydrated:c,cache:a},Km(w),s}function dx(s){return s?(s=rl,s):rl}function hx(s,a,c,f,_,w){_=dx(_),f.context===null?f.context=_:f.pendingContext=_,f=$i(a),f.payload={element:c},w=w===void 0?null:w,w!==null&&(f.callback=w),c=qi(s,f,a),c!==null&&(hr(c,s,a),qc(c,s,a))}function fx(s,a){if(s=s.memoizedState,s!==null&&s.dehydrated!==null){var c=s.retryLane;s.retryLane=c!==0&&c<a?c:a}}function fg(s,a){fx(s,a),(s=s.alternate)&&fx(s,a)}function mx(s){if(s.tag===13||s.tag===31){var a=no(s,67108864);a!==null&&hr(a,s,67108864),fg(s,67108864)}}function px(s){if(s.tag===13||s.tag===31){var a=Ar();a=qa(a);var c=no(s,a);c!==null&&hr(c,s,a),fg(s,a)}}var Ah=!0;function I2(s,a,c,f){var _=W.T;W.T=null;var w=H.p;try{H.p=2,mg(s,a,c,f)}finally{H.p=w,W.T=_}}function k2(s,a,c,f){var _=W.T;W.T=null;var w=H.p;try{H.p=8,mg(s,a,c,f)}finally{H.p=w,W.T=_}}function mg(s,a,c,f){if(Ah){var _=pg(f);if(_===null)eg(s,a,f,jh,c),yx(s,f);else if(M2(_,s,a,c,f))f.stopPropagation();else if(yx(s,f),a&4&&-1<D2.indexOf(s)){for(;_!==null;){var w=Dr(_);if(w!==null)switch(w.tag){case 3:if(w=w.stateNode,w.current.memoizedState.isDehydrated){var z=nr(w.pendingLanes);if(z!==0){var Q=w;for(Q.pendingLanes|=2,Q.entangledLanes|=2;z;){var re=1<<31-Tt(z);Q.entanglements[1]|=re,z&=~re}Ps(w),(jt&6)===0&&(uh=Oe()+500,au(0))}}break;case 31:case 13:Q=no(w,2),Q!==null&&hr(Q,w,2),hh(),fg(w,2)}if(w=pg(f),w===null&&eg(s,a,f,jh,c),w===_)break;_=w}_!==null&&f.stopPropagation()}else eg(s,a,f,null,c)}}function pg(s){return s=Mr(s),gg(s)}var jh=null;function gg(s){if(jh=null,s=ws(s),s!==null){var a=o(s);if(a===null)s=null;else{var c=a.tag;if(c===13){if(s=l(a),s!==null)return s;s=null}else if(c===31){if(s=d(a),s!==null)return s;s=null}else if(c===3){if(a.stateNode.current.memoizedState.isDehydrated)return a.tag===3?a.stateNode.containerInfo:null;s=null}else a!==s&&(s=null)}}return jh=s,null}function gx(s){switch(s){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(De()){case qe:return 2;case St:return 8;case tt:case Wn:return 32;case ps:return 268435456;default:return 32}default:return 32}}var yg=!1,ta=null,na=null,ra=null,fu=new Map,mu=new Map,sa=[],D2="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function yx(s,a){switch(s){case"focusin":case"focusout":ta=null;break;case"dragenter":case"dragleave":na=null;break;case"mouseover":case"mouseout":ra=null;break;case"pointerover":case"pointerout":fu.delete(a.pointerId);break;case"gotpointercapture":case"lostpointercapture":mu.delete(a.pointerId)}}function pu(s,a,c,f,_,w){return s===null||s.nativeEvent!==w?(s={blockedOn:a,domEventName:c,eventSystemFlags:f,nativeEvent:w,targetContainers:[_]},a!==null&&(a=Dr(a),a!==null&&mx(a)),s):(s.eventSystemFlags|=f,a=s.targetContainers,_!==null&&a.indexOf(_)===-1&&a.push(_),s)}function M2(s,a,c,f,_){switch(a){case"focusin":return ta=pu(ta,s,a,c,f,_),!0;case"dragenter":return na=pu(na,s,a,c,f,_),!0;case"mouseover":return ra=pu(ra,s,a,c,f,_),!0;case"pointerover":var w=_.pointerId;return fu.set(w,pu(fu.get(w)||null,s,a,c,f,_)),!0;case"gotpointercapture":return w=_.pointerId,mu.set(w,pu(mu.get(w)||null,s,a,c,f,_)),!0}return!1}function _x(s){var a=ws(s.target);if(a!==null){var c=o(a);if(c!==null){if(a=c.tag,a===13){if(a=l(c),a!==null){s.blockedOn=a,Yr(s.priority,function(){px(c)});return}}else if(a===31){if(a=d(c),a!==null){s.blockedOn=a,Yr(s.priority,function(){px(c)});return}}else if(a===3&&c.stateNode.current.memoizedState.isDehydrated){s.blockedOn=c.tag===3?c.stateNode.containerInfo:null;return}}}s.blockedOn=null}function Rh(s){if(s.blockedOn!==null)return!1;for(var a=s.targetContainers;0<a.length;){var c=pg(s.nativeEvent);if(c===null){c=s.nativeEvent;var f=new c.constructor(c.type,c);jc=f,c.target.dispatchEvent(f),jc=null}else return a=Dr(c),a!==null&&mx(a),s.blockedOn=c,!1;a.shift()}return!0}function bx(s,a,c){Rh(s)&&c.delete(a)}function O2(){yg=!1,ta!==null&&Rh(ta)&&(ta=null),na!==null&&Rh(na)&&(na=null),ra!==null&&Rh(ra)&&(ra=null),fu.forEach(bx),mu.forEach(bx)}function Ih(s,a){s.blockedOn===a&&(s.blockedOn=null,yg||(yg=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,O2)))}var kh=null;function vx(s){kh!==s&&(kh=s,t.unstable_scheduleCallback(t.unstable_NormalPriority,function(){kh===s&&(kh=null);for(var a=0;a<s.length;a+=3){var c=s[a],f=s[a+1],_=s[a+2];if(typeof f!="function"){if(gg(f||c)===null)continue;break}var w=Dr(c);w!==null&&(s.splice(a,3),a-=3,pp(w,{pending:!0,data:_,method:c.method,action:f},f,_))}}))}function Al(s){function a(re){return Ih(re,s)}ta!==null&&Ih(ta,s),na!==null&&Ih(na,s),ra!==null&&Ih(ra,s),fu.forEach(a),mu.forEach(a);for(var c=0;c<sa.length;c++){var f=sa[c];f.blockedOn===s&&(f.blockedOn=null)}for(;0<sa.length&&(c=sa[0],c.blockedOn===null);)_x(c),c.blockedOn===null&&sa.shift();if(c=(s.ownerDocument||s).$$reactFormReplay,c!=null)for(f=0;f<c.length;f+=3){var _=c[f],w=c[f+1],z=_[In]||null;if(typeof w=="function")z||vx(c);else if(z){var Q=null;if(w&&w.hasAttribute("formAction")){if(_=w,z=w[In]||null)Q=z.formAction;else if(gg(_)!==null)continue}else Q=z.action;typeof Q=="function"?c[f+1]=Q:(c.splice(f,3),f-=3),vx(c)}}}function xx(){function s(w){w.canIntercept&&w.info==="react-transition"&&w.intercept({handler:function(){return new Promise(function(z){return _=z})},focusReset:"manual",scroll:"manual"})}function a(){_!==null&&(_(),_=null),f||setTimeout(c,20)}function c(){if(!f&&!navigation.transition){var w=navigation.currentEntry;w&&w.url!=null&&navigation.navigate(w.url,{state:w.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var f=!1,_=null;return navigation.addEventListener("navigate",s),navigation.addEventListener("navigatesuccess",a),navigation.addEventListener("navigateerror",a),setTimeout(c,100),function(){f=!0,navigation.removeEventListener("navigate",s),navigation.removeEventListener("navigatesuccess",a),navigation.removeEventListener("navigateerror",a),_!==null&&(_(),_=null)}}}function _g(s){this._internalRoot=s}Dh.prototype.render=_g.prototype.render=function(s){var a=this._internalRoot;if(a===null)throw Error(r(409));var c=a.current,f=Ar();hx(c,f,s,a,null,null)},Dh.prototype.unmount=_g.prototype.unmount=function(){var s=this._internalRoot;if(s!==null){this._internalRoot=null;var a=s.containerInfo;hx(s.current,2,null,s,null,null),hh(),a[vs]=null}};function Dh(s){this._internalRoot=s}Dh.prototype.unstable_scheduleHydration=function(s){if(s){var a=hd();s={blockedOn:null,target:s,priority:a};for(var c=0;c<sa.length&&a!==0&&a<sa[c].priority;c++);sa.splice(c,0,s),c===0&&_x(s)}};var wx=e.version;if(wx!=="19.2.3")throw Error(r(527,wx,"19.2.3"));H.findDOMNode=function(s){var a=s._reactInternals;if(a===void 0)throw typeof s.render=="function"?Error(r(188)):(s=Object.keys(s).join(","),Error(r(268,s)));return s=m(a),s=s!==null?p(s):null,s=s===null?null:s.stateNode,s};var N2={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:W,reconcilerVersion:"19.2.3"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Mh=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Mh.isDisabled&&Mh.supportsFiber)try{xt=Mh.inject(N2),tn=Mh}catch{}}return yu.createRoot=function(s,a){if(!i(s))throw Error(r(299));var c=!1,f="",_=Rb,w=Ib,z=kb;return a!=null&&(a.unstable_strictMode===!0&&(c=!0),a.identifierPrefix!==void 0&&(f=a.identifierPrefix),a.onUncaughtError!==void 0&&(_=a.onUncaughtError),a.onCaughtError!==void 0&&(w=a.onCaughtError),a.onRecoverableError!==void 0&&(z=a.onRecoverableError)),a=ux(s,1,!1,null,null,c,f,null,_,w,z,xx),s[vs]=a.current,Jp(s),new _g(a)},yu.hydrateRoot=function(s,a,c){if(!i(s))throw Error(r(299));var f=!1,_="",w=Rb,z=Ib,Q=kb,re=null;return c!=null&&(c.unstable_strictMode===!0&&(f=!0),c.identifierPrefix!==void 0&&(_=c.identifierPrefix),c.onUncaughtError!==void 0&&(w=c.onUncaughtError),c.onCaughtError!==void 0&&(z=c.onCaughtError),c.onRecoverableError!==void 0&&(Q=c.onRecoverableError),c.formState!==void 0&&(re=c.formState)),a=ux(s,1,!0,a,c??null,f,_,re,w,z,Q,xx),a.context=dx(null),c=a.current,f=Ar(),f=qa(f),_=$i(f),_.callback=null,qi(c,_,f),c=f,a.current.lanes=c,Va(a,c),Ps(a),s[vs]=a.current,Jp(s),new Dh(a)},yu.version="19.2.3",yu}var Dx;function G2(){if(Dx)return xg.exports;Dx=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),xg.exports=H2(),xg.exports}var Q2=G2();var Mx="popstate";function W2(t={}){function e(r,i){let{pathname:o,search:l,hash:d}=r.location;return Kg("",{pathname:o,search:l,hash:d},i.state&&i.state.usr||null,i.state&&i.state.key||"default")}function n(r,i){return typeof i=="string"?i:ku(i)}return Y2(e,n,null,t)}function Zt(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function Rr(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function K2(){return Math.random().toString(36).substring(2,10)}function Ox(t,e){return{usr:t.state,key:t.key,idx:e}}function Kg(t,e,n=null,r){return{pathname:typeof t=="string"?t:t.pathname,search:"",hash:"",...typeof e=="string"?Jl(e):e,state:n,key:e&&e.key||r||K2()}}function ku({pathname:t="/",search:e="",hash:n=""}){return e&&e!=="?"&&(t+=e.charAt(0)==="?"?e:"?"+e),n&&n!=="#"&&(t+=n.charAt(0)==="#"?n:"#"+n),t}function Jl(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substring(n),t=t.substring(0,n));let r=t.indexOf("?");r>=0&&(e.search=t.substring(r),t=t.substring(0,r)),t&&(e.pathname=t)}return e}function Y2(t,e,n,r={}){let{window:i=document.defaultView,v5Compat:o=!1}=r,l=i.history,d="POP",h=null,m=p();m==null&&(m=0,l.replaceState({...l.state,idx:m},""));function p(){return(l.state||{idx:null}).idx}function g(){d="POP";let S=p(),E=S==null?null:S-m;m=S,h&&h({action:d,location:x.location,delta:E})}function v(S,E){d="PUSH";let T=Kg(x.location,S,E);m=p()+1;let I=Ox(T,m),D=x.createHref(T);try{l.pushState(I,"",D)}catch(B){if(B instanceof DOMException&&B.name==="DataCloneError")throw B;i.location.assign(D)}o&&h&&h({action:d,location:x.location,delta:1})}function b(S,E){d="REPLACE";let T=Kg(x.location,S,E);m=p();let I=Ox(T,m),D=x.createHref(T);l.replaceState(I,"",D),o&&h&&h({action:d,location:x.location,delta:0})}function C(S){return X2(S)}let x={get action(){return d},get location(){return t(i,l)},listen(S){if(h)throw new Error("A history only accepts one active listener");return i.addEventListener(Mx,g),h=S,()=>{i.removeEventListener(Mx,g),h=null}},createHref(S){return e(i,S)},createURL:C,encodeLocation(S){let E=C(S);return{pathname:E.pathname,search:E.search,hash:E.hash}},push:v,replace:b,go(S){return l.go(S)}};return x}function X2(t,e=!1){let n="http://localhost";typeof window<"u"&&(n=window.location.origin!=="null"?window.location.origin:window.location.href),Zt(n,"No window.location.(origin|href) available to create URL");let r=typeof t=="string"?t:ku(t);return r=r.replace(/ $/,"%20"),!e&&r.startsWith("//")&&(r=n+r),new URL(r,n)}function cS(t,e,n="/"){return Z2(t,e,n,!1)}function Z2(t,e,n,r){let i=typeof e=="string"?Jl(e):e,o=_i(i.pathname||"/",n);if(o==null)return null;let l=uS(t);J2(l);let d=null;for(let h=0;d==null&&h<l.length;++h){let m=u5(o);d=l5(l[h],m,r)}return d}function uS(t,e=[],n=[],r="",i=!1){let o=(l,d,h=i,m)=>{let p={relativePath:m===void 0?l.path||"":m,caseSensitive:l.caseSensitive===!0,childrenIndex:d,route:l};if(p.relativePath.startsWith("/")){if(!p.relativePath.startsWith(r)&&h)return;Zt(p.relativePath.startsWith(r),`Absolute route path "${p.relativePath}" nested under path "${r}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),p.relativePath=p.relativePath.slice(r.length)}let g=gi([r,p.relativePath]),v=n.concat(p);l.children&&l.children.length>0&&(Zt(l.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${g}".`),uS(l.children,e,v,g,h)),!(l.path==null&&!l.index)&&e.push({path:g,score:a5(g,l.index),routesMeta:v})};return t.forEach((l,d)=>{if(l.path===""||!l.path?.includes("?"))o(l,d);else for(let h of dS(l.path))o(l,d,!0,h)}),e}function dS(t){let e=t.split("/");if(e.length===0)return[];let[n,...r]=e,i=n.endsWith("?"),o=n.replace(/\?$/,"");if(r.length===0)return i?[o,""]:[o];let l=dS(r.join("/")),d=[];return d.push(...l.map(h=>h===""?o:[o,h].join("/"))),i&&d.push(...l),d.map(h=>t.startsWith("/")&&h===""?"/":h)}function J2(t){t.sort((e,n)=>e.score!==n.score?n.score-e.score:o5(e.routesMeta.map(r=>r.childrenIndex),n.routesMeta.map(r=>r.childrenIndex)))}var e5=/^:[\w-]+$/,t5=3,n5=2,r5=1,s5=10,i5=-2,Nx=t=>t==="*";function a5(t,e){let n=t.split("/"),r=n.length;return n.some(Nx)&&(r+=i5),e&&(r+=n5),n.filter(i=>!Nx(i)).reduce((i,o)=>i+(e5.test(o)?t5:o===""?r5:s5),r)}function o5(t,e){return t.length===e.length&&t.slice(0,-1).every((r,i)=>r===e[i])?t[t.length-1]-e[e.length-1]:0}function l5(t,e,n=!1){let{routesMeta:r}=t,i={},o="/",l=[];for(let d=0;d<r.length;++d){let h=r[d],m=d===r.length-1,p=o==="/"?e:e.slice(o.length)||"/",g=rf({path:h.relativePath,caseSensitive:h.caseSensitive,end:m},p),v=h.route;if(!g&&m&&n&&!r[r.length-1].route.index&&(g=rf({path:h.relativePath,caseSensitive:h.caseSensitive,end:!1},p)),!g)return null;Object.assign(i,g.params),l.push({params:i,pathname:gi([o,g.pathname]),pathnameBase:m5(gi([o,g.pathnameBase])),route:v}),g.pathnameBase!=="/"&&(o=gi([o,g.pathnameBase]))}return l}function rf(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,r]=c5(t.path,t.caseSensitive,t.end),i=e.match(n);if(!i)return null;let o=i[0],l=o.replace(/(.)\/+$/,"$1"),d=i.slice(1);return{params:r.reduce((m,{paramName:p,isOptional:g},v)=>{if(p==="*"){let C=d[v]||"";l=o.slice(0,o.length-C.length).replace(/(.)\/+$/,"$1")}const b=d[v];return g&&!b?m[p]=void 0:m[p]=(b||"").replace(/%2F/g,"/"),m},{}),pathname:o,pathnameBase:l,pattern:t}}function c5(t,e=!1,n=!0){Rr(t==="*"||!t.endsWith("*")||t.endsWith("/*"),`Route path "${t}" will be treated as if it were "${t.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${t.replace(/\*$/,"/*")}".`);let r=[],i="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(l,d,h)=>(r.push({paramName:d,isOptional:h!=null}),h?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return t.endsWith("*")?(r.push({paramName:"*"}),i+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?i+="\\/*$":t!==""&&t!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,e?void 0:"i"),r]}function u5(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return Rr(!1,`The URL path "${t}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),t}}function _i(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,r=t.charAt(n);return r&&r!=="/"?null:t.slice(n)||"/"}var hS=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,d5=t=>hS.test(t);function h5(t,e="/"){let{pathname:n,search:r="",hash:i=""}=typeof t=="string"?Jl(t):t,o;if(n)if(d5(n))o=n;else{if(n.includes("//")){let l=n;n=n.replace(/\/\/+/g,"/"),Rr(!1,`Pathnames cannot have embedded double slashes - normalizing ${l} -> ${n}`)}n.startsWith("/")?o=Px(n.substring(1),"/"):o=Px(n,e)}else o=e;return{pathname:o,search:p5(r),hash:g5(i)}}function Px(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(i=>{i===".."?n.length>1&&n.pop():i!=="."&&n.push(i)}),n.length>1?n.join("/"):"/"}function Eg(t,e,n,r){return`Cannot include a '${t}' character in a manually specified \`to.${e}\` field [${JSON.stringify(r)}].  Please separate it out to the \`to.${n}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function f5(t){return t.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function Oy(t){let e=f5(t);return e.map((n,r)=>r===e.length-1?n.pathname:n.pathnameBase)}function Ny(t,e,n,r=!1){let i;typeof t=="string"?i=Jl(t):(i={...t},Zt(!i.pathname||!i.pathname.includes("?"),Eg("?","pathname","search",i)),Zt(!i.pathname||!i.pathname.includes("#"),Eg("#","pathname","hash",i)),Zt(!i.search||!i.search.includes("#"),Eg("#","search","hash",i)));let o=t===""||i.pathname==="",l=o?"/":i.pathname,d;if(l==null)d=n;else{let g=e.length-1;if(!r&&l.startsWith("..")){let v=l.split("/");for(;v[0]==="..";)v.shift(),g-=1;i.pathname=v.join("/")}d=g>=0?e[g]:"/"}let h=h5(i,d),m=l&&l!=="/"&&l.endsWith("/"),p=(o||l===".")&&n.endsWith("/");return!h.pathname.endsWith("/")&&(m||p)&&(h.pathname+="/"),h}var gi=t=>t.join("/").replace(/\/\/+/g,"/"),m5=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),p5=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,g5=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t,y5=class{constructor(t,e,n,r=!1){this.status=t,this.statusText=e||"",this.internal=r,n instanceof Error?(this.data=n.toString(),this.error=n):this.data=n}};function _5(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}function b5(t){return t.map(e=>e.route.path).filter(Boolean).join("/").replace(/\/\/*/g,"/")||"/"}var fS=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function mS(t,e){let n=t;if(typeof n!="string"||!hS.test(n))return{absoluteURL:void 0,isExternal:!1,to:n};let r=n,i=!1;if(fS)try{let o=new URL(window.location.href),l=n.startsWith("//")?new URL(o.protocol+n):new URL(n),d=_i(l.pathname,e);l.origin===o.origin&&d!=null?n=d+l.search+l.hash:i=!0}catch{Rr(!1,`<Link to="${n}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}return{absoluteURL:r,isExternal:i,to:n}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var pS=["POST","PUT","PATCH","DELETE"];new Set(pS);var v5=["GET",...pS];new Set(v5);var ec=M.createContext(null);ec.displayName="DataRouter";var Pf=M.createContext(null);Pf.displayName="DataRouterState";var x5=M.createContext(!1),gS=M.createContext({isTransitioning:!1});gS.displayName="ViewTransition";var w5=M.createContext(new Map);w5.displayName="Fetchers";var S5=M.createContext(null);S5.displayName="Await";var Ir=M.createContext(null);Ir.displayName="Navigation";var Gu=M.createContext(null);Gu.displayName="Location";var Qr=M.createContext({outlet:null,matches:[],isDataRoute:!1});Qr.displayName="Route";var Py=M.createContext(null);Py.displayName="RouteError";var yS="REACT_ROUTER_ERROR",C5="REDIRECT",E5="ROUTE_ERROR_RESPONSE";function T5(t){if(t.startsWith(`${yS}:${C5}:{`))try{let e=JSON.parse(t.slice(28));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.location=="string"&&typeof e.reloadDocument=="boolean"&&typeof e.replace=="boolean")return e}catch{}}function A5(t){if(t.startsWith(`${yS}:${E5}:{`))try{let e=JSON.parse(t.slice(40));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string")return new y5(e.status,e.statusText,e.data)}catch{}}function j5(t,{relative:e}={}){Zt(tc(),"useHref() may be used only in the context of a <Router> component.");let{basename:n,navigator:r}=M.useContext(Ir),{hash:i,pathname:o,search:l}=Wu(t,{relative:e}),d=o;return n!=="/"&&(d=o==="/"?n:gi([n,o])),r.createHref({pathname:d,search:l,hash:i})}function tc(){return M.useContext(Gu)!=null}function Nn(){return Zt(tc(),"useLocation() may be used only in the context of a <Router> component."),M.useContext(Gu).location}var _S="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function bS(t){M.useContext(Ir).static||M.useLayoutEffect(t)}function Qu(){let{isDataRoute:t}=M.useContext(Qr);return t?q5():R5()}function R5(){Zt(tc(),"useNavigate() may be used only in the context of a <Router> component.");let t=M.useContext(ec),{basename:e,navigator:n}=M.useContext(Ir),{matches:r}=M.useContext(Qr),{pathname:i}=Nn(),o=JSON.stringify(Oy(r)),l=M.useRef(!1);return bS(()=>{l.current=!0}),M.useCallback((h,m={})=>{if(Rr(l.current,_S),!l.current)return;if(typeof h=="number"){n.go(h);return}let p=Ny(h,JSON.parse(o),i,m.relative==="path");t==null&&e!=="/"&&(p.pathname=p.pathname==="/"?e:gi([e,p.pathname])),(m.replace?n.replace:n.push)(p,m.state,m)},[e,n,o,i,t])}var I5=M.createContext(null);function k5(t){let e=M.useContext(Qr).outlet;return M.useMemo(()=>e&&M.createElement(I5.Provider,{value:t},e),[e,t])}function D5(){let{matches:t}=M.useContext(Qr),e=t[t.length-1];return e?e.params:{}}function Wu(t,{relative:e}={}){let{matches:n}=M.useContext(Qr),{pathname:r}=Nn(),i=JSON.stringify(Oy(n));return M.useMemo(()=>Ny(t,JSON.parse(i),r,e==="path"),[t,i,r,e])}function M5(t,e){return vS(t,e)}function vS(t,e,n,r,i){Zt(tc(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:o}=M.useContext(Ir),{matches:l}=M.useContext(Qr),d=l[l.length-1],h=d?d.params:{},m=d?d.pathname:"/",p=d?d.pathnameBase:"/",g=d&&d.route;{let T=g&&g.path||"";wS(m,!g||T.endsWith("*")||T.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${m}" (under <Route path="${T}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${T}"> to <Route path="${T==="/"?"*":`${T}/*`}">.`)}let v=Nn(),b;if(e){let T=typeof e=="string"?Jl(e):e;Zt(p==="/"||T.pathname?.startsWith(p),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${p}" but pathname "${T.pathname}" was given in the \`location\` prop.`),b=T}else b=v;let C=b.pathname||"/",x=C;if(p!=="/"){let T=p.replace(/^\//,"").split("/");x="/"+C.replace(/^\//,"").split("/").slice(T.length).join("/")}let S=cS(t,{pathname:x});Rr(g||S!=null,`No routes matched location "${b.pathname}${b.search}${b.hash}" `),Rr(S==null||S[S.length-1].route.element!==void 0||S[S.length-1].route.Component!==void 0||S[S.length-1].route.lazy!==void 0,`Matched leaf route at location "${b.pathname}${b.search}${b.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let E=B5(S&&S.map(T=>Object.assign({},T,{params:Object.assign({},h,T.params),pathname:gi([p,o.encodeLocation?o.encodeLocation(T.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:T.pathname]),pathnameBase:T.pathnameBase==="/"?p:gi([p,o.encodeLocation?o.encodeLocation(T.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:T.pathnameBase])})),l,n,r,i);return e&&E?M.createElement(Gu.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...b},navigationType:"POP"}},E):E}function O5(){let t=$5(),e=_5(t)?`${t.status} ${t.statusText}`:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,r="rgba(200,200,200, 0.5)",i={padding:"0.5rem",backgroundColor:r},o={padding:"2px 4px",backgroundColor:r},l=null;return console.error("Error handled by React Router default ErrorBoundary:",t),l=M.createElement(M.Fragment,null,M.createElement("p",null," Hey developer "),M.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",M.createElement("code",{style:o},"ErrorBoundary")," or"," ",M.createElement("code",{style:o},"errorElement")," prop on your route.")),M.createElement(M.Fragment,null,M.createElement("h2",null,"Unexpected Application Error!"),M.createElement("h3",{style:{fontStyle:"italic"}},e),n?M.createElement("pre",{style:i},n):null,l)}var N5=M.createElement(O5,null),xS=class extends M.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,e){return e.location!==t.location||e.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:e.error,location:e.location,revalidation:t.revalidation||e.revalidation}}componentDidCatch(t,e){this.props.onError?this.props.onError(t,e):console.error("React Router caught the following error during render",t)}render(){let t=this.state.error;if(this.context&&typeof t=="object"&&t&&"digest"in t&&typeof t.digest=="string"){const n=A5(t.digest);n&&(t=n)}let e=t!==void 0?M.createElement(Qr.Provider,{value:this.props.routeContext},M.createElement(Py.Provider,{value:t,children:this.props.component})):this.props.children;return this.context?M.createElement(P5,{error:t},e):e}};xS.contextType=x5;var Tg=new WeakMap;function P5({children:t,error:e}){let{basename:n}=M.useContext(Ir);if(typeof e=="object"&&e&&"digest"in e&&typeof e.digest=="string"){let r=T5(e.digest);if(r){let i=Tg.get(e);if(i)throw i;let o=mS(r.location,n);if(fS&&!Tg.get(e))if(o.isExternal||r.reloadDocument)window.location.href=o.absoluteURL||o.to;else{const l=Promise.resolve().then(()=>window.__reactRouterDataRouter.navigate(o.to,{replace:r.replace}));throw Tg.set(e,l),l}return M.createElement("meta",{httpEquiv:"refresh",content:`0;url=${o.absoluteURL||o.to}`})}}return t}function z5({routeContext:t,match:e,children:n}){let r=M.useContext(ec);return r&&r.static&&r.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=e.route.id),M.createElement(Qr.Provider,{value:t},n)}function B5(t,e=[],n=null,r=null,i=null){if(t==null){if(!n)return null;if(n.errors)t=n.matches;else if(e.length===0&&!n.initialized&&n.matches.length>0)t=n.matches;else return null}let o=t,l=n?.errors;if(l!=null){let p=o.findIndex(g=>g.route.id&&l?.[g.route.id]!==void 0);Zt(p>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(l).join(",")}`),o=o.slice(0,Math.min(o.length,p+1))}let d=!1,h=-1;if(n)for(let p=0;p<o.length;p++){let g=o[p];if((g.route.HydrateFallback||g.route.hydrateFallbackElement)&&(h=p),g.route.id){let{loaderData:v,errors:b}=n,C=g.route.loader&&!v.hasOwnProperty(g.route.id)&&(!b||b[g.route.id]===void 0);if(g.route.lazy||C){d=!0,h>=0?o=o.slice(0,h+1):o=[o[0]];break}}}let m=n&&r?(p,g)=>{r(p,{location:n.location,params:n.matches?.[0]?.params??{},unstable_pattern:b5(n.matches),errorInfo:g})}:void 0;return o.reduceRight((p,g,v)=>{let b,C=!1,x=null,S=null;n&&(b=l&&g.route.id?l[g.route.id]:void 0,x=g.route.errorElement||N5,d&&(h<0&&v===0?(wS("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),C=!0,S=null):h===v&&(C=!0,S=g.route.hydrateFallbackElement||null)));let E=e.concat(o.slice(0,v+1)),T=()=>{let I;return b?I=x:C?I=S:g.route.Component?I=M.createElement(g.route.Component,null):g.route.element?I=g.route.element:I=p,M.createElement(z5,{match:g,routeContext:{outlet:p,matches:E,isDataRoute:n!=null},children:I})};return n&&(g.route.ErrorBoundary||g.route.errorElement||v===0)?M.createElement(xS,{location:n.location,revalidation:n.revalidation,component:x,error:b,children:T(),routeContext:{outlet:null,matches:E,isDataRoute:!0},onError:m}):T()},null)}function zy(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function L5(t){let e=M.useContext(ec);return Zt(e,zy(t)),e}function U5(t){let e=M.useContext(Pf);return Zt(e,zy(t)),e}function F5(t){let e=M.useContext(Qr);return Zt(e,zy(t)),e}function By(t){let e=F5(t),n=e.matches[e.matches.length-1];return Zt(n.route.id,`${t} can only be used on routes that contain a unique "id"`),n.route.id}function V5(){return By("useRouteId")}function $5(){let t=M.useContext(Py),e=U5("useRouteError"),n=By("useRouteError");return t!==void 0?t:e.errors?.[n]}function q5(){let{router:t}=L5("useNavigate"),e=By("useNavigate"),n=M.useRef(!1);return bS(()=>{n.current=!0}),M.useCallback(async(i,o={})=>{Rr(n.current,_S),n.current&&(typeof i=="number"?await t.navigate(i):await t.navigate(i,{fromRouteId:e,...o}))},[t,e])}var zx={};function wS(t,e,n){!e&&!zx[t]&&(zx[t]=!0,Rr(!1,n))}M.memo(H5);function H5({routes:t,future:e,state:n,onError:r}){return vS(t,void 0,n,r,e)}function zf({to:t,replace:e,state:n,relative:r}){Zt(tc(),"<Navigate> may be used only in the context of a <Router> component.");let{static:i}=M.useContext(Ir);Rr(!i,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:o}=M.useContext(Qr),{pathname:l}=Nn(),d=Qu(),h=Ny(t,Oy(o),l,r==="path"),m=JSON.stringify(h);return M.useEffect(()=>{d(JSON.parse(m),{replace:e,state:n,relative:r})},[d,m,r,e,n]),null}function Bf(t){return k5(t.context)}function En(t){Zt(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function G5({basename:t="/",children:e=null,location:n,navigationType:r="POP",navigator:i,static:o=!1,unstable_useTransitions:l}){Zt(!tc(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let d=t.replace(/^\/*/,"/"),h=M.useMemo(()=>({basename:d,navigator:i,static:o,unstable_useTransitions:l,future:{}}),[d,i,o,l]);typeof n=="string"&&(n=Jl(n));let{pathname:m="/",search:p="",hash:g="",state:v=null,key:b="default"}=n,C=M.useMemo(()=>{let x=_i(m,d);return x==null?null:{location:{pathname:x,search:p,hash:g,state:v,key:b},navigationType:r}},[d,m,p,g,v,b,r]);return Rr(C!=null,`<Router basename="${d}"> is not able to match the URL "${m}${p}${g}" because it does not start with the basename, so the <Router> won't render anything.`),C==null?null:M.createElement(Ir.Provider,{value:h},M.createElement(Gu.Provider,{children:e,value:C}))}function Q5({children:t,location:e}){return M5(Yg(t),e)}function Yg(t,e=[]){let n=[];return M.Children.forEach(t,(r,i)=>{if(!M.isValidElement(r))return;let o=[...e,i];if(r.type===M.Fragment){n.push.apply(n,Yg(r.props.children,o));return}Zt(r.type===En,`[${typeof r.type=="string"?r.type:r.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),Zt(!r.props.index||!r.props.children,"An index route cannot have child routes.");let l={id:r.props.id||o.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,middleware:r.props.middleware,loader:r.props.loader,action:r.props.action,hydrateFallbackElement:r.props.hydrateFallbackElement,HydrateFallback:r.props.HydrateFallback,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.hasErrorBoundary===!0||r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(l.children=Yg(r.props.children,o)),n.push(l)}),n}var Hh="get",Gh="application/x-www-form-urlencoded";function Lf(t){return typeof HTMLElement<"u"&&t instanceof HTMLElement}function W5(t){return Lf(t)&&t.tagName.toLowerCase()==="button"}function K5(t){return Lf(t)&&t.tagName.toLowerCase()==="form"}function Y5(t){return Lf(t)&&t.tagName.toLowerCase()==="input"}function X5(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function Z5(t,e){return t.button===0&&(!e||e==="_self")&&!X5(t)}function Xg(t=""){return new URLSearchParams(typeof t=="string"||Array.isArray(t)||t instanceof URLSearchParams?t:Object.keys(t).reduce((e,n)=>{let r=t[n];return e.concat(Array.isArray(r)?r.map(i=>[n,i]):[[n,r]])},[]))}function J5(t,e){let n=Xg(t);return e&&e.forEach((r,i)=>{n.has(i)||e.getAll(i).forEach(o=>{n.append(i,o)})}),n}var Nh=null;function ej(){if(Nh===null)try{new FormData(document.createElement("form"),0),Nh=!1}catch{Nh=!0}return Nh}var tj=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function Ag(t){return t!=null&&!tj.has(t)?(Rr(!1,`"${t}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${Gh}"`),null):t}function nj(t,e){let n,r,i,o,l;if(K5(t)){let d=t.getAttribute("action");r=d?_i(d,e):null,n=t.getAttribute("method")||Hh,i=Ag(t.getAttribute("enctype"))||Gh,o=new FormData(t)}else if(W5(t)||Y5(t)&&(t.type==="submit"||t.type==="image")){let d=t.form;if(d==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let h=t.getAttribute("formaction")||d.getAttribute("action");if(r=h?_i(h,e):null,n=t.getAttribute("formmethod")||d.getAttribute("method")||Hh,i=Ag(t.getAttribute("formenctype"))||Ag(d.getAttribute("enctype"))||Gh,o=new FormData(d,t),!ej()){let{name:m,type:p,value:g}=t;if(p==="image"){let v=m?`${m}.`:"";o.append(`${v}x`,"0"),o.append(`${v}y`,"0")}else m&&o.append(m,g)}}else{if(Lf(t))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');n=Hh,r=null,i=Gh,l=t}return o&&i==="text/plain"&&(l=o,o=void 0),{action:r,method:n.toLowerCase(),encType:i,formData:o,body:l}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function Ly(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function rj(t,e,n){let r=typeof t=="string"?new URL(t,typeof window>"u"?"server://singlefetch/":window.location.origin):t;return r.pathname==="/"?r.pathname=`_root.${n}`:e&&_i(r.pathname,e)==="/"?r.pathname=`${e.replace(/\/$/,"")}/_root.${n}`:r.pathname=`${r.pathname.replace(/\/$/,"")}.${n}`,r}async function sj(t,e){if(t.id in e)return e[t.id];try{let n=await import(t.module);return e[t.id]=n,n}catch(n){return console.error(`Error loading route module \`${t.module}\`, reloading page...`),console.error(n),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function ij(t){return t==null?!1:t.href==null?t.rel==="preload"&&typeof t.imageSrcSet=="string"&&typeof t.imageSizes=="string":typeof t.rel=="string"&&typeof t.href=="string"}async function aj(t,e,n){let r=await Promise.all(t.map(async i=>{let o=e.routes[i.route.id];if(o){let l=await sj(o,n);return l.links?l.links():[]}return[]}));return uj(r.flat(1).filter(ij).filter(i=>i.rel==="stylesheet"||i.rel==="preload").map(i=>i.rel==="stylesheet"?{...i,rel:"prefetch",as:"style"}:{...i,rel:"prefetch"}))}function Bx(t,e,n,r,i,o){let l=(h,m)=>n[m]?h.route.id!==n[m].route.id:!0,d=(h,m)=>n[m].pathname!==h.pathname||n[m].route.path?.endsWith("*")&&n[m].params["*"]!==h.params["*"];return o==="assets"?e.filter((h,m)=>l(h,m)||d(h,m)):o==="data"?e.filter((h,m)=>{let p=r.routes[h.route.id];if(!p||!p.hasLoader)return!1;if(l(h,m)||d(h,m))return!0;if(h.route.shouldRevalidate){let g=h.route.shouldRevalidate({currentUrl:new URL(i.pathname+i.search+i.hash,window.origin),currentParams:n[0]?.params||{},nextUrl:new URL(t,window.origin),nextParams:h.params,defaultShouldRevalidate:!0});if(typeof g=="boolean")return g}return!0}):[]}function oj(t,e,{includeHydrateFallback:n}={}){return lj(t.map(r=>{let i=e.routes[r.route.id];if(!i)return[];let o=[i.module];return i.clientActionModule&&(o=o.concat(i.clientActionModule)),i.clientLoaderModule&&(o=o.concat(i.clientLoaderModule)),n&&i.hydrateFallbackModule&&(o=o.concat(i.hydrateFallbackModule)),i.imports&&(o=o.concat(i.imports)),o}).flat(1))}function lj(t){return[...new Set(t)]}function cj(t){let e={},n=Object.keys(t).sort();for(let r of n)e[r]=t[r];return e}function uj(t,e){let n=new Set;return new Set(e),t.reduce((r,i)=>{let o=JSON.stringify(cj(i));return n.has(o)||(n.add(o),r.push({key:o,link:i})),r},[])}function SS(){let t=M.useContext(ec);return Ly(t,"You must render this element inside a <DataRouterContext.Provider> element"),t}function dj(){let t=M.useContext(Pf);return Ly(t,"You must render this element inside a <DataRouterStateContext.Provider> element"),t}var Uy=M.createContext(void 0);Uy.displayName="FrameworkContext";function CS(){let t=M.useContext(Uy);return Ly(t,"You must render this element inside a <HydratedRouter> element"),t}function hj(t,e){let n=M.useContext(Uy),[r,i]=M.useState(!1),[o,l]=M.useState(!1),{onFocus:d,onBlur:h,onMouseEnter:m,onMouseLeave:p,onTouchStart:g}=e,v=M.useRef(null);M.useEffect(()=>{if(t==="render"&&l(!0),t==="viewport"){let x=E=>{E.forEach(T=>{l(T.isIntersecting)})},S=new IntersectionObserver(x,{threshold:.5});return v.current&&S.observe(v.current),()=>{S.disconnect()}}},[t]),M.useEffect(()=>{if(r){let x=setTimeout(()=>{l(!0)},100);return()=>{clearTimeout(x)}}},[r]);let b=()=>{i(!0)},C=()=>{i(!1),l(!1)};return n?t!=="intent"?[o,v,{}]:[o,v,{onFocus:_u(d,b),onBlur:_u(h,C),onMouseEnter:_u(m,b),onMouseLeave:_u(p,C),onTouchStart:_u(g,b)}]:[!1,v,{}]}function _u(t,e){return n=>{t&&t(n),n.defaultPrevented||e(n)}}function fj({page:t,...e}){let{router:n}=SS(),r=M.useMemo(()=>cS(n.routes,t,n.basename),[n.routes,t,n.basename]);return r?M.createElement(pj,{page:t,matches:r,...e}):null}function mj(t){let{manifest:e,routeModules:n}=CS(),[r,i]=M.useState([]);return M.useEffect(()=>{let o=!1;return aj(t,e,n).then(l=>{o||i(l)}),()=>{o=!0}},[t,e,n]),r}function pj({page:t,matches:e,...n}){let r=Nn(),{manifest:i,routeModules:o}=CS(),{basename:l}=SS(),{loaderData:d,matches:h}=dj(),m=M.useMemo(()=>Bx(t,e,h,i,r,"data"),[t,e,h,i,r]),p=M.useMemo(()=>Bx(t,e,h,i,r,"assets"),[t,e,h,i,r]),g=M.useMemo(()=>{if(t===r.pathname+r.search+r.hash)return[];let C=new Set,x=!1;if(e.forEach(E=>{let T=i.routes[E.route.id];!T||!T.hasLoader||(!m.some(I=>I.route.id===E.route.id)&&E.route.id in d&&o[E.route.id]?.shouldRevalidate||T.hasClientLoader?x=!0:C.add(E.route.id))}),C.size===0)return[];let S=rj(t,l,"data");return x&&C.size>0&&S.searchParams.set("_routes",e.filter(E=>C.has(E.route.id)).map(E=>E.route.id).join(",")),[S.pathname+S.search]},[l,d,r,i,m,e,t,o]),v=M.useMemo(()=>oj(p,i),[p,i]),b=mj(p);return M.createElement(M.Fragment,null,g.map(C=>M.createElement("link",{key:C,rel:"prefetch",as:"fetch",href:C,...n})),v.map(C=>M.createElement("link",{key:C,rel:"modulepreload",href:C,...n})),b.map(({key:C,link:x})=>M.createElement("link",{key:C,nonce:n.nonce,...x})))}function gj(...t){return e=>{t.forEach(n=>{typeof n=="function"?n(e):n!=null&&(n.current=e)})}}var yj=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{yj&&(window.__reactRouterVersion="7.11.0")}catch{}function _j({basename:t,children:e,unstable_useTransitions:n,window:r}){let i=M.useRef();i.current==null&&(i.current=W2({window:r,v5Compat:!0}));let o=i.current,[l,d]=M.useState({action:o.action,location:o.location}),h=M.useCallback(m=>{n===!1?d(m):M.startTransition(()=>d(m))},[n]);return M.useLayoutEffect(()=>o.listen(h),[o,h]),M.createElement(G5,{basename:t,children:e,location:l.location,navigationType:l.action,navigator:o,unstable_useTransitions:n})}var ES=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,An=M.forwardRef(function({onClick:e,discover:n="render",prefetch:r="none",relative:i,reloadDocument:o,replace:l,state:d,target:h,to:m,preventScrollReset:p,viewTransition:g,unstable_defaultShouldRevalidate:v,...b},C){let{basename:x,unstable_useTransitions:S}=M.useContext(Ir),E=typeof m=="string"&&ES.test(m),T=mS(m,x);m=T.to;let I=j5(m,{relative:i}),[D,B,$]=hj(r,b),k=wj(m,{replace:l,state:d,target:h,preventScrollReset:p,relative:i,viewTransition:g,unstable_defaultShouldRevalidate:v,unstable_useTransitions:S});function j(F){e&&e(F),F.defaultPrevented||k(F)}let N=M.createElement("a",{...b,...$,href:T.absoluteURL||I,onClick:T.isExternal||o?e:j,ref:gj(C,B),target:h,"data-discover":!E&&n==="render"?"true":void 0});return D&&!E?M.createElement(M.Fragment,null,N,M.createElement(fj,{page:I})):N});An.displayName="Link";var bj=M.forwardRef(function({"aria-current":e="page",caseSensitive:n=!1,className:r="",end:i=!1,style:o,to:l,viewTransition:d,children:h,...m},p){let g=Wu(l,{relative:m.relative}),v=Nn(),b=M.useContext(Pf),{navigator:C,basename:x}=M.useContext(Ir),S=b!=null&&Aj(g)&&d===!0,E=C.encodeLocation?C.encodeLocation(g).pathname:g.pathname,T=v.pathname,I=b&&b.navigation&&b.navigation.location?b.navigation.location.pathname:null;n||(T=T.toLowerCase(),I=I?I.toLowerCase():null,E=E.toLowerCase()),I&&x&&(I=_i(I,x)||I);const D=E!=="/"&&E.endsWith("/")?E.length-1:E.length;let B=T===E||!i&&T.startsWith(E)&&T.charAt(D)==="/",$=I!=null&&(I===E||!i&&I.startsWith(E)&&I.charAt(E.length)==="/"),k={isActive:B,isPending:$,isTransitioning:S},j=B?e:void 0,N;typeof r=="function"?N=r(k):N=[r,B?"active":null,$?"pending":null,S?"transitioning":null].filter(Boolean).join(" ");let F=typeof o=="function"?o(k):o;return M.createElement(An,{...m,"aria-current":j,className:N,ref:p,style:F,to:l,viewTransition:d},typeof h=="function"?h(k):h)});bj.displayName="NavLink";var vj=M.forwardRef(({discover:t="render",fetcherKey:e,navigate:n,reloadDocument:r,replace:i,state:o,method:l=Hh,action:d,onSubmit:h,relative:m,preventScrollReset:p,viewTransition:g,unstable_defaultShouldRevalidate:v,...b},C)=>{let{unstable_useTransitions:x}=M.useContext(Ir),S=Ej(),E=Tj(d,{relative:m}),T=l.toLowerCase()==="get"?"get":"post",I=typeof d=="string"&&ES.test(d),D=B=>{if(h&&h(B),B.defaultPrevented)return;B.preventDefault();let $=B.nativeEvent.submitter,k=$?.getAttribute("formmethod")||l,j=()=>S($||B.currentTarget,{fetcherKey:e,method:k,navigate:n,replace:i,state:o,relative:m,preventScrollReset:p,viewTransition:g,unstable_defaultShouldRevalidate:v});x&&n!==!1?M.startTransition(()=>j()):j()};return M.createElement("form",{ref:C,method:T,action:E,onSubmit:r?h:D,...b,"data-discover":!I&&t==="render"?"true":void 0})});vj.displayName="Form";function xj(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function TS(t){let e=M.useContext(ec);return Zt(e,xj(t)),e}function wj(t,{target:e,replace:n,state:r,preventScrollReset:i,relative:o,viewTransition:l,unstable_defaultShouldRevalidate:d,unstable_useTransitions:h}={}){let m=Qu(),p=Nn(),g=Wu(t,{relative:o});return M.useCallback(v=>{if(Z5(v,e)){v.preventDefault();let b=n!==void 0?n:ku(p)===ku(g),C=()=>m(t,{replace:b,state:r,preventScrollReset:i,relative:o,viewTransition:l,unstable_defaultShouldRevalidate:d});h?M.startTransition(()=>C()):C()}},[p,m,g,n,r,e,t,i,o,l,d,h])}function AS(t){Rr(typeof URLSearchParams<"u","You cannot use the `useSearchParams` hook in a browser that does not support the URLSearchParams API. If you need to support Internet Explorer 11, we recommend you load a polyfill such as https://github.com/ungap/url-search-params.");let e=M.useRef(Xg(t)),n=M.useRef(!1),r=Nn(),i=M.useMemo(()=>J5(r.search,n.current?null:e.current),[r.search]),o=Qu(),l=M.useCallback((d,h)=>{const m=Xg(typeof d=="function"?d(new URLSearchParams(i)):d);n.current=!0,o("?"+m,h)},[o,i]);return[i,l]}var Sj=0,Cj=()=>`__${String(++Sj)}__`;function Ej(){let{router:t}=TS("useSubmit"),{basename:e}=M.useContext(Ir),n=V5(),r=t.fetch,i=t.navigate;return M.useCallback(async(o,l={})=>{let{action:d,method:h,encType:m,formData:p,body:g}=nj(o,e);if(l.navigate===!1){let v=l.fetcherKey||Cj();await r(v,n,l.action||d,{unstable_defaultShouldRevalidate:l.unstable_defaultShouldRevalidate,preventScrollReset:l.preventScrollReset,formData:p,body:g,formMethod:l.method||h,formEncType:l.encType||m,flushSync:l.flushSync})}else await i(l.action||d,{unstable_defaultShouldRevalidate:l.unstable_defaultShouldRevalidate,preventScrollReset:l.preventScrollReset,formData:p,body:g,formMethod:l.method||h,formEncType:l.encType||m,replace:l.replace,state:l.state,fromRouteId:n,flushSync:l.flushSync,viewTransition:l.viewTransition})},[r,i,e,n])}function Tj(t,{relative:e}={}){let{basename:n}=M.useContext(Ir),r=M.useContext(Qr);Zt(r,"useFormAction must be used inside a RouteContext");let[i]=r.matches.slice(-1),o={...Wu(t||".",{relative:e})},l=Nn();if(t==null){o.search=l.search;let d=new URLSearchParams(o.search),h=d.getAll("index");if(h.some(p=>p==="")){d.delete("index"),h.filter(g=>g).forEach(g=>d.append("index",g));let p=d.toString();o.search=p?`?${p}`:""}}return(!t||t===".")&&i.route.index&&(o.search=o.search?o.search.replace(/^\?/,"?index&"):"?index"),n!=="/"&&(o.pathname=o.pathname==="/"?n:gi([n,o.pathname])),ku(o)}function Aj(t,{relative:e}={}){let n=M.useContext(gS);Zt(n!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:r}=TS("useViewTransitionState"),i=Wu(t,{relative:e});if(!n.isTransitioning)return!1;let o=_i(n.currentLocation.pathname,r)||n.currentLocation.pathname,l=_i(n.nextLocation.pathname,r)||n.nextLocation.pathname;return rf(i.pathname,l)!=null||rf(i.pathname,o)!=null}var nc=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(t){return this.listeners.add(t),this.onSubscribe(),()=>{this.listeners.delete(t),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},jj={setTimeout:(t,e)=>setTimeout(t,e),clearTimeout:t=>clearTimeout(t),setInterval:(t,e)=>setInterval(t,e),clearInterval:t=>clearInterval(t)},Rj=class{#e=jj;#t=!1;setTimeoutProvider(t){this.#e=t}setTimeout(t,e){return this.#e.setTimeout(t,e)}clearTimeout(t){this.#e.clearTimeout(t)}setInterval(t,e){return this.#e.setInterval(t,e)}clearInterval(t){this.#e.clearInterval(t)}},vo=new Rj;function Ij(t){setTimeout(t,0)}var To=typeof window>"u"||"Deno"in globalThis;function ir(){}function kj(t,e){return typeof t=="function"?t(e):t}function Zg(t){return typeof t=="number"&&t>=0&&t!==1/0}function jS(t,e){return Math.max(t+(e||0)-Date.now(),0)}function ga(t,e){return typeof t=="function"?t(e):t}function qr(t,e){return typeof t=="function"?t(e):t}function Lx(t,e){const{type:n="all",exact:r,fetchStatus:i,predicate:o,queryKey:l,stale:d}=t;if(l){if(r){if(e.queryHash!==Fy(l,e.options))return!1}else if(!Du(e.queryKey,l))return!1}if(n!=="all"){const h=e.isActive();if(n==="active"&&!h||n==="inactive"&&h)return!1}return!(typeof d=="boolean"&&e.isStale()!==d||i&&i!==e.state.fetchStatus||o&&!o(e))}function Ux(t,e){const{exact:n,status:r,predicate:i,mutationKey:o}=t;if(o){if(!e.options.mutationKey)return!1;if(n){if(Ao(e.options.mutationKey)!==Ao(o))return!1}else if(!Du(e.options.mutationKey,o))return!1}return!(r&&e.state.status!==r||i&&!i(e))}function Fy(t,e){return(e?.queryKeyHashFn||Ao)(t)}function Ao(t){return JSON.stringify(t,(e,n)=>Jg(n)?Object.keys(n).sort().reduce((r,i)=>(r[i]=n[i],r),{}):n)}function Du(t,e){return t===e?!0:typeof t!=typeof e?!1:t&&e&&typeof t=="object"&&typeof e=="object"?Object.keys(e).every(n=>Du(t[n],e[n])):!1}var Dj=Object.prototype.hasOwnProperty;function RS(t,e){if(t===e)return t;const n=Fx(t)&&Fx(e);if(!n&&!(Jg(t)&&Jg(e)))return e;const i=(n?t:Object.keys(t)).length,o=n?e:Object.keys(e),l=o.length,d=n?new Array(l):{};let h=0;for(let m=0;m<l;m++){const p=n?m:o[m],g=t[p],v=e[p];if(g===v){d[p]=g,(n?m<i:Dj.call(t,p))&&h++;continue}if(g===null||v===null||typeof g!="object"||typeof v!="object"){d[p]=v;continue}const b=RS(g,v);d[p]=b,b===g&&h++}return i===l&&h===i?t:d}function sf(t,e){if(!e||Object.keys(t).length!==Object.keys(e).length)return!1;for(const n in t)if(t[n]!==e[n])return!1;return!0}function Fx(t){return Array.isArray(t)&&t.length===Object.keys(t).length}function Jg(t){if(!Vx(t))return!1;const e=t.constructor;if(e===void 0)return!0;const n=e.prototype;return!(!Vx(n)||!n.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(t)!==Object.prototype)}function Vx(t){return Object.prototype.toString.call(t)==="[object Object]"}function Mj(t){return new Promise(e=>{vo.setTimeout(e,t)})}function ey(t,e,n){return typeof n.structuralSharing=="function"?n.structuralSharing(t,e):n.structuralSharing!==!1?RS(t,e):e}function Oj(t,e,n=0){const r=[...t,e];return n&&r.length>n?r.slice(1):r}function Nj(t,e,n=0){const r=[e,...t];return n&&r.length>n?r.slice(0,-1):r}var Vy=Symbol();function IS(t,e){return!t.queryFn&&e?.initialPromise?()=>e.initialPromise:!t.queryFn||t.queryFn===Vy?()=>Promise.reject(new Error(`Missing queryFn: '${t.queryHash}'`)):t.queryFn}function kS(t,e){return typeof t=="function"?t(...e):!!t}var Pj=class extends nc{#e;#t;#n;constructor(){super(),this.#n=t=>{if(!To&&window.addEventListener){const e=()=>t();return window.addEventListener("visibilitychange",e,!1),()=>{window.removeEventListener("visibilitychange",e)}}}}onSubscribe(){this.#t||this.setEventListener(this.#n)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(t){this.#n=t,this.#t?.(),this.#t=t(e=>{typeof e=="boolean"?this.setFocused(e):this.onFocus()})}setFocused(t){this.#e!==t&&(this.#e=t,this.onFocus())}onFocus(){const t=this.isFocused();this.listeners.forEach(e=>{e(t)})}isFocused(){return typeof this.#e=="boolean"?this.#e:globalThis.document?.visibilityState!=="hidden"}},$y=new Pj;function ty(){let t,e;const n=new Promise((i,o)=>{t=i,e=o});n.status="pending",n.catch(()=>{});function r(i){Object.assign(n,i),delete n.resolve,delete n.reject}return n.resolve=i=>{r({status:"fulfilled",value:i}),t(i)},n.reject=i=>{r({status:"rejected",reason:i}),e(i)},n}var zj=Ij;function Bj(){let t=[],e=0,n=d=>{d()},r=d=>{d()},i=zj;const o=d=>{e?t.push(d):i(()=>{n(d)})},l=()=>{const d=t;t=[],d.length&&i(()=>{r(()=>{d.forEach(h=>{n(h)})})})};return{batch:d=>{let h;e++;try{h=d()}finally{e--,e||l()}return h},batchCalls:d=>(...h)=>{o(()=>{d(...h)})},schedule:o,setNotifyFunction:d=>{n=d},setBatchNotifyFunction:d=>{r=d},setScheduler:d=>{i=d}}}var Tn=Bj(),Lj=class extends nc{#e=!0;#t;#n;constructor(){super(),this.#n=t=>{if(!To&&window.addEventListener){const e=()=>t(!0),n=()=>t(!1);return window.addEventListener("online",e,!1),window.addEventListener("offline",n,!1),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",n)}}}}onSubscribe(){this.#t||this.setEventListener(this.#n)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(t){this.#n=t,this.#t?.(),this.#t=t(this.setOnline.bind(this))}setOnline(t){this.#e!==t&&(this.#e=t,this.listeners.forEach(n=>{n(t)}))}isOnline(){return this.#e}},af=new Lj;function Uj(t){return Math.min(1e3*2**t,3e4)}function DS(t){return(t??"online")==="online"?af.isOnline():!0}var ny=class extends Error{constructor(t){super("CancelledError"),this.revert=t?.revert,this.silent=t?.silent}};function MS(t){let e=!1,n=0,r;const i=ty(),o=()=>i.status!=="pending",l=x=>{if(!o()){const S=new ny(x);v(S),t.onCancel?.(S)}},d=()=>{e=!0},h=()=>{e=!1},m=()=>$y.isFocused()&&(t.networkMode==="always"||af.isOnline())&&t.canRun(),p=()=>DS(t.networkMode)&&t.canRun(),g=x=>{o()||(r?.(),i.resolve(x))},v=x=>{o()||(r?.(),i.reject(x))},b=()=>new Promise(x=>{r=S=>{(o()||m())&&x(S)},t.onPause?.()}).then(()=>{r=void 0,o()||t.onContinue?.()}),C=()=>{if(o())return;let x;const S=n===0?t.initialPromise:void 0;try{x=S??t.fn()}catch(E){x=Promise.reject(E)}Promise.resolve(x).then(g).catch(E=>{if(o())return;const T=t.retry??(To?0:3),I=t.retryDelay??Uj,D=typeof I=="function"?I(n,E):I,B=T===!0||typeof T=="number"&&n<T||typeof T=="function"&&T(n,E);if(e||!B){v(E);return}n++,t.onFail?.(n,E),Mj(D).then(()=>m()?void 0:b()).then(()=>{e?v(E):C()})})};return{promise:i,status:()=>i.status,cancel:l,continue:()=>(r?.(),i),cancelRetry:d,continueRetry:h,canStart:p,start:()=>(p()?C():b().then(C),i)}}var OS=class{#e;destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),Zg(this.gcTime)&&(this.#e=vo.setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(t){this.gcTime=Math.max(this.gcTime||0,t??(To?1/0:300*1e3))}clearGcTimeout(){this.#e&&(vo.clearTimeout(this.#e),this.#e=void 0)}},Fj=class extends OS{#e;#t;#n;#s;#r;#a;#o;constructor(e){super(),this.#o=!1,this.#a=e.defaultOptions,this.setOptions(e.options),this.observers=[],this.#s=e.client,this.#n=this.#s.getQueryCache(),this.queryKey=e.queryKey,this.queryHash=e.queryHash,this.#e=qx(this.options),this.state=e.state??this.#e,this.scheduleGc()}get meta(){return this.options.meta}get promise(){return this.#r?.promise}setOptions(e){if(this.options={...this.#a,...e},this.updateGcTime(this.options.gcTime),this.state&&this.state.data===void 0){const n=qx(this.options);n.data!==void 0&&(this.setState($x(n.data,n.dataUpdatedAt)),this.#e=n)}}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&this.#n.remove(this)}setData(e,n){const r=ey(this.state.data,e,this.options);return this.#i({data:r,type:"success",dataUpdatedAt:n?.updatedAt,manual:n?.manual}),r}setState(e,n){this.#i({type:"setState",state:e,setStateOptions:n})}cancel(e){const n=this.#r?.promise;return this.#r?.cancel(e),n?n.then(ir).catch(ir):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(this.#e)}isActive(){return this.observers.some(e=>qr(e.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===Vy||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(e=>ga(e.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(e=>e.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(e=0){return this.state.data===void 0?!0:e==="static"?!1:this.state.isInvalidated?!0:!jS(this.state.dataUpdatedAt,e)}onFocus(){this.observers.find(n=>n.shouldFetchOnWindowFocus())?.refetch({cancelRefetch:!1}),this.#r?.continue()}onOnline(){this.observers.find(n=>n.shouldFetchOnReconnect())?.refetch({cancelRefetch:!1}),this.#r?.continue()}addObserver(e){this.observers.includes(e)||(this.observers.push(e),this.clearGcTimeout(),this.#n.notify({type:"observerAdded",query:this,observer:e}))}removeObserver(e){this.observers.includes(e)&&(this.observers=this.observers.filter(n=>n!==e),this.observers.length||(this.#r&&(this.#o?this.#r.cancel({revert:!0}):this.#r.cancelRetry()),this.scheduleGc()),this.#n.notify({type:"observerRemoved",query:this,observer:e}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||this.#i({type:"invalidate"})}async fetch(e,n){if(this.state.fetchStatus!=="idle"&&this.#r?.status()!=="rejected"){if(this.state.data!==void 0&&n?.cancelRefetch)this.cancel({silent:!0});else if(this.#r)return this.#r.continueRetry(),this.#r.promise}if(e&&this.setOptions(e),!this.options.queryFn){const h=this.observers.find(m=>m.options.queryFn);h&&this.setOptions(h.options)}const r=new AbortController,i=h=>{Object.defineProperty(h,"signal",{enumerable:!0,get:()=>(this.#o=!0,r.signal)})},o=()=>{const h=IS(this.options,n),p=(()=>{const g={client:this.#s,queryKey:this.queryKey,meta:this.meta};return i(g),g})();return this.#o=!1,this.options.persister?this.options.persister(h,p,this):h(p)},d=(()=>{const h={fetchOptions:n,options:this.options,queryKey:this.queryKey,client:this.#s,state:this.state,fetchFn:o};return i(h),h})();this.options.behavior?.onFetch(d,this),this.#t=this.state,(this.state.fetchStatus==="idle"||this.state.fetchMeta!==d.fetchOptions?.meta)&&this.#i({type:"fetch",meta:d.fetchOptions?.meta}),this.#r=MS({initialPromise:n?.initialPromise,fn:d.fetchFn,onCancel:h=>{h instanceof ny&&h.revert&&this.setState({...this.#t,fetchStatus:"idle"}),r.abort()},onFail:(h,m)=>{this.#i({type:"failed",failureCount:h,error:m})},onPause:()=>{this.#i({type:"pause"})},onContinue:()=>{this.#i({type:"continue"})},retry:d.options.retry,retryDelay:d.options.retryDelay,networkMode:d.options.networkMode,canRun:()=>!0});try{const h=await this.#r.start();if(h===void 0)throw new Error(`${this.queryHash} data is undefined`);return this.setData(h),this.#n.config.onSuccess?.(h,this),this.#n.config.onSettled?.(h,this.state.error,this),h}catch(h){if(h instanceof ny){if(h.silent)return this.#r.promise;if(h.revert){if(this.state.data===void 0)throw h;return this.state.data}}throw this.#i({type:"error",error:h}),this.#n.config.onError?.(h,this),this.#n.config.onSettled?.(this.state.data,h,this),h}finally{this.scheduleGc()}}#i(e){const n=r=>{switch(e.type){case"failed":return{...r,fetchFailureCount:e.failureCount,fetchFailureReason:e.error};case"pause":return{...r,fetchStatus:"paused"};case"continue":return{...r,fetchStatus:"fetching"};case"fetch":return{...r,...NS(r.data,this.options),fetchMeta:e.meta??null};case"success":const i={...r,...$x(e.data,e.dataUpdatedAt),dataUpdateCount:r.dataUpdateCount+1,...!e.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return this.#t=e.manual?i:void 0,i;case"error":const o=e.error;return{...r,error:o,errorUpdateCount:r.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:r.fetchFailureCount+1,fetchFailureReason:o,fetchStatus:"idle",status:"error"};case"invalidate":return{...r,isInvalidated:!0};case"setState":return{...r,...e.state}}};this.state=n(this.state),Tn.batch(()=>{this.observers.forEach(r=>{r.onQueryUpdate()}),this.#n.notify({query:this,type:"updated",action:e})})}};function NS(t,e){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:DS(e.networkMode)?"fetching":"paused",...t===void 0&&{error:null,status:"pending"}}}function $x(t,e){return{data:t,dataUpdatedAt:e??Date.now(),error:null,isInvalidated:!1,status:"success"}}function qx(t){const e=typeof t.initialData=="function"?t.initialData():t.initialData,n=e!==void 0,r=n?typeof t.initialDataUpdatedAt=="function"?t.initialDataUpdatedAt():t.initialDataUpdatedAt:0;return{data:e,dataUpdateCount:0,dataUpdatedAt:n?r??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:n?"success":"pending",fetchStatus:"idle"}}var Vj=class extends nc{constructor(t,e){super(),this.options=e,this.#e=t,this.#i=null,this.#o=ty(),this.bindMethods(),this.setOptions(e)}#e;#t=void 0;#n=void 0;#s=void 0;#r;#a;#o;#i;#p;#h;#f;#c;#u;#l;#m=new Set;bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(this.#t.addObserver(this),Hx(this.#t,this.options)?this.#d():this.updateResult(),this.#b())}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return ry(this.#t,this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return ry(this.#t,this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,this.#v(),this.#x(),this.#t.removeObserver(this)}setOptions(t){const e=this.options,n=this.#t;if(this.options=this.#e.defaultQueryOptions(t),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof qr(this.options.enabled,this.#t)!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");this.#w(),this.#t.setOptions(this.options),e._defaulted&&!sf(this.options,e)&&this.#e.getQueryCache().notify({type:"observerOptionsUpdated",query:this.#t,observer:this});const r=this.hasListeners();r&&Gx(this.#t,n,this.options,e)&&this.#d(),this.updateResult(),r&&(this.#t!==n||qr(this.options.enabled,this.#t)!==qr(e.enabled,this.#t)||ga(this.options.staleTime,this.#t)!==ga(e.staleTime,this.#t))&&this.#g();const i=this.#y();r&&(this.#t!==n||qr(this.options.enabled,this.#t)!==qr(e.enabled,this.#t)||i!==this.#l)&&this.#_(i)}getOptimisticResult(t){const e=this.#e.getQueryCache().build(this.#e,t),n=this.createResult(e,t);return qj(this,n)&&(this.#s=n,this.#a=this.options,this.#r=this.#t.state),n}getCurrentResult(){return this.#s}trackResult(t,e){return new Proxy(t,{get:(n,r)=>(this.trackProp(r),e?.(r),r==="promise"&&(this.trackProp("data"),!this.options.experimental_prefetchInRender&&this.#o.status==="pending"&&this.#o.reject(new Error("experimental_prefetchInRender feature flag is not enabled"))),Reflect.get(n,r))})}trackProp(t){this.#m.add(t)}getCurrentQuery(){return this.#t}refetch({...t}={}){return this.fetch({...t})}fetchOptimistic(t){const e=this.#e.defaultQueryOptions(t),n=this.#e.getQueryCache().build(this.#e,e);return n.fetch().then(()=>this.createResult(n,e))}fetch(t){return this.#d({...t,cancelRefetch:t.cancelRefetch??!0}).then(()=>(this.updateResult(),this.#s))}#d(t){this.#w();let e=this.#t.fetch(this.options,t);return t?.throwOnError||(e=e.catch(ir)),e}#g(){this.#v();const t=ga(this.options.staleTime,this.#t);if(To||this.#s.isStale||!Zg(t))return;const n=jS(this.#s.dataUpdatedAt,t)+1;this.#c=vo.setTimeout(()=>{this.#s.isStale||this.updateResult()},n)}#y(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(this.#t):this.options.refetchInterval)??!1}#_(t){this.#x(),this.#l=t,!(To||qr(this.options.enabled,this.#t)===!1||!Zg(this.#l)||this.#l===0)&&(this.#u=vo.setInterval(()=>{(this.options.refetchIntervalInBackground||$y.isFocused())&&this.#d()},this.#l))}#b(){this.#g(),this.#_(this.#y())}#v(){this.#c&&(vo.clearTimeout(this.#c),this.#c=void 0)}#x(){this.#u&&(vo.clearInterval(this.#u),this.#u=void 0)}createResult(t,e){const n=this.#t,r=this.options,i=this.#s,o=this.#r,l=this.#a,h=t!==n?t.state:this.#n,{state:m}=t;let p={...m},g=!1,v;if(e._optimisticResults){const j=this.hasListeners(),N=!j&&Hx(t,e),F=j&&Gx(t,n,e,r);(N||F)&&(p={...p,...NS(m.data,t.options)}),e._optimisticResults==="isRestoring"&&(p.fetchStatus="idle")}let{error:b,errorUpdatedAt:C,status:x}=p;v=p.data;let S=!1;if(e.placeholderData!==void 0&&v===void 0&&x==="pending"){let j;i?.isPlaceholderData&&e.placeholderData===l?.placeholderData?(j=i.data,S=!0):j=typeof e.placeholderData=="function"?e.placeholderData(this.#f?.state.data,this.#f):e.placeholderData,j!==void 0&&(x="success",v=ey(i?.data,j,e),g=!0)}if(e.select&&v!==void 0&&!S)if(i&&v===o?.data&&e.select===this.#p)v=this.#h;else try{this.#p=e.select,v=e.select(v),v=ey(i?.data,v,e),this.#h=v,this.#i=null}catch(j){this.#i=j}this.#i&&(b=this.#i,v=this.#h,C=Date.now(),x="error");const E=p.fetchStatus==="fetching",T=x==="pending",I=x==="error",D=T&&E,B=v!==void 0,k={status:x,fetchStatus:p.fetchStatus,isPending:T,isSuccess:x==="success",isError:I,isInitialLoading:D,isLoading:D,data:v,dataUpdatedAt:p.dataUpdatedAt,error:b,errorUpdatedAt:C,failureCount:p.fetchFailureCount,failureReason:p.fetchFailureReason,errorUpdateCount:p.errorUpdateCount,isFetched:p.dataUpdateCount>0||p.errorUpdateCount>0,isFetchedAfterMount:p.dataUpdateCount>h.dataUpdateCount||p.errorUpdateCount>h.errorUpdateCount,isFetching:E,isRefetching:E&&!T,isLoadingError:I&&!B,isPaused:p.fetchStatus==="paused",isPlaceholderData:g,isRefetchError:I&&B,isStale:qy(t,e),refetch:this.refetch,promise:this.#o,isEnabled:qr(e.enabled,t)!==!1};if(this.options.experimental_prefetchInRender){const j=q=>{k.status==="error"?q.reject(k.error):k.data!==void 0&&q.resolve(k.data)},N=()=>{const q=this.#o=k.promise=ty();j(q)},F=this.#o;switch(F.status){case"pending":t.queryHash===n.queryHash&&j(F);break;case"fulfilled":(k.status==="error"||k.data!==F.value)&&N();break;case"rejected":(k.status!=="error"||k.error!==F.reason)&&N();break}}return k}updateResult(){const t=this.#s,e=this.createResult(this.#t,this.options);if(this.#r=this.#t.state,this.#a=this.options,this.#r.data!==void 0&&(this.#f=this.#t),sf(e,t))return;this.#s=e;const n=()=>{if(!t)return!0;const{notifyOnChangeProps:r}=this.options,i=typeof r=="function"?r():r;if(i==="all"||!i&&!this.#m.size)return!0;const o=new Set(i??this.#m);return this.options.throwOnError&&o.add("error"),Object.keys(this.#s).some(l=>{const d=l;return this.#s[d]!==t[d]&&o.has(d)})};this.#S({listeners:n()})}#w(){const t=this.#e.getQueryCache().build(this.#e,this.options);if(t===this.#t)return;const e=this.#t;this.#t=t,this.#n=t.state,this.hasListeners()&&(e?.removeObserver(this),t.addObserver(this))}onQueryUpdate(){this.updateResult(),this.hasListeners()&&this.#b()}#S(t){Tn.batch(()=>{t.listeners&&this.listeners.forEach(e=>{e(this.#s)}),this.#e.getQueryCache().notify({query:this.#t,type:"observerResultsUpdated"})})}};function $j(t,e){return qr(e.enabled,t)!==!1&&t.state.data===void 0&&!(t.state.status==="error"&&e.retryOnMount===!1)}function Hx(t,e){return $j(t,e)||t.state.data!==void 0&&ry(t,e,e.refetchOnMount)}function ry(t,e,n){if(qr(e.enabled,t)!==!1&&ga(e.staleTime,t)!=="static"){const r=typeof n=="function"?n(t):n;return r==="always"||r!==!1&&qy(t,e)}return!1}function Gx(t,e,n,r){return(t!==e||qr(r.enabled,t)===!1)&&(!n.suspense||t.state.status!=="error")&&qy(t,n)}function qy(t,e){return qr(e.enabled,t)!==!1&&t.isStaleByTime(ga(e.staleTime,t))}function qj(t,e){return!sf(t.getCurrentResult(),e)}function Qx(t){return{onFetch:(e,n)=>{const r=e.options,i=e.fetchOptions?.meta?.fetchMore?.direction,o=e.state.data?.pages||[],l=e.state.data?.pageParams||[];let d={pages:[],pageParams:[]},h=0;const m=async()=>{let p=!1;const g=C=>{Object.defineProperty(C,"signal",{enumerable:!0,get:()=>(e.signal.aborted?p=!0:e.signal.addEventListener("abort",()=>{p=!0}),e.signal)})},v=IS(e.options,e.fetchOptions),b=async(C,x,S)=>{if(p)return Promise.reject();if(x==null&&C.pages.length)return Promise.resolve(C);const T=(()=>{const $={client:e.client,queryKey:e.queryKey,pageParam:x,direction:S?"backward":"forward",meta:e.options.meta};return g($),$})(),I=await v(T),{maxPages:D}=e.options,B=S?Nj:Oj;return{pages:B(C.pages,I,D),pageParams:B(C.pageParams,x,D)}};if(i&&o.length){const C=i==="backward",x=C?Hj:Wx,S={pages:o,pageParams:l},E=x(r,S);d=await b(S,E,C)}else{const C=t??o.length;do{const x=h===0?l[0]??r.initialPageParam:Wx(r,d);if(h>0&&x==null)break;d=await b(d,x),h++}while(h<C)}return d};e.options.persister?e.fetchFn=()=>e.options.persister?.(m,{client:e.client,queryKey:e.queryKey,meta:e.options.meta,signal:e.signal},n):e.fetchFn=m}}}function Wx(t,{pages:e,pageParams:n}){const r=e.length-1;return e.length>0?t.getNextPageParam(e[r],e,n[r],n):void 0}function Hj(t,{pages:e,pageParams:n}){return e.length>0?t.getPreviousPageParam?.(e[0],e,n[0],n):void 0}var Gj=class extends OS{#e;#t;#n;#s;constructor(e){super(),this.#e=e.client,this.mutationId=e.mutationId,this.#n=e.mutationCache,this.#t=[],this.state=e.state||PS(),this.setOptions(e.options),this.scheduleGc()}setOptions(e){this.options=e,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(e){this.#t.includes(e)||(this.#t.push(e),this.clearGcTimeout(),this.#n.notify({type:"observerAdded",mutation:this,observer:e}))}removeObserver(e){this.#t=this.#t.filter(n=>n!==e),this.scheduleGc(),this.#n.notify({type:"observerRemoved",mutation:this,observer:e})}optionalRemove(){this.#t.length||(this.state.status==="pending"?this.scheduleGc():this.#n.remove(this))}continue(){return this.#s?.continue()??this.execute(this.state.variables)}async execute(e){const n=()=>{this.#r({type:"continue"})},r={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};this.#s=MS({fn:()=>this.options.mutationFn?this.options.mutationFn(e,r):Promise.reject(new Error("No mutationFn found")),onFail:(l,d)=>{this.#r({type:"failed",failureCount:l,error:d})},onPause:()=>{this.#r({type:"pause"})},onContinue:n,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>this.#n.canRun(this)});const i=this.state.status==="pending",o=!this.#s.canStart();try{if(i)n();else{this.#r({type:"pending",variables:e,isPaused:o}),await this.#n.config.onMutate?.(e,this,r);const d=await this.options.onMutate?.(e,r);d!==this.state.context&&this.#r({type:"pending",context:d,variables:e,isPaused:o})}const l=await this.#s.start();return await this.#n.config.onSuccess?.(l,e,this.state.context,this,r),await this.options.onSuccess?.(l,e,this.state.context,r),await this.#n.config.onSettled?.(l,null,this.state.variables,this.state.context,this,r),await this.options.onSettled?.(l,null,e,this.state.context,r),this.#r({type:"success",data:l}),l}catch(l){try{throw await this.#n.config.onError?.(l,e,this.state.context,this,r),await this.options.onError?.(l,e,this.state.context,r),await this.#n.config.onSettled?.(void 0,l,this.state.variables,this.state.context,this,r),await this.options.onSettled?.(void 0,l,e,this.state.context,r),l}finally{this.#r({type:"error",error:l})}}finally{this.#n.runNext(this)}}#r(e){const n=r=>{switch(e.type){case"failed":return{...r,failureCount:e.failureCount,failureReason:e.error};case"pause":return{...r,isPaused:!0};case"continue":return{...r,isPaused:!1};case"pending":return{...r,context:e.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:e.isPaused,status:"pending",variables:e.variables,submittedAt:Date.now()};case"success":return{...r,data:e.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...r,data:void 0,error:e.error,failureCount:r.failureCount+1,failureReason:e.error,isPaused:!1,status:"error"}}};this.state=n(this.state),Tn.batch(()=>{this.#t.forEach(r=>{r.onMutationUpdate(e)}),this.#n.notify({mutation:this,type:"updated",action:e})})}};function PS(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var Qj=class extends nc{constructor(t={}){super(),this.config=t,this.#e=new Set,this.#t=new Map,this.#n=0}#e;#t;#n;build(t,e,n){const r=new Gj({client:t,mutationCache:this,mutationId:++this.#n,options:t.defaultMutationOptions(e),state:n});return this.add(r),r}add(t){this.#e.add(t);const e=Ph(t);if(typeof e=="string"){const n=this.#t.get(e);n?n.push(t):this.#t.set(e,[t])}this.notify({type:"added",mutation:t})}remove(t){if(this.#e.delete(t)){const e=Ph(t);if(typeof e=="string"){const n=this.#t.get(e);if(n)if(n.length>1){const r=n.indexOf(t);r!==-1&&n.splice(r,1)}else n[0]===t&&this.#t.delete(e)}}this.notify({type:"removed",mutation:t})}canRun(t){const e=Ph(t);if(typeof e=="string"){const r=this.#t.get(e)?.find(i=>i.state.status==="pending");return!r||r===t}else return!0}runNext(t){const e=Ph(t);return typeof e=="string"?this.#t.get(e)?.find(r=>r!==t&&r.state.isPaused)?.continue()??Promise.resolve():Promise.resolve()}clear(){Tn.batch(()=>{this.#e.forEach(t=>{this.notify({type:"removed",mutation:t})}),this.#e.clear(),this.#t.clear()})}getAll(){return Array.from(this.#e)}find(t){const e={exact:!0,...t};return this.getAll().find(n=>Ux(e,n))}findAll(t={}){return this.getAll().filter(e=>Ux(t,e))}notify(t){Tn.batch(()=>{this.listeners.forEach(e=>{e(t)})})}resumePausedMutations(){const t=this.getAll().filter(e=>e.state.isPaused);return Tn.batch(()=>Promise.all(t.map(e=>e.continue().catch(ir))))}};function Ph(t){return t.options.scope?.id}var Wj=class extends nc{#e;#t=void 0;#n;#s;constructor(e,n){super(),this.#e=e,this.setOptions(n),this.bindMethods(),this.#r()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){const n=this.options;this.options=this.#e.defaultMutationOptions(e),sf(this.options,n)||this.#e.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#n,observer:this}),n?.mutationKey&&this.options.mutationKey&&Ao(n.mutationKey)!==Ao(this.options.mutationKey)?this.reset():this.#n?.state.status==="pending"&&this.#n.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#n?.removeObserver(this)}onMutationUpdate(e){this.#r(),this.#a(e)}getCurrentResult(){return this.#t}reset(){this.#n?.removeObserver(this),this.#n=void 0,this.#r(),this.#a()}mutate(e,n){return this.#s=n,this.#n?.removeObserver(this),this.#n=this.#e.getMutationCache().build(this.#e,this.options),this.#n.addObserver(this),this.#n.execute(e)}#r(){const e=this.#n?.state??PS();this.#t={...e,isPending:e.status==="pending",isSuccess:e.status==="success",isError:e.status==="error",isIdle:e.status==="idle",mutate:this.mutate,reset:this.reset}}#a(e){Tn.batch(()=>{if(this.#s&&this.hasListeners()){const n=this.#t.variables,r=this.#t.context,i={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};e?.type==="success"?(this.#s.onSuccess?.(e.data,n,r,i),this.#s.onSettled?.(e.data,null,n,r,i)):e?.type==="error"&&(this.#s.onError?.(e.error,n,r,i),this.#s.onSettled?.(void 0,e.error,n,r,i))}this.listeners.forEach(n=>{n(this.#t)})})}},Kj=class extends nc{constructor(t={}){super(),this.config=t,this.#e=new Map}#e;build(t,e,n){const r=e.queryKey,i=e.queryHash??Fy(r,e);let o=this.get(i);return o||(o=new Fj({client:t,queryKey:r,queryHash:i,options:t.defaultQueryOptions(e),state:n,defaultOptions:t.getQueryDefaults(r)}),this.add(o)),o}add(t){this.#e.has(t.queryHash)||(this.#e.set(t.queryHash,t),this.notify({type:"added",query:t}))}remove(t){const e=this.#e.get(t.queryHash);e&&(t.destroy(),e===t&&this.#e.delete(t.queryHash),this.notify({type:"removed",query:t}))}clear(){Tn.batch(()=>{this.getAll().forEach(t=>{this.remove(t)})})}get(t){return this.#e.get(t)}getAll(){return[...this.#e.values()]}find(t){const e={exact:!0,...t};return this.getAll().find(n=>Lx(e,n))}findAll(t={}){const e=this.getAll();return Object.keys(t).length>0?e.filter(n=>Lx(t,n)):e}notify(t){Tn.batch(()=>{this.listeners.forEach(e=>{e(t)})})}onFocus(){Tn.batch(()=>{this.getAll().forEach(t=>{t.onFocus()})})}onOnline(){Tn.batch(()=>{this.getAll().forEach(t=>{t.onOnline()})})}},Yj=class{#e;#t;#n;#s;#r;#a;#o;#i;constructor(t={}){this.#e=t.queryCache||new Kj,this.#t=t.mutationCache||new Qj,this.#n=t.defaultOptions||{},this.#s=new Map,this.#r=new Map,this.#a=0}mount(){this.#a++,this.#a===1&&(this.#o=$y.subscribe(async t=>{t&&(await this.resumePausedMutations(),this.#e.onFocus())}),this.#i=af.subscribe(async t=>{t&&(await this.resumePausedMutations(),this.#e.onOnline())}))}unmount(){this.#a--,this.#a===0&&(this.#o?.(),this.#o=void 0,this.#i?.(),this.#i=void 0)}isFetching(t){return this.#e.findAll({...t,fetchStatus:"fetching"}).length}isMutating(t){return this.#t.findAll({...t,status:"pending"}).length}getQueryData(t){const e=this.defaultQueryOptions({queryKey:t});return this.#e.get(e.queryHash)?.state.data}ensureQueryData(t){const e=this.defaultQueryOptions(t),n=this.#e.build(this,e),r=n.state.data;return r===void 0?this.fetchQuery(t):(t.revalidateIfStale&&n.isStaleByTime(ga(e.staleTime,n))&&this.prefetchQuery(e),Promise.resolve(r))}getQueriesData(t){return this.#e.findAll(t).map(({queryKey:e,state:n})=>{const r=n.data;return[e,r]})}setQueryData(t,e,n){const r=this.defaultQueryOptions({queryKey:t}),o=this.#e.get(r.queryHash)?.state.data,l=kj(e,o);if(l!==void 0)return this.#e.build(this,r).setData(l,{...n,manual:!0})}setQueriesData(t,e,n){return Tn.batch(()=>this.#e.findAll(t).map(({queryKey:r})=>[r,this.setQueryData(r,e,n)]))}getQueryState(t){const e=this.defaultQueryOptions({queryKey:t});return this.#e.get(e.queryHash)?.state}removeQueries(t){const e=this.#e;Tn.batch(()=>{e.findAll(t).forEach(n=>{e.remove(n)})})}resetQueries(t,e){const n=this.#e;return Tn.batch(()=>(n.findAll(t).forEach(r=>{r.reset()}),this.refetchQueries({type:"active",...t},e)))}cancelQueries(t,e={}){const n={revert:!0,...e},r=Tn.batch(()=>this.#e.findAll(t).map(i=>i.cancel(n)));return Promise.all(r).then(ir).catch(ir)}invalidateQueries(t,e={}){return Tn.batch(()=>(this.#e.findAll(t).forEach(n=>{n.invalidate()}),t?.refetchType==="none"?Promise.resolve():this.refetchQueries({...t,type:t?.refetchType??t?.type??"active"},e)))}refetchQueries(t,e={}){const n={...e,cancelRefetch:e.cancelRefetch??!0},r=Tn.batch(()=>this.#e.findAll(t).filter(i=>!i.isDisabled()&&!i.isStatic()).map(i=>{let o=i.fetch(void 0,n);return n.throwOnError||(o=o.catch(ir)),i.state.fetchStatus==="paused"?Promise.resolve():o}));return Promise.all(r).then(ir)}fetchQuery(t){const e=this.defaultQueryOptions(t);e.retry===void 0&&(e.retry=!1);const n=this.#e.build(this,e);return n.isStaleByTime(ga(e.staleTime,n))?n.fetch(e):Promise.resolve(n.state.data)}prefetchQuery(t){return this.fetchQuery(t).then(ir).catch(ir)}fetchInfiniteQuery(t){return t.behavior=Qx(t.pages),this.fetchQuery(t)}prefetchInfiniteQuery(t){return this.fetchInfiniteQuery(t).then(ir).catch(ir)}ensureInfiniteQueryData(t){return t.behavior=Qx(t.pages),this.ensureQueryData(t)}resumePausedMutations(){return af.isOnline()?this.#t.resumePausedMutations():Promise.resolve()}getQueryCache(){return this.#e}getMutationCache(){return this.#t}getDefaultOptions(){return this.#n}setDefaultOptions(t){this.#n=t}setQueryDefaults(t,e){this.#s.set(Ao(t),{queryKey:t,defaultOptions:e})}getQueryDefaults(t){const e=[...this.#s.values()],n={};return e.forEach(r=>{Du(t,r.queryKey)&&Object.assign(n,r.defaultOptions)}),n}setMutationDefaults(t,e){this.#r.set(Ao(t),{mutationKey:t,defaultOptions:e})}getMutationDefaults(t){const e=[...this.#r.values()],n={};return e.forEach(r=>{Du(t,r.mutationKey)&&Object.assign(n,r.defaultOptions)}),n}defaultQueryOptions(t){if(t._defaulted)return t;const e={...this.#n.queries,...this.getQueryDefaults(t.queryKey),...t,_defaulted:!0};return e.queryHash||(e.queryHash=Fy(e.queryKey,e)),e.refetchOnReconnect===void 0&&(e.refetchOnReconnect=e.networkMode!=="always"),e.throwOnError===void 0&&(e.throwOnError=!!e.suspense),!e.networkMode&&e.persister&&(e.networkMode="offlineFirst"),e.queryFn===Vy&&(e.enabled=!1),e}defaultMutationOptions(t){return t?._defaulted?t:{...this.#n.mutations,...t?.mutationKey&&this.getMutationDefaults(t.mutationKey),...t,_defaulted:!0}}clear(){this.#e.clear(),this.#t.clear()}},zS=M.createContext(void 0),$t=t=>{const e=M.useContext(zS);if(!e)throw new Error("No QueryClient set, use QueryClientProvider to set one");return e},Xj=({client:t,children:e})=>(M.useEffect(()=>(t.mount(),()=>{t.unmount()}),[t]),u.jsx(zS.Provider,{value:t,children:e})),BS=M.createContext(!1),Zj=()=>M.useContext(BS);BS.Provider;function Jj(){let t=!1;return{clearReset:()=>{t=!1},reset:()=>{t=!0},isReset:()=>t}}var eR=M.createContext(Jj()),tR=()=>M.useContext(eR),nR=(t,e)=>{(t.suspense||t.throwOnError||t.experimental_prefetchInRender)&&(e.isReset()||(t.retryOnMount=!1))},rR=t=>{M.useEffect(()=>{t.clearReset()},[t])},sR=({result:t,errorResetBoundary:e,throwOnError:n,query:r,suspense:i})=>t.isError&&!e.isReset()&&!t.isFetching&&r&&(i&&t.data===void 0||kS(n,[t.error,r])),iR=t=>{if(t.suspense){const n=i=>i==="static"?i:Math.max(i??1e3,1e3),r=t.staleTime;t.staleTime=typeof r=="function"?(...i)=>n(r(...i)):n(r),typeof t.gcTime=="number"&&(t.gcTime=Math.max(t.gcTime,1e3))}},aR=(t,e)=>t.isLoading&&t.isFetching&&!e,oR=(t,e)=>t?.suspense&&e.isPending,Kx=(t,e,n)=>e.fetchOptimistic(t).catch(()=>{n.clearReset()});function lR(t,e,n){const r=Zj(),i=tR(),o=$t(),l=o.defaultQueryOptions(t);o.getDefaultOptions().queries?._experimental_beforeQuery?.(l),l._optimisticResults=r?"isRestoring":"optimistic",iR(l),nR(l,i),rR(i);const d=!o.getQueryCache().get(l.queryHash),[h]=M.useState(()=>new e(o,l)),m=h.getOptimisticResult(l),p=!r&&t.subscribed!==!1;if(M.useSyncExternalStore(M.useCallback(g=>{const v=p?h.subscribe(Tn.batchCalls(g)):ir;return h.updateResult(),v},[h,p]),()=>h.getCurrentResult(),()=>h.getCurrentResult()),M.useEffect(()=>{h.setOptions(l)},[l,h]),oR(l,m))throw Kx(l,h,i);if(sR({result:m,errorResetBoundary:i,throwOnError:l.throwOnError,query:o.getQueryCache().get(l.queryHash),suspense:l.suspense}))throw m.error;return o.getDefaultOptions().queries?._experimental_afterQuery?.(l,m),l.experimental_prefetchInRender&&!To&&aR(m,r)&&(d?Kx(l,h,i):o.getQueryCache().get(l.queryHash)?.promise)?.catch(ir).finally(()=>{h.updateResult()}),l.notifyOnChangeProps?m:h.trackResult(m)}function Mo(t,e){return lR(t,Vj)}function Gn(t,e){const n=$t(),[r]=M.useState(()=>new Wj(n,t));M.useEffect(()=>{r.setOptions(t)},[r,t]);const i=M.useSyncExternalStore(M.useCallback(l=>r.subscribe(Tn.batchCalls(l)),[r]),()=>r.getCurrentResult(),()=>r.getCurrentResult()),o=M.useCallback((l,d)=>{r.mutate(l,d).catch(ir)},[r]);if(i.error&&kS(r.options.throwOnError,[i.error]))throw i.error;return{...i,mutate:o,mutateAsync:i.mutate}}const cR={isLoading:!1,loadingMessage:"Loading...",addLoadingHold:()=>{},removeLoadingHold:()=>{}},LS=M.createContext(cR);function uR({children:t}){const[e,n]=M.useState(new Map),r=M.useCallback((h,m)=>{n(p=>new Map(p).set(h,m))},[]),i=M.useCallback(h=>{n(m=>{const p=new Map(m);return p.delete(h),p})},[]),o=e.size>0,l=e.size>0&&Array.from(e.values()).pop()||"Loading...",d={isLoading:o,loadingMessage:l,addLoadingHold:r,removeLoadingHold:i};return u.jsx(LS.Provider,{value:d,children:t})}function Qn(){const t=M.useContext(LS);if(!t)throw new Error("useApp must be used within an AppProvider");return t}const dR=()=>{};var Yx={};const US=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let i=t.charCodeAt(r);i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=i&63|128):(i&64512)===55296&&r+1<t.length&&(t.charCodeAt(r+1)&64512)===56320?(i=65536+((i&1023)<<10)+(t.charCodeAt(++r)&1023),e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=i&63|128):(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=i&63|128)}return e},hR=function(t){const e=[];let n=0,r=0;for(;n<t.length;){const i=t[n++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){const o=t[n++];e[r++]=String.fromCharCode((i&31)<<6|o&63)}else if(i>239&&i<365){const o=t[n++],l=t[n++],d=t[n++],h=((i&7)<<18|(o&63)<<12|(l&63)<<6|d&63)-65536;e[r++]=String.fromCharCode(55296+(h>>10)),e[r++]=String.fromCharCode(56320+(h&1023))}else{const o=t[n++],l=t[n++];e[r++]=String.fromCharCode((i&15)<<12|(o&63)<<6|l&63)}}return e.join("")},FS={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<t.length;i+=3){const o=t[i],l=i+1<t.length,d=l?t[i+1]:0,h=i+2<t.length,m=h?t[i+2]:0,p=o>>2,g=(o&3)<<4|d>>4;let v=(d&15)<<2|m>>6,b=m&63;h||(b=64,l||(v=64)),r.push(n[p],n[g],n[v],n[b])}return r.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(US(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):hR(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<t.length;){const o=n[t.charAt(i++)],d=i<t.length?n[t.charAt(i)]:0;++i;const m=i<t.length?n[t.charAt(i)]:64;++i;const g=i<t.length?n[t.charAt(i)]:64;if(++i,o==null||d==null||m==null||g==null)throw new fR;const v=o<<2|d>>4;if(r.push(v),m!==64){const b=d<<4&240|m>>2;if(r.push(b),g!==64){const C=m<<6&192|g;r.push(C)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class fR extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const mR=function(t){const e=US(t);return FS.encodeByteArray(e,!0)},of=function(t){return mR(t).replace(/\./g,"")},VS=function(t){try{return FS.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function pR(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const gR=()=>pR().__FIREBASE_DEFAULTS__,yR=()=>{if(typeof process>"u"||typeof Yx>"u")return;const t=Yx.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},_R=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&VS(t[1]);return e&&JSON.parse(e)},Uf=()=>{try{return dR()||gR()||yR()||_R()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},$S=t=>Uf()?.emulatorHosts?.[t],bR=t=>{const e=$S(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(n+1),10);return e[0]==="["?[e.substring(1,n-1),r]:[e.substring(0,n),r]},qS=()=>Uf()?.config,HS=t=>Uf()?.[`_${t}`];class vR{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,r)=>{n?this.reject(n):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,r))}}}function rc(t){try{return(t.startsWith("http://")||t.startsWith("https://")?new URL(t).hostname:t).endsWith(".cloudworkstations.dev")}catch{return!1}}async function GS(t){return(await fetch(t,{credentials:"include"})).ok}function xR(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n={alg:"none",type:"JWT"},r=e||"demo-project",i=t.iat||0,o=t.sub||t.user_id;if(!o)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const l={iss:`https://securetoken.google.com/${r}`,aud:r,iat:i,exp:i+3600,auth_time:i,sub:o,user_id:o,firebase:{sign_in_provider:"custom",identities:{}},...t};return[of(JSON.stringify(n)),of(JSON.stringify(l)),""].join(".")}const Eu={};function wR(){const t={prod:[],emulator:[]};for(const e of Object.keys(Eu))Eu[e]?t.emulator.push(e):t.prod.push(e);return t}function SR(t){let e=document.getElementById(t),n=!1;return e||(e=document.createElement("div"),e.setAttribute("id",t),n=!0),{created:n,element:e}}let Xx=!1;function QS(t,e){if(typeof window>"u"||typeof document>"u"||!rc(window.location.host)||Eu[t]===e||Eu[t]||Xx)return;Eu[t]=e;function n(v){return`__firebase__banner__${v}`}const r="__firebase__banner",o=wR().prod.length>0;function l(){const v=document.getElementById(r);v&&v.remove()}function d(v){v.style.display="flex",v.style.background="#7faaf0",v.style.position="fixed",v.style.bottom="5px",v.style.left="5px",v.style.padding=".5em",v.style.borderRadius="5px",v.style.alignItems="center"}function h(v,b){v.setAttribute("width","24"),v.setAttribute("id",b),v.setAttribute("height","24"),v.setAttribute("viewBox","0 0 24 24"),v.setAttribute("fill","none"),v.style.marginLeft="-6px"}function m(){const v=document.createElement("span");return v.style.cursor="pointer",v.style.marginLeft="16px",v.style.fontSize="24px",v.innerHTML=" &times;",v.onclick=()=>{Xx=!0,l()},v}function p(v,b){v.setAttribute("id",b),v.innerText="Learn more",v.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",v.setAttribute("target","__blank"),v.style.paddingLeft="5px",v.style.textDecoration="underline"}function g(){const v=SR(r),b=n("text"),C=document.getElementById(b)||document.createElement("span"),x=n("learnmore"),S=document.getElementById(x)||document.createElement("a"),E=n("preprendIcon"),T=document.getElementById(E)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(v.created){const I=v.element;d(I),p(S,x);const D=m();h(T,E),I.append(T,C,S,D),document.body.appendChild(I)}o?(C.innerText="Preview backend disconnected.",T.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(T.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,C.innerText="Preview backend running in this workspace."),C.setAttribute("id",b)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",g):g()}function er(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function CR(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(er())}function ER(){const t=Uf()?.forceEnvironment;if(t==="node")return!0;if(t==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function TR(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function AR(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function jR(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function RR(){const t=er();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function IR(){return!ER()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function kR(){try{return typeof indexedDB=="object"}catch{return!1}}function DR(){return new Promise((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{e(i.error?.message||"")}}catch(n){e(n)}})}const MR="FirebaseError";class Ti extends Error{constructor(e,n,r){super(n),this.code=e,this.customData=r,this.name=MR,Object.setPrototypeOf(this,Ti.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Ku.prototype.create)}}class Ku{constructor(e,n,r){this.service=e,this.serviceName=n,this.errors=r}create(e,...n){const r=n[0]||{},i=`${this.service}/${e}`,o=this.errors[e],l=o?OR(o,r):"Error",d=`${this.serviceName}: ${l} (${i}).`;return new Ti(i,d,r)}}function OR(t,e){return t.replace(NR,(n,r)=>{const i=e[r];return i!=null?String(i):`<${r}?>`})}const NR=/\{\$([^}]+)}/g;function PR(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function bi(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const i of n){if(!r.includes(i))return!1;const o=t[i],l=e[i];if(Zx(o)&&Zx(l)){if(!bi(o,l))return!1}else if(o!==l)return!1}for(const i of r)if(!n.includes(i))return!1;return!0}function Zx(t){return t!==null&&typeof t=="object"}function Yu(t){const e=[];for(const[n,r]of Object.entries(t))Array.isArray(r)?r.forEach(i=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function bu(t){const e={};return t.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[i,o]=r.split("=");e[decodeURIComponent(i)]=decodeURIComponent(o)}}),e}function vu(t){const e=t.indexOf("?");if(!e)return"";const n=t.indexOf("#",e);return t.substring(e,n>0?n:void 0)}function zR(t,e){const n=new BR(t,e);return n.subscribe.bind(n)}class BR{constructor(e,n){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(n=>{n.next(e)})}error(e){this.forEachObserver(n=>{n.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,n,r){let i;if(e===void 0&&n===void 0&&r===void 0)throw new Error("Missing Observer.");LR(e,["next","error","complete"])?i=e:i={next:e,error:n,complete:r},i.next===void 0&&(i.next=jg),i.error===void 0&&(i.error=jg),i.complete===void 0&&(i.complete=jg);const o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),o}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let n=0;n<this.observers.length;n++)this.sendOne(n,e)}sendOne(e,n){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{n(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function LR(t,e){if(typeof t!="object"||t===null)return!1;for(const n of e)if(n in t&&typeof t[n]=="function")return!0;return!1}function jg(){}function wn(t){return t&&t._delegate?t._delegate:t}class jo{constructor(e,n,r){this.name=e,this.instanceFactory=n,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const _o="[DEFAULT]";class UR{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){const r=new vR;if(this.instancesDeferred.set(n,r),this.isInitialized(n)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:n});i&&r.resolve(i)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){const n=this.normalizeInstanceIdentifier(e?.identifier),r=e?.optional??!1;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(i){if(r)return null;throw i}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(VR(e))try{this.getOrInitializeService({instanceIdentifier:_o})}catch{}for(const[n,r]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(n);try{const o=this.getOrInitializeService({instanceIdentifier:i});r.resolve(o)}catch{}}}}clearInstance(e=_o){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=_o){return this.instances.has(e)}getOptions(e=_o){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:n={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:r,options:n});for(const[o,l]of this.instancesDeferred.entries()){const d=this.normalizeInstanceIdentifier(o);r===d&&l.resolve(i)}return i}onInit(e,n){const r=this.normalizeInstanceIdentifier(n),i=this.onInitCallbacks.get(r)??new Set;i.add(e),this.onInitCallbacks.set(r,i);const o=this.instances.get(r);return o&&e(o,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,n){const r=this.onInitCallbacks.get(n);if(r)for(const i of r)try{i(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:FR(e),options:n}),this.instances.set(e,r),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=_o){return this.component?this.component.multipleInstances?e:_o:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function FR(t){return t===_o?void 0:t}function VR(t){return t.instantiationMode==="EAGER"}class $R{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const n=new UR(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}}var ft;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(ft||(ft={}));const qR={debug:ft.DEBUG,verbose:ft.VERBOSE,info:ft.INFO,warn:ft.WARN,error:ft.ERROR,silent:ft.SILENT},HR=ft.INFO,GR={[ft.DEBUG]:"log",[ft.VERBOSE]:"log",[ft.INFO]:"info",[ft.WARN]:"warn",[ft.ERROR]:"error"},QR=(t,e,...n)=>{if(e<t.logLevel)return;const r=new Date().toISOString(),i=GR[e];if(i)console[i](`[${r}]  ${t.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Hy{constructor(e){this.name=e,this._logLevel=HR,this._logHandler=QR,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in ft))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?qR[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,ft.DEBUG,...e),this._logHandler(this,ft.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,ft.VERBOSE,...e),this._logHandler(this,ft.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,ft.INFO,...e),this._logHandler(this,ft.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,ft.WARN,...e),this._logHandler(this,ft.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,ft.ERROR,...e),this._logHandler(this,ft.ERROR,...e)}}const WR=(t,e)=>e.some(n=>t instanceof n);let Jx,ew;function KR(){return Jx||(Jx=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function YR(){return ew||(ew=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const WS=new WeakMap,sy=new WeakMap,KS=new WeakMap,Rg=new WeakMap,Gy=new WeakMap;function XR(t){const e=new Promise((n,r)=>{const i=()=>{t.removeEventListener("success",o),t.removeEventListener("error",l)},o=()=>{n(ya(t.result)),i()},l=()=>{r(t.error),i()};t.addEventListener("success",o),t.addEventListener("error",l)});return e.then(n=>{n instanceof IDBCursor&&WS.set(n,t)}).catch(()=>{}),Gy.set(e,t),e}function ZR(t){if(sy.has(t))return;const e=new Promise((n,r)=>{const i=()=>{t.removeEventListener("complete",o),t.removeEventListener("error",l),t.removeEventListener("abort",l)},o=()=>{n(),i()},l=()=>{r(t.error||new DOMException("AbortError","AbortError")),i()};t.addEventListener("complete",o),t.addEventListener("error",l),t.addEventListener("abort",l)});sy.set(t,e)}let iy={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return sy.get(t);if(e==="objectStoreNames")return t.objectStoreNames||KS.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return ya(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function JR(t){iy=t(iy)}function eI(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const r=t.call(Ig(this),e,...n);return KS.set(r,e.sort?e.sort():[e]),ya(r)}:YR().includes(t)?function(...e){return t.apply(Ig(this),e),ya(WS.get(this))}:function(...e){return ya(t.apply(Ig(this),e))}}function tI(t){return typeof t=="function"?eI(t):(t instanceof IDBTransaction&&ZR(t),WR(t,KR())?new Proxy(t,iy):t)}function ya(t){if(t instanceof IDBRequest)return XR(t);if(Rg.has(t))return Rg.get(t);const e=tI(t);return e!==t&&(Rg.set(t,e),Gy.set(e,t)),e}const Ig=t=>Gy.get(t);function nI(t,e,{blocked:n,upgrade:r,blocking:i,terminated:o}={}){const l=indexedDB.open(t,e),d=ya(l);return r&&l.addEventListener("upgradeneeded",h=>{r(ya(l.result),h.oldVersion,h.newVersion,ya(l.transaction),h)}),n&&l.addEventListener("blocked",h=>n(h.oldVersion,h.newVersion,h)),d.then(h=>{o&&h.addEventListener("close",()=>o()),i&&h.addEventListener("versionchange",m=>i(m.oldVersion,m.newVersion,m))}).catch(()=>{}),d}const rI=["get","getKey","getAll","getAllKeys","count"],sI=["put","add","delete","clear"],kg=new Map;function tw(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(kg.get(e))return kg.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,i=sI.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(i||rI.includes(n)))return;const o=async function(l,...d){const h=this.transaction(l,i?"readwrite":"readonly");let m=h.store;return r&&(m=m.index(d.shift())),(await Promise.all([m[n](...d),i&&h.done]))[0]};return kg.set(e,o),o}JR(t=>({...t,get:(e,n,r)=>tw(e,n)||t.get(e,n,r),has:(e,n)=>!!tw(e,n)||t.has(e,n)}));class iI{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(aI(n)){const r=n.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(n=>n).join(" ")}}function aI(t){return t.getComponent()?.type==="VERSION"}const ay="@firebase/app",nw="0.14.6";const vi=new Hy("@firebase/app"),oI="@firebase/app-compat",lI="@firebase/analytics-compat",cI="@firebase/analytics",uI="@firebase/app-check-compat",dI="@firebase/app-check",hI="@firebase/auth",fI="@firebase/auth-compat",mI="@firebase/database",pI="@firebase/data-connect",gI="@firebase/database-compat",yI="@firebase/functions",_I="@firebase/functions-compat",bI="@firebase/installations",vI="@firebase/installations-compat",xI="@firebase/messaging",wI="@firebase/messaging-compat",SI="@firebase/performance",CI="@firebase/performance-compat",EI="@firebase/remote-config",TI="@firebase/remote-config-compat",AI="@firebase/storage",jI="@firebase/storage-compat",RI="@firebase/firestore",II="@firebase/ai",kI="@firebase/firestore-compat",DI="firebase",MI="12.6.0";const oy="[DEFAULT]",OI={[ay]:"fire-core",[oI]:"fire-core-compat",[cI]:"fire-analytics",[lI]:"fire-analytics-compat",[dI]:"fire-app-check",[uI]:"fire-app-check-compat",[hI]:"fire-auth",[fI]:"fire-auth-compat",[mI]:"fire-rtdb",[pI]:"fire-data-connect",[gI]:"fire-rtdb-compat",[yI]:"fire-fn",[_I]:"fire-fn-compat",[bI]:"fire-iid",[vI]:"fire-iid-compat",[xI]:"fire-fcm",[wI]:"fire-fcm-compat",[SI]:"fire-perf",[CI]:"fire-perf-compat",[EI]:"fire-rc",[TI]:"fire-rc-compat",[AI]:"fire-gcs",[jI]:"fire-gcs-compat",[RI]:"fire-fst",[kI]:"fire-fst-compat",[II]:"fire-vertex","fire-js":"fire-js",[DI]:"fire-js-all"};const lf=new Map,NI=new Map,ly=new Map;function rw(t,e){try{t.container.addComponent(e)}catch(n){vi.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function Vl(t){const e=t.name;if(ly.has(e))return vi.debug(`There were multiple attempts to register component ${e}.`),!1;ly.set(e,t);for(const n of lf.values())rw(n,t);for(const n of NI.values())rw(n,t);return!0}function Qy(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function os(t){return t==null?!1:t.settings!==void 0}const PI={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},_a=new Ku("app","Firebase",PI);class zI{constructor(e,n,r){this._isDeleted=!1,this._options={...e},this._config={...n},this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new jo("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw _a.create("app-deleted",{appName:this._name})}}const sc=MI;function YS(t,e={}){let n=t;typeof e!="object"&&(e={name:e});const r={name:oy,automaticDataCollectionEnabled:!0,...e},i=r.name;if(typeof i!="string"||!i)throw _a.create("bad-app-name",{appName:String(i)});if(n||(n=qS()),!n)throw _a.create("no-options");const o=lf.get(i);if(o){if(bi(n,o.options)&&bi(r,o.config))return o;throw _a.create("duplicate-app",{appName:i})}const l=new $R(i);for(const h of ly.values())l.addComponent(h);const d=new zI(n,r,l);return lf.set(i,d),d}function XS(t=oy){const e=lf.get(t);if(!e&&t===oy&&qS())return YS();if(!e)throw _a.create("no-app",{appName:t});return e}function ba(t,e,n){let r=OI[t]??t;n&&(r+=`-${n}`);const i=r.match(/\s|\//),o=e.match(/\s|\//);if(i||o){const l=[`Unable to register library "${r}" with version "${e}":`];i&&l.push(`library name "${r}" contains illegal characters (whitespace or "/")`),i&&o&&l.push("and"),o&&l.push(`version name "${e}" contains illegal characters (whitespace or "/")`),vi.warn(l.join(" "));return}Vl(new jo(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}const BI="firebase-heartbeat-database",LI=1,Mu="firebase-heartbeat-store";let Dg=null;function ZS(){return Dg||(Dg=nI(BI,LI,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(Mu)}catch(n){console.warn(n)}}}}).catch(t=>{throw _a.create("idb-open",{originalErrorMessage:t.message})})),Dg}async function UI(t){try{const n=(await ZS()).transaction(Mu),r=await n.objectStore(Mu).get(JS(t));return await n.done,r}catch(e){if(e instanceof Ti)vi.warn(e.message);else{const n=_a.create("idb-get",{originalErrorMessage:e?.message});vi.warn(n.message)}}}async function sw(t,e){try{const r=(await ZS()).transaction(Mu,"readwrite");await r.objectStore(Mu).put(e,JS(t)),await r.done}catch(n){if(n instanceof Ti)vi.warn(n.message);else{const r=_a.create("idb-set",{originalErrorMessage:n?.message});vi.warn(r.message)}}}function JS(t){return`${t.name}!${t.options.appId}`}const FI=1024,VI=30;class $I{constructor(e){this.container=e,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new HI(n),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){try{const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=iw();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(i=>i.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:n}),this._heartbeatsCache.heartbeats.length>VI){const i=GI(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(i,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){vi.warn(e)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const e=iw(),{heartbeatsToSend:n,unsentEntries:r}=qI(this._heartbeatsCache.heartbeats),i=of(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(e){return vi.warn(e),""}}}function iw(){return new Date().toISOString().substring(0,10)}function qI(t,e=FI){const n=[];let r=t.slice();for(const i of t){const o=n.find(l=>l.agent===i.agent);if(o){if(o.dates.push(i.date),aw(n)>e){o.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),aw(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}class HI{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return kR()?DR().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const n=await UI(this.app);return n?.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return sw(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return sw(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function aw(t){return of(JSON.stringify({version:2,heartbeats:t})).length}function GI(t){if(t.length===0)return-1;let e=0,n=t[0].date;for(let r=1;r<t.length;r++)t[r].date<n&&(n=t[r].date,e=r);return e}function QI(t){Vl(new jo("platform-logger",e=>new iI(e),"PRIVATE")),Vl(new jo("heartbeat",e=>new $I(e),"PRIVATE")),ba(ay,nw,t),ba(ay,nw,"esm2020"),ba("fire-js","")}QI("");function eC(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const WI=eC,tC=new Ku("auth","Firebase",eC());const cf=new Hy("@firebase/auth");function KI(t,...e){cf.logLevel<=ft.WARN&&cf.warn(`Auth (${sc}): ${t}`,...e)}function Qh(t,...e){cf.logLevel<=ft.ERROR&&cf.error(`Auth (${sc}): ${t}`,...e)}function ds(t,...e){throw Wy(t,...e)}function Us(t,...e){return Wy(t,...e)}function nC(t,e,n){const r={...WI(),[e]:n};return new Ku("auth","Firebase",r).create(e,{appName:t.name})}function va(t){return nC(t,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Wy(t,...e){if(typeof t!="string"){const n=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=t.name),t._errorFactory.create(n,...r)}return tC.create(t,...e)}function We(t,e,...n){if(!t)throw Wy(e,...n)}function mi(t){const e="INTERNAL ASSERTION FAILED: "+t;throw Qh(e),new Error(e)}function xi(t,e){t||mi(e)}function cy(){return typeof self<"u"&&self.location?.href||""}function YI(){return ow()==="http:"||ow()==="https:"}function ow(){return typeof self<"u"&&self.location?.protocol||null}function XI(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(YI()||AR()||"connection"in navigator)?navigator.onLine:!0}function ZI(){if(typeof navigator>"u")return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}class Xu{constructor(e,n){this.shortDelay=e,this.longDelay=n,xi(n>e,"Short delay should be less than long delay!"),this.isMobile=CR()||jR()}get(){return XI()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function Ky(t,e){xi(t.emulator,"Emulator should always be set here");const{url:n}=t.emulator;return e?`${n}${e.startsWith("/")?e.slice(1):e}`:n}class rC{static initialize(e,n,r){this.fetchImpl=e,n&&(this.headersImpl=n),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;mi("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;mi("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;mi("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const JI={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};const ek=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],tk=new Xu(3e4,6e4);function Oo(t,e){return t.tenantId&&!e.tenantId?{...e,tenantId:t.tenantId}:e}async function Oa(t,e,n,r,i={}){return sC(t,i,async()=>{let o={},l={};r&&(e==="GET"?l=r:o={body:JSON.stringify(r)});const d=Yu({key:t.config.apiKey,...l}).slice(1),h=await t._getAdditionalHeaders();h["Content-Type"]="application/json",t.languageCode&&(h["X-Firebase-Locale"]=t.languageCode);const m={method:e,headers:h,...o};return TR()||(m.referrerPolicy="no-referrer"),t.emulatorConfig&&rc(t.emulatorConfig.host)&&(m.credentials="include"),rC.fetch()(await iC(t,t.config.apiHost,n,d),m)})}async function sC(t,e,n){t._canInitEmulator=!1;const r={...JI,...e};try{const i=new rk(t),o=await Promise.race([n(),i.promise]);i.clearNetworkTimeout();const l=await o.json();if("needConfirmation"in l)throw zh(t,"account-exists-with-different-credential",l);if(o.ok&&!("errorMessage"in l))return l;{const d=o.ok?l.errorMessage:l.error.message,[h,m]=d.split(" : ");if(h==="FEDERATED_USER_ID_ALREADY_LINKED")throw zh(t,"credential-already-in-use",l);if(h==="EMAIL_EXISTS")throw zh(t,"email-already-in-use",l);if(h==="USER_DISABLED")throw zh(t,"user-disabled",l);const p=r[h]||h.toLowerCase().replace(/[_\s]+/g,"-");if(m)throw nC(t,p,m);ds(t,p)}}catch(i){if(i instanceof Ti)throw i;ds(t,"network-request-failed",{message:String(i)})}}async function Ff(t,e,n,r,i={}){const o=await Oa(t,e,n,r,i);return"mfaPendingCredential"in o&&ds(t,"multi-factor-auth-required",{_serverResponse:o}),o}async function iC(t,e,n,r){const i=`${e}${n}?${r}`,o=t,l=o.config.emulator?Ky(t.config,i):`${t.config.apiScheme}://${i}`;return ek.includes(n)&&(await o._persistenceManagerAvailable,o._getPersistenceType()==="COOKIE")?o._getPersistence()._getFinalTarget(l).toString():l}function nk(t){switch(t){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class rk{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((n,r)=>{this.timer=setTimeout(()=>r(Us(this.auth,"network-request-failed")),tk.get())})}}function zh(t,e,n){const r={appName:t.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const i=Us(t,e,r);return i.customData._tokenResponse=n,i}function lw(t){return t!==void 0&&t.enterprise!==void 0}class sk{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const n of this.recaptchaEnforcementState)if(n.provider&&n.provider===e)return nk(n.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function ik(t,e){return Oa(t,"GET","/v2/recaptchaConfig",Oo(t,e))}async function ak(t,e){return Oa(t,"POST","/v1/accounts:delete",e)}async function uf(t,e){return Oa(t,"POST","/v1/accounts:lookup",e)}function Tu(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function ok(t,e=!1){const n=wn(t),r=await n.getIdToken(e),i=Yy(r);We(i&&i.exp&&i.auth_time&&i.iat,n.auth,"internal-error");const o=typeof i.firebase=="object"?i.firebase:void 0,l=o?.sign_in_provider;return{claims:i,token:r,authTime:Tu(Mg(i.auth_time)),issuedAtTime:Tu(Mg(i.iat)),expirationTime:Tu(Mg(i.exp)),signInProvider:l||null,signInSecondFactor:o?.sign_in_second_factor||null}}function Mg(t){return Number(t)*1e3}function Yy(t){const[e,n,r]=t.split(".");if(e===void 0||n===void 0||r===void 0)return Qh("JWT malformed, contained fewer than 3 sections"),null;try{const i=VS(n);return i?JSON.parse(i):(Qh("Failed to decode base64 JWT payload"),null)}catch(i){return Qh("Caught error parsing JWT payload as JSON",i?.toString()),null}}function cw(t){const e=Yy(t);return We(e,"internal-error"),We(typeof e.exp<"u","internal-error"),We(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}async function Ou(t,e,n=!1){if(n)return e;try{return await e}catch(r){throw r instanceof Ti&&lk(r)&&t.auth.currentUser===t&&await t.auth.signOut(),r}}function lk({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}class ck{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const n=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),n}else{this.errorBackoff=3e4;const r=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;const n=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},n)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class uy{constructor(e,n){this.createdAt=e,this.lastLoginAt=n,this._initializeTime()}_initializeTime(){this.lastSignInTime=Tu(this.lastLoginAt),this.creationTime=Tu(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function df(t){const e=t.auth,n=await t.getIdToken(),r=await Ou(t,uf(e,{idToken:n}));We(r?.users.length,e,"internal-error");const i=r.users[0];t._notifyReloadListener(i);const o=i.providerUserInfo?.length?aC(i.providerUserInfo):[],l=dk(t.providerData,o),d=t.isAnonymous,h=!(t.email&&i.passwordHash)&&!l?.length,m=d?h:!1,p={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:l,metadata:new uy(i.createdAt,i.lastLoginAt),isAnonymous:m};Object.assign(t,p)}async function uk(t){const e=wn(t);await df(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function dk(t,e){return[...t.filter(r=>!e.some(i=>i.providerId===r.providerId)),...e]}function aC(t){return t.map(({providerId:e,...n})=>({providerId:e,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}))}async function hk(t,e){const n=await sC(t,{},async()=>{const r=Yu({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:o}=t.config,l=await iC(t,i,"/v1/token",`key=${o}`),d=await t._getAdditionalHeaders();d["Content-Type"]="application/x-www-form-urlencoded";const h={method:"POST",headers:d,body:r};return t.emulatorConfig&&rc(t.emulatorConfig.host)&&(h.credentials="include"),rC.fetch()(l,h)});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}async function fk(t,e){return Oa(t,"POST","/v2/accounts:revokeToken",Oo(t,e))}class zl{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){We(e.idToken,"internal-error"),We(typeof e.idToken<"u","internal-error"),We(typeof e.refreshToken<"u","internal-error");const n="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):cw(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,n)}updateFromIdToken(e){We(e.length!==0,"internal-error");const n=cw(e);this.updateTokensAndExpiration(e,null,n)}async getToken(e,n=!1){return!n&&this.accessToken&&!this.isExpired?this.accessToken:(We(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,n){const{accessToken:r,refreshToken:i,expiresIn:o}=await hk(e,n);this.updateTokensAndExpiration(r,i,Number(o))}updateTokensAndExpiration(e,n,r){this.refreshToken=n||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,n){const{refreshToken:r,accessToken:i,expirationTime:o}=n,l=new zl;return r&&(We(typeof r=="string","internal-error",{appName:e}),l.refreshToken=r),i&&(We(typeof i=="string","internal-error",{appName:e}),l.accessToken=i),o&&(We(typeof o=="number","internal-error",{appName:e}),l.expirationTime=o),l}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new zl,this.toJSON())}_performRefresh(){return mi("not implemented")}}function aa(t,e){We(typeof t=="string"||typeof t>"u","internal-error",{appName:e})}class ls{constructor({uid:e,auth:n,stsTokenManager:r,...i}){this.providerId="firebase",this.proactiveRefresh=new ck(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new uy(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const n=await Ou(this,this.stsTokenManager.getToken(this.auth,e));return We(n,this.auth,"internal-error"),this.accessToken!==n&&(this.accessToken=n,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),n}getIdTokenResult(e){return ok(this,e)}reload(){return uk(this)}_assign(e){this!==e&&(We(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(n=>({...n})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const n=new ls({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return n.metadata._copy(this.metadata),n}_onReload(e){We(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,n=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),n&&await df(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(os(this.auth.app))return Promise.reject(va(this.auth));const e=await this.getIdToken();return await Ou(this,ak(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,n){const r=n.displayName??void 0,i=n.email??void 0,o=n.phoneNumber??void 0,l=n.photoURL??void 0,d=n.tenantId??void 0,h=n._redirectEventId??void 0,m=n.createdAt??void 0,p=n.lastLoginAt??void 0,{uid:g,emailVerified:v,isAnonymous:b,providerData:C,stsTokenManager:x}=n;We(g&&x,e,"internal-error");const S=zl.fromJSON(this.name,x);We(typeof g=="string",e,"internal-error"),aa(r,e.name),aa(i,e.name),We(typeof v=="boolean",e,"internal-error"),We(typeof b=="boolean",e,"internal-error"),aa(o,e.name),aa(l,e.name),aa(d,e.name),aa(h,e.name),aa(m,e.name),aa(p,e.name);const E=new ls({uid:g,auth:e,email:i,emailVerified:v,displayName:r,isAnonymous:b,photoURL:l,phoneNumber:o,tenantId:d,stsTokenManager:S,createdAt:m,lastLoginAt:p});return C&&Array.isArray(C)&&(E.providerData=C.map(T=>({...T}))),h&&(E._redirectEventId=h),E}static async _fromIdTokenResponse(e,n,r=!1){const i=new zl;i.updateFromServerResponse(n);const o=new ls({uid:n.localId,auth:e,stsTokenManager:i,isAnonymous:r});return await df(o),o}static async _fromGetAccountInfoResponse(e,n,r){const i=n.users[0];We(i.localId!==void 0,"internal-error");const o=i.providerUserInfo!==void 0?aC(i.providerUserInfo):[],l=!(i.email&&i.passwordHash)&&!o?.length,d=new zl;d.updateFromIdToken(r);const h=new ls({uid:i.localId,auth:e,stsTokenManager:d,isAnonymous:l}),m={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:o,metadata:new uy(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!o?.length};return Object.assign(h,m),h}}const uw=new Map;function pi(t){xi(t instanceof Function,"Expected a class definition");let e=uw.get(t);return e?(xi(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,uw.set(t,e),e)}class oC{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,n){this.storage[e]=n}async _get(e){const n=this.storage[e];return n===void 0?null:n}async _remove(e){delete this.storage[e]}_addListener(e,n){}_removeListener(e,n){}}oC.type="NONE";const dw=oC;function Wh(t,e,n){return`firebase:${t}:${e}:${n}`}class Bl{constructor(e,n,r){this.persistence=e,this.auth=n,this.userKey=r;const{config:i,name:o}=this.auth;this.fullUserKey=Wh(this.userKey,i.apiKey,o),this.fullPersistenceKey=Wh("persistence",i.apiKey,o),this.boundEventHandler=n._onStorageEvent.bind(n),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const n=await uf(this.auth,{idToken:e}).catch(()=>{});return n?ls._fromGetAccountInfoResponse(this.auth,n,e):null}return ls._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const n=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,n)return this.setCurrentUser(n)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,n,r="authUser"){if(!n.length)return new Bl(pi(dw),e,r);const i=(await Promise.all(n.map(async m=>{if(await m._isAvailable())return m}))).filter(m=>m);let o=i[0]||pi(dw);const l=Wh(r,e.config.apiKey,e.name);let d=null;for(const m of n)try{const p=await m._get(l);if(p){let g;if(typeof p=="string"){const v=await uf(e,{idToken:p}).catch(()=>{});if(!v)break;g=await ls._fromGetAccountInfoResponse(e,v,p)}else g=ls._fromJSON(e,p);m!==o&&(d=g),o=m;break}}catch{}const h=i.filter(m=>m._shouldAllowMigration);return!o._shouldAllowMigration||!h.length?new Bl(o,e,r):(o=h[0],d&&await o._set(l,d.toJSON()),await Promise.all(n.map(async m=>{if(m!==o)try{await m._remove(l)}catch{}})),new Bl(o,e,r))}}function hw(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(dC(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(lC(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(fC(e))return"Blackberry";if(mC(e))return"Webos";if(cC(e))return"Safari";if((e.includes("chrome/")||uC(e))&&!e.includes("edge/"))return"Chrome";if(hC(e))return"Android";{const n=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=t.match(n);if(r?.length===2)return r[1]}return"Other"}function lC(t=er()){return/firefox\//i.test(t)}function cC(t=er()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function uC(t=er()){return/crios\//i.test(t)}function dC(t=er()){return/iemobile/i.test(t)}function hC(t=er()){return/android/i.test(t)}function fC(t=er()){return/blackberry/i.test(t)}function mC(t=er()){return/webos/i.test(t)}function Xy(t=er()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function mk(t=er()){return Xy(t)&&!!window.navigator?.standalone}function pk(){return RR()&&document.documentMode===10}function pC(t=er()){return Xy(t)||hC(t)||mC(t)||fC(t)||/windows phone/i.test(t)||dC(t)}function gC(t,e=[]){let n;switch(t){case"Browser":n=hw(er());break;case"Worker":n=`${hw(er())}-${t}`;break;default:n=t}const r=e.length?e.join(","):"FirebaseCore-web";return`${n}/JsCore/${sc}/${r}`}class gk{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,n){const r=o=>new Promise((l,d)=>{try{const h=e(o);l(h)}catch(h){d(h)}});r.onAbort=n,this.queue.push(r);const i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const n=[];try{for(const r of this.queue)await r(e),r.onAbort&&n.push(r.onAbort)}catch(r){n.reverse();for(const i of n)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r?.message})}}}async function yk(t,e={}){return Oa(t,"GET","/v2/passwordPolicy",Oo(t,e))}const _k=6;class bk{constructor(e){const n=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=n.minPasswordLength??_k,n.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=n.maxPasswordLength),n.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=n.containsLowercaseCharacter),n.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=n.containsUppercaseCharacter),n.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=n.containsNumericCharacter),n.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=n.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const n={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,n),this.validatePasswordCharacterOptions(e,n),n.isValid&&(n.isValid=n.meetsMinPasswordLength??!0),n.isValid&&(n.isValid=n.meetsMaxPasswordLength??!0),n.isValid&&(n.isValid=n.containsLowercaseLetter??!0),n.isValid&&(n.isValid=n.containsUppercaseLetter??!0),n.isValid&&(n.isValid=n.containsNumericCharacter??!0),n.isValid&&(n.isValid=n.containsNonAlphanumericCharacter??!0),n}validatePasswordLengthOptions(e,n){const r=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;r&&(n.meetsMinPasswordLength=e.length>=r),i&&(n.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,n){this.updatePasswordCharacterOptionsStatuses(n,!1,!1,!1,!1);let r;for(let i=0;i<e.length;i++)r=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(n,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,n,r,i,o){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=n)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=o))}}class vk{constructor(e,n,r,i){this.app=e,this.heartbeatServiceProvider=n,this.appCheckServiceProvider=r,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new fw(this),this.idTokenSubscription=new fw(this),this.beforeStateQueue=new gk(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=tC,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion,this._persistenceManagerAvailable=new Promise(o=>this._resolvePersistenceManagerAvailable=o)}_initializeWithPersistence(e,n){return n&&(this._popupRedirectResolver=pi(n)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await Bl.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(n),this.lastNotifiedUid=this.currentUser?.uid||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const n=await uf(this,{idToken:e}),r=await ls._fromGetAccountInfoResponse(this,n,e);await this.directlySetCurrentUser(r)}catch(n){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",n),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(os(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(l=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(l,l))}):this.directlySetCurrentUser(null)}const n=await this.assertedPersistence.getCurrentUser();let r=n,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=this.redirectUser?._redirectEventId,l=r?._redirectEventId,d=await this.tryRedirectSignIn(e);(!o||o===l)&&d?.user&&(r=d.user,i=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(r)}catch(o){r=n,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return We(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let n=null;try{n=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return n}async reloadAndSetCurrentUserOrClear(e){try{await df(e)}catch(n){if(n?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=ZI()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(os(this.app))return Promise.reject(va(this));const n=e?wn(e):null;return n&&We(n.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(n&&n._clone(this))}async _updateCurrentUser(e,n=!1){if(!this._deleted)return e&&We(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),n||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return os(this.app)?Promise.reject(va(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return os(this.app)?Promise.reject(va(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(pi(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const n=this._getPasswordPolicyInternal();return n.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):n.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await yk(this),n=new bk(e);this.tenantId===null?this._projectPasswordPolicy=n:this._tenantPasswordPolicies[this.tenantId]=n}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new Ku("auth","Firebase",e())}onAuthStateChanged(e,n,r){return this.registerStateListener(this.authStateSubscription,e,n,r)}beforeAuthStateChanged(e,n){return this.beforeStateQueue.pushCallback(e,n)}onIdTokenChanged(e,n,r){return this.registerStateListener(this.idTokenSubscription,e,n,r)}authStateReady(){return new Promise((e,n)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},n)}})}async revokeAccessToken(e){if(this.currentUser){const n=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:n};this.tenantId!=null&&(r.tenantId=this.tenantId),await fk(this,r)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,n){const r=await this.getOrInitRedirectPersistenceManager(n);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const n=e&&pi(e)||this._popupRedirectResolver;We(n,this,"argument-error"),this.redirectPersistenceManager=await Bl.create(this,[pi(n._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,n,r,i){if(this._deleted)return()=>{};const o=typeof n=="function"?n:n.next.bind(n);let l=!1;const d=this._isInitialized?Promise.resolve():this._initializationPromise;if(We(d,this,"internal-error"),d.then(()=>{l||o(this.currentUser)}),typeof n=="function"){const h=e.addObserver(n,r,i);return()=>{l=!0,h()}}else{const h=e.addObserver(n);return()=>{l=!0,h()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return We(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=gC(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const n=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();n&&(e["X-Firebase-Client"]=n);const r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){if(os(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&KI(`Error while retrieving App Check token: ${e.error}`),e?.token}}function ic(t){return wn(t)}class fw{constructor(e){this.auth=e,this.observer=null,this.addObserver=zR(n=>this.observer=n)}get next(){return We(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let Vf={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function xk(t){Vf=t}function yC(t){return Vf.loadJS(t)}function wk(){return Vf.recaptchaEnterpriseScript}function Sk(){return Vf.gapiScript}function Ck(t){return`__${t}${Math.floor(Math.random()*1e6)}`}class Ek{constructor(){this.enterprise=new Tk}ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}class Tk{ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}const Ak="recaptcha-enterprise",_C="NO_RECAPTCHA";class jk{constructor(e){this.type=Ak,this.auth=ic(e)}async verify(e="verify",n=!1){async function r(o){if(!n){if(o.tenantId==null&&o._agentRecaptchaConfig!=null)return o._agentRecaptchaConfig.siteKey;if(o.tenantId!=null&&o._tenantRecaptchaConfigs[o.tenantId]!==void 0)return o._tenantRecaptchaConfigs[o.tenantId].siteKey}return new Promise(async(l,d)=>{ik(o,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(h=>{if(h.recaptchaKey===void 0)d(new Error("recaptcha Enterprise site key undefined"));else{const m=new sk(h);return o.tenantId==null?o._agentRecaptchaConfig=m:o._tenantRecaptchaConfigs[o.tenantId]=m,l(m.siteKey)}}).catch(h=>{d(h)})})}function i(o,l,d){const h=window.grecaptcha;lw(h)?h.enterprise.ready(()=>{h.enterprise.execute(o,{action:e}).then(m=>{l(m)}).catch(()=>{l(_C)})}):d(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new Ek().execute("siteKey",{action:"verify"}):new Promise((o,l)=>{r(this.auth).then(d=>{if(!n&&lw(window.grecaptcha))i(d,o,l);else{if(typeof window>"u"){l(new Error("RecaptchaVerifier is only supported in browser"));return}let h=wk();h.length!==0&&(h+=d),yC(h).then(()=>{i(d,o,l)}).catch(m=>{l(m)})}}).catch(d=>{l(d)})})}}async function mw(t,e,n,r=!1,i=!1){const o=new jk(t);let l;if(i)l=_C;else try{l=await o.verify(n)}catch{l=await o.verify(n,!0)}const d={...e};if(n==="mfaSmsEnrollment"||n==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in d){const h=d.phoneEnrollmentInfo.phoneNumber,m=d.phoneEnrollmentInfo.recaptchaToken;Object.assign(d,{phoneEnrollmentInfo:{phoneNumber:h,recaptchaToken:m,captchaResponse:l,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in d){const h=d.phoneSignInInfo.recaptchaToken;Object.assign(d,{phoneSignInInfo:{recaptchaToken:h,captchaResponse:l,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return d}return r?Object.assign(d,{captchaResp:l}):Object.assign(d,{captchaResponse:l}),Object.assign(d,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(d,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),d}async function pw(t,e,n,r,i){if(t._getRecaptchaConfig()?.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const o=await mw(t,e,n,n==="getOobCode");return r(t,o)}else return r(t,e).catch(async o=>{if(o.code==="auth/missing-recaptcha-token"){console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const l=await mw(t,e,n,n==="getOobCode");return r(t,l)}else return Promise.reject(o)})}function Rk(t,e){const n=Qy(t,"auth");if(n.isInitialized()){const i=n.getImmediate(),o=n.getOptions();if(bi(o,e??{}))return i;ds(i,"already-initialized")}return n.initialize({options:e})}function Ik(t,e){const n=e?.persistence||[],r=(Array.isArray(n)?n:[n]).map(pi);e?.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(r,e?.popupRedirectResolver)}function kk(t,e,n){const r=ic(t);We(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const i=!1,o=bC(e),{host:l,port:d}=Dk(e),h=d===null?"":`:${d}`,m={url:`${o}//${l}${h}/`},p=Object.freeze({host:l,port:d,protocol:o.replace(":",""),options:Object.freeze({disableWarnings:i})});if(!r._canInitEmulator){We(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),We(bi(m,r.config.emulator)&&bi(p,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=m,r.emulatorConfig=p,r.settings.appVerificationDisabledForTesting=!0,rc(l)?(GS(`${o}//${l}${h}`),QS("Auth",!0)):Mk()}function bC(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function Dk(t){const e=bC(t),n=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){const o=i[1];return{host:o,port:gw(r.substr(o.length+1))}}else{const[o,l]=r.split(":");return{host:o,port:gw(l)}}}function gw(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}function Mk(){function t(){const e=document.createElement("p"),n=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",n.position="fixed",n.width="100%",n.backgroundColor="#ffffff",n.border=".1em solid #000000",n.color="#b50000",n.bottom="0px",n.left="0px",n.margin="0px",n.zIndex="10000",n.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",t):t())}class Zy{constructor(e,n){this.providerId=e,this.signInMethod=n}toJSON(){return mi("not implemented")}_getIdTokenResponse(e){return mi("not implemented")}_linkToIdToken(e,n){return mi("not implemented")}_getReauthenticationResolver(e){return mi("not implemented")}}async function Ok(t,e){return Oa(t,"POST","/v1/accounts:signUp",e)}async function Nk(t,e){return Ff(t,"POST","/v1/accounts:signInWithPassword",Oo(t,e))}async function Pk(t,e){return Ff(t,"POST","/v1/accounts:signInWithEmailLink",Oo(t,e))}async function zk(t,e){return Ff(t,"POST","/v1/accounts:signInWithEmailLink",Oo(t,e))}class Nu extends Zy{constructor(e,n,r,i=null){super("password",r),this._email=e,this._password=n,this._tenantId=i}static _fromEmailAndPassword(e,n){return new Nu(e,n,"password")}static _fromEmailAndCode(e,n,r=null){return new Nu(e,n,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e;if(n?.email&&n?.password){if(n.signInMethod==="password")return this._fromEmailAndPassword(n.email,n.password);if(n.signInMethod==="emailLink")return this._fromEmailAndCode(n.email,n.password,n.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const n={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return pw(e,n,"signInWithPassword",Nk);case"emailLink":return Pk(e,{email:this._email,oobCode:this._password});default:ds(e,"internal-error")}}async _linkToIdToken(e,n){switch(this.signInMethod){case"password":const r={idToken:n,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return pw(e,r,"signUpPassword",Ok);case"emailLink":return zk(e,{idToken:n,email:this._email,oobCode:this._password});default:ds(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function Ll(t,e){return Ff(t,"POST","/v1/accounts:signInWithIdp",Oo(t,e))}const Bk="http://localhost";class Ro extends Zy{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const n=new Ro(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(n.idToken=e.idToken),e.accessToken&&(n.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(n.nonce=e.nonce),e.pendingToken&&(n.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(n.accessToken=e.oauthToken,n.secret=e.oauthTokenSecret):ds("argument-error"),n}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:i,...o}=n;if(!r||!i)return null;const l=new Ro(r,i);return l.idToken=o.idToken||void 0,l.accessToken=o.accessToken||void 0,l.secret=o.secret,l.nonce=o.nonce,l.pendingToken=o.pendingToken||null,l}_getIdTokenResponse(e){const n=this.buildRequest();return Ll(e,n)}_linkToIdToken(e,n){const r=this.buildRequest();return r.idToken=n,Ll(e,r)}_getReauthenticationResolver(e){const n=this.buildRequest();return n.autoCreate=!1,Ll(e,n)}buildRequest(){const e={requestUri:Bk,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const n={};this.idToken&&(n.id_token=this.idToken),this.accessToken&&(n.access_token=this.accessToken),this.secret&&(n.oauth_token_secret=this.secret),n.providerId=this.providerId,this.nonce&&!this.pendingToken&&(n.nonce=this.nonce),e.postBody=Yu(n)}return e}}function Lk(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function Uk(t){const e=bu(vu(t)).link,n=e?bu(vu(e)).deep_link_id:null,r=bu(vu(t)).deep_link_id;return(r?bu(vu(r)).link:null)||r||n||e||t}class Jy{constructor(e){const n=bu(vu(e)),r=n.apiKey??null,i=n.oobCode??null,o=Lk(n.mode??null);We(r&&i&&o,"argument-error"),this.apiKey=r,this.operation=o,this.code=i,this.continueUrl=n.continueUrl??null,this.languageCode=n.lang??null,this.tenantId=n.tenantId??null}static parseLink(e){const n=Uk(e);try{return new Jy(n)}catch{return null}}}class ac{constructor(){this.providerId=ac.PROVIDER_ID}static credential(e,n){return Nu._fromEmailAndPassword(e,n)}static credentialWithLink(e,n){const r=Jy.parseLink(n);return We(r,"argument-error"),Nu._fromEmailAndCode(e,r.code,r.tenantId)}}ac.PROVIDER_ID="password";ac.EMAIL_PASSWORD_SIGN_IN_METHOD="password";ac.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class vC{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class Zu extends vC{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class la extends Zu{constructor(){super("facebook.com")}static credential(e){return Ro._fromParams({providerId:la.PROVIDER_ID,signInMethod:la.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return la.credentialFromTaggedObject(e)}static credentialFromError(e){return la.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return la.credential(e.oauthAccessToken)}catch{return null}}}la.FACEBOOK_SIGN_IN_METHOD="facebook.com";la.PROVIDER_ID="facebook.com";class ca extends Zu{constructor(){super("google.com"),this.addScope("profile")}static credential(e,n){return Ro._fromParams({providerId:ca.PROVIDER_ID,signInMethod:ca.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:n})}static credentialFromResult(e){return ca.credentialFromTaggedObject(e)}static credentialFromError(e){return ca.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:n,oauthAccessToken:r}=e;if(!n&&!r)return null;try{return ca.credential(n,r)}catch{return null}}}ca.GOOGLE_SIGN_IN_METHOD="google.com";ca.PROVIDER_ID="google.com";class ua extends Zu{constructor(){super("github.com")}static credential(e){return Ro._fromParams({providerId:ua.PROVIDER_ID,signInMethod:ua.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return ua.credentialFromTaggedObject(e)}static credentialFromError(e){return ua.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return ua.credential(e.oauthAccessToken)}catch{return null}}}ua.GITHUB_SIGN_IN_METHOD="github.com";ua.PROVIDER_ID="github.com";class da extends Zu{constructor(){super("twitter.com")}static credential(e,n){return Ro._fromParams({providerId:da.PROVIDER_ID,signInMethod:da.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:n})}static credentialFromResult(e){return da.credentialFromTaggedObject(e)}static credentialFromError(e){return da.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:n,oauthTokenSecret:r}=e;if(!n||!r)return null;try{return da.credential(n,r)}catch{return null}}}da.TWITTER_SIGN_IN_METHOD="twitter.com";da.PROVIDER_ID="twitter.com";class $l{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,n,r,i=!1){const o=await ls._fromIdTokenResponse(e,r,i),l=yw(r);return new $l({user:o,providerId:l,_tokenResponse:r,operationType:n})}static async _forOperation(e,n,r){await e._updateTokensIfNecessary(r,!0);const i=yw(r);return new $l({user:e,providerId:i,_tokenResponse:r,operationType:n})}}function yw(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}class hf extends Ti{constructor(e,n,r,i){super(n.code,n.message),this.operationType=r,this.user=i,Object.setPrototypeOf(this,hf.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:n.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,n,r,i){return new hf(e,n,r,i)}}function xC(t,e,n,r){return(e==="reauthenticate"?n._getReauthenticationResolver(t):n._getIdTokenResponse(t)).catch(o=>{throw o.code==="auth/multi-factor-auth-required"?hf._fromErrorAndOperation(t,o,e,r):o})}async function Fk(t,e,n=!1){const r=await Ou(t,e._linkToIdToken(t.auth,await t.getIdToken()),n);return $l._forOperation(t,"link",r)}async function Vk(t,e,n=!1){const{auth:r}=t;if(os(r.app))return Promise.reject(va(r));const i="reauthenticate";try{const o=await Ou(t,xC(r,i,e,t),n);We(o.idToken,r,"internal-error");const l=Yy(o.idToken);We(l,r,"internal-error");const{sub:d}=l;return We(t.uid===d,r,"user-mismatch"),$l._forOperation(t,i,o)}catch(o){throw o?.code==="auth/user-not-found"&&ds(r,"user-mismatch"),o}}async function wC(t,e,n=!1){if(os(t.app))return Promise.reject(va(t));const r="signIn",i=await xC(t,r,e),o=await $l._fromIdTokenResponse(t,r,i);return n||await t._updateCurrentUser(o.user),o}async function $k(t,e){return wC(ic(t),e)}async function qk(t){const e=ic(t);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}function Hk(t,e,n){return os(t.app)?Promise.reject(va(t)):$k(wn(t),ac.credential(e,n)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&qk(t),r})}function Gk(t,e,n,r){return wn(t).onIdTokenChanged(e,n,r)}function Qk(t,e,n){return wn(t).beforeAuthStateChanged(e,n)}function Wk(t,e,n,r){return wn(t).onAuthStateChanged(e,n,r)}function Kk(t){return wn(t).signOut()}const ff="__sak";class SC{constructor(e,n){this.storageRetriever=e,this.type=n}_isAvailable(){try{return this.storage?(this.storage.setItem(ff,"1"),this.storage.removeItem(ff),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,n){return this.storage.setItem(e,JSON.stringify(n)),Promise.resolve()}_get(e){const n=this.storage.getItem(e);return Promise.resolve(n?JSON.parse(n):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}const Yk=1e3,Xk=10;class CC extends SC{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,n)=>this.onStorageEvent(e,n),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=pC(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const n of Object.keys(this.listeners)){const r=this.storage.getItem(n),i=this.localCache[n];r!==i&&e(n,i,r)}}onStorageEvent(e,n=!1){if(!e.key){this.forAllChangedKeys((l,d,h)=>{this.notifyListeners(l,h)});return}const r=e.key;n?this.detachListener():this.stopPolling();const i=()=>{const l=this.storage.getItem(r);!n&&this.localCache[r]===l||this.notifyListeners(r,l)},o=this.storage.getItem(r);pk()&&o!==e.newValue&&e.newValue!==e.oldValue?setTimeout(i,Xk):i()}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const i of Array.from(r))i(n&&JSON.parse(n))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,n,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:n,newValue:r}),!0)})},Yk)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,n){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,n){await super._set(e,n),this.localCache[e]=JSON.stringify(n)}async _get(e){const n=await super._get(e);return this.localCache[e]=JSON.stringify(n),n}async _remove(e){await super._remove(e),delete this.localCache[e]}}CC.type="LOCAL";const Zk=CC;class EC extends SC{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,n){}_removeListener(e,n){}}EC.type="SESSION";const TC=EC;function Jk(t){return Promise.all(t.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(n){return{fulfilled:!1,reason:n}}}))}class $f{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const n=this.receivers.find(i=>i.isListeningto(e));if(n)return n;const r=new $f(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const n=e,{eventId:r,eventType:i,data:o}=n.data,l=this.handlersMap[i];if(!l?.size)return;n.ports[0].postMessage({status:"ack",eventId:r,eventType:i});const d=Array.from(l).map(async m=>m(n.origin,o)),h=await Jk(d);n.ports[0].postMessage({status:"done",eventId:r,eventType:i,response:h})}_subscribe(e,n){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(n)}_unsubscribe(e,n){this.handlersMap[e]&&n&&this.handlersMap[e].delete(n),(!n||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}$f.receivers=[];function e0(t="",e=10){let n="";for(let r=0;r<e;r++)n+=Math.floor(Math.random()*10);return t+n}class eD{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,n,r=50){const i=typeof MessageChannel<"u"?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let o,l;return new Promise((d,h)=>{const m=e0("",20);i.port1.start();const p=setTimeout(()=>{h(new Error("unsupported_event"))},r);l={messageChannel:i,onMessage(g){const v=g;if(v.data.eventId===m)switch(v.data.status){case"ack":clearTimeout(p),o=setTimeout(()=>{h(new Error("timeout"))},3e3);break;case"done":clearTimeout(o),d(v.data.response);break;default:clearTimeout(p),clearTimeout(o),h(new Error("invalid_response"));break}}},this.handlers.add(l),i.port1.addEventListener("message",l.onMessage),this.target.postMessage({eventType:e,eventId:m,data:n},[i.port2])}).finally(()=>{l&&this.removeMessageHandler(l)})}}function Fs(){return window}function tD(t){Fs().location.href=t}function AC(){return typeof Fs().WorkerGlobalScope<"u"&&typeof Fs().importScripts=="function"}async function nD(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function rD(){return navigator?.serviceWorker?.controller||null}function sD(){return AC()?self:null}const jC="firebaseLocalStorageDb",iD=1,mf="firebaseLocalStorage",RC="fbase_key";class Ju{constructor(e){this.request=e}toPromise(){return new Promise((e,n)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{n(this.request.error)})})}}function qf(t,e){return t.transaction([mf],e?"readwrite":"readonly").objectStore(mf)}function aD(){const t=indexedDB.deleteDatabase(jC);return new Ju(t).toPromise()}function dy(){const t=indexedDB.open(jC,iD);return new Promise((e,n)=>{t.addEventListener("error",()=>{n(t.error)}),t.addEventListener("upgradeneeded",()=>{const r=t.result;try{r.createObjectStore(mf,{keyPath:RC})}catch(i){n(i)}}),t.addEventListener("success",async()=>{const r=t.result;r.objectStoreNames.contains(mf)?e(r):(r.close(),await aD(),e(await dy()))})})}async function _w(t,e,n){const r=qf(t,!0).put({[RC]:e,value:n});return new Ju(r).toPromise()}async function oD(t,e){const n=qf(t,!1).get(e),r=await new Ju(n).toPromise();return r===void 0?null:r.value}function bw(t,e){const n=qf(t,!0).delete(e);return new Ju(n).toPromise()}const lD=800,cD=3;class IC{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await dy(),this.db)}async _withRetries(e){let n=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(n++>cD)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return AC()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=$f._getInstance(sD()),this.receiver._subscribe("keyChanged",async(e,n)=>({keyProcessed:(await this._poll()).includes(n.key)})),this.receiver._subscribe("ping",async(e,n)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await nD(),!this.activeServiceWorker)return;this.sender=new eD(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||rD()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await dy();return await _w(e,ff,"1"),await bw(e,ff),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,n){return this._withPendingWrite(async()=>(await this._withRetries(r=>_w(r,e,n)),this.localCache[e]=n,this.notifyServiceWorker(e)))}async _get(e){const n=await this._withRetries(r=>oD(r,e));return this.localCache[e]=n,n}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(n=>bw(n,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(i=>{const o=qf(i,!1).getAll();return new Ju(o).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const n=[],r=new Set;if(e.length!==0)for(const{fbase_key:i,value:o}of e)r.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(o)&&(this.notifyListeners(i,o),n.push(i));for(const i of Object.keys(this.localCache))this.localCache[i]&&!r.has(i)&&(this.notifyListeners(i,null),n.push(i));return n}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const i of Array.from(r))i(n)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),lD)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,n){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}IC.type="LOCAL";const uD=IC;new Xu(3e4,6e4);function dD(t,e){return e?pi(e):(We(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}class t0 extends Zy{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Ll(e,this._buildIdpRequest())}_linkToIdToken(e,n){return Ll(e,this._buildIdpRequest(n))}_getReauthenticationResolver(e){return Ll(e,this._buildIdpRequest())}_buildIdpRequest(e){const n={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(n.idToken=e),n}}function hD(t){return wC(t.auth,new t0(t),t.bypassAuthState)}function fD(t){const{auth:e,user:n}=t;return We(n,e,"internal-error"),Vk(n,new t0(t),t.bypassAuthState)}async function mD(t){const{auth:e,user:n}=t;return We(n,e,"internal-error"),Fk(n,new t0(t),t.bypassAuthState)}class kC{constructor(e,n,r,i,o=!1){this.auth=e,this.resolver=r,this.user=i,this.bypassAuthState=o,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(n)?n:[n]}execute(){return new Promise(async(e,n)=>{this.pendingPromise={resolve:e,reject:n};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:n,sessionId:r,postBody:i,tenantId:o,error:l,type:d}=e;if(l){this.reject(l);return}const h={auth:this.auth,requestUri:n,sessionId:r,tenantId:o||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(d)(h))}catch(m){this.reject(m)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return hD;case"linkViaPopup":case"linkViaRedirect":return mD;case"reauthViaPopup":case"reauthViaRedirect":return fD;default:ds(this.auth,"internal-error")}}resolve(e){xi(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){xi(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const pD=new Xu(2e3,1e4);class Pl extends kC{constructor(e,n,r,i,o){super(e,n,i,o),this.provider=r,this.authWindow=null,this.pollId=null,Pl.currentPopupAction&&Pl.currentPopupAction.cancel(),Pl.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return We(e,this.auth,"internal-error"),e}async onExecution(){xi(this.filter.length===1,"Popup operations only handle one event");const e=e0();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(n=>{this.reject(n)}),this.resolver._isIframeWebStorageSupported(this.auth,n=>{n||this.reject(Us(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(Us(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Pl.currentPopupAction=null}pollUserCancellation(){const e=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Us(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,pD.get())};e()}}Pl.currentPopupAction=null;const gD="pendingRedirect",Kh=new Map;class yD extends kC{constructor(e,n,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],n,void 0,r),this.eventId=null}async execute(){let e=Kh.get(this.auth._key());if(!e){try{const r=await _D(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(n){e=()=>Promise.reject(n)}Kh.set(this.auth._key(),e)}return this.bypassAuthState||Kh.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const n=await this.auth._redirectUserForId(e.eventId);if(n)return this.user=n,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function _D(t,e){const n=xD(e),r=vD(t);if(!await r._isAvailable())return!1;const i=await r._get(n)==="true";return await r._remove(n),i}function bD(t,e){Kh.set(t._key(),e)}function vD(t){return pi(t._redirectPersistence)}function xD(t){return Wh(gD,t.config.apiKey,t.name)}async function wD(t,e,n=!1){if(os(t.app))return Promise.reject(va(t));const r=ic(t),i=dD(r,e),l=await new yD(r,i,n).execute();return l&&!n&&(delete l.user._redirectEventId,await r._persistUserIfCurrent(l.user),await r._setRedirectUser(null,e)),l}const SD=600*1e3;class CD{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let n=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(n=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!ED(e)||(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=e,n=!0)),n}sendToConsumer(e,n){if(e.error&&!DC(e)){const r=e.error.code?.split("auth/")[1]||"internal-error";n.onError(Us(this.auth,r))}else n.onAuthEvent(e)}isEventForConsumer(e,n){const r=n.eventId===null||!!e.eventId&&e.eventId===n.eventId;return n.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=SD&&this.cachedEventUids.clear(),this.cachedEventUids.has(vw(e))}saveEventToCache(e){this.cachedEventUids.add(vw(e)),this.lastProcessedEventTime=Date.now()}}function vw(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(e=>e).join("-")}function DC({type:t,error:e}){return t==="unknown"&&e?.code==="auth/no-auth-event"}function ED(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return DC(t);default:return!1}}async function TD(t,e={}){return Oa(t,"GET","/v1/projects",e)}const AD=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,jD=/^https?/;async function RD(t){if(t.config.emulator)return;const{authorizedDomains:e}=await TD(t);for(const n of e)try{if(ID(n))return}catch{}ds(t,"unauthorized-domain")}function ID(t){const e=cy(),{protocol:n,hostname:r}=new URL(e);if(t.startsWith("chrome-extension://")){const l=new URL(t);return l.hostname===""&&r===""?n==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):n==="chrome-extension:"&&l.hostname===r}if(!jD.test(n))return!1;if(AD.test(t))return r===t;const i=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}const kD=new Xu(3e4,6e4);function xw(){const t=Fs().___jsl;if(t?.H){for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let n=0;n<t.CP.length;n++)t.CP[n]=null}}function DD(t){return new Promise((e,n)=>{function r(){xw(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{xw(),n(Us(t,"network-request-failed"))},timeout:kD.get()})}if(Fs().gapi?.iframes?.Iframe)e(gapi.iframes.getContext());else if(Fs().gapi?.load)r();else{const i=Ck("iframefcb");return Fs()[i]=()=>{gapi.load?r():n(Us(t,"network-request-failed"))},yC(`${Sk()}?onload=${i}`).catch(o=>n(o))}}).catch(e=>{throw Yh=null,e})}let Yh=null;function MD(t){return Yh=Yh||DD(t),Yh}const OD=new Xu(5e3,15e3),ND="__/auth/iframe",PD="emulator/auth/iframe",zD={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},BD=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function LD(t){const e=t.config;We(e.authDomain,t,"auth-domain-config-required");const n=e.emulator?Ky(e,PD):`https://${t.config.authDomain}/${ND}`,r={apiKey:e.apiKey,appName:t.name,v:sc},i=BD.get(t.config.apiHost);i&&(r.eid=i);const o=t._getFrameworks();return o.length&&(r.fw=o.join(",")),`${n}?${Yu(r).slice(1)}`}async function UD(t){const e=await MD(t),n=Fs().gapi;return We(n,t,"internal-error"),e.open({where:document.body,url:LD(t),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:zD,dontclear:!0},r=>new Promise(async(i,o)=>{await r.restyle({setHideOnLeave:!1});const l=Us(t,"network-request-failed"),d=Fs().setTimeout(()=>{o(l)},OD.get());function h(){Fs().clearTimeout(d),i(r)}r.ping(h).then(h,()=>{o(l)})}))}const FD={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},VD=500,$D=600,qD="_blank",HD="http://localhost";class ww{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function GD(t,e,n,r=VD,i=$D){const o=Math.max((window.screen.availHeight-i)/2,0).toString(),l=Math.max((window.screen.availWidth-r)/2,0).toString();let d="";const h={...FD,width:r.toString(),height:i.toString(),top:o,left:l},m=er().toLowerCase();n&&(d=uC(m)?qD:n),lC(m)&&(e=e||HD,h.scrollbars="yes");const p=Object.entries(h).reduce((v,[b,C])=>`${v}${b}=${C},`,"");if(mk(m)&&d!=="_self")return QD(e||"",d),new ww(null);const g=window.open(e||"",d,p);We(g,t,"popup-blocked");try{g.focus()}catch{}return new ww(g)}function QD(t,e){const n=document.createElement("a");n.href=t,n.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}const WD="__/auth/handler",KD="emulator/auth/handler",YD=encodeURIComponent("fac");async function Sw(t,e,n,r,i,o){We(t.config.authDomain,t,"auth-domain-config-required"),We(t.config.apiKey,t,"invalid-api-key");const l={apiKey:t.config.apiKey,appName:t.name,authType:n,redirectUrl:r,v:sc,eventId:i};if(e instanceof vC){e.setDefaultLanguage(t.languageCode),l.providerId=e.providerId||"",PR(e.getCustomParameters())||(l.customParameters=JSON.stringify(e.getCustomParameters()));for(const[p,g]of Object.entries({}))l[p]=g}if(e instanceof Zu){const p=e.getScopes().filter(g=>g!=="");p.length>0&&(l.scopes=p.join(","))}t.tenantId&&(l.tid=t.tenantId);const d=l;for(const p of Object.keys(d))d[p]===void 0&&delete d[p];const h=await t._getAppCheckToken(),m=h?`#${YD}=${encodeURIComponent(h)}`:"";return`${XD(t)}?${Yu(d).slice(1)}${m}`}function XD({config:t}){return t.emulator?Ky(t,KD):`https://${t.authDomain}/${WD}`}const Og="webStorageSupport";class ZD{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=TC,this._completeRedirectFn=wD,this._overrideRedirectResult=bD}async _openPopup(e,n,r,i){xi(this.eventManagers[e._key()]?.manager,"_initialize() not called before _openPopup()");const o=await Sw(e,n,r,cy(),i);return GD(e,o,e0())}async _openRedirect(e,n,r,i){await this._originValidation(e);const o=await Sw(e,n,r,cy(),i);return tD(o),new Promise(()=>{})}_initialize(e){const n=e._key();if(this.eventManagers[n]){const{manager:i,promise:o}=this.eventManagers[n];return i?Promise.resolve(i):(xi(o,"If manager is not set, promise should be"),o)}const r=this.initAndGetManager(e);return this.eventManagers[n]={promise:r},r.catch(()=>{delete this.eventManagers[n]}),r}async initAndGetManager(e){const n=await UD(e),r=new CD(e);return n.register("authEvent",i=>(We(i?.authEvent,e,"invalid-auth-event"),{status:r.onEvent(i.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=n,r}_isIframeWebStorageSupported(e,n){this.iframes[e._key()].send(Og,{type:Og},i=>{const o=i?.[0]?.[Og];o!==void 0&&n(!!o),ds(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const n=e._key();return this.originValidationPromises[n]||(this.originValidationPromises[n]=RD(e)),this.originValidationPromises[n]}get _shouldInitProactively(){return pC()||cC()||Xy()}}const JD=ZD;var Cw="@firebase/auth",Ew="1.12.0";class eM{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const n=this.auth.onIdTokenChanged(r=>{e(r?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,n),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const n=this.internalListeners.get(e);n&&(this.internalListeners.delete(e),n(),this.updateProactiveRefresh())}assertAuthConfigured(){We(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function tM(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function nM(t){Vl(new jo("auth",(e,{options:n})=>{const r=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),o=e.getProvider("app-check-internal"),{apiKey:l,authDomain:d}=r.options;We(l&&!l.includes(":"),"invalid-api-key",{appName:r.name});const h={apiKey:l,authDomain:d,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:gC(t)},m=new vk(r,i,o,h);return Ik(m,n),m},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,n,r)=>{e.getProvider("auth-internal").initialize()})),Vl(new jo("auth-internal",e=>{const n=ic(e.getProvider("auth").getImmediate());return(r=>new eM(r))(n)},"PRIVATE").setInstantiationMode("EXPLICIT")),ba(Cw,Ew,tM(t)),ba(Cw,Ew,"esm2020")}const rM=300,sM=HS("authIdTokenMaxAge")||rM;let Tw=null;const iM=t=>async e=>{const n=e&&await e.getIdTokenResult(),r=n&&(new Date().getTime()-Date.parse(n.issuedAtTime))/1e3;if(r&&r>sM)return;const i=n?.token;Tw!==i&&(Tw=i,await fetch(t,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))};function aM(t=XS()){const e=Qy(t,"auth");if(e.isInitialized())return e.getImmediate();const n=Rk(t,{popupRedirectResolver:JD,persistence:[uD,Zk,TC]}),r=HS("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const o=new URL(r,location.origin);if(location.origin===o.origin){const l=iM(o.toString());Qk(n,l,()=>l(n.currentUser)),Gk(n,d=>l(d))}}const i=$S("auth");return i&&kk(n,`http://${i}`),n}function oM(){return document.getElementsByTagName("head")?.[0]??document}xk({loadJS(t){return new Promise((e,n)=>{const r=document.createElement("script");r.setAttribute("src",t),r.onload=e,r.onerror=i=>{const o=Us("internal-error");o.customData=i,n(o)},r.type="text/javascript",r.charset="UTF-8",oM().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});nM("Browser");var lM="firebase",cM="12.7.0";ba(lM,cM,"app");const uM={apiKey:"AIzaSyCfvR8bEeW2CXdD31Ec34doRNThnbryXJo",authDomain:"budget-tkl.firebaseapp.com",projectId:"budget-tkl",storageBucket:"budget-tkl.firebasestorage.app",messagingSenderId:"631248313026",appId:"1:631248313026:web:36574d789a42b2d102f95b"},MC=YS(uM);function Na(){const t=aM(MC);async function e(){return!1}async function n(h,m){return Hk(t,h,m)}function r(){return Kk(t)}function i(h){Wk(t,m=>{h(m)})}function o(){return t.currentUser}function l(){const h=t.currentUser;if(!h)throw new Error("Not authenticated");if(!h.email)throw new Error("Email is required but not available for this account");return h.email}return{set_user_listener:i,delete_firebase_user:e,login_firebase_user:n,logout_firebase_user:r,get_current_firebase_user:o,requireUserEmail:l}}const oc=300*1e3,dM=1800*1e3,Le=new Yj({defaultOptions:{queries:{staleTime:oc,gcTime:dM,refetchOnWindowFocus:!1,refetchOnReconnect:!0,retry:1,refetchOnMount:!0},mutations:{retry:1}}});Le.getQueryCache().subscribe(t=>{const e=t?.query;if(e&&t.type==="updated"){const{state:n}=e;n.status==="error"&&n.error&&console.error("[RQ] Query FAILED:",e.queryKey,n.error)}});const Ie={user:t=>["user",t],budget:t=>["budget",t],month:(t,e,n)=>["month",t,e,n],payees:t=>["payees",t],accessibleBudgets:t=>["accessibleBudgets",t],feedback:()=>["feedback"]};function hM({children:t}){return u.jsx(Xj,{client:Le,children:t})}var Aw=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var xa,OC;(function(){var t;function e(k,j){function N(){}N.prototype=j.prototype,k.F=j.prototype,k.prototype=new N,k.prototype.constructor=k,k.D=function(F,q,A){for(var P=Array(arguments.length-2),O=2;O<arguments.length;O++)P[O-2]=arguments[O];return j.prototype[q].apply(F,P)}}function n(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(r,n),r.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(k,j,N){N||(N=0);const F=Array(16);if(typeof j=="string")for(var q=0;q<16;++q)F[q]=j.charCodeAt(N++)|j.charCodeAt(N++)<<8|j.charCodeAt(N++)<<16|j.charCodeAt(N++)<<24;else for(q=0;q<16;++q)F[q]=j[N++]|j[N++]<<8|j[N++]<<16|j[N++]<<24;j=k.g[0],N=k.g[1],q=k.g[2];let A=k.g[3],P;P=j+(A^N&(q^A))+F[0]+3614090360&4294967295,j=N+(P<<7&4294967295|P>>>25),P=A+(q^j&(N^q))+F[1]+3905402710&4294967295,A=j+(P<<12&4294967295|P>>>20),P=q+(N^A&(j^N))+F[2]+606105819&4294967295,q=A+(P<<17&4294967295|P>>>15),P=N+(j^q&(A^j))+F[3]+3250441966&4294967295,N=q+(P<<22&4294967295|P>>>10),P=j+(A^N&(q^A))+F[4]+4118548399&4294967295,j=N+(P<<7&4294967295|P>>>25),P=A+(q^j&(N^q))+F[5]+1200080426&4294967295,A=j+(P<<12&4294967295|P>>>20),P=q+(N^A&(j^N))+F[6]+2821735955&4294967295,q=A+(P<<17&4294967295|P>>>15),P=N+(j^q&(A^j))+F[7]+4249261313&4294967295,N=q+(P<<22&4294967295|P>>>10),P=j+(A^N&(q^A))+F[8]+1770035416&4294967295,j=N+(P<<7&4294967295|P>>>25),P=A+(q^j&(N^q))+F[9]+2336552879&4294967295,A=j+(P<<12&4294967295|P>>>20),P=q+(N^A&(j^N))+F[10]+4294925233&4294967295,q=A+(P<<17&4294967295|P>>>15),P=N+(j^q&(A^j))+F[11]+2304563134&4294967295,N=q+(P<<22&4294967295|P>>>10),P=j+(A^N&(q^A))+F[12]+1804603682&4294967295,j=N+(P<<7&4294967295|P>>>25),P=A+(q^j&(N^q))+F[13]+4254626195&4294967295,A=j+(P<<12&4294967295|P>>>20),P=q+(N^A&(j^N))+F[14]+2792965006&4294967295,q=A+(P<<17&4294967295|P>>>15),P=N+(j^q&(A^j))+F[15]+1236535329&4294967295,N=q+(P<<22&4294967295|P>>>10),P=j+(q^A&(N^q))+F[1]+4129170786&4294967295,j=N+(P<<5&4294967295|P>>>27),P=A+(N^q&(j^N))+F[6]+3225465664&4294967295,A=j+(P<<9&4294967295|P>>>23),P=q+(j^N&(A^j))+F[11]+643717713&4294967295,q=A+(P<<14&4294967295|P>>>18),P=N+(A^j&(q^A))+F[0]+3921069994&4294967295,N=q+(P<<20&4294967295|P>>>12),P=j+(q^A&(N^q))+F[5]+3593408605&4294967295,j=N+(P<<5&4294967295|P>>>27),P=A+(N^q&(j^N))+F[10]+38016083&4294967295,A=j+(P<<9&4294967295|P>>>23),P=q+(j^N&(A^j))+F[15]+3634488961&4294967295,q=A+(P<<14&4294967295|P>>>18),P=N+(A^j&(q^A))+F[4]+3889429448&4294967295,N=q+(P<<20&4294967295|P>>>12),P=j+(q^A&(N^q))+F[9]+568446438&4294967295,j=N+(P<<5&4294967295|P>>>27),P=A+(N^q&(j^N))+F[14]+3275163606&4294967295,A=j+(P<<9&4294967295|P>>>23),P=q+(j^N&(A^j))+F[3]+4107603335&4294967295,q=A+(P<<14&4294967295|P>>>18),P=N+(A^j&(q^A))+F[8]+1163531501&4294967295,N=q+(P<<20&4294967295|P>>>12),P=j+(q^A&(N^q))+F[13]+2850285829&4294967295,j=N+(P<<5&4294967295|P>>>27),P=A+(N^q&(j^N))+F[2]+4243563512&4294967295,A=j+(P<<9&4294967295|P>>>23),P=q+(j^N&(A^j))+F[7]+1735328473&4294967295,q=A+(P<<14&4294967295|P>>>18),P=N+(A^j&(q^A))+F[12]+2368359562&4294967295,N=q+(P<<20&4294967295|P>>>12),P=j+(N^q^A)+F[5]+4294588738&4294967295,j=N+(P<<4&4294967295|P>>>28),P=A+(j^N^q)+F[8]+2272392833&4294967295,A=j+(P<<11&4294967295|P>>>21),P=q+(A^j^N)+F[11]+1839030562&4294967295,q=A+(P<<16&4294967295|P>>>16),P=N+(q^A^j)+F[14]+4259657740&4294967295,N=q+(P<<23&4294967295|P>>>9),P=j+(N^q^A)+F[1]+2763975236&4294967295,j=N+(P<<4&4294967295|P>>>28),P=A+(j^N^q)+F[4]+1272893353&4294967295,A=j+(P<<11&4294967295|P>>>21),P=q+(A^j^N)+F[7]+4139469664&4294967295,q=A+(P<<16&4294967295|P>>>16),P=N+(q^A^j)+F[10]+3200236656&4294967295,N=q+(P<<23&4294967295|P>>>9),P=j+(N^q^A)+F[13]+681279174&4294967295,j=N+(P<<4&4294967295|P>>>28),P=A+(j^N^q)+F[0]+3936430074&4294967295,A=j+(P<<11&4294967295|P>>>21),P=q+(A^j^N)+F[3]+3572445317&4294967295,q=A+(P<<16&4294967295|P>>>16),P=N+(q^A^j)+F[6]+76029189&4294967295,N=q+(P<<23&4294967295|P>>>9),P=j+(N^q^A)+F[9]+3654602809&4294967295,j=N+(P<<4&4294967295|P>>>28),P=A+(j^N^q)+F[12]+3873151461&4294967295,A=j+(P<<11&4294967295|P>>>21),P=q+(A^j^N)+F[15]+530742520&4294967295,q=A+(P<<16&4294967295|P>>>16),P=N+(q^A^j)+F[2]+3299628645&4294967295,N=q+(P<<23&4294967295|P>>>9),P=j+(q^(N|~A))+F[0]+4096336452&4294967295,j=N+(P<<6&4294967295|P>>>26),P=A+(N^(j|~q))+F[7]+1126891415&4294967295,A=j+(P<<10&4294967295|P>>>22),P=q+(j^(A|~N))+F[14]+2878612391&4294967295,q=A+(P<<15&4294967295|P>>>17),P=N+(A^(q|~j))+F[5]+4237533241&4294967295,N=q+(P<<21&4294967295|P>>>11),P=j+(q^(N|~A))+F[12]+1700485571&4294967295,j=N+(P<<6&4294967295|P>>>26),P=A+(N^(j|~q))+F[3]+2399980690&4294967295,A=j+(P<<10&4294967295|P>>>22),P=q+(j^(A|~N))+F[10]+4293915773&4294967295,q=A+(P<<15&4294967295|P>>>17),P=N+(A^(q|~j))+F[1]+2240044497&4294967295,N=q+(P<<21&4294967295|P>>>11),P=j+(q^(N|~A))+F[8]+1873313359&4294967295,j=N+(P<<6&4294967295|P>>>26),P=A+(N^(j|~q))+F[15]+4264355552&4294967295,A=j+(P<<10&4294967295|P>>>22),P=q+(j^(A|~N))+F[6]+2734768916&4294967295,q=A+(P<<15&4294967295|P>>>17),P=N+(A^(q|~j))+F[13]+1309151649&4294967295,N=q+(P<<21&4294967295|P>>>11),P=j+(q^(N|~A))+F[4]+4149444226&4294967295,j=N+(P<<6&4294967295|P>>>26),P=A+(N^(j|~q))+F[11]+3174756917&4294967295,A=j+(P<<10&4294967295|P>>>22),P=q+(j^(A|~N))+F[2]+718787259&4294967295,q=A+(P<<15&4294967295|P>>>17),P=N+(A^(q|~j))+F[9]+3951481745&4294967295,k.g[0]=k.g[0]+j&4294967295,k.g[1]=k.g[1]+(q+(P<<21&4294967295|P>>>11))&4294967295,k.g[2]=k.g[2]+q&4294967295,k.g[3]=k.g[3]+A&4294967295}r.prototype.v=function(k,j){j===void 0&&(j=k.length);const N=j-this.blockSize,F=this.C;let q=this.h,A=0;for(;A<j;){if(q==0)for(;A<=N;)i(this,k,A),A+=this.blockSize;if(typeof k=="string"){for(;A<j;)if(F[q++]=k.charCodeAt(A++),q==this.blockSize){i(this,F),q=0;break}}else for(;A<j;)if(F[q++]=k[A++],q==this.blockSize){i(this,F),q=0;break}}this.h=q,this.o+=j},r.prototype.A=function(){var k=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);k[0]=128;for(var j=1;j<k.length-8;++j)k[j]=0;j=this.o*8;for(var N=k.length-8;N<k.length;++N)k[N]=j&255,j/=256;for(this.v(k),k=Array(16),j=0,N=0;N<4;++N)for(let F=0;F<32;F+=8)k[j++]=this.g[N]>>>F&255;return k};function o(k,j){var N=d;return Object.prototype.hasOwnProperty.call(N,k)?N[k]:N[k]=j(k)}function l(k,j){this.h=j;const N=[];let F=!0;for(let q=k.length-1;q>=0;q--){const A=k[q]|0;F&&A==j||(N[q]=A,F=!1)}this.g=N}var d={};function h(k){return-128<=k&&k<128?o(k,function(j){return new l([j|0],j<0?-1:0)}):new l([k|0],k<0?-1:0)}function m(k){if(isNaN(k)||!isFinite(k))return g;if(k<0)return S(m(-k));const j=[];let N=1;for(let F=0;k>=N;F++)j[F]=k/N|0,N*=4294967296;return new l(j,0)}function p(k,j){if(k.length==0)throw Error("number format error: empty string");if(j=j||10,j<2||36<j)throw Error("radix out of range: "+j);if(k.charAt(0)=="-")return S(p(k.substring(1),j));if(k.indexOf("-")>=0)throw Error('number format error: interior "-" character');const N=m(Math.pow(j,8));let F=g;for(let A=0;A<k.length;A+=8){var q=Math.min(8,k.length-A);const P=parseInt(k.substring(A,A+q),j);q<8?(q=m(Math.pow(j,q)),F=F.j(q).add(m(P))):(F=F.j(N),F=F.add(m(P)))}return F}var g=h(0),v=h(1),b=h(16777216);t=l.prototype,t.m=function(){if(x(this))return-S(this).m();let k=0,j=1;for(let N=0;N<this.g.length;N++){const F=this.i(N);k+=(F>=0?F:4294967296+F)*j,j*=4294967296}return k},t.toString=function(k){if(k=k||10,k<2||36<k)throw Error("radix out of range: "+k);if(C(this))return"0";if(x(this))return"-"+S(this).toString(k);const j=m(Math.pow(k,6));var N=this;let F="";for(;;){const q=D(N,j).g;N=E(N,q.j(j));let A=((N.g.length>0?N.g[0]:N.h)>>>0).toString(k);if(N=q,C(N))return A+F;for(;A.length<6;)A="0"+A;F=A+F}},t.i=function(k){return k<0?0:k<this.g.length?this.g[k]:this.h};function C(k){if(k.h!=0)return!1;for(let j=0;j<k.g.length;j++)if(k.g[j]!=0)return!1;return!0}function x(k){return k.h==-1}t.l=function(k){return k=E(this,k),x(k)?-1:C(k)?0:1};function S(k){const j=k.g.length,N=[];for(let F=0;F<j;F++)N[F]=~k.g[F];return new l(N,~k.h).add(v)}t.abs=function(){return x(this)?S(this):this},t.add=function(k){const j=Math.max(this.g.length,k.g.length),N=[];let F=0;for(let q=0;q<=j;q++){let A=F+(this.i(q)&65535)+(k.i(q)&65535),P=(A>>>16)+(this.i(q)>>>16)+(k.i(q)>>>16);F=P>>>16,A&=65535,P&=65535,N[q]=P<<16|A}return new l(N,N[N.length-1]&-2147483648?-1:0)};function E(k,j){return k.add(S(j))}t.j=function(k){if(C(this)||C(k))return g;if(x(this))return x(k)?S(this).j(S(k)):S(S(this).j(k));if(x(k))return S(this.j(S(k)));if(this.l(b)<0&&k.l(b)<0)return m(this.m()*k.m());const j=this.g.length+k.g.length,N=[];for(var F=0;F<2*j;F++)N[F]=0;for(F=0;F<this.g.length;F++)for(let q=0;q<k.g.length;q++){const A=this.i(F)>>>16,P=this.i(F)&65535,O=k.i(q)>>>16,X=k.i(q)&65535;N[2*F+2*q]+=P*X,T(N,2*F+2*q),N[2*F+2*q+1]+=A*X,T(N,2*F+2*q+1),N[2*F+2*q+1]+=P*O,T(N,2*F+2*q+1),N[2*F+2*q+2]+=A*O,T(N,2*F+2*q+2)}for(k=0;k<j;k++)N[k]=N[2*k+1]<<16|N[2*k];for(k=j;k<2*j;k++)N[k]=0;return new l(N,0)};function T(k,j){for(;(k[j]&65535)!=k[j];)k[j+1]+=k[j]>>>16,k[j]&=65535,j++}function I(k,j){this.g=k,this.h=j}function D(k,j){if(C(j))throw Error("division by zero");if(C(k))return new I(g,g);if(x(k))return j=D(S(k),j),new I(S(j.g),S(j.h));if(x(j))return j=D(k,S(j)),new I(S(j.g),j.h);if(k.g.length>30){if(x(k)||x(j))throw Error("slowDivide_ only works with positive integers.");for(var N=v,F=j;F.l(k)<=0;)N=B(N),F=B(F);var q=$(N,1),A=$(F,1);for(F=$(F,2),N=$(N,2);!C(F);){var P=A.add(F);P.l(k)<=0&&(q=q.add(N),A=P),F=$(F,1),N=$(N,1)}return j=E(k,q.j(j)),new I(q,j)}for(q=g;k.l(j)>=0;){for(N=Math.max(1,Math.floor(k.m()/j.m())),F=Math.ceil(Math.log(N)/Math.LN2),F=F<=48?1:Math.pow(2,F-48),A=m(N),P=A.j(j);x(P)||P.l(k)>0;)N-=F,A=m(N),P=A.j(j);C(A)&&(A=v),q=q.add(A),k=E(k,P)}return new I(q,k)}t.B=function(k){return D(this,k).h},t.and=function(k){const j=Math.max(this.g.length,k.g.length),N=[];for(let F=0;F<j;F++)N[F]=this.i(F)&k.i(F);return new l(N,this.h&k.h)},t.or=function(k){const j=Math.max(this.g.length,k.g.length),N=[];for(let F=0;F<j;F++)N[F]=this.i(F)|k.i(F);return new l(N,this.h|k.h)},t.xor=function(k){const j=Math.max(this.g.length,k.g.length),N=[];for(let F=0;F<j;F++)N[F]=this.i(F)^k.i(F);return new l(N,this.h^k.h)};function B(k){const j=k.g.length+1,N=[];for(let F=0;F<j;F++)N[F]=k.i(F)<<1|k.i(F-1)>>>31;return new l(N,k.h)}function $(k,j){const N=j>>5;j%=32;const F=k.g.length-N,q=[];for(let A=0;A<F;A++)q[A]=j>0?k.i(A+N)>>>j|k.i(A+N+1)<<32-j:k.i(A+N);return new l(q,k.h)}r.prototype.digest=r.prototype.A,r.prototype.reset=r.prototype.u,r.prototype.update=r.prototype.v,OC=r,l.prototype.add=l.prototype.add,l.prototype.multiply=l.prototype.j,l.prototype.modulo=l.prototype.B,l.prototype.compare=l.prototype.l,l.prototype.toNumber=l.prototype.m,l.prototype.toString=l.prototype.toString,l.prototype.getBits=l.prototype.i,l.fromNumber=m,l.fromString=p,xa=l}).apply(typeof Aw<"u"?Aw:typeof self<"u"?self:typeof window<"u"?window:{});var Bh=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var NC,xu,PC,Xh,hy,zC,BC,LC;(function(){var t,e=Object.defineProperty;function n(y){y=[typeof globalThis=="object"&&globalThis,y,typeof window=="object"&&window,typeof self=="object"&&self,typeof Bh=="object"&&Bh];for(var R=0;R<y.length;++R){var V=y[R];if(V&&V.Math==Math)return V}throw Error("Cannot find global object")}var r=n(this);function i(y,R){if(R)e:{var V=r;y=y.split(".");for(var K=0;K<y.length-1;K++){var fe=y[K];if(!(fe in V))break e;V=V[fe]}y=y[y.length-1],K=V[y],R=R(K),R!=K&&R!=null&&e(V,y,{configurable:!0,writable:!0,value:R})}}i("Symbol.dispose",function(y){return y||Symbol("Symbol.dispose")}),i("Array.prototype.values",function(y){return y||function(){return this[Symbol.iterator]()}}),i("Object.entries",function(y){return y||function(R){var V=[],K;for(K in R)Object.prototype.hasOwnProperty.call(R,K)&&V.push([K,R[K]]);return V}});var o=o||{},l=this||self;function d(y){var R=typeof y;return R=="object"&&y!=null||R=="function"}function h(y,R,V){return y.call.apply(y.bind,arguments)}function m(y,R,V){return m=h,m.apply(null,arguments)}function p(y,R){var V=Array.prototype.slice.call(arguments,1);return function(){var K=V.slice();return K.push.apply(K,arguments),y.apply(this,K)}}function g(y,R){function V(){}V.prototype=R.prototype,y.Z=R.prototype,y.prototype=new V,y.prototype.constructor=y,y.Ob=function(K,fe,xe){for(var Ne=Array(arguments.length-2),nt=2;nt<arguments.length;nt++)Ne[nt-2]=arguments[nt];return R.prototype[fe].apply(K,Ne)}}var v=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?y=>y&&AsyncContext.Snapshot.wrap(y):y=>y;function b(y){const R=y.length;if(R>0){const V=Array(R);for(let K=0;K<R;K++)V[K]=y[K];return V}return[]}function C(y,R){for(let K=1;K<arguments.length;K++){const fe=arguments[K];var V=typeof fe;if(V=V!="object"?V:fe?Array.isArray(fe)?"array":V:"null",V=="array"||V=="object"&&typeof fe.length=="number"){V=y.length||0;const xe=fe.length||0;y.length=V+xe;for(let Ne=0;Ne<xe;Ne++)y[V+Ne]=fe[Ne]}else y.push(fe)}}class x{constructor(R,V){this.i=R,this.j=V,this.h=0,this.g=null}get(){let R;return this.h>0?(this.h--,R=this.g,this.g=R.next,R.next=null):R=this.i(),R}}function S(y){l.setTimeout(()=>{throw y},0)}function E(){var y=k;let R=null;return y.g&&(R=y.g,y.g=y.g.next,y.g||(y.h=null),R.next=null),R}class T{constructor(){this.h=this.g=null}add(R,V){const K=I.get();K.set(R,V),this.h?this.h.next=K:this.g=K,this.h=K}}var I=new x(()=>new D,y=>y.reset());class D{constructor(){this.next=this.g=this.h=null}set(R,V){this.h=R,this.g=V,this.next=null}reset(){this.next=this.g=this.h=null}}let B,$=!1,k=new T,j=()=>{const y=Promise.resolve(void 0);B=()=>{y.then(N)}};function N(){for(var y;y=E();){try{y.h.call(y.g)}catch(V){S(V)}var R=I;R.j(y),R.h<100&&(R.h++,y.next=R.g,R.g=y)}$=!1}function F(){this.u=this.u,this.C=this.C}F.prototype.u=!1,F.prototype.dispose=function(){this.u||(this.u=!0,this.N())},F.prototype[Symbol.dispose]=function(){this.dispose()},F.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function q(y,R){this.type=y,this.g=this.target=R,this.defaultPrevented=!1}q.prototype.h=function(){this.defaultPrevented=!0};var A=(function(){if(!l.addEventListener||!Object.defineProperty)return!1;var y=!1,R=Object.defineProperty({},"passive",{get:function(){y=!0}});try{const V=()=>{};l.addEventListener("test",V,R),l.removeEventListener("test",V,R)}catch{}return y})();function P(y){return/^[\s\xa0]*$/.test(y)}function O(y,R){q.call(this,y?y.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,y&&this.init(y,R)}g(O,q),O.prototype.init=function(y,R){const V=this.type=y.type,K=y.changedTouches&&y.changedTouches.length?y.changedTouches[0]:null;this.target=y.target||y.srcElement,this.g=R,R=y.relatedTarget,R||(V=="mouseover"?R=y.fromElement:V=="mouseout"&&(R=y.toElement)),this.relatedTarget=R,K?(this.clientX=K.clientX!==void 0?K.clientX:K.pageX,this.clientY=K.clientY!==void 0?K.clientY:K.pageY,this.screenX=K.screenX||0,this.screenY=K.screenY||0):(this.clientX=y.clientX!==void 0?y.clientX:y.pageX,this.clientY=y.clientY!==void 0?y.clientY:y.pageY,this.screenX=y.screenX||0,this.screenY=y.screenY||0),this.button=y.button,this.key=y.key||"",this.ctrlKey=y.ctrlKey,this.altKey=y.altKey,this.shiftKey=y.shiftKey,this.metaKey=y.metaKey,this.pointerId=y.pointerId||0,this.pointerType=y.pointerType,this.state=y.state,this.i=y,y.defaultPrevented&&O.Z.h.call(this)},O.prototype.h=function(){O.Z.h.call(this);const y=this.i;y.preventDefault?y.preventDefault():y.returnValue=!1};var X="closure_listenable_"+(Math.random()*1e6|0),W=0;function H(y,R,V,K,fe){this.listener=y,this.proxy=null,this.src=R,this.type=V,this.capture=!!K,this.ha=fe,this.key=++W,this.da=this.fa=!1}function Z(y){y.da=!0,y.listener=null,y.proxy=null,y.src=null,y.ha=null}function Y(y,R,V){for(const K in y)R.call(V,y[K],K,y)}function se(y,R){for(const V in y)R.call(void 0,y[V],V,y)}function L(y){const R={};for(const V in y)R[V]=y[V];return R}const G="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ne(y,R){let V,K;for(let fe=1;fe<arguments.length;fe++){K=arguments[fe];for(V in K)y[V]=K[V];for(let xe=0;xe<G.length;xe++)V=G[xe],Object.prototype.hasOwnProperty.call(K,V)&&(y[V]=K[V])}}function ie(y){this.src=y,this.g={},this.h=0}ie.prototype.add=function(y,R,V,K,fe){const xe=y.toString();y=this.g[xe],y||(y=this.g[xe]=[],this.h++);const Ne=ue(y,R,K,fe);return Ne>-1?(R=y[Ne],V||(R.fa=!1)):(R=new H(R,this.src,xe,!!K,fe),R.fa=V,y.push(R)),R};function te(y,R){const V=R.type;if(V in y.g){var K=y.g[V],fe=Array.prototype.indexOf.call(K,R,void 0),xe;(xe=fe>=0)&&Array.prototype.splice.call(K,fe,1),xe&&(Z(R),y.g[V].length==0&&(delete y.g[V],y.h--))}}function ue(y,R,V,K){for(let fe=0;fe<y.length;++fe){const xe=y[fe];if(!xe.da&&xe.listener==R&&xe.capture==!!V&&xe.ha==K)return fe}return-1}var ve="closure_lm_"+(Math.random()*1e6|0),ce={};function be(y,R,V,K,fe){if(Array.isArray(R)){for(let xe=0;xe<R.length;xe++)be(y,R[xe],V,K,fe);return null}return V=J(V),y&&y[X]?y.J(R,V,d(K)?!!K.capture:!1,fe):ze(y,R,V,!1,K,fe)}function ze(y,R,V,K,fe,xe){if(!R)throw Error("Invalid event type");const Ne=d(fe)?!!fe.capture:!!fe;let nt=ye(y);if(nt||(y[ve]=nt=new ie(y)),V=nt.add(R,V,K,Ne,xe),V.proxy)return V;if(K=Pe(),V.proxy=K,K.src=y,K.listener=V,y.addEventListener)A||(fe=Ne),fe===void 0&&(fe=!1),y.addEventListener(R.toString(),K,fe);else if(y.attachEvent)y.attachEvent(U(R.toString()),K);else if(y.addListener&&y.removeListener)y.addListener(K);else throw Error("addEventListener and attachEvent are unavailable.");return V}function Pe(){function y(V){return R.call(y.src,y.listener,V)}const R=he;return y}function at(y,R,V,K,fe){if(Array.isArray(R))for(var xe=0;xe<R.length;xe++)at(y,R[xe],V,K,fe);else K=d(K)?!!K.capture:!!K,V=J(V),y&&y[X]?(y=y.i,xe=String(R).toString(),xe in y.g&&(R=y.g[xe],V=ue(R,V,K,fe),V>-1&&(Z(R[V]),Array.prototype.splice.call(R,V,1),R.length==0&&(delete y.g[xe],y.h--)))):y&&(y=ye(y))&&(R=y.g[R.toString()],y=-1,R&&(y=ue(R,V,K,fe)),(V=y>-1?R[y]:null)&&bt(V))}function bt(y){if(typeof y!="number"&&y&&!y.da){var R=y.src;if(R&&R[X])te(R.i,y);else{var V=y.type,K=y.proxy;R.removeEventListener?R.removeEventListener(V,K,y.capture):R.detachEvent?R.detachEvent(U(V),K):R.addListener&&R.removeListener&&R.removeListener(K),(V=ye(R))?(te(V,y),V.h==0&&(V.src=null,R[ve]=null)):Z(y)}}}function U(y){return y in ce?ce[y]:ce[y]="on"+y}function he(y,R){if(y.da)y=!0;else{R=new O(R,this);const V=y.listener,K=y.ha||y.src;y.fa&&bt(y),y=V.call(K,R)}return y}function ye(y){return y=y[ve],y instanceof ie?y:null}var ee="__closure_events_fn_"+(Math.random()*1e9>>>0);function J(y){return typeof y=="function"?y:(y[ee]||(y[ee]=function(R){return y.handleEvent(R)}),y[ee])}function oe(){F.call(this),this.i=new ie(this),this.M=this,this.G=null}g(oe,F),oe.prototype[X]=!0,oe.prototype.removeEventListener=function(y,R,V,K){at(this,y,R,V,K)};function Ce(y,R){var V,K=y.G;if(K)for(V=[];K;K=K.G)V.push(K);if(y=y.M,K=R.type||R,typeof R=="string")R=new q(R,y);else if(R instanceof q)R.target=R.target||y;else{var fe=R;R=new q(K,y),ne(R,fe)}fe=!0;let xe,Ne;if(V)for(Ne=V.length-1;Ne>=0;Ne--)xe=R.g=V[Ne],fe=Se(xe,K,!0,R)&&fe;if(xe=R.g=y,fe=Se(xe,K,!0,R)&&fe,fe=Se(xe,K,!1,R)&&fe,V)for(Ne=0;Ne<V.length;Ne++)xe=R.g=V[Ne],fe=Se(xe,K,!1,R)&&fe}oe.prototype.N=function(){if(oe.Z.N.call(this),this.i){var y=this.i;for(const R in y.g){const V=y.g[R];for(let K=0;K<V.length;K++)Z(V[K]);delete y.g[R],y.h--}}this.G=null},oe.prototype.J=function(y,R,V,K){return this.i.add(String(y),R,!1,V,K)},oe.prototype.K=function(y,R,V,K){return this.i.add(String(y),R,!0,V,K)};function Se(y,R,V,K){if(R=y.i.g[String(R)],!R)return!0;R=R.concat();let fe=!0;for(let xe=0;xe<R.length;++xe){const Ne=R[xe];if(Ne&&!Ne.da&&Ne.capture==V){const nt=Ne.listener,sn=Ne.ha||Ne.src;Ne.fa&&te(y.i,Ne),fe=nt.call(sn,K)!==!1&&fe}}return fe&&!K.defaultPrevented}function ae(y,R){if(typeof y!="function")if(y&&typeof y.handleEvent=="function")y=m(y.handleEvent,y);else throw Error("Invalid listener argument");return Number(R)>2147483647?-1:l.setTimeout(y,R||0)}function Ae(y){y.g=ae(()=>{y.g=null,y.i&&(y.i=!1,Ae(y))},y.l);const R=y.h;y.h=null,y.m.apply(null,R)}class Oe extends F{constructor(R,V){super(),this.m=R,this.l=V,this.h=null,this.i=!1,this.g=null}j(R){this.h=arguments,this.g?this.i=!0:Ae(this)}N(){super.N(),this.g&&(l.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function De(y){F.call(this),this.h=y,this.g={}}g(De,F);var qe=[];function St(y){Y(y.g,function(R,V){this.g.hasOwnProperty(V)&&bt(R)},y),y.g={}}De.prototype.N=function(){De.Z.N.call(this),St(this)},De.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var tt=l.JSON.stringify,Wn=l.JSON.parse,ps=class{stringify(y){return l.JSON.stringify(y,void 0)}parse(y){return l.JSON.parse(y,void 0)}};function tr(){}function gs(){}var xt={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function tn(){q.call(this,"d")}g(tn,q);function Kn(){q.call(this,"c")}g(Kn,q);var Tt={},Fa=null;function ji(){return Fa=Fa||new oe}Tt.Ia="serverreachability";function Fo(y){q.call(this,Tt.Ia,y)}g(Fo,q);function kr(y){const R=ji();Ce(R,new Fo(R))}Tt.STAT_EVENT="statevent";function ys(y,R){q.call(this,Tt.STAT_EVENT,y),this.stat=R}g(ys,q);function Ft(y){const R=ji();Ce(R,new ys(R,y))}Tt.Ja="timingevent";function nr(y,R){q.call(this,Tt.Ja,y),this.size=R}g(nr,q);function _s(y,R){if(typeof y!="function")throw Error("Fn must not be null and must be a function");return l.setTimeout(function(){y()},R)}function Kr(){this.g=!0}Kr.prototype.ua=function(){this.g=!1};function Sm(y,R,V,K,fe,xe){y.info(function(){if(y.g)if(xe){var Ne="",nt=xe.split("&");for(let At=0;At<nt.length;At++){var sn=nt[At].split("=");if(sn.length>1){const Wt=sn[0];sn=sn[1];const Nr=Wt.split("_");Ne=Nr.length>=2&&Nr[1]=="type"?Ne+(Wt+"="+sn+"&"):Ne+(Wt+"=redacted&")}}}else Ne=null;else Ne=xe;return"XMLHTTP REQ ("+K+") [attempt "+fe+"]: "+R+`
`+V+`
`+Ne})}function dd(y,R,V,K,fe,xe,Ne){y.info(function(){return"XMLHTTP RESP ("+K+") [ attempt "+fe+"]: "+R+`
`+V+`
`+xe+" "+Ne})}function bs(y,R,V,K){y.info(function(){return"XMLHTTP TEXT ("+R+"): "+Cm(y,V)+(K?" "+K:"")})}function Va(y,R){y.info(function(){return"TIMEOUT: "+R})}Kr.prototype.info=function(){};function Cm(y,R){if(!y.g)return R;if(!R)return null;try{const xe=JSON.parse(R);if(xe){for(y=0;y<xe.length;y++)if(Array.isArray(xe[y])){var V=xe[y];if(!(V.length<2)){var K=V[1];if(Array.isArray(K)&&!(K.length<1)){var fe=K[0];if(fe!="noop"&&fe!="stop"&&fe!="close")for(let Ne=1;Ne<K.length;Ne++)K[Ne]=""}}}}return tt(xe)}catch{return R}}var $a={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},yc={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},_c;function qa(){}g(qa,tr),qa.prototype.g=function(){return new XMLHttpRequest},_c=new qa;function Ws(y){return encodeURIComponent(String(y))}function hd(y){var R=1;y=y.split(":");const V=[];for(;R>0&&y.length;)V.push(y.shift()),R--;return y.length&&V.push(y.join(":")),V}function Yr(y,R,V,K){this.j=y,this.i=R,this.l=V,this.S=K||1,this.V=new De(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new Xr}function Xr(){this.i=null,this.g="",this.h=!1}var hn={},In={};function vs(y,R,V){y.M=1,y.A=Ha(mn(R)),y.u=V,y.R=!0,Vo(y,null)}function Vo(y,R){y.F=Date.now(),xs(y),y.B=mn(y.A);var V=y.B,K=y.S;Array.isArray(K)||(K=[String(K)]),Go(V.i,"t",K),y.C=0,V=y.j.L,y.h=new Xr,y.g=Ad(y.j,V?R:null,!y.u),y.P>0&&(y.O=new Oe(m(y.Y,y,y.g),y.P)),R=y.V,V=y.g,K=y.ba;var fe="readystatechange";Array.isArray(fe)||(fe&&(qe[0]=fe.toString()),fe=qe);for(let xe=0;xe<fe.length;xe++){const Ne=be(V,fe[xe],K||R.handleEvent,!1,R.h||R);if(!Ne)break;R.g[Ne.key]=Ne}R=y.J?L(y.J):{},y.u?(y.v||(y.v="POST"),R["Content-Type"]="application/x-www-form-urlencoded",y.g.ea(y.B,y.v,y.u,R)):(y.v="GET",y.g.ea(y.B,y.v,null,R)),kr(),Sm(y.i,y.v,y.B,y.l,y.S,y.u)}Yr.prototype.ba=function(y){y=y.target;const R=this.O;R&&es(y)==3?R.j():this.Y(y)},Yr.prototype.Y=function(y){try{if(y==this.g)e:{const nt=es(this.g),sn=this.g.ya(),At=this.g.ca();if(!(nt<3)&&(nt!=3||this.g&&(this.h.h||this.g.la()||Pn(this.g)))){this.K||nt!=4||sn==7||(sn==8||At<=0?kr(3):kr(2)),ws(this);var R=this.g.ca();this.X=R;var V=Em(this);if(this.o=R==200,dd(this.i,this.v,this.B,this.l,this.S,nt,R),this.o){if(this.U&&!this.L){t:{if(this.g){var K,fe=this.g;if((K=fe.g?fe.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!P(K)){var xe=K;break t}}xe=null}if(y=xe)bs(this.i,this.l,y,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,Ss(this,y);else{this.o=!1,this.m=3,Ft(12),br(this),Dr(this);break e}}if(this.R){y=!0;let Wt;for(;!this.K&&this.C<V.length;)if(Wt=md(this,V),Wt==In){nt==4&&(this.m=4,Ft(14),y=!1),bs(this.i,this.l,null,"[Incomplete Response]");break}else if(Wt==hn){this.m=4,Ft(15),bs(this.i,this.l,V,"[Invalid Chunk]"),y=!1;break}else bs(this.i,this.l,Wt,null),Ss(this,Wt);if(fd(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),nt!=4||V.length!=0||this.h.h||(this.m=1,Ft(16),y=!1),this.o=this.o&&y,!y)bs(this.i,this.l,V,"[Invalid Chunked Response]"),br(this),Dr(this);else if(V.length>0&&!this.W){this.W=!0;var Ne=this.j;Ne.g==this&&Ne.aa&&!Ne.P&&(Ne.j.info("Great, no buffering proxy detected. Bytes received: "+V.length),Mc(Ne),Ne.P=!0,Ft(11))}}else bs(this.i,this.l,V,null),Ss(this,V);nt==4&&br(this),this.o&&!this.K&&(nt==4?Sd(this.j,this):(this.o=!1,xs(this)))}else Ys(this.g),R==400&&V.indexOf("Unknown SID")>0?(this.m=3,Ft(12)):(this.m=0,Ft(13)),br(this),Dr(this)}}}catch{}};function Em(y){if(!fd(y))return y.g.la();const R=Pn(y.g);if(R==="")return"";let V="";const K=R.length,fe=es(y.g)==4;if(!y.h.i){if(typeof TextDecoder>"u")return br(y),Dr(y),"";y.h.i=new l.TextDecoder}for(let xe=0;xe<K;xe++)y.h.h=!0,V+=y.h.i.decode(R[xe],{stream:!(fe&&xe==K-1)});return R.length=0,y.h.g+=V,y.C=0,y.h.g}function fd(y){return y.g?y.v=="GET"&&y.M!=2&&y.j.Aa:!1}function md(y,R){var V=y.C,K=R.indexOf(`
`,V);return K==-1?In:(V=Number(R.substring(V,K)),isNaN(V)?hn:(K+=1,K+V>R.length?In:(R=R.slice(K,K+V),y.C=K+V,R)))}Yr.prototype.cancel=function(){this.K=!0,br(this)};function xs(y){y.T=Date.now()+y.H,$o(y,y.H)}function $o(y,R){if(y.D!=null)throw Error("WatchDog timer not null");y.D=_s(m(y.aa,y),R)}function ws(y){y.D&&(l.clearTimeout(y.D),y.D=null)}Yr.prototype.aa=function(){this.D=null;const y=Date.now();y-this.T>=0?(Va(this.i,this.B),this.M!=2&&(kr(),Ft(17)),br(this),this.m=2,Dr(this)):$o(this,this.T-y)};function Dr(y){y.j.I==0||y.K||Sd(y.j,y)}function br(y){ws(y);var R=y.O;R&&typeof R.dispose=="function"&&R.dispose(),y.O=null,St(y.V),y.g&&(R=y.g,y.g=null,R.abort(),R.dispose())}function Ss(y,R){try{var V=y.j;if(V.I!=0&&(V.g==y||Es(V.h,y))){if(!y.L&&Es(V.h,y)&&V.I==3){try{var K=V.Ba.g.parse(R)}catch{K=null}if(Array.isArray(K)&&K.length==3){var fe=K;if(fe[0]==0){e:if(!V.v){if(V.g)if(V.g.F+3e3<y.F)Xo(V),Pi(V);else break e;Za(V),Ft(18)}}else V.xa=fe[1],0<V.xa-V.K&&fe[2]<37500&&V.F&&V.A==0&&!V.C&&(V.C=_s(m(V.Va,V),6e3));Cs(V.h)<=1&&V.ta&&(V.ta=void 0)}else ks(V,11)}else if((y.L||V.g==y)&&Xo(V),!P(R))for(fe=V.Ba.g.parse(R),R=0;R<fe.length;R++){let At=fe[R];const Wt=At[0];if(!(Wt<=V.K))if(V.K=Wt,At=At[1],V.I==2)if(At[0]=="c"){V.M=At[1],V.ba=At[2];const Nr=At[3];Nr!=null&&(V.ka=Nr,V.j.info("VER="+V.ka));const Ds=At[4];Ds!=null&&(V.za=Ds,V.j.info("SVER="+V.za));const ts=At[5];ts!=null&&typeof ts=="number"&&ts>0&&(K=1.5*ts,V.O=K,V.j.info("backChannelRequestTimeoutMs_="+K)),K=V;const ns=y.g;if(ns){const Ja=ns.g?ns.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Ja){var xe=K.h;xe.g||Ja.indexOf("spdy")==-1&&Ja.indexOf("quic")==-1&&Ja.indexOf("h2")==-1||(xe.j=xe.l,xe.g=new Set,xe.h&&(xc(xe,xe.h),xe.h=null))}if(K.G){const Zo=ns.g?ns.g.getResponseHeader("X-HTTP-Session-Id"):null;Zo&&(K.wa=Zo,kt(K.J,K.G,Zo))}}V.I=3,V.l&&V.l.ra(),V.aa&&(V.T=Date.now()-y.F,V.j.info("Handshake RTT: "+V.T+"ms")),K=V;var Ne=y;if(K.na=Td(K,K.L?K.ba:null,K.W),Ne.L){wc(K.h,Ne);var nt=Ne,sn=K.O;sn&&(nt.H=sn),nt.D&&(ws(nt),xs(nt)),K.g=Ne}else xd(K);V.i.length>0&&Is(V)}else At[0]!="stop"&&At[0]!="close"||ks(V,7);else V.I==3&&(At[0]=="stop"||At[0]=="close"?At[0]=="stop"?ks(V,7):kc(V):At[0]!="noop"&&V.l&&V.l.qa(At),V.A=0)}}kr(4)}catch{}}var fn=class{constructor(y,R){this.g=y,this.map=R}};function bc(y){this.l=y||10,l.PerformanceNavigationTiming?(y=l.performance.getEntriesByType("navigation"),y=y.length>0&&(y[0].nextHopProtocol=="hq"||y[0].nextHopProtocol=="h2")):y=!!(l.chrome&&l.chrome.loadTimes&&l.chrome.loadTimes()&&l.chrome.loadTimes().wasFetchedViaSpdy),this.j=y?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function vc(y){return y.h?!0:y.g?y.g.size>=y.j:!1}function Cs(y){return y.h?1:y.g?y.g.size:0}function Es(y,R){return y.h?y.h==R:y.g?y.g.has(R):!1}function xc(y,R){y.g?y.g.add(R):y.h=R}function wc(y,R){y.h&&y.h==R?y.h=null:y.g&&y.g.has(R)&&y.g.delete(R)}bc.prototype.cancel=function(){if(this.i=Sc(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const y of this.g.values())y.cancel();this.g.clear()}};function Sc(y){if(y.h!=null)return y.i.concat(y.h.G);if(y.g!=null&&y.g.size!==0){let R=y.i;for(const V of y.g.values())R=R.concat(V.G);return R}return b(y.i)}var pd=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function qo(y,R){if(y){y=y.split("&");for(let V=0;V<y.length;V++){const K=y[V].indexOf("=");let fe,xe=null;K>=0?(fe=y[V].substring(0,K),xe=y[V].substring(K+1)):fe=y[V],R(fe,xe?decodeURIComponent(xe.replace(/\+/g," ")):"")}}}function vr(y){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let R;y instanceof vr?(this.l=y.l,kn(this,y.j),this.o=y.o,this.g=y.g,Ri(this,y.u),this.h=y.h,Cc(this,bd(y.i)),this.m=y.m):y&&(R=String(y).match(pd))?(this.l=!1,kn(this,R[1]||"",!0),this.o=Ts(R[2]||""),this.g=Ts(R[3]||"",!0),Ri(this,R[4]),this.h=Ts(R[5]||"",!0),Cc(this,R[6]||"",!0),this.m=Ts(R[7]||"")):(this.l=!1,this.i=new ki(null,this.l))}vr.prototype.toString=function(){const y=[];var R=this.j;R&&y.push(Ga(R,Ho,!0),":");var V=this.g;return(V||R=="file")&&(y.push("//"),(R=this.o)&&y.push(Ga(R,Ho,!0),"@"),y.push(Ws(V).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),V=this.u,V!=null&&y.push(":",String(V))),(V=this.h)&&(this.g&&V.charAt(0)!="/"&&y.push("/"),y.push(Ga(V,V.charAt(0)=="/"?Ec:gd,!0))),(V=this.i.toString())&&y.push("?",V),(V=this.m)&&y.push("#",Ga(V,yd)),y.join("")},vr.prototype.resolve=function(y){const R=mn(this);let V=!!y.j;V?kn(R,y.j):V=!!y.o,V?R.o=y.o:V=!!y.g,V?R.g=y.g:V=y.u!=null;var K=y.h;if(V)Ri(R,y.u);else if(V=!!y.h){if(K.charAt(0)!="/")if(this.g&&!this.h)K="/"+K;else{var fe=R.h.lastIndexOf("/");fe!=-1&&(K=R.h.slice(0,fe+1)+K)}if(fe=K,fe==".."||fe==".")K="";else if(fe.indexOf("./")!=-1||fe.indexOf("/.")!=-1){K=fe.lastIndexOf("/",0)==0,fe=fe.split("/");const xe=[];for(let Ne=0;Ne<fe.length;){const nt=fe[Ne++];nt=="."?K&&Ne==fe.length&&xe.push(""):nt==".."?((xe.length>1||xe.length==1&&xe[0]!="")&&xe.pop(),K&&Ne==fe.length&&xe.push("")):(xe.push(nt),K=!0)}K=xe.join("/")}else K=fe}return V?R.h=K:V=y.i.toString()!=="",V?Cc(R,bd(y.i)):V=!!y.m,V&&(R.m=y.m),R};function mn(y){return new vr(y)}function kn(y,R,V){y.j=V?Ts(R,!0):R,y.j&&(y.j=y.j.replace(/:$/,""))}function Ri(y,R){if(R){if(R=Number(R),isNaN(R)||R<0)throw Error("Bad port number "+R);y.u=R}else y.u=null}function Cc(y,R,V){R instanceof ki?(y.i=R,Qo(y.i,y.l)):(V||(R=Ga(R,Ii)),y.i=new ki(R,y.l))}function kt(y,R,V){y.i.set(R,V)}function Ha(y){return kt(y,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),y}function Ts(y,R){return y?R?decodeURI(y.replace(/%25/g,"%2525")):decodeURIComponent(y):""}function Ga(y,R,V){return typeof y=="string"?(y=encodeURI(y).replace(R,ar),V&&(y=y.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),y):null}function ar(y){return y=y.charCodeAt(0),"%"+(y>>4&15).toString(16)+(y&15).toString(16)}var Ho=/[#\/\?@]/g,gd=/[#\?:]/g,Ec=/[#\?]/g,Ii=/[#\?@]/g,yd=/#/g;function ki(y,R){this.h=this.g=null,this.i=y||null,this.j=!!R}function or(y){y.g||(y.g=new Map,y.h=0,y.i&&qo(y.i,function(R,V){y.add(decodeURIComponent(R.replace(/\+/g," ")),V)}))}t=ki.prototype,t.add=function(y,R){or(this),this.i=null,y=Di(this,y);let V=this.g.get(y);return V||this.g.set(y,V=[]),V.push(R),this.h+=1,this};function _d(y,R){or(y),R=Di(y,R),y.g.has(R)&&(y.i=null,y.h-=y.g.get(R).length,y.g.delete(R))}function Tc(y,R){return or(y),R=Di(y,R),y.g.has(R)}t.forEach=function(y,R){or(this),this.g.forEach(function(V,K){V.forEach(function(fe){y.call(R,fe,K,this)},this)},this)};function Ac(y,R){or(y);let V=[];if(typeof R=="string")Tc(y,R)&&(V=V.concat(y.g.get(Di(y,R))));else for(y=Array.from(y.g.values()),R=0;R<y.length;R++)V=V.concat(y[R]);return V}t.set=function(y,R){return or(this),this.i=null,y=Di(this,y),Tc(this,y)&&(this.h-=this.g.get(y).length),this.g.set(y,[R]),this.h+=1,this},t.get=function(y,R){return y?(y=Ac(this,y),y.length>0?String(y[0]):R):R};function Go(y,R,V){_d(y,R),V.length>0&&(y.i=null,y.g.set(Di(y,R),b(V)),y.h+=V.length)}t.toString=function(){if(this.i)return this.i;if(!this.g)return"";const y=[],R=Array.from(this.g.keys());for(let K=0;K<R.length;K++){var V=R[K];const fe=Ws(V);V=Ac(this,V);for(let xe=0;xe<V.length;xe++){let Ne=fe;V[xe]!==""&&(Ne+="="+Ws(V[xe])),y.push(Ne)}}return this.i=y.join("&")};function bd(y){const R=new ki;return R.i=y.i,y.g&&(R.g=new Map(y.g),R.h=y.h),R}function Di(y,R){return R=String(R),y.j&&(R=R.toLowerCase()),R}function Qo(y,R){R&&!y.j&&(or(y),y.i=null,y.g.forEach(function(V,K){const fe=K.toLowerCase();K!=fe&&(_d(this,K),Go(this,fe,V))},y)),y.j=R}function Zr(y,R){const V=new Kr;if(l.Image){const K=new Image;K.onload=p(Mr,V,"TestLoadImage: loaded",!0,R,K),K.onerror=p(Mr,V,"TestLoadImage: error",!1,R,K),K.onabort=p(Mr,V,"TestLoadImage: abort",!1,R,K),K.ontimeout=p(Mr,V,"TestLoadImage: timeout",!1,R,K),l.setTimeout(function(){K.ontimeout&&K.ontimeout()},1e4),K.src=y}else R(!1)}function jc(y,R){const V=new Kr,K=new AbortController,fe=setTimeout(()=>{K.abort(),Mr(V,"TestPingServer: timeout",!1,R)},1e4);fetch(y,{signal:K.signal}).then(xe=>{clearTimeout(fe),xe.ok?Mr(V,"TestPingServer: ok",!0,R):Mr(V,"TestPingServer: server error",!1,R)}).catch(()=>{clearTimeout(fe),Mr(V,"TestPingServer: error",!1,R)})}function Mr(y,R,V,K,fe){try{fe&&(fe.onload=null,fe.onerror=null,fe.onabort=null,fe.ontimeout=null),K(V)}catch{}}function Mi(){this.g=new ps}function As(y){this.i=y.Sb||null,this.h=y.ab||!1}g(As,tr),As.prototype.g=function(){return new Qa(this.i,this.h)};function Qa(y,R){oe.call(this),this.H=y,this.o=R,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}g(Qa,oe),t=Qa.prototype,t.open=function(y,R){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=y,this.D=R,this.readyState=1,Jr(this)},t.send=function(y){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const R={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};y&&(R.body=y),(this.H||l).fetch(new Request(this.D,R)).then(this.Pa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,Oi(this)),this.readyState=0},t.Pa=function(y){if(this.g&&(this.l=y,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=y.headers,this.readyState=2,Jr(this)),this.g&&(this.readyState=3,Jr(this),this.g)))if(this.responseType==="arraybuffer")y.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof l.ReadableStream<"u"&&"body"in y){if(this.j=y.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;Wo(this)}else y.text().then(this.Oa.bind(this),this.ga.bind(this))};function Wo(y){y.j.read().then(y.Ma.bind(y)).catch(y.ga.bind(y))}t.Ma=function(y){if(this.g){if(this.o&&y.value)this.response.push(y.value);else if(!this.o){var R=y.value?y.value:new Uint8Array(0);(R=this.B.decode(R,{stream:!y.done}))&&(this.response=this.responseText+=R)}y.done?Oi(this):Jr(this),this.readyState==3&&Wo(this)}},t.Oa=function(y){this.g&&(this.response=this.responseText=y,Oi(this))},t.Na=function(y){this.g&&(this.response=y,Oi(this))},t.ga=function(){this.g&&Oi(this)};function Oi(y){y.readyState=4,y.l=null,y.j=null,y.B=null,Jr(y)}t.setRequestHeader=function(y,R){this.A.append(y,R)},t.getResponseHeader=function(y){return this.h&&this.h.get(y.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";const y=[],R=this.h.entries();for(var V=R.next();!V.done;)V=V.value,y.push(V[0]+": "+V[1]),V=R.next();return y.join(`\r
`)};function Jr(y){y.onreadystatechange&&y.onreadystatechange.call(y)}Object.defineProperty(Qa.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(y){this.m=y?"include":"same-origin"}});function Or(y){let R="";return Y(y,function(V,K){R+=K,R+=":",R+=V,R+=`\r
`}),R}function Wa(y,R,V){e:{for(K in V){var K=!1;break e}K=!0}K||(V=Or(V),typeof y=="string"?V!=null&&Ws(V):kt(y,R,V))}function Ot(y){oe.call(this),this.headers=new Map,this.L=y||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}g(Ot,oe);var js=/^https?$/i,Rc=["POST","PUT"];t=Ot.prototype,t.Fa=function(y){this.H=y},t.ea=function(y,R,V,K){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+y);R=R?R.toUpperCase():"GET",this.D=y,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():_c.g(),this.g.onreadystatechange=v(m(this.Ca,this));try{this.B=!0,this.g.open(R,String(y),!0),this.B=!1}catch(xe){Ka(this,xe);return}if(y=V||"",V=new Map(this.headers),K)if(Object.getPrototypeOf(K)===Object.prototype)for(var fe in K)V.set(fe,K[fe]);else if(typeof K.keys=="function"&&typeof K.get=="function")for(const xe of K.keys())V.set(xe,K.get(xe));else throw Error("Unknown input type for opt_headers: "+String(K));K=Array.from(V.keys()).find(xe=>xe.toLowerCase()=="content-type"),fe=l.FormData&&y instanceof l.FormData,!(Array.prototype.indexOf.call(Rc,R,void 0)>=0)||K||fe||V.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[xe,Ne]of V)this.g.setRequestHeader(xe,Ne);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(y),this.v=!1}catch(xe){Ka(this,xe)}};function Ka(y,R){y.h=!1,y.g&&(y.j=!0,y.g.abort(),y.j=!1),y.l=R,y.o=5,Ic(y),Ks(y)}function Ic(y){y.A||(y.A=!0,Ce(y,"complete"),Ce(y,"error"))}t.abort=function(y){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=y||7,Ce(this,"complete"),Ce(this,"abort"),Ks(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Ks(this,!0)),Ot.Z.N.call(this)},t.Ca=function(){this.u||(this.B||this.v||this.j?Ya(this):this.Xa())},t.Xa=function(){Ya(this)};function Ya(y){if(y.h&&typeof o<"u"){if(y.v&&es(y)==4)setTimeout(y.Ca.bind(y),0);else if(Ce(y,"readystatechange"),es(y)==4){y.h=!1;try{const xe=y.ca();e:switch(xe){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var R=!0;break e;default:R=!1}var V;if(!(V=R)){var K;if(K=xe===0){let Ne=String(y.D).match(pd)[1]||null;!Ne&&l.self&&l.self.location&&(Ne=l.self.location.protocol.slice(0,-1)),K=!js.test(Ne?Ne.toLowerCase():"")}V=K}if(V)Ce(y,"complete"),Ce(y,"success");else{y.o=6;try{var fe=es(y)>2?y.g.statusText:""}catch{fe=""}y.l=fe+" ["+y.ca()+"]",Ic(y)}}finally{Ks(y)}}}}function Ks(y,R){if(y.g){y.m&&(clearTimeout(y.m),y.m=null);const V=y.g;y.g=null,R||Ce(y,"ready");try{V.onreadystatechange=null}catch{}}}t.isActive=function(){return!!this.g};function es(y){return y.g?y.g.readyState:0}t.ca=function(){try{return es(this)>2?this.g.status:-1}catch{return-1}},t.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},t.La=function(y){if(this.g){var R=this.g.responseText;return y&&R.indexOf(y)==0&&(R=R.substring(y.length)),Wn(R)}};function Pn(y){try{if(!y.g)return null;if("response"in y.g)return y.g.response;switch(y.F){case"":case"text":return y.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in y.g)return y.g.mozResponseArrayBuffer}return null}catch{return null}}function Ys(y){const R={};y=(y.g&&es(y)>=2&&y.g.getAllResponseHeaders()||"").split(`\r
`);for(let K=0;K<y.length;K++){if(P(y[K]))continue;var V=hd(y[K]);const fe=V[0];if(V=V[1],typeof V!="string")continue;V=V.trim();const xe=R[fe]||[];R[fe]=xe,xe.push(V)}se(R,function(K){return K.join(", ")})}t.ya=function(){return this.o},t.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function Rs(y,R,V){return V&&V.internalChannelParams&&V.internalChannelParams[y]||R}function Ni(y){this.za=0,this.i=[],this.j=new Kr,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=Rs("failFast",!1,y),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=Rs("baseRetryDelayMs",5e3,y),this.Za=Rs("retryDelaySeedMs",1e4,y),this.Ta=Rs("forwardChannelMaxRetries",2,y),this.va=Rs("forwardChannelRequestTimeoutMs",2e4,y),this.ma=y&&y.xmlHttpFactory||void 0,this.Ua=y&&y.Rb||void 0,this.Aa=y&&y.useFetchStreams||!1,this.O=void 0,this.L=y&&y.supportsCrossDomainXhr||!1,this.M="",this.h=new bc(y&&y.concurrentRequestLimit),this.Ba=new Mi,this.S=y&&y.fastHandshake||!1,this.R=y&&y.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=y&&y.Pb||!1,y&&y.ua&&this.j.ua(),y&&y.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&y&&y.detectBufferingProxy||!1,this.ia=void 0,y&&y.longPollingTimeout&&y.longPollingTimeout>0&&(this.ia=y.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}t=Ni.prototype,t.ka=8,t.I=1,t.connect=function(y,R,V,K){Ft(0),this.W=y,this.H=R||{},V&&K!==void 0&&(this.H.OSID=V,this.H.OAID=K),this.F=this.X,this.J=Td(this,null,this.W),Is(this)};function kc(y){if(Ko(y),y.I==3){var R=y.V++,V=mn(y.J);if(kt(V,"SID",y.M),kt(V,"RID",R),kt(V,"TYPE","terminate"),Xa(y,V),R=new Yr(y,y.j,R),R.M=2,R.A=Ha(mn(V)),V=!1,l.navigator&&l.navigator.sendBeacon)try{V=l.navigator.sendBeacon(R.A.toString(),"")}catch{}!V&&l.Image&&(new Image().src=R.A,V=!0),V||(R.g=Ad(R.j,null),R.g.ea(R.A)),R.F=Date.now(),xs(R)}Ed(y)}function Pi(y){y.g&&(Mc(y),y.g.cancel(),y.g=null)}function Ko(y){Pi(y),y.v&&(l.clearTimeout(y.v),y.v=null),Xo(y),y.h.cancel(),y.m&&(typeof y.m=="number"&&l.clearTimeout(y.m),y.m=null)}function Is(y){if(!vc(y.h)&&!y.m){y.m=!0;var R=y.Ea;B||j(),$||(B(),$=!0),k.add(R,y),y.D=0}}function Yo(y,R){return Cs(y.h)>=y.h.j-(y.m?1:0)?!1:y.m?(y.i=R.G.concat(y.i),!0):y.I==1||y.I==2||y.D>=(y.Sa?0:y.Ta)?!1:(y.m=_s(m(y.Ea,y,R),Cd(y,y.D)),y.D++,!0)}t.Ea=function(y){if(this.m)if(this.m=null,this.I==1){if(!y){this.V=Math.floor(Math.random()*1e5),y=this.V++;const fe=new Yr(this,this.j,y);let xe=this.o;if(this.U&&(xe?(xe=L(xe),ne(xe,this.U)):xe=this.U),this.u!==null||this.R||(fe.J=xe,xe=null),this.S)e:{for(var R=0,V=0;V<this.i.length;V++){t:{var K=this.i[V];if("__data__"in K.map&&(K=K.map.__data__,typeof K=="string")){K=K.length;break t}K=void 0}if(K===void 0)break;if(R+=K,R>4096){R=V;break e}if(R===4096||V===this.i.length-1){R=V+1;break e}}R=1e3}else R=1e3;R=vd(this,fe,R),V=mn(this.J),kt(V,"RID",y),kt(V,"CVER",22),this.G&&kt(V,"X-HTTP-Session-Id",this.G),Xa(this,V),xe&&(this.R?R="headers="+Ws(Or(xe))+"&"+R:this.u&&Wa(V,this.u,xe)),xc(this.h,fe),this.Ra&&kt(V,"TYPE","init"),this.S?(kt(V,"$req",R),kt(V,"SID","null"),fe.U=!0,vs(fe,V,null)):vs(fe,V,R),this.I=2}}else this.I==3&&(y?Dc(this,y):this.i.length==0||vc(this.h)||Dc(this))};function Dc(y,R){var V;R?V=R.l:V=y.V++;const K=mn(y.J);kt(K,"SID",y.M),kt(K,"RID",V),kt(K,"AID",y.K),Xa(y,K),y.u&&y.o&&Wa(K,y.u,y.o),V=new Yr(y,y.j,V,y.D+1),y.u===null&&(V.J=y.o),R&&(y.i=R.G.concat(y.i)),R=vd(y,V,1e3),V.H=Math.round(y.va*.5)+Math.round(y.va*.5*Math.random()),xc(y.h,V),vs(V,K,R)}function Xa(y,R){y.H&&Y(y.H,function(V,K){kt(R,K,V)}),y.l&&Y({},function(V,K){kt(R,K,V)})}function vd(y,R,V){V=Math.min(y.i.length,V);const K=y.l?m(y.l.Ka,y.l,y):null;e:{var fe=y.i;let nt=-1;for(;;){const sn=["count="+V];nt==-1?V>0?(nt=fe[0].g,sn.push("ofs="+nt)):nt=0:sn.push("ofs="+nt);let At=!0;for(let Wt=0;Wt<V;Wt++){var xe=fe[Wt].g;const Nr=fe[Wt].map;if(xe-=nt,xe<0)nt=Math.max(0,fe[Wt].g-100),At=!1;else try{xe="req"+xe+"_"||"";try{var Ne=Nr instanceof Map?Nr:Object.entries(Nr);for(const[Ds,ts]of Ne){let ns=ts;d(ts)&&(ns=tt(ts)),sn.push(xe+Ds+"="+encodeURIComponent(ns))}}catch(Ds){throw sn.push(xe+"type="+encodeURIComponent("_badmap")),Ds}}catch{K&&K(Nr)}}if(At){Ne=sn.join("&");break e}}Ne=void 0}return y=y.i.splice(0,V),R.G=y,Ne}function xd(y){if(!y.g&&!y.v){y.Y=1;var R=y.Da;B||j(),$||(B(),$=!0),k.add(R,y),y.A=0}}function Za(y){return y.g||y.v||y.A>=3?!1:(y.Y++,y.v=_s(m(y.Da,y),Cd(y,y.A)),y.A++,!0)}t.Da=function(){if(this.v=null,wd(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var y=4*this.T;this.j.info("BP detection timer enabled: "+y),this.B=_s(m(this.Wa,this),y)}},t.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,Ft(10),Pi(this),wd(this))};function Mc(y){y.B!=null&&(l.clearTimeout(y.B),y.B=null)}function wd(y){y.g=new Yr(y,y.j,"rpc",y.Y),y.u===null&&(y.g.J=y.o),y.g.P=0;var R=mn(y.na);kt(R,"RID","rpc"),kt(R,"SID",y.M),kt(R,"AID",y.K),kt(R,"CI",y.F?"0":"1"),!y.F&&y.ia&&kt(R,"TO",y.ia),kt(R,"TYPE","xmlhttp"),Xa(y,R),y.u&&y.o&&Wa(R,y.u,y.o),y.O&&(y.g.H=y.O);var V=y.g;y=y.ba,V.M=1,V.A=Ha(mn(R)),V.u=null,V.R=!0,Vo(V,y)}t.Va=function(){this.C!=null&&(this.C=null,Pi(this),Za(this),Ft(19))};function Xo(y){y.C!=null&&(l.clearTimeout(y.C),y.C=null)}function Sd(y,R){var V=null;if(y.g==R){Xo(y),Mc(y),y.g=null;var K=2}else if(Es(y.h,R))V=R.G,wc(y.h,R),K=1;else return;if(y.I!=0){if(R.o)if(K==1){V=R.u?R.u.length:0,R=Date.now()-R.F;var fe=y.D;K=ji(),Ce(K,new nr(K,V)),Is(y)}else xd(y);else if(fe=R.m,fe==3||fe==0&&R.X>0||!(K==1&&Yo(y,R)||K==2&&Za(y)))switch(V&&V.length>0&&(R=y.h,R.i=R.i.concat(V)),fe){case 1:ks(y,5);break;case 4:ks(y,10);break;case 3:ks(y,6);break;default:ks(y,2)}}}function Cd(y,R){let V=y.Qa+Math.floor(Math.random()*y.Za);return y.isActive()||(V*=2),V*R}function ks(y,R){if(y.j.info("Error code "+R),R==2){var V=m(y.bb,y),K=y.Ua;const fe=!K;K=new vr(K||"//www.google.com/images/cleardot.gif"),l.location&&l.location.protocol=="http"||kn(K,"https"),Ha(K),fe?Zr(K.toString(),V):jc(K.toString(),V)}else Ft(2);y.I=0,y.l&&y.l.pa(R),Ed(y),Ko(y)}t.bb=function(y){y?(this.j.info("Successfully pinged google.com"),Ft(2)):(this.j.info("Failed to ping google.com"),Ft(1))};function Ed(y){if(y.I=0,y.ja=[],y.l){const R=Sc(y.h);(R.length!=0||y.i.length!=0)&&(C(y.ja,R),C(y.ja,y.i),y.h.i.length=0,b(y.i),y.i.length=0),y.l.oa()}}function Td(y,R,V){var K=V instanceof vr?mn(V):new vr(V);if(K.g!="")R&&(K.g=R+"."+K.g),Ri(K,K.u);else{var fe=l.location;K=fe.protocol,R=R?R+"."+fe.hostname:fe.hostname,fe=+fe.port;const xe=new vr(null);K&&kn(xe,K),R&&(xe.g=R),fe&&Ri(xe,fe),V&&(xe.h=V),K=xe}return V=y.G,R=y.wa,V&&R&&kt(K,V,R),kt(K,"VER",y.ka),Xa(y,K),K}function Ad(y,R,V){if(R&&!y.L)throw Error("Can't create secondary domain capable XhrIo object.");return R=y.Aa&&!y.ma?new Ot(new As({ab:V})):new Ot(y.ma),R.Fa(y.L),R}t.isActive=function(){return!!this.l&&this.l.isActive(this)};function jd(){}t=jd.prototype,t.ra=function(){},t.qa=function(){},t.pa=function(){},t.oa=function(){},t.isActive=function(){return!0},t.Ka=function(){};function zi(){}zi.prototype.g=function(y,R){return new rr(y,R)};function rr(y,R){oe.call(this),this.g=new Ni(R),this.l=y,this.h=R&&R.messageUrlParams||null,y=R&&R.messageHeaders||null,R&&R.clientProtocolHeaderRequired&&(y?y["X-Client-Protocol"]="webchannel":y={"X-Client-Protocol":"webchannel"}),this.g.o=y,y=R&&R.initMessageHeaders||null,R&&R.messageContentType&&(y?y["X-WebChannel-Content-Type"]=R.messageContentType:y={"X-WebChannel-Content-Type":R.messageContentType}),R&&R.sa&&(y?y["X-WebChannel-Client-Profile"]=R.sa:y={"X-WebChannel-Client-Profile":R.sa}),this.g.U=y,(y=R&&R.Qb)&&!P(y)&&(this.g.u=y),this.A=R&&R.supportsCrossDomainXhr||!1,this.v=R&&R.sendRawJson||!1,(R=R&&R.httpSessionIdParam)&&!P(R)&&(this.g.G=R,y=this.h,y!==null&&R in y&&(y=this.h,R in y&&delete y[R])),this.j=new Xs(this)}g(rr,oe),rr.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},rr.prototype.close=function(){kc(this.g)},rr.prototype.o=function(y){var R=this.g;if(typeof y=="string"){var V={};V.__data__=y,y=V}else this.v&&(V={},V.__data__=tt(y),y=V);R.i.push(new fn(R.Ya++,y)),R.I==3&&Is(R)},rr.prototype.N=function(){this.g.l=null,delete this.j,kc(this.g),delete this.g,rr.Z.N.call(this)};function Rd(y){tn.call(this),y.__headers__&&(this.headers=y.__headers__,this.statusCode=y.__status__,delete y.__headers__,delete y.__status__);var R=y.__sm__;if(R){e:{for(const V in R){y=V;break e}y=void 0}(this.i=y)&&(y=this.i,R=R!==null&&y in R?R[y]:void 0),this.data=R}else this.data=y}g(Rd,tn);function Id(){Kn.call(this),this.status=1}g(Id,Kn);function Xs(y){this.g=y}g(Xs,jd),Xs.prototype.ra=function(){Ce(this.g,"a")},Xs.prototype.qa=function(y){Ce(this.g,new Rd(y))},Xs.prototype.pa=function(y){Ce(this.g,new Id)},Xs.prototype.oa=function(){Ce(this.g,"b")},zi.prototype.createWebChannel=zi.prototype.g,rr.prototype.send=rr.prototype.o,rr.prototype.open=rr.prototype.m,rr.prototype.close=rr.prototype.close,LC=function(){return new zi},BC=function(){return ji()},zC=Tt,hy={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},$a.NO_ERROR=0,$a.TIMEOUT=8,$a.HTTP_ERROR=6,Xh=$a,yc.COMPLETE="complete",PC=yc,gs.EventType=xt,xt.OPEN="a",xt.CLOSE="b",xt.ERROR="c",xt.MESSAGE="d",oe.prototype.listen=oe.prototype.J,xu=gs,Ot.prototype.listenOnce=Ot.prototype.K,Ot.prototype.getLastError=Ot.prototype.Ha,Ot.prototype.getLastErrorCode=Ot.prototype.ya,Ot.prototype.getStatus=Ot.prototype.ca,Ot.prototype.getResponseJson=Ot.prototype.La,Ot.prototype.getResponseText=Ot.prototype.la,Ot.prototype.send=Ot.prototype.ea,Ot.prototype.setWithCredentials=Ot.prototype.Fa,NC=Ot}).apply(typeof Bh<"u"?Bh:typeof self<"u"?self:typeof window<"u"?window:{});const jw="@firebase/firestore",Rw="4.9.3";class Zn{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Zn.UNAUTHENTICATED=new Zn(null),Zn.GOOGLE_CREDENTIALS=new Zn("google-credentials-uid"),Zn.FIRST_PARTY=new Zn("first-party-uid"),Zn.MOCK_USER=new Zn("mock-user");let lc="12.7.0";const Io=new Hy("@firebase/firestore");function Dl(){return Io.logLevel}function Ue(t,...e){if(Io.logLevel<=ft.DEBUG){const n=e.map(n0);Io.debug(`Firestore (${lc}): ${t}`,...n)}}function wi(t,...e){if(Io.logLevel<=ft.ERROR){const n=e.map(n0);Io.error(`Firestore (${lc}): ${t}`,...n)}}function ql(t,...e){if(Io.logLevel<=ft.WARN){const n=e.map(n0);Io.warn(`Firestore (${lc}): ${t}`,...n)}}function n0(t){if(typeof t=="string")return t;try{return(function(n){return JSON.stringify(n)})(t)}catch{return t}}function Ke(t,e,n){let r="Unexpected state";typeof e=="string"?r=e:n=e,UC(t,r,n)}function UC(t,e,n){let r=`FIRESTORE (${lc}) INTERNAL ASSERTION FAILED: ${e} (ID: ${t.toString(16)})`;if(n!==void 0)try{r+=" CONTEXT: "+JSON.stringify(n)}catch{r+=" CONTEXT: "+n}throw wi(r),new Error(r)}function It(t,e,n,r){let i="Unexpected state";typeof n=="string"?i=n:r=n,t||UC(e,i,r)}function et(t,e){return t}const je={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Be extends Ti{constructor(e,n){super(e,n),this.code=e,this.message=n,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class yi{constructor(){this.promise=new Promise(((e,n)=>{this.resolve=e,this.reject=n}))}}class FC{constructor(e,n){this.user=n,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class fM{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,n){e.enqueueRetryable((()=>n(Zn.UNAUTHENTICATED)))}shutdown(){}}class mM{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,n){this.changeListener=n,e.enqueueRetryable((()=>n(this.token.user)))}shutdown(){this.changeListener=null}}class pM{constructor(e){this.t=e,this.currentUser=Zn.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,n){It(this.o===void 0,42304);let r=this.i;const i=h=>this.i!==r?(r=this.i,n(h)):Promise.resolve();let o=new yi;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new yi,e.enqueueRetryable((()=>i(this.currentUser)))};const l=()=>{const h=o;e.enqueueRetryable((async()=>{await h.promise,await i(this.currentUser)}))},d=h=>{Ue("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=h,this.o&&(this.auth.addAuthTokenListener(this.o),l())};this.t.onInit((h=>d(h))),setTimeout((()=>{if(!this.auth){const h=this.t.getImmediate({optional:!0});h?d(h):(Ue("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new yi)}}),0),l()}getToken(){const e=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then((r=>this.i!==e?(Ue("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(It(typeof r.accessToken=="string",31837,{l:r}),new FC(r.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return It(e===null||typeof e=="string",2055,{h:e}),new Zn(e)}}class gM{constructor(e,n,r){this.P=e,this.T=n,this.I=r,this.type="FirstParty",this.user=Zn.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class yM{constructor(e,n,r){this.P=e,this.T=n,this.I=r}getToken(){return Promise.resolve(new gM(this.P,this.T,this.I))}start(e,n){e.enqueueRetryable((()=>n(Zn.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class Iw{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class _M{constructor(e,n){this.V=n,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,os(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,n){It(this.o===void 0,3512);const r=o=>{o.error!=null&&Ue("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${o.error.message}`);const l=o.token!==this.m;return this.m=o.token,Ue("FirebaseAppCheckTokenProvider",`Received ${l?"new":"existing"} token.`),l?n(o.token):Promise.resolve()};this.o=o=>{e.enqueueRetryable((()=>r(o)))};const i=o=>{Ue("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=o,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((o=>i(o))),setTimeout((()=>{if(!this.appCheck){const o=this.V.getImmediate({optional:!0});o?i(o):Ue("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new Iw(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((n=>n?(It(typeof n.token=="string",44558,{tokenResult:n}),this.m=n.token,new Iw(n.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function bM(t){const e=typeof self<"u"&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(n);else for(let r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}class r0{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const i=bM(40);for(let o=0;o<i.length;++o)r.length<20&&i[o]<n&&(r+=e.charAt(i[o]%62))}return r}}function mt(t,e){return t<e?-1:t>e?1:0}function fy(t,e){const n=Math.min(t.length,e.length);for(let r=0;r<n;r++){const i=t.charAt(r),o=e.charAt(r);if(i!==o)return Ng(i)===Ng(o)?mt(i,o):Ng(i)?1:-1}return mt(t.length,e.length)}const vM=55296,xM=57343;function Ng(t){const e=t.charCodeAt(0);return e>=vM&&e<=xM}function Hl(t,e,n){return t.length===e.length&&t.every(((r,i)=>n(r,e[i])))}const kw="__name__";class Bs{constructor(e,n,r){n===void 0?n=0:n>e.length&&Ke(637,{offset:n,range:e.length}),r===void 0?r=e.length-n:r>e.length-n&&Ke(1746,{length:r,range:e.length-n}),this.segments=e,this.offset=n,this.len=r}get length(){return this.len}isEqual(e){return Bs.comparator(this,e)===0}child(e){const n=this.segments.slice(this.offset,this.limit());return e instanceof Bs?e.forEach((r=>{n.push(r)})):n.push(e),this.construct(n)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}forEach(e){for(let n=this.offset,r=this.limit();n<r;n++)e(this.segments[n])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,n){const r=Math.min(e.length,n.length);for(let i=0;i<r;i++){const o=Bs.compareSegments(e.get(i),n.get(i));if(o!==0)return o}return mt(e.length,n.length)}static compareSegments(e,n){const r=Bs.isNumericId(e),i=Bs.isNumericId(n);return r&&!i?-1:!r&&i?1:r&&i?Bs.extractNumericId(e).compare(Bs.extractNumericId(n)):fy(e,n)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return xa.fromString(e.substring(4,e.length-2))}}class Vt extends Bs{construct(e,n,r){return new Vt(e,n,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const n=[];for(const r of e){if(r.indexOf("//")>=0)throw new Be(je.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);n.push(...r.split("/").filter((i=>i.length>0)))}return new Vt(n)}static emptyPath(){return new Vt([])}}const wM=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Vn extends Bs{construct(e,n,r){return new Vn(e,n,r)}static isValidIdentifier(e){return wM.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Vn.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===kw}static keyField(){return new Vn([kw])}static fromServerFormat(e){const n=[];let r="",i=0;const o=()=>{if(r.length===0)throw new Be(je.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);n.push(r),r=""};let l=!1;for(;i<e.length;){const d=e[i];if(d==="\\"){if(i+1===e.length)throw new Be(je.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const h=e[i+1];if(h!=="\\"&&h!=="."&&h!=="`")throw new Be(je.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=h,i+=2}else d==="`"?(l=!l,i++):d!=="."||l?(r+=d,i++):(o(),i++)}if(o(),l)throw new Be(je.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Vn(n)}static emptyPath(){return new Vn([])}}class Ge{constructor(e){this.path=e}static fromPath(e){return new Ge(Vt.fromString(e))}static fromName(e){return new Ge(Vt.fromString(e).popFirst(5))}static empty(){return new Ge(Vt.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Vt.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,n){return Vt.comparator(e.path,n.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Ge(new Vt(e.slice()))}}function VC(t,e,n){if(!n)throw new Be(je.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function SM(t,e,n,r){if(e===!0&&r===!0)throw new Be(je.INVALID_ARGUMENT,`${t} and ${n} cannot be used together.`)}function Dw(t){if(!Ge.isDocumentKey(t))throw new Be(je.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function Mw(t){if(Ge.isDocumentKey(t))throw new Be(je.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function $C(t){return typeof t=="object"&&t!==null&&(Object.getPrototypeOf(t)===Object.prototype||Object.getPrototypeOf(t)===null)}function Hf(t){if(t===void 0)return"undefined";if(t===null)return"null";if(typeof t=="string")return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if(typeof t=="number"||typeof t=="boolean")return""+t;if(typeof t=="object"){if(t instanceof Array)return"an array";{const e=(function(r){return r.constructor?r.constructor.name:null})(t);return e?`a custom ${e} object`:"an object"}}return typeof t=="function"?"a function":Ke(12329,{type:typeof t})}function hs(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new Be(je.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=Hf(t);throw new Be(je.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}function xn(t,e){const n={typeString:t};return e&&(n.value=e),n}function ed(t,e){if(!$C(t))throw new Be(je.INVALID_ARGUMENT,"JSON must be an object");let n;for(const r in e)if(e[r]){const i=e[r].typeString,o="value"in e[r]?{value:e[r].value}:void 0;if(!(r in t)){n=`JSON missing required field: '${r}'`;break}const l=t[r];if(i&&typeof l!==i){n=`JSON field '${r}' must be a ${i}.`;break}if(o!==void 0&&l!==o.value){n=`Expected '${r}' field to equal '${o.value}'`;break}}if(n)throw new Be(je.INVALID_ARGUMENT,n);return!0}const Ow=-62135596800,Nw=1e6;class Qt{static now(){return Qt.fromMillis(Date.now())}static fromDate(e){return Qt.fromMillis(e.getTime())}static fromMillis(e){const n=Math.floor(e/1e3),r=Math.floor((e-1e3*n)*Nw);return new Qt(n,r)}constructor(e,n){if(this.seconds=e,this.nanoseconds=n,n<0)throw new Be(je.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new Be(je.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(e<Ow)throw new Be(je.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Be(je.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/Nw}_compareTo(e){return this.seconds===e.seconds?mt(this.nanoseconds,e.nanoseconds):mt(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:Qt._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(ed(e,Qt._jsonSchema))return new Qt(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-Ow;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}Qt._jsonSchemaVersion="firestore/timestamp/1.0",Qt._jsonSchema={type:xn("string",Qt._jsonSchemaVersion),seconds:xn("number"),nanoseconds:xn("number")};class Xe{static fromTimestamp(e){return new Xe(e)}static min(){return new Xe(new Qt(0,0))}static max(){return new Xe(new Qt(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const Pu=-1;function CM(t,e){const n=t.toTimestamp().seconds,r=t.toTimestamp().nanoseconds+1,i=Xe.fromTimestamp(r===1e9?new Qt(n+1,0):new Qt(n,r));return new Sa(i,Ge.empty(),e)}function EM(t){return new Sa(t.readTime,t.key,Pu)}class Sa{constructor(e,n,r){this.readTime=e,this.documentKey=n,this.largestBatchId=r}static min(){return new Sa(Xe.min(),Ge.empty(),Pu)}static max(){return new Sa(Xe.max(),Ge.empty(),Pu)}}function TM(t,e){let n=t.readTime.compareTo(e.readTime);return n!==0?n:(n=Ge.comparator(t.documentKey,e.documentKey),n!==0?n:mt(t.largestBatchId,e.largestBatchId))}const AM="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class jM{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function cc(t){if(t.code!==je.FAILED_PRECONDITION||t.message!==AM)throw t;Ue("LocalStore","Unexpectedly lost primary lease")}class ke{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((n=>{this.isDone=!0,this.result=n,this.nextCallback&&this.nextCallback(n)}),(n=>{this.isDone=!0,this.error=n,this.catchCallback&&this.catchCallback(n)}))}catch(e){return this.next(void 0,e)}next(e,n){return this.callbackAttached&&Ke(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new ke(((r,i)=>{this.nextCallback=o=>{this.wrapSuccess(e,o).next(r,i)},this.catchCallback=o=>{this.wrapFailure(n,o).next(r,i)}}))}toPromise(){return new Promise(((e,n)=>{this.next(e,n)}))}wrapUserFunction(e){try{const n=e();return n instanceof ke?n:ke.resolve(n)}catch(n){return ke.reject(n)}}wrapSuccess(e,n){return e?this.wrapUserFunction((()=>e(n))):ke.resolve(n)}wrapFailure(e,n){return e?this.wrapUserFunction((()=>e(n))):ke.reject(n)}static resolve(e){return new ke(((n,r)=>{n(e)}))}static reject(e){return new ke(((n,r)=>{r(e)}))}static waitFor(e){return new ke(((n,r)=>{let i=0,o=0,l=!1;e.forEach((d=>{++i,d.next((()=>{++o,l&&o===i&&n()}),(h=>r(h)))})),l=!0,o===i&&n()}))}static or(e){let n=ke.resolve(!1);for(const r of e)n=n.next((i=>i?ke.resolve(i):r()));return n}static forEach(e,n){const r=[];return e.forEach(((i,o)=>{r.push(n.call(this,i,o))})),this.waitFor(r)}static mapArray(e,n){return new ke(((r,i)=>{const o=e.length,l=new Array(o);let d=0;for(let h=0;h<o;h++){const m=h;n(e[m]).next((p=>{l[m]=p,++d,d===o&&r(l)}),(p=>i(p)))}}))}static doWhile(e,n){return new ke(((r,i)=>{const o=()=>{e()===!0?n().next((()=>{o()}),i):r()};o()}))}}function RM(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}function uc(t){return t.name==="IndexedDbTransactionError"}class Gf{constructor(e,n){this.previousValue=e,n&&(n.sequenceNumberHandler=r=>this.ae(r),this.ue=r=>n.writeSequenceNumber(r))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}Gf.ce=-1;const s0=-1;function Qf(t){return t==null}function pf(t){return t===0&&1/t==-1/0}function IM(t){return typeof t=="number"&&Number.isInteger(t)&&!pf(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}const qC="";function kM(t){let e="";for(let n=0;n<t.length;n++)e.length>0&&(e=Pw(e)),e=DM(t.get(n),e);return Pw(e)}function DM(t,e){let n=e;const r=t.length;for(let i=0;i<r;i++){const o=t.charAt(i);switch(o){case"\0":n+="";break;case qC:n+="";break;default:n+=o}}return n}function Pw(t){return t+qC+""}function zw(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Pa(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function HC(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}class en{constructor(e,n){this.comparator=e,this.root=n||Fn.EMPTY}insert(e,n){return new en(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,Fn.BLACK,null,null))}remove(e){return new en(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Fn.BLACK,null,null))}get(e){let n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(r===0)return n.value;r<0?n=n.left:r>0&&(n=n.right)}return null}indexOf(e){let n=0,r=this.root;for(;!r.isEmpty();){const i=this.comparator(e,r.key);if(i===0)return n+r.left.size;i<0?r=r.left:(n+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((n,r)=>(e(n,r),!1)))}toString(){const e=[];return this.inorderTraversal(((n,r)=>(e.push(`${n}:${r}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Lh(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Lh(this.root,e,this.comparator,!1)}getReverseIterator(){return new Lh(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Lh(this.root,e,this.comparator,!0)}}class Lh{constructor(e,n,r,i){this.isReverse=i,this.nodeStack=[];let o=1;for(;!e.isEmpty();)if(o=n?r(e.key,n):1,n&&i&&(o*=-1),o<0)e=this.isReverse?e.left:e.right;else{if(o===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const n={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return n}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Fn{constructor(e,n,r,i,o){this.key=e,this.value=n,this.color=r??Fn.RED,this.left=i??Fn.EMPTY,this.right=o??Fn.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,n,r,i,o){return new Fn(e??this.key,n??this.value,r??this.color,i??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,r){let i=this;const o=r(e,i.key);return i=o<0?i.copy(null,null,null,i.left.insert(e,n,r),null):o===0?i.copy(null,n,null,null,null):i.copy(null,null,null,null,i.right.insert(e,n,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return Fn.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,n){let r,i=this;if(n(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),n(e,i.key)===0){if(i.right.isEmpty())return Fn.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Fn.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Fn.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Ke(43730,{key:this.key,value:this.value});if(this.right.isRed())throw Ke(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw Ke(27949);return e+(this.isRed()?0:1)}}Fn.EMPTY=null,Fn.RED=!0,Fn.BLACK=!1;Fn.EMPTY=new class{constructor(){this.size=0}get key(){throw Ke(57766)}get value(){throw Ke(16141)}get color(){throw Ke(16727)}get left(){throw Ke(29726)}get right(){throw Ke(36894)}copy(e,n,r,i,o){return this}insert(e,n,r){return new Fn(e,n)}remove(e,n){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class jn{constructor(e){this.comparator=e,this.data=new en(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((n,r)=>(e(n),!1)))}forEachInRange(e,n){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;n(i.key)}}forEachWhile(e,n){let r;for(r=n!==void 0?this.data.getIteratorFrom(n):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const n=this.data.getIteratorFrom(e);return n.hasNext()?n.getNext().key:null}getIterator(){return new Bw(this.data.getIterator())}getIteratorFrom(e){return new Bw(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let n=this;return n.size<e.size&&(n=e,e=this),e.forEach((r=>{n=n.add(r)})),n}isEqual(e){if(!(e instanceof jn)||this.size!==e.size)return!1;const n=this.data.getIterator(),r=e.data.getIterator();for(;n.hasNext();){const i=n.getNext().key,o=r.getNext().key;if(this.comparator(i,o)!==0)return!1}return!0}toArray(){const e=[];return this.forEach((n=>{e.push(n)})),e}toString(){const e=[];return this.forEach((n=>e.push(n))),"SortedSet("+e.toString()+")"}copy(e){const n=new jn(this.comparator);return n.data=e,n}}class Bw{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class jr{constructor(e){this.fields=e,e.sort(Vn.comparator)}static empty(){return new jr([])}unionWith(e){let n=new jn(Vn.comparator);for(const r of this.fields)n=n.add(r);for(const r of e)n=n.add(r);return new jr(n.toArray())}covers(e){for(const n of this.fields)if(n.isPrefixOf(e))return!0;return!1}isEqual(e){return Hl(this.fields,e.fields,((n,r)=>n.isEqual(r)))}}class GC extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class qn{constructor(e){this.binaryString=e}static fromBase64String(e){const n=(function(i){try{return atob(i)}catch(o){throw typeof DOMException<"u"&&o instanceof DOMException?new GC("Invalid base64 string: "+o):o}})(e);return new qn(n)}static fromUint8Array(e){const n=(function(i){let o="";for(let l=0;l<i.length;++l)o+=String.fromCharCode(i[l]);return o})(e);return new qn(n)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(n){return btoa(n)})(this.binaryString)}toUint8Array(){return(function(n){const r=new Uint8Array(n.length);for(let i=0;i<n.length;i++)r[i]=n.charCodeAt(i);return r})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return mt(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}qn.EMPTY_BYTE_STRING=new qn("");const MM=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Ca(t){if(It(!!t,39018),typeof t=="string"){let e=0;const n=MM.exec(t);if(It(!!n,46558,{timestamp:t}),n[1]){let i=n[1];i=(i+"000000000").substr(0,9),e=Number(i)}const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:ln(t.seconds),nanos:ln(t.nanos)}}function ln(t){return typeof t=="number"?t:typeof t=="string"?Number(t):0}function Ea(t){return typeof t=="string"?qn.fromBase64String(t):qn.fromUint8Array(t)}const QC="server_timestamp",WC="__type__",KC="__previous_value__",YC="__local_write_time__";function i0(t){return(t?.mapValue?.fields||{})[WC]?.stringValue===QC}function Wf(t){const e=t.mapValue.fields[KC];return i0(e)?Wf(e):e}function zu(t){const e=Ca(t.mapValue.fields[YC].timestampValue);return new Qt(e.seconds,e.nanos)}class OM{constructor(e,n,r,i,o,l,d,h,m,p){this.databaseId=e,this.appId=n,this.persistenceKey=r,this.host=i,this.ssl=o,this.forceLongPolling=l,this.autoDetectLongPolling=d,this.longPollingOptions=h,this.useFetchStreams=m,this.isUsingEmulator=p}}const gf="(default)";class Bu{constructor(e,n){this.projectId=e,this.database=n||gf}static empty(){return new Bu("","")}get isDefaultDatabase(){return this.database===gf}isEqual(e){return e instanceof Bu&&e.projectId===this.projectId&&e.database===this.database}}const XC="__type__",NM="__max__",Uh={mapValue:{}},ZC="__vector__",yf="value";function Ta(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?i0(t)?4:zM(t)?9007199254740991:PM(t)?10:11:Ke(28295,{value:t})}function Gs(t,e){if(t===e)return!0;const n=Ta(t);if(n!==Ta(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return zu(t).isEqual(zu(e));case 3:return(function(i,o){if(typeof i.timestampValue=="string"&&typeof o.timestampValue=="string"&&i.timestampValue.length===o.timestampValue.length)return i.timestampValue===o.timestampValue;const l=Ca(i.timestampValue),d=Ca(o.timestampValue);return l.seconds===d.seconds&&l.nanos===d.nanos})(t,e);case 5:return t.stringValue===e.stringValue;case 6:return(function(i,o){return Ea(i.bytesValue).isEqual(Ea(o.bytesValue))})(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return(function(i,o){return ln(i.geoPointValue.latitude)===ln(o.geoPointValue.latitude)&&ln(i.geoPointValue.longitude)===ln(o.geoPointValue.longitude)})(t,e);case 2:return(function(i,o){if("integerValue"in i&&"integerValue"in o)return ln(i.integerValue)===ln(o.integerValue);if("doubleValue"in i&&"doubleValue"in o){const l=ln(i.doubleValue),d=ln(o.doubleValue);return l===d?pf(l)===pf(d):isNaN(l)&&isNaN(d)}return!1})(t,e);case 9:return Hl(t.arrayValue.values||[],e.arrayValue.values||[],Gs);case 10:case 11:return(function(i,o){const l=i.mapValue.fields||{},d=o.mapValue.fields||{};if(zw(l)!==zw(d))return!1;for(const h in l)if(l.hasOwnProperty(h)&&(d[h]===void 0||!Gs(l[h],d[h])))return!1;return!0})(t,e);default:return Ke(52216,{left:t})}}function Lu(t,e){return(t.values||[]).find((n=>Gs(n,e)))!==void 0}function Gl(t,e){if(t===e)return 0;const n=Ta(t),r=Ta(e);if(n!==r)return mt(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return mt(t.booleanValue,e.booleanValue);case 2:return(function(o,l){const d=ln(o.integerValue||o.doubleValue),h=ln(l.integerValue||l.doubleValue);return d<h?-1:d>h?1:d===h?0:isNaN(d)?isNaN(h)?0:-1:1})(t,e);case 3:return Lw(t.timestampValue,e.timestampValue);case 4:return Lw(zu(t),zu(e));case 5:return fy(t.stringValue,e.stringValue);case 6:return(function(o,l){const d=Ea(o),h=Ea(l);return d.compareTo(h)})(t.bytesValue,e.bytesValue);case 7:return(function(o,l){const d=o.split("/"),h=l.split("/");for(let m=0;m<d.length&&m<h.length;m++){const p=mt(d[m],h[m]);if(p!==0)return p}return mt(d.length,h.length)})(t.referenceValue,e.referenceValue);case 8:return(function(o,l){const d=mt(ln(o.latitude),ln(l.latitude));return d!==0?d:mt(ln(o.longitude),ln(l.longitude))})(t.geoPointValue,e.geoPointValue);case 9:return Uw(t.arrayValue,e.arrayValue);case 10:return(function(o,l){const d=o.fields||{},h=l.fields||{},m=d[yf]?.arrayValue,p=h[yf]?.arrayValue,g=mt(m?.values?.length||0,p?.values?.length||0);return g!==0?g:Uw(m,p)})(t.mapValue,e.mapValue);case 11:return(function(o,l){if(o===Uh.mapValue&&l===Uh.mapValue)return 0;if(o===Uh.mapValue)return 1;if(l===Uh.mapValue)return-1;const d=o.fields||{},h=Object.keys(d),m=l.fields||{},p=Object.keys(m);h.sort(),p.sort();for(let g=0;g<h.length&&g<p.length;++g){const v=fy(h[g],p[g]);if(v!==0)return v;const b=Gl(d[h[g]],m[p[g]]);if(b!==0)return b}return mt(h.length,p.length)})(t.mapValue,e.mapValue);default:throw Ke(23264,{he:n})}}function Lw(t,e){if(typeof t=="string"&&typeof e=="string"&&t.length===e.length)return mt(t,e);const n=Ca(t),r=Ca(e),i=mt(n.seconds,r.seconds);return i!==0?i:mt(n.nanos,r.nanos)}function Uw(t,e){const n=t.values||[],r=e.values||[];for(let i=0;i<n.length&&i<r.length;++i){const o=Gl(n[i],r[i]);if(o)return o}return mt(n.length,r.length)}function Ql(t){return my(t)}function my(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?(function(n){const r=Ca(n);return`time(${r.seconds},${r.nanos})`})(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?(function(n){return Ea(n).toBase64()})(t.bytesValue):"referenceValue"in t?(function(n){return Ge.fromName(n).toString()})(t.referenceValue):"geoPointValue"in t?(function(n){return`geo(${n.latitude},${n.longitude})`})(t.geoPointValue):"arrayValue"in t?(function(n){let r="[",i=!0;for(const o of n.values||[])i?i=!1:r+=",",r+=my(o);return r+"]"})(t.arrayValue):"mapValue"in t?(function(n){const r=Object.keys(n.fields||{}).sort();let i="{",o=!0;for(const l of r)o?o=!1:i+=",",i+=`${l}:${my(n.fields[l])}`;return i+"}"})(t.mapValue):Ke(61005,{value:t})}function Zh(t){switch(Ta(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=Wf(t);return e?16+Zh(e):16;case 5:return 2*t.stringValue.length;case 6:return Ea(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return(function(r){return(r.values||[]).reduce(((i,o)=>i+Zh(o)),0)})(t.arrayValue);case 10:case 11:return(function(r){let i=0;return Pa(r.fields,((o,l)=>{i+=o.length+Zh(l)})),i})(t.mapValue);default:throw Ke(13486,{value:t})}}function Fw(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function py(t){return!!t&&"integerValue"in t}function a0(t){return!!t&&"arrayValue"in t}function Vw(t){return!!t&&"nullValue"in t}function $w(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Jh(t){return!!t&&"mapValue"in t}function PM(t){return(t?.mapValue?.fields||{})[XC]?.stringValue===ZC}function Au(t){if(t.geoPointValue)return{geoPointValue:{...t.geoPointValue}};if(t.timestampValue&&typeof t.timestampValue=="object")return{timestampValue:{...t.timestampValue}};if(t.mapValue){const e={mapValue:{fields:{}}};return Pa(t.mapValue.fields,((n,r)=>e.mapValue.fields[n]=Au(r))),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=Au(t.arrayValue.values[n]);return e}return{...t}}function zM(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue===NM}class mr{constructor(e){this.value=e}static empty(){return new mr({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let n=this.value;for(let r=0;r<e.length-1;++r)if(n=(n.mapValue.fields||{})[e.get(r)],!Jh(n))return null;return n=(n.mapValue.fields||{})[e.lastSegment()],n||null}}set(e,n){this.getFieldsMap(e.popLast())[e.lastSegment()]=Au(n)}setAll(e){let n=Vn.emptyPath(),r={},i=[];e.forEach(((l,d)=>{if(!n.isImmediateParentOf(d)){const h=this.getFieldsMap(n);this.applyChanges(h,r,i),r={},i=[],n=d.popLast()}l?r[d.lastSegment()]=Au(l):i.push(d.lastSegment())}));const o=this.getFieldsMap(n);this.applyChanges(o,r,i)}delete(e){const n=this.field(e.popLast());Jh(n)&&n.mapValue.fields&&delete n.mapValue.fields[e.lastSegment()]}isEqual(e){return Gs(this.value,e.value)}getFieldsMap(e){let n=this.value;n.mapValue.fields||(n.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=n.mapValue.fields[e.get(r)];Jh(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},n.mapValue.fields[e.get(r)]=i),n=i}return n.mapValue.fields}applyChanges(e,n,r){Pa(n,((i,o)=>e[i]=o));for(const i of r)delete e[i]}clone(){return new mr(Au(this.value))}}function JC(t){const e=[];return Pa(t.fields,((n,r)=>{const i=new Vn([n]);if(Jh(r)){const o=JC(r.mapValue).fields;if(o.length===0)e.push(i);else for(const l of o)e.push(i.child(l))}else e.push(i)})),new jr(e)}class Jn{constructor(e,n,r,i,o,l,d){this.key=e,this.documentType=n,this.version=r,this.readTime=i,this.createTime=o,this.data=l,this.documentState=d}static newInvalidDocument(e){return new Jn(e,0,Xe.min(),Xe.min(),Xe.min(),mr.empty(),0)}static newFoundDocument(e,n,r,i){return new Jn(e,1,n,Xe.min(),r,i,0)}static newNoDocument(e,n){return new Jn(e,2,n,Xe.min(),Xe.min(),mr.empty(),0)}static newUnknownDocument(e,n){return new Jn(e,3,n,Xe.min(),Xe.min(),mr.empty(),2)}convertToFoundDocument(e,n){return!this.createTime.isEqual(Xe.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=n,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=mr.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=mr.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Xe.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Jn&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Jn(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class _f{constructor(e,n){this.position=e,this.inclusive=n}}function qw(t,e,n){let r=0;for(let i=0;i<t.position.length;i++){const o=e[i],l=t.position[i];if(o.field.isKeyField()?r=Ge.comparator(Ge.fromName(l.referenceValue),n.key):r=Gl(l,n.data.field(o.field)),o.dir==="desc"&&(r*=-1),r!==0)break}return r}function Hw(t,e){if(t===null)return e===null;if(e===null||t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!Gs(t.position[n],e.position[n]))return!1;return!0}class bf{constructor(e,n="asc"){this.field=e,this.dir=n}}function BM(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}class eE{}class vn extends eE{constructor(e,n,r){super(),this.field=e,this.op=n,this.value=r}static create(e,n,r){return e.isKeyField()?n==="in"||n==="not-in"?this.createKeyFieldInFilter(e,n,r):new UM(e,n,r):n==="array-contains"?new $M(e,r):n==="in"?new qM(e,r):n==="not-in"?new HM(e,r):n==="array-contains-any"?new GM(e,r):new vn(e,n,r)}static createKeyFieldInFilter(e,n,r){return n==="in"?new FM(e,r):new VM(e,r)}matches(e){const n=e.data.field(this.field);return this.op==="!="?n!==null&&n.nullValue===void 0&&this.matchesComparison(Gl(n,this.value)):n!==null&&Ta(this.value)===Ta(n)&&this.matchesComparison(Gl(n,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Ke(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class fs extends eE{constructor(e,n){super(),this.filters=e,this.op=n,this.Pe=null}static create(e,n){return new fs(e,n)}matches(e){return tE(this)?this.filters.find((n=>!n.matches(e)))===void 0:this.filters.find((n=>n.matches(e)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((e,n)=>e.concat(n.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function tE(t){return t.op==="and"}function nE(t){return LM(t)&&tE(t)}function LM(t){for(const e of t.filters)if(e instanceof fs)return!1;return!0}function gy(t){if(t instanceof vn)return t.field.canonicalString()+t.op.toString()+Ql(t.value);if(nE(t))return t.filters.map((e=>gy(e))).join(",");{const e=t.filters.map((n=>gy(n))).join(",");return`${t.op}(${e})`}}function rE(t,e){return t instanceof vn?(function(r,i){return i instanceof vn&&r.op===i.op&&r.field.isEqual(i.field)&&Gs(r.value,i.value)})(t,e):t instanceof fs?(function(r,i){return i instanceof fs&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce(((o,l,d)=>o&&rE(l,i.filters[d])),!0):!1})(t,e):void Ke(19439)}function sE(t){return t instanceof vn?(function(n){return`${n.field.canonicalString()} ${n.op} ${Ql(n.value)}`})(t):t instanceof fs?(function(n){return n.op.toString()+" {"+n.getFilters().map(sE).join(" ,")+"}"})(t):"Filter"}class UM extends vn{constructor(e,n,r){super(e,n,r),this.key=Ge.fromName(r.referenceValue)}matches(e){const n=Ge.comparator(e.key,this.key);return this.matchesComparison(n)}}class FM extends vn{constructor(e,n){super(e,"in",n),this.keys=iE("in",n)}matches(e){return this.keys.some((n=>n.isEqual(e.key)))}}class VM extends vn{constructor(e,n){super(e,"not-in",n),this.keys=iE("not-in",n)}matches(e){return!this.keys.some((n=>n.isEqual(e.key)))}}function iE(t,e){return(e.arrayValue?.values||[]).map((n=>Ge.fromName(n.referenceValue)))}class $M extends vn{constructor(e,n){super(e,"array-contains",n)}matches(e){const n=e.data.field(this.field);return a0(n)&&Lu(n.arrayValue,this.value)}}class qM extends vn{constructor(e,n){super(e,"in",n)}matches(e){const n=e.data.field(this.field);return n!==null&&Lu(this.value.arrayValue,n)}}class HM extends vn{constructor(e,n){super(e,"not-in",n)}matches(e){if(Lu(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const n=e.data.field(this.field);return n!==null&&n.nullValue===void 0&&!Lu(this.value.arrayValue,n)}}class GM extends vn{constructor(e,n){super(e,"array-contains-any",n)}matches(e){const n=e.data.field(this.field);return!(!a0(n)||!n.arrayValue.values)&&n.arrayValue.values.some((r=>Lu(this.value.arrayValue,r)))}}class QM{constructor(e,n=null,r=[],i=[],o=null,l=null,d=null){this.path=e,this.collectionGroup=n,this.orderBy=r,this.filters=i,this.limit=o,this.startAt=l,this.endAt=d,this.Te=null}}function Gw(t,e=null,n=[],r=[],i=null,o=null,l=null){return new QM(t,e,n,r,i,o,l)}function o0(t){const e=et(t);if(e.Te===null){let n=e.path.canonicalString();e.collectionGroup!==null&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map((r=>gy(r))).join(","),n+="|ob:",n+=e.orderBy.map((r=>(function(o){return o.field.canonicalString()+o.dir})(r))).join(","),Qf(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map((r=>Ql(r))).join(",")),e.endAt&&(n+="|ub:",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map((r=>Ql(r))).join(",")),e.Te=n}return e.Te}function l0(t,e){if(t.limit!==e.limit||t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!BM(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!rE(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!Hw(t.startAt,e.startAt)&&Hw(t.endAt,e.endAt)}function yy(t){return Ge.isDocumentKey(t.path)&&t.collectionGroup===null&&t.filters.length===0}class td{constructor(e,n=null,r=[],i=[],o=null,l="F",d=null,h=null){this.path=e,this.collectionGroup=n,this.explicitOrderBy=r,this.filters=i,this.limit=o,this.limitType=l,this.startAt=d,this.endAt=h,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function WM(t,e,n,r,i,o,l,d){return new td(t,e,n,r,i,o,l,d)}function c0(t){return new td(t)}function Qw(t){return t.filters.length===0&&t.limit===null&&t.startAt==null&&t.endAt==null&&(t.explicitOrderBy.length===0||t.explicitOrderBy.length===1&&t.explicitOrderBy[0].field.isKeyField())}function aE(t){return t.collectionGroup!==null}function ju(t){const e=et(t);if(e.Ie===null){e.Ie=[];const n=new Set;for(const o of e.explicitOrderBy)e.Ie.push(o),n.add(o.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(l){let d=new jn(Vn.comparator);return l.filters.forEach((h=>{h.getFlattenedFilters().forEach((m=>{m.isInequality()&&(d=d.add(m.field))}))})),d})(e).forEach((o=>{n.has(o.canonicalString())||o.isKeyField()||e.Ie.push(new bf(o,r))})),n.has(Vn.keyField().canonicalString())||e.Ie.push(new bf(Vn.keyField(),r))}return e.Ie}function Vs(t){const e=et(t);return e.Ee||(e.Ee=KM(e,ju(t))),e.Ee}function KM(t,e){if(t.limitType==="F")return Gw(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map((i=>{const o=i.dir==="desc"?"asc":"desc";return new bf(i.field,o)}));const n=t.endAt?new _f(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new _f(t.startAt.position,t.startAt.inclusive):null;return Gw(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}}function _y(t,e){const n=t.filters.concat([e]);return new td(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}function by(t,e,n){return new td(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Kf(t,e){return l0(Vs(t),Vs(e))&&t.limitType===e.limitType}function oE(t){return`${o0(Vs(t))}|lt:${t.limitType}`}function Ml(t){return`Query(target=${(function(n){let r=n.path.canonicalString();return n.collectionGroup!==null&&(r+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(r+=`, filters: [${n.filters.map((i=>sE(i))).join(", ")}]`),Qf(n.limit)||(r+=", limit: "+n.limit),n.orderBy.length>0&&(r+=`, orderBy: [${n.orderBy.map((i=>(function(l){return`${l.field.canonicalString()} (${l.dir})`})(i))).join(", ")}]`),n.startAt&&(r+=", startAt: ",r+=n.startAt.inclusive?"b:":"a:",r+=n.startAt.position.map((i=>Ql(i))).join(",")),n.endAt&&(r+=", endAt: ",r+=n.endAt.inclusive?"a:":"b:",r+=n.endAt.position.map((i=>Ql(i))).join(",")),`Target(${r})`})(Vs(t))}; limitType=${t.limitType})`}function Yf(t,e){return e.isFoundDocument()&&(function(r,i){const o=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(o):Ge.isDocumentKey(r.path)?r.path.isEqual(o):r.path.isImmediateParentOf(o)})(t,e)&&(function(r,i){for(const o of ju(r))if(!o.field.isKeyField()&&i.data.field(o.field)===null)return!1;return!0})(t,e)&&(function(r,i){for(const o of r.filters)if(!o.matches(i))return!1;return!0})(t,e)&&(function(r,i){return!(r.startAt&&!(function(l,d,h){const m=qw(l,d,h);return l.inclusive?m<=0:m<0})(r.startAt,ju(r),i)||r.endAt&&!(function(l,d,h){const m=qw(l,d,h);return l.inclusive?m>=0:m>0})(r.endAt,ju(r),i))})(t,e)}function YM(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function lE(t){return(e,n)=>{let r=!1;for(const i of ju(t)){const o=XM(i,e,n);if(o!==0)return o;r=r||i.field.isKeyField()}return 0}}function XM(t,e,n){const r=t.field.isKeyField()?Ge.comparator(e.key,n.key):(function(o,l,d){const h=l.data.field(o),m=d.data.field(o);return h!==null&&m!==null?Gl(h,m):Ke(42886)})(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return Ke(19790,{direction:t.dir})}}class No{constructor(e,n){this.mapKeyFn=e,this.equalsFn=n,this.inner={},this.innerSize=0}get(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r!==void 0){for(const[i,o]of r)if(this.equalsFn(i,e))return o}}has(e){return this.get(e)!==void 0}set(e,n){const r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,n]],void this.innerSize++;for(let o=0;o<i.length;o++)if(this.equalsFn(i[o][0],e))return void(i[o]=[e,n]);i.push([e,n]),this.innerSize++}delete(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[n]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Pa(this.inner,((n,r)=>{for(const[i,o]of r)e(i,o)}))}isEmpty(){return HC(this.inner)}size(){return this.innerSize}}const ZM=new en(Ge.comparator);function Si(){return ZM}const cE=new en(Ge.comparator);function wu(...t){let e=cE;for(const n of t)e=e.insert(n.key,n);return e}function uE(t){let e=cE;return t.forEach(((n,r)=>e=e.insert(n,r.overlayedDocument))),e}function xo(){return Ru()}function dE(){return Ru()}function Ru(){return new No((t=>t.toString()),((t,e)=>t.isEqual(e)))}const JM=new en(Ge.comparator),eO=new jn(Ge.comparator);function pt(...t){let e=eO;for(const n of t)e=e.add(n);return e}const tO=new jn(mt);function nO(){return tO}function u0(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:pf(e)?"-0":e}}function hE(t){return{integerValue:""+t}}function rO(t,e){return IM(e)?hE(e):u0(t,e)}class Xf{constructor(){this._=void 0}}function sO(t,e,n){return t instanceof vf?(function(i,o){const l={fields:{[WC]:{stringValue:QC},[YC]:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return o&&i0(o)&&(o=Wf(o)),o&&(l.fields[KC]=o),{mapValue:l}})(n,e):t instanceof Wl?mE(t,e):t instanceof Kl?pE(t,e):(function(i,o){const l=fE(i,o),d=Ww(l)+Ww(i.Ae);return py(l)&&py(i.Ae)?hE(d):u0(i.serializer,d)})(t,e)}function iO(t,e,n){return t instanceof Wl?mE(t,e):t instanceof Kl?pE(t,e):n}function fE(t,e){return t instanceof xf?(function(r){return py(r)||(function(o){return!!o&&"doubleValue"in o})(r)})(e)?e:{integerValue:0}:null}class vf extends Xf{}class Wl extends Xf{constructor(e){super(),this.elements=e}}function mE(t,e){const n=gE(e);for(const r of t.elements)n.some((i=>Gs(i,r)))||n.push(r);return{arrayValue:{values:n}}}class Kl extends Xf{constructor(e){super(),this.elements=e}}function pE(t,e){let n=gE(e);for(const r of t.elements)n=n.filter((i=>!Gs(i,r)));return{arrayValue:{values:n}}}class xf extends Xf{constructor(e,n){super(),this.serializer=e,this.Ae=n}}function Ww(t){return ln(t.integerValue||t.doubleValue)}function gE(t){return a0(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}class yE{constructor(e,n){this.field=e,this.transform=n}}function aO(t,e){return t.field.isEqual(e.field)&&(function(r,i){return r instanceof Wl&&i instanceof Wl||r instanceof Kl&&i instanceof Kl?Hl(r.elements,i.elements,Gs):r instanceof xf&&i instanceof xf?Gs(r.Ae,i.Ae):r instanceof vf&&i instanceof vf})(t.transform,e.transform)}class oO{constructor(e,n){this.version=e,this.transformResults=n}}class yr{constructor(e,n){this.updateTime=e,this.exists=n}static none(){return new yr}static exists(e){return new yr(void 0,e)}static updateTime(e){return new yr(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function ef(t,e){return t.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(t.updateTime):t.exists===void 0||t.exists===e.isFoundDocument()}class Zf{}function _E(t,e){if(!t.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return t.isNoDocument()?new Jf(t.key,yr.none()):new nd(t.key,t.data,yr.none());{const n=t.data,r=mr.empty();let i=new jn(Vn.comparator);for(let o of e.fields)if(!i.has(o)){let l=n.field(o);l===null&&o.length>1&&(o=o.popLast(),l=n.field(o)),l===null?r.delete(o):r.set(o,l),i=i.add(o)}return new za(t.key,r,new jr(i.toArray()),yr.none())}}function lO(t,e,n){t instanceof nd?(function(i,o,l){const d=i.value.clone(),h=Yw(i.fieldTransforms,o,l.transformResults);d.setAll(h),o.convertToFoundDocument(l.version,d).setHasCommittedMutations()})(t,e,n):t instanceof za?(function(i,o,l){if(!ef(i.precondition,o))return void o.convertToUnknownDocument(l.version);const d=Yw(i.fieldTransforms,o,l.transformResults),h=o.data;h.setAll(bE(i)),h.setAll(d),o.convertToFoundDocument(l.version,h).setHasCommittedMutations()})(t,e,n):(function(i,o,l){o.convertToNoDocument(l.version).setHasCommittedMutations()})(0,e,n)}function Iu(t,e,n,r){return t instanceof nd?(function(o,l,d,h){if(!ef(o.precondition,l))return d;const m=o.value.clone(),p=Xw(o.fieldTransforms,h,l);return m.setAll(p),l.convertToFoundDocument(l.version,m).setHasLocalMutations(),null})(t,e,n,r):t instanceof za?(function(o,l,d,h){if(!ef(o.precondition,l))return d;const m=Xw(o.fieldTransforms,h,l),p=l.data;return p.setAll(bE(o)),p.setAll(m),l.convertToFoundDocument(l.version,p).setHasLocalMutations(),d===null?null:d.unionWith(o.fieldMask.fields).unionWith(o.fieldTransforms.map((g=>g.field)))})(t,e,n,r):(function(o,l,d){return ef(o.precondition,l)?(l.convertToNoDocument(l.version).setHasLocalMutations(),null):d})(t,e,n)}function cO(t,e){let n=null;for(const r of t.fieldTransforms){const i=e.data.field(r.field),o=fE(r.transform,i||null);o!=null&&(n===null&&(n=mr.empty()),n.set(r.field,o))}return n||null}function Kw(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!(function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&Hl(r,i,((o,l)=>aO(o,l)))})(t.fieldTransforms,e.fieldTransforms)&&(t.type===0?t.value.isEqual(e.value):t.type!==1||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class nd extends Zf{constructor(e,n,r,i=[]){super(),this.key=e,this.value=n,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class za extends Zf{constructor(e,n,r,i,o=[]){super(),this.key=e,this.data=n,this.fieldMask=r,this.precondition=i,this.fieldTransforms=o,this.type=1}getFieldMask(){return this.fieldMask}}function bE(t){const e=new Map;return t.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const r=t.data.field(n);e.set(n,r)}})),e}function Yw(t,e,n){const r=new Map;It(t.length===n.length,32656,{Re:n.length,Ve:t.length});for(let i=0;i<n.length;i++){const o=t[i],l=o.transform,d=e.data.field(o.field);r.set(o.field,iO(l,d,n[i]))}return r}function Xw(t,e,n){const r=new Map;for(const i of t){const o=i.transform,l=n.data.field(i.field);r.set(i.field,sO(o,l,e))}return r}class Jf extends Zf{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class uO extends Zf{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class dO{constructor(e,n,r,i){this.batchId=e,this.localWriteTime=n,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,n){const r=n.mutationResults;for(let i=0;i<this.mutations.length;i++){const o=this.mutations[i];o.key.isEqual(e.key)&&lO(o,e,r[i])}}applyToLocalView(e,n){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(n=Iu(r,e,n,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(n=Iu(r,e,n,this.localWriteTime));return n}applyToLocalDocumentSet(e,n){const r=dE();return this.mutations.forEach((i=>{const o=e.get(i.key),l=o.overlayedDocument;let d=this.applyToLocalView(l,o.mutatedFields);d=n.has(i.key)?null:d;const h=_E(l,d);h!==null&&r.set(i.key,h),l.isValidDocument()||l.convertToNoDocument(Xe.min())})),r}keys(){return this.mutations.reduce(((e,n)=>e.add(n.key)),pt())}isEqual(e){return this.batchId===e.batchId&&Hl(this.mutations,e.mutations,((n,r)=>Kw(n,r)))&&Hl(this.baseMutations,e.baseMutations,((n,r)=>Kw(n,r)))}}class d0{constructor(e,n,r,i){this.batch=e,this.commitVersion=n,this.mutationResults=r,this.docVersions=i}static from(e,n,r){It(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let i=(function(){return JM})();const o=e.mutations;for(let l=0;l<o.length;l++)i=i.insert(o[l].key,r[l].version);return new d0(e,n,r,i)}}class hO{constructor(e,n){this.largestBatchId=e,this.mutation=n}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class fO{constructor(e,n){this.count=e,this.unchangedNames=n}}var bn,vt;function mO(t){switch(t){case je.OK:return Ke(64938);case je.CANCELLED:case je.UNKNOWN:case je.DEADLINE_EXCEEDED:case je.RESOURCE_EXHAUSTED:case je.INTERNAL:case je.UNAVAILABLE:case je.UNAUTHENTICATED:return!1;case je.INVALID_ARGUMENT:case je.NOT_FOUND:case je.ALREADY_EXISTS:case je.PERMISSION_DENIED:case je.FAILED_PRECONDITION:case je.ABORTED:case je.OUT_OF_RANGE:case je.UNIMPLEMENTED:case je.DATA_LOSS:return!0;default:return Ke(15467,{code:t})}}function vE(t){if(t===void 0)return wi("GRPC error has no .code"),je.UNKNOWN;switch(t){case bn.OK:return je.OK;case bn.CANCELLED:return je.CANCELLED;case bn.UNKNOWN:return je.UNKNOWN;case bn.DEADLINE_EXCEEDED:return je.DEADLINE_EXCEEDED;case bn.RESOURCE_EXHAUSTED:return je.RESOURCE_EXHAUSTED;case bn.INTERNAL:return je.INTERNAL;case bn.UNAVAILABLE:return je.UNAVAILABLE;case bn.UNAUTHENTICATED:return je.UNAUTHENTICATED;case bn.INVALID_ARGUMENT:return je.INVALID_ARGUMENT;case bn.NOT_FOUND:return je.NOT_FOUND;case bn.ALREADY_EXISTS:return je.ALREADY_EXISTS;case bn.PERMISSION_DENIED:return je.PERMISSION_DENIED;case bn.FAILED_PRECONDITION:return je.FAILED_PRECONDITION;case bn.ABORTED:return je.ABORTED;case bn.OUT_OF_RANGE:return je.OUT_OF_RANGE;case bn.UNIMPLEMENTED:return je.UNIMPLEMENTED;case bn.DATA_LOSS:return je.DATA_LOSS;default:return Ke(39323,{code:t})}}(vt=bn||(bn={}))[vt.OK=0]="OK",vt[vt.CANCELLED=1]="CANCELLED",vt[vt.UNKNOWN=2]="UNKNOWN",vt[vt.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",vt[vt.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",vt[vt.NOT_FOUND=5]="NOT_FOUND",vt[vt.ALREADY_EXISTS=6]="ALREADY_EXISTS",vt[vt.PERMISSION_DENIED=7]="PERMISSION_DENIED",vt[vt.UNAUTHENTICATED=16]="UNAUTHENTICATED",vt[vt.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",vt[vt.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",vt[vt.ABORTED=10]="ABORTED",vt[vt.OUT_OF_RANGE=11]="OUT_OF_RANGE",vt[vt.UNIMPLEMENTED=12]="UNIMPLEMENTED",vt[vt.INTERNAL=13]="INTERNAL",vt[vt.UNAVAILABLE=14]="UNAVAILABLE",vt[vt.DATA_LOSS=15]="DATA_LOSS";function pO(){return new TextEncoder}const gO=new xa([4294967295,4294967295],0);function Zw(t){const e=pO().encode(t),n=new OC;return n.update(e),new Uint8Array(n.digest())}function Jw(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),o=e.getUint32(12,!0);return[new xa([n,r],0),new xa([i,o],0)]}class h0{constructor(e,n,r){if(this.bitmap=e,this.padding=n,this.hashCount=r,n<0||n>=8)throw new Su(`Invalid padding: ${n}`);if(r<0)throw new Su(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Su(`Invalid hash count: ${r}`);if(e.length===0&&n!==0)throw new Su(`Invalid padding when bitmap length is 0: ${n}`);this.ge=8*e.length-n,this.pe=xa.fromNumber(this.ge)}ye(e,n,r){let i=e.add(n.multiply(xa.fromNumber(r)));return i.compare(gO)===1&&(i=new xa([i.getBits(0),i.getBits(1)],0)),i.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const n=Zw(e),[r,i]=Jw(n);for(let o=0;o<this.hashCount;o++){const l=this.ye(r,i,o);if(!this.we(l))return!1}return!0}static create(e,n,r){const i=e%8==0?0:8-e%8,o=new Uint8Array(Math.ceil(e/8)),l=new h0(o,i,n);return r.forEach((d=>l.insert(d))),l}insert(e){if(this.ge===0)return;const n=Zw(e),[r,i]=Jw(n);for(let o=0;o<this.hashCount;o++){const l=this.ye(r,i,o);this.Se(l)}}Se(e){const n=Math.floor(e/8),r=e%8;this.bitmap[n]|=1<<r}}class Su extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class em{constructor(e,n,r,i,o){this.snapshotVersion=e,this.targetChanges=n,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=o}static createSynthesizedRemoteEventForCurrentChange(e,n,r){const i=new Map;return i.set(e,rd.createSynthesizedTargetChangeForCurrentChange(e,n,r)),new em(Xe.min(),i,new en(mt),Si(),pt())}}class rd{constructor(e,n,r,i,o){this.resumeToken=e,this.current=n,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=o}static createSynthesizedTargetChangeForCurrentChange(e,n,r){return new rd(r,n,pt(),pt(),pt())}}class tf{constructor(e,n,r,i){this.be=e,this.removedTargetIds=n,this.key=r,this.De=i}}class xE{constructor(e,n){this.targetId=e,this.Ce=n}}class wE{constructor(e,n,r=qn.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=n,this.resumeToken=r,this.cause=i}}class e1{constructor(){this.ve=0,this.Fe=t1(),this.Me=qn.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=pt(),n=pt(),r=pt();return this.Fe.forEach(((i,o)=>{switch(o){case 0:e=e.add(i);break;case 2:n=n.add(i);break;case 1:r=r.add(i);break;default:Ke(38017,{changeType:o})}})),new rd(this.Me,this.xe,e,n,r)}qe(){this.Oe=!1,this.Fe=t1()}Qe(e,n){this.Oe=!0,this.Fe=this.Fe.insert(e,n)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,It(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class yO{constructor(e){this.Ge=e,this.ze=new Map,this.je=Si(),this.Je=Fh(),this.He=Fh(),this.Ye=new en(mt)}Ze(e){for(const n of e.be)e.De&&e.De.isFoundDocument()?this.Xe(n,e.De):this.et(n,e.key,e.De);for(const n of e.removedTargetIds)this.et(n,e.key,e.De)}tt(e){this.forEachTarget(e,(n=>{const r=this.nt(n);switch(e.state){case 0:this.rt(n)&&r.Le(e.resumeToken);break;case 1:r.Ke(),r.Ne||r.qe(),r.Le(e.resumeToken);break;case 2:r.Ke(),r.Ne||this.removeTarget(n);break;case 3:this.rt(n)&&(r.We(),r.Le(e.resumeToken));break;case 4:this.rt(n)&&(this.it(n),r.Le(e.resumeToken));break;default:Ke(56790,{state:e.state})}}))}forEachTarget(e,n){e.targetIds.length>0?e.targetIds.forEach(n):this.ze.forEach(((r,i)=>{this.rt(i)&&n(i)}))}st(e){const n=e.targetId,r=e.Ce.count,i=this.ot(n);if(i){const o=i.target;if(yy(o))if(r===0){const l=new Ge(o.path);this.et(n,l,Jn.newNoDocument(l,Xe.min()))}else It(r===1,20013,{expectedCount:r});else{const l=this._t(n);if(l!==r){const d=this.ut(e),h=d?this.ct(d,e,l):1;if(h!==0){this.it(n);const m=h===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(n,m)}}}}}ut(e){const n=e.Ce.unchangedNames;if(!n||!n.bits)return null;const{bits:{bitmap:r="",padding:i=0},hashCount:o=0}=n;let l,d;try{l=Ea(r).toUint8Array()}catch(h){if(h instanceof GC)return ql("Decoding the base64 bloom filter in existence filter failed ("+h.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw h}try{d=new h0(l,i,o)}catch(h){return ql(h instanceof Su?"BloomFilter error: ":"Applying bloom filter failed: ",h),null}return d.ge===0?null:d}ct(e,n,r){return n.Ce.count===r-this.Pt(e,n.targetId)?0:2}Pt(e,n){const r=this.Ge.getRemoteKeysForTarget(n);let i=0;return r.forEach((o=>{const l=this.Ge.ht(),d=`projects/${l.projectId}/databases/${l.database}/documents/${o.path.canonicalString()}`;e.mightContain(d)||(this.et(n,o,null),i++)})),i}Tt(e){const n=new Map;this.ze.forEach(((o,l)=>{const d=this.ot(l);if(d){if(o.current&&yy(d.target)){const h=new Ge(d.target.path);this.It(h).has(l)||this.Et(l,h)||this.et(l,h,Jn.newNoDocument(h,e))}o.Be&&(n.set(l,o.ke()),o.qe())}}));let r=pt();this.He.forEach(((o,l)=>{let d=!0;l.forEachWhile((h=>{const m=this.ot(h);return!m||m.purpose==="TargetPurposeLimboResolution"||(d=!1,!1)})),d&&(r=r.add(o))})),this.je.forEach(((o,l)=>l.setReadTime(e)));const i=new em(e,n,this.Ye,this.je,r);return this.je=Si(),this.Je=Fh(),this.He=Fh(),this.Ye=new en(mt),i}Xe(e,n){if(!this.rt(e))return;const r=this.Et(e,n.key)?2:0;this.nt(e).Qe(n.key,r),this.je=this.je.insert(n.key,n),this.Je=this.Je.insert(n.key,this.It(n.key).add(e)),this.He=this.He.insert(n.key,this.dt(n.key).add(e))}et(e,n,r){if(!this.rt(e))return;const i=this.nt(e);this.Et(e,n)?i.Qe(n,1):i.$e(n),this.He=this.He.insert(n,this.dt(n).delete(e)),this.He=this.He.insert(n,this.dt(n).add(e)),r&&(this.je=this.je.insert(n,r))}removeTarget(e){this.ze.delete(e)}_t(e){const n=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+n.addedDocuments.size-n.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let n=this.ze.get(e);return n||(n=new e1,this.ze.set(e,n)),n}dt(e){let n=this.He.get(e);return n||(n=new jn(mt),this.He=this.He.insert(e,n)),n}It(e){let n=this.Je.get(e);return n||(n=new jn(mt),this.Je=this.Je.insert(e,n)),n}rt(e){const n=this.ot(e)!==null;return n||Ue("WatchChangeAggregator","Detected inactive target",e),n}ot(e){const n=this.ze.get(e);return n&&n.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new e1),this.Ge.getRemoteKeysForTarget(e).forEach((n=>{this.et(e,n,null)}))}Et(e,n){return this.Ge.getRemoteKeysForTarget(e).has(n)}}function Fh(){return new en(Ge.comparator)}function t1(){return new en(Ge.comparator)}const _O={asc:"ASCENDING",desc:"DESCENDING"},bO={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},vO={and:"AND",or:"OR"};class xO{constructor(e,n){this.databaseId=e,this.useProto3Json=n}}function vy(t,e){return t.useProto3Json||Qf(e)?e:{value:e}}function wf(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function SE(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function wO(t,e){return wf(t,e.toTimestamp())}function $s(t){return It(!!t,49232),Xe.fromTimestamp((function(n){const r=Ca(n);return new Qt(r.seconds,r.nanos)})(t))}function f0(t,e){return xy(t,e).canonicalString()}function xy(t,e){const n=(function(i){return new Vt(["projects",i.projectId,"databases",i.database])})(t).child("documents");return e===void 0?n:n.child(e)}function CE(t){const e=Vt.fromString(t);return It(RE(e),10190,{key:e.toString()}),e}function wy(t,e){return f0(t.databaseId,e.path)}function Pg(t,e){const n=CE(e);if(n.get(1)!==t.databaseId.projectId)throw new Be(je.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new Be(je.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new Ge(TE(n))}function EE(t,e){return f0(t.databaseId,e)}function SO(t){const e=CE(t);return e.length===4?Vt.emptyPath():TE(e)}function Sy(t){return new Vt(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function TE(t){return It(t.length>4&&t.get(4)==="documents",29091,{key:t.toString()}),t.popFirst(5)}function n1(t,e,n){return{name:wy(t,e),fields:n.value.mapValue.fields}}function CO(t,e){let n;if("targetChange"in e){e.targetChange;const r=(function(m){return m==="NO_CHANGE"?0:m==="ADD"?1:m==="REMOVE"?2:m==="CURRENT"?3:m==="RESET"?4:Ke(39313,{state:m})})(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],o=(function(m,p){return m.useProto3Json?(It(p===void 0||typeof p=="string",58123),qn.fromBase64String(p||"")):(It(p===void 0||p instanceof Buffer||p instanceof Uint8Array,16193),qn.fromUint8Array(p||new Uint8Array))})(t,e.targetChange.resumeToken),l=e.targetChange.cause,d=l&&(function(m){const p=m.code===void 0?je.UNKNOWN:vE(m.code);return new Be(p,m.message||"")})(l);n=new wE(r,i,o,d||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const i=Pg(t,r.document.name),o=$s(r.document.updateTime),l=r.document.createTime?$s(r.document.createTime):Xe.min(),d=new mr({mapValue:{fields:r.document.fields}}),h=Jn.newFoundDocument(i,o,l,d),m=r.targetIds||[],p=r.removedTargetIds||[];n=new tf(m,p,h.key,h)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const i=Pg(t,r.document),o=r.readTime?$s(r.readTime):Xe.min(),l=Jn.newNoDocument(i,o),d=r.removedTargetIds||[];n=new tf([],d,l.key,l)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const i=Pg(t,r.document),o=r.removedTargetIds||[];n=new tf([],o,i,null)}else{if(!("filter"in e))return Ke(11601,{Rt:e});{e.filter;const r=e.filter;r.targetId;const{count:i=0,unchangedNames:o}=r,l=new fO(i,o),d=r.targetId;n=new xE(d,l)}}return n}function EO(t,e){let n;if(e instanceof nd)n={update:n1(t,e.key,e.value)};else if(e instanceof Jf)n={delete:wy(t,e.key)};else if(e instanceof za)n={update:n1(t,e.key,e.data),updateMask:OO(e.fieldMask)};else{if(!(e instanceof uO))return Ke(16599,{Vt:e.type});n={verify:wy(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map((r=>(function(o,l){const d=l.transform;if(d instanceof vf)return{fieldPath:l.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(d instanceof Wl)return{fieldPath:l.field.canonicalString(),appendMissingElements:{values:d.elements}};if(d instanceof Kl)return{fieldPath:l.field.canonicalString(),removeAllFromArray:{values:d.elements}};if(d instanceof xf)return{fieldPath:l.field.canonicalString(),increment:d.Ae};throw Ke(20930,{transform:l.transform})})(0,r)))),e.precondition.isNone||(n.currentDocument=(function(i,o){return o.updateTime!==void 0?{updateTime:wO(i,o.updateTime)}:o.exists!==void 0?{exists:o.exists}:Ke(27497)})(t,e.precondition)),n}function TO(t,e){return t&&t.length>0?(It(e!==void 0,14353),t.map((n=>(function(i,o){let l=i.updateTime?$s(i.updateTime):$s(o);return l.isEqual(Xe.min())&&(l=$s(o)),new oO(l,i.transformResults||[])})(n,e)))):[]}function AO(t,e){return{documents:[EE(t,e.path)]}}function jO(t,e){const n={structuredQuery:{}},r=e.path;let i;e.collectionGroup!==null?(i=r,n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=EE(t,i);const o=(function(m){if(m.length!==0)return jE(fs.create(m,"and"))})(e.filters);o&&(n.structuredQuery.where=o);const l=(function(m){if(m.length!==0)return m.map((p=>(function(v){return{field:Ol(v.field),direction:kO(v.dir)}})(p)))})(e.orderBy);l&&(n.structuredQuery.orderBy=l);const d=vy(t,e.limit);return d!==null&&(n.structuredQuery.limit=d),e.startAt&&(n.structuredQuery.startAt=(function(m){return{before:m.inclusive,values:m.position}})(e.startAt)),e.endAt&&(n.structuredQuery.endAt=(function(m){return{before:!m.inclusive,values:m.position}})(e.endAt)),{ft:n,parent:i}}function RO(t){let e=SO(t.parent);const n=t.structuredQuery,r=n.from?n.from.length:0;let i=null;if(r>0){It(r===1,65062);const p=n.from[0];p.allDescendants?i=p.collectionId:e=e.child(p.collectionId)}let o=[];n.where&&(o=(function(g){const v=AE(g);return v instanceof fs&&nE(v)?v.getFilters():[v]})(n.where));let l=[];n.orderBy&&(l=(function(g){return g.map((v=>(function(C){return new bf(Nl(C.field),(function(S){switch(S){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(C.direction))})(v)))})(n.orderBy));let d=null;n.limit&&(d=(function(g){let v;return v=typeof g=="object"?g.value:g,Qf(v)?null:v})(n.limit));let h=null;n.startAt&&(h=(function(g){const v=!!g.before,b=g.values||[];return new _f(b,v)})(n.startAt));let m=null;return n.endAt&&(m=(function(g){const v=!g.before,b=g.values||[];return new _f(b,v)})(n.endAt)),WM(e,i,l,o,d,"F",h,m)}function IO(t,e){const n=(function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Ke(28987,{purpose:i})}})(e.purpose);return n==null?null:{"goog-listen-tags":n}}function AE(t){return t.unaryFilter!==void 0?(function(n){switch(n.unaryFilter.op){case"IS_NAN":const r=Nl(n.unaryFilter.field);return vn.create(r,"==",{doubleValue:NaN});case"IS_NULL":const i=Nl(n.unaryFilter.field);return vn.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const o=Nl(n.unaryFilter.field);return vn.create(o,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const l=Nl(n.unaryFilter.field);return vn.create(l,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return Ke(61313);default:return Ke(60726)}})(t):t.fieldFilter!==void 0?(function(n){return vn.create(Nl(n.fieldFilter.field),(function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return Ke(58110);default:return Ke(50506)}})(n.fieldFilter.op),n.fieldFilter.value)})(t):t.compositeFilter!==void 0?(function(n){return fs.create(n.compositeFilter.filters.map((r=>AE(r))),(function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return Ke(1026)}})(n.compositeFilter.op))})(t):Ke(30097,{filter:t})}function kO(t){return _O[t]}function DO(t){return bO[t]}function MO(t){return vO[t]}function Ol(t){return{fieldPath:t.canonicalString()}}function Nl(t){return Vn.fromServerFormat(t.fieldPath)}function jE(t){return t instanceof vn?(function(n){if(n.op==="=="){if($w(n.value))return{unaryFilter:{field:Ol(n.field),op:"IS_NAN"}};if(Vw(n.value))return{unaryFilter:{field:Ol(n.field),op:"IS_NULL"}}}else if(n.op==="!="){if($w(n.value))return{unaryFilter:{field:Ol(n.field),op:"IS_NOT_NAN"}};if(Vw(n.value))return{unaryFilter:{field:Ol(n.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Ol(n.field),op:DO(n.op),value:n.value}}})(t):t instanceof fs?(function(n){const r=n.getFilters().map((i=>jE(i)));return r.length===1?r[0]:{compositeFilter:{op:MO(n.op),filters:r}}})(t):Ke(54877,{filter:t})}function OO(t){const e=[];return t.fields.forEach((n=>e.push(n.canonicalString()))),{fieldPaths:e}}function RE(t){return t.length>=4&&t.get(0)==="projects"&&t.get(2)==="databases"}class ha{constructor(e,n,r,i,o=Xe.min(),l=Xe.min(),d=qn.EMPTY_BYTE_STRING,h=null){this.target=e,this.targetId=n,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=o,this.lastLimboFreeSnapshotVersion=l,this.resumeToken=d,this.expectedCount=h}withSequenceNumber(e){return new ha(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,n){return new ha(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new ha(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new ha(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class NO{constructor(e){this.yt=e}}function PO(t){const e=RO({parent:t.parent,structuredQuery:t.structuredQuery});return t.limitType==="LAST"?by(e,e.limit,"L"):e}class zO{constructor(){this.Cn=new BO}addToCollectionParentIndex(e,n){return this.Cn.add(n),ke.resolve()}getCollectionParents(e,n){return ke.resolve(this.Cn.getEntries(n))}addFieldIndex(e,n){return ke.resolve()}deleteFieldIndex(e,n){return ke.resolve()}deleteAllFieldIndexes(e){return ke.resolve()}createTargetIndexes(e,n){return ke.resolve()}getDocumentsMatchingTarget(e,n){return ke.resolve(null)}getIndexType(e,n){return ke.resolve(0)}getFieldIndexes(e,n){return ke.resolve([])}getNextCollectionGroupToUpdate(e){return ke.resolve(null)}getMinOffset(e,n){return ke.resolve(Sa.min())}getMinOffsetFromCollectionGroup(e,n){return ke.resolve(Sa.min())}updateCollectionGroup(e,n,r){return ke.resolve()}updateIndexEntries(e,n){return ke.resolve()}}class BO{constructor(){this.index={}}add(e){const n=e.lastSegment(),r=e.popLast(),i=this.index[n]||new jn(Vt.comparator),o=!i.has(r);return this.index[n]=i.add(r),o}has(e){const n=e.lastSegment(),r=e.popLast(),i=this.index[n];return i&&i.has(r)}getEntries(e){return(this.index[e]||new jn(Vt.comparator)).toArray()}}const r1={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},IE=41943040;class fr{static withCacheSize(e){return new fr(e,fr.DEFAULT_COLLECTION_PERCENTILE,fr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,n,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=n,this.maximumSequenceNumbersToCollect=r}}fr.DEFAULT_COLLECTION_PERCENTILE=10,fr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,fr.DEFAULT=new fr(IE,fr.DEFAULT_COLLECTION_PERCENTILE,fr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),fr.DISABLED=new fr(-1,0,0);class Yl{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new Yl(0)}static cr(){return new Yl(-1)}}const s1="LruGarbageCollector",LO=1048576;function i1([t,e],[n,r]){const i=mt(t,n);return i===0?mt(e,r):i}class UO{constructor(e){this.Ir=e,this.buffer=new jn(i1),this.Er=0}dr(){return++this.Er}Ar(e){const n=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(n);else{const r=this.buffer.last();i1(n,r)<0&&(this.buffer=this.buffer.delete(r).add(n))}}get maxValue(){return this.buffer.last()[0]}}class FO{constructor(e,n,r){this.garbageCollector=e,this.asyncQueue=n,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){Ue(s1,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(n){uc(n)?Ue(s1,"Ignoring IndexedDB error during garbage collection: ",n):await cc(n)}await this.Vr(3e5)}))}}class VO{constructor(e,n){this.mr=e,this.params=n}calculateTargetCount(e,n){return this.mr.gr(e).next((r=>Math.floor(n/100*r)))}nthSequenceNumber(e,n){if(n===0)return ke.resolve(Gf.ce);const r=new UO(n);return this.mr.forEachTarget(e,(i=>r.Ar(i.sequenceNumber))).next((()=>this.mr.pr(e,(i=>r.Ar(i))))).next((()=>r.maxValue))}removeTargets(e,n,r){return this.mr.removeTargets(e,n,r)}removeOrphanedDocuments(e,n){return this.mr.removeOrphanedDocuments(e,n)}collect(e,n){return this.params.cacheSizeCollectionThreshold===-1?(Ue("LruGarbageCollector","Garbage collection skipped; disabled"),ke.resolve(r1)):this.getCacheSize(e).next((r=>r<this.params.cacheSizeCollectionThreshold?(Ue("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),r1):this.yr(e,n)))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,n){let r,i,o,l,d,h,m;const p=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((g=>(g>this.params.maximumSequenceNumbersToCollect?(Ue("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${g}`),i=this.params.maximumSequenceNumbersToCollect):i=g,l=Date.now(),this.nthSequenceNumber(e,i)))).next((g=>(r=g,d=Date.now(),this.removeTargets(e,r,n)))).next((g=>(o=g,h=Date.now(),this.removeOrphanedDocuments(e,r)))).next((g=>(m=Date.now(),Dl()<=ft.DEBUG&&Ue("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${l-p}ms
	Determined least recently used ${i} in `+(d-l)+`ms
	Removed ${o} targets in `+(h-d)+`ms
	Removed ${g} documents in `+(m-h)+`ms
Total Duration: ${m-p}ms`),ke.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:o,documentsRemoved:g}))))}}function $O(t,e){return new VO(t,e)}class qO{constructor(){this.changes=new No((e=>e.toString()),((e,n)=>e.isEqual(n))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,n){this.assertNotApplied(),this.changes.set(e,Jn.newInvalidDocument(e).setReadTime(n))}getEntry(e,n){this.assertNotApplied();const r=this.changes.get(n);return r!==void 0?ke.resolve(r):this.getFromCache(e,n)}getEntries(e,n){return this.getAllFromCache(e,n)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class HO{constructor(e,n){this.overlayedDocument=e,this.mutatedFields=n}}class GO{constructor(e,n,r,i){this.remoteDocumentCache=e,this.mutationQueue=n,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,n){let r=null;return this.documentOverlayCache.getOverlay(e,n).next((i=>(r=i,this.remoteDocumentCache.getEntry(e,n)))).next((i=>(r!==null&&Iu(r.mutation,i,jr.empty(),Qt.now()),i)))}getDocuments(e,n){return this.remoteDocumentCache.getEntries(e,n).next((r=>this.getLocalViewOfDocuments(e,r,pt()).next((()=>r))))}getLocalViewOfDocuments(e,n,r=pt()){const i=xo();return this.populateOverlays(e,i,n).next((()=>this.computeViews(e,n,i,r).next((o=>{let l=wu();return o.forEach(((d,h)=>{l=l.insert(d,h.overlayedDocument)})),l}))))}getOverlayedDocuments(e,n){const r=xo();return this.populateOverlays(e,r,n).next((()=>this.computeViews(e,n,r,pt())))}populateOverlays(e,n,r){const i=[];return r.forEach((o=>{n.has(o)||i.push(o)})),this.documentOverlayCache.getOverlays(e,i).next((o=>{o.forEach(((l,d)=>{n.set(l,d)}))}))}computeViews(e,n,r,i){let o=Si();const l=Ru(),d=(function(){return Ru()})();return n.forEach(((h,m)=>{const p=r.get(m.key);i.has(m.key)&&(p===void 0||p.mutation instanceof za)?o=o.insert(m.key,m):p!==void 0?(l.set(m.key,p.mutation.getFieldMask()),Iu(p.mutation,m,p.mutation.getFieldMask(),Qt.now())):l.set(m.key,jr.empty())})),this.recalculateAndSaveOverlays(e,o).next((h=>(h.forEach(((m,p)=>l.set(m,p))),n.forEach(((m,p)=>d.set(m,new HO(p,l.get(m)??null)))),d)))}recalculateAndSaveOverlays(e,n){const r=Ru();let i=new en(((l,d)=>l-d)),o=pt();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,n).next((l=>{for(const d of l)d.keys().forEach((h=>{const m=n.get(h);if(m===null)return;let p=r.get(h)||jr.empty();p=d.applyToLocalView(m,p),r.set(h,p);const g=(i.get(d.batchId)||pt()).add(h);i=i.insert(d.batchId,g)}))})).next((()=>{const l=[],d=i.getReverseIterator();for(;d.hasNext();){const h=d.getNext(),m=h.key,p=h.value,g=dE();p.forEach((v=>{if(!o.has(v)){const b=_E(n.get(v),r.get(v));b!==null&&g.set(v,b),o=o.add(v)}})),l.push(this.documentOverlayCache.saveOverlays(e,m,g))}return ke.waitFor(l)})).next((()=>r))}recalculateAndSaveOverlaysForDocumentKeys(e,n){return this.remoteDocumentCache.getEntries(e,n).next((r=>this.recalculateAndSaveOverlays(e,r)))}getDocumentsMatchingQuery(e,n,r,i){return(function(l){return Ge.isDocumentKey(l.path)&&l.collectionGroup===null&&l.filters.length===0})(n)?this.getDocumentsMatchingDocumentQuery(e,n.path):aE(n)?this.getDocumentsMatchingCollectionGroupQuery(e,n,r,i):this.getDocumentsMatchingCollectionQuery(e,n,r,i)}getNextDocuments(e,n,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,n,r,i).next((o=>{const l=i-o.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,n,r.largestBatchId,i-o.size):ke.resolve(xo());let d=Pu,h=o;return l.next((m=>ke.forEach(m,((p,g)=>(d<g.largestBatchId&&(d=g.largestBatchId),o.get(p)?ke.resolve():this.remoteDocumentCache.getEntry(e,p).next((v=>{h=h.insert(p,v)}))))).next((()=>this.populateOverlays(e,m,o))).next((()=>this.computeViews(e,h,m,pt()))).next((p=>({batchId:d,changes:uE(p)})))))}))}getDocumentsMatchingDocumentQuery(e,n){return this.getDocument(e,new Ge(n)).next((r=>{let i=wu();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i}))}getDocumentsMatchingCollectionGroupQuery(e,n,r,i){const o=n.collectionGroup;let l=wu();return this.indexManager.getCollectionParents(e,o).next((d=>ke.forEach(d,(h=>{const m=(function(g,v){return new td(v,null,g.explicitOrderBy.slice(),g.filters.slice(),g.limit,g.limitType,g.startAt,g.endAt)})(n,h.child(o));return this.getDocumentsMatchingCollectionQuery(e,m,r,i).next((p=>{p.forEach(((g,v)=>{l=l.insert(g,v)}))}))})).next((()=>l))))}getDocumentsMatchingCollectionQuery(e,n,r,i){let o;return this.documentOverlayCache.getOverlaysForCollection(e,n.path,r.largestBatchId).next((l=>(o=l,this.remoteDocumentCache.getDocumentsMatchingQuery(e,n,r,o,i)))).next((l=>{o.forEach(((h,m)=>{const p=m.getKey();l.get(p)===null&&(l=l.insert(p,Jn.newInvalidDocument(p)))}));let d=wu();return l.forEach(((h,m)=>{const p=o.get(h);p!==void 0&&Iu(p.mutation,m,jr.empty(),Qt.now()),Yf(n,m)&&(d=d.insert(h,m))})),d}))}}class QO{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,n){return ke.resolve(this.Lr.get(n))}saveBundleMetadata(e,n){return this.Lr.set(n.id,(function(i){return{id:i.id,version:i.version,createTime:$s(i.createTime)}})(n)),ke.resolve()}getNamedQuery(e,n){return ke.resolve(this.kr.get(n))}saveNamedQuery(e,n){return this.kr.set(n.name,(function(i){return{name:i.name,query:PO(i.bundledQuery),readTime:$s(i.readTime)}})(n)),ke.resolve()}}class WO{constructor(){this.overlays=new en(Ge.comparator),this.qr=new Map}getOverlay(e,n){return ke.resolve(this.overlays.get(n))}getOverlays(e,n){const r=xo();return ke.forEach(n,(i=>this.getOverlay(e,i).next((o=>{o!==null&&r.set(i,o)})))).next((()=>r))}saveOverlays(e,n,r){return r.forEach(((i,o)=>{this.St(e,n,o)})),ke.resolve()}removeOverlaysForBatchId(e,n,r){const i=this.qr.get(r);return i!==void 0&&(i.forEach((o=>this.overlays=this.overlays.remove(o))),this.qr.delete(r)),ke.resolve()}getOverlaysForCollection(e,n,r){const i=xo(),o=n.length+1,l=new Ge(n.child("")),d=this.overlays.getIteratorFrom(l);for(;d.hasNext();){const h=d.getNext().value,m=h.getKey();if(!n.isPrefixOf(m.path))break;m.path.length===o&&h.largestBatchId>r&&i.set(h.getKey(),h)}return ke.resolve(i)}getOverlaysForCollectionGroup(e,n,r,i){let o=new en(((m,p)=>m-p));const l=this.overlays.getIterator();for(;l.hasNext();){const m=l.getNext().value;if(m.getKey().getCollectionGroup()===n&&m.largestBatchId>r){let p=o.get(m.largestBatchId);p===null&&(p=xo(),o=o.insert(m.largestBatchId,p)),p.set(m.getKey(),m)}}const d=xo(),h=o.getIterator();for(;h.hasNext()&&(h.getNext().value.forEach(((m,p)=>d.set(m,p))),!(d.size()>=i)););return ke.resolve(d)}St(e,n,r){const i=this.overlays.get(r.key);if(i!==null){const l=this.qr.get(i.largestBatchId).delete(r.key);this.qr.set(i.largestBatchId,l)}this.overlays=this.overlays.insert(r.key,new hO(n,r));let o=this.qr.get(n);o===void 0&&(o=pt(),this.qr.set(n,o)),this.qr.set(n,o.add(r.key))}}class KO{constructor(){this.sessionToken=qn.EMPTY_BYTE_STRING}getSessionToken(e){return ke.resolve(this.sessionToken)}setSessionToken(e,n){return this.sessionToken=n,ke.resolve()}}class m0{constructor(){this.Qr=new jn(Mn.$r),this.Ur=new jn(Mn.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,n){const r=new Mn(e,n);this.Qr=this.Qr.add(r),this.Ur=this.Ur.add(r)}Wr(e,n){e.forEach((r=>this.addReference(r,n)))}removeReference(e,n){this.Gr(new Mn(e,n))}zr(e,n){e.forEach((r=>this.removeReference(r,n)))}jr(e){const n=new Ge(new Vt([])),r=new Mn(n,e),i=new Mn(n,e+1),o=[];return this.Ur.forEachInRange([r,i],(l=>{this.Gr(l),o.push(l.key)})),o}Jr(){this.Qr.forEach((e=>this.Gr(e)))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const n=new Ge(new Vt([])),r=new Mn(n,e),i=new Mn(n,e+1);let o=pt();return this.Ur.forEachInRange([r,i],(l=>{o=o.add(l.key)})),o}containsKey(e){const n=new Mn(e,0),r=this.Qr.firstAfterOrEqual(n);return r!==null&&e.isEqual(r.key)}}class Mn{constructor(e,n){this.key=e,this.Yr=n}static $r(e,n){return Ge.comparator(e.key,n.key)||mt(e.Yr,n.Yr)}static Kr(e,n){return mt(e.Yr,n.Yr)||Ge.comparator(e.key,n.key)}}class YO{constructor(e,n){this.indexManager=e,this.referenceDelegate=n,this.mutationQueue=[],this.tr=1,this.Zr=new jn(Mn.$r)}checkEmpty(e){return ke.resolve(this.mutationQueue.length===0)}addMutationBatch(e,n,r,i){const o=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const l=new dO(o,n,r,i);this.mutationQueue.push(l);for(const d of i)this.Zr=this.Zr.add(new Mn(d.key,o)),this.indexManager.addToCollectionParentIndex(e,d.key.path.popLast());return ke.resolve(l)}lookupMutationBatch(e,n){return ke.resolve(this.Xr(n))}getNextMutationBatchAfterBatchId(e,n){const r=n+1,i=this.ei(r),o=i<0?0:i;return ke.resolve(this.mutationQueue.length>o?this.mutationQueue[o]:null)}getHighestUnacknowledgedBatchId(){return ke.resolve(this.mutationQueue.length===0?s0:this.tr-1)}getAllMutationBatches(e){return ke.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,n){const r=new Mn(n,0),i=new Mn(n,Number.POSITIVE_INFINITY),o=[];return this.Zr.forEachInRange([r,i],(l=>{const d=this.Xr(l.Yr);o.push(d)})),ke.resolve(o)}getAllMutationBatchesAffectingDocumentKeys(e,n){let r=new jn(mt);return n.forEach((i=>{const o=new Mn(i,0),l=new Mn(i,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([o,l],(d=>{r=r.add(d.Yr)}))})),ke.resolve(this.ti(r))}getAllMutationBatchesAffectingQuery(e,n){const r=n.path,i=r.length+1;let o=r;Ge.isDocumentKey(o)||(o=o.child(""));const l=new Mn(new Ge(o),0);let d=new jn(mt);return this.Zr.forEachWhile((h=>{const m=h.key.path;return!!r.isPrefixOf(m)&&(m.length===i&&(d=d.add(h.Yr)),!0)}),l),ke.resolve(this.ti(d))}ti(e){const n=[];return e.forEach((r=>{const i=this.Xr(r);i!==null&&n.push(i)})),n}removeMutationBatch(e,n){It(this.ni(n.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Zr;return ke.forEach(n.mutations,(i=>{const o=new Mn(i.key,n.batchId);return r=r.delete(o),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)})).next((()=>{this.Zr=r}))}ir(e){}containsKey(e,n){const r=new Mn(n,0),i=this.Zr.firstAfterOrEqual(r);return ke.resolve(n.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,ke.resolve()}ni(e,n){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const n=this.ei(e);return n<0||n>=this.mutationQueue.length?null:this.mutationQueue[n]}}class XO{constructor(e){this.ri=e,this.docs=(function(){return new en(Ge.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,n){const r=n.key,i=this.docs.get(r),o=i?i.size:0,l=this.ri(n);return this.docs=this.docs.insert(r,{document:n.mutableCopy(),size:l}),this.size+=l-o,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const n=this.docs.get(e);n&&(this.docs=this.docs.remove(e),this.size-=n.size)}getEntry(e,n){const r=this.docs.get(n);return ke.resolve(r?r.document.mutableCopy():Jn.newInvalidDocument(n))}getEntries(e,n){let r=Si();return n.forEach((i=>{const o=this.docs.get(i);r=r.insert(i,o?o.document.mutableCopy():Jn.newInvalidDocument(i))})),ke.resolve(r)}getDocumentsMatchingQuery(e,n,r,i){let o=Si();const l=n.path,d=new Ge(l.child("__id-9223372036854775808__")),h=this.docs.getIteratorFrom(d);for(;h.hasNext();){const{key:m,value:{document:p}}=h.getNext();if(!l.isPrefixOf(m.path))break;m.path.length>l.length+1||TM(EM(p),r)<=0||(i.has(p.key)||Yf(n,p))&&(o=o.insert(p.key,p.mutableCopy()))}return ke.resolve(o)}getAllFromCollectionGroup(e,n,r,i){Ke(9500)}ii(e,n){return ke.forEach(this.docs,(r=>n(r)))}newChangeBuffer(e){return new ZO(this)}getSize(e){return ke.resolve(this.size)}}class ZO extends qO{constructor(e){super(),this.Nr=e}applyChanges(e){const n=[];return this.changes.forEach(((r,i)=>{i.isValidDocument()?n.push(this.Nr.addEntry(e,i)):this.Nr.removeEntry(r)})),ke.waitFor(n)}getFromCache(e,n){return this.Nr.getEntry(e,n)}getAllFromCache(e,n){return this.Nr.getEntries(e,n)}}class JO{constructor(e){this.persistence=e,this.si=new No((n=>o0(n)),l0),this.lastRemoteSnapshotVersion=Xe.min(),this.highestTargetId=0,this.oi=0,this._i=new m0,this.targetCount=0,this.ai=Yl.ur()}forEachTarget(e,n){return this.si.forEach(((r,i)=>n(i))),ke.resolve()}getLastRemoteSnapshotVersion(e){return ke.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return ke.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),ke.resolve(this.highestTargetId)}setTargetsMetadata(e,n,r){return r&&(this.lastRemoteSnapshotVersion=r),n>this.oi&&(this.oi=n),ke.resolve()}Pr(e){this.si.set(e.target,e);const n=e.targetId;n>this.highestTargetId&&(this.ai=new Yl(n),this.highestTargetId=n),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,n){return this.Pr(n),this.targetCount+=1,ke.resolve()}updateTargetData(e,n){return this.Pr(n),ke.resolve()}removeTargetData(e,n){return this.si.delete(n.target),this._i.jr(n.targetId),this.targetCount-=1,ke.resolve()}removeTargets(e,n,r){let i=0;const o=[];return this.si.forEach(((l,d)=>{d.sequenceNumber<=n&&r.get(d.targetId)===null&&(this.si.delete(l),o.push(this.removeMatchingKeysForTargetId(e,d.targetId)),i++)})),ke.waitFor(o).next((()=>i))}getTargetCount(e){return ke.resolve(this.targetCount)}getTargetData(e,n){const r=this.si.get(n)||null;return ke.resolve(r)}addMatchingKeys(e,n,r){return this._i.Wr(n,r),ke.resolve()}removeMatchingKeys(e,n,r){this._i.zr(n,r);const i=this.persistence.referenceDelegate,o=[];return i&&n.forEach((l=>{o.push(i.markPotentiallyOrphaned(e,l))})),ke.waitFor(o)}removeMatchingKeysForTargetId(e,n){return this._i.jr(n),ke.resolve()}getMatchingKeysForTargetId(e,n){const r=this._i.Hr(n);return ke.resolve(r)}containsKey(e,n){return ke.resolve(this._i.containsKey(n))}}class kE{constructor(e,n){this.ui={},this.overlays={},this.ci=new Gf(0),this.li=!1,this.li=!0,this.hi=new KO,this.referenceDelegate=e(this),this.Pi=new JO(this),this.indexManager=new zO,this.remoteDocumentCache=(function(i){return new XO(i)})((r=>this.referenceDelegate.Ti(r))),this.serializer=new NO(n),this.Ii=new QO(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let n=this.overlays[e.toKey()];return n||(n=new WO,this.overlays[e.toKey()]=n),n}getMutationQueue(e,n){let r=this.ui[e.toKey()];return r||(r=new YO(n,this.referenceDelegate),this.ui[e.toKey()]=r),r}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,n,r){Ue("MemoryPersistence","Starting transaction:",e);const i=new eN(this.ci.next());return this.referenceDelegate.Ei(),r(i).next((o=>this.referenceDelegate.di(i).next((()=>o)))).toPromise().then((o=>(i.raiseOnCommittedEvent(),o)))}Ai(e,n){return ke.or(Object.values(this.ui).map((r=>()=>r.containsKey(e,n))))}}class eN extends jM{constructor(e){super(),this.currentSequenceNumber=e}}class p0{constructor(e){this.persistence=e,this.Ri=new m0,this.Vi=null}static mi(e){return new p0(e)}get fi(){if(this.Vi)return this.Vi;throw Ke(60996)}addReference(e,n,r){return this.Ri.addReference(r,n),this.fi.delete(r.toString()),ke.resolve()}removeReference(e,n,r){return this.Ri.removeReference(r,n),this.fi.add(r.toString()),ke.resolve()}markPotentiallyOrphaned(e,n){return this.fi.add(n.toString()),ke.resolve()}removeTarget(e,n){this.Ri.jr(n.targetId).forEach((i=>this.fi.add(i.toString())));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,n.targetId).next((i=>{i.forEach((o=>this.fi.add(o.toString())))})).next((()=>r.removeTargetData(e,n)))}Ei(){this.Vi=new Set}di(e){const n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return ke.forEach(this.fi,(r=>{const i=Ge.fromPath(r);return this.gi(e,i).next((o=>{o||n.removeEntry(i,Xe.min())}))})).next((()=>(this.Vi=null,n.apply(e))))}updateLimboDocument(e,n){return this.gi(e,n).next((r=>{r?this.fi.delete(n.toString()):this.fi.add(n.toString())}))}Ti(e){return 0}gi(e,n){return ke.or([()=>ke.resolve(this.Ri.containsKey(n)),()=>this.persistence.getTargetCache().containsKey(e,n),()=>this.persistence.Ai(e,n)])}}class Sf{constructor(e,n){this.persistence=e,this.pi=new No((r=>kM(r.path)),((r,i)=>r.isEqual(i))),this.garbageCollector=$O(this,n)}static mi(e,n){return new Sf(e,n)}Ei(){}di(e){return ke.resolve()}forEachTarget(e,n){return this.persistence.getTargetCache().forEachTarget(e,n)}gr(e){const n=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next((r=>n.next((i=>r+i))))}wr(e){let n=0;return this.pr(e,(r=>{n++})).next((()=>n))}pr(e,n){return ke.forEach(this.pi,((r,i)=>this.br(e,r,i).next((o=>o?ke.resolve():n(i)))))}removeTargets(e,n,r){return this.persistence.getTargetCache().removeTargets(e,n,r)}removeOrphanedDocuments(e,n){let r=0;const i=this.persistence.getRemoteDocumentCache(),o=i.newChangeBuffer();return i.ii(e,(l=>this.br(e,l,n).next((d=>{d||(r++,o.removeEntry(l,Xe.min()))})))).next((()=>o.apply(e))).next((()=>r))}markPotentiallyOrphaned(e,n){return this.pi.set(n,e.currentSequenceNumber),ke.resolve()}removeTarget(e,n){const r=n.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,n,r){return this.pi.set(r,e.currentSequenceNumber),ke.resolve()}removeReference(e,n,r){return this.pi.set(r,e.currentSequenceNumber),ke.resolve()}updateLimboDocument(e,n){return this.pi.set(n,e.currentSequenceNumber),ke.resolve()}Ti(e){let n=e.key.toString().length;return e.isFoundDocument()&&(n+=Zh(e.data.value)),n}br(e,n,r){return ke.or([()=>this.persistence.Ai(e,n),()=>this.persistence.getTargetCache().containsKey(e,n),()=>{const i=this.pi.get(n);return ke.resolve(i!==void 0&&i>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class g0{constructor(e,n,r,i){this.targetId=e,this.fromCache=n,this.Es=r,this.ds=i}static As(e,n){let r=pt(),i=pt();for(const o of n.docChanges)switch(o.type){case 0:r=r.add(o.doc.key);break;case 1:i=i.add(o.doc.key)}return new g0(e,n.fromCache,r,i)}}class tN{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class nN{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(function(){return IR()?8:RM(er())>0?6:4})()}initialize(e,n){this.ps=e,this.indexManager=n,this.Rs=!0}getDocumentsMatchingQuery(e,n,r,i){const o={result:null};return this.ys(e,n).next((l=>{o.result=l})).next((()=>{if(!o.result)return this.ws(e,n,i,r).next((l=>{o.result=l}))})).next((()=>{if(o.result)return;const l=new tN;return this.Ss(e,n,l).next((d=>{if(o.result=d,this.Vs)return this.bs(e,n,l,d.size)}))})).next((()=>o.result))}bs(e,n,r,i){return r.documentReadCount<this.fs?(Dl()<=ft.DEBUG&&Ue("QueryEngine","SDK will not create cache indexes for query:",Ml(n),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),ke.resolve()):(Dl()<=ft.DEBUG&&Ue("QueryEngine","Query:",Ml(n),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.gs*i?(Dl()<=ft.DEBUG&&Ue("QueryEngine","The SDK decides to create cache indexes for query:",Ml(n),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Vs(n))):ke.resolve())}ys(e,n){if(Qw(n))return ke.resolve(null);let r=Vs(n);return this.indexManager.getIndexType(e,r).next((i=>i===0?null:(n.limit!==null&&i===1&&(n=by(n,null,"F"),r=Vs(n)),this.indexManager.getDocumentsMatchingTarget(e,r).next((o=>{const l=pt(...o);return this.ps.getDocuments(e,l).next((d=>this.indexManager.getMinOffset(e,r).next((h=>{const m=this.Ds(n,d);return this.Cs(n,m,l,h.readTime)?this.ys(e,by(n,null,"F")):this.vs(e,m,n,h)}))))})))))}ws(e,n,r,i){return Qw(n)||i.isEqual(Xe.min())?ke.resolve(null):this.ps.getDocuments(e,r).next((o=>{const l=this.Ds(n,o);return this.Cs(n,l,r,i)?ke.resolve(null):(Dl()<=ft.DEBUG&&Ue("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Ml(n)),this.vs(e,l,n,CM(i,Pu)).next((d=>d)))}))}Ds(e,n){let r=new jn(lE(e));return n.forEach(((i,o)=>{Yf(e,o)&&(r=r.add(o))})),r}Cs(e,n,r,i){if(e.limit===null)return!1;if(r.size!==n.size)return!0;const o=e.limitType==="F"?n.last():n.first();return!!o&&(o.hasPendingWrites||o.version.compareTo(i)>0)}Ss(e,n,r){return Dl()<=ft.DEBUG&&Ue("QueryEngine","Using full collection scan to execute query:",Ml(n)),this.ps.getDocumentsMatchingQuery(e,n,Sa.min(),r)}vs(e,n,r,i){return this.ps.getDocumentsMatchingQuery(e,r,i).next((o=>(n.forEach((l=>{o=o.insert(l.key,l)})),o)))}}const y0="LocalStore",rN=3e8;class sN{constructor(e,n,r,i){this.persistence=e,this.Fs=n,this.serializer=i,this.Ms=new en(mt),this.xs=new No((o=>o0(o)),l0),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(r)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new GO(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(n=>e.collect(n,this.Ms)))}}function iN(t,e,n,r){return new sN(t,e,n,r)}async function DE(t,e){const n=et(t);return await n.persistence.runTransaction("Handle user change","readonly",(r=>{let i;return n.mutationQueue.getAllMutationBatches(r).next((o=>(i=o,n.Bs(e),n.mutationQueue.getAllMutationBatches(r)))).next((o=>{const l=[],d=[];let h=pt();for(const m of i){l.push(m.batchId);for(const p of m.mutations)h=h.add(p.key)}for(const m of o){d.push(m.batchId);for(const p of m.mutations)h=h.add(p.key)}return n.localDocuments.getDocuments(r,h).next((m=>({Ls:m,removedBatchIds:l,addedBatchIds:d})))}))}))}function aN(t,e){const n=et(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(r=>{const i=e.batch.keys(),o=n.Ns.newChangeBuffer({trackRemovals:!0});return(function(d,h,m,p){const g=m.batch,v=g.keys();let b=ke.resolve();return v.forEach((C=>{b=b.next((()=>p.getEntry(h,C))).next((x=>{const S=m.docVersions.get(C);It(S!==null,48541),x.version.compareTo(S)<0&&(g.applyToRemoteDocument(x,m),x.isValidDocument()&&(x.setReadTime(m.commitVersion),p.addEntry(x)))}))})),b.next((()=>d.mutationQueue.removeMutationBatch(h,g)))})(n,r,e,o).next((()=>o.apply(r))).next((()=>n.mutationQueue.performConsistencyCheck(r))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,(function(d){let h=pt();for(let m=0;m<d.mutationResults.length;++m)d.mutationResults[m].transformResults.length>0&&(h=h.add(d.batch.mutations[m].key));return h})(e)))).next((()=>n.localDocuments.getDocuments(r,i)))}))}function ME(t){const e=et(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(n=>e.Pi.getLastRemoteSnapshotVersion(n)))}function oN(t,e){const n=et(t),r=e.snapshotVersion;let i=n.Ms;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(o=>{const l=n.Ns.newChangeBuffer({trackRemovals:!0});i=n.Ms;const d=[];e.targetChanges.forEach(((p,g)=>{const v=i.get(g);if(!v)return;d.push(n.Pi.removeMatchingKeys(o,p.removedDocuments,g).next((()=>n.Pi.addMatchingKeys(o,p.addedDocuments,g))));let b=v.withSequenceNumber(o.currentSequenceNumber);e.targetMismatches.get(g)!==null?b=b.withResumeToken(qn.EMPTY_BYTE_STRING,Xe.min()).withLastLimboFreeSnapshotVersion(Xe.min()):p.resumeToken.approximateByteSize()>0&&(b=b.withResumeToken(p.resumeToken,r)),i=i.insert(g,b),(function(x,S,E){return x.resumeToken.approximateByteSize()===0||S.snapshotVersion.toMicroseconds()-x.snapshotVersion.toMicroseconds()>=rN?!0:E.addedDocuments.size+E.modifiedDocuments.size+E.removedDocuments.size>0})(v,b,p)&&d.push(n.Pi.updateTargetData(o,b))}));let h=Si(),m=pt();if(e.documentUpdates.forEach((p=>{e.resolvedLimboDocuments.has(p)&&d.push(n.persistence.referenceDelegate.updateLimboDocument(o,p))})),d.push(lN(o,l,e.documentUpdates).next((p=>{h=p.ks,m=p.qs}))),!r.isEqual(Xe.min())){const p=n.Pi.getLastRemoteSnapshotVersion(o).next((g=>n.Pi.setTargetsMetadata(o,o.currentSequenceNumber,r)));d.push(p)}return ke.waitFor(d).next((()=>l.apply(o))).next((()=>n.localDocuments.getLocalViewOfDocuments(o,h,m))).next((()=>h))})).then((o=>(n.Ms=i,o)))}function lN(t,e,n){let r=pt(),i=pt();return n.forEach((o=>r=r.add(o))),e.getEntries(t,r).next((o=>{let l=Si();return n.forEach(((d,h)=>{const m=o.get(d);h.isFoundDocument()!==m.isFoundDocument()&&(i=i.add(d)),h.isNoDocument()&&h.version.isEqual(Xe.min())?(e.removeEntry(d,h.readTime),l=l.insert(d,h)):!m.isValidDocument()||h.version.compareTo(m.version)>0||h.version.compareTo(m.version)===0&&m.hasPendingWrites?(e.addEntry(h),l=l.insert(d,h)):Ue(y0,"Ignoring outdated watch update for ",d,". Current version:",m.version," Watch version:",h.version)})),{ks:l,qs:i}}))}function cN(t,e){const n=et(t);return n.persistence.runTransaction("Get next mutation batch","readonly",(r=>(e===void 0&&(e=s0),n.mutationQueue.getNextMutationBatchAfterBatchId(r,e))))}function uN(t,e){const n=et(t);return n.persistence.runTransaction("Allocate target","readwrite",(r=>{let i;return n.Pi.getTargetData(r,e).next((o=>o?(i=o,ke.resolve(i)):n.Pi.allocateTargetId(r).next((l=>(i=new ha(e,l,"TargetPurposeListen",r.currentSequenceNumber),n.Pi.addTargetData(r,i).next((()=>i)))))))})).then((r=>{const i=n.Ms.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(n.Ms=n.Ms.insert(r.targetId,r),n.xs.set(e,r.targetId)),r}))}async function Cy(t,e,n){const r=et(t),i=r.Ms.get(e),o=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",o,(l=>r.persistence.referenceDelegate.removeTarget(l,i)))}catch(l){if(!uc(l))throw l;Ue(y0,`Failed to update sequence numbers for target ${e}: ${l}`)}r.Ms=r.Ms.remove(e),r.xs.delete(i.target)}function a1(t,e,n){const r=et(t);let i=Xe.min(),o=pt();return r.persistence.runTransaction("Execute query","readwrite",(l=>(function(h,m,p){const g=et(h),v=g.xs.get(p);return v!==void 0?ke.resolve(g.Ms.get(v)):g.Pi.getTargetData(m,p)})(r,l,Vs(e)).next((d=>{if(d)return i=d.lastLimboFreeSnapshotVersion,r.Pi.getMatchingKeysForTargetId(l,d.targetId).next((h=>{o=h}))})).next((()=>r.Fs.getDocumentsMatchingQuery(l,e,n?i:Xe.min(),n?o:pt()))).next((d=>(dN(r,YM(e),d),{documents:d,Qs:o})))))}function dN(t,e,n){let r=t.Os.get(e)||Xe.min();n.forEach(((i,o)=>{o.readTime.compareTo(r)>0&&(r=o.readTime)})),t.Os.set(e,r)}class o1{constructor(){this.activeTargetIds=nO()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class hN{constructor(){this.Mo=new o1,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,n,r){}addLocalQueryTarget(e,n=!0){return n&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,n,r){this.xo[e]=n}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new o1,Promise.resolve()}handleUserChange(e,n,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class fN{Oo(e){}shutdown(){}}const l1="ConnectivityMonitor";class c1{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){Ue(l1,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){Ue(l1,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}let Vh=null;function Ey(){return Vh===null?Vh=(function(){return 268435456+Math.round(2147483648*Math.random())})():Vh++,"0x"+Vh.toString(16)}const zg="RestConnection",mN={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class pN{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const n=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Uo=n+"://"+e.host,this.Ko=`projects/${r}/databases/${i}`,this.Wo=this.databaseId.database===gf?`project_id=${r}`:`project_id=${r}&database_id=${i}`}Go(e,n,r,i,o){const l=Ey(),d=this.zo(e,n.toUriEncodedString());Ue(zg,`Sending RPC '${e}' ${l}:`,d,r);const h={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(h,i,o);const{host:m}=new URL(d),p=rc(m);return this.Jo(e,d,h,r,p).then((g=>(Ue(zg,`Received RPC '${e}' ${l}: `,g),g)),(g=>{throw ql(zg,`RPC '${e}' ${l} failed with error: `,g,"url: ",d,"request:",r),g}))}Ho(e,n,r,i,o,l){return this.Go(e,n,r,i,o)}jo(e,n,r){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+lc})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach(((i,o)=>e[o]=i)),r&&r.headers.forEach(((i,o)=>e[o]=i))}zo(e,n){const r=mN[e];return`${this.Uo}/v1/${n}:${r}`}terminate(){}}class gN{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}const Xn="WebChannelConnection";class yN extends pN{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,n,r,i,o){const l=Ey();return new Promise(((d,h)=>{const m=new NC;m.setWithCredentials(!0),m.listenOnce(PC.COMPLETE,(()=>{try{switch(m.getLastErrorCode()){case Xh.NO_ERROR:const g=m.getResponseJson();Ue(Xn,`XHR for RPC '${e}' ${l} received:`,JSON.stringify(g)),d(g);break;case Xh.TIMEOUT:Ue(Xn,`RPC '${e}' ${l} timed out`),h(new Be(je.DEADLINE_EXCEEDED,"Request time out"));break;case Xh.HTTP_ERROR:const v=m.getStatus();if(Ue(Xn,`RPC '${e}' ${l} failed with status:`,v,"response text:",m.getResponseText()),v>0){let b=m.getResponseJson();Array.isArray(b)&&(b=b[0]);const C=b?.error;if(C&&C.status&&C.message){const x=(function(E){const T=E.toLowerCase().replace(/_/g,"-");return Object.values(je).indexOf(T)>=0?T:je.UNKNOWN})(C.status);h(new Be(x,C.message))}else h(new Be(je.UNKNOWN,"Server responded with status "+m.getStatus()))}else h(new Be(je.UNAVAILABLE,"Connection failed."));break;default:Ke(9055,{l_:e,streamId:l,h_:m.getLastErrorCode(),P_:m.getLastError()})}}finally{Ue(Xn,`RPC '${e}' ${l} completed.`)}}));const p=JSON.stringify(i);Ue(Xn,`RPC '${e}' ${l} sending request:`,i),m.send(n,"POST",p,r,15)}))}T_(e,n,r){const i=Ey(),o=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],l=LC(),d=BC(),h={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},m=this.longPollingOptions.timeoutSeconds;m!==void 0&&(h.longPollingTimeout=Math.round(1e3*m)),this.useFetchStreams&&(h.useFetchStreams=!0),this.jo(h.initMessageHeaders,n,r),h.encodeInitMessageHeaders=!0;const p=o.join("");Ue(Xn,`Creating RPC '${e}' stream ${i}: ${p}`,h);const g=l.createWebChannel(p,h);this.I_(g);let v=!1,b=!1;const C=new gN({Yo:S=>{b?Ue(Xn,`Not sending because RPC '${e}' stream ${i} is closed:`,S):(v||(Ue(Xn,`Opening RPC '${e}' stream ${i} transport.`),g.open(),v=!0),Ue(Xn,`RPC '${e}' stream ${i} sending:`,S),g.send(S))},Zo:()=>g.close()}),x=(S,E,T)=>{S.listen(E,(I=>{try{T(I)}catch(D){setTimeout((()=>{throw D}),0)}}))};return x(g,xu.EventType.OPEN,(()=>{b||(Ue(Xn,`RPC '${e}' stream ${i} transport opened.`),C.o_())})),x(g,xu.EventType.CLOSE,(()=>{b||(b=!0,Ue(Xn,`RPC '${e}' stream ${i} transport closed`),C.a_(),this.E_(g))})),x(g,xu.EventType.ERROR,(S=>{b||(b=!0,ql(Xn,`RPC '${e}' stream ${i} transport errored. Name:`,S.name,"Message:",S.message),C.a_(new Be(je.UNAVAILABLE,"The operation could not be completed")))})),x(g,xu.EventType.MESSAGE,(S=>{if(!b){const E=S.data[0];It(!!E,16349);const T=E,I=T?.error||T[0]?.error;if(I){Ue(Xn,`RPC '${e}' stream ${i} received error:`,I);const D=I.status;let B=(function(j){const N=bn[j];if(N!==void 0)return vE(N)})(D),$=I.message;B===void 0&&(B=je.INTERNAL,$="Unknown error status: "+D+" with message "+I.message),b=!0,C.a_(new Be(B,$)),g.close()}else Ue(Xn,`RPC '${e}' stream ${i} received:`,E),C.u_(E)}})),x(d,zC.STAT_EVENT,(S=>{S.stat===hy.PROXY?Ue(Xn,`RPC '${e}' stream ${i} detected buffering proxy`):S.stat===hy.NOPROXY&&Ue(Xn,`RPC '${e}' stream ${i} detected no buffering proxy`)})),setTimeout((()=>{C.__()}),0),C}terminate(){this.c_.forEach((e=>e.close())),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter((n=>n===e))}}function Bg(){return typeof document<"u"?document:null}function tm(t){return new xO(t,!0)}class OE{constructor(e,n,r=1e3,i=1.5,o=6e4){this.Mi=e,this.timerId=n,this.d_=r,this.A_=i,this.R_=o,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const n=Math.floor(this.V_+this.y_()),r=Math.max(0,Date.now()-this.f_),i=Math.max(0,n-r);i>0&&Ue("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.V_} ms, delay with jitter: ${n} ms, last attempt: ${r} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,i,(()=>(this.f_=Date.now(),e()))),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}const u1="PersistentStream";class NE{constructor(e,n,r,i,o,l,d,h){this.Mi=e,this.S_=r,this.b_=i,this.connection=o,this.authCredentialsProvider=l,this.appCheckCredentialsProvider=d,this.listener=h,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new OE(e,n)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,(()=>this.k_())))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,n){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():n&&n.code===je.RESOURCE_EXHAUSTED?(wi(n.toString()),wi("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):n&&n.code===je.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(n)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),n=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([r,i])=>{this.D_===n&&this.G_(r,i)}),(r=>{e((()=>{const i=new Be(je.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(i)}))}))}G_(e,n){const r=this.W_(this.D_);this.stream=this.j_(e,n),this.stream.Xo((()=>{r((()=>this.listener.Xo()))})),this.stream.t_((()=>{r((()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.t_())))})),this.stream.r_((i=>{r((()=>this.z_(i)))})),this.stream.onMessage((i=>{r((()=>++this.F_==1?this.J_(i):this.onNext(i)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(e){return Ue(u1,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return n=>{this.Mi.enqueueAndForget((()=>this.D_===e?n():(Ue(u1,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class _N extends NE{constructor(e,n,r,i,o,l){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",n,r,i,l),this.serializer=o}j_(e,n){return this.connection.T_("Listen",e,n)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const n=CO(this.serializer,e),r=(function(o){if(!("targetChange"in o))return Xe.min();const l=o.targetChange;return l.targetIds&&l.targetIds.length?Xe.min():l.readTime?$s(l.readTime):Xe.min()})(e);return this.listener.H_(n,r)}Y_(e){const n={};n.database=Sy(this.serializer),n.addTarget=(function(o,l){let d;const h=l.target;if(d=yy(h)?{documents:AO(o,h)}:{query:jO(o,h).ft},d.targetId=l.targetId,l.resumeToken.approximateByteSize()>0){d.resumeToken=SE(o,l.resumeToken);const m=vy(o,l.expectedCount);m!==null&&(d.expectedCount=m)}else if(l.snapshotVersion.compareTo(Xe.min())>0){d.readTime=wf(o,l.snapshotVersion.toTimestamp());const m=vy(o,l.expectedCount);m!==null&&(d.expectedCount=m)}return d})(this.serializer,e);const r=IO(this.serializer,e);r&&(n.labels=r),this.q_(n)}Z_(e){const n={};n.database=Sy(this.serializer),n.removeTarget=e,this.q_(n)}}class bN extends NE{constructor(e,n,r,i,o,l){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",n,r,i,l),this.serializer=o}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,n){return this.connection.T_("Write",e,n)}J_(e){return It(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,It(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){It(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const n=TO(e.writeResults,e.commitTime),r=$s(e.commitTime);return this.listener.na(r,n)}ra(){const e={};e.database=Sy(this.serializer),this.q_(e)}ea(e){const n={streamToken:this.lastStreamToken,writes:e.map((r=>EO(this.serializer,r)))};this.q_(n)}}class vN{}class xN extends vN{constructor(e,n,r,i){super(),this.authCredentials=e,this.appCheckCredentials=n,this.connection=r,this.serializer=i,this.ia=!1}sa(){if(this.ia)throw new Be(je.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,n,r,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([o,l])=>this.connection.Go(e,xy(n,r),i,o,l))).catch((o=>{throw o.name==="FirebaseError"?(o.code===je.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new Be(je.UNKNOWN,o.toString())}))}Ho(e,n,r,i,o){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([l,d])=>this.connection.Ho(e,xy(n,r),i,l,d,o))).catch((l=>{throw l.name==="FirebaseError"?(l.code===je.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),l):new Be(je.UNKNOWN,l.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}class wN{constructor(e,n){this.asyncQueue=e,this.onlineStateHandler=n,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const n=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(wi(n),this.aa=!1):Ue("OnlineStateTracker",n)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}const ko="RemoteStore";class SN{constructor(e,n,r,i,o){this.localStore=e,this.datastore=n,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=o,this.Aa.Oo((l=>{r.enqueueAndForget((async()=>{Po(this)&&(Ue(ko,"Restarting streams for network reachability change."),await(async function(h){const m=et(h);m.Ea.add(4),await sd(m),m.Ra.set("Unknown"),m.Ea.delete(4),await nm(m)})(this))}))})),this.Ra=new wN(r,i)}}async function nm(t){if(Po(t))for(const e of t.da)await e(!0)}async function sd(t){for(const e of t.da)await e(!1)}function PE(t,e){const n=et(t);n.Ia.has(e.targetId)||(n.Ia.set(e.targetId,e),x0(n)?v0(n):dc(n).O_()&&b0(n,e))}function _0(t,e){const n=et(t),r=dc(n);n.Ia.delete(e),r.O_()&&zE(n,e),n.Ia.size===0&&(r.O_()?r.L_():Po(n)&&n.Ra.set("Unknown"))}function b0(t,e){if(t.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Xe.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}dc(t).Y_(e)}function zE(t,e){t.Va.Ue(e),dc(t).Z_(e)}function v0(t){t.Va=new yO({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),At:e=>t.Ia.get(e)||null,ht:()=>t.datastore.serializer.databaseId}),dc(t).start(),t.Ra.ua()}function x0(t){return Po(t)&&!dc(t).x_()&&t.Ia.size>0}function Po(t){return et(t).Ea.size===0}function BE(t){t.Va=void 0}async function CN(t){t.Ra.set("Online")}async function EN(t){t.Ia.forEach(((e,n)=>{b0(t,e)}))}async function TN(t,e){BE(t),x0(t)?(t.Ra.ha(e),v0(t)):t.Ra.set("Unknown")}async function AN(t,e,n){if(t.Ra.set("Online"),e instanceof wE&&e.state===2&&e.cause)try{await(async function(i,o){const l=o.cause;for(const d of o.targetIds)i.Ia.has(d)&&(await i.remoteSyncer.rejectListen(d,l),i.Ia.delete(d),i.Va.removeTarget(d))})(t,e)}catch(r){Ue(ko,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await Cf(t,r)}else if(e instanceof tf?t.Va.Ze(e):e instanceof xE?t.Va.st(e):t.Va.tt(e),!n.isEqual(Xe.min()))try{const r=await ME(t.localStore);n.compareTo(r)>=0&&await(function(o,l){const d=o.Va.Tt(l);return d.targetChanges.forEach(((h,m)=>{if(h.resumeToken.approximateByteSize()>0){const p=o.Ia.get(m);p&&o.Ia.set(m,p.withResumeToken(h.resumeToken,l))}})),d.targetMismatches.forEach(((h,m)=>{const p=o.Ia.get(h);if(!p)return;o.Ia.set(h,p.withResumeToken(qn.EMPTY_BYTE_STRING,p.snapshotVersion)),zE(o,h);const g=new ha(p.target,h,m,p.sequenceNumber);b0(o,g)})),o.remoteSyncer.applyRemoteEvent(d)})(t,n)}catch(r){Ue(ko,"Failed to raise snapshot:",r),await Cf(t,r)}}async function Cf(t,e,n){if(!uc(e))throw e;t.Ea.add(1),await sd(t),t.Ra.set("Offline"),n||(n=()=>ME(t.localStore)),t.asyncQueue.enqueueRetryable((async()=>{Ue(ko,"Retrying IndexedDB access"),await n(),t.Ea.delete(1),await nm(t)}))}function LE(t,e){return e().catch((n=>Cf(t,n,e)))}async function rm(t){const e=et(t),n=Aa(e);let r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:s0;for(;jN(e);)try{const i=await cN(e.localStore,r);if(i===null){e.Ta.length===0&&n.L_();break}r=i.batchId,RN(e,i)}catch(i){await Cf(e,i)}UE(e)&&FE(e)}function jN(t){return Po(t)&&t.Ta.length<10}function RN(t,e){t.Ta.push(e);const n=Aa(t);n.O_()&&n.X_&&n.ea(e.mutations)}function UE(t){return Po(t)&&!Aa(t).x_()&&t.Ta.length>0}function FE(t){Aa(t).start()}async function IN(t){Aa(t).ra()}async function kN(t){const e=Aa(t);for(const n of t.Ta)e.ea(n.mutations)}async function DN(t,e,n){const r=t.Ta.shift(),i=d0.from(r,e,n);await LE(t,(()=>t.remoteSyncer.applySuccessfulWrite(i))),await rm(t)}async function MN(t,e){e&&Aa(t).X_&&await(async function(r,i){if((function(l){return mO(l)&&l!==je.ABORTED})(i.code)){const o=r.Ta.shift();Aa(r).B_(),await LE(r,(()=>r.remoteSyncer.rejectFailedWrite(o.batchId,i))),await rm(r)}})(t,e),UE(t)&&FE(t)}async function d1(t,e){const n=et(t);n.asyncQueue.verifyOperationInProgress(),Ue(ko,"RemoteStore received new credentials");const r=Po(n);n.Ea.add(3),await sd(n),r&&n.Ra.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.Ea.delete(3),await nm(n)}async function ON(t,e){const n=et(t);e?(n.Ea.delete(2),await nm(n)):e||(n.Ea.add(2),await sd(n),n.Ra.set("Unknown"))}function dc(t){return t.ma||(t.ma=(function(n,r,i){const o=et(n);return o.sa(),new _N(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,i)})(t.datastore,t.asyncQueue,{Xo:CN.bind(null,t),t_:EN.bind(null,t),r_:TN.bind(null,t),H_:AN.bind(null,t)}),t.da.push((async e=>{e?(t.ma.B_(),x0(t)?v0(t):t.Ra.set("Unknown")):(await t.ma.stop(),BE(t))}))),t.ma}function Aa(t){return t.fa||(t.fa=(function(n,r,i){const o=et(n);return o.sa(),new bN(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,i)})(t.datastore,t.asyncQueue,{Xo:()=>Promise.resolve(),t_:IN.bind(null,t),r_:MN.bind(null,t),ta:kN.bind(null,t),na:DN.bind(null,t)}),t.da.push((async e=>{e?(t.fa.B_(),await rm(t)):(await t.fa.stop(),t.Ta.length>0&&(Ue(ko,`Stopping write stream with ${t.Ta.length} pending writes`),t.Ta=[]))}))),t.fa}class w0{constructor(e,n,r,i,o){this.asyncQueue=e,this.timerId=n,this.targetTimeMs=r,this.op=i,this.removalCallback=o,this.deferred=new yi,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((l=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,n,r,i,o){const l=Date.now()+r,d=new w0(e,n,l,i,o);return d.start(r),d}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Be(je.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function S0(t,e){if(wi("AsyncQueue",`${e}: ${t}`),uc(t))return new Be(je.UNAVAILABLE,`${e}: ${t}`);throw t}class Ul{static emptySet(e){return new Ul(e.comparator)}constructor(e){this.comparator=e?(n,r)=>e(n,r)||Ge.comparator(n.key,r.key):(n,r)=>Ge.comparator(n.key,r.key),this.keyedMap=wu(),this.sortedSet=new en(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const n=this.keyedMap.get(e);return n?this.sortedSet.indexOf(n):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((n,r)=>(e(n),!1)))}add(e){const n=this.delete(e.key);return n.copy(n.keyedMap.insert(e.key,e),n.sortedSet.insert(e,null))}delete(e){const n=this.get(e);return n?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(n)):this}isEqual(e){if(!(e instanceof Ul)||this.size!==e.size)return!1;const n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;n.hasNext();){const i=n.getNext().key,o=r.getNext().key;if(!i.isEqual(o))return!1}return!0}toString(){const e=[];return this.forEach((n=>{e.push(n.toString())})),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,n){const r=new Ul;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r}}class h1{constructor(){this.ga=new en(Ge.comparator)}track(e){const n=e.doc.key,r=this.ga.get(n);r?e.type!==0&&r.type===3?this.ga=this.ga.insert(n,e):e.type===3&&r.type!==1?this.ga=this.ga.insert(n,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.ga=this.ga.insert(n,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.ga=this.ga.insert(n,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.ga=this.ga.remove(n):e.type===1&&r.type===2?this.ga=this.ga.insert(n,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.ga=this.ga.insert(n,{type:2,doc:e.doc}):Ke(63341,{Rt:e,pa:r}):this.ga=this.ga.insert(n,e)}ya(){const e=[];return this.ga.inorderTraversal(((n,r)=>{e.push(r)})),e}}class Xl{constructor(e,n,r,i,o,l,d,h,m){this.query=e,this.docs=n,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=o,this.fromCache=l,this.syncStateChanged=d,this.excludesMetadataChanges=h,this.hasCachedResults=m}static fromInitialDocuments(e,n,r,i,o){const l=[];return n.forEach((d=>{l.push({type:0,doc:d})})),new Xl(e,n,Ul.emptySet(n),l,r,i,!0,!1,o)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Kf(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const n=this.docChanges,r=e.docChanges;if(n.length!==r.length)return!1;for(let i=0;i<n.length;i++)if(n[i].type!==r[i].type||!n[i].doc.isEqual(r[i].doc))return!1;return!0}}class NN{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some((e=>e.Da()))}}class PN{constructor(){this.queries=f1(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(n,r){const i=et(n),o=i.queries;i.queries=f1(),o.forEach(((l,d)=>{for(const h of d.Sa)h.onError(r)}))})(this,new Be(je.ABORTED,"Firestore shutting down"))}}function f1(){return new No((t=>oE(t)),Kf)}async function VE(t,e){const n=et(t);let r=3;const i=e.query;let o=n.queries.get(i);o?!o.ba()&&e.Da()&&(r=2):(o=new NN,r=e.Da()?0:1);try{switch(r){case 0:o.wa=await n.onListen(i,!0);break;case 1:o.wa=await n.onListen(i,!1);break;case 2:await n.onFirstRemoteStoreListen(i)}}catch(l){const d=S0(l,`Initialization of query '${Ml(e.query)}' failed`);return void e.onError(d)}n.queries.set(i,o),o.Sa.push(e),e.va(n.onlineState),o.wa&&e.Fa(o.wa)&&C0(n)}async function $E(t,e){const n=et(t),r=e.query;let i=3;const o=n.queries.get(r);if(o){const l=o.Sa.indexOf(e);l>=0&&(o.Sa.splice(l,1),o.Sa.length===0?i=e.Da()?0:1:!o.ba()&&e.Da()&&(i=2))}switch(i){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}}function zN(t,e){const n=et(t);let r=!1;for(const i of e){const o=i.query,l=n.queries.get(o);if(l){for(const d of l.Sa)d.Fa(i)&&(r=!0);l.wa=i}}r&&C0(n)}function BN(t,e,n){const r=et(t),i=r.queries.get(e);if(i)for(const o of i.Sa)o.onError(n);r.queries.delete(e)}function C0(t){t.Ca.forEach((e=>{e.next()}))}var Ty,m1;(m1=Ty||(Ty={})).Ma="default",m1.Cache="cache";class qE{constructor(e,n,r){this.query=e,this.xa=n,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){const r=[];for(const i of e.docChanges)i.type!==3&&r.push(i);e=new Xl(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let n=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),n=!0):this.La(e,this.onlineState)&&(this.ka(e),n=!0),this.Na=e,n}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let n=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),n=!0),n}La(e,n){if(!e.fromCache||!this.Da())return!0;const r=n!=="Offline";return(!this.options.qa||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||n==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const n=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!n)&&this.options.includeMetadataChanges===!0}ka(e){e=Xl.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==Ty.Cache}}class HE{constructor(e){this.key=e}}class GE{constructor(e){this.key=e}}class LN{constructor(e,n){this.query=e,this.Ya=n,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=pt(),this.mutatedKeys=pt(),this.eu=lE(e),this.tu=new Ul(this.eu)}get nu(){return this.Ya}ru(e,n){const r=n?n.iu:new h1,i=n?n.tu:this.tu;let o=n?n.mutatedKeys:this.mutatedKeys,l=i,d=!1;const h=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,m=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal(((p,g)=>{const v=i.get(p),b=Yf(this.query,g)?g:null,C=!!v&&this.mutatedKeys.has(v.key),x=!!b&&(b.hasLocalMutations||this.mutatedKeys.has(b.key)&&b.hasCommittedMutations);let S=!1;v&&b?v.data.isEqual(b.data)?C!==x&&(r.track({type:3,doc:b}),S=!0):this.su(v,b)||(r.track({type:2,doc:b}),S=!0,(h&&this.eu(b,h)>0||m&&this.eu(b,m)<0)&&(d=!0)):!v&&b?(r.track({type:0,doc:b}),S=!0):v&&!b&&(r.track({type:1,doc:v}),S=!0,(h||m)&&(d=!0)),S&&(b?(l=l.add(b),o=x?o.add(p):o.delete(p)):(l=l.delete(p),o=o.delete(p)))})),this.query.limit!==null)for(;l.size>this.query.limit;){const p=this.query.limitType==="F"?l.last():l.first();l=l.delete(p.key),o=o.delete(p.key),r.track({type:1,doc:p})}return{tu:l,iu:r,Cs:d,mutatedKeys:o}}su(e,n){return e.hasLocalMutations&&n.hasCommittedMutations&&!n.hasLocalMutations}applyChanges(e,n,r,i){const o=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const l=e.iu.ya();l.sort(((p,g)=>(function(b,C){const x=S=>{switch(S){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Ke(20277,{Rt:S})}};return x(b)-x(C)})(p.type,g.type)||this.eu(p.doc,g.doc))),this.ou(r),i=i??!1;const d=n&&!i?this._u():[],h=this.Xa.size===0&&this.current&&!i?1:0,m=h!==this.Za;return this.Za=h,l.length!==0||m?{snapshot:new Xl(this.query,e.tu,o,l,e.mutatedKeys,h===0,m,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:d}:{au:d}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new h1,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach((n=>this.Ya=this.Ya.add(n))),e.modifiedDocuments.forEach((n=>{})),e.removedDocuments.forEach((n=>this.Ya=this.Ya.delete(n))),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=pt(),this.tu.forEach((r=>{this.uu(r.key)&&(this.Xa=this.Xa.add(r.key))}));const n=[];return e.forEach((r=>{this.Xa.has(r)||n.push(new GE(r))})),this.Xa.forEach((r=>{e.has(r)||n.push(new HE(r))})),n}cu(e){this.Ya=e.Qs,this.Xa=pt();const n=this.ru(e.documents);return this.applyChanges(n,!0)}lu(){return Xl.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const E0="SyncEngine";class UN{constructor(e,n,r){this.query=e,this.targetId=n,this.view=r}}class FN{constructor(e){this.key=e,this.hu=!1}}class VN{constructor(e,n,r,i,o,l){this.localStore=e,this.remoteStore=n,this.eventManager=r,this.sharedClientState=i,this.currentUser=o,this.maxConcurrentLimboResolutions=l,this.Pu={},this.Tu=new No((d=>oE(d)),Kf),this.Iu=new Map,this.Eu=new Set,this.du=new en(Ge.comparator),this.Au=new Map,this.Ru=new m0,this.Vu={},this.mu=new Map,this.fu=Yl.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function $N(t,e,n=!0){const r=ZE(t);let i;const o=r.Tu.get(e);return o?(r.sharedClientState.addLocalQueryTarget(o.targetId),i=o.view.lu()):i=await QE(r,e,n,!0),i}async function qN(t,e){const n=ZE(t);await QE(n,e,!0,!1)}async function QE(t,e,n,r){const i=await uN(t.localStore,Vs(e)),o=i.targetId,l=t.sharedClientState.addLocalQueryTarget(o,n);let d;return r&&(d=await HN(t,e,o,l==="current",i.resumeToken)),t.isPrimaryClient&&n&&PE(t.remoteStore,i),d}async function HN(t,e,n,r,i){t.pu=(g,v,b)=>(async function(x,S,E,T){let I=S.view.ru(E);I.Cs&&(I=await a1(x.localStore,S.query,!1).then((({documents:k})=>S.view.ru(k,I))));const D=T&&T.targetChanges.get(S.targetId),B=T&&T.targetMismatches.get(S.targetId)!=null,$=S.view.applyChanges(I,x.isPrimaryClient,D,B);return g1(x,S.targetId,$.au),$.snapshot})(t,g,v,b);const o=await a1(t.localStore,e,!0),l=new LN(e,o.Qs),d=l.ru(o.documents),h=rd.createSynthesizedTargetChangeForCurrentChange(n,r&&t.onlineState!=="Offline",i),m=l.applyChanges(d,t.isPrimaryClient,h);g1(t,n,m.au);const p=new UN(e,n,l);return t.Tu.set(e,p),t.Iu.has(n)?t.Iu.get(n).push(e):t.Iu.set(n,[e]),m.snapshot}async function GN(t,e,n){const r=et(t),i=r.Tu.get(e),o=r.Iu.get(i.targetId);if(o.length>1)return r.Iu.set(i.targetId,o.filter((l=>!Kf(l,e)))),void r.Tu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||await Cy(r.localStore,i.targetId,!1).then((()=>{r.sharedClientState.clearQueryState(i.targetId),n&&_0(r.remoteStore,i.targetId),Ay(r,i.targetId)})).catch(cc)):(Ay(r,i.targetId),await Cy(r.localStore,i.targetId,!0))}async function QN(t,e){const n=et(t),r=n.Tu.get(e),i=n.Iu.get(r.targetId);n.isPrimaryClient&&i.length===1&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),_0(n.remoteStore,r.targetId))}async function WN(t,e,n){const r=t6(t);try{const i=await(function(l,d){const h=et(l),m=Qt.now(),p=d.reduce(((b,C)=>b.add(C.key)),pt());let g,v;return h.persistence.runTransaction("Locally write mutations","readwrite",(b=>{let C=Si(),x=pt();return h.Ns.getEntries(b,p).next((S=>{C=S,C.forEach(((E,T)=>{T.isValidDocument()||(x=x.add(E))}))})).next((()=>h.localDocuments.getOverlayedDocuments(b,C))).next((S=>{g=S;const E=[];for(const T of d){const I=cO(T,g.get(T.key).overlayedDocument);I!=null&&E.push(new za(T.key,I,JC(I.value.mapValue),yr.exists(!0)))}return h.mutationQueue.addMutationBatch(b,m,E,d)})).next((S=>{v=S;const E=S.applyToLocalDocumentSet(g,x);return h.documentOverlayCache.saveOverlays(b,S.batchId,E)}))})).then((()=>({batchId:v.batchId,changes:uE(g)})))})(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),(function(l,d,h){let m=l.Vu[l.currentUser.toKey()];m||(m=new en(mt)),m=m.insert(d,h),l.Vu[l.currentUser.toKey()]=m})(r,i.batchId,n),await id(r,i.changes),await rm(r.remoteStore)}catch(i){const o=S0(i,"Failed to persist write");n.reject(o)}}async function WE(t,e){const n=et(t);try{const r=await oN(n.localStore,e);e.targetChanges.forEach(((i,o)=>{const l=n.Au.get(o);l&&(It(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1,22616),i.addedDocuments.size>0?l.hu=!0:i.modifiedDocuments.size>0?It(l.hu,14607):i.removedDocuments.size>0&&(It(l.hu,42227),l.hu=!1))})),await id(n,r,e)}catch(r){await cc(r)}}function p1(t,e,n){const r=et(t);if(r.isPrimaryClient&&n===0||!r.isPrimaryClient&&n===1){const i=[];r.Tu.forEach(((o,l)=>{const d=l.view.va(e);d.snapshot&&i.push(d.snapshot)})),(function(l,d){const h=et(l);h.onlineState=d;let m=!1;h.queries.forEach(((p,g)=>{for(const v of g.Sa)v.va(d)&&(m=!0)})),m&&C0(h)})(r.eventManager,e),i.length&&r.Pu.H_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function KN(t,e,n){const r=et(t);r.sharedClientState.updateQueryState(e,"rejected",n);const i=r.Au.get(e),o=i&&i.key;if(o){let l=new en(Ge.comparator);l=l.insert(o,Jn.newNoDocument(o,Xe.min()));const d=pt().add(o),h=new em(Xe.min(),new Map,new en(mt),l,d);await WE(r,h),r.du=r.du.remove(o),r.Au.delete(e),T0(r)}else await Cy(r.localStore,e,!1).then((()=>Ay(r,e,n))).catch(cc)}async function YN(t,e){const n=et(t),r=e.batch.batchId;try{const i=await aN(n.localStore,e);YE(n,r,null),KE(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await id(n,i)}catch(i){await cc(i)}}async function XN(t,e,n){const r=et(t);try{const i=await(function(l,d){const h=et(l);return h.persistence.runTransaction("Reject batch","readwrite-primary",(m=>{let p;return h.mutationQueue.lookupMutationBatch(m,d).next((g=>(It(g!==null,37113),p=g.keys(),h.mutationQueue.removeMutationBatch(m,g)))).next((()=>h.mutationQueue.performConsistencyCheck(m))).next((()=>h.documentOverlayCache.removeOverlaysForBatchId(m,p,d))).next((()=>h.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(m,p))).next((()=>h.localDocuments.getDocuments(m,p)))}))})(r.localStore,e);YE(r,e,n),KE(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),await id(r,i)}catch(i){await cc(i)}}function KE(t,e){(t.mu.get(e)||[]).forEach((n=>{n.resolve()})),t.mu.delete(e)}function YE(t,e,n){const r=et(t);let i=r.Vu[r.currentUser.toKey()];if(i){const o=i.get(e);o&&(n?o.reject(n):o.resolve(),i=i.remove(e)),r.Vu[r.currentUser.toKey()]=i}}function Ay(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.Iu.get(e))t.Tu.delete(r),n&&t.Pu.yu(r,n);t.Iu.delete(e),t.isPrimaryClient&&t.Ru.jr(e).forEach((r=>{t.Ru.containsKey(r)||XE(t,r)}))}function XE(t,e){t.Eu.delete(e.path.canonicalString());const n=t.du.get(e);n!==null&&(_0(t.remoteStore,n),t.du=t.du.remove(e),t.Au.delete(n),T0(t))}function g1(t,e,n){for(const r of n)r instanceof HE?(t.Ru.addReference(r.key,e),ZN(t,r)):r instanceof GE?(Ue(E0,"Document no longer in limbo: "+r.key),t.Ru.removeReference(r.key,e),t.Ru.containsKey(r.key)||XE(t,r.key)):Ke(19791,{wu:r})}function ZN(t,e){const n=e.key,r=n.path.canonicalString();t.du.get(n)||t.Eu.has(r)||(Ue(E0,"New document in limbo: "+n),t.Eu.add(r),T0(t))}function T0(t){for(;t.Eu.size>0&&t.du.size<t.maxConcurrentLimboResolutions;){const e=t.Eu.values().next().value;t.Eu.delete(e);const n=new Ge(Vt.fromString(e)),r=t.fu.next();t.Au.set(r,new FN(n)),t.du=t.du.insert(n,r),PE(t.remoteStore,new ha(Vs(c0(n.path)),r,"TargetPurposeLimboResolution",Gf.ce))}}async function id(t,e,n){const r=et(t),i=[],o=[],l=[];r.Tu.isEmpty()||(r.Tu.forEach(((d,h)=>{l.push(r.pu(h,e,n).then((m=>{if((m||n)&&r.isPrimaryClient){const p=m?!m.fromCache:n?.targetChanges.get(h.targetId)?.current;r.sharedClientState.updateQueryState(h.targetId,p?"current":"not-current")}if(m){i.push(m);const p=g0.As(h.targetId,m);o.push(p)}})))})),await Promise.all(l),r.Pu.H_(i),await(async function(h,m){const p=et(h);try{await p.persistence.runTransaction("notifyLocalViewChanges","readwrite",(g=>ke.forEach(m,(v=>ke.forEach(v.Es,(b=>p.persistence.referenceDelegate.addReference(g,v.targetId,b))).next((()=>ke.forEach(v.ds,(b=>p.persistence.referenceDelegate.removeReference(g,v.targetId,b)))))))))}catch(g){if(!uc(g))throw g;Ue(y0,"Failed to update sequence numbers: "+g)}for(const g of m){const v=g.targetId;if(!g.fromCache){const b=p.Ms.get(v),C=b.snapshotVersion,x=b.withLastLimboFreeSnapshotVersion(C);p.Ms=p.Ms.insert(v,x)}}})(r.localStore,o))}async function JN(t,e){const n=et(t);if(!n.currentUser.isEqual(e)){Ue(E0,"User change. New user:",e.toKey());const r=await DE(n.localStore,e);n.currentUser=e,(function(o,l){o.mu.forEach((d=>{d.forEach((h=>{h.reject(new Be(je.CANCELLED,l))}))})),o.mu.clear()})(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await id(n,r.Ls)}}function e6(t,e){const n=et(t),r=n.Au.get(e);if(r&&r.hu)return pt().add(r.key);{let i=pt();const o=n.Iu.get(e);if(!o)return i;for(const l of o){const d=n.Tu.get(l);i=i.unionWith(d.view.nu)}return i}}function ZE(t){const e=et(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=WE.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=e6.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=KN.bind(null,e),e.Pu.H_=zN.bind(null,e.eventManager),e.Pu.yu=BN.bind(null,e.eventManager),e}function t6(t){const e=et(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=YN.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=XN.bind(null,e),e}class Ef{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=tm(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,n){return null}Mu(e,n){return null}vu(e){return iN(this.persistence,new nN,e.initialUser,this.serializer)}Cu(e){return new kE(p0.mi,this.serializer)}Du(e){return new hN}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Ef.provider={build:()=>new Ef};class n6 extends Ef{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,n){It(this.persistence.referenceDelegate instanceof Sf,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new FO(r,e.asyncQueue,n)}Cu(e){const n=this.cacheSizeBytes!==void 0?fr.withCacheSize(this.cacheSizeBytes):fr.DEFAULT;return new kE((r=>Sf.mi(r,n)),this.serializer)}}class jy{async initialize(e,n){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>p1(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=JN.bind(null,this.syncEngine),await ON(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new PN})()}createDatastore(e){const n=tm(e.databaseInfo.databaseId),r=(function(o){return new yN(o)})(e.databaseInfo);return(function(o,l,d,h){return new xN(o,l,d,h)})(e.authCredentials,e.appCheckCredentials,r,n)}createRemoteStore(e){return(function(r,i,o,l,d){return new SN(r,i,o,l,d)})(this.localStore,this.datastore,e.asyncQueue,(n=>p1(this.syncEngine,n,0)),(function(){return c1.v()?new c1:new fN})())}createSyncEngine(e,n){return(function(i,o,l,d,h,m,p){const g=new VN(i,o,l,d,h,m);return p&&(g.gu=!0),g})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,n)}async terminate(){await(async function(n){const r=et(n);Ue(ko,"RemoteStore shutting down."),r.Ea.add(5),await sd(r),r.Aa.shutdown(),r.Ra.set("Unknown")})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}jy.provider={build:()=>new jy};class JE{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):wi("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,n){setTimeout((()=>{this.muted||e(n)}),0)}}const ja="FirestoreClient";class r6{constructor(e,n,r,i,o){this.authCredentials=e,this.appCheckCredentials=n,this.asyncQueue=r,this.databaseInfo=i,this.user=Zn.UNAUTHENTICATED,this.clientId=r0.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=o,this.authCredentials.start(r,(async l=>{Ue(ja,"Received user=",l.uid),await this.authCredentialListener(l),this.user=l})),this.appCheckCredentials.start(r,(l=>(Ue(ja,"Received new app check token=",l),this.appCheckCredentialListener(l,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new yi;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){const r=S0(n,"Failed to shutdown persistence");e.reject(r)}})),e.promise}}async function Lg(t,e){t.asyncQueue.verifyOperationInProgress(),Ue(ja,"Initializing OfflineComponentProvider");const n=t.configuration;await e.initialize(n);let r=n.initialUser;t.setCredentialChangeListener((async i=>{r.isEqual(i)||(await DE(e.localStore,i),r=i)})),e.persistence.setDatabaseDeletedListener((()=>t.terminate())),t._offlineComponents=e}async function y1(t,e){t.asyncQueue.verifyOperationInProgress();const n=await s6(t);Ue(ja,"Initializing OnlineComponentProvider"),await e.initialize(n,t.configuration),t.setCredentialChangeListener((r=>d1(e.remoteStore,r))),t.setAppCheckTokenChangeListener(((r,i)=>d1(e.remoteStore,i))),t._onlineComponents=e}async function s6(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){Ue(ja,"Using user provided OfflineComponentProvider");try{await Lg(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!(function(i){return i.name==="FirebaseError"?i.code===je.FAILED_PRECONDITION||i.code===je.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11})(n))throw n;ql("Error using user provided cache. Falling back to memory cache: "+n),await Lg(t,new Ef)}}else Ue(ja,"Using default OfflineComponentProvider"),await Lg(t,new n6(void 0));return t._offlineComponents}async function eT(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(Ue(ja,"Using user provided OnlineComponentProvider"),await y1(t,t._uninitializedComponentsProvider._online)):(Ue(ja,"Using default OnlineComponentProvider"),await y1(t,new jy))),t._onlineComponents}function i6(t){return eT(t).then((e=>e.syncEngine))}async function tT(t){const e=await eT(t),n=e.eventManager;return n.onListen=$N.bind(null,e.syncEngine),n.onUnlisten=GN.bind(null,e.syncEngine),n.onFirstRemoteStoreListen=qN.bind(null,e.syncEngine),n.onLastRemoteStoreUnlisten=QN.bind(null,e.syncEngine),n}function a6(t,e,n={}){const r=new yi;return t.asyncQueue.enqueueAndForget((async()=>(function(o,l,d,h,m){const p=new JE({next:v=>{p.Nu(),l.enqueueAndForget((()=>$E(o,g)));const b=v.docs.has(d);!b&&v.fromCache?m.reject(new Be(je.UNAVAILABLE,"Failed to get document because the client is offline.")):b&&v.fromCache&&h&&h.source==="server"?m.reject(new Be(je.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):m.resolve(v)},error:v=>m.reject(v)}),g=new qE(c0(d.path),p,{includeMetadataChanges:!0,qa:!0});return VE(o,g)})(await tT(t),t.asyncQueue,e,n,r))),r.promise}function o6(t,e,n={}){const r=new yi;return t.asyncQueue.enqueueAndForget((async()=>(function(o,l,d,h,m){const p=new JE({next:v=>{p.Nu(),l.enqueueAndForget((()=>$E(o,g))),v.fromCache&&h.source==="server"?m.reject(new Be(je.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):m.resolve(v)},error:v=>m.reject(v)}),g=new qE(d,p,{includeMetadataChanges:!0,qa:!0});return VE(o,g)})(await tT(t),t.asyncQueue,e,n,r))),r.promise}function nT(t){const e={};return t.timeoutSeconds!==void 0&&(e.timeoutSeconds=t.timeoutSeconds),e}const _1=new Map;const rT="firestore.googleapis.com",b1=!0;class v1{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new Be(je.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=rT,this.ssl=b1}else this.host=e.host,this.ssl=e.ssl??b1;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=IE;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<LO)throw new Be(je.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}SM("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=nT(e.experimentalLongPollingOptions??{}),(function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new Be(je.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new Be(je.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new Be(je.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(r,i){return r.timeoutSeconds===i.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class sm{constructor(e,n,r,i){this._authCredentials=e,this._appCheckCredentials=n,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new v1({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Be(je.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new Be(je.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new v1(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(r){if(!r)return new fM;switch(r.type){case"firstParty":return new yM(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new Be(je.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(n){const r=_1.get(n);r&&(Ue("ComponentProvider","Removing Datastore"),_1.delete(n),r.terminate())})(this),Promise.resolve()}}function l6(t,e,n,r={}){t=hs(t,sm);const i=rc(e),o=t._getSettings(),l={...o,emulatorOptions:t._getEmulatorOptions()},d=`${e}:${n}`;i&&(GS(`https://${d}`),QS("Firestore",!0)),o.host!==rT&&o.host!==d&&ql("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const h={...o,host:d,ssl:i,emulatorOptions:r};if(!bi(h,l)&&(t._setSettings(h),r.mockUserToken)){let m,p;if(typeof r.mockUserToken=="string")m=r.mockUserToken,p=Zn.MOCK_USER;else{m=xR(r.mockUserToken,t._app?.options.projectId);const g=r.mockUserToken.sub||r.mockUserToken.user_id;if(!g)throw new Be(je.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");p=new Zn(g)}t._authCredentials=new mM(new FC(m,p))}}class hc{constructor(e,n,r){this.converter=n,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new hc(this.firestore,e,this._query)}}class un{constructor(e,n,r){this.converter=n,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new wa(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new un(this.firestore,e,this._key)}toJSON(){return{type:un._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,n,r){if(ed(n,un._jsonSchema))return new un(e,r||null,new Ge(Vt.fromString(n.referencePath)))}}un._jsonSchemaVersion="firestore/documentReference/1.0",un._jsonSchema={type:xn("string",un._jsonSchemaVersion),referencePath:xn("string")};class wa extends hc{constructor(e,n,r){super(e,n,c0(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new un(this.firestore,null,new Ge(e))}withConverter(e){return new wa(this.firestore,e,this._path)}}function c6(t,e,...n){if(t=wn(t),VC("collection","path",e),t instanceof sm){const r=Vt.fromString(e,...n);return Mw(r),new wa(t,null,r)}{if(!(t instanceof un||t instanceof wa))throw new Be(je.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(Vt.fromString(e,...n));return Mw(r),new wa(t.firestore,null,r)}}function fc(t,e,...n){if(t=wn(t),arguments.length===1&&(e=r0.newId()),VC("doc","path",e),t instanceof sm){const r=Vt.fromString(e,...n);return Dw(r),new un(t,null,new Ge(r))}{if(!(t instanceof un||t instanceof wa))throw new Be(je.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(Vt.fromString(e,...n));return Dw(r),new un(t.firestore,t instanceof wa?t.converter:null,new Ge(r))}}const x1="AsyncQueue";class w1{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new OE(this,"async_queue_retry"),this._c=()=>{const r=Bg();r&&Ue(x1,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=e;const n=Bg();n&&typeof n.addEventListener=="function"&&n.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const n=Bg();n&&typeof n.removeEventListener=="function"&&n.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise((()=>{}));const n=new yi;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(e().then(n.resolve,n.reject),n.promise))).then((()=>n.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Xu.push(e),this.lc())))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!uc(e))throw e;Ue(x1,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_((()=>this.lc()))}}cc(e){const n=this.ac.then((()=>(this.rc=!0,e().catch((r=>{throw this.nc=r,this.rc=!1,wi("INTERNAL UNHANDLED ERROR: ",S1(r)),r})).then((r=>(this.rc=!1,r))))));return this.ac=n,n}enqueueAfterDelay(e,n,r){this.uc(),this.oc.indexOf(e)>-1&&(n=0);const i=w0.createAndSchedule(this,e,n,r,(o=>this.hc(o)));return this.tc.push(i),i}uc(){this.nc&&Ke(47125,{Pc:S1(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const n of this.tc)if(n.timerId===e)return!0;return!1}Ec(e){return this.Tc().then((()=>{this.tc.sort(((n,r)=>n.targetTimeMs-r.targetTimeMs));for(const n of this.tc)if(n.skipDelay(),e!=="all"&&n.timerId===e)break;return this.Tc()}))}dc(e){this.oc.push(e)}hc(e){const n=this.tc.indexOf(e);this.tc.splice(n,1)}}function S1(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+`
`+t.stack),e}class zo extends sm{constructor(e,n,r,i){super(e,n,r,i),this.type="firestore",this._queue=new w1,this._persistenceKey=i?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new w1(e),this._firestoreClient=void 0,await e}}}function u6(t,e){const n=typeof t=="object"?t:XS(),r=typeof t=="string"?t:gf,i=Qy(n,"firestore").getImmediate({identifier:r});if(!i._initialized){const o=bR("firestore");o&&l6(i,...o)}return i}function im(t){if(t._terminated)throw new Be(je.FAILED_PRECONDITION,"The client has already been terminated.");return t._firestoreClient||d6(t),t._firestoreClient}function d6(t){const e=t._freezeSettings(),n=(function(i,o,l,d){return new OM(i,o,l,d.host,d.ssl,d.experimentalForceLongPolling,d.experimentalAutoDetectLongPolling,nT(d.experimentalLongPollingOptions),d.useFetchStreams,d.isUsingEmulator)})(t._databaseId,t._app?.options.appId||"",t._persistenceKey,e);t._componentsProvider||e.localCache?._offlineComponentProvider&&e.localCache?._onlineComponentProvider&&(t._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),t._firestoreClient=new r6(t._authCredentials,t._appCheckCredentials,t._queue,n,t._componentsProvider&&(function(i){const o=i?._online.build();return{_offline:i?._offline.build(o),_online:o}})(t._componentsProvider))}class Gr{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Gr(qn.fromBase64String(e))}catch(n){throw new Be(je.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+n)}}static fromUint8Array(e){return new Gr(qn.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:Gr._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(ed(e,Gr._jsonSchema))return Gr.fromBase64String(e.bytes)}}Gr._jsonSchemaVersion="firestore/bytes/1.0",Gr._jsonSchema={type:xn("string",Gr._jsonSchemaVersion),bytes:xn("string")};class ad{constructor(...e){for(let n=0;n<e.length;++n)if(e[n].length===0)throw new Be(je.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Vn(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class od{constructor(e){this._methodName=e}}class qs{constructor(e,n){if(!isFinite(e)||e<-90||e>90)throw new Be(je.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(n)||n<-180||n>180)throw new Be(je.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=e,this._long=n}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return mt(this._lat,e._lat)||mt(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:qs._jsonSchemaVersion}}static fromJSON(e){if(ed(e,qs._jsonSchema))return new qs(e.latitude,e.longitude)}}qs._jsonSchemaVersion="firestore/geoPoint/1.0",qs._jsonSchema={type:xn("string",qs._jsonSchemaVersion),latitude:xn("number"),longitude:xn("number")};class Hs{constructor(e){this._values=(e||[]).map((n=>n))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(r,i){if(r.length!==i.length)return!1;for(let o=0;o<r.length;++o)if(r[o]!==i[o])return!1;return!0})(this._values,e._values)}toJSON(){return{type:Hs._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(ed(e,Hs._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every((n=>typeof n=="number")))return new Hs(e.vectorValues);throw new Be(je.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Hs._jsonSchemaVersion="firestore/vectorValue/1.0",Hs._jsonSchema={type:xn("string",Hs._jsonSchemaVersion),vectorValues:xn("object")};const h6=/^__.*__$/;class f6{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return this.fieldMask!==null?new za(e,this.data,this.fieldMask,n,this.fieldTransforms):new nd(e,this.data,n,this.fieldTransforms)}}class sT{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return new za(e,this.data,this.fieldMask,n,this.fieldTransforms)}}function iT(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Ke(40011,{Ac:t})}}class am{constructor(e,n,r,i,o,l){this.settings=e,this.databaseId=n,this.serializer=r,this.ignoreUndefinedProperties=i,o===void 0&&this.Rc(),this.fieldTransforms=o||[],this.fieldMask=l||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new am({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){const n=this.path?.child(e),r=this.Vc({path:n,fc:!1});return r.gc(e),r}yc(e){const n=this.path?.child(e),r=this.Vc({path:n,fc:!1});return r.Rc(),r}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return Tf(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find((n=>e.isPrefixOf(n)))!==void 0||this.fieldTransforms.find((n=>e.isPrefixOf(n.field)))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(iT(this.Ac)&&h6.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class m6{constructor(e,n,r){this.databaseId=e,this.ignoreUndefinedProperties=n,this.serializer=r||tm(e)}Cc(e,n,r,i=!1){return new am({Ac:e,methodName:n,Dc:r,path:Vn.emptyPath(),fc:!1,bc:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function om(t){const e=t._freezeSettings(),n=tm(t._databaseId);return new m6(t._databaseId,!!e.ignoreUndefinedProperties,n)}function aT(t,e,n,r,i,o={}){const l=t.Cc(o.merge||o.mergeFields?2:0,e,n,i);R0("Data must be an object, but it was:",l,r);const d=uT(r,l);let h,m;if(o.merge)h=new jr(l.fieldMask),m=l.fieldTransforms;else if(o.mergeFields){const p=[];for(const g of o.mergeFields){const v=Ry(e,g,n);if(!l.contains(v))throw new Be(je.INVALID_ARGUMENT,`Field '${v}' is specified in your field mask but missing from your input data.`);hT(p,v)||p.push(v)}h=new jr(p),m=l.fieldTransforms.filter((g=>h.covers(g.field)))}else h=null,m=l.fieldTransforms;return new f6(new mr(d),h,m)}class lm extends od{_toFieldTransform(e){if(e.Ac!==2)throw e.Ac===1?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof lm}}function oT(t,e,n){return new am({Ac:3,Dc:e.settings.Dc,methodName:t._methodName,fc:n},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class A0 extends od{constructor(e,n){super(e),this.vc=n}_toFieldTransform(e){const n=oT(this,e,!0),r=this.vc.map((o=>Bo(o,n))),i=new Wl(r);return new yE(e.path,i)}isEqual(e){return e instanceof A0&&bi(this.vc,e.vc)}}class j0 extends od{constructor(e,n){super(e),this.vc=n}_toFieldTransform(e){const n=oT(this,e,!0),r=this.vc.map((o=>Bo(o,n))),i=new Kl(r);return new yE(e.path,i)}isEqual(e){return e instanceof j0&&bi(this.vc,e.vc)}}function lT(t,e,n,r){const i=t.Cc(1,e,n);R0("Data must be an object, but it was:",i,r);const o=[],l=mr.empty();Pa(r,((h,m)=>{const p=I0(e,h,n);m=wn(m);const g=i.yc(p);if(m instanceof lm)o.push(p);else{const v=Bo(m,g);v!=null&&(o.push(p),l.set(p,v))}}));const d=new jr(o);return new sT(l,d,i.fieldTransforms)}function cT(t,e,n,r,i,o){const l=t.Cc(1,e,n),d=[Ry(e,r,n)],h=[i];if(o.length%2!=0)throw new Be(je.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let v=0;v<o.length;v+=2)d.push(Ry(e,o[v])),h.push(o[v+1]);const m=[],p=mr.empty();for(let v=d.length-1;v>=0;--v)if(!hT(m,d[v])){const b=d[v];let C=h[v];C=wn(C);const x=l.yc(b);if(C instanceof lm)m.push(b);else{const S=Bo(C,x);S!=null&&(m.push(b),p.set(b,S))}}const g=new jr(m);return new sT(p,g,l.fieldTransforms)}function p6(t,e,n,r=!1){return Bo(n,t.Cc(r?4:3,e))}function Bo(t,e){if(dT(t=wn(t)))return R0("Unsupported field value:",e,t),uT(t,e);if(t instanceof od)return(function(r,i){if(!iT(i.Ac))throw i.Sc(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Sc(`${r._methodName}() is not currently supported inside arrays`);const o=r._toFieldTransform(i);o&&i.fieldTransforms.push(o)})(t,e),null;if(t===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return(function(r,i){const o=[];let l=0;for(const d of r){let h=Bo(d,i.wc(l));h==null&&(h={nullValue:"NULL_VALUE"}),o.push(h),l++}return{arrayValue:{values:o}}})(t,e)}return(function(r,i){if((r=wn(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return rO(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const o=Qt.fromDate(r);return{timestampValue:wf(i.serializer,o)}}if(r instanceof Qt){const o=new Qt(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:wf(i.serializer,o)}}if(r instanceof qs)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Gr)return{bytesValue:SE(i.serializer,r._byteString)};if(r instanceof un){const o=i.databaseId,l=r.firestore._databaseId;if(!l.isEqual(o))throw i.Sc(`Document reference is for database ${l.projectId}/${l.database} but should be for database ${o.projectId}/${o.database}`);return{referenceValue:f0(r.firestore._databaseId||i.databaseId,r._key.path)}}if(r instanceof Hs)return(function(l,d){return{mapValue:{fields:{[XC]:{stringValue:ZC},[yf]:{arrayValue:{values:l.toArray().map((m=>{if(typeof m!="number")throw d.Sc("VectorValues must only contain numeric values.");return u0(d.serializer,m)}))}}}}}})(r,i);throw i.Sc(`Unsupported field value: ${Hf(r)}`)})(t,e)}function uT(t,e){const n={};return HC(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Pa(t,((r,i)=>{const o=Bo(i,e.mc(r));o!=null&&(n[r]=o)})),{mapValue:{fields:n}}}function dT(t){return!(typeof t!="object"||t===null||t instanceof Array||t instanceof Date||t instanceof Qt||t instanceof qs||t instanceof Gr||t instanceof un||t instanceof od||t instanceof Hs)}function R0(t,e,n){if(!dT(n)||!$C(n)){const r=Hf(n);throw r==="an object"?e.Sc(t+" a custom object"):e.Sc(t+" "+r)}}function Ry(t,e,n){if((e=wn(e))instanceof ad)return e._internalPath;if(typeof e=="string")return I0(t,e);throw Tf("Field path arguments must be of type string or ",t,!1,void 0,n)}const g6=new RegExp("[~\\*/\\[\\]]");function I0(t,e,n){if(e.search(g6)>=0)throw Tf(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new ad(...e.split("."))._internalPath}catch{throw Tf(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function Tf(t,e,n,r,i){const o=r&&!r.isEmpty(),l=i!==void 0;let d=`Function ${e}() called with invalid data`;n&&(d+=" (via `toFirestore()`)"),d+=". ";let h="";return(o||l)&&(h+=" (found",o&&(h+=` in field ${r}`),l&&(h+=` in document ${i}`),h+=")"),new Be(je.INVALID_ARGUMENT,d+t+h)}function hT(t,e){return t.some((n=>n.isEqual(e)))}class fT{constructor(e,n,r,i,o){this._firestore=e,this._userDataWriter=n,this._key=r,this._document=i,this._converter=o}get id(){return this._key.path.lastSegment()}get ref(){return new un(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new y6(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const n=this._document.data.field(k0("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n)}}}class y6 extends fT{data(){return super.data()}}function k0(t,e){return typeof e=="string"?I0(t,e):e instanceof ad?e._internalPath:e._delegate._internalPath}function _6(t){if(t.limitType==="L"&&t.explicitOrderBy.length===0)throw new Be(je.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class D0{}class b6 extends D0{}function v6(t,e,...n){let r=[];e instanceof D0&&r.push(e),r=r.concat(n),(function(o){const l=o.filter((h=>h instanceof M0)).length,d=o.filter((h=>h instanceof cm)).length;if(l>1||l>0&&d>0)throw new Be(je.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")})(r);for(const i of r)t=i._apply(t);return t}class cm extends b6{constructor(e,n,r){super(),this._field=e,this._op=n,this._value=r,this.type="where"}static _create(e,n,r){return new cm(e,n,r)}_apply(e){const n=this._parse(e);return mT(e._query,n),new hc(e.firestore,e.converter,_y(e._query,n))}_parse(e){const n=om(e.firestore);return(function(o,l,d,h,m,p,g){let v;if(m.isKeyField()){if(p==="array-contains"||p==="array-contains-any")throw new Be(je.INVALID_ARGUMENT,`Invalid Query. You can't perform '${p}' queries on documentId().`);if(p==="in"||p==="not-in"){E1(g,p);const C=[];for(const x of g)C.push(C1(h,o,x));v={arrayValue:{values:C}}}else v=C1(h,o,g)}else p!=="in"&&p!=="not-in"&&p!=="array-contains-any"||E1(g,p),v=p6(d,l,g,p==="in"||p==="not-in");return vn.create(m,p,v)})(e._query,"where",n,e.firestore._databaseId,this._field,this._op,this._value)}}function x6(t,e,n){const r=e,i=k0("where",t);return cm._create(i,r,n)}class M0 extends D0{constructor(e,n){super(),this.type=e,this._queryConstraints=n}static _create(e,n){return new M0(e,n)}_parse(e){const n=this._queryConstraints.map((r=>r._parse(e))).filter((r=>r.getFilters().length>0));return n.length===1?n[0]:fs.create(n,this._getOperator())}_apply(e){const n=this._parse(e);return n.getFilters().length===0?e:((function(i,o){let l=i;const d=o.getFlattenedFilters();for(const h of d)mT(l,h),l=_y(l,h)})(e._query,n),new hc(e.firestore,e.converter,_y(e._query,n)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function C1(t,e,n){if(typeof(n=wn(n))=="string"){if(n==="")throw new Be(je.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!aE(e)&&n.indexOf("/")!==-1)throw new Be(je.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=e.path.child(Vt.fromString(n));if(!Ge.isDocumentKey(r))throw new Be(je.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Fw(t,new Ge(r))}if(n instanceof un)return Fw(t,n._key);throw new Be(je.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Hf(n)}.`)}function E1(t,e){if(!Array.isArray(t)||t.length===0)throw new Be(je.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function mT(t,e){const n=(function(i,o){for(const l of i)for(const d of l.getFlattenedFilters())if(o.indexOf(d.op)>=0)return d.op;return null})(t.filters,(function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(e.op));if(n!==null)throw n===e.op?new Be(je.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new Be(je.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}class w6{convertValue(e,n="none"){switch(Ta(e)){case 0:return null;case 1:return e.booleanValue;case 2:return ln(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,n);case 5:return e.stringValue;case 6:return this.convertBytes(Ea(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,n);case 11:return this.convertObject(e.mapValue,n);case 10:return this.convertVectorValue(e.mapValue);default:throw Ke(62114,{value:e})}}convertObject(e,n){return this.convertObjectMap(e.fields,n)}convertObjectMap(e,n="none"){const r={};return Pa(e,((i,o)=>{r[i]=this.convertValue(o,n)})),r}convertVectorValue(e){const n=e.fields?.[yf].arrayValue?.values?.map((r=>ln(r.doubleValue)));return new Hs(n)}convertGeoPoint(e){return new qs(ln(e.latitude),ln(e.longitude))}convertArray(e,n){return(e.values||[]).map((r=>this.convertValue(r,n)))}convertServerTimestamp(e,n){switch(n){case"previous":const r=Wf(e);return r==null?null:this.convertValue(r,n);case"estimate":return this.convertTimestamp(zu(e));default:return null}}convertTimestamp(e){const n=Ca(e);return new Qt(n.seconds,n.nanos)}convertDocumentKey(e,n){const r=Vt.fromString(e);It(RE(r),9688,{name:e});const i=new Bu(r.get(1),r.get(3)),o=new Ge(r.popFirst(5));return i.isEqual(n)||wi(`Document ${o} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${n.projectId}/${n.database}) instead.`),o}}function pT(t,e,n){let r;return r=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,r}class Cu{constructor(e,n){this.hasPendingWrites=e,this.fromCache=n}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Eo extends fT{constructor(e,n,r,i,o,l){super(e,n,r,i,l),this._firestore=e,this._firestoreImpl=e,this.metadata=o}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const n=new nf(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(n,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,n={}){if(this._document){const r=this._document.data.field(k0("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,n.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new Be(je.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,n={};return n.type=Eo._jsonSchemaVersion,n.bundle="",n.bundleSource="DocumentSnapshot",n.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?n:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),n.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),n)}}Eo._jsonSchemaVersion="firestore/documentSnapshot/1.0",Eo._jsonSchema={type:xn("string",Eo._jsonSchemaVersion),bundleSource:xn("string","DocumentSnapshot"),bundleName:xn("string"),bundle:xn("string")};class nf extends Eo{data(e={}){return super.data(e)}}class Fl{constructor(e,n,r,i){this._firestore=e,this._userDataWriter=n,this._snapshot=i,this.metadata=new Cu(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){const e=[];return this.forEach((n=>e.push(n))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,n){this._snapshot.docs.forEach((r=>{e.call(n,new nf(this._firestore,this._userDataWriter,r.key,r,new Cu(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const n=!!e.includeMetadataChanges;if(n&&this._snapshot.excludesMetadataChanges)throw new Be(je.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===n||(this._cachedChanges=(function(i,o){if(i._snapshot.oldDocs.isEmpty()){let l=0;return i._snapshot.docChanges.map((d=>{const h=new nf(i._firestore,i._userDataWriter,d.doc.key,d.doc,new Cu(i._snapshot.mutatedKeys.has(d.doc.key),i._snapshot.fromCache),i.query.converter);return d.doc,{type:"added",doc:h,oldIndex:-1,newIndex:l++}}))}{let l=i._snapshot.oldDocs;return i._snapshot.docChanges.filter((d=>o||d.type!==3)).map((d=>{const h=new nf(i._firestore,i._userDataWriter,d.doc.key,d.doc,new Cu(i._snapshot.mutatedKeys.has(d.doc.key),i._snapshot.fromCache),i.query.converter);let m=-1,p=-1;return d.type!==0&&(m=l.indexOf(d.doc.key),l=l.delete(d.doc.key)),d.type!==1&&(l=l.add(d.doc),p=l.indexOf(d.doc.key)),{type:S6(d.type),doc:h,oldIndex:m,newIndex:p}}))}})(this,n),this._cachedChangesIncludeMetadataChanges=n),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new Be(je.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=Fl._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=r0.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const n=[],r=[],i=[];return this.docs.forEach((o=>{o._document!==null&&(n.push(o._document),r.push(this._userDataWriter.convertObjectMap(o._document.data.value.mapValue.fields,"previous")),i.push(o.ref.path))})),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function S6(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Ke(61501,{type:t})}}function C6(t){t=hs(t,un);const e=hs(t.firestore,zo);return a6(im(e),t._key).then((n=>R6(e,t,n)))}Fl._jsonSchemaVersion="firestore/querySnapshot/1.0",Fl._jsonSchema={type:xn("string",Fl._jsonSchemaVersion),bundleSource:xn("string","QuerySnapshot"),bundleName:xn("string"),bundle:xn("string")};class gT extends w6{constructor(e){super(),this.firestore=e}convertBytes(e){return new Gr(e)}convertReference(e){const n=this.convertDocumentKey(e,this.firestore._databaseId);return new un(this.firestore,null,n)}}function E6(t){t=hs(t,hc);const e=hs(t.firestore,zo),n=im(e),r=new gT(e);return _6(t._query),o6(n,t._query).then((i=>new Fl(e,r,t,i)))}function T6(t,e,n){t=hs(t,un);const r=hs(t.firestore,zo),i=pT(t.converter,e,n);return um(r,[aT(om(r),"setDoc",t._key,i,t.converter!==null,n).toMutation(t._key,yr.none())])}function A6(t,e,n,...r){t=hs(t,un);const i=hs(t.firestore,zo),o=om(i);let l;return l=typeof(e=wn(e))=="string"||e instanceof ad?cT(o,"updateDoc",t._key,e,n,r):lT(o,"updateDoc",t._key,e),um(i,[l.toMutation(t._key,yr.exists(!0))])}function j6(t){return um(hs(t.firestore,zo),[new Jf(t._key,yr.none())])}function um(t,e){return(function(r,i){const o=new yi;return r.asyncQueue.enqueueAndForget((async()=>WN(await i6(r),i,o))),o.promise})(im(t),e)}function R6(t,e,n){const r=n.docs.get(e._key),i=new gT(t);return new Eo(t,i,e._key,r,new Cu(n.hasPendingWrites,n.fromCache),e.converter)}class I6{constructor(e,n){this._firestore=e,this._commitHandler=n,this._mutations=[],this._committed=!1,this._dataReader=om(e)}set(e,n,r){this._verifyNotCommitted();const i=Ug(e,this._firestore),o=pT(i.converter,n,r),l=aT(this._dataReader,"WriteBatch.set",i._key,o,i.converter!==null,r);return this._mutations.push(l.toMutation(i._key,yr.none())),this}update(e,n,r,...i){this._verifyNotCommitted();const o=Ug(e,this._firestore);let l;return l=typeof(n=wn(n))=="string"||n instanceof ad?cT(this._dataReader,"WriteBatch.update",o._key,n,r,i):lT(this._dataReader,"WriteBatch.update",o._key,n),this._mutations.push(l.toMutation(o._key,yr.exists(!0))),this}delete(e){this._verifyNotCommitted();const n=Ug(e,this._firestore);return this._mutations=this._mutations.concat(new Jf(n._key,yr.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new Be(je.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Ug(t,e){if((t=wn(t)).firestore!==e)throw new Be(je.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}function Uu(...t){return new A0("arrayUnion",t)}function T1(...t){return new j0("arrayRemove",t)}function yT(t){return im(t=hs(t,zo)),new I6(t,(e=>um(t,e)))}(function(e,n=!0){(function(i){lc=i})(sc),Vl(new jo("firestore",((r,{instanceIdentifier:i,options:o})=>{const l=r.getProvider("app").getImmediate(),d=new zo(new pM(r.getProvider("auth-internal")),new _M(l,r.getProvider("app-check-internal")),(function(m,p){if(!Object.prototype.hasOwnProperty.apply(m.options,["projectId"]))throw new Be(je.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Bu(m.options.projectId,p)})(l,i),l);return o={useFetchStreams:n,...o},d._setSettings(o),d}),"PUBLIC").setMultipleInstances(!0)),ba(jw,Rw,e),ba(jw,Rw,"esm2020")})();function Lo(){return u6(MC)}const Yt={showGroupTotals:!1};function Uo(t,e,n,r=1,i,o){let l=e;if(e.startsWith("budgets/"))l="budgets";else if(e.startsWith("months/")){const p=e.replace("months/","").split("_");if(p.length>=2){const g=p[p.length-1];l=`months/${p[p.length-2]}/${g}`}}console.log(`[Firebase] ${t}(${r}): ${l}${i===!1?" [NOT FOUND]":""}`)}async function Rt(t,e,n){const r=fc(Lo(),t,e),i=`${t}/${e}`,o=await C6(r),l=o.exists(),d=l?o.data():null;return Uo("READ",i,n,1,l),{exists:l,data:d,ref:r}}async function On(t,e,n){const r=Lo(),i=c6(r,t);let o;if(n&&n.length>0){const m=n.map(p=>x6(p.field,p.op,p.value));o=v6(i,...m)}else o=i;const l=await E6(o),d=l.docs.map(m=>({id:m.id,data:m.data()}));let h=t;if(n&&n.length>0){const m=n.map(p=>`${p.field} ${p.op} ${JSON.stringify(p.value)}`).join(", ");h+=` WHERE ${m}`}return Uo("QUERY",h,e,l.docs.length,void 0),{docs:d}}async function Hn(t,e,n,r,i){const o=fc(Lo(),t,e),l=`${t}/${e}`;return Uo("WRITE",l,r,1,void 0),T6(o,n,i??{})}async function dm(t,e){const r=Lo();for(let i=0;i<t.length;i+=500){const o=t.slice(i,i+500),l=yT(r);for(const{collectionPath:d,docId:h,data:m}of o){const p=fc(r,d,h);l.set(p,m)}Uo("BATCH_WRITE",`${o.length} docs`,e,o.length,void 0);try{await l.commit()}catch(d){throw console.error(`[Firebase] BATCH_WRITE ERROR in ${e}:`,d),console.error("[Firebase] Failed batch details:",{batchIndex:Math.floor(i/500)+1,totalBatches:Math.ceil(t.length/500),docsInBatch:o.length,firstDoc:o[0]?`${o[0].collectionPath}/${o[0].docId}`:"none"}),d}}}async function Af(t,e,n,r){const i=fc(Lo(),t,e),o=`${t}/${e}`;return Uo("UPDATE",o,r,1,void 0),A6(i,n)}async function Iy(t,e,n){const r=fc(Lo(),t,e),i=`${t}/${e}`;return Uo("DELETE",i),j6(r)}async function _T(t,e,n){const i=Lo();for(let o=0;o<t.length;o+=500){const l=t.slice(o,o+500),d=yT(i);for(const{collectionPath:h,docId:m}of l){const p=fc(i,h,m);d.delete(p)}Uo("BATCH_DELETE",`${l.length} docs`,e,l.length),await d.commit(),n?.(o+l.length)}}const bo={mobile:640,tablet:768,wide:1200},k6=bo.mobile,Fu=["January","February","March","April","May","June","July","August","September","October","November","December"],Ra=3,jf=3,Jt="ungrouped_accounts",cn="ungrouped_categories";function D6(t={}){const e={};return Object.entries(t).forEach(([n,r])=>{e[n]={nickname:r.nickname??"",description:r.description??"",balance:r.balance??0,account_group_id:r.account_group_id??Jt,sort_order:r.sort_order??0,is_income_account:r.is_income_account??!1,is_income_default:r.is_income_default??!1,is_outgo_account:r.is_outgo_account??!1,is_outgo_default:r.is_outgo_default??!1,on_budget:r.on_budget??!0,is_active:r.is_active??!0}}),e}function M6(t={}){const e={};return Object.entries(t).forEach(([n,r])=>{e[n]={name:r.name,sort_order:r.sort_order??0,expected_balance:r.expected_balance??"positive",on_budget:r.on_budget!==void 0?r.on_budget:null,is_active:r.is_active!==void 0?r.is_active:null}}),e[Jt]||(e[Jt]={name:"Ungrouped",sort_order:0,expected_balance:"positive",on_budget:null,is_active:null}),e}function O6(t={}){const e={};return Object.entries(t).forEach(([n,r])=>{e[n]={name:r.name,description:r.description,category_group_id:r.category_group_id??cn,sort_order:r.sort_order??0,default_monthly_amount:r.default_monthly_amount,default_monthly_type:r.default_monthly_type,balance:r.balance??0,is_hidden:r.is_hidden??!1}}),e}function N6(t=[]){const e=t.map(r=>({id:r.id,name:r.name,sort_order:r.sort_order??0}));return e.some(r=>r.id===cn)||e.push({id:cn,name:"Uncategorized",sort_order:0}),e.sort((r,i)=>r.sort_order-i.sort_order),e}function P6(t={}){const e={};return Object.entries(t).forEach(([n,r])=>{e[n]={needs_recalculation:r?.needs_recalculation??!1}}),e}async function O0(t){const{exists:e,data:n}=await Rt("budgets",t,"loading budget data (cache miss or stale)");if(!e||!n)throw new Error(`Budget ${t} not found`);const r=D6(n.accounts),i=M6(n.account_groups),o=O6(n.categories),l=N6(n.category_groups),d=n.total_available??0,h=P6(n.month_map),m=n.is_needs_recalculation??!1;return{budget:{id:t,name:n.name,user_ids:n.user_ids||[],accepted_user_ids:n.accepted_user_ids||[],owner_id:n.owner_id||n.user_ids?.[0]||"",owner_email:n.owner_email||"",accounts:r,account_groups:i,categories:o,category_groups:l,total_available:d,is_needs_recalculation:m,month_map:h},accounts:r,accountGroups:i,categories:o,categoryGroups:l,isNeedsRecalculation:m,monthMap:h}}function z6(t,e){const{initialDataLoadComplete:n}=Ye(),r=!!t&&e?.enabled!==!1&&n;return Mo({queryKey:t?Ie.budget(t):["budget","none"],queryFn:()=>O0(t),enabled:r,staleTime:oc})}function ms(t,e,n){const r=n.toString().padStart(2,"0");return`${t}_${e}_${r}`}function Zl(t,e){return e===1?{year:t-1,month:12}:{year:t,month:e-1}}function bT(t,e){return e===12?{year:t+1,month:1}:{year:t,month:e+1}}function gt(t,e){return`${t}${e.toString().padStart(2,"0")}`}function ky(t){return new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit"})}function hm(t,e){const n=new Date,r=n.getFullYear(),i=n.getMonth()+1;if(t===r&&e===i){const o=n.getDate();return`${r}-${String(i).padStart(2,"0")}-${String(o).padStart(2,"0")}`}return`${t}-${String(e).padStart(2,"0")}-01`}function fm(t){const[e,n]=t.split("-").map(Number);return{year:e,month:n}}function Me(t){return Math.round((t+Number.EPSILON)*100)/100}function ut(t){if(t==null||isNaN(t))return!1;const e=t*100;return Math.abs(e-Math.round(e))>1e-9}function Ia(t){if(t==null)return t;if(Array.isArray(t))return t.map(e=>Ia(e));if(typeof t=="object"){const e={};for(const[n,r]of Object.entries(t))r!==void 0&&(e[n]=Ia(r));return e}return t}function B6(t,e,n,r){return{budget_id:e,year_month_ordinal:t.year_month_ordinal??gt(n,r),year:t.year??n,month:t.month??r,income:t.income||[],total_income:t.total_income??0,previous_month_income:t.previous_month_income??0,expenses:t.expenses||[],total_expenses:t.total_expenses??0,transfers:t.transfers||[],adjustments:t.adjustments||[],account_balances:t.account_balances||[],category_balances:t.category_balances||[],are_allocations_finalized:t.are_allocations_finalized??!1,created_at:t.created_at,updated_at:t.updated_at}}async function Wr(t,e,n,r){const i=ms(t,e,n);return(await Le.fetchQuery({queryKey:Ie.month(t,e,n),queryFn:async()=>{const{exists:l,data:d}=await Rt("months",i,r?.description??`reading month ${e}/${n}`);return!l||!d?null:{month:B6(d,t,e,n)}},staleTime:oc}))?.month??null}async function L6(t,e,n){const r=gt(e,n);return(await On("months","getFutureMonths: querying months after specified month",[{field:"budget_id",op:"==",value:t},{field:"year_month_ordinal",op:">",value:r}])).docs.map(l=>({id:l.id,...l.data})).sort((l,d)=>l.year!==d.year?l.year-d.year:l.month-d.month)}function U6(t){const e={},n={};return t.category_balances&&t.category_balances.forEach(r=>{e[r.category_id]=r.end_balance}),t.account_balances&&t.account_balances.forEach(r=>{n[r.account_id]=r.end_balance}),{categoryEndBalances:e,accountEndBalances:n}}function F6(){const t=new Date,e=t.getFullYear(),n=t.getMonth()+1,r=[];for(let i=jf;i>0;i--){let o=e,l=n-i;for(;l<1;)l+=12,o-=1;r.push(gt(o,l))}r.push(gt(e,n));for(let i=1;i<=Ra;i++){let o=e,l=n+i;for(;l>12;)l-=12,o+=1;r.push(gt(o,l))}return r}function V6(t,e){const n=Ie.budget(t),r=Le.getQueryData(n);if(!r?.monthMap)return!1;for(const[i,o]of Object.entries(r.monthMap))if(i>=e&&!o.needs_recalculation)return!1;return!0}function $6(t,e,n){const r=Ie.budget(t),i=Le.getQueryData(r);i&&Le.setQueryData(r,{...i,isNeedsRecalculation:!0,monthMap:n,budget:{...i.budget,is_needs_recalculation:!0,month_map:n}})}function q6(t,e,n){const r=Ie.budget(t),i=Le.getQueryData(r);i&&Le.setQueryData(r,{...i,monthMap:e,budget:{...i.budget,month_map:e}})}function H6(t,e,n,r){const i=gt(e,n),o=Ie.budget(t),l=Le.getQueryData(o);if(!l)return console.warn(`[removeMonthFromMap] Budget ${t} not found in cache`),{};const d=l.monthMap||{},{[i]:h,...m}=d,p=m;return Le.setQueryData(o,{...l,monthMap:p,budget:{...l.budget,month_map:p}}),r&&r({type:"budget",budgetId:t}),p}async function G6(t,e,n,r){const{bypassDateLimit:i=!1}={},o=new Date,l=o.getFullYear(),d=o.getMonth()+1,h=(e-l)*12+(n-d);if(!i&&h>Ra){const j=`[createMonth] Refusing to create month ${e}/${n} - it's ${h} months in the future (max allowed: ${Ra}). This likely indicates a bug in month navigation.`;throw console.error(j),new Error(j)}if(!i&&h<-jf){const j=`[createMonth] Refusing to create month ${e}/${n} - it's ${Math.abs(h)} months in the past (max allowed: ${jf}). Existing months can still be viewed, but new months cannot be created this far back.`;throw console.error(j),new Error(j)}const{exists:m,data:p}=await Rt("budgets",t,"validating budget exists before creating month");if(!m||!p){Le.removeQueries({queryKey:Ie.budget(t)});const j=`[createMonth] Budget ${t} does not exist. It may have been deleted. Please refresh the page.`;throw console.error(j),new Error(j)}const g=o.toISOString(),v=ms(t,e,n);let b=0,C={},x={};if(n>1||e>new Date().getFullYear()-10){const{year:j,month:N}=Zl(e,n),F=ms(t,j,N);try{const{exists:q,data:A}=await Rt("months",F,"fetching previous month to create start balances for new month");if(q&&A){const P={budget_id:t,year_month_ordinal:A.year_month_ordinal??gt(j,N),year:A.year??j,month:A.month??N,income:A.income||[],total_income:A.total_income??0,previous_month_income:A.previous_month_income??0,expenses:A.expenses||[],total_expenses:A.total_expenses??0,transfers:A.transfers||[],adjustments:A.adjustments||[],account_balances:A.account_balances||[],category_balances:A.category_balances||[],are_allocations_finalized:A.are_allocations_finalized??!1,created_at:A.created_at,updated_at:A.updated_at};b=P.total_income;const{categoryEndBalances:O,accountEndBalances:X}=U6(P);C=O,x=X}}catch(q){if(q instanceof Error&&q.message.includes("Missing or insufficient permissions"))console.warn(`[createMonth] Permission error reading previous month ${j}/${N}, starting with zero balances`);else throw q}}const S=Object.entries(C).map(([j,N])=>({category_id:j,start_balance:N,allocated:0,spent:0,transfers:0,adjustments:0,end_balance:N})),E=Object.entries(x).map(([j,N])=>({account_id:j,start_balance:N,income:0,expenses:0,transfers:0,adjustments:0,net_change:0,end_balance:N})),T={budget_id:t,year_month_ordinal:gt(e,n),year:e,month:n,income:[],total_income:0,previous_month_income:b,expenses:[],total_expenses:0,transfers:[],adjustments:[],account_balances:E,category_balances:S,are_allocations_finalized:!1,created_at:g,updated_at:g},I={budget_id:t,year_month_ordinal:gt(e,n),year:e,month:n,income:[],total_income:0,previous_month_income:b,expenses:[],total_expenses:0,transfers:[],adjustments:[],account_balances:E,category_balances:S,are_allocations_finalized:!1,created_at:g,updated_at:g};await Hn("months",v,I,"creating new month document (first time viewing this month)"),Le.setQueryData(Ie.month(t,e,n),{month:T});const D=gt(e,n),$={...p.month_map||{},[D]:{needs_recalculation:!1}},k=$;return q6(t,k),await Af("budgets",t,{month_map:k,updated_at:g},`adding month ${e}/${n} to budget month_map`),T}function Q6(t,e,n,r){return{budget_id:e,year_month_ordinal:t.year_month_ordinal??gt(n,r),year:t.year??n,month:t.month??r,income:t.income||[],total_income:t.total_income??0,previous_month_income:t.previous_month_income??0,expenses:t.expenses||[],total_expenses:t.total_expenses??0,transfers:t.transfers||[],adjustments:t.adjustments||[],account_balances:t.account_balances||[],category_balances:t.category_balances||[],are_allocations_finalized:t.are_allocations_finalized??!1,created_at:t.created_at,updated_at:t.updated_at}}async function N0(t,e,n){const r=ms(t,e,n);try{const{exists:i,data:o}=await Rt("months",r,`loading month ${e}/${n}`);return!i||!o?null:Q6(o,t,e,n)}catch(i){if(i instanceof Error&&i.message.includes("Missing or insufficient permissions"))return console.warn(`[readMonthDirect] Permission error reading month ${e}/${n}, treating as not found`),null;throw i}}async function W6(t,e,n,r){const i=await N0(t,e,n);if(i)return i;let o=!1;if(r){const l=r.getQueryData(Ie.budget(t));l?.monthMap&&(o=gt(e,n)in l.monthMap)}else{const{exists:l,data:d}=await Rt("budgets",t,"checking month_map before creating month");if(l&&d?.month_map){const h=gt(e,n),m=d.month_map;o=h in m}}if(o)return G6(t,e,n);throw new Error(`Month ${e}/${n} does not exist in budget. Cannot create months that are not in month_map.`)}function K6(t,e,n,r){const i=$t(),{initialDataLoadComplete:o}=Ye(),l=t?Ie.month(t,e,n):["month","none"],d=!!t&&r?.enabled!==!1&&o;return Mo({queryKey:l,queryFn:async()=>({month:await W6(t,e,n,i)}),enabled:d,staleTime:oc})}async function P0(t){const{exists:e,data:n}=await Rt("payees",t,"loading payees for autocomplete (cache miss or stale)");return e&&n?n.payees||[]:[]}function z0(t,e){const{initialDataLoadComplete:n}=Ye(),r=!!t&&e?.enabled!==!1&&n;return Mo({queryKey:t?Ie.payees(t):["payees","none"],queryFn:()=>P0(t),enabled:r,staleTime:oc})}async function Y6(t,e){const{exists:n,data:r}=await Rt("users",t,"loading user profile (cache miss or stale)");if(n&&r)return r;const i={uid:t,email:e,budget_ids:[],created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return await Hn("users",t,i,"creating new user document (first login)"),i}function X6(t,e,n){return Mo({queryKey:t?Ie.user(t):["user","none"],queryFn:()=>Y6(t,e),enabled:!!t&&n?.enabled!==!1})}async function Z6(t,e){const n=await On("budgets","loading budgets user has access to (cache miss or stale)",[{field:"user_ids",op:"array-contains",value:t}]),r=[],i=[];for(const o of n.docs){const l=o.data;l.accepted_user_ids?.includes(t)||e?.budget_ids?.includes(o.id)?r.push({id:o.id,name:l.name||"Unnamed Budget",ownerEmail:l.owner_email||null,isOwner:l.owner_id===t,isPending:!1}):i.push({budgetId:o.id,budgetName:l.name||"Unnamed Budget",ownerEmail:l.owner_email||null})}return{budgets:r,pendingInvites:i}}function J6(t,e,n){return Mo({queryKey:t?Ie.accessibleBudgets(t):["accessibleBudgets","none"],queryFn:async()=>t?Z6(t,e):{budgets:[],pendingInvites:[]},enabled:!!t&&n?.enabled!==!1,staleTime:60*1e3})}function e4(t){if(Array.isArray(t))return t;if(t&&typeof t=="object"&&!Array.isArray(t)){const e=t;if(e._methodName==="arrayUnion"&&Array.isArray(e.vc))return console.warn("[fetchFeedback] Found corrupted arrayUnion in feedback document - extracting items from vc"),e.vc}return[]}async function t4(){const t=await On("feedback","admin loading all feedback (cache miss or stale)"),e=[];for(const n of t.docs){const r=e4(n.data.items),i=n.data.user_email||n.id;r.forEach(o=>{e.push({...o,doc_id:n.id,user_email:i})})}return{items:e}}function n4(t){return Mo({queryKey:Ie.feedback(),queryFn:t4,enabled:t?.enabled!==!1})}const Xt="__NO_CATEGORY__",Do="No Category";function it(t){return t===Xt}const Gt="__NO_ACCOUNT__",ka="No Account";function Je(t){return t===Gt}const B0={categoryEndBalances:{},accountEndBalances:{},totalIncome:0};function L0(t,e){const n=t.income||[],r=t.expenses||[],i=Me(n.reduce((g,v)=>g+v.amount,0)),o=Me(r.reduce((g,v)=>g+v.amount,0)),l=r4(t),{transfersMap:d,adjustmentsMap:h}=s4(t),m=i4(t.category_balances,e.categoryEndBalances,l,d,h),p=a4(t,e.accountEndBalances);return{...t,total_income:i,total_expenses:o,previous_month_income:e.totalIncome,category_balances:m,account_balances:p,updated_at:new Date().toISOString()}}function r4(t){const e={};for(const n of t.transfers||[])it(n.from_category_id)||(e[n.from_category_id]=(e[n.from_category_id]||0)-n.amount),it(n.to_category_id)||(e[n.to_category_id]=(e[n.to_category_id]||0)+n.amount);for(const n of t.adjustments||[])it(n.category_id)||(e[n.category_id]=(e[n.category_id]||0)+n.amount);for(const n of Object.keys(e))e[n]=Me(e[n]);return e}function s4(t){const e={},n={};for(const r of t.transfers||[])it(r.from_category_id)||(e[r.from_category_id]=(e[r.from_category_id]||0)-r.amount),it(r.to_category_id)||(e[r.to_category_id]=(e[r.to_category_id]||0)+r.amount);for(const r of t.adjustments||[])it(r.category_id)||(n[r.category_id]=(n[r.category_id]||0)+r.amount);for(const r of Object.keys(e))e[r]=Me(e[r]);for(const r of Object.keys(n))n[r]=Me(n[r]);return{transfersMap:e,adjustmentsMap:n}}function i4(t,e,n,r,i){const o=new Map;for(const h of t)it(h.category_id)||o.set(h.category_id,h);const l=new Set;for(const h of t)it(h.category_id)||l.add(h.category_id);for(const h of Object.keys(e))it(h)||l.add(h);for(const h of Object.keys(n))it(h)||l.add(h);const d=[];for(const h of l){const m=o.get(h),p=Me(e[h]??0),g=Me(m?.allocated??0),v=Me(m?.spent??0),b=Me(r[h]??0),C=Me(i[h]??0);d.push({category_id:h,start_balance:p,allocated:g,spent:v,transfers:b,adjustments:C,end_balance:Me(p+g+v+b+C)})}return d}function a4(t,e){const n=new Set;for(const i of t.income||[])Je(i.account_id)||n.add(i.account_id);for(const i of t.expenses||[])Je(i.account_id)||n.add(i.account_id);for(const i of t.transfers||[])Je(i.from_account_id)||n.add(i.from_account_id),Je(i.to_account_id)||n.add(i.to_account_id);for(const i of t.adjustments||[])Je(i.account_id)||n.add(i.account_id);for(const i of Object.keys(e))Je(i)||n.add(i);for(const i of t.account_balances||[])Je(i.account_id)||n.add(i.account_id);const r=[];for(const i of n){const o=Me(e[i]??0),l=Me((t.income||[]).filter(b=>b.account_id===i).reduce((b,C)=>b+C.amount,0)),d=Me((t.expenses||[]).filter(b=>b.account_id===i).reduce((b,C)=>b+C.amount,0)),h=Me((t.transfers||[]).filter(b=>b.from_account_id===i).reduce((b,C)=>b-C.amount,0)),m=Me((t.transfers||[]).filter(b=>b.to_account_id===i).reduce((b,C)=>b+C.amount,0)),p=Me(m+h),g=Me((t.adjustments||[]).filter(b=>b.account_id===i).reduce((b,C)=>b+C.amount,0)),v=Me(l+d+p+g);r.push({account_id:i,start_balance:o,income:l,expenses:d,transfers:p,adjustments:g,net_change:v,end_balance:Me(o+v)})}return r}function Vu(t){const e={},n={};for(const r of t.category_balances||[])it(r.category_id)||(e[r.category_id]=Me(r.end_balance));for(const r of t.account_balances||[])Je(r.account_id)||(n[r.account_id]=Me(r.end_balance));return{categoryEndBalances:e,accountEndBalances:n,totalIncome:Me(t.total_income)}}const o4=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function l4(t){return{year:parseInt(t.slice(0,4),10),month:parseInt(t.slice(4,6),10)}}function vT(t={}){const e={};return Object.entries(t).forEach(([n,r])=>{e[n]={needs_recalculation:r?.needs_recalculation??!1}}),e}function xT(t){return Object.entries(t).filter(([,e])=>e.needs_recalculation).map(([e])=>e).sort()}function c4(t){return Object.keys(t).sort()}async function u4(t,e){const{year:n,month:r}=l4(e),i=ms(t,n,r),{exists:o,data:l}=await Rt("months",i,`[recalc] fetching month ${n}/${r}`);return!o||!l?null:{id:i,budget_id:t,year_month_ordinal:l.year_month_ordinal??gt(n,r),year:l.year??n,month:l.month??r,income:l.income||[],total_income:l.total_income??0,previous_month_income:l.previous_month_income??0,expenses:l.expenses||[],total_expenses:l.total_expenses??0,transfers:l.transfers||[],adjustments:l.adjustments||[],account_balances:l.account_balances||[],category_balances:l.category_balances||[],are_allocations_finalized:l.are_allocations_finalized??!1,created_at:l.created_at,updated_at:l.updated_at}}async function d4(t,e,n){n?.(0,e.length);const r=await Promise.all(e.map(i=>u4(t,i)));return n?.(e.length,e.length),r.filter(i=>i!==null)}function U0(t){const e={};for(const n of Object.keys(t))e[n]={needs_recalculation:!1};return e}function F0(t,e,n){const r=Object.entries(t).reduce((o,[,l])=>{const d=l.account_group_id?n[l.account_group_id]:void 0,h=d&&d.on_budget!==null?d.on_budget:l.on_budget!==!1,m=d&&d.is_active!==null?d.is_active:l.is_active!==!1;return h&&m?o+(l.balance??0):o},0),i=Object.values(e).reduce((o,l)=>{const d=l.balance??0;return o+(d>0?d:0)},0);return Me(r-i)}async function wT(t,e,n,r){const{exists:i,data:o}=await Rt("budgets",t,"[recalc] reading budget for balance update");if(!i||!o)return;const l={...o.accounts};for(const[p,g]of Object.entries(e))l[p]&&(l[p]={...l[p],balance:Me(g)});const d={...o.categories};for(const[p,g]of Object.entries(n))d[p]&&(d[p]={...d[p],balance:Me(g)});const h=U0(r),m=F0(l,d,o.account_groups||{});await Hn("budgets",t,{...o,accounts:l,categories:d,total_available:m,is_needs_recalculation:!1,month_map:h,updated_at:new Date().toISOString()},"[recalc] saving balances and clearing flags"),f4(t,l,d,m,h)}function h4(t,e){const n=Le.getQueryData(Ie.budget(t));n&&Le.setQueryData(Ie.budget(t),{...n,isNeedsRecalculation:!1,monthMap:e,budget:{...n.budget,is_needs_recalculation:!1,month_map:e}})}function f4(t,e,n,r,i){const o=Le.getQueryData(Ie.budget(t));if(o){const l={};for(const[h,m]of Object.entries(o.accounts)){const p=e[h];l[h]=p?{...m,balance:p.balance??m.balance}:m}const d={};for(const[h,m]of Object.entries(o.categories)){const p=n[h];d[h]=p?{...m,balance:p.balance??m.balance}:m}Le.setQueryData(Ie.budget(t),{...o,accounts:l,categories:d,isNeedsRecalculation:!1,monthMap:i,budget:{...o.budget,accounts:e,categories:n,total_available:r,is_needs_recalculation:!1,month_map:i}})}}async function A1(t,e){const{exists:n,data:r}=await Rt("budgets",t,"[recalc] reading budget to clear flags");if(!n||!r)return;const i=U0(e);await Hn("budgets",t,{...r,total_available:F0(r.accounts||{},r.categories||{},r.account_groups||{}),is_needs_recalculation:!1,month_map:i,updated_at:new Date().toISOString()},"[recalc] clearing flags"),h4(t,i)}const Fg=new Map;async function m4(t,e={}){const n=Fg.get(t);if(n)return n;const r=p4(t,e);Fg.set(t,r);try{return await r}finally{Fg.delete(t)}}async function p4(t,e={}){const{onProgress:n}=e;n?.({phase:"reading-budget",monthsProcessed:0,totalMonths:0,percentComplete:5});const{exists:r,data:i}=await Rt("budgets",t,"[recalc] reading budget for month_map");if(!r||!i)return n?.({phase:"complete",monthsProcessed:0,totalMonths:0,percentComplete:100}),{monthsRecalculated:0,budgetUpdated:!1};const o=vT(i.month_map),l=xT(o);if(l.length===0&&!i.is_needs_recalculation)return n?.({phase:"complete",monthsProcessed:0,totalMonths:0,percentComplete:100}),{monthsRecalculated:0,budgetUpdated:!1};const d=c4(o),h=l.length>0?l[0]:null;if(!h)return await A1(t,o),n?.({phase:"complete",monthsProcessed:0,totalMonths:0,percentComplete:100}),{monthsRecalculated:0,budgetUpdated:!0};const m=d.indexOf(h),p=m>0;let g=p?d.slice(m-1):d.slice(m);const v=new Date,b=v.getFullYear(),C=v.getMonth()+1,x=gt(b+Math.floor((C+Ra-1)/12),(C+Ra-1)%12+1);g=g.filter(q=>q<=x);const S=p?g.length-1:g.length;n?.({phase:"fetching-months",monthsFetched:0,totalMonthsToFetch:g.length,monthsProcessed:0,totalMonths:S,percentComplete:10});const E=await d4(t,g,(q,A)=>{n?.({phase:"fetching-months",monthsFetched:q,totalMonthsToFetch:A,monthsProcessed:0,totalMonths:S,percentComplete:q===0?10:30})});if(E.length===0)return await A1(t,o),n?.({phase:"complete",monthsProcessed:0,totalMonths:0,percentComplete:100}),{monthsRecalculated:0,budgetUpdated:!0};const T=p?1:0,I=E.length-1,D=I-T+1;let B=B0;p&&E.length>0&&(B=Vu(E[0]));const $=[];let k=0;for(let q=T;q<=I;q++){const A=E[q],P=`${o4[A.month-1]} ${A.year}`;n?.({phase:"recalculating",currentMonth:P,monthsProcessed:k,totalMonths:D,percentComplete:Math.round(30+k/D*40)});const O=L0(A,B);$.push(O),B=Vu(O),k++}n?.({phase:"saving",monthsProcessed:k,totalMonths:D,percentComplete:75});const j=$.map(q=>({collectionPath:"months",docId:ms(t,q.year,q.month),data:q}));await dm(j,`[recalc] batch write ${$.length} months`);for(const q of $)Le.setQueryData(Ie.month(t,q.year,q.month),{month:q});n?.({phase:"saving",monthsProcessed:k,totalMonths:D,percentComplete:92});const N=B.accountEndBalances,F=B.categoryEndBalances;return await wT(t,N,F,o),n?.({phase:"complete",monthsProcessed:k,totalMonths:D,percentComplete:100}),{monthsRecalculated:k,budgetUpdated:!0,finalAccountBalances:N}}async function g4(t,e,n){const r=gt(e,n);if(V6(t,r))return{markedCount:0,budgetUpdated:!1};const{exists:i,data:o}=await Rt("budgets",t,"reading budget for month_map update");if(!i||!o)return console.warn(`[markMonthsNeedRecalculation] Budget ${t} not found`),{markedCount:0,budgetUpdated:!1};const d={...o.month_map||{}},h=F6();for(const v of h)d[v]||(d[v]={needs_recalculation:!1});let m=0;for(const v of h)v>=r&&(d[v]?.needs_recalculation||(d[v]={needs_recalculation:!0},m++));const p=o.is_needs_recalculation===!0;if(m===0&&p)return{markedCount:0,budgetUpdated:!1};const g=d;return $6(t,r,g),await Af("budgets",t,{is_needs_recalculation:!0,month_map:g,updated_at:new Date().toISOString()},`marking budget and ${m} future months as needing recalculation`),{markedCount:m,budgetUpdated:!0}}async function y4(t,e){return Le.fetchQuery({queryKey:["budgetInvite",t,e],queryFn:async()=>{const{exists:n,data:r}=await Rt("budgets",t,"checking if user has pending invite for budget");return!n||!r?null:{isInvited:r.user_ids?.includes(e)??!1,hasAccepted:r.accepted_user_ids?.includes(e)??!1,budgetName:r.name||"Unnamed Budget",ownerEmail:r.owner_email||null}},staleTime:60*1e3})}async function Dy(t,e,n){const r=await Wr(t,e,n,{description:`fetching month for balance calculation (walking ${e}/${n})`});return r?{year:r.year,month:r.month,category_balances:r.category_balances,are_allocations_finalized:r.are_allocations_finalized,expenses:r.expenses}:null}async function _4(t,e,n,r){const i={};e.forEach(v=>{i[v]=0});const o=await Dy(t,n,r);if(o?.category_balances){for(const v of o.category_balances)e.includes(v.category_id)&&(i[v.category_id]=v.end_balance);return i}const l={};e.forEach(v=>{l[v]=0});const d=[];o&&d.push(o);let h=n,m=r,p=!1;const g=120;for(let v=0;v<g&&!p;v++){const b=Zl(h,m);h=b.year,m=b.month;const C=await Dy(t,h,m);if(!C)p=!0;else if(C.category_balances){p=!0;for(const x of C.category_balances)e.includes(x.category_id)&&(l[x.category_id]=x.end_balance)}else d.push(C)}d.reverse(),Object.assign(i,l);for(const v of d){if(v.are_allocations_finalized&&v.category_balances)for(const b of v.category_balances)e.includes(b.category_id)&&(i[b.category_id]=(i[b.category_id]||0)+b.allocated);if(v.expenses)for(const b of v.expenses)e.includes(b.category_id)&&(i[b.category_id]=(i[b.category_id]||0)-b.amount)}return i}async function b4(t,e,n,r,i){const o={...n},d=Le.getQueryData(Ie.budget(t))?.monthMap||{},h=new Date,m=h.getFullYear(),p=h.getMonth()+1;let g=m,v=p+Ra;for(;v>12;)v-=12,g+=1;const b=gt(g,v);let C=r,x=i;const S=Ra*2;for(let E=0;E<S;E++){const T=bT(C,x);C=T.year,x=T.month;const I=gt(C,x);if(I>b||!(I in d))break;const D=await Dy(t,C,x);if(!D)break;if(D.are_allocations_finalized&&D.category_balances)for(const B of D.category_balances)e.includes(B.category_id)&&(o[B.category_id]=(o[B.category_id]||0)+B.allocated);if(D.expenses)for(const B of D.expenses)e.includes(B.category_id)&&(o[B.category_id]=(o[B.category_id]||0)-B.amount)}return o}async function Vg(t,e,n,r){const i=await _4(t,e,n,r),o=await b4(t,e,i,n,r);return{current:i,total:o}}async function ST(t,e,n){const r=ms(t,e.year,e.month);await Hn("months",r,e,`writeMonthData: ${n}`)}async function CT(t,e,n){await g4(t,e,n)}async function ET(t){const{budgetId:e,month:n,description:r,cascadeRecalculation:i=!0}=t;await ST(e,n,r||`${n.year}/${n.month}`),Le.setQueryData(Ie.month(e,n.year,n.month),{month:n}),i&&await CT(e,n.year,n.month)}function v4(){const t=$t();return{writeData:Gn({mutationFn:async({budgetId:n,month:r,description:i,cascadeRecalculation:o=!0})=>(await ST(n,r,i||`${r.year}/${r.month}`),{budgetId:n,year:r.year,month:r.month,cascadeRecalculation:o}),onMutate:async({budgetId:n,month:r})=>{const i=Ie.month(n,r.year,r.month);await t.cancelQueries({queryKey:i});const o=t.getQueryData(i);return t.setQueryData(i,{month:r}),{oldMonthQueryData:o,monthKey:i}},onSuccess:async({budgetId:n,year:r,month:i,cascadeRecalculation:o})=>{o&&await CT(n,r,i)},onError:(n,r,i)=>{i?.oldMonthQueryData&&t.setQueryData(i.monthKey,i.oldMonthQueryData)}})}}function x4(t,e,n,r){const i={};t.category_balances&&t.category_balances.forEach(h=>{i[h.category_id]=h});const o=t.expenses??[],l={};for(const h of t.transfers||[])it(h.from_category_id)||(l[h.from_category_id]=(l[h.from_category_id]||0)-h.amount),it(h.to_category_id)||(l[h.to_category_id]=(l[h.to_category_id]||0)+h.amount);const d={};for(const h of t.adjustments||[])it(h.category_id)||(d[h.category_id]=(d[h.category_id]||0)+h.amount);return e.map(h=>{const m=i[h],p=Me(m?.start_balance??0),g=Me(n[h]??0),v=Me(o.filter(x=>x.category_id===h).reduce((x,S)=>x+S.amount,0)),b=Me(l[h]??0),C=Me(d[h]??0);return{category_id:h,start_balance:p,allocated:g,spent:v,transfers:b,adjustments:C,end_balance:Me(p+g+v+b+C)}})}function w4(){const{writeData:t}=v4();return{saveDraftAllocations:async(n,r,i,o)=>{const l=await Wr(n,r,i);if(!l)throw new Error(`Month not found: ${r}/${i}`);const d=l.category_balances.map(m=>({...m,allocated:o[m.category_id]??m.allocated})),h={...l,category_balances:d,updated_at:new Date().toISOString()};return await t.mutateAsync({budgetId:n,month:h,cascadeRecalculation:!1}),{updatedMonth:h}},isPending:t.isPending,isError:t.isError,error:t.error}}const me={primary:"#646cff",error:"#f87171",errorBg:"rgba(220, 38, 38, 0.1)",errorBorder:"rgba(220, 38, 38, 0.3)",success:"#4ade80",danger:"#f87171",warning:"#facc15",debt:"#fb923c",zero:"rgba(255, 255, 255, 0.4)"},cs={textDecoration:"underline",textDecorationStyle:"dotted",textUnderlineOffset:"3px"},Da="1px solid color-mix(in srgb, currentColor 20%, transparent)",Rf={maxWidth:"var(--page-max-width, 85rem)",margin:"0 auto",padding:"var(--page-padding, 2rem)"},V0={background:"color-mix(in srgb, currentColor 8%, transparent)",padding:"1rem 1.25rem",borderRadius:"8px",display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem"},S4={background:"color-mix(in srgb, currentColor 8%, transparent)",padding:"1.25rem",borderRadius:"8px",display:"flex",flexDirection:"column",gap:"1rem"},C4={display:"flex",flexDirection:"column",gap:"0.5rem"},E4={fontSize:"0.9rem",fontWeight:500},Ba={padding:"0.6rem 0.8rem",borderRadius:"6px",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"1rem",color:"inherit",width:"100%",boxSizing:"border-box"},T4={...Ba,cursor:"pointer"},$0={padding:"0.6rem 1.25rem",borderRadius:"6px",cursor:"pointer",fontWeight:500,fontSize:"0.9rem",transition:"opacity 0.15s"},TT={...$0,background:me.primary,color:"white",border:"none"},A4={...TT,padding:"0.75rem 1.5rem",borderRadius:"8px"},j4={...$0,background:"transparent",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)"},R4={...$0,background:"transparent",border:`1px solid ${me.errorBorder}`,color:me.error},I4={background:"transparent",border:"1px solid color-mix(in srgb, currentColor 25%, transparent)",padding:"0.35rem 0.75rem",borderRadius:"6px",cursor:"pointer",fontSize:"0.8rem",opacity:.8,transition:"opacity 0.15s"},fa={background:"transparent",border:"1px solid color-mix(in srgb, currentColor 15%, transparent)",padding:"0.25rem 0.35rem",borderRadius:"4px",cursor:"pointer",fontSize:"0.75rem",lineHeight:1,display:"flex",alignItems:"center",justifyContent:"center",opacity:.6,transition:"opacity 0.15s, background 0.15s"},If={display:"flex",flexDirection:"column",gap:"2px"},k4={display:"flex",gap:"0.75rem",marginTop:"0.5rem"},D4={opacity:.4,cursor:"grab"},M4={position:"absolute",top:"-4px",left:0,right:0,height:"3px",background:me.primary,borderRadius:"2px",transition:"opacity 0.15s"},O4={position:"relative",height:"2rem",marginTop:"-0.25rem"},N4={position:"absolute",top:"50%",left:0,right:0,height:"3px",background:me.primary,borderRadius:"2px",transition:"opacity 0.15s"},P4={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"0.75rem",opacity:.7,background:"var(--background, #1a1a1a)",padding:"0 0.5rem",whiteSpace:"nowrap"},z4={background:me.errorBg,border:`1px solid ${me.errorBorder}`,color:me.error,padding:"0.75rem 1rem",borderRadius:"8px",marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem"},B4={background:"transparent",border:"none",color:me.error,cursor:"pointer",fontSize:"1.2rem",padding:"0 0.25rem",lineHeight:1},AT={opacity:.7,marginBottom:"1.5rem"},j1={display:"flex",flexDirection:"column",gap:"0.5rem",marginBottom:"1.5rem"};function mm({message:t,children:e,onDismiss:n,style:r}){return u.jsxs("div",{style:{...z4,...r},children:[u.jsx("span",{children:e??t}),n&&u.jsx("button",{onClick:n,style:B4,children:""})]})}const L4={primary:TT,"primary-large":A4,secondary:j4,danger:R4,small:I4},U4={position:"absolute",bottom:"100%",left:"50%",transform:"translateX(-50%)",background:me.warning,color:"#1a1a1a",padding:"0.5rem 0.75rem",borderRadius:"6px",fontSize:"0.8rem",fontWeight:500,whiteSpace:"nowrap",marginBottom:"0.5rem",zIndex:100,boxShadow:"0 2px 8px rgba(0,0,0,0.3)",animation:"tooltipFadeIn 0.15s ease-out"},F4={position:"absolute",top:"100%",left:"50%",transform:"translateX(-50%)",width:0,height:0,borderLeft:"6px solid transparent",borderRight:"6px solid transparent",borderTop:`6px solid ${me.warning}`};function Ve({variant:t="primary",isLoading:e,loadingText:n="Saving...",children:r,disabled:i,style:o,actionName:l,disabledReason:d,onClick:h,...m}){const p=L4[t],g=i||e,[v,b]=M.useState(!1);function C(E){h?.(E)}function x(E){g&&d&&(E.preventDefault(),E.stopPropagation(),b(!0),setTimeout(()=>b(!1),3e3))}const S=g?{cursor:"not-allowed",opacity:.35,filter:"grayscale(50%)"}:{};return u.jsxs("div",{style:{position:"relative",display:"inline-block"},onClick:x,children:[v&&d&&u.jsxs("div",{style:U4,children:[d,u.jsx("div",{style:F4})]}),u.jsx("button",{disabled:g,style:{...p,cursor:g?"not-allowed":"pointer",...S,...o},onClick:C,...m,children:e?n:r})]})}function jT(t,e){const n=t.toLowerCase(),r=e.toLowerCase();if(r.includes(n)){const d=r.indexOf(n);return{match:!0,score:d===0||/\s/.test(r[d-1])?100:90}}let i=0,o=0,l=0;for(let d=0;d<r.length&&i<n.length;d++)r[d]===n[i]?(i++,l++,o+=l*2):l=0;return i===n.length?{match:!0,score:o}:{match:!1,score:0}}function RT(t){return[...t].sort((e,n)=>!e.groupId&&n.groupId?1:e.groupId&&!n.groupId?-1:!e.groupId&&!n.groupId?e.sortOrder-n.sortOrder:e.groupSortOrder!==n.groupSortOrder?e.groupSortOrder-n.groupSortOrder:e.sortOrder-n.sortOrder)}function IT(t){const e=RT(t),n=[];let r="__initial__";return e.forEach(i=>{i.groupId!==r&&(r=i.groupId,n.push({groupId:i.groupId,groupName:i.groupName,groupSortOrder:i.groupSortOrder,items:[]})),n[n.length-1].items.push(i)}),n}function kT(t,e,n){return e.trim()?t.map(i=>{const o=n(i);let l=0,d=!1;for(const h of o){const m=jT(e,h);m.match&&(d=!0,l=Math.max(l,m.score))}return{item:i,score:l,hasMatch:d}}).filter(({hasMatch:i})=>i).sort((i,o)=>o.score!==i.score?o.score-i.score:!i.item.groupId&&o.item.groupId?1:i.item.groupId&&!o.item.groupId?-1:i.item.groupSortOrder!==o.item.groupSortOrder?i.item.groupSortOrder-o.item.groupSortOrder:i.item.sortOrder-o.item.sortOrder).map(({item:i})=>i):RT(t)}const q0={position:"absolute",top:"100%",left:0,right:0,marginTop:"4px",background:"var(--background, #1a1a1a)",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",borderRadius:"6px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",zIndex:1e3},$u={padding:"0.6rem 0.8rem",cursor:"pointer",transition:"background 0.1s"};function R1({id:t,value:e,onChange:n,payees:r,placeholder:i="Enter payee name",autoFocus:o}){const[l,d]=M.useState(!1),[h,m]=M.useState(-1),p=M.useRef(null),g=M.useRef(null),v=e.trim()?r.map(x=>({payee:x,...jT(e,x)})).filter(x=>x.match).sort((x,S)=>S.score-x.score).slice(0,8).map(x=>x.payee):[];M.useEffect(()=>{function x(S){p.current&&!p.current.contains(S.target)&&d(!1)}return document.addEventListener("mousedown",x),()=>document.removeEventListener("mousedown",x)},[]);function b(x){!l||v.length===0||(x.key==="ArrowDown"?(x.preventDefault(),m(S=>Math.min(S+1,v.length-1))):x.key==="ArrowUp"?(x.preventDefault(),m(S=>Math.max(S-1,-1))):x.key==="Enter"&&h>=0?(x.preventDefault(),n(v[h]),d(!1),m(-1)):x.key==="Escape"&&(d(!1),m(-1)))}function C(x){n(x),d(!1),m(-1),g.current?.focus()}return u.jsxs("div",{ref:p,style:{position:"relative"},children:[u.jsx("input",{ref:g,id:t,type:"text",value:e,onChange:x=>{n(x.target.value),d(!0),m(-1)},onFocus:()=>d(!0),onKeyDown:b,placeholder:i,autoComplete:"off",autoFocus:o,style:Ba}),l&&v.length>0&&u.jsx("div",{style:{...q0,maxHeight:"200px",overflowY:"auto"},children:v.map((x,S)=>u.jsx("div",{onClick:()=>C(x),style:{...$u,background:S===h?`color-mix(in srgb, ${me.primary} 20%, transparent)`:"transparent",borderBottom:S<v.length-1?"1px solid color-mix(in srgb, currentColor 10%, transparent)":"none"},onMouseEnter:()=>m(S),children:x},x))})]})}function DT({id:t,value:e,onChange:n,categories:r,categoryGroups:i,placeholder:o="Search categories...",required:l,showNoCategoryOption:d=!1,showHiddenCategories:h=!1}){const m=Object.fromEntries(i.map(H=>[H.id,H.name])),p=Object.fromEntries(i.map(H=>[H.id,H.sort_order])),g=h?r:Object.fromEntries(Object.entries(r).filter(([,H])=>!H.is_hidden)),v=Object.entries(g).map(([H,Z])=>({id:H,name:Z.name,groupId:Z.category_group_id,groupName:Z.category_group_id&&m[Z.category_group_id]||null,sortOrder:Z.sort_order,groupSortOrder:Z.category_group_id?p[Z.category_group_id]??999:999})),b=e===Xt,C=b?null:e?r[e]:null,x=b?"":C?.name||"",[S,E]=M.useState(x),[T,I]=M.useState(!1),[D,B]=M.useState(-1),$=M.useRef(null),k=M.useRef(null);M.useEffect(()=>{if(e===Xt)E("");else if(e){const H=r[e];E(H?.name||"")}},[e,r]);const j=kT(v,S,H=>[H.name]),N=IT(j);M.useEffect(()=>{function H(Z){if($.current&&!$.current.contains(Z.target))if(I(!1),e===Xt)E("");else{const Y=e?r[e]:null;E(Y?.name||"")}}return document.addEventListener("mousedown",H),()=>document.removeEventListener("mousedown",H)},[e,r]);function F(H){if(H.key==="ArrowDown")H.preventDefault(),T?B(Z=>Math.min(Z+1,j.length-1)):(I(!0),B(0));else if(H.key==="ArrowUp")H.preventDefault(),B(Z=>Math.max(Z-1,0));else if(H.key==="Enter")H.preventDefault(),T&&D>=0&&j[D]&&q(j[D]);else if(H.key==="Escape")if(I(!1),B(-1),e===Xt)E("");else{const Z=e?r[e]:null;E(Z?.name||"")}else if(H.key==="Tab")if(T&&D>=0&&j[D])q(j[D]);else if(I(!1),B(-1),e===Xt)E("");else{const Z=e?r[e]:null;E(Z?.name||"")}}function q(H){n(H.id),E(H.id===Xt?"":H.name),I(!1),B(-1)}function A(){n(Xt),E(""),I(!1),B(-1)}function P(H){const Z=H.target.value;E(Z),I(!0),B(Z.trim()?0:-1),Z!==x&&(d&&Z.trim()===""?n(Xt):n(""))}function O(){I(!0),d&&(e===Xt||S.trim()==="")?B(-1):j.length>0&&B(0)}let X=-1;const W=()=>++X;return u.jsxs("div",{ref:$,style:{position:"relative"},children:[u.jsx("input",{ref:k,id:t,type:"text",value:S,onChange:P,onFocus:O,onKeyDown:F,placeholder:o,autoComplete:"off",required:l&&!d,style:{...Ba,borderColor:l&&!e?me.error:void 0}}),T&&u.jsxs("div",{style:{...q0,maxHeight:"250px",overflowY:"auto"},children:[d&&u.jsx("div",{onClick:A,onMouseEnter:()=>B(-1),style:{...$u,opacity:.7,fontStyle:"italic",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)",background:D===-1?`color-mix(in srgb, ${me.primary} 20%, transparent)`:"transparent"},children:Do}),N.map((H,Z)=>u.jsxs("div",{children:[H.groupName&&u.jsx("div",{style:{padding:"0.4rem 0.8rem",fontSize:"0.75rem",textTransform:"uppercase",letterSpacing:"0.5px",opacity:.6,background:"color-mix(in srgb, currentColor 5%, transparent)",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},children:H.groupName}),H.items.map(Y=>{const se=W();return u.jsx("div",{onClick:()=>q(Y),style:{...$u,paddingLeft:H.groupName?"1.2rem":"0.8rem",background:se===D?`color-mix(in srgb, ${me.primary} 20%, transparent)`:"transparent",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},onMouseEnter:()=>B(se),children:Y.name},Y.id)})]},`group-${Z}`)),j.length===0&&S.trim()&&!d&&u.jsx("div",{style:{padding:"0.6rem 0.8rem",opacity:.6,fontStyle:"italic"},children:"No matching categories"})]})]})}function MT({id:t,value:e,onChange:n,accounts:r,accountGroups:i,placeholder:o="Search accounts...",required:l,showNoAccountOption:d=!1,showHiddenAccounts:h=!1}){const p=(h?r:r.filter(([,X])=>!X.is_hidden)).map(([X,W])=>({id:X,name:W.nickname,groupId:W.account_group_id,groupName:W.account_group_id&&i[W.account_group_id]?.name||null,sortOrder:W.sort_order,groupSortOrder:W.account_group_id?i[W.account_group_id]?.sort_order??999:999})),g=e===Gt,v=g?null:r.find(([X])=>X===e)?.[1],b=g?"":v?.nickname||"",[C,x]=M.useState(b),[S,E]=M.useState(!1),[T,I]=M.useState(-1),D=M.useRef(null),B=M.useRef(null);M.useEffect(()=>{if(e===Gt)x("");else if(e){const X=r.find(([W])=>W===e)?.[1];x(X?.nickname||"")}},[e,r]);const $=kT(p,C,X=>[X.name]),k=IT($);M.useEffect(()=>{function X(W){if(D.current&&!D.current.contains(W.target))if(E(!1),e===Gt)x("");else{const H=r.find(([Z])=>Z===e)?.[1];x(H?.nickname||"")}}return document.addEventListener("mousedown",X),()=>document.removeEventListener("mousedown",X)},[e,r]);function j(X){if(X.key==="ArrowDown")X.preventDefault(),S?I(W=>Math.min(W+1,$.length-1)):(E(!0),I(0));else if(X.key==="ArrowUp")X.preventDefault(),I(W=>Math.max(W-1,0));else if(X.key==="Enter")X.preventDefault(),S&&T>=0&&$[T]&&N($[T]);else if(X.key==="Escape")if(E(!1),I(-1),e===Gt)x("");else{const W=r.find(([H])=>H===e)?.[1];x(W?.nickname||"")}else if(X.key==="Tab")if(S&&T>=0&&$[T])N($[T]);else if(E(!1),I(-1),e===Gt)x("");else{const W=r.find(([H])=>H===e)?.[1];x(W?.nickname||"")}}function N(X){n(X.id),x(X.id===Gt?"":X.name),E(!1),I(-1)}function F(){n(Gt),x(""),E(!1),I(-1)}function q(X){const W=X.target.value;x(W),E(!0),I(W.trim()?0:-1),W!==b&&(d&&W.trim()===""?n(Gt):n(""))}function A(){E(!0),d&&(e===Gt||C.trim()==="")?I(-1):$.length>0&&I(0)}let P=-1;const O=()=>++P;return u.jsxs("div",{ref:D,style:{position:"relative"},children:[u.jsx("input",{ref:B,id:t,type:"text",value:C,onChange:q,onFocus:A,onKeyDown:j,placeholder:o,autoComplete:"off",required:l&&!d,style:{...Ba,borderColor:l&&!e?me.error:void 0}}),S&&u.jsxs("div",{style:{...q0,maxHeight:"250px",overflowY:"auto"},children:[d&&u.jsx("div",{onClick:F,onMouseEnter:()=>I(-1),style:{...$u,opacity:.7,fontStyle:"italic",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)",background:T===-1?`color-mix(in srgb, ${me.primary} 20%, transparent)`:"transparent"},children:ka}),k.map((X,W)=>u.jsxs("div",{children:[X.groupName&&u.jsx("div",{style:{padding:"0.4rem 0.8rem",fontSize:"0.75rem",textTransform:"uppercase",letterSpacing:"0.5px",opacity:.6,background:"color-mix(in srgb, currentColor 5%, transparent)",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},children:X.groupName}),X.items.map(H=>{const Z=O();return u.jsx("div",{onClick:()=>N(H),style:{...$u,paddingLeft:X.groupName?"1.2rem":"0.8rem",background:Z===T?`color-mix(in srgb, ${me.primary} 20%, transparent)`:"transparent",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},onMouseEnter:()=>I(Z),children:H.name},H.id)})]},`group-${W}`)),$.length===0&&C.trim()&&!d&&u.jsx("div",{style:{padding:"0.6rem 0.8rem",opacity:.6,fontStyle:"italic"},children:"No matching accounts"})]})]})}function Ci({children:t,onSubmit:e,actionName:n}){function r(i){e(i)}return u.jsx("form",{onSubmit:r,style:S4,children:t})}function Bt({label:t,htmlFor:e,children:n,hint:r,style:i}){return u.jsxs("div",{style:{...C4,...i},children:[u.jsx("label",{htmlFor:e,style:E4,children:t}),n,r&&u.jsx("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.85rem",opacity:.6},children:r})]})}function Ei(t){return u.jsx("input",{style:Ba,...t})}function V4(t){if(!t)return"";try{return new Date(t+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"})}catch{return t}}function kf({value:t,onChange:e,style:n,autoFocus:r,...i}){const o=M.useRef(null),l=M.useRef(null),d=V4(t);M.useEffect(()=>{r&&l.current?.focus()},[r]);function h(){o.current?.showPicker?.()}function m(p){p.key==="Enter"&&(p.preventDefault(),o.current?.showPicker?.())}return u.jsxs("div",{style:{position:"relative"},children:[u.jsx("input",{ref:o,type:"date",value:t||"",onChange:e,style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",opacity:0,pointerEvents:"none"},...i}),u.jsx("div",{ref:l,tabIndex:0,onClick:h,onKeyDown:m,style:{...Ba,cursor:"pointer",display:"flex",alignItems:"center",fontSize:"0.85rem",fontFamily:"monospace",color:t?"inherit":"color-mix(in srgb, currentColor 50%, transparent)",...n},children:d||"Select date"})]})}function qu({children:t,...e}){return u.jsx("select",{style:T4,...e,children:t})}function H0({minHeight:t="6rem",style:e,...n}){return u.jsx("textarea",{style:{...Ba,width:"100%",minHeight:t,resize:"vertical",fontFamily:"inherit",boxSizing:"border-box",...e},...n})}function La({children:t}){return u.jsx("div",{style:k4,children:t})}function $g(t){const n=t.replace(/[^\d.]/g,"").split("."),r=n[0]||"",i=n[1],o=r.replace(/\B(?=(\d{3})+(?!\d))/g,",");return i!==void 0?`$${o}.${i.slice(0,2)}`:o?`$${o}`:""}function $4(t){return t.replace(/[$,]/g,"")}function wo({id:t,value:e,onChange:n,placeholder:r="$0.00",required:i,autoFocus:o,style:l}){const[d,h]=M.useState(()=>$g(e)),m=M.useRef(null);M.useEffect(()=>{const g=$g(e);$4(d)!==e&&h(g)},[e]);function p(g){const v=g.target.value;if(!v||v==="$"){h(""),n("");return}const C=v.replace(/[^\d.]/g,"").split(".");let x=C[0];C.length>1&&(x+="."+C.slice(1).join("").slice(0,2));const S=$g(x);h(S),n(x)}return u.jsx("input",{ref:m,id:t,type:"text",inputMode:"decimal",value:d,onChange:p,placeholder:r,required:i,autoFocus:o,style:{...Ba,...l}})}function Ai(t=k6){const[e,n]=M.useState(()=>typeof window>"u"?!1:window.innerWidth<t);return M.useEffect(()=>{const r=window.matchMedia(`(max-width: ${t-1}px)`);function i(l){n(l.matches)}i(r),r.addEventListener("change",i);function o(){n(window.innerWidth<t)}return window.addEventListener("resize",o),()=>{r.removeEventListener("change",i),window.removeEventListener("resize",o)}},[t]),e}function OT(){const[t,e]=M.useState(()=>typeof window>"u"?1200:window.innerWidth);return M.useEffect(()=>{function n(){e(window.innerWidth)}return window.addEventListener("resize",n),n(),()=>window.removeEventListener("resize",n)},[]),{width:t,isWide:t>=bo.wide,isMedium:t>=bo.tablet&&t<bo.wide,isNarrowMedium:t>=bo.mobile&&t<bo.tablet,isMobile:t<bo.mobile}}function Rn(){const{selectedBudgetId:t,currentUserId:e}=Ye(),n=z6(t),r=n.data,i=r?.budget||null,o=M.useMemo(()=>r?.accounts||{},[r?.accounts]),l=M.useMemo(()=>r?.accountGroups||{},[r?.accountGroups]),d=M.useMemo(()=>r?.categories||{},[r?.categories]),h=M.useMemo(()=>r?.categoryGroups||[],[r?.categoryGroups]),m=i?.owner_id===e,p=M.useMemo(()=>i?.user_ids||[],[i?.user_ids]),g=M.useMemo(()=>i?.accepted_user_ids||[],[i?.accepted_user_ids]),v=i?.total_available??0,b=M.useMemo(()=>r?.monthMap||{},[r?.monthMap]),C=M.useCallback(D=>{if(!t)return;const B=Le.getQueryData(Ie.budget(t));B&&Le.setQueryData(Ie.budget(t),{...B,accounts:D})},[t]),x=M.useCallback(D=>{if(!t)return;const B=Le.getQueryData(Ie.budget(t));B&&Le.setQueryData(Ie.budget(t),{...B,accountGroups:D})},[t]),S=M.useCallback(D=>{if(!t)return;const B=Le.getQueryData(Ie.budget(t));B&&Le.setQueryData(Ie.budget(t),{...B,categories:D})},[t]),E=M.useCallback(D=>{if(!t)return;const B=Le.getQueryData(Ie.budget(t));B&&Le.setQueryData(Ie.budget(t),{...B,categoryGroups:D})},[t]),T=M.useCallback(async()=>{t&&await Le.invalidateQueries({queryKey:Ie.budget(t)})},[t]),I=M.useCallback(()=>Object.entries(o).filter(([,D])=>{const B=D.account_group_id?l[D.account_group_id]:void 0,$=B&&B.on_budget!==null?B.on_budget:D.on_budget!==!1,k=B&&B.is_active!==null?B.is_active:D.is_active!==!1;return $&&k}).reduce((D,[,B])=>D+B.balance,0),[o,l]);return{isLoading:n.isLoading,isFetching:n.isFetching,error:n.error,budget:i,accounts:o,accountGroups:l,categories:d,categoryGroups:h,isOwner:m,budgetUserIds:p,acceptedUserIds:g,totalAvailable:v,monthMap:b,setAccountsOptimistic:C,setAccountGroupsOptimistic:x,setCategoriesOptimistic:S,setCategoryGroupsOptimistic:E,refreshBudget:T,getOnBudgetTotal:I}}function Qs(t,e,n){const{addLoadingHold:r,removeLoadingHold:i}=Qn(),o=$t(),l=K6(t,e,n,{enabled:!!t});M.useEffect(()=>{const T=t?Ie.month(t,e,n):null;return!(T?o.getQueryData(T):null)&&l.isLoading?r("month-query","Loading month data..."):i("month-query"),()=>i("month-query")},[l.isLoading,t,e,n,o,r,i]);const d=l.data?.month||null,h=M.useMemo(()=>d?.income||[],[d?.income]),m=M.useMemo(()=>d?.expenses||[],[d?.expenses]),p=M.useMemo(()=>d?.transfers||[],[d?.transfers]),g=M.useMemo(()=>d?.adjustments||[],[d?.adjustments]),v=M.useMemo(()=>d?.category_balances||[],[d?.category_balances]),b=M.useMemo(()=>d?.account_balances||[],[d?.account_balances]),C=d?.total_income||0,x=d?.total_expenses||0,S=d?.are_allocations_finalized||!1,E=d?.previous_month_income??0;return{isLoading:l.isLoading,isFetching:l.isFetching,error:l.error,month:d,income:h,expenses:m,transfers:p,adjustments:g,categoryBalances:v,accountBalances:b,totalIncome:C,totalExpenses:x,areAllocationsFinalized:S,previousMonthIncome:E}}const q4={trackChange:()=>{},clearChanges:()=>{},removeChange:()=>{},getChanges:()=>[],hasChanges:()=>!1,isSaving:!1,setIsSaving:()=>{},lastSaveTime:null,setLastSaveTime:()=>{},saveError:null,setSaveError:()=>{},clearSaveError:()=>{},syncError:null,setSyncError:()=>{}},NT=M.createContext(q4);function H4({children:t}){const[e,n]=M.useState(new Map),[r,i]=M.useState(!1),[o,l]=M.useState(null),[d,h]=M.useState(null),[m,p]=M.useState(null),g=M.useCallback($=>{i($)},[]),v=M.useCallback($=>{l($)},[]),b=M.useCallback($=>{h($)},[]),C=M.useCallback($=>$.type==="month"&&$.year!==void 0&&$.month!==void 0?`${$.type}:${$.budgetId}:${$.year}:${$.month}`:`${$.type}:${$.budgetId}`,[]),x=M.useCallback($=>{n(k=>{const j=new Map(k),N=C($);return j.set(N,{...$,timestamp:Date.now()}),j})},[C]),S=M.useCallback(()=>{n(new Map)},[]),E=M.useCallback($=>{n(k=>{const j=new Map(k),N=C($);return j.delete(N),j})},[C]),T=M.useCallback(()=>Array.from(e.values()),[e]),I=M.useCallback(()=>e.size>0,[e]),D=M.useCallback(()=>{h(null)},[]),B={trackChange:x,clearChanges:S,removeChange:E,getChanges:T,hasChanges:I,isSaving:r,lastSaveTime:o,saveError:d,clearSaveError:D,setIsSaving:g,setLastSaveTime:v,setSaveError:b,syncError:m,setSyncError:p};return u.jsx(NT.Provider,{value:B,children:t})}function mc(){const t=M.useContext(NT);if(!t)throw new Error("useSync must be used within a SyncProvider");return t}function pm(){const{trackChange:t}=mc();return{updateBudgetCacheAndTrack:(n,r)=>{Le.setQueryData(Ie.budget(n),r),t({type:"budget",budgetId:n})}}}function PT(){const t=$t(),{currentViewingDocument:e}=Ye(),{saveCurrentDocument:n}=Sn(),{updateBudgetCacheAndTrack:r}=pm(),i=Gn({onMutate:async l=>{const{budgetId:d,accounts:h}=l,m=Ie.budget(d);await t.cancelQueries({queryKey:m});const p=t.getQueryData(m);if(p){const v={...p,accounts:h};r(d,v)}if(e.type==="budget")try{await n(d,"budget")}catch(v){console.warn("[useUpdateAccounts] Failed to save current document immediately:",v)}return{previousData:p}},mutationFn:async l=>{const{accounts:d}=l;return{accounts:d}},onError:(l,d,h)=>{h?.previousData&&t.setQueryData(Ie.budget(d.budgetId),h.previousData)}});return{updateAccounts:{mutate:l=>i.mutate(l),mutateAsync:l=>i.mutateAsync(l),isPending:i.isPending,isError:i.isError,error:i.error,reset:i.reset}}}function G4(){const t=$t(),{currentViewingDocument:e}=Ye(),{saveCurrentDocument:n}=Sn(),{updateBudgetCacheAndTrack:r}=pm(),i=Gn({onMutate:async l=>{const{budgetId:d,accountGroups:h}=l,m=Ie.budget(d);await t.cancelQueries({queryKey:m});const p=t.getQueryData(m);if(p){const v={...p,accountGroups:h};r(d,v)}if(e.type==="budget")try{await n(d,"budget")}catch(v){console.warn("[useUpdateAccountGroups] Failed to save current document immediately:",v)}return{previousData:p}},mutationFn:async l=>{const{accountGroups:d}=l;return{accountGroups:d}},onError:(l,d,h)=>{h?.previousData&&t.setQueryData(Ie.budget(d.budgetId),h.previousData)}});return{updateAccountGroups:{mutate:l=>i.mutate(l),mutateAsync:l=>i.mutateAsync(l),isPending:i.isPending,isError:i.isError,error:i.error,reset:i.reset}}}function zT(){const t=$t(),{currentViewingDocument:e}=Ye(),{saveCurrentDocument:n}=Sn(),{updateBudgetCacheAndTrack:r}=pm(),i=Gn({onMutate:async l=>{const{budgetId:d,categories:h}=l,m=Ie.budget(d);await t.cancelQueries({queryKey:m});const p=t.getQueryData(m);if(p){const v={...p,categories:h};r(d,v)}if(e.type==="budget")try{await n(d,"budget")}catch(v){console.warn("[useUpdateCategories] Failed to save current document immediately:",v)}return{previousData:p}},mutationFn:async l=>{const{categories:d}=l;return{categories:d}},onError:(l,d,h)=>{h?.previousData&&t.setQueryData(Ie.budget(d.budgetId),h.previousData)}});return{updateCategories:{mutate:l=>i.mutate(l),mutateAsync:l=>i.mutateAsync(l),isPending:i.isPending,isError:i.isError,error:i.error,reset:i.reset}}}function Q4(){const t=$t(),{currentViewingDocument:e}=Ye(),{saveCurrentDocument:n}=Sn(),{updateBudgetCacheAndTrack:r}=pm(),i=Gn({onMutate:async l=>{const{budgetId:d,categoryGroups:h}=l,m=Ie.budget(d);await t.cancelQueries({queryKey:m});const p=t.getQueryData(m);if(p){const v={...p,categoryGroups:h};r(d,v)}if(e.type==="budget")try{await n(d,"budget")}catch(v){console.warn("[useUpdateCategoryGroups] Failed to save current document immediately:",v)}return{previousData:p}},mutationFn:async l=>{const{categoryGroups:d}=l;return{categoryGroups:d}},onError:(l,d,h)=>{h?.previousData&&t.setQueryData(Ie.budget(d.budgetId),h.previousData)}});return{updateCategoryGroups:{mutate:l=>i.mutate(l),mutateAsync:l=>i.mutateAsync(l),isPending:i.isPending,isError:i.isError,error:i.error,reset:i.reset}}}async function gm(t){const{budgetId:e,updates:n,description:r}=t,i={...n,updated_at:new Date().toISOString()},o=Ia(i);await Hn("budgets",e,o,r,{merge:!0});const l=Le.getQueryData(Ie.budget(e));l&&Le.setQueryData(Ie.budget(e),{...l,budget:{...l.budget,...n}})}function W4(){const t=$t(),e=Gn({onMutate:async r=>{const{budgetId:i,newName:o}=r,l=Ie.budget(i);await t.cancelQueries({queryKey:l});const d=t.getQueryData(l);return d&&t.setQueryData(l,{...d,budget:{...d.budget,name:o.trim()}}),{previousData:d}},mutationFn:async r=>{const{budgetId:i,newName:o}=r,l=o.trim();return await gm({budgetId:i,updates:{name:l},description:`renaming budget to "${l}"`}),{newName:l}},onError:(r,i,o)=>{o?.previousData&&t.setQueryData(Ie.budget(i.budgetId),o.previousData)}});return{renameBudget:{mutate:r=>e.mutate(r),mutateAsync:r=>e.mutateAsync(r),isPending:e.isPending,isError:e.isError,error:e.error,reset:e.reset}}}function K4({currentBudget:t,accounts:e,accountGroups:n,setAccountsOptimistic:r,setAccountGroupsOptimistic:i,saveAccounts:o,saveAccountGroups:l,setError:d}){const h=M.useCallback(async(p,g,v)=>{const b=e[p];if(!b)return;const C=v==="ungrouped"?Jt:v,x=Object.entries(e).filter(([,T])=>(T.account_group_id||"ungrouped")===v),S={};Object.entries(e).forEach(([T,I])=>{T!==p&&(S[T]={...I})});let E;if(g==="__group_end__"||x.length===0||!x.find(([T])=>T===g))E=(x.length>0?Math.max(...x.filter(([I])=>I!==p).map(([,I])=>I.sort_order)):-1)+1;else{const T=x.find(([I])=>I===g);if(T){const[,I]=T;E=I.sort_order,Object.entries(S).forEach(([D,B])=>{(B.account_group_id||"ungrouped")===v&&B.sort_order>=E&&(S[D]={...B,sort_order:B.sort_order+1})})}else E=0}if(S[p]={...b,account_group_id:C,sort_order:E},r(S),!!t)try{await o(S)}catch(T){d(T instanceof Error?T.message:"Failed to save changes")}},[t,e,r,o,d]),m=M.useCallback(async(p,g)=>{if(p===g)return;const v=Object.entries(n).sort(([,E],[,T])=>E.sort_order-T.sort_order),b=v.findIndex(([E])=>E===p),C=[...v],[x]=C.splice(b,1);if(g==="__end__")C.push(x);else{const E=C.findIndex(([T])=>T===g);C.splice(E,0,x)}const S={};if(C.forEach(([E,T],I)=>{S[E]={...T,sort_order:I}}),i(S),!!t)try{await l(S)}catch(E){d(E instanceof Error?E.message:"Failed to save new order")}},[t,n,i,l,d]);return{reorderAccountsInGroup:h,reorderGroups:m}}function Y4(){const{selectedBudgetId:t}=Ye(),{budget:e,accounts:n,accountGroups:r,setAccountsOptimistic:i,setAccountGroupsOptimistic:o}=Rn(),{updateAccounts:l}=PT(),{updateAccountGroups:d}=G4(),[h,m]=M.useState(null),p=M.useCallback(async F=>{if(!t)throw new Error("No budget selected");await l.mutateAsync({budgetId:t,accounts:F})},[t,l]),g=M.useCallback(async F=>{if(!t)throw new Error("No budget selected");await d.mutateAsync({budgetId:t,accountGroups:F})},[t,d]),v=M.useCallback(async(F,q)=>{if(!t)throw new Error("No budget selected");await Promise.all([l.mutateAsync({budgetId:t,accounts:F}),d.mutateAsync({budgetId:t,accountGroups:q})])},[t,l,d]),b=M.useMemo(()=>Object.entries(n).filter(([,F])=>!F.is_hidden).reduce((F,[q,A])=>{const P=A.account_group_id||Jt;return F[P]||(F[P]=[]),F[P].push({...A,id:q}),F},{}),[n]),C=M.useMemo(()=>Object.entries(n).filter(([,F])=>F.is_hidden).map(([F,q])=>({...q,id:F})).sort((F,q)=>F.sort_order-q.sort_order),[n]),x=M.useMemo(()=>Object.entries(r).sort(([,F],[,q])=>F.sort_order-q.sort_order).map(([F,q])=>({...q,id:F})),[r]),S=M.useCallback((F,q)=>{if(!e)return;const A=q||Jt,P=Object.values(n).filter(Z=>Z.account_group_id===A),O=P.length>0?Math.max(...P.map(Z=>Z.sort_order)):-1,X=`account_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,W={nickname:F.nickname,description:"",balance:0,account_group_id:A,sort_order:O+1,is_income_account:F.is_income_account??!1,is_income_default:F.is_income_default??!1,is_outgo_account:F.is_outgo_account??!1,is_outgo_default:F.is_outgo_default??!1,on_budget:F.on_budget!==!1,is_active:F.is_active!==!1,is_hidden:F.is_hidden??!1},H={...n};F.is_income_default&&Object.keys(H).forEach(Z=>{H[Z]={...H[Z],is_income_default:!1}}),F.is_outgo_default&&Object.keys(H).forEach(Z=>{H[Z]={...H[Z],is_outgo_default:!1}}),H[X]=W,i(H),p(H).catch(Z=>m(Z instanceof Error?Z.message:"Failed to create account."))},[e,n,i,p]),E=M.useCallback((F,q)=>{if(!e)return;const A=n[F];if(!A)return;const P=A.account_group_id||Jt,O=q.account_group_id||Jt;let X=A.sort_order;if(P!==O){const H=Object.values(n).filter(Z=>Z.account_group_id===O);X=H.length>0?Math.max(...H.map(Z=>Z.sort_order))+1:0}const W={};Object.entries(n).forEach(([H,Z])=>{H===F?W[H]={...Z,nickname:q.nickname,account_group_id:O,sort_order:X,is_income_account:q.is_income_account??!1,is_income_default:q.is_income_default??!1,is_outgo_account:q.is_outgo_account??!1,is_outgo_default:q.is_outgo_default??!1,on_budget:q.on_budget!==!1,is_active:q.is_active!==!1,is_hidden:q.is_hidden??!1}:(W[H]={...Z},q.is_income_default&&!A.is_income_default&&(W[H].is_income_default=!1),q.is_outgo_default&&!A.is_outgo_default&&(W[H].is_outgo_default=!1))}),i(W),p(W).catch(H=>m(H instanceof Error?H.message:"Failed to save account."))},[e,n,i,p]),T=M.useCallback(F=>{if(!confirm("Are you sure you want to delete this account?")||!e)return;const{[F]:q,...A}=n;i(A),p(A).catch(P=>m(P instanceof Error?P.message:"Failed to delete account."))},[e,n,i,p]),I=M.useCallback(async(F,q)=>{const A=n[F];if(!A)return;const P=A.account_group_id||Jt,O=Object.entries(n).filter(([,se])=>se.account_group_id===P).sort(([,se],[,L])=>se.sort_order-L.sort_order),X=O.findIndex(([se])=>se===F),W=q==="up"?X-1:X+1;if(W<0||W>=O.length)return;const[H,Z]=O[W],Y={};if(Object.entries(n).forEach(([se,L])=>{se===F?Y[se]={...L,sort_order:Z.sort_order}:se===H?Y[se]={...L,sort_order:A.sort_order}:Y[se]={...L}}),i(Y),!!e)try{await p(Y)}catch(se){i(n),m(se instanceof Error?se.message:"Failed to move account")}},[e,n,i,p]),D=M.useCallback(F=>{if(!e)return;const q=Object.values(r).map(W=>W.sort_order),A=q.length>0?Math.max(...q):-1,P=`account_group_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,O={name:F.name,sort_order:A+1,expected_balance:F.expected_balance,on_budget:F.on_budget??null,is_active:F.is_active??null},X={...r,[P]:O};o(X),g(X).catch(W=>m(W instanceof Error?W.message:"Failed to create account type."))},[e,r,o,g]),B=M.useCallback((F,q)=>{if(!e)return;const A={...r,[F]:{...r[F],name:q.name,expected_balance:q.expected_balance,on_budget:q.on_budget??null,is_active:q.is_active??null}};o(A),g(A).catch(P=>m(P instanceof Error?P.message:"Failed to update account type."))},[e,r,o,g]),$=M.useCallback(F=>{if(F===Jt){alert("Cannot delete the default Ungrouped account type.");return}if(!confirm("Are you sure you want to delete this account type? Accounts in this type will move to Ungrouped.")||!e)return;const q={};Object.entries(n).forEach(([O,X])=>{q[O]=X.account_group_id===F?{...X,account_group_id:Jt}:X});const{[F]:A,...P}=r;i(q),o(P),v(q,P).catch(O=>m(O instanceof Error?O.message:"Failed to delete account type."))},[e,n,r,i,o,v]),k=M.useCallback(async(F,q)=>{const A=Object.entries(r).sort(([,H],[,Z])=>H.sort_order-Z.sort_order),P=A.findIndex(([H])=>H===F),O=q==="up"?P-1:P+1;if(O<0||O>=A.length)return;const[X]=A.splice(P,1);A.splice(O,0,X);const W={};if(A.forEach(([H,Z],Y)=>{W[H]={...Z,sort_order:Y}}),o(W),!!e)try{await g(W)}catch(H){o(r),m(H instanceof Error?H.message:"Failed to move account type")}},[e,r,o,g]),{reorderAccountsInGroup:j,reorderGroups:N}=K4({currentBudget:e,accounts:n,accountGroups:r,setAccountsOptimistic:i,setAccountGroupsOptimistic:o,saveAccounts:p,saveAccountGroups:g,setError:m});return{accounts:n,accountGroups:r,accountsByGroup:b,hiddenAccounts:C,sortedGroups:x,currentBudget:e,error:h,setError:m,handleCreateAccount:S,handleUpdateAccount:E,handleDeleteAccount:T,handleMoveAccount:I,handleCreateGroup:D,handleUpdateGroup:B,handleDeleteGroup:$,handleMoveGroup:k,reorderAccountsInGroup:j,reorderGroups:N}}function I1(t,e){if(!t)return{};const n={};return Object.entries(e).forEach(([r,i])=>{if(i.default_monthly_type==="percentage")return;const o=t.category_balances?.find(l=>l.category_id===r);o&&o.allocated>0?n[r]=o.allocated.toString():i.default_monthly_amount!==void 0&&i.default_monthly_amount>0?n[r]=i.default_monthly_amount.toString():n[r]=""}),n}function X4(){const{addLoadingHold:t,removeLoadingHold:e}=Qn(),{selectedBudgetId:n,currentYear:r,currentMonthNumber:i}=Ye(),{categories:o,getOnBudgetTotal:l,totalAvailable:d}=Rn(),{month:h,isLoading:m,previousMonthIncome:p,areAllocationsFinalized:g}=Qs(n,r,i),v=M.useMemo(()=>h?.income?h.income.reduce((L,G)=>L+G.amount,0):0,[h]),{saveDraftAllocations:b}=w4(),{finalizeAllocations:C}=TP(),{deleteAllocations:x}=YT(),S=M.useMemo(()=>I1(h,o),[h,o]),[E,T]=M.useState(S),[I,D]=M.useState(!1),[B,$]=M.useState(null),k=M.useRef(null);M.useMemo(()=>Object.values(o).reduce((L,G)=>L+(G.balance??0),0),[o]),M.useEffect(()=>{if(!h)return;const L=`${h.year}-${h.month}`;k.current!==L&&(D(!1),T(I1(h,o)),k.current=L)},[h,o]);const j=M.useCallback((L,G)=>{if(G.default_monthly_type==="percentage"&&G.default_monthly_amount!==void 0)return Me(G.default_monthly_amount/100*p);const ne=E[L],ie=parseFloat(ne||"0");return isNaN(ie)?0:Me(ie)},[E,p]),N=M.useMemo(()=>Object.entries(o).reduce((L,[G,ne])=>{const ie=j(G,ne),te=ne.balance??0;if(te<0){const ue=Math.abs(te),ve=Math.max(0,ie-ue);return L+ve}return L+ie},0),[o,j]),F=l(),q=g?(h?.category_balances||[]).reduce((L,G)=>{const ne=o[G.category_id]?.balance??0,ie=G.allocated,te=ne-ie;if(te<0){const ue=Math.abs(te);return L+Math.max(0,ie-ue)}return L+ie},0):0,A=I?d+q:d,P=M.useMemo(()=>I?A-N:A-N+q,[A,N,q,I]),O=M.useCallback((L,G)=>{T(ne=>({...ne,[L]:G}))},[]),X=M.useCallback(()=>{if(!h)return;const L={};Object.entries(o).forEach(([G,ne])=>{if(ne.default_monthly_type==="percentage")return;const ie=h.category_balances?.find(te=>te.category_id===G);ie&&ie.allocated>0?L[G]=ie.allocated.toString():ne.default_monthly_amount!==void 0&&ne.default_monthly_amount>0?L[G]=ne.default_monthly_amount.toString():L[G]=""}),T(L),D(!1)},[h,o]),W=M.useCallback(()=>{const L={};return Object.entries(o).forEach(([G,ne])=>{const ie=j(G,ne);ie>0&&(L[G]=ie)}),L},[o,j]),H=M.useCallback(async()=>{if(n){$(null),t("allocations-save","Saving allocations...");try{await b(n,r,i,W()),D(!1)}catch(L){$(L instanceof Error?L.message:"Failed to save allocations")}finally{e("allocations-save")}}},[n,r,i,b,W,t,e]),Z=M.useCallback(async()=>{if(n){$(null),t("allocations-finalize","Applying allocations...");try{await C({budgetId:n,year:r,month:i,allocations:W(),onProgress:L=>{t("allocations-finalize",L.message)}}),D(!1)}catch(L){$(L instanceof Error?L.message:"Failed to finalize allocations")}finally{e("allocations-finalize")}}},[n,r,i,C,W,t,e]),Y=M.useCallback(async()=>{if(n){$(null),t("allocations-delete","Deleting allocations...");try{await x({budgetId:n,year:r,month:i,onProgress:G=>{t("allocations-delete",G.message)}});const L={};Object.entries(o).forEach(([G,ne])=>{ne.default_monthly_type!=="percentage"&&(ne.default_monthly_amount!==void 0&&ne.default_monthly_amount>0?L[G]=ne.default_monthly_amount.toString():L[G]="")}),T(L),D(!1)}catch(L){$(L instanceof Error?L.message:"Failed to delete allocations")}finally{e("allocations-delete")}}},[n,r,i,x,o,t,e]),se=N-q;return{localAllocations:E,isEditingAppliedAllocations:I,error:B,monthLoading:m,onBudgetTotal:F,availableNow:A,currentDraftTotal:N,draftChangeAmount:se,availableAfterApply:P,previousMonthIncome:p,currentMonthIncome:v,allocationsFinalized:g,getAllocationAmount:j,handleAllocationChange:O,resetAllocationsToSaved:X,handleSaveAllocations:H,handleFinalizeAllocations:Z,handleDeleteAllocations:Y,setIsEditingAppliedAllocations:D,setError:$}}function Z4({budgetId:t,categories:e,currentYear:n,currentMonth:r,updateCategoriesWithBalances:i}){const[o,l]=M.useState({}),[d,h]=M.useState(!1);M.useEffect(()=>{if(!t||Object.keys(e).length===0){l({});return}let E=!1;h(!0);const T=Object.keys(e);return Vg(t,T,n,r).then(({current:I,total:D})=>{if(E)return;const B={};T.forEach($=>{B[$]={current:I[$]??0,total:D[$]??0}}),l(B)}).catch(I=>{if(E)return;console.error("[useCategoryBalances] Error calculating balances:",I);const D={};Object.entries(e).forEach(([B,$])=>{D[B]={current:$.balance??0,total:$.balance??0}}),l(D)}).finally(()=>{E||h(!1)}),()=>{E=!0}},[t,n,r,e]);const m=M.useMemo(()=>{const E={};return Object.entries(e).forEach(([T,I])=>{o[T]?E[T]=o[T]:E[T]={current:I.balance??0,total:I.balance??0}}),E},[e,o]),[p,g]=M.useState(!1),v=p||d,[b,C]=M.useState(null),x=M.useCallback(async()=>{if(!t||Object.keys(e).length===0)return null;const E=Object.keys(e),{total:T}=await Vg(t,E,n,r),I={};Object.entries(e).forEach(([B,$])=>{const k=$.balance,j=T[B]??0;Math.abs(k-j)>.01&&(I[B]={stored:k,calculated:j})});const D=Object.keys(I).length>0?I:null;return C(D),D},[t,e,n,r]),S=M.useCallback(async()=>{if(!(!t||Object.keys(e).length===0)){g(!0);try{const E=Object.keys(e),{total:T}=await Vg(t,E,n,r),I={};Object.entries(e).forEach(([D,B])=>{I[D]={...B,balance:T[D]??0}}),await i(I),C(null)}finally{g(!1)}}},[t,e,i,n,r]);return{categoryBalances:m,loadingBalances:v,categoryBalanceMismatch:b,checkCategoryBalanceMismatch:x,recalculateAndSaveCategoryBalances:S}}function J4({categories:t,categoryGroups:e,currentBudget:n,setCategoriesOptimistic:r,setCategoryGroupsOptimistic:i,saveCategories:o,saveCategoryGroups:l,setError:d}){const[h,m]=M.useState(null),[p,g]=M.useState(null),[v,b]=M.useState(null),[C,x]=M.useState(null);function S(j,N){m("category"),g(N),j.dataTransfer.effectAllowed="move"}function E(j,N,F){j.preventDefault(),h==="category"&&(N!==p&&b(N),x(F))}function T(j,N){j.preventDefault(),h==="category"&&(x(N),b(null))}function I(){b(null)}function D(){x(null)}function B(){m(null),g(null),b(null),x(null)}async function $(j,N,F){if(j.preventDefault(),j.stopPropagation(),!p||h!=="category"){B();return}const q=t[p];if(!q)return;const A=F==="ungrouped"?cn:F,P=Object.entries(t).filter(([,W])=>(W.category_group_id||"ungrouped")===F),O={};Object.entries(t).forEach(([W,H])=>{W!==p&&(O[W]=H)});let X;if(N==="__group_end__"||P.length===0||!P.find(([W])=>W===N))X=(P.length>0?Math.max(...P.filter(([H])=>H!==p).map(([,H])=>H.sort_order)):-1)+1;else{const W=P.find(([H])=>H===N);W?(X=W[1].sort_order,Object.entries(O).forEach(([H,Z])=>{(Z.category_group_id||"ungrouped")===F&&Z.sort_order>=X&&(O[H]={...Z,sort_order:Z.sort_order+1})})):X=0}if(O[p]={...q,category_group_id:A,sort_order:X},r(O),B(),!!n)try{await o(O)}catch(W){d(W instanceof Error?W.message:"Failed to save changes")}}async function k(j,N){j.preventDefault(),h==="category"&&await $(j,"__group_end__",N)}return{dragType:h,draggedId:p,dragOverId:v,dragOverGroupId:C,setDragOverId:b,setDragOverGroupId:x,handleCategoryDragStart:S,handleCategoryDragOver:E,handleDragOverGroup:T,handleDragLeave:I,handleDragLeaveGroup:D,handleDragEnd:B,handleCategoryDrop:$,handleDropOnGroup:k}}function e3(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n}=Ye(),{budget:r,categories:i,categoryGroups:o,isLoading:l,setCategoriesOptimistic:d,setCategoryGroupsOptimistic:h,getOnBudgetTotal:m}=Rn(),{updateCategories:p}=zT(),{updateCategoryGroups:g}=Q4(),[v,b]=M.useState(null),C=M.useCallback(async Z=>{if(!t)throw new Error("No budget selected");await p.mutateAsync({budgetId:t,categories:Z})},[t,p]),x=M.useCallback(async Z=>{if(!t)throw new Error("No budget selected");await g.mutateAsync({budgetId:t,categoryGroups:Z})},[t,g]),S=M.useCallback(async(Z,Y)=>{if(!t)throw new Error("No budget selected");await Promise.all([p.mutateAsync({budgetId:t,categories:Z}),g.mutateAsync({budgetId:t,categoryGroups:Y})])},[t,p,g]),{categoryBalances:E,loadingBalances:T,categoryBalanceMismatch:I,checkCategoryBalanceMismatch:D,recalculateAndSaveCategoryBalances:B}=Z4({budgetId:t,categories:i,currentYear:e,currentMonth:n,updateCategoriesWithBalances:C}),$=J4({categories:i,categoryGroups:o,currentBudget:r,setCategoriesOptimistic:d,setCategoryGroupsOptimistic:h,saveCategories:C,saveCategoryGroups:x,setError:b});async function k(Z,Y){if(!r)return;const se=Y||cn,L=Object.values(i).filter(ue=>ue.category_group_id===se),G=L.length>0?Math.max(...L.map(ue=>ue.sort_order)):-1,ne=`category_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,ie={name:Z.name,description:Z.description??"",category_group_id:se,sort_order:G+1,default_monthly_amount:Z.default_monthly_amount??0,default_monthly_type:Z.default_monthly_type??"fixed",balance:0,is_hidden:Z.is_hidden??!1},te={...i,[ne]:ie};d(te);try{await C(te)}catch(ue){d(i),b(ue instanceof Error?ue.message:"Failed to create category")}}async function j(Z,Y){if(r)try{const se=i[Z];if(!se)return;const L=se.category_group_id||cn,G=Y.category_group_id||cn;let ne=se.sort_order;if(L!==G){const te=Object.values(i).filter(ue=>ue.category_group_id===G).filter((ue,ve,ce)=>i[Z]!==ce[ve]);ne=te.length>0?Math.max(...te.map(ue=>ue.sort_order))+1:0}const ie={...i,[Z]:{...se,name:Y.name,description:Y.description??"",category_group_id:G,sort_order:ne,default_monthly_amount:Y.default_monthly_amount??0,default_monthly_type:Y.default_monthly_type??"fixed",is_hidden:Y.is_hidden??!1}};d(ie),await C(ie)}catch(se){b(se instanceof Error?se.message:"Failed to update category")}}async function N(Z){if(confirm("Are you sure you want to delete this category?")&&r)try{const{[Z]:Y,...se}=i;d(se),await C(se)}catch(Y){b(Y instanceof Error?Y.message:"Failed to delete category")}}async function F(Z,Y){const se=i[Z];if(!se)return;const L=se.category_group_id||cn,G=Object.entries(i).filter(([,ce])=>ce.category_group_id===L).sort((ce,be)=>ce[1].sort_order-be[1].sort_order),ne=G.findIndex(([ce])=>ce===Z),ie=Y==="up"?ne-1:ne+1;if(ie<0||ie>=G.length)return;const[te,ue]=G[ie],ve={};if(Object.entries(i).forEach(([ce,be])=>{ce===Z?ve[ce]={...be,sort_order:ue.sort_order}:ce===te?ve[ce]={...be,sort_order:se.sort_order}:ve[ce]=be}),d(ve),!!r)try{await C(ve)}catch(ce){d(i),b(ce instanceof Error?ce.message:"Failed to move category")}}async function q(Z){if(r)try{const Y=o.length>0?Math.max(...o.map(G=>G.sort_order)):-1,se={id:`category_group_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,name:Z.name,sort_order:Y+1},L=[...o,se];h(L),await x(L)}catch(Y){b(Y instanceof Error?Y.message:"Failed to create group")}}async function A(Z,Y){if(r)try{const se=o.map(L=>L.id===Z?{...L,name:Y.name}:L);h(se),await x(se)}catch(se){b(se instanceof Error?se.message:"Failed to update group")}}async function P(Z){if(Z===cn){alert("Cannot delete the default Uncategorized category group.");return}if(confirm("Are you sure you want to delete this group? Categories in this group will move to Uncategorized.")&&r)try{const Y={};Object.entries(i).forEach(([L,G])=>{Y[L]=G.category_group_id===Z?{...G,category_group_id:cn}:G});const se=o.filter(L=>L.id!==Z);d(Y),h(se),await S(Y,se)}catch(Y){b(Y instanceof Error?Y.message:"Failed to delete group")}}async function O(Z,Y){const se=[...o].sort((te,ue)=>te.sort_order-ue.sort_order),L=se.findIndex(te=>te.id===Z),G=Y==="up"?L-1:L+1;if(G<0||G>=se.length)return;const[ne]=se.splice(L,1);se.splice(G,0,ne);const ie=se.map((te,ue)=>({...te,sort_order:ue}));if(h(ie),!!r)try{await x(ie)}catch(te){h(o),b(te instanceof Error?te.message:"Failed to move group")}}const X=Object.entries(i).filter(([,Z])=>!Z.is_hidden).reduce((Z,[Y,se])=>{const L=se.category_group_id||cn;return Z[L]||(Z[L]=[]),Z[L].push([Y,se]),Z},{}),W=Object.entries(i).filter(([,Z])=>Z.is_hidden).map(([Z,Y])=>[Z,Y]).sort((Z,Y)=>Z[1].sort_order-Y[1].sort_order),H=[...o].sort((Z,Y)=>Z.sort_order-Y.sort_order);return{currentBudget:r,categories:i,categoryGroups:o,categoriesByGroup:X,hiddenCategories:W,sortedGroups:H,categoryBalances:E,isLoading:l,loadingBalances:T,error:v,setError:b,getOnBudgetTotal:m,categoryBalanceMismatch:I,checkCategoryBalanceMismatch:D,recalculateAndSaveCategoryBalances:B,handleCreateCategory:k,handleUpdateCategory:j,handleDeleteCategory:N,handleMoveCategory:F,handleCreateGroup:q,handleUpdateGroup:A,handleDeleteGroup:P,handleMoveGroup:O,dragType:$.dragType,draggedId:$.draggedId,dragOverId:$.dragOverId,dragOverGroupId:$.dragOverGroupId,setDragOverId:$.setDragOverId,setDragOverGroupId:$.setDragOverGroupId,handleCategoryDragStart:$.handleCategoryDragStart,handleCategoryDragOver:$.handleCategoryDragOver,handleDragOverGroup:$.handleDragOverGroup,handleDragLeave:$.handleDragLeave,handleDragLeaveGroup:$.handleDragLeaveGroup,handleDragEnd:$.handleDragEnd,handleCategoryDrop:$.handleCategoryDrop,handleDropOnGroup:$.handleDropOnGroup}}function t3(t){switch(t.phase){case"reading-budget":return"Reading budget data...";case"fetching-months":return t.totalMonthsToFetch?`Loading ${t.totalMonthsToFetch} months...`:"Loading months...";case"recalculating":return t.currentMonth?`Recalculating ${t.currentMonth}...`:"Recalculating balances...";case"saving":return t.totalMonths?`Saving ${t.totalMonths} months...`:"Saving results...";case"complete":return"Recalculation complete!";default:return"Recalculating..."}}function ld({budgetId:t,year:e,month:n,monthMap:r,checkAnyMonth:i=!1,requireMonthLoaded:o=!1,currentMonth:l,additionalCondition:d=!0,onProgress:h,onError:m,logPrefix:p="[AutoRecalc]"}){const[g,v]=M.useState(null),b=M.useRef(!1),C=M.useRef(null),x=M.useRef(null),S=Nn(),E=M.useRef(null),{addLoadingHold:T,removeLoadingHold:I}=Qn();return M.useEffect(()=>{if(!t||!d||o&&!l)return;let D;const B=S.pathname;if(i){E.current!==B&&(C.current=null,E.current=B);const j=xT(r);if(j.length===0||b.current||(D=`any-${j[0]}`,C.current===D))return}else{if(e===void 0||n===void 0){console.warn(`${p} year and month are required when checkAnyMonth is false`);return}const j=gt(e,n),N=r[j]?.needs_recalculation===!0;if(D=`${e}-${n}`,(E.current!==B||x.current!==D)&&(C.current=null,E.current=B,x.current=D),C.current===D)return;if(!N||b.current){C.current=D;return}`${e}${String(n).padStart(2,"0")}`}b.current=!0,C.current=D;const $=`recalc-${t}`;T($,"Recalculating balances..."),m4(t,{onProgress:j=>{v(j);const N=t3(j);T($,N),h?.(j)}}).then(()=>{Le.invalidateQueries({queryKey:["month",t]})}).catch(j=>{const N=j instanceof Error?j:new Error(String(j));m?m(N):console.error(`${p} Recalculation failed:`,N)}).finally(()=>{b.current=!1,v(null),I($)})},[t,e,n,r,i,o,l,d,h,m,p,S.pathname,T,I]),{recalcProgress:g,isRecalculating:g!==null}}function n3(t,e,n,r){return{budget_id:e,year_month_ordinal:t.year_month_ordinal??gt(n,r),year:t.year??n,month:t.month??r,income:t.income||[],total_income:t.total_income??0,previous_month_income:t.previous_month_income??0,expenses:t.expenses||[],total_expenses:t.total_expenses??0,transfers:t.transfers||[],adjustments:t.adjustments||[],account_balances:t.account_balances||[],category_balances:t.category_balances||[],are_allocations_finalized:t.are_allocations_finalized??!1,created_at:t.created_at,updated_at:t.updated_at}}async function r3(t){const e=new Date,n=e.getFullYear(),r=e.getMonth()+1;let i=n,o=r-3;for(;o<=0;)o+=12,i-=1;const l=gt(i,o);return(await On("months","useInitialDataLoad: loading initial months",[{field:"budget_id",op:"==",value:t},{field:"year_month_ordinal",op:">=",value:l}])).docs.map(m=>{const p=m.data,g=p.year,v=p.month;return n3(p,t,g,v)}).sort((m,p)=>m.year!==p.year?m.year-p.year:m.month-p.month)}async function s3(t){const[e,n,r]=await Promise.all([O0(t),P0(t),r3(t)]);return{budget:e,payees:n,months:r}}function i3(t,e){return Mo({queryKey:t?["initialDataLoad",t]:["initialDataLoad","none"],queryFn:()=>s3(t),enabled:!!t&&e?.enabled!==!1,staleTime:1/0})}async function a3(t,e,n,r){const i=Ie.month(t,e,n),o=r.getQueryData(i);if(!o?.month)throw new Error(`Month ${e}/${n} not found in cache`);const l=o.month,d=await o3(t,e,n,r),h=L0(l,d);return r.setQueryData(i,{month:h}),h}async function o3(t,e,n,r){const{year:i,month:o}=Zl(e,n),l=Ie.month(t,i,o),d=r.getQueryData(l);if(d?.month)return Vu(d.month);try{const h=await N0(t,i,o);if(h)return r.setQueryData(l,{month:h}),Vu(h)}catch(h){console.warn(`[useLocalRecalculation] Could not fetch previous month ${i}/${o}:`,h)}return B0}function l3(){const t=Nn(),{saveAllChanges:e}=Sn(),{hasChanges:n}=mc(),r=M.useRef(null);M.useEffect(()=>{const i=t.pathname;if(r.current===null){r.current=i;return}r.current!==i&&n()&&queueMicrotask(()=>{e("navigation save (page change)").catch(o=>{console.error("[useNavigationSave] Failed to save on navigation:",o)})}),r.current=i},[t.pathname,n,e])}const k1=300*1e3;function c3(t,e,n,r){return{budget_id:e,year_month_ordinal:t.year_month_ordinal??gt(n,r),year:t.year??n,month:t.month??r,income:t.income||[],total_income:t.total_income??0,previous_month_income:t.previous_month_income??0,expenses:t.expenses||[],total_expenses:t.total_expenses??0,transfers:t.transfers||[],adjustments:t.adjustments||[],account_balances:t.account_balances||[],category_balances:t.category_balances||[],are_allocations_finalized:t.are_allocations_finalized??!1,created_at:t.created_at,updated_at:t.updated_at}}function D1(t,e){return e?t?new Date(e)>new Date(t):!0:!1}async function u3(t,e){const n=[],r=new Date,i=r.getFullYear(),o=r.getMonth()+1;let l=i,d=o-3;for(;d<=0;)d+=12,l-=1;const h=gt(l,d),[m,p,g]=await Promise.all([Le.fetchQuery({queryKey:Ie.budget(t),queryFn:()=>O0(t),staleTime:0}).catch(()=>null),Le.fetchQuery({queryKey:Ie.payees(t),queryFn:()=>P0(t),staleTime:0}).catch(()=>null),On("months","useSyncCheck: checking for remote changes",[{field:"budget_id",op:"==",value:t},{field:"year_month_ordinal",op:">=",value:h}]).catch(()=>({docs:[]}))]);if(m){const b=Le.getQueryData(Ie.budget(t));if(b){const C=b.budget?.updated_at;D1(C,m.budget.updated_at)&&(e.some(S=>S.type==="budget"&&S.budgetId===t)?n.push("Budget document has been updated remotely (you have unsaved local changes)"):Le.setQueryData(Ie.budget(t),m))}}p!==null&&Le.getQueryData(Ie.payees(t));const v=g.docs.map(b=>{const C=b.data,x=C.year,S=C.month;return c3(C,t,x,S)});for(const b of v){const C=Le.getQueryData(Ie.month(t,b.year,b.month));C?.month&&D1(C.month.updated_at,b.updated_at)&&(e.some(S=>S.type==="month"&&S.budgetId===t&&S.year===b.year&&S.month===b.month)?n.push(`Month ${b.year}/${b.month} has been updated remotely (you have unsaved local changes)`):Le.setQueryData(Ie.month(t,b.year,b.month),{month:b}))}return n}function d3(t,e){const{setSyncError:n,getChanges:r}=mc(),i=M.useRef(null),o=M.useRef(null),l=M.useRef(0),d=M.useRef(!1);M.useEffect(()=>{if(!t||!e||d.current)return;d.current=!0;const h=async()=>{try{const m=r(),p=await u3(t,m);if(p.length>0){const g=`Sync conflict detected: ${p.join("; ")}`;n(g),gr.add({type:"error",message:g,autoDismissMs:0})}else n(null)}catch(m){console.error("[useSyncCheck] Sync check failed:",m);const p=`Failed to check for sync conflicts: ${m instanceof Error?m.message:String(m)}`;n(p),gr.add({type:"error",message:p,autoDismissMs:0})}};return o.current=setTimeout(()=>{h(),l.current=Date.now(),i.current=setInterval(()=>{h(),l.current=Date.now()},k1)},k1),()=>{o.current&&clearTimeout(o.current),i.current&&clearInterval(i.current),d.current=!1}},[t,e,n,r])}function h3(t,e,n){const r=$t(),i=M.useRef(null),o=M.useRef(null);M.useEffect(()=>{if(i.current===null||o.current===null){i.current=e,o.current=n;return}if(i.current===e&&o.current===n)return;if(!t){i.current=e,o.current=n;return}const l=gt(i.current,o.current),m=gt(e,n)>l?bT(e,n):Zl(e,n),p=Ie.month(t,m.year,m.month);if(!r.getQueryData(p)){const v=r.getQueryData(Ie.budget(t)),b=gt(m.year,m.month);v?.monthMap&&b in v.monthMap&&r.prefetchQuery({queryKey:p,queryFn:async()=>{const x=await N0(t,m.year,m.month);return x?{month:x}:null},staleTime:oc}).catch(x=>{console.warn(`[useMonthPrefetch] Failed to prefetch month ${m.year}/${m.month}:`,x)})}i.current=e,o.current=n},[t,e,n,r])}function Ma(){Le.removeQueries({queryKey:["budget"]}),Le.removeQueries({queryKey:["month"]}),Le.removeQueries({queryKey:["accessibleBudgets"]}),Le.removeQueries({queryKey:["payees"]}),Le.removeQueries({queryKey:["user"]}),console.log("[Migration] All caches cleared")}async function ym(t){try{const e=await t();return Ma(),e}catch(e){throw Ma(),e}}const BT=M.createContext(null),M1={isOpen:!1,migrationName:"",stage:"",progress:null,currentItem:null,details:null,isComplete:!1,error:null};function f3({children:t}){const[e,n]=M.useState(M1),r=M.useCallback(()=>({setStage:d=>{n(h=>({...h,stage:d}))},setProgress:d=>{n(h=>({...h,progress:d}))},setCurrentItem:d=>{n(h=>({...h,currentItem:d}))},setDetails:d=>{n(h=>({...h,details:d}))},updateItemProgress:(d,h,m)=>{const p=h>0?Math.round(d/h*100):0;n(g=>({...g,progress:p,currentItem:m||`Item ${d} of ${h}`,details:`${d} / ${h} complete`}))}}),[]),i=M.useCallback(async(d,h)=>{n({isOpen:!0,migrationName:d,stage:"Starting migration...",progress:null,currentItem:null,details:null,isComplete:!1,error:null});const m=r();try{const p=await h(m);return Ma(),n(g=>({...g,isComplete:!0,stage:"Migration complete",progress:100,details:p.errors.length>0?`Completed with ${p.errors.length} error(s)`:"All operations successful"})),p}catch(p){Ma();const g=p instanceof Error?p.message:"Unknown error occurred";throw n(v=>({...v,isComplete:!0,error:g,stage:"Migration failed",progress:null})),p}},[r]),o=M.useCallback(()=>{n(d=>d.isComplete?M1:(console.warn("[MigrationProgress] Cannot close modal while migration is running"),d))},[]),l={state:e,runMigrationWithProgress:i,closeModal:o};return u.jsx(BT.Provider,{value:l,children:t})}function m3(){const t=M.useContext(BT);if(!t)throw new Error("useMigrationProgress must be used within MigrationProgressProvider");return t}async function p3(t){return(await On("budgets",`${t}: batch reading all budgets`)).docs.map(n=>({id:n.id,data:n.data}))}async function LT(t,e){return(await On("months",`${e}: batch reading months for budget ${t}`,[{field:"budget_id",op:"==",value:t}])).docs.map(i=>({id:i.id,data:i.data,budgetId:i.data.budget_id,year:i.data.year,month:i.data.month})).sort((i,o)=>i.year!==o.year?i.year-o.year:i.month-o.month)}async function Ua(t){const e=await p3(t),n=await On("months",`${t}: batch reading all months`),r=new Map;for(const i of n.docs){const o=i.data.budget_id,l={id:i.id,data:i.data,budgetId:o,year:i.data.year,month:i.data.month};r.has(o)||r.set(o,[]),r.get(o).push(l)}for(const i of r.values())i.sort((o,l)=>o.year!==l.year?o.year-l.year:o.month-l.month);return{budgets:e,monthsByBudget:r}}async function cd(t,e){if(t.length===0)return;const n=t.map(r=>({collectionPath:"months",docId:ms(r.budgetId,r.year,r.month),data:Ia({...r.data,updated_at:new Date().toISOString()})}));await dm(n,`${e}: batch writing ${t.length} months`)}async function UT(t,e){if(t.length===0)return;const n=t.map(r=>({collectionPath:"budgets",docId:r.budgetId,data:Ia({...r.data,updated_at:new Date().toISOString()})}));await dm(n,`${e}: batch writing ${t.length} budgets`)}async function FT(t,e,n){if(e.length===0)return;let r=B0;const i=[];for(const p of e){const g=L0(p,r);i.push(g),r=Vu(g)}const o=i.map(p=>({budgetId:t,year:p.year,month:p.month,data:p}));await cd(o,n);const l=r.accountEndBalances,d=r.categoryEndBalances,{exists:h,data:m}=await Rt("budgets",t,`${n}: reading budget for final update`);if(h&&m){const p=vT(m.month_map||{}),g=U0(p),v={...d},b=m.categories||{};for(const C of Object.keys(b))C in v||(v[C]=0);await wT(t,l,v,g)}}async function g3(t,e){if(t.length===0)return;const n=new Map;for(const r of t)n.has(r.budgetId)||n.set(r.budgetId,[]),n.get(r.budgetId).push(r);for(const[r,i]of n){i.sort((d,h)=>d.year!==h.year?d.year-h.year:d.month-h.month),await cd(i,e);const l=(await LT(r,e)).map(d=>d.data);await FT(r,l,e)}}async function y3(t){const{exists:e,data:n}=await Rt("budgets",t,`[delete all months] reading budget ${t} for reset`);if(!e||!n)return;const r={...n.accounts};for(const o of Object.keys(r))r[o]&&typeof r[o]=="object"&&(r[o]={...r[o],balance:0});const i={...n.categories};for(const o of Object.keys(i))i[o]&&typeof i[o]=="object"&&(i[o]={...i[o],balance:0});await Hn("budgets",t,{...n,accounts:r,categories:i,month_map:{},total_available:0,is_needs_recalculation:!1,updated_at:new Date().toISOString()},`[delete all months] resetting budget ${t} balances to zero`)}function _3({currentUser:t,onComplete:e}){const[n,r]=M.useState(!1),[i,o]=M.useState(!1),[l,d]=M.useState(null),[h,m]=M.useState(null),[p,g]=M.useState(null);async function v(){if(t){r(!0);try{const C=await On("months","delete all months: scanning for all months"),x=[],S=new Set;for(const E of C.docs){const{budget_id:T,year:I,month:D}=E.data;S.add(T),x.push({docId:E.id,budgetId:T,year:I,month:D})}x.sort((E,T)=>E.budgetId!==T.budgetId?E.budgetId.localeCompare(T.budgetId):E.year!==T.year?E.year-T.year:E.month-T.month),d({monthsToDelete:x,monthsCount:x.length,budgetCount:S.size})}catch{}finally{r(!1)}}}async function b(){if(!t||!l||l.monthsToDelete.length===0)return;o(!0),m(null);const C=l.monthsToDelete.length,x=new Set,S=[];for(const B of l.monthsToDelete)x.add(B.budgetId);g({phase:"deleting",deleted:0,total:C,currentMonth:null,budgetsRecalculated:0,totalBudgets:l.budgetCount,percentComplete:0});const E=l.monthsToDelete.map(B=>({collectionPath:"months",docId:B.docId}));let T=0;try{await _T(E,"delete all months: batch deleting all month documents",B=>{T=B,g({phase:"deleting",deleted:B,total:C,currentMonth:`Batch ${Math.ceil(B/500)} of ${Math.ceil(C/500)}`,budgetsRecalculated:0,totalBudgets:l.budgetCount,percentComplete:Math.round(B/C*70)})}),T=C}catch(B){S.push(`Batch delete failed: ${B instanceof Error?B.message:"Unknown error"}`)}const I=Array.from(x);let D=0;for(const B of I){g({phase:"resetting-budgets",deleted:T,total:C,currentMonth:`Budget ${D+1}/${I.length}`,budgetsRecalculated:D,totalBudgets:I.length,percentComplete:70+Math.round(D/I.length*25)});try{await y3(B),D++}catch{D++}}g({phase:"clearing-cache",deleted:T,total:C,currentMonth:null,budgetsRecalculated:D,totalBudgets:I.length,percentComplete:95}),Ma(),g({phase:"complete",deleted:T,total:C,currentMonth:null,budgetsRecalculated:D,totalBudgets:I.length,percentComplete:100}),m({deleted:T,errors:S,budgetsRecalculated:D}),o(!1),g(null),S.length===0&&(d({monthsToDelete:[],monthsCount:0,budgetCount:0}),e?.())}return{status:l,isScanning:n,scanStatus:v,isDeleting:i,deleteResult:h,deleteProgress:p,deleteAllMonths:b}}const qg="sample@sample.com",go="budget_1767746876726_xuj7nzl4l";function b3({currentUser:t,onComplete:e}){const[n,r]=M.useState(!1),[i,o]=M.useState(!1),[l,d]=M.useState(null),[h,m]=M.useState(null),[p,g]=M.useState(null);async function v(){if(t){r(!0);try{let x=(await On("budgets","delete sample user budget: scanning for sample user budgets",[{field:"owner_email",op:"==",value:qg}])).docs;if(x.length===0){console.log("delete sample user budget: no budgets found by owner_email, checking fallback budget ID");const B=await Rt("budgets",go,"delete sample user budget: checking fallback budget ID");B.exists&&B.data&&(console.log("delete sample user budget: found fallback budget",go),x=[{id:go,data:B.data}])}const S=[];let E=0,T=!1;for(const B of x){const $=B.id,k=B.data.name,N=(await On("months",`delete sample user budget: counting months for budget ${$}`,[{field:"budget_id",op:"==",value:$}])).docs.length;E+=N,S.push({budgetId:$,budgetName:k,monthCount:N}),(await On("payees",`delete sample user budget: checking payees for budget ${$}`,[{field:"budget_id",op:"==",value:$}])).docs.length>0&&(T=!0)}const I=[],D=await On("users","delete sample user budget: finding sample user document",[{field:"email",op:"==",value:qg}]);D.docs.length>0&&D.docs[0].data.budget_ids?.includes(go)&&(S.some(j=>j.budgetId===go)||(console.log("delete sample user budget: found stale budget reference in sample user document",go),I.push(go))),d({budgets:S,totalBudgets:S.length,totalMonths:E,hasPayees:T,staleBudgetIds:I})}catch(C){console.error("Error scanning for sample user budgets:",C)}finally{r(!1)}}}async function b(){if(!t||!l||l.budgets.length===0&&l.staleBudgetIds.length===0)return;o(!0),m(null);const C=[];let x=0,S=0,E=0;const T=l.totalMonths,I=l.totalBudgets;g({phase:"deleting-months",monthsDeleted:0,totalMonths:T,budgetsDeleted:0,totalBudgets:I,percentComplete:0});for(const B of l.budgets)try{const k=(await On("months",`delete sample user budget: fetching month IDs for budget ${B.budgetId}`)).docs.filter(j=>j.data.budget_id===B.budgetId).map(j=>({collectionPath:"months",docId:j.id}));k.length>0&&(await _T(k,`delete sample user budget: deleting ${k.length} months for budget ${B.budgetId}`,j=>{x=j,g({phase:"deleting-months",monthsDeleted:x,totalMonths:T,budgetsDeleted:S,totalBudgets:I,percentComplete:Math.round(x/Math.max(T,1)*60)})}),x=k.length)}catch($){C.push(`Failed to delete months for budget ${B.budgetId}: ${$ instanceof Error?$.message:"Unknown error"}`)}g({phase:"deleting-payees",monthsDeleted:x,totalMonths:T,budgetsDeleted:S,totalBudgets:I,percentComplete:60});for(const B of l.budgets)try{await Iy("payees",B.budgetId,`delete sample user budget: deleting payees for budget ${B.budgetId}`),E++}catch{}g({phase:"deleting-budgets",monthsDeleted:x,totalMonths:T,budgetsDeleted:S,totalBudgets:I,percentComplete:70});for(const B of l.budgets)try{await Iy("budgets",B.budgetId,`delete sample user budget: deleting budget ${B.budgetId}`),S++,g({phase:"deleting-budgets",monthsDeleted:x,totalMonths:T,budgetsDeleted:S,totalBudgets:I,percentComplete:70+Math.round(S/I*10)})}catch($){C.push(`Failed to delete budget ${B.budgetId}: ${$ instanceof Error?$.message:"Unknown error"}`)}g({phase:"updating-user",monthsDeleted:x,totalMonths:T,budgetsDeleted:S,totalBudgets:I,percentComplete:80});const D=[...l.budgets.map(B=>B.budgetId),...l.staleBudgetIds];try{const B=await On("users","delete sample user budget: finding sample user document to remove budget references",[{field:"email",op:"==",value:qg}]);if(B.docs.length>0){const $=B.docs[0],k=$.id,j=$.data,N=(j.budget_ids||[]).filter(F=>!D.includes(F));await Hn("users",k,{...j,budget_ids:N,updated_at:new Date().toISOString()},"delete sample user budget: removing deleted budget IDs from sample user document"),console.log(`delete sample user budget: removed ${D.length} budget IDs from sample user document`)}else console.log("delete sample user budget: no sample user document found, skipping user update")}catch(B){C.push(`Failed to update sample user document: ${B instanceof Error?B.message:"Unknown error"}`)}g({phase:"clearing-cache",monthsDeleted:x,totalMonths:T,budgetsDeleted:S,totalBudgets:I,percentComplete:95}),Ma(),g({phase:"complete",monthsDeleted:x,totalMonths:T,budgetsDeleted:S,totalBudgets:I,percentComplete:100}),m({budgetsDeleted:S,monthsDeleted:x,payeesDeleted:E,errors:C}),o(!1),g(null),C.length===0&&(d({budgets:[],totalBudgets:0,totalMonths:0,hasPayees:!1,staleBudgetIds:[]}),e?.())}return{status:l,isScanning:n,scanStatus:v,isDeleting:i,deleteResult:h,deleteProgress:p,deleteSampleUserBudget:b}}function O1(t){if(!t)return 0;let e=0;for(const n of t)ut(n.start_balance??0)&&e++,ut(n.end_balance??0)&&e++,ut(n.allocated??0)&&e++,ut(n.spent??0)&&e++,ut(n.income??0)&&e++,ut(n.expenses??0)&&e++,ut(n.net_change??0)&&e++;return e}function N1(t){if(!t)return 0;let e=0;for(const n of t)ut(n.amount??0)&&e++;return e}async function P1(){const t=await On("budgets","precision cleanup: scanning all budgets");let e=0,n=0,r=0,i=0;for(const g of t.docs){const v=g.data;let b=!1;ut(v.total_available??0)&&(i++,b=!0);const C=v.accounts;if(C&&typeof C=="object")for(const S of Object.values(C))ut(S.balance??0)&&(n++,b=!0);const x=v.categories;if(x&&typeof x=="object")for(const S of Object.values(x))ut(S.balance??0)&&(r++,b=!0),ut(S.default_monthly_amount??0)&&(r++,b=!0);b&&e++}const o=await On("months","precision cleanup: scanning all months");let l=0,d=0,h=0,m=0,p=0;for(const g of o.docs){const v=g.data;let b=!1;(ut(v.total_income??0)||ut(v.total_expenses??0)||ut(v.previous_month_income??0))&&(b=!0);const C=N1(v.income);C>0&&(d+=C,b=!0);const x=N1(v.expenses);x>0&&(h+=x,b=!0);const S=O1(v.category_balances);S>0&&(m+=S,b=!0);const E=O1(v.account_balances);E>0&&(p+=E,b=!0),b&&l++}return{totalBudgets:t.docs.length,budgetsWithPrecisionIssues:e,accountsWithPrecisionIssues:n,categoriesWithPrecisionIssues:r,totalAvailableWithPrecisionIssues:i,totalMonths:o.docs.length,monthsWithPrecisionIssues:l,incomeValuesWithPrecisionIssues:d,expenseValuesWithPrecisionIssues:h,categoryBalancesWithPrecisionIssues:m,accountBalancesWithPrecisionIssues:p}}function z1(t){const e={...t};return e.start_balance!==void 0&&(e.start_balance=Me(e.start_balance)),e.end_balance!==void 0&&(e.end_balance=Me(e.end_balance)),e.allocated!==void 0&&(e.allocated=Me(e.allocated)),e.spent!==void 0&&(e.spent=Me(e.spent)),e.income!==void 0&&(e.income=Me(e.income)),e.expenses!==void 0&&(e.expenses=Me(e.expenses)),e.transfers!==void 0&&(e.transfers=Me(e.transfers)),e.adjustments!==void 0&&(e.adjustments=Me(e.adjustments)),e.net_change!==void 0&&(e.net_change=Me(e.net_change)),e}function v3(t,e){let n=!1;ut(t.total_available??0)&&(t.total_available=Me(t.total_available??0),e.totalAvailableFixed++,n=!0);const r=t.accounts;if(r&&typeof r=="object")for(const[o,l]of Object.entries(r)){const d=l;ut(d.balance??0)&&(r[o].balance=Me(d.balance??0),e.accountsFixed++,n=!0)}const i=t.categories;if(i&&typeof i=="object")for(const[o,l]of Object.entries(i)){const d=l;ut(d.balance??0)&&(i[o].balance=Me(d.balance??0),e.categoriesFixed++,n=!0),ut(d.default_monthly_amount??0)&&(i[o].default_monthly_amount=Me(d.default_monthly_amount??0),e.categoriesFixed++,n=!0)}return{fixed:n,data:t}}function x3(t,e){let n=!1;if(ut(t.total_income??0)&&(t.total_income=Me(t.total_income??0),n=!0),ut(t.total_expenses??0)&&(t.total_expenses=Me(t.total_expenses??0),n=!0),ut(t.previous_month_income??0)&&(t.previous_month_income=Me(t.previous_month_income??0),n=!0),t.income&&Array.isArray(t.income)){const r=[];for(const i of t.income)ut(i.amount??0)?(r.push({...i,amount:Me(i.amount??0)}),e.incomeValuesFixed++,n=!0):r.push(i);t.income=r}if(t.expenses&&Array.isArray(t.expenses)){const r=[];for(const i of t.expenses)ut(i.amount??0)?(r.push({...i,amount:Me(i.amount??0)}),e.expenseValuesFixed++,n=!0):r.push(i);t.expenses=r}if(t.category_balances&&Array.isArray(t.category_balances)){const r=[];for(const i of t.category_balances)ut(i.start_balance??0)||ut(i.end_balance??0)||ut(i.allocated??0)||ut(i.spent??0)||ut(i.transfers??0)||ut(i.adjustments??0)?(r.push(z1(i)),e.categoryBalancesFixed++,n=!0):r.push(i);t.category_balances=r}if(t.account_balances&&Array.isArray(t.account_balances)){const r=[];for(const i of t.account_balances)ut(i.start_balance??0)||ut(i.end_balance??0)||ut(i.income??0)||ut(i.expenses??0)||ut(i.transfers??0)||ut(i.adjustments??0)||ut(i.net_change??0)?(r.push(z1(i)),e.accountBalancesFixed++,n=!0):r.push(i);t.account_balances=r}return{fixed:n,data:t}}function w3(t,e,n){const r={...t.data},{fixed:i,data:o}=v3(r,n),l=i?{budgetId:t.id,data:o}:null;i&&n.budgetsProcessed++;const d=[];let h=!1;for(const m of e){const p={...m.data},{fixed:g,data:v}=x3(p,n);g&&(n.monthsProcessed++,h=!0),d.push(v)}return{budgetUpdate:l,fixedMonths:d,hasMonthFixes:h}}async function S3(){const t={budgetsProcessed:0,accountsFixed:0,categoriesFixed:0,totalAvailableFixed:0,monthsProcessed:0,incomeValuesFixed:0,expenseValuesFixed:0,categoryBalancesFixed:0,accountBalancesFixed:0,errors:[]},{budgets:e,monthsByBudget:n}=await Ua("precision cleanup"),r=[],i=[];for(const o of e)try{const l=n.get(o.id)||[],{budgetUpdate:d,fixedMonths:h,hasMonthFixes:m}=w3(o,l,t);d&&r.push(d),(m||h.length>0)&&i.push({budgetId:o.id,months:h})}catch(l){t.errors.push(`Budget ${o.id}: ${l instanceof Error?l.message:String(l)}`)}if(r.length>0)try{await UT(r,"precision cleanup")}catch(o){t.errors.push(`Budget batch write: ${o instanceof Error?o.message:String(o)}`)}for(const{budgetId:o,months:l}of i)try{await FT(o,l,"precision cleanup")}catch(d){t.errors.push(`Budget ${o} recalc: ${d instanceof Error?d.message:String(d)}`)}return t}function C3({currentUser:t,onComplete:e}){const[n,r]=M.useState(null),[i,o]=M.useState(!1),[l,d]=M.useState(!1),[h,m]=M.useState(null),[p,g]=M.useState(null),v=n?n.accountsWithPrecisionIssues+n.categoriesWithPrecisionIssues+n.totalAvailableWithPrecisionIssues+n.incomeValuesWithPrecisionIssues+n.expenseValuesWithPrecisionIssues+n.categoryBalancesWithPrecisionIssues+n.accountBalancesWithPrecisionIssues:0,b=v>0,C=M.useCallback(async()=>{if(t){o(!0),g(null);try{const S=await P1();r(S),m(null)}catch(S){g(S instanceof Error?S.message:"Failed to scan for precision issues")}finally{o(!1)}}},[t]),x=M.useCallback(async()=>{if(!(!t||!b)){d(!0),g(null);try{const S=await ym(()=>S3());m(S);const E=await P1();r(E),e?.()}catch(S){g(S instanceof Error?S.message:"Failed to run precision cleanup")}finally{d(!1)}}},[t,b,e]);return{status:n,isScanning:i,isRunning:l,result:h,error:p,totalIssues:v,hasIssues:b,hasData:n!==null,scan:C,runCleanup:x}}function _m(t){const e=t.income||[],n=t.expenses||[],r=Me(e.reduce((d,h)=>d+h.amount,0)),i=Me(n.reduce((d,h)=>d+h.amount,0)),o=E3(t),l=T3(t);return{...t,total_income:r,total_expenses:i,account_balances:o,category_balances:l}}function E3(t){const e=t.income||[],n=t.expenses||[],r=t.transfers||[],i=t.adjustments||[],o=t.account_balances||[],l=new Map;for(const m of o)Je(m.account_id)||l.set(m.account_id,m);const d=new Set;for(const m of e)Je(m.account_id)||d.add(m.account_id);for(const m of n)Je(m.account_id)||d.add(m.account_id);for(const m of r)Je(m.from_account_id)||d.add(m.from_account_id),Je(m.to_account_id)||d.add(m.to_account_id);for(const m of i)Je(m.account_id)||d.add(m.account_id);for(const m of o)Je(m.account_id)||d.add(m.account_id);const h=[];for(const m of d){const p=l.get(m),g=Me(p?.start_balance??0),v=Me(e.filter(I=>I.account_id===m).reduce((I,D)=>I+D.amount,0)),b=Me(n.filter(I=>I.account_id===m).reduce((I,D)=>I+D.amount,0)),C=Me(r.filter(I=>I.from_account_id===m).reduce((I,D)=>I-D.amount,0)),x=Me(r.filter(I=>I.to_account_id===m).reduce((I,D)=>I+D.amount,0)),S=Me(x+C),E=Me(i.filter(I=>I.account_id===m).reduce((I,D)=>I+D.amount,0)),T=Me(v+b+S+E);h.push({account_id:m,start_balance:g,income:v,expenses:b,transfers:S,adjustments:E,net_change:T,end_balance:Me(g+T)})}return h}function T3(t){const e=t.expenses||[],n=t.transfers||[],r=t.adjustments||[],i=t.category_balances||[],o=new Map;for(const g of i)it(g.category_id)||o.set(g.category_id,g);const l=new Map;for(const g of e){if(it(g.category_id))continue;const v=l.get(g.category_id)||0;l.set(g.category_id,v+g.amount)}const d=new Map;for(const g of n){if(!it(g.from_category_id)){const v=d.get(g.from_category_id)||0;d.set(g.from_category_id,v-g.amount)}if(!it(g.to_category_id)){const v=d.get(g.to_category_id)||0;d.set(g.to_category_id,v+g.amount)}}const h=new Map;for(const g of r)if(!it(g.category_id)){const v=h.get(g.category_id)||0;h.set(g.category_id,v+g.amount)}const m=new Set;for(const g of i)it(g.category_id)||m.add(g.category_id);for(const g of e)it(g.category_id)||m.add(g.category_id);for(const g of n)it(g.from_category_id)||m.add(g.from_category_id),it(g.to_category_id)||m.add(g.to_category_id);for(const g of r)it(g.category_id)||m.add(g.category_id);const p=[];for(const g of m){const v=o.get(g),b=Me(l.get(g)??0),C=Me(d.get(g)??0),x=Me(h.get(g)??0);if(v){const S=Me(v.start_balance),E=Me(v.allocated);p.push({category_id:g,start_balance:S,allocated:E,spent:b,transfers:C,adjustments:x,end_balance:Me(S+E+b+C+x)})}else p.push({category_id:g,start_balance:0,allocated:0,spent:b,transfers:C,adjustments:x,end_balance:Me(b+C+x)})}return p}const A3=["unknown","Unknown","UNKNOWN","","null","undefined","N/A","n/a"],j3=["unknown","Unknown","UNKNOWN","","null","undefined","N/A","n/a"];function bm(t){return!t||Je(t)?!0:A3.includes(t)}function vm(t){return!t||it(t)?!0:j3.includes(t)}function VT(t){return bm(t.account_id)||vm(t.category_id)}function R3(t){return{id:t.id.replace("expense_","adjustment_"),amount:t.amount,account_id:bm(t.account_id)?Gt:t.account_id,category_id:vm(t.category_id)?Xt:t.category_id,date:t.date,description:t.description||t.payee,cleared:t.cleared,created_at:t.created_at}}function I3(t){const e=t.data,n=e.expenses||[],r=e.adjustments||[],i=[],o=[];let l=0,d=0;for(const m of n)VT(m)?(bm(m.account_id)&&!Je(m.account_id)&&l++,vm(m.category_id)&&!it(m.category_id)&&d++,o.push(R3(m))):i.push(m);return o.length===0?{needsUpdate:!1,updatedMonth:null,stats:{expensesMigrated:0,invalidAccountsFixed:0,invalidCategoriesFixed:0}}:{needsUpdate:!0,updatedMonth:_m({...e,expenses:i,adjustments:[...r,...o],transfers:e.transfers||[],updated_at:new Date().toISOString()}),stats:{expensesMigrated:o.length,invalidAccountsFixed:l,invalidCategoriesFixed:d}}}async function k3(){const{budgets:t,monthsByBudget:e}=await Ua("expense-to-adjustment-scan");let n=0,r=0,i=0,o=0;for(const l of t){const d=e.get(l.id)||[];n+=d.length;for(const h of d){const p=h.data.expenses||[];for(const g of p)VT(g)&&(r++,bm(g.account_id)&&!Je(g.account_id)&&i++,vm(g.category_id)&&!it(g.category_id)&&o++)}}return{totalBudgets:t.length,totalMonths:n,expensesToMigrate:r,invalidAccountsToFix:i,invalidCategoriesToFix:o}}async function D3(){const{budgets:t,monthsByBudget:e}=await Ua("expense-to-adjustment-migration"),n=[];let r=0,i=0,o=0;const l=[];for(const d of t){const h=e.get(d.id)||[];for(const m of h)try{const{needsUpdate:p,updatedMonth:g,stats:v}=I3(m);p&&g&&(n.push({budgetId:d.id,year:m.year,month:m.month,data:g}),r+=v.expensesMigrated,i+=v.invalidAccountsFixed,o+=v.invalidCategoriesFixed)}catch(p){l.push(`Month ${m.year}/${m.month} in budget ${d.id}: ${p instanceof Error?p.message:String(p)}`)}}return n.length>0&&await cd(n,"expense-to-adjustment-migration"),{budgetsProcessed:t.length,monthsProcessed:n.length,expensesMigrated:r,invalidAccountsFixed:i,invalidCategoriesFixed:o,errors:l}}function M3({currentUser:t,onComplete:e}){const[n,r]=M.useState(!1),[i,o]=M.useState(!1),[l,d]=M.useState(null),[h,m]=M.useState(null);async function p(){if(t){r(!0);try{const b=await k3();d(b)}catch(b){console.error("Failed to scan for expense to adjustment migration:",b)}finally{r(!1)}}}async function g(){if(t){o(!0),m(null);try{const b=await ym(()=>D3());m(b),e?.()}catch(b){m({budgetsProcessed:0,monthsProcessed:0,expensesMigrated:0,invalidAccountsFixed:0,invalidCategoriesFixed:0,errors:[b instanceof Error?b.message:"Unknown error"]})}finally{o(!1)}}}const v=l!==null&&l.expensesToMigrate>0;return{status:l,isScanning:n,scanStatus:p,hasItemsToMigrate:v,isRunning:i,result:h,runMigration:g}}function $T(t){const e=new Set,n=new Set,r=t.categories;if(r)for(const o of Object.keys(r))e.add(o);const i=t.accounts;if(i)for(const o of Object.keys(i))n.add(o);return{categoryIds:e,accountIds:n}}function ma(t,e){return!t||it(t)?!1:!e.has(t)}function Ls(t,e){return!t||Je(t)?!1:!e.has(t)}function O3(t,e){const n=t.data;let r=0,i=0,o=0,l=0,d=0,h=0,m=!1;const p=(n.expenses||[]).map(x=>{const S={...x};let E=!1;return ma(x.category_id,e.categoryIds)&&(S.category_id=Xt,r++,E=!0),Ls(x.account_id,e.accountIds)&&(S.account_id=Gt,i++,E=!0),E&&(o++,m=!0),S}),g=(n.income||[]).map(x=>{const S={...x};let E=!1;return Ls(x.account_id,e.accountIds)&&(S.account_id=Gt,i++,E=!0),E&&(l++,m=!0),S}),v=(n.transfers||[]).map(x=>{const S={...x};let E=!1;return ma(x.from_category_id,e.categoryIds)&&(S.from_category_id=Xt,r++,E=!0),ma(x.to_category_id,e.categoryIds)&&(S.to_category_id=Xt,r++,E=!0),Ls(x.from_account_id,e.accountIds)&&(S.from_account_id=Gt,i++,E=!0),Ls(x.to_account_id,e.accountIds)&&(S.to_account_id=Gt,i++,E=!0),E&&(d++,m=!0),S}),b=(n.adjustments||[]).map(x=>{const S={...x};let E=!1;return ma(x.category_id,e.categoryIds)&&(S.category_id=Xt,r++,E=!0),Ls(x.account_id,e.accountIds)&&(S.account_id=Gt,i++,E=!0),E&&(h++,m=!0),S});return m?{needsUpdate:!0,updatedMonth:{...n,expenses:p,income:g,transfers:v,adjustments:b,updated_at:new Date().toISOString()},stats:{categoryIdsFixed:r,accountIdsFixed:i,affectedExpenses:o,affectedIncome:l,affectedTransfers:d,affectedAdjustments:h}}:{needsUpdate:!1,updatedMonth:null,stats:{categoryIdsFixed:0,accountIdsFixed:0,affectedExpenses:0,affectedIncome:0,affectedTransfers:0,affectedAdjustments:0}}}async function N3(){const{budgets:t,monthsByBudget:e}=await Ua("orphaned-id-scan");let n=0,r=0,i=0,o=0,l=0,d=0,h=0;for(const m of t){const p=$T(m.data),g=e.get(m.id)||[];n+=g.length;for(const v of g){const b=v.data;for(const C of b.expenses||[]){let x=!1;ma(C.category_id,p.categoryIds)&&(r++,x=!0),Ls(C.account_id,p.accountIds)&&(i++,x=!0),x&&o++}for(const C of b.income||[])Ls(C.account_id,p.accountIds)&&(i++,l++);for(const C of b.transfers||[]){let x=!1;ma(C.from_category_id,p.categoryIds)&&(r++,x=!0),ma(C.to_category_id,p.categoryIds)&&(r++,x=!0),Ls(C.from_account_id,p.accountIds)&&(i++,x=!0),Ls(C.to_account_id,p.accountIds)&&(i++,x=!0),x&&d++}for(const C of b.adjustments||[]){let x=!1;ma(C.category_id,p.categoryIds)&&(r++,x=!0),Ls(C.account_id,p.accountIds)&&(i++,x=!0),x&&h++}}}return{totalBudgets:t.length,totalMonths:n,orphanedCategoryIds:r,orphanedAccountIds:i,affectedExpenses:o,affectedIncome:l,affectedTransfers:d,affectedAdjustments:h}}async function P3(){const{budgets:t,monthsByBudget:e}=await Ua("orphaned-id-cleanup"),n=[];let r=0,i=0;const o=[];for(const l of t){const d=$T(l.data),h=e.get(l.id)||[];for(const m of h)try{const{needsUpdate:p,updatedMonth:g,stats:v}=O3(m,d);p&&g&&(n.push({budgetId:l.id,year:m.year,month:m.month,data:g}),r+=v.categoryIdsFixed,i+=v.accountIdsFixed)}catch(p){o.push(`Month ${m.year}/${m.month} in budget ${l.id}: ${p instanceof Error?p.message:String(p)}`)}}return n.length>0&&await cd(n,"orphaned-id-cleanup"),{budgetsProcessed:t.length,monthsProcessed:n.length,categoryIdsFixed:r,accountIdsFixed:i,errors:o}}function z3({currentUser:t,onComplete:e}){const[n,r]=M.useState(!1),[i,o]=M.useState(!1),[l,d]=M.useState(null),[h,m]=M.useState(null);async function p(){if(t){r(!0);try{const b=await N3();d(b)}catch(b){console.error("Failed to scan for orphaned IDs:",b)}finally{r(!1)}}}async function g(){if(t){o(!0),m(null);try{const b=await ym(()=>P3());m(b),e?.()}catch(b){m({budgetsProcessed:0,monthsProcessed:0,categoryIdsFixed:0,accountIdsFixed:0,errors:[b instanceof Error?b.message:"Unknown error"]})}finally{o(!1)}}}const v=l!==null&&(l.orphanedCategoryIds>0||l.orphanedAccountIds>0);return{status:l,isScanning:n,scanStatus:p,hasItemsToFix:v,isRunning:i,result:h,runMigration:g}}function B3(t,e){if(t.date!==e.date||Math.abs(t.amount+e.amount)>.001)return null;const n=t.amount<0?t:e,r=t.amount<0?e:t,i=it(t.category_id)&&it(e.category_id),o=!Je(t.account_id)&&!Je(e.account_id),l=t.account_id!==e.account_id;if(i&&o&&l)return{negative:n,positive:r,type:"account"};const d=Je(t.account_id)&&Je(e.account_id),h=!it(t.category_id)&&!it(e.category_id),m=t.category_id!==e.category_id;return d&&h&&m?{negative:n,positive:r,type:"category"}:null}function qT(t){const e=[],n=new Set;for(let r=0;r<t.length;r++)if(!n.has(t[r].id))for(let i=r+1;i<t.length;i++){if(n.has(t[i].id))continue;const o=B3(t[r],t[i]);if(o){e.push(o),n.add(t[r].id),n.add(t[i].id);break}}return e}function L3(t){const{negative:e,positive:n,type:r}=t;return r==="account"?{id:`transfer_from_adj_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,amount:Math.abs(e.amount),from_account_id:e.account_id,to_account_id:n.account_id,from_category_id:Xt,to_category_id:Xt,date:e.date,description:e.description||n.description||"Transfer",cleared:e.cleared&&n.cleared,created_at:new Date().toISOString()}:{id:`transfer_from_adj_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,amount:Math.abs(e.amount),from_account_id:Gt,to_account_id:Gt,from_category_id:e.category_id,to_category_id:n.category_id,date:e.date,description:e.description||n.description||"Transfer",cleared:e.cleared&&n.cleared,created_at:new Date().toISOString()}}function U3(t){const e=t.data,n=e.adjustments||[],r=e.transfers||[],i=qT(n);if(i.length===0)return{needsUpdate:!1,updatedMonth:null,stats:{pairsConverted:0,adjustmentsRemoved:0}};const o=i.map(L3),l=new Set;for(const m of i)l.add(m.negative.id),l.add(m.positive.id);const d=n.filter(m=>!l.has(m.id));return{needsUpdate:!0,updatedMonth:{...e,adjustments:d,transfers:[...r,...o],updated_at:new Date().toISOString()},stats:{pairsConverted:i.length,adjustmentsRemoved:l.size}}}async function F3(){const{budgets:t,monthsByBudget:e}=await Ua("adjustments-to-transfers-scan");let n=0,r=0,i=0,o=0;for(const l of t){const d=e.get(l.id)||[];n+=d.length;for(const h of d){const p=h.data.adjustments||[],g=qT(p);r+=g.length;for(const v of g)v.type==="account"?i++:o++}}return{totalBudgets:t.length,totalMonths:n,pairsFound:r,accountTransferPairs:i,categoryTransferPairs:o}}async function V3(){const{budgets:t,monthsByBudget:e}=await Ua("adjustments-to-transfers-migration"),n=[];let r=0,i=0;const o=[];for(const l of t){const d=e.get(l.id)||[];for(const h of d)try{const{needsUpdate:m,updatedMonth:p,stats:g}=U3(h);m&&p&&(n.push({budgetId:l.id,year:h.year,month:h.month,data:p}),r+=g.pairsConverted,i+=g.adjustmentsRemoved)}catch(m){o.push(`Month ${h.year}/${h.month} in budget ${l.id}: ${m instanceof Error?m.message:String(m)}`)}}return n.length>0&&await cd(n,"adjustments-to-transfers-migration"),{budgetsProcessed:t.length,monthsProcessed:n.length,transfersCreated:r,adjustmentsRemoved:i,errors:o}}function $3({currentUser:t,onComplete:e}){const[n,r]=M.useState(!1),[i,o]=M.useState(!1),[l,d]=M.useState(null),[h,m]=M.useState(null);async function p(){if(t){r(!0);try{const b=await F3();d(b)}catch(b){console.error("Failed to scan for adjustment pairs:",b)}finally{r(!1)}}}async function g(){if(t){o(!0),m(null);try{const b=await ym(()=>V3());m(b),e?.()}catch(b){m({budgetsProcessed:0,monthsProcessed:0,transfersCreated:0,adjustmentsRemoved:0,errors:[b instanceof Error?b.message:"Unknown error"]})}finally{o(!1)}}}const v=l!==null&&l.pairsFound>0;return{status:l,isScanning:n,scanStatus:p,hasPairsToConvert:v,isRunning:i,result:h,runMigration:g}}function q3(t){const e=[];let n="",r=!1;for(let i=0;i<t.length;i++){const o=t[i];o==='"'?r=!r:o===","&&!r?(e.push(n.trim()),n=""):n+=o}return e.push(n.trim()),e}function H3(t){if(!t)return 0;let e=t.replace(/[$\s]/g,"");const n=e.startsWith("(")||e.startsWith("-");e=e.replace(/[()]/g,"").replace("-",""),e=e.replace(/,/g,"");const r=parseFloat(e);return isNaN(r)?0:n?-r:r}function G3(t){if(!t)return null;const e=t.split("/");if(e.length!==3)return null;const n=parseInt(e[0],10),r=parseInt(e[1],10),i=parseInt(e[2],10);return isNaN(n)||isNaN(r)||isNaN(i)||n<1||n>12||r<1||r>31?null:{year:i,month:n,day:r}}function Q3(t){if(!t)return!1;const e=t.toLowerCase().trim();return e==="true"||e==="1"||e==="yes"}function W3(t,e){return e.toLowerCase()==="income"?"income":t.toLowerCase()==="budget allocation"?"allocation":"spend"}function K3(t){const e=t.split(`
`).filter(r=>r.trim()),n=[];for(const r of e){const i=q3(r);if(i.length<5)continue;const[o,l,d,h,m,p,g]=i;if(o.toLowerCase()==="cash flow"||o.toLowerCase()==="date")continue;const v=G3(o);if(!v)continue;const b=W3(l,d),C=H3(m),x=Q3(g||"");n.push({recordType:b,date:o,year:v.year,month:v.month,day:v.day,payee:l,category:d,account:h,amount:C,description:p||"",cleared:x,rawLine:r})}return n}function Y3(t){return!t.account_id||t.account_id.trim()===""?"Missing account_id (empty or undefined)":null}function X3(t){const e=[];return(!t.account_id||t.account_id.trim()==="")&&e.push("missing account_id"),(!t.category_id||t.category_id.trim()==="")&&e.push("missing category_id"),e.length>0?e.join(", "):null}function Z3(t){const e=Je(t.account_id)||!t.account_id||t.account_id.trim()==="",n=it(t.category_id)||!t.category_id||t.category_id.trim()==="";return e&&n?"Both account_id and category_id are missing/NO_* (must have at least one real ID)":null}function J3(t){const e=[];if((!t.from_account_id||t.from_account_id.trim()==="")&&e.push("missing from_account_id"),(!t.to_account_id||t.to_account_id.trim()==="")&&e.push("missing to_account_id"),(!t.from_category_id||t.from_category_id.trim()==="")&&e.push("missing from_category_id"),(!t.to_category_id||t.to_category_id.trim()==="")&&e.push("missing to_category_id"),e.length>0)return e.join(", ");const n=t.from_account_id===t.to_account_id,r=t.from_category_id===t.to_category_id;if(n&&r)return"Transfer has same from/to on both account and category (nothing would transfer)";const i=Je(t.from_account_id),o=Je(t.to_account_id),l=it(t.from_category_id),d=it(t.to_category_id);return i&&o&&l&&d?"All from/to account and category IDs are NO_* (must involve at least one real entity)":i&&o&&r?"Both accounts are NO_ACCOUNT and categories are the same (nothing transfers)":l&&d&&n?"Both categories are NO_CATEGORY and accounts are the same (nothing transfers)":null}function $h(t,e,n,r,i){return t.filter(o=>{const[l,d,h]=e.split("-").map(Number);return o.year!==l||o.month!==d||o.day!==h||Math.abs(Math.abs(o.amount)-Math.abs(n))>.01?!1:(r&&o.payee&&o.payee.toLowerCase()===r.toLowerCase()||i&&o.description&&o.description.toLowerCase().includes(i.toLowerCase()),!0)})}async function eP(t){const e=[];let n=0,r=0,i=0,o=0;const l=t?K3(t):[],{budgets:d,monthsByBudget:h}=await Ua("account-category-validation");for(const m of d){const p=h.get(m.id)||[];for(const g of p){const v=g.data,b=`${v.year}-${String(v.month).padStart(2,"0")}`,C=v.income||[];n+=C.length;for(const T of C){const I=Y3(T);I&&e.push({budgetId:m.id,monthKey:b,transactionType:"income",transactionId:T.id,violation:I,transactionDetails:{date:T.date,amount:T.amount,payee:T.payee,description:T.description,accountId:T.account_id},potentialSeedMatches:$h(l,T.date,T.amount,T.payee,T.description)})}const x=v.expenses||[];r+=x.length;for(const T of x){const I=X3(T);I&&e.push({budgetId:m.id,monthKey:b,transactionType:"expense",transactionId:T.id,violation:I,transactionDetails:{date:T.date,amount:T.amount,payee:T.payee,description:T.description,accountId:T.account_id,categoryId:T.category_id},potentialSeedMatches:$h(l,T.date,T.amount,T.payee,T.description)})}const S=v.adjustments||[];i+=S.length;for(const T of S){const I=Z3(T);I&&e.push({budgetId:m.id,monthKey:b,transactionType:"adjustment",transactionId:T.id,violation:I,transactionDetails:{date:T.date,amount:T.amount,description:T.description,accountId:T.account_id,categoryId:T.category_id},potentialSeedMatches:$h(l,T.date,T.amount,void 0,T.description)})}const E=v.transfers||[];o+=E.length;for(const T of E){const I=J3(T);I&&e.push({budgetId:m.id,monthKey:b,transactionType:"transfer",transactionId:T.id,violation:I,transactionDetails:{date:T.date,amount:T.amount,description:T.description,fromAccountId:T.from_account_id,toAccountId:T.to_account_id,fromCategoryId:T.from_category_id,toCategoryId:T.to_category_id},potentialSeedMatches:$h(l,T.date,T.amount,void 0,T.description)})}}}return e.sort((m,p)=>{const g=m.monthKey.localeCompare(p.monthKey);return g!==0?g:m.transactionType.localeCompare(p.transactionType)}),{totalBudgets:d.length,totalMonths:Array.from(h.values()).reduce((m,p)=>m+p.length,0),totalIncome:n,totalExpenses:r,totalAdjustments:i,totalTransfers:o,violations:e,scannedAt:new Date().toISOString()}}function tP(t){const e=[];if(e.push("=".repeat(80),"ACCOUNT/CATEGORY VALIDATION REPORT",`Scanned at: ${t.scannedAt}`,"=".repeat(80),"","SUMMARY:"),e.push(`  Budgets scanned: ${t.totalBudgets}`,`  Months scanned: ${t.totalMonths}`,`  Income transactions: ${t.totalIncome}`,`  Expense transactions: ${t.totalExpenses}`,`  Adjustment transactions: ${t.totalAdjustments}`,`  Transfer transactions: ${t.totalTransfers}`,`  VIOLATIONS FOUND: ${t.violations.length}`,""),t.violations.length===0)return e.push(" No violations found!"),e.join(`
`);const n=new Map;for(const r of t.violations)n.has(r.transactionType)||n.set(r.transactionType,[]),n.get(r.transactionType).push(r);e.push("-".repeat(80),"VIOLATIONS BY TYPE:","-".repeat(80));for(const[r,i]of n){e.push("",`## ${r.toUpperCase()} (${i.length} violations)`,"");for(const o of i){if(e.push(`  [${o.monthKey}] ID: ${o.transactionId}`,`    Violation: ${o.violation}`,`    Date: ${o.transactionDetails.date}`,`    Amount: ${o.transactionDetails.amount}`),o.transactionDetails.payee&&e.push(`    Payee: ${o.transactionDetails.payee}`),o.transactionDetails.description&&e.push(`    Description: ${o.transactionDetails.description}`),o.transactionDetails.accountId!==void 0&&e.push(`    Account ID: ${o.transactionDetails.accountId||"(empty)"}`),o.transactionDetails.categoryId!==void 0&&e.push(`    Category ID: ${o.transactionDetails.categoryId||"(empty)"}`),o.transactionDetails.fromAccountId!==void 0&&e.push(`    From Account: ${o.transactionDetails.fromAccountId||"(empty)"}`,`    To Account: ${o.transactionDetails.toAccountId||"(empty)"}`,`    From Category: ${o.transactionDetails.fromCategoryId||"(empty)"}`,`    To Category: ${o.transactionDetails.toCategoryId||"(empty)"}`),o.potentialSeedMatches.length>0){e.push(`    POTENTIAL SEED MATCHES (${o.potentialSeedMatches.length}):`);for(const l of o.potentialSeedMatches.slice(0,5))e.push(`      - Line: ${l.rawLine}`,`        Type: ${l.recordType}, Date: ${l.date}, Payee: ${l.payee}`,`        Category: ${l.category}, Account: ${l.account}`);o.potentialSeedMatches.length>5&&e.push(`      ... and ${o.potentialSeedMatches.length-5} more matches`)}else e.push("    No seed matches found");e.push("")}}return e.join(`
`)}function nP({currentUser:t}){const[e,n]=M.useState(!1),[r,i]=M.useState(null),[o,l]=M.useState(null);async function d(h){if(t){n(!0),i(null),l(null);try{const m=await eP(h);i(m),l(tP(m))}catch(m){console.error("Failed to scan transactions:",m),l(`Error scanning: ${m instanceof Error?m.message:"Unknown error"}`)}finally{n(!1)}}}return{isScanning:e,status:r,report:o,scan:d,hasViolations:r!==null&&r.violations.length>0,violationCount:r?.violations.length??0}}function qh(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Hg={exports:{}};var B1;function rP(){return B1||(B1=1,(function(t,e){(function(n){t.exports=n()})(function(){return(function n(r,i,o){function l(m,p){if(!i[m]){if(!r[m]){var g=typeof qh=="function"&&qh;if(!p&&g)return g(m,!0);if(d)return d(m,!0);var v=new Error("Cannot find module '"+m+"'");throw v.code="MODULE_NOT_FOUND",v}var b=i[m]={exports:{}};r[m][0].call(b.exports,function(C){var x=r[m][1][C];return l(x||C)},b,b.exports,n,r,i,o)}return i[m].exports}for(var d=typeof qh=="function"&&qh,h=0;h<o.length;h++)l(o[h]);return l})({1:[function(n,r,i){var o=n("./utils"),l=n("./support"),d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(h){for(var m,p,g,v,b,C,x,S=[],E=0,T=h.length,I=T,D=o.getTypeOf(h)!=="string";E<h.length;)I=T-E,g=D?(m=h[E++],p=E<T?h[E++]:0,E<T?h[E++]:0):(m=h.charCodeAt(E++),p=E<T?h.charCodeAt(E++):0,E<T?h.charCodeAt(E++):0),v=m>>2,b=(3&m)<<4|p>>4,C=1<I?(15&p)<<2|g>>6:64,x=2<I?63&g:64,S.push(d.charAt(v)+d.charAt(b)+d.charAt(C)+d.charAt(x));return S.join("")},i.decode=function(h){var m,p,g,v,b,C,x=0,S=0,E="data:";if(h.substr(0,E.length)===E)throw new Error("Invalid base64 input, it looks like a data url.");var T,I=3*(h=h.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(h.charAt(h.length-1)===d.charAt(64)&&I--,h.charAt(h.length-2)===d.charAt(64)&&I--,I%1!=0)throw new Error("Invalid base64 input, bad content length.");for(T=l.uint8array?new Uint8Array(0|I):new Array(0|I);x<h.length;)m=d.indexOf(h.charAt(x++))<<2|(v=d.indexOf(h.charAt(x++)))>>4,p=(15&v)<<4|(b=d.indexOf(h.charAt(x++)))>>2,g=(3&b)<<6|(C=d.indexOf(h.charAt(x++))),T[S++]=m,b!==64&&(T[S++]=p),C!==64&&(T[S++]=g);return T}},{"./support":30,"./utils":32}],2:[function(n,r,i){var o=n("./external"),l=n("./stream/DataWorker"),d=n("./stream/Crc32Probe"),h=n("./stream/DataLengthProbe");function m(p,g,v,b,C){this.compressedSize=p,this.uncompressedSize=g,this.crc32=v,this.compression=b,this.compressedContent=C}m.prototype={getContentWorker:function(){var p=new l(o.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new h("data_length")),g=this;return p.on("end",function(){if(this.streamInfo.data_length!==g.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),p},getCompressedWorker:function(){return new l(o.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},m.createWorkerFrom=function(p,g,v){return p.pipe(new d).pipe(new h("uncompressedSize")).pipe(g.compressWorker(v)).pipe(new h("compressedSize")).withStreamInfo("compression",g)},r.exports=m},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(n,r,i){var o=n("./stream/GenericWorker");i.STORE={magic:"\0\0",compressWorker:function(){return new o("STORE compression")},uncompressWorker:function(){return new o("STORE decompression")}},i.DEFLATE=n("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(n,r,i){var o=n("./utils"),l=(function(){for(var d,h=[],m=0;m<256;m++){d=m;for(var p=0;p<8;p++)d=1&d?3988292384^d>>>1:d>>>1;h[m]=d}return h})();r.exports=function(d,h){return d!==void 0&&d.length?o.getTypeOf(d)!=="string"?(function(m,p,g,v){var b=l,C=v+g;m^=-1;for(var x=v;x<C;x++)m=m>>>8^b[255&(m^p[x])];return-1^m})(0|h,d,d.length,0):(function(m,p,g,v){var b=l,C=v+g;m^=-1;for(var x=v;x<C;x++)m=m>>>8^b[255&(m^p.charCodeAt(x))];return-1^m})(0|h,d,d.length,0):0}},{"./utils":32}],5:[function(n,r,i){i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!0,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],6:[function(n,r,i){var o=null;o=typeof Promise<"u"?Promise:n("lie"),r.exports={Promise:o}},{lie:37}],7:[function(n,r,i){var o=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",l=n("pako"),d=n("./utils"),h=n("./stream/GenericWorker"),m=o?"uint8array":"array";function p(g,v){h.call(this,"FlateWorker/"+g),this._pako=null,this._pakoAction=g,this._pakoOptions=v,this.meta={}}i.magic="\b\0",d.inherits(p,h),p.prototype.processChunk=function(g){this.meta=g.meta,this._pako===null&&this._createPako(),this._pako.push(d.transformTo(m,g.data),!1)},p.prototype.flush=function(){h.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},p.prototype.cleanUp=function(){h.prototype.cleanUp.call(this),this._pako=null},p.prototype._createPako=function(){this._pako=new l[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var g=this;this._pako.onData=function(v){g.push({data:v,meta:g.meta})}},i.compressWorker=function(g){return new p("Deflate",g)},i.uncompressWorker=function(){return new p("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(n,r,i){function o(b,C){var x,S="";for(x=0;x<C;x++)S+=String.fromCharCode(255&b),b>>>=8;return S}function l(b,C,x,S,E,T){var I,D,B=b.file,$=b.compression,k=T!==m.utf8encode,j=d.transformTo("string",T(B.name)),N=d.transformTo("string",m.utf8encode(B.name)),F=B.comment,q=d.transformTo("string",T(F)),A=d.transformTo("string",m.utf8encode(F)),P=N.length!==B.name.length,O=A.length!==F.length,X="",W="",H="",Z=B.dir,Y=B.date,se={crc32:0,compressedSize:0,uncompressedSize:0};C&&!x||(se.crc32=b.crc32,se.compressedSize=b.compressedSize,se.uncompressedSize=b.uncompressedSize);var L=0;C&&(L|=8),k||!P&&!O||(L|=2048);var G=0,ne=0;Z&&(G|=16),E==="UNIX"?(ne=798,G|=(function(te,ue){var ve=te;return te||(ve=ue?16893:33204),(65535&ve)<<16})(B.unixPermissions,Z)):(ne=20,G|=(function(te){return 63&(te||0)})(B.dosPermissions)),I=Y.getUTCHours(),I<<=6,I|=Y.getUTCMinutes(),I<<=5,I|=Y.getUTCSeconds()/2,D=Y.getUTCFullYear()-1980,D<<=4,D|=Y.getUTCMonth()+1,D<<=5,D|=Y.getUTCDate(),P&&(W=o(1,1)+o(p(j),4)+N,X+="up"+o(W.length,2)+W),O&&(H=o(1,1)+o(p(q),4)+A,X+="uc"+o(H.length,2)+H);var ie="";return ie+=`
\0`,ie+=o(L,2),ie+=$.magic,ie+=o(I,2),ie+=o(D,2),ie+=o(se.crc32,4),ie+=o(se.compressedSize,4),ie+=o(se.uncompressedSize,4),ie+=o(j.length,2),ie+=o(X.length,2),{fileRecord:g.LOCAL_FILE_HEADER+ie+j+X,dirRecord:g.CENTRAL_FILE_HEADER+o(ne,2)+ie+o(q.length,2)+"\0\0\0\0"+o(G,4)+o(S,4)+j+X+q}}var d=n("../utils"),h=n("../stream/GenericWorker"),m=n("../utf8"),p=n("../crc32"),g=n("../signature");function v(b,C,x,S){h.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=C,this.zipPlatform=x,this.encodeFileName=S,this.streamFiles=b,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}d.inherits(v,h),v.prototype.push=function(b){var C=b.meta.percent||0,x=this.entriesCount,S=this._sources.length;this.accumulate?this.contentBuffer.push(b):(this.bytesWritten+=b.data.length,h.prototype.push.call(this,{data:b.data,meta:{currentFile:this.currentFile,percent:x?(C+100*(x-S-1))/x:100}}))},v.prototype.openedSource=function(b){this.currentSourceOffset=this.bytesWritten,this.currentFile=b.file.name;var C=this.streamFiles&&!b.file.dir;if(C){var x=l(b,C,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:x.fileRecord,meta:{percent:0}})}else this.accumulate=!0},v.prototype.closedSource=function(b){this.accumulate=!1;var C=this.streamFiles&&!b.file.dir,x=l(b,C,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(x.dirRecord),C)this.push({data:(function(S){return g.DATA_DESCRIPTOR+o(S.crc32,4)+o(S.compressedSize,4)+o(S.uncompressedSize,4)})(b),meta:{percent:100}});else for(this.push({data:x.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},v.prototype.flush=function(){for(var b=this.bytesWritten,C=0;C<this.dirRecords.length;C++)this.push({data:this.dirRecords[C],meta:{percent:100}});var x=this.bytesWritten-b,S=(function(E,T,I,D,B){var $=d.transformTo("string",B(D));return g.CENTRAL_DIRECTORY_END+"\0\0\0\0"+o(E,2)+o(E,2)+o(T,4)+o(I,4)+o($.length,2)+$})(this.dirRecords.length,x,b,this.zipComment,this.encodeFileName);this.push({data:S,meta:{percent:100}})},v.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},v.prototype.registerPrevious=function(b){this._sources.push(b);var C=this;return b.on("data",function(x){C.processChunk(x)}),b.on("end",function(){C.closedSource(C.previous.streamInfo),C._sources.length?C.prepareNextSource():C.end()}),b.on("error",function(x){C.error(x)}),this},v.prototype.resume=function(){return!!h.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},v.prototype.error=function(b){var C=this._sources;if(!h.prototype.error.call(this,b))return!1;for(var x=0;x<C.length;x++)try{C[x].error(b)}catch{}return!0},v.prototype.lock=function(){h.prototype.lock.call(this);for(var b=this._sources,C=0;C<b.length;C++)b[C].lock()},r.exports=v},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(n,r,i){var o=n("../compressions"),l=n("./ZipFileWorker");i.generateWorker=function(d,h,m){var p=new l(h.streamFiles,m,h.platform,h.encodeFileName),g=0;try{d.forEach(function(v,b){g++;var C=(function(T,I){var D=T||I,B=o[D];if(!B)throw new Error(D+" is not a valid compression method !");return B})(b.options.compression,h.compression),x=b.options.compressionOptions||h.compressionOptions||{},S=b.dir,E=b.date;b._compressWorker(C,x).withStreamInfo("file",{name:v,dir:S,date:E,comment:b.comment||"",unixPermissions:b.unixPermissions,dosPermissions:b.dosPermissions}).pipe(p)}),p.entriesCount=g}catch(v){p.error(v)}return p}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(n,r,i){function o(){if(!(this instanceof o))return new o;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var l=new o;for(var d in this)typeof this[d]!="function"&&(l[d]=this[d]);return l}}(o.prototype=n("./object")).loadAsync=n("./load"),o.support=n("./support"),o.defaults=n("./defaults"),o.version="3.10.1",o.loadAsync=function(l,d){return new o().loadAsync(l,d)},o.external=n("./external"),r.exports=o},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(n,r,i){var o=n("./utils"),l=n("./external"),d=n("./utf8"),h=n("./zipEntries"),m=n("./stream/Crc32Probe"),p=n("./nodejsUtils");function g(v){return new l.Promise(function(b,C){var x=v.decompressed.getContentWorker().pipe(new m);x.on("error",function(S){C(S)}).on("end",function(){x.streamInfo.crc32!==v.decompressed.crc32?C(new Error("Corrupted zip : CRC32 mismatch")):b()}).resume()})}r.exports=function(v,b){var C=this;return b=o.extend(b||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:d.utf8decode}),p.isNode&&p.isStream(v)?l.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):o.prepareContent("the loaded zip file",v,!0,b.optimizedBinaryString,b.base64).then(function(x){var S=new h(b);return S.load(x),S}).then(function(x){var S=[l.Promise.resolve(x)],E=x.files;if(b.checkCRC32)for(var T=0;T<E.length;T++)S.push(g(E[T]));return l.Promise.all(S)}).then(function(x){for(var S=x.shift(),E=S.files,T=0;T<E.length;T++){var I=E[T],D=I.fileNameStr,B=o.resolve(I.fileNameStr);C.file(B,I.decompressed,{binary:!0,optimizedBinaryString:!0,date:I.date,dir:I.dir,comment:I.fileCommentStr.length?I.fileCommentStr:null,unixPermissions:I.unixPermissions,dosPermissions:I.dosPermissions,createFolders:b.createFolders}),I.dir||(C.file(B).unsafeOriginalName=D)}return S.zipComment.length&&(C.comment=S.zipComment),C})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(n,r,i){var o=n("../utils"),l=n("../stream/GenericWorker");function d(h,m){l.call(this,"Nodejs stream input adapter for "+h),this._upstreamEnded=!1,this._bindStream(m)}o.inherits(d,l),d.prototype._bindStream=function(h){var m=this;(this._stream=h).pause(),h.on("data",function(p){m.push({data:p,meta:{percent:0}})}).on("error",function(p){m.isPaused?this.generatedError=p:m.error(p)}).on("end",function(){m.isPaused?m._upstreamEnded=!0:m.end()})},d.prototype.pause=function(){return!!l.prototype.pause.call(this)&&(this._stream.pause(),!0)},d.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},r.exports=d},{"../stream/GenericWorker":28,"../utils":32}],13:[function(n,r,i){var o=n("readable-stream").Readable;function l(d,h,m){o.call(this,h),this._helper=d;var p=this;d.on("data",function(g,v){p.push(g)||p._helper.pause(),m&&m(v)}).on("error",function(g){p.emit("error",g)}).on("end",function(){p.push(null)})}n("../utils").inherits(l,o),l.prototype._read=function(){this._helper.resume()},r.exports=l},{"../utils":32,"readable-stream":16}],14:[function(n,r,i){r.exports={isNode:typeof Buffer<"u",newBufferFrom:function(o,l){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(o,l);if(typeof o=="number")throw new Error('The "data" argument must not be a number');return new Buffer(o,l)},allocBuffer:function(o){if(Buffer.alloc)return Buffer.alloc(o);var l=new Buffer(o);return l.fill(0),l},isBuffer:function(o){return Buffer.isBuffer(o)},isStream:function(o){return o&&typeof o.on=="function"&&typeof o.pause=="function"&&typeof o.resume=="function"}}},{}],15:[function(n,r,i){function o(B,$,k){var j,N=d.getTypeOf($),F=d.extend(k||{},p);F.date=F.date||new Date,F.compression!==null&&(F.compression=F.compression.toUpperCase()),typeof F.unixPermissions=="string"&&(F.unixPermissions=parseInt(F.unixPermissions,8)),F.unixPermissions&&16384&F.unixPermissions&&(F.dir=!0),F.dosPermissions&&16&F.dosPermissions&&(F.dir=!0),F.dir&&(B=E(B)),F.createFolders&&(j=S(B))&&T.call(this,j,!0);var q=N==="string"&&F.binary===!1&&F.base64===!1;k&&k.binary!==void 0||(F.binary=!q),($ instanceof g&&$.uncompressedSize===0||F.dir||!$||$.length===0)&&(F.base64=!1,F.binary=!0,$="",F.compression="STORE",N="string");var A=null;A=$ instanceof g||$ instanceof h?$:C.isNode&&C.isStream($)?new x(B,$):d.prepareContent(B,$,F.binary,F.optimizedBinaryString,F.base64);var P=new v(B,A,F);this.files[B]=P}var l=n("./utf8"),d=n("./utils"),h=n("./stream/GenericWorker"),m=n("./stream/StreamHelper"),p=n("./defaults"),g=n("./compressedObject"),v=n("./zipObject"),b=n("./generate"),C=n("./nodejsUtils"),x=n("./nodejs/NodejsStreamInputAdapter"),S=function(B){B.slice(-1)==="/"&&(B=B.substring(0,B.length-1));var $=B.lastIndexOf("/");return 0<$?B.substring(0,$):""},E=function(B){return B.slice(-1)!=="/"&&(B+="/"),B},T=function(B,$){return $=$!==void 0?$:p.createFolders,B=E(B),this.files[B]||o.call(this,B,null,{dir:!0,createFolders:$}),this.files[B]};function I(B){return Object.prototype.toString.call(B)==="[object RegExp]"}var D={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(B){var $,k,j;for($ in this.files)j=this.files[$],(k=$.slice(this.root.length,$.length))&&$.slice(0,this.root.length)===this.root&&B(k,j)},filter:function(B){var $=[];return this.forEach(function(k,j){B(k,j)&&$.push(j)}),$},file:function(B,$,k){if(arguments.length!==1)return B=this.root+B,o.call(this,B,$,k),this;if(I(B)){var j=B;return this.filter(function(F,q){return!q.dir&&j.test(F)})}var N=this.files[this.root+B];return N&&!N.dir?N:null},folder:function(B){if(!B)return this;if(I(B))return this.filter(function(N,F){return F.dir&&B.test(N)});var $=this.root+B,k=T.call(this,$),j=this.clone();return j.root=k.name,j},remove:function(B){B=this.root+B;var $=this.files[B];if($||(B.slice(-1)!=="/"&&(B+="/"),$=this.files[B]),$&&!$.dir)delete this.files[B];else for(var k=this.filter(function(N,F){return F.name.slice(0,B.length)===B}),j=0;j<k.length;j++)delete this.files[k[j].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(B){var $,k={};try{if((k=d.extend(B||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:l.utf8encode})).type=k.type.toLowerCase(),k.compression=k.compression.toUpperCase(),k.type==="binarystring"&&(k.type="string"),!k.type)throw new Error("No output type specified.");d.checkSupport(k.type),k.platform!=="darwin"&&k.platform!=="freebsd"&&k.platform!=="linux"&&k.platform!=="sunos"||(k.platform="UNIX"),k.platform==="win32"&&(k.platform="DOS");var j=k.comment||this.comment||"";$=b.generateWorker(this,k,j)}catch(N){($=new h("error")).error(N)}return new m($,k.type||"string",k.mimeType)},generateAsync:function(B,$){return this.generateInternalStream(B).accumulate($)},generateNodeStream:function(B,$){return(B=B||{}).type||(B.type="nodebuffer"),this.generateInternalStream(B).toNodejsStream($)}};r.exports=D},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(n,r,i){r.exports=n("stream")},{stream:void 0}],17:[function(n,r,i){var o=n("./DataReader");function l(d){o.call(this,d);for(var h=0;h<this.data.length;h++)d[h]=255&d[h]}n("../utils").inherits(l,o),l.prototype.byteAt=function(d){return this.data[this.zero+d]},l.prototype.lastIndexOfSignature=function(d){for(var h=d.charCodeAt(0),m=d.charCodeAt(1),p=d.charCodeAt(2),g=d.charCodeAt(3),v=this.length-4;0<=v;--v)if(this.data[v]===h&&this.data[v+1]===m&&this.data[v+2]===p&&this.data[v+3]===g)return v-this.zero;return-1},l.prototype.readAndCheckSignature=function(d){var h=d.charCodeAt(0),m=d.charCodeAt(1),p=d.charCodeAt(2),g=d.charCodeAt(3),v=this.readData(4);return h===v[0]&&m===v[1]&&p===v[2]&&g===v[3]},l.prototype.readData=function(d){if(this.checkOffset(d),d===0)return[];var h=this.data.slice(this.zero+this.index,this.zero+this.index+d);return this.index+=d,h},r.exports=l},{"../utils":32,"./DataReader":18}],18:[function(n,r,i){var o=n("../utils");function l(d){this.data=d,this.length=d.length,this.index=0,this.zero=0}l.prototype={checkOffset:function(d){this.checkIndex(this.index+d)},checkIndex:function(d){if(this.length<this.zero+d||d<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+d+"). Corrupted zip ?")},setIndex:function(d){this.checkIndex(d),this.index=d},skip:function(d){this.setIndex(this.index+d)},byteAt:function(){},readInt:function(d){var h,m=0;for(this.checkOffset(d),h=this.index+d-1;h>=this.index;h--)m=(m<<8)+this.byteAt(h);return this.index+=d,m},readString:function(d){return o.transformTo("string",this.readData(d))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var d=this.readInt(4);return new Date(Date.UTC(1980+(d>>25&127),(d>>21&15)-1,d>>16&31,d>>11&31,d>>5&63,(31&d)<<1))}},r.exports=l},{"../utils":32}],19:[function(n,r,i){var o=n("./Uint8ArrayReader");function l(d){o.call(this,d)}n("../utils").inherits(l,o),l.prototype.readData=function(d){this.checkOffset(d);var h=this.data.slice(this.zero+this.index,this.zero+this.index+d);return this.index+=d,h},r.exports=l},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(n,r,i){var o=n("./DataReader");function l(d){o.call(this,d)}n("../utils").inherits(l,o),l.prototype.byteAt=function(d){return this.data.charCodeAt(this.zero+d)},l.prototype.lastIndexOfSignature=function(d){return this.data.lastIndexOf(d)-this.zero},l.prototype.readAndCheckSignature=function(d){return d===this.readData(4)},l.prototype.readData=function(d){this.checkOffset(d);var h=this.data.slice(this.zero+this.index,this.zero+this.index+d);return this.index+=d,h},r.exports=l},{"../utils":32,"./DataReader":18}],21:[function(n,r,i){var o=n("./ArrayReader");function l(d){o.call(this,d)}n("../utils").inherits(l,o),l.prototype.readData=function(d){if(this.checkOffset(d),d===0)return new Uint8Array(0);var h=this.data.subarray(this.zero+this.index,this.zero+this.index+d);return this.index+=d,h},r.exports=l},{"../utils":32,"./ArrayReader":17}],22:[function(n,r,i){var o=n("../utils"),l=n("../support"),d=n("./ArrayReader"),h=n("./StringReader"),m=n("./NodeBufferReader"),p=n("./Uint8ArrayReader");r.exports=function(g){var v=o.getTypeOf(g);return o.checkSupport(v),v!=="string"||l.uint8array?v==="nodebuffer"?new m(g):l.uint8array?new p(o.transformTo("uint8array",g)):new d(o.transformTo("array",g)):new h(g)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(n,r,i){i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(n,r,i){var o=n("./GenericWorker"),l=n("../utils");function d(h){o.call(this,"ConvertWorker to "+h),this.destType=h}l.inherits(d,o),d.prototype.processChunk=function(h){this.push({data:l.transformTo(this.destType,h.data),meta:h.meta})},r.exports=d},{"../utils":32,"./GenericWorker":28}],25:[function(n,r,i){var o=n("./GenericWorker"),l=n("../crc32");function d(){o.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}n("../utils").inherits(d,o),d.prototype.processChunk=function(h){this.streamInfo.crc32=l(h.data,this.streamInfo.crc32||0),this.push(h)},r.exports=d},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(n,r,i){var o=n("../utils"),l=n("./GenericWorker");function d(h){l.call(this,"DataLengthProbe for "+h),this.propName=h,this.withStreamInfo(h,0)}o.inherits(d,l),d.prototype.processChunk=function(h){if(h){var m=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=m+h.data.length}l.prototype.processChunk.call(this,h)},r.exports=d},{"../utils":32,"./GenericWorker":28}],27:[function(n,r,i){var o=n("../utils"),l=n("./GenericWorker");function d(h){l.call(this,"DataWorker");var m=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,h.then(function(p){m.dataIsReady=!0,m.data=p,m.max=p&&p.length||0,m.type=o.getTypeOf(p),m.isPaused||m._tickAndRepeat()},function(p){m.error(p)})}o.inherits(d,l),d.prototype.cleanUp=function(){l.prototype.cleanUp.call(this),this.data=null},d.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,o.delay(this._tickAndRepeat,[],this)),!0)},d.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(o.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},d.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var h=null,m=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":h=this.data.substring(this.index,m);break;case"uint8array":h=this.data.subarray(this.index,m);break;case"array":case"nodebuffer":h=this.data.slice(this.index,m)}return this.index=m,this.push({data:h,meta:{percent:this.max?this.index/this.max*100:0}})},r.exports=d},{"../utils":32,"./GenericWorker":28}],28:[function(n,r,i){function o(l){this.name=l||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}o.prototype={push:function(l){this.emit("data",l)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(l){this.emit("error",l)}return!0},error:function(l){return!this.isFinished&&(this.isPaused?this.generatedError=l:(this.isFinished=!0,this.emit("error",l),this.previous&&this.previous.error(l),this.cleanUp()),!0)},on:function(l,d){return this._listeners[l].push(d),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(l,d){if(this._listeners[l])for(var h=0;h<this._listeners[l].length;h++)this._listeners[l][h].call(this,d)},pipe:function(l){return l.registerPrevious(this)},registerPrevious:function(l){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=l.streamInfo,this.mergeStreamInfo(),this.previous=l;var d=this;return l.on("data",function(h){d.processChunk(h)}),l.on("end",function(){d.end()}),l.on("error",function(h){d.error(h)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var l=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),l=!0),this.previous&&this.previous.resume(),!l},flush:function(){},processChunk:function(l){this.push(l)},withStreamInfo:function(l,d){return this.extraStreamInfo[l]=d,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var l in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,l)&&(this.streamInfo[l]=this.extraStreamInfo[l])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var l="Worker "+this.name;return this.previous?this.previous+" -> "+l:l}},r.exports=o},{}],29:[function(n,r,i){var o=n("../utils"),l=n("./ConvertWorker"),d=n("./GenericWorker"),h=n("../base64"),m=n("../support"),p=n("../external"),g=null;if(m.nodestream)try{g=n("../nodejs/NodejsStreamOutputAdapter")}catch{}function v(C,x){return new p.Promise(function(S,E){var T=[],I=C._internalType,D=C._outputType,B=C._mimeType;C.on("data",function($,k){T.push($),x&&x(k)}).on("error",function($){T=[],E($)}).on("end",function(){try{var $=(function(k,j,N){switch(k){case"blob":return o.newBlob(o.transformTo("arraybuffer",j),N);case"base64":return h.encode(j);default:return o.transformTo(k,j)}})(D,(function(k,j){var N,F=0,q=null,A=0;for(N=0;N<j.length;N++)A+=j[N].length;switch(k){case"string":return j.join("");case"array":return Array.prototype.concat.apply([],j);case"uint8array":for(q=new Uint8Array(A),N=0;N<j.length;N++)q.set(j[N],F),F+=j[N].length;return q;case"nodebuffer":return Buffer.concat(j);default:throw new Error("concat : unsupported type '"+k+"'")}})(I,T),B);S($)}catch(k){E(k)}T=[]}).resume()})}function b(C,x,S){var E=x;switch(x){case"blob":case"arraybuffer":E="uint8array";break;case"base64":E="string"}try{this._internalType=E,this._outputType=x,this._mimeType=S,o.checkSupport(E),this._worker=C.pipe(new l(E)),C.lock()}catch(T){this._worker=new d("error"),this._worker.error(T)}}b.prototype={accumulate:function(C){return v(this,C)},on:function(C,x){var S=this;return C==="data"?this._worker.on(C,function(E){x.call(S,E.data,E.meta)}):this._worker.on(C,function(){o.delay(x,arguments,S)}),this},resume:function(){return o.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(C){if(o.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new g(this,{objectMode:this._outputType!=="nodebuffer"},C)}},r.exports=b},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(n,r,i){if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",i.nodebuffer=typeof Buffer<"u",i.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")i.blob=!1;else{var o=new ArrayBuffer(0);try{i.blob=new Blob([o],{type:"application/zip"}).size===0}catch{try{var l=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);l.append(o),i.blob=l.getBlob("application/zip").size===0}catch{i.blob=!1}}}try{i.nodestream=!!n("readable-stream").Readable}catch{i.nodestream=!1}},{"readable-stream":16}],31:[function(n,r,i){for(var o=n("./utils"),l=n("./support"),d=n("./nodejsUtils"),h=n("./stream/GenericWorker"),m=new Array(256),p=0;p<256;p++)m[p]=252<=p?6:248<=p?5:240<=p?4:224<=p?3:192<=p?2:1;m[254]=m[254]=1;function g(){h.call(this,"utf-8 decode"),this.leftOver=null}function v(){h.call(this,"utf-8 encode")}i.utf8encode=function(b){return l.nodebuffer?d.newBufferFrom(b,"utf-8"):(function(C){var x,S,E,T,I,D=C.length,B=0;for(T=0;T<D;T++)(64512&(S=C.charCodeAt(T)))==55296&&T+1<D&&(64512&(E=C.charCodeAt(T+1)))==56320&&(S=65536+(S-55296<<10)+(E-56320),T++),B+=S<128?1:S<2048?2:S<65536?3:4;for(x=l.uint8array?new Uint8Array(B):new Array(B),T=I=0;I<B;T++)(64512&(S=C.charCodeAt(T)))==55296&&T+1<D&&(64512&(E=C.charCodeAt(T+1)))==56320&&(S=65536+(S-55296<<10)+(E-56320),T++),S<128?x[I++]=S:(S<2048?x[I++]=192|S>>>6:(S<65536?x[I++]=224|S>>>12:(x[I++]=240|S>>>18,x[I++]=128|S>>>12&63),x[I++]=128|S>>>6&63),x[I++]=128|63&S);return x})(b)},i.utf8decode=function(b){return l.nodebuffer?o.transformTo("nodebuffer",b).toString("utf-8"):(function(C){var x,S,E,T,I=C.length,D=new Array(2*I);for(x=S=0;x<I;)if((E=C[x++])<128)D[S++]=E;else if(4<(T=m[E]))D[S++]=65533,x+=T-1;else{for(E&=T===2?31:T===3?15:7;1<T&&x<I;)E=E<<6|63&C[x++],T--;1<T?D[S++]=65533:E<65536?D[S++]=E:(E-=65536,D[S++]=55296|E>>10&1023,D[S++]=56320|1023&E)}return D.length!==S&&(D.subarray?D=D.subarray(0,S):D.length=S),o.applyFromCharCode(D)})(b=o.transformTo(l.uint8array?"uint8array":"array",b))},o.inherits(g,h),g.prototype.processChunk=function(b){var C=o.transformTo(l.uint8array?"uint8array":"array",b.data);if(this.leftOver&&this.leftOver.length){if(l.uint8array){var x=C;(C=new Uint8Array(x.length+this.leftOver.length)).set(this.leftOver,0),C.set(x,this.leftOver.length)}else C=this.leftOver.concat(C);this.leftOver=null}var S=(function(T,I){var D;for((I=I||T.length)>T.length&&(I=T.length),D=I-1;0<=D&&(192&T[D])==128;)D--;return D<0||D===0?I:D+m[T[D]]>I?D:I})(C),E=C;S!==C.length&&(l.uint8array?(E=C.subarray(0,S),this.leftOver=C.subarray(S,C.length)):(E=C.slice(0,S),this.leftOver=C.slice(S,C.length))),this.push({data:i.utf8decode(E),meta:b.meta})},g.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:i.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},i.Utf8DecodeWorker=g,o.inherits(v,h),v.prototype.processChunk=function(b){this.push({data:i.utf8encode(b.data),meta:b.meta})},i.Utf8EncodeWorker=v},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(n,r,i){var o=n("./support"),l=n("./base64"),d=n("./nodejsUtils"),h=n("./external");function m(x){return x}function p(x,S){for(var E=0;E<x.length;++E)S[E]=255&x.charCodeAt(E);return S}n("setimmediate"),i.newBlob=function(x,S){i.checkSupport("blob");try{return new Blob([x],{type:S})}catch{try{var E=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return E.append(x),E.getBlob(S)}catch{throw new Error("Bug : can't construct the Blob.")}}};var g={stringifyByChunk:function(x,S,E){var T=[],I=0,D=x.length;if(D<=E)return String.fromCharCode.apply(null,x);for(;I<D;)S==="array"||S==="nodebuffer"?T.push(String.fromCharCode.apply(null,x.slice(I,Math.min(I+E,D)))):T.push(String.fromCharCode.apply(null,x.subarray(I,Math.min(I+E,D)))),I+=E;return T.join("")},stringifyByChar:function(x){for(var S="",E=0;E<x.length;E++)S+=String.fromCharCode(x[E]);return S},applyCanBeUsed:{uint8array:(function(){try{return o.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}})(),nodebuffer:(function(){try{return o.nodebuffer&&String.fromCharCode.apply(null,d.allocBuffer(1)).length===1}catch{return!1}})()}};function v(x){var S=65536,E=i.getTypeOf(x),T=!0;if(E==="uint8array"?T=g.applyCanBeUsed.uint8array:E==="nodebuffer"&&(T=g.applyCanBeUsed.nodebuffer),T)for(;1<S;)try{return g.stringifyByChunk(x,E,S)}catch{S=Math.floor(S/2)}return g.stringifyByChar(x)}function b(x,S){for(var E=0;E<x.length;E++)S[E]=x[E];return S}i.applyFromCharCode=v;var C={};C.string={string:m,array:function(x){return p(x,new Array(x.length))},arraybuffer:function(x){return C.string.uint8array(x).buffer},uint8array:function(x){return p(x,new Uint8Array(x.length))},nodebuffer:function(x){return p(x,d.allocBuffer(x.length))}},C.array={string:v,array:m,arraybuffer:function(x){return new Uint8Array(x).buffer},uint8array:function(x){return new Uint8Array(x)},nodebuffer:function(x){return d.newBufferFrom(x)}},C.arraybuffer={string:function(x){return v(new Uint8Array(x))},array:function(x){return b(new Uint8Array(x),new Array(x.byteLength))},arraybuffer:m,uint8array:function(x){return new Uint8Array(x)},nodebuffer:function(x){return d.newBufferFrom(new Uint8Array(x))}},C.uint8array={string:v,array:function(x){return b(x,new Array(x.length))},arraybuffer:function(x){return x.buffer},uint8array:m,nodebuffer:function(x){return d.newBufferFrom(x)}},C.nodebuffer={string:v,array:function(x){return b(x,new Array(x.length))},arraybuffer:function(x){return C.nodebuffer.uint8array(x).buffer},uint8array:function(x){return b(x,new Uint8Array(x.length))},nodebuffer:m},i.transformTo=function(x,S){if(S=S||"",!x)return S;i.checkSupport(x);var E=i.getTypeOf(S);return C[E][x](S)},i.resolve=function(x){for(var S=x.split("/"),E=[],T=0;T<S.length;T++){var I=S[T];I==="."||I===""&&T!==0&&T!==S.length-1||(I===".."?E.pop():E.push(I))}return E.join("/")},i.getTypeOf=function(x){return typeof x=="string"?"string":Object.prototype.toString.call(x)==="[object Array]"?"array":o.nodebuffer&&d.isBuffer(x)?"nodebuffer":o.uint8array&&x instanceof Uint8Array?"uint8array":o.arraybuffer&&x instanceof ArrayBuffer?"arraybuffer":void 0},i.checkSupport=function(x){if(!o[x.toLowerCase()])throw new Error(x+" is not supported by this platform")},i.MAX_VALUE_16BITS=65535,i.MAX_VALUE_32BITS=-1,i.pretty=function(x){var S,E,T="";for(E=0;E<(x||"").length;E++)T+="\\x"+((S=x.charCodeAt(E))<16?"0":"")+S.toString(16).toUpperCase();return T},i.delay=function(x,S,E){setImmediate(function(){x.apply(E||null,S||[])})},i.inherits=function(x,S){function E(){}E.prototype=S.prototype,x.prototype=new E},i.extend=function(){var x,S,E={};for(x=0;x<arguments.length;x++)for(S in arguments[x])Object.prototype.hasOwnProperty.call(arguments[x],S)&&E[S]===void 0&&(E[S]=arguments[x][S]);return E},i.prepareContent=function(x,S,E,T,I){return h.Promise.resolve(S).then(function(D){return o.blob&&(D instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(D))!==-1)&&typeof FileReader<"u"?new h.Promise(function(B,$){var k=new FileReader;k.onload=function(j){B(j.target.result)},k.onerror=function(j){$(j.target.error)},k.readAsArrayBuffer(D)}):D}).then(function(D){var B=i.getTypeOf(D);return B?(B==="arraybuffer"?D=i.transformTo("uint8array",D):B==="string"&&(I?D=l.decode(D):E&&T!==!0&&(D=(function($){return p($,o.uint8array?new Uint8Array($.length):new Array($.length))})(D))),D):h.Promise.reject(new Error("Can't read the data of '"+x+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(n,r,i){var o=n("./reader/readerFor"),l=n("./utils"),d=n("./signature"),h=n("./zipEntry"),m=n("./support");function p(g){this.files=[],this.loadOptions=g}p.prototype={checkSignature:function(g){if(!this.reader.readAndCheckSignature(g)){this.reader.index-=4;var v=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+l.pretty(v)+", expected "+l.pretty(g)+")")}},isSignature:function(g,v){var b=this.reader.index;this.reader.setIndex(g);var C=this.reader.readString(4)===v;return this.reader.setIndex(b),C},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var g=this.reader.readData(this.zipCommentLength),v=m.uint8array?"uint8array":"array",b=l.transformTo(v,g);this.zipComment=this.loadOptions.decodeFileName(b)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var g,v,b,C=this.zip64EndOfCentralSize-44;0<C;)g=this.reader.readInt(2),v=this.reader.readInt(4),b=this.reader.readData(v),this.zip64ExtensibleData[g]={id:g,length:v,value:b}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var g,v;for(g=0;g<this.files.length;g++)v=this.files[g],this.reader.setIndex(v.localHeaderOffset),this.checkSignature(d.LOCAL_FILE_HEADER),v.readLocalPart(this.reader),v.handleUTF8(),v.processAttributes()},readCentralDir:function(){var g;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(d.CENTRAL_FILE_HEADER);)(g=new h({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(g);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var g=this.reader.lastIndexOfSignature(d.CENTRAL_DIRECTORY_END);if(g<0)throw this.isSignature(0,d.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(g);var v=g;if(this.checkSignature(d.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===l.MAX_VALUE_16BITS||this.diskWithCentralDirStart===l.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===l.MAX_VALUE_16BITS||this.centralDirRecords===l.MAX_VALUE_16BITS||this.centralDirSize===l.MAX_VALUE_32BITS||this.centralDirOffset===l.MAX_VALUE_32BITS){if(this.zip64=!0,(g=this.reader.lastIndexOfSignature(d.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(g),this.checkSignature(d.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,d.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(d.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(d.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var b=this.centralDirOffset+this.centralDirSize;this.zip64&&(b+=20,b+=12+this.zip64EndOfCentralSize);var C=v-b;if(0<C)this.isSignature(v,d.CENTRAL_FILE_HEADER)||(this.reader.zero=C);else if(C<0)throw new Error("Corrupted zip: missing "+Math.abs(C)+" bytes.")},prepareReader:function(g){this.reader=o(g)},load:function(g){this.prepareReader(g),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},r.exports=p},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(n,r,i){var o=n("./reader/readerFor"),l=n("./utils"),d=n("./compressedObject"),h=n("./crc32"),m=n("./utf8"),p=n("./compressions"),g=n("./support");function v(b,C){this.options=b,this.loadOptions=C}v.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(b){var C,x;if(b.skip(22),this.fileNameLength=b.readInt(2),x=b.readInt(2),this.fileName=b.readData(this.fileNameLength),b.skip(x),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((C=(function(S){for(var E in p)if(Object.prototype.hasOwnProperty.call(p,E)&&p[E].magic===S)return p[E];return null})(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+l.pretty(this.compressionMethod)+" unknown (inner file : "+l.transformTo("string",this.fileName)+")");this.decompressed=new d(this.compressedSize,this.uncompressedSize,this.crc32,C,b.readData(this.compressedSize))},readCentralPart:function(b){this.versionMadeBy=b.readInt(2),b.skip(2),this.bitFlag=b.readInt(2),this.compressionMethod=b.readString(2),this.date=b.readDate(),this.crc32=b.readInt(4),this.compressedSize=b.readInt(4),this.uncompressedSize=b.readInt(4);var C=b.readInt(2);if(this.extraFieldsLength=b.readInt(2),this.fileCommentLength=b.readInt(2),this.diskNumberStart=b.readInt(2),this.internalFileAttributes=b.readInt(2),this.externalFileAttributes=b.readInt(4),this.localHeaderOffset=b.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");b.skip(C),this.readExtraFields(b),this.parseZIP64ExtraField(b),this.fileComment=b.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var b=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),b==0&&(this.dosPermissions=63&this.externalFileAttributes),b==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var b=o(this.extraFields[1].value);this.uncompressedSize===l.MAX_VALUE_32BITS&&(this.uncompressedSize=b.readInt(8)),this.compressedSize===l.MAX_VALUE_32BITS&&(this.compressedSize=b.readInt(8)),this.localHeaderOffset===l.MAX_VALUE_32BITS&&(this.localHeaderOffset=b.readInt(8)),this.diskNumberStart===l.MAX_VALUE_32BITS&&(this.diskNumberStart=b.readInt(4))}},readExtraFields:function(b){var C,x,S,E=b.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});b.index+4<E;)C=b.readInt(2),x=b.readInt(2),S=b.readData(x),this.extraFields[C]={id:C,length:x,value:S};b.setIndex(E)},handleUTF8:function(){var b=g.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=m.utf8decode(this.fileName),this.fileCommentStr=m.utf8decode(this.fileComment);else{var C=this.findExtraFieldUnicodePath();if(C!==null)this.fileNameStr=C;else{var x=l.transformTo(b,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(x)}var S=this.findExtraFieldUnicodeComment();if(S!==null)this.fileCommentStr=S;else{var E=l.transformTo(b,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(E)}}},findExtraFieldUnicodePath:function(){var b=this.extraFields[28789];if(b){var C=o(b.value);return C.readInt(1)!==1||h(this.fileName)!==C.readInt(4)?null:m.utf8decode(C.readData(b.length-5))}return null},findExtraFieldUnicodeComment:function(){var b=this.extraFields[25461];if(b){var C=o(b.value);return C.readInt(1)!==1||h(this.fileComment)!==C.readInt(4)?null:m.utf8decode(C.readData(b.length-5))}return null}},r.exports=v},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(n,r,i){function o(C,x,S){this.name=C,this.dir=S.dir,this.date=S.date,this.comment=S.comment,this.unixPermissions=S.unixPermissions,this.dosPermissions=S.dosPermissions,this._data=x,this._dataBinary=S.binary,this.options={compression:S.compression,compressionOptions:S.compressionOptions}}var l=n("./stream/StreamHelper"),d=n("./stream/DataWorker"),h=n("./utf8"),m=n("./compressedObject"),p=n("./stream/GenericWorker");o.prototype={internalStream:function(C){var x=null,S="string";try{if(!C)throw new Error("No output type specified.");var E=(S=C.toLowerCase())==="string"||S==="text";S!=="binarystring"&&S!=="text"||(S="string"),x=this._decompressWorker();var T=!this._dataBinary;T&&!E&&(x=x.pipe(new h.Utf8EncodeWorker)),!T&&E&&(x=x.pipe(new h.Utf8DecodeWorker))}catch(I){(x=new p("error")).error(I)}return new l(x,S,"")},async:function(C,x){return this.internalStream(C).accumulate(x)},nodeStream:function(C,x){return this.internalStream(C||"nodebuffer").toNodejsStream(x)},_compressWorker:function(C,x){if(this._data instanceof m&&this._data.compression.magic===C.magic)return this._data.getCompressedWorker();var S=this._decompressWorker();return this._dataBinary||(S=S.pipe(new h.Utf8EncodeWorker)),m.createWorkerFrom(S,C,x)},_decompressWorker:function(){return this._data instanceof m?this._data.getContentWorker():this._data instanceof p?this._data:new d(this._data)}};for(var g=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],v=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},b=0;b<g.length;b++)o.prototype[g[b]]=v;r.exports=o},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(n,r,i){(function(o){var l,d,h=o.MutationObserver||o.WebKitMutationObserver;if(h){var m=0,p=new h(C),g=o.document.createTextNode("");p.observe(g,{characterData:!0}),l=function(){g.data=m=++m%2}}else if(o.setImmediate||o.MessageChannel===void 0)l="document"in o&&"onreadystatechange"in o.document.createElement("script")?function(){var x=o.document.createElement("script");x.onreadystatechange=function(){C(),x.onreadystatechange=null,x.parentNode.removeChild(x),x=null},o.document.documentElement.appendChild(x)}:function(){setTimeout(C,0)};else{var v=new o.MessageChannel;v.port1.onmessage=C,l=function(){v.port2.postMessage(0)}}var b=[];function C(){var x,S;d=!0;for(var E=b.length;E;){for(S=b,b=[],x=-1;++x<E;)S[x]();E=b.length}d=!1}r.exports=function(x){b.push(x)!==1||d||l()}}).call(this,typeof Oh<"u"?Oh:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(n,r,i){var o=n("immediate");function l(){}var d={},h=["REJECTED"],m=["FULFILLED"],p=["PENDING"];function g(E){if(typeof E!="function")throw new TypeError("resolver must be a function");this.state=p,this.queue=[],this.outcome=void 0,E!==l&&x(this,E)}function v(E,T,I){this.promise=E,typeof T=="function"&&(this.onFulfilled=T,this.callFulfilled=this.otherCallFulfilled),typeof I=="function"&&(this.onRejected=I,this.callRejected=this.otherCallRejected)}function b(E,T,I){o(function(){var D;try{D=T(I)}catch(B){return d.reject(E,B)}D===E?d.reject(E,new TypeError("Cannot resolve promise with itself")):d.resolve(E,D)})}function C(E){var T=E&&E.then;if(E&&(typeof E=="object"||typeof E=="function")&&typeof T=="function")return function(){T.apply(E,arguments)}}function x(E,T){var I=!1;function D(k){I||(I=!0,d.reject(E,k))}function B(k){I||(I=!0,d.resolve(E,k))}var $=S(function(){T(B,D)});$.status==="error"&&D($.value)}function S(E,T){var I={};try{I.value=E(T),I.status="success"}catch(D){I.status="error",I.value=D}return I}(r.exports=g).prototype.finally=function(E){if(typeof E!="function")return this;var T=this.constructor;return this.then(function(I){return T.resolve(E()).then(function(){return I})},function(I){return T.resolve(E()).then(function(){throw I})})},g.prototype.catch=function(E){return this.then(null,E)},g.prototype.then=function(E,T){if(typeof E!="function"&&this.state===m||typeof T!="function"&&this.state===h)return this;var I=new this.constructor(l);return this.state!==p?b(I,this.state===m?E:T,this.outcome):this.queue.push(new v(I,E,T)),I},v.prototype.callFulfilled=function(E){d.resolve(this.promise,E)},v.prototype.otherCallFulfilled=function(E){b(this.promise,this.onFulfilled,E)},v.prototype.callRejected=function(E){d.reject(this.promise,E)},v.prototype.otherCallRejected=function(E){b(this.promise,this.onRejected,E)},d.resolve=function(E,T){var I=S(C,T);if(I.status==="error")return d.reject(E,I.value);var D=I.value;if(D)x(E,D);else{E.state=m,E.outcome=T;for(var B=-1,$=E.queue.length;++B<$;)E.queue[B].callFulfilled(T)}return E},d.reject=function(E,T){E.state=h,E.outcome=T;for(var I=-1,D=E.queue.length;++I<D;)E.queue[I].callRejected(T);return E},g.resolve=function(E){return E instanceof this?E:d.resolve(new this(l),E)},g.reject=function(E){var T=new this(l);return d.reject(T,E)},g.all=function(E){var T=this;if(Object.prototype.toString.call(E)!=="[object Array]")return this.reject(new TypeError("must be an array"));var I=E.length,D=!1;if(!I)return this.resolve([]);for(var B=new Array(I),$=0,k=-1,j=new this(l);++k<I;)N(E[k],k);return j;function N(F,q){T.resolve(F).then(function(A){B[q]=A,++$!==I||D||(D=!0,d.resolve(j,B))},function(A){D||(D=!0,d.reject(j,A))})}},g.race=function(E){var T=this;if(Object.prototype.toString.call(E)!=="[object Array]")return this.reject(new TypeError("must be an array"));var I=E.length,D=!1;if(!I)return this.resolve([]);for(var B=-1,$=new this(l);++B<I;)k=E[B],T.resolve(k).then(function(j){D||(D=!0,d.resolve($,j))},function(j){D||(D=!0,d.reject($,j))});var k;return $}},{immediate:36}],38:[function(n,r,i){var o={};(0,n("./lib/utils/common").assign)(o,n("./lib/deflate"),n("./lib/inflate"),n("./lib/zlib/constants")),r.exports=o},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(n,r,i){var o=n("./zlib/deflate"),l=n("./utils/common"),d=n("./utils/strings"),h=n("./zlib/messages"),m=n("./zlib/zstream"),p=Object.prototype.toString,g=0,v=-1,b=0,C=8;function x(E){if(!(this instanceof x))return new x(E);this.options=l.assign({level:v,method:C,chunkSize:16384,windowBits:15,memLevel:8,strategy:b,to:""},E||{});var T=this.options;T.raw&&0<T.windowBits?T.windowBits=-T.windowBits:T.gzip&&0<T.windowBits&&T.windowBits<16&&(T.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new m,this.strm.avail_out=0;var I=o.deflateInit2(this.strm,T.level,T.method,T.windowBits,T.memLevel,T.strategy);if(I!==g)throw new Error(h[I]);if(T.header&&o.deflateSetHeader(this.strm,T.header),T.dictionary){var D;if(D=typeof T.dictionary=="string"?d.string2buf(T.dictionary):p.call(T.dictionary)==="[object ArrayBuffer]"?new Uint8Array(T.dictionary):T.dictionary,(I=o.deflateSetDictionary(this.strm,D))!==g)throw new Error(h[I]);this._dict_set=!0}}function S(E,T){var I=new x(T);if(I.push(E,!0),I.err)throw I.msg||h[I.err];return I.result}x.prototype.push=function(E,T){var I,D,B=this.strm,$=this.options.chunkSize;if(this.ended)return!1;D=T===~~T?T:T===!0?4:0,typeof E=="string"?B.input=d.string2buf(E):p.call(E)==="[object ArrayBuffer]"?B.input=new Uint8Array(E):B.input=E,B.next_in=0,B.avail_in=B.input.length;do{if(B.avail_out===0&&(B.output=new l.Buf8($),B.next_out=0,B.avail_out=$),(I=o.deflate(B,D))!==1&&I!==g)return this.onEnd(I),!(this.ended=!0);B.avail_out!==0&&(B.avail_in!==0||D!==4&&D!==2)||(this.options.to==="string"?this.onData(d.buf2binstring(l.shrinkBuf(B.output,B.next_out))):this.onData(l.shrinkBuf(B.output,B.next_out)))}while((0<B.avail_in||B.avail_out===0)&&I!==1);return D===4?(I=o.deflateEnd(this.strm),this.onEnd(I),this.ended=!0,I===g):D!==2||(this.onEnd(g),!(B.avail_out=0))},x.prototype.onData=function(E){this.chunks.push(E)},x.prototype.onEnd=function(E){E===g&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=l.flattenChunks(this.chunks)),this.chunks=[],this.err=E,this.msg=this.strm.msg},i.Deflate=x,i.deflate=S,i.deflateRaw=function(E,T){return(T=T||{}).raw=!0,S(E,T)},i.gzip=function(E,T){return(T=T||{}).gzip=!0,S(E,T)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(n,r,i){var o=n("./zlib/inflate"),l=n("./utils/common"),d=n("./utils/strings"),h=n("./zlib/constants"),m=n("./zlib/messages"),p=n("./zlib/zstream"),g=n("./zlib/gzheader"),v=Object.prototype.toString;function b(x){if(!(this instanceof b))return new b(x);this.options=l.assign({chunkSize:16384,windowBits:0,to:""},x||{});var S=this.options;S.raw&&0<=S.windowBits&&S.windowBits<16&&(S.windowBits=-S.windowBits,S.windowBits===0&&(S.windowBits=-15)),!(0<=S.windowBits&&S.windowBits<16)||x&&x.windowBits||(S.windowBits+=32),15<S.windowBits&&S.windowBits<48&&(15&S.windowBits)==0&&(S.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new p,this.strm.avail_out=0;var E=o.inflateInit2(this.strm,S.windowBits);if(E!==h.Z_OK)throw new Error(m[E]);this.header=new g,o.inflateGetHeader(this.strm,this.header)}function C(x,S){var E=new b(S);if(E.push(x,!0),E.err)throw E.msg||m[E.err];return E.result}b.prototype.push=function(x,S){var E,T,I,D,B,$,k=this.strm,j=this.options.chunkSize,N=this.options.dictionary,F=!1;if(this.ended)return!1;T=S===~~S?S:S===!0?h.Z_FINISH:h.Z_NO_FLUSH,typeof x=="string"?k.input=d.binstring2buf(x):v.call(x)==="[object ArrayBuffer]"?k.input=new Uint8Array(x):k.input=x,k.next_in=0,k.avail_in=k.input.length;do{if(k.avail_out===0&&(k.output=new l.Buf8(j),k.next_out=0,k.avail_out=j),(E=o.inflate(k,h.Z_NO_FLUSH))===h.Z_NEED_DICT&&N&&($=typeof N=="string"?d.string2buf(N):v.call(N)==="[object ArrayBuffer]"?new Uint8Array(N):N,E=o.inflateSetDictionary(this.strm,$)),E===h.Z_BUF_ERROR&&F===!0&&(E=h.Z_OK,F=!1),E!==h.Z_STREAM_END&&E!==h.Z_OK)return this.onEnd(E),!(this.ended=!0);k.next_out&&(k.avail_out!==0&&E!==h.Z_STREAM_END&&(k.avail_in!==0||T!==h.Z_FINISH&&T!==h.Z_SYNC_FLUSH)||(this.options.to==="string"?(I=d.utf8border(k.output,k.next_out),D=k.next_out-I,B=d.buf2string(k.output,I),k.next_out=D,k.avail_out=j-D,D&&l.arraySet(k.output,k.output,I,D,0),this.onData(B)):this.onData(l.shrinkBuf(k.output,k.next_out)))),k.avail_in===0&&k.avail_out===0&&(F=!0)}while((0<k.avail_in||k.avail_out===0)&&E!==h.Z_STREAM_END);return E===h.Z_STREAM_END&&(T=h.Z_FINISH),T===h.Z_FINISH?(E=o.inflateEnd(this.strm),this.onEnd(E),this.ended=!0,E===h.Z_OK):T!==h.Z_SYNC_FLUSH||(this.onEnd(h.Z_OK),!(k.avail_out=0))},b.prototype.onData=function(x){this.chunks.push(x)},b.prototype.onEnd=function(x){x===h.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=l.flattenChunks(this.chunks)),this.chunks=[],this.err=x,this.msg=this.strm.msg},i.Inflate=b,i.inflate=C,i.inflateRaw=function(x,S){return(S=S||{}).raw=!0,C(x,S)},i.ungzip=C},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(n,r,i){var o=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";i.assign=function(h){for(var m=Array.prototype.slice.call(arguments,1);m.length;){var p=m.shift();if(p){if(typeof p!="object")throw new TypeError(p+"must be non-object");for(var g in p)p.hasOwnProperty(g)&&(h[g]=p[g])}}return h},i.shrinkBuf=function(h,m){return h.length===m?h:h.subarray?h.subarray(0,m):(h.length=m,h)};var l={arraySet:function(h,m,p,g,v){if(m.subarray&&h.subarray)h.set(m.subarray(p,p+g),v);else for(var b=0;b<g;b++)h[v+b]=m[p+b]},flattenChunks:function(h){var m,p,g,v,b,C;for(m=g=0,p=h.length;m<p;m++)g+=h[m].length;for(C=new Uint8Array(g),m=v=0,p=h.length;m<p;m++)b=h[m],C.set(b,v),v+=b.length;return C}},d={arraySet:function(h,m,p,g,v){for(var b=0;b<g;b++)h[v+b]=m[p+b]},flattenChunks:function(h){return[].concat.apply([],h)}};i.setTyped=function(h){h?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,l)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,d))},i.setTyped(o)},{}],42:[function(n,r,i){var o=n("./common"),l=!0,d=!0;try{String.fromCharCode.apply(null,[0])}catch{l=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{d=!1}for(var h=new o.Buf8(256),m=0;m<256;m++)h[m]=252<=m?6:248<=m?5:240<=m?4:224<=m?3:192<=m?2:1;function p(g,v){if(v<65537&&(g.subarray&&d||!g.subarray&&l))return String.fromCharCode.apply(null,o.shrinkBuf(g,v));for(var b="",C=0;C<v;C++)b+=String.fromCharCode(g[C]);return b}h[254]=h[254]=1,i.string2buf=function(g){var v,b,C,x,S,E=g.length,T=0;for(x=0;x<E;x++)(64512&(b=g.charCodeAt(x)))==55296&&x+1<E&&(64512&(C=g.charCodeAt(x+1)))==56320&&(b=65536+(b-55296<<10)+(C-56320),x++),T+=b<128?1:b<2048?2:b<65536?3:4;for(v=new o.Buf8(T),x=S=0;S<T;x++)(64512&(b=g.charCodeAt(x)))==55296&&x+1<E&&(64512&(C=g.charCodeAt(x+1)))==56320&&(b=65536+(b-55296<<10)+(C-56320),x++),b<128?v[S++]=b:(b<2048?v[S++]=192|b>>>6:(b<65536?v[S++]=224|b>>>12:(v[S++]=240|b>>>18,v[S++]=128|b>>>12&63),v[S++]=128|b>>>6&63),v[S++]=128|63&b);return v},i.buf2binstring=function(g){return p(g,g.length)},i.binstring2buf=function(g){for(var v=new o.Buf8(g.length),b=0,C=v.length;b<C;b++)v[b]=g.charCodeAt(b);return v},i.buf2string=function(g,v){var b,C,x,S,E=v||g.length,T=new Array(2*E);for(b=C=0;b<E;)if((x=g[b++])<128)T[C++]=x;else if(4<(S=h[x]))T[C++]=65533,b+=S-1;else{for(x&=S===2?31:S===3?15:7;1<S&&b<E;)x=x<<6|63&g[b++],S--;1<S?T[C++]=65533:x<65536?T[C++]=x:(x-=65536,T[C++]=55296|x>>10&1023,T[C++]=56320|1023&x)}return p(T,C)},i.utf8border=function(g,v){var b;for((v=v||g.length)>g.length&&(v=g.length),b=v-1;0<=b&&(192&g[b])==128;)b--;return b<0||b===0?v:b+h[g[b]]>v?b:v}},{"./common":41}],43:[function(n,r,i){r.exports=function(o,l,d,h){for(var m=65535&o|0,p=o>>>16&65535|0,g=0;d!==0;){for(d-=g=2e3<d?2e3:d;p=p+(m=m+l[h++]|0)|0,--g;);m%=65521,p%=65521}return m|p<<16|0}},{}],44:[function(n,r,i){r.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(n,r,i){var o=(function(){for(var l,d=[],h=0;h<256;h++){l=h;for(var m=0;m<8;m++)l=1&l?3988292384^l>>>1:l>>>1;d[h]=l}return d})();r.exports=function(l,d,h,m){var p=o,g=m+h;l^=-1;for(var v=m;v<g;v++)l=l>>>8^p[255&(l^d[v])];return-1^l}},{}],46:[function(n,r,i){var o,l=n("../utils/common"),d=n("./trees"),h=n("./adler32"),m=n("./crc32"),p=n("./messages"),g=0,v=4,b=0,C=-2,x=-1,S=4,E=2,T=8,I=9,D=286,B=30,$=19,k=2*D+1,j=15,N=3,F=258,q=F+N+1,A=42,P=113,O=1,X=2,W=3,H=4;function Z(U,he){return U.msg=p[he],he}function Y(U){return(U<<1)-(4<U?9:0)}function se(U){for(var he=U.length;0<=--he;)U[he]=0}function L(U){var he=U.state,ye=he.pending;ye>U.avail_out&&(ye=U.avail_out),ye!==0&&(l.arraySet(U.output,he.pending_buf,he.pending_out,ye,U.next_out),U.next_out+=ye,he.pending_out+=ye,U.total_out+=ye,U.avail_out-=ye,he.pending-=ye,he.pending===0&&(he.pending_out=0))}function G(U,he){d._tr_flush_block(U,0<=U.block_start?U.block_start:-1,U.strstart-U.block_start,he),U.block_start=U.strstart,L(U.strm)}function ne(U,he){U.pending_buf[U.pending++]=he}function ie(U,he){U.pending_buf[U.pending++]=he>>>8&255,U.pending_buf[U.pending++]=255&he}function te(U,he){var ye,ee,J=U.max_chain_length,oe=U.strstart,Ce=U.prev_length,Se=U.nice_match,ae=U.strstart>U.w_size-q?U.strstart-(U.w_size-q):0,Ae=U.window,Oe=U.w_mask,De=U.prev,qe=U.strstart+F,St=Ae[oe+Ce-1],tt=Ae[oe+Ce];U.prev_length>=U.good_match&&(J>>=2),Se>U.lookahead&&(Se=U.lookahead);do if(Ae[(ye=he)+Ce]===tt&&Ae[ye+Ce-1]===St&&Ae[ye]===Ae[oe]&&Ae[++ye]===Ae[oe+1]){oe+=2,ye++;do;while(Ae[++oe]===Ae[++ye]&&Ae[++oe]===Ae[++ye]&&Ae[++oe]===Ae[++ye]&&Ae[++oe]===Ae[++ye]&&Ae[++oe]===Ae[++ye]&&Ae[++oe]===Ae[++ye]&&Ae[++oe]===Ae[++ye]&&Ae[++oe]===Ae[++ye]&&oe<qe);if(ee=F-(qe-oe),oe=qe-F,Ce<ee){if(U.match_start=he,Se<=(Ce=ee))break;St=Ae[oe+Ce-1],tt=Ae[oe+Ce]}}while((he=De[he&Oe])>ae&&--J!=0);return Ce<=U.lookahead?Ce:U.lookahead}function ue(U){var he,ye,ee,J,oe,Ce,Se,ae,Ae,Oe,De=U.w_size;do{if(J=U.window_size-U.lookahead-U.strstart,U.strstart>=De+(De-q)){for(l.arraySet(U.window,U.window,De,De,0),U.match_start-=De,U.strstart-=De,U.block_start-=De,he=ye=U.hash_size;ee=U.head[--he],U.head[he]=De<=ee?ee-De:0,--ye;);for(he=ye=De;ee=U.prev[--he],U.prev[he]=De<=ee?ee-De:0,--ye;);J+=De}if(U.strm.avail_in===0)break;if(Ce=U.strm,Se=U.window,ae=U.strstart+U.lookahead,Ae=J,Oe=void 0,Oe=Ce.avail_in,Ae<Oe&&(Oe=Ae),ye=Oe===0?0:(Ce.avail_in-=Oe,l.arraySet(Se,Ce.input,Ce.next_in,Oe,ae),Ce.state.wrap===1?Ce.adler=h(Ce.adler,Se,Oe,ae):Ce.state.wrap===2&&(Ce.adler=m(Ce.adler,Se,Oe,ae)),Ce.next_in+=Oe,Ce.total_in+=Oe,Oe),U.lookahead+=ye,U.lookahead+U.insert>=N)for(oe=U.strstart-U.insert,U.ins_h=U.window[oe],U.ins_h=(U.ins_h<<U.hash_shift^U.window[oe+1])&U.hash_mask;U.insert&&(U.ins_h=(U.ins_h<<U.hash_shift^U.window[oe+N-1])&U.hash_mask,U.prev[oe&U.w_mask]=U.head[U.ins_h],U.head[U.ins_h]=oe,oe++,U.insert--,!(U.lookahead+U.insert<N)););}while(U.lookahead<q&&U.strm.avail_in!==0)}function ve(U,he){for(var ye,ee;;){if(U.lookahead<q){if(ue(U),U.lookahead<q&&he===g)return O;if(U.lookahead===0)break}if(ye=0,U.lookahead>=N&&(U.ins_h=(U.ins_h<<U.hash_shift^U.window[U.strstart+N-1])&U.hash_mask,ye=U.prev[U.strstart&U.w_mask]=U.head[U.ins_h],U.head[U.ins_h]=U.strstart),ye!==0&&U.strstart-ye<=U.w_size-q&&(U.match_length=te(U,ye)),U.match_length>=N)if(ee=d._tr_tally(U,U.strstart-U.match_start,U.match_length-N),U.lookahead-=U.match_length,U.match_length<=U.max_lazy_match&&U.lookahead>=N){for(U.match_length--;U.strstart++,U.ins_h=(U.ins_h<<U.hash_shift^U.window[U.strstart+N-1])&U.hash_mask,ye=U.prev[U.strstart&U.w_mask]=U.head[U.ins_h],U.head[U.ins_h]=U.strstart,--U.match_length!=0;);U.strstart++}else U.strstart+=U.match_length,U.match_length=0,U.ins_h=U.window[U.strstart],U.ins_h=(U.ins_h<<U.hash_shift^U.window[U.strstart+1])&U.hash_mask;else ee=d._tr_tally(U,0,U.window[U.strstart]),U.lookahead--,U.strstart++;if(ee&&(G(U,!1),U.strm.avail_out===0))return O}return U.insert=U.strstart<N-1?U.strstart:N-1,he===v?(G(U,!0),U.strm.avail_out===0?W:H):U.last_lit&&(G(U,!1),U.strm.avail_out===0)?O:X}function ce(U,he){for(var ye,ee,J;;){if(U.lookahead<q){if(ue(U),U.lookahead<q&&he===g)return O;if(U.lookahead===0)break}if(ye=0,U.lookahead>=N&&(U.ins_h=(U.ins_h<<U.hash_shift^U.window[U.strstart+N-1])&U.hash_mask,ye=U.prev[U.strstart&U.w_mask]=U.head[U.ins_h],U.head[U.ins_h]=U.strstart),U.prev_length=U.match_length,U.prev_match=U.match_start,U.match_length=N-1,ye!==0&&U.prev_length<U.max_lazy_match&&U.strstart-ye<=U.w_size-q&&(U.match_length=te(U,ye),U.match_length<=5&&(U.strategy===1||U.match_length===N&&4096<U.strstart-U.match_start)&&(U.match_length=N-1)),U.prev_length>=N&&U.match_length<=U.prev_length){for(J=U.strstart+U.lookahead-N,ee=d._tr_tally(U,U.strstart-1-U.prev_match,U.prev_length-N),U.lookahead-=U.prev_length-1,U.prev_length-=2;++U.strstart<=J&&(U.ins_h=(U.ins_h<<U.hash_shift^U.window[U.strstart+N-1])&U.hash_mask,ye=U.prev[U.strstart&U.w_mask]=U.head[U.ins_h],U.head[U.ins_h]=U.strstart),--U.prev_length!=0;);if(U.match_available=0,U.match_length=N-1,U.strstart++,ee&&(G(U,!1),U.strm.avail_out===0))return O}else if(U.match_available){if((ee=d._tr_tally(U,0,U.window[U.strstart-1]))&&G(U,!1),U.strstart++,U.lookahead--,U.strm.avail_out===0)return O}else U.match_available=1,U.strstart++,U.lookahead--}return U.match_available&&(ee=d._tr_tally(U,0,U.window[U.strstart-1]),U.match_available=0),U.insert=U.strstart<N-1?U.strstart:N-1,he===v?(G(U,!0),U.strm.avail_out===0?W:H):U.last_lit&&(G(U,!1),U.strm.avail_out===0)?O:X}function be(U,he,ye,ee,J){this.good_length=U,this.max_lazy=he,this.nice_length=ye,this.max_chain=ee,this.func=J}function ze(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=T,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new l.Buf16(2*k),this.dyn_dtree=new l.Buf16(2*(2*B+1)),this.bl_tree=new l.Buf16(2*(2*$+1)),se(this.dyn_ltree),se(this.dyn_dtree),se(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new l.Buf16(j+1),this.heap=new l.Buf16(2*D+1),se(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new l.Buf16(2*D+1),se(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Pe(U){var he;return U&&U.state?(U.total_in=U.total_out=0,U.data_type=E,(he=U.state).pending=0,he.pending_out=0,he.wrap<0&&(he.wrap=-he.wrap),he.status=he.wrap?A:P,U.adler=he.wrap===2?0:1,he.last_flush=g,d._tr_init(he),b):Z(U,C)}function at(U){var he=Pe(U);return he===b&&(function(ye){ye.window_size=2*ye.w_size,se(ye.head),ye.max_lazy_match=o[ye.level].max_lazy,ye.good_match=o[ye.level].good_length,ye.nice_match=o[ye.level].nice_length,ye.max_chain_length=o[ye.level].max_chain,ye.strstart=0,ye.block_start=0,ye.lookahead=0,ye.insert=0,ye.match_length=ye.prev_length=N-1,ye.match_available=0,ye.ins_h=0})(U.state),he}function bt(U,he,ye,ee,J,oe){if(!U)return C;var Ce=1;if(he===x&&(he=6),ee<0?(Ce=0,ee=-ee):15<ee&&(Ce=2,ee-=16),J<1||I<J||ye!==T||ee<8||15<ee||he<0||9<he||oe<0||S<oe)return Z(U,C);ee===8&&(ee=9);var Se=new ze;return(U.state=Se).strm=U,Se.wrap=Ce,Se.gzhead=null,Se.w_bits=ee,Se.w_size=1<<Se.w_bits,Se.w_mask=Se.w_size-1,Se.hash_bits=J+7,Se.hash_size=1<<Se.hash_bits,Se.hash_mask=Se.hash_size-1,Se.hash_shift=~~((Se.hash_bits+N-1)/N),Se.window=new l.Buf8(2*Se.w_size),Se.head=new l.Buf16(Se.hash_size),Se.prev=new l.Buf16(Se.w_size),Se.lit_bufsize=1<<J+6,Se.pending_buf_size=4*Se.lit_bufsize,Se.pending_buf=new l.Buf8(Se.pending_buf_size),Se.d_buf=1*Se.lit_bufsize,Se.l_buf=3*Se.lit_bufsize,Se.level=he,Se.strategy=oe,Se.method=ye,at(U)}o=[new be(0,0,0,0,function(U,he){var ye=65535;for(ye>U.pending_buf_size-5&&(ye=U.pending_buf_size-5);;){if(U.lookahead<=1){if(ue(U),U.lookahead===0&&he===g)return O;if(U.lookahead===0)break}U.strstart+=U.lookahead,U.lookahead=0;var ee=U.block_start+ye;if((U.strstart===0||U.strstart>=ee)&&(U.lookahead=U.strstart-ee,U.strstart=ee,G(U,!1),U.strm.avail_out===0)||U.strstart-U.block_start>=U.w_size-q&&(G(U,!1),U.strm.avail_out===0))return O}return U.insert=0,he===v?(G(U,!0),U.strm.avail_out===0?W:H):(U.strstart>U.block_start&&(G(U,!1),U.strm.avail_out),O)}),new be(4,4,8,4,ve),new be(4,5,16,8,ve),new be(4,6,32,32,ve),new be(4,4,16,16,ce),new be(8,16,32,32,ce),new be(8,16,128,128,ce),new be(8,32,128,256,ce),new be(32,128,258,1024,ce),new be(32,258,258,4096,ce)],i.deflateInit=function(U,he){return bt(U,he,T,15,8,0)},i.deflateInit2=bt,i.deflateReset=at,i.deflateResetKeep=Pe,i.deflateSetHeader=function(U,he){return U&&U.state?U.state.wrap!==2?C:(U.state.gzhead=he,b):C},i.deflate=function(U,he){var ye,ee,J,oe;if(!U||!U.state||5<he||he<0)return U?Z(U,C):C;if(ee=U.state,!U.output||!U.input&&U.avail_in!==0||ee.status===666&&he!==v)return Z(U,U.avail_out===0?-5:C);if(ee.strm=U,ye=ee.last_flush,ee.last_flush=he,ee.status===A)if(ee.wrap===2)U.adler=0,ne(ee,31),ne(ee,139),ne(ee,8),ee.gzhead?(ne(ee,(ee.gzhead.text?1:0)+(ee.gzhead.hcrc?2:0)+(ee.gzhead.extra?4:0)+(ee.gzhead.name?8:0)+(ee.gzhead.comment?16:0)),ne(ee,255&ee.gzhead.time),ne(ee,ee.gzhead.time>>8&255),ne(ee,ee.gzhead.time>>16&255),ne(ee,ee.gzhead.time>>24&255),ne(ee,ee.level===9?2:2<=ee.strategy||ee.level<2?4:0),ne(ee,255&ee.gzhead.os),ee.gzhead.extra&&ee.gzhead.extra.length&&(ne(ee,255&ee.gzhead.extra.length),ne(ee,ee.gzhead.extra.length>>8&255)),ee.gzhead.hcrc&&(U.adler=m(U.adler,ee.pending_buf,ee.pending,0)),ee.gzindex=0,ee.status=69):(ne(ee,0),ne(ee,0),ne(ee,0),ne(ee,0),ne(ee,0),ne(ee,ee.level===9?2:2<=ee.strategy||ee.level<2?4:0),ne(ee,3),ee.status=P);else{var Ce=T+(ee.w_bits-8<<4)<<8;Ce|=(2<=ee.strategy||ee.level<2?0:ee.level<6?1:ee.level===6?2:3)<<6,ee.strstart!==0&&(Ce|=32),Ce+=31-Ce%31,ee.status=P,ie(ee,Ce),ee.strstart!==0&&(ie(ee,U.adler>>>16),ie(ee,65535&U.adler)),U.adler=1}if(ee.status===69)if(ee.gzhead.extra){for(J=ee.pending;ee.gzindex<(65535&ee.gzhead.extra.length)&&(ee.pending!==ee.pending_buf_size||(ee.gzhead.hcrc&&ee.pending>J&&(U.adler=m(U.adler,ee.pending_buf,ee.pending-J,J)),L(U),J=ee.pending,ee.pending!==ee.pending_buf_size));)ne(ee,255&ee.gzhead.extra[ee.gzindex]),ee.gzindex++;ee.gzhead.hcrc&&ee.pending>J&&(U.adler=m(U.adler,ee.pending_buf,ee.pending-J,J)),ee.gzindex===ee.gzhead.extra.length&&(ee.gzindex=0,ee.status=73)}else ee.status=73;if(ee.status===73)if(ee.gzhead.name){J=ee.pending;do{if(ee.pending===ee.pending_buf_size&&(ee.gzhead.hcrc&&ee.pending>J&&(U.adler=m(U.adler,ee.pending_buf,ee.pending-J,J)),L(U),J=ee.pending,ee.pending===ee.pending_buf_size)){oe=1;break}oe=ee.gzindex<ee.gzhead.name.length?255&ee.gzhead.name.charCodeAt(ee.gzindex++):0,ne(ee,oe)}while(oe!==0);ee.gzhead.hcrc&&ee.pending>J&&(U.adler=m(U.adler,ee.pending_buf,ee.pending-J,J)),oe===0&&(ee.gzindex=0,ee.status=91)}else ee.status=91;if(ee.status===91)if(ee.gzhead.comment){J=ee.pending;do{if(ee.pending===ee.pending_buf_size&&(ee.gzhead.hcrc&&ee.pending>J&&(U.adler=m(U.adler,ee.pending_buf,ee.pending-J,J)),L(U),J=ee.pending,ee.pending===ee.pending_buf_size)){oe=1;break}oe=ee.gzindex<ee.gzhead.comment.length?255&ee.gzhead.comment.charCodeAt(ee.gzindex++):0,ne(ee,oe)}while(oe!==0);ee.gzhead.hcrc&&ee.pending>J&&(U.adler=m(U.adler,ee.pending_buf,ee.pending-J,J)),oe===0&&(ee.status=103)}else ee.status=103;if(ee.status===103&&(ee.gzhead.hcrc?(ee.pending+2>ee.pending_buf_size&&L(U),ee.pending+2<=ee.pending_buf_size&&(ne(ee,255&U.adler),ne(ee,U.adler>>8&255),U.adler=0,ee.status=P)):ee.status=P),ee.pending!==0){if(L(U),U.avail_out===0)return ee.last_flush=-1,b}else if(U.avail_in===0&&Y(he)<=Y(ye)&&he!==v)return Z(U,-5);if(ee.status===666&&U.avail_in!==0)return Z(U,-5);if(U.avail_in!==0||ee.lookahead!==0||he!==g&&ee.status!==666){var Se=ee.strategy===2?(function(ae,Ae){for(var Oe;;){if(ae.lookahead===0&&(ue(ae),ae.lookahead===0)){if(Ae===g)return O;break}if(ae.match_length=0,Oe=d._tr_tally(ae,0,ae.window[ae.strstart]),ae.lookahead--,ae.strstart++,Oe&&(G(ae,!1),ae.strm.avail_out===0))return O}return ae.insert=0,Ae===v?(G(ae,!0),ae.strm.avail_out===0?W:H):ae.last_lit&&(G(ae,!1),ae.strm.avail_out===0)?O:X})(ee,he):ee.strategy===3?(function(ae,Ae){for(var Oe,De,qe,St,tt=ae.window;;){if(ae.lookahead<=F){if(ue(ae),ae.lookahead<=F&&Ae===g)return O;if(ae.lookahead===0)break}if(ae.match_length=0,ae.lookahead>=N&&0<ae.strstart&&(De=tt[qe=ae.strstart-1])===tt[++qe]&&De===tt[++qe]&&De===tt[++qe]){St=ae.strstart+F;do;while(De===tt[++qe]&&De===tt[++qe]&&De===tt[++qe]&&De===tt[++qe]&&De===tt[++qe]&&De===tt[++qe]&&De===tt[++qe]&&De===tt[++qe]&&qe<St);ae.match_length=F-(St-qe),ae.match_length>ae.lookahead&&(ae.match_length=ae.lookahead)}if(ae.match_length>=N?(Oe=d._tr_tally(ae,1,ae.match_length-N),ae.lookahead-=ae.match_length,ae.strstart+=ae.match_length,ae.match_length=0):(Oe=d._tr_tally(ae,0,ae.window[ae.strstart]),ae.lookahead--,ae.strstart++),Oe&&(G(ae,!1),ae.strm.avail_out===0))return O}return ae.insert=0,Ae===v?(G(ae,!0),ae.strm.avail_out===0?W:H):ae.last_lit&&(G(ae,!1),ae.strm.avail_out===0)?O:X})(ee,he):o[ee.level].func(ee,he);if(Se!==W&&Se!==H||(ee.status=666),Se===O||Se===W)return U.avail_out===0&&(ee.last_flush=-1),b;if(Se===X&&(he===1?d._tr_align(ee):he!==5&&(d._tr_stored_block(ee,0,0,!1),he===3&&(se(ee.head),ee.lookahead===0&&(ee.strstart=0,ee.block_start=0,ee.insert=0))),L(U),U.avail_out===0))return ee.last_flush=-1,b}return he!==v?b:ee.wrap<=0?1:(ee.wrap===2?(ne(ee,255&U.adler),ne(ee,U.adler>>8&255),ne(ee,U.adler>>16&255),ne(ee,U.adler>>24&255),ne(ee,255&U.total_in),ne(ee,U.total_in>>8&255),ne(ee,U.total_in>>16&255),ne(ee,U.total_in>>24&255)):(ie(ee,U.adler>>>16),ie(ee,65535&U.adler)),L(U),0<ee.wrap&&(ee.wrap=-ee.wrap),ee.pending!==0?b:1)},i.deflateEnd=function(U){var he;return U&&U.state?(he=U.state.status)!==A&&he!==69&&he!==73&&he!==91&&he!==103&&he!==P&&he!==666?Z(U,C):(U.state=null,he===P?Z(U,-3):b):C},i.deflateSetDictionary=function(U,he){var ye,ee,J,oe,Ce,Se,ae,Ae,Oe=he.length;if(!U||!U.state||(oe=(ye=U.state).wrap)===2||oe===1&&ye.status!==A||ye.lookahead)return C;for(oe===1&&(U.adler=h(U.adler,he,Oe,0)),ye.wrap=0,Oe>=ye.w_size&&(oe===0&&(se(ye.head),ye.strstart=0,ye.block_start=0,ye.insert=0),Ae=new l.Buf8(ye.w_size),l.arraySet(Ae,he,Oe-ye.w_size,ye.w_size,0),he=Ae,Oe=ye.w_size),Ce=U.avail_in,Se=U.next_in,ae=U.input,U.avail_in=Oe,U.next_in=0,U.input=he,ue(ye);ye.lookahead>=N;){for(ee=ye.strstart,J=ye.lookahead-(N-1);ye.ins_h=(ye.ins_h<<ye.hash_shift^ye.window[ee+N-1])&ye.hash_mask,ye.prev[ee&ye.w_mask]=ye.head[ye.ins_h],ye.head[ye.ins_h]=ee,ee++,--J;);ye.strstart=ee,ye.lookahead=N-1,ue(ye)}return ye.strstart+=ye.lookahead,ye.block_start=ye.strstart,ye.insert=ye.lookahead,ye.lookahead=0,ye.match_length=ye.prev_length=N-1,ye.match_available=0,U.next_in=Se,U.input=ae,U.avail_in=Ce,ye.wrap=oe,b},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(n,r,i){r.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(n,r,i){r.exports=function(o,l){var d,h,m,p,g,v,b,C,x,S,E,T,I,D,B,$,k,j,N,F,q,A,P,O,X;d=o.state,h=o.next_in,O=o.input,m=h+(o.avail_in-5),p=o.next_out,X=o.output,g=p-(l-o.avail_out),v=p+(o.avail_out-257),b=d.dmax,C=d.wsize,x=d.whave,S=d.wnext,E=d.window,T=d.hold,I=d.bits,D=d.lencode,B=d.distcode,$=(1<<d.lenbits)-1,k=(1<<d.distbits)-1;e:do{I<15&&(T+=O[h++]<<I,I+=8,T+=O[h++]<<I,I+=8),j=D[T&$];t:for(;;){if(T>>>=N=j>>>24,I-=N,(N=j>>>16&255)===0)X[p++]=65535&j;else{if(!(16&N)){if((64&N)==0){j=D[(65535&j)+(T&(1<<N)-1)];continue t}if(32&N){d.mode=12;break e}o.msg="invalid literal/length code",d.mode=30;break e}F=65535&j,(N&=15)&&(I<N&&(T+=O[h++]<<I,I+=8),F+=T&(1<<N)-1,T>>>=N,I-=N),I<15&&(T+=O[h++]<<I,I+=8,T+=O[h++]<<I,I+=8),j=B[T&k];n:for(;;){if(T>>>=N=j>>>24,I-=N,!(16&(N=j>>>16&255))){if((64&N)==0){j=B[(65535&j)+(T&(1<<N)-1)];continue n}o.msg="invalid distance code",d.mode=30;break e}if(q=65535&j,I<(N&=15)&&(T+=O[h++]<<I,(I+=8)<N&&(T+=O[h++]<<I,I+=8)),b<(q+=T&(1<<N)-1)){o.msg="invalid distance too far back",d.mode=30;break e}if(T>>>=N,I-=N,(N=p-g)<q){if(x<(N=q-N)&&d.sane){o.msg="invalid distance too far back",d.mode=30;break e}if(P=E,(A=0)===S){if(A+=C-N,N<F){for(F-=N;X[p++]=E[A++],--N;);A=p-q,P=X}}else if(S<N){if(A+=C+S-N,(N-=S)<F){for(F-=N;X[p++]=E[A++],--N;);if(A=0,S<F){for(F-=N=S;X[p++]=E[A++],--N;);A=p-q,P=X}}}else if(A+=S-N,N<F){for(F-=N;X[p++]=E[A++],--N;);A=p-q,P=X}for(;2<F;)X[p++]=P[A++],X[p++]=P[A++],X[p++]=P[A++],F-=3;F&&(X[p++]=P[A++],1<F&&(X[p++]=P[A++]))}else{for(A=p-q;X[p++]=X[A++],X[p++]=X[A++],X[p++]=X[A++],2<(F-=3););F&&(X[p++]=X[A++],1<F&&(X[p++]=X[A++]))}break}}break}}while(h<m&&p<v);h-=F=I>>3,T&=(1<<(I-=F<<3))-1,o.next_in=h,o.next_out=p,o.avail_in=h<m?m-h+5:5-(h-m),o.avail_out=p<v?v-p+257:257-(p-v),d.hold=T,d.bits=I}},{}],49:[function(n,r,i){var o=n("../utils/common"),l=n("./adler32"),d=n("./crc32"),h=n("./inffast"),m=n("./inftrees"),p=1,g=2,v=0,b=-2,C=1,x=852,S=592;function E(A){return(A>>>24&255)+(A>>>8&65280)+((65280&A)<<8)+((255&A)<<24)}function T(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new o.Buf16(320),this.work=new o.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function I(A){var P;return A&&A.state?(P=A.state,A.total_in=A.total_out=P.total=0,A.msg="",P.wrap&&(A.adler=1&P.wrap),P.mode=C,P.last=0,P.havedict=0,P.dmax=32768,P.head=null,P.hold=0,P.bits=0,P.lencode=P.lendyn=new o.Buf32(x),P.distcode=P.distdyn=new o.Buf32(S),P.sane=1,P.back=-1,v):b}function D(A){var P;return A&&A.state?((P=A.state).wsize=0,P.whave=0,P.wnext=0,I(A)):b}function B(A,P){var O,X;return A&&A.state?(X=A.state,P<0?(O=0,P=-P):(O=1+(P>>4),P<48&&(P&=15)),P&&(P<8||15<P)?b:(X.window!==null&&X.wbits!==P&&(X.window=null),X.wrap=O,X.wbits=P,D(A))):b}function $(A,P){var O,X;return A?(X=new T,(A.state=X).window=null,(O=B(A,P))!==v&&(A.state=null),O):b}var k,j,N=!0;function F(A){if(N){var P;for(k=new o.Buf32(512),j=new o.Buf32(32),P=0;P<144;)A.lens[P++]=8;for(;P<256;)A.lens[P++]=9;for(;P<280;)A.lens[P++]=7;for(;P<288;)A.lens[P++]=8;for(m(p,A.lens,0,288,k,0,A.work,{bits:9}),P=0;P<32;)A.lens[P++]=5;m(g,A.lens,0,32,j,0,A.work,{bits:5}),N=!1}A.lencode=k,A.lenbits=9,A.distcode=j,A.distbits=5}function q(A,P,O,X){var W,H=A.state;return H.window===null&&(H.wsize=1<<H.wbits,H.wnext=0,H.whave=0,H.window=new o.Buf8(H.wsize)),X>=H.wsize?(o.arraySet(H.window,P,O-H.wsize,H.wsize,0),H.wnext=0,H.whave=H.wsize):(X<(W=H.wsize-H.wnext)&&(W=X),o.arraySet(H.window,P,O-X,W,H.wnext),(X-=W)?(o.arraySet(H.window,P,O-X,X,0),H.wnext=X,H.whave=H.wsize):(H.wnext+=W,H.wnext===H.wsize&&(H.wnext=0),H.whave<H.wsize&&(H.whave+=W))),0}i.inflateReset=D,i.inflateReset2=B,i.inflateResetKeep=I,i.inflateInit=function(A){return $(A,15)},i.inflateInit2=$,i.inflate=function(A,P){var O,X,W,H,Z,Y,se,L,G,ne,ie,te,ue,ve,ce,be,ze,Pe,at,bt,U,he,ye,ee,J=0,oe=new o.Buf8(4),Ce=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!A||!A.state||!A.output||!A.input&&A.avail_in!==0)return b;(O=A.state).mode===12&&(O.mode=13),Z=A.next_out,W=A.output,se=A.avail_out,H=A.next_in,X=A.input,Y=A.avail_in,L=O.hold,G=O.bits,ne=Y,ie=se,he=v;e:for(;;)switch(O.mode){case C:if(O.wrap===0){O.mode=13;break}for(;G<16;){if(Y===0)break e;Y--,L+=X[H++]<<G,G+=8}if(2&O.wrap&&L===35615){oe[O.check=0]=255&L,oe[1]=L>>>8&255,O.check=d(O.check,oe,2,0),G=L=0,O.mode=2;break}if(O.flags=0,O.head&&(O.head.done=!1),!(1&O.wrap)||(((255&L)<<8)+(L>>8))%31){A.msg="incorrect header check",O.mode=30;break}if((15&L)!=8){A.msg="unknown compression method",O.mode=30;break}if(G-=4,U=8+(15&(L>>>=4)),O.wbits===0)O.wbits=U;else if(U>O.wbits){A.msg="invalid window size",O.mode=30;break}O.dmax=1<<U,A.adler=O.check=1,O.mode=512&L?10:12,G=L=0;break;case 2:for(;G<16;){if(Y===0)break e;Y--,L+=X[H++]<<G,G+=8}if(O.flags=L,(255&O.flags)!=8){A.msg="unknown compression method",O.mode=30;break}if(57344&O.flags){A.msg="unknown header flags set",O.mode=30;break}O.head&&(O.head.text=L>>8&1),512&O.flags&&(oe[0]=255&L,oe[1]=L>>>8&255,O.check=d(O.check,oe,2,0)),G=L=0,O.mode=3;case 3:for(;G<32;){if(Y===0)break e;Y--,L+=X[H++]<<G,G+=8}O.head&&(O.head.time=L),512&O.flags&&(oe[0]=255&L,oe[1]=L>>>8&255,oe[2]=L>>>16&255,oe[3]=L>>>24&255,O.check=d(O.check,oe,4,0)),G=L=0,O.mode=4;case 4:for(;G<16;){if(Y===0)break e;Y--,L+=X[H++]<<G,G+=8}O.head&&(O.head.xflags=255&L,O.head.os=L>>8),512&O.flags&&(oe[0]=255&L,oe[1]=L>>>8&255,O.check=d(O.check,oe,2,0)),G=L=0,O.mode=5;case 5:if(1024&O.flags){for(;G<16;){if(Y===0)break e;Y--,L+=X[H++]<<G,G+=8}O.length=L,O.head&&(O.head.extra_len=L),512&O.flags&&(oe[0]=255&L,oe[1]=L>>>8&255,O.check=d(O.check,oe,2,0)),G=L=0}else O.head&&(O.head.extra=null);O.mode=6;case 6:if(1024&O.flags&&(Y<(te=O.length)&&(te=Y),te&&(O.head&&(U=O.head.extra_len-O.length,O.head.extra||(O.head.extra=new Array(O.head.extra_len)),o.arraySet(O.head.extra,X,H,te,U)),512&O.flags&&(O.check=d(O.check,X,te,H)),Y-=te,H+=te,O.length-=te),O.length))break e;O.length=0,O.mode=7;case 7:if(2048&O.flags){if(Y===0)break e;for(te=0;U=X[H+te++],O.head&&U&&O.length<65536&&(O.head.name+=String.fromCharCode(U)),U&&te<Y;);if(512&O.flags&&(O.check=d(O.check,X,te,H)),Y-=te,H+=te,U)break e}else O.head&&(O.head.name=null);O.length=0,O.mode=8;case 8:if(4096&O.flags){if(Y===0)break e;for(te=0;U=X[H+te++],O.head&&U&&O.length<65536&&(O.head.comment+=String.fromCharCode(U)),U&&te<Y;);if(512&O.flags&&(O.check=d(O.check,X,te,H)),Y-=te,H+=te,U)break e}else O.head&&(O.head.comment=null);O.mode=9;case 9:if(512&O.flags){for(;G<16;){if(Y===0)break e;Y--,L+=X[H++]<<G,G+=8}if(L!==(65535&O.check)){A.msg="header crc mismatch",O.mode=30;break}G=L=0}O.head&&(O.head.hcrc=O.flags>>9&1,O.head.done=!0),A.adler=O.check=0,O.mode=12;break;case 10:for(;G<32;){if(Y===0)break e;Y--,L+=X[H++]<<G,G+=8}A.adler=O.check=E(L),G=L=0,O.mode=11;case 11:if(O.havedict===0)return A.next_out=Z,A.avail_out=se,A.next_in=H,A.avail_in=Y,O.hold=L,O.bits=G,2;A.adler=O.check=1,O.mode=12;case 12:if(P===5||P===6)break e;case 13:if(O.last){L>>>=7&G,G-=7&G,O.mode=27;break}for(;G<3;){if(Y===0)break e;Y--,L+=X[H++]<<G,G+=8}switch(O.last=1&L,G-=1,3&(L>>>=1)){case 0:O.mode=14;break;case 1:if(F(O),O.mode=20,P!==6)break;L>>>=2,G-=2;break e;case 2:O.mode=17;break;case 3:A.msg="invalid block type",O.mode=30}L>>>=2,G-=2;break;case 14:for(L>>>=7&G,G-=7&G;G<32;){if(Y===0)break e;Y--,L+=X[H++]<<G,G+=8}if((65535&L)!=(L>>>16^65535)){A.msg="invalid stored block lengths",O.mode=30;break}if(O.length=65535&L,G=L=0,O.mode=15,P===6)break e;case 15:O.mode=16;case 16:if(te=O.length){if(Y<te&&(te=Y),se<te&&(te=se),te===0)break e;o.arraySet(W,X,H,te,Z),Y-=te,H+=te,se-=te,Z+=te,O.length-=te;break}O.mode=12;break;case 17:for(;G<14;){if(Y===0)break e;Y--,L+=X[H++]<<G,G+=8}if(O.nlen=257+(31&L),L>>>=5,G-=5,O.ndist=1+(31&L),L>>>=5,G-=5,O.ncode=4+(15&L),L>>>=4,G-=4,286<O.nlen||30<O.ndist){A.msg="too many length or distance symbols",O.mode=30;break}O.have=0,O.mode=18;case 18:for(;O.have<O.ncode;){for(;G<3;){if(Y===0)break e;Y--,L+=X[H++]<<G,G+=8}O.lens[Ce[O.have++]]=7&L,L>>>=3,G-=3}for(;O.have<19;)O.lens[Ce[O.have++]]=0;if(O.lencode=O.lendyn,O.lenbits=7,ye={bits:O.lenbits},he=m(0,O.lens,0,19,O.lencode,0,O.work,ye),O.lenbits=ye.bits,he){A.msg="invalid code lengths set",O.mode=30;break}O.have=0,O.mode=19;case 19:for(;O.have<O.nlen+O.ndist;){for(;be=(J=O.lencode[L&(1<<O.lenbits)-1])>>>16&255,ze=65535&J,!((ce=J>>>24)<=G);){if(Y===0)break e;Y--,L+=X[H++]<<G,G+=8}if(ze<16)L>>>=ce,G-=ce,O.lens[O.have++]=ze;else{if(ze===16){for(ee=ce+2;G<ee;){if(Y===0)break e;Y--,L+=X[H++]<<G,G+=8}if(L>>>=ce,G-=ce,O.have===0){A.msg="invalid bit length repeat",O.mode=30;break}U=O.lens[O.have-1],te=3+(3&L),L>>>=2,G-=2}else if(ze===17){for(ee=ce+3;G<ee;){if(Y===0)break e;Y--,L+=X[H++]<<G,G+=8}G-=ce,U=0,te=3+(7&(L>>>=ce)),L>>>=3,G-=3}else{for(ee=ce+7;G<ee;){if(Y===0)break e;Y--,L+=X[H++]<<G,G+=8}G-=ce,U=0,te=11+(127&(L>>>=ce)),L>>>=7,G-=7}if(O.have+te>O.nlen+O.ndist){A.msg="invalid bit length repeat",O.mode=30;break}for(;te--;)O.lens[O.have++]=U}}if(O.mode===30)break;if(O.lens[256]===0){A.msg="invalid code -- missing end-of-block",O.mode=30;break}if(O.lenbits=9,ye={bits:O.lenbits},he=m(p,O.lens,0,O.nlen,O.lencode,0,O.work,ye),O.lenbits=ye.bits,he){A.msg="invalid literal/lengths set",O.mode=30;break}if(O.distbits=6,O.distcode=O.distdyn,ye={bits:O.distbits},he=m(g,O.lens,O.nlen,O.ndist,O.distcode,0,O.work,ye),O.distbits=ye.bits,he){A.msg="invalid distances set",O.mode=30;break}if(O.mode=20,P===6)break e;case 20:O.mode=21;case 21:if(6<=Y&&258<=se){A.next_out=Z,A.avail_out=se,A.next_in=H,A.avail_in=Y,O.hold=L,O.bits=G,h(A,ie),Z=A.next_out,W=A.output,se=A.avail_out,H=A.next_in,X=A.input,Y=A.avail_in,L=O.hold,G=O.bits,O.mode===12&&(O.back=-1);break}for(O.back=0;be=(J=O.lencode[L&(1<<O.lenbits)-1])>>>16&255,ze=65535&J,!((ce=J>>>24)<=G);){if(Y===0)break e;Y--,L+=X[H++]<<G,G+=8}if(be&&(240&be)==0){for(Pe=ce,at=be,bt=ze;be=(J=O.lencode[bt+((L&(1<<Pe+at)-1)>>Pe)])>>>16&255,ze=65535&J,!(Pe+(ce=J>>>24)<=G);){if(Y===0)break e;Y--,L+=X[H++]<<G,G+=8}L>>>=Pe,G-=Pe,O.back+=Pe}if(L>>>=ce,G-=ce,O.back+=ce,O.length=ze,be===0){O.mode=26;break}if(32&be){O.back=-1,O.mode=12;break}if(64&be){A.msg="invalid literal/length code",O.mode=30;break}O.extra=15&be,O.mode=22;case 22:if(O.extra){for(ee=O.extra;G<ee;){if(Y===0)break e;Y--,L+=X[H++]<<G,G+=8}O.length+=L&(1<<O.extra)-1,L>>>=O.extra,G-=O.extra,O.back+=O.extra}O.was=O.length,O.mode=23;case 23:for(;be=(J=O.distcode[L&(1<<O.distbits)-1])>>>16&255,ze=65535&J,!((ce=J>>>24)<=G);){if(Y===0)break e;Y--,L+=X[H++]<<G,G+=8}if((240&be)==0){for(Pe=ce,at=be,bt=ze;be=(J=O.distcode[bt+((L&(1<<Pe+at)-1)>>Pe)])>>>16&255,ze=65535&J,!(Pe+(ce=J>>>24)<=G);){if(Y===0)break e;Y--,L+=X[H++]<<G,G+=8}L>>>=Pe,G-=Pe,O.back+=Pe}if(L>>>=ce,G-=ce,O.back+=ce,64&be){A.msg="invalid distance code",O.mode=30;break}O.offset=ze,O.extra=15&be,O.mode=24;case 24:if(O.extra){for(ee=O.extra;G<ee;){if(Y===0)break e;Y--,L+=X[H++]<<G,G+=8}O.offset+=L&(1<<O.extra)-1,L>>>=O.extra,G-=O.extra,O.back+=O.extra}if(O.offset>O.dmax){A.msg="invalid distance too far back",O.mode=30;break}O.mode=25;case 25:if(se===0)break e;if(te=ie-se,O.offset>te){if((te=O.offset-te)>O.whave&&O.sane){A.msg="invalid distance too far back",O.mode=30;break}ue=te>O.wnext?(te-=O.wnext,O.wsize-te):O.wnext-te,te>O.length&&(te=O.length),ve=O.window}else ve=W,ue=Z-O.offset,te=O.length;for(se<te&&(te=se),se-=te,O.length-=te;W[Z++]=ve[ue++],--te;);O.length===0&&(O.mode=21);break;case 26:if(se===0)break e;W[Z++]=O.length,se--,O.mode=21;break;case 27:if(O.wrap){for(;G<32;){if(Y===0)break e;Y--,L|=X[H++]<<G,G+=8}if(ie-=se,A.total_out+=ie,O.total+=ie,ie&&(A.adler=O.check=O.flags?d(O.check,W,ie,Z-ie):l(O.check,W,ie,Z-ie)),ie=se,(O.flags?L:E(L))!==O.check){A.msg="incorrect data check",O.mode=30;break}G=L=0}O.mode=28;case 28:if(O.wrap&&O.flags){for(;G<32;){if(Y===0)break e;Y--,L+=X[H++]<<G,G+=8}if(L!==(4294967295&O.total)){A.msg="incorrect length check",O.mode=30;break}G=L=0}O.mode=29;case 29:he=1;break e;case 30:he=-3;break e;case 31:return-4;default:return b}return A.next_out=Z,A.avail_out=se,A.next_in=H,A.avail_in=Y,O.hold=L,O.bits=G,(O.wsize||ie!==A.avail_out&&O.mode<30&&(O.mode<27||P!==4))&&q(A,A.output,A.next_out,ie-A.avail_out)?(O.mode=31,-4):(ne-=A.avail_in,ie-=A.avail_out,A.total_in+=ne,A.total_out+=ie,O.total+=ie,O.wrap&&ie&&(A.adler=O.check=O.flags?d(O.check,W,ie,A.next_out-ie):l(O.check,W,ie,A.next_out-ie)),A.data_type=O.bits+(O.last?64:0)+(O.mode===12?128:0)+(O.mode===20||O.mode===15?256:0),(ne==0&&ie===0||P===4)&&he===v&&(he=-5),he)},i.inflateEnd=function(A){if(!A||!A.state)return b;var P=A.state;return P.window&&(P.window=null),A.state=null,v},i.inflateGetHeader=function(A,P){var O;return A&&A.state?(2&(O=A.state).wrap)==0?b:((O.head=P).done=!1,v):b},i.inflateSetDictionary=function(A,P){var O,X=P.length;return A&&A.state?(O=A.state).wrap!==0&&O.mode!==11?b:O.mode===11&&l(1,P,X,0)!==O.check?-3:q(A,P,X,X)?(O.mode=31,-4):(O.havedict=1,v):b},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(n,r,i){var o=n("../utils/common"),l=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],d=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],h=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],m=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];r.exports=function(p,g,v,b,C,x,S,E){var T,I,D,B,$,k,j,N,F,q=E.bits,A=0,P=0,O=0,X=0,W=0,H=0,Z=0,Y=0,se=0,L=0,G=null,ne=0,ie=new o.Buf16(16),te=new o.Buf16(16),ue=null,ve=0;for(A=0;A<=15;A++)ie[A]=0;for(P=0;P<b;P++)ie[g[v+P]]++;for(W=q,X=15;1<=X&&ie[X]===0;X--);if(X<W&&(W=X),X===0)return C[x++]=20971520,C[x++]=20971520,E.bits=1,0;for(O=1;O<X&&ie[O]===0;O++);for(W<O&&(W=O),A=Y=1;A<=15;A++)if(Y<<=1,(Y-=ie[A])<0)return-1;if(0<Y&&(p===0||X!==1))return-1;for(te[1]=0,A=1;A<15;A++)te[A+1]=te[A]+ie[A];for(P=0;P<b;P++)g[v+P]!==0&&(S[te[g[v+P]]++]=P);if(k=p===0?(G=ue=S,19):p===1?(G=l,ne-=257,ue=d,ve-=257,256):(G=h,ue=m,-1),A=O,$=x,Z=P=L=0,D=-1,B=(se=1<<(H=W))-1,p===1&&852<se||p===2&&592<se)return 1;for(;;){for(j=A-Z,F=S[P]<k?(N=0,S[P]):S[P]>k?(N=ue[ve+S[P]],G[ne+S[P]]):(N=96,0),T=1<<A-Z,O=I=1<<H;C[$+(L>>Z)+(I-=T)]=j<<24|N<<16|F|0,I!==0;);for(T=1<<A-1;L&T;)T>>=1;if(T!==0?(L&=T-1,L+=T):L=0,P++,--ie[A]==0){if(A===X)break;A=g[v+S[P]]}if(W<A&&(L&B)!==D){for(Z===0&&(Z=W),$+=O,Y=1<<(H=A-Z);H+Z<X&&!((Y-=ie[H+Z])<=0);)H++,Y<<=1;if(se+=1<<H,p===1&&852<se||p===2&&592<se)return 1;C[D=L&B]=W<<24|H<<16|$-x|0}}return L!==0&&(C[$+L]=A-Z<<24|64<<16|0),E.bits=W,0}},{"../utils/common":41}],51:[function(n,r,i){r.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(n,r,i){var o=n("../utils/common"),l=0,d=1;function h(J){for(var oe=J.length;0<=--oe;)J[oe]=0}var m=0,p=29,g=256,v=g+1+p,b=30,C=19,x=2*v+1,S=15,E=16,T=7,I=256,D=16,B=17,$=18,k=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],j=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],N=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],F=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],q=new Array(2*(v+2));h(q);var A=new Array(2*b);h(A);var P=new Array(512);h(P);var O=new Array(256);h(O);var X=new Array(p);h(X);var W,H,Z,Y=new Array(b);function se(J,oe,Ce,Se,ae){this.static_tree=J,this.extra_bits=oe,this.extra_base=Ce,this.elems=Se,this.max_length=ae,this.has_stree=J&&J.length}function L(J,oe){this.dyn_tree=J,this.max_code=0,this.stat_desc=oe}function G(J){return J<256?P[J]:P[256+(J>>>7)]}function ne(J,oe){J.pending_buf[J.pending++]=255&oe,J.pending_buf[J.pending++]=oe>>>8&255}function ie(J,oe,Ce){J.bi_valid>E-Ce?(J.bi_buf|=oe<<J.bi_valid&65535,ne(J,J.bi_buf),J.bi_buf=oe>>E-J.bi_valid,J.bi_valid+=Ce-E):(J.bi_buf|=oe<<J.bi_valid&65535,J.bi_valid+=Ce)}function te(J,oe,Ce){ie(J,Ce[2*oe],Ce[2*oe+1])}function ue(J,oe){for(var Ce=0;Ce|=1&J,J>>>=1,Ce<<=1,0<--oe;);return Ce>>>1}function ve(J,oe,Ce){var Se,ae,Ae=new Array(S+1),Oe=0;for(Se=1;Se<=S;Se++)Ae[Se]=Oe=Oe+Ce[Se-1]<<1;for(ae=0;ae<=oe;ae++){var De=J[2*ae+1];De!==0&&(J[2*ae]=ue(Ae[De]++,De))}}function ce(J){var oe;for(oe=0;oe<v;oe++)J.dyn_ltree[2*oe]=0;for(oe=0;oe<b;oe++)J.dyn_dtree[2*oe]=0;for(oe=0;oe<C;oe++)J.bl_tree[2*oe]=0;J.dyn_ltree[2*I]=1,J.opt_len=J.static_len=0,J.last_lit=J.matches=0}function be(J){8<J.bi_valid?ne(J,J.bi_buf):0<J.bi_valid&&(J.pending_buf[J.pending++]=J.bi_buf),J.bi_buf=0,J.bi_valid=0}function ze(J,oe,Ce,Se){var ae=2*oe,Ae=2*Ce;return J[ae]<J[Ae]||J[ae]===J[Ae]&&Se[oe]<=Se[Ce]}function Pe(J,oe,Ce){for(var Se=J.heap[Ce],ae=Ce<<1;ae<=J.heap_len&&(ae<J.heap_len&&ze(oe,J.heap[ae+1],J.heap[ae],J.depth)&&ae++,!ze(oe,Se,J.heap[ae],J.depth));)J.heap[Ce]=J.heap[ae],Ce=ae,ae<<=1;J.heap[Ce]=Se}function at(J,oe,Ce){var Se,ae,Ae,Oe,De=0;if(J.last_lit!==0)for(;Se=J.pending_buf[J.d_buf+2*De]<<8|J.pending_buf[J.d_buf+2*De+1],ae=J.pending_buf[J.l_buf+De],De++,Se===0?te(J,ae,oe):(te(J,(Ae=O[ae])+g+1,oe),(Oe=k[Ae])!==0&&ie(J,ae-=X[Ae],Oe),te(J,Ae=G(--Se),Ce),(Oe=j[Ae])!==0&&ie(J,Se-=Y[Ae],Oe)),De<J.last_lit;);te(J,I,oe)}function bt(J,oe){var Ce,Se,ae,Ae=oe.dyn_tree,Oe=oe.stat_desc.static_tree,De=oe.stat_desc.has_stree,qe=oe.stat_desc.elems,St=-1;for(J.heap_len=0,J.heap_max=x,Ce=0;Ce<qe;Ce++)Ae[2*Ce]!==0?(J.heap[++J.heap_len]=St=Ce,J.depth[Ce]=0):Ae[2*Ce+1]=0;for(;J.heap_len<2;)Ae[2*(ae=J.heap[++J.heap_len]=St<2?++St:0)]=1,J.depth[ae]=0,J.opt_len--,De&&(J.static_len-=Oe[2*ae+1]);for(oe.max_code=St,Ce=J.heap_len>>1;1<=Ce;Ce--)Pe(J,Ae,Ce);for(ae=qe;Ce=J.heap[1],J.heap[1]=J.heap[J.heap_len--],Pe(J,Ae,1),Se=J.heap[1],J.heap[--J.heap_max]=Ce,J.heap[--J.heap_max]=Se,Ae[2*ae]=Ae[2*Ce]+Ae[2*Se],J.depth[ae]=(J.depth[Ce]>=J.depth[Se]?J.depth[Ce]:J.depth[Se])+1,Ae[2*Ce+1]=Ae[2*Se+1]=ae,J.heap[1]=ae++,Pe(J,Ae,1),2<=J.heap_len;);J.heap[--J.heap_max]=J.heap[1],(function(tt,Wn){var ps,tr,gs,xt,tn,Kn,Tt=Wn.dyn_tree,Fa=Wn.max_code,ji=Wn.stat_desc.static_tree,Fo=Wn.stat_desc.has_stree,kr=Wn.stat_desc.extra_bits,ys=Wn.stat_desc.extra_base,Ft=Wn.stat_desc.max_length,nr=0;for(xt=0;xt<=S;xt++)tt.bl_count[xt]=0;for(Tt[2*tt.heap[tt.heap_max]+1]=0,ps=tt.heap_max+1;ps<x;ps++)Ft<(xt=Tt[2*Tt[2*(tr=tt.heap[ps])+1]+1]+1)&&(xt=Ft,nr++),Tt[2*tr+1]=xt,Fa<tr||(tt.bl_count[xt]++,tn=0,ys<=tr&&(tn=kr[tr-ys]),Kn=Tt[2*tr],tt.opt_len+=Kn*(xt+tn),Fo&&(tt.static_len+=Kn*(ji[2*tr+1]+tn)));if(nr!==0){do{for(xt=Ft-1;tt.bl_count[xt]===0;)xt--;tt.bl_count[xt]--,tt.bl_count[xt+1]+=2,tt.bl_count[Ft]--,nr-=2}while(0<nr);for(xt=Ft;xt!==0;xt--)for(tr=tt.bl_count[xt];tr!==0;)Fa<(gs=tt.heap[--ps])||(Tt[2*gs+1]!==xt&&(tt.opt_len+=(xt-Tt[2*gs+1])*Tt[2*gs],Tt[2*gs+1]=xt),tr--)}})(J,oe),ve(Ae,St,J.bl_count)}function U(J,oe,Ce){var Se,ae,Ae=-1,Oe=oe[1],De=0,qe=7,St=4;for(Oe===0&&(qe=138,St=3),oe[2*(Ce+1)+1]=65535,Se=0;Se<=Ce;Se++)ae=Oe,Oe=oe[2*(Se+1)+1],++De<qe&&ae===Oe||(De<St?J.bl_tree[2*ae]+=De:ae!==0?(ae!==Ae&&J.bl_tree[2*ae]++,J.bl_tree[2*D]++):De<=10?J.bl_tree[2*B]++:J.bl_tree[2*$]++,Ae=ae,St=(De=0)===Oe?(qe=138,3):ae===Oe?(qe=6,3):(qe=7,4))}function he(J,oe,Ce){var Se,ae,Ae=-1,Oe=oe[1],De=0,qe=7,St=4;for(Oe===0&&(qe=138,St=3),Se=0;Se<=Ce;Se++)if(ae=Oe,Oe=oe[2*(Se+1)+1],!(++De<qe&&ae===Oe)){if(De<St)for(;te(J,ae,J.bl_tree),--De!=0;);else ae!==0?(ae!==Ae&&(te(J,ae,J.bl_tree),De--),te(J,D,J.bl_tree),ie(J,De-3,2)):De<=10?(te(J,B,J.bl_tree),ie(J,De-3,3)):(te(J,$,J.bl_tree),ie(J,De-11,7));Ae=ae,St=(De=0)===Oe?(qe=138,3):ae===Oe?(qe=6,3):(qe=7,4)}}h(Y);var ye=!1;function ee(J,oe,Ce,Se){ie(J,(m<<1)+(Se?1:0),3),(function(ae,Ae,Oe,De){be(ae),ne(ae,Oe),ne(ae,~Oe),o.arraySet(ae.pending_buf,ae.window,Ae,Oe,ae.pending),ae.pending+=Oe})(J,oe,Ce)}i._tr_init=function(J){ye||((function(){var oe,Ce,Se,ae,Ae,Oe=new Array(S+1);for(ae=Se=0;ae<p-1;ae++)for(X[ae]=Se,oe=0;oe<1<<k[ae];oe++)O[Se++]=ae;for(O[Se-1]=ae,ae=Ae=0;ae<16;ae++)for(Y[ae]=Ae,oe=0;oe<1<<j[ae];oe++)P[Ae++]=ae;for(Ae>>=7;ae<b;ae++)for(Y[ae]=Ae<<7,oe=0;oe<1<<j[ae]-7;oe++)P[256+Ae++]=ae;for(Ce=0;Ce<=S;Ce++)Oe[Ce]=0;for(oe=0;oe<=143;)q[2*oe+1]=8,oe++,Oe[8]++;for(;oe<=255;)q[2*oe+1]=9,oe++,Oe[9]++;for(;oe<=279;)q[2*oe+1]=7,oe++,Oe[7]++;for(;oe<=287;)q[2*oe+1]=8,oe++,Oe[8]++;for(ve(q,v+1,Oe),oe=0;oe<b;oe++)A[2*oe+1]=5,A[2*oe]=ue(oe,5);W=new se(q,k,g+1,v,S),H=new se(A,j,0,b,S),Z=new se(new Array(0),N,0,C,T)})(),ye=!0),J.l_desc=new L(J.dyn_ltree,W),J.d_desc=new L(J.dyn_dtree,H),J.bl_desc=new L(J.bl_tree,Z),J.bi_buf=0,J.bi_valid=0,ce(J)},i._tr_stored_block=ee,i._tr_flush_block=function(J,oe,Ce,Se){var ae,Ae,Oe=0;0<J.level?(J.strm.data_type===2&&(J.strm.data_type=(function(De){var qe,St=4093624447;for(qe=0;qe<=31;qe++,St>>>=1)if(1&St&&De.dyn_ltree[2*qe]!==0)return l;if(De.dyn_ltree[18]!==0||De.dyn_ltree[20]!==0||De.dyn_ltree[26]!==0)return d;for(qe=32;qe<g;qe++)if(De.dyn_ltree[2*qe]!==0)return d;return l})(J)),bt(J,J.l_desc),bt(J,J.d_desc),Oe=(function(De){var qe;for(U(De,De.dyn_ltree,De.l_desc.max_code),U(De,De.dyn_dtree,De.d_desc.max_code),bt(De,De.bl_desc),qe=C-1;3<=qe&&De.bl_tree[2*F[qe]+1]===0;qe--);return De.opt_len+=3*(qe+1)+5+5+4,qe})(J),ae=J.opt_len+3+7>>>3,(Ae=J.static_len+3+7>>>3)<=ae&&(ae=Ae)):ae=Ae=Ce+5,Ce+4<=ae&&oe!==-1?ee(J,oe,Ce,Se):J.strategy===4||Ae===ae?(ie(J,2+(Se?1:0),3),at(J,q,A)):(ie(J,4+(Se?1:0),3),(function(De,qe,St,tt){var Wn;for(ie(De,qe-257,5),ie(De,St-1,5),ie(De,tt-4,4),Wn=0;Wn<tt;Wn++)ie(De,De.bl_tree[2*F[Wn]+1],3);he(De,De.dyn_ltree,qe-1),he(De,De.dyn_dtree,St-1)})(J,J.l_desc.max_code+1,J.d_desc.max_code+1,Oe+1),at(J,J.dyn_ltree,J.dyn_dtree)),ce(J),Se&&be(J)},i._tr_tally=function(J,oe,Ce){return J.pending_buf[J.d_buf+2*J.last_lit]=oe>>>8&255,J.pending_buf[J.d_buf+2*J.last_lit+1]=255&oe,J.pending_buf[J.l_buf+J.last_lit]=255&Ce,J.last_lit++,oe===0?J.dyn_ltree[2*Ce]++:(J.matches++,oe--,J.dyn_ltree[2*(O[Ce]+g+1)]++,J.dyn_dtree[2*G(oe)]++),J.last_lit===J.lit_bufsize-1},i._tr_align=function(J){ie(J,2,3),te(J,I,q),(function(oe){oe.bi_valid===16?(ne(oe,oe.bi_buf),oe.bi_buf=0,oe.bi_valid=0):8<=oe.bi_valid&&(oe.pending_buf[oe.pending++]=255&oe.bi_buf,oe.bi_buf>>=8,oe.bi_valid-=8)})(J)}},{"../utils/common":41}],53:[function(n,r,i){r.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(n,r,i){(function(o){(function(l,d){if(!l.setImmediate){var h,m,p,g,v=1,b={},C=!1,x=l.document,S=Object.getPrototypeOf&&Object.getPrototypeOf(l);S=S&&S.setTimeout?S:l,h={}.toString.call(l.process)==="[object process]"?function(D){process.nextTick(function(){T(D)})}:(function(){if(l.postMessage&&!l.importScripts){var D=!0,B=l.onmessage;return l.onmessage=function(){D=!1},l.postMessage("","*"),l.onmessage=B,D}})()?(g="setImmediate$"+Math.random()+"$",l.addEventListener?l.addEventListener("message",I,!1):l.attachEvent("onmessage",I),function(D){l.postMessage(g+D,"*")}):l.MessageChannel?((p=new MessageChannel).port1.onmessage=function(D){T(D.data)},function(D){p.port2.postMessage(D)}):x&&"onreadystatechange"in x.createElement("script")?(m=x.documentElement,function(D){var B=x.createElement("script");B.onreadystatechange=function(){T(D),B.onreadystatechange=null,m.removeChild(B),B=null},m.appendChild(B)}):function(D){setTimeout(T,0,D)},S.setImmediate=function(D){typeof D!="function"&&(D=new Function(""+D));for(var B=new Array(arguments.length-1),$=0;$<B.length;$++)B[$]=arguments[$+1];var k={callback:D,args:B};return b[v]=k,h(v),v++},S.clearImmediate=E}function E(D){delete b[D]}function T(D){if(C)setTimeout(T,0,D);else{var B=b[D];if(B){C=!0;try{(function($){var k=$.callback,j=$.args;switch(j.length){case 0:k();break;case 1:k(j[0]);break;case 2:k(j[0],j[1]);break;case 3:k(j[0],j[1],j[2]);break;default:k.apply(d,j)}})(B)}finally{E(D),C=!1}}}}function I(D){D.source===l&&typeof D.data=="string"&&D.data.indexOf(g)===0&&T(+D.data.slice(g.length))}})(typeof self>"u"?o===void 0?this:o:self)}).call(this,typeof Oh<"u"?Oh:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(Hg)),Hg.exports}var sP=rP();const xm=z2(sP);function iP({currentUser:t,budgetId:e}){const[n,r]=M.useState(!1),[i,o]=M.useState(null),[l,d]=M.useState(null);async function h(){if(!t){d("Must be logged in to download budget");return}if(!e){d("No budget selected");return}r(!0),d(null),o({phase:"reading",current:0,total:1,percentComplete:0});try{o({phase:"reading",current:0,total:1,percentComplete:10});const{exists:m,data:p}=await Rt("budgets",e,`downloading budget ${e}`);if(!m||!p){d(`Budget ${e} not found`);return}const g=await LT(e,"download-budget");let v=null;try{const{exists:A,data:P}=await Rt("payees",e,`downloading payees for budget ${e}`);A&&P&&(v=P)}catch(A){console.warn(`Could not read payees for budget ${e}:`,A)}o({phase:"processing",current:0,total:g.length+1,percentComplete:20});const b=new xm,C=new Date,x=C.toISOString().split("T")[0],S=`budget_${e}`,{accounts:E,account_groups:T,categories:I,category_groups:D,...B}=p;b.file(`${S}/budget.json`,JSON.stringify(B,null,2)),b.file(`${S}/accounts.json`,JSON.stringify(E||{},null,2)),b.file(`${S}/account_groups.json`,JSON.stringify(T||{},null,2)),b.file(`${S}/categories.json`,JSON.stringify(I||{},null,2)),b.file(`${S}/category_groups.json`,JSON.stringify(D||[],null,2)),v&&b.file(`${S}/payees.json`,JSON.stringify(v,null,2));let $=0;for(const A of g){const P=A.data,O=`${S}/months/month_${P.year}_${String(P.month).padStart(2,"0")}`,X={};if(P.are_allocations_finalized&&P.category_balances)for(const W of P.category_balances)W.allocated!==void 0&&(X[W.category_id]=W.allocated);b.file(`${O}/metadata.json`,JSON.stringify({budget_id:P.budget_id,year_month_ordinal:P.year_month_ordinal,year:P.year,month:P.month,total_income:P.total_income,previous_month_income:P.previous_month_income,total_expenses:P.total_expenses,are_allocations_finalized:P.are_allocations_finalized,created_at:P.created_at,updated_at:P.updated_at,...P.are_allocations_finalized&&{allocations:X},downloaded_at:C.toISOString()},null,2)),b.file(`${O}/income.json`,JSON.stringify(P.income||[],null,2)),b.file(`${O}/expenses.json`,JSON.stringify(P.expenses||[],null,2)),b.file(`${O}/transfers.json`,JSON.stringify(P.transfers||[],null,2)),b.file(`${O}/adjustments.json`,JSON.stringify(P.adjustments||[],null,2)),b.file(`${O}/account_balances.json`,JSON.stringify(P.account_balances||[],null,2)),b.file(`${O}/category_balances.json`,JSON.stringify(P.category_balances||[],null,2)),$++,o({phase:"processing",current:$,total:g.length,percentComplete:20+Math.round($/g.length*60)})}o({phase:"zipping",current:0,total:1,percentComplete:80});const k=await b.generateAsync({type:"blob"});o({phase:"complete",current:1,total:1,percentComplete:100});const N=(p.name||"budget").replace(/[^a-z0-9]/gi,"_").toLowerCase(),F=URL.createObjectURL(k),q=document.createElement("a");q.href=F,q.download=`${x}_${N}_${e}.zip`,document.body.appendChild(q),q.click(),document.body.removeChild(q),URL.revokeObjectURL(F)}catch(m){d(m instanceof Error?m.message:"Unknown error during download")}finally{r(!1),o(null)}}return{isDownloading:n,progress:i,error:l,downloadBudget:h}}async function aP(t){const n=await new xm().loadAsync(t),r=new Set,i=new Set;for(const[o]of Object.entries(n.files)){const l=o.match(/^budget_([^/]+)\//);if(l){const d=l[1];r.add(d),o.match(/^budget_([^/]+)\/months\/month_\d{4}_\d{2}\//)&&i.add(o.split("/months/")[1].split("/")[0])}}return{budgetsFound:r.size,monthsFound:i.size,payeesFound:r.size,budgetsToRestore:Array.from(r)}}async function oP(t,e,n){const i=`${`${e}/months/`}${n}/`,o=`${i}metadata.json`,l=t.files[o];if(!l)return null;const d=await l.async("string"),h=JSON.parse(d),{downloaded_at:m,allocations:p,...g}=h,v=async S=>{const E=`${i}${S}`,T=t.files[E];if(T){const I=await T.async("string");return JSON.parse(I)}return[]},b={budget_id:g.budget_id,year:g.year,month:g.month,year_month_ordinal:g.year_month_ordinal,total_income:0,previous_month_income:0,total_expenses:0,are_allocations_finalized:g.are_allocations_finalized??!1,created_at:g.created_at||new Date().toISOString(),updated_at:new Date().toISOString(),income:await v("income.json"),expenses:await v("expenses.json"),transfers:await v("transfers.json"),adjustments:await v("adjustments.json"),account_balances:[],category_balances:[]},C=Ia(b);let x=_m(C);if(h.are_allocations_finalized&&p!==void 0){const S=new Map;for(const I of x.category_balances)S.set(I.category_id,I);const E=[],T=new Set;for(const I of x.category_balances){const D=p[I.category_id];if(D!==void 0){const B=Me(D);E.push({...I,allocated:B,end_balance:Me(I.start_balance+B+I.spent+I.transfers+I.adjustments)})}else E.push(I);T.add(I.category_id)}for(const[I,D]of Object.entries(p))if(!T.has(I)){const B=Me(D);E.push({category_id:I,start_balance:0,allocated:B,spent:0,transfers:0,adjustments:0,end_balance:B})}x={...x,category_balances:E}}return{budgetId:g.budget_id,year:g.year,month:g.month,data:x}}async function lP(t,e){const n=`budget_${e}`,r=async $=>{const k=t.files[$];if(k){const j=await k.async("string");return JSON.parse(j)}return null},i=`${n}/budget.json`,o=`${n}/accounts.json`,l=`${n}/account_groups.json`,d=`${n}/categories.json`,h=`${n}/category_groups.json`,m=await r(i);if(!m)throw new Error("Missing required file budget.json");const p=await r(o)||{},g=await r(l)||{},v=await r(d)||{},b=await r(h)||[],C=Ia({...m,accounts:p,account_groups:g,categories:v,category_groups:b}),x={budgetId:e,data:C},S=`${n}/payees.json`,E=await r(S);let T=null;if(E){const $={...E,budget_id:e,updated_at:new Date().toISOString()};T={collectionPath:"payees",docId:e,data:Ia($)}}const I=`${n}/months/`,D=new Set;for(const $ of Object.keys(t.files))if($.startsWith(I)&&$.includes("/metadata.json")){const k=$.split("/months/")[1].split("/")[0];D.add(k)}const B=[];for(const $ of D){const k=await oP(t,n,$);k&&B.push(k)}return{budgetUpdate:x,monthUpdates:B,payeeWrite:T}}function cP({currentUser:t}){const[e,n]=M.useState(!1),[r,i]=M.useState(!1),[o,l]=M.useState(null),[d,h]=M.useState(null),[m,p]=M.useState(null),[g,v]=M.useState(null);async function b(x){if(!t){p("Must be logged in to upload budget");return}n(!0),p(null),l(null),v(null);try{const S=await aP(x);l(S)}catch(S){p(S instanceof Error?S.message:"Failed to parse zip file")}finally{n(!1)}}async function C(x){if(!t){p("Must be logged in to upload budget");return}if(!o){p("Must scan file first");return}i(!0),p(null),h({phase:"parsing",current:0,total:1,percentComplete:0});const S=[];let E=0,T=0,I=0;try{h({phase:"parsing",current:0,total:1,percentComplete:10});const B=await new xm().loadAsync(x);h({phase:"validating",current:0,total:1,percentComplete:20}),h({phase:"uploading",current:0,total:o.budgetsToRestore.length,percentComplete:30});const $=[],k=[],j=[];for(let N=0;N<o.budgetsToRestore.length;N++){const F=o.budgetsToRestore[N];try{const{budgetUpdate:q,monthUpdates:A,payeeWrite:P}=await lP(B,F);$.push(q),k.push(...A),P&&j.push(P),h({phase:"uploading",current:N+1,total:o.budgetsToRestore.length,percentComplete:30+Math.round((N+1)/o.budgetsToRestore.length*50)})}catch(q){S.push(`Budget ${F}: ${q instanceof Error?q.message:String(q)}`)}}if(h({phase:"uploading",current:o.budgetsToRestore.length,total:o.budgetsToRestore.length,percentComplete:80}),$.length>0)try{console.log(`[Upload] Writing ${$.length} budget(s)...`),await UT($,"upload-budget"),E=$.length,console.log(`[Upload] Successfully wrote ${E} budget(s)`)}catch(N){const F=`Failed to write budgets: ${N instanceof Error?N.message:String(N)}`;throw console.error(`[Upload] ${F}`,N),S.push(F),N}if(j.length>0)try{console.log(`[Upload] Writing ${j.length} payee doc(s)...`),await dm(j,"upload-budget: writing payees"),I=j.length,console.log(`[Upload] Successfully wrote ${I} payee doc(s)`)}catch(N){const F=`Failed to write payees: ${N instanceof Error?N.message:String(N)}`;throw console.error(`[Upload] ${F}`,N),S.push(F),N}if(k.length>0)try{console.log(`[Upload] Writing ${k.length} month(s) and recalculating...`),await g3(k,"upload-budget"),T=k.length,console.log(`[Upload] Successfully wrote ${T} month(s)`)}catch(N){const F=`Failed to write months: ${N instanceof Error?N.message:String(N)}`;throw console.error(`[Upload] ${F}`,N),S.push(F),N}h({phase:"complete",current:1,total:1,percentComplete:100}),v({success:S.length===0,budgetsRestored:E,monthsRestored:T,payeesRestored:I,errors:S}),console.log("[Upload] Clearing all caches after upload..."),Ma()}catch(D){const B=D instanceof Error?D.message:"Unknown error during upload";console.error("[Upload] Upload failed with error:",D),console.error("[Upload] Error details:",{errorMessage:B,budgetsRestored:E,monthsRestored:T,payeesRestored:I,errorsSoFar:S}),p(B),v({success:!1,budgetsRestored:E,monthsRestored:T,payeesRestored:I,errors:[...S,B]}),console.log("[Upload] Clearing all caches after failed upload (partial writes possible)..."),Ma()}finally{i(!1),h(null)}}return{isScanning:e,isUploading:r,status:o,progress:d,error:m,result:g,scanZipFile:b,uploadBudget:C}}function uP({isActive:t,onDragOver:e,onDragLeave:n,onDrop:r,label:i="Move to end"}){return u.jsxs("div",{onDragOver:e,onDragLeave:n,onDrop:r,style:O4,children:[u.jsx("div",{style:{...N4,opacity:t?1:.3,boxShadow:t?"0 0 8px rgba(100, 108, 255, 0.6)":"none"}}),t&&u.jsx("span",{style:P4,children:i})]})}function _t(t){return`$${Math.abs(t).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`}function pr(t){return t<0?`-$${Math.abs(t).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`:`$${t.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`}function wt(t){return t===0?"$0.00":`${t>0?"+":"-"}${_t(t)}`}function Lt(t){return`${t>=0?"+":"-"}${_t(t)}`}function ot(t){return t===0?me.zero:t>0?me.success:me.danger}function dn(t){return t===0?me.zero:t>0?me.success:me.debt}function pc(t){return t===0?me.zero:t<0?me.error:me.success}function gc(t){return t===0?me.zero:t>0?me.success:me.error}async function HT(t,e){const{exists:n,data:r}=await Rt("feedback",t,`VALIDATION-READ: ${e}`);if(!n||!r)throw new Error(`Feedback document not found: ${t}`);return{items:r.items||[],user_email:r.user_email,created_at:r.created_at,updated_at:r.updated_at}}async function G0(t){const{docId:e,items:n,description:r}=t;await Hn("feedback",e,{items:n,updated_at:new Date().toISOString()},r,{merge:!0})}async function dP(t,e,n,r){const{exists:i}=await Rt("feedback",t,"checking if user has existing feedback document");i?await Hn("feedback",t,{items:Uu(e),user_email:n,updated_at:new Date().toISOString()},r,{merge:!0}):await Hn("feedback",t,{items:[e],user_email:n,created_at:new Date().toISOString(),updated_at:new Date().toISOString()},r)}function GT(){const t=$t(),e=Gn({onMutate:async r=>{const{userId:i,userEmail:o,text:l,feedbackType:d,currentPath:h}=r,m=o||i,p=Ie.feedback();await t.cancelQueries({queryKey:p});const g=t.getQueryData(p),v=`feedback_optimistic_${Date.now()}`,b={id:v,text:`${l}

(Submitted from: ${h})`,created_at:new Date().toISOString(),is_done:!1,completed_at:null,sort_order:Date.now(),feedback_type:d,doc_id:m,user_email:o};return g&&t.setQueryData(p,{items:[...g.items,b]}),{previousData:g,optimisticId:v}},mutationFn:async r=>{const{userId:i,userEmail:o,text:l,feedbackType:d,currentPath:h}=r,m=o||i,p={id:`feedback_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,text:`${l}

(Submitted from: ${h})`,created_at:new Date().toISOString(),is_done:!1,completed_at:null,sort_order:Date.now(),feedback_type:d};return await dP(m,p,o,"submitting new feedback"),{feedbackItem:p,docId:m}},onSuccess:(r,i,o)=>{if(!o?.optimisticId)return;const l=t.getQueryData(Ie.feedback());l&&t.setQueryData(Ie.feedback(),{items:l.items.map(d=>d.id===o.optimisticId?{...r.feedbackItem,doc_id:r.docId,user_email:i.userEmail}:d)})},onError:(r,i,o)=>{o?.previousData&&t.setQueryData(Ie.feedback(),o.previousData)}});return{submitFeedback:{mutate:r=>e.mutate(r),mutateAsync:r=>e.mutateAsync(r),isPending:e.isPending,isError:e.isError,error:e.error,reset:e.reset}}}function hP(){const t=$t(),e=Gn({onMutate:async r=>{const{item:i}=r,o=Ie.feedback(),l=!i.is_done,d=l?new Date().toISOString():null;await t.cancelQueries({queryKey:o});const h=t.getQueryData(o);return h&&t.setQueryData(o,{items:h.items.map(m=>m.id===i.id?{...m,is_done:l,completed_at:d}:m)}),{previousData:h}},mutationFn:async r=>{const{item:i}=r,o=!i.is_done,l=o?new Date().toISOString():null,d=await HT(i.doc_id,"toggle feedback");let h=!1;const m=d.items.map(p=>p.id===i.id?(h=!0,{...p,is_done:o,completed_at:l}):p);if(!h)throw console.error("[toggleFeedback] Item not found in document",{searchingFor:i.id,inDocument:i.doc_id,availableIds:d.items.map(p=>p.id)}),new Error(`Feedback item not found in document. Item ID: ${i.id}, Doc ID: ${i.doc_id}`);return await G0({docId:i.doc_id,items:m,description:`marking feedback item as ${o?"done":"not done"}`}),{itemId:i.id,isDone:o,completedAt:l}},onError:(r,i,o)=>{o?.previousData&&t.setQueryData(Ie.feedback(),o.previousData)}});return{toggleFeedback:{mutate:r=>e.mutate(r),mutateAsync:r=>e.mutateAsync(r),isPending:e.isPending,isError:e.isError,error:e.error,reset:e.reset}}}function fP(){const t=$t(),e=Gn({onMutate:async r=>{const{docId:i,items:o}=r,l=Ie.feedback();await t.cancelQueries({queryKey:l});const d=t.getQueryData(l),h=new Map;return o.forEach(m=>{h.set(m.id,m.sort_order)}),d&&t.setQueryData(l,{items:d.items.map(m=>m.doc_id===i&&h.has(m.id)?{...m,sort_order:h.get(m.id)}:m)}),{previousData:d}},mutationFn:async r=>{const{docId:i,items:o}=r;return await G0({docId:i,items:o,description:"saving reordered feedback items"}),{docId:i,items:o}},onError:(r,i,o)=>{o?.previousData&&t.setQueryData(Ie.feedback(),o.previousData)}});return{updateSortOrder:{mutate:r=>e.mutate(r),mutateAsync:r=>e.mutateAsync(r),isPending:e.isPending,isError:e.isError,error:e.error,reset:e.reset}}}function us({isOpen:t,onClose:e,title:n,children:r,width:i="28rem"}){if(!t)return null;function o(){e()}return u.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0, 0, 0, 0.6)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1001,padding:"1rem"},onClick:o,children:u.jsxs("div",{style:{background:"#1a1a1a",color:"rgba(255, 255, 255, 0.87)",borderRadius:"12px",padding:"1.5rem",width:i,maxWidth:"calc(100vw - 2rem)",flexShrink:0,boxSizing:"border-box",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.5)"},onClick:l=>l.stopPropagation(),children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[u.jsx("h2",{style:{margin:0,fontSize:"1.25rem"},children:n}),u.jsx("button",{onClick:o,style:{background:"transparent",border:"none",color:"inherit",cursor:"pointer",fontSize:"1.5rem",opacity:.6,lineHeight:1},children:""})]}),r]})})}const mP=2e3,pP={critical_bug:{label:"Critical Bug",color:"#ff4757",bgColor:"rgba(255, 71, 87, 0.15)"},bug:{label:"Bug",color:"#ffa502",bgColor:"rgba(255, 165, 2, 0.15)"},new_feature:{label:"New Feature",color:"#2ed573",bgColor:"rgba(46, 213, 115, 0.15)"},core_feature:{label:"Core Feature",color:"#1e90ff",bgColor:"rgba(30, 144, 255, 0.15)"},qol:{label:"QOL",color:"#a55eea",bgColor:"rgba(165, 94, 234, 0.15)"}};function gP(){const[t,e]=M.useState(!1),[n,r]=M.useState(""),[i,o]=M.useState("bug"),[l,d]=M.useState(!1),h=M.useContext(ud),p=Na().get_current_firebase_user(),g=Nn(),{submitFeedback:v}=GT();if(M.useEffect(()=>{if(l){const x=setTimeout(()=>d(!1),mP);return()=>clearTimeout(x)}},[l]),g.pathname.includes("/admin/feedback")||!h.is_logged_in)return null;function C(x){x.preventDefault(),!(!n.trim()||!h.username||!p)&&(v.mutate({userId:p.uid,userEmail:h.username,text:n.trim(),feedbackType:i,currentPath:g.pathname}),r(""),o("bug"),e(!1),d(!0))}return u.jsxs(u.Fragment,{children:[l&&u.jsxs("div",{style:{position:"fixed",bottom:"5rem",right:"1.5rem",background:"rgba(46, 213, 115, 0.95)",color:"white",padding:"0.75rem 1rem",borderRadius:"0.5rem",fontSize:"0.9rem",fontWeight:500,boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",zIndex:1001,display:"flex",alignItems:"center",gap:"0.5rem",animation:"fadeInUp 0.2s ease-out"},children:[u.jsx("span",{children:""}),u.jsx("span",{children:"Feedback submitted!"})]}),u.jsx("button",{onClick:()=>{e(!0)},style:{position:"fixed",bottom:"1.5rem",right:"1.5rem",width:"3rem",height:"3rem",borderRadius:"50%",background:me.primary,color:"white",border:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1.25rem",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",transition:"transform 0.15s, box-shadow 0.15s",zIndex:1e3},title:"Send Feedback",onMouseEnter:x=>{x.currentTarget.style.transform="scale(1.1)",x.currentTarget.style.boxShadow="0 6px 16px rgba(0, 0, 0, 0.4)"},onMouseLeave:x=>{x.currentTarget.style.transform="scale(1)",x.currentTarget.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.3)"},children:""}),u.jsx(us,{isOpen:t,onClose:()=>{e(!1),o("bug")},title:"Send Feedback",children:u.jsxs("form",{onSubmit:C,children:[u.jsx("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"0.75rem",paddingBottom:"1rem",flexWrap:"wrap"},children:["critical_bug","bug","new_feature","core_feature","qol"].map(x=>{const S=pP[x],E=i===x;return u.jsxs("button",{type:"button",onClick:()=>{S.label,o(x)},style:{flex:1,padding:"0.6rem 0.5rem",border:`2px solid ${S.color}`,borderRadius:"0.5rem",background:E?S.bgColor:"transparent",color:E?S.color:"rgba(255,255,255,0.5)",cursor:"pointer",fontWeight:E?600:400,fontSize:"0.8rem",transition:"all 0.15s ease",opacity:E?1:.5,boxShadow:E?`0 0 12px ${S.bgColor}`:"none",position:"relative"},children:[S.label,E&&u.jsx("span",{style:{position:"absolute",bottom:"-14px",left:"10%",right:"10%",height:"3px",background:"white",borderRadius:"2px"}})]},x)})}),u.jsx(H0,{value:n,onChange:x=>r(x.target.value),placeholder:"Share your feedback, bug reports, or feature requests...",minHeight:"8rem",autoFocus:!0,required:!0}),u.jsxs(La,{children:[u.jsx(Ve,{type:"button",variant:"secondary",actionName:"Cancel Feedback",onClick:()=>{e(!1),o("bug")},children:"Cancel"}),u.jsx(Ve,{type:"submit",actionName:"Submit Feedback",disabled:!n.trim(),children:"Submit"})]})]})})]})}function Hr({children:t,labelStyle:e,...n}){return u.jsxs("label",{style:{display:"flex",alignItems:"flex-start",gap:"0.75rem",flex:1,cursor:"pointer",...e},children:[u.jsx("input",{type:"checkbox",style:{width:"1.25rem",height:"1.25rem",marginTop:"0.1rem",cursor:"pointer",accentColor:me.primary},...n}),t]})}function Q0({title:t,count:e,children:n,defaultExpanded:r=!1}){const[i,o]=M.useState(r);return u.jsxs("div",{style:{marginTop:"2rem"},children:[u.jsxs("button",{onClick:()=>o(!i),style:{background:"transparent",border:"none",color:"inherit",cursor:"pointer",display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 0",fontSize:"0.9rem",opacity:.7},children:[u.jsx("span",{style:{transition:"transform 0.2s",transform:i?"rotate(90deg)":"rotate(0deg)"},children:""}),t,e!==void 0&&` (${e})`]}),i&&n]})}const yP=t=>{switch(t){case 2:return 220;case 3:return 320;case 4:return 420;case 5:return 520;case 6:return 620;default:return t*100+20}},_P=t=>t<=4?2:t<=6?3:Math.ceil(t/2);function Df(t){const{tabs:e,activeTab:n,variant:r="primary"}=t,i=e.filter(S=>!S.hidden),o=i.length,l=yP(o),d=_P(o),h=Math.floor(100/d),m=`tab-nav-${o}-${r}`,p=r==="primary",g=r==="secondary",v=r==="segmented",b=S=>{const E="color-mix(in srgb, currentColor 10%, transparent)",T="color-mix(in srgb, currentColor 3%, transparent)";return v?{flex:"1 1 0",padding:"0.75rem 1rem",border:"none",borderRadius:0,background:S?E:T,cursor:"pointer",fontWeight:S?600:400,fontSize:"0.95rem",color:"inherit",opacity:S?1:.55,transition:"all 0.15s",textDecoration:"none",display:"inline-flex",alignItems:"center",justifyContent:"center",gap:"0.25rem",position:"relative",boxSizing:"border-box",outline:"none",borderBottom:S?"2px solid currentColor":"2px solid transparent"}:g?{flex:"none",minWidth:"8.5rem",padding:"0.55rem 1rem 0.65rem",border:"none",borderRadius:"10px 10px 0 0",background:"transparent",cursor:"pointer",fontWeight:600,fontSize:"0.85rem",color:S?"inherit":"color-mix(in srgb, currentColor 55%, transparent)",transition:"color 0.15s",textDecoration:"none",display:"inline-flex",alignItems:"center",justifyContent:"center",gap:"0.25rem",position:"relative",boxSizing:"border-box",outline:"none",marginBottom:S?"-1px":"0"}:{flex:"1 1 0",padding:"0.7rem 0.75rem",border:"none",borderRadius:0,background:"transparent",cursor:"pointer",fontWeight:S?600:400,fontSize:"1rem",letterSpacing:"0.01em",color:"inherit",opacity:S?1:.6,transition:"all 0.15s",textDecoration:"none",display:"inline-flex",alignItems:"center",justifyContent:"center",gap:"0.25rem",position:"relative",boxSizing:"border-box",outline:"none"}},C=(S,E)=>u.jsxs(u.Fragment,{children:[u.jsx("span",{children:S.label}),S.checkmark&&u.jsx("span",{style:{color:me.success,fontWeight:600},children:""}),p&&E&&u.jsx("span",{style:{position:"absolute",bottom:"-1px",left:"10%",right:"10%",height:"3px",background:"white",borderRadius:"2px"}})]}),x=()=>v?`
        .${m} {
          display: flex;
          margin-bottom: 0.75rem;
          border-bottom: 1px solid color-mix(in srgb, currentColor 15%, transparent);
        }
      `:g?`
        .${m} {
          display: flex;
          flex-wrap: nowrap;
          margin-bottom: 1rem;
          border-bottom: 1px solid color-mix(in srgb, currentColor 10%, transparent);
          justify-content: flex-start;
          padding-left: 0.75rem;
          position: relative;
        }
        .${m} > button,
        .${m} > a {
          margin-right: -8px;
          isolation: isolate;
        }
        .${m} > button:last-child,
        .${m} > a:last-child {
          margin-right: 0;
        }
        .${m} > button::before,
        .${m} > a::before {
          content: '';
          position: absolute;
          inset: 0;
          background: var(--tab-bg);
          border-radius: 10px 10px 0 0;
          z-index: -1;
          transform: perspective(50px) rotateX(5deg);
          transform-origin: bottom center;
          transition: background 0.15s;
          box-shadow: -1px 0 0 #242424, 1px 0 0 #242424;
        }
        .${m} > button:nth-child(1),
        .${m} > a:nth-child(1) {
          z-index: 4;
        }
        .${m} > button:nth-child(2),
        .${m} > a:nth-child(2) {
          z-index: 3;
        }
        .${m} > button:nth-child(3),
        .${m} > a:nth-child(3) {
          z-index: 2;
        }
        .${m} > button:nth-child(4),
        .${m} > a:nth-child(4) {
          z-index: 1;
        }
        .${m} > button.tab-active,
        .${m} > a.tab-active {
          z-index: 10;
        }
        .${m} > button.tab-active::before,
        .${m} > a.tab-active::before {
          background: var(--tab-bg-active);
        }
        .${m} > button:not(.tab-active):hover,
        .${m} > a:not(.tab-active):hover {
          color: color-mix(in srgb, currentColor 80%, transparent);
        }
        .${m} > button:not(.tab-active):hover::before,
        .${m} > a:not(.tab-active):hover::before {
          background: var(--tab-bg-hover);
        }
        @media (max-width: 480px) {
          .${m} {
            padding-left: 0;
            padding-right: 0;
          }
          .${m} > button,
          .${m} > a {
            flex: 0 0 27% !important;
            min-width: 27% !important;
            padding: 0.55rem 0.5rem 0.65rem !important;
            font-size: 0.8rem !important;
          }
        }
      `:`
      .${m} {
        display: flex;
        flex-wrap: wrap;
        margin-bottom: 0;
        border-bottom: 1px solid color-mix(in srgb, currentColor 25%, transparent);
      }
      @media (max-width: ${l}px) {
        .${m} > * {
          flex: 1 1 ${h}% !important;
          min-width: ${h}% !important;
        }
      }
    `;return u.jsxs(u.Fragment,{children:[u.jsx("style",{children:`
        ${x()}
        .${m} > button,
        .${m} > a {
          border: none !important;
          border-radius: 0 !important;
          outline: none !important;
        }
        .${m} > button:hover,
        .${m} > button:focus,
        .${m} > a:hover,
        .${m} > a:focus {
          border: none !important;
          border-color: transparent !important;
          ${p?"opacity: 0.85;":""}
          ${v?"background: color-mix(in srgb, currentColor 7%, transparent);":""}
        }
      `}),u.jsx("div",{className:m,children:i.map(S=>{const E=n===S.id;return t.mode==="link"?u.jsx(An,{to:`${t.linkPrefix}/${S.id}`,onClick:()=>(`${S.label}`,void 0),style:b(E),className:E?"tab-active":"",children:C(S,E)},S.id):u.jsx("button",{onClick:()=>{`${S.label}`,t.onTabChange(S.id)},style:b(E),className:E?"tab-active":"",children:C(S,E)},S.id)})})]})}function QT({items:t}){const[e,n]=M.useState(!1),r=M.useRef(null),o=Nn().pathname;M.useEffect(()=>{function d(h){r.current&&!r.current.contains(h.target)&&n(!1)}if(e)return document.addEventListener("mousedown",d),()=>document.removeEventListener("mousedown",d)},[e]),M.useEffect(()=>{function d(h){h.key==="Escape"&&n(!1)}if(e)return document.addEventListener("keydown",d),()=>document.removeEventListener("keydown",d)},[e]);const l=t.filter(d=>d.hidden?!1:d.to?d.to==="/budget"?!(o==="/budget"||/^\/budget\/\d{4}\/\d{1,2}\/\w+$/.test(o)):d.to==="/account"||d.to==="/"?o!==d.to:!o.startsWith(d.to):!0);return u.jsxs("div",{ref:r,style:{position:"relative"},children:[u.jsx("button",{onClick:()=>{n(!e)},style:{display:"flex",alignItems:"center",justifyContent:"center",width:"2.5rem",height:"2.5rem",borderRadius:"8px",background:e?"color-mix(in srgb, currentColor 15%, transparent)":"color-mix(in srgb, currentColor 8%, transparent)",border:"none",cursor:"pointer",fontSize:"1.25rem",color:"inherit",transition:"background 0.15s",lineHeight:1},title:"Menu","aria-expanded":e,"aria-haspopup":"true",children:""}),e&&u.jsx("div",{style:{position:"absolute",top:"100%",right:0,marginTop:"0.5rem",minWidth:"180px",background:"#1a1a2e",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",borderRadius:"8px",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.3)",zIndex:1e3,overflow:"hidden"},children:l.map((d,h)=>{if(d.divider)return u.jsx("div",{style:{height:"1px",background:"color-mix(in srgb, currentColor 15%, transparent)",margin:"0.25rem 0"}},h);const m=u.jsxs(u.Fragment,{children:[d.icon&&u.jsx("span",{style:{width:"1.5rem",textAlign:"center"},children:d.icon}),u.jsx("span",{children:d.label})]}),p={display:"flex",alignItems:"center",gap:"0.75rem",padding:"0.75rem 1rem",fontSize:"0.95rem",color:"inherit",textDecoration:"none",cursor:"pointer",transition:"background 0.15s",background:"transparent",border:"none",width:"100%",textAlign:"left"},g={background:"color-mix(in srgb, currentColor 10%, transparent)"};return d.to?u.jsx(An,{to:d.to,style:p,onMouseEnter:v=>Object.assign(v.currentTarget.style,g),onMouseLeave:v=>v.currentTarget.style.background="transparent",onClick:()=>{`${d.label}`,n(!1)},children:m},h):u.jsx("button",{onClick:()=>{`${d.label}`,d.onClick?.(),n(!1)},style:p,onMouseEnter:v=>Object.assign(v.currentTarget.style,g),onMouseLeave:v=>v.currentTarget.style.background="transparent",children:m},h)})})]})}function bP({title:t,showBackArrow:e=!1,hideMenu:n=!1}){const{isAdmin:r}=Ye(),i=Nn(),l=[...i.pathname==="/budget"||i.pathname.startsWith("/budget/")&&!i.pathname.startsWith("/budget/settings")&&!i.pathname.startsWith("/budget/admin")&&!i.pathname.startsWith("/budget/analytics")&&!i.pathname.startsWith("/budget/my-budgets")?[]:[{label:"Budget",icon:"",to:"/budget"}],{label:"Budget Settings",icon:"",to:"/budget/settings"},{label:"Analytics",icon:"",to:"/budget/analytics"},...r?[{label:"Admin",icon:"",to:"/budget/admin"}]:[],{label:"Switch Budgets",icon:"",to:"/budget/my-budgets"},{divider:!0,label:""},{label:"Exit Budget App",icon:"",to:"/"}];return u.jsxs("nav",{style:{marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%"},children:[u.jsx("div",{style:{flex:"0 0 auto"},children:e?u.jsx(An,{to:"/",onClick:()=>void 0,style:{opacity:.6,fontSize:"1.5rem",textDecoration:"none"},title:"Back to Home",children:""}):u.jsx(An,{to:"/budget",onClick:()=>void 0,title:"Budget Home",children:u.jsx("img",{src:"/budget-icon.svg",alt:"Budget",style:{width:"1.5rem",height:"1.5rem"}})})}),u.jsx("span",{style:{fontWeight:600,fontSize:"1.1rem",textAlign:"center",flex:"1 1 auto"},children:t}),u.jsx("div",{style:{flex:"0 0 auto"},children:n?u.jsx("div",{style:{width:"1.5rem"}}):u.jsx(QT,{items:l})})]})}function WT({children:t,style:e}){return u.jsx("div",{style:{width:"100%",maxWidth:"var(--content-max-width, 900px)",marginLeft:"auto",marginRight:"auto",...e},children:t})}function Hu({message:t,linkText:e,linkTo:n}){return u.jsx("div",{style:{gridColumn:"1 / -1",background:`color-mix(in srgb, ${me.warning} 12%, transparent)`,border:`2px solid ${me.warning}`,borderRadius:"8px",padding:"1rem 1.25rem",margin:"0.75rem 0",animation:"warningPulse 2s ease-in-out infinite"},children:u.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"0.75rem",flexWrap:"wrap"},children:[u.jsx("span",{style:{fontSize:"1.25rem",lineHeight:1.3},children:""}),u.jsxs("div",{style:{flex:1,minWidth:"200px"},children:[u.jsx("p",{style:{margin:0,fontWeight:500,color:me.warning,fontSize:"0.95rem"},children:t}),u.jsxs(An,{to:n,style:{display:"inline-flex",alignItems:"center",gap:"0.35rem",marginTop:"0.5rem",color:me.warning,fontWeight:600,fontSize:"0.9rem",textDecoration:"underline",textUnderlineOffset:"3px"},children:[e," "]})]})]})})}const vP={success:{bgColor:"rgba(46, 213, 115, 0.95)",color:"white",icon:""},error:{bgColor:"rgba(255, 71, 87, 0.95)",color:"white",icon:""},warning:{bgColor:"rgba(255, 165, 2, 0.95)",color:"white",icon:""},info:{bgColor:"rgba(30, 144, 255, 0.95)",color:"white",icon:""}};function xP({item:t,onDismiss:e}){const[n,r]=M.useState(!1);if(M.useEffect(()=>{if(t){if(r(!0),t.autoDismissMs&&t.autoDismissMs>0){const o=setTimeout(()=>{r(!1),setTimeout(()=>e(t.id),200)},t.autoDismissMs);return()=>clearTimeout(o)}}else r(!1)},[t,e]),!t||!n)return null;const i=vP[t.type];return u.jsxs("div",{style:{position:"fixed",bottom:"1.5rem",right:"1.5rem",left:"1.5rem",maxWidth:"600px",margin:"0 auto",background:i.bgColor,color:i.color,padding:"0.75rem 1rem",borderRadius:"0.5rem",fontSize:"0.9rem",fontWeight:500,boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",zIndex:1001,display:"flex",alignItems:"center",gap:"0.5rem",animation:n?"fadeInUp 0.2s ease-out":"fadeOut 0.2s ease-out",cursor:"pointer"},onClick:()=>{r(!1),setTimeout(()=>e(t.id),200)},children:[u.jsx("span",{children:i.icon}),u.jsx("span",{style:{flex:1},children:t.message}),u.jsx("span",{style:{fontSize:"1.2rem",lineHeight:1},children:""})]})}class wP{items=[];listeners=new Set;nextId=1;add(e){const n=`banner-${this.nextId++}`,r={...e,id:n};return this.items.push(r),this.notify(),n}remove(e){this.items=this.items.filter(n=>n.id!==e),this.notify()}getCurrent(){return this.items[0]||null}subscribe(e){return this.listeners.add(e),e(this.getCurrent()),()=>{this.listeners.delete(e)}}notify(){const e=this.getCurrent();this.listeners.forEach(n=>n(e))}}const gr=new wP;function SP(t,e){const n={};Object.keys(e).forEach(l=>{n[l]=0});const r=Le.getQueryData(Ie.budget(t));if(!r)return n;const i=r.budget.month_map||{},o=Object.keys(i).sort();for(const l of o){const d=parseInt(l.substring(0,4),10),h=parseInt(l.substring(4,6),10),m=Ie.month(t,d,h),p=Le.getQueryData(m);if(!p?.month)continue;const g=p.month;for(const v of g.account_balances||[])v.account_id&&!Je(v.account_id)&&n[v.account_id]===0&&(n[v.account_id]=v.start_balance??0)}for(const l of o){const d=parseInt(l.substring(0,4),10),h=parseInt(l.substring(4,6),10),m=Ie.month(t,d,h),p=Le.getQueryData(m);if(!p?.month)continue;const g=p.month;for(const v of g.income||[])v.account_id&&!Je(v.account_id)&&n[v.account_id]!==void 0&&(n[v.account_id]+=v.amount);for(const v of g.expenses||[])v.account_id&&!Je(v.account_id)&&n[v.account_id]!==void 0&&(n[v.account_id]+=v.amount);for(const v of g.transfers||[])v.to_account_id&&!Je(v.to_account_id)&&n[v.to_account_id]!==void 0&&(n[v.to_account_id]+=v.amount),v.from_account_id&&!Je(v.from_account_id)&&n[v.from_account_id]!==void 0&&(n[v.from_account_id]-=v.amount);for(const v of g.adjustments||[])v.account_id&&!Je(v.account_id)&&n[v.account_id]!==void 0&&(n[v.account_id]+=v.amount)}for(const l of Object.keys(n))n[l]=Me(n[l]);return n}function KT(t){const e=Le.getQueryData(Ie.budget(t));if(!e){console.warn("[recalculateBudgetAccountBalancesFromCache] Budget not in cache");return}const n=SP(t,e.accounts),r={};for(const[o,l]of Object.entries(e.accounts))r[o]={...l,balance:n[o]??l.balance};const i=F0(r,e.categories,e.accountGroups);Le.setQueryData(Ie.budget(t),{...e,accounts:r,budget:{...e.budget,accounts:r,total_available:i}})}const CP=300*1e3;function Sn(){const{removeChange:t,getChanges:e,clearChanges:n,hasChanges:r,setIsSaving:i,setLastSaveTime:o,setSaveError:l}=mc(),d=M.useRef(null),h=M.useRef(!1),m=M.useCallback(async(C,x,S,E)=>{const T=Ie.month(C,x,S),I=Le.getQueryData(T);if(!I?.month)throw new Error(`Month ${x}/${S} not found in cache`);await ET({budgetId:C,month:I.month,description:`${E}: ${x}/${S}`,cascadeRecalculation:!1})},[]),p=M.useCallback(async(C,x)=>{const S=Ie.budget(C),E=Le.getQueryData(S);if(!E)throw new Error(`Budget ${C} not found in cache`);await gm({budgetId:C,updates:{name:E.budget.name,user_ids:E.budget.user_ids,accepted_user_ids:E.budget.accepted_user_ids,owner_id:E.budget.owner_id,owner_email:E.budget.owner_email,accounts:E.budget.accounts,account_groups:E.budget.account_groups,categories:E.budget.categories,category_groups:E.budget.category_groups,total_available:E.budget.total_available,is_needs_recalculation:E.budget.is_needs_recalculation,month_map:E.budget.month_map},description:`${x}: budget`})},[]),g=M.useCallback(async(C,x)=>{const S=Ie.payees(C),E=Le.getQueryData(S);if(!E)throw new Error(`Payees for budget ${C} not found in cache`);await Hn("payees",C,{budget_id:C,payees:E,updated_at:new Date().toISOString()},`${x}: payees`)},[]),v=M.useCallback(async(C="periodic save")=>{if(h.current||!r())return;h.current=!0,i(!0),l(null);const x=e(),S=[];try{const E=[],T=new Set,I=new Set;for(const D of x)D.type==="month"&&D.year!==void 0&&D.month!==void 0?E.push({budgetId:D.budgetId,year:D.year,month:D.month}):D.type==="budget"?T.add(D.budgetId):D.type==="payees"&&I.add(D.budgetId);for(const{budgetId:D,year:B,month:$}of E){const k=Ie.month(D,B,$),j=Le.getQueryData(k);if(j?.month){const N=_m(j.month);Le.setQueryData(k,{month:N})}}for(const{budgetId:D,year:B,month:$}of E)try{await m(D,B,$,C)}catch(k){const j=`Failed to save month ${B}/${$}: ${k instanceof Error?k.message:String(k)}`;S.push(j),console.error("[useBackgroundSave]",j,k)}for(const D of T)try{KT(D)}catch(B){console.warn("[useBackgroundSave] Failed to recalculate budget account balances from cache:",B)}for(const D of T)try{await p(D,C)}catch(B){const $=`Failed to save budget: ${B instanceof Error?B.message:String(B)}`;S.push($),console.error("[useBackgroundSave]",$,B)}for(const D of I)try{await g(D,C)}catch(B){const $=`Failed to save payees: ${B instanceof Error?B.message:String(B)}`;S.push($),console.error("[useBackgroundSave]",$,B)}if(S.length===0)n(),o(Date.now()),gr.add({type:"success",message:"All changes saved successfully",autoDismissMs:2e3});else throw new Error(S.join("; "))}catch(E){const T=E instanceof Error?E.message:String(E);throw l(T),gr.add({type:"error",message:`Failed to save changes: ${T}`,autoDismissMs:0}),E}finally{h.current=!1,i(!1)}},[r,e,n,m,p,g,i,o,l]),b=M.useCallback(async(C,x,S,E)=>{try{i(!0),l(null),x==="month"&&S!==void 0&&E!==void 0?(await m(C,S,E,"immediate save (current viewing document)"),t({type:"month",budgetId:C,year:S,month:E}),o(Date.now())):x==="budget"&&(await p(C,"immediate save (current viewing document)"),t({type:"budget",budgetId:C}),o(Date.now()))}catch(T){const I=T instanceof Error?T.message:String(T);throw l(I),gr.add({type:"error",message:`Failed to save current document: ${I}`,autoDismissMs:0}),T}finally{i(!1)}},[m,p,t,i,o,l]);return M.useEffect(()=>(d.current&&clearInterval(d.current),d.current=setInterval(()=>{r()&&v("periodic save (5-minute timer)").catch(x=>{console.error("[useBackgroundSave] Periodic save failed:",x)})},CP),()=>{d.current&&clearInterval(d.current)}),[r,v]),{saveAllChanges:v,saveCurrentDocument:b}}async function EP(t,e,n,r){const i=Le.getQueryData(Ie.budget(t));if(!i){console.warn("[mutationHelpers] Budget not in cache, skipping local recalculation");return}const o=i.budget.month_map,l=gt(e,n),d=[];for(const[h]of Object.entries(o))if(h>=l){const m=parseInt(h.substring(0,4),10),p=parseInt(h.substring(4,6),10);d.push({year:m,month:p})}d.sort((h,m)=>h.year!==m.year?h.year-m.year:h.month-m.month);for(const{year:h,month:m}of d)try{await a3(t,h,m,Le),r&&r({type:"month",budgetId:t,year:h,month:m})}catch(p){console.warn(`[mutationHelpers] Failed to recalculate month ${h}/${m} locally:`,p)}}function _r(){const{trackChange:t}=mc();return{updateMonthCacheAndTrack:(r,i,o,l)=>{Le.setQueryData(Ie.month(r,i,o),{month:l}),t({type:"month",budgetId:r,year:i,month:o})},recalculateMonthAndCascade:async(r,i,o)=>{const l=Ie.month(r,i,o),d=Le.getQueryData(l);if(d?.month){const h=_m(d.month);Le.setQueryData(l,{month:h})}await EP(r,i,o,t);try{KT(r),t({type:"budget",budgetId:r})}catch(h){console.warn("[mutationHelpers] Failed to recalculate budget account balances from cache:",h),t({type:"budget",budgetId:r})}},trackChange:t}}function TP(){const{currentViewingDocument:t}=Ye(),{saveCurrentDocument:e}=Sn(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=_r();return{finalizeAllocations:async o=>{const{budgetId:l,year:d,month:h,allocations:m,onProgress:p}=o;p?.({phase:"saving",message:"Saving allocations..."});const g=await Wr(l,d,h);if(!g)throw new Error(`Month not found: ${d}/${h}`);const v=g.category_balances?.map(E=>E.category_id)??[],b=v.length>0?v:Object.keys(m),C=b.length>0?x4(g,b,m):g.category_balances,x={...g,category_balances:C,are_allocations_finalized:!0,updated_at:new Date().toISOString()};n(l,d,h,x),p?.({phase:"recalculating",message:"Recalculating month balances..."});try{await r(l,d,h)}catch(E){console.warn("[useFinalizeAllocations] Failed to recalculate month and cascade:",E)}if(t.type==="month"&&t.year===d&&t.month===h)try{await e(l,"month",d,h)}catch(E){console.warn("[useFinalizeAllocations] Failed to save current document immediately:",E)}return p?.({phase:"complete",message:"Allocations applied!"}),{updatedMonth:x}},isPending:!1,isError:!1,error:null}}function YT(){const{currentViewingDocument:t}=Ye(),{saveCurrentDocument:e}=Sn(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=_r();return{deleteAllocations:async o=>{const{budgetId:l,year:d,month:h,onProgress:m}=o;m?.({phase:"saving",message:"Deleting allocations..."});const p=await Wr(l,d,h);if(!p)throw new Error(`Month not found: ${d}/${h}`);const g=p.category_balances.map(C=>({...C,allocated:0,end_balance:C.start_balance-C.spent})),v={...p,category_balances:g,are_allocations_finalized:!1,updated_at:new Date().toISOString()};n(l,d,h,v),m?.({phase:"recalculating",message:"Recalculating month balances..."});try{await r(l,d,h)}catch(C){console.warn("[useDeleteAllocations] Failed to recalculate month and cascade:",C)}if(t.type==="month"&&t.year===d&&t.month===h)try{await e(l,"month",d,h)}catch(C){console.warn("[useDeleteAllocations] Failed to save current document immediately:",C)}return m?.({phase:"complete",message:"Allocations deleted!"}),{updatedMonth:v}},isPending:!1,isError:!1,error:null}}async function wm(t,e,n){const r=e.trim();if(!r||n.includes(r))return null;const i=[...n,r].sort((o,l)=>o.toLowerCase().localeCompare(l.toLowerCase()));return await Hn("payees",t,{budget_id:t,payees:i,updated_at:new Date().toISOString()},`adding new payee "${r}" to autocomplete list`),i}function AP(t,e){const n={id:e,amount:t.amount,account_id:t.accountId,date:t.date,created_at:new Date().toISOString()};return t.payee?.trim()&&(n.payee=t.payee.trim()),t.description&&(n.description=t.description),n}function jP(){const t=$t(),{currentViewingDocument:e}=Ye(),{saveCurrentDocument:n}=Sn(),{updateMonthCacheAndTrack:r,recalculateMonthAndCascade:i,trackChange:o}=_r(),l=Gn({onMutate:async h=>{const{budgetId:m,year:p,month:g}=h,v=Ie.month(m,p,g);await t.cancelQueries({queryKey:v});const b=t.getQueryData(v),C=`income_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,x=AP(h,C);if(b?.month){const E={...b.month,income:[...b.month.income||[],x],updated_at:new Date().toISOString()};r(m,p,g,E)}try{await i(m,p,g)}catch(E){console.warn("[useAddIncome] Failed to recalculate month and cascade:",E)}if(h.payee?.trim()){const E=t.getQueryData(Ie.payees(m))||[],T=await wm(m,h.payee,E);T&&(t.setQueryData(Ie.payees(m),T),o({type:"payees",budgetId:m}))}if(e.type==="month"&&e.year===p&&e.month===g)try{await n(m,"month",p,g)}catch(E){console.warn("[useAddIncome] Failed to save current document immediately:",E)}return{previousData:b,incomeId:C,newIncome:x}},mutationFn:async h=>{const{budgetId:m,year:p,month:g}=h,v=Ie.month(m,p,g),b=t.getQueryData(v);if(!b?.month)throw new Error("No month data in cache after optimistic update");const C=b.month,x=C.income?.[C.income.length-1];if(!x)throw new Error("Could not find new income in updated month");return{updatedMonth:C,newIncome:x}},onError:(h,m,p)=>{if(p?.previousData){const{budgetId:g,year:v,month:b}=m;t.setQueryData(Ie.month(g,v,b),p.previousData)}}});return{addIncome:async(h,m,p,g,v,b,C,x)=>l.mutateAsync({budgetId:h,year:m,month:p,amount:g,accountId:v,date:b,payee:C,description:x}),isPending:l.isPending,isError:l.isError,error:l.error}}function RP(t,e,n,r,i,o){if(!t)return!0;const l=t.payee||void 0,d=i?.trim()||void 0,h=t.description||void 0,m=o||void 0;return e!==t.amount||n!==t.account_id||r!==t.date||d!==l||m!==h}function IP(){const t=$t(),{currentViewingDocument:e}=Ye(),{saveCurrentDocument:n}=Sn(),{updateMonthCacheAndTrack:r,recalculateMonthAndCascade:i,trackChange:o}=_r();return{updateIncome:async(d,h,m,p,g,v,b,C,x)=>{const S=await Wr(d,h,m);if(!S)throw new Error(`Month not found: ${h}/${m}`);const E=(S.income||[]).find($=>$.id===p);if(!RP(E,g,v,b,C,x))return{updatedMonth:S,noOp:!0};const T={id:p,amount:g,account_id:v,date:b,created_at:(S.income||[]).find($=>$.id===p)?.created_at||new Date().toISOString()};C?.trim()&&(T.payee=C.trim()),x&&(T.description=x);const I=(S.income||[]).map($=>$.id===p?T:$),D={...S,income:I,updated_at:new Date().toISOString()};r(d,h,m,D);try{await i(d,h,m)}catch($){console.warn("[useUpdateIncome] Failed to recalculate month and cascade:",$)}if(C?.trim()){const $=t.getQueryData(Ie.payees(d))||[],k=await wm(d,C,$);k&&(t.setQueryData(Ie.payees(d),k),o({type:"payees",budgetId:d}))}if(e.type==="month"&&e.year===h&&e.month===m)try{await n(d,"month",h,m)}catch($){console.warn("[useUpdateIncome] Failed to save current document immediately:",$)}return{updatedMonth:D}},isPending:!1,isError:!1,error:null}}function kP(){const{currentViewingDocument:t}=Ye(),{saveCurrentDocument:e}=Sn(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=_r();return{deleteIncome:async(o,l,d,h)=>{const m=await Wr(o,l,d);if(!m)throw new Error(`Month not found: ${l}/${d}`);const p=(m.income||[]).filter(b=>b.id!==h),g={...m,income:p,updated_at:new Date().toISOString()};n(o,l,d,g);try{await r(o,l,d)}catch(b){console.warn("[useDeleteIncome] Failed to recalculate month and cascade:",b)}if(t.type==="month"&&t.year===l&&t.month===d)try{await e(o,"month",l,d)}catch(b){console.warn("[useDeleteIncome] Failed to save current document immediately:",b)}return{updatedMonth:g}},isPending:!1,isError:!1,error:null}}function DP(t,e){const n={id:e,amount:t.amount,category_id:t.categoryId,account_id:t.accountId,date:t.date,created_at:new Date().toISOString()};return t.payee?.trim()&&(n.payee=t.payee.trim()),t.description&&(n.description=t.description),t.cleared!==void 0&&(n.cleared=t.cleared),n}function MP(){const t=$t(),{currentViewingDocument:e}=Ye(),{saveCurrentDocument:n}=Sn(),{updateMonthCacheAndTrack:r,recalculateMonthAndCascade:i,trackChange:o}=_r(),l=Gn({onMutate:async h=>{const{budgetId:m,year:p,month:g}=h,v=Ie.month(m,p,g);await t.cancelQueries({queryKey:v});const b=t.getQueryData(v),C=`expense_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,x=DP(h,C);if(b?.month){const E={...b.month,expenses:[...b.month.expenses||[],x],updated_at:new Date().toISOString()};r(m,p,g,E)}try{await i(m,p,g)}catch(E){console.warn("[useAddExpense] Failed to recalculate month and cascade:",E)}if(h.payee?.trim()){const E=t.getQueryData(Ie.payees(m))||[],T=await wm(m,h.payee,E);T&&(t.setQueryData(Ie.payees(m),T),o({type:"payees",budgetId:m}))}if(e.type==="month"&&e.year===p&&e.month===g)try{await n(m,"month",p,g)}catch(E){console.warn("[useAddExpense] Failed to save current document immediately:",E)}return{previousData:b,expenseId:C,newExpense:x}},mutationFn:async h=>{const{budgetId:m,year:p,month:g}=h,v=Ie.month(m,p,g),b=t.getQueryData(v);if(!b?.month)throw new Error("No month data in cache after optimistic update");const C=b.month,x=C.expenses?.[C.expenses.length-1];if(!x)throw new Error("Could not find new expense in updated month");return{updatedMonth:C,newExpense:x}},onError:(h,m,p)=>{if(p?.previousData){const{budgetId:g,year:v,month:b}=m;t.setQueryData(Ie.month(g,v,b),p.previousData)}}});return{addExpense:async(h,m,p,g,v,b,C,x,S,E)=>l.mutateAsync({budgetId:h,year:m,month:p,amount:g,categoryId:v,accountId:b,date:C,payee:x,description:S,cleared:E}),isPending:l.isPending,isError:l.isError,error:l.error}}function OP(t,e,n,r,i,o,l,d){if(!t)return!0;const h=t.payee||void 0,m=o?.trim()||void 0,p=t.description||void 0,g=l||void 0;return e!==t.amount||n!==t.category_id||r!==t.account_id||i!==t.date||m!==h||g!==p||d!==t.cleared}function NP(){const t=$t(),{currentViewingDocument:e}=Ye(),{saveCurrentDocument:n}=Sn(),{updateMonthCacheAndTrack:r,recalculateMonthAndCascade:i}=_r();return{updateExpense:async(l,d,h,m,p,g,v,b,C,x,S)=>{const E=await Wr(l,d,h);if(!E)throw new Error(`Month not found: ${d}/${h}`);const T=(E.expenses||[]).find(k=>k.id===m);if(!OP(T,p,g,v,b,C,x,S))return{updatedMonth:E,noOp:!0};const I={id:m,amount:p,category_id:g,account_id:v,date:b,created_at:E.expenses?.find(k=>k.id===m)?.created_at||new Date().toISOString()};C?.trim()&&(I.payee=C.trim()),x&&(I.description=x),S!==void 0&&(I.cleared=S);const D=(E.expenses||[]).map(k=>k.id===m?I:k),B={...E,expenses:D,updated_at:new Date().toISOString()};r(l,d,h,B);try{await i(l,d,h)}catch(k){console.warn("[useUpdateExpense] Failed to recalculate month and cascade:",k)}if(C?.trim()){const k=t.getQueryData(Ie.payees(l))||[],j=await wm(l,C,k);j&&t.setQueryData(Ie.payees(l),j)}if(e.type==="month"&&e.year===d&&e.month===h)try{await n(l,"month",d,h)}catch(k){console.warn("[useUpdateExpense] Failed to save current document immediately:",k)}return{updatedMonth:B}},isPending:!1,isError:!1,error:null}}function PP(){const{currentViewingDocument:t}=Ye(),{saveCurrentDocument:e}=Sn(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=_r();return{deleteExpense:async(o,l,d,h)=>{const m=await Wr(o,l,d);if(!m)throw new Error(`Month not found: ${l}/${d}`);const p=(m.expenses||[]).filter(b=>b.id!==h),g={...m,expenses:p,updated_at:new Date().toISOString()};n(o,l,d,g);try{await r(o,l,d)}catch(b){console.warn("[useDeleteExpense] Failed to recalculate month and cascade:",b)}if(t.type==="month"&&t.year===l&&t.month===d)try{await e(o,"month",l,d)}catch(b){console.warn("[useDeleteExpense] Failed to save current document immediately:",b)}return{updatedMonth:g}},isPending:!1,isError:!1,error:null}}function zP(t,e){const n={id:e,amount:t.amount,from_account_id:t.fromAccountId,to_account_id:t.toAccountId,from_category_id:t.fromCategoryId,to_category_id:t.toCategoryId,date:t.date,created_at:new Date().toISOString()};return t.description&&(n.description=t.description),t.cleared!==void 0&&(n.cleared=t.cleared),n}function BP(){const t=$t(),{currentViewingDocument:e}=Ye(),{saveCurrentDocument:n}=Sn(),{updateMonthCacheAndTrack:r,recalculateMonthAndCascade:i}=_r(),o=Gn({onMutate:async d=>{const{budgetId:h,year:m,month:p}=d,g=Ie.month(h,m,p);await t.cancelQueries({queryKey:g});const v=t.getQueryData(g),b=`transfer_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,C=zP(d,b);if(v?.month){const S={...v.month,transfers:[...v.month.transfers||[],C],updated_at:new Date().toISOString()};r(h,m,p,S)}try{await i(h,m,p)}catch(S){console.warn("[useAddTransfer] Failed to recalculate month and cascade:",S)}if(e.type==="month"&&e.year===m&&e.month===p)try{await n(h,"month",m,p)}catch(S){console.warn("[useAddTransfer] Failed to save current document immediately:",S)}return{previousData:v,transferId:b,newTransfer:C}},mutationFn:async d=>{const{budgetId:h,year:m,month:p}=d,g=Ie.month(h,m,p),v=t.getQueryData(g);if(!v?.month)throw new Error("No month data in cache after optimistic update");const b=v.month,C=b.transfers?.[b.transfers.length-1];if(!C)throw new Error("Could not find new transfer in updated month");return{updatedMonth:b,newTransfer:C}},onError:(d,h,m)=>{if(m?.previousData){const{budgetId:p,year:g,month:v}=h;t.setQueryData(Ie.month(p,g,v),m.previousData)}}});return{addTransfer:async(d,h,m,p,g,v,b,C,x,S,E)=>o.mutateAsync({budgetId:d,year:h,month:m,amount:p,fromAccountId:g,toAccountId:v,fromCategoryId:b,toCategoryId:C,date:x,description:S,cleared:E}),isPending:o.isPending,isError:o.isError,error:o.error}}function LP(t,e,n,r,i,o,l,d,h){if(!t)return!0;const m=t.description||void 0,p=d||void 0;return e!==t.amount||n!==t.from_account_id||r!==t.to_account_id||i!==t.from_category_id||o!==t.to_category_id||l!==t.date||p!==m||h!==t.cleared}function UP(){const{currentViewingDocument:t}=Ye(),{saveCurrentDocument:e}=Sn(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=_r();return{updateTransfer:async(o,l,d,h,m,p,g,v,b,C,x,S)=>{const E=await Wr(o,l,d);if(!E)throw new Error(`Month not found: ${l}/${d}`);const T=(E.transfers||[]).find(k=>k.id===h);if(!LP(T,m,p,g,v,b,C,x,S))return{updatedMonth:E,noOp:!0};const I={id:h,amount:m,from_account_id:p,to_account_id:g,from_category_id:v,to_category_id:b,date:C,created_at:E.transfers?.find(k=>k.id===h)?.created_at||new Date().toISOString()};x&&(I.description=x),S!==void 0&&(I.cleared=S);const D=(E.transfers||[]).map(k=>k.id===h?I:k),B={...E,transfers:D,updated_at:new Date().toISOString()};n(o,l,d,B);try{await r(o,l,d)}catch(k){console.warn("[useUpdateTransfer] Failed to recalculate month and cascade:",k)}if(t.type==="month"&&t.year===l&&t.month===d)try{await e(o,"month",l,d)}catch(k){console.warn("[useUpdateTransfer] Failed to save current document immediately:",k)}return{updatedMonth:B}},isPending:!1,isError:!1,error:null}}function FP(){const{currentViewingDocument:t}=Ye(),{saveCurrentDocument:e}=Sn(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=_r();return{deleteTransfer:async(o,l,d,h)=>{const m=await Wr(o,l,d);if(!m)throw new Error(`Month not found: ${l}/${d}`);const p=(m.transfers||[]).filter(b=>b.id!==h),g={...m,transfers:p,updated_at:new Date().toISOString()};n(o,l,d,g);try{await r(o,l,d)}catch(b){console.warn("[useDeleteTransfer] Failed to recalculate month and cascade:",b)}if(t.type==="month"&&t.year===l&&t.month===d)try{await e(o,"month",l,d)}catch(b){console.warn("[useDeleteTransfer] Failed to save current document immediately:",b)}return{updatedMonth:g}},isPending:!1,isError:!1,error:null}}function VP(t,e){const n={id:e,amount:t.amount,account_id:t.accountId,category_id:t.categoryId,date:t.date,created_at:new Date().toISOString()};return t.payee?.trim()&&(n.payee=t.payee.trim()),t.description&&(n.description=t.description),t.cleared!==void 0&&(n.cleared=t.cleared),n}function $P(){const t=$t(),{currentViewingDocument:e}=Ye(),{saveCurrentDocument:n}=Sn(),{updateMonthCacheAndTrack:r,recalculateMonthAndCascade:i}=_r(),o=Gn({onMutate:async d=>{const{budgetId:h,year:m,month:p}=d,g=Ie.month(h,m,p);await t.cancelQueries({queryKey:g});const v=t.getQueryData(g),b=`adjustment_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,C=VP(d,b);if(v?.month){const S={...v.month,adjustments:[...v.month.adjustments||[],C],updated_at:new Date().toISOString()};r(h,m,p,S)}try{await i(h,m,p)}catch(S){console.warn("[useAddAdjustment] Failed to recalculate month and cascade:",S)}if(e.type==="month"&&e.year===m&&e.month===p)try{await n(h,"month",m,p)}catch(S){console.warn("[useAddAdjustment] Failed to save current document immediately:",S)}return{previousData:v,adjustmentId:b,newAdjustment:C}},mutationFn:async d=>{const{budgetId:h,year:m,month:p}=d,g=Ie.month(h,m,p),v=t.getQueryData(g);if(!v?.month)throw new Error("No month data in cache after optimistic update");const b=v.month,C=b.adjustments?.[b.adjustments.length-1];if(!C)throw new Error("Could not find new adjustment in updated month");return{updatedMonth:b,newAdjustment:C}},onError:(d,h,m)=>{if(m?.previousData){const{budgetId:p,year:g,month:v}=h;t.setQueryData(Ie.month(p,g,v),m.previousData)}}});return{addAdjustment:async(d,h,m,p,g,v,b,C,x,S)=>o.mutateAsync({budgetId:d,year:h,month:m,amount:p,accountId:g,categoryId:v,date:b,payee:C,description:x,cleared:S}),isPending:o.isPending,isError:o.isError,error:o.error}}function qP(t,e,n,r,i,o,l,d){if(!t)return!0;const h=t.payee||void 0,m=o?.trim()||void 0,p=t.description||void 0,g=l||void 0;return e!==t.amount||n!==t.account_id||r!==t.category_id||i!==t.date||m!==h||g!==p||d!==t.cleared}function HP(){const{currentViewingDocument:t}=Ye(),{saveCurrentDocument:e}=Sn(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=_r();return{updateAdjustment:async(o,l,d,h,m,p,g,v,b,C,x)=>{const S=await Wr(o,l,d);if(!S)throw new Error(`Month not found: ${l}/${d}`);const E=(S.adjustments||[]).find($=>$.id===h);if(!qP(E,m,p,g,v,b,C,x))return{updatedMonth:S,noOp:!0};const T={id:h,amount:m,account_id:p,category_id:g,date:v,created_at:S.adjustments?.find($=>$.id===h)?.created_at||new Date().toISOString()};b?.trim()&&(T.payee=b.trim()),C&&(T.description=C),x!==void 0&&(T.cleared=x);const I=(S.adjustments||[]).map($=>$.id===h?T:$),D={...S,adjustments:I,updated_at:new Date().toISOString()};n(o,l,d,D);try{await r(o,l,d)}catch($){console.warn("[useUpdateAdjustment] Failed to recalculate month and cascade:",$)}if(t.type==="month"&&t.year===l&&t.month===d)try{await e(o,"month",l,d)}catch($){console.warn("[useUpdateAdjustment] Failed to save current document immediately:",$)}return{updatedMonth:D}},isPending:!1,isError:!1,error:null}}function GP(){const{currentViewingDocument:t}=Ye(),{saveCurrentDocument:e}=Sn(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=_r();return{deleteAdjustment:async(o,l,d,h)=>{const m=await Wr(o,l,d);if(!m)throw new Error(`Month not found: ${l}/${d}`);const p=(m.adjustments||[]).filter(b=>b.id!==h),g={...m,adjustments:p,updated_at:new Date().toISOString()};n(o,l,d,g);try{await r(o,l,d)}catch(b){console.warn("[useDeleteAdjustment] Failed to recalculate month and cascade:",b)}if(t.type==="month"&&t.year===l&&t.month===d)try{await e(o,"month",l,d)}catch(b){console.warn("[useDeleteAdjustment] Failed to save current document immediately:",b)}return{updatedMonth:g}},isPending:!1,isError:!1,error:null}}const QP={currentUserId:null,selectedBudgetId:null,currentYear:new Date().getFullYear(),currentMonthNumber:new Date().getMonth()+1,lastActiveTab:"categories",lastSettingsTab:"categories",lastAdminTab:"budget",currentViewingDocument:{type:null},setCurrentViewingDocument:()=>{},setSelectedBudgetId:()=>{},setCurrentYear:()=>{},setCurrentMonthNumber:()=>{},setLastActiveTab:()=>{},setLastSettingsTab:()=>{},setLastAdminTab:()=>{},pageTitle:"Budget",setPageTitle:()=>{},isInitialized:!1,needsFirstBudget:!1,initialDataLoadComplete:!1,goToPreviousMonth:()=>{},goToNextMonth:()=>{},pendingInvites:[],hasPendingInvites:!1,accessibleBudgets:[],isAdmin:!1,isTest:!1,loadAccessibleBudgets:async()=>{},switchToBudget:()=>{},checkBudgetInvite:async()=>null,clearCache:()=>{}},XT=M.createContext(QP);function WP({children:t}){const n=Na().get_current_firebase_user(),[r,i]=M.useState(null),[o,l]=M.useState(new Date().getFullYear()),[d,h]=M.useState(new Date().getMonth()+1),[m,p]=M.useState("categories"),[g,v]=M.useState("categories"),[b,C]=M.useState("budget"),[x,S]=M.useState("Budget"),E=M.useCallback(ue=>{S(ve=>ve===ue?ve:ue)},[]),[T,I]=M.useState({type:null}),[D,B]=M.useState(!1),[$,k]=M.useState(!1),j=X6(n?.uid||null,n?.email||null),N=j.data&&j.data.budget_ids.length===0,F=J6(n?.uid||null,j.data||null,{enabled:!!n?.uid&&!!j.data&&N}),q=i3(r,{enabled:!!r&&D}),[A,P]=M.useState(!1);M.useEffect(()=>{if(!q.data){P(!1);return}const{budget:ue,payees:ve,months:ce}=q.data,be=Date.now();Le.setQueryData(Ie.budget(r),ue,{updatedAt:be}),Le.setQueryData(Ie.payees(r),ve,{updatedAt:be});for(const ze of ce)Le.setQueryData(Ie.month(r,ze.year,ze.month),{month:ze},{updatedAt:be});P(!0)},[q.data,r]),M.useEffect(()=>{r||P(!1)},[r]);const O=j.data?.permission_flags?.is_admin===!0,X=j.data?.permission_flags?.is_test===!0,W=F.data?.pendingInvites||[],H=F.data?.budgets||[],Z=W.length>0;M.useEffect(()=>{if(!n||D||j.isLoading)return;const ue=j.data;if(!(!ue&&!j.isError))if(ue&&ue.budget_ids.length>0)i(ue.budget_ids[0]),k(!1),B(!0);else{if(F.isLoading)return;const ve=F.data;k(!(ve?.pendingInvites&&ve.pendingInvites.length>0)),B(!0)}},[n,D,j.data,j.isLoading,j.isError,F.data,F.isLoading]);const Y=M.useCallback(()=>{d===1?(l(ue=>ue-1),h(12)):h(ue=>ue-1)},[d]),se=M.useCallback(()=>{d===12?(l(ue=>ue+1),h(1)):h(ue=>ue+1)},[d]),L=M.useCallback(async ue=>{(ue?.force||!F.data)&&await F.refetch()},[F]),G=M.useCallback(ue=>{i(ue),k(!1)},[]),ne=M.useCallback(async ue=>{if(!n)return null;try{const ve=await y4(ue,n.uid);return ve&&ve.isInvited&&!ve.hasAccepted?{budgetId:ue,budgetName:ve.budgetName,ownerEmail:ve.ownerEmail}:null}catch(ve){return console.error("[BudgetContext] Error checking budget invite:",ve),null}},[n]),ie=M.useCallback(()=>{Le.clear()},[]),te={currentUserId:n?.uid||null,selectedBudgetId:r,currentYear:o,currentMonthNumber:d,lastActiveTab:m,lastSettingsTab:g,lastAdminTab:b,currentViewingDocument:T,setCurrentViewingDocument:I,setSelectedBudgetId:i,setCurrentYear:l,setCurrentMonthNumber:h,setLastActiveTab:p,setLastSettingsTab:v,setLastAdminTab:C,pageTitle:x,setPageTitle:E,isInitialized:D,needsFirstBudget:$,initialDataLoadComplete:A,goToPreviousMonth:Y,goToNextMonth:se,pendingInvites:W,hasPendingInvites:Z,accessibleBudgets:H,isAdmin:O,isTest:X,loadAccessibleBudgets:L,switchToBudget:G,checkBudgetInvite:ne,clearCache:ie};return u.jsx(XT.Provider,{value:te,children:t})}function Ye(){const t=M.useContext(XT);if(!t)throw new Error("useBudget must be used within a BudgetProvider");return t}const KP=function(){},YP={is_logged_in:!1,is_auth_checked:!1,username:"",set_user_context:KP},ud=M.createContext(YP);function L1({budget:t,isCurrent:e,isAccepting:n,isSwitching:r,isEditing:i,editName:o,isRenaming:l,onAccept:d,onSwitch:h,onStartEdit:m,onCancelEdit:p,onEditNameChange:g,onSaveEdit:v}){const b=e&&t.isOwner;return u.jsx("div",{style:{background:e?"color-mix(in srgb, #646cff 15%, transparent)":"color-mix(in srgb, currentColor 8%, transparent)",border:e?"2px solid color-mix(in srgb, #646cff 50%, transparent)":"1px solid transparent",padding:"1rem",borderRadius:"8px"},children:i?u.jsxs("form",{onSubmit:v,children:[u.jsx("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"0.5rem"},children:u.jsx("input",{type:"text",value:o,onChange:C=>g(C.target.value),placeholder:"Budget name",autoFocus:!0,style:{flex:1,padding:"0.5rem 0.75rem",borderRadius:"6px",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"1rem",fontWeight:600,color:"inherit"}})}),u.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[u.jsx("button",{type:"submit",disabled:l||!o.trim(),style:{background:"#22c55e",color:"white",border:"none",padding:"0.4rem 0.75rem",borderRadius:"6px",cursor:l||!o.trim()?"not-allowed":"pointer",fontWeight:500,opacity:l||!o.trim()?.7:1,fontSize:"0.8rem"},children:l?"Saving...":"Save"}),u.jsx("button",{type:"button",onClick:p,disabled:l,style:{background:"transparent",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)",padding:"0.4rem 0.75rem",borderRadius:"6px",cursor:l?"not-allowed":"pointer",fontWeight:500,opacity:l?.7:.8,fontSize:"0.8rem"},children:"Cancel"})]})]}):u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem",flexWrap:"wrap"},children:[u.jsxs("div",{style:{flex:1,minWidth:"200px"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flexWrap:"wrap",marginBottom:"0.25rem"},children:[u.jsx("span",{style:{fontWeight:600},children:t.name}),t.isOwner&&u.jsx("span",{style:{background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.65rem",textTransform:"uppercase",fontWeight:600},children:"Owner"}),e&&u.jsx("span",{style:{background:"color-mix(in srgb, #22c55e 20%, transparent)",color:"#4ade80",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.65rem",textTransform:"uppercase",fontWeight:600},children:"Active"}),t.isPending&&u.jsx("span",{style:{background:"color-mix(in srgb, #f59e0b 20%, transparent)",color:"#fbbf24",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.65rem",textTransform:"uppercase",fontWeight:600},children:"Pending"}),b&&u.jsx("button",{onClick:m,style:{background:"transparent",border:"none",padding:"0.15rem",cursor:"pointer",opacity:.5,fontSize:"0.8rem",lineHeight:1},title:"Rename budget",children:""})]}),u.jsx("p",{style:{margin:0,fontSize:"0.8rem",opacity:.6},children:t.ownerEmail?`Owner: ${t.ownerEmail}`:`ID: ${t.id}`})]}),u.jsx("div",{style:{display:"flex",gap:"0.5rem"},children:t.isPending?u.jsx("button",{onClick:d,disabled:n,style:{background:"#22c55e",color:"white",border:"none",padding:"0.5rem 1rem",borderRadius:"6px",cursor:n?"not-allowed":"pointer",fontWeight:500,opacity:n?.7:1,fontSize:"0.85rem"},children:n?"Accepting...":"Accept"}):e?null:u.jsx("button",{onClick:h,disabled:r,style:{background:"#646cff",color:"white",border:"none",padding:"0.5rem 1rem",borderRadius:"6px",cursor:r?"not-allowed":"pointer",fontWeight:500,opacity:r?.7:1,fontSize:"0.85rem"},children:r?"Switching...":"Switch"})})]})})}const Mf={critical_bug:{label:"Critical Bug",color:"#ff4757",bgColor:"rgba(255, 71, 87, 0.15)"},bug:{label:"Bug",color:"#ffa502",bgColor:"rgba(255, 165, 2, 0.15)"},new_feature:{label:"New Feature",color:"#2ed573",bgColor:"rgba(46, 213, 115, 0.15)"},core_feature:{label:"Core Feature",color:"#1e90ff",bgColor:"rgba(30, 144, 255, 0.15)"},qol:{label:"QOL",color:"#a55eea",bgColor:"rgba(165, 94, 234, 0.15)"}};function ZT({type:t,onClick:e}){const n=t==="feature"?"new_feature":t,r=n&&n in Mf?n:"bug",i=Mf[r];return u.jsx("button",{type:"button",onClick:e,style:{padding:"0.25rem 0.5rem",borderRadius:"0.25rem",background:i.bgColor,color:i.color,fontSize:"0.7rem",fontWeight:600,textTransform:"uppercase",letterSpacing:"0.025em",flexShrink:0,border:"none",cursor:"pointer",transition:"opacity 0.15s, transform 0.15s"},onMouseEnter:o=>{o.currentTarget.style.opacity="0.8",o.currentTarget.style.transform="scale(1.05)"},onMouseLeave:o=>{o.currentTarget.style.opacity="1",o.currentTarget.style.transform="scale(1)"},title:"Click to change type",children:i.label})}function XP({item:t,isDragging:e,isDragOver:n,onDragStart:r,onDragOver:i,onDragLeave:o,onDragEnd:l,onDrop:d,onToggleDone:h,onTypeClick:m}){return u.jsxs("div",{onDragOver:p=>{p.stopPropagation(),i(p)},onDragLeave:p=>{p.stopPropagation(),o()},onDrop:p=>{p.stopPropagation(),d(p)},style:{position:"relative"},children:[u.jsx("div",{style:{...M4,opacity:n?1:0,boxShadow:n?"0 0 8px rgba(100, 108, 255, 0.6)":"none"}}),u.jsxs("div",{draggable:!0,onDragStart:r,onDragEnd:l,style:{...V0,cursor:"grab",opacity:e?.5:1,flexDirection:"column",alignItems:"stretch",gap:"0.5rem"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[u.jsx("span",{style:{...D4},children:""}),u.jsx("input",{type:"checkbox",checked:t.is_done,onChange:h,style:{width:"1.25rem",height:"1.25rem",cursor:"pointer",accentColor:me.primary,flexShrink:0}}),u.jsx(ZT,{type:t.feedback_type,onClick:m})]}),u.jsxs("div",{style:{marginLeft:"3.25rem"},children:[u.jsx("p",{style:{margin:0,lineHeight:1.5},children:t.text}),u.jsxs("p",{style:{margin:"0.5rem 0 0 0",fontSize:"0.8rem",opacity:.6},children:[t.user_email,"  ",ky(t.created_at)]})]})]})]})}function ZP({item:t,onToggleDone:e,onTypeClick:n}){return u.jsxs("div",{style:{...V0,opacity:.6,flexDirection:"column",alignItems:"stretch",gap:"0.5rem"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[u.jsx("input",{type:"checkbox",checked:t.is_done,onChange:e,style:{width:"1.25rem",height:"1.25rem",cursor:"pointer",accentColor:me.primary,flexShrink:0}}),u.jsx(ZT,{type:t.feedback_type,onClick:n})]}),u.jsxs("div",{style:{marginLeft:"2rem"},children:[u.jsx("p",{style:{margin:0,lineHeight:1.5,textDecoration:"line-through"},children:t.text}),u.jsxs("p",{style:{margin:"0.5rem 0 0 0",fontSize:"0.8rem",opacity:.8},children:[t.user_email,"  Created: ",ky(t.created_at)]}),t.completed_at&&u.jsxs("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.8rem",color:me.success},children:[" Completed: ",ky(t.completed_at)]})]})]})}function $n({noMargin:t}={}){return u.jsx("span",{style:{display:"inline-block",width:"14px",height:"14px",border:"2px solid rgba(255, 255, 255, 0.3)",borderTopColor:"white",borderRadius:"50%",animation:"spin 0.8s linear infinite",marginRight:t?0:"0.5rem",verticalAlign:"middle"}})}function JT(){const{state:t,closeModal:e}=m3();if(!t.isOpen)return null;const n=t.isComplete;return u.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0, 0, 0, 0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1002,padding:"1rem"},onClick:n?e:void 0,children:u.jsxs("div",{style:{background:"#1a1a1a",color:"rgba(255, 255, 255, 0.87)",borderRadius:"16px",padding:"2rem",width:"32rem",maxWidth:"calc(100vw - 2rem)",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.5)"},onClick:r=>r.stopPropagation(),children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1.5rem"},children:[u.jsxs("h2",{style:{margin:0,fontSize:"1.25rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[!t.isComplete&&u.jsx($n,{noMargin:!0}),t.migrationName]}),n&&u.jsx("button",{onClick:e,style:{background:"transparent",border:"none",color:"inherit",cursor:"pointer",fontSize:"1.5rem",opacity:.6,lineHeight:1,padding:"0.25rem"},title:"Close",children:""})]}),u.jsxs("div",{style:{fontSize:"1rem",fontWeight:500,marginBottom:"1rem",color:t.error?"#ef4444":t.isComplete?"#22c55e":"inherit"},children:[t.error?" ":t.isComplete?" ":"",t.stage]}),u.jsx("div",{style:{background:"rgba(255, 255, 255, 0.1)",borderRadius:"8px",height:"12px",overflow:"hidden",marginBottom:"1rem"},children:t.progress!==null?u.jsx("div",{style:{background:t.error?"#ef4444":t.isComplete?"#22c55e":"#646cff",height:"100%",width:`${t.progress}%`,transition:"width 0.3s ease-out",borderRadius:"8px"}}):u.jsx("div",{style:{background:t.error?"#ef4444":"#646cff",height:"100%",width:"30%",borderRadius:"8px",animation:"progressIndeterminate 1.5s ease-in-out infinite"}})}),t.currentItem&&u.jsx("div",{style:{fontSize:"0.9rem",opacity:.8,marginBottom:"0.5rem",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:t.currentItem}),t.details&&u.jsx("div",{style:{fontSize:"0.85rem",opacity:.6,marginBottom:t.error?"1rem":0},children:t.details}),t.error&&u.jsx("div",{style:{background:"rgba(239, 68, 68, 0.1)",border:"1px solid rgba(239, 68, 68, 0.3)",borderRadius:"8px",padding:"0.75rem 1rem",fontSize:"0.9rem",color:"#ef4444"},children:t.error}),t.isComplete&&u.jsx("button",{onClick:e,style:{marginTop:"1.5rem",width:"100%",background:t.error?"rgba(239, 68, 68, 0.2)":"#646cff",color:"white",border:"none",padding:"0.75rem 1.5rem",borderRadius:"8px",cursor:"pointer",fontWeight:500,fontSize:"1rem"},children:t.error?"Close":"Done"}),!t.isComplete&&u.jsx("div",{style:{marginTop:"1rem",fontSize:"0.85rem",opacity:.5,textAlign:"center"},children:"Please wait  do not close this window"}),u.jsx("style",{children:`
            @keyframes progressIndeterminate {
              0% { transform: translateX(-100%); }
              100% { transform: translateX(400%); }
            }
          `})]})})}function So({isOpen:t,onClose:e,onConfirm:n,migrationName:r,isDestructive:i=!1,onDownloadBackup:o,isDownloading:l=!1}){const[d,h]=M.useState(!1),m=M.useCallback(async()=>{o&&(await o(),h(!0))},[o]),p=M.useCallback(()=>{n(d?"downloaded":"already-have")},[d,n]),g=M.useCallback(()=>{n("cancelled"),e()},[n,e]);return u.jsxs(us,{isOpen:t,onClose:g,title:" Backup Recommended",children:[u.jsx("div",{style:{background:i?"color-mix(in srgb, #ef4444 15%, transparent)":"color-mix(in srgb, #f59e0b 15%, transparent)",border:`1px solid ${i?"color-mix(in srgb, #ef4444 40%, transparent)":"color-mix(in srgb, #f59e0b 40%, transparent)"}`,borderRadius:"8px",padding:"1rem",marginBottom:"1rem"},children:u.jsx("p",{style:{margin:0,color:i?"#fca5a5":"#fcd34d",fontWeight:500,fontSize:"0.95rem"},children:i?" This migration modifies your data. A backup is strongly recommended!":" Before running migrations, we recommend having a recent backup."})}),u.jsxs("p",{style:{margin:"0 0 0.75rem",opacity:.9},children:["You are about to run: ",u.jsx("strong",{children:r})]}),u.jsx("p",{style:{margin:"0 0 1rem",opacity:.8,fontSize:"0.9rem"},children:"Please ensure you have a recent backup of your data. You can download a diagnostic backup that includes all your budget and month data."}),o&&u.jsx("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",padding:"1rem",marginBottom:"1rem"},children:u.jsx(Ve,{variant:"secondary",onClick:m,disabled:l,actionName:"Download Backup Before Migration",style:{width:"100%"},children:l?u.jsxs(u.Fragment,{children:[u.jsx($n,{noMargin:!0})," Downloading Backup..."]}):d?" Backup Downloaded":" Download Backup Now"})}),u.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[u.jsx(Ve,{variant:"secondary",actionName:"Cancel Migration",onClick:g,children:"Cancel"}),u.jsx(Ve,{variant:i?"danger":"primary",actionName:`Proceed with ${r}`,onClick:p,disabled:l,children:d?" Proceed with Migration":" I Have a Backup - Proceed"})]})]})}function Co({migrationName:t,isDestructive:e=!1,onDownloadBackup:n}){const[r,i]=M.useState(!1),[o,l]=M.useState(!1),[d,h]=M.useState(null),m=M.useCallback(b=>{h(()=>b),i(!0)},[]),p=M.useCallback(b=>{b!=="cancelled"&&d&&d(),h(null),i(!1)},[d]),g=M.useCallback(()=>{h(null),i(!1)},[]),v=M.useCallback(async()=>{if(n){l(!0);try{await n()}finally{l(!1)}}},[n]);return{promptBeforeAction:m,promptProps:{isOpen:r,onClose:g,onConfirm:p,migrationName:t,isDestructive:e,onDownloadBackup:n?v:void 0,isDownloading:o}}}const JP={onetime:{borderColor:"color-mix(in srgb, #a855f7 30%, transparent)",iconBg:"color-mix(in srgb, #a855f7 15%, transparent)",headerBg:"color-mix(in srgb, #a855f7 8%, transparent)"},maintenance:{borderColor:"color-mix(in srgb, #3b82f6 30%, transparent)",iconBg:"color-mix(in srgb, #3b82f6 15%, transparent)",headerBg:"color-mix(in srgb, #3b82f6 8%, transparent)"},utility:{borderColor:"color-mix(in srgb, #22c55e 30%, transparent)",iconBg:"color-mix(in srgb, #22c55e 15%, transparent)",headerBg:"color-mix(in srgb, #22c55e 8%, transparent)"}};function W0({title:t,icon:e,description:n,type:r,children:i,onValidateAll:o,isValidating:l=!1,isAnyRunning:d=!1}){const h=JP[r],m=l||d,p=()=>{o&&!m&&o()};return u.jsxs("section",{style:{background:"color-mix(in srgb, currentColor 3%, transparent)",border:`1px solid ${h.borderColor}`,borderRadius:"12px",marginBottom:"1.5rem",overflow:"hidden"},children:[u.jsxs("div",{style:{background:h.headerBg,padding:"1.25rem 1.5rem",borderBottom:`2px solid ${h.borderColor}`,display:"flex",justifyContent:"space-between",alignItems:"flex-start",gap:"1rem"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"0.875rem",flex:1},children:[u.jsx("span",{style:{fontSize:"1.75rem",background:h.iconBg,padding:"0.625rem",borderRadius:"10px",lineHeight:1,display:"flex",alignItems:"center",justifyContent:"center",minWidth:"48px",minHeight:"48px"},children:e}),u.jsxs("div",{children:[u.jsx("h3",{style:{margin:"0 0 0.375rem 0",fontSize:"1.25rem",fontWeight:600,letterSpacing:"-0.01em"},children:t}),u.jsx("p",{style:{margin:0,opacity:.75,fontSize:"0.9rem",lineHeight:1.4},children:n})]})]}),o&&u.jsx("button",{onClick:p,disabled:m,style:{background:"color-mix(in srgb, #3b82f6 20%, transparent)",color:"#60a5fa",border:"1px solid color-mix(in srgb, #3b82f6 40%, transparent)",padding:"0.5rem 1rem",borderRadius:"6px",cursor:m?"not-allowed":"pointer",fontWeight:500,fontSize:"0.85rem",opacity:m?.6:1,display:"flex",alignItems:"center",gap:"0.4rem",flexShrink:0},children:l?u.jsxs(u.Fragment,{children:[u.jsx($n,{noMargin:!0})," Validating..."]}):" Validate All"})]}),u.jsx("div",{style:{padding:"0.75rem",background:"color-mix(in srgb, currentColor 1%, transparent)"},children:i})]})}const ez={unknown:{color:"#9ca3af",icon:"",text:"Unknown"},clean:{color:"#22c55e",icon:"",text:"Clean"},"needs-action":{color:"#f59e0b",icon:"",text:"Needs Action"},running:{color:"#60a5fa",icon:"",text:"Running"},complete:{color:"#22c55e",icon:"",text:"Complete"},error:{color:"#ef4444",icon:"",text:"Error"}};function K0({name:t,description:e,status:n,statusText:r,onCheck:i,isChecking:o,onRun:l,isRunning:d=!1,actionText:h="Run",disabled:m=!1,itemCount:p,details:g,isDestructive:v=!1}){const[b,C]=M.useState(!1),x=ez[n],S=r||x.text,E=m||d||o,T=()=>{i()},I=()=>{l&&l()},D=()=>{g&&C(!b)};return u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"8px",margin:"0.25rem 0",overflow:"hidden"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"0.75rem 1rem",gap:"1rem"},children:[u.jsx("div",{style:{width:"28px",height:"28px",borderRadius:"50%",background:`color-mix(in srgb, ${x.color} 20%, transparent)`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.85rem",flexShrink:0},children:d||o?u.jsx($n,{noMargin:!0}):x.icon}),u.jsxs("div",{style:{flex:1,minWidth:0},children:[u.jsx("div",{style:{fontWeight:500,fontSize:"0.95rem",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:t}),u.jsx("div",{style:{fontSize:"0.8rem",opacity:.6,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:e})]}),u.jsxs("div",{style:{color:x.color,fontSize:"0.8rem",fontWeight:500,display:"flex",alignItems:"center",gap:"0.25rem",flexShrink:0},children:[S,p!==void 0&&p>0&&u.jsx("span",{style:{background:`color-mix(in srgb, ${x.color} 20%, transparent)`,padding:"0.15rem 0.4rem",borderRadius:"4px",fontSize:"0.75rem"},children:p})]}),u.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:[u.jsx("button",{onClick:T,disabled:E,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",padding:"0.35rem 0.6rem",borderRadius:"4px",cursor:E?"not-allowed":"pointer",fontSize:"0.8rem",opacity:E?.5:1,display:"flex",alignItems:"center",gap:"0.25rem"},title:"Check status",children:o?u.jsx($n,{noMargin:!0}):""}),l&&n==="needs-action"&&u.jsx("button",{onClick:I,disabled:E,style:{background:v?"#ef4444":"#646cff",color:"white",border:"none",padding:"0.35rem 0.75rem",borderRadius:"4px",cursor:E?"not-allowed":"pointer",fontSize:"0.8rem",fontWeight:500,opacity:E?.6:1,display:"flex",alignItems:"center",gap:"0.25rem"},children:d?u.jsx($n,{noMargin:!0}):h}),g&&u.jsx("button",{onClick:D,style:{background:"transparent",color:"inherit",border:"none",padding:"0.35rem",borderRadius:"4px",cursor:"pointer",fontSize:"0.9rem",opacity:.6},title:b?"Collapse details":"Expand details",children:b?"":""})]})]}),b&&g&&u.jsx("div",{style:{borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)",padding:"1rem",background:"color-mix(in srgb, currentColor 2%, transparent)"},children:g})]})}function tz({name:t,description:e,onAction:n,actionText:r,actionIcon:i,isRunning:o=!1,disabled:l=!1,progress:d,error:h,isDestructive:m=!1}){const p=l||o,g=()=>{n()};return u.jsx("div",{style:{background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"8px",margin:"0.25rem 0",padding:"0.75rem 1rem"},children:u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},children:[u.jsxs("div",{style:{flex:1,minWidth:0},children:[u.jsx("div",{style:{fontWeight:500,fontSize:"0.95rem",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:t}),u.jsx("div",{style:{fontSize:"0.8rem",opacity:.6,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:e}),h&&u.jsx("div",{style:{fontSize:"0.8rem",color:"#ef4444",marginTop:"0.25rem"},children:h})]}),d!==void 0&&o&&u.jsxs("div",{style:{width:"100px",flexShrink:0},children:[u.jsx("div",{style:{background:"rgba(255, 255, 255, 0.1)",borderRadius:"4px",height:"6px",overflow:"hidden"},children:u.jsx("div",{style:{background:m?"#ef4444":"#646cff",height:"100%",width:`${d}%`,transition:"width 0.3s"}})}),u.jsxs("div",{style:{fontSize:"0.7rem",opacity:.6,textAlign:"center",marginTop:"0.15rem"},children:[d,"%"]})]}),u.jsx("button",{onClick:g,disabled:p,style:{background:m?"#ef4444":"#646cff",color:"white",border:"none",padding:"0.5rem 1rem",borderRadius:"6px",cursor:p?"not-allowed":"pointer",fontSize:"0.85rem",fontWeight:500,opacity:p?.6:1,display:"flex",alignItems:"center",gap:"0.4rem",flexShrink:0},children:o?u.jsxs(u.Fragment,{children:[u.jsx($n,{noMargin:!0})," Running..."]}):u.jsxs(u.Fragment,{children:[i&&u.jsx("span",{children:i}),r]})})]})})}function nz({disabled:t,onDownloadBackup:e,isDownloadingBackup:n}){return u.jsx(u.Fragment,{children:u.jsx(W0,{title:"One-Time Migrations",icon:"",description:"Migrations that typically only need to be run once. Check status first, then apply if needed.",type:"onetime",isAnyRunning:!1,children:null})})}const eA={unknown:{color:"#9ca3af",icon:""},clean:{color:"#22c55e",icon:""},"needs-action":{color:"#f59e0b",icon:""},running:{color:"#60a5fa",icon:""},complete:{color:"#22c55e",icon:""},error:{color:"#ef4444",icon:""}};function rz({check:t,disabled:e}){const n=eA[t.status],r=e||t.isRunning||t.isChecking;return u.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"0.5rem 0.75rem",gap:"0.75rem",borderRadius:"6px",background:"color-mix(in srgb, currentColor 3%, transparent)",marginBottom:"0.25rem"},children:[u.jsx("div",{style:{width:"20px",height:"20px",borderRadius:"50%",background:`color-mix(in srgb, ${n.color} 20%, transparent)`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.7rem",flexShrink:0},children:t.isRunning||t.isChecking?u.jsx($n,{noMargin:!0}):n.icon}),u.jsxs("div",{style:{flex:1,minWidth:0},children:[u.jsxs("div",{style:{fontWeight:500,fontSize:"0.85rem"},children:[t.name,t.issueCount>0&&u.jsxs("span",{style:{marginLeft:"0.5rem",color:n.color,fontSize:"0.75rem"},children:["(",t.issueCount,")"]})]}),u.jsx("div",{style:{fontSize:"0.75rem",opacity:.6},children:t.description}),t.details]}),u.jsxs("div",{style:{display:"flex",gap:"0.35rem",flexShrink:0},children:[u.jsx("button",{onClick:()=>{`${t.name}`,t.onCheck()},disabled:r,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",padding:"0.25rem 0.4rem",borderRadius:"4px",cursor:r?"not-allowed":"pointer",fontSize:"0.7rem",opacity:r?.5:1},title:"Check",children:t.isChecking?u.jsx($n,{noMargin:!0}):""}),t.canFix&&t.onFix&&u.jsx("button",{onClick:()=>{`${t.name}`,t.onFix()},disabled:r,style:{background:"#646cff",color:"white",border:"none",padding:"0.25rem 0.5rem",borderRadius:"4px",cursor:r?"not-allowed":"pointer",fontSize:"0.7rem",fontWeight:500,opacity:r?.6:1},children:t.isRunning?u.jsx($n,{noMargin:!0}):"Fix"})]})]})}function sz({accountCategoryValidation:t,orphanedIdCleanup:e,expenseToAdjustment:n,adjustmentsToTransfers:r,needsAction:i,totalIssues:o,isScanning:l,isRunning:d,disabled:h,onRunOrphaned:m,onRunExpense:p,onRunTransfers:g}){const[v,b]=M.useState(!1),x=d?"running":t.hasData&&e.hasData&&n.hasData&&r.hasData?i?"needs-action":"clean":"unknown",S=eA[x],E=[{id:"validation",name:"Account/Category Validation",status:t.isScanning?"running":t.hasData?t.hasViolations?"needs-action":"clean":"unknown",issueCount:t.violationCount,description:"Validates all transactions have proper account/category combinations",canFix:!1,onCheck:()=>t.scan(),isChecking:t.isScanning,isRunning:!1,details:t.hasViolations&&t.status&&u.jsxs("div",{style:{fontSize:"0.8rem",opacity:.8},children:[t.status.violations.filter(D=>D.transactionType==="income").length>0&&u.jsxs("span",{children:["Income: ",t.status.violations.filter(D=>D.transactionType==="income").length," "]}),t.status.violations.filter(D=>D.transactionType==="expense").length>0&&u.jsxs("span",{children:["Expenses: ",t.status.violations.filter(D=>D.transactionType==="expense").length," "]}),t.status.violations.filter(D=>D.transactionType==="adjustment").length>0&&u.jsxs("span",{children:["Adjustments: ",t.status.violations.filter(D=>D.transactionType==="adjustment").length," "]}),t.status.violations.filter(D=>D.transactionType==="transfer").length>0&&u.jsxs("span",{children:["Transfers: ",t.status.violations.filter(D=>D.transactionType==="transfer").length]})]})},{id:"orphaned",name:"Orphaned ID Cleanup",status:Gg(e),issueCount:e.totalOrphaned,description:"Finds transactions with deleted/invalid account/category IDs",canFix:e.hasItemsToFix,onCheck:e.scanStatus,onFix:m,isChecking:e.isScanning,isRunning:e.isRunning,details:e.hasItemsToFix&&e.status&&u.jsxs("div",{style:{fontSize:"0.8rem",opacity:.8},children:[e.status.orphanedCategoryIds>0&&u.jsxs("span",{children:["Categories: ",e.status.orphanedCategoryIds," "]}),e.status.orphanedAccountIds>0&&u.jsxs("span",{children:["Accounts: ",e.status.orphanedAccountIds]})]})},{id:"expense",name:"Expense  Adjustment",status:Gg(n,"hasItemsToMigrate"),issueCount:n.totalToMigrate,description:"Moves expenses without account/category to adjustments",canFix:n.hasItemsToMigrate,onCheck:n.scanStatus,onFix:p,isChecking:n.isScanning,isRunning:n.isRunning,details:n.hasItemsToMigrate&&n.status&&u.jsxs("div",{style:{fontSize:"0.8rem",opacity:.8},children:[n.status.expensesToMigrate," expense(s) with No Account or No Category"]})},{id:"transfers",name:"Adjustment  Transfers",status:Gg(r,"hasPairsToConvert"),issueCount:r.totalPairs,description:"Converts opposite adjustment pairs to transfers",canFix:r.hasPairsToConvert,onCheck:r.scanStatus,onFix:g,isChecking:r.isScanning,isRunning:r.isRunning,details:r.hasPairsToConvert&&r.status&&u.jsxs("div",{style:{fontSize:"0.8rem",opacity:.8},children:[r.status.accountTransferPairs>0&&u.jsxs("span",{children:["Account transfers: ",r.status.accountTransferPairs," "]}),r.status.categoryTransferPairs>0&&u.jsxs("span",{children:["Category transfers: ",r.status.categoryTransferPairs]})]})}],T=h||d||l,I=()=>{E.forEach(D=>D.onCheck())};return u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"8px",margin:"0.25rem 0",overflow:"hidden"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"0.75rem 1rem",gap:"1rem"},children:[u.jsx("div",{style:{width:"28px",height:"28px",borderRadius:"50%",background:`color-mix(in srgb, ${S.color} 20%, transparent)`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.85rem",flexShrink:0},children:d||l?u.jsx($n,{noMargin:!0}):S.icon}),u.jsxs("div",{style:{flex:1,minWidth:0},children:[u.jsx("div",{style:{fontWeight:500,fontSize:"0.95rem",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:"Transaction Type Audit"}),u.jsx("div",{style:{fontSize:"0.8rem",opacity:.6,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:"Validates account/category assignments and fixes invalid transactions"})]}),u.jsxs("div",{style:{color:S.color,fontSize:"0.8rem",fontWeight:500,display:"flex",alignItems:"center",gap:"0.25rem",flexShrink:0},children:[x==="unknown"?"Unknown":x==="clean"?"Clean":x==="running"?"Running":"Needs Action",o>0&&u.jsx("span",{style:{background:`color-mix(in srgb, ${S.color} 20%, transparent)`,padding:"0.15rem 0.4rem",borderRadius:"4px",fontSize:"0.75rem"},children:o})]}),u.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:[u.jsx("button",{onClick:I,disabled:T,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",padding:"0.35rem 0.6rem",borderRadius:"4px",cursor:T?"not-allowed":"pointer",fontSize:"0.8rem",opacity:T?.5:1,display:"flex",alignItems:"center",gap:"0.25rem"},title:"Check all",children:l?u.jsx($n,{noMargin:!0}):""}),u.jsx("button",{onClick:()=>b(!v),style:{background:"transparent",color:"inherit",border:"none",padding:"0.35rem",borderRadius:"4px",cursor:"pointer",fontSize:"0.9rem",opacity:.6},title:v?"Collapse":"Expand",children:v?"":""})]})]}),v&&u.jsx("div",{style:{borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)",padding:"0.5rem",background:"color-mix(in srgb, currentColor 2%, transparent)"},children:E.map(D=>u.jsx(rz,{check:D,disabled:h},D.id))})]})}function Gg(t,e="hasItemsToFix"){return t.isRunning?"running":t.result&&t.result.errors.length===0?"complete":t.isScanning?"running":t.hasData?t[e]?"needs-action":"clean":"unknown"}function iz({status:t,hasData:e,hasIssues:n,totalIssues:r,isChecking:i,isRunning:o,result:l,onCheck:d,onRun:h,disabled:m}){const p=()=>o?"running":e?l&&l.errors.length===0?"complete":l&&l.errors.length>0?"error":n?"needs-action":"clean":"unknown",g=()=>{if(l&&l.errors.length===0){const b=l.accountsFixed+l.categoriesFixed+l.totalAvailableFixed+l.incomeValuesFixed+l.expenseValuesFixed+l.categoryBalancesFixed+l.accountBalancesFixed;return b>0?`Fixed ${b}`:"Complete"}},v=()=>{if(l){const b=l.accountsFixed+l.categoriesFixed+l.totalAvailableFixed+l.incomeValuesFixed+l.expenseValuesFixed+l.categoryBalancesFixed+l.accountBalancesFixed;return u.jsxs("div",{style:{fontSize:"0.85rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem",fontWeight:500},children:l.errors.length>0?" Completed with errors":" Cleanup complete"}),u.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[l.budgetsProcessed>0&&u.jsxs("li",{children:[l.budgetsProcessed," budget(s) updated"]}),l.accountsFixed>0&&u.jsxs("li",{children:[l.accountsFixed," account balance(s) fixed"]}),l.categoriesFixed>0&&u.jsxs("li",{children:[l.categoriesFixed," category value(s) fixed"]}),l.totalAvailableFixed>0&&u.jsxs("li",{children:[l.totalAvailableFixed," total_available value(s) fixed"]}),l.monthsProcessed>0&&u.jsxs("li",{children:[l.monthsProcessed," month(s) updated"]}),l.incomeValuesFixed>0&&u.jsxs("li",{children:[l.incomeValuesFixed," income amount(s) fixed"]}),l.expenseValuesFixed>0&&u.jsxs("li",{children:[l.expenseValuesFixed," expense amount(s) fixed"]}),l.categoryBalancesFixed>0&&u.jsxs("li",{children:[l.categoryBalancesFixed," category balance(s) fixed"]}),l.accountBalancesFixed>0&&u.jsxs("li",{children:[l.accountBalancesFixed," account balance(s) fixed"]}),b===0&&u.jsx("li",{children:"No changes needed"})]}),l.errors.length>0&&u.jsxs("div",{style:{marginTop:"0.5rem",color:"#ef4444"},children:[u.jsxs("div",{children:["Errors (",l.errors.length,"):"]}),u.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1.25rem"},children:[l.errors.slice(0,3).map((C,x)=>u.jsx("li",{children:C},x)),l.errors.length>3&&u.jsxs("li",{children:["...and ",l.errors.length-3," more"]})]})]})]})}return e?n?u.jsxs("div",{style:{fontSize:"0.85rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem",color:"#fbbf24"},children:"Precision issues found:"}),u.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[t.budgetsWithPrecisionIssues>0&&u.jsxs("li",{children:[t.budgetsWithPrecisionIssues," budget(s) with issues:",u.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1rem",opacity:.8},children:[t.accountsWithPrecisionIssues>0&&u.jsxs("li",{children:[t.accountsWithPrecisionIssues," account balance(s)"]}),t.categoriesWithPrecisionIssues>0&&u.jsxs("li",{children:[t.categoriesWithPrecisionIssues," category value(s)"]}),t.totalAvailableWithPrecisionIssues>0&&u.jsxs("li",{children:[t.totalAvailableWithPrecisionIssues," total_available value(s)"]})]})]}),t.monthsWithPrecisionIssues>0&&u.jsxs("li",{children:[t.monthsWithPrecisionIssues," month(s) with issues:",u.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1rem",opacity:.8},children:[t.incomeValuesWithPrecisionIssues>0&&u.jsxs("li",{children:[t.incomeValuesWithPrecisionIssues," income amount(s)"]}),t.expenseValuesWithPrecisionIssues>0&&u.jsxs("li",{children:[t.expenseValuesWithPrecisionIssues," expense amount(s)"]}),t.categoryBalancesWithPrecisionIssues>0&&u.jsxs("li",{children:[t.categoryBalancesWithPrecisionIssues," category balance(s)"]}),t.accountBalancesWithPrecisionIssues>0&&u.jsxs("li",{children:[t.accountBalancesWithPrecisionIssues," account balance(s)"]})]})]})]}),u.jsxs("div",{style:{marginTop:"0.5rem",opacity:.6},children:["Scanned ",t.totalBudgets," budget(s) and ",t.totalMonths," month(s)."]})]}):u.jsxs("div",{style:{fontSize:"0.85rem"},children:[" All currency values have proper precision (2 decimal places).",u.jsxs("div",{style:{marginTop:"0.25rem",opacity:.6},children:["Scanned ",t.totalBudgets," budget(s) and ",t.totalMonths," month(s)."]})]}):u.jsx("div",{style:{fontSize:"0.85rem",opacity:.7},children:"Click check to scan for precision issues."})};return u.jsx(K0,{name:"Currency Precision",description:"Fixes floating-point precision by rounding all values to 2 decimal places",status:p(),statusText:g(),onCheck:d,isChecking:i,onRun:h,isRunning:o,actionText:`Fix ${r}`,disabled:m,itemCount:n?r:void 0,details:v(),isDestructive:!0})}function az({disabled:t,onDownloadBackup:e,isDownloadingBackup:n,accountCategoryValidation:r,orphanedIdCleanup:i,expenseToAdjustment:o,adjustmentsToTransfers:l,precisionCleanup:d}){const h=r.isScanning||i.isScanning||o.isScanning||l.isScanning||d.isScanning,m=i.isRunning||o.isRunning||l.isRunning||d.isRunning,p=async()=>{await Promise.all([r.scan(),i.scanStatus(),o.scanStatus(),l.scanStatus(),d.scan()])},g=Co({migrationName:"Orphaned ID Cleanup",isDestructive:!0,onDownloadBackup:e}),v=Co({migrationName:"Expense to Adjustment Migration",isDestructive:!0,onDownloadBackup:e}),b=Co({migrationName:"Adjustments to Transfers Migration",isDestructive:!0,onDownloadBackup:e}),C=Co({migrationName:"Currency Precision Cleanup",isDestructive:!0,onDownloadBackup:e}),x=r.hasViolations||i.hasItemsToFix||o.hasItemsToMigrate||l.hasPairsToConvert,S=(r.violationCount||0)+(i.totalOrphaned||0)+(o.totalToMigrate||0)+(l.totalPairs||0);return u.jsxs(u.Fragment,{children:[u.jsxs(W0,{title:"Maintenance",icon:"",description:"Re-runnable database validation scripts. Validate all to see which need resolution.",type:"maintenance",onValidateAll:p,isValidating:h,isAnyRunning:m,children:[u.jsx(sz,{accountCategoryValidation:r,orphanedIdCleanup:i,expenseToAdjustment:o,adjustmentsToTransfers:l,needsAction:x,totalIssues:S,isScanning:r.isScanning||i.isScanning||o.isScanning||l.isScanning,isRunning:i.isRunning||o.isRunning||l.isRunning,disabled:t,onRunOrphaned:()=>g.promptBeforeAction(i.runMigration),onRunExpense:()=>v.promptBeforeAction(o.runMigration),onRunTransfers:()=>b.promptBeforeAction(l.runMigration)}),u.jsx(iz,{status:d.status,hasData:d.hasData,hasIssues:d.hasIssues,totalIssues:d.totalIssues,isChecking:d.isScanning,isRunning:d.isRunning,result:d.result,onCheck:d.scan,onRun:()=>C.promptBeforeAction(d.runCleanup),disabled:t})]}),u.jsx(So,{...g.promptProps,isDownloading:n}),u.jsx(So,{...v.promptProps,isDownloading:n}),u.jsx(So,{...b.promptProps,isDownloading:n}),u.jsx(So,{...C.promptProps,isDownloading:n})]})}function oz({isDownloading:t,downloadProgress:e,downloadError:n,onDownload:r,isScanning:i,isUploading:o,uploadStatus:l,uploadProgress:d,uploadError:h,uploadResult:m,onScan:p,onUpload:g,disabled:v}){const b=M.useRef(null),[C,x]=M.useState(null),[S,E]=M.useState(!1),T=async q=>{const A=q.target.files?.[0];A&&(x(A),await p(A))},I=l!==null,D=I&&(l.budgetsFound>0||l.monthsFound>0),B=v||t||i||o,$=m?.success?"#22c55e":D?"#f59e0b":I?"#22c55e":"#9ca3af",k=m?.success?"":o||i||t?"":D?"":I?"":"",j=m?.success?"Uploaded":o?"Uploading":i?"Scanning":t?"Downloading":D?`${l.budgetsFound} budget(s), ${l.monthsFound} month(s) ready`:I?"Nothing to upload":"Select file",N=t?e?.percentComplete:d?.percentComplete,F=n||h;return u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"8px",margin:"0.25rem 0",overflow:"hidden"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"0.75rem 1rem",gap:"1rem"},children:[u.jsx("div",{style:{width:"28px",height:"28px",borderRadius:"50%",background:`color-mix(in srgb, ${$} 20%, transparent)`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.85rem",flexShrink:0},children:o||i||t?u.jsx($n,{noMargin:!0}):k}),u.jsxs("div",{style:{flex:1,minWidth:0},children:[u.jsx("div",{style:{fontWeight:500,fontSize:"0.95rem",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:" Budget Backup & Restore"}),u.jsx("div",{style:{fontSize:"0.8rem",opacity:.6,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:"Download selected budget as zip or restore from zip file"})]}),u.jsx("div",{style:{color:$,fontSize:"0.8rem",fontWeight:500,flexShrink:0},children:j}),u.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:[u.jsx("button",{onClick:()=>{r()},disabled:B,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",padding:"0.35rem 0.6rem",borderRadius:"4px",cursor:B?"not-allowed":"pointer",fontSize:"0.8rem",opacity:B?.5:1,display:"flex",alignItems:"center",gap:"0.25rem"},title:"Download all budgets as zip",children:t?u.jsx($n,{noMargin:!0}):""}),u.jsx("input",{ref:b,type:"file",accept:".zip",onChange:T,style:{display:"none"}}),u.jsx("button",{onClick:()=>b.current?.click(),disabled:B,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",padding:"0.35rem 0.6rem",borderRadius:"4px",cursor:B?"not-allowed":"pointer",fontSize:"0.8rem",opacity:B?.5:1,display:"flex",alignItems:"center",gap:"0.25rem"},title:"Select zip file to restore",children:i?u.jsx($n,{noMargin:!0}):""}),D&&C&&u.jsx("button",{onClick:async()=>{await g(C)},disabled:B,style:{background:"#646cff",color:"white",border:"none",padding:"0.35rem 0.75rem",borderRadius:"4px",cursor:B?"not-allowed":"pointer",fontSize:"0.8rem",fontWeight:500,opacity:B?.6:1,display:"flex",alignItems:"center",gap:"0.25rem"},children:o?u.jsx($n,{noMargin:!0}):"Upload"}),(I||m||F)&&u.jsx("button",{onClick:()=>E(!S),style:{background:"transparent",color:"inherit",border:"none",padding:"0.35rem",borderRadius:"4px",cursor:"pointer",fontSize:"0.9rem",opacity:.6},title:S?"Collapse":"Expand",children:S?"":""})]})]}),(t||o)&&N!==void 0&&u.jsxs("div",{style:{padding:"0 1rem 0.5rem 1rem"},children:[u.jsx("div",{style:{width:"100%",height:"4px",background:"color-mix(in srgb, currentColor 10%, transparent)",borderRadius:"2px",overflow:"hidden"},children:u.jsx("div",{style:{width:`${N}%`,height:"100%",background:"#646cff",transition:"width 0.3s ease"}})}),u.jsxs("div",{style:{fontSize:"0.75rem",opacity:.6,marginTop:"0.25rem",textAlign:"center"},children:[t?e?.phase:d?.phase,": ",N,"%"]})]}),S&&(I||m||F)&&u.jsxs("div",{style:{borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)",padding:"1rem",background:"color-mix(in srgb, currentColor 2%, transparent)",fontSize:"0.85rem"},children:[F&&u.jsxs("div",{style:{marginBottom:"0.75rem",color:"#ef4444"},children:[" Error: ",F]}),m&&u.jsx("div",{style:{marginBottom:l?"0.75rem":0,color:m.success?"#22c55e":"#ef4444"},children:m.success?u.jsxs(u.Fragment,{children:[" Restored ",m.budgetsRestored," budget(s), ",m.monthsRestored," month(s), ",m.payeesRestored," payee doc(s)"]}):u.jsxs(u.Fragment,{children:[" Upload failed: ",m.errors.join(", ")]})}),l&&u.jsxs(u.Fragment,{children:[u.jsxs("div",{style:{marginBottom:"0.25rem"},children:[u.jsx("strong",{children:"Found in zip:"})," ",l.budgetsFound," budget(s), ",l.monthsFound," month(s), ",l.payeesFound," payee doc(s)"]}),l.budgetsToRestore.length>0&&u.jsxs("div",{children:[u.jsx("strong",{children:"Budgets to restore:"})," ",l.budgetsToRestore.join(", ")]})]})]})]})}function lz({hasData:t,monthsCount:e,budgetCount:n,isChecking:r,isDeleting:i,deleteResult:o,onCheck:l,onDelete:d,disabled:h}){const[m,p]=M.useState(!1),g=()=>i?"running":t?o&&o.errors.length===0?"complete":e===0?"clean":"needs-action":"unknown",v=()=>o&&o.errors.length===0?`Deleted ${o.deleted}`:e===0?"No months":`${e} months`,b=()=>{p(!0)},C=()=>{p(!1),d()},x=()=>o?u.jsxs("div",{style:{fontSize:"0.85rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem",fontWeight:500},children:o.errors.length>0?" Completed with errors":" Deletion complete"}),u.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[u.jsxs("li",{children:[o.deleted," month(s) deleted"]}),o.budgetsRecalculated>0&&u.jsxs("li",{children:[o.budgetsRecalculated," budget(s) reset"]})]}),o.errors.length>0&&u.jsxs("div",{style:{marginTop:"0.5rem",color:"#ef4444"},children:[u.jsxs("div",{children:["Errors (",o.errors.length,"):"]}),u.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1.25rem"},children:[o.errors.slice(0,3).map((S,E)=>u.jsx("li",{children:S},E)),o.errors.length>3&&u.jsxs("li",{children:["...and ",o.errors.length-3," more"]})]})]})]}):t?e===0?u.jsx("div",{style:{fontSize:"0.85rem"},children:" No month documents found in Firebase."}):u.jsxs("div",{style:{fontSize:"0.85rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem",color:"#ef4444"},children:" DESTRUCTIVE ACTION"}),u.jsxs("div",{children:["Found ",e," month(s) across ",n," budget(s)."]}),u.jsx("div",{style:{marginTop:"0.5rem",opacity:.7},children:"This will permanently delete ALL month documents and reset all budgets."})]}):u.jsx("div",{style:{fontSize:"0.85rem",opacity:.7},children:"Click check to scan for months."});return u.jsxs(u.Fragment,{children:[u.jsx(K0,{name:"Delete ALL Months",description:"DESTRUCTIVE: Deletes all month documents from all budgets",status:g(),statusText:v(),onCheck:l,isChecking:r,onRun:e>0?b:void 0,isRunning:i,actionText:"Delete",disabled:h,itemCount:e>0?e:void 0,details:x(),isDestructive:!0}),u.jsxs(us,{isOpen:m,onClose:()=>p(!1),title:" Delete All Months?",children:[u.jsx("div",{style:{background:"color-mix(in srgb, #ef4444 15%, transparent)",border:"1px solid color-mix(in srgb, #ef4444 40%, transparent)",borderRadius:"8px",padding:"1rem",marginBottom:"1rem"},children:u.jsx("p",{style:{margin:0,color:"#fca5a5",fontWeight:500,fontSize:"0.95rem"},children:" This is a destructive operation that cannot be undone!"})}),u.jsxs("p",{style:{margin:"0 0 0.75rem",opacity:.9},children:["This will permanently delete ",u.jsxs("strong",{style:{color:"#ef4444"},children:[e," month(s)"]})," across"," ",u.jsxs("strong",{style:{color:"#ef4444"},children:[n," budget(s)"]}),"."]}),u.jsxs("ul",{style:{margin:"0 0 1.5rem",paddingLeft:"1.5rem",opacity:.8,fontSize:"0.9rem"},children:[u.jsx("li",{children:"All account balances  $0"}),u.jsx("li",{children:"All category balances  $0"}),u.jsx("li",{children:"Month history cleared"})]}),u.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[u.jsx(Ve,{variant:"secondary",actionName:"Cancel Delete All Months",onClick:()=>p(!1),children:"Cancel"}),u.jsxs(Ve,{variant:"danger",actionName:"Confirm Delete All Months",onClick:C,children:[" Delete All ",e," Months"]})]})]})]})}function cz({status:t,hasData:e,totalBudgets:n,totalMonths:r,isChecking:i,isDeleting:o,deleteResult:l,onCheck:d,onDelete:h,disabled:m}){const[p,g]=M.useState(!1),v=t?.staleBudgetIds??[],b=v.length>0,C=()=>o?"running":e?l&&l.errors.length===0?"complete":n===0&&!b?"clean":"needs-action":"unknown",x=()=>l&&l.errors.length===0?`Deleted ${l.budgetsDeleted}`:n===0&&!b?"Clean":b?`${v.length} stale ref(s)`:`${n} budget(s)`,S=()=>{g(!0)},E=()=>{g(!1),h()},T=()=>l?u.jsxs("div",{style:{fontSize:"0.85rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem",fontWeight:500},children:l.errors.length>0?" Completed with errors":" Deletion complete"}),u.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[l.budgetsDeleted>0&&u.jsxs("li",{children:[l.budgetsDeleted," budget(s) deleted"]}),l.monthsDeleted>0&&u.jsxs("li",{children:[l.monthsDeleted," month(s) deleted"]}),l.payeesDeleted>0&&u.jsxs("li",{children:[l.payeesDeleted," payee doc(s) deleted"]})]}),l.errors.length>0&&u.jsxs("div",{style:{marginTop:"0.5rem",color:"#ef4444"},children:[u.jsxs("div",{children:["Errors (",l.errors.length,"):"]}),u.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1.25rem"},children:[l.errors.slice(0,3).map((D,B)=>u.jsx("li",{children:D},B)),l.errors.length>3&&u.jsxs("li",{children:["...and ",l.errors.length-3," more"]})]})]})]}):e?n===0&&!b?u.jsx("div",{style:{fontSize:"0.85rem"},children:' No budget found for sample@sample.com  user is in "new user" state.'}):b?u.jsxs("div",{style:{fontSize:"0.85rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem",color:"#f59e0b"},children:" Found stale budget references:"}),u.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[v.slice(0,3).map(D=>u.jsx("li",{style:{opacity:.8},children:D},D)),v.length>3&&u.jsxs("li",{style:{opacity:.6},children:["...and ",v.length-3," more"]})]})]}):u.jsxs("div",{style:{fontSize:"0.85rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem",color:"#f59e0b"},children:" Sample user budget found:"}),u.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[u.jsxs("li",{children:[n," budget(s)"]}),u.jsxs("li",{children:[r," month(s)"]})]}),u.jsx("div",{style:{marginTop:"0.5rem",opacity:.7},children:"Deleting will reset sample@sample.com to a new user state."})]}):u.jsx("div",{style:{fontSize:"0.85rem",opacity:.7},children:"Click check to scan for sample user budget."}),I=n>0||b;return u.jsxs(u.Fragment,{children:[u.jsx(K0,{name:"Delete Sample User Budget",description:"Reset sample@sample.com to new user state",status:C(),statusText:x(),onCheck:d,isChecking:i,onRun:I?S:void 0,isRunning:o,actionText:"Delete",disabled:m,itemCount:I?n||v.length:void 0,details:T(),isDestructive:!0}),u.jsxs(us,{isOpen:p,onClose:()=>g(!1),title:" Delete Sample User Budget?",children:[u.jsx("div",{style:{background:"color-mix(in srgb, #f59e0b 15%, transparent)",border:"1px solid color-mix(in srgb, #f59e0b 40%, transparent)",borderRadius:"8px",padding:"1rem",marginBottom:"1rem"},children:u.jsx("p",{style:{margin:0,color:"#fcd34d",fontWeight:500,fontSize:"0.95rem"},children:" This will delete all data for sample@sample.com!"})}),n>0&&u.jsxs("p",{style:{margin:"0 0 0.75rem",opacity:.9},children:["This will permanently delete ",u.jsxs("strong",{style:{color:"#f59e0b"},children:[n," budget(s)"]})," and"," ",u.jsxs("strong",{style:{color:"#f59e0b"},children:[r," month(s)"]}),"."]}),b&&u.jsxs("p",{style:{margin:"0 0 0.75rem",opacity:.9},children:["This will remove ",u.jsxs("strong",{style:{color:"#f59e0b"},children:[v.length," stale reference(s)"]})," from the user document."]}),u.jsxs("ul",{style:{margin:"0 0 1.5rem",paddingLeft:"1.5rem",opacity:.8,fontSize:"0.9rem"},children:[u.jsx("li",{children:"Budget document deleted"}),u.jsx("li",{children:"All month documents deleted"}),u.jsx("li",{children:"Payees document deleted"}),u.jsx("li",{children:"User will see onboarding flow"})]}),u.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[u.jsx(Ve,{variant:"secondary",actionName:"Cancel Delete Sample User Budget",onClick:()=>g(!1),children:"Cancel"}),u.jsx(Ve,{variant:"danger",actionName:"Confirm Delete Sample User Budget",onClick:E,children:" Delete Sample User Data"})]})]})]})}function uz({onClearCache:t,disabled:e}){const[n,r]=M.useState(!1),i=()=>{r(!0)},o=()=>{r(!1),t()};return u.jsxs(u.Fragment,{children:[u.jsx(tz,{name:"Clear All Caches",description:"Clear cached data and reload to fetch fresh data from Firestore",onAction:i,actionText:"Clear & Reload",actionIcon:"",disabled:e,isDestructive:!0}),u.jsxs(us,{isOpen:n,onClose:()=>r(!1),title:"Clear Caches & Reload?",children:[u.jsx("p",{style:{margin:"0 0 1rem 0",opacity:.8},children:"This will clear all cached data and reload the page. The app will fetch fresh data from Firestore for everything."}),u.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[u.jsx(Ve,{variant:"secondary",actionName:"Cancel Clear Caches",onClick:()=>r(!1),children:"Cancel"}),u.jsx(Ve,{variant:"danger",actionName:"Confirm Clear Caches & Reload",onClick:o,children:"Clear & Reload"})]})]})]})}function dz({disabled:t,onDownloadBackup:e,isDownloadingBackup:n,budgetDownloadUpload:r,deleteAllMonths:i,deleteSampleUserBudget:o,onClearCache:l}){const d=r.isDownloading||r.isUploading||i.isDeleting||o.isDeleting,h=Co({migrationName:"Delete All Months",isDestructive:!0,onDownloadBackup:e}),m=Co({migrationName:"Delete Sample User Budget",isDestructive:!0,onDownloadBackup:e}),p=Co({migrationName:"Upload Budget",isDestructive:!0,onDownloadBackup:e});return u.jsxs(u.Fragment,{children:[u.jsxs(W0,{title:"Utilities",icon:"",description:"Administrative utilities for data management, downloads, and cache control.",type:"utility",isAnyRunning:d,children:[u.jsx(oz,{isDownloading:r.isDownloading,downloadProgress:r.downloadProgress,downloadError:r.downloadError,onDownload:r.downloadBudget,isScanning:r.isScanning,isUploading:r.isUploading,uploadStatus:r.uploadStatus,uploadProgress:r.uploadProgress,uploadError:r.uploadError,uploadResult:r.uploadResult,onScan:r.scanZipFile,onUpload:async g=>{p.promptBeforeAction(()=>{r.uploadBudget(g).catch(v=>console.error("Upload failed:",v))})},disabled:t}),u.jsxs("div",{style:{marginTop:"0.75rem",paddingTop:"0.75rem",borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},children:[u.jsx("div",{style:{fontSize:"0.75rem",opacity:.5,textTransform:"uppercase",letterSpacing:"0.05em",marginBottom:"0.5rem",paddingLeft:"0.5rem"},children:"Destructive Actions"}),u.jsx(lz,{status:i.status,hasData:i.hasData,monthsCount:i.monthsCount,budgetCount:i.budgetCount,isChecking:i.isScanning,isDeleting:i.isDeleting,deleteResult:i.deleteResult,deleteProgress:i.deleteProgress,onCheck:i.scanStatus,onDelete:()=>h.promptBeforeAction(i.deleteAllMonths),disabled:t}),u.jsx(cz,{status:o.status,hasData:o.hasData,totalBudgets:o.totalBudgets,totalMonths:o.totalMonths,isChecking:o.isScanning,isDeleting:o.isDeleting,deleteResult:o.deleteResult,deleteProgress:o.deleteProgress,onCheck:o.scanStatus,onDelete:()=>m.promptBeforeAction(o.deleteSampleUserBudget),disabled:t}),u.jsx(uz,{onClearCache:l,disabled:t})]})]}),u.jsx(So,{...h.promptProps,isDownloading:n}),u.jsx(So,{...m.promptProps,isDownloading:n}),u.jsx(So,{...p.promptProps,isDownloading:n})]})}function Y0({message:t="Loading...",spinnerColor:e=me.primary,children:n,spinnerSize:r=4}){return u.jsxs("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(15, 15, 20, 0.95)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",zIndex:9999,gap:"1.5rem",backdropFilter:"blur(4px)"},children:[u.jsx("div",{style:{width:`${r}rem`,height:`${r}rem`,border:"3px solid rgba(255, 255, 255, 0.15)",borderTopColor:e,borderRadius:"50%",animation:"loadingOverlaySpin 0.8s linear infinite"}}),u.jsx("p",{style:{color:"rgba(255, 255, 255, 0.95)",fontSize:"1.2rem",fontWeight:600,letterSpacing:"0.02em",margin:0},children:t}),n,u.jsx("style",{children:`
        @keyframes loadingOverlaySpin {
          to { transform: rotate(360deg); }
        }
      `})]})}function tA({percent:t,gradient:e="linear-gradient(90deg, #646cff, #8b5cf6)",width:n=300}){return u.jsx("div",{style:{width:`${n}px`,height:"8px",background:"rgba(255, 255, 255, 0.1)",borderRadius:"4px",overflow:"hidden"},children:u.jsx("div",{style:{width:`${t}%`,height:"100%",background:e,borderRadius:"4px",transition:"width 0.3s ease-out"}})})}function Of({value:t,label:e,color:n="#646cff"}){return u.jsxs("div",{style:{textAlign:"center"},children:[u.jsx("p",{style:{color:n,fontSize:"1.5rem",fontWeight:700,margin:0},children:t}),u.jsx("p",{style:{color:"rgba(255, 255, 255, 0.6)",fontSize:"0.8rem",margin:"0.25rem 0 0",textTransform:"uppercase",letterSpacing:"0.05em"},children:e})]})}function nA({percent:t}){return u.jsxs("p",{style:{color:"rgba(255, 255, 255, 0.5)",fontSize:"0.9rem",margin:0},children:[t,"% complete"]})}function hz(){return u.jsxs("div",{style:Rf,children:[u.jsx("nav",{style:{marginBottom:"1rem",display:"flex",alignItems:"center"},children:u.jsx(An,{to:"/",style:{display:"flex",alignItems:"center"},title:"Tarron Lane Home",children:u.jsx("img",{src:"/t-icon.svg",alt:"Tarron Lane Home",style:{width:"2rem",height:"2rem"}})})}),u.jsx("h1",{children:"Tarron Lane Homepage"}),u.jsx("nav",{children:u.jsxs("ul",{children:[u.jsx("li",{children:u.jsx(An,{to:"/sql-test",children:"SQL Test"})}),u.jsx("li",{children:u.jsx(An,{to:"/budget",children:"Budget"})}),u.jsx("li",{children:u.jsx(An,{to:"/account",children:"Account"})})]})})]})}function fz(){const t=M.useContext(ud),e=Na(),[n,r]=M.useState(!1),i=Nn(),o=Qu(),l=i.state?.from||"/";M.useEffect(()=>{t.is_logged_in&&l!=="/"&&o(l,{replace:!0})},[t.is_logged_in,l,o]);function d(){r(!0),e.logout_firebase_user().then(function(){Le.clear(),window.location.href="/"})}return u.jsxs("div",{style:Rf,children:[u.jsxs("nav",{style:{marginBottom:"1rem",display:"grid",gridTemplateColumns:"1fr auto 1fr",alignItems:"center"},children:[u.jsx("div",{style:{display:"flex",alignItems:"center"},children:u.jsx(An,{to:"/",style:{opacity:.6,fontSize:"1.5rem",textDecoration:"none",padding:"0.25rem 0.5rem"},title:"Back to Home",children:""})}),u.jsxs(An,{to:"/",style:{display:"flex",alignItems:"center",gap:"0.5rem",textDecoration:"none",color:"inherit"},title:"Tarron Lane Home",children:[u.jsx("img",{src:"/t-icon.svg",alt:"Tarron Lane",style:{width:"1.5rem",height:"1.5rem"}}),u.jsx("span",{style:{fontWeight:600,fontSize:"1.1rem"},children:"Account"})]}),u.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:u.jsx(QT,{items:[{label:"Budget",icon:"",to:"/budget"},{label:"Account",icon:"",to:"/account"}]})})]}),u.jsx("h1",{children:"Account"}),t.is_logged_in?n?u.jsx("p",{children:"Logging Out..."}):u.jsxs(u.Fragment,{children:[u.jsxs("p",{children:["You are logged in as ",t.username]}),u.jsx("button",{onClick:d,style:{marginTop:"1rem"},children:"Logout"})]}):u.jsx(mz,{})]})}function mz(){const t=Na(),[e,n]=M.useState(""),[r,i]=M.useState(""),[o,l]=M.useState(!1),[d,h]=M.useState(!1),[m,p]=M.useState("");function g(C){n(C.target.value)}function v(C){i(C.target.value)}function b(C){C.preventDefault(),h(!0),p(""),Le.clear(),t.login_firebase_user(e,r).then(function(){}).catch(function(){p("Incorrect login credentials")}).finally(function(){h(!1)})}return u.jsxs("form",{onSubmit:b,children:[u.jsxs("div",{children:[u.jsx("label",{htmlFor:"username",children:"Email: "}),u.jsx("input",{id:"username",type:"email",value:e,onChange:g})]}),u.jsxs("div",{children:[u.jsx("label",{htmlFor:"password",children:"Password: "}),u.jsxs("div",{style:{display:"inline-flex",alignItems:"center",position:"relative"},children:[u.jsx("input",{id:"password",type:o?"text":"password",value:r,onChange:v,style:{paddingRight:"2rem"}}),u.jsx("button",{type:"button",onClick:()=>l(!o),style:{position:"absolute",right:"0.25rem",background:"none",border:"none",cursor:"pointer",padding:"0.25rem",opacity:.6,fontSize:"1rem"},title:o?"Hide password":"Show password",children:o?"":""})]})]}),d?u.jsx("p",{children:"Logging in..."}):u.jsx("button",{children:"Login"}),m&&u.jsx("p",{style:{color:"red"},children:m})]})}const pz={categories:"balances",accounts:"balances",income:"transactions",spend:"transactions",transfers:"transactions",adjustments:"transactions"},gz={balances:"categories",transactions:"income"};function yz({activeTab:t,setActiveTab:e,allocationsFinalized:n}){const r=pz[t],i=M.useMemo(()=>[{id:"balances",label:"Balances"},{id:"transactions",label:"Transactions"}],[]),o=M.useMemo(()=>[{id:"categories",label:"Categories",checkmark:n},{id:"accounts",label:"Accounts"}],[n]),l=M.useMemo(()=>[{id:"income",label:"Income"},{id:"spend",label:"Spend"},{id:"transfers",label:"Transfers"},{id:"adjustments",label:"Adjustments"}],[]),d=m=>{e(gz[m])},h=r==="balances"?o:l;return u.jsxs("div",{children:[u.jsx(Df,{mode:"button",tabs:i,activeTab:r,onTabChange:d,variant:"segmented"}),u.jsx(Df,{mode:"button",tabs:h,activeTab:t,onTabChange:m=>e(m),variant:"secondary"})]})}function _z({isOpen:t,onClose:e,onProceed:n,results:r}){const[i,o]=M.useState("from_current"),l=!r||r.status==="confirming",d=r&&!["confirming","done","error"].includes(r.status),h=l||r?.status==="done"||r?.status==="error";function m(){h&&(e(),o("from_current"))}function p(){n(i)}return u.jsx(us,{isOpen:t,onClose:m,title:"Recalculate Balances",width:"540px",children:u.jsxs("div",{style:{padding:"0.5rem 0"},children:[l&&u.jsxs(u.Fragment,{children:[u.jsx("p",{style:{margin:"0 0 1rem 0",fontSize:"0.95rem",lineHeight:1.5},children:"Choose what to recalculate:"}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem",marginBottom:"1.5rem"},children:[u.jsx(F1,{selected:i==="from_current",onClick:()=>o("from_current"),title:"From current month forward",description:"Recalculate from this month onward. Use for quick fixes."}),u.jsx(F1,{selected:i==="all_months",onClick:()=>o("all_months"),title:"All months from beginning",description:"Recalculate entire history. Use after migrations or data repairs.",recommended:!0})]}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem",marginBottom:"1.5rem"},children:[u.jsx(jl,{status:"waiting",label:"Find all months to process"}),u.jsx(jl,{status:"waiting",label:"Process months"}),u.jsx(jl,{status:"waiting",label:"Update budget totals"})]}),u.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[u.jsx(Ve,{variant:"secondary",actionName:"Cancel Recalculation",onClick:e,children:"Cancel"}),u.jsx(Ve,{actionName:"Proceed with Recalculation",onClick:p,children:"Proceed"})]})]}),!l&&u.jsxs(u.Fragment,{children:[u.jsx("p",{style:{margin:"0 0 1.5rem 0",fontSize:"0.9rem",opacity:.7},children:"Recalculating category balances and account balances..."}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:[u.jsx(jl,{status:r?.status==="pending"?"waiting":"complete",label:"Find all months to process",detail:r&&r.status!=="pending"?`Found ${r.monthsFound||0} month${r.monthsFound!==1?"s":""}`:void 0}),u.jsx(jl,{status:U1(r?.status,["pending","finding_months"],"processing_months"),label:"Process months",detail:r?.status==="processing_months"?`Processing: ${r.currentMonthLabel} (${(r.currentMonthIndex||0)+1}/${r.monthsFound||0})`:r?.monthsProcessed!==void 0?`Processed ${r.monthsProcessed} month${r.monthsProcessed!==1?"s":""}`:void 0}),u.jsx(jl,{status:r?.status==="error"?"error":U1(r?.status,["pending","finding_months","processing_months"],"updating_budget"),label:"Update budget totals",detail:r?.status==="error"?r.error:void 0,isError:r?.status==="error"})]}),r?.status==="done"&&u.jsxs("div",{style:{marginTop:"1.5rem",padding:"1rem",background:`color-mix(in srgb, ${me.success} 10%, transparent)`,border:`1px solid ${me.success}`,borderRadius:"8px",textAlign:"center"},children:[u.jsx("p",{style:{margin:0,fontWeight:600,color:me.success},children:" Recalculation complete!"}),u.jsxs("p",{style:{margin:"0.5rem 0 0 0",fontSize:"0.9rem",opacity:.8},children:[r.monthsProcessed," month",r.monthsProcessed!==1?"s":""," processed",u.jsx("br",{}),"Total Income: ",_t(r.totalIncomeRecalculated||0),u.jsx("br",{}),"Total Expenses: ",_t(r.totalExpensesRecalculated||0)]})]}),(r?.status==="done"||r?.status==="error")&&u.jsx("div",{style:{marginTop:"1.5rem",display:"flex",justifyContent:"center"},children:u.jsx(Ve,{actionName:"Close Recalculation Modal",onClick:e,children:"Done"})}),d&&u.jsx("p",{style:{marginTop:"1.5rem",textAlign:"center",fontSize:"0.85rem",opacity:.6},children:"Please wait, do not close this window..."})]})]})})}function U1(t,e,n){return!t||e.includes(t)?t===n?"active":"waiting":t===n?"active":"complete"}function jl({status:t,label:e,detail:n,isError:r}){const i=t==="waiting"?"":t==="active"?"":t==="error"?"":"";return u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[u.jsx("span",{style:{fontSize:"1.1rem",width:"1.5rem",textAlign:"center"},children:i}),u.jsxs("div",{style:{flex:1},children:[u.jsx("p",{style:{margin:0,fontWeight:500},children:e}),n&&u.jsx("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.85rem",opacity:r?1:.6,color:r?me.error:"inherit"},children:n})]})]})}function F1({selected:t,onClick:e,title:n,description:r,recommended:i}){return u.jsxs("button",{type:"button",onClick:e,style:{display:"flex",alignItems:"flex-start",gap:"0.75rem",padding:"0.75rem 1rem",background:t?"color-mix(in srgb, #646cff 15%, transparent)":"color-mix(in srgb, currentColor 5%, transparent)",border:t?"2px solid #646cff":"2px solid transparent",borderRadius:"8px",cursor:"pointer",textAlign:"left",width:"100%",transition:"all 0.15s ease"},children:[u.jsx("span",{style:{width:"20px",height:"20px",borderRadius:"50%",border:t?"6px solid #646cff":"2px solid rgba(128,128,128,0.5)",flexShrink:0,marginTop:"2px",background:t?"white":"transparent"}}),u.jsxs("div",{style:{flex:1},children:[u.jsxs("p",{style:{margin:0,fontWeight:600,fontSize:"0.95rem"},children:[n,i&&u.jsx("span",{style:{marginLeft:"0.5rem",padding:"0.15rem 0.5rem",background:me.success,color:"white",borderRadius:"4px",fontSize:"0.7rem",fontWeight:500,verticalAlign:"middle"},children:"RECOMMENDED"})]}),u.jsx("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.85rem",opacity:.7},children:r})]})]})}function Qg(t){return t==="no_category"||t==="NO_CATEGORY"}function bz(t,e){const n={};for(const r of t)Qg(r.from_category_id)||(n[r.from_category_id]=(n[r.from_category_id]||0)-r.amount),Qg(r.to_category_id)||(n[r.to_category_id]=(n[r.to_category_id]||0)+r.amount);for(const r of e)Qg(r.category_id)||(n[r.category_id]=(n[r.category_id]||0)+r.amount);for(const r of Object.keys(n))n[r]=Me(n[r]);return n}async function vz(t,e,n,r,i,o,l){const d=ms(t,e.year,e.month),{exists:h,data:m}=await Rt("months",d,"recalculate: reading full month data");if(!h||!m)return null;const p=m.income||[],g=m.expenses||[],v=m.transfers||[],b=m.adjustments||[],C=m.are_allocations_finalized||!1,x=Me(p.reduce((j,N)=>j+N.amount,0)),S=Me(g.reduce((j,N)=>j+N.amount,0)),E={};if(m.category_balances)for(const j of m.category_balances)E[j.category_id]={allocated:j.allocated??0};const T=bz(v,b),I=n.map(j=>{const N=Me(i[j]??0);let F=0;C&&E[j]&&(F=Me(E[j].allocated));let q=0;g.length>0&&(q=Me(g.filter(W=>W.category_id===j).reduce((W,H)=>W+H.amount,0)));const A=T[j]??0,P=Me(v.filter(W=>W.from_category_id===j||W.to_category_id===j).reduce((W,H)=>H.from_category_id===j?W-H.amount:H.to_category_id===j?W+H.amount:W,0)),O=Me(b.filter(W=>W.category_id===j).reduce((W,H)=>W+H.amount,0)),X=Me(N+F+q+A);return{category_id:j,start_balance:N,allocated:F,spent:q,transfers:P,adjustments:O,end_balance:X}});I.forEach(j=>{i[j.category_id]=j.end_balance});const D=Object.keys(r),B={},$=D.map(j=>{const N=Me(p.filter(H=>H.account_id===j).reduce((H,Z)=>H+Z.amount,0)),F=Me(g.filter(H=>H.account_id===j).reduce((H,Z)=>H+Z.amount,0)),q=Me(v.filter(H=>H.from_account_id===j).reduce((H,Z)=>H-Z.amount,0)),A=Me(v.filter(H=>H.to_account_id===j).reduce((H,Z)=>H+Z.amount,0)),P=Me(b.filter(H=>H.account_id===j).reduce((H,Z)=>H+Z.amount,0)),O=Me(N+F+q+A+P);B[j]=O;const X=Me(o[j]??0),W=Me(q+A);return{account_id:j,start_balance:X,income:N,expenses:F,transfers:W,adjustments:P,net_change:O,end_balance:Me(X+O)}});for(const j of $)o[j.account_id]=j.end_balance;return{updatedMonth:{budget_id:t,year_month_ordinal:gt(e.year,e.month),year:e.year,month:e.month,income:p,total_income:x,previous_month_income:l,expenses:g,total_expenses:S,transfers:v,adjustments:b,account_balances:$,category_balances:I,are_allocations_finalized:C,created_at:m.created_at||new Date().toISOString(),updated_at:new Date().toISOString()},totalIncome:x,totalExpenses:S,accountNetChanges:B}}function X0({isDisabled:t,onCloseMenu:e}){const{selectedBudgetId:n,currentYear:r,currentMonthNumber:i}=Ye(),{categories:o,accounts:l}=Rn(),{updateAccounts:d}=PT(),{updateCategories:h}=zT(),[m,p]=M.useState(!1),[g,v]=M.useState(!1),[b,C]=M.useState(null);function x(){v(!0),C({status:"confirming"})}async function S(T){if(n){p(!0),C({status:"pending"});try{C({status:"finding_months"});let I;if(T==="all_months")I=(await On("months","recalculate: querying all months for full recalculation",[{field:"budget_id",op:"==",value:n}])).docs.map(P=>({year:P.data.year,month:P.data.month})).sort((P,O)=>P.year!==O.year?P.year-O.year:P.month-O.month);else{const A=new Date,P=r||A.getFullYear(),O=i||A.getMonth()+1,{year:X,month:W}=Zl(P,O);I=await L6(n,X,W)}const D=Object.keys(o);C({status:"finding_months",monthsFound:I.length}),await new Promise(A=>setTimeout(A,100));const B={},$={};if(T==="from_current"){const A=new Date,P=r||A.getFullYear(),O=i||A.getMonth()+1,{year:X,month:W}=Zl(P,O),H=ms(n,X,W),{exists:Z,data:Y}=await Rt("months",H,"recalculate: reading previous month for starting balances");if(Z&&Y?.category_balances)for(const se of Y.category_balances)B[se.category_id]=se.end_balance??0;if(Z&&Y?.account_balances)for(const se of Y.account_balances)$[se.account_id]=se.end_balance??0}D.forEach(A=>{B[A]===void 0&&(B[A]=0)}),Object.keys(l).forEach(A=>{$[A]===void 0&&($[A]=0)});let k=0,j=0,N=0;for(let A=0;A<I.length;A++){const P=I[A],O=`${Fu[P.month-1]} ${P.year}`;C({status:"processing_months",monthsFound:I.length,currentMonthIndex:A,currentMonthLabel:O});const X=await vz(n,P,D,l,B,$,N);X&&(k+=X.totalIncome,j+=X.totalExpenses,N=X.totalIncome,await ET({budgetId:n,month:X.updatedMonth,description:"recalculate all months"}),await new Promise(W=>setTimeout(W,50)))}const F={};Object.entries(l).forEach(([A,P])=>{F[A]={...P,balance:$[A]??0}}),await d.mutateAsync({budgetId:n,accounts:F}),C({status:"updating_budget",monthsFound:I.length,monthsProcessed:I.length,totalIncomeRecalculated:k,totalExpensesRecalculated:j});const q={};Object.entries(o).forEach(([A,P])=>{q[A]={...P,balance:B[A]??0}}),await h.mutateAsync({budgetId:n,categories:q});for(const A of I)Le.invalidateQueries({queryKey:Ie.month(n,A.year,A.month)});C({status:"done",monthsFound:I.length,monthsProcessed:I.length,totalIncomeRecalculated:k,totalExpensesRecalculated:j})}catch(I){console.error("Recalculate error:",I),C({status:"error",error:I instanceof Error?I.message:"Failed to recalculate"})}finally{p(!1)}}}function E(){v(!1),C(null),e?.()}return u.jsxs(u.Fragment,{children:[u.jsxs("button",{onClick:x,disabled:t||m,style:{background:"color-mix(in srgb, currentColor 15%, transparent)",border:"1px solid rgba(255,255,255,0.2)",borderRadius:"6px",padding:"0.4rem 0.75rem",cursor:t||m?"not-allowed":"pointer",opacity:t||m?.5:1,fontSize:"0.9rem",fontWeight:500,display:"flex",alignItems:"center",justifyContent:"center",gap:"0.4rem",transition:"all 0.15s ease"},onMouseEnter:T=>{!t&&!m&&(T.currentTarget.style.background="color-mix(in srgb, currentColor 20%, transparent)",T.currentTarget.style.borderColor="rgba(255,255,255,0.3)")},onMouseLeave:T=>{!t&&!m&&(T.currentTarget.style.background="color-mix(in srgb, currentColor 15%, transparent)",T.currentTarget.style.borderColor="rgba(255,255,255,0.2)")},title:"Recalculate balances from this month forward",children:[m?"":""," Recalculate"]}),u.jsx(_z,{isOpen:g,onClose:E,onProceed:S,results:b})]})}function V1({direction:t,isDisabled:e,isLoading:n,disabledReason:r,onNavigate:i}){const[o,l]=M.useState(!1),d=n||e,h=t==="prev"?"":"",m=t==="prev"?"Previous month":"Next month",p=()=>{n||(e?(l(!0),setTimeout(()=>l(!1),2e3)):i())};return u.jsxs("div",{style:{position:"relative"},children:[u.jsx("button",{onClick:p,onMouseEnter:()=>e&&l(!0),onMouseLeave:()=>l(!1),style:{background:"color-mix(in srgb, currentColor 10%, transparent)",border:"none",borderRadius:"8px",padding:"0.75rem 1rem",cursor:d?"not-allowed":"pointer",fontSize:"1.25rem",opacity:d?.5:1,transition:"opacity 0.15s, background 0.15s"},title:e?void 0:m,children:h}),o&&e&&u.jsx("div",{style:{position:"absolute",top:"100%",...t==="prev"?{left:0}:{right:0},marginTop:"0.5rem",padding:"0.5rem 0.75rem",background:me.warning,color:"#000",borderRadius:"6px",fontSize:"0.75rem",fontWeight:500,width:"max-content",maxWidth:"min(300px, 50vw)",textAlign:"center",zIndex:20,boxShadow:"0 2px 8px rgba(0,0,0,0.3)"},children:r})]})}function xz({pickerYear:t,pickerMonth:e,currentYear:n,currentMonthNumber:r,minOrdinal:i,maxOrdinal:o,minAllowed:l,maxAllowed:d,onYearChange:h,onMonthChange:m,onGo:p}){const g=t>l.year,v=t<d.year,b=Number(gt(t,e)),C=b>=i&&b<=o;return u.jsxs("div",{style:{padding:"0.75rem",borderTop:"1px solid color-mix(in srgb, currentColor 15%, transparent)",marginTop:"0.25rem"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.5rem"},children:[u.jsx("button",{onClick:()=>h(t-1),disabled:!g,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",border:"none",borderRadius:"4px",padding:"0.25rem 0.5rem",cursor:g?"pointer":"not-allowed",fontSize:"0.8rem",opacity:g?1:.3},title:g?"Previous year":"Cannot go further back",children:""}),u.jsx("span",{style:{flex:1,textAlign:"center",fontSize:"0.9rem",fontWeight:500},children:t}),u.jsx("button",{onClick:()=>h(t+1),disabled:!v,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",border:"none",borderRadius:"4px",padding:"0.25rem 0.5rem",cursor:v?"pointer":"not-allowed",fontSize:"0.8rem",opacity:v?1:.3},title:v?"Next year":"Cannot go further ahead",children:""})]}),u.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"0.25rem",marginBottom:"0.5rem"},children:Fu.map((x,S)=>{const E=S+1,T=E===e,I=t===n&&E===r,D=Number(gt(t,E)),B=D<i,$=D>o,k=B||$;let j=x;return B?j="Too far in the past":$&&(j="Too far in the future"),u.jsx("button",{onClick:()=>m(E),disabled:k,style:{background:T?me.primary:"color-mix(in srgb, currentColor 8%, transparent)",border:I?`1px solid ${me.primary}`:"1px solid transparent",borderRadius:"4px",padding:"0.35rem 0.25rem",cursor:k?"not-allowed":"pointer",fontSize:"0.7rem",color:T?"#fff":"inherit",opacity:k?.3:1,transition:"background 0.15s"},title:j,children:x.slice(0,3)},E)})}),u.jsxs("button",{onClick:p,disabled:!C,style:{width:"100%",background:C?me.primary:"color-mix(in srgb, currentColor 20%, transparent)",border:"none",borderRadius:"6px",padding:"0.5rem",cursor:C?"pointer":"not-allowed",fontSize:"0.85rem",color:C?"#fff":"inherit",fontWeight:500,opacity:C?1:.5},children:["Go to ",Fu[e-1]," ",t]})]})}function wz({isOpen:t,onClose:e,year:n,month:r,isDeleting:i,onConfirm:o}){return u.jsxs(us,{isOpen:t,onClose:e,title:" Delete Month?",children:[u.jsx("div",{style:{background:"color-mix(in srgb, #ef4444 15%, transparent)",border:"1px solid color-mix(in srgb, #ef4444 40%, transparent)",borderRadius:"8px",padding:"1rem",marginBottom:"1rem"},children:u.jsxs("p",{style:{margin:0,color:"#fca5a5",fontWeight:500,fontSize:"0.95rem"},children:[" This will permanently delete ",Fu[r-1]," ",n,"!"]})}),u.jsx("p",{style:{margin:"0 0 0.75rem",opacity:.9},children:"This month document and all its data (income, expenses, allocations) will be permanently deleted."}),u.jsx("p",{style:{margin:"0 0 1rem",opacity:.8,fontSize:"0.9rem"},children:"After deletion, you will be navigated to the previous month."}),u.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[u.jsx(Ve,{variant:"secondary",actionName:"Cancel Delete Month",onClick:e,disabled:i,children:"Cancel"}),u.jsx(Ve,{variant:"danger",actionName:"Confirm Delete Month",onClick:o,disabled:i,children:i?"Deleting...":" Delete Month"})]})]})}function Sz(){const t=new Date;let e=t.getFullYear(),n=t.getMonth()+1+Ra;for(;n>12;)n-=12,e+=1;return{year:e,month:n}}function Cz(){const t=new Date;let e=t.getFullYear(),n=t.getMonth()+1-jf;for(;n<1;)n+=12,e-=1;return{year:e,month:n}}function Ez(t){return Object.keys(t).sort()[0]}function Tz(t){const e=parseInt(t.slice(0,4),10),n=parseInt(t.slice(4,6),10);return{year:e,month:n}}function Az(t){const e=Cz(),n=Ez(t);if(!n)return e;const r=gt(e.year,e.month);return n<r?Tz(n):e}function $1(t,e){return e===1?{year:t-1,month:12}:{year:t,month:e-1}}function jz(t,e){return e===12?{year:t+1,month:1}:{year:t,month:e+1}}function Rz({onPreviousMonth:t,onNextMonth:e}){const{isLoading:n}=Qn(),{currentYear:r,currentMonthNumber:i,isAdmin:o,selectedBudgetId:l,setCurrentYear:d,setCurrentMonthNumber:h}=Ye(),{budget:m,monthMap:p}=Rn(),{month:g}=Qs(l,r,i),v=$1(r,i),b=jz(r,i),C=Az(p),x=Sz(),S=Number(gt(C.year,C.month)),E=Number(gt(x.year,x.month)),T=Number(gt(v.year,v.month)),I=Number(gt(b.year,b.month)),D=T<S,B=I>E,[$,k]=M.useState(!1),[j,N]=M.useState(!1),[F,q]=M.useState(r),[A,P]=M.useState(i),[O,X]=M.useState(!1),[W,H]=M.useState(!1),Z=M.useRef(null),Y=(()=>{if(!p||Object.keys(p).length===0)return!1;const te=gt(r,i),ue=Math.max(...Object.keys(p).map(Number));return Number(te)===ue})(),{trackChange:se}=mc();async function L(){if(l){H(!0);try{const te=ms(l,r,i);H6(l,r,i,se),await Iy("months",te,`deleting month ${r}/${i}`),`${r}${i}`,Le.removeQueries({queryKey:Ie.month(l,r,i)});const ue=$1(r,i);X(!1),k(!1),window.location.href=`/budget/${ue.year}/${ue.month}/categories`}catch(te){console.error("Failed to delete month:",te),alert(`Failed to delete month: ${te instanceof Error?te.message:"Unknown error"}`)}finally{H(!1)}}}M.useEffect(()=>{if(!$)return;function te(ue){Z.current&&!Z.current.contains(ue.target)&&(k(!1),N(!1))}return document.addEventListener("mousedown",te),()=>document.removeEventListener("mousedown",te)},[$]);function G(){j||(q(r),P(i)),N(!j)}function ne(){d(F),h(A),N(!1),k(!1)}async function ie(){if(!g||!m)return;const te=new Date,ve=`${te.toISOString().split("T")[0]}_month_${r}_${String(i).padStart(2,"0")}`,ce=new xm,be=[{name:`${ve}_income.json`,data:g.income||[]},{name:`${ve}_expenses.json`,data:g.expenses||[]},{name:`${ve}_transfers.json`,data:g.transfers||[]},{name:`${ve}_adjustments.json`,data:g.adjustments||[]},{name:`${ve}_account_balances.json`,data:g.account_balances||[]},{name:`${ve}_category_balances.json`,data:g.category_balances||[]}],ze={budget_id:m.id,budget_name:m.name,year_month_ordinal:g.year_month_ordinal,year:g.year,month:g.month,total_income:g.total_income,previous_month_income:g.previous_month_income,total_expenses:g.total_expenses,are_allocations_finalized:g.are_allocations_finalized,created_at:g.created_at,updated_at:g.updated_at,downloaded_at:te.toISOString()};be.push({name:`${ve}_metadata.json`,data:ze});for(const U of be)ce.file(U.name,JSON.stringify(U.data,null,2));const Pe=await ce.generateAsync({type:"blob"}),at=URL.createObjectURL(Pe),bt=document.createElement("a");bt.href=at,bt.download=`${ve}.zip`,document.body.appendChild(bt),bt.click(),document.body.removeChild(bt),URL.revokeObjectURL(at),k(!1)}return u.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"1rem",marginBottom:"1.5rem",padding:"1rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"12px"},children:[u.jsx(V1,{direction:"prev",isDisabled:D,isLoading:n,disabledReason:"Cannot create months more than 3 months into the past",onNavigate:t}),u.jsxs("div",{ref:Z,style:{textAlign:"center",minWidth:"180px",position:"relative"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"flex-start",justifyContent:"center",gap:"0.25rem"},children:[u.jsxs("h2",{style:{margin:0,fontSize:"1.5rem"},children:[Fu[i-1]," ",r]}),u.jsx("button",{onClick:()=>k(!$),style:{background:"transparent",border:"none",cursor:"pointer",fontSize:"0.5rem",opacity:.4,padding:"0.15rem",borderRadius:"4px",transition:"opacity 0.15s, transform 0.15s",transform:$?"rotate(180deg)":"rotate(0deg)",marginTop:"0.25rem"},title:"Month options",children:""})]}),n&&u.jsxs(u.Fragment,{children:[u.jsx("style",{children:"@keyframes spin { to { transform: rotate(360deg); } }"}),u.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0.4rem",marginTop:"0.35rem"},children:[u.jsx("span",{style:{display:"inline-block",width:"14px",height:"14px",border:"2px solid color-mix(in srgb, currentColor 20%, transparent)",borderTopColor:me.primary,borderRadius:"50%",animation:"spin 0.8s linear infinite"}}),u.jsx("span",{style:{fontSize:"0.8rem",opacity:.6},children:"Loading..."})]})]}),$&&u.jsxs("div",{style:{position:"absolute",top:"100%",left:"50%",transform:"translateX(-50%)",marginTop:"0.5rem",background:"var(--background, #242424)",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",borderRadius:"8px",padding:"0.25rem",zIndex:100,minWidth:"160px",boxShadow:"0 4px 12px rgba(0,0,0,0.3)"},children:[u.jsx(X0,{isDisabled:n,onCloseMenu:()=>k(!1)}),u.jsx("button",{onClick:G,style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%",background:"transparent",border:"none",borderRadius:"6px",padding:"0.5rem 0.75rem",cursor:"pointer",fontSize:"0.85rem",color:"inherit",textAlign:"left",transition:"background 0.15s"},title:"Jump to a specific month",children:" Go to Month"}),j&&u.jsx(xz,{pickerYear:F,pickerMonth:A,currentYear:r,currentMonthNumber:i,minOrdinal:S,maxOrdinal:E,minAllowed:C,maxAllowed:x,onYearChange:q,onMonthChange:P,onGo:ne}),o&&g&&u.jsx("button",{onClick:()=>{ie()},style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%",background:"transparent",border:"none",borderRadius:"6px",padding:"0.5rem 0.75rem",cursor:"pointer",fontSize:"0.85rem",color:"inherit",textAlign:"left",transition:"background 0.15s"},title:"Download month document as JSON (for debugging)",children:" Download JSON"}),o&&g&&Y&&u.jsx("button",{onClick:()=>X(!0),style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%",background:"transparent",border:"none",borderRadius:"6px",padding:"0.5rem 0.75rem",cursor:"pointer",fontSize:"0.85rem",color:"#ef4444",textAlign:"left",transition:"background 0.15s"},title:"Delete this month (last month only)",children:" Delete Month"})]})]}),u.jsx(V1,{direction:"next",isDisabled:B,isLoading:n,disabledReason:"Cannot create months more than 3 months into the future",onNavigate:e}),u.jsx(wz,{isOpen:O,onClose:()=>X(!1),year:r,month:i,isDeleting:W,onConfirm:L})]})}const Z0={cursor:"pointer",fontSize:"0.9rem",padding:"0.35rem 0.5rem",borderRadius:"4px"},Iz={...Z0,background:me.primary,border:"none",color:"white"},kz={...Z0,background:"transparent",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)"},Dz={...Z0,background:"transparent",border:`1px solid ${me.errorBorder}`,color:me.error},q1=t=>({display:"flex",alignItems:"center",justifyContent:"center",width:"2.25rem",height:"100%",minHeight:"2.25rem",background:t?`color-mix(in srgb, ${me.error} 15%, transparent)`:`color-mix(in srgb, ${me.success} 15%, transparent)`,border:`1px solid ${t?me.errorBorder:"rgba(74, 222, 128, 0.4)"}`,borderRadius:"4px 0 0 4px",cursor:"pointer",fontSize:"1rem",fontWeight:600,color:t?me.error:me.success,transition:"all 0.15s ease",flexShrink:0});function J0({accounts:t,accountGroups:e,categories:n,categoryGroups:r,payees:i,initialData:o,defaultAccountId:l,defaultDate:d,config:h,onSubmit:m,onCancel:p,onDelete:g,extraContent:v}){const{isWide:b}=OT(),{showCategory:C=!1,showCleared:x=!1,showSignToggle:S=!1,accountLabel:E="Account",payeePlaceholder:T="Payee name",descriptionPlaceholder:I="Optional note",submitLabel:D}=h,B=new Date().toISOString().split("T")[0],[$,k]=M.useState(o?.date||d||B),[j,N]=M.useState(o?.payee||""),[F,q]=M.useState(o?.categoryId||(h.showNoCategoryOption?Xt:"")),[A,P]=M.useState(o?.accountId||l||(h.showNoAccountOption?Gt:t[0]?t[0][0]:"")),O=o?.amount!==void 0?Math.abs(o.amount):void 0,[X,W]=M.useState(O?.toString()||""),[H,Z]=M.useState(o?.description||""),[Y,se]=M.useState(o?.cleared||!1),[L,G]=M.useState(()=>S?o?.amount!==void 0?o.amount<0:!1:!0),[ne,ie]=M.useState(!1),te={},ue=[];t.forEach(([Se,ae])=>{ae.account_group_id?(te[ae.account_group_id]||(te[ae.account_group_id]=[]),te[ae.account_group_id].push([Se,ae])):ue.push([Se,ae])});function ve(Se){Se.preventDefault();const ae=parseFloat(X);if(isNaN(ae)||ae<=0||C&&!F||!A||!$)return;if(F===Xt&&A===Gt){ie(!0);return}ie(!1);const De=S&&L?-ae:ae;m({date:$,payee:j.trim()||void 0,categoryId:C?F:void 0,accountId:A,amount:De,description:H.trim()||void 0,cleared:x?Y:void 0})}!(F===Xt&&A===Gt)&&ne&&ie(!1);const Pe=h.showNoAccountOption?u.jsx(MT,{id:"txn-account",value:A,onChange:P,accounts:t,accountGroups:e,placeholder:ka,required:!0,showNoAccountOption:!0}):u.jsxs(qu,{id:"txn-account",value:A,onChange:Se=>P(Se.target.value),required:!0,style:{fontSize:"0.85rem",padding:"0.5rem"},children:[Object.entries(e).map(([Se,ae])=>{const Ae=te[Se];return Ae?.length?u.jsx("optgroup",{label:ae.name,children:Ae.map(([Oe,De])=>u.jsx("option",{value:Oe,children:De.nickname},Oe))},Se):null}),ue.length>0&&u.jsx("optgroup",{label:"Other",children:ue.map(([Se,ae])=>u.jsx("option",{value:Se,children:ae.nickname},Se))})]}),at=C&&n&&r?u.jsx(Bt,{label:"Category",htmlFor:"txn-category",children:u.jsx(DT,{id:"txn-category",value:F,onChange:q,categories:n,categoryGroups:r,placeholder:h.showNoCategoryOption?Do:"Search...",required:!0,showNoCategoryOption:h.showNoCategoryOption})}):null,bt=x?u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.25rem",paddingBottom:"0.35rem"},children:[u.jsx("label",{htmlFor:"txn-cleared",style:{fontSize:"0.75rem",opacity:.7,fontWeight:500},children:"Clr"}),u.jsx(Hr,{id:"txn-cleared",checked:Y,onChange:Se=>se(Se.target.checked)})]}):null,U=u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.25rem",paddingBottom:"0.1rem"},children:[u.jsx("span",{style:{fontSize:"0.75rem",opacity:.7,fontWeight:500},children:""}),u.jsxs("div",{style:{display:"flex",gap:"0.25rem"},children:[u.jsx("button",{type:"submit",title:D,style:Iz,children:""}),u.jsx("button",{type:"button",onClick:()=>{p()},title:"Cancel",style:kz,children:""}),g&&u.jsx("button",{type:"button",onClick:()=>{g()},title:"Delete",style:Dz,children:""})]})]}),he=ne?u.jsx("div",{style:{background:`color-mix(in srgb, ${me.error} 15%, transparent)`,border:`1px solid ${me.errorBorder}`,borderRadius:"6px",padding:"0.5rem 0.75rem",fontSize:"0.85rem",color:me.error},children:'Cannot select both "No Category" and "No Account"  at least one must be a real category or account.'}):null,ye=u.jsxs(La,{children:[u.jsx(Ve,{type:"submit",actionName:D,children:D}),u.jsx(Ve,{type:"button",variant:"secondary",actionName:"Cancel Transaction Form",onClick:p,children:"Cancel"}),g&&u.jsx(Ve,{type:"button",variant:"danger",actionName:"Delete Transaction",onClick:g,children:" Delete"})]}),ee=C&&n&&r,J={fontSize:"0.85rem",padding:"0.5rem"};if(!b)return u.jsxs(Ci,{actionName:D,onSubmit:ve,children:[u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:[u.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[u.jsx(Bt,{label:"Date",htmlFor:"txn-date",children:u.jsx(kf,{id:"txn-date",value:$,onChange:Se=>k(Se.target.value),required:!0,autoFocus:!0})}),u.jsx(Bt,{label:S?L?"Amount (Expense)":"Amount (Refund)":"Amount",htmlFor:"txn-amount",children:S?u.jsxs("div",{className:"currency-with-sign",style:{display:"flex",alignItems:"stretch"},children:[u.jsx("button",{type:"button",onClick:()=>G(!L),style:q1(L),title:L?"Click to make this a refund (+)":"Click to make this an expense (-)",children:L?"":"+"}),u.jsx("div",{style:{flex:1},children:u.jsx(wo,{id:"txn-amount",value:X,onChange:W,placeholder:"$0.00",required:!0,style:{borderTopLeftRadius:0,borderBottomLeftRadius:0,borderLeft:"none",color:L?me.error:me.success}})})]}):u.jsx(wo,{id:"txn-amount",value:X,onChange:W,placeholder:"$0.00",required:!0})})]}),u.jsx(Bt,{label:"Payee",htmlFor:"txn-payee",children:u.jsx(R1,{id:"txn-payee",value:j,onChange:N,payees:i,placeholder:T})}),at,u.jsx(Bt,{label:E,htmlFor:"txn-account",children:Pe}),u.jsx(Bt,{label:"Description (optional)",htmlFor:"txn-description",children:u.jsx(Ei,{id:"txn-description",value:H,onChange:Se=>Z(Se.target.value),placeholder:I})}),x&&u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx(Hr,{id:"txn-cleared-stacked",checked:Y,onChange:Se=>se(Se.target.checked)}),u.jsx("label",{htmlFor:"txn-cleared-stacked",style:{fontSize:"0.9rem",cursor:"pointer"},children:"Cleared (appeared in bank account)"})]}),he,v]}),ye]});const oe=S?"8.25rem":"6rem",Ce=ee?x?`6rem minmax(8rem, 1fr) minmax(8rem, 1fr) minmax(8rem, 1fr) ${oe} minmax(10rem, 2fr) auto auto`:`6rem minmax(8rem, 1fr) minmax(8rem, 1fr) minmax(8rem, 1fr) ${oe} minmax(10rem, 2fr) auto`:x?`6rem minmax(10rem, 1fr) minmax(10rem, 1fr) ${oe} minmax(12rem, 2fr) auto auto`:`6rem minmax(10rem, 1fr) minmax(10rem, 1fr) ${oe} minmax(12rem, 2fr) auto`;return u.jsxs(Ci,{actionName:D,onSubmit:ve,children:[u.jsxs("div",{style:{display:"grid",gridTemplateColumns:Ce,gap:"1rem",alignItems:"end"},children:[u.jsx(Bt,{label:"Date",htmlFor:"txn-date",children:u.jsx(kf,{id:"txn-date",value:$,onChange:Se=>k(Se.target.value),required:!0,style:J,autoFocus:!0})}),u.jsx(Bt,{label:"Payee",htmlFor:"txn-payee",children:u.jsx(R1,{id:"txn-payee",value:j,onChange:N,payees:i,placeholder:T})}),at,u.jsx(Bt,{label:E,htmlFor:"txn-account",children:Pe}),u.jsx(Bt,{label:S?L?"Amount ()":"Amount (+)":"Amount",htmlFor:"txn-amount",children:S?u.jsxs("div",{className:"currency-with-sign",style:{display:"flex",alignItems:"stretch"},children:[u.jsx("button",{type:"button",onClick:()=>G(!L),style:q1(L),title:L?"Click to make this a refund (+)":"Click to make this an expense (-)",children:L?"":"+"}),u.jsx("div",{style:{flex:1},children:u.jsx(wo,{id:"txn-amount",value:X,onChange:W,placeholder:"$0.00",required:!0,style:{borderTopLeftRadius:0,borderBottomLeftRadius:0,borderLeft:"none",color:L?me.error:me.success}})})]}):u.jsx(wo,{id:"txn-amount",value:X,onChange:W,placeholder:"$0.00",required:!0})}),u.jsx(Bt,{label:"Description",htmlFor:"txn-description",children:u.jsx(Ei,{id:"txn-description",value:H,onChange:Se=>Z(Se.target.value),placeholder:I,style:J})}),bt,U]}),he,v]})}function H1({accounts:t,accountGroups:e,payees:n,initialData:r,defaultAccountId:i,defaultDate:o,onSubmit:l,onCancel:d,onDelete:h,submitLabel:m}){function p(g){l(g.amount,g.accountId,g.date,g.payee,g.description)}return u.jsx(J0,{accounts:t,accountGroups:e,payees:n,initialData:r?{date:r.date,payee:r.payee,accountId:r.account_id,amount:r.amount,description:r.description}:void 0,defaultAccountId:i,defaultDate:o,config:{showCategory:!1,showCleared:!1,accountLabel:"Deposit To",payeePlaceholder:"e.g., Employer, Client name",descriptionPlaceholder:"e.g., January paycheck",submitLabel:m},onSubmit:p,onCancel:d,onDelete:h})}function Mz({income:t,accountName:e,accountGroupName:n,onEdit:r,onDelete:i,isMobile:o,isEvenRow:l}){const d=t.date?new Date(t.date+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"}):"",h=n?`${n} / ${e}`:e,m=l?"transparent":"rgba(255,255,255,0.04)";if(o)return u.jsxs("div",{onClick:r,style:{gridColumn:"1 / -1",display:"grid",gridTemplateColumns:"1fr auto",gap:"0.5rem",padding:"0.75rem 1rem",background:m,cursor:"pointer",transition:"background 0.15s"},children:[u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{style:{fontSize:"0.75rem",opacity:.5,fontFamily:"monospace",minWidth:"3rem"},children:d}),u.jsx("span",{style:{fontWeight:500,fontSize:"0.9rem"},children:t.payee||""})]}),u.jsxs("span",{style:{fontSize:"0.75rem",opacity:.6},children:[" ",h]})]}),u.jsx("div",{style:{display:"flex",alignItems:"center"},children:u.jsxs("span",{style:{fontWeight:600,color:me.success,fontFamily:"monospace"},children:["+",_t(t.amount)]})})]});const p={padding:"0.6rem 0.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem"};return u.jsxs("div",{style:{gridColumn:"1 / -1",background:m,display:"grid",gridTemplateColumns:"5rem 1.5fr 7rem 1fr 6rem 1fr 3rem 4rem"},children:[u.jsx("div",{style:{...p,fontSize:"0.85rem",fontFamily:"monospace"},children:u.jsx("span",{style:{opacity:.6},children:d})}),u.jsx("div",{style:{...p,fontWeight:500,overflow:"hidden"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.payee||""})}),u.jsx("div",{style:{...p,overflow:"hidden"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.85rem",opacity:.7},children:h})}),u.jsxs("div",{style:{...p,justifyContent:"flex-end",fontWeight:600,color:me.success,fontFamily:"monospace"},children:["+",_t(t.amount)]}),u.jsx("div",{style:{...p,paddingLeft:"0.5rem",overflow:"hidden"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.8rem",opacity:.6},children:t.description||""})}),u.jsxs("div",{style:{...p,justifyContent:"flex-end",gap:"0.25rem"},children:[u.jsx("button",{onClick:r,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:g=>g.currentTarget.style.opacity="1",onMouseLeave:g=>g.currentTarget.style.opacity="0.5",title:"Edit",children:""}),u.jsx("button",{onClick:i,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:g=>g.currentTarget.style.opacity="1",onMouseLeave:g=>g.currentTarget.style.opacity="0.5",title:"Delete",children:""})]})]})}const Rl={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderTop:"1px solid rgba(255,255,255,0.1)"};function Oz(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n,setCurrentYear:r,setCurrentMonthNumber:i}=Ye(),{accounts:o,accountGroups:l}=Rn(),{month:d,isLoading:h}=Qs(t,e,n),{addIncome:m}=jP(),{updateIncome:p}=IP(),{deleteIncome:g}=kP(),v=Ai(),[b,C]=M.useState(null),[x,S]=M.useState(!1),[E,T]=M.useState(null),B=z0(t,{enabled:x||E!==null}).data||[];function $(H){const Z=H.account_group_id?l[H.account_group_id]:void 0;return Z&&Z.is_active!==null?Z.is_active:H.is_active!==!1}function k(H){const Z=H.account_group_id?l[H.account_group_id]:void 0;return Z&&Z.on_budget!==null?Z.on_budget:H.on_budget!==!1}const j=Object.entries(o).filter(([,H])=>$(H)&&k(H)),N=j.filter(([,H])=>H.is_income_account),F=N.length>0?N:j,q=j.find(([,H])=>H.is_income_default),A=q?q[0]:void 0,P=d?.income.reduce((H,Z)=>H+Z.amount,0)||0;function O(H,Z,Y,se,L){if(!t)return;C(null),S(!1);const{year:G,month:ne}=fm(Y);(G!==e||ne!==n)&&(r(G),i(ne)),m(t,G,ne,H,Z,Y,se,L).catch(ie=>{C(ie instanceof Error?ie.message:"Failed to add income")})}function X(H,Z,Y,se,L,G){t&&(C(null),T(null),p(t,e,n,H,Z,Y,se,L,G).catch(ne=>{C(ne instanceof Error?ne.message:"Failed to update income")}))}function W(H){t&&confirm("Are you sure you want to delete this income entry?")&&(C(null),g(t,e,n,H).catch(Z=>{C(Z instanceof Error?Z.message:"Failed to delete income")}))}return u.jsxs("div",{style:{opacity:h?.5:1,transition:"opacity 0.15s ease-out",pointerEvents:h?"none":"auto"},children:[b&&u.jsx("div",{style:{background:`color-mix(in srgb, ${me.error} 15%, transparent)`,border:`1px solid ${me.error}`,borderRadius:"8px",padding:"0.75rem",marginBottom:"1rem",color:me.error},children:b}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:v?"1fr":"5rem 1.5fr 2fr 7rem 1.5fr 3rem"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"#242424",borderBottom:"1px solid rgba(255,255,255,0.15)",display:v?"block":"grid",gridTemplateColumns:v?void 0:"subgrid"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem"},children:[u.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[u.jsx("span",{style:{fontWeight:600},children:"Income:"}),u.jsx("span",{style:{opacity:.6,fontSize:"0.8rem"},children:"Incoming money that should be factored into income calculations"}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"Total: "}),u.jsx("span",{style:{color:ot(P),fontWeight:600},children:_t(P)})]})]}),u.jsx("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:!x&&u.jsx(Ve,{actionName:"Open Add Income Form",onClick:()=>S(!0),disabled:F.length===0,disabledReason:Object.keys(o).length===0?"Create an account first":"Set up an income account first",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:"+ Add Income"})})]}),!v&&u.jsxs(u.Fragment,{children:[u.jsx("div",{style:Rl,children:"Date"}),u.jsx("div",{style:Rl,children:"Payee"}),u.jsx("div",{style:Rl,children:"Account"}),u.jsx("div",{style:{...Rl,textAlign:"right"},children:"Amount"}),u.jsx("div",{style:Rl,children:"Description"}),u.jsx("div",{style:Rl})]})]}),u.jsx("div",{style:{gridColumn:"1 / -1",fontSize:"0.8rem",opacity:.55,fontStyle:"italic",padding:"0.5rem 0"},children:" All income entries on this page count towards the tithing owed calculation."}),F.length===0&&u.jsx(Hu,{message:Object.keys(o).length===0?"You need to create at least one account before adding income.":'No accounts are set up for income deposits. Edit an account and enable "Show in income deposit list".',linkText:"Manage accounts",linkTo:"/budget/settings/accounts"}),x&&u.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"1rem"},children:u.jsx(H1,{accounts:F,accountGroups:l,payees:B,defaultAccountId:A,defaultDate:hm(e,n),onSubmit:O,onCancel:()=>S(!1),submitLabel:"Add Income",isMobile:v})}),d?.income.slice().sort((H,Z)=>(H.date||"").localeCompare(Z.date||"")).map((H,Z)=>E===H.id?u.jsx("div",{style:{gridColumn:"1 / -1",padding:"0.5rem"},children:u.jsx(H1,{accounts:F,accountGroups:l,payees:B,initialData:H,onSubmit:(Y,se,L,G,ne)=>X(H.id,Y,se,L,G,ne),onCancel:()=>T(null),onDelete:()=>W(H.id),submitLabel:"Save",isMobile:v})},H.id):u.jsx(Mz,{income:H,accountName:Je(H.account_id)?ka:o[H.account_id]?.nickname||"Unknown Account",accountGroupName:Je(H.account_id)?void 0:o[H.account_id]?.account_group_id?l[o[H.account_id].account_group_id]?.name:void 0,onEdit:()=>{H.payee||`${H.amount}`,T(H.id)},onDelete:()=>W(H.id),isMobile:v,isEvenRow:Z%2===0},H.id)),(!d?.income||d.income.length===0)&&!x&&u.jsx("p",{style:{gridColumn:"1 / -1",opacity:.5,fontSize:"0.9rem",textAlign:"center",padding:"1.5rem"},children:"No income recorded for this month"}),u.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]})]})}function G1({accounts:t,accountGroups:e,categories:n,categoryGroups:r,payees:i,initialData:o,defaultAccountId:l,defaultDate:d,onSubmit:h,onCancel:m,onDelete:p,submitLabel:g}){function v(b){h(b.amount,b.categoryId,b.accountId,b.date,b.payee,b.description,b.cleared)}return u.jsx(J0,{accounts:t,accountGroups:e,categories:n,categoryGroups:r,payees:i,initialData:o?{date:o.date,payee:o.payee,categoryId:o.category_id,accountId:o.account_id,amount:o.amount,description:o.description,cleared:o.cleared}:void 0,defaultAccountId:l,defaultDate:d,config:{showCategory:!0,showCleared:!0,showNoCategoryOption:!1,showNoAccountOption:!1,showSignToggle:!0,accountLabel:"Pay From",payeePlaceholder:"e.g., Grocery Store",descriptionPlaceholder:"e.g., Weekly groceries",submitLabel:g},onSubmit:v,onCancel:m,onDelete:p})}function Nz({expense:t,categoryName:e,accountName:n,accountGroupName:r,onEdit:i,onDelete:o,isMobile:l,isEvenRow:d}){const h=t.date?new Date(t.date+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"}):"",m=r?`${r} / ${n}`:n,p=d?"transparent":"rgba(255,255,255,0.04)";if(l)return u.jsxs("div",{onClick:i,style:{gridColumn:"1 / -1",display:"grid",gridTemplateColumns:"1fr auto",gap:"0.5rem",padding:"0.75rem 1rem",background:p,cursor:"pointer",transition:"background 0.15s"},children:[u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{style:{fontSize:"0.75rem",opacity:.5,fontFamily:"monospace",minWidth:"3rem"},children:h}),u.jsx("span",{style:{fontWeight:500,fontSize:"0.9rem"},children:t.payee||""}),t.cleared&&u.jsx("span",{style:{fontSize:"0.7rem",color:me.success},title:"Cleared",children:""})]}),u.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap"},children:[u.jsx("span",{style:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px"},children:e}),u.jsxs("span",{style:{fontSize:"0.75rem",opacity:.6},children:[" ",m]})]})]}),u.jsx("div",{style:{display:"flex",alignItems:"center"},children:u.jsx("span",{style:{fontWeight:600,color:ot(t.amount),fontFamily:"monospace"},children:Lt(t.amount)})})]});const g={padding:"0.6rem 0.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem"};return u.jsxs("div",{style:{gridColumn:"1 / -1",background:p,display:"grid",gridTemplateColumns:"5rem 1.5fr 7rem 1fr 6rem 1fr 3rem 4rem"},children:[u.jsx("div",{style:{...g,fontSize:"0.85rem",fontFamily:"monospace"},children:u.jsx("span",{style:{opacity:.6},children:h})}),u.jsx("div",{style:{...g,fontWeight:500,overflow:"hidden"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.payee||""})}),u.jsx("div",{style:{...g,justifyContent:"center"},children:u.jsx("span",{style:{fontSize:"0.8rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e})}),u.jsx("div",{style:{...g,overflow:"hidden"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.85rem",opacity:.7},children:m})}),u.jsx("div",{style:{...g,justifyContent:"flex-end",fontWeight:600,color:ot(t.amount),fontFamily:"monospace"},children:Lt(t.amount)}),u.jsx("div",{style:{...g,paddingLeft:"0.5rem",overflow:"hidden"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.8rem",opacity:.6},children:t.description||""})}),u.jsx("div",{style:{...g,justifyContent:"center",color:t.cleared?me.success:"inherit",opacity:t.cleared?1:.3,fontSize:"1rem"},children:t.cleared?"":""}),u.jsxs("div",{style:{...g,justifyContent:"flex-end",gap:"0.25rem"},children:[u.jsx("button",{onClick:i,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:v=>v.currentTarget.style.opacity="1",onMouseLeave:v=>v.currentTarget.style.opacity="0.5",title:"Edit",children:""}),u.jsx("button",{onClick:o,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:v=>v.currentTarget.style.opacity="1",onMouseLeave:v=>v.currentTarget.style.opacity="0.5",title:"Delete",children:""})]})]})}const oa={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderTop:"1px solid rgba(255,255,255,0.1)"};function Pz(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n,setCurrentYear:r,setCurrentMonthNumber:i}=Ye(),{accounts:o,accountGroups:l,categories:d,categoryGroups:h}=Rn(),{month:m,isLoading:p}=Qs(t,e,n),{addExpense:g}=MP(),{updateExpense:v}=NP(),{deleteExpense:b}=PP(),C=Ai(),[x,S]=M.useState(null),[E,T]=M.useState(!1),[I,D]=M.useState(null),k=z0(t,{enabled:E||I!==null}).data||[];function j(Y){const se=Y.account_group_id?l[Y.account_group_id]:void 0;return se&&se.is_active!==null?se.is_active:Y.is_active!==!1}function N(Y){const se=Y.account_group_id?l[Y.account_group_id]:void 0;return se&&se.on_budget!==null?se.on_budget:Y.on_budget!==!1}const F=Object.entries(o).filter(([,Y])=>j(Y)&&N(Y)),q=F.filter(([,Y])=>Y.is_outgo_account),A=q.length>0?q:F,P=F.find(([,Y])=>Y.is_outgo_default),O=P?P[0]:void 0,X=m?.expenses?.reduce((Y,se)=>Y+se.amount,0)||0;function W(Y,se,L,G,ne,ie,te){if(!t)return;S(null),T(!1);const{year:ue,month:ve}=fm(G);(ue!==e||ve!==n)&&(r(ue),i(ve)),g(t,ue,ve,Y,se,L,G,ne,ie,te).catch(ce=>{S(ce instanceof Error?ce.message:"Failed to add expense")})}function H(Y,se,L,G,ne,ie,te,ue){t&&(S(null),D(null),v(t,e,n,Y,se,L,G,ne,ie,te,ue).catch(ve=>{S(ve instanceof Error?ve.message:"Failed to update expense")}))}function Z(Y){t&&confirm("Are you sure you want to delete this expense?")&&(S(null),b(t,e,n,Y).catch(se=>{S(se instanceof Error?se.message:"Failed to delete expense")}))}return u.jsxs("div",{style:{opacity:p?.5:1,transition:"opacity 0.15s ease-out",pointerEvents:p?"none":"auto"},children:[x&&u.jsx("div",{style:{background:`color-mix(in srgb, ${me.error} 15%, transparent)`,border:`1px solid ${me.error}`,borderRadius:"8px",padding:"0.75rem",marginBottom:"1rem",color:me.error},children:x}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:C?"1fr":"5rem 1.5fr 7rem 1fr 6rem 1fr 3rem 4rem"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"#242424",borderBottom:"1px solid rgba(255,255,255,0.15)",display:C?"block":"grid",gridTemplateColumns:C?void 0:"subgrid"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem"},children:[u.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[u.jsx("span",{style:{fontWeight:600},children:"Expenses:"}),u.jsx("span",{style:{opacity:.6,fontSize:"0.8rem"},children:"Transactions that should be factored into spend calculations"}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"Total: "}),u.jsx("span",{style:{color:ot(X),fontWeight:600},children:Lt(X)})]})]}),u.jsx("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:!E&&u.jsx(Ve,{actionName:"Open Add Expense Form",onClick:()=>T(!0),disabled:A.length===0||Object.keys(d).length===0,disabledReason:A.length===0&&Object.keys(d).length===0?"Create accounts and categories first":A.length===0?"Create an expense account first":"Create a category first",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:"+ Add Expense"})})]}),!C&&u.jsxs(u.Fragment,{children:[u.jsx("div",{style:oa,children:"Date"}),u.jsx("div",{style:oa,children:"Payee"}),u.jsx("div",{style:{...oa,textAlign:"center"},children:"Category"}),u.jsx("div",{style:oa,children:"Account"}),u.jsx("div",{style:{...oa,textAlign:"right"},children:"Amount"}),u.jsx("div",{style:oa,children:"Description"}),u.jsx("div",{style:{...oa,textAlign:"center"},children:"Clr"}),u.jsx("div",{style:oa})]})]}),A.length===0&&u.jsx(Hu,{message:Object.keys(o).length===0?"You need to create at least one account before adding expenses.":'No accounts are set up for expenses. Edit an account and enable "Show in expense list".',linkText:"Manage accounts",linkTo:"/budget/settings/accounts"}),Object.keys(d).length===0&&u.jsx(Hu,{message:"You need to create at least one category before adding expenses.",linkText:"Create categories",linkTo:"/budget/settings/categories"}),E&&u.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"1rem"},children:u.jsx(G1,{accounts:A,accountGroups:l,categories:d,categoryGroups:h,payees:k,defaultAccountId:O,defaultDate:hm(e,n),onSubmit:W,onCancel:()=>T(!1),submitLabel:"Add Expense",isMobile:C})}),m?.expenses?.slice().sort((Y,se)=>(Y.date||"").localeCompare(se.date||"")).map((Y,se)=>I===Y.id?u.jsx("div",{style:{gridColumn:"1 / -1",padding:"0.5rem"},children:u.jsx(G1,{accounts:A,accountGroups:l,categories:d,categoryGroups:h,payees:k,initialData:Y,onSubmit:(L,G,ne,ie,te,ue,ve)=>H(Y.id,L,G,ne,ie,te,ue,ve),onCancel:()=>D(null),onDelete:()=>Z(Y.id),submitLabel:"Save",isMobile:C})},Y.id):u.jsx(Nz,{expense:Y,categoryName:it(Y.category_id)?Do:d[Y.category_id]?.name||"Unknown Category",accountName:Je(Y.account_id)?ka:o[Y.account_id]?.nickname||"Unknown Account",accountGroupName:Je(Y.account_id)?void 0:o[Y.account_id]?.account_group_id?l[o[Y.account_id].account_group_id]?.name:void 0,onEdit:()=>{Y.payee||`${Y.amount}`,D(Y.id)},onDelete:()=>Z(Y.id),isMobile:C,isEvenRow:se%2===0},Y.id)),(!m?.expenses||m.expenses.length===0)&&!E&&u.jsx("p",{style:{gridColumn:"1 / -1",opacity:.5,fontSize:"0.9rem",textAlign:"center",padding:"1.5rem"},children:"No expenses recorded for this month"}),u.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]})]})}const zz={background:me.primary,border:"none",cursor:"pointer",fontSize:"0.9rem",padding:"0.35rem 0.5rem",borderRadius:"4px",color:"white"},Bz={background:"transparent",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)",cursor:"pointer",fontSize:"0.9rem",padding:"0.35rem 0.5rem",borderRadius:"4px"},Lz={background:"transparent",border:`1px solid ${me.errorBorder}`,color:me.error,cursor:"pointer",fontSize:"0.9rem",padding:"0.35rem 0.5rem",borderRadius:"4px"};function Q1({accounts:t,accountGroups:e,categories:n,categoryGroups:r,initialData:i,defaultDate:o,onSubmit:l,onCancel:d,onDelete:h,submitLabel:m}){const{isWide:p}=OT(),g=new Date().toISOString().split("T")[0],[v,b]=M.useState(i?.date||o||g),[C,x]=M.useState(i?.amount?.toString()||""),[S,E]=M.useState(i?.from_account_id||Gt),[T,I]=M.useState(i?.to_account_id||Gt),[D,B]=M.useState(i?.from_category_id||Xt),[$,k]=M.useState(i?.to_category_id||Xt),[j,N]=M.useState(i?.description||""),[F,q]=M.useState(i?.cleared||!1),[A,P]=M.useState(null),O=D===Xt,X=$===Xt,W=S===Gt,H=T===Gt;function Z(){return O&&X&&(W&&H)?'A transfer must move between real categories or real accounts  not all "No" options.':W!==H?'Both accounts must be real accounts, or both must be "No Account". Cannot transfer from a real account to nothing.':O!==X?'Both categories must be real categories, or both must be "No Category". Cannot transfer from a real category to nothing.':null}Z()===null&&A!==null&&P(null);function se(ce){ce.preventDefault();const be=parseFloat(C);if(isNaN(be)||be<=0||!S||!T||!D||!$||!v)return;const ze=Z();if(ze){P(ze);return}P(null),l(be,S,T,D,$,v,j.trim()||void 0,F)}const L=A?u.jsx("div",{style:{background:`color-mix(in srgb, ${me.error} 15%, transparent)`,border:`1px solid ${me.errorBorder}`,borderRadius:"6px",padding:"0.5rem 0.75rem",fontSize:"0.85rem",color:me.error,marginTop:"0.5rem"},children:A}):null,G=(ce,be,ze,Pe)=>u.jsx(Bt,{label:Pe,htmlFor:ce,children:u.jsx(MT,{id:ce,value:be,onChange:ze,accounts:t,accountGroups:e,placeholder:ka,required:!0,showNoAccountOption:!0})}),ne=(ce,be,ze,Pe)=>u.jsx(Bt,{label:Pe,htmlFor:ce,children:u.jsx(DT,{id:ce,value:be,onChange:ze,categories:n,categoryGroups:r,placeholder:Do,required:!0,showNoCategoryOption:!0})}),ie=u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.25rem",paddingBottom:"0.35rem"},children:[u.jsx("label",{htmlFor:"transfer-cleared",style:{fontSize:"0.75rem",opacity:.7,fontWeight:500},children:"Clr"}),u.jsx(Hr,{id:"transfer-cleared",checked:F,onChange:ce=>q(ce.target.checked)})]}),te=u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.25rem",paddingBottom:"0.1rem"},children:[u.jsx("span",{style:{fontSize:"0.75rem",opacity:.7,fontWeight:500},children:""}),u.jsxs("div",{style:{display:"flex",gap:"0.25rem"},children:[u.jsx("button",{type:"submit",title:m,style:zz,children:""}),u.jsx("button",{type:"button",onClick:()=>{d()},title:"Cancel",style:Bz,children:""}),h&&u.jsx("button",{type:"button",onClick:()=>{h()},title:"Delete",style:Lz,children:""})]})]}),ue=u.jsxs(La,{children:[u.jsx(Ve,{type:"submit",actionName:m,children:m}),u.jsx(Ve,{type:"button",variant:"secondary",actionName:"Cancel Transfer Form",onClick:d,children:"Cancel"}),h&&u.jsx(Ve,{type:"button",variant:"danger",actionName:"Delete Transfer",onClick:h,children:" Delete"})]}),ve={fontSize:"0.85rem",padding:"0.5rem"};return p?u.jsx(Ci,{actionName:m,onSubmit:se,children:u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[u.jsxs("div",{style:{display:"grid",gridTemplateColumns:"5.5rem 5.5rem 1fr 1fr 1.5fr",gap:"0.75rem",alignItems:"end"},children:[u.jsx(Bt,{label:"Date",htmlFor:"transfer-date",children:u.jsx(kf,{id:"transfer-date",value:v,onChange:ce=>b(ce.target.value),required:!0,style:ve,autoFocus:!0})}),u.jsx(Bt,{label:"Amount",htmlFor:"transfer-amount",children:u.jsx(wo,{id:"transfer-amount",value:C,onChange:x,placeholder:"$0.00",required:!0})}),ne("from-category",D,B,"From Category"),G("from-account",S,E,"From Account"),u.jsx(Bt,{label:"Description",htmlFor:"transfer-description",children:u.jsx(Ei,{id:"transfer-description",value:j,onChange:ce=>N(ce.target.value),placeholder:"e.g., Transfer",style:ve})})]}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:"5.5rem 5.5rem 1fr 1fr 1.5fr",gap:"0.75rem",alignItems:"end"},children:[u.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1.2rem",opacity:.5,paddingBottom:"0.5rem"},children:""}),u.jsx("div",{}),ne("to-category",$,k,"To Category"),G("to-account",T,I,"To Account"),u.jsxs("div",{style:{display:"flex",gap:"0.75rem",alignItems:"end",paddingBottom:"0.25rem"},children:[ie,te]})]}),L]})}):u.jsxs(Ci,{actionName:m,onSubmit:se,children:[u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:[u.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[u.jsx(Bt,{label:"Date",htmlFor:"transfer-date",children:u.jsx(kf,{id:"transfer-date",value:v,onChange:ce=>b(ce.target.value),required:!0,autoFocus:!0})}),u.jsx(Bt,{label:"Amount",htmlFor:"transfer-amount",children:u.jsx(wo,{id:"transfer-amount",value:C,onChange:x,placeholder:"$0.00",required:!0})})]}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem",background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1rem",borderRadius:"8px"},children:[u.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"0.75rem",alignItems:"end"},children:[ne("from-category",D,B,"From Cat."),G("from-account",S,E,"From Acct.")]}),u.jsx("div",{style:{display:"flex",justifyContent:"center",fontSize:"1.5rem",opacity:.5},children:""}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"0.75rem",alignItems:"end"},children:[ne("to-category",$,k,"To Cat."),G("to-account",T,I,"To Acct.")]})]}),u.jsx(Bt,{label:"Description (optional)",htmlFor:"transfer-description",children:u.jsx(Ei,{id:"transfer-description",value:j,onChange:ce=>N(ce.target.value),placeholder:"e.g., Transfer to savings"})}),u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx(Hr,{id:"transfer-cleared-stacked",checked:F,onChange:ce=>q(ce.target.checked)}),u.jsx("label",{htmlFor:"transfer-cleared-stacked",style:{fontSize:"0.9rem",cursor:"pointer"},children:"Cleared (appeared in bank account)"})]}),L]}),ue]})}function Uz({transfer:t,fromCategoryName:e,toCategoryName:n,fromAccountName:r,toAccountName:i,fromAccountGroupName:o,toAccountGroupName:l,isFromCategoryNo:d,isToCategoryNo:h,isFromAccountNo:m,isToAccountNo:p,onEdit:g,onDelete:v,isMobile:b,isEvenRow:C}){const x=t.date?new Date(t.date+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"}):"",S=C?"transparent":"rgba(255,255,255,0.04)";if(b)return u.jsxs("div",{onClick:g,style:{gridColumn:"1 / -1",display:"flex",flexDirection:"column",gap:"0.5rem",padding:"0.75rem 1rem",background:S,cursor:"pointer",transition:"background 0.15s"},children:[u.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{style:{fontSize:"0.75rem",opacity:.5,fontFamily:"monospace",minWidth:"3rem"},children:x}),u.jsx("span",{style:{fontWeight:600,opacity:.8,fontFamily:"monospace"},children:_t(t.amount)}),t.cleared&&u.jsx("span",{style:{fontSize:"0.7rem",color:me.success},title:"Cleared",children:""})]})}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto 1fr",gap:"0.5rem",alignItems:"center"},children:[u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[u.jsx("span",{style:d?{fontSize:"0.7rem",opacity:.4}:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px",display:"inline-block",width:"fit-content"},children:e}),m?u.jsx("span",{style:{fontSize:"0.75rem",opacity:.4},children:r}):u.jsxs("div",{style:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px",display:"inline-flex",flexDirection:"column",gap:"0.1rem",width:"fit-content"},children:[o&&u.jsx("span",{style:{fontSize:"0.65rem",opacity:.6},children:o}),u.jsx("span",{children:r})]})]}),u.jsx("span",{style:{opacity:.5},children:""}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[u.jsx("span",{style:h?{fontSize:"0.7rem",opacity:.4}:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px",display:"inline-block",width:"fit-content"},children:n}),p?u.jsx("span",{style:{fontSize:"0.75rem",opacity:.4},children:i}):u.jsxs("div",{style:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px",display:"inline-flex",flexDirection:"column",gap:"0.1rem",width:"fit-content"},children:[l&&u.jsx("span",{style:{fontSize:"0.65rem",opacity:.6},children:l}),u.jsx("span",{children:i})]})]})]}),t.description&&u.jsx("div",{style:{fontSize:"0.75rem",opacity:.6},children:t.description})]});const E={padding:"0.6rem 0.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem"};return u.jsxs("div",{style:{gridColumn:"1 / -1",background:S,display:"grid",gridTemplateColumns:"5rem 1.5fr 7rem 1fr 6rem 1fr 3rem 4rem"},children:[u.jsx("div",{style:{...E,fontSize:"0.85rem",fontFamily:"monospace"},children:u.jsx("span",{style:{opacity:.6},children:x})}),u.jsx("div",{style:{...E,justifyContent:"flex-end",fontWeight:600,opacity:.8,fontFamily:"monospace"},children:_t(t.amount)}),u.jsx("div",{style:{...E,justifyContent:"center"},children:u.jsx("span",{style:d?{fontSize:"0.8rem",opacity:.4}:{fontSize:"0.8rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e})}),u.jsx("div",{style:{...E,overflow:"hidden"},children:m?u.jsx("span",{style:{opacity:.4,fontSize:"0.85rem"},children:r}):u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.1rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden"},children:[o&&u.jsx("span",{style:{fontSize:"0.7rem",opacity:.6,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:o}),u.jsx("span",{style:{fontSize:"0.8rem",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:r})]})}),u.jsx("div",{style:{...E,justifyContent:"center",fontSize:"1rem"},children:u.jsx("span",{style:{opacity:.5},children:""})}),u.jsx("div",{style:{...E,justifyContent:"center"},children:u.jsx("span",{style:h?{fontSize:"0.8rem",opacity:.4}:{fontSize:"0.8rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:n})}),u.jsx("div",{style:{...E,overflow:"hidden"},children:p?u.jsx("span",{style:{opacity:.4,fontSize:"0.85rem"},children:i}):u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.1rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden"},children:[l&&u.jsx("span",{style:{fontSize:"0.7rem",opacity:.6,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:l}),u.jsx("span",{style:{fontSize:"0.8rem",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:i})]})}),u.jsx("div",{style:{...E,paddingLeft:"0.5rem",overflow:"hidden"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.8rem",opacity:.6},children:t.description||""})}),u.jsx("div",{style:{...E,justifyContent:"center",color:t.cleared?me.success:"inherit",opacity:t.cleared?1:.3,fontSize:"1rem"},children:t.cleared?"":""}),u.jsxs("div",{style:{...E,justifyContent:"flex-end",gap:"0.25rem"},children:[u.jsx("button",{onClick:g,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:T=>T.currentTarget.style.opacity="1",onMouseLeave:T=>T.currentTarget.style.opacity="0.5",title:"Edit",children:""}),u.jsx("button",{onClick:v,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:T=>T.currentTarget.style.opacity="1",onMouseLeave:T=>T.currentTarget.style.opacity="0.5",title:"Delete",children:""})]})]})}const zs={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderTop:"1px solid rgba(255,255,255,0.1)"};function Fz(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n,setCurrentYear:r,setCurrentMonthNumber:i}=Ye(),{accounts:o,accountGroups:l,categories:d,categoryGroups:h}=Rn(),{month:m,isLoading:p}=Qs(t,e,n),{addTransfer:g}=BP(),{updateTransfer:v}=UP(),{deleteTransfer:b}=FP(),C=Ai(),[x,S]=M.useState(null),[E,T]=M.useState(!1),[I,D]=M.useState(null);function B(A){const P=A.account_group_id?l[A.account_group_id]:void 0;return P&&P.is_active!==null?P.is_active:A.is_active!==!1}function $(A){const P=A.account_group_id?l[A.account_group_id]:void 0;return P&&P.on_budget!==null?P.on_budget:A.on_budget!==!1}const k=Object.entries(o).filter(([,A])=>B(A)&&$(A));function j(A,P,O,X,W,H,Z,Y){if(!t)return;S(null),T(!1);const{year:se,month:L}=fm(H);(se!==e||L!==n)&&(r(se),i(L)),g(t,se,L,A,P,O,X,W,H,Z,Y).catch(G=>{S(G instanceof Error?G.message:"Failed to add transfer")})}function N(A,P,O,X,W,H,Z,Y,se){t&&(S(null),D(null),v(t,e,n,A,P,O,X,W,H,Z,Y,se).catch(L=>{S(L instanceof Error?L.message:"Failed to update transfer")}))}function F(A){t&&confirm("Are you sure you want to delete this transfer?")&&(S(null),b(t,e,n,A).catch(P=>{S(P instanceof Error?P.message:"Failed to delete transfer")}))}const q=k.length>=1&&Object.keys(d).length>=1;return u.jsxs("div",{style:{opacity:p?.5:1,transition:"opacity 0.15s ease-out",pointerEvents:p?"none":"auto"},children:[x&&u.jsx("div",{style:{background:`color-mix(in srgb, ${me.error} 15%, transparent)`,border:`1px solid ${me.error}`,borderRadius:"8px",padding:"0.75rem",marginBottom:"1rem",color:me.error},children:x}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:C?"1fr":"5rem 6rem 1fr 1fr 2rem 1fr 1fr 1fr 3rem 4rem"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"#242424",borderBottom:"1px solid rgba(255,255,255,0.15)",display:C?"block":"grid",gridTemplateColumns:C?void 0:"subgrid"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem"},children:[u.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[u.jsx("span",{style:{fontWeight:600},children:"Transfers:"}),u.jsx("span",{style:{opacity:.6,fontSize:"0.8rem"},children:"Moving money between accounts and categories within the budget"})]}),u.jsx("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:!E&&u.jsx(Ve,{actionName:"Open Add Transfer Form",onClick:()=>T(!0),disabled:!q,disabledReason:k.length===0&&Object.keys(d).length===0?"Create accounts and categories first":k.length===0?"Create an account first":"Create a category first",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:"+ Add Transfer"})})]}),!C&&u.jsxs(u.Fragment,{children:[u.jsx("div",{style:zs,children:"Date"}),u.jsx("div",{style:{...zs,textAlign:"right"},children:"Amount"}),u.jsx("div",{style:{...zs,textAlign:"center"},children:"From Cat"}),u.jsx("div",{style:zs,children:"From Acct"}),u.jsx("div",{style:zs}),u.jsx("div",{style:{...zs,textAlign:"center"},children:"To Cat"}),u.jsx("div",{style:zs,children:"To Acct"}),u.jsx("div",{style:zs,children:"Description"}),u.jsx("div",{style:{...zs,textAlign:"center"},children:"Clr"}),u.jsx("div",{style:zs})]})]}),!q&&u.jsx(Hu,{message:"You need at least one account and one category before adding transfers.",linkText:"Manage accounts",linkTo:"/budget/settings/accounts"}),E&&u.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"1rem"},children:u.jsx(Q1,{accounts:k,accountGroups:l,categories:d,categoryGroups:h,defaultDate:hm(e,n),onSubmit:j,onCancel:()=>T(!1),submitLabel:"Add Transfer"})}),m?.transfers?.slice().sort((A,P)=>(A.date||"").localeCompare(P.date||"")).map((A,P)=>I===A.id?u.jsx("div",{style:{gridColumn:"1 / -1",padding:"0.5rem"},children:u.jsx(Q1,{accounts:k,accountGroups:l,categories:d,categoryGroups:h,initialData:A,onSubmit:(O,X,W,H,Z,Y,se,L)=>N(A.id,O,X,W,H,Z,Y,se,L),onCancel:()=>D(null),onDelete:()=>F(A.id),submitLabel:"Save"})},A.id):u.jsx(Uz,{transfer:A,fromCategoryName:it(A.from_category_id)?Do:d[A.from_category_id]?.name||"Unknown",toCategoryName:it(A.to_category_id)?Do:d[A.to_category_id]?.name||"Unknown",fromAccountName:Je(A.from_account_id)?ka:o[A.from_account_id]?.nickname||"Unknown",toAccountName:Je(A.to_account_id)?ka:o[A.to_account_id]?.nickname||"Unknown",fromAccountGroupName:Je(A.from_account_id)?void 0:o[A.from_account_id]?.account_group_id?l[o[A.from_account_id].account_group_id]?.name:void 0,toAccountGroupName:Je(A.to_account_id)?void 0:o[A.to_account_id]?.account_group_id?l[o[A.to_account_id].account_group_id]?.name:void 0,isFromCategoryNo:it(A.from_category_id),isToCategoryNo:it(A.to_category_id),isFromAccountNo:Je(A.from_account_id),isToAccountNo:Je(A.to_account_id),onEdit:()=>{A.description||`${A.amount}`,D(A.id)},onDelete:()=>F(A.id),isMobile:C,isEvenRow:P%2===0},A.id)),(!m?.transfers||m.transfers.length===0)&&!E&&u.jsx("p",{style:{gridColumn:"1 / -1",opacity:.5,fontSize:"0.9rem",textAlign:"center",padding:"1.5rem"},children:"No transfers recorded for this month"}),u.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]})]})}function W1({accounts:t,accountGroups:e,categories:n,categoryGroups:r,payees:i,initialData:o,defaultAccountId:l,defaultDate:d,onSubmit:h,onCancel:m,onDelete:p,submitLabel:g}){function v(b){h(b.amount,b.accountId,b.categoryId,b.date,b.payee,b.description,b.cleared)}return u.jsx(J0,{accounts:t,accountGroups:e,categories:n,categoryGroups:r,payees:i,initialData:o?{date:o.date,payee:o.payee,categoryId:o.category_id,accountId:o.account_id,amount:o.amount,description:o.description,cleared:o.cleared}:void 0,defaultAccountId:l,defaultDate:d,config:{showCategory:!0,showCleared:!0,showNoCategoryOption:!0,showNoAccountOption:!0,showSignToggle:!0,accountLabel:"Account",payeePlaceholder:"e.g., Bank, Interest source",descriptionPlaceholder:"e.g., Starting balance, Correction",submitLabel:g},onSubmit:v,onCancel:m,onDelete:p})}function Vz({adjustment:t,categoryName:e,accountName:n,accountGroupName:r,onEdit:i,onDelete:o,isMobile:l,isEvenRow:d}){const h=t.date?new Date(t.date+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"}):"",m=r?`${r} / ${n}`:n,p=d?"transparent":"rgba(255,255,255,0.04)";if(l)return u.jsxs("div",{onClick:i,style:{gridColumn:"1 / -1",display:"flex",flexDirection:"column",gap:"0.25rem",padding:"0.75rem 1rem",background:p,cursor:"pointer",transition:"background 0.15s"},children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{style:{fontSize:"0.75rem",opacity:.5,fontFamily:"monospace"},children:h}),t.cleared&&u.jsx("span",{style:{fontSize:"0.7rem",color:me.success},title:"Cleared",children:""})]}),u.jsx("span",{style:{fontWeight:600,color:ot(t.amount),fontFamily:"monospace"},children:Lt(t.amount)})]}),u.jsx("div",{style:{fontWeight:500,fontSize:"0.9rem"},children:t.description||"Adjustment"}),u.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap",alignItems:"center"},children:[u.jsx("span",{style:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px"},children:e}),u.jsx("span",{style:{fontSize:"0.75rem",opacity:.6},children:m})]})]});const g={padding:"0.6rem 0.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem"};return u.jsxs("div",{style:{gridColumn:"1 / -1",background:p,display:"grid",gridTemplateColumns:"5rem 1.5fr 7rem 1fr 6rem 1fr 3rem 4rem"},children:[u.jsx("div",{style:{...g,fontSize:"0.85rem",fontFamily:"monospace"},children:u.jsx("span",{style:{opacity:.6},children:h})}),u.jsx("div",{style:{...g,justifyContent:"center"},children:u.jsx("span",{style:{fontSize:"0.8rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e})}),u.jsx("div",{style:{...g,overflow:"hidden"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.85rem",opacity:.7},children:m})}),u.jsx("div",{style:{...g,justifyContent:"flex-end",fontWeight:600,color:ot(t.amount),fontFamily:"monospace"},children:Lt(t.amount)}),u.jsx("div",{style:{...g,paddingLeft:"0.5rem",overflow:"hidden"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.8rem",opacity:.6},children:t.description||""})}),u.jsx("div",{style:{...g,justifyContent:"center",color:t.cleared?me.success:"inherit",opacity:t.cleared?1:.3,fontSize:"1rem"},children:t.cleared?"":""}),u.jsxs("div",{style:{...g,justifyContent:"flex-end",gap:"0.25rem"},children:[u.jsx("button",{onClick:i,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:v=>v.currentTarget.style.opacity="1",onMouseLeave:v=>v.currentTarget.style.opacity="0.5",title:"Edit",children:""}),u.jsx("button",{onClick:o,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:v=>v.currentTarget.style.opacity="1",onMouseLeave:v=>v.currentTarget.style.opacity="0.5",title:"Delete",children:""})]})]})}const yo={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderTop:"1px solid rgba(255,255,255,0.1)"};function $z(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n,setCurrentYear:r,setCurrentMonthNumber:i}=Ye(),{accounts:o,accountGroups:l,categories:d,categoryGroups:h}=Rn(),{month:m,isLoading:p}=Qs(t,e,n),{addAdjustment:g}=$P(),{updateAdjustment:v}=HP(),{deleteAdjustment:b}=GP(),C=Ai(),[x,S]=M.useState(null),[E,T]=M.useState(!1),[I,D]=M.useState(null),k=z0(t,{enabled:E||I!==null}).data||[];function j(O){const X=O.account_group_id?l[O.account_group_id]:void 0;return X&&X.is_active!==null?X.is_active:O.is_active!==!1}function N(O){const X=O.account_group_id?l[O.account_group_id]:void 0;return X&&X.on_budget!==null?X.on_budget:O.on_budget!==!1}const F=Object.entries(o).filter(([,O])=>j(O)&&N(O));function q(O,X,W,H,Z,Y,se){if(!t)return;S(null),T(!1);const{year:L,month:G}=fm(H);(L!==e||G!==n)&&(r(L),i(G)),g(t,L,G,O,X,W,H,Z,Y,se).catch(ne=>{S(ne instanceof Error?ne.message:"Failed to add adjustment")})}function A(O,X,W,H,Z,Y,se,L){t&&(S(null),D(null),v(t,e,n,O,X,W,H,Z,Y,se,L).catch(G=>{S(G instanceof Error?G.message:"Failed to update adjustment")}))}function P(O){t&&confirm("Are you sure you want to delete this adjustment?")&&(S(null),b(t,e,n,O).catch(X=>{S(X instanceof Error?X.message:"Failed to delete adjustment")}))}return u.jsxs("div",{style:{opacity:p?.5:1,transition:"opacity 0.15s ease-out",pointerEvents:p?"none":"auto"},children:[x&&u.jsx("div",{style:{background:`color-mix(in srgb, ${me.error} 15%, transparent)`,border:`1px solid ${me.error}`,borderRadius:"8px",padding:"0.75rem",marginBottom:"1rem",color:me.error},children:x}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:C?"1fr":"5rem 1fr 1fr 6rem 1.5fr 3rem 4rem"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"#242424",borderBottom:"1px solid rgba(255,255,255,0.15)",display:C?"block":"grid",gridTemplateColumns:C?void 0:"subgrid"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem"},children:[u.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[u.jsx("span",{style:{fontWeight:600},children:"Adjustments:"}),u.jsx("span",{style:{opacity:.6,fontSize:"0.8rem"},children:"Incoming or outgoing transactions that should bypass income and spend calculations"})]}),u.jsx("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:!E&&u.jsx(Ve,{actionName:"Open Add Adjustment Form",onClick:()=>T(!0),disabled:Object.keys(d).length===0&&F.length===0,disabledReason:"Create an account or category first",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:"+ Add Adjustment"})})]}),!C&&u.jsxs(u.Fragment,{children:[u.jsx("div",{style:yo,children:"Date"}),u.jsx("div",{style:{...yo,textAlign:"center"},children:"Category"}),u.jsx("div",{style:yo,children:"Account"}),u.jsx("div",{style:{...yo,textAlign:"right"},children:"Amount"}),u.jsx("div",{style:yo,children:"Description"}),u.jsx("div",{style:{...yo,textAlign:"center"},children:"Clr"}),u.jsx("div",{style:yo})]})]}),F.length===0&&Object.keys(d).length===0&&u.jsx(Hu,{message:"You need to create at least one account or category before adding adjustments.",linkText:"Manage accounts",linkTo:"/budget/settings/accounts"}),E&&u.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"1rem"},children:u.jsx(W1,{accounts:F,accountGroups:l,categories:d,categoryGroups:h,payees:k,defaultDate:hm(e,n),onSubmit:q,onCancel:()=>T(!1),submitLabel:"Add Adjustment"})}),m?.adjustments?.slice().sort((O,X)=>(O.date||"").localeCompare(X.date||"")).map((O,X)=>I===O.id?u.jsx("div",{style:{gridColumn:"1 / -1",padding:"0.5rem"},children:u.jsx(W1,{accounts:F,accountGroups:l,categories:d,categoryGroups:h,payees:k,initialData:O,onSubmit:(W,H,Z,Y,se,L,G)=>A(O.id,W,H,Z,Y,se,L,G),onCancel:()=>D(null),onDelete:()=>P(O.id),submitLabel:"Save"})},O.id):u.jsx(Vz,{adjustment:O,categoryName:it(O.category_id)?Do:d[O.category_id]?.name||"Unknown Category",accountName:Je(O.account_id)?ka:o[O.account_id]?.nickname||"Unknown Account",accountGroupName:Je(O.account_id)?void 0:o[O.account_id]?.account_group_id?l[o[O.account_id].account_group_id]?.name:void 0,onEdit:()=>{O.description||`${O.amount}`,D(O.id)},onDelete:()=>P(O.id),isMobile:C,isEvenRow:X%2===0},O.id)),(!m?.adjustments||m.adjustments.length===0)&&!E&&u.jsx("p",{style:{gridColumn:"1 / -1",opacity:.5,fontSize:"0.9rem",textAlign:"center",padding:"1.5rem"},children:"No adjustments recorded for this month"}),u.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]})]})}function qz({isOpen:t,onClose:e,onDeleted:n}){const{addLoadingHold:r,removeLoadingHold:i}=Qn(),{selectedBudgetId:o,currentYear:l,currentMonthNumber:d}=Ye(),{deleteAllocations:h}=YT(),[m,p]=M.useState(null),g=async()=>{if(o){p(null),r("allocations-delete","Deleting allocations...");try{await h({budgetId:o,year:l,month:d}),e(),n?.()}catch(v){p(v instanceof Error?v.message:"Failed to delete allocations")}finally{i("allocations-delete")}}};return u.jsxs(us,{isOpen:t,onClose:e,title:"Delete Allocations",children:[m&&u.jsx(mm,{message:m,onDismiss:()=>p(null)}),u.jsx("p",{style:{margin:"0 0 1.5rem 0"},children:"Are you sure you want to delete all allocations for this month? This will remove all allocated amounts and reset the month to unfinalized."}),u.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[u.jsx(Ve,{actionName:"Cancel Delete Allocations",variant:"secondary",onClick:e,children:"Cancel"}),u.jsx(Ve,{actionName:"Confirm Delete Allocations",variant:"danger",onClick:g,children:"Delete Allocations"})]})]})}function rA({isDraftMode:t,isEditingAppliedAllocations:e,availableNow:n,currentMonthIncome:r,balanceTotals:i,draftChangeAmount:o,availableAfterApply:l,currentDraftTotal:d}){const h=t&&d!==void 0?d:i.allocated;return u.jsxs(u.Fragment,{children:[u.jsx("span",{style:{fontWeight:600,marginRight:"0.25rem"},children:t||e?"Allocations Worksheet:":"Month Summary:"}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:t?"Avail: ":"Inc: "}),t?u.jsx("span",{style:{color:ot(n),fontWeight:600},children:_t(n)}):u.jsxs("span",{style:{color:me.success,fontWeight:600},children:["+",_t(r)]})]}),u.jsxs("span",{children:[t&&u.jsx("span",{style:{opacity:.6},children:" "}),u.jsx("span",{style:{opacity:.6},children:t?"Draft: ":"Alloc: "}),u.jsxs("span",{style:{color:gc(t?h:i.allocated),fontWeight:600,...t?cs:{}},children:[t?"":"+",_t(t?h:i.allocated)]}),e&&o!==0&&u.jsxs("span",{style:{fontSize:"0.85em",color:o>0?me.warning:me.success,marginLeft:"0.25rem"},children:["(",Lt(o),")"]})]}),!t&&u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"Spent: "}),u.jsx("span",{style:{color:pc(i.spent),fontWeight:600},children:wt(i.spent)})]}),u.jsxs("span",{children:[t&&u.jsx("span",{style:{opacity:.6},children:"= "}),u.jsx("span",{style:{opacity:.6},children:t?"Remaining: ":"Net: "}),t?u.jsx("span",{style:{color:ot(l),fontWeight:600,...cs},children:_t(l)}):u.jsx("span",{style:{color:ot(i.allocated+i.spent),fontWeight:600},children:_t(i.allocated+i.spent)})]})]})}function Hz({totals:t}){return u.jsxs(u.Fragment,{children:[u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"Start: "}),u.jsx("span",{style:{color:ot(t.start),fontWeight:600},children:_t(t.start)})]}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"Inc: "}),u.jsxs("span",{style:{color:me.success,fontWeight:600},children:["+",_t(t.income)]})]}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"Exp: "}),u.jsx("span",{style:{color:pc(t.expenses),fontWeight:600},children:wt(t.expenses)})]}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"End: "}),u.jsx("span",{style:{color:ot(t.end),fontWeight:600},children:_t(t.end)})]})]})}function e_({isDraftMode:t,isEditingAppliedAllocations:e,allocationsFinalized:n,onSave:r,onApply:i,onEdit:o,onCancel:l,onDelete:d}){return u.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:[t&&!e&&u.jsxs(u.Fragment,{children:[u.jsx(Ve,{actionName:"Save Draft Allocations",onClick:r,variant:"secondary",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:" Save"}),u.jsx(Ve,{actionName:"Apply Allocations",onClick:i,variant:"secondary",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:" Apply"})]}),!t&&n&&u.jsx(Ve,{actionName:"Edit Allocations",onClick:o,variant:"secondary",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:" Edit Allocations"}),e&&u.jsxs(u.Fragment,{children:[u.jsx(Ve,{actionName:"Apply Allocations",onClick:i,variant:"secondary",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:" Apply"}),u.jsx(Ve,{actionName:"Cancel Edit Allocations",onClick:l,variant:"secondary",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:""}),u.jsx(Ve,{actionName:"Open Delete Allocations Modal",onClick:d,variant:"secondary",style:{fontSize:"0.8rem",padding:"0.4em 0.8em",color:me.error},children:""})]})]})}function K1(t){return t===0?me.zero:t>0?me.success:me.error}function Gz({category:t,balance:e,localAllocation:n,previousMonthIncome:r,isDraftMode:i,onAllocationChange:o,projectedAllTime:l}){const d=t.default_monthly_type==="percentage"&&t.default_monthly_amount!==void 0&&t.default_monthly_amount>0,h=d?t.default_monthly_amount/100*r:0,m=d?h.toFixed(2):n,p=i&&!d,g=i?l:t.balance??0,v=t.balance??0,b=v<0,C=b?Math.abs(v):0,x=d?h:parseFloat(n)||0,S=b?Math.min(x,C):0,E=b?Math.max(0,x-C):0,T=b&&x>0&&E>0;return u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",padding:"0.75rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem"},children:u.jsx("span",{style:{fontWeight:500},children:t.name})}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr 1fr 1fr",gap:"0.25rem",fontSize:"0.75rem"},children:[u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:"Start"}),u.jsx("span",{style:{color:dn(e.start_balance)},children:pr(e.start_balance)})]}),u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:"Alloc"}),p?u.jsxs(u.Fragment,{children:[u.jsx("input",{type:"text",inputMode:"decimal",value:m?`$${m}`:"",onChange:I=>{const D=I.target.value.replace(/[^\d.]/g,"");o(D)},placeholder:"$0",style:{width:"100%",maxWidth:"80px",padding:"0.25rem 0.35rem",borderRadius:"4px",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",background:"color-mix(in srgb, currentColor 8%, transparent)",fontSize:"0.8rem",color:"inherit",boxSizing:"border-box"}}),b&&x>0&&u.jsxs("div",{style:{fontSize:"0.65rem",marginTop:"0.15rem",lineHeight:1.3},children:[u.jsxs("span",{style:{color:me.debt,display:"block"},children:[_t(S),"  debt"]}),T&&u.jsxs("span",{style:{color:me.success,display:"block"},children:[_t(E),"  balance"]})]})]}):u.jsx("span",{style:{color:gc(e.allocated)},children:Lt(e.allocated)})]}),u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:"Spent"}),u.jsx("span",{style:{color:pc(e.spent)},children:wt(e.spent)})]}),u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:"End"}),u.jsx("span",{style:{color:dn(e.end_balance),...i&&!d?cs:{}},children:pr(e.end_balance)})]}),u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:i?"Proj. All-Time":"All-Time"}),u.jsx("span",{style:{color:dn(g),...i&&!d?cs:{}},children:pr(g)})]})]}),(e.transfers!==0||e.adjustments!==0)&&u.jsxs("div",{style:{marginTop:"0.5rem",paddingTop:"0.5rem",borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)",display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",fontSize:"0.7rem",opacity:.7},children:[e.transfers!==0&&u.jsxs("span",{style:{color:K1(e.transfers)},children:[Lt(e.transfers)," transfers"]}),e.adjustments!==0&&u.jsxs("span",{style:{color:K1(e.adjustments)},children:[Lt(e.adjustments)," adjust"]})]}),i&&d&&u.jsx("div",{style:{marginTop:"0.5rem"},children:u.jsxs("span",{style:{fontSize:"0.8rem"},children:[u.jsxs("span",{style:{opacity:.6},children:[_t(r),"  "]}),u.jsxs("span",{style:{color:me.success},children:[t.default_monthly_amount,"%"]}),u.jsx("span",{style:{opacity:.6},children:" = "}),u.jsx("span",{style:{color:me.success},children:_t(h)})]})})]})}function Nf(t){return t===0?me.zero:t>0?me.success:me.error}function Y1({name:t,categories:e,groupTotals:n,getCategoryBalance:r,localAllocations:i,savedAllocations:o,previousMonthIncome:l,isDraftMode:d,onAllocationChange:h,isMobile:m,isUngrouped:p,getAllocationAmount:g,gridTemplateColumns:v}){const b={paddingTop:"0.6rem",paddingBottom:"0.6rem",paddingLeft:"0.5rem",paddingRight:"0.5rem",marginTop:"1.25rem",borderTop:"1px solid rgba(255,255,255,0.2)",borderBottom:Da,background:"rgba(255,255,255,0.04)",display:"flex",alignItems:"center",fontSize:"0.9rem",fontWeight:600},C=n.allocated+n.spent+n.transfers+n.adjustments,x=e.reduce((S,[E,T])=>{const I=T.balance??0;if(d){const D=g(E,T),B=o[E]??0,$=D-B;return S+I+$}return S+I},0);return u.jsxs("div",{style:{display:"contents"},children:[!m&&u.jsxs(u.Fragment,{children:[u.jsxs("div",{style:{...b,paddingLeft:"0.5rem",opacity:p?.7:1},children:[u.jsx("span",{children:t}),u.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",e.length,")"]})]}),u.jsx("div",{style:{...b,justifyContent:"flex-end",color:dn(n.start)},children:Yt.showGroupTotals}),u.jsx("div",{style:{...b,justifyContent:d?"center":"flex-end",color:gc(n.allocated)},children:Yt.showGroupTotals}),u.jsx("div",{style:{...b,justifyContent:"flex-end",color:pc(n.spent)},children:Yt.showGroupTotals}),u.jsx("div",{style:{...b,justifyContent:"flex-end",color:Nf(n.transfers)},children:Yt.showGroupTotals}),u.jsx("div",{style:{...b,justifyContent:"flex-end",color:Nf(n.adjustments)},children:Yt.showGroupTotals}),u.jsx("div",{style:{...b,justifyContent:"flex-end",color:dn(C)},children:Yt.showGroupTotals}),u.jsx("div",{style:{...b,justifyContent:"flex-end",color:dn(n.end),paddingRight:"1rem",borderRight:"2px solid rgba(128, 128, 128, 0.4)"},children:Yt.showGroupTotals}),u.jsx("div",{style:{...b,justifyContent:"flex-end",color:dn(x)},children:Yt.showGroupTotals})]}),!d&&m&&u.jsxs("div",{style:{gridColumn:"1 / -1",paddingTop:"0.6rem",paddingBottom:"0.6rem",paddingLeft:"0.5rem",paddingRight:"0.5rem",marginTop:"1.25rem",borderTop:"1px solid rgba(255,255,255,0.2)",borderBottom:Da,background:"rgba(255,255,255,0.04)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[u.jsxs("span",{style:{fontWeight:600,opacity:p?.7:1},children:[t,u.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",e.length,")"]})]}),Yt.showGroupTotals]}),e.map(([S,E],T)=>{const I=r(S);if(!I)return null;const D=E.balance??0;let B=D;if(d){const $=g(S,E),k=o[S]??0,j=$-k;B=D+j}return m?u.jsx("div",{style:{gridColumn:"1 / -1"},children:u.jsx(Gz,{category:E,balance:I,localAllocation:i[S]||"",previousMonthIncome:l,isDraftMode:d,onAllocationChange:$=>h(S,$),projectedAllTime:B})},S):u.jsx(Qz,{category:E,balance:I,localAllocation:i[S]||"",previousMonthIncome:l,isDraftMode:d,onAllocationChange:$=>h(S,$),allTimeBalance:B,isEvenRow:T%2===0,gridTemplateColumns:v},S)})]})}function Qz({category:t,balance:e,localAllocation:n,previousMonthIncome:r,isDraftMode:i,onAllocationChange:o,allTimeBalance:l,isEvenRow:d,gridTemplateColumns:h}){const m=t.default_monthly_type==="percentage"&&t.default_monthly_amount!==void 0&&t.default_monthly_amount>0,p=m?t.default_monthly_amount/100*r:0,g=m?p.toFixed(2):n,v=t.balance??0,b=v<0,C=b?Math.abs(v):0,x=m?p:parseFloat(n)||0,S=b?Math.min(x,C):0,E=b?Math.max(0,x-C):0,T=b&&x>0&&E>0,I=d?"transparent":"rgba(255,255,255,0.04)",D={paddingTop:"0.6rem",paddingBottom:"0.6rem",paddingLeft:"0.5rem",paddingRight:"0.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem",minHeight:"2.4rem",boxSizing:"border-box"},B=e.allocated+e.spent+e.transfers+e.adjustments;return u.jsxs("div",{style:{gridColumn:"1 / -1",background:I,display:"grid",gridTemplateColumns:h},children:[u.jsx("div",{style:{paddingTop:"0.6rem",paddingBottom:"0.6rem",paddingRight:"0.5rem",paddingLeft:"1.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem",fontWeight:500,overflow:"hidden",borderLeft:"2px solid rgba(255,255,255,0.1)",minHeight:"2.4rem",boxSizing:"border-box"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.name})}),u.jsx("div",{style:{...D,justifyContent:"flex-end",color:dn(e.start_balance)},children:pr(e.start_balance)}),i?u.jsx("div",{style:{...D,justifyContent:"center",flexDirection:"column",gap:"0.1rem",paddingTop:"0.35rem",paddingBottom:"0.35rem"},children:m?u.jsxs("span",{style:{fontSize:"0.85rem"},children:[u.jsxs("span",{style:{color:me.success},children:[t.default_monthly_amount,"%"]}),u.jsx("span",{style:{opacity:.5},children:" = "}),u.jsx("span",{style:{color:me.success},children:_t(p)})]}):u.jsxs(u.Fragment,{children:[u.jsx("input",{type:"text",inputMode:"decimal",value:g?`$${g}`:"",onChange:$=>{const k=$.target.value.replace(/[^\d.]/g,"");o(k)},placeholder:"$0.00",style:{width:"100px",padding:"0.2rem 0.5rem",borderRadius:"4px",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"0.9rem",lineHeight:1,color:"inherit",boxSizing:"border-box"}}),b&&x>0&&u.jsxs("div",{style:{fontSize:"0.6rem",whiteSpace:"nowrap",textAlign:"center",lineHeight:1.3,display:"flex",flexDirection:"column",alignItems:"center"},children:[u.jsxs("span",{style:{color:me.debt},children:[_t(S),"  debt"]}),T&&u.jsxs("span",{style:{color:me.success},children:[_t(E),"  bal"]})]})]})}):(()=>{const $=e.start_balance<0,k=$?Math.abs(e.start_balance):0,j=$?Math.min(e.allocated,k):0,N=$?Math.max(0,e.allocated-k):0,F=$&&e.allocated>0;return u.jsxs("div",{style:{...D,justifyContent:"flex-end",flexDirection:"column",alignItems:"flex-end",gap:"0.1rem",color:gc(e.allocated)},children:[u.jsxs("span",{children:["+",_t(e.allocated)]}),F&&u.jsxs("div",{style:{fontSize:"0.6rem",whiteSpace:"nowrap",textAlign:"right",lineHeight:1.3,display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[u.jsxs("span",{style:{color:me.debt},children:[_t(j),"  debt"]}),N>0&&u.jsxs("span",{style:{color:me.success},children:[_t(N),"  bal"]})]})]})})(),u.jsx("div",{style:{...D,justifyContent:"flex-end",color:pc(e.spent)},children:wt(e.spent)}),u.jsx("div",{style:{...D,justifyContent:"flex-end",color:Nf(e.transfers)},children:Lt(e.transfers)}),u.jsx("div",{style:{...D,justifyContent:"flex-end",color:Nf(e.adjustments)},children:Lt(e.adjustments)}),u.jsx("div",{style:{...D,justifyContent:"flex-end",color:dn(B),...i&&!m?cs:{}},children:Lt(B)}),u.jsx("div",{style:{...D,justifyContent:"flex-end",fontWeight:600,color:dn(e.end_balance),paddingRight:"1rem",borderRight:"2px solid rgba(128, 128, 128, 0.4)",...i&&!m?cs:{}},children:pr(e.end_balance)}),u.jsx("div",{style:{...D,justifyContent:"flex-end",color:dn(l),...i&&!m?cs:{}},children:pr(l)})]})}function Wz(t,e){const{includeHidden:n=!1}={},r=Object.entries(t).filter(([,i])=>n||!i.is_hidden).reduce((i,[o,l])=>{const d=l.category_group_id||"ungrouped";return i[d]||(i[d]=[]),i[d].push([o,l]),i},{});return Object.keys(r).forEach(i=>{r[i].sort((o,l)=>o[1].sort_order-l[1].sort_order)}),r}function Kz(t,e,n,r,i){const o={};t?.category_balances&&t.category_balances.forEach(d=>{o[d.category_id]=d});const l={};return Object.entries(e).forEach(([d,h])=>{const m=o[d],p=m?.start_balance??0,g=m?.spent??0;let v=0;n?v=i(d,h):r&&m&&(v=m.allocated);let b=0;t?.transfers&&t.transfers.forEach(x=>{x.to_category_id===d&&(b+=x.amount),x.from_category_id===d&&(b-=x.amount)});let C=0;t?.adjustments&&(C=t.adjustments.filter(x=>x.category_id===d).reduce((x,S)=>x+S.amount,0)),l[d]={category_id:d,start_balance:p,allocated:v,spent:g,transfers:b,adjustments:C,end_balance:p+v+g+b+C}}),l}function Yz(t,e){const n={};t?.account_balances&&t.account_balances.forEach(i=>{n[i.account_id]=i});const r={};return Object.entries(e).forEach(([i,o])=>{const d=n[i]?.start_balance??o.balance;let h=0;t?.income&&(h=t.income.filter(b=>b.account_id===i).reduce((b,C)=>b+C.amount,0));let m=0;t?.expenses&&(m=t.expenses.filter(b=>b.account_id===i).reduce((b,C)=>b+C.amount,0));let p=0;t?.transfers&&t.transfers.forEach(b=>{b.to_account_id===i&&(p+=b.amount),b.from_account_id===i&&(p-=b.amount)});let g=0;t?.adjustments&&(g=t.adjustments.filter(b=>b.account_id===i).reduce((b,C)=>b+C.amount,0));const v=h+m+p+g;r[i]={account_id:i,start_balance:d,income:h,expenses:m,transfers:p,adjustments:g,net_change:v,end_balance:d+v}}),r}function Xz(t){return Object.values(t).reduce((e,n)=>({start:e.start+n.start_balance,income:e.income+n.income,expenses:e.expenses+n.expenses,transfers:e.transfers+n.transfers,adjustments:e.adjustments+n.adjustments,netChange:e.netChange+n.net_change,end:e.end+n.end_balance}),{start:0,income:0,expenses:0,transfers:0,adjustments:0,netChange:0,end:0})}function Zz(t){return Object.values(t).reduce((e,n)=>({start:e.start+n.start_balance,allocated:e.allocated+n.allocated,spent:e.spent+n.spent,transfers:e.transfers+n.transfers,adjustments:e.adjustments+n.adjustments,end:e.end+n.end_balance}),{start:0,allocated:0,spent:0,transfers:0,adjustments:0,end:0})}function sA(t,e){const n={},r={};return t?.account_balances&&t.account_balances.forEach(i=>{r[i.account_id]=i}),t?(Object.entries(e).forEach(([i,o])=>{const d=r[i]?.start_balance??o.balance;let h=0,m=0;t?.income&&t.income.filter(T=>T.account_id===i).forEach(T=>{m+=T.amount,h+=T.amount});let p=0,g=0;t?.expenses&&t.expenses.filter(T=>T.account_id===i).forEach(T=>{g+=T.amount,T.cleared===!0&&(p+=T.amount)});let v=0,b=0;t?.transfers&&t.transfers.forEach(T=>{T.to_account_id===i&&(b+=T.amount,T.cleared===!0&&(v+=T.amount)),T.from_account_id===i&&(b-=T.amount,T.cleared===!0&&(v-=T.amount))});let C=0,x=0;t?.adjustments&&t.adjustments.filter(T=>T.account_id===i).forEach(T=>{x+=T.amount,T.cleared===!0&&(C+=T.amount)});const S=h+p+v+C,E=m+g+b+x;n[i]={account_id:i,cleared_balance:d+S,uncleared_balance:d+E}}),n):(Object.entries(e).forEach(([i,o])=>{n[i]={account_id:i,cleared_balance:o.balance??0,uncleared_balance:o.balance??0}}),n)}function X1(t){return t===0?me.zero:t>0?me.success:me.error}function Jz({isDraftMode:t,allocationsFinalized:e,balanceTotals:n,grandAllTime:r,onSave:i,onApply:o,onEdit:l,onCancel:d,onDelete:h}){const m={paddingTop:"0.6rem",paddingBottom:"0.6rem",paddingLeft:"0.5rem",paddingRight:"0.5rem",borderTop:"2px solid rgba(255,255,255,0.3)",borderBottom:"2px solid rgba(255,255,255,0.3)",fontWeight:600,display:"flex",alignItems:"center",fontSize:"0.9rem"},p=n.allocated+n.spent+n.transfers+n.adjustments;return u.jsxs(u.Fragment,{children:[u.jsxs("div",{style:{...m,gap:"0.75rem"},children:["Grand Totals",!t&&u.jsx(e_,{isDraftMode:!1,isEditingAppliedAllocations:!1,allocationsFinalized:e,onSave:i,onApply:o,onEdit:l,onCancel:d,onDelete:h})]}),u.jsx("div",{style:{...m,justifyContent:"flex-end",color:dn(n.start)},children:pr(n.start)}),u.jsxs("div",{style:{...m,justifyContent:t?"center":"flex-end",color:gc(n.allocated),...t?cs:{}},children:["+",_t(n.allocated)]}),u.jsx("div",{style:{...m,justifyContent:"flex-end",color:pc(n.spent)},children:wt(n.spent)}),u.jsx("div",{style:{...m,justifyContent:"flex-end",color:X1(n.transfers)},children:Lt(n.transfers)}),u.jsx("div",{style:{...m,justifyContent:"flex-end",color:X1(n.adjustments)},children:Lt(n.adjustments)}),u.jsx("div",{style:{...m,justifyContent:"flex-end",color:dn(p),...t?cs:{}},children:Lt(p)}),u.jsx("div",{style:{...m,justifyContent:"flex-end",color:dn(n.end),paddingRight:"1rem",borderRight:"2px solid rgba(128, 128, 128, 0.4)",...t?cs:{}},children:pr(n.end)}),u.jsx("div",{style:{...m,justifyContent:"flex-end",color:dn(r),...t?cs:{}},children:pr(r)})]})}function eB({allocationsFinalized:t,availableNow:e,currentMonthIncome:n,balanceTotals:r,draftChangeAmount:i,availableAfterApply:o,currentDraftTotal:l,onSave:d,onApply:h,onEdit:m,onCancel:p,onDelete:g}){return u.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem",borderTop:"2px solid rgba(255,255,255,0.3)",borderBottom:"2px solid rgba(255,255,255,0.3)"},children:[u.jsx("span",{style:{fontWeight:600},children:"Grand Totals:"}),u.jsx(rA,{isDraftMode:!1,isEditingAppliedAllocations:!1,availableNow:e,currentMonthIncome:n,balanceTotals:r,draftChangeAmount:i,availableAfterApply:o,currentDraftTotal:l}),u.jsx(e_,{isDraftMode:!1,isEditingAppliedAllocations:!1,allocationsFinalized:t,onSave:d,onApply:h,onEdit:m,onCancel:p,onDelete:g})]})}const fi={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderBottom:"2px solid rgba(255,255,255,0.2)"};function tB(t){if(!t)return"";switch(t.phase){case"reading-budget":return"Reading budget data...";case"fetching-months":return"Fetching months...";case"recalculating":return t.currentMonth?`Recalculating ${t.currentMonth}...`:"Recalculating...";case"saving":return"Saving results...";case"complete":return"Recalculation complete!";default:return"Recalculating balances..."}}function nB(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n}=Ye(),{categories:r,categoryGroups:i,monthMap:o}=Rn(),{month:l}=Qs(t,e,n),d=Ai(),[h,m]=M.useState(null);ld({budgetId:t,year:e,month:n,monthMap:o,requireMonthLoaded:!0,currentMonth:l,onProgress:G=>m(G),logPrefix:"[MonthCategories]"});const[p,g]=M.useState(!1),{localAllocations:v,isEditingAppliedAllocations:b,error:C,availableNow:x,currentDraftTotal:S,draftChangeAmount:E,availableAfterApply:T,previousMonthIncome:I,currentMonthIncome:D,allocationsFinalized:B,getAllocationAmount:$,handleAllocationChange:k,resetAllocationsToSaved:j,handleSaveAllocations:N,handleFinalizeAllocations:F,setIsEditingAppliedAllocations:q,setError:A}=X4(),P=[...i].sort((G,ne)=>G.sort_order-ne.sort_order),O=M.useMemo(()=>Wz(r),[r]),X=!B||b,W=M.useMemo(()=>Kz(l,r,X,B,$),[l,r,X,B,$]),H=G=>W[G],Z=M.useMemo(()=>Zz(W),[W]),Y=M.useMemo(()=>{const G={};if(l?.category_balances)for(const ne of l.category_balances)G[ne.category_id]=ne.allocated;return G},[l]),se=M.useMemo(()=>Object.entries(r).reduce((G,[ne,ie])=>{const te=ie.balance??0;if(X){const ue=$(ne,ie),ve=Y[ne]??0,ce=ue-ve;return G+te+ce}return G+te},0),[r,X,$,Y]),L={onSave:N,onApply:F,onEdit:()=>q(!0),onCancel:j,onDelete:()=>g(!0)};return u.jsxs(u.Fragment,{children:[h&&u.jsxs(Y0,{message:tB(h),spinnerColor:"#22c55e",children:[u.jsx(tA,{percent:h.percentComplete,gradient:"linear-gradient(90deg, #22c55e, #10b981)"}),u.jsxs("div",{style:{display:"flex",gap:"2rem",justifyContent:"center",flexWrap:"wrap"},children:[(h.totalMonthsToFetch??0)>0&&u.jsx(Of,{value:`${h.monthsFetched||0}/${h.totalMonthsToFetch}`,label:"Months Loaded",color:h.phase==="fetching-months"?"#22c55e":"#6b7280"}),(h.totalMonths??0)>0&&u.jsx(Of,{value:`${h.monthsProcessed}/${h.totalMonths}`,label:"Months Recalculated",color:h.phase==="recalculating"?"#22c55e":"#6b7280"})]}),u.jsx(nA,{percent:h.percentComplete})]}),C&&u.jsx(mm,{message:C,onDismiss:()=>A(null)}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:d?"1fr":X?"2fr 1fr 200px 1fr 1fr 1fr 1fr 1fr 120px":"2fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 120px"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"#242424",display:d?"block":"grid",gridTemplateColumns:d?void 0:"subgrid"},children:[X&&u.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexDirection:d?"column":"row",flexWrap:"wrap",alignItems:d?"stretch":"center",gap:d?"0.5rem":"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:d?"0.5rem":"0.25rem"},children:[u.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:d?void 0:1,alignItems:"center"},children:u.jsx(rA,{isDraftMode:X,isEditingAppliedAllocations:b,availableNow:x,currentMonthIncome:D,balanceTotals:Z,draftChangeAmount:E,availableAfterApply:T,currentDraftTotal:S})}),u.jsx(e_,{isDraftMode:X,isEditingAppliedAllocations:b,allocationsFinalized:B,...L})]}),!d&&u.jsxs(u.Fragment,{children:[u.jsx("div",{style:fi,children:"Category"}),u.jsx("div",{style:{...fi,textAlign:"right"},children:"Start"}),u.jsx("div",{style:{...fi,textAlign:X?"center":"right"},children:"Allocated"}),u.jsx("div",{style:{...fi,textAlign:"right"},children:"Spent"}),u.jsx("div",{style:{...fi,textAlign:"right"},children:"Transfers"}),u.jsx("div",{style:{...fi,textAlign:"right"},children:"Adjust"}),u.jsx("div",{style:{...fi,textAlign:"right"},children:"Net Change"}),u.jsx("div",{style:{...fi,textAlign:"right",paddingRight:"1rem",borderRight:"2px solid rgba(128, 128, 128, 0.4)"},children:"End"}),u.jsx("div",{style:{...fi,textAlign:"right"},children:"All-Time"})]}),!d&&u.jsx(Jz,{isDraftMode:X,allocationsFinalized:B,balanceTotals:Z,grandAllTime:se,...L}),!X&&d&&u.jsx(eB,{allocationsFinalized:B,availableNow:x,currentMonthIncome:D,balanceTotals:Z,draftChangeAmount:E,availableAfterApply:T,currentDraftTotal:S,...L})]}),Object.keys(r).length===0&&u.jsxs("p",{style:{gridColumn:"1 / -1",opacity:.6,textAlign:"center",padding:"2rem"},children:["No categories yet. ",u.jsx(An,{to:"/budget/settings/categories",style:{opacity:1},children:"Create categories "})]}),P.map(G=>{const ne=O[G.id]||[];if(ne.length===0)return null;const ie=ne.reduce((te,[ue])=>{const ve=H(ue);return ve?{start:te.start+ve.start_balance,allocated:te.allocated+ve.allocated,spent:te.spent+ve.spent,transfers:te.transfers+ve.transfers,adjustments:te.adjustments+ve.adjustments,end:te.end+ve.end_balance}:te},{start:0,allocated:0,spent:0,transfers:0,adjustments:0,end:0});return u.jsx(Y1,{name:G.name,categories:ne,groupTotals:ie,getCategoryBalance:H,localAllocations:v,savedAllocations:Y,previousMonthIncome:I,isDraftMode:X,onAllocationChange:k,isMobile:d,getAllocationAmount:$,gridTemplateColumns:X?"2fr 1fr 200px 1fr 1fr 1fr 1fr 1fr 120px":"2fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 120px"},G.id)}),O[cn]?.length>0&&(()=>{const G=O[cn],ne=G.reduce((ie,[te])=>{const ue=H(te);return ue?{start:ie.start+ue.start_balance,allocated:ie.allocated+ue.allocated,spent:ie.spent+ue.spent,transfers:ie.transfers+ue.transfers,adjustments:ie.adjustments+ue.adjustments,end:ie.end+ue.end_balance}:ie},{start:0,allocated:0,spent:0,transfers:0,adjustments:0,end:0});return u.jsx(Y1,{name:"Uncategorized",categories:G,groupTotals:ne,getCategoryBalance:H,localAllocations:v,savedAllocations:Y,previousMonthIncome:I,isDraftMode:X,onAllocationChange:k,isMobile:d,isUngrouped:!0,getAllocationAmount:$,gridTemplateColumns:X?"2fr 1fr 200px 1fr 1fr 1fr 1fr 1fr 120px":"2fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 120px"},cn)})(),u.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]}),u.jsx(qz,{isOpen:p,onClose:()=>g(!1),onDeleted:()=>q(!1)})]})}function iA(t){return t===0?me.zero:t>0?me.success:me.error}function aA(t){return t===0?me.zero:t<0?me.error:me.success}function pa(t){return t===0?me.zero:t>0?me.success:me.error}function Z1({name:t,accounts:e,groupTotals:n,accountBalances:r,accountClearedBalances:i,isMobile:o,isUngrouped:l}){const d={padding:"0.6rem 0.5rem",marginTop:"1.25rem",borderTop:"1px solid rgba(255,255,255,0.2)",borderBottom:Da,background:"rgba(255,255,255,0.04)",display:"flex",alignItems:"center",fontSize:"0.9rem",fontWeight:600};return u.jsxs("div",{style:{display:"contents"},children:[!o&&u.jsxs(u.Fragment,{children:[u.jsxs("div",{style:{...d,opacity:l?.7:1},children:[u.jsx("span",{children:t}),u.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",e.length,")"]})]}),u.jsx("div",{style:{...d,justifyContent:"flex-end",color:ot(n.start)},children:Yt.showGroupTotals}),u.jsx("div",{style:{...d,justifyContent:"flex-end",color:iA(n.income)},children:Yt.showGroupTotals}),u.jsx("div",{style:{...d,justifyContent:"flex-end",color:aA(n.expenses)},children:Yt.showGroupTotals}),u.jsx("div",{style:{...d,justifyContent:"flex-end",color:pa(n.transfers)},children:Yt.showGroupTotals}),u.jsx("div",{style:{...d,justifyContent:"flex-end",color:pa(n.adjustments)},children:Yt.showGroupTotals}),u.jsx("div",{style:{...d,justifyContent:"flex-end",color:pa(n.netChange)},children:Yt.showGroupTotals}),u.jsx("div",{style:{...d,justifyContent:"flex-end",color:ot(n.end)},children:Yt.showGroupTotals}),u.jsx("div",{style:{...d,justifyContent:"flex-end"},children:Yt.showGroupTotals}),u.jsx("div",{style:{...d,justifyContent:"flex-end"},children:Yt.showGroupTotals}),u.jsx("div",{style:{...d,justifyContent:"flex-end"},children:Yt.showGroupTotals})]}),o&&u.jsxs("div",{style:{gridColumn:"1 / -1",padding:"0.6rem 0.5rem",marginTop:"1.25rem",borderTop:"1px solid rgba(255,255,255,0.2)",borderBottom:Da,background:"rgba(255,255,255,0.04)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[u.jsxs("span",{style:{fontWeight:600,opacity:l?.7:1},children:[t,u.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",e.length,")"]})]}),Yt.showGroupTotals]}),e.map(([h,m],p)=>{const g=r[h];if(!g)return null;const v=i?.[h];return o?u.jsx("div",{style:{gridColumn:"1 / -1"},children:u.jsx(sB,{account:m,balance:g,clearedBalance:v})},h):u.jsx(rB,{account:m,balance:g,clearedBalance:v,isEvenRow:p%2===0},h)})]})}function rB({account:t,balance:e,clearedBalance:n,isEvenRow:r}){const i=r?"transparent":"rgba(255,255,255,0.04)",o={padding:"0.5rem 0.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem"};return u.jsxs("div",{style:{gridColumn:"1 / -1",background:i,display:"grid",gridTemplateColumns:"2fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr"},children:[u.jsx("div",{style:{...o,fontWeight:500,overflow:"hidden",paddingLeft:"1.5rem",borderLeft:"2px solid rgba(255,255,255,0.1)"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.nickname})}),u.jsx("div",{style:{...o,justifyContent:"flex-end",color:ot(e.start_balance)},children:wt(e.start_balance)}),u.jsxs("div",{style:{...o,justifyContent:"flex-end",color:iA(e.income)},children:["+",_t(e.income)]}),u.jsx("div",{style:{...o,justifyContent:"flex-end",color:aA(e.expenses)},children:wt(e.expenses)}),u.jsx("div",{style:{...o,justifyContent:"flex-end",color:pa(e.transfers)},children:Lt(e.transfers)}),u.jsx("div",{style:{...o,justifyContent:"flex-end",color:pa(e.adjustments)},children:Lt(e.adjustments)}),u.jsx("div",{style:{...o,justifyContent:"flex-end",color:pa(e.net_change)},children:Lt(e.net_change)}),u.jsx("div",{style:{...o,justifyContent:"flex-end",fontWeight:600,color:ot(e.end_balance)},children:wt(e.end_balance)}),n?u.jsx("div",{style:{...o,justifyContent:"flex-end",color:ot(n.uncleared_balance),fontWeight:600},children:wt(n.uncleared_balance)}):u.jsx("div",{style:{...o,justifyContent:"flex-end",opacity:.3,color:"#9ca3af"},children:""}),n?u.jsx("div",{style:{...o,justifyContent:"flex-end",color:ot(n.cleared_balance)},children:Math.abs(n.uncleared_balance-n.cleared_balance)<.01?u.jsx("span",{style:{opacity:.3,color:"#9ca3af"},children:""}):wt(n.cleared_balance)}):u.jsx("div",{style:{...o,justifyContent:"flex-end",opacity:.3,color:"#9ca3af"},children:""}),n&&Math.abs(n.uncleared_balance-n.cleared_balance)>=.01?u.jsx("div",{style:{...o,justifyContent:"flex-end",color:pa(n.uncleared_balance-n.cleared_balance)},children:Lt(n.uncleared_balance-n.cleared_balance)}):u.jsx("div",{style:{...o,justifyContent:"flex-end",opacity:.3,color:"#9ca3af"},children:""})]})}function sB({account:t,balance:e,clearedBalance:n}){return u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",padding:"0.75rem",marginBottom:"0.25rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem"},children:u.jsx("span",{style:{fontWeight:500},children:t.nickname})}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:n&&Math.abs(n.uncleared_balance-n.cleared_balance)>=.01?"1fr 1fr 1fr 1fr":"1fr 1fr 1fr",gap:"0.25rem",fontSize:"0.75rem"},children:[u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:"Start"}),u.jsx("span",{children:wt(e.start_balance)})]}),u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:"Net Change"}),u.jsx("span",{style:{color:ot(e.net_change)},children:Lt(e.net_change)})]}),u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:"End"}),u.jsx("span",{style:{color:ot(e.end_balance)},children:wt(e.end_balance)})]}),n&&u.jsxs(u.Fragment,{children:[u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:"Total"}),u.jsx("span",{style:{color:ot(n.uncleared_balance),fontWeight:600},children:wt(n.uncleared_balance)})]}),Math.abs(n.uncleared_balance-n.cleared_balance)>=.01?u.jsxs(u.Fragment,{children:[u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:"Cleared"}),u.jsx("span",{style:{color:ot(n.cleared_balance)},children:wt(n.cleared_balance)})]}),u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:"Uncleared"}),u.jsx("span",{style:{color:pa(n.uncleared_balance-n.cleared_balance)},children:Lt(n.uncleared_balance-n.cleared_balance)})]})]}):u.jsxs(u.Fragment,{children:[u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:"Cleared"}),u.jsx("span",{style:{opacity:.3,color:"#9ca3af"},children:""})]}),u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:"Uncleared"}),u.jsx("span",{style:{opacity:.3,color:"#9ca3af"},children:""})]})]})]})]}),(e.income!==0||e.expenses!==0||e.transfers!==0||e.adjustments!==0)&&u.jsxs("div",{style:{marginTop:"0.5rem",paddingTop:"0.5rem",borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)",display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",fontSize:"0.7rem",opacity:.7},children:[e.income!==0&&u.jsxs("span",{children:[Lt(e.income)," income"]}),e.expenses!==0&&u.jsxs("span",{children:[wt(e.expenses)," expenses"]}),e.transfers!==0&&u.jsxs("span",{children:[Lt(e.transfers)," transfers"]}),e.adjustments!==0&&u.jsxs("span",{children:[Lt(e.adjustments)," adjust"]})]})]})}const as={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderBottom:"2px solid rgba(255,255,255,0.2)"};function iB(t){return t===0?me.zero:t>0?me.success:me.error}function aB(t){return t===0?me.zero:t<0?me.error:me.success}function Wg(t){return t===0?me.zero:t>0?me.success:me.error}function oB(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n}=Ye(),{accounts:r,accountGroups:i,monthMap:o}=Rn(),{month:l}=Qs(t,e,n),d=Ai(),[h,m]=M.useState(null);ld({budgetId:t,year:e,month:n,monthMap:o,requireMonthLoaded:!0,currentMonth:l,onProgress:I=>m(I),logPrefix:"[MonthAccounts]"});const p=M.useMemo(()=>Object.entries(i).map(([I,D])=>({id:I,...D})).sort((I,D)=>I.sort_order-D.sort_order),[i]),g=M.useMemo(()=>{const I={};return Object.entries(r).filter(([,D])=>!D.is_hidden).forEach(([D,B])=>{const $=B.account_group_id||Jt;I[$]||(I[$]=[]),I[$].push([D,B])}),Object.keys(I).forEach(D=>{I[D].sort((B,$)=>B[1].sort_order-$[1].sort_order)}),I},[r]),v=M.useMemo(()=>Yz(l,r),[l,r]),b=M.useMemo(()=>sA(l,r),[l,r]),C=M.useMemo(()=>Xz(v),[v]),x=C.income+C.expenses,E={...{padding:"0.6rem 0.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem"},borderTop:"2px solid rgba(255,255,255,0.3)",borderBottom:"2px solid rgba(255,255,255,0.3)",fontWeight:600},T=()=>{if(!h)return"";switch(h.phase){case"reading-budget":return"Reading budget data...";case"fetching-months":return"Fetching months...";case"recalculating":return h.currentMonth?`Recalculating ${h.currentMonth}...`:"Recalculating...";case"saving":return"Saving results...";case"complete":return"Recalculation complete!";default:return"Recalculating balances..."}};return u.jsxs(u.Fragment,{children:[h&&u.jsxs(Y0,{message:T(),spinnerColor:"#22c55e",children:[u.jsx(tA,{percent:h.percentComplete,gradient:"linear-gradient(90deg, #22c55e, #10b981)"}),u.jsxs("div",{style:{display:"flex",gap:"2rem",justifyContent:"center",flexWrap:"wrap"},children:[(h.totalMonthsToFetch??0)>0&&u.jsx(Of,{value:`${h.monthsFetched||0}/${h.totalMonthsToFetch}`,label:"Months Loaded",color:h.phase==="fetching-months"?"#22c55e":"#6b7280"}),(h.totalMonths??0)>0&&u.jsx(Of,{value:`${h.monthsProcessed}/${h.totalMonths}`,label:"Months Recalculated",color:h.phase==="recalculating"?"#22c55e":"#6b7280"})]}),u.jsx(nA,{percent:h.percentComplete})]}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:d?"1fr":"2fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"#242424",display:d?"block":"grid",gridTemplateColumns:d?void 0:"subgrid"},children:[!d&&u.jsxs(u.Fragment,{children:[u.jsx("div",{style:as,children:"Account"}),u.jsx("div",{style:{...as,textAlign:"right"},children:"Start"}),u.jsx("div",{style:{...as,textAlign:"right"},children:"Income"}),u.jsx("div",{style:{...as,textAlign:"right"},children:"Expenses"}),u.jsx("div",{style:{...as,textAlign:"right"},children:"Transfers"}),u.jsx("div",{style:{...as,textAlign:"right"},children:"Adjust"}),u.jsx("div",{style:{...as,textAlign:"right"},children:"Net Change"}),u.jsx("div",{style:{...as,textAlign:"right"},children:"End"}),u.jsx("div",{style:{...as,textAlign:"right"},children:"Total"}),u.jsx("div",{style:{...as,textAlign:"right"},children:"Cleared"}),u.jsx("div",{style:{...as,textAlign:"right"},children:"Uncleared"})]}),d?u.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem",borderTop:"2px solid rgba(255,255,255,0.3)",borderBottom:"2px solid rgba(255,255,255,0.3)"},children:[u.jsx("span",{style:{fontWeight:600},children:"Grand Totals:"}),u.jsx(Hz,{totals:C})]}):u.jsxs(u.Fragment,{children:[u.jsx("div",{style:{...E},children:"Grand Totals"}),u.jsx("div",{style:{...E,justifyContent:"flex-end",color:ot(C.start)},children:wt(C.start)}),u.jsxs("div",{style:{...E,justifyContent:"flex-end",color:iB(C.income)},children:["+",_t(C.income)]}),u.jsx("div",{style:{...E,justifyContent:"flex-end",color:aB(C.expenses)},children:wt(C.expenses)}),u.jsx("div",{style:{...E,justifyContent:"flex-end",color:Wg(C.transfers)},children:Lt(C.transfers)}),u.jsx("div",{style:{...E,justifyContent:"flex-end",color:Wg(C.adjustments)},children:Lt(C.adjustments)}),u.jsx("div",{style:{...E,justifyContent:"flex-end",color:Wg(x)},children:Lt(x)}),u.jsx("div",{style:{...E,justifyContent:"flex-end",color:ot(C.end)},children:wt(C.end)}),u.jsx("div",{style:{...E,justifyContent:"flex-end"},children:Object.keys(b).length>0?wt(Object.values(b).reduce((I,D)=>I+D.uncleared_balance,0)):u.jsx("span",{style:{opacity:.3,color:"#9ca3af"},children:""})}),u.jsx("div",{style:{...E,justifyContent:"flex-end"},children:(()=>{if(Object.keys(b).length===0)return u.jsx("span",{style:{opacity:.3,color:"#9ca3af"},children:""});const I=Object.values(b).reduce((B,$)=>B+$.cleared_balance,0),D=Object.values(b).reduce((B,$)=>B+$.uncleared_balance,0);return Math.abs(D-I)<.01?u.jsx("span",{style:{opacity:.3,color:"#9ca3af"},children:""}):wt(I)})()}),u.jsx("div",{style:{...E,justifyContent:"flex-end"},children:(()=>{if(Object.keys(b).length===0)return u.jsx("span",{style:{opacity:.3,color:"#9ca3af"},children:""});const I=Object.values(b).reduce(($,k)=>$+k.cleared_balance,0),B=Object.values(b).reduce(($,k)=>$+k.uncleared_balance,0)-I;return Math.abs(B)<.01?u.jsx("span",{style:{opacity:.3,color:"#9ca3af"},children:""}):Lt(B)})()})]})]}),Object.keys(r).length===0&&u.jsxs("p",{style:{gridColumn:"1 / -1",opacity:.6,textAlign:"center",padding:"2rem"},children:["No accounts yet."," ",u.jsx(An,{to:"/budget/settings/accounts",style:{opacity:1},children:"Add accounts "})]}),p.map(I=>{const D=g[I.id]||[];if(D.length===0)return null;const B=D.reduce(($,[k])=>{const j=v[k];return j?{start:$.start+j.start_balance,income:$.income+j.income,expenses:$.expenses+j.expenses,transfers:$.transfers+j.transfers,adjustments:$.adjustments+j.adjustments,netChange:$.netChange+j.net_change,end:$.end+j.end_balance}:$},{start:0,income:0,expenses:0,transfers:0,adjustments:0,netChange:0,end:0});return u.jsx(Z1,{name:I.name,accounts:D,groupTotals:B,accountBalances:v,accountClearedBalances:b,isMobile:d},I.id)}),g[Jt]?.length>0&&(()=>{const I=g[Jt],D=I.reduce((B,[$])=>{const k=v[$];return k?{start:B.start+k.start_balance,income:B.income+k.income,expenses:B.expenses+k.expenses,transfers:B.transfers+k.transfers,adjustments:B.adjustments+k.adjustments,netChange:B.netChange+k.net_change,end:B.end+k.end_balance}:B},{start:0,income:0,expenses:0,transfers:0,adjustments:0,netChange:0,end:0});return u.jsx(Z1,{name:"Ungrouped",accounts:I,groupTotals:D,accountBalances:v,accountClearedBalances:b,isMobile:d,isUngrouped:!0},Jt)})(),u.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]})]})}const lB=["income","categories","accounts","spend","transfers","adjustments"];function J1(t){const e=t.year?parseInt(t.year,10):null,n=t.month?parseInt(t.month,10):null,r=t.tab&&lB.includes(t.tab)?t.tab:null;return{year:e&&!isNaN(e)&&e>=2e3&&e<=2100?e:null,month:n&&!isNaN(n)&&n>=1&&n<=12?n:null,tab:r}}function cB(){const t=new Date;return{year:t.getFullYear(),month:t.getMonth()+1}}function eS(){const t=D5(),e=Qu(),[n,r]=AS(),{addLoadingHold:i,removeLoadingHold:o}=Qn(),{selectedBudgetId:l,setSelectedBudgetId:d,currentYear:h,currentMonthNumber:m,lastActiveTab:p,setCurrentYear:g,setCurrentMonthNumber:v,setLastActiveTab:b,setPageTitle:C,goToPreviousMonth:x,goToNextMonth:S,hasPendingInvites:E,needsFirstBudget:T,initialDataLoadComplete:I}=Ye(),{budget:D,isLoading:B,monthMap:$}=Rn(),k=!B,[j,N]=M.useState(!1);M.useEffect(()=>(!k||!I?i("budget-data","Loading budget data..."):o("budget-data"),()=>o("budget-data")),[k,I,i,o]);const F=M.useRef(!1),q=n.get("error"),[A,P]=M.useState(q);M.useEffect(()=>{q&&(n.delete("error"),r(n,{replace:!0}))},[q,n,r]);const[O,X]=M.useState(()=>{const{tab:ne}=J1(t);return ne??p}),W=ne=>{X(ne),b(ne)};M.useEffect(()=>{if(F.current)return;const{year:ne,month:ie}=J1(t);ne&&g(ne),ie&&v(ie),F.current=!0},[t,g,v]),M.useEffect(()=>{if(!F.current)return;const ne=`/budget/${h}/${m}/${O}`,ie=`/budget/${t.year}/${t.month}/${t.tab}`;ne!==ie&&e(ne,{replace:!0})},[h,m,O,e,t]);const{month:H,error:Z,isLoading:Y}=Qs(k?l:null,h,m);M.useEffect(()=>{if(!Z||j)return;const ne=Z.message||"";if(ne.includes("Budget")&&ne.includes("does not exist")){queueMicrotask(()=>{d(null),e("/budget/my-budgets?context=budget-not-found",{replace:!0})});return}(ne.includes("months in the past")||ne.includes("Refusing to create month"))&&queueMicrotask(()=>{i("month-redirect","Redirecting to current month..."),N(!0);const{year:ie,month:te}=cB();P(`Cannot create month ${h}/${m} - it's too far in the past. Redirected to current month.`),g(ie),v(te)})},[Z,j,h,m,g,v,i,d,e]),M.useEffect(()=>{j&&H&&!Y&&queueMicrotask(()=>{N(!1),o("month-redirect")})},[j,H,Y,o]),M.useLayoutEffect(()=>{C(D?.name||"Budget")},[D?.name,C]);const{setCurrentViewingDocument:se}=Ye();if(M.useEffect(()=>(D&&h&&m&&se({type:"month",year:h,month:m}),()=>{se({type:null})}),[D,h,m,se]),M.useEffect(()=>{if(k&&!j){if(!D&&!l){e("/budget/my-budgets",{replace:!0});return}if(!D&&E){e("/budget/my-budgets",{replace:!0});return}if(T){e("/budget/my-budgets",{replace:!0});return}}},[k,j,D,l,E,T,e]),h3(l,h,m),ld({budgetId:l,year:h,month:m,monthMap:$,additionalCondition:k&&!!D,logPrefix:"[Budget]"}),!k||!I||j||!D)return null;function L(){P(null),x()}function G(){P(null),S()}return u.jsxs(u.Fragment,{children:[A&&u.jsx(mm,{message:A,onDismiss:()=>P(null)}),u.jsx(Rz,{onPreviousMonth:L,onNextMonth:G}),u.jsx(yz,{activeTab:O,setActiveTab:W,allocationsFinalized:H?.are_allocations_finalized}),O==="income"&&u.jsx(Oz,{},`${h}-${m}`),O==="categories"&&u.jsx(nB,{},`${h}-${m}`),O==="accounts"&&u.jsx(oB,{},`${h}-${m}`),O==="spend"&&u.jsx(Pz,{},`${h}-${m}`),O==="transfers"&&u.jsx(Fz,{},`${h}-${m}`),O==="adjustments"&&u.jsx($z,{},`${h}-${m}`)]})}function uB(){const{setPageTitle:t}=Ye();return M.useLayoutEffect(()=>{t("Analytics")},[t]),u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"50vh",textAlign:"center",gap:"1.5rem"},children:[u.jsx("div",{style:{fontSize:"4rem",opacity:.8},children:""}),u.jsx("h1",{style:{margin:0,fontSize:"2rem",fontWeight:600},children:"Analytics"}),u.jsx("p",{style:{margin:0,fontSize:"1.25rem",opacity:.6,maxWidth:"400px"},children:"Coming Soon"}),u.jsx("p",{style:{margin:0,fontSize:"0.95rem",opacity:.5,maxWidth:"500px",lineHeight:1.6},children:"Track spending trends, category breakdowns, and insights about your budget over time."}),u.jsx(An,{to:"/budget",style:{marginTop:"1rem",padding:"0.75rem 1.5rem",background:me.primary,color:"white",borderRadius:"8px",textDecoration:"none",fontWeight:500,transition:"opacity 0.15s"},children:"Back to Budget"})]})}function dB(){const t=$t();return{createBudget:Gn({mutationFn:async({name:n,userId:r,userEmail:i})=>{const o=`budget_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,l=new Date().toISOString(),d={name:n.trim()||"My Budget",user_ids:[r],accepted_user_ids:[r],owner_id:r,owner_email:i,accounts:{},account_groups:{[Jt]:{name:"Ungrouped",sort_order:0,expected_balance:"positive",on_budget:null,is_active:null}},categories:{},category_groups:[{id:cn,name:"Uncategorized",sort_order:0}],total_available:0,is_needs_recalculation:!1,month_map:{},created_at:l,updated_at:l};return await Hn("budgets",o,d,"creating new budget document"),await Hn("users",r,{uid:r,email:i,budget_ids:Uu(o),updated_at:l},"adding new budget to user's budget list",{merge:!0}),{budgetId:o,budget:{id:o,...d}}},onSuccess:(n,{userId:r})=>{t.invalidateQueries({queryKey:Ie.user(r)}),t.invalidateQueries({queryKey:Ie.accessibleBudgets(r)})}})}}function hB(){const t=$t();return{acceptInvite:Gn({mutationFn:async({budgetId:n,userId:r})=>{const i=new Date().toISOString(),{exists:o,data:l}=await Rt("budgets",n,"validating user was invited to this budget");if(!o||!l)throw new Error("Budget not found");if(!l.user_ids?.includes(r))throw new Error("You have not been invited to this budget");if(l.accepted_user_ids?.includes(r))throw new Error("You have already accepted this invite");return await Hn("users",r,{uid:r,budget_ids:Uu(n),updated_at:i},"adding accepted budget to user's budget list",{merge:!0}),await Hn("budgets",n,{accepted_user_ids:Uu(r),updated_at:i},"marking user as accepted in budget's accepted_user_ids",{merge:!0}),{budgetId:n}},onSuccess:(n,{userId:r})=>{t.invalidateQueries({queryKey:Ie.user(r)}),t.invalidateQueries({queryKey:Ie.accessibleBudgets(r)}),t.invalidateQueries({queryKey:Ie.budget(n.budgetId)})}})}}function fB(){const t=$t(),e=Gn({onMutate:async r=>{const{budgetId:i,userId:o}=r,l=Ie.budget(i);await t.cancelQueries({queryKey:l});const d=t.getQueryData(l);return d&&t.setQueryData(l,{...d,budget:{...d.budget,user_ids:[...d.budget.user_ids,o]}}),{previousData:d}},mutationFn:async r=>{const{budgetId:i,userId:o}=r,{exists:l,data:d}=await Rt("budgets",i,"validating user is not already invited");if(!l||!d)throw new Error("Budget not found");if(d.user_ids?.includes(o))throw new Error("User is already invited");return await gm({budgetId:i,updates:{user_ids:Uu(o)},description:"adding user to budget's invited users list"}),{budgetId:i}},onError:(r,i,o)=>{o?.previousData&&t.setQueryData(Ie.budget(i.budgetId),o.previousData)}});return{inviteUser:{mutate:r=>e.mutate(r),mutateAsync:r=>e.mutateAsync(r),isPending:e.isPending,isError:e.isError,error:e.error,reset:e.reset}}}function mB(){const t=$t(),e=Gn({onMutate:async r=>{const{budgetId:i,userId:o}=r,l=Ie.budget(i);await t.cancelQueries({queryKey:l});const d=t.getQueryData(l);return d&&t.setQueryData(l,{...d,budget:{...d.budget,user_ids:d.budget.user_ids.filter(h=>h!==o),accepted_user_ids:d.budget.accepted_user_ids.filter(h=>h!==o)}}),{previousData:d}},mutationFn:async r=>{const{budgetId:i,userId:o}=r;return await gm({budgetId:i,updates:{user_ids:T1(o),accepted_user_ids:T1(o)},description:"removing user from budget's access lists"}),{budgetId:i}},onError:(r,i,o)=>{o?.previousData&&t.setQueryData(Ie.budget(i.budgetId),o.previousData)}});return{revokeUser:{mutate:r=>e.mutate(r),mutateAsync:r=>e.mutateAsync(r),isPending:e.isPending,isError:e.isError,error:e.error,reset:e.reset}}}function pB({message:t,onDismiss:e}){return u.jsxs("div",{style:{background:"rgba(220, 38, 38, 0.1)",border:"1px solid rgba(220, 38, 38, 0.3)",color:"#f87171",padding:"0.75rem 1rem",borderRadius:"8px",marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[u.jsx("span",{children:t}),u.jsx("button",{onClick:e,style:{background:"transparent",border:"none",color:"#f87171",cursor:"pointer",fontSize:"1.2rem",padding:"0 0.25rem",lineHeight:1},children:""})]})}function gB({message:t,onDismiss:e}){return u.jsxs("div",{style:{background:"rgba(34, 197, 94, 0.1)",border:"1px solid rgba(34, 197, 94, 0.3)",color:"#4ade80",padding:"0.75rem 1rem",borderRadius:"8px",marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[u.jsx("span",{children:t}),u.jsx("button",{onClick:e,style:{background:"transparent",border:"none",color:"#4ade80",cursor:"pointer",fontSize:"1.2rem",padding:"0 0.25rem",lineHeight:1},children:""})]})}function yB({budgetIdInput:t,setBudgetIdInput:e,isCheckingManual:n,manualInvite:r,isAccepting:i,onCheckInvite:o,onAcceptInvite:l,onCancel:d}){return u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px"},children:[u.jsxs("h3",{style:{margin:"0 0 0.75rem 0",fontSize:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{children:""})," Join Budget by ID"]}),u.jsx("p",{style:{margin:"0 0 1rem 0",fontSize:"0.9rem",opacity:.7},children:"If someone shared a budget ID with you, enter it below to accept the invitation:"}),r?u.jsxs("div",{style:{background:"color-mix(in srgb, #22c55e 10%, transparent)",border:"1px solid color-mix(in srgb, #22c55e 30%, transparent)",padding:"1rem",borderRadius:"8px"},children:[u.jsx("p",{style:{margin:"0 0 0.75rem 0",fontWeight:500},children:" You've been invited to join:"}),u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 8%, transparent)",padding:"0.75rem 1rem",borderRadius:"6px",marginBottom:"1rem"},children:[u.jsx("p",{style:{margin:"0 0 0.25rem 0",fontWeight:600,fontSize:"1.1rem"},children:r.budgetName}),r.ownerEmail&&u.jsxs("p",{style:{margin:0,fontSize:"0.9rem",opacity:.7},children:["Owner: ",r.ownerEmail]})]}),u.jsxs("div",{style:{display:"flex",gap:"0.75rem"},children:[u.jsx("button",{onClick:l,disabled:i===r.budgetId,style:{background:"#22c55e",color:"white",border:"none",padding:"0.6rem 1.25rem",borderRadius:"6px",cursor:i===r.budgetId?"not-allowed":"pointer",fontWeight:500,opacity:i===r.budgetId?.7:1},children:i===r.budgetId?"Accepting...":"Accept Invitation"}),u.jsx("button",{onClick:d,disabled:i===r.budgetId,style:{background:"transparent",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)",padding:"0.6rem 1.25rem",borderRadius:"6px",cursor:i===r.budgetId?"not-allowed":"pointer",fontWeight:500,opacity:i===r.budgetId?.7:.8},children:"Cancel"})]})]}):u.jsxs("form",{onSubmit:o,style:{display:"flex",gap:"0.75rem"},children:[u.jsx("input",{type:"text",value:t,onChange:h=>e(h.target.value),placeholder:"Enter Budget ID",style:{flex:1,padding:"0.6rem 0.8rem",borderRadius:"6px",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"0.95rem",color:"inherit"}}),u.jsx("button",{type:"submit",disabled:n||!t.trim(),style:{background:"#646cff",color:"white",border:"none",padding:"0.6rem 1.25rem",borderRadius:"6px",cursor:n||!t.trim()?"not-allowed":"pointer",fontWeight:500,opacity:n||!t.trim()?.7:1,whiteSpace:"nowrap"},children:n?"Checking...":"Check Invite"})]})]})}function _B({currentUserId:t}){return u.jsxs("div",{style:{marginTop:"1.5rem",padding:"1rem",background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"6px",fontSize:"0.85rem",opacity:.7},children:[u.jsx("p",{style:{margin:"0 0 0.5rem 0"},children:" Share your User ID with budget owners so they can invite you:"}),u.jsx("code",{style:{display:"block",padding:"0.5rem 0.75rem",background:"color-mix(in srgb, currentColor 8%, transparent)",borderRadius:"4px",fontSize:"0.8rem",wordBreak:"break-all"},children:t})]})}function bB(){const{addLoadingHold:t,removeLoadingHold:e}=Qn(),{selectedBudgetId:n,currentUserId:r,accessibleBudgets:i,loadAccessibleBudgets:o,switchToBudget:l,checkBudgetInvite:d,isInitialized:h,setPageTitle:m,needsFirstBudget:p}=Ye(),{requireUserEmail:g}=Na(),v=M.useRef(!1),[b,C]=AS(),x=b.get("context");M.useEffect(()=>{x&&(b.delete("context"),C(b,{replace:!0}))},[x,b,C]);const S=x==="budget-not-found",E=p&&i.length===0;M.useLayoutEffect(()=>{m("My Budgets")},[m]),M.useEffect(()=>{h&&!v.current&&(v.current=!0,o())},[h,o]);const{budget:T,isLoading:I}=Rn(),{renameBudget:D}=W4(),{acceptInvite:B}=hB(),{createBudget:$}=dB(),[k,j]=M.useState(null),[N,F]=M.useState(null),[q,A]=M.useState(null),[P,O]=M.useState(null),[X,W]=M.useState(null),[H,Z]=M.useState(""),[Y,se]=M.useState(!1),[L,G]=M.useState(""),[ne,ie]=M.useState(!1),[te,ue]=M.useState(null),[ve,ce]=M.useState(""),[be,ze]=M.useState(!1);async function Pe(ae){if(ae!==T?.id){j(ae),A(null),O(null);try{await l(ae),O("Switched to budget successfully!"),await o({force:!0})}catch(Ae){A(Ae instanceof Error?Ae.message:"Failed to switch budget")}finally{j(null)}}}async function at(ae){if(r){F(ae),A(null),O(null);try{await B.mutateAsync({budgetId:ae,userId:r}),O("Invitation accepted! You now have access to this budget."),await o({force:!0})}catch(Ae){A(Ae instanceof Error?Ae.message:"Failed to accept invitation")}finally{F(null)}}}async function bt(ae){if(ae.preventDefault(),!!L.trim()){ie(!0),A(null),ue(null);try{const Ae=await d(L.trim());Ae?ue(Ae):A("No pending invitation found for this budget ID. Make sure you've been invited by the budget owner.")}catch(Ae){A(Ae instanceof Error?Ae.message:"Failed to check invitation")}finally{ie(!1)}}}async function U(){if(!(!te||!r)){te.budgetName,F(te.budgetId),A(null);try{await B.mutateAsync({budgetId:te.budgetId,userId:r}),O(`Successfully joined "${te.budgetName}"!`),ue(null),G(""),await o({force:!0})}catch(ae){A(ae instanceof Error?ae.message:"Failed to accept invitation")}finally{F(null)}}}function he(ae,Ae){Z(Ae),W(ae)}async function ye(ae){if(ae.preventDefault(),!(!H.trim()||!X||!n)){H.trim(),se(!0),A(null),O(null);try{await D.mutateAsync({budgetId:n,newName:H.trim()}),O("Budget renamed successfully!"),W(null),await o({force:!0})}catch(Ae){A(Ae instanceof Error?Ae.message:"Failed to rename budget")}finally{se(!1)}}}async function ee(ae){if(ae.preventDefault(),!!r){ve.trim(),ze(!0),A(null),O(null);try{const Ae=await $.mutateAsync({name:ve.trim()||"My Budget",userId:r,userEmail:g()});await l(Ae.budgetId),O("Budget created successfully!"),ce(""),await o({force:!0})}catch(Ae){A(Ae instanceof Error?Ae.message:"Failed to create budget")}finally{ze(!1)}}}const J=i.filter(ae=>!ae.isPending),oe=i.filter(ae=>ae.isPending);if(M.useEffect(()=>(I||!h?t("my-budgets","Loading your budgets..."):e("my-budgets"),()=>e("my-budgets")),[I,h,t,e]),I||!h)return null;let Ce="My Budgets",Se="Switch between budgets, accept invitations, or create a new budget.";return S?(Ce="Budget Not Found",Se="Your selected budget could not be found. It may have been deleted. Select another budget or create a new one."):E&&(Ce="Welcome!",Se="Get started by creating your first budget or accepting an invitation."),u.jsxs("div",{children:[u.jsx("h1",{children:Ce}),u.jsx("p",{style:{opacity:.7,marginBottom:"1.5rem"},children:Se}),q&&u.jsx(pB,{message:q,onDismiss:()=>A(null)}),P&&u.jsx(gB,{message:P,onDismiss:()=>O(null)}),oe.length>0&&u.jsxs("div",{style:{background:"color-mix(in srgb, #f59e0b 10%, transparent)",border:"1px solid color-mix(in srgb, #f59e0b 30%, transparent)",padding:"1.25rem",borderRadius:"8px",marginBottom:"1.5rem"},children:[u.jsxs("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{children:""})," Pending Invitations (",oe.length,")"]}),u.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:oe.map(ae=>u.jsx(L1,{budget:ae,isCurrent:!1,isAccepting:N===ae.id,isSwitching:!1,isEditing:!1,editName:"",isRenaming:!1,onAccept:()=>at(ae.id),onSwitch:()=>{},onStartEdit:()=>{},onCancelEdit:()=>{},onEditNameChange:()=>{},onSaveEdit:()=>{}},ae.id))})]}),J.length>0&&u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px",marginBottom:"1.5rem"},children:[u.jsxs("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{children:""})," Your Budgets (",J.length,")"]}),u.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:J.map(ae=>u.jsx(L1,{budget:ae,isCurrent:ae.id===n,isAccepting:!1,isSwitching:k===ae.id,isEditing:X===ae.id,editName:X===ae.id?H:"",isRenaming:Y,onAccept:()=>{},onSwitch:()=>Pe(ae.id),onStartEdit:()=>he(ae.id,ae.name),onCancelEdit:()=>{W(null),Z("")},onEditNameChange:Z,onSaveEdit:ye},ae.id))})]}),u.jsxs("div",{style:{background:"color-mix(in srgb, #646cff 8%, transparent)",border:"1px solid color-mix(in srgb, #646cff 25%, transparent)",padding:"1.5rem",borderRadius:"8px",marginBottom:"1.5rem"},children:[u.jsxs("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{children:""})," Create New Budget"]}),u.jsxs("form",{onSubmit:ee,children:[u.jsxs("div",{style:{marginBottom:"1rem"},children:[u.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.9rem",opacity:.8},children:"Budget Name"}),u.jsx("input",{type:"text",value:ve,onChange:ae=>ce(ae.target.value),placeholder:"My Budget",style:{width:"100%",padding:"0.6rem 0.8rem",borderRadius:"6px",border:"1px solid color-mix(in srgb, currentColor 25%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"0.95rem",color:"inherit",boxSizing:"border-box"}}),u.jsx("p",{style:{margin:"0.5rem 0 0 0",fontSize:"0.8rem",opacity:.5},children:"You can always rename this later"})]}),u.jsx("button",{type:"submit",disabled:be,style:{background:me.primary,color:"white",border:"none",padding:"0.6rem 1.5rem",borderRadius:"6px",cursor:be?"not-allowed":"pointer",fontWeight:500,opacity:be?.7:1,fontSize:"0.9rem"},children:be?"Creating...":"Create Budget"})]})]}),u.jsx(yB,{budgetIdInput:L,setBudgetIdInput:G,isCheckingManual:ne,manualInvite:te,isAccepting:N,onCheckInvite:bt,onAcceptInvite:U,onCancel:()=>{ue(null),G("")}}),r&&u.jsx(_B,{currentUserId:r})]})}const vB=["accounts","categories","users"];function xB(){const{addLoadingHold:t,removeLoadingHold:e}=Qn(),{lastSettingsTab:n,setLastSettingsTab:r,setPageTitle:i,selectedBudgetId:o,setCurrentViewingDocument:l}=Ye();M.useLayoutEffect(()=>{i("Budget Settings")},[i]),M.useEffect(()=>(o&&l({type:"budget"}),()=>{l({type:null})}),[o,l]);const{isOwner:d,isLoading:h}=Rn();M.useEffect(()=>(h?t("settings","Loading settings..."):e("settings"),()=>e("settings")),[h,t,e]);const m=Nn(),p=m.pathname==="/budget/settings",g=M.useMemo(()=>{const S=m.pathname;return S.includes("/settings/accounts")?"accounts":S.includes("/settings/categories")?"categories":S.includes("/settings/users")?"users":"categories"},[m.pathname]),v=g==="users";M.useEffect(()=>{p||r(g)},[g,p,r]);function b(){return!vB.includes(n)||n==="users"&&!d?"categories":n}const C=M.useMemo(()=>[{id:"accounts",label:"Accounts",icon:""},{id:"categories",label:"Categories",icon:""},{id:"users",label:"Users",icon:"",hidden:!d}],[d]);return h?null:!d&&v?u.jsxs("div",{children:[u.jsx("h1",{children:"Access Denied"}),u.jsx("p",{style:{opacity:.7},children:"Only the budget owner can access this section."}),u.jsx("p",{style:{marginTop:"1rem"},children:u.jsx(An,{to:"/budget/settings/categories",children:"Go to Categories "})})]}):u.jsxs("div",{children:[u.jsx(Df,{mode:"link",linkPrefix:"/budget/settings",tabs:C,activeTab:p?b():g}),p?u.jsx(zf,{to:`/budget/settings/${b()}`,replace:!0}):u.jsx(WT,{children:u.jsx(Bf,{})})]})}function t_({initialData:t,onSubmit:e,onCancel:n,submitLabel:r,accountGroups:i,showGroupSelector:o=!1,showIncomeSettings:l=!1,hasExistingIncomeDefault:d=!1,hasExistingOutgoDefault:h=!1,currentGroupId:m,onDelete:p}){const[g,v]=M.useState(t||{nickname:"",account_group_id:null,is_income_account:!1,is_income_default:!1,is_outgo_account:!1,is_outgo_default:!1,on_budget:!0,is_active:!0,is_hidden:!1}),b=g.account_group_id||m,C=b?i.find(D=>D.id===b):null,x=!!(C&&C.is_active!==null),S=!!(C&&C.on_budget!==null);function E(D){D.preventDefault(),g.nickname.trim()&&e(g)}function T(D){v({...g,is_income_account:D,is_income_default:D?g.is_income_default:!1})}function I(D){v({...g,is_outgo_account:D,is_outgo_default:D?g.is_outgo_default:!1})}return u.jsxs(Ci,{actionName:r==="Create Account"?"Create Account":"Update Account",onSubmit:E,children:[u.jsx(Bt,{label:"Account Nickname",htmlFor:"account-nickname",children:u.jsx(Ei,{id:"account-nickname",type:"text",value:g.nickname,onChange:D=>v({...g,nickname:D.target.value}),placeholder:"e.g., Main Checking, Savings",required:!0,autoFocus:!0})}),o&&u.jsx(Bt,{label:"Account Type",htmlFor:"account-group",children:u.jsxs(qu,{id:"account-group",value:g.account_group_id||Jt,onChange:D=>v({...g,account_group_id:D.target.value===Jt?null:D.target.value}),children:[u.jsx("option",{value:Jt,children:"Ungrouped"}),i.map(D=>u.jsx("option",{value:D.id,children:D.name},D.id))]})}),l&&u.jsxs("div",{style:{padding:"0.75rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",display:"flex",flexDirection:"column",gap:"0.75rem"},children:[u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[u.jsx("p",{style:{margin:0,fontSize:"0.85rem",opacity:.7},children:"Account Status"}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[u.jsx(Hr,{id:"is-active",checked:(()=>{if(x&&C){const D=C.is_active;return D===null||D===void 0?!1:D}return g.is_active??!0})(),onChange:D=>v({...g,is_active:D.target.checked}),disabled:x,children:u.jsx("span",{style:{opacity:x?.5:1},children:"Active account"})}),x&&C&&u.jsxs("p",{style:{margin:0,fontSize:"0.7rem",opacity:.6,marginLeft:"2rem",color:me.warning},children:['Set by account type "',C.name,'"']})]}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[u.jsx(Hr,{id:"on-budget",checked:(()=>{if(S&&C){const D=C.on_budget;return D===null||D===void 0?!1:D}return g.on_budget??!0})(),onChange:D=>v({...g,on_budget:D.target.checked}),disabled:S,children:u.jsx("span",{style:{opacity:S?.5:1},children:"On budget (affects budget totals)"})}),S&&C&&u.jsxs("p",{style:{margin:0,fontSize:"0.7rem",opacity:.6,marginLeft:"2rem",color:me.warning},children:['Set by account type "',C.name,'"']})]}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[u.jsx(Hr,{id:"is-hidden",checked:g.is_hidden||!1,onChange:D=>v({...g,is_hidden:D.target.checked}),children:"Hidden account"}),u.jsx("p",{style:{margin:0,fontSize:"0.7rem",opacity:.6,marginLeft:"2rem"},children:"Hidden accounts don't appear in dropdowns or balance displays. Use for historical accounts that aren't actively used."})]})]}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[u.jsx("p",{style:{margin:0,fontSize:"0.85rem",opacity:.7},children:"Income Settings"}),u.jsx(Hr,{id:"is-income-account",checked:g.is_income_account||!1,onChange:D=>T(D.target.checked),children:"Show in income deposit list"}),g.is_income_account&&u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem",marginLeft:"2rem"},children:[u.jsx(Hr,{id:"is-income-default",checked:g.is_income_default||!1,onChange:D=>v({...g,is_income_default:D.target.checked}),disabled:d&&!t?.is_income_default,children:"Default account for new income"}),d&&!t?.is_income_default&&u.jsx("p",{style:{margin:0,fontSize:"0.75rem",opacity:.5},children:"Another account is already set as default"})]})]}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[u.jsx("p",{style:{margin:0,fontSize:"0.85rem",opacity:.7},children:"Expense Settings"}),u.jsx(Hr,{id:"is-outgo-account",checked:g.is_outgo_account||!1,onChange:D=>I(D.target.checked),children:"Show in expense account list"}),g.is_outgo_account&&u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem",marginLeft:"2rem"},children:[u.jsx(Hr,{id:"is-outgo-default",checked:g.is_outgo_default||!1,onChange:D=>v({...g,is_outgo_default:D.target.checked}),disabled:h&&!t?.is_outgo_default,children:"Default account for new expenses"}),h&&!t?.is_outgo_default&&u.jsx("p",{style:{margin:0,fontSize:"0.75rem",opacity:.5},children:"Another account is already set as default"})]})]})]}),u.jsxs(La,{children:[u.jsx(Ve,{type:"submit",actionName:r,children:r}),u.jsx(Ve,{type:"button",variant:"secondary",actionName:"Cancel Account Form",onClick:n,children:"Cancel"}),p&&u.jsx(Ve,{type:"button",variant:"secondary",actionName:"Delete Account",onClick:D=>{D.preventDefault(),p()},style:{color:"#ff6b6b",borderColor:"#ff6b6b"},children:" Delete"})]})]})}function tS({label:t,value:e,onChange:n,trueLabel:r,falseLabel:i,undefinedLabel:o}){function l(){n(e===void 0?!0:e===!0?!1:void 0)}const d=e===!0?r:e===!1?i:o,h=e===!0?me.success:e===!1?me.warning:"inherit",m=e===!0?"":e===!1?"":"";return u.jsxs("button",{type:"button",onClick:l,style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 0.75rem",background:e!==void 0?`color-mix(in srgb, ${h} 15%, transparent)`:"color-mix(in srgb, currentColor 8%, transparent)",border:e!==void 0?`1px solid color-mix(in srgb, ${h} 40%, transparent)`:"1px solid color-mix(in srgb, currentColor 20%, transparent)",borderRadius:"6px",cursor:"pointer",fontSize:"0.85rem",color:"inherit",textAlign:"left",width:"100%"},children:[u.jsx("span",{style:{width:"1.25rem",height:"1.25rem",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"4px",background:e!==void 0?h:"color-mix(in srgb, currentColor 20%, transparent)",color:e!==void 0?"white":"inherit",fontWeight:600,fontSize:"0.75rem"},children:m}),u.jsxs("span",{style:{flex:1},children:[u.jsxs("span",{style:{opacity:.7},children:[t,":"]})," ",u.jsx("span",{style:{fontWeight:500,color:h},children:d})]}),u.jsx("span",{style:{fontSize:"0.7rem",opacity:.5},children:"click to cycle"})]})}function nS({initialData:t,onSubmit:e,onCancel:n,submitLabel:r}){const[i,o]=M.useState(t||{name:"",expected_balance:"positive"});function l(d){d.preventDefault(),i.name.trim()&&e(i)}return u.jsxs(Ci,{actionName:r==="Create Account Type"?"Create Account Type":"Update Account Type",onSubmit:l,children:[u.jsx(Bt,{label:"Account Type Name",htmlFor:"group-name",children:u.jsx(Ei,{id:"group-name",type:"text",value:i.name,onChange:d=>o({...i,name:d.target.value}),placeholder:"e.g., Checking, Savings, Credit Cards, Investments",required:!0,autoFocus:!0})}),u.jsx(Bt,{label:"Expected Balance",htmlFor:"expected-balance",children:u.jsxs(qu,{id:"expected-balance",value:i.expected_balance,onChange:d=>o({...i,expected_balance:d.target.value}),children:[u.jsx("option",{value:"positive",children:"Normally Positive (e.g., Checking, Savings)"}),u.jsx("option",{value:"negative",children:"Normally Negative (e.g., Credit Cards, Loans)"}),u.jsx("option",{value:"any",children:"Either (no warnings)"})]})}),u.jsxs("div",{style:{padding:"0.75rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",display:"flex",flexDirection:"column",gap:"0.5rem"},children:[u.jsxs("p",{style:{margin:0,fontSize:"0.85rem",opacity:.7},children:["Group-Level Overrides ",u.jsx("span",{style:{fontSize:"0.75rem",opacity:.6},children:"(applies to all accounts in this type)"})]}),u.jsx(tS,{label:"Active status",value:i.is_active,onChange:d=>o({...i,is_active:d}),trueLabel:"All active",falseLabel:"All inactive",undefinedLabel:"Per account"}),u.jsx(tS,{label:"Budget status",value:i.on_budget,onChange:d=>o({...i,on_budget:d}),trueLabel:"All on budget",falseLabel:"All off budget",undefinedLabel:"Per account"})]}),u.jsxs(La,{children:[u.jsx(Ve,{type:"submit",actionName:r,children:r}),u.jsx(Ve,{type:"button",variant:"secondary",actionName:"Cancel Account Type Form",onClick:n,children:"Cancel"})]})]})}function Il({icon:t,label:e,variant:n,title:r}){const o={success:{background:`color-mix(in srgb, ${me.success} 20%, transparent)`,border:`1px solid color-mix(in srgb, ${me.success} 40%, transparent)`,color:me.success,opacity:1},warning:{background:`color-mix(in srgb, ${me.warning} 15%, transparent)`,border:`1px solid color-mix(in srgb, ${me.warning} 35%, transparent)`,color:me.warning,opacity:1},muted:{background:"color-mix(in srgb, currentColor 12%, transparent)",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",color:"inherit",opacity:.7},income:{background:`color-mix(in srgb, ${me.success} 10%, transparent)`,border:`1px solid color-mix(in srgb, ${me.success} 25%, transparent)`,color:me.success,opacity:.7},expense:{background:`color-mix(in srgb, ${me.warning} 10%, transparent)`,border:`1px solid color-mix(in srgb, ${me.warning} 25%, transparent)`,color:me.warning,opacity:.7}}[n];return u.jsxs("span",{title:r||e,style:{display:"inline-flex",alignItems:"center",gap:"0.25rem",background:o.background,border:o.border,padding:"0.15rem 0.4rem",borderRadius:"4px",fontSize:"0.7rem",fontWeight:500,textTransform:"uppercase",letterSpacing:"0.3px",color:o.color,opacity:o.opacity,whiteSpace:"nowrap"},children:[u.jsx("span",{style:{fontSize:"0.75rem"},children:t}),e]})}function rS({account:t,accountGroups:e}){const n=[],r=t.account_group_id?e.find(l=>l.id===t.account_group_id):null,i=r&&r.is_active!==null?r.is_active:t.is_active!==!1,o=r&&r.on_budget!==null?r.on_budget:t.on_budget!==!1;if(!i){const l=r&&r.is_active!==null;n.push(u.jsx(Il,{icon:"",label:l?"Inactive (type)":"Inactive",variant:"warning",title:l?`Set by "${r.name}" account type`:"Account is inactive/archived"},"inactive"))}if(!o){const l=r&&r.on_budget!==null;n.push(u.jsx(Il,{icon:"",label:l?"Off Budget (type)":"Off Budget",variant:"warning",title:l?`Set by "${r.name}" account type`:"Tracking only - not included in budget"},"off-budget"))}return t.is_income_default?n.push(u.jsx(Il,{icon:"",label:"Income Default",variant:"success",title:"Default income deposit account"},"income-default")):t.is_income_account&&n.push(u.jsx(Il,{icon:"",label:"Income",variant:"income",title:"Income deposit account"},"income")),t.is_outgo_default?n.push(u.jsx(Il,{icon:"",label:"Expense Default",variant:"warning",title:"Default expense account"},"outgo-default")):t.is_outgo_account&&n.push(u.jsx(Il,{icon:"",label:"Expense",variant:"expense",title:"Expense account"},"outgo")),n.length===0?null:u.jsx(u.Fragment,{children:n})}function wB({account:t,accountIndex:e,allGroups:n,allAccounts:r,clearedBalance:i,onEdit:o,onDelete:l,onMoveUp:d,onMoveDown:h,canMoveUp:m,canMoveDown:p,editingAccountId:g,setEditingAccountId:v,onUpdateAccount:b,isMobile:C}){if(g===t.id)return u.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"0.5rem"},children:u.jsx(t_,{initialData:{nickname:t.nickname,account_group_id:t.account_group_id,is_income_account:t.is_income_account,is_income_default:t.is_income_default,is_outgo_account:t.is_outgo_account,is_outgo_default:t.is_outgo_default,on_budget:t.on_budget,is_active:t.is_active},onSubmit:T=>{b(t.id,T),v(null)},onCancel:()=>v(null),onDelete:()=>{t.nickname,l(t.id),v(null)},submitLabel:"Save",accountGroups:n,showGroupSelector:!0,showIncomeSettings:!0,currentGroupId:t.account_group_id,hasExistingIncomeDefault:Object.entries(r).some(([T,I])=>I.is_income_default&&T!==t.id),hasExistingOutgoDefault:Object.entries(r).some(([T,I])=>I.is_outgo_default&&T!==t.id)})});if(C)return u.jsx("div",{style:{gridColumn:"1 / -1"},children:u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",padding:"0.75rem",marginBottom:"0.25rem"},children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"},children:[u.jsx("span",{style:{fontWeight:500},children:t.nickname}),u.jsx("div",{style:{display:"flex",gap:"1rem",fontSize:"0.85rem"},children:i?u.jsxs(u.Fragment,{children:[u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[u.jsx("span",{style:{opacity:.6,fontSize:"0.7rem"},children:"Total"}),u.jsx("span",{style:{color:ot(i.uncleared_balance),fontWeight:600},children:wt(i.uncleared_balance)})]}),Math.abs(i.uncleared_balance-i.cleared_balance)>=.01?u.jsxs(u.Fragment,{children:[u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[u.jsx("span",{style:{opacity:.6,fontSize:"0.7rem"},children:"Cleared"}),u.jsx("span",{style:{color:ot(i.cleared_balance)},children:wt(i.cleared_balance)})]}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[u.jsx("span",{style:{opacity:.6,fontSize:"0.7rem"},children:"Uncleared"}),u.jsx("span",{style:{color:ot(i.uncleared_balance-i.cleared_balance)},children:wt(i.uncleared_balance-i.cleared_balance)})]})]}):u.jsxs(u.Fragment,{children:[u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[u.jsx("span",{style:{opacity:.6,fontSize:"0.7rem"},children:"Cleared"}),u.jsx("span",{style:{opacity:.3,color:"#9ca3af"},children:""})]}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[u.jsx("span",{style:{opacity:.6,fontSize:"0.7rem"},children:"Uncleared"}),u.jsx("span",{style:{opacity:.3,color:"#9ca3af"},children:""})]})]})]}):u.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:u.jsx("span",{style:{color:ot(t.balance),fontWeight:600},children:wt(t.balance)})})})]}),u.jsx("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap",marginBottom:"0.5rem"},children:u.jsx(rS,{account:t,accountGroups:n})}),u.jsxs("div",{style:{display:"flex",gap:"0.5rem",justifyContent:"flex-end"},children:[u.jsx("button",{onClick:T=>{T.stopPropagation(),t.nickname,o(t.id)},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Edit",children:""}),u.jsx("button",{onClick:T=>{T.stopPropagation(),d()},disabled:!m,style:{background:"transparent",border:"none",cursor:m?"pointer":"default",opacity:m?.6:.2,fontSize:"0.9rem",padding:"0.25rem"},title:"Move up",children:""}),u.jsx("button",{onClick:T=>{T.stopPropagation(),h()},disabled:!p,style:{background:"transparent",border:"none",cursor:p?"pointer":"default",opacity:p?.6:.2,fontSize:"0.9rem",padding:"0.25rem"},title:"Move down",children:""})]})]})});const S=e%2===0?"transparent":"rgba(255,255,255,0.04)",E={padding:"0.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem"};return u.jsxs("div",{style:{gridColumn:"1 / -1",background:S,display:"grid",gridTemplateColumns:"2fr 1fr 1fr 1fr 1.5fr 1fr"},children:[u.jsx("div",{style:{...E,fontWeight:500,overflow:"hidden",paddingLeft:"1.5rem",borderLeft:"2px solid rgba(255,255,255,0.1)"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.nickname})}),i?u.jsx("div",{style:{...E,justifyContent:"flex-end",color:ot(i.uncleared_balance),fontWeight:600},children:wt(i.uncleared_balance)}):u.jsx("div",{style:{...E,justifyContent:"flex-end",color:ot(t.balance),fontWeight:600},children:wt(t.balance)}),i?u.jsx("div",{style:{...E,justifyContent:"flex-end",color:ot(i.cleared_balance)},children:Math.abs(i.uncleared_balance-i.cleared_balance)<.01?u.jsx("span",{style:{opacity:.3,color:"#9ca3af"},children:""}):wt(i.cleared_balance)}):u.jsx("div",{style:{...E,justifyContent:"flex-end",color:ot(t.balance),fontWeight:600},children:wt(t.balance)}),i&&Math.abs(i.uncleared_balance-i.cleared_balance)>=.01?u.jsx("div",{style:{...E,justifyContent:"flex-end",color:ot(i.uncleared_balance-i.cleared_balance)},children:wt(i.uncleared_balance-i.cleared_balance)}):u.jsx("div",{style:{...E,justifyContent:"flex-end",opacity:.3,color:"#9ca3af"},children:""}),u.jsx("div",{style:{...E,gap:"0.25rem",flexWrap:"wrap"},children:u.jsx(rS,{account:t,accountGroups:n})}),u.jsxs("div",{style:{...E,justifyContent:"flex-end",gap:"0.25rem"},children:[u.jsx("button",{onClick:T=>{T.stopPropagation(),t.nickname,o(t.id)},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Edit",children:""}),u.jsx("button",{onClick:T=>{T.stopPropagation(),d()},disabled:!m,style:{background:"transparent",border:"none",cursor:m?"pointer":"default",opacity:m?.6:.2,fontSize:"0.9rem",padding:"0.25rem"},title:"Move up",children:""}),u.jsx("button",{onClick:T=>{T.stopPropagation(),h()},disabled:!p,style:{background:"transparent",border:"none",cursor:p?"pointer":"default",opacity:p?.6:.2,fontSize:"0.9rem",padding:"0.25rem"},title:"Move down",children:""})]})]})}function sS({group:t,accounts:e,allGroups:n,allAccounts:r,accountClearedBalances:i,editingAccountId:o,createForGroupId:l,setEditingAccountId:d,setCreateForGroupId:h,onUpdateAccount:m,onDeleteAccount:p,onMoveAccount:g,onCreateAccount:v,isMobile:b,isUngrouped:C,canMoveGroupUp:x,canMoveGroupDown:S,onEditGroup:E,onDeleteGroup:T,onMoveGroupUp:I,onMoveGroupDown:D}){const B=[...e].sort((k,j)=>k.sort_order-j.sort_order);B.reduce((k,j)=>k+j.balance,0);const $={padding:"0.6rem 0.5rem",marginTop:"1.25rem",borderTop:"1px solid rgba(255,255,255,0.2)",borderBottom:Da,background:"rgba(255,255,255,0.04)",display:"flex",alignItems:"center",fontSize:"0.9rem",fontWeight:600};return u.jsxs("div",{style:{display:"contents"},children:[!b&&u.jsxs(u.Fragment,{children:[u.jsxs("div",{style:{...$,opacity:C?.7:1,justifyContent:"space-between"},children:[u.jsxs("span",{children:[u.jsx("span",{children:t.name}),u.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",B.length,")"]})]}),u.jsx("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center",flexShrink:0},children:!C&&u.jsxs(u.Fragment,{children:[u.jsx(Ve,{variant:"small",actionName:`Open Add Account Form (${t.name})`,onClick:()=>h(t.id),disabled:l!==null,children:"+ Account"}),u.jsx("button",{onClick:()=>{t.name,E()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Edit account type",children:""}),u.jsx("button",{onClick:()=>{t.name,T()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Delete account type",children:""}),u.jsxs("div",{style:If,children:[u.jsx("button",{onClick:I,disabled:!x,style:{...fa,opacity:x?.6:.2,cursor:x?"pointer":"default"},title:"Move up","aria-label":"Move up",children:""}),u.jsx("button",{onClick:D,disabled:!S,style:{...fa,opacity:S?.6:.2,cursor:S?"pointer":"default"},title:"Move down","aria-label":"Move down",children:""})]})]})})]}),u.jsx("div",{style:$}),u.jsx("div",{style:$}),u.jsx("div",{style:$}),u.jsx("div",{style:$}),u.jsx("div",{style:$})]}),b&&u.jsxs("div",{style:{gridColumn:"1 / -1",padding:"0.6rem 0.5rem",marginTop:"1.25rem",borderTop:"1px solid rgba(255,255,255,0.2)",borderBottom:Da,background:"rgba(255,255,255,0.04)"},children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"},children:[u.jsxs("span",{style:{fontWeight:600,opacity:C?.7:1},children:[t.name,u.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",B.length,")"]})]}),Yt.showGroupTotals]}),!C&&u.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center",flexWrap:"wrap"},children:[u.jsx(Ve,{variant:"small",actionName:`Open Add Account Form (${t.name})`,onClick:()=>h(t.id),disabled:l!==null,children:"+ Account"}),u.jsx("button",{onClick:()=>{t.name,E()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Edit account type",children:""}),u.jsx("button",{onClick:()=>{t.name,T()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Delete account type",children:""}),u.jsxs("div",{style:If,children:[u.jsx("button",{onClick:I,disabled:!x,style:{...fa,opacity:x?.6:.2,cursor:x?"pointer":"default"},title:"Move up","aria-label":"Move up",children:""}),u.jsx("button",{onClick:D,disabled:!S,style:{...fa,opacity:S?.6:.2,cursor:S?"pointer":"default"},title:"Move down","aria-label":"Move down",children:""})]})]})]}),B.map((k,j)=>u.jsx(wB,{account:k,accountIndex:j,totalAccounts:B.length,allGroups:n,allAccounts:r,clearedBalance:i?.[k.id],onEdit:d,onDelete:p,onMoveUp:()=>g(k.id,"up"),onMoveDown:()=>g(k.id,"down"),canMoveUp:j>0,canMoveDown:j<B.length-1,editingAccountId:o,setEditingAccountId:d,onUpdateAccount:m,isMobile:b},k.id)),l===t.id&&u.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"0.5rem"},children:u.jsx(t_,{initialData:{nickname:"",account_group_id:t.id},onSubmit:k=>v(k,t.id),onCancel:()=>h(null),submitLabel:"Create",accountGroups:n,showIncomeSettings:!0,currentGroupId:t.id})})]})}function SB({hiddenAccounts:t,accounts:e,sortedGroups:n,editingAccountId:r,setEditingAccountId:i,onUpdateAccount:o}){return t.length===0?null:u.jsx("div",{style:{marginBottom:"2rem"},children:u.jsxs(Q0,{title:"Hidden Accounts",count:t.length,children:[u.jsxs("div",{style:{padding:"0.75rem",marginBottom:"1rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",fontSize:"0.85rem"},children:[u.jsxs("p",{style:{margin:"0 0 0.5rem 0",opacity:.8},children:[u.jsx("strong",{children:" Hidden accounts"})," are excluded from dropdowns and balance displays. They're useful for historical accounts (like closed bank accounts or old 401Ks) that you want to keep for record-keeping but don't need in everyday use."]}),u.jsx("p",{style:{margin:0,opacity:.6},children:'To unhide an account, click it to edit and uncheck "Hidden account".'})]}),u.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:t.map(l=>r===l.id?u.jsx(t_,{initialData:{nickname:l.nickname,account_group_id:l.account_group_id,is_income_account:l.is_income_account,is_income_default:l.is_income_default,is_outgo_account:l.is_outgo_account,is_outgo_default:l.is_outgo_default,on_budget:l.on_budget,is_active:l.is_active,is_hidden:l.is_hidden},onSubmit:d=>{o(l.id,d),i(null)},onCancel:()=>i(null),submitLabel:"Save",accountGroups:n,showGroupSelector:!0,showIncomeSettings:!0,currentGroupId:l.account_group_id,hasExistingIncomeDefault:Object.entries(e).some(([d,h])=>h.is_income_default&&d!==l.id),hasExistingOutgoDefault:Object.entries(e).some(([d,h])=>h.is_outgo_default&&d!==l.id)},l.id):u.jsxs("div",{onClick:()=>i(l.id),style:{padding:"0.75rem 1rem",background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"8px",cursor:"pointer",display:"flex",justifyContent:"space-between",alignItems:"center",opacity:.7},children:[u.jsx("span",{children:l.nickname}),u.jsx("span",{style:{color:ot(l.balance),fontWeight:500},children:wt(l.balance)})]},l.id))})]})})}function CB(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n}=Ye(),{monthMap:r,isLoading:i,isFetching:o,accounts:l}=Rn(),{month:d}=Qs(t,e,n),{accounts:h,accountsByGroup:m,hiddenAccounts:p,sortedGroups:g,currentBudget:v,error:b,setError:C,handleCreateAccount:x,handleUpdateAccount:S,handleDeleteAccount:E,handleMoveAccount:T,handleCreateGroup:I,handleUpdateGroup:D,handleDeleteGroup:B,handleMoveGroup:$}=Y4(),k=Ai(),{addLoadingHold:j,removeLoadingHold:N}=Qn(),F=i||o||!v;ld({budgetId:t,monthMap:r,checkAnyMonth:!0,additionalCondition:!F&&!!v,logPrefix:"[Settings/Accounts]"}),M.useEffect(()=>(F?j("accounts","Loading accounts..."):N("accounts"),()=>N("accounts")),[F,j,N]);const[q,A]=M.useState(null),[P,O]=M.useState(null),[X,W]=M.useState(null),[H,Z]=M.useState(!1),Y=M.useMemo(()=>{const te=Object.values(h),ue=te.reduce((be,ze)=>be+(ze.balance??0),0);let ve=0,ce=0;for(const be of te){const ze=g.find(at=>at.id===be.account_group_id);be.on_budget===!0||be.on_budget===void 0&&ze?.on_budget!==!1?ve+=be.balance??0:ce+=be.balance??0}return{count:te.length,groupCount:g.filter(be=>be.id!==Jt).length,totalBalance:ue,onBudgetTotal:ve,offBudgetTotal:ce}},[h,g]),se=M.useMemo(()=>g.filter(te=>te.id!==Jt),[g]),L=M.useMemo(()=>({id:Jt,name:"Ungrouped",sort_order:se.length,expected_balance:"any",on_budget:null,is_active:null}),[se.length]),G=m[Jt]||[],ne=M.useMemo(()=>d?sA(d,l):{},[d,l]),ie={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",paddingTop:"0.75rem",paddingBottom:"0.5rem",paddingLeft:"0.5rem",paddingRight:"0.5rem",borderBottom:"2px solid rgba(255,255,255,0.2)"};return M.useEffect(()=>{b&&(console.error("[Settings/Accounts] Error:",b),gr.add({type:"error",message:"Failed to update accounts. See console for details.",autoDismissMs:0}),C(null))},[b,C]),F||!v?F?null:u.jsx("p",{children:"No budget found. Please log in."}):u.jsxs("div",{children:[u.jsxs("div",{style:{display:"grid",gridTemplateColumns:k?"1fr":"2fr 1fr 1fr 1fr 1.5fr 1fr",marginBottom:"1.5rem"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:50,backgroundColor:"#242424",display:k?"block":"grid",gridTemplateColumns:k?void 0:"subgrid"},children:[u.jsx("div",{style:{gridColumn:"1 / -1",marginLeft:"calc(-1 * var(--page-padding, 2rem))",marginRight:"calc(-1 * var(--page-padding, 2rem))",paddingLeft:"var(--page-padding, 2rem)",paddingRight:"var(--page-padding, 2rem)",paddingTop:"0.5rem",paddingBottom:"0.5rem"},children:u.jsxs("div",{style:{display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingBottom:"0.5rem",borderBottom:"1px solid rgba(255,255,255,0.15)"},children:[u.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[u.jsx("span",{style:{fontWeight:600},children:"Accounts:"}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"On-Budget: "}),u.jsx("span",{style:{color:ot(Y.onBudgetTotal),fontWeight:600},children:wt(Y.onBudgetTotal)})]}),Y.offBudgetTotal!==0&&u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"Off-Budget: "}),u.jsx("span",{style:{fontWeight:600,opacity:.7},children:wt(Y.offBudgetTotal)})]}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"Total: "}),u.jsx("span",{style:{color:ot(Y.totalBalance),fontWeight:600},children:wt(Y.totalBalance)})]}),u.jsx("span",{style:{opacity:.5,fontSize:"0.8rem"},children:"Use  buttons to reorder accounts."})]}),u.jsx("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:u.jsx(X0,{})})]})}),!k&&u.jsxs(u.Fragment,{children:[u.jsx("div",{style:ie,children:"Account"}),u.jsx("div",{style:{...ie,textAlign:"right"},children:"Total"}),u.jsx("div",{style:{...ie,textAlign:"right"},children:"Cleared"}),u.jsx("div",{style:{...ie,textAlign:"right"},children:"Uncleared"}),u.jsx("div",{style:ie,children:"Flags"}),u.jsx("div",{style:{...ie,textAlign:"right"},children:"Actions"})]})]}),Object.keys(h).length===0&&se.length===0&&u.jsx("p",{style:{gridColumn:"1 / -1",opacity:.7,textAlign:"center",padding:"2rem"},children:"No accounts yet. Create an account type first, then add accounts!"}),se.map((te,ue)=>{const ve=m[te.id]||[];return ve.length===0&&X!==te.id&&P!==te.id?null:X===te.id?u.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"1rem"},children:u.jsx(nS,{initialData:{name:te.name,expected_balance:te.expected_balance||"positive",on_budget:te.on_budget??void 0,is_active:te.is_active??void 0},onSubmit:ce=>{D(te.id,ce),W(null)},onCancel:()=>W(null),submitLabel:"Save"})},te.id):u.jsx(sS,{group:te,accounts:ve,allGroups:se,allAccounts:h,accountClearedBalances:ne,editingAccountId:q,createForGroupId:P,setEditingAccountId:A,setCreateForGroupId:O,onUpdateAccount:(ce,be)=>{S(ce,be),A(null)},onDeleteAccount:E,onMoveAccount:T,onCreateAccount:x,isMobile:k,canMoveGroupUp:ue>0,canMoveGroupDown:ue<se.length-1,onEditGroup:()=>W(te.id),onDeleteGroup:()=>B(te.id),onMoveGroupUp:()=>$(te.id,"up"),onMoveGroupDown:()=>$(te.id,"down")},te.id)}),(G.length>0||P==="ungrouped")&&u.jsx(sS,{group:L,accounts:G,allGroups:se,allAccounts:h,accountClearedBalances:ne,editingAccountId:q,createForGroupId:P,setEditingAccountId:A,setCreateForGroupId:O,onUpdateAccount:(te,ue)=>{S(te,ue),A(null)},onDeleteAccount:E,onMoveAccount:T,onCreateAccount:x,isMobile:k,isUngrouped:!0,canMoveGroupUp:!1,canMoveGroupDown:!1,onEditGroup:()=>{},onDeleteGroup:()=>{},onMoveGroupUp:()=>{},onMoveGroupDown:()=>{}}),u.jsx("div",{style:{gridColumn:"1 / -1",height:"1rem"}})]}),u.jsx(SB,{hiddenAccounts:p,accounts:h,sortedGroups:se,editingAccountId:q,setEditingAccountId:A,onUpdateAccount:S}),H?u.jsx(nS,{onSubmit:te=>{I(te),Z(!1)},onCancel:()=>Z(!1),submitLabel:"Create Account Type"}):u.jsx(Ve,{variant:"primary-large",actionName:"Open Add Account Type Form",onClick:()=>Z(!0),children:"+ Add Account Type"})]})}function n_({initialData:t,onSubmit:e,onCancel:n,submitLabel:r,categoryGroups:i=[],showGroupSelector:o=!1,onDelete:l}){const[d,h]=M.useState(t||{name:"",category_group_id:null,is_hidden:!1}),[m,p]=M.useState(t?.default_monthly_amount?.toString()||""),[g,v]=M.useState(t?.default_monthly_type||"fixed"),[b,C]=M.useState(!1);function x(S){if(S.preventDefault(),!d.name.trim())return;C(!0);const E=parseFloat(m),T=!isNaN(E)&&E>0;e({...d,description:d.description?.trim()||void 0,default_monthly_amount:T?E:void 0,default_monthly_type:T?g:void 0})}return u.jsxs(Ci,{actionName:r==="Create"?"Create Category":"Update Category",onSubmit:x,children:[u.jsx(Bt,{label:"Category Name",htmlFor:"category-name",children:u.jsx(Ei,{id:"category-name",type:"text",value:d.name,onChange:S=>h({...d,name:S.target.value}),placeholder:"e.g., Groceries, Rent, Gas",required:!0,autoFocus:!0})}),u.jsx(Bt,{label:"Description (optional)",htmlFor:"category-description",children:u.jsx(H0,{id:"category-description",value:d.description||"",onChange:S=>h({...d,description:S.target.value}),placeholder:"What is this category used for?",minHeight:"3rem"})}),o&&u.jsx(Bt,{label:"Category Group",htmlFor:"category-group",children:u.jsxs(qu,{id:"category-group",value:d.category_group_id||cn,onChange:S=>h({...d,category_group_id:S.target.value===cn?null:S.target.value}),children:[u.jsx("option",{value:cn,children:"Uncategorized"}),i.map(S=>u.jsx("option",{value:S.id,children:S.name},S.id))]})}),u.jsxs(Bt,{label:"Default Monthly Allocation (optional)",htmlFor:"default-amount",children:[u.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center"},children:[u.jsxs(qu,{id:"default-type",value:g,onChange:S=>v(S.target.value),style:{width:"auto",flex:"0 0 auto"},children:[u.jsx("option",{value:"fixed",children:"Fixed $"}),u.jsx("option",{value:"percentage",children:"% of Prev Income"})]}),g==="fixed"?u.jsx(wo,{id:"default-amount",value:m,onChange:p,placeholder:"$0.00"}):u.jsx(Ei,{id:"default-amount",type:"number",value:m,onChange:S=>p(S.target.value),placeholder:"0",min:"0",max:"100",step:"0.1",style:{width:"80px"}}),g==="percentage"&&u.jsx("span",{style:{opacity:.6},children:"%"})]}),u.jsx("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.75rem",opacity:.6},children:g==="fixed"?"Suggested fixed amount to allocate each month":"Percentage of previous month's total income"})]}),o&&u.jsxs("div",{style:{padding:"0.75rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px"},children:[u.jsx(Hr,{id:"is-hidden",checked:d.is_hidden||!1,onChange:S=>h({...d,is_hidden:S.target.checked}),children:"Hidden category"}),u.jsx("p",{style:{margin:"0.25rem 0 0 2rem",fontSize:"0.7rem",opacity:.6},children:"Hidden categories don't appear in dropdowns or balance displays. Use for historical categories that aren't actively used."})]}),u.jsxs(La,{children:[u.jsx(Ve,{type:"submit",actionName:r==="Create"?"Create Category":"Save Category",isLoading:b,children:r}),u.jsx(Ve,{type:"button",variant:"secondary",actionName:"Cancel Category Form",onClick:n,children:"Cancel"}),l&&u.jsx(Ve,{type:"button",variant:"secondary",actionName:"Delete Category",onClick:S=>{S.preventDefault(),l()},style:{color:"#ff6b6b",borderColor:"#ff6b6b"},children:" Delete"})]})]})}function iS({initialData:t,onSubmit:e,onCancel:n,submitLabel:r}){const[i,o]=M.useState(t||{name:""}),[l,d]=M.useState(!1);function h(m){m.preventDefault(),i.name.trim()&&(d(!0),e(i))}return u.jsxs(Ci,{actionName:r==="Create Group"?"Create Category Group":"Update Category Group",onSubmit:h,children:[u.jsx(Bt,{label:"Group Name",htmlFor:"group-name",children:u.jsx(Ei,{id:"group-name",type:"text",value:i.name,onChange:m=>o({...i,name:m.target.value}),placeholder:"e.g., Housing, Transportation, Food",required:!0,autoFocus:!0})}),u.jsxs(La,{children:[u.jsx(Ve,{type:"submit",actionName:r==="Create Group"?"Create Category Group":"Save Category Group",isLoading:l,children:r}),u.jsx(Ve,{type:"button",variant:"secondary",actionName:"Cancel Category Group Form",onClick:n,children:"Cancel"})]})]})}function EB({category:t,catId:e,categoryIndex:n,categoryGroups:r,categoryBalances:i,loadingBalances:o,onEdit:l,onDelete:d,onMoveUp:h,onMoveDown:m,canMoveUp:p,canMoveDown:g,editingCategoryId:v,setEditingCategoryId:b,onUpdateCategory:C,isMobile:x}){const S=i[e]||{current:0,total:0};if(v===e)return u.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"0.5rem"},children:u.jsx(n_,{initialData:{name:t.name,description:t.description,category_group_id:t.category_group_id,default_monthly_amount:t.default_monthly_amount,default_monthly_type:t.default_monthly_type,is_hidden:t.is_hidden},onSubmit:D=>{C(e,D),b(null)},onCancel:()=>b(null),onDelete:()=>{t.name,d(e),b(null)},submitLabel:"Save",categoryGroups:r,showGroupSelector:!0})});if(x)return u.jsx("div",{style:{gridColumn:"1 / -1"},children:u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",padding:"0.75rem",marginBottom:"0.25rem"},children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"},children:[u.jsx("span",{style:{fontWeight:500},children:t.name}),u.jsxs("div",{style:{display:"flex",gap:"1rem",fontSize:"0.85rem"},children:[t.default_monthly_amount!==void 0&&t.default_monthly_amount>0&&u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[u.jsx("span",{style:{opacity:.6,fontSize:"0.7rem"},children:"Default"}),u.jsx("span",{style:{opacity:.7},children:t.default_monthly_type==="percentage"?`${t.default_monthly_amount}%`:`${_t(t.default_monthly_amount)}/mo`})]}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[u.jsx("span",{style:{opacity:.6,fontSize:"0.7rem"},children:"Available Now"}),u.jsx("span",{style:{color:dn(S.current),fontWeight:600},children:o?"...":pr(S.current)})]}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[u.jsx("span",{style:{opacity:.6,fontSize:"0.7rem"},children:"Total Allocated"}),u.jsx("span",{style:{color:dn(S.total)},children:o?"...":pr(S.total)})]})]})]}),t.description&&u.jsx("p",{style:{fontSize:"0.8rem",opacity:.6,margin:"0 0 0.5rem 0"},children:t.description}),t.default_monthly_amount!==void 0&&t.default_monthly_amount>0&&u.jsxs("div",{style:{fontSize:"0.75rem",opacity:.8,marginBottom:"0.5rem"},children:["Default: ",t.default_monthly_type==="percentage"?u.jsxs(u.Fragment,{children:[u.jsxs("span",{style:{color:me.success,fontWeight:500},children:[t.default_monthly_amount,"%"]})," of prev income"]}):u.jsxs(u.Fragment,{children:[u.jsx("span",{style:{color:me.success,fontWeight:500},children:t.default_monthly_amount}),"/mo"]})]}),u.jsxs("div",{style:{display:"flex",gap:"0.5rem",justifyContent:"flex-end"},children:[u.jsx("button",{onClick:D=>{D.stopPropagation(),t.name,l(e)},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Edit",children:""}),u.jsx("button",{onClick:D=>{D.stopPropagation(),h()},disabled:!p,style:{background:"transparent",border:"none",cursor:p?"pointer":"default",opacity:p?.6:.2,fontSize:"0.9rem",padding:"0.25rem"},title:"Move up",children:""}),u.jsx("button",{onClick:D=>{D.stopPropagation(),m()},disabled:!g,style:{background:"transparent",border:"none",cursor:g?"pointer":"default",opacity:g?.6:.2,fontSize:"0.9rem",padding:"0.25rem"},title:"Move down",children:""})]})]})});const T=n%2===0?"transparent":"rgba(255,255,255,0.04)",I={padding:"0.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem"};return u.jsxs("div",{style:{gridColumn:"1 / -1",background:T,display:"grid",gridTemplateColumns:"2fr 1fr 1fr 1fr 2fr 1fr"},children:[u.jsx("div",{style:{...I,fontWeight:500,overflow:"hidden",paddingLeft:"1.5rem",borderLeft:"2px solid rgba(255,255,255,0.1)"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.name})}),u.jsx("div",{style:{...I,justifyContent:"flex-end",opacity:.7,fontSize:"0.85rem"},children:t.default_monthly_amount!==void 0&&t.default_monthly_amount>0?u.jsx("span",{children:t.default_monthly_type==="percentage"?`${t.default_monthly_amount}%`:`${pr(t.default_monthly_amount)}/mo`}):u.jsx("span",{style:{opacity:.3,fontStyle:"italic",color:"#9ca3af"},children:""})}),u.jsx("div",{style:{...I,justifyContent:"flex-end",color:dn(S.current),fontWeight:600},children:o?"...":pr(S.current)}),u.jsx("div",{style:{...I,justifyContent:"flex-end",color:dn(S.total)},children:o?"...":pr(S.total)}),u.jsx("div",{style:{...I,opacity:.7,fontSize:"0.85rem"},children:t.description?u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.description}):u.jsx("span",{style:{opacity:.3,fontStyle:"italic",color:"#9ca3af"},children:""})}),u.jsxs("div",{style:{...I,justifyContent:"flex-end",gap:"0.25rem"},children:[u.jsx("button",{onClick:D=>{D.stopPropagation(),t.name,l(e)},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Edit",children:""}),u.jsx("button",{onClick:D=>{D.stopPropagation(),h()},disabled:!p,style:{background:"transparent",border:"none",cursor:p?"pointer":"default",opacity:p?.6:.2,fontSize:"0.9rem",padding:"0.25rem"},title:"Move up",children:""}),u.jsx("button",{onClick:D=>{D.stopPropagation(),m()},disabled:!g,style:{background:"transparent",border:"none",cursor:g?"pointer":"default",opacity:g?.6:.2,fontSize:"0.9rem",padding:"0.25rem"},title:"Move down",children:""})]})]})}function aS({group:t,categories:e,categoryGroups:n,categoryBalances:r,loadingBalances:i,editingCategoryId:o,createForGroupId:l,setEditingCategoryId:d,setCreateForGroupId:h,handleUpdateCategory:m,handleDeleteCategory:p,handleMoveCategory:g,handleCreateCategory:v,isMobile:b,isUngrouped:C,startRowIndex:x=0,canMoveGroupUp:S,canMoveGroupDown:E,onEditGroup:T,onDeleteGroup:I,onMoveGroupUp:D,onMoveGroupDown:B}){const $=[...e].sort((N,F)=>N[1].sort_order-F[1].sort_order),k=$.reduce((N,[F])=>{const q=r[F];return N+(q?.current||0)},0),j={padding:"0.6rem 0.5rem",marginTop:"1.25rem",borderTop:"1px solid rgba(255,255,255,0.2)",borderBottom:Da,background:"rgba(255,255,255,0.04)",display:"flex",alignItems:"center",fontSize:"0.9rem",fontWeight:600};return u.jsxs("div",{style:{display:"contents"},children:[!b&&u.jsxs(u.Fragment,{children:[u.jsxs("div",{style:{...j,opacity:C?.7:1,justifyContent:"space-between"},children:[u.jsxs("span",{children:[u.jsx("span",{children:t.name}),u.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",$.length,")"]})]}),u.jsx("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center",flexShrink:0},children:!C&&u.jsxs(u.Fragment,{children:[u.jsx(Ve,{variant:"small",actionName:`Open Add Category Form (${t.name})`,onClick:()=>h(t.id),disabled:l!==null,children:"+ Category"}),u.jsx("button",{onClick:()=>{t.name,T()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Edit group",children:""}),u.jsx("button",{onClick:()=>{t.name,I()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Delete group",children:""}),u.jsxs("div",{style:If,children:[u.jsx("button",{onClick:D,disabled:!S,style:{...fa,opacity:S?.6:.2,cursor:S?"pointer":"default"},title:"Move group up","aria-label":"Move group up",children:""}),u.jsx("button",{onClick:B,disabled:!E,style:{...fa,opacity:E?.6:.2,cursor:E?"pointer":"default"},title:"Move group down","aria-label":"Move group down",children:""})]})]})})]}),u.jsx("div",{style:j}),u.jsx("div",{style:{...j,justifyContent:"flex-end",color:dn(k)},children:Yt.showGroupTotals}),u.jsx("div",{style:{...j,justifyContent:"flex-end",color:dn($.reduce((N,[F])=>{const q=r[F];return N+(q?.total||0)},0))},children:Yt.showGroupTotals}),u.jsx("div",{style:j}),u.jsx("div",{style:j})]}),b&&u.jsxs("div",{style:{gridColumn:"1 / -1",padding:"0.6rem 0.5rem",marginTop:"1.25rem",borderTop:"1px solid rgba(255,255,255,0.2)",borderBottom:Da,background:"rgba(255,255,255,0.04)"},children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"},children:[u.jsxs("span",{style:{fontWeight:600,opacity:C?.7:1},children:[t.name,u.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",$.length,")"]})]}),Yt.showGroupTotals]}),!C&&u.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center",flexWrap:"wrap"},children:[u.jsx(Ve,{variant:"small",actionName:`Open Add Category Form (${t.name})`,onClick:()=>h(t.id),disabled:l!==null,children:"+ Category"}),u.jsx("button",{onClick:()=>{t.name,T()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Edit group",children:""}),u.jsx("button",{onClick:()=>{t.name,I()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Delete group",children:""}),u.jsxs("div",{style:If,children:[u.jsx("button",{onClick:D,disabled:!S,style:{...fa,opacity:S?.6:.2,cursor:S?"pointer":"default"},title:"Move group up","aria-label":"Move group up",children:""}),u.jsx("button",{onClick:B,disabled:!E,style:{...fa,opacity:E?.6:.2,cursor:E?"pointer":"default"},title:"Move group down","aria-label":"Move group down",children:""})]})]})]}),$.map(([N,F],q)=>{const A=x+q;return u.jsx(EB,{category:F,catId:N,categoryIndex:A,totalCategories:$.length,categoryGroups:n,categoryBalances:r,loadingBalances:i,onEdit:d,onDelete:p,onMoveUp:()=>g(N,"up"),onMoveDown:()=>g(N,"down"),canMoveUp:q>0,canMoveDown:q<$.length-1,editingCategoryId:o,setEditingCategoryId:d,onUpdateCategory:m,isMobile:b},N)}),l===t.id&&u.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"0.5rem"},children:u.jsx(n_,{initialData:{name:"",category_group_id:t.id},onSubmit:N=>v(N,t.id),onCancel:()=>h(null),submitLabel:"Create",categoryGroups:n})})]})}function TB(){const{selectedBudgetId:t}=Ye(),{monthMap:e,isLoading:n,isFetching:r}=Rn(),{currentBudget:i,categories:o,categoryGroups:l,categoriesByGroup:d,hiddenCategories:h,sortedGroups:m,categoryBalances:p,isLoading:g,loadingBalances:v,error:b,setError:C,getOnBudgetTotal:x,handleCreateCategory:S,handleUpdateCategory:E,handleDeleteCategory:T,handleMoveCategory:I,handleCreateGroup:D,handleUpdateGroup:B,handleDeleteGroup:$,handleMoveGroup:k}=e3(),j=Ai(),{addLoadingHold:N,removeLoadingHold:F}=Qn(),q=n||g||r||!i;ld({budgetId:t,monthMap:e,checkAnyMonth:!0,additionalCondition:!q&&!!i,logPrefix:"[Settings/Categories]"}),M.useEffect(()=>(q?N("categories","Loading categories..."):F("categories"),()=>F("categories")),[q,N,F]);const[A,P]=M.useState(null),[O,X]=M.useState(null),[W,H]=M.useState(null),[Z,Y]=M.useState(!1),se=M.useMemo(()=>m.filter(ue=>ue.id!==cn),[m]),L=M.useMemo(()=>({id:cn,name:"Uncategorized",sort_order:se.length}),[se.length]),G=(d[cn]||[]).sort((ue,ve)=>ue[1].sort_order-ve[1].sort_order);if(M.useEffect(()=>{b&&(console.error("[Settings/Categories] Error:",b),gr.add({type:"error",message:"Failed to update categories. See console for details.",autoDismissMs:0}),C(null))},[b,C]),q||!i)return q?null:u.jsx("p",{children:"No budget found. Please log in."});const ne=Object.values(p).reduce((ue,ve)=>ue+ve.current,0),ie=Object.values(p).reduce((ue,ve)=>ue+ve.total,0),te={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",paddingTop:"0.75rem",paddingBottom:"0.5rem",paddingLeft:"0.5rem",paddingRight:"0.5rem",borderBottom:"2px solid rgba(255,255,255,0.2)"};return u.jsxs("div",{children:[u.jsxs("div",{style:{display:"grid",gridTemplateColumns:j?"1fr":"2fr 1fr 1fr 1fr 2fr 1fr",marginBottom:"1.5rem"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:50,backgroundColor:"#242424",display:j?"block":"grid",gridTemplateColumns:j?void 0:"subgrid"},children:[u.jsx("div",{style:{gridColumn:"1 / -1",marginLeft:"calc(-1 * var(--page-padding, 2rem))",marginRight:"calc(-1 * var(--page-padding, 2rem))",paddingLeft:"var(--page-padding, 2rem)",paddingRight:"var(--page-padding, 2rem)",paddingTop:"0.5rem",paddingBottom:"0.5rem"},children:u.jsxs("div",{style:{display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingBottom:"0.5rem",borderBottom:"1px solid rgba(255,255,255,0.15)"},children:[u.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[u.jsx("span",{style:{fontWeight:600},children:"Categories:"}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"On-Budget: "}),u.jsx("span",{style:{color:ot(x()),fontWeight:600},children:_t(x())})]}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"Available Now: "}),u.jsx("span",{style:{color:ot(ne),fontWeight:600},children:v?"...":_t(ne)})]}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"Total Allocated: "}),u.jsx("span",{style:{color:gc(ie),fontWeight:600},children:v?"...":_t(ie)})]}),u.jsx("span",{style:{opacity:.6},children:"Use  buttons to reorder categories."})]}),u.jsx("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:u.jsx(X0,{})})]})}),!j&&u.jsxs(u.Fragment,{children:[u.jsx("div",{style:te,children:"Category"}),u.jsx("div",{style:{...te,textAlign:"right"},children:"Default"}),u.jsx("div",{style:{...te,textAlign:"right"},children:"Available Now"}),u.jsx("div",{style:{...te,textAlign:"right"},children:"Total Allocated"}),u.jsx("div",{style:te,children:"Description"}),u.jsx("div",{style:{...te,textAlign:"right"},children:"Actions"})]})]}),Object.keys(o).length===0&&l.length===0&&u.jsx("p",{style:{gridColumn:"1 / -1",opacity:.7,textAlign:"center",padding:"2rem"},children:"No categories yet. Create a group first, then add categories!"}),(()=>{const ue={};let ve=0;return se.forEach(ce=>{const be=(d[ce.id]||[]).sort((ze,Pe)=>ze[1].sort_order-Pe[1].sort_order);ue[ce.id]=ve,ve+=be.length}),se.map((ce,be)=>{const ze=(d[ce.id]||[]).sort((Pe,at)=>Pe[1].sort_order-at[1].sort_order);return ze.length===0&&W!==ce.id&&O!==ce.id?null:W===ce.id?u.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"1rem"},children:u.jsx(iS,{initialData:{name:ce.name},onSubmit:Pe=>{B(ce.id,Pe),H(null)},onCancel:()=>H(null),submitLabel:"Save"})},ce.id):u.jsx(aS,{group:ce,categories:ze,categoryGroups:l,categoryBalances:p,loadingBalances:v,editingCategoryId:A,createForGroupId:O,setEditingCategoryId:P,setCreateForGroupId:X,handleUpdateCategory:E,handleDeleteCategory:T,handleMoveCategory:I,handleCreateCategory:S,isMobile:j,canMoveGroupUp:be>0,canMoveGroupDown:be<se.length-1,onEditGroup:()=>H(ce.id),onDeleteGroup:()=>$(ce.id),onMoveGroupUp:()=>k(ce.id,"up"),onMoveGroupDown:()=>k(ce.id,"down"),startRowIndex:ue[ce.id]??0},ce.id)})})(),(G.length>0||O==="ungrouped")&&(()=>{const ue=se.reduce((ve,ce)=>{const be=(d[ce.id]||[]).sort((ze,Pe)=>ze[1].sort_order-Pe[1].sort_order);return ve+be.length},0);return u.jsx(aS,{group:L,categories:G,categoryGroups:l,categoryBalances:p,loadingBalances:v,editingCategoryId:A,createForGroupId:O,setEditingCategoryId:P,setCreateForGroupId:X,handleUpdateCategory:E,handleDeleteCategory:T,handleMoveCategory:I,handleCreateCategory:S,isMobile:j,isUngrouped:!0,canMoveGroupUp:!1,canMoveGroupDown:!1,onEditGroup:()=>{},onDeleteGroup:()=>{},onMoveGroupUp:()=>{},onMoveGroupDown:()=>{},startRowIndex:ue})})(),u.jsx("div",{style:{gridColumn:"1 / -1",height:"1rem"}})]}),h.length>0&&u.jsx("div",{style:{marginBottom:"2rem"},children:u.jsxs(Q0,{title:"Hidden Categories",count:h.length,children:[u.jsxs("div",{style:{padding:"0.75rem",marginBottom:"1rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",fontSize:"0.85rem"},children:[u.jsxs("p",{style:{margin:"0 0 0.5rem 0",opacity:.8},children:[u.jsx("strong",{children:" Hidden categories"})," are excluded from dropdowns and balance displays. They're useful for historical categories that you want to keep for record-keeping but don't need in everyday use."]}),u.jsx("p",{style:{margin:0,opacity:.6},children:'To unhide a category, click it to edit and uncheck "Hidden category".'})]}),u.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:h.map(([ue,ve])=>A===ue?u.jsx(n_,{initialData:{name:ve.name,description:ve.description,category_group_id:ve.category_group_id,default_monthly_amount:ve.default_monthly_amount,default_monthly_type:ve.default_monthly_type,is_hidden:ve.is_hidden},onSubmit:ce=>{E(ue,ce),P(null)},onCancel:()=>P(null),submitLabel:"Save",categoryGroups:l,showGroupSelector:!0},ue):u.jsxs("div",{onClick:()=>P(ue),style:{padding:"0.75rem 1rem",background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"8px",cursor:"pointer",display:"flex",justifyContent:"space-between",alignItems:"center",opacity:.7},children:[u.jsx("span",{children:ve.name}),u.jsx("span",{style:{color:ot(ve.balance),fontWeight:500},children:_t(ve.balance)})]},ue))})]})}),Z?u.jsx(iS,{onSubmit:ue=>{D(ue),Y(!1)},onCancel:()=>Y(!1),submitLabel:"Create Group"}):u.jsx(Ve,{variant:"primary-large",actionName:"Open Add Category Group Form",onClick:()=>Y(!0),children:"+ Add Category Group"})]})}function AB(){const{selectedBudgetId:t,currentUserId:e}=Ye(),{addLoadingHold:n,removeLoadingHold:r}=Qn(),{budget:i,budgetUserIds:o,acceptedUserIds:l,isLoading:d}=Rn();M.useEffect(()=>(d||!i?n("users","Loading users..."):r("users"),()=>r("users")),[d,i,n,r]);const{inviteUser:h}=fB(),{revokeUser:m}=mB(),[p,g]=M.useState(""),[v,b]=M.useState(!1),[C,x]=M.useState(null),[S,E]=M.useState(null);if(d)return null;if(!i)return u.jsx("p",{children:"No budget found."});async function T($){if($.preventDefault(),!(!p.trim()||!i||!t)){b(!0),x(null),E(null);try{await h.mutateAsync({budgetId:t,userId:p.trim()}),g(""),E("Invite sent! The user can now accept the invitation from their account.")}catch(k){x(k instanceof Error?k.message:"Failed to invite user")}finally{b(!1)}}}async function I($){if(!i||!t)return;if($===i.owner_id){x("Cannot revoke the budget owner");return}if($===e){x("Cannot revoke yourself from the budget");return}const k=l.includes($);if(confirm(k?"Are you sure you want to revoke this user's access? They will lose access to this budget.":"Are you sure you want to cancel this invitation?")){x(null),E(null);try{await m.mutateAsync({budgetId:t,userId:$}),E(k?"User access revoked.":"Invitation cancelled.")}catch(N){x(N instanceof Error?N.message:"Failed to revoke user")}}}const D=o.filter($=>l.includes($)),B=o.filter($=>!l.includes($));return u.jsxs("div",{children:[u.jsx("h2",{style:{marginTop:0},children:"Budget Users"}),u.jsx("p",{style:{opacity:.7,marginBottom:"1.5rem"},children:"Invite users to access this budget. They must accept the invitation before they can access it."}),C&&u.jsxs("div",{style:{background:"rgba(220, 38, 38, 0.1)",border:"1px solid rgba(220, 38, 38, 0.3)",color:"#f87171",padding:"0.75rem 1rem",borderRadius:"8px",marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[u.jsx("span",{children:C}),u.jsx("button",{onClick:()=>x(null),style:{background:"transparent",border:"none",color:"#f87171",cursor:"pointer",fontSize:"1.2rem",padding:"0 0.25rem",lineHeight:1},children:""})]}),S&&u.jsxs("div",{style:{background:"rgba(34, 197, 94, 0.1)",border:"1px solid rgba(34, 197, 94, 0.3)",color:"#4ade80",padding:"0.75rem 1rem",borderRadius:"8px",marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[u.jsx("span",{children:S}),u.jsx("button",{onClick:()=>E(null),style:{background:"transparent",border:"none",color:"#4ade80",cursor:"pointer",fontSize:"1.2rem",padding:"0 0.25rem",lineHeight:1},children:""})]}),u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px",marginBottom:"1.5rem"},children:[u.jsxs("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem"},children:["Active Users (",D.length,")"]}),D.length===0?u.jsx("p",{style:{opacity:.6,margin:0},children:"No users have accepted invitations yet."}):u.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:D.map($=>{const k=$===i.owner_id,j=$===e;return u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 8%, transparent)",padding:"0.75rem 1rem",borderRadius:"6px",display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem"},children:[u.jsx("div",{style:{flex:1,minWidth:0},children:u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flexWrap:"wrap"},children:[u.jsx("code",{style:{fontSize:"0.85rem",background:"color-mix(in srgb, currentColor 10%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",wordBreak:"break-all"},children:$}),k&&u.jsx("span",{style:{background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.7rem",textTransform:"uppercase",fontWeight:600},children:"Owner"}),j&&u.jsx("span",{style:{background:"color-mix(in srgb, #22c55e 20%, transparent)",color:"#4ade80",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.7rem",textTransform:"uppercase",fontWeight:600},children:"You"})]})}),!k&&!j&&u.jsx("button",{onClick:()=>I($),style:{background:"transparent",border:"1px solid rgba(220, 38, 38, 0.4)",color:"#f87171",padding:"0.4rem 0.75rem",borderRadius:"6px",cursor:"pointer",fontSize:"0.8rem",whiteSpace:"nowrap"},children:"Revoke Access"})]},$)})})]}),B.length>0&&u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px",marginBottom:"1.5rem"},children:[u.jsxs("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem"},children:["Pending Invitations (",B.length,")"]}),u.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:B.map($=>u.jsxs("div",{style:{background:"color-mix(in srgb, #f59e0b 10%, transparent)",border:"1px solid color-mix(in srgb, #f59e0b 30%, transparent)",padding:"0.75rem 1rem",borderRadius:"6px",display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem"},children:[u.jsx("div",{style:{flex:1,minWidth:0},children:u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flexWrap:"wrap"},children:[u.jsx("code",{style:{fontSize:"0.85rem",background:"color-mix(in srgb, currentColor 10%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",wordBreak:"break-all"},children:$}),u.jsx("span",{style:{background:"color-mix(in srgb, #f59e0b 20%, transparent)",color:"#fbbf24",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.7rem",textTransform:"uppercase",fontWeight:600},children:"Pending"})]})}),u.jsx("button",{onClick:()=>I($),style:{background:"transparent",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)",color:"inherit",padding:"0.4rem 0.75rem",borderRadius:"6px",cursor:"pointer",fontSize:"0.8rem",whiteSpace:"nowrap",opacity:.8},children:"Cancel Invite"})]},$))})]}),u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px"},children:[u.jsx("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem"},children:"Invite User"}),u.jsxs("form",{onSubmit:T,style:{display:"flex",gap:"0.75rem"},children:[u.jsx("input",{type:"text",value:p,onChange:$=>g($.target.value),placeholder:"Enter Firebase User ID",style:{flex:1,padding:"0.6rem 0.8rem",borderRadius:"6px",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"0.95rem",color:"inherit"}}),u.jsx("button",{type:"submit",disabled:v||!p.trim(),style:{background:"#646cff",color:"white",border:"none",padding:"0.6rem 1.25rem",borderRadius:"6px",cursor:v||!p.trim()?"not-allowed":"pointer",fontWeight:500,opacity:v||!p.trim()?.7:1,whiteSpace:"nowrap"},children:v?"Inviting...":"Send Invite"})]}),u.jsx("p",{style:{margin:"1rem 0 0 0",fontSize:"0.85rem",opacity:.6},children:" The invited user will need to accept the invitation from their Account page using this budget's ID:"}),u.jsx("code",{style:{display:"block",marginTop:"0.5rem",padding:"0.5rem 0.75rem",background:"color-mix(in srgb, currentColor 10%, transparent)",borderRadius:"6px",fontSize:"0.85rem",wordBreak:"break-all"},children:i.id})]})]})}const jB=["budget","feedback","migration","tests"];function RB(){const{isAdmin:t,isTest:e,lastAdminTab:n,setLastAdminTab:r,setPageTitle:i}=Ye();M.useLayoutEffect(()=>{i("Budget Admin")},[i]);const o=Nn(),l=o.pathname==="/budget/admin",d=M.useMemo(()=>{const g=o.pathname;return g.includes("/admin/budget")?"budget":g.includes("/admin/feedback")?"feedback":g.includes("/admin/migration")?"migration":g.includes("/admin/tests")?"tests":"budget"},[o.pathname]),h=d==="tests";M.useEffect(()=>{l||r(d)},[d,l,r]);function m(){return!jB.includes(n)||n==="tests"&&!e?"budget":n}const p=M.useMemo(()=>[{id:"budget",label:"Budget",icon:""},{id:"feedback",label:"Feedback",icon:""},{id:"migration",label:"Migration",icon:""},{id:"tests",label:"Tests",icon:"",hidden:!e}],[e]);return t?!e&&h?u.jsxs("div",{children:[u.jsx("h1",{children:"Access Denied"}),u.jsx("p",{style:{opacity:.7},children:"Only test users can access this section."}),u.jsx("p",{style:{marginTop:"1rem"},children:u.jsx(An,{to:"/budget/admin/budget",children:"Go to Admin "})})]}):u.jsxs("div",{children:[u.jsx(Df,{mode:"link",linkPrefix:"/budget/admin",tabs:p,activeTab:d}),l?u.jsx(zf,{to:`/budget/admin/${m()}`,replace:!0}):u.jsx(Bf,{})]}):u.jsxs("div",{children:[u.jsx("h1",{children:"Access Denied"}),u.jsx("p",{style:{opacity:.7},children:"Only administrators can access this section."}),u.jsx("p",{style:{marginTop:"1rem"},children:u.jsx(An,{to:"/budget",children:"Go to Budget "})})]})}function IB(){const{addLoadingHold:t,removeLoadingHold:e}=Qn(),{isAdmin:n}=Ye(),{budget:r,accounts:i,accountGroups:o,categories:l,categoryGroups:d,isOwner:h,isLoading:m}=Rn();return M.useEffect(()=>(m?t("settings-budget","Loading budget info..."):e("settings-budget"),()=>e("settings-budget")),[m,t,e]),m?null:r?u.jsxs("div",{children:[u.jsx("h2",{style:{marginTop:0},children:"Budget Summary"}),u.jsx("p",{style:{opacity:.7,marginBottom:"1.5rem"},children:"Information about the currently selected budget."}),u.jsx("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px",marginBottom:"1.5rem"},children:u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem",fontSize:"0.95rem"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{children:""}),u.jsx("span",{style:{opacity:.7,minWidth:"80px"},children:"Name:"}),u.jsx("strong",{children:r.name})]}),u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{children:""}),u.jsx("span",{style:{opacity:.7,minWidth:"80px"},children:"ID:"}),u.jsx("code",{style:{background:"color-mix(in srgb, currentColor 10%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",fontSize:"0.85rem"},children:r.id})]}),u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{children:""}),u.jsx("span",{style:{opacity:.7,minWidth:"80px"},children:"Owner:"}),u.jsx("strong",{children:r.owner_email||r.owner_id})]}),u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{children:""}),u.jsx("span",{style:{opacity:.7,minWidth:"80px"},children:"Users:"}),u.jsxs("span",{children:[r.user_ids.length," user",r.user_ids.length!==1?"s":"",u.jsxs("span",{style:{opacity:.7},children:["  ",h?"You are the owner":"Shared with you"]})]})]})]})}),n&&u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px"},children:[u.jsx("h3",{style:{margin:"0 0 0.75rem 0",fontSize:"1rem"},children:"Admin Tools"}),u.jsx("button",{onClick:()=>{const p={...r,accounts:i,account_groups:o,categories:l,category_groups:d,_meta:{downloaded_at:new Date().toISOString()}},g=new Blob([JSON.stringify(p,null,2)],{type:"application/json"}),v=URL.createObjectURL(g),b=document.createElement("a");b.href=v,b.download=`budget_${r.id}.json`,document.body.appendChild(b),b.click(),document.body.removeChild(b),URL.revokeObjectURL(v)},style:{display:"inline-flex",alignItems:"center",gap:"0.5rem",background:"color-mix(in srgb, currentColor 10%, transparent)",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",borderRadius:"6px",padding:"0.5rem 0.75rem",cursor:"pointer",fontSize:"0.85rem",color:"inherit",transition:"background 0.15s"},title:"Download budget document as JSON (for debugging)",children:" Download Budget JSON"})]})]}):u.jsx("p",{style:{opacity:.7},children:"No budget selected."})}function oS({selectedType:t,onSelect:e}){return u.jsx("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"0.75rem",paddingBottom:"1rem",flexWrap:"wrap"},children:["critical_bug","bug","new_feature","core_feature","qol"].map(n=>{const r=Mf[n],i=t==="feature"?"new_feature":t,o=i===n||!i&&n==="bug";return u.jsxs("button",{type:"button",onClick:()=>{r.label,e(n)},style:{flex:1,padding:"0.6rem 0.75rem",border:`2px solid ${r.color}`,borderRadius:"0.5rem",background:o?r.bgColor:"transparent",color:o?r.color:"rgba(255,255,255,0.5)",cursor:"pointer",fontWeight:o?600:400,fontSize:"0.85rem",transition:"all 0.15s ease",opacity:o?1:.5,boxShadow:o?`0 0 12px ${r.bgColor}`:"none",position:"relative"},children:[r.label,o&&u.jsx("span",{style:{position:"absolute",bottom:"-14px",left:"10%",right:"10%",height:"3px",background:"white",borderRadius:"2px"}})]},n)})})}function kB(){const[t,e]=M.useState(null),[n,r]=M.useState(null),[i,o]=M.useState(!1),[l,d]=M.useState(""),[h,m]=M.useState("bug"),[p,g]=M.useState(null),[v,b]=M.useState(!1),[C,x]=M.useState(null),S=M.useContext(ud),T=Na().get_current_firebase_user(),I=$t(),D=n4(),{submitFeedback:B}=GT(),{toggleFeedback:$}=hP(),{updateSortOrder:k}=fP(),j=D.data?.items||[],N=Ai(),{addLoadingHold:F,removeLoadingHold:q}=Qn();M.useEffect(()=>(D.isLoading?F("settings-feedback","Loading feedback..."):q("settings-feedback"),()=>q("settings-feedback")),[D.isLoading,F,q]);function A(ce){ce.preventDefault(),!(!l.trim()||!S.username||!T)&&(B.mutate({userId:T.uid,userEmail:S.username,text:l.trim(),feedbackType:h,currentPath:"/settings/feedback"}),d(""),m("bug"),o(!1))}function P(ce){ce.is_done?O(ce):g(ce)}async function O(ce){try{await $.mutateAsync({item:ce})}catch(be){console.error("[Feedback] Error updating feedback:",be),gr.add({type:"error",message:"Failed to update feedback",autoDismissMs:5e3})}}function X(){p&&(O(p),g(null))}async function W(){b(!1);const ce="mark-all-feedback-complete";F(ce,`Marking ${Y.length} item${Y.length!==1?"s":""} as complete...`);try{const be=new Date().toISOString(),ze=new Set(Y.map(he=>he.id)),Pe=new Map;for(const he of Y)Pe.has(he.doc_id)||Pe.set(he.doc_id,[]),Pe.get(he.doc_id).push(he);const at=[];for(const[he,ye]of Pe){const ee=(async()=>{const oe=(await HT(he,"mark all feedback complete")).items.map(Ce=>ze.has(Ce.id)?{...Ce,is_done:!0,completed_at:be}:Ce);await G0({docId:he,items:oe,description:`marking ${ye.length} feedback item${ye.length!==1?"s":""} as complete`})})();at.push(ee)}await Promise.all(at);const bt=Ie.feedback(),U=I.getQueryData(bt);U&&I.setQueryData(bt,{items:U.items.map(he=>ze.has(he.id)?{...he,is_done:!0,completed_at:be}:he)}),await I.invalidateQueries({queryKey:bt}),gr.add({type:"success",message:`Marked ${Y.length} item${Y.length!==1?"s":""} as complete`,autoDismissMs:3e3})}catch(be){console.error("[Feedback] Error marking all as complete:",be),gr.add({type:"error",message:"Failed to mark all items as complete",autoDismissMs:5e3}),await I.invalidateQueries({queryKey:Ie.feedback()})}finally{q(ce)}}function H(){W()}async function Z(ce){if(C){try{const ze=j.filter(Pe=>Pe.doc_id===C.doc_id).map(Pe=>({id:Pe.id,text:Pe.text,created_at:Pe.created_at,is_done:Pe.is_done,completed_at:Pe.completed_at,sort_order:Pe.sort_order,feedback_type:Pe.id===C.id?ce:Pe.feedback_type}));await k.mutateAsync({docId:C.doc_id,items:ze})}catch(be){console.error("[Feedback] Error updating feedback type:",be),gr.add({type:"error",message:"Failed to update feedback type",autoDismissMs:5e3})}x(null)}}const Y=j.filter(ce=>!ce.is_done).sort((ce,be)=>ce.sort_order-be.sort_order),se=j.filter(ce=>ce.is_done).sort((ce,be)=>new Date(be.completed_at||0).getTime()-new Date(ce.completed_at||0).getTime());function L(ce,be){e(be),ce.dataTransfer.effectAllowed="move"}function G(ce,be){ce.preventDefault(),be!==t&&r(be)}function ne(){r(null)}function ie(){e(null),r(null)}async function te(ce,be){if(ce.preventDefault(),!t||t===be){ie();return}const ze=Y.findIndex(he=>he.id===t),Pe=[...Y],[at]=Pe.splice(ze,1);if(be==="__end__")Pe.push(at);else{const he=Pe.findIndex(ye=>ye.id===be);Pe.splice(he,0,at)}const bt=Pe.map((he,ye)=>({...he,sort_order:ye}));ie();const U=new Map;for(const he of bt)U.has(he.doc_id)||U.set(he.doc_id,[]),U.get(he.doc_id).push({id:he.id,text:he.text,created_at:he.created_at,is_done:he.is_done,completed_at:he.completed_at,sort_order:he.sort_order,feedback_type:he.feedback_type});for(const he of se)U.has(he.doc_id)||U.set(he.doc_id,[]),U.get(he.doc_id).push({id:he.id,text:he.text,created_at:he.created_at,is_done:he.is_done,completed_at:he.completed_at,sort_order:he.sort_order,feedback_type:he.feedback_type});try{for(const[he,ye]of U)await k.mutateAsync({docId:he,items:ye})}catch(he){console.error("[Feedback] Error saving order:",he),gr.add({type:"error",message:"Failed to save order",autoDismissMs:5e3})}}function ue(){const ce=ve(Y),be=new Blob([ce],{type:"text/markdown"}),ze=URL.createObjectURL(be),Pe=document.createElement("a");Pe.href=ze,Pe.download=`feedback-${new Date().toISOString().split("T")[0]}.md`,document.body.appendChild(Pe),Pe.click(),document.body.removeChild(Pe),URL.revokeObjectURL(ze)}function ve(ce){let be=`# Feedback Export

`;return be+=`Generated: ${new Date().toISOString()}

`,ce.length>0&&(be+=`## Pending

`,ce.forEach((ze,Pe)=>{const at=ze.feedback_type?Mf[ze.feedback_type]?.label||ze.feedback_type:"Unknown";be+=`### ${Pe+1}. [${at}] ${ze.text.split(`
`)[0].substring(0,60)}${ze.text.split(`
`)[0].length>60?"...":""}

`,be+=`- **Type:** ${at}
`,be+=`- **Created:** ${ze.created_at}
`,be+=`- **User:** ${ze.user_email||ze.doc_id}
`,be+=`- **ID:** ${ze.id}

`,be+=`${ze.text}

`,be+=`---

`})),be}return D.isLoading?null:u.jsxs("div",{children:[u.jsxs("div",{style:{display:"flex",flexDirection:N?"column":"row",justifyContent:"space-between",alignItems:N?"stretch":"flex-start",gap:N?"0.75rem":"1rem",marginTop:"1.5rem",marginBottom:"0.5rem"},children:[u.jsxs("div",{children:[u.jsx("h2",{style:{marginTop:0},children:"Feedback"}),u.jsx("p",{style:{...AT,fontSize:"0.9rem"},children:"View and manage user feedback. Drag to reorder pending items."})]}),u.jsxs("div",{style:{display:"flex",gap:"0.75rem",flexDirection:N?"column":"row"},children:[u.jsx(Ve,{variant:"secondary",actionName:"Download Feedback as Markdown",onClick:ue,disabled:Y.length===0,style:N?{width:"100%"}:void 0,children:"Download Markdown"}),u.jsx(Ve,{variant:"secondary",actionName:"Mark All Complete",onClick:()=>b(!0),disabled:Y.length===0,style:N?{width:"100%"}:void 0,children:"Mark All Complete"})]})]}),u.jsxs("div",{style:j1,children:[Y.length===0&&!i&&u.jsx("p",{style:{opacity:.7},children:"No pending feedback."}),Y.map(ce=>u.jsx(XP,{item:ce,isDragging:t===ce.id,isDragOver:n===ce.id,onDragStart:be=>L(be,ce.id),onDragOver:be=>G(be,ce.id),onDragLeave:ne,onDragEnd:ie,onDrop:be=>te(be,ce.id),onToggleDone:()=>P(ce),onTypeClick:()=>x(ce)},ce.id)),t&&Y.length>0&&u.jsx(uP,{isActive:n==="__end__",onDragOver:ce=>G(ce,"__end__"),onDragLeave:ne,onDrop:ce=>te(ce,"__end__")})]}),i?u.jsxs(Ci,{actionName:"Add Feedback",onSubmit:A,children:[u.jsx(oS,{selectedType:h,onSelect:m}),u.jsx(H0,{value:l,onChange:ce=>d(ce.target.value),placeholder:"Enter your feedback, bug report, or feature request...",autoFocus:!0,required:!0}),u.jsxs(La,{children:[u.jsx(Ve,{type:"submit",actionName:"Add Feedback",disabled:!l.trim(),children:"Add Feedback"}),u.jsx(Ve,{type:"button",variant:"secondary",actionName:"Cancel Add Feedback",onClick:()=>{o(!1),d(""),m("bug")},children:"Cancel"})]})]}):u.jsx(Ve,{variant:"primary-large",actionName:"Open Add Feedback Form",onClick:()=>o(!0),children:"+ Add Feedback"}),se.length>0&&u.jsx(Q0,{title:"Completed",count:se.length,children:u.jsx("div",{style:{...j1,marginTop:"0.5rem"},children:se.map(ce=>u.jsx(ZP,{item:ce,onToggleDone:()=>P(ce),onTypeClick:()=>x(ce)},ce.id))})}),u.jsxs(us,{isOpen:p!==null,onClose:()=>g(null),title:"Mark as Complete",children:[u.jsx("p",{style:{margin:"0 0 1.5rem 0"},children:"Are you sure you want to mark this feedback item as complete?"}),p&&u.jsxs("p",{style:{margin:"0 0 1.5rem 0",padding:"0.75rem",background:"rgba(255,255,255,0.05)",borderRadius:"0.5rem",fontSize:"0.9rem"},children:['"',p.text,'"']}),u.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[u.jsx(Ve,{variant:"secondary",actionName:"Cancel Mark Complete",onClick:()=>g(null),children:"Cancel"}),u.jsx(Ve,{variant:"primary",actionName:"Confirm Mark Complete",onClick:X,children:"Mark Complete"})]})]}),u.jsxs(us,{isOpen:v,onClose:()=>b(!1),title:"Mark All as Complete",children:[u.jsxs("p",{style:{margin:"0 0 1.5rem 0"},children:["Are you sure you want to mark all ",Y.length," pending feedback item",Y.length!==1?"s":""," as complete?"]}),u.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[u.jsx(Ve,{variant:"secondary",actionName:"Cancel Mark All Complete",onClick:()=>b(!1),children:"Cancel"}),u.jsx(Ve,{variant:"primary",actionName:"Confirm Mark All Complete",onClick:H,children:"Mark All Complete"})]})]}),u.jsxs(us,{isOpen:C!==null,onClose:()=>x(null),title:"Change Feedback Type",children:[u.jsx("p",{style:{margin:"0 0 1rem 0",fontSize:"0.9rem",opacity:.8},children:"Select a new type for this feedback:"}),u.jsx(oS,{selectedType:C?.feedback_type||"bug",onSelect:Z}),u.jsx(Ve,{variant:"secondary",actionName:"Cancel Change Feedback Type",onClick:()=>x(null),style:{width:"100%"},children:"Cancel"})]})]})}function DB(){Le.clear(),window.location.reload()}function MB(){const e=Na().get_current_firebase_user(),{selectedBudgetId:n}=Ye(),r=nP({currentUser:e}),i=z3({currentUser:e}),o=M3({currentUser:e}),l=$3({currentUser:e}),d=C3({currentUser:e}),h=iP({currentUser:e,budgetId:n}),m=cP({currentUser:e}),p=_3({currentUser:e}),g=b3({currentUser:e}),v=r.isScanning||i.isScanning||o.isScanning||l.isScanning||d.isScanning||p.isScanning||g.isScanning,b=i.isRunning||o.isRunning||l.isRunning||d.isRunning||p.isDeleting||g.isDeleting||h.isDownloading||m.isUploading,C=async()=>{await Promise.all([r.scan(),i.scanStatus(),o.scanStatus(),l.scanStatus(),d.scan(),p.scanStatus(),g.scanStatus()])};return u.jsxs("div",{children:[u.jsx("style",{children:"@keyframes spin { to { transform: rotate(360deg); } }"}),u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"},children:[u.jsx("h2",{style:{margin:0},children:"Data Migrations"}),u.jsxs("button",{onClick:C,disabled:v||b,style:{background:"#646cff",color:"white",border:"none",padding:"0.5rem 1rem",borderRadius:"6px",cursor:v||b?"not-allowed":"pointer",fontWeight:500,opacity:v||b?.7:1,display:"flex",alignItems:"center",gap:"0.4rem",minWidth:"130px",minHeight:"36px"},children:[u.jsx("span",{style:{width:"18px",height:"18px",display:"inline-flex",justifyContent:"center",alignItems:"center",flexShrink:0},children:v?u.jsx($n,{noMargin:!0}):""}),"Refresh All"]})]}),u.jsx("p",{style:{opacity:.7,marginBottom:"1.5rem"},children:'Run migrations to validate and fix your database. Click "Refresh All" to scan Firestore directly.'}),u.jsx(nz,{disabled:!e,onDownloadBackup:h.downloadBudget,isDownloadingBackup:h.isDownloading}),u.jsx(az,{disabled:!e,onDownloadBackup:h.downloadBudget,isDownloadingBackup:h.isDownloading,accountCategoryValidation:{status:r.status,hasData:!!r.status,hasViolations:r.hasViolations,violationCount:r.violationCount,isScanning:r.isScanning,report:r.report,scan:r.scan},orphanedIdCleanup:{status:i.status,hasData:!!i.status,hasItemsToFix:i.hasItemsToFix,totalOrphaned:i.status?i.status.orphanedCategoryIds+i.status.orphanedAccountIds:0,isScanning:i.isScanning,isRunning:i.isRunning,result:i.result,scanStatus:i.scanStatus,runMigration:i.runMigration},expenseToAdjustment:{status:o.status,hasData:!!o.status,hasItemsToMigrate:o.hasItemsToMigrate,totalToMigrate:o.status?.expensesToMigrate??0,isScanning:o.isScanning,isRunning:o.isRunning,result:o.result,scanStatus:o.scanStatus,runMigration:o.runMigration},adjustmentsToTransfers:{status:l.status,hasData:!!l.status,hasPairsToConvert:l.hasPairsToConvert,totalPairs:l.status?.pairsFound??0,isScanning:l.isScanning,isRunning:l.isRunning,result:l.result,scanStatus:l.scanStatus,runMigration:l.runMigration},precisionCleanup:{status:d.status,hasData:d.hasData,hasIssues:d.hasIssues,totalIssues:d.totalIssues,isScanning:d.isScanning,isRunning:d.isRunning,result:d.result,scan:d.scan,runCleanup:d.runCleanup}}),u.jsx(dz,{disabled:!e,onDownloadBackup:h.downloadBudget,isDownloadingBackup:h.isDownloading,budgetDownloadUpload:{isDownloading:h.isDownloading,downloadProgress:h.progress,downloadError:h.error,downloadBudget:h.downloadBudget,isScanning:m.isScanning,isUploading:m.isUploading,uploadStatus:m.status,uploadProgress:m.progress,uploadError:m.error,uploadResult:m.result,scanZipFile:m.scanZipFile,uploadBudget:m.uploadBudget},deleteAllMonths:{status:p.status,hasData:!!p.status,monthsCount:p.status?.monthsCount??0,budgetCount:p.status?.budgetCount??0,isScanning:p.isScanning,isDeleting:p.isDeleting,deleteResult:p.deleteResult,deleteProgress:p.deleteProgress,scanStatus:p.scanStatus,deleteAllMonths:p.deleteAllMonths},deleteSampleUserBudget:{status:g.status,hasData:!!g.status,totalBudgets:g.status?.totalBudgets??0,totalMonths:g.status?.totalMonths??0,isScanning:g.isScanning,isDeleting:g.isDeleting,deleteResult:g.deleteResult,deleteProgress:g.deleteProgress,scanStatus:g.scanStatus,deleteSampleUserBudget:g.deleteSampleUserBudget},onClearCache:DB}),u.jsx("div",{style:{background:"color-mix(in srgb, currentColor 3%, transparent)",padding:"1rem",borderRadius:"8px",fontSize:"0.85rem"},children:u.jsxs("p",{style:{margin:0,opacity:.7},children:[u.jsx("strong",{children:"Note:"})," These migrations will process ",u.jsx("strong",{children:"all budgets and months"})," in the system, not just the ones you own or are invited to."]})}),u.jsx(JT,{})]})}function kl({name:t,description:e,expectedBehavior:n,result:r,onRun:i,disabled:o,expectedToSucceed:l}){const d=r?.status==="passed"?me.success:r?.status==="failed"?me.danger:r?.status==="running"?me.warning:"inherit";return u.jsxs("div",{style:{...V0,display:"flex",flexDirection:"column",gap:"0.5rem"},children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",gap:"1rem"},children:[u.jsxs("div",{style:{flex:1},children:[u.jsx("h4",{style:{margin:0,fontSize:"0.95rem"},children:t}),u.jsx("p",{style:{margin:"0.25rem 0 0",opacity:.7,fontSize:"0.85rem"},children:e}),u.jsxs("p",{style:{margin:"0.25rem 0 0",fontSize:"0.8rem",color:l?me.success:me.warning},children:["Expected: ",n]})]}),u.jsx(Ve,{onClick:i,disabled:o,variant:"secondary",style:{flexShrink:0},children:r?.status==="running"?"":"Run"})]}),r&&r.status!=="pending"&&u.jsx("div",{style:{padding:"0.5rem 0.75rem",borderRadius:"6px",background:`color-mix(in srgb, ${d} 15%, transparent)`,border:`1px solid color-mix(in srgb, ${d} 30%, transparent)`,fontSize:"0.85rem",color:d},children:r.message})]})}function OB({totalCount:t,passedCount:e,failedCount:n}){return u.jsxs("div",{style:{display:"flex",gap:"1rem",padding:"0.75rem 1rem",borderRadius:"8px",background:"color-mix(in srgb, currentColor 5%, transparent)",marginBottom:"1rem"},children:[u.jsxs("span",{children:["Total: ",u.jsx("strong",{children:t})]}),u.jsxs("span",{style:{color:me.success},children:["Passed: ",u.jsx("strong",{children:e})]}),u.jsxs("span",{style:{color:me.danger},children:["Failed: ",u.jsx("strong",{children:n})]})]})}const lS=[{name:"Read unauthorized budget",expectedToFail:!0},{name:"Read another user's document",expectedToFail:!0},{name:"Read unauthorized budget month",expectedToFail:!0},{name:"Toggle is_admin in own permission_flags",expectedToFail:!0},{name:"Toggle is_test in own permission_flags",expectedToFail:!0},{name:"Read own user document",expectedToFail:!1}];function NB(){const{currentUserId:t}=Ye(),[e,n]=M.useState([]),[r,i]=M.useState(!1);function o(b,C){n(x=>x.map(S=>S.name===b?{...S,...C}:S))}async function l(b,C,x){o(b,{status:"running",message:"Running..."});try{const S=await C();x?o(b,{status:"failed",message:` ${S}`}):o(b,{status:"passed",message:` ${S}`})}catch(S){const E=S instanceof Error?S.message:"Unknown error";x?o(b,{status:"passed",message:` Blocked as expected: ${E}`}):o(b,{status:"failed",message:` ${E}`})}}async function d(){i(!0),n(lS.map(b=>({...b,status:"pending",message:""})));for(const b of lS)await h(b.name);i(!1)}async function h(b){switch(b){case"Read unauthorized budget":await l(b,async()=>(await Rt("budgets","unauthorized_budget_test_12345","security test: attempting unauthorized budget read"),"Was able to read budget (unexpected)"),!0);break;case"Read another user's document":await l(b,async()=>(await Rt("users","another_user_test_12345","security test: attempting unauthorized user read"),"Was able to read user document (unexpected)"),!0);break;case"Read unauthorized budget month":await l(b,async()=>(await Rt("months","unauthorized_budget_test_12345_2024_01","security test: attempting unauthorized month read"),"Was able to read month document for unauthorized budget (unexpected)"),!0);break;case"Toggle is_admin in own permission_flags":await l(b,async()=>{if(!t)throw new Error("Not authenticated");const{data:C}=await Rt("users",t,"security test: reading own user to get current is_admin value"),x=C?.permission_flags?.is_admin??!1;return await Af("users",t,{"permission_flags.is_admin":!x},"security test: attempting to toggle is_admin (should fail)"),`Was able to change is_admin from ${x} to ${!x} (SECURITY ISSUE!)`},!0);break;case"Toggle is_test in own permission_flags":await l(b,async()=>{if(!t)throw new Error("Not authenticated");const{data:C}=await Rt("users",t,"security test: reading own user to get current is_test value"),x=C?.permission_flags?.is_test??!1;return await Af("users",t,{"permission_flags.is_test":!x},"security test: attempting to toggle is_test (should fail)"),`Was able to change is_test from ${x} to ${!x} (SECURITY ISSUE!)`},!0);break;case"Read own user document":await l(b,async()=>{if(!t)throw new Error("Not authenticated");const{exists:C}=await Rt("users",t,"security test: reading own user document (should succeed)");if(C)return"Successfully read own document";throw new Error("Document does not exist")},!1);break}}async function m(b){e.find(x=>x.name===b)||n(x=>[...x,{name:b,status:"pending",message:"",expectedToFail:!0}]),i(!0),await h(b),i(!1)}const p=e.filter(b=>b.status==="passed").length,g=e.filter(b=>b.status==="failed").length,v=e.length;return u.jsxs("div",{children:[u.jsx("p",{style:AT,children:'Run security tests to verify Firestore rules are working correctly. Tests that are expected to fail (blocked by security rules) should show as "passed".'}),u.jsx("div",{style:{marginBottom:"1.5rem"},children:u.jsx(Ve,{onClick:d,disabled:r,variant:"primary",children:r?"Running Tests...":"Run All Tests"})}),e.length>0&&u.jsx(OB,{totalCount:v,passedCount:p,failedCount:g}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:[u.jsx("h3",{style:{margin:"0.5rem 0"},children:"Individual Tests"}),u.jsx(kl,{name:"Read unauthorized budget",description:"Try to read a budget the user doesn't have access to",expectedBehavior:"Should be blocked by Firestore rules",result:e.find(b=>b.name==="Read unauthorized budget"),onRun:()=>m("Read unauthorized budget"),disabled:r}),u.jsx(kl,{name:"Read another user's document",description:"Try to read another user's profile document",expectedBehavior:"Should be blocked by Firestore rules",result:e.find(b=>b.name==="Read another user's document"),onRun:()=>m("Read another user's document"),disabled:r}),u.jsx(kl,{name:"Read unauthorized budget month",description:"Try to read a month document for a budget you don't have access to",expectedBehavior:"Should be blocked - months inherit budget access",result:e.find(b=>b.name==="Read unauthorized budget month"),onRun:()=>m("Read unauthorized budget month"),disabled:r}),u.jsx(kl,{name:"Toggle is_admin in own permission_flags",description:"Try to change your admin privileges (toggles current value)",expectedBehavior:"Should be blocked - permission_flags is protected",result:e.find(b=>b.name==="Toggle is_admin in own permission_flags"),onRun:()=>m("Toggle is_admin in own permission_flags"),disabled:r}),u.jsx(kl,{name:"Toggle is_test in own permission_flags",description:"Try to change your test privileges (toggles current value)",expectedBehavior:"Should be blocked - permission_flags is protected",result:e.find(b=>b.name==="Toggle is_test in own permission_flags"),onRun:()=>m("Toggle is_test in own permission_flags"),disabled:r}),u.jsx(kl,{name:"Read own user document",description:"Read your own user profile document",expectedBehavior:"Should succeed - users can read their own data",result:e.find(b=>b.name==="Read own user document"),onRun:()=>m("Read own user document"),disabled:r,expectedToSucceed:!0})]}),g>0&&u.jsxs(mm,{style:{marginTop:"1.5rem"},children:[" ",g," test(s) failed! This may indicate a security vulnerability in your Firestore rules."]})]})}function PB({children:t}){const{addLoadingHold:e,removeLoadingHold:n}=Qn(),r=M.useContext(ud),i=Nn();return M.useEffect(()=>(r.is_auth_checked?n("protected-route"):e("protected-route","Checking authentication..."),()=>n("protected-route")),[r.is_auth_checked,e,n]),r.is_auth_checked?r.is_logged_in?t?u.jsx(u.Fragment,{children:t}):u.jsx(Bf,{}):u.jsx(zf,{to:"/account",state:{from:i.pathname},replace:!0}):null}function zB(){const{addLoadingHold:t,removeLoadingHold:e}=Qn(),{isInitialized:n,pageTitle:r}=Ye(),{isLoading:i,error:o}=Rn();return M.useEffect(()=>{n?e("budget-init"):t("budget-init",i?"Fetching data from server...":"Loading budget...")},[n,i,t,e]),M.useEffect(()=>()=>e("budget-init"),[e]),o?(console.error("[BudgetLayout] Error:",o),u.jsx("div",{style:Rf,children:u.jsxs("p",{style:{color:"#ef4444"},children:["Error: ",o.message]})})):u.jsx("div",{style:{...Rf,paddingBottom:"5rem"},children:u.jsxs(WT,{children:[u.jsx(bP,{title:r}),n&&u.jsx(Bf,{})]})})}const BB={is_logged_in:!1,is_auth_checked:!1,username:"",set_user_context:()=>{}};function LB(){const{isLoading:t,loadingMessage:e}=Qn();return t?u.jsx(Y0,{message:e}):null}function UB(){const[t,e]=M.useState(null);return M.useEffect(()=>gr.subscribe(e),[]),t?u.jsx(xP,{item:t,onDismiss:n=>gr.remove(n)}):null}function FB(){const{selectedBudgetId:t,isInitialized:e}=Ye(),n=$t(),r=t?["initialDataLoad",t]:null,i=r?n.getQueryState(r)?.status==="success":!1;return Sn(),l3(),d3(t,i&&e),u.jsxs(u.Fragment,{children:[u.jsxs(Q5,{children:[u.jsx(En,{path:"/",element:u.jsx(hz,{})}),u.jsx(En,{path:"/account",element:u.jsx(fz,{})}),u.jsx(En,{path:"/budget",element:u.jsx(PB,{}),children:u.jsxs(En,{element:u.jsx(zB,{}),children:[u.jsx(En,{index:!0,element:u.jsx(eS,{})}),u.jsx(En,{path:":year/:month/:tab/:view?",element:u.jsx(eS,{})}),u.jsx(En,{path:"analytics",element:u.jsx(uB,{})}),u.jsx(En,{path:"my-budgets",element:u.jsx(bB,{})}),u.jsxs(En,{path:"settings",element:u.jsx(xB,{}),children:[u.jsx(En,{index:!0,element:u.jsx(zf,{to:"categories",replace:!0})}),u.jsx(En,{path:"accounts",element:u.jsx(CB,{})}),u.jsx(En,{path:"categories",element:u.jsx(TB,{})}),u.jsx(En,{path:"users",element:u.jsx(AB,{})})]}),u.jsxs(En,{path:"admin",element:u.jsx(RB,{}),children:[u.jsx(En,{path:"budget",element:u.jsx(IB,{})}),u.jsx(En,{path:"feedback",element:u.jsx(kB,{})}),u.jsx(En,{path:"migration",element:u.jsx(MB,{})}),u.jsx(En,{path:"tests",element:u.jsx(NB,{})})]})]})})]}),u.jsx(gP,{}),u.jsx(JT,{}),u.jsx(UB,{})]})}function VB(){const[t,e]=M.useState(BB),n=Na(),r=M.useRef(!1),{addLoadingHold:i,removeLoadingHold:o}=Qn();return M.useEffect(function(){r.current||(r.current=!0,n.set_user_listener(l=>{e({is_logged_in:l!=null,is_auth_checked:!0,username:l?.email??"",set_user_context:e})}))},[n]),M.useEffect(()=>{t.is_auth_checked?o("auth"):i("auth","Authenticating...")},[t.is_auth_checked,i,o]),t.is_auth_checked?u.jsx(ud.Provider,{value:t,children:u.jsx(hM,{children:u.jsx(WP,{children:u.jsx(H4,{children:u.jsx(f3,{children:u.jsx(_j,{children:u.jsx(FB,{})})})})})})}):null}function $B(){return u.jsxs(uR,{children:[u.jsx(LB,{}),u.jsx(VB,{})]})}Q2.createRoot(document.getElementById("root")).render(u.jsx(M.StrictMode,{children:u.jsx($B,{})}));
